(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();function Cx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ju={exports:{}},So={};var Vh;function kx(){if(Vh)return So;Vh=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(o,r,c){var d=null;if(c!==void 0&&(d=""+c),r.key!==void 0&&(d=""+r.key),"key"in r){c={};for(var h in r)h!=="key"&&(c[h]=r[h])}else c=r;return r=c.ref,{$$typeof:e,type:o,key:d,ref:r!==void 0?r:null,props:c}}return So.Fragment=n,So.jsx=a,So.jsxs=a,So}var Yh;function Nx(){return Yh||(Yh=1,Ju.exports=kx()),Ju.exports}var y=Nx(),Qu={exports:{}},we={};var Kh;function Rx(){if(Kh)return we;Kh=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),d=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),b=Symbol.for("react.activity"),x=Symbol.iterator;function T(R){return R===null||typeof R!="object"?null:(R=x&&R[x]||R["@@iterator"],typeof R=="function"?R:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,O={};function _(R,W,Q){this.props=R,this.context=W,this.refs=O,this.updater=Q||S}_.prototype.isReactComponent={},_.prototype.setState=function(R,W){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,W,"setState")},_.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function E(){}E.prototype=_.prototype;function w(R,W,Q){this.props=R,this.context=W,this.refs=O,this.updater=Q||S}var C=w.prototype=new E;C.constructor=w,A(C,_.prototype),C.isPureReactComponent=!0;var I=Array.isArray;function N(){}var H={H:null,A:null,T:null,S:null},D=Object.prototype.hasOwnProperty;function G(R,W,Q){var ne=Q.ref;return{$$typeof:e,type:R,key:W,ref:ne!==void 0?ne:null,props:Q}}function P(R,W){return G(R.type,W,R.props)}function Y(R){return typeof R=="object"&&R!==null&&R.$$typeof===e}function F(R){var W={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(Q){return W[Q]})}var Z=/\/+/g;function z(R,W){return typeof R=="object"&&R!==null&&R.key!=null?F(""+R.key):W.toString(36)}function q(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(N,N):(R.status="pending",R.then(function(W){R.status==="pending"&&(R.status="fulfilled",R.value=W)},function(W){R.status==="pending"&&(R.status="rejected",R.reason=W)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function B(R,W,Q,ne,re){var ce=typeof R;(ce==="undefined"||ce==="boolean")&&(R=null);var me=!1;if(R===null)me=!0;else switch(ce){case"bigint":case"string":case"number":me=!0;break;case"object":switch(R.$$typeof){case e:case n:me=!0;break;case f:return me=R._init,B(me(R._payload),W,Q,ne,re)}}if(me)return re=re(R),me=ne===""?"."+z(R,0):ne,I(re)?(Q="",me!=null&&(Q=me.replace(Z,"$&/")+"/"),B(re,W,Q,"",function(_e){return _e})):re!=null&&(Y(re)&&(re=P(re,Q+(re.key==null||R&&R.key===re.key?"":(""+re.key).replace(Z,"$&/")+"/")+me)),W.push(re)),1;me=0;var Ce=ne===""?".":ne+":";if(I(R))for(var ve=0;ve<R.length;ve++)ne=R[ve],ce=Ce+z(ne,ve),me+=B(ne,W,Q,ce,re);else if(ve=T(R),typeof ve=="function")for(R=ve.call(R),ve=0;!(ne=R.next()).done;)ne=ne.value,ce=Ce+z(ne,ve++),me+=B(ne,W,Q,ce,re);else if(ce==="object"){if(typeof R.then=="function")return B(q(R),W,Q,ne,re);throw W=String(R),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.")}return me}function $(R,W,Q){if(R==null)return R;var ne=[],re=0;return B(R,ne,"","",function(ce){return W.call(Q,ce,re++)}),ne}function X(R){if(R._status===-1){var W=R._result;W=W(),W.then(function(Q){(R._status===0||R._status===-1)&&(R._status=1,R._result=Q)},function(Q){(R._status===0||R._status===-1)&&(R._status=2,R._result=Q)}),R._status===-1&&(R._status=0,R._result=W)}if(R._status===1)return R._result.default;throw R._result}var le=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var W=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(W))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},fe={map:$,forEach:function(R,W,Q){$(R,function(){W.apply(this,arguments)},Q)},count:function(R){var W=0;return $(R,function(){W++}),W},toArray:function(R){return $(R,function(W){return W})||[]},only:function(R){if(!Y(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return we.Activity=b,we.Children=fe,we.Component=_,we.Fragment=a,we.Profiler=r,we.PureComponent=w,we.StrictMode=o,we.Suspense=g,we.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,we.__COMPILER_RUNTIME={__proto__:null,c:function(R){return H.H.useMemoCache(R)}},we.cache=function(R){return function(){return R.apply(null,arguments)}},we.cacheSignal=function(){return null},we.cloneElement=function(R,W,Q){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var ne=A({},R.props),re=R.key;if(W!=null)for(ce in W.key!==void 0&&(re=""+W.key),W)!D.call(W,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&W.ref===void 0||(ne[ce]=W[ce]);var ce=arguments.length-2;if(ce===1)ne.children=Q;else if(1<ce){for(var me=Array(ce),Ce=0;Ce<ce;Ce++)me[Ce]=arguments[Ce+2];ne.children=me}return G(R.type,re,ne)},we.createContext=function(R){return R={$$typeof:d,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:c,_context:R},R},we.createElement=function(R,W,Q){var ne,re={},ce=null;if(W!=null)for(ne in W.key!==void 0&&(ce=""+W.key),W)D.call(W,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(re[ne]=W[ne]);var me=arguments.length-2;if(me===1)re.children=Q;else if(1<me){for(var Ce=Array(me),ve=0;ve<me;ve++)Ce[ve]=arguments[ve+2];re.children=Ce}if(R&&R.defaultProps)for(ne in me=R.defaultProps,me)re[ne]===void 0&&(re[ne]=me[ne]);return G(R,ce,re)},we.createRef=function(){return{current:null}},we.forwardRef=function(R){return{$$typeof:h,render:R}},we.isValidElement=Y,we.lazy=function(R){return{$$typeof:f,_payload:{_status:-1,_result:R},_init:X}},we.memo=function(R,W){return{$$typeof:m,type:R,compare:W===void 0?null:W}},we.startTransition=function(R){var W=H.T,Q={};H.T=Q;try{var ne=R(),re=H.S;re!==null&&re(Q,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(N,le)}catch(ce){le(ce)}finally{W!==null&&Q.types!==null&&(W.types=Q.types),H.T=W}},we.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},we.use=function(R){return H.H.use(R)},we.useActionState=function(R,W,Q){return H.H.useActionState(R,W,Q)},we.useCallback=function(R,W){return H.H.useCallback(R,W)},we.useContext=function(R){return H.H.useContext(R)},we.useDebugValue=function(){},we.useDeferredValue=function(R,W){return H.H.useDeferredValue(R,W)},we.useEffect=function(R,W){return H.H.useEffect(R,W)},we.useEffectEvent=function(R){return H.H.useEffectEvent(R)},we.useId=function(){return H.H.useId()},we.useImperativeHandle=function(R,W,Q){return H.H.useImperativeHandle(R,W,Q)},we.useInsertionEffect=function(R,W){return H.H.useInsertionEffect(R,W)},we.useLayoutEffect=function(R,W){return H.H.useLayoutEffect(R,W)},we.useMemo=function(R,W){return H.H.useMemo(R,W)},we.useOptimistic=function(R,W){return H.H.useOptimistic(R,W)},we.useReducer=function(R,W,Q){return H.H.useReducer(R,W,Q)},we.useRef=function(R){return H.H.useRef(R)},we.useState=function(R){return H.H.useState(R)},we.useSyncExternalStore=function(R,W,Q){return H.H.useSyncExternalStore(R,W,Q)},we.useTransition=function(){return H.H.useTransition()},we.version="19.2.3",we}var Fh;function Dd(){return Fh||(Fh=1,Qu.exports=Rx()),Qu.exports}var k=Dd();const Fn=Cx(k);var Zu={exports:{}},Ao={},ed={exports:{}},td={};var Xh;function Ix(){return Xh||(Xh=1,(function(e){function n(B,$){var X=B.length;B.push($);e:for(;0<X;){var le=X-1>>>1,fe=B[le];if(0<r(fe,$))B[le]=$,B[X]=fe,X=le;else break e}}function a(B){return B.length===0?null:B[0]}function o(B){if(B.length===0)return null;var $=B[0],X=B.pop();if(X!==$){B[0]=X;e:for(var le=0,fe=B.length,R=fe>>>1;le<R;){var W=2*(le+1)-1,Q=B[W],ne=W+1,re=B[ne];if(0>r(Q,X))ne<fe&&0>r(re,Q)?(B[le]=re,B[ne]=X,le=ne):(B[le]=Q,B[W]=X,le=W);else if(ne<fe&&0>r(re,X))B[le]=re,B[ne]=X,le=ne;else break e}}return $}function r(B,$){var X=B.sortIndex-$.sortIndex;return X!==0?X:B.id-$.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var d=Date,h=d.now();e.unstable_now=function(){return d.now()-h}}var g=[],m=[],f=1,b=null,x=3,T=!1,S=!1,A=!1,O=!1,_=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function C(B){for(var $=a(m);$!==null;){if($.callback===null)o(m);else if($.startTime<=B)o(m),$.sortIndex=$.expirationTime,n(g,$);else break;$=a(m)}}function I(B){if(A=!1,C(B),!S)if(a(g)!==null)S=!0,N||(N=!0,F());else{var $=a(m);$!==null&&q(I,$.startTime-B)}}var N=!1,H=-1,D=5,G=-1;function P(){return O?!0:!(e.unstable_now()-G<D)}function Y(){if(O=!1,N){var B=e.unstable_now();G=B;var $=!0;try{e:{S=!1,A&&(A=!1,E(H),H=-1),T=!0;var X=x;try{t:{for(C(B),b=a(g);b!==null&&!(b.expirationTime>B&&P());){var le=b.callback;if(typeof le=="function"){b.callback=null,x=b.priorityLevel;var fe=le(b.expirationTime<=B);if(B=e.unstable_now(),typeof fe=="function"){b.callback=fe,C(B),$=!0;break t}b===a(g)&&o(g),C(B)}else o(g);b=a(g)}if(b!==null)$=!0;else{var R=a(m);R!==null&&q(I,R.startTime-B),$=!1}}break e}finally{b=null,x=X,T=!1}$=void 0}}finally{$?F():N=!1}}}var F;if(typeof w=="function")F=function(){w(Y)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,z=Z.port2;Z.port1.onmessage=Y,F=function(){z.postMessage(null)}}else F=function(){_(Y,0)};function q(B,$){H=_(function(){B(e.unstable_now())},$)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(B){B.callback=null},e.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<B?Math.floor(1e3/B):5},e.unstable_getCurrentPriorityLevel=function(){return x},e.unstable_next=function(B){switch(x){case 1:case 2:case 3:var $=3;break;default:$=x}var X=x;x=$;try{return B()}finally{x=X}},e.unstable_requestPaint=function(){O=!0},e.unstable_runWithPriority=function(B,$){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var X=x;x=B;try{return $()}finally{x=X}},e.unstable_scheduleCallback=function(B,$,X){var le=e.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?le+X:le):X=le,B){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=X+fe,B={id:f++,callback:$,priorityLevel:B,startTime:X,expirationTime:fe,sortIndex:-1},X>le?(B.sortIndex=X,n(m,B),a(g)===null&&B===a(m)&&(A?(E(H),H=-1):A=!0,q(I,X-le))):(B.sortIndex=fe,n(g,B),S||T||(S=!0,N||(N=!0,F()))),B},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(B){var $=x;return function(){var X=x;x=$;try{return B.apply(this,arguments)}finally{x=X}}}})(td)),td}var Wh;function Lx(){return Wh||(Wh=1,ed.exports=Ix()),ed.exports}var nd={exports:{}},nn={};var Gh;function Hx(){if(Gh)return nn;Gh=1;var e=Dd();function n(g){var m="https://react.dev/errors/"+g;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)m+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+g+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var o={d:{f:a,r:function(){throw Error(n(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},r=Symbol.for("react.portal");function c(g,m,f){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:b==null?null:""+b,children:g,containerInfo:m,implementation:f}}var d=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(g,m){if(g==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return nn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,nn.createPortal=function(g,m){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(n(299));return c(g,m,null,f)},nn.flushSync=function(g){var m=d.T,f=o.p;try{if(d.T=null,o.p=2,g)return g()}finally{d.T=m,o.p=f,o.d.f()}},nn.preconnect=function(g,m){typeof g=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,o.d.C(g,m))},nn.prefetchDNS=function(g){typeof g=="string"&&o.d.D(g)},nn.preinit=function(g,m){if(typeof g=="string"&&m&&typeof m.as=="string"){var f=m.as,b=h(f,m.crossOrigin),x=typeof m.integrity=="string"?m.integrity:void 0,T=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;f==="style"?o.d.S(g,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:b,integrity:x,fetchPriority:T}):f==="script"&&o.d.X(g,{crossOrigin:b,integrity:x,fetchPriority:T,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},nn.preinitModule=function(g,m){if(typeof g=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var f=h(m.as,m.crossOrigin);o.d.M(g,{crossOrigin:f,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&o.d.M(g)},nn.preload=function(g,m){if(typeof g=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var f=m.as,b=h(f,m.crossOrigin);o.d.L(g,f,{crossOrigin:b,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},nn.preloadModule=function(g,m){if(typeof g=="string")if(m){var f=h(m.as,m.crossOrigin);o.d.m(g,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:f,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else o.d.m(g)},nn.requestFormReset=function(g){o.d.r(g)},nn.unstable_batchedUpdates=function(g,m){return g(m)},nn.useFormState=function(g,m,f){return d.H.useFormState(g,m,f)},nn.useFormStatus=function(){return d.H.useHostTransitionStatus()},nn.version="19.2.3",nn}var Jh;function Bx(){if(Jh)return nd.exports;Jh=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),nd.exports=Hx(),nd.exports}var Qh;function jx(){if(Qh)return Ao;Qh=1;var e=Lx(),n=Dd(),a=Bx();function o(t){var i="https://react.dev/errors/"+t;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)i+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function c(t){var i=t,s=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(s=i.return),t=i.return;while(t)}return i.tag===3?s:null}function d(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function h(t){if(t.tag===31){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function g(t){if(c(t)!==t)throw Error(o(188))}function m(t){var i=t.alternate;if(!i){if(i=c(t),i===null)throw Error(o(188));return i!==t?null:t}for(var s=t,l=i;;){var u=s.return;if(u===null)break;var p=u.alternate;if(p===null){if(l=u.return,l!==null){s=l;continue}break}if(u.child===p.child){for(p=u.child;p;){if(p===s)return g(u),t;if(p===l)return g(u),i;p=p.sibling}throw Error(o(188))}if(s.return!==l.return)s=u,l=p;else{for(var v=!1,M=u.child;M;){if(M===s){v=!0,s=u,l=p;break}if(M===l){v=!0,l=u,s=p;break}M=M.sibling}if(!v){for(M=p.child;M;){if(M===s){v=!0,s=p,l=u;break}if(M===l){v=!0,l=p,s=u;break}M=M.sibling}if(!v)throw Error(o(189))}}if(s.alternate!==l)throw Error(o(190))}if(s.tag!==3)throw Error(o(188));return s.stateNode.current===s?t:i}function f(t){var i=t.tag;if(i===5||i===26||i===27||i===6)return t;for(t=t.child;t!==null;){if(i=f(t),i!==null)return i;t=t.sibling}return null}var b=Object.assign,x=Symbol.for("react.element"),T=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),O=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),w=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),D=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),Y=Symbol.iterator;function F(t){return t===null||typeof t!="object"?null:(t=Y&&t[Y]||t["@@iterator"],typeof t=="function"?t:null)}var Z=Symbol.for("react.client.reference");function z(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===Z?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case A:return"Fragment";case _:return"Profiler";case O:return"StrictMode";case I:return"Suspense";case N:return"SuspenseList";case G:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case S:return"Portal";case w:return t.displayName||"Context";case E:return(t._context.displayName||"Context")+".Consumer";case C:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case H:return i=t.displayName||null,i!==null?i:z(t.type)||"Memo";case D:i=t._payload,t=t._init;try{return z(t(i))}catch{}}return null}var q=Array.isArray,B=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},le=[],fe=-1;function R(t){return{current:t}}function W(t){0>fe||(t.current=le[fe],le[fe]=null,fe--)}function Q(t,i){fe++,le[fe]=t.current,t.current=i}var ne=R(null),re=R(null),ce=R(null),me=R(null);function Ce(t,i){switch(Q(ce,i),Q(re,t),Q(ne,null),i.nodeType){case 9:case 11:t=(t=i.documentElement)&&(t=t.namespaceURI)?mh(t):0;break;default:if(t=i.tagName,i=i.namespaceURI)i=mh(i),t=ph(i,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}W(ne),Q(ne,t)}function ve(){W(ne),W(re),W(ce)}function _e(t){t.memoizedState!==null&&Q(me,t);var i=ne.current,s=ph(i,t.type);i!==s&&(Q(re,t),Q(ne,s))}function ke(t){re.current===t&&(W(ne),W(re)),me.current===t&&(W(me),go._currentValue=X)}var ze,Ue;function qe(t){if(ze===void 0)try{throw Error()}catch(s){var i=s.stack.trim().match(/\n( *(at )?)/);ze=i&&i[1]||"",Ue=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ze+t+Ue}var Ge=!1;function dt(t,i){if(!t||Ge)return"";Ge=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(i){var oe=function(){throw Error()};if(Object.defineProperty(oe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(oe,[])}catch(te){var J=te}Reflect.construct(t,[],oe)}else{try{oe.call()}catch(te){J=te}t.call(oe.prototype)}}else{try{throw Error()}catch(te){J=te}(oe=t())&&typeof oe.catch=="function"&&oe.catch(function(){})}}catch(te){if(te&&J&&typeof te.stack=="string")return[te.stack,J.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var p=l.DetermineComponentFrameRoot(),v=p[0],M=p[1];if(v&&M){var L=v.split(`
`),K=M.split(`
`);for(u=l=0;l<L.length&&!L[l].includes("DetermineComponentFrameRoot");)l++;for(;u<K.length&&!K[u].includes("DetermineComponentFrameRoot");)u++;if(l===L.length||u===K.length)for(l=L.length-1,u=K.length-1;1<=l&&0<=u&&L[l]!==K[u];)u--;for(;1<=l&&0<=u;l--,u--)if(L[l]!==K[u]){if(l!==1||u!==1)do if(l--,u--,0>u||L[l]!==K[u]){var ie=`
`+L[l].replace(" at new "," at ");return t.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",t.displayName)),ie}while(1<=l&&0<=u);break}}}finally{Ge=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?qe(s):""}function Te(t,i){switch(t.tag){case 26:case 27:case 5:return qe(t.type);case 16:return qe("Lazy");case 13:return t.child!==i&&i!==null?qe("Suspense Fallback"):qe("Suspense");case 19:return qe("SuspenseList");case 0:case 15:return dt(t.type,!1);case 11:return dt(t.type.render,!1);case 1:return dt(t.type,!0);case 31:return qe("Activity");default:return""}}function rt(t){try{var i="",s=null;do i+=Te(t,s),s=t,t=t.return;while(t);return i}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var wt=Object.prototype.hasOwnProperty,Ut=e.unstable_scheduleCallback,Mt=e.unstable_cancelCallback,Un=e.unstable_shouldYield,qn=e.unstable_requestPaint,Nt=e.unstable_now,Qn=e.unstable_getCurrentPriorityLevel,ft=e.unstable_ImmediatePriority,St=e.unstable_UserBlockingPriority,qt=e.unstable_NormalPriority,Zn=e.unstable_LowPriority,yn=e.unstable_IdlePriority,ua=e.log,ja=e.unstable_setDisableYieldValue,ln=null,De=null;function et(t){if(typeof ua=="function"&&ja(t),De&&typeof De.setStrictMode=="function")try{De.setStrictMode(ln,t)}catch{}}var st=Math.clz32?Math.clz32:Re,Mn=Math.log,Ae=Math.LN2;function Re(t){return t>>>=0,t===0?32:31-(Mn(t)/Ae|0)|0}var We=256,lt=262144,ct=4194304;function $t(t){var i=t&42;if(i!==0)return i;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function At(t,i,s){var l=t.pendingLanes;if(l===0)return 0;var u=0,p=t.suspendedLanes,v=t.pingedLanes;t=t.warmLanes;var M=l&134217727;return M!==0?(l=M&~p,l!==0?u=$t(l):(v&=M,v!==0?u=$t(v):s||(s=M&~t,s!==0&&(u=$t(s))))):(M=l&~p,M!==0?u=$t(M):v!==0?u=$t(v):s||(s=l&~t,s!==0&&(u=$t(s)))),u===0?0:i!==0&&i!==u&&(i&p)===0&&(p=u&-u,s=i&-i,p>=s||p===32&&(s&4194048)!==0)?i:u}function gn(t,i){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&i)===0}function bn(t,i){switch(t){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ri(){var t=ct;return ct<<=1,(ct&62914560)===0&&(ct=4194304),t}function ei(t){for(var i=[],s=0;31>s;s++)i.push(t);return i}function $n(t,i){t.pendingLanes|=i,i!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Rt(t,i,s,l,u,p){var v=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var M=t.entanglements,L=t.expirationTimes,K=t.hiddenUpdates;for(s=v&~s;0<s;){var ie=31-st(s),oe=1<<ie;M[ie]=0,L[ie]=-1;var J=K[ie];if(J!==null)for(K[ie]=null,ie=0;ie<J.length;ie++){var te=J[ie];te!==null&&(te.lane&=-536870913)}s&=~oe}l!==0&&yt(t,l,0),p!==0&&u===0&&t.tag!==0&&(t.suspendedLanes|=p&~(v&~i))}function yt(t,i,s){t.pendingLanes|=i,t.suspendedLanes&=~i;var l=31-st(i);t.entangledLanes|=i,t.entanglements[l]=t.entanglements[l]|1073741824|s&261930}function tn(t,i){var s=t.entangledLanes|=i;for(t=t.entanglements;s;){var l=31-st(s),u=1<<l;u&i|t[l]&i&&(t[l]|=i),s&=~u}}function ti(t,i){var s=i&-i;return s=(s&42)!==0?1:Cs(s),(s&(t.suspendedLanes|i))!==0?0:s}function Cs(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Da(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function ks(){var t=$.p;return t!==0?t:(t=window.event,t===void 0?32:jh(t.type))}function Qd(t,i){var s=$.p;try{return $.p=t,i()}finally{$.p=s}}var Ri=Math.random().toString(36).slice(2),Wt="__reactFiber$"+Ri,cn="__reactProps$"+Ri,Pa="__reactContainer$"+Ri,$l="__reactEvents$"+Ri,b0="__reactListeners$"+Ri,x0="__reactHandles$"+Ri,Zd="__reactResources$"+Ri,Ns="__reactMarker$"+Ri;function zl(t){delete t[Wt],delete t[cn],delete t[$l],delete t[b0],delete t[x0]}function Ua(t){var i=t[Wt];if(i)return i;for(var s=t.parentNode;s;){if(i=s[Pa]||s[Wt]){if(s=i.alternate,i.child!==null||s!==null&&s.child!==null)for(t=Sh(t);t!==null;){if(s=t[Wt])return s;t=Sh(t)}return i}t=s,s=t.parentNode}return null}function qa(t){if(t=t[Wt]||t[Pa]){var i=t.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return t}return null}function Rs(t){var i=t.tag;if(i===5||i===26||i===27||i===6)return t.stateNode;throw Error(o(33))}function $a(t){var i=t[Zd];return i||(i=t[Zd]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Kt(t){t[Ns]=!0}var ef=new Set,tf={};function da(t,i){za(t,i),za(t+"Capture",i)}function za(t,i){for(tf[t]=i,t=0;t<i.length;t++)ef.add(i[t])}var v0=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),nf={},af={};function S0(t){return wt.call(af,t)?!0:wt.call(nf,t)?!1:v0.test(t)?af[t]=!0:(nf[t]=!0,!1)}function Po(t,i,s){if(S0(i))if(s===null)t.removeAttribute(i);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(i);return;case"boolean":var l=i.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){t.removeAttribute(i);return}}t.setAttribute(i,""+s)}}function Uo(t,i,s){if(s===null)t.removeAttribute(i);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(i);return}t.setAttribute(i,""+s)}}function li(t,i,s,l){if(l===null)t.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(i,s,""+l)}}function On(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function sf(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function A0(t,i,s){var l=Object.getOwnPropertyDescriptor(t.constructor.prototype,i);if(!t.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var u=l.get,p=l.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return u.call(this)},set:function(v){s=""+v,p.call(this,v)}}),Object.defineProperty(t,i,{enumerable:l.enumerable}),{getValue:function(){return s},setValue:function(v){s=""+v},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Vl(t){if(!t._valueTracker){var i=sf(t)?"checked":"value";t._valueTracker=A0(t,i,""+t[i])}}function of(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var s=i.getValue(),l="";return t&&(l=sf(t)?t.checked?"true":"false":t.value),t=l,t!==s?(i.setValue(t),!0):!1}function qo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var T0=/[\n"\\]/g;function Cn(t){return t.replace(T0,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Yl(t,i,s,l,u,p,v,M){t.name="",v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?t.type=v:t.removeAttribute("type"),i!=null?v==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+On(i)):t.value!==""+On(i)&&(t.value=""+On(i)):v!=="submit"&&v!=="reset"||t.removeAttribute("value"),i!=null?Kl(t,v,On(i)):s!=null?Kl(t,v,On(s)):l!=null&&t.removeAttribute("value"),u==null&&p!=null&&(t.defaultChecked=!!p),u!=null&&(t.checked=u&&typeof u!="function"&&typeof u!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?t.name=""+On(M):t.removeAttribute("name")}function rf(t,i,s,l,u,p,v,M){if(p!=null&&typeof p!="function"&&typeof p!="symbol"&&typeof p!="boolean"&&(t.type=p),i!=null||s!=null){if(!(p!=="submit"&&p!=="reset"||i!=null)){Vl(t);return}s=s!=null?""+On(s):"",i=i!=null?""+On(i):s,M||i===t.value||(t.value=i),t.defaultValue=i}l=l??u,l=typeof l!="function"&&typeof l!="symbol"&&!!l,t.checked=M?t.checked:!!l,t.defaultChecked=!!l,v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(t.name=v),Vl(t)}function Kl(t,i,s){i==="number"&&qo(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function Va(t,i,s,l){if(t=t.options,i){i={};for(var u=0;u<s.length;u++)i["$"+s[u]]=!0;for(s=0;s<t.length;s++)u=i.hasOwnProperty("$"+t[s].value),t[s].selected!==u&&(t[s].selected=u),u&&l&&(t[s].defaultSelected=!0)}else{for(s=""+On(s),i=null,u=0;u<t.length;u++){if(t[u].value===s){t[u].selected=!0,l&&(t[u].defaultSelected=!0);return}i!==null||t[u].disabled||(i=t[u])}i!==null&&(i.selected=!0)}}function lf(t,i,s){if(i!=null&&(i=""+On(i),i!==t.value&&(t.value=i),s==null)){t.defaultValue!==i&&(t.defaultValue=i);return}t.defaultValue=s!=null?""+On(s):""}function cf(t,i,s,l){if(i==null){if(l!=null){if(s!=null)throw Error(o(92));if(q(l)){if(1<l.length)throw Error(o(93));l=l[0]}s=l}s==null&&(s=""),i=s}s=On(i),t.defaultValue=s,l=t.textContent,l===s&&l!==""&&l!==null&&(t.value=l),Vl(t)}function Ya(t,i){if(i){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=i;return}}t.textContent=i}var E0=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function uf(t,i,s){var l=i.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?l?t.setProperty(i,""):i==="float"?t.cssFloat="":t[i]="":l?t.setProperty(i,s):typeof s!="number"||s===0||E0.has(i)?i==="float"?t.cssFloat=s:t[i]=(""+s).trim():t[i]=s+"px"}function df(t,i,s){if(i!=null&&typeof i!="object")throw Error(o(62));if(t=t.style,s!=null){for(var l in s)!s.hasOwnProperty(l)||i!=null&&i.hasOwnProperty(l)||(l.indexOf("--")===0?t.setProperty(l,""):l==="float"?t.cssFloat="":t[l]="");for(var u in i)l=i[u],i.hasOwnProperty(u)&&s[u]!==l&&uf(t,u,l)}else for(var p in i)i.hasOwnProperty(p)&&uf(t,p,i[p])}function Fl(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _0=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),w0=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $o(t){return w0.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function ci(){}var Xl=null;function Wl(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ka=null,Fa=null;function ff(t){var i=qa(t);if(i&&(t=i.stateNode)){var s=t[cn]||null;e:switch(t=i.stateNode,i.type){case"input":if(Yl(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),i=s.name,s.type==="radio"&&i!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+Cn(""+i)+'"][type="radio"]'),i=0;i<s.length;i++){var l=s[i];if(l!==t&&l.form===t.form){var u=l[cn]||null;if(!u)throw Error(o(90));Yl(l,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(i=0;i<s.length;i++)l=s[i],l.form===t.form&&of(l)}break e;case"textarea":lf(t,s.value,s.defaultValue);break e;case"select":i=s.value,i!=null&&Va(t,!!s.multiple,i,!1)}}}var Gl=!1;function mf(t,i,s){if(Gl)return t(i,s);Gl=!0;try{var l=t(i);return l}finally{if(Gl=!1,(Ka!==null||Fa!==null)&&(Cr(),Ka&&(i=Ka,t=Fa,Fa=Ka=null,ff(i),t)))for(i=0;i<t.length;i++)ff(t[i])}}function Is(t,i){var s=t.stateNode;if(s===null)return null;var l=s[cn]||null;if(l===null)return null;s=l[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(o(231,i,typeof s));return s}var ui=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jl=!1;if(ui)try{var Ls={};Object.defineProperty(Ls,"passive",{get:function(){Jl=!0}}),window.addEventListener("test",Ls,Ls),window.removeEventListener("test",Ls,Ls)}catch{Jl=!1}var Ii=null,Ql=null,zo=null;function pf(){if(zo)return zo;var t,i=Ql,s=i.length,l,u="value"in Ii?Ii.value:Ii.textContent,p=u.length;for(t=0;t<s&&i[t]===u[t];t++);var v=s-t;for(l=1;l<=v&&i[s-l]===u[p-l];l++);return zo=u.slice(t,1<l?1-l:void 0)}function Vo(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function Yo(){return!0}function hf(){return!1}function un(t){function i(s,l,u,p,v){this._reactName=s,this._targetInst=u,this.type=l,this.nativeEvent=p,this.target=v,this.currentTarget=null;for(var M in t)t.hasOwnProperty(M)&&(s=t[M],this[M]=s?s(p):p[M]);return this.isDefaultPrevented=(p.defaultPrevented!=null?p.defaultPrevented:p.returnValue===!1)?Yo:hf,this.isPropagationStopped=hf,this}return b(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Yo)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Yo)},persist:function(){},isPersistent:Yo}),i}var fa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ko=un(fa),Hs=b({},fa,{view:0,detail:0}),M0=un(Hs),Zl,ec,Bs,Fo=b({},Hs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Bs&&(Bs&&t.type==="mousemove"?(Zl=t.screenX-Bs.screenX,ec=t.screenY-Bs.screenY):ec=Zl=0,Bs=t),Zl)},movementY:function(t){return"movementY"in t?t.movementY:ec}}),yf=un(Fo),O0=b({},Fo,{dataTransfer:0}),C0=un(O0),k0=b({},Hs,{relatedTarget:0}),tc=un(k0),N0=b({},fa,{animationName:0,elapsedTime:0,pseudoElement:0}),R0=un(N0),I0=b({},fa,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),L0=un(I0),H0=b({},fa,{data:0}),gf=un(H0),B0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},j0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},D0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function P0(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=D0[t])?!!i[t]:!1}function nc(){return P0}var U0=b({},Hs,{key:function(t){if(t.key){var i=B0[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Vo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?j0[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nc,charCode:function(t){return t.type==="keypress"?Vo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Vo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),q0=un(U0),$0=b({},Fo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bf=un($0),z0=b({},Hs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nc}),V0=un(z0),Y0=b({},fa,{propertyName:0,elapsedTime:0,pseudoElement:0}),K0=un(Y0),F0=b({},Fo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),X0=un(F0),W0=b({},fa,{newState:0,oldState:0}),G0=un(W0),J0=[9,13,27,32],ic=ui&&"CompositionEvent"in window,js=null;ui&&"documentMode"in document&&(js=document.documentMode);var Q0=ui&&"TextEvent"in window&&!js,xf=ui&&(!ic||js&&8<js&&11>=js),vf=" ",Sf=!1;function Af(t,i){switch(t){case"keyup":return J0.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Xa=!1;function Z0(t,i){switch(t){case"compositionend":return Tf(i);case"keypress":return i.which!==32?null:(Sf=!0,vf);case"textInput":return t=i.data,t===vf&&Sf?null:t;default:return null}}function eb(t,i){if(Xa)return t==="compositionend"||!ic&&Af(t,i)?(t=pf(),zo=Ql=Ii=null,Xa=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return xf&&i.locale!=="ko"?null:i.data;default:return null}}var tb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ef(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!tb[t.type]:i==="textarea"}function _f(t,i,s,l){Ka?Fa?Fa.push(l):Fa=[l]:Ka=l,i=Br(i,"onChange"),0<i.length&&(s=new Ko("onChange","change",null,s,l),t.push({event:s,listeners:i}))}var Ds=null,Ps=null;function nb(t){rh(t,0)}function Xo(t){var i=Rs(t);if(of(i))return t}function wf(t,i){if(t==="change")return i}var Mf=!1;if(ui){var ac;if(ui){var sc="oninput"in document;if(!sc){var Of=document.createElement("div");Of.setAttribute("oninput","return;"),sc=typeof Of.oninput=="function"}ac=sc}else ac=!1;Mf=ac&&(!document.documentMode||9<document.documentMode)}function Cf(){Ds&&(Ds.detachEvent("onpropertychange",kf),Ps=Ds=null)}function kf(t){if(t.propertyName==="value"&&Xo(Ps)){var i=[];_f(i,Ps,t,Wl(t)),mf(nb,i)}}function ib(t,i,s){t==="focusin"?(Cf(),Ds=i,Ps=s,Ds.attachEvent("onpropertychange",kf)):t==="focusout"&&Cf()}function ab(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Xo(Ps)}function sb(t,i){if(t==="click")return Xo(i)}function ob(t,i){if(t==="input"||t==="change")return Xo(i)}function rb(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var xn=typeof Object.is=="function"?Object.is:rb;function Us(t,i){if(xn(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var s=Object.keys(t),l=Object.keys(i);if(s.length!==l.length)return!1;for(l=0;l<s.length;l++){var u=s[l];if(!wt.call(i,u)||!xn(t[u],i[u]))return!1}return!0}function Nf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Rf(t,i){var s=Nf(t);t=0;for(var l;s;){if(s.nodeType===3){if(l=t+s.textContent.length,t<=i&&l>=i)return{node:s,offset:i-t};t=l}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Nf(s)}}function If(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?If(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function Lf(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var i=qo(t.document);i instanceof t.HTMLIFrameElement;){try{var s=typeof i.contentWindow.location.href=="string"}catch{s=!1}if(s)t=i.contentWindow;else break;i=qo(t.document)}return i}function oc(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}var lb=ui&&"documentMode"in document&&11>=document.documentMode,Wa=null,rc=null,qs=null,lc=!1;function Hf(t,i,s){var l=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;lc||Wa==null||Wa!==qo(l)||(l=Wa,"selectionStart"in l&&oc(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),qs&&Us(qs,l)||(qs=l,l=Br(rc,"onSelect"),0<l.length&&(i=new Ko("onSelect","select",null,i,s),t.push({event:i,listeners:l}),i.target=Wa)))}function ma(t,i){var s={};return s[t.toLowerCase()]=i.toLowerCase(),s["Webkit"+t]="webkit"+i,s["Moz"+t]="moz"+i,s}var Ga={animationend:ma("Animation","AnimationEnd"),animationiteration:ma("Animation","AnimationIteration"),animationstart:ma("Animation","AnimationStart"),transitionrun:ma("Transition","TransitionRun"),transitionstart:ma("Transition","TransitionStart"),transitioncancel:ma("Transition","TransitionCancel"),transitionend:ma("Transition","TransitionEnd")},cc={},Bf={};ui&&(Bf=document.createElement("div").style,"AnimationEvent"in window||(delete Ga.animationend.animation,delete Ga.animationiteration.animation,delete Ga.animationstart.animation),"TransitionEvent"in window||delete Ga.transitionend.transition);function pa(t){if(cc[t])return cc[t];if(!Ga[t])return t;var i=Ga[t],s;for(s in i)if(i.hasOwnProperty(s)&&s in Bf)return cc[t]=i[s];return t}var jf=pa("animationend"),Df=pa("animationiteration"),Pf=pa("animationstart"),cb=pa("transitionrun"),ub=pa("transitionstart"),db=pa("transitioncancel"),Uf=pa("transitionend"),qf=new Map,uc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");uc.push("scrollEnd");function zn(t,i){qf.set(t,i),da(i,[t])}var Wo=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},kn=[],Ja=0,dc=0;function Go(){for(var t=Ja,i=dc=Ja=0;i<t;){var s=kn[i];kn[i++]=null;var l=kn[i];kn[i++]=null;var u=kn[i];kn[i++]=null;var p=kn[i];if(kn[i++]=null,l!==null&&u!==null){var v=l.pending;v===null?u.next=u:(u.next=v.next,v.next=u),l.pending=u}p!==0&&$f(s,u,p)}}function Jo(t,i,s,l){kn[Ja++]=t,kn[Ja++]=i,kn[Ja++]=s,kn[Ja++]=l,dc|=l,t.lanes|=l,t=t.alternate,t!==null&&(t.lanes|=l)}function fc(t,i,s,l){return Jo(t,i,s,l),Qo(t)}function ha(t,i){return Jo(t,null,null,i),Qo(t)}function $f(t,i,s){t.lanes|=s;var l=t.alternate;l!==null&&(l.lanes|=s);for(var u=!1,p=t.return;p!==null;)p.childLanes|=s,l=p.alternate,l!==null&&(l.childLanes|=s),p.tag===22&&(t=p.stateNode,t===null||t._visibility&1||(u=!0)),t=p,p=p.return;return t.tag===3?(p=t.stateNode,u&&i!==null&&(u=31-st(s),t=p.hiddenUpdates,l=t[u],l===null?t[u]=[i]:l.push(i),i.lane=s|536870912),p):null}function Qo(t){if(50<co)throw co=0,Su=null,Error(o(185));for(var i=t.return;i!==null;)t=i,i=t.return;return t.tag===3?t.stateNode:null}var Qa={};function fb(t,i,s,l){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vn(t,i,s,l){return new fb(t,i,s,l)}function mc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function di(t,i){var s=t.alternate;return s===null?(s=vn(t.tag,i,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=i,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,i=t.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function zf(t,i){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=i,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,i=s.dependencies,t.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t}function Zo(t,i,s,l,u,p){var v=0;if(l=t,typeof t=="function")mc(t)&&(v=1);else if(typeof t=="string")v=gx(t,s,ne.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case G:return t=vn(31,s,i,u),t.elementType=G,t.lanes=p,t;case A:return ya(s.children,u,p,i);case O:v=8,u|=24;break;case _:return t=vn(12,s,i,u|2),t.elementType=_,t.lanes=p,t;case I:return t=vn(13,s,i,u),t.elementType=I,t.lanes=p,t;case N:return t=vn(19,s,i,u),t.elementType=N,t.lanes=p,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case w:v=10;break e;case E:v=9;break e;case C:v=11;break e;case H:v=14;break e;case D:v=16,l=null;break e}v=29,s=Error(o(130,t===null?"null":typeof t,"")),l=null}return i=vn(v,s,i,u),i.elementType=t,i.type=l,i.lanes=p,i}function ya(t,i,s,l){return t=vn(7,t,l,i),t.lanes=s,t}function pc(t,i,s){return t=vn(6,t,null,i),t.lanes=s,t}function Vf(t){var i=vn(18,null,null,0);return i.stateNode=t,i}function hc(t,i,s){return i=vn(4,t.children!==null?t.children:[],t.key,i),i.lanes=s,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}var Yf=new WeakMap;function Nn(t,i){if(typeof t=="object"&&t!==null){var s=Yf.get(t);return s!==void 0?s:(i={value:t,source:i,stack:rt(i)},Yf.set(t,i),i)}return{value:t,source:i,stack:rt(i)}}var Za=[],es=0,er=null,$s=0,Rn=[],In=0,Li=null,ni=1,ii="";function fi(t,i){Za[es++]=$s,Za[es++]=er,er=t,$s=i}function Kf(t,i,s){Rn[In++]=ni,Rn[In++]=ii,Rn[In++]=Li,Li=t;var l=ni;t=ii;var u=32-st(l)-1;l&=~(1<<u),s+=1;var p=32-st(i)+u;if(30<p){var v=u-u%5;p=(l&(1<<v)-1).toString(32),l>>=v,u-=v,ni=1<<32-st(i)+u|s<<u|l,ii=p+t}else ni=1<<p|s<<u|l,ii=t}function yc(t){t.return!==null&&(fi(t,1),Kf(t,1,0))}function gc(t){for(;t===er;)er=Za[--es],Za[es]=null,$s=Za[--es],Za[es]=null;for(;t===Li;)Li=Rn[--In],Rn[In]=null,ii=Rn[--In],Rn[In]=null,ni=Rn[--In],Rn[In]=null}function Ff(t,i){Rn[In++]=ni,Rn[In++]=ii,Rn[In++]=Li,ni=i.id,ii=i.overflow,Li=t}var Gt=null,mt=null,Pe=!1,Hi=null,Ln=!1,bc=Error(o(519));function Bi(t){var i=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw zs(Nn(i,t)),bc}function Xf(t){var i=t.stateNode,s=t.type,l=t.memoizedProps;switch(i[Wt]=t,i[cn]=l,s){case"dialog":He("cancel",i),He("close",i);break;case"iframe":case"object":case"embed":He("load",i);break;case"video":case"audio":for(s=0;s<fo.length;s++)He(fo[s],i);break;case"source":He("error",i);break;case"img":case"image":case"link":He("error",i),He("load",i);break;case"details":He("toggle",i);break;case"input":He("invalid",i),rf(i,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":He("invalid",i);break;case"textarea":He("invalid",i),cf(i,l.value,l.defaultValue,l.children)}s=l.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||i.textContent===""+s||l.suppressHydrationWarning===!0||dh(i.textContent,s)?(l.popover!=null&&(He("beforetoggle",i),He("toggle",i)),l.onScroll!=null&&He("scroll",i),l.onScrollEnd!=null&&He("scrollend",i),l.onClick!=null&&(i.onclick=ci),i=!0):i=!1,i||Bi(t,!0)}function Wf(t){for(Gt=t.return;Gt;)switch(Gt.tag){case 5:case 31:case 13:Ln=!1;return;case 27:case 3:Ln=!0;return;default:Gt=Gt.return}}function ts(t){if(t!==Gt)return!1;if(!Pe)return Wf(t),Pe=!0,!1;var i=t.tag,s;if((s=i!==3&&i!==27)&&((s=i===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||Bu(t.type,t.memoizedProps)),s=!s),s&&mt&&Bi(t),Wf(t),i===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));mt=vh(t)}else if(i===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));mt=vh(t)}else i===27?(i=mt,Gi(t.type)?(t=qu,qu=null,mt=t):mt=i):mt=Gt?Bn(t.stateNode.nextSibling):null;return!0}function ga(){mt=Gt=null,Pe=!1}function xc(){var t=Hi;return t!==null&&(pn===null?pn=t:pn.push.apply(pn,t),Hi=null),t}function zs(t){Hi===null?Hi=[t]:Hi.push(t)}var vc=R(null),ba=null,mi=null;function ji(t,i,s){Q(vc,i._currentValue),i._currentValue=s}function pi(t){t._currentValue=vc.current,W(vc)}function Sc(t,i,s){for(;t!==null;){var l=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,l!==null&&(l.childLanes|=i)):l!==null&&(l.childLanes&i)!==i&&(l.childLanes|=i),t===s)break;t=t.return}}function Ac(t,i,s,l){var u=t.child;for(u!==null&&(u.return=t);u!==null;){var p=u.dependencies;if(p!==null){var v=u.child;p=p.firstContext;e:for(;p!==null;){var M=p;p=u;for(var L=0;L<i.length;L++)if(M.context===i[L]){p.lanes|=s,M=p.alternate,M!==null&&(M.lanes|=s),Sc(p.return,s,t),l||(v=null);break e}p=M.next}}else if(u.tag===18){if(v=u.return,v===null)throw Error(o(341));v.lanes|=s,p=v.alternate,p!==null&&(p.lanes|=s),Sc(v,s,t),v=null}else v=u.child;if(v!==null)v.return=u;else for(v=u;v!==null;){if(v===t){v=null;break}if(u=v.sibling,u!==null){u.return=v.return,v=u;break}v=v.return}u=v}}function ns(t,i,s,l){t=null;for(var u=i,p=!1;u!==null;){if(!p){if((u.flags&524288)!==0)p=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var v=u.alternate;if(v===null)throw Error(o(387));if(v=v.memoizedProps,v!==null){var M=u.type;xn(u.pendingProps.value,v.value)||(t!==null?t.push(M):t=[M])}}else if(u===me.current){if(v=u.alternate,v===null)throw Error(o(387));v.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(t!==null?t.push(go):t=[go])}u=u.return}t!==null&&Ac(i,t,s,l),i.flags|=262144}function tr(t){for(t=t.firstContext;t!==null;){if(!xn(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function xa(t){ba=t,mi=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Jt(t){return Gf(ba,t)}function nr(t,i){return ba===null&&xa(t),Gf(t,i)}function Gf(t,i){var s=i._currentValue;if(i={context:i,memoizedValue:s,next:null},mi===null){if(t===null)throw Error(o(308));mi=i,t.dependencies={lanes:0,firstContext:i},t.flags|=524288}else mi=mi.next=i;return s}var mb=typeof AbortController<"u"?AbortController:function(){var t=[],i=this.signal={aborted:!1,addEventListener:function(s,l){t.push(l)}};this.abort=function(){i.aborted=!0,t.forEach(function(s){return s()})}},pb=e.unstable_scheduleCallback,hb=e.unstable_NormalPriority,It={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Tc(){return{controller:new mb,data:new Map,refCount:0}}function Vs(t){t.refCount--,t.refCount===0&&pb(hb,function(){t.controller.abort()})}var Ys=null,Ec=0,is=0,as=null;function yb(t,i){if(Ys===null){var s=Ys=[];Ec=0,is=Mu(),as={status:"pending",value:void 0,then:function(l){s.push(l)}}}return Ec++,i.then(Jf,Jf),i}function Jf(){if(--Ec===0&&Ys!==null){as!==null&&(as.status="fulfilled");var t=Ys;Ys=null,is=0,as=null;for(var i=0;i<t.length;i++)(0,t[i])()}}function gb(t,i){var s=[],l={status:"pending",value:null,reason:null,then:function(u){s.push(u)}};return t.then(function(){l.status="fulfilled",l.value=i;for(var u=0;u<s.length;u++)(0,s[u])(i)},function(u){for(l.status="rejected",l.reason=u,u=0;u<s.length;u++)(0,s[u])(void 0)}),l}var Qf=B.S;B.S=function(t,i){Hp=Nt(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&yb(t,i),Qf!==null&&Qf(t,i)};var va=R(null);function _c(){var t=va.current;return t!==null?t:ot.pooledCache}function ir(t,i){i===null?Q(va,va.current):Q(va,i.pool)}function Zf(){var t=_c();return t===null?null:{parent:It._currentValue,pool:t}}var ss=Error(o(460)),wc=Error(o(474)),ar=Error(o(542)),sr={then:function(){}};function em(t){return t=t.status,t==="fulfilled"||t==="rejected"}function tm(t,i,s){switch(s=t[s],s===void 0?t.push(i):s!==i&&(i.then(ci,ci),i=s),i.status){case"fulfilled":return i.value;case"rejected":throw t=i.reason,im(t),t;default:if(typeof i.status=="string")i.then(ci,ci);else{if(t=ot,t!==null&&100<t.shellSuspendCounter)throw Error(o(482));t=i,t.status="pending",t.then(function(l){if(i.status==="pending"){var u=i;u.status="fulfilled",u.value=l}},function(l){if(i.status==="pending"){var u=i;u.status="rejected",u.reason=l}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw t=i.reason,im(t),t}throw Aa=i,ss}}function Sa(t){try{var i=t._init;return i(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(Aa=s,ss):s}}var Aa=null;function nm(){if(Aa===null)throw Error(o(459));var t=Aa;return Aa=null,t}function im(t){if(t===ss||t===ar)throw Error(o(483))}var os=null,Ks=0;function or(t){var i=Ks;return Ks+=1,os===null&&(os=[]),tm(os,t,i)}function Fs(t,i){i=i.props.ref,t.ref=i!==void 0?i:null}function rr(t,i){throw i.$$typeof===x?Error(o(525)):(t=Object.prototype.toString.call(i),Error(o(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t)))}function am(t){function i(U,j){if(t){var V=U.deletions;V===null?(U.deletions=[j],U.flags|=16):V.push(j)}}function s(U,j){if(!t)return null;for(;j!==null;)i(U,j),j=j.sibling;return null}function l(U){for(var j=new Map;U!==null;)U.key!==null?j.set(U.key,U):j.set(U.index,U),U=U.sibling;return j}function u(U,j){return U=di(U,j),U.index=0,U.sibling=null,U}function p(U,j,V){return U.index=V,t?(V=U.alternate,V!==null?(V=V.index,V<j?(U.flags|=67108866,j):V):(U.flags|=67108866,j)):(U.flags|=1048576,j)}function v(U){return t&&U.alternate===null&&(U.flags|=67108866),U}function M(U,j,V,ae){return j===null||j.tag!==6?(j=pc(V,U.mode,ae),j.return=U,j):(j=u(j,V),j.return=U,j)}function L(U,j,V,ae){var xe=V.type;return xe===A?ie(U,j,V.props.children,ae,V.key):j!==null&&(j.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===D&&Sa(xe)===j.type)?(j=u(j,V.props),Fs(j,V),j.return=U,j):(j=Zo(V.type,V.key,V.props,null,U.mode,ae),Fs(j,V),j.return=U,j)}function K(U,j,V,ae){return j===null||j.tag!==4||j.stateNode.containerInfo!==V.containerInfo||j.stateNode.implementation!==V.implementation?(j=hc(V,U.mode,ae),j.return=U,j):(j=u(j,V.children||[]),j.return=U,j)}function ie(U,j,V,ae,xe){return j===null||j.tag!==7?(j=ya(V,U.mode,ae,xe),j.return=U,j):(j=u(j,V),j.return=U,j)}function oe(U,j,V){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=pc(""+j,U.mode,V),j.return=U,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case T:return V=Zo(j.type,j.key,j.props,null,U.mode,V),Fs(V,j),V.return=U,V;case S:return j=hc(j,U.mode,V),j.return=U,j;case D:return j=Sa(j),oe(U,j,V)}if(q(j)||F(j))return j=ya(j,U.mode,V,null),j.return=U,j;if(typeof j.then=="function")return oe(U,or(j),V);if(j.$$typeof===w)return oe(U,nr(U,j),V);rr(U,j)}return null}function J(U,j,V,ae){var xe=j!==null?j.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return xe!==null?null:M(U,j,""+V,ae);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case T:return V.key===xe?L(U,j,V,ae):null;case S:return V.key===xe?K(U,j,V,ae):null;case D:return V=Sa(V),J(U,j,V,ae)}if(q(V)||F(V))return xe!==null?null:ie(U,j,V,ae,null);if(typeof V.then=="function")return J(U,j,or(V),ae);if(V.$$typeof===w)return J(U,j,nr(U,V),ae);rr(U,V)}return null}function te(U,j,V,ae,xe){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return U=U.get(V)||null,M(j,U,""+ae,xe);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case T:return U=U.get(ae.key===null?V:ae.key)||null,L(j,U,ae,xe);case S:return U=U.get(ae.key===null?V:ae.key)||null,K(j,U,ae,xe);case D:return ae=Sa(ae),te(U,j,V,ae,xe)}if(q(ae)||F(ae))return U=U.get(V)||null,ie(j,U,ae,xe,null);if(typeof ae.then=="function")return te(U,j,V,or(ae),xe);if(ae.$$typeof===w)return te(U,j,V,nr(j,ae),xe);rr(j,ae)}return null}function pe(U,j,V,ae){for(var xe=null,Ve=null,ge=j,Oe=j=0,je=null;ge!==null&&Oe<V.length;Oe++){ge.index>Oe?(je=ge,ge=null):je=ge.sibling;var Ye=J(U,ge,V[Oe],ae);if(Ye===null){ge===null&&(ge=je);break}t&&ge&&Ye.alternate===null&&i(U,ge),j=p(Ye,j,Oe),Ve===null?xe=Ye:Ve.sibling=Ye,Ve=Ye,ge=je}if(Oe===V.length)return s(U,ge),Pe&&fi(U,Oe),xe;if(ge===null){for(;Oe<V.length;Oe++)ge=oe(U,V[Oe],ae),ge!==null&&(j=p(ge,j,Oe),Ve===null?xe=ge:Ve.sibling=ge,Ve=ge);return Pe&&fi(U,Oe),xe}for(ge=l(ge);Oe<V.length;Oe++)je=te(ge,U,Oe,V[Oe],ae),je!==null&&(t&&je.alternate!==null&&ge.delete(je.key===null?Oe:je.key),j=p(je,j,Oe),Ve===null?xe=je:Ve.sibling=je,Ve=je);return t&&ge.forEach(function(ta){return i(U,ta)}),Pe&&fi(U,Oe),xe}function Se(U,j,V,ae){if(V==null)throw Error(o(151));for(var xe=null,Ve=null,ge=j,Oe=j=0,je=null,Ye=V.next();ge!==null&&!Ye.done;Oe++,Ye=V.next()){ge.index>Oe?(je=ge,ge=null):je=ge.sibling;var ta=J(U,ge,Ye.value,ae);if(ta===null){ge===null&&(ge=je);break}t&&ge&&ta.alternate===null&&i(U,ge),j=p(ta,j,Oe),Ve===null?xe=ta:Ve.sibling=ta,Ve=ta,ge=je}if(Ye.done)return s(U,ge),Pe&&fi(U,Oe),xe;if(ge===null){for(;!Ye.done;Oe++,Ye=V.next())Ye=oe(U,Ye.value,ae),Ye!==null&&(j=p(Ye,j,Oe),Ve===null?xe=Ye:Ve.sibling=Ye,Ve=Ye);return Pe&&fi(U,Oe),xe}for(ge=l(ge);!Ye.done;Oe++,Ye=V.next())Ye=te(ge,U,Oe,Ye.value,ae),Ye!==null&&(t&&Ye.alternate!==null&&ge.delete(Ye.key===null?Oe:Ye.key),j=p(Ye,j,Oe),Ve===null?xe=Ye:Ve.sibling=Ye,Ve=Ye);return t&&ge.forEach(function(Ox){return i(U,Ox)}),Pe&&fi(U,Oe),xe}function it(U,j,V,ae){if(typeof V=="object"&&V!==null&&V.type===A&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case T:e:{for(var xe=V.key;j!==null;){if(j.key===xe){if(xe=V.type,xe===A){if(j.tag===7){s(U,j.sibling),ae=u(j,V.props.children),ae.return=U,U=ae;break e}}else if(j.elementType===xe||typeof xe=="object"&&xe!==null&&xe.$$typeof===D&&Sa(xe)===j.type){s(U,j.sibling),ae=u(j,V.props),Fs(ae,V),ae.return=U,U=ae;break e}s(U,j);break}else i(U,j);j=j.sibling}V.type===A?(ae=ya(V.props.children,U.mode,ae,V.key),ae.return=U,U=ae):(ae=Zo(V.type,V.key,V.props,null,U.mode,ae),Fs(ae,V),ae.return=U,U=ae)}return v(U);case S:e:{for(xe=V.key;j!==null;){if(j.key===xe)if(j.tag===4&&j.stateNode.containerInfo===V.containerInfo&&j.stateNode.implementation===V.implementation){s(U,j.sibling),ae=u(j,V.children||[]),ae.return=U,U=ae;break e}else{s(U,j);break}else i(U,j);j=j.sibling}ae=hc(V,U.mode,ae),ae.return=U,U=ae}return v(U);case D:return V=Sa(V),it(U,j,V,ae)}if(q(V))return pe(U,j,V,ae);if(F(V)){if(xe=F(V),typeof xe!="function")throw Error(o(150));return V=xe.call(V),Se(U,j,V,ae)}if(typeof V.then=="function")return it(U,j,or(V),ae);if(V.$$typeof===w)return it(U,j,nr(U,V),ae);rr(U,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,j!==null&&j.tag===6?(s(U,j.sibling),ae=u(j,V),ae.return=U,U=ae):(s(U,j),ae=pc(V,U.mode,ae),ae.return=U,U=ae),v(U)):s(U,j)}return function(U,j,V,ae){try{Ks=0;var xe=it(U,j,V,ae);return os=null,xe}catch(ge){if(ge===ss||ge===ar)throw ge;var Ve=vn(29,ge,null,U.mode);return Ve.lanes=ae,Ve.return=U,Ve}}}var Ta=am(!0),sm=am(!1),Di=!1;function Mc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Oc(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Pi(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Ui(t,i,s){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,(Ke&2)!==0){var u=l.pending;return u===null?i.next=i:(i.next=u.next,u.next=i),l.pending=i,i=Qo(t),$f(t,null,s),i}return Jo(t,l,i,s),Qo(t)}function Xs(t,i,s){if(i=i.updateQueue,i!==null&&(i=i.shared,(s&4194048)!==0)){var l=i.lanes;l&=t.pendingLanes,s|=l,i.lanes=s,tn(t,s)}}function Cc(t,i){var s=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,s===l)){var u=null,p=null;if(s=s.firstBaseUpdate,s!==null){do{var v={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};p===null?u=p=v:p=p.next=v,s=s.next}while(s!==null);p===null?u=p=i:p=p.next=i}else u=p=i;s={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:p,shared:l.shared,callbacks:l.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=i:t.next=i,s.lastBaseUpdate=i}var kc=!1;function Ws(){if(kc){var t=as;if(t!==null)throw t}}function Gs(t,i,s,l){kc=!1;var u=t.updateQueue;Di=!1;var p=u.firstBaseUpdate,v=u.lastBaseUpdate,M=u.shared.pending;if(M!==null){u.shared.pending=null;var L=M,K=L.next;L.next=null,v===null?p=K:v.next=K,v=L;var ie=t.alternate;ie!==null&&(ie=ie.updateQueue,M=ie.lastBaseUpdate,M!==v&&(M===null?ie.firstBaseUpdate=K:M.next=K,ie.lastBaseUpdate=L))}if(p!==null){var oe=u.baseState;v=0,ie=K=L=null,M=p;do{var J=M.lane&-536870913,te=J!==M.lane;if(te?(Be&J)===J:(l&J)===J){J!==0&&J===is&&(kc=!0),ie!==null&&(ie=ie.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var pe=t,Se=M;J=i;var it=s;switch(Se.tag){case 1:if(pe=Se.payload,typeof pe=="function"){oe=pe.call(it,oe,J);break e}oe=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=Se.payload,J=typeof pe=="function"?pe.call(it,oe,J):pe,J==null)break e;oe=b({},oe,J);break e;case 2:Di=!0}}J=M.callback,J!==null&&(t.flags|=64,te&&(t.flags|=8192),te=u.callbacks,te===null?u.callbacks=[J]:te.push(J))}else te={lane:J,tag:M.tag,payload:M.payload,callback:M.callback,next:null},ie===null?(K=ie=te,L=oe):ie=ie.next=te,v|=J;if(M=M.next,M===null){if(M=u.shared.pending,M===null)break;te=M,M=te.next,te.next=null,u.lastBaseUpdate=te,u.shared.pending=null}}while(!0);ie===null&&(L=oe),u.baseState=L,u.firstBaseUpdate=K,u.lastBaseUpdate=ie,p===null&&(u.shared.lanes=0),Yi|=v,t.lanes=v,t.memoizedState=oe}}function om(t,i){if(typeof t!="function")throw Error(o(191,t));t.call(i)}function rm(t,i){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)om(s[t],i)}var rs=R(null),lr=R(0);function lm(t,i){t=Ti,Q(lr,t),Q(rs,i),Ti=t|i.baseLanes}function Nc(){Q(lr,Ti),Q(rs,rs.current)}function Rc(){Ti=lr.current,W(rs),W(lr)}var Sn=R(null),Hn=null;function qi(t){var i=t.alternate;Q(Ot,Ot.current&1),Q(Sn,t),Hn===null&&(i===null||rs.current!==null||i.memoizedState!==null)&&(Hn=t)}function Ic(t){Q(Ot,Ot.current),Q(Sn,t),Hn===null&&(Hn=t)}function cm(t){t.tag===22?(Q(Ot,Ot.current),Q(Sn,t),Hn===null&&(Hn=t)):$i()}function $i(){Q(Ot,Ot.current),Q(Sn,Sn.current)}function An(t){W(Sn),Hn===t&&(Hn=null),W(Ot)}var Ot=R(0);function cr(t){for(var i=t;i!==null;){if(i.tag===13){var s=i.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Pu(s)||Uu(s)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var hi=0,Me=null,tt=null,Lt=null,ur=!1,ls=!1,Ea=!1,dr=0,Js=0,cs=null,bb=0;function Tt(){throw Error(o(321))}function Lc(t,i){if(i===null)return!1;for(var s=0;s<i.length&&s<t.length;s++)if(!xn(t[s],i[s]))return!1;return!0}function Hc(t,i,s,l,u,p){return hi=p,Me=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,B.H=t===null||t.memoizedState===null?Km:Gc,Ea=!1,p=s(l,u),Ea=!1,ls&&(p=dm(i,s,l,u)),um(t),p}function um(t){B.H=eo;var i=tt!==null&&tt.next!==null;if(hi=0,Lt=tt=Me=null,ur=!1,Js=0,cs=null,i)throw Error(o(300));t===null||Ht||(t=t.dependencies,t!==null&&tr(t)&&(Ht=!0))}function dm(t,i,s,l){Me=t;var u=0;do{if(ls&&(cs=null),Js=0,ls=!1,25<=u)throw Error(o(301));if(u+=1,Lt=tt=null,t.updateQueue!=null){var p=t.updateQueue;p.lastEffect=null,p.events=null,p.stores=null,p.memoCache!=null&&(p.memoCache.index=0)}B.H=Fm,p=i(s,l)}while(ls);return p}function xb(){var t=B.H,i=t.useState()[0];return i=typeof i.then=="function"?Qs(i):i,t=t.useState()[0],(tt!==null?tt.memoizedState:null)!==t&&(Me.flags|=1024),i}function Bc(){var t=dr!==0;return dr=0,t}function jc(t,i,s){i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~s}function Dc(t){if(ur){for(t=t.memoizedState;t!==null;){var i=t.queue;i!==null&&(i.pending=null),t=t.next}ur=!1}hi=0,Lt=tt=Me=null,ls=!1,Js=dr=0,cs=null}function sn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Lt===null?Me.memoizedState=Lt=t:Lt=Lt.next=t,Lt}function Ct(){if(tt===null){var t=Me.alternate;t=t!==null?t.memoizedState:null}else t=tt.next;var i=Lt===null?Me.memoizedState:Lt.next;if(i!==null)Lt=i,tt=t;else{if(t===null)throw Me.alternate===null?Error(o(467)):Error(o(310));tt=t,t={memoizedState:tt.memoizedState,baseState:tt.baseState,baseQueue:tt.baseQueue,queue:tt.queue,next:null},Lt===null?Me.memoizedState=Lt=t:Lt=Lt.next=t}return Lt}function fr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qs(t){var i=Js;return Js+=1,cs===null&&(cs=[]),t=tm(cs,t,i),i=Me,(Lt===null?i.memoizedState:Lt.next)===null&&(i=i.alternate,B.H=i===null||i.memoizedState===null?Km:Gc),t}function mr(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Qs(t);if(t.$$typeof===w)return Jt(t)}throw Error(o(438,String(t)))}function Pc(t){var i=null,s=Me.updateQueue;if(s!==null&&(i=s.memoCache),i==null){var l=Me.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(i={data:l.data.map(function(u){return u.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),s===null&&(s=fr(),Me.updateQueue=s),s.memoCache=i,s=i.data[i.index],s===void 0)for(s=i.data[i.index]=Array(t),l=0;l<t;l++)s[l]=P;return i.index++,s}function yi(t,i){return typeof i=="function"?i(t):i}function pr(t){var i=Ct();return Uc(i,tt,t)}function Uc(t,i,s){var l=t.queue;if(l===null)throw Error(o(311));l.lastRenderedReducer=s;var u=t.baseQueue,p=l.pending;if(p!==null){if(u!==null){var v=u.next;u.next=p.next,p.next=v}i.baseQueue=u=p,l.pending=null}if(p=t.baseState,u===null)t.memoizedState=p;else{i=u.next;var M=v=null,L=null,K=i,ie=!1;do{var oe=K.lane&-536870913;if(oe!==K.lane?(Be&oe)===oe:(hi&oe)===oe){var J=K.revertLane;if(J===0)L!==null&&(L=L.next={lane:0,revertLane:0,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),oe===is&&(ie=!0);else if((hi&J)===J){K=K.next,J===is&&(ie=!0);continue}else oe={lane:0,revertLane:K.revertLane,gesture:null,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},L===null?(M=L=oe,v=p):L=L.next=oe,Me.lanes|=J,Yi|=J;oe=K.action,Ea&&s(p,oe),p=K.hasEagerState?K.eagerState:s(p,oe)}else J={lane:oe,revertLane:K.revertLane,gesture:K.gesture,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},L===null?(M=L=J,v=p):L=L.next=J,Me.lanes|=oe,Yi|=oe;K=K.next}while(K!==null&&K!==i);if(L===null?v=p:L.next=M,!xn(p,t.memoizedState)&&(Ht=!0,ie&&(s=as,s!==null)))throw s;t.memoizedState=p,t.baseState=v,t.baseQueue=L,l.lastRenderedState=p}return u===null&&(l.lanes=0),[t.memoizedState,l.dispatch]}function qc(t){var i=Ct(),s=i.queue;if(s===null)throw Error(o(311));s.lastRenderedReducer=t;var l=s.dispatch,u=s.pending,p=i.memoizedState;if(u!==null){s.pending=null;var v=u=u.next;do p=t(p,v.action),v=v.next;while(v!==u);xn(p,i.memoizedState)||(Ht=!0),i.memoizedState=p,i.baseQueue===null&&(i.baseState=p),s.lastRenderedState=p}return[p,l]}function fm(t,i,s){var l=Me,u=Ct(),p=Pe;if(p){if(s===void 0)throw Error(o(407));s=s()}else s=i();var v=!xn((tt||u).memoizedState,s);if(v&&(u.memoizedState=s,Ht=!0),u=u.queue,Vc(hm.bind(null,l,u,t),[t]),u.getSnapshot!==i||v||Lt!==null&&Lt.memoizedState.tag&1){if(l.flags|=2048,us(9,{destroy:void 0},pm.bind(null,l,u,s,i),null),ot===null)throw Error(o(349));p||(hi&127)!==0||mm(l,i,s)}return s}function mm(t,i,s){t.flags|=16384,t={getSnapshot:i,value:s},i=Me.updateQueue,i===null?(i=fr(),Me.updateQueue=i,i.stores=[t]):(s=i.stores,s===null?i.stores=[t]:s.push(t))}function pm(t,i,s,l){i.value=s,i.getSnapshot=l,ym(i)&&gm(t)}function hm(t,i,s){return s(function(){ym(i)&&gm(t)})}function ym(t){var i=t.getSnapshot;t=t.value;try{var s=i();return!xn(t,s)}catch{return!0}}function gm(t){var i=ha(t,2);i!==null&&hn(i,t,2)}function $c(t){var i=sn();if(typeof t=="function"){var s=t;if(t=s(),Ea){et(!0);try{s()}finally{et(!1)}}}return i.memoizedState=i.baseState=t,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yi,lastRenderedState:t},i}function bm(t,i,s,l){return t.baseState=s,Uc(t,tt,typeof l=="function"?l:yi)}function vb(t,i,s,l,u){if(gr(t))throw Error(o(485));if(t=i.action,t!==null){var p={payload:u,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(v){p.listeners.push(v)}};B.T!==null?s(!0):p.isTransition=!1,l(p),s=i.pending,s===null?(p.next=i.pending=p,xm(i,p)):(p.next=s.next,i.pending=s.next=p)}}function xm(t,i){var s=i.action,l=i.payload,u=t.state;if(i.isTransition){var p=B.T,v={};B.T=v;try{var M=s(u,l),L=B.S;L!==null&&L(v,M),vm(t,i,M)}catch(K){zc(t,i,K)}finally{p!==null&&v.types!==null&&(p.types=v.types),B.T=p}}else try{p=s(u,l),vm(t,i,p)}catch(K){zc(t,i,K)}}function vm(t,i,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(l){Sm(t,i,l)},function(l){return zc(t,i,l)}):Sm(t,i,s)}function Sm(t,i,s){i.status="fulfilled",i.value=s,Am(i),t.state=s,i=t.pending,i!==null&&(s=i.next,s===i?t.pending=null:(s=s.next,i.next=s,xm(t,s)))}function zc(t,i,s){var l=t.pending;if(t.pending=null,l!==null){l=l.next;do i.status="rejected",i.reason=s,Am(i),i=i.next;while(i!==l)}t.action=null}function Am(t){t=t.listeners;for(var i=0;i<t.length;i++)(0,t[i])()}function Tm(t,i){return i}function Em(t,i){if(Pe){var s=ot.formState;if(s!==null){e:{var l=Me;if(Pe){if(mt){t:{for(var u=mt,p=Ln;u.nodeType!==8;){if(!p){u=null;break t}if(u=Bn(u.nextSibling),u===null){u=null;break t}}p=u.data,u=p==="F!"||p==="F"?u:null}if(u){mt=Bn(u.nextSibling),l=u.data==="F!";break e}}Bi(l)}l=!1}l&&(i=s[0])}}return s=sn(),s.memoizedState=s.baseState=i,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tm,lastRenderedState:i},s.queue=l,s=zm.bind(null,Me,l),l.dispatch=s,l=$c(!1),p=Wc.bind(null,Me,!1,l.queue),l=sn(),u={state:i,dispatch:null,action:t,pending:null},l.queue=u,s=vb.bind(null,Me,u,p,s),u.dispatch=s,l.memoizedState=t,[i,s,!1]}function _m(t){var i=Ct();return wm(i,tt,t)}function wm(t,i,s){if(i=Uc(t,i,Tm)[0],t=pr(yi)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var l=Qs(i)}catch(v){throw v===ss?ar:v}else l=i;i=Ct();var u=i.queue,p=u.dispatch;return s!==i.memoizedState&&(Me.flags|=2048,us(9,{destroy:void 0},Sb.bind(null,u,s),null)),[l,p,t]}function Sb(t,i){t.action=i}function Mm(t){var i=Ct(),s=tt;if(s!==null)return wm(i,s,t);Ct(),i=i.memoizedState,s=Ct();var l=s.queue.dispatch;return s.memoizedState=t,[i,l,!1]}function us(t,i,s,l){return t={tag:t,create:s,deps:l,inst:i,next:null},i=Me.updateQueue,i===null&&(i=fr(),Me.updateQueue=i),s=i.lastEffect,s===null?i.lastEffect=t.next=t:(l=s.next,s.next=t,t.next=l,i.lastEffect=t),t}function Om(){return Ct().memoizedState}function hr(t,i,s,l){var u=sn();Me.flags|=t,u.memoizedState=us(1|i,{destroy:void 0},s,l===void 0?null:l)}function yr(t,i,s,l){var u=Ct();l=l===void 0?null:l;var p=u.memoizedState.inst;tt!==null&&l!==null&&Lc(l,tt.memoizedState.deps)?u.memoizedState=us(i,p,s,l):(Me.flags|=t,u.memoizedState=us(1|i,p,s,l))}function Cm(t,i){hr(8390656,8,t,i)}function Vc(t,i){yr(2048,8,t,i)}function Ab(t){Me.flags|=4;var i=Me.updateQueue;if(i===null)i=fr(),Me.updateQueue=i,i.events=[t];else{var s=i.events;s===null?i.events=[t]:s.push(t)}}function km(t){var i=Ct().memoizedState;return Ab({ref:i,nextImpl:t}),function(){if((Ke&2)!==0)throw Error(o(440));return i.impl.apply(void 0,arguments)}}function Nm(t,i){return yr(4,2,t,i)}function Rm(t,i){return yr(4,4,t,i)}function Im(t,i){if(typeof i=="function"){t=t();var s=i(t);return function(){typeof s=="function"?s():i(null)}}if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function Lm(t,i,s){s=s!=null?s.concat([t]):null,yr(4,4,Im.bind(null,i,t),s)}function Yc(){}function Hm(t,i){var s=Ct();i=i===void 0?null:i;var l=s.memoizedState;return i!==null&&Lc(i,l[1])?l[0]:(s.memoizedState=[t,i],t)}function Bm(t,i){var s=Ct();i=i===void 0?null:i;var l=s.memoizedState;if(i!==null&&Lc(i,l[1]))return l[0];if(l=t(),Ea){et(!0);try{t()}finally{et(!1)}}return s.memoizedState=[l,i],l}function Kc(t,i,s){return s===void 0||(hi&1073741824)!==0&&(Be&261930)===0?t.memoizedState=i:(t.memoizedState=s,t=jp(),Me.lanes|=t,Yi|=t,s)}function jm(t,i,s,l){return xn(s,i)?s:rs.current!==null?(t=Kc(t,s,l),xn(t,i)||(Ht=!0),t):(hi&42)===0||(hi&1073741824)!==0&&(Be&261930)===0?(Ht=!0,t.memoizedState=s):(t=jp(),Me.lanes|=t,Yi|=t,i)}function Dm(t,i,s,l,u){var p=$.p;$.p=p!==0&&8>p?p:8;var v=B.T,M={};B.T=M,Wc(t,!1,i,s);try{var L=u(),K=B.S;if(K!==null&&K(M,L),L!==null&&typeof L=="object"&&typeof L.then=="function"){var ie=gb(L,l);Zs(t,i,ie,_n(t))}else Zs(t,i,l,_n(t))}catch(oe){Zs(t,i,{then:function(){},status:"rejected",reason:oe},_n())}finally{$.p=p,v!==null&&M.types!==null&&(v.types=M.types),B.T=v}}function Tb(){}function Fc(t,i,s,l){if(t.tag!==5)throw Error(o(476));var u=Pm(t).queue;Dm(t,u,i,X,s===null?Tb:function(){return Um(t),s(l)})}function Pm(t){var i=t.memoizedState;if(i!==null)return i;i={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yi,lastRenderedState:X},next:null};var s={};return i.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:yi,lastRenderedState:s},next:null},t.memoizedState=i,t=t.alternate,t!==null&&(t.memoizedState=i),i}function Um(t){var i=Pm(t);i.next===null&&(i=t.alternate.memoizedState),Zs(t,i.next.queue,{},_n())}function Xc(){return Jt(go)}function qm(){return Ct().memoizedState}function $m(){return Ct().memoizedState}function Eb(t){for(var i=t.return;i!==null;){switch(i.tag){case 24:case 3:var s=_n();t=Pi(s);var l=Ui(i,t,s);l!==null&&(hn(l,i,s),Xs(l,i,s)),i={cache:Tc()},t.payload=i;return}i=i.return}}function _b(t,i,s){var l=_n();s={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},gr(t)?Vm(i,s):(s=fc(t,i,s,l),s!==null&&(hn(s,t,l),Ym(s,i,l)))}function zm(t,i,s){var l=_n();Zs(t,i,s,l)}function Zs(t,i,s,l){var u={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(gr(t))Vm(i,u);else{var p=t.alternate;if(t.lanes===0&&(p===null||p.lanes===0)&&(p=i.lastRenderedReducer,p!==null))try{var v=i.lastRenderedState,M=p(v,s);if(u.hasEagerState=!0,u.eagerState=M,xn(M,v))return Jo(t,i,u,0),ot===null&&Go(),!1}catch{}if(s=fc(t,i,u,l),s!==null)return hn(s,t,l),Ym(s,i,l),!0}return!1}function Wc(t,i,s,l){if(l={lane:2,revertLane:Mu(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},gr(t)){if(i)throw Error(o(479))}else i=fc(t,s,l,2),i!==null&&hn(i,t,2)}function gr(t){var i=t.alternate;return t===Me||i!==null&&i===Me}function Vm(t,i){ls=ur=!0;var s=t.pending;s===null?i.next=i:(i.next=s.next,s.next=i),t.pending=i}function Ym(t,i,s){if((s&4194048)!==0){var l=i.lanes;l&=t.pendingLanes,s|=l,i.lanes=s,tn(t,s)}}var eo={readContext:Jt,use:mr,useCallback:Tt,useContext:Tt,useEffect:Tt,useImperativeHandle:Tt,useLayoutEffect:Tt,useInsertionEffect:Tt,useMemo:Tt,useReducer:Tt,useRef:Tt,useState:Tt,useDebugValue:Tt,useDeferredValue:Tt,useTransition:Tt,useSyncExternalStore:Tt,useId:Tt,useHostTransitionStatus:Tt,useFormState:Tt,useActionState:Tt,useOptimistic:Tt,useMemoCache:Tt,useCacheRefresh:Tt};eo.useEffectEvent=Tt;var Km={readContext:Jt,use:mr,useCallback:function(t,i){return sn().memoizedState=[t,i===void 0?null:i],t},useContext:Jt,useEffect:Cm,useImperativeHandle:function(t,i,s){s=s!=null?s.concat([t]):null,hr(4194308,4,Im.bind(null,i,t),s)},useLayoutEffect:function(t,i){return hr(4194308,4,t,i)},useInsertionEffect:function(t,i){hr(4,2,t,i)},useMemo:function(t,i){var s=sn();i=i===void 0?null:i;var l=t();if(Ea){et(!0);try{t()}finally{et(!1)}}return s.memoizedState=[l,i],l},useReducer:function(t,i,s){var l=sn();if(s!==void 0){var u=s(i);if(Ea){et(!0);try{s(i)}finally{et(!1)}}}else u=i;return l.memoizedState=l.baseState=u,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:u},l.queue=t,t=t.dispatch=_b.bind(null,Me,t),[l.memoizedState,t]},useRef:function(t){var i=sn();return t={current:t},i.memoizedState=t},useState:function(t){t=$c(t);var i=t.queue,s=zm.bind(null,Me,i);return i.dispatch=s,[t.memoizedState,s]},useDebugValue:Yc,useDeferredValue:function(t,i){var s=sn();return Kc(s,t,i)},useTransition:function(){var t=$c(!1);return t=Dm.bind(null,Me,t.queue,!0,!1),sn().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,i,s){var l=Me,u=sn();if(Pe){if(s===void 0)throw Error(o(407));s=s()}else{if(s=i(),ot===null)throw Error(o(349));(Be&127)!==0||mm(l,i,s)}u.memoizedState=s;var p={value:s,getSnapshot:i};return u.queue=p,Cm(hm.bind(null,l,p,t),[t]),l.flags|=2048,us(9,{destroy:void 0},pm.bind(null,l,p,s,i),null),s},useId:function(){var t=sn(),i=ot.identifierPrefix;if(Pe){var s=ii,l=ni;s=(l&~(1<<32-st(l)-1)).toString(32)+s,i="_"+i+"R_"+s,s=dr++,0<s&&(i+="H"+s.toString(32)),i+="_"}else s=bb++,i="_"+i+"r_"+s.toString(32)+"_";return t.memoizedState=i},useHostTransitionStatus:Xc,useFormState:Em,useActionState:Em,useOptimistic:function(t){var i=sn();i.memoizedState=i.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=s,i=Wc.bind(null,Me,!0,s),s.dispatch=i,[t,i]},useMemoCache:Pc,useCacheRefresh:function(){return sn().memoizedState=Eb.bind(null,Me)},useEffectEvent:function(t){var i=sn(),s={impl:t};return i.memoizedState=s,function(){if((Ke&2)!==0)throw Error(o(440));return s.impl.apply(void 0,arguments)}}},Gc={readContext:Jt,use:mr,useCallback:Hm,useContext:Jt,useEffect:Vc,useImperativeHandle:Lm,useInsertionEffect:Nm,useLayoutEffect:Rm,useMemo:Bm,useReducer:pr,useRef:Om,useState:function(){return pr(yi)},useDebugValue:Yc,useDeferredValue:function(t,i){var s=Ct();return jm(s,tt.memoizedState,t,i)},useTransition:function(){var t=pr(yi)[0],i=Ct().memoizedState;return[typeof t=="boolean"?t:Qs(t),i]},useSyncExternalStore:fm,useId:qm,useHostTransitionStatus:Xc,useFormState:_m,useActionState:_m,useOptimistic:function(t,i){var s=Ct();return bm(s,tt,t,i)},useMemoCache:Pc,useCacheRefresh:$m};Gc.useEffectEvent=km;var Fm={readContext:Jt,use:mr,useCallback:Hm,useContext:Jt,useEffect:Vc,useImperativeHandle:Lm,useInsertionEffect:Nm,useLayoutEffect:Rm,useMemo:Bm,useReducer:qc,useRef:Om,useState:function(){return qc(yi)},useDebugValue:Yc,useDeferredValue:function(t,i){var s=Ct();return tt===null?Kc(s,t,i):jm(s,tt.memoizedState,t,i)},useTransition:function(){var t=qc(yi)[0],i=Ct().memoizedState;return[typeof t=="boolean"?t:Qs(t),i]},useSyncExternalStore:fm,useId:qm,useHostTransitionStatus:Xc,useFormState:Mm,useActionState:Mm,useOptimistic:function(t,i){var s=Ct();return tt!==null?bm(s,tt,t,i):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Pc,useCacheRefresh:$m};Fm.useEffectEvent=km;function Jc(t,i,s,l){i=t.memoizedState,s=s(l,i),s=s==null?i:b({},i,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Qc={enqueueSetState:function(t,i,s){t=t._reactInternals;var l=_n(),u=Pi(l);u.payload=i,s!=null&&(u.callback=s),i=Ui(t,u,l),i!==null&&(hn(i,t,l),Xs(i,t,l))},enqueueReplaceState:function(t,i,s){t=t._reactInternals;var l=_n(),u=Pi(l);u.tag=1,u.payload=i,s!=null&&(u.callback=s),i=Ui(t,u,l),i!==null&&(hn(i,t,l),Xs(i,t,l))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var s=_n(),l=Pi(s);l.tag=2,i!=null&&(l.callback=i),i=Ui(t,l,s),i!==null&&(hn(i,t,s),Xs(i,t,s))}};function Xm(t,i,s,l,u,p,v){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,p,v):i.prototype&&i.prototype.isPureReactComponent?!Us(s,l)||!Us(u,p):!0}function Wm(t,i,s,l){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(s,l),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(s,l),i.state!==t&&Qc.enqueueReplaceState(i,i.state,null)}function _a(t,i){var s=i;if("ref"in i){s={};for(var l in i)l!=="ref"&&(s[l]=i[l])}if(t=t.defaultProps){s===i&&(s=b({},s));for(var u in t)s[u]===void 0&&(s[u]=t[u])}return s}function Gm(t){Wo(t)}function Jm(t){console.error(t)}function Qm(t){Wo(t)}function br(t,i){try{var s=t.onUncaughtError;s(i.value,{componentStack:i.stack})}catch(l){setTimeout(function(){throw l})}}function Zm(t,i,s){try{var l=t.onCaughtError;l(s.value,{componentStack:s.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function Zc(t,i,s){return s=Pi(s),s.tag=3,s.payload={element:null},s.callback=function(){br(t,i)},s}function ep(t){return t=Pi(t),t.tag=3,t}function tp(t,i,s,l){var u=s.type.getDerivedStateFromError;if(typeof u=="function"){var p=l.value;t.payload=function(){return u(p)},t.callback=function(){Zm(i,s,l)}}var v=s.stateNode;v!==null&&typeof v.componentDidCatch=="function"&&(t.callback=function(){Zm(i,s,l),typeof u!="function"&&(Ki===null?Ki=new Set([this]):Ki.add(this));var M=l.stack;this.componentDidCatch(l.value,{componentStack:M!==null?M:""})})}function wb(t,i,s,l,u){if(s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(i=s.alternate,i!==null&&ns(i,s,u,!0),s=Sn.current,s!==null){switch(s.tag){case 31:case 13:return Hn===null?kr():s.alternate===null&&Et===0&&(Et=3),s.flags&=-257,s.flags|=65536,s.lanes=u,l===sr?s.flags|=16384:(i=s.updateQueue,i===null?s.updateQueue=new Set([l]):i.add(l),Eu(t,l,u)),!1;case 22:return s.flags|=65536,l===sr?s.flags|=16384:(i=s.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([l])},s.updateQueue=i):(s=i.retryQueue,s===null?i.retryQueue=new Set([l]):s.add(l)),Eu(t,l,u)),!1}throw Error(o(435,s.tag))}return Eu(t,l,u),kr(),!1}if(Pe)return i=Sn.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=u,l!==bc&&(t=Error(o(422),{cause:l}),zs(Nn(t,s)))):(l!==bc&&(i=Error(o(423),{cause:l}),zs(Nn(i,s))),t=t.current.alternate,t.flags|=65536,u&=-u,t.lanes|=u,l=Nn(l,s),u=Zc(t.stateNode,l,u),Cc(t,u),Et!==4&&(Et=2)),!1;var p=Error(o(520),{cause:l});if(p=Nn(p,s),lo===null?lo=[p]:lo.push(p),Et!==4&&(Et=2),i===null)return!0;l=Nn(l,s),s=i;do{switch(s.tag){case 3:return s.flags|=65536,t=u&-u,s.lanes|=t,t=Zc(s.stateNode,l,t),Cc(s,t),!1;case 1:if(i=s.type,p=s.stateNode,(s.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||p!==null&&typeof p.componentDidCatch=="function"&&(Ki===null||!Ki.has(p))))return s.flags|=65536,u&=-u,s.lanes|=u,u=ep(u),tp(u,t,s,l),Cc(s,u),!1}s=s.return}while(s!==null);return!1}var eu=Error(o(461)),Ht=!1;function Qt(t,i,s,l){i.child=t===null?sm(i,null,s,l):Ta(i,t.child,s,l)}function np(t,i,s,l,u){s=s.render;var p=i.ref;if("ref"in l){var v={};for(var M in l)M!=="ref"&&(v[M]=l[M])}else v=l;return xa(i),l=Hc(t,i,s,v,p,u),M=Bc(),t!==null&&!Ht?(jc(t,i,u),gi(t,i,u)):(Pe&&M&&yc(i),i.flags|=1,Qt(t,i,l,u),i.child)}function ip(t,i,s,l,u){if(t===null){var p=s.type;return typeof p=="function"&&!mc(p)&&p.defaultProps===void 0&&s.compare===null?(i.tag=15,i.type=p,ap(t,i,p,l,u)):(t=Zo(s.type,null,l,i,i.mode,u),t.ref=i.ref,t.return=i,i.child=t)}if(p=t.child,!lu(t,u)){var v=p.memoizedProps;if(s=s.compare,s=s!==null?s:Us,s(v,l)&&t.ref===i.ref)return gi(t,i,u)}return i.flags|=1,t=di(p,l),t.ref=i.ref,t.return=i,i.child=t}function ap(t,i,s,l,u){if(t!==null){var p=t.memoizedProps;if(Us(p,l)&&t.ref===i.ref)if(Ht=!1,i.pendingProps=l=p,lu(t,u))(t.flags&131072)!==0&&(Ht=!0);else return i.lanes=t.lanes,gi(t,i,u)}return tu(t,i,s,l,u)}function sp(t,i,s,l){var u=l.children,p=t!==null?t.memoizedState:null;if(t===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((i.flags&128)!==0){if(p=p!==null?p.baseLanes|s:s,t!==null){for(l=i.child=t.child,u=0;l!==null;)u=u|l.lanes|l.childLanes,l=l.sibling;l=u&~p}else l=0,i.child=null;return op(t,i,p,s,l)}if((s&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},t!==null&&ir(i,p!==null?p.cachePool:null),p!==null?lm(i,p):Nc(),cm(i);else return l=i.lanes=536870912,op(t,i,p!==null?p.baseLanes|s:s,s,l)}else p!==null?(ir(i,p.cachePool),lm(i,p),$i(),i.memoizedState=null):(t!==null&&ir(i,null),Nc(),$i());return Qt(t,i,u,s),i.child}function to(t,i){return t!==null&&t.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function op(t,i,s,l,u){var p=_c();return p=p===null?null:{parent:It._currentValue,pool:p},i.memoizedState={baseLanes:s,cachePool:p},t!==null&&ir(i,null),Nc(),cm(i),t!==null&&ns(t,i,l,!0),i.childLanes=u,null}function xr(t,i){return i=Sr({mode:i.mode,children:i.children},t.mode),i.ref=t.ref,t.child=i,i.return=t,i}function rp(t,i,s){return Ta(i,t.child,null,s),t=xr(i,i.pendingProps),t.flags|=2,An(i),i.memoizedState=null,t}function Mb(t,i,s){var l=i.pendingProps,u=(i.flags&128)!==0;if(i.flags&=-129,t===null){if(Pe){if(l.mode==="hidden")return t=xr(i,l),i.lanes=536870912,to(null,t);if(Ic(i),(t=mt)?(t=xh(t,Ln),t=t!==null&&t.data==="&"?t:null,t!==null&&(i.memoizedState={dehydrated:t,treeContext:Li!==null?{id:ni,overflow:ii}:null,retryLane:536870912,hydrationErrors:null},s=Vf(t),s.return=i,i.child=s,Gt=i,mt=null)):t=null,t===null)throw Bi(i);return i.lanes=536870912,null}return xr(i,l)}var p=t.memoizedState;if(p!==null){var v=p.dehydrated;if(Ic(i),u)if(i.flags&256)i.flags&=-257,i=rp(t,i,s);else if(i.memoizedState!==null)i.child=t.child,i.flags|=128,i=null;else throw Error(o(558));else if(Ht||ns(t,i,s,!1),u=(s&t.childLanes)!==0,Ht||u){if(l=ot,l!==null&&(v=ti(l,s),v!==0&&v!==p.retryLane))throw p.retryLane=v,ha(t,v),hn(l,t,v),eu;kr(),i=rp(t,i,s)}else t=p.treeContext,mt=Bn(v.nextSibling),Gt=i,Pe=!0,Hi=null,Ln=!1,t!==null&&Ff(i,t),i=xr(i,l),i.flags|=4096;return i}return t=di(t.child,{mode:l.mode,children:l.children}),t.ref=i.ref,i.child=t,t.return=i,t}function vr(t,i){var s=i.ref;if(s===null)t!==null&&t.ref!==null&&(i.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(o(284));(t===null||t.ref!==s)&&(i.flags|=4194816)}}function tu(t,i,s,l,u){return xa(i),s=Hc(t,i,s,l,void 0,u),l=Bc(),t!==null&&!Ht?(jc(t,i,u),gi(t,i,u)):(Pe&&l&&yc(i),i.flags|=1,Qt(t,i,s,u),i.child)}function lp(t,i,s,l,u,p){return xa(i),i.updateQueue=null,s=dm(i,l,s,u),um(t),l=Bc(),t!==null&&!Ht?(jc(t,i,p),gi(t,i,p)):(Pe&&l&&yc(i),i.flags|=1,Qt(t,i,s,p),i.child)}function cp(t,i,s,l,u){if(xa(i),i.stateNode===null){var p=Qa,v=s.contextType;typeof v=="object"&&v!==null&&(p=Jt(v)),p=new s(l,p),i.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Qc,i.stateNode=p,p._reactInternals=i,p=i.stateNode,p.props=l,p.state=i.memoizedState,p.refs={},Mc(i),v=s.contextType,p.context=typeof v=="object"&&v!==null?Jt(v):Qa,p.state=i.memoizedState,v=s.getDerivedStateFromProps,typeof v=="function"&&(Jc(i,s,v,l),p.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(v=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),v!==p.state&&Qc.enqueueReplaceState(p,p.state,null),Gs(i,l,p,u),Ws(),p.state=i.memoizedState),typeof p.componentDidMount=="function"&&(i.flags|=4194308),l=!0}else if(t===null){p=i.stateNode;var M=i.memoizedProps,L=_a(s,M);p.props=L;var K=p.context,ie=s.contextType;v=Qa,typeof ie=="object"&&ie!==null&&(v=Jt(ie));var oe=s.getDerivedStateFromProps;ie=typeof oe=="function"||typeof p.getSnapshotBeforeUpdate=="function",M=i.pendingProps!==M,ie||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(M||K!==v)&&Wm(i,p,l,v),Di=!1;var J=i.memoizedState;p.state=J,Gs(i,l,p,u),Ws(),K=i.memoizedState,M||J!==K||Di?(typeof oe=="function"&&(Jc(i,s,oe,l),K=i.memoizedState),(L=Di||Xm(i,s,L,l,J,K,v))?(ie||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount()),typeof p.componentDidMount=="function"&&(i.flags|=4194308)):(typeof p.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=l,i.memoizedState=K),p.props=l,p.state=K,p.context=v,l=L):(typeof p.componentDidMount=="function"&&(i.flags|=4194308),l=!1)}else{p=i.stateNode,Oc(t,i),v=i.memoizedProps,ie=_a(s,v),p.props=ie,oe=i.pendingProps,J=p.context,K=s.contextType,L=Qa,typeof K=="object"&&K!==null&&(L=Jt(K)),M=s.getDerivedStateFromProps,(K=typeof M=="function"||typeof p.getSnapshotBeforeUpdate=="function")||typeof p.UNSAFE_componentWillReceiveProps!="function"&&typeof p.componentWillReceiveProps!="function"||(v!==oe||J!==L)&&Wm(i,p,l,L),Di=!1,J=i.memoizedState,p.state=J,Gs(i,l,p,u),Ws();var te=i.memoizedState;v!==oe||J!==te||Di||t!==null&&t.dependencies!==null&&tr(t.dependencies)?(typeof M=="function"&&(Jc(i,s,M,l),te=i.memoizedState),(ie=Di||Xm(i,s,ie,l,J,te,L)||t!==null&&t.dependencies!==null&&tr(t.dependencies))?(K||typeof p.UNSAFE_componentWillUpdate!="function"&&typeof p.componentWillUpdate!="function"||(typeof p.componentWillUpdate=="function"&&p.componentWillUpdate(l,te,L),typeof p.UNSAFE_componentWillUpdate=="function"&&p.UNSAFE_componentWillUpdate(l,te,L)),typeof p.componentDidUpdate=="function"&&(i.flags|=4),typeof p.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof p.componentDidUpdate!="function"||v===t.memoizedProps&&J===t.memoizedState||(i.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||v===t.memoizedProps&&J===t.memoizedState||(i.flags|=1024),i.memoizedProps=l,i.memoizedState=te),p.props=l,p.state=te,p.context=L,l=ie):(typeof p.componentDidUpdate!="function"||v===t.memoizedProps&&J===t.memoizedState||(i.flags|=4),typeof p.getSnapshotBeforeUpdate!="function"||v===t.memoizedProps&&J===t.memoizedState||(i.flags|=1024),l=!1)}return p=l,vr(t,i),l=(i.flags&128)!==0,p||l?(p=i.stateNode,s=l&&typeof s.getDerivedStateFromError!="function"?null:p.render(),i.flags|=1,t!==null&&l?(i.child=Ta(i,t.child,null,u),i.child=Ta(i,null,s,u)):Qt(t,i,s,u),i.memoizedState=p.state,t=i.child):t=gi(t,i,u),t}function up(t,i,s,l){return ga(),i.flags|=256,Qt(t,i,s,l),i.child}var nu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function iu(t){return{baseLanes:t,cachePool:Zf()}}function au(t,i,s){return t=t!==null?t.childLanes&~s:0,i&&(t|=En),t}function dp(t,i,s){var l=i.pendingProps,u=!1,p=(i.flags&128)!==0,v;if((v=p)||(v=t!==null&&t.memoizedState===null?!1:(Ot.current&2)!==0),v&&(u=!0,i.flags&=-129),v=(i.flags&32)!==0,i.flags&=-33,t===null){if(Pe){if(u?qi(i):$i(),(t=mt)?(t=xh(t,Ln),t=t!==null&&t.data!=="&"?t:null,t!==null&&(i.memoizedState={dehydrated:t,treeContext:Li!==null?{id:ni,overflow:ii}:null,retryLane:536870912,hydrationErrors:null},s=Vf(t),s.return=i,i.child=s,Gt=i,mt=null)):t=null,t===null)throw Bi(i);return Uu(t)?i.lanes=32:i.lanes=536870912,null}var M=l.children;return l=l.fallback,u?($i(),u=i.mode,M=Sr({mode:"hidden",children:M},u),l=ya(l,u,s,null),M.return=i,l.return=i,M.sibling=l,i.child=M,l=i.child,l.memoizedState=iu(s),l.childLanes=au(t,v,s),i.memoizedState=nu,to(null,l)):(qi(i),su(i,M))}var L=t.memoizedState;if(L!==null&&(M=L.dehydrated,M!==null)){if(p)i.flags&256?(qi(i),i.flags&=-257,i=ou(t,i,s)):i.memoizedState!==null?($i(),i.child=t.child,i.flags|=128,i=null):($i(),M=l.fallback,u=i.mode,l=Sr({mode:"visible",children:l.children},u),M=ya(M,u,s,null),M.flags|=2,l.return=i,M.return=i,l.sibling=M,i.child=l,Ta(i,t.child,null,s),l=i.child,l.memoizedState=iu(s),l.childLanes=au(t,v,s),i.memoizedState=nu,i=to(null,l));else if(qi(i),Uu(M)){if(v=M.nextSibling&&M.nextSibling.dataset,v)var K=v.dgst;v=K,l=Error(o(419)),l.stack="",l.digest=v,zs({value:l,source:null,stack:null}),i=ou(t,i,s)}else if(Ht||ns(t,i,s,!1),v=(s&t.childLanes)!==0,Ht||v){if(v=ot,v!==null&&(l=ti(v,s),l!==0&&l!==L.retryLane))throw L.retryLane=l,ha(t,l),hn(v,t,l),eu;Pu(M)||kr(),i=ou(t,i,s)}else Pu(M)?(i.flags|=192,i.child=t.child,i=null):(t=L.treeContext,mt=Bn(M.nextSibling),Gt=i,Pe=!0,Hi=null,Ln=!1,t!==null&&Ff(i,t),i=su(i,l.children),i.flags|=4096);return i}return u?($i(),M=l.fallback,u=i.mode,L=t.child,K=L.sibling,l=di(L,{mode:"hidden",children:l.children}),l.subtreeFlags=L.subtreeFlags&65011712,K!==null?M=di(K,M):(M=ya(M,u,s,null),M.flags|=2),M.return=i,l.return=i,l.sibling=M,i.child=l,to(null,l),l=i.child,M=t.child.memoizedState,M===null?M=iu(s):(u=M.cachePool,u!==null?(L=It._currentValue,u=u.parent!==L?{parent:L,pool:L}:u):u=Zf(),M={baseLanes:M.baseLanes|s,cachePool:u}),l.memoizedState=M,l.childLanes=au(t,v,s),i.memoizedState=nu,to(t.child,l)):(qi(i),s=t.child,t=s.sibling,s=di(s,{mode:"visible",children:l.children}),s.return=i,s.sibling=null,t!==null&&(v=i.deletions,v===null?(i.deletions=[t],i.flags|=16):v.push(t)),i.child=s,i.memoizedState=null,s)}function su(t,i){return i=Sr({mode:"visible",children:i},t.mode),i.return=t,t.child=i}function Sr(t,i){return t=vn(22,t,null,i),t.lanes=0,t}function ou(t,i,s){return Ta(i,t.child,null,s),t=su(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function fp(t,i,s){t.lanes|=i;var l=t.alternate;l!==null&&(l.lanes|=i),Sc(t.return,i,s)}function ru(t,i,s,l,u,p){var v=t.memoizedState;v===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:l,tail:s,tailMode:u,treeForkCount:p}:(v.isBackwards=i,v.rendering=null,v.renderingStartTime=0,v.last=l,v.tail=s,v.tailMode=u,v.treeForkCount=p)}function mp(t,i,s){var l=i.pendingProps,u=l.revealOrder,p=l.tail;l=l.children;var v=Ot.current,M=(v&2)!==0;if(M?(v=v&1|2,i.flags|=128):v&=1,Q(Ot,v),Qt(t,i,l,s),l=Pe?$s:0,!M&&t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&fp(t,s,i);else if(t.tag===19)fp(t,s,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(u){case"forwards":for(s=i.child,u=null;s!==null;)t=s.alternate,t!==null&&cr(t)===null&&(u=s),s=s.sibling;s=u,s===null?(u=i.child,i.child=null):(u=s.sibling,s.sibling=null),ru(i,!1,u,s,p,l);break;case"backwards":case"unstable_legacy-backwards":for(s=null,u=i.child,i.child=null;u!==null;){if(t=u.alternate,t!==null&&cr(t)===null){i.child=u;break}t=u.sibling,u.sibling=s,s=u,u=t}ru(i,!0,s,null,p,l);break;case"together":ru(i,!1,null,null,void 0,l);break;default:i.memoizedState=null}return i.child}function gi(t,i,s){if(t!==null&&(i.dependencies=t.dependencies),Yi|=i.lanes,(s&i.childLanes)===0)if(t!==null){if(ns(t,i,s,!1),(s&i.childLanes)===0)return null}else return null;if(t!==null&&i.child!==t.child)throw Error(o(153));if(i.child!==null){for(t=i.child,s=di(t,t.pendingProps),i.child=s,s.return=i;t.sibling!==null;)t=t.sibling,s=s.sibling=di(t,t.pendingProps),s.return=i;s.sibling=null}return i.child}function lu(t,i){return(t.lanes&i)!==0?!0:(t=t.dependencies,!!(t!==null&&tr(t)))}function Ob(t,i,s){switch(i.tag){case 3:Ce(i,i.stateNode.containerInfo),ji(i,It,t.memoizedState.cache),ga();break;case 27:case 5:_e(i);break;case 4:Ce(i,i.stateNode.containerInfo);break;case 10:ji(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,Ic(i),null;break;case 13:var l=i.memoizedState;if(l!==null)return l.dehydrated!==null?(qi(i),i.flags|=128,null):(s&i.child.childLanes)!==0?dp(t,i,s):(qi(i),t=gi(t,i,s),t!==null?t.sibling:null);qi(i);break;case 19:var u=(t.flags&128)!==0;if(l=(s&i.childLanes)!==0,l||(ns(t,i,s,!1),l=(s&i.childLanes)!==0),u){if(l)return mp(t,i,s);i.flags|=128}if(u=i.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),Q(Ot,Ot.current),l)break;return null;case 22:return i.lanes=0,sp(t,i,s,i.pendingProps);case 24:ji(i,It,t.memoizedState.cache)}return gi(t,i,s)}function pp(t,i,s){if(t!==null)if(t.memoizedProps!==i.pendingProps)Ht=!0;else{if(!lu(t,s)&&(i.flags&128)===0)return Ht=!1,Ob(t,i,s);Ht=(t.flags&131072)!==0}else Ht=!1,Pe&&(i.flags&1048576)!==0&&Kf(i,$s,i.index);switch(i.lanes=0,i.tag){case 16:e:{var l=i.pendingProps;if(t=Sa(i.elementType),i.type=t,typeof t=="function")mc(t)?(l=_a(t,l),i.tag=1,i=cp(null,i,t,l,s)):(i.tag=0,i=tu(null,i,t,l,s));else{if(t!=null){var u=t.$$typeof;if(u===C){i.tag=11,i=np(null,i,t,l,s);break e}else if(u===H){i.tag=14,i=ip(null,i,t,l,s);break e}}throw i=z(t)||t,Error(o(306,i,""))}}return i;case 0:return tu(t,i,i.type,i.pendingProps,s);case 1:return l=i.type,u=_a(l,i.pendingProps),cp(t,i,l,u,s);case 3:e:{if(Ce(i,i.stateNode.containerInfo),t===null)throw Error(o(387));l=i.pendingProps;var p=i.memoizedState;u=p.element,Oc(t,i),Gs(i,l,null,s);var v=i.memoizedState;if(l=v.cache,ji(i,It,l),l!==p.cache&&Ac(i,[It],s,!0),Ws(),l=v.element,p.isDehydrated)if(p={element:l,isDehydrated:!1,cache:v.cache},i.updateQueue.baseState=p,i.memoizedState=p,i.flags&256){i=up(t,i,l,s);break e}else if(l!==u){u=Nn(Error(o(424)),i),zs(u),i=up(t,i,l,s);break e}else for(t=i.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,mt=Bn(t.firstChild),Gt=i,Pe=!0,Hi=null,Ln=!0,s=sm(i,null,l,s),i.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ga(),l===u){i=gi(t,i,s);break e}Qt(t,i,l,s)}i=i.child}return i;case 26:return vr(t,i),t===null?(s=_h(i.type,null,i.pendingProps,null))?i.memoizedState=s:Pe||(s=i.type,t=i.pendingProps,l=jr(ce.current).createElement(s),l[Wt]=i,l[cn]=t,Zt(l,s,t),Kt(l),i.stateNode=l):i.memoizedState=_h(i.type,t.memoizedProps,i.pendingProps,t.memoizedState),null;case 27:return _e(i),t===null&&Pe&&(l=i.stateNode=Ah(i.type,i.pendingProps,ce.current),Gt=i,Ln=!0,u=mt,Gi(i.type)?(qu=u,mt=Bn(l.firstChild)):mt=u),Qt(t,i,i.pendingProps.children,s),vr(t,i),t===null&&(i.flags|=4194304),i.child;case 5:return t===null&&Pe&&((u=l=mt)&&(l=ax(l,i.type,i.pendingProps,Ln),l!==null?(i.stateNode=l,Gt=i,mt=Bn(l.firstChild),Ln=!1,u=!0):u=!1),u||Bi(i)),_e(i),u=i.type,p=i.pendingProps,v=t!==null?t.memoizedProps:null,l=p.children,Bu(u,p)?l=null:v!==null&&Bu(u,v)&&(i.flags|=32),i.memoizedState!==null&&(u=Hc(t,i,xb,null,null,s),go._currentValue=u),vr(t,i),Qt(t,i,l,s),i.child;case 6:return t===null&&Pe&&((t=s=mt)&&(s=sx(s,i.pendingProps,Ln),s!==null?(i.stateNode=s,Gt=i,mt=null,t=!0):t=!1),t||Bi(i)),null;case 13:return dp(t,i,s);case 4:return Ce(i,i.stateNode.containerInfo),l=i.pendingProps,t===null?i.child=Ta(i,null,l,s):Qt(t,i,l,s),i.child;case 11:return np(t,i,i.type,i.pendingProps,s);case 7:return Qt(t,i,i.pendingProps,s),i.child;case 8:return Qt(t,i,i.pendingProps.children,s),i.child;case 12:return Qt(t,i,i.pendingProps.children,s),i.child;case 10:return l=i.pendingProps,ji(i,i.type,l.value),Qt(t,i,l.children,s),i.child;case 9:return u=i.type._context,l=i.pendingProps.children,xa(i),u=Jt(u),l=l(u),i.flags|=1,Qt(t,i,l,s),i.child;case 14:return ip(t,i,i.type,i.pendingProps,s);case 15:return ap(t,i,i.type,i.pendingProps,s);case 19:return mp(t,i,s);case 31:return Mb(t,i,s);case 22:return sp(t,i,s,i.pendingProps);case 24:return xa(i),l=Jt(It),t===null?(u=_c(),u===null&&(u=ot,p=Tc(),u.pooledCache=p,p.refCount++,p!==null&&(u.pooledCacheLanes|=s),u=p),i.memoizedState={parent:l,cache:u},Mc(i),ji(i,It,u)):((t.lanes&s)!==0&&(Oc(t,i),Gs(i,null,null,s),Ws()),u=t.memoizedState,p=i.memoizedState,u.parent!==l?(u={parent:l,cache:l},i.memoizedState=u,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=u),ji(i,It,l)):(l=p.cache,ji(i,It,l),l!==u.cache&&Ac(i,[It],s,!0))),Qt(t,i,i.pendingProps.children,s),i.child;case 29:throw i.pendingProps}throw Error(o(156,i.tag))}function bi(t){t.flags|=4}function cu(t,i,s,l,u){if((i=(t.mode&32)!==0)&&(i=!1),i){if(t.flags|=16777216,(u&335544128)===u)if(t.stateNode.complete)t.flags|=8192;else if(qp())t.flags|=8192;else throw Aa=sr,wc}else t.flags&=-16777217}function hp(t,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!kh(i))if(qp())t.flags|=8192;else throw Aa=sr,wc}function Ar(t,i){i!==null&&(t.flags|=4),t.flags&16384&&(i=t.tag!==22?ri():536870912,t.lanes|=i,ps|=i)}function no(t,i){if(!Pe)switch(t.tailMode){case"hidden":i=t.tail;for(var s=null;i!==null;)i.alternate!==null&&(s=i),i=i.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function pt(t){var i=t.alternate!==null&&t.alternate.child===t.child,s=0,l=0;if(i)for(var u=t.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags&65011712,l|=u.flags&65011712,u.return=t,u=u.sibling;else for(u=t.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=t,u=u.sibling;return t.subtreeFlags|=l,t.childLanes=s,i}function Cb(t,i,s){var l=i.pendingProps;switch(gc(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pt(i),null;case 1:return pt(i),null;case 3:return s=i.stateNode,l=null,t!==null&&(l=t.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),pi(It),ve(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(ts(i)?bi(i):t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,xc())),pt(i),null;case 26:var u=i.type,p=i.memoizedState;return t===null?(bi(i),p!==null?(pt(i),hp(i,p)):(pt(i),cu(i,u,null,l,s))):p?p!==t.memoizedState?(bi(i),pt(i),hp(i,p)):(pt(i),i.flags&=-16777217):(t=t.memoizedProps,t!==l&&bi(i),pt(i),cu(i,u,t,l,s)),null;case 27:if(ke(i),s=ce.current,u=i.type,t!==null&&i.stateNode!=null)t.memoizedProps!==l&&bi(i);else{if(!l){if(i.stateNode===null)throw Error(o(166));return pt(i),null}t=ne.current,ts(i)?Xf(i):(t=Ah(u,l,s),i.stateNode=t,bi(i))}return pt(i),null;case 5:if(ke(i),u=i.type,t!==null&&i.stateNode!=null)t.memoizedProps!==l&&bi(i);else{if(!l){if(i.stateNode===null)throw Error(o(166));return pt(i),null}if(p=ne.current,ts(i))Xf(i);else{var v=jr(ce.current);switch(p){case 1:p=v.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:p=v.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":p=v.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":p=v.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":p=v.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild);break;case"select":p=typeof l.is=="string"?v.createElement("select",{is:l.is}):v.createElement("select"),l.multiple?p.multiple=!0:l.size&&(p.size=l.size);break;default:p=typeof l.is=="string"?v.createElement(u,{is:l.is}):v.createElement(u)}}p[Wt]=i,p[cn]=l;e:for(v=i.child;v!==null;){if(v.tag===5||v.tag===6)p.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===i)break e;for(;v.sibling===null;){if(v.return===null||v.return===i)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}i.stateNode=p;e:switch(Zt(p,u,l),u){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&bi(i)}}return pt(i),cu(i,i.type,t===null?null:t.memoizedProps,i.pendingProps,s),null;case 6:if(t&&i.stateNode!=null)t.memoizedProps!==l&&bi(i);else{if(typeof l!="string"&&i.stateNode===null)throw Error(o(166));if(t=ce.current,ts(i)){if(t=i.stateNode,s=i.memoizedProps,l=null,u=Gt,u!==null)switch(u.tag){case 27:case 5:l=u.memoizedProps}t[Wt]=i,t=!!(t.nodeValue===s||l!==null&&l.suppressHydrationWarning===!0||dh(t.nodeValue,s)),t||Bi(i,!0)}else t=jr(t).createTextNode(l),t[Wt]=i,i.stateNode=t}return pt(i),null;case 31:if(s=i.memoizedState,t===null||t.memoizedState!==null){if(l=ts(i),s!==null){if(t===null){if(!l)throw Error(o(318));if(t=i.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(557));t[Wt]=i}else ga(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;pt(i),t=!1}else s=xc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return i.flags&256?(An(i),i):(An(i),null);if((i.flags&128)!==0)throw Error(o(558))}return pt(i),null;case 13:if(l=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(u=ts(i),l!==null&&l.dehydrated!==null){if(t===null){if(!u)throw Error(o(318));if(u=i.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));u[Wt]=i}else ga(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;pt(i),u=!1}else u=xc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=u),u=!0;if(!u)return i.flags&256?(An(i),i):(An(i),null)}return An(i),(i.flags&128)!==0?(i.lanes=s,i):(s=l!==null,t=t!==null&&t.memoizedState!==null,s&&(l=i.child,u=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(u=l.alternate.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==u&&(l.flags|=2048)),s!==t&&s&&(i.child.flags|=8192),Ar(i,i.updateQueue),pt(i),null);case 4:return ve(),t===null&&Nu(i.stateNode.containerInfo),pt(i),null;case 10:return pi(i.type),pt(i),null;case 19:if(W(Ot),l=i.memoizedState,l===null)return pt(i),null;if(u=(i.flags&128)!==0,p=l.rendering,p===null)if(u)no(l,!1);else{if(Et!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(p=cr(t),p!==null){for(i.flags|=128,no(l,!1),t=p.updateQueue,i.updateQueue=t,Ar(i,t),i.subtreeFlags=0,t=s,s=i.child;s!==null;)zf(s,t),s=s.sibling;return Q(Ot,Ot.current&1|2),Pe&&fi(i,l.treeForkCount),i.child}t=t.sibling}l.tail!==null&&Nt()>Mr&&(i.flags|=128,u=!0,no(l,!1),i.lanes=4194304)}else{if(!u)if(t=cr(p),t!==null){if(i.flags|=128,u=!0,t=t.updateQueue,i.updateQueue=t,Ar(i,t),no(l,!0),l.tail===null&&l.tailMode==="hidden"&&!p.alternate&&!Pe)return pt(i),null}else 2*Nt()-l.renderingStartTime>Mr&&s!==536870912&&(i.flags|=128,u=!0,no(l,!1),i.lanes=4194304);l.isBackwards?(p.sibling=i.child,i.child=p):(t=l.last,t!==null?t.sibling=p:i.child=p,l.last=p)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=Nt(),t.sibling=null,s=Ot.current,Q(Ot,u?s&1|2:s&1),Pe&&fi(i,l.treeForkCount),t):(pt(i),null);case 22:case 23:return An(i),Rc(),l=i.memoizedState!==null,t!==null?t.memoizedState!==null!==l&&(i.flags|=8192):l&&(i.flags|=8192),l?(s&536870912)!==0&&(i.flags&128)===0&&(pt(i),i.subtreeFlags&6&&(i.flags|=8192)):pt(i),s=i.updateQueue,s!==null&&Ar(i,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),l=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),l!==s&&(i.flags|=2048),t!==null&&W(va),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),i.memoizedState.cache!==s&&(i.flags|=2048),pi(It),pt(i),null;case 25:return null;case 30:return null}throw Error(o(156,i.tag))}function kb(t,i){switch(gc(i),i.tag){case 1:return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return pi(It),ve(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 26:case 27:case 5:return ke(i),null;case 31:if(i.memoizedState!==null){if(An(i),i.alternate===null)throw Error(o(340));ga()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 13:if(An(i),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(o(340));ga()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return W(Ot),null;case 4:return ve(),null;case 10:return pi(i.type),null;case 22:case 23:return An(i),Rc(),t!==null&&W(va),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 24:return pi(It),null;case 25:return null;default:return null}}function yp(t,i){switch(gc(i),i.tag){case 3:pi(It),ve();break;case 26:case 27:case 5:ke(i);break;case 4:ve();break;case 31:i.memoizedState!==null&&An(i);break;case 13:An(i);break;case 19:W(Ot);break;case 10:pi(i.type);break;case 22:case 23:An(i),Rc(),t!==null&&W(va);break;case 24:pi(It)}}function io(t,i){try{var s=i.updateQueue,l=s!==null?s.lastEffect:null;if(l!==null){var u=l.next;s=u;do{if((s.tag&t)===t){l=void 0;var p=s.create,v=s.inst;l=p(),v.destroy=l}s=s.next}while(s!==u)}}catch(M){Qe(i,i.return,M)}}function zi(t,i,s){try{var l=i.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var p=u.next;l=p;do{if((l.tag&t)===t){var v=l.inst,M=v.destroy;if(M!==void 0){v.destroy=void 0,u=i;var L=s,K=M;try{K()}catch(ie){Qe(u,L,ie)}}}l=l.next}while(l!==p)}}catch(ie){Qe(i,i.return,ie)}}function gp(t){var i=t.updateQueue;if(i!==null){var s=t.stateNode;try{rm(i,s)}catch(l){Qe(t,t.return,l)}}}function bp(t,i,s){s.props=_a(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(l){Qe(t,i,l)}}function ao(t,i){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var l=t.stateNode;break;case 30:l=t.stateNode;break;default:l=t.stateNode}typeof s=="function"?t.refCleanup=s(l):s.current=l}}catch(u){Qe(t,i,u)}}function ai(t,i){var s=t.ref,l=t.refCleanup;if(s!==null)if(typeof l=="function")try{l()}catch(u){Qe(t,i,u)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(u){Qe(t,i,u)}else s.current=null}function xp(t){var i=t.type,s=t.memoizedProps,l=t.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":s.autoFocus&&l.focus();break e;case"img":s.src?l.src=s.src:s.srcSet&&(l.srcset=s.srcSet)}}catch(u){Qe(t,t.return,u)}}function uu(t,i,s){try{var l=t.stateNode;Qb(l,t.type,s,i),l[cn]=i}catch(u){Qe(t,t.return,u)}}function vp(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Gi(t.type)||t.tag===4}function du(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||vp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Gi(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function fu(t,i,s){var l=t.tag;if(l===5||l===6)t=t.stateNode,i?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,i):(i=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,i.appendChild(t),s=s._reactRootContainer,s!=null||i.onclick!==null||(i.onclick=ci));else if(l!==4&&(l===27&&Gi(t.type)&&(s=t.stateNode,i=null),t=t.child,t!==null))for(fu(t,i,s),t=t.sibling;t!==null;)fu(t,i,s),t=t.sibling}function Tr(t,i,s){var l=t.tag;if(l===5||l===6)t=t.stateNode,i?s.insertBefore(t,i):s.appendChild(t);else if(l!==4&&(l===27&&Gi(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(Tr(t,i,s),t=t.sibling;t!==null;)Tr(t,i,s),t=t.sibling}function Sp(t){var i=t.stateNode,s=t.memoizedProps;try{for(var l=t.type,u=i.attributes;u.length;)i.removeAttributeNode(u[0]);Zt(i,l,s),i[Wt]=t,i[cn]=s}catch(p){Qe(t,t.return,p)}}var xi=!1,Bt=!1,mu=!1,Ap=typeof WeakSet=="function"?WeakSet:Set,Ft=null;function Nb(t,i){if(t=t.containerInfo,Lu=Vr,t=Lf(t),oc(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var l=s.getSelection&&s.getSelection();if(l&&l.rangeCount!==0){s=l.anchorNode;var u=l.anchorOffset,p=l.focusNode;l=l.focusOffset;try{s.nodeType,p.nodeType}catch{s=null;break e}var v=0,M=-1,L=-1,K=0,ie=0,oe=t,J=null;t:for(;;){for(var te;oe!==s||u!==0&&oe.nodeType!==3||(M=v+u),oe!==p||l!==0&&oe.nodeType!==3||(L=v+l),oe.nodeType===3&&(v+=oe.nodeValue.length),(te=oe.firstChild)!==null;)J=oe,oe=te;for(;;){if(oe===t)break t;if(J===s&&++K===u&&(M=v),J===p&&++ie===l&&(L=v),(te=oe.nextSibling)!==null)break;oe=J,J=oe.parentNode}oe=te}s=M===-1||L===-1?null:{start:M,end:L}}else s=null}s=s||{start:0,end:0}}else s=null;for(Hu={focusedElem:t,selectionRange:s},Vr=!1,Ft=i;Ft!==null;)if(i=Ft,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,Ft=t;else for(;Ft!==null;){switch(i=Ft,p=i.alternate,t=i.flags,i.tag){case 0:if((t&4)!==0&&(t=i.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)u=t[s],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&p!==null){t=void 0,s=i,u=p.memoizedProps,p=p.memoizedState,l=s.stateNode;try{var pe=_a(s.type,u);t=l.getSnapshotBeforeUpdate(pe,p),l.__reactInternalSnapshotBeforeUpdate=t}catch(Se){Qe(s,s.return,Se)}}break;case 3:if((t&1024)!==0){if(t=i.stateNode.containerInfo,s=t.nodeType,s===9)Du(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Du(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(o(163))}if(t=i.sibling,t!==null){t.return=i.return,Ft=t;break}Ft=i.return}}function Tp(t,i,s){var l=s.flags;switch(s.tag){case 0:case 11:case 15:Si(t,s),l&4&&io(5,s);break;case 1:if(Si(t,s),l&4)if(t=s.stateNode,i===null)try{t.componentDidMount()}catch(v){Qe(s,s.return,v)}else{var u=_a(s.type,i.memoizedProps);i=i.memoizedState;try{t.componentDidUpdate(u,i,t.__reactInternalSnapshotBeforeUpdate)}catch(v){Qe(s,s.return,v)}}l&64&&gp(s),l&512&&ao(s,s.return);break;case 3:if(Si(t,s),l&64&&(t=s.updateQueue,t!==null)){if(i=null,s.child!==null)switch(s.child.tag){case 27:case 5:i=s.child.stateNode;break;case 1:i=s.child.stateNode}try{rm(t,i)}catch(v){Qe(s,s.return,v)}}break;case 27:i===null&&l&4&&Sp(s);case 26:case 5:Si(t,s),i===null&&l&4&&xp(s),l&512&&ao(s,s.return);break;case 12:Si(t,s);break;case 31:Si(t,s),l&4&&wp(t,s);break;case 13:Si(t,s),l&4&&Mp(t,s),l&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=Ub.bind(null,s),ox(t,s))));break;case 22:if(l=s.memoizedState!==null||xi,!l){i=i!==null&&i.memoizedState!==null||Bt,u=xi;var p=Bt;xi=l,(Bt=i)&&!p?Ai(t,s,(s.subtreeFlags&8772)!==0):Si(t,s),xi=u,Bt=p}break;case 30:break;default:Si(t,s)}}function Ep(t){var i=t.alternate;i!==null&&(t.alternate=null,Ep(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&zl(i)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var gt=null,dn=!1;function vi(t,i,s){for(s=s.child;s!==null;)_p(t,i,s),s=s.sibling}function _p(t,i,s){if(De&&typeof De.onCommitFiberUnmount=="function")try{De.onCommitFiberUnmount(ln,s)}catch{}switch(s.tag){case 26:Bt||ai(s,i),vi(t,i,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:Bt||ai(s,i);var l=gt,u=dn;Gi(s.type)&&(gt=s.stateNode,dn=!1),vi(t,i,s),po(s.stateNode),gt=l,dn=u;break;case 5:Bt||ai(s,i);case 6:if(l=gt,u=dn,gt=null,vi(t,i,s),gt=l,dn=u,gt!==null)if(dn)try{(gt.nodeType===9?gt.body:gt.nodeName==="HTML"?gt.ownerDocument.body:gt).removeChild(s.stateNode)}catch(p){Qe(s,i,p)}else try{gt.removeChild(s.stateNode)}catch(p){Qe(s,i,p)}break;case 18:gt!==null&&(dn?(t=gt,gh(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),As(t)):gh(gt,s.stateNode));break;case 4:l=gt,u=dn,gt=s.stateNode.containerInfo,dn=!0,vi(t,i,s),gt=l,dn=u;break;case 0:case 11:case 14:case 15:zi(2,s,i),Bt||zi(4,s,i),vi(t,i,s);break;case 1:Bt||(ai(s,i),l=s.stateNode,typeof l.componentWillUnmount=="function"&&bp(s,i,l)),vi(t,i,s);break;case 21:vi(t,i,s);break;case 22:Bt=(l=Bt)||s.memoizedState!==null,vi(t,i,s),Bt=l;break;default:vi(t,i,s)}}function wp(t,i){if(i.memoizedState===null&&(t=i.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{As(t)}catch(s){Qe(i,i.return,s)}}}function Mp(t,i){if(i.memoizedState===null&&(t=i.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{As(t)}catch(s){Qe(i,i.return,s)}}function Rb(t){switch(t.tag){case 31:case 13:case 19:var i=t.stateNode;return i===null&&(i=t.stateNode=new Ap),i;case 22:return t=t.stateNode,i=t._retryCache,i===null&&(i=t._retryCache=new Ap),i;default:throw Error(o(435,t.tag))}}function Er(t,i){var s=Rb(t);i.forEach(function(l){if(!s.has(l)){s.add(l);var u=qb.bind(null,t,l);l.then(u,u)}})}function fn(t,i){var s=i.deletions;if(s!==null)for(var l=0;l<s.length;l++){var u=s[l],p=t,v=i,M=v;e:for(;M!==null;){switch(M.tag){case 27:if(Gi(M.type)){gt=M.stateNode,dn=!1;break e}break;case 5:gt=M.stateNode,dn=!1;break e;case 3:case 4:gt=M.stateNode.containerInfo,dn=!0;break e}M=M.return}if(gt===null)throw Error(o(160));_p(p,v,u),gt=null,dn=!1,p=u.alternate,p!==null&&(p.return=null),u.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)Op(i,t),i=i.sibling}var Vn=null;function Op(t,i){var s=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:fn(i,t),mn(t),l&4&&(zi(3,t,t.return),io(3,t),zi(5,t,t.return));break;case 1:fn(i,t),mn(t),l&512&&(Bt||s===null||ai(s,s.return)),l&64&&xi&&(t=t.updateQueue,t!==null&&(l=t.callbacks,l!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?l:s.concat(l))));break;case 26:var u=Vn;if(fn(i,t),mn(t),l&512&&(Bt||s===null||ai(s,s.return)),l&4){var p=s!==null?s.memoizedState:null;if(l=t.memoizedState,s===null)if(l===null)if(t.stateNode===null){e:{l=t.type,s=t.memoizedProps,u=u.ownerDocument||u;t:switch(l){case"title":p=u.getElementsByTagName("title")[0],(!p||p[Ns]||p[Wt]||p.namespaceURI==="http://www.w3.org/2000/svg"||p.hasAttribute("itemprop"))&&(p=u.createElement(l),u.head.insertBefore(p,u.querySelector("head > title"))),Zt(p,l,s),p[Wt]=t,Kt(p),l=p;break e;case"link":var v=Oh("link","href",u).get(l+(s.href||""));if(v){for(var M=0;M<v.length;M++)if(p=v[M],p.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&p.getAttribute("rel")===(s.rel==null?null:s.rel)&&p.getAttribute("title")===(s.title==null?null:s.title)&&p.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){v.splice(M,1);break t}}p=u.createElement(l),Zt(p,l,s),u.head.appendChild(p);break;case"meta":if(v=Oh("meta","content",u).get(l+(s.content||""))){for(M=0;M<v.length;M++)if(p=v[M],p.getAttribute("content")===(s.content==null?null:""+s.content)&&p.getAttribute("name")===(s.name==null?null:s.name)&&p.getAttribute("property")===(s.property==null?null:s.property)&&p.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&p.getAttribute("charset")===(s.charSet==null?null:s.charSet)){v.splice(M,1);break t}}p=u.createElement(l),Zt(p,l,s),u.head.appendChild(p);break;default:throw Error(o(468,l))}p[Wt]=t,Kt(p),l=p}t.stateNode=l}else Ch(u,t.type,t.stateNode);else t.stateNode=Mh(u,l,t.memoizedProps);else p!==l?(p===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):p.count--,l===null?Ch(u,t.type,t.stateNode):Mh(u,l,t.memoizedProps)):l===null&&t.stateNode!==null&&uu(t,t.memoizedProps,s.memoizedProps)}break;case 27:fn(i,t),mn(t),l&512&&(Bt||s===null||ai(s,s.return)),s!==null&&l&4&&uu(t,t.memoizedProps,s.memoizedProps);break;case 5:if(fn(i,t),mn(t),l&512&&(Bt||s===null||ai(s,s.return)),t.flags&32){u=t.stateNode;try{Ya(u,"")}catch(pe){Qe(t,t.return,pe)}}l&4&&t.stateNode!=null&&(u=t.memoizedProps,uu(t,u,s!==null?s.memoizedProps:u)),l&1024&&(mu=!0);break;case 6:if(fn(i,t),mn(t),l&4){if(t.stateNode===null)throw Error(o(162));l=t.memoizedProps,s=t.stateNode;try{s.nodeValue=l}catch(pe){Qe(t,t.return,pe)}}break;case 3:if(Ur=null,u=Vn,Vn=Dr(i.containerInfo),fn(i,t),Vn=u,mn(t),l&4&&s!==null&&s.memoizedState.isDehydrated)try{As(i.containerInfo)}catch(pe){Qe(t,t.return,pe)}mu&&(mu=!1,Cp(t));break;case 4:l=Vn,Vn=Dr(t.stateNode.containerInfo),fn(i,t),mn(t),Vn=l;break;case 12:fn(i,t),mn(t);break;case 31:fn(i,t),mn(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Er(t,l)));break;case 13:fn(i,t),mn(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(wr=Nt()),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Er(t,l)));break;case 22:u=t.memoizedState!==null;var L=s!==null&&s.memoizedState!==null,K=xi,ie=Bt;if(xi=K||u,Bt=ie||L,fn(i,t),Bt=ie,xi=K,mn(t),l&8192)e:for(i=t.stateNode,i._visibility=u?i._visibility&-2:i._visibility|1,u&&(s===null||L||xi||Bt||wa(t)),s=null,i=t;;){if(i.tag===5||i.tag===26){if(s===null){L=s=i;try{if(p=L.stateNode,u)v=p.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none";else{M=L.stateNode;var oe=L.memoizedProps.style,J=oe!=null&&oe.hasOwnProperty("display")?oe.display:null;M.style.display=J==null||typeof J=="boolean"?"":(""+J).trim()}}catch(pe){Qe(L,L.return,pe)}}}else if(i.tag===6){if(s===null){L=i;try{L.stateNode.nodeValue=u?"":L.memoizedProps}catch(pe){Qe(L,L.return,pe)}}}else if(i.tag===18){if(s===null){L=i;try{var te=L.stateNode;u?bh(te,!0):bh(L.stateNode,!1)}catch(pe){Qe(L,L.return,pe)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===t)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;i.sibling===null;){if(i.return===null||i.return===t)break e;s===i&&(s=null),i=i.return}s===i&&(s=null),i.sibling.return=i.return,i=i.sibling}l&4&&(l=t.updateQueue,l!==null&&(s=l.retryQueue,s!==null&&(l.retryQueue=null,Er(t,s))));break;case 19:fn(i,t),mn(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Er(t,l)));break;case 30:break;case 21:break;default:fn(i,t),mn(t)}}function mn(t){var i=t.flags;if(i&2){try{for(var s,l=t.return;l!==null;){if(vp(l)){s=l;break}l=l.return}if(s==null)throw Error(o(160));switch(s.tag){case 27:var u=s.stateNode,p=du(t);Tr(t,p,u);break;case 5:var v=s.stateNode;s.flags&32&&(Ya(v,""),s.flags&=-33);var M=du(t);Tr(t,M,v);break;case 3:case 4:var L=s.stateNode.containerInfo,K=du(t);fu(t,K,L);break;default:throw Error(o(161))}}catch(ie){Qe(t,t.return,ie)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function Cp(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var i=t;Cp(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),t=t.sibling}}function Si(t,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Tp(t,i.alternate,i),i=i.sibling}function wa(t){for(t=t.child;t!==null;){var i=t;switch(i.tag){case 0:case 11:case 14:case 15:zi(4,i,i.return),wa(i);break;case 1:ai(i,i.return);var s=i.stateNode;typeof s.componentWillUnmount=="function"&&bp(i,i.return,s),wa(i);break;case 27:po(i.stateNode);case 26:case 5:ai(i,i.return),wa(i);break;case 22:i.memoizedState===null&&wa(i);break;case 30:wa(i);break;default:wa(i)}t=t.sibling}}function Ai(t,i,s){for(s=s&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var l=i.alternate,u=t,p=i,v=p.flags;switch(p.tag){case 0:case 11:case 15:Ai(u,p,s),io(4,p);break;case 1:if(Ai(u,p,s),l=p,u=l.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(K){Qe(l,l.return,K)}if(l=p,u=l.updateQueue,u!==null){var M=l.stateNode;try{var L=u.shared.hiddenCallbacks;if(L!==null)for(u.shared.hiddenCallbacks=null,u=0;u<L.length;u++)om(L[u],M)}catch(K){Qe(l,l.return,K)}}s&&v&64&&gp(p),ao(p,p.return);break;case 27:Sp(p);case 26:case 5:Ai(u,p,s),s&&l===null&&v&4&&xp(p),ao(p,p.return);break;case 12:Ai(u,p,s);break;case 31:Ai(u,p,s),s&&v&4&&wp(u,p);break;case 13:Ai(u,p,s),s&&v&4&&Mp(u,p);break;case 22:p.memoizedState===null&&Ai(u,p,s),ao(p,p.return);break;case 30:break;default:Ai(u,p,s)}i=i.sibling}}function pu(t,i){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(t=i.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&Vs(s))}function hu(t,i){t=null,i.alternate!==null&&(t=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==t&&(i.refCount++,t!=null&&Vs(t))}function Yn(t,i,s,l){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)kp(t,i,s,l),i=i.sibling}function kp(t,i,s,l){var u=i.flags;switch(i.tag){case 0:case 11:case 15:Yn(t,i,s,l),u&2048&&io(9,i);break;case 1:Yn(t,i,s,l);break;case 3:Yn(t,i,s,l),u&2048&&(t=null,i.alternate!==null&&(t=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==t&&(i.refCount++,t!=null&&Vs(t)));break;case 12:if(u&2048){Yn(t,i,s,l),t=i.stateNode;try{var p=i.memoizedProps,v=p.id,M=p.onPostCommit;typeof M=="function"&&M(v,i.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(L){Qe(i,i.return,L)}}else Yn(t,i,s,l);break;case 31:Yn(t,i,s,l);break;case 13:Yn(t,i,s,l);break;case 23:break;case 22:p=i.stateNode,v=i.alternate,i.memoizedState!==null?p._visibility&2?Yn(t,i,s,l):so(t,i):p._visibility&2?Yn(t,i,s,l):(p._visibility|=2,ds(t,i,s,l,(i.subtreeFlags&10256)!==0||!1)),u&2048&&pu(v,i);break;case 24:Yn(t,i,s,l),u&2048&&hu(i.alternate,i);break;default:Yn(t,i,s,l)}}function ds(t,i,s,l,u){for(u=u&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var p=t,v=i,M=s,L=l,K=v.flags;switch(v.tag){case 0:case 11:case 15:ds(p,v,M,L,u),io(8,v);break;case 23:break;case 22:var ie=v.stateNode;v.memoizedState!==null?ie._visibility&2?ds(p,v,M,L,u):so(p,v):(ie._visibility|=2,ds(p,v,M,L,u)),u&&K&2048&&pu(v.alternate,v);break;case 24:ds(p,v,M,L,u),u&&K&2048&&hu(v.alternate,v);break;default:ds(p,v,M,L,u)}i=i.sibling}}function so(t,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var s=t,l=i,u=l.flags;switch(l.tag){case 22:so(s,l),u&2048&&pu(l.alternate,l);break;case 24:so(s,l),u&2048&&hu(l.alternate,l);break;default:so(s,l)}i=i.sibling}}var oo=8192;function fs(t,i,s){if(t.subtreeFlags&oo)for(t=t.child;t!==null;)Np(t,i,s),t=t.sibling}function Np(t,i,s){switch(t.tag){case 26:fs(t,i,s),t.flags&oo&&t.memoizedState!==null&&bx(s,Vn,t.memoizedState,t.memoizedProps);break;case 5:fs(t,i,s);break;case 3:case 4:var l=Vn;Vn=Dr(t.stateNode.containerInfo),fs(t,i,s),Vn=l;break;case 22:t.memoizedState===null&&(l=t.alternate,l!==null&&l.memoizedState!==null?(l=oo,oo=16777216,fs(t,i,s),oo=l):fs(t,i,s));break;default:fs(t,i,s)}}function Rp(t){var i=t.alternate;if(i!==null&&(t=i.child,t!==null)){i.child=null;do i=t.sibling,t.sibling=null,t=i;while(t!==null)}}function ro(t){var i=t.deletions;if((t.flags&16)!==0){if(i!==null)for(var s=0;s<i.length;s++){var l=i[s];Ft=l,Lp(l,t)}Rp(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Ip(t),t=t.sibling}function Ip(t){switch(t.tag){case 0:case 11:case 15:ro(t),t.flags&2048&&zi(9,t,t.return);break;case 3:ro(t);break;case 12:ro(t);break;case 22:var i=t.stateNode;t.memoizedState!==null&&i._visibility&2&&(t.return===null||t.return.tag!==13)?(i._visibility&=-3,_r(t)):ro(t);break;default:ro(t)}}function _r(t){var i=t.deletions;if((t.flags&16)!==0){if(i!==null)for(var s=0;s<i.length;s++){var l=i[s];Ft=l,Lp(l,t)}Rp(t)}for(t=t.child;t!==null;){switch(i=t,i.tag){case 0:case 11:case 15:zi(8,i,i.return),_r(i);break;case 22:s=i.stateNode,s._visibility&2&&(s._visibility&=-3,_r(i));break;default:_r(i)}t=t.sibling}}function Lp(t,i){for(;Ft!==null;){var s=Ft;switch(s.tag){case 0:case 11:case 15:zi(8,s,i);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var l=s.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Vs(s.memoizedState.cache)}if(l=s.child,l!==null)l.return=s,Ft=l;else e:for(s=t;Ft!==null;){l=Ft;var u=l.sibling,p=l.return;if(Ep(l),l===s){Ft=null;break e}if(u!==null){u.return=p,Ft=u;break e}Ft=p}}}var Ib={getCacheForType:function(t){var i=Jt(It),s=i.data.get(t);return s===void 0&&(s=t(),i.data.set(t,s)),s},cacheSignal:function(){return Jt(It).controller.signal}},Lb=typeof WeakMap=="function"?WeakMap:Map,Ke=0,ot=null,Le=null,Be=0,Je=0,Tn=null,Vi=!1,ms=!1,yu=!1,Ti=0,Et=0,Yi=0,Ma=0,gu=0,En=0,ps=0,lo=null,pn=null,bu=!1,wr=0,Hp=0,Mr=1/0,Or=null,Ki=null,zt=0,Fi=null,hs=null,Ei=0,xu=0,vu=null,Bp=null,co=0,Su=null;function _n(){return(Ke&2)!==0&&Be!==0?Be&-Be:B.T!==null?Mu():ks()}function jp(){if(En===0)if((Be&536870912)===0||Pe){var t=lt;lt<<=1,(lt&3932160)===0&&(lt=262144),En=t}else En=536870912;return t=Sn.current,t!==null&&(t.flags|=32),En}function hn(t,i,s){(t===ot&&(Je===2||Je===9)||t.cancelPendingCommit!==null)&&(ys(t,0),Xi(t,Be,En,!1)),$n(t,s),((Ke&2)===0||t!==ot)&&(t===ot&&((Ke&2)===0&&(Ma|=s),Et===4&&Xi(t,Be,En,!1)),si(t))}function Dp(t,i,s){if((Ke&6)!==0)throw Error(o(327));var l=!s&&(i&127)===0&&(i&t.expiredLanes)===0||gn(t,i),u=l?jb(t,i):Tu(t,i,!0),p=l;do{if(u===0){ms&&!l&&Xi(t,i,0,!1);break}else{if(s=t.current.alternate,p&&!Hb(s)){u=Tu(t,i,!1),p=!1;continue}if(u===2){if(p=i,t.errorRecoveryDisabledLanes&p)var v=0;else v=t.pendingLanes&-536870913,v=v!==0?v:v&536870912?536870912:0;if(v!==0){i=v;e:{var M=t;u=lo;var L=M.current.memoizedState.isDehydrated;if(L&&(ys(M,v).flags|=256),v=Tu(M,v,!1),v!==2){if(yu&&!L){M.errorRecoveryDisabledLanes|=p,Ma|=p,u=4;break e}p=pn,pn=u,p!==null&&(pn===null?pn=p:pn.push.apply(pn,p))}u=v}if(p=!1,u!==2)continue}}if(u===1){ys(t,0),Xi(t,i,0,!0);break}e:{switch(l=t,p=u,p){case 0:case 1:throw Error(o(345));case 4:if((i&4194048)!==i)break;case 6:Xi(l,i,En,!Vi);break e;case 2:pn=null;break;case 3:case 5:break;default:throw Error(o(329))}if((i&62914560)===i&&(u=wr+300-Nt(),10<u)){if(Xi(l,i,En,!Vi),At(l,0,!0)!==0)break e;Ei=i,l.timeoutHandle=hh(Pp.bind(null,l,s,pn,Or,bu,i,En,Ma,ps,Vi,p,"Throttled",-0,0),u);break e}Pp(l,s,pn,Or,bu,i,En,Ma,ps,Vi,p,null,-0,0)}}break}while(!0);si(t)}function Pp(t,i,s,l,u,p,v,M,L,K,ie,oe,J,te){if(t.timeoutHandle=-1,oe=i.subtreeFlags,oe&8192||(oe&16785408)===16785408){oe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ci},Np(i,p,oe);var pe=(p&62914560)===p?wr-Nt():(p&4194048)===p?Hp-Nt():0;if(pe=xx(oe,pe),pe!==null){Ei=p,t.cancelPendingCommit=pe(Fp.bind(null,t,i,p,s,l,u,v,M,L,ie,oe,null,J,te)),Xi(t,p,v,!K);return}}Fp(t,i,p,s,l,u,v,M,L)}function Hb(t){for(var i=t;;){var s=i.tag;if((s===0||s===11||s===15)&&i.flags&16384&&(s=i.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var l=0;l<s.length;l++){var u=s[l],p=u.getSnapshot;u=u.value;try{if(!xn(p(),u))return!1}catch{return!1}}if(s=i.child,i.subtreeFlags&16384&&s!==null)s.return=i,i=s;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Xi(t,i,s,l){i&=~gu,i&=~Ma,t.suspendedLanes|=i,t.pingedLanes&=~i,l&&(t.warmLanes|=i),l=t.expirationTimes;for(var u=i;0<u;){var p=31-st(u),v=1<<p;l[p]=-1,u&=~v}s!==0&&yt(t,s,i)}function Cr(){return(Ke&6)===0?(uo(0),!1):!0}function Au(){if(Le!==null){if(Je===0)var t=Le.return;else t=Le,mi=ba=null,Dc(t),os=null,Ks=0,t=Le;for(;t!==null;)yp(t.alternate,t),t=t.return;Le=null}}function ys(t,i){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,tx(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),Ei=0,Au(),ot=t,Le=s=di(t.current,null),Be=i,Je=0,Tn=null,Vi=!1,ms=gn(t,i),yu=!1,ps=En=gu=Ma=Yi=Et=0,pn=lo=null,bu=!1,(i&8)!==0&&(i|=i&32);var l=t.entangledLanes;if(l!==0)for(t=t.entanglements,l&=i;0<l;){var u=31-st(l),p=1<<u;i|=t[u],l&=~p}return Ti=i,Go(),s}function Up(t,i){Me=null,B.H=eo,i===ss||i===ar?(i=nm(),Je=3):i===wc?(i=nm(),Je=4):Je=i===eu?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,Tn=i,Le===null&&(Et=1,br(t,Nn(i,t.current)))}function qp(){var t=Sn.current;return t===null?!0:(Be&4194048)===Be?Hn===null:(Be&62914560)===Be||(Be&536870912)!==0?t===Hn:!1}function $p(){var t=B.H;return B.H=eo,t===null?eo:t}function zp(){var t=B.A;return B.A=Ib,t}function kr(){Et=4,Vi||(Be&4194048)!==Be&&Sn.current!==null||(ms=!0),(Yi&134217727)===0&&(Ma&134217727)===0||ot===null||Xi(ot,Be,En,!1)}function Tu(t,i,s){var l=Ke;Ke|=2;var u=$p(),p=zp();(ot!==t||Be!==i)&&(Or=null,ys(t,i)),i=!1;var v=Et;e:do try{if(Je!==0&&Le!==null){var M=Le,L=Tn;switch(Je){case 8:Au(),v=6;break e;case 3:case 2:case 9:case 6:Sn.current===null&&(i=!0);var K=Je;if(Je=0,Tn=null,gs(t,M,L,K),s&&ms){v=0;break e}break;default:K=Je,Je=0,Tn=null,gs(t,M,L,K)}}Bb(),v=Et;break}catch(ie){Up(t,ie)}while(!0);return i&&t.shellSuspendCounter++,mi=ba=null,Ke=l,B.H=u,B.A=p,Le===null&&(ot=null,Be=0,Go()),v}function Bb(){for(;Le!==null;)Vp(Le)}function jb(t,i){var s=Ke;Ke|=2;var l=$p(),u=zp();ot!==t||Be!==i?(Or=null,Mr=Nt()+500,ys(t,i)):ms=gn(t,i);e:do try{if(Je!==0&&Le!==null){i=Le;var p=Tn;t:switch(Je){case 1:Je=0,Tn=null,gs(t,i,p,1);break;case 2:case 9:if(em(p)){Je=0,Tn=null,Yp(i);break}i=function(){Je!==2&&Je!==9||ot!==t||(Je=7),si(t)},p.then(i,i);break e;case 3:Je=7;break e;case 4:Je=5;break e;case 7:em(p)?(Je=0,Tn=null,Yp(i)):(Je=0,Tn=null,gs(t,i,p,7));break;case 5:var v=null;switch(Le.tag){case 26:v=Le.memoizedState;case 5:case 27:var M=Le;if(v?kh(v):M.stateNode.complete){Je=0,Tn=null;var L=M.sibling;if(L!==null)Le=L;else{var K=M.return;K!==null?(Le=K,Nr(K)):Le=null}break t}}Je=0,Tn=null,gs(t,i,p,5);break;case 6:Je=0,Tn=null,gs(t,i,p,6);break;case 8:Au(),Et=6;break e;default:throw Error(o(462))}}Db();break}catch(ie){Up(t,ie)}while(!0);return mi=ba=null,B.H=l,B.A=u,Ke=s,Le!==null?0:(ot=null,Be=0,Go(),Et)}function Db(){for(;Le!==null&&!Un();)Vp(Le)}function Vp(t){var i=pp(t.alternate,t,Ti);t.memoizedProps=t.pendingProps,i===null?Nr(t):Le=i}function Yp(t){var i=t,s=i.alternate;switch(i.tag){case 15:case 0:i=lp(s,i,i.pendingProps,i.type,void 0,Be);break;case 11:i=lp(s,i,i.pendingProps,i.type.render,i.ref,Be);break;case 5:Dc(i);default:yp(s,i),i=Le=zf(i,Ti),i=pp(s,i,Ti)}t.memoizedProps=t.pendingProps,i===null?Nr(t):Le=i}function gs(t,i,s,l){mi=ba=null,Dc(i),os=null,Ks=0;var u=i.return;try{if(wb(t,u,i,s,Be)){Et=1,br(t,Nn(s,t.current)),Le=null;return}}catch(p){if(u!==null)throw Le=u,p;Et=1,br(t,Nn(s,t.current)),Le=null;return}i.flags&32768?(Pe||l===1?t=!0:ms||(Be&536870912)!==0?t=!1:(Vi=t=!0,(l===2||l===9||l===3||l===6)&&(l=Sn.current,l!==null&&l.tag===13&&(l.flags|=16384))),Kp(i,t)):Nr(i)}function Nr(t){var i=t;do{if((i.flags&32768)!==0){Kp(i,Vi);return}t=i.return;var s=Cb(i.alternate,i,Ti);if(s!==null){Le=s;return}if(i=i.sibling,i!==null){Le=i;return}Le=i=t}while(i!==null);Et===0&&(Et=5)}function Kp(t,i){do{var s=kb(t.alternate,t);if(s!==null){s.flags&=32767,Le=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!i&&(t=t.sibling,t!==null)){Le=t;return}Le=t=s}while(t!==null);Et=6,Le=null}function Fp(t,i,s,l,u,p,v,M,L){t.cancelPendingCommit=null;do Rr();while(zt!==0);if((Ke&6)!==0)throw Error(o(327));if(i!==null){if(i===t.current)throw Error(o(177));if(p=i.lanes|i.childLanes,p|=dc,Rt(t,s,p,v,M,L),t===ot&&(Le=ot=null,Be=0),hs=i,Fi=t,Ei=s,xu=p,vu=u,Bp=l,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,$b(qt,function(){return Qp(),null})):(t.callbackNode=null,t.callbackPriority=0),l=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||l){l=B.T,B.T=null,u=$.p,$.p=2,v=Ke,Ke|=4;try{Nb(t,i,s)}finally{Ke=v,$.p=u,B.T=l}}zt=1,Xp(),Wp(),Gp()}}function Xp(){if(zt===1){zt=0;var t=Fi,i=hs,s=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||s){s=B.T,B.T=null;var l=$.p;$.p=2;var u=Ke;Ke|=4;try{Op(i,t);var p=Hu,v=Lf(t.containerInfo),M=p.focusedElem,L=p.selectionRange;if(v!==M&&M&&M.ownerDocument&&If(M.ownerDocument.documentElement,M)){if(L!==null&&oc(M)){var K=L.start,ie=L.end;if(ie===void 0&&(ie=K),"selectionStart"in M)M.selectionStart=K,M.selectionEnd=Math.min(ie,M.value.length);else{var oe=M.ownerDocument||document,J=oe&&oe.defaultView||window;if(J.getSelection){var te=J.getSelection(),pe=M.textContent.length,Se=Math.min(L.start,pe),it=L.end===void 0?Se:Math.min(L.end,pe);!te.extend&&Se>it&&(v=it,it=Se,Se=v);var U=Rf(M,Se),j=Rf(M,it);if(U&&j&&(te.rangeCount!==1||te.anchorNode!==U.node||te.anchorOffset!==U.offset||te.focusNode!==j.node||te.focusOffset!==j.offset)){var V=oe.createRange();V.setStart(U.node,U.offset),te.removeAllRanges(),Se>it?(te.addRange(V),te.extend(j.node,j.offset)):(V.setEnd(j.node,j.offset),te.addRange(V))}}}}for(oe=[],te=M;te=te.parentNode;)te.nodeType===1&&oe.push({element:te,left:te.scrollLeft,top:te.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<oe.length;M++){var ae=oe[M];ae.element.scrollLeft=ae.left,ae.element.scrollTop=ae.top}}Vr=!!Lu,Hu=Lu=null}finally{Ke=u,$.p=l,B.T=s}}t.current=i,zt=2}}function Wp(){if(zt===2){zt=0;var t=Fi,i=hs,s=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||s){s=B.T,B.T=null;var l=$.p;$.p=2;var u=Ke;Ke|=4;try{Tp(t,i.alternate,i)}finally{Ke=u,$.p=l,B.T=s}}zt=3}}function Gp(){if(zt===4||zt===3){zt=0,qn();var t=Fi,i=hs,s=Ei,l=Bp;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?zt=5:(zt=0,hs=Fi=null,Jp(t,t.pendingLanes));var u=t.pendingLanes;if(u===0&&(Ki=null),Da(s),i=i.stateNode,De&&typeof De.onCommitFiberRoot=="function")try{De.onCommitFiberRoot(ln,i,void 0,(i.current.flags&128)===128)}catch{}if(l!==null){i=B.T,u=$.p,$.p=2,B.T=null;try{for(var p=t.onRecoverableError,v=0;v<l.length;v++){var M=l[v];p(M.value,{componentStack:M.stack})}}finally{B.T=i,$.p=u}}(Ei&3)!==0&&Rr(),si(t),u=t.pendingLanes,(s&261930)!==0&&(u&42)!==0?t===Su?co++:(co=0,Su=t):co=0,uo(0)}}function Jp(t,i){(t.pooledCacheLanes&=i)===0&&(i=t.pooledCache,i!=null&&(t.pooledCache=null,Vs(i)))}function Rr(){return Xp(),Wp(),Gp(),Qp()}function Qp(){if(zt!==5)return!1;var t=Fi,i=xu;xu=0;var s=Da(Ei),l=B.T,u=$.p;try{$.p=32>s?32:s,B.T=null,s=vu,vu=null;var p=Fi,v=Ei;if(zt=0,hs=Fi=null,Ei=0,(Ke&6)!==0)throw Error(o(331));var M=Ke;if(Ke|=4,Ip(p.current),kp(p,p.current,v,s),Ke=M,uo(0,!1),De&&typeof De.onPostCommitFiberRoot=="function")try{De.onPostCommitFiberRoot(ln,p)}catch{}return!0}finally{$.p=u,B.T=l,Jp(t,i)}}function Zp(t,i,s){i=Nn(s,i),i=Zc(t.stateNode,i,2),t=Ui(t,i,2),t!==null&&($n(t,2),si(t))}function Qe(t,i,s){if(t.tag===3)Zp(t,t,s);else for(;i!==null;){if(i.tag===3){Zp(i,t,s);break}else if(i.tag===1){var l=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Ki===null||!Ki.has(l))){t=Nn(s,t),s=ep(2),l=Ui(i,s,2),l!==null&&(tp(s,l,i,t),$n(l,2),si(l));break}}i=i.return}}function Eu(t,i,s){var l=t.pingCache;if(l===null){l=t.pingCache=new Lb;var u=new Set;l.set(i,u)}else u=l.get(i),u===void 0&&(u=new Set,l.set(i,u));u.has(s)||(yu=!0,u.add(s),t=Pb.bind(null,t,i,s),i.then(t,t))}function Pb(t,i,s){var l=t.pingCache;l!==null&&l.delete(i),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,ot===t&&(Be&s)===s&&(Et===4||Et===3&&(Be&62914560)===Be&&300>Nt()-wr?(Ke&2)===0&&ys(t,0):gu|=s,ps===Be&&(ps=0)),si(t)}function eh(t,i){i===0&&(i=ri()),t=ha(t,i),t!==null&&($n(t,i),si(t))}function Ub(t){var i=t.memoizedState,s=0;i!==null&&(s=i.retryLane),eh(t,s)}function qb(t,i){var s=0;switch(t.tag){case 31:case 13:var l=t.stateNode,u=t.memoizedState;u!==null&&(s=u.retryLane);break;case 19:l=t.stateNode;break;case 22:l=t.stateNode._retryCache;break;default:throw Error(o(314))}l!==null&&l.delete(i),eh(t,s)}function $b(t,i){return Ut(t,i)}var Ir=null,bs=null,_u=!1,Lr=!1,wu=!1,Wi=0;function si(t){t!==bs&&t.next===null&&(bs===null?Ir=bs=t:bs=bs.next=t),Lr=!0,_u||(_u=!0,Vb())}function uo(t,i){if(!wu&&Lr){wu=!0;do for(var s=!1,l=Ir;l!==null;){if(t!==0){var u=l.pendingLanes;if(u===0)var p=0;else{var v=l.suspendedLanes,M=l.pingedLanes;p=(1<<31-st(42|t)+1)-1,p&=u&~(v&~M),p=p&201326741?p&201326741|1:p?p|2:0}p!==0&&(s=!0,ah(l,p))}else p=Be,p=At(l,l===ot?p:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(p&3)===0||gn(l,p)||(s=!0,ah(l,p));l=l.next}while(s);wu=!1}}function zb(){th()}function th(){Lr=_u=!1;var t=0;Wi!==0&&ex()&&(t=Wi);for(var i=Nt(),s=null,l=Ir;l!==null;){var u=l.next,p=nh(l,i);p===0?(l.next=null,s===null?Ir=u:s.next=u,u===null&&(bs=s)):(s=l,(t!==0||(p&3)!==0)&&(Lr=!0)),l=u}zt!==0&&zt!==5||uo(t),Wi!==0&&(Wi=0)}function nh(t,i){for(var s=t.suspendedLanes,l=t.pingedLanes,u=t.expirationTimes,p=t.pendingLanes&-62914561;0<p;){var v=31-st(p),M=1<<v,L=u[v];L===-1?((M&s)===0||(M&l)!==0)&&(u[v]=bn(M,i)):L<=i&&(t.expiredLanes|=M),p&=~M}if(i=ot,s=Be,s=At(t,t===i?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l=t.callbackNode,s===0||t===i&&(Je===2||Je===9)||t.cancelPendingCommit!==null)return l!==null&&l!==null&&Mt(l),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||gn(t,s)){if(i=s&-s,i===t.callbackPriority)return i;switch(l!==null&&Mt(l),Da(s)){case 2:case 8:s=St;break;case 32:s=qt;break;case 268435456:s=yn;break;default:s=qt}return l=ih.bind(null,t),s=Ut(s,l),t.callbackPriority=i,t.callbackNode=s,i}return l!==null&&l!==null&&Mt(l),t.callbackPriority=2,t.callbackNode=null,2}function ih(t,i){if(zt!==0&&zt!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(Rr()&&t.callbackNode!==s)return null;var l=Be;return l=At(t,t===ot?l:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l===0?null:(Dp(t,l,i),nh(t,Nt()),t.callbackNode!=null&&t.callbackNode===s?ih.bind(null,t):null)}function ah(t,i){if(Rr())return null;Dp(t,i,!0)}function Vb(){nx(function(){(Ke&6)!==0?Ut(ft,zb):th()})}function Mu(){if(Wi===0){var t=is;t===0&&(t=We,We<<=1,(We&261888)===0&&(We=256)),Wi=t}return Wi}function sh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:$o(""+t)}function oh(t,i){var s=i.ownerDocument.createElement("input");return s.name=i.name,s.value=i.value,t.id&&s.setAttribute("form",t.id),i.parentNode.insertBefore(s,i),t=new FormData(t),s.parentNode.removeChild(s),t}function Yb(t,i,s,l,u){if(i==="submit"&&s&&s.stateNode===u){var p=sh((u[cn]||null).action),v=l.submitter;v&&(i=(i=v[cn]||null)?sh(i.formAction):v.getAttribute("formAction"),i!==null&&(p=i,v=null));var M=new Ko("action","action",null,l,u);t.push({event:M,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Wi!==0){var L=v?oh(u,v):new FormData(u);Fc(s,{pending:!0,data:L,method:u.method,action:p},null,L)}}else typeof p=="function"&&(M.preventDefault(),L=v?oh(u,v):new FormData(u),Fc(s,{pending:!0,data:L,method:u.method,action:p},p,L))},currentTarget:u}]})}}for(var Ou=0;Ou<uc.length;Ou++){var Cu=uc[Ou],Kb=Cu.toLowerCase(),Fb=Cu[0].toUpperCase()+Cu.slice(1);zn(Kb,"on"+Fb)}zn(jf,"onAnimationEnd"),zn(Df,"onAnimationIteration"),zn(Pf,"onAnimationStart"),zn("dblclick","onDoubleClick"),zn("focusin","onFocus"),zn("focusout","onBlur"),zn(cb,"onTransitionRun"),zn(ub,"onTransitionStart"),zn(db,"onTransitionCancel"),zn(Uf,"onTransitionEnd"),za("onMouseEnter",["mouseout","mouseover"]),za("onMouseLeave",["mouseout","mouseover"]),za("onPointerEnter",["pointerout","pointerover"]),za("onPointerLeave",["pointerout","pointerover"]),da("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),da("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),da("onBeforeInput",["compositionend","keypress","textInput","paste"]),da("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),da("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),da("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(fo));function rh(t,i){i=(i&4)!==0;for(var s=0;s<t.length;s++){var l=t[s],u=l.event;l=l.listeners;e:{var p=void 0;if(i)for(var v=l.length-1;0<=v;v--){var M=l[v],L=M.instance,K=M.currentTarget;if(M=M.listener,L!==p&&u.isPropagationStopped())break e;p=M,u.currentTarget=K;try{p(u)}catch(ie){Wo(ie)}u.currentTarget=null,p=L}else for(v=0;v<l.length;v++){if(M=l[v],L=M.instance,K=M.currentTarget,M=M.listener,L!==p&&u.isPropagationStopped())break e;p=M,u.currentTarget=K;try{p(u)}catch(ie){Wo(ie)}u.currentTarget=null,p=L}}}}function He(t,i){var s=i[$l];s===void 0&&(s=i[$l]=new Set);var l=t+"__bubble";s.has(l)||(lh(i,t,2,!1),s.add(l))}function ku(t,i,s){var l=0;i&&(l|=4),lh(s,t,l,i)}var Hr="_reactListening"+Math.random().toString(36).slice(2);function Nu(t){if(!t[Hr]){t[Hr]=!0,ef.forEach(function(s){s!=="selectionchange"&&(Xb.has(s)||ku(s,!1,t),ku(s,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Hr]||(i[Hr]=!0,ku("selectionchange",!1,i))}}function lh(t,i,s,l){switch(jh(i)){case 2:var u=Ax;break;case 8:u=Tx;break;default:u=Ku}s=u.bind(null,i,s,t),u=void 0,!Jl||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(u=!0),l?u!==void 0?t.addEventListener(i,s,{capture:!0,passive:u}):t.addEventListener(i,s,!0):u!==void 0?t.addEventListener(i,s,{passive:u}):t.addEventListener(i,s,!1)}function Ru(t,i,s,l,u){var p=l;if((i&1)===0&&(i&2)===0&&l!==null)e:for(;;){if(l===null)return;var v=l.tag;if(v===3||v===4){var M=l.stateNode.containerInfo;if(M===u)break;if(v===4)for(v=l.return;v!==null;){var L=v.tag;if((L===3||L===4)&&v.stateNode.containerInfo===u)return;v=v.return}for(;M!==null;){if(v=Ua(M),v===null)return;if(L=v.tag,L===5||L===6||L===26||L===27){l=p=v;continue e}M=M.parentNode}}l=l.return}mf(function(){var K=p,ie=Wl(s),oe=[];e:{var J=qf.get(t);if(J!==void 0){var te=Ko,pe=t;switch(t){case"keypress":if(Vo(s)===0)break e;case"keydown":case"keyup":te=q0;break;case"focusin":pe="focus",te=tc;break;case"focusout":pe="blur",te=tc;break;case"beforeblur":case"afterblur":te=tc;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":te=yf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":te=C0;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":te=V0;break;case jf:case Df:case Pf:te=R0;break;case Uf:te=K0;break;case"scroll":case"scrollend":te=M0;break;case"wheel":te=X0;break;case"copy":case"cut":case"paste":te=L0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":te=bf;break;case"toggle":case"beforetoggle":te=G0}var Se=(i&4)!==0,it=!Se&&(t==="scroll"||t==="scrollend"),U=Se?J!==null?J+"Capture":null:J;Se=[];for(var j=K,V;j!==null;){var ae=j;if(V=ae.stateNode,ae=ae.tag,ae!==5&&ae!==26&&ae!==27||V===null||U===null||(ae=Is(j,U),ae!=null&&Se.push(mo(j,ae,V))),it)break;j=j.return}0<Se.length&&(J=new te(J,pe,null,s,ie),oe.push({event:J,listeners:Se}))}}if((i&7)===0){e:{if(J=t==="mouseover"||t==="pointerover",te=t==="mouseout"||t==="pointerout",J&&s!==Xl&&(pe=s.relatedTarget||s.fromElement)&&(Ua(pe)||pe[Pa]))break e;if((te||J)&&(J=ie.window===ie?ie:(J=ie.ownerDocument)?J.defaultView||J.parentWindow:window,te?(pe=s.relatedTarget||s.toElement,te=K,pe=pe?Ua(pe):null,pe!==null&&(it=c(pe),Se=pe.tag,pe!==it||Se!==5&&Se!==27&&Se!==6)&&(pe=null)):(te=null,pe=K),te!==pe)){if(Se=yf,ae="onMouseLeave",U="onMouseEnter",j="mouse",(t==="pointerout"||t==="pointerover")&&(Se=bf,ae="onPointerLeave",U="onPointerEnter",j="pointer"),it=te==null?J:Rs(te),V=pe==null?J:Rs(pe),J=new Se(ae,j+"leave",te,s,ie),J.target=it,J.relatedTarget=V,ae=null,Ua(ie)===K&&(Se=new Se(U,j+"enter",pe,s,ie),Se.target=V,Se.relatedTarget=it,ae=Se),it=ae,te&&pe)t:{for(Se=Wb,U=te,j=pe,V=0,ae=U;ae;ae=Se(ae))V++;ae=0;for(var xe=j;xe;xe=Se(xe))ae++;for(;0<V-ae;)U=Se(U),V--;for(;0<ae-V;)j=Se(j),ae--;for(;V--;){if(U===j||j!==null&&U===j.alternate){Se=U;break t}U=Se(U),j=Se(j)}Se=null}else Se=null;te!==null&&ch(oe,J,te,Se,!1),pe!==null&&it!==null&&ch(oe,it,pe,Se,!0)}}e:{if(J=K?Rs(K):window,te=J.nodeName&&J.nodeName.toLowerCase(),te==="select"||te==="input"&&J.type==="file")var Ve=wf;else if(Ef(J))if(Mf)Ve=ob;else{Ve=ab;var ge=ib}else te=J.nodeName,!te||te.toLowerCase()!=="input"||J.type!=="checkbox"&&J.type!=="radio"?K&&Fl(K.elementType)&&(Ve=wf):Ve=sb;if(Ve&&(Ve=Ve(t,K))){_f(oe,Ve,s,ie);break e}ge&&ge(t,J,K),t==="focusout"&&K&&J.type==="number"&&K.memoizedProps.value!=null&&Kl(J,"number",J.value)}switch(ge=K?Rs(K):window,t){case"focusin":(Ef(ge)||ge.contentEditable==="true")&&(Wa=ge,rc=K,qs=null);break;case"focusout":qs=rc=Wa=null;break;case"mousedown":lc=!0;break;case"contextmenu":case"mouseup":case"dragend":lc=!1,Hf(oe,s,ie);break;case"selectionchange":if(lb)break;case"keydown":case"keyup":Hf(oe,s,ie)}var Oe;if(ic)e:{switch(t){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else Xa?Af(t,s)&&(je="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(je="onCompositionStart");je&&(xf&&s.locale!=="ko"&&(Xa||je!=="onCompositionStart"?je==="onCompositionEnd"&&Xa&&(Oe=pf()):(Ii=ie,Ql="value"in Ii?Ii.value:Ii.textContent,Xa=!0)),ge=Br(K,je),0<ge.length&&(je=new gf(je,t,null,s,ie),oe.push({event:je,listeners:ge}),Oe?je.data=Oe:(Oe=Tf(s),Oe!==null&&(je.data=Oe)))),(Oe=Q0?Z0(t,s):eb(t,s))&&(je=Br(K,"onBeforeInput"),0<je.length&&(ge=new gf("onBeforeInput","beforeinput",null,s,ie),oe.push({event:ge,listeners:je}),ge.data=Oe)),Yb(oe,t,K,s,ie)}rh(oe,i)})}function mo(t,i,s){return{instance:t,listener:i,currentTarget:s}}function Br(t,i){for(var s=i+"Capture",l=[];t!==null;){var u=t,p=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||p===null||(u=Is(t,s),u!=null&&l.unshift(mo(t,u,p)),u=Is(t,i),u!=null&&l.push(mo(t,u,p))),t.tag===3)return l;t=t.return}return[]}function Wb(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function ch(t,i,s,l,u){for(var p=i._reactName,v=[];s!==null&&s!==l;){var M=s,L=M.alternate,K=M.stateNode;if(M=M.tag,L!==null&&L===l)break;M!==5&&M!==26&&M!==27||K===null||(L=K,u?(K=Is(s,p),K!=null&&v.unshift(mo(s,K,L))):u||(K=Is(s,p),K!=null&&v.push(mo(s,K,L)))),s=s.return}v.length!==0&&t.push({event:i,listeners:v})}var Gb=/\r\n?/g,Jb=/\u0000|\uFFFD/g;function uh(t){return(typeof t=="string"?t:""+t).replace(Gb,`
`).replace(Jb,"")}function dh(t,i){return i=uh(i),uh(t)===i}function nt(t,i,s,l,u,p){switch(s){case"children":typeof l=="string"?i==="body"||i==="textarea"&&l===""||Ya(t,l):(typeof l=="number"||typeof l=="bigint")&&i!=="body"&&Ya(t,""+l);break;case"className":Uo(t,"class",l);break;case"tabIndex":Uo(t,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Uo(t,s,l);break;case"style":df(t,l,p);break;case"data":if(i!=="object"){Uo(t,"data",l);break}case"src":case"href":if(l===""&&(i!=="a"||s!=="href")){t.removeAttribute(s);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(s);break}l=$o(""+l),t.setAttribute(s,l);break;case"action":case"formAction":if(typeof l=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof p=="function"&&(s==="formAction"?(i!=="input"&&nt(t,i,"name",u.name,u,null),nt(t,i,"formEncType",u.formEncType,u,null),nt(t,i,"formMethod",u.formMethod,u,null),nt(t,i,"formTarget",u.formTarget,u,null)):(nt(t,i,"encType",u.encType,u,null),nt(t,i,"method",u.method,u,null),nt(t,i,"target",u.target,u,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(s);break}l=$o(""+l),t.setAttribute(s,l);break;case"onClick":l!=null&&(t.onclick=ci);break;case"onScroll":l!=null&&He("scroll",t);break;case"onScrollEnd":l!=null&&He("scrollend",t);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));t.innerHTML=s}}break;case"multiple":t.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":t.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){t.removeAttribute("xlink:href");break}s=$o(""+l),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(s,""+l):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":l===!0?t.setAttribute(s,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(s,l):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?t.setAttribute(s,l):t.removeAttribute(s);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?t.removeAttribute(s):t.setAttribute(s,l);break;case"popover":He("beforetoggle",t),He("toggle",t),Po(t,"popover",l);break;case"xlinkActuate":li(t,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":li(t,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":li(t,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":li(t,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":li(t,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":li(t,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":li(t,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":li(t,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":li(t,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":Po(t,"is",l);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=_0.get(s)||s,Po(t,s,l))}}function Iu(t,i,s,l,u,p){switch(s){case"style":df(t,l,p);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));t.innerHTML=s}}break;case"children":typeof l=="string"?Ya(t,l):(typeof l=="number"||typeof l=="bigint")&&Ya(t,""+l);break;case"onScroll":l!=null&&He("scroll",t);break;case"onScrollEnd":l!=null&&He("scrollend",t);break;case"onClick":l!=null&&(t.onclick=ci);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!tf.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(u=s.endsWith("Capture"),i=s.slice(2,u?s.length-7:void 0),p=t[cn]||null,p=p!=null?p[s]:null,typeof p=="function"&&t.removeEventListener(i,p,u),typeof l=="function")){typeof p!="function"&&p!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(i,l,u);break e}s in t?t[s]=l:l===!0?t.setAttribute(s,""):Po(t,s,l)}}}function Zt(t,i,s){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":He("error",t),He("load",t);var l=!1,u=!1,p;for(p in s)if(s.hasOwnProperty(p)){var v=s[p];if(v!=null)switch(p){case"src":l=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,i));default:nt(t,i,p,v,s,null)}}u&&nt(t,i,"srcSet",s.srcSet,s,null),l&&nt(t,i,"src",s.src,s,null);return;case"input":He("invalid",t);var M=p=v=u=null,L=null,K=null;for(l in s)if(s.hasOwnProperty(l)){var ie=s[l];if(ie!=null)switch(l){case"name":u=ie;break;case"type":v=ie;break;case"checked":L=ie;break;case"defaultChecked":K=ie;break;case"value":p=ie;break;case"defaultValue":M=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(o(137,i));break;default:nt(t,i,l,ie,s,null)}}rf(t,p,M,L,K,v,u,!1);return;case"select":He("invalid",t),l=v=p=null;for(u in s)if(s.hasOwnProperty(u)&&(M=s[u],M!=null))switch(u){case"value":p=M;break;case"defaultValue":v=M;break;case"multiple":l=M;default:nt(t,i,u,M,s,null)}i=p,s=v,t.multiple=!!l,i!=null?Va(t,!!l,i,!1):s!=null&&Va(t,!!l,s,!0);return;case"textarea":He("invalid",t),p=u=l=null;for(v in s)if(s.hasOwnProperty(v)&&(M=s[v],M!=null))switch(v){case"value":l=M;break;case"defaultValue":u=M;break;case"children":p=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(o(91));break;default:nt(t,i,v,M,s,null)}cf(t,l,u,p);return;case"option":for(L in s)s.hasOwnProperty(L)&&(l=s[L],l!=null)&&(L==="selected"?t.selected=l&&typeof l!="function"&&typeof l!="symbol":nt(t,i,L,l,s,null));return;case"dialog":He("beforetoggle",t),He("toggle",t),He("cancel",t),He("close",t);break;case"iframe":case"object":He("load",t);break;case"video":case"audio":for(l=0;l<fo.length;l++)He(fo[l],t);break;case"image":He("error",t),He("load",t);break;case"details":He("toggle",t);break;case"embed":case"source":case"link":He("error",t),He("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(K in s)if(s.hasOwnProperty(K)&&(l=s[K],l!=null))switch(K){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,i));default:nt(t,i,K,l,s,null)}return;default:if(Fl(i)){for(ie in s)s.hasOwnProperty(ie)&&(l=s[ie],l!==void 0&&Iu(t,i,ie,l,s,void 0));return}}for(M in s)s.hasOwnProperty(M)&&(l=s[M],l!=null&&nt(t,i,M,l,s,null))}function Qb(t,i,s,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,p=null,v=null,M=null,L=null,K=null,ie=null;for(te in s){var oe=s[te];if(s.hasOwnProperty(te)&&oe!=null)switch(te){case"checked":break;case"value":break;case"defaultValue":L=oe;default:l.hasOwnProperty(te)||nt(t,i,te,null,l,oe)}}for(var J in l){var te=l[J];if(oe=s[J],l.hasOwnProperty(J)&&(te!=null||oe!=null))switch(J){case"type":p=te;break;case"name":u=te;break;case"checked":K=te;break;case"defaultChecked":ie=te;break;case"value":v=te;break;case"defaultValue":M=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(o(137,i));break;default:te!==oe&&nt(t,i,J,te,l,oe)}}Yl(t,v,M,L,K,ie,p,u);return;case"select":te=v=M=J=null;for(p in s)if(L=s[p],s.hasOwnProperty(p)&&L!=null)switch(p){case"value":break;case"multiple":te=L;default:l.hasOwnProperty(p)||nt(t,i,p,null,l,L)}for(u in l)if(p=l[u],L=s[u],l.hasOwnProperty(u)&&(p!=null||L!=null))switch(u){case"value":J=p;break;case"defaultValue":M=p;break;case"multiple":v=p;default:p!==L&&nt(t,i,u,p,l,L)}i=M,s=v,l=te,J!=null?Va(t,!!s,J,!1):!!l!=!!s&&(i!=null?Va(t,!!s,i,!0):Va(t,!!s,s?[]:"",!1));return;case"textarea":te=J=null;for(M in s)if(u=s[M],s.hasOwnProperty(M)&&u!=null&&!l.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:nt(t,i,M,null,l,u)}for(v in l)if(u=l[v],p=s[v],l.hasOwnProperty(v)&&(u!=null||p!=null))switch(v){case"value":J=u;break;case"defaultValue":te=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(o(91));break;default:u!==p&&nt(t,i,v,u,l,p)}lf(t,J,te);return;case"option":for(var pe in s)J=s[pe],s.hasOwnProperty(pe)&&J!=null&&!l.hasOwnProperty(pe)&&(pe==="selected"?t.selected=!1:nt(t,i,pe,null,l,J));for(L in l)J=l[L],te=s[L],l.hasOwnProperty(L)&&J!==te&&(J!=null||te!=null)&&(L==="selected"?t.selected=J&&typeof J!="function"&&typeof J!="symbol":nt(t,i,L,J,l,te));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Se in s)J=s[Se],s.hasOwnProperty(Se)&&J!=null&&!l.hasOwnProperty(Se)&&nt(t,i,Se,null,l,J);for(K in l)if(J=l[K],te=s[K],l.hasOwnProperty(K)&&J!==te&&(J!=null||te!=null))switch(K){case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(o(137,i));break;default:nt(t,i,K,J,l,te)}return;default:if(Fl(i)){for(var it in s)J=s[it],s.hasOwnProperty(it)&&J!==void 0&&!l.hasOwnProperty(it)&&Iu(t,i,it,void 0,l,J);for(ie in l)J=l[ie],te=s[ie],!l.hasOwnProperty(ie)||J===te||J===void 0&&te===void 0||Iu(t,i,ie,J,l,te);return}}for(var U in s)J=s[U],s.hasOwnProperty(U)&&J!=null&&!l.hasOwnProperty(U)&&nt(t,i,U,null,l,J);for(oe in l)J=l[oe],te=s[oe],!l.hasOwnProperty(oe)||J===te||J==null&&te==null||nt(t,i,oe,J,l,te)}function fh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Zb(){if(typeof performance.getEntriesByType=="function"){for(var t=0,i=0,s=performance.getEntriesByType("resource"),l=0;l<s.length;l++){var u=s[l],p=u.transferSize,v=u.initiatorType,M=u.duration;if(p&&M&&fh(v)){for(v=0,M=u.responseEnd,l+=1;l<s.length;l++){var L=s[l],K=L.startTime;if(K>M)break;var ie=L.transferSize,oe=L.initiatorType;ie&&fh(oe)&&(L=L.responseEnd,v+=ie*(L<M?1:(M-K)/(L-K)))}if(--l,i+=8*(p+v)/(u.duration/1e3),t++,10<t)break}}if(0<t)return i/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Lu=null,Hu=null;function jr(t){return t.nodeType===9?t:t.ownerDocument}function mh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ph(t,i){if(t===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&i==="foreignObject"?0:t}function Bu(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var ju=null;function ex(){var t=window.event;return t&&t.type==="popstate"?t===ju?!1:(ju=t,!0):(ju=null,!1)}var hh=typeof setTimeout=="function"?setTimeout:void 0,tx=typeof clearTimeout=="function"?clearTimeout:void 0,yh=typeof Promise=="function"?Promise:void 0,nx=typeof queueMicrotask=="function"?queueMicrotask:typeof yh<"u"?function(t){return yh.resolve(null).then(t).catch(ix)}:hh;function ix(t){setTimeout(function(){throw t})}function Gi(t){return t==="head"}function gh(t,i){var s=i,l=0;do{var u=s.nextSibling;if(t.removeChild(s),u&&u.nodeType===8)if(s=u.data,s==="/$"||s==="/&"){if(l===0){t.removeChild(u),As(i);return}l--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")l++;else if(s==="html")po(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,po(s);for(var p=s.firstChild;p;){var v=p.nextSibling,M=p.nodeName;p[Ns]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&p.rel.toLowerCase()==="stylesheet"||s.removeChild(p),p=v}}else s==="body"&&po(t.ownerDocument.body);s=u}while(s);As(i)}function bh(t,i){var s=t;t=0;do{var l=s.nextSibling;if(s.nodeType===1?i?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(i?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),l&&l.nodeType===8)if(s=l.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=l}while(s)}function Du(t){var i=t.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var s=i;switch(i=i.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Du(s),zl(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function ax(t,i,s,l){for(;t.nodeType===1;){var u=s;if(t.nodeName.toLowerCase()!==i.toLowerCase()){if(!l&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(l){if(!t[Ns])switch(i){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(p=t.getAttribute("rel"),p==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(p!==u.rel||t.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||t.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||t.getAttribute("title")!==(u.title==null?null:u.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(p=t.getAttribute("src"),(p!==(u.src==null?null:u.src)||t.getAttribute("type")!==(u.type==null?null:u.type)||t.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&p&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(i==="input"&&t.type==="hidden"){var p=u.name==null?null:""+u.name;if(u.type==="hidden"&&t.getAttribute("name")===p)return t}else return t;if(t=Bn(t.nextSibling),t===null)break}return null}function sx(t,i,s){if(i==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=Bn(t.nextSibling),t===null))return null;return t}function xh(t,i){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!i||(t=Bn(t.nextSibling),t===null))return null;return t}function Pu(t){return t.data==="$?"||t.data==="$~"}function Uu(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function ox(t,i){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=i;else if(t.data!=="$?"||s.readyState!=="loading")i();else{var l=function(){i(),s.removeEventListener("DOMContentLoaded",l)};s.addEventListener("DOMContentLoaded",l),t._reactRetry=l}}function Bn(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return t}var qu=null;function vh(t){t=t.nextSibling;for(var i=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(i===0)return Bn(t.nextSibling);i--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||i++}t=t.nextSibling}return null}function Sh(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(i===0)return t;i--}else s!=="/$"&&s!=="/&"||i++}t=t.previousSibling}return null}function Ah(t,i,s){switch(i=jr(s),t){case"html":if(t=i.documentElement,!t)throw Error(o(452));return t;case"head":if(t=i.head,!t)throw Error(o(453));return t;case"body":if(t=i.body,!t)throw Error(o(454));return t;default:throw Error(o(451))}}function po(t){for(var i=t.attributes;i.length;)t.removeAttributeNode(i[0]);zl(t)}var jn=new Map,Th=new Set;function Dr(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var _i=$.d;$.d={f:rx,r:lx,D:cx,C:ux,L:dx,m:fx,X:px,S:mx,M:hx};function rx(){var t=_i.f(),i=Cr();return t||i}function lx(t){var i=qa(t);i!==null&&i.tag===5&&i.type==="form"?Um(i):_i.r(t)}var xs=typeof document>"u"?null:document;function Eh(t,i,s){var l=xs;if(l&&typeof i=="string"&&i){var u=Cn(i);u='link[rel="'+t+'"][href="'+u+'"]',typeof s=="string"&&(u+='[crossorigin="'+s+'"]'),Th.has(u)||(Th.add(u),t={rel:t,crossOrigin:s,href:i},l.querySelector(u)===null&&(i=l.createElement("link"),Zt(i,"link",t),Kt(i),l.head.appendChild(i)))}}function cx(t){_i.D(t),Eh("dns-prefetch",t,null)}function ux(t,i){_i.C(t,i),Eh("preconnect",t,i)}function dx(t,i,s){_i.L(t,i,s);var l=xs;if(l&&t&&i){var u='link[rel="preload"][as="'+Cn(i)+'"]';i==="image"&&s&&s.imageSrcSet?(u+='[imagesrcset="'+Cn(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(u+='[imagesizes="'+Cn(s.imageSizes)+'"]')):u+='[href="'+Cn(t)+'"]';var p=u;switch(i){case"style":p=vs(t);break;case"script":p=Ss(t)}jn.has(p)||(t=b({rel:"preload",href:i==="image"&&s&&s.imageSrcSet?void 0:t,as:i},s),jn.set(p,t),l.querySelector(u)!==null||i==="style"&&l.querySelector(ho(p))||i==="script"&&l.querySelector(yo(p))||(i=l.createElement("link"),Zt(i,"link",t),Kt(i),l.head.appendChild(i)))}}function fx(t,i){_i.m(t,i);var s=xs;if(s&&t){var l=i&&typeof i.as=="string"?i.as:"script",u='link[rel="modulepreload"][as="'+Cn(l)+'"][href="'+Cn(t)+'"]',p=u;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":p=Ss(t)}if(!jn.has(p)&&(t=b({rel:"modulepreload",href:t},i),jn.set(p,t),s.querySelector(u)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(yo(p)))return}l=s.createElement("link"),Zt(l,"link",t),Kt(l),s.head.appendChild(l)}}}function mx(t,i,s){_i.S(t,i,s);var l=xs;if(l&&t){var u=$a(l).hoistableStyles,p=vs(t);i=i||"default";var v=u.get(p);if(!v){var M={loading:0,preload:null};if(v=l.querySelector(ho(p)))M.loading=5;else{t=b({rel:"stylesheet",href:t,"data-precedence":i},s),(s=jn.get(p))&&$u(t,s);var L=v=l.createElement("link");Kt(L),Zt(L,"link",t),L._p=new Promise(function(K,ie){L.onload=K,L.onerror=ie}),L.addEventListener("load",function(){M.loading|=1}),L.addEventListener("error",function(){M.loading|=2}),M.loading|=4,Pr(v,i,l)}v={type:"stylesheet",instance:v,count:1,state:M},u.set(p,v)}}}function px(t,i){_i.X(t,i);var s=xs;if(s&&t){var l=$a(s).hoistableScripts,u=Ss(t),p=l.get(u);p||(p=s.querySelector(yo(u)),p||(t=b({src:t,async:!0},i),(i=jn.get(u))&&zu(t,i),p=s.createElement("script"),Kt(p),Zt(p,"link",t),s.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},l.set(u,p))}}function hx(t,i){_i.M(t,i);var s=xs;if(s&&t){var l=$a(s).hoistableScripts,u=Ss(t),p=l.get(u);p||(p=s.querySelector(yo(u)),p||(t=b({src:t,async:!0,type:"module"},i),(i=jn.get(u))&&zu(t,i),p=s.createElement("script"),Kt(p),Zt(p,"link",t),s.head.appendChild(p)),p={type:"script",instance:p,count:1,state:null},l.set(u,p))}}function _h(t,i,s,l){var u=(u=ce.current)?Dr(u):null;if(!u)throw Error(o(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(i=vs(s.href),s=$a(u).hoistableStyles,l=s.get(i),l||(l={type:"style",instance:null,count:0,state:null},s.set(i,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=vs(s.href);var p=$a(u).hoistableStyles,v=p.get(t);if(v||(u=u.ownerDocument||u,v={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},p.set(t,v),(p=u.querySelector(ho(t)))&&!p._p&&(v.instance=p,v.state.loading=5),jn.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},jn.set(t,s),p||yx(u,t,s,v.state))),i&&l===null)throw Error(o(528,""));return v}if(i&&l!==null)throw Error(o(529,""));return null;case"script":return i=s.async,s=s.src,typeof s=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=Ss(s),s=$a(u).hoistableScripts,l=s.get(i),l||(l={type:"script",instance:null,count:0,state:null},s.set(i,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,t))}}function vs(t){return'href="'+Cn(t)+'"'}function ho(t){return'link[rel="stylesheet"]['+t+"]"}function wh(t){return b({},t,{"data-precedence":t.precedence,precedence:null})}function yx(t,i,s,l){t.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=t.createElement("link"),l.preload=i,i.addEventListener("load",function(){return l.loading|=1}),i.addEventListener("error",function(){return l.loading|=2}),Zt(i,"link",s),Kt(i),t.head.appendChild(i))}function Ss(t){return'[src="'+Cn(t)+'"]'}function yo(t){return"script[async]"+t}function Mh(t,i,s){if(i.count++,i.instance===null)switch(i.type){case"style":var l=t.querySelector('style[data-href~="'+Cn(s.href)+'"]');if(l)return i.instance=l,Kt(l),l;var u=b({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return l=(t.ownerDocument||t).createElement("style"),Kt(l),Zt(l,"style",u),Pr(l,s.precedence,t),i.instance=l;case"stylesheet":u=vs(s.href);var p=t.querySelector(ho(u));if(p)return i.state.loading|=4,i.instance=p,Kt(p),p;l=wh(s),(u=jn.get(u))&&$u(l,u),p=(t.ownerDocument||t).createElement("link"),Kt(p);var v=p;return v._p=new Promise(function(M,L){v.onload=M,v.onerror=L}),Zt(p,"link",l),i.state.loading|=4,Pr(p,s.precedence,t),i.instance=p;case"script":return p=Ss(s.src),(u=t.querySelector(yo(p)))?(i.instance=u,Kt(u),u):(l=s,(u=jn.get(p))&&(l=b({},s),zu(l,u)),t=t.ownerDocument||t,u=t.createElement("script"),Kt(u),Zt(u,"link",l),t.head.appendChild(u),i.instance=u);case"void":return null;default:throw Error(o(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(l=i.instance,i.state.loading|=4,Pr(l,s.precedence,t));return i.instance}function Pr(t,i,s){for(var l=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=l.length?l[l.length-1]:null,p=u,v=0;v<l.length;v++){var M=l[v];if(M.dataset.precedence===i)p=M;else if(p!==u)break}p?p.parentNode.insertBefore(t,p.nextSibling):(i=s.nodeType===9?s.head:s,i.insertBefore(t,i.firstChild))}function $u(t,i){t.crossOrigin==null&&(t.crossOrigin=i.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=i.referrerPolicy),t.title==null&&(t.title=i.title)}function zu(t,i){t.crossOrigin==null&&(t.crossOrigin=i.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=i.referrerPolicy),t.integrity==null&&(t.integrity=i.integrity)}var Ur=null;function Oh(t,i,s){if(Ur===null){var l=new Map,u=Ur=new Map;u.set(s,l)}else u=Ur,l=u.get(s),l||(l=new Map,u.set(s,l));if(l.has(t))return l;for(l.set(t,null),s=s.getElementsByTagName(t),u=0;u<s.length;u++){var p=s[u];if(!(p[Ns]||p[Wt]||t==="link"&&p.getAttribute("rel")==="stylesheet")&&p.namespaceURI!=="http://www.w3.org/2000/svg"){var v=p.getAttribute(i)||"";v=t+v;var M=l.get(v);M?M.push(p):l.set(v,[p])}}return l}function Ch(t,i,s){t=t.ownerDocument||t,t.head.insertBefore(s,i==="title"?t.querySelector("head > title"):null)}function gx(t,i,s){if(s===1||i.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;return i.rel==="stylesheet"?(t=i.disabled,typeof i.precedence=="string"&&t==null):!0;case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function kh(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function bx(t,i,s,l){if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var u=vs(l.href),p=i.querySelector(ho(u));if(p){i=p._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(t.count++,t=qr.bind(t),i.then(t,t)),s.state.loading|=4,s.instance=p,Kt(p);return}p=i.ownerDocument||i,l=wh(l),(u=jn.get(u))&&$u(l,u),p=p.createElement("link"),Kt(p);var v=p;v._p=new Promise(function(M,L){v.onload=M,v.onerror=L}),Zt(p,"link",l),s.instance=p}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=qr.bind(t),i.addEventListener("load",s),i.addEventListener("error",s))}}var Vu=0;function xx(t,i){return t.stylesheets&&t.count===0&&zr(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var l=setTimeout(function(){if(t.stylesheets&&zr(t,t.stylesheets),t.unsuspend){var p=t.unsuspend;t.unsuspend=null,p()}},6e4+i);0<t.imgBytes&&Vu===0&&(Vu=62500*Zb());var u=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&zr(t,t.stylesheets),t.unsuspend)){var p=t.unsuspend;t.unsuspend=null,p()}},(t.imgBytes>Vu?50:800)+i);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(l),clearTimeout(u)}}:null}function qr(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)zr(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var $r=null;function zr(t,i){t.stylesheets=null,t.unsuspend!==null&&(t.count++,$r=new Map,i.forEach(vx,t),$r=null,qr.call(t))}function vx(t,i){if(!(i.state.loading&4)){var s=$r.get(t);if(s)var l=s.get(null);else{s=new Map,$r.set(t,s);for(var u=t.querySelectorAll("link[data-precedence],style[data-precedence]"),p=0;p<u.length;p++){var v=u[p];(v.nodeName==="LINK"||v.getAttribute("media")!=="not all")&&(s.set(v.dataset.precedence,v),l=v)}l&&s.set(null,l)}u=i.instance,v=u.getAttribute("data-precedence"),p=s.get(v)||l,p===l&&s.set(null,u),s.set(v,u),this.count++,l=qr.bind(this),u.addEventListener("load",l),u.addEventListener("error",l),p?p.parentNode.insertBefore(u,p.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(u,t.firstChild)),i.state.loading|=4}}var go={$$typeof:w,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function Sx(t,i,s,l,u,p,v,M,L){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ei(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ei(0),this.hiddenUpdates=ei(null),this.identifierPrefix=l,this.onUncaughtError=u,this.onCaughtError=p,this.onRecoverableError=v,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function Nh(t,i,s,l,u,p,v,M,L,K,ie,oe){return t=new Sx(t,i,s,v,L,K,ie,oe,M),i=1,p===!0&&(i|=24),p=vn(3,null,null,i),t.current=p,p.stateNode=t,i=Tc(),i.refCount++,t.pooledCache=i,i.refCount++,p.memoizedState={element:l,isDehydrated:s,cache:i},Mc(p),t}function Rh(t){return t?(t=Qa,t):Qa}function Ih(t,i,s,l,u,p){u=Rh(u),l.context===null?l.context=u:l.pendingContext=u,l=Pi(i),l.payload={element:s},p=p===void 0?null:p,p!==null&&(l.callback=p),s=Ui(t,l,i),s!==null&&(hn(s,t,i),Xs(s,t,i))}function Lh(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<i?s:i}}function Yu(t,i){Lh(t,i),(t=t.alternate)&&Lh(t,i)}function Hh(t){if(t.tag===13||t.tag===31){var i=ha(t,67108864);i!==null&&hn(i,t,67108864),Yu(t,67108864)}}function Bh(t){if(t.tag===13||t.tag===31){var i=_n();i=Cs(i);var s=ha(t,i);s!==null&&hn(s,t,i),Yu(t,i)}}var Vr=!0;function Ax(t,i,s,l){var u=B.T;B.T=null;var p=$.p;try{$.p=2,Ku(t,i,s,l)}finally{$.p=p,B.T=u}}function Tx(t,i,s,l){var u=B.T;B.T=null;var p=$.p;try{$.p=8,Ku(t,i,s,l)}finally{$.p=p,B.T=u}}function Ku(t,i,s,l){if(Vr){var u=Fu(l);if(u===null)Ru(t,i,l,Yr,s),Dh(t,l);else if(_x(u,t,i,s,l))l.stopPropagation();else if(Dh(t,l),i&4&&-1<Ex.indexOf(t)){for(;u!==null;){var p=qa(u);if(p!==null)switch(p.tag){case 3:if(p=p.stateNode,p.current.memoizedState.isDehydrated){var v=$t(p.pendingLanes);if(v!==0){var M=p;for(M.pendingLanes|=2,M.entangledLanes|=2;v;){var L=1<<31-st(v);M.entanglements[1]|=L,v&=~L}si(p),(Ke&6)===0&&(Mr=Nt()+500,uo(0))}}break;case 31:case 13:M=ha(p,2),M!==null&&hn(M,p,2),Cr(),Yu(p,2)}if(p=Fu(l),p===null&&Ru(t,i,l,Yr,s),p===u)break;u=p}u!==null&&l.stopPropagation()}else Ru(t,i,l,null,s)}}function Fu(t){return t=Wl(t),Xu(t)}var Yr=null;function Xu(t){if(Yr=null,t=Ua(t),t!==null){var i=c(t);if(i===null)t=null;else{var s=i.tag;if(s===13){if(t=d(i),t!==null)return t;t=null}else if(s===31){if(t=h(i),t!==null)return t;t=null}else if(s===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null)}}return Yr=t,null}function jh(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Qn()){case ft:return 2;case St:return 8;case qt:case Zn:return 32;case yn:return 268435456;default:return 32}default:return 32}}var Wu=!1,Ji=null,Qi=null,Zi=null,bo=new Map,xo=new Map,ea=[],Ex="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dh(t,i){switch(t){case"focusin":case"focusout":Ji=null;break;case"dragenter":case"dragleave":Qi=null;break;case"mouseover":case"mouseout":Zi=null;break;case"pointerover":case"pointerout":bo.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":xo.delete(i.pointerId)}}function vo(t,i,s,l,u,p){return t===null||t.nativeEvent!==p?(t={blockedOn:i,domEventName:s,eventSystemFlags:l,nativeEvent:p,targetContainers:[u]},i!==null&&(i=qa(i),i!==null&&Hh(i)),t):(t.eventSystemFlags|=l,i=t.targetContainers,u!==null&&i.indexOf(u)===-1&&i.push(u),t)}function _x(t,i,s,l,u){switch(i){case"focusin":return Ji=vo(Ji,t,i,s,l,u),!0;case"dragenter":return Qi=vo(Qi,t,i,s,l,u),!0;case"mouseover":return Zi=vo(Zi,t,i,s,l,u),!0;case"pointerover":var p=u.pointerId;return bo.set(p,vo(bo.get(p)||null,t,i,s,l,u)),!0;case"gotpointercapture":return p=u.pointerId,xo.set(p,vo(xo.get(p)||null,t,i,s,l,u)),!0}return!1}function Ph(t){var i=Ua(t.target);if(i!==null){var s=c(i);if(s!==null){if(i=s.tag,i===13){if(i=d(s),i!==null){t.blockedOn=i,Qd(t.priority,function(){Bh(s)});return}}else if(i===31){if(i=h(s),i!==null){t.blockedOn=i,Qd(t.priority,function(){Bh(s)});return}}else if(i===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Kr(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var s=Fu(t.nativeEvent);if(s===null){s=t.nativeEvent;var l=new s.constructor(s.type,s);Xl=l,s.target.dispatchEvent(l),Xl=null}else return i=qa(s),i!==null&&Hh(i),t.blockedOn=s,!1;i.shift()}return!0}function Uh(t,i,s){Kr(t)&&s.delete(i)}function wx(){Wu=!1,Ji!==null&&Kr(Ji)&&(Ji=null),Qi!==null&&Kr(Qi)&&(Qi=null),Zi!==null&&Kr(Zi)&&(Zi=null),bo.forEach(Uh),xo.forEach(Uh)}function Fr(t,i){t.blockedOn===i&&(t.blockedOn=null,Wu||(Wu=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,wx)))}var Xr=null;function qh(t){Xr!==t&&(Xr=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Xr===t&&(Xr=null);for(var i=0;i<t.length;i+=3){var s=t[i],l=t[i+1],u=t[i+2];if(typeof l!="function"){if(Xu(l||s)===null)continue;break}var p=qa(s);p!==null&&(t.splice(i,3),i-=3,Fc(p,{pending:!0,data:u,method:s.method,action:l},l,u))}}))}function As(t){function i(L){return Fr(L,t)}Ji!==null&&Fr(Ji,t),Qi!==null&&Fr(Qi,t),Zi!==null&&Fr(Zi,t),bo.forEach(i),xo.forEach(i);for(var s=0;s<ea.length;s++){var l=ea[s];l.blockedOn===t&&(l.blockedOn=null)}for(;0<ea.length&&(s=ea[0],s.blockedOn===null);)Ph(s),s.blockedOn===null&&ea.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(l=0;l<s.length;l+=3){var u=s[l],p=s[l+1],v=u[cn]||null;if(typeof p=="function")v||qh(s);else if(v){var M=null;if(p&&p.hasAttribute("formAction")){if(u=p,v=p[cn]||null)M=v.formAction;else if(Xu(u)!==null)continue}else M=v.action;typeof M=="function"?s[l+1]=M:(s.splice(l,3),l-=3),qh(s)}}}function $h(){function t(p){p.canIntercept&&p.info==="react-transition"&&p.intercept({handler:function(){return new Promise(function(v){return u=v})},focusReset:"manual",scroll:"manual"})}function i(){u!==null&&(u(),u=null),l||setTimeout(s,20)}function s(){if(!l&&!navigation.transition){var p=navigation.currentEntry;p&&p.url!=null&&navigation.navigate(p.url,{state:p.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,u=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(s,100),function(){l=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),u!==null&&(u(),u=null)}}}function Gu(t){this._internalRoot=t}Wr.prototype.render=Gu.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(o(409));var s=i.current,l=_n();Ih(s,l,t,i,null,null)},Wr.prototype.unmount=Gu.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;Ih(t.current,2,null,t,null,null),Cr(),i[Pa]=null}};function Wr(t){this._internalRoot=t}Wr.prototype.unstable_scheduleHydration=function(t){if(t){var i=ks();t={blockedOn:null,target:t,priority:i};for(var s=0;s<ea.length&&i!==0&&i<ea[s].priority;s++);ea.splice(s,0,t),s===0&&Ph(t)}};var zh=n.version;if(zh!=="19.2.3")throw Error(o(527,zh,"19.2.3"));$.findDOMNode=function(t){var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(o(188)):(t=Object.keys(t).join(","),Error(o(268,t)));return t=m(i),t=t!==null?f(t):null,t=t===null?null:t.stateNode,t};var Mx={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:B,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gr.isDisabled&&Gr.supportsFiber)try{ln=Gr.inject(Mx),De=Gr}catch{}}return Ao.createRoot=function(t,i){if(!r(t))throw Error(o(299));var s=!1,l="",u=Gm,p=Jm,v=Qm;return i!=null&&(i.unstable_strictMode===!0&&(s=!0),i.identifierPrefix!==void 0&&(l=i.identifierPrefix),i.onUncaughtError!==void 0&&(u=i.onUncaughtError),i.onCaughtError!==void 0&&(p=i.onCaughtError),i.onRecoverableError!==void 0&&(v=i.onRecoverableError)),i=Nh(t,1,!1,null,null,s,l,null,u,p,v,$h),t[Pa]=i.current,Nu(t),new Gu(i)},Ao.hydrateRoot=function(t,i,s){if(!r(t))throw Error(o(299));var l=!1,u="",p=Gm,v=Jm,M=Qm,L=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(p=s.onUncaughtError),s.onCaughtError!==void 0&&(v=s.onCaughtError),s.onRecoverableError!==void 0&&(M=s.onRecoverableError),s.formState!==void 0&&(L=s.formState)),i=Nh(t,1,!0,i,s??null,l,u,L,p,v,M,$h),i.context=Rh(null),s=i.current,l=_n(),l=Cs(l),u=Pi(l),u.callback=null,Ui(s,u,l),s=l,i.current.lanes=s,$n(i,s),si(i),t[Pa]=i.current,Nu(t),new Wr(i)},Ao.version="19.2.3",Ao}var Zh;function Dx(){if(Zh)return Zu.exports;Zh=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Zu.exports=jx(),Zu.exports}var Px=Dx();const on=(e,n)=>({q:e,r:n,s:-e-n}),Ux=e=>`${e.q},${e.r}`,ue=Ux,se=(e,n)=>e.q===n.q&&e.r===n.r&&e.s===n.s,rn=(e,n)=>on(e.q+n.q,e.r+n.r),Ed=(e,n)=>on(e.q-n.q,e.r-n.r),be=(e,n)=>(Math.abs(e.q-n.q)+Math.abs(e.r-n.r)+Math.abs(e.s-n.s))/2,Ee=(e,n)=>{const a=n*(1.5*e.q),o=n*Math.sqrt(3)*(e.r+e.q/2);return{x:a,y:o}},ey=e=>({q:e.q,r:e.r,s:e.s??-e.q-e.r}),qx=e=>on(e.q,e.r),$x=e=>{let n=Math.round(e.q),a=Math.round(e.r),o=Math.round(e.s);const r=Math.abs(n-e.q),c=Math.abs(a-e.r),d=Math.abs(o-e.s);return r>c&&r>d?n=-a-o:c>d?a=-n-o:o=-n-a,{q:n,r:a,s:o}},Io=[on(1,0),on(1,-1),on(0,-1),on(-1,0),on(-1,1),on(0,1)],Xe=e=>Io.map(n=>rn(e,n)),Yt=e=>Io[(e%6+6)%6],id=(e,n,a)=>e+(n-e)*a,ht=(e,n)=>{const a=be(e,n),o=[],r=ey(e),c=ey(n);for(let d=0;d<=a;d++){const h=a===0?0:d/a,g={q:id(r.q+1e-6,c.q+1e-6,h),r:id(r.r+1e-6,c.r+1e-6,h),s:id(r.s+1e-6,c.s+1e-6,h)};o.push(qx($x(g)))}return o},Gn=(e,n)=>{const a=be(e,n);if(a===0)return-1;const o=Ed(n,e),r=o.q/a,c=o.r/a,d=(0-o.q-o.r)/a;return Io.findIndex(h=>Math.abs(h.q-r)<.01&&Math.abs(h.r-c)<.01&&Math.abs(h.s-d)<.01)};function Pd(e,n){const a=Yt(e);return{q:a.q*n,r:a.r*n,s:-(a.q*n)-a.r*n}}const jl=(e,n,a,o)=>{if(e<0||e>=a||n<0||n>=o)return!1;const r=e+n,c=Math.floor(a/2),d=a-1+(o-1)-c;return r>=c&&r<=d},zx=(e,n)=>{const a=[];for(let o=0;o<e;o++)for(let r=0;r<n;r++)jl(o,r,e,n)&&a.push(on(o,r));return a},la=(e,n,a)=>jl(e.q,e.r,n,a),_g={footman:{subtype:"footman",name:"Footman",stats:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:4,mind:0,instinct:0},skills:{base:["BASIC_MOVE","BASIC_ATTACK"],passive:["AUTO_ATTACK"]}},sprinter:{subtype:"sprinter",name:"Sprinter",stats:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,actionCooldown:1,weightClass:"Standard",speed:2},trinity:{body:2,mind:0,instinct:0},skills:{base:["BASIC_MOVE","BASIC_ATTACK"],passive:[]}},raider:{subtype:"raider",name:"Raider",stats:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,actionCooldown:1,weightClass:"Standard",speed:1},trinity:{body:2,mind:0,instinct:1},skills:{base:["BASIC_MOVE","BASIC_ATTACK","DASH"],passive:[]}},pouncer:{subtype:"pouncer",name:"Pouncer",stats:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,actionCooldown:1,weightClass:"Standard",speed:1},trinity:{body:2,mind:0,instinct:1},skills:{base:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],passive:[]}},shieldBearer:{subtype:"shieldBearer",name:"Shield Bearer",stats:{hp:2,maxHp:2,range:1,damage:1,type:"melee",cost:2,actionCooldown:2,weightClass:"Heavy",speed:1},trinity:{body:1,mind:0,instinct:.4},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],passive:[]}},archer:{subtype:"archer",name:"Archer",stats:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:1,actionCooldown:3,weightClass:"Standard",speed:1},trinity:{body:.2,mind:0,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","ARCHER_SHOT"],passive:[]}},bomber:{subtype:"bomber",name:"Bomber",stats:{hp:1,maxHp:1,range:3,damage:1,type:"ranged",cost:1,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:.4,mind:.2,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","BOMB_TOSS"],passive:[]}},warlock:{subtype:"warlock",name:"Warlock",stats:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:2,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:.4,mind:.6,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],passive:[]}},sentinel:{subtype:"sentinel",name:"Sentinel",stats:{hp:30,maxHp:30,range:4,damage:2,type:"boss",cost:25,actionCooldown:1,weightClass:"Heavy",speed:1},trinity:{body:4,mind:2,instinct:2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],passive:[]}}},wg=e=>_g[e],Vx=(e,n={})=>{const a=wg(e);return a?n.includePassive??!0?[...a.skills.base,...a.skills.passive]:[...a.skills.base]:[]},_l=7,wl=9,ee=36,ty={speed:1},Yx={stunned:{tickWindow:"START_OF_TURN"},poisoned:{tickWindow:"START_OF_TURN"},armored:{tickWindow:"END_OF_TURN"},hidden:{tickWindow:"END_OF_TURN"},time_bomb:{tickWindow:"END_OF_TURN"}},wi=e=>{const n=_g[e];return{hp:n.stats.hp,maxHp:n.stats.maxHp,range:n.stats.range,damage:n.stats.damage,type:n.stats.type,cost:n.stats.cost,skills:[...n.skills.base,...n.skills.passive],actionCooldown:n.stats.actionCooldown,weightClass:n.stats.weightClass,speed:n.stats.speed}},_d={footman:wi("footman"),sprinter:wi("sprinter"),raider:wi("raider"),pouncer:wi("pouncer"),shieldBearer:wi("shieldBearer"),archer:wi("archer"),bomber:wi("bomber"),warlock:wi("warlock"),sentinel:wi("sentinel")},Kx=.17,ny=[0,2,3,5,7,10,12,15,18,22,0],Jr={floor:"#6b7b3c",wall:"#374151",shrine:"#f97316",portal:"#ffffff"},Fx={1:"inferno",2:"inferno",3:"inferno",4:"inferno",5:"inferno",6:"inferno",7:"inferno",8:"inferno",9:"inferno",10:"inferno"},ad={1:["footman"],2:["footman","sprinter"],3:["footman","archer"],4:["footman","archer","bomber","raider"],5:["footman","archer","bomber","shieldBearer","raider"],6:["footman","archer","bomber","shieldBearer","warlock","pouncer"],7:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],8:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],9:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],10:[]},_s={GRASS:{id:"GRASS",name:"Grass",description:"Soft grass",defaultTraits:new Set(["WALKABLE","FLAMMABLE"]),visual:{color:"#4a7c59",icon:""}},STONE:{id:"STONE",name:"Stone Floor",description:"Hard stone",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#808080",icon:""}},LAVA:{id:"LAVA",name:"Lava",description:"Molten lava",defaultTraits:new Set(["LIQUID","HAZARDOUS"]),visual:{color:"#ff4400",icon:""}},WALL:{id:"WALL",name:"Wall",description:"Solid wall",defaultTraits:new Set(["BLOCKS_LOS","BLOCKS_MOVEMENT","ANCHOR"]),visual:{color:"#333333",icon:""}},ICE:{id:"ICE",name:"Ice",description:"Slippery ice",defaultTraits:new Set(["WALKABLE","SLIPPERY"]),visual:{color:"#aaddff",icon:""}},VOID:{id:"VOID",name:"Void",description:"The endless void",defaultTraits:new Set(["HAZARDOUS"]),visual:{color:"#000000",icon:""}},STAIRS:{id:"STAIRS",name:"Stairs",description:"Lead to the next floor",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#ffffff",icon:""}},SHRINE:{id:"SHRINE",name:"Shrine",description:"A place of power",defaultTraits:new Set(["WALKABLE","ANCHOR"]),visual:{color:"#ffd700",icon:""}},GATE:{id:"GATE",name:"Gate",description:"A heavy gate",defaultTraits:new Set(["BLOCKS_MOVEMENT","BLOCKS_LOS"]),visual:{color:"#444444",icon:""}},BRIDGE:{id:"BRIDGE",name:"Bridge",description:"Crossing the gap",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#8b4513",icon:""}}},Qr={FIRE:{id:"FIRE",name:"Fire",description:"Burning flames",onStay:e=>({effects:[{type:"Damage",target:e.actor.id,amount:1,reason:"fire_damage"}],messages:[`${e.actor.subtype||e.actor.type} burns!`]}),interactsWith:{WET:e=>({effects:[{type:"Juice",effect:"flash",target:e.tile.position,color:"#aaaaaa"}],messages:["Steam rises!"],modifyTile:{effects:e.tile.effects.filter(n=>n.id!=="FIRE"&&n.id!=="WET"&&n.id!=="STEAM").concat({id:"STEAM",duration:2,potency:1})}})}},WET:{id:"WET",name:"Wet",description:"Soaked with water",onApply:e=>e.tile.effects.some(a=>a.id==="FIRE")?{effects:[],messages:["Water extinguishes the flames!"],modifyTile:{effects:e.tile.effects.filter(a=>a.id!=="FIRE")}}:{effects:[],messages:[]}},OIL:{id:"OIL",name:"Oil",description:"Slippery oil",interactsWith:{FIRE:e=>({effects:[{type:"Damage",target:"area",amount:3,reason:"oil_explosion"},{type:"Juice",effect:"explosion_ring",target:e.tile.position}],messages:["Oil explodes!"],modifyTile:{effects:e.tile.effects.filter(n=>n.id!=="OIL")}})}},STEAM:{id:"STEAM",name:"Steam",description:"Obscuring steam cloud"},BLESSED:{id:"BLESSED",name:"Blessed",description:"Holy ground"},CURSED:{id:"CURSED",name:"Cursed",description:"Unholy ground"},ICE_WALL:{id:"ICE_WALL",name:"Ice Wall",description:"A wall of ice"},SMOKE:{id:"SMOKE",name:"Smoke",description:"Thick smoke"},BOMB_TICK:{id:"BOMB_TICK",name:"Bomb Tick",description:"About to explode"},TRI_TRAP:{id:"TRI_TRAP",name:"Kinetic Trap",description:"Hidden trap that flings non-flying units outward"},SNARE:{id:"SNARE",name:"Snare",description:"Entangling roots that halt movement and root the target.",onPass:e=>e.actor.isFlying?{effects:[],messages:[]}:{effects:[{type:"ApplyStatus",target:e.actor.id,status:"rooted",duration:2}],messages:["Snared! Movement halted."],interrupt:!0,newMomentum:0}}},Xx=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619)>>>0;return n>>>0},Wx=e=>function(){let n=(e+=1831565813)>>>0;return n=Math.imul(n^n>>>15,n|1)>>>0,n^=n+Math.imul(n^n>>>7,n|61)>>>0,((n^n>>>14)>>>0)/4294967296},Dl=e=>{const n=typeof e=="number"?e>>>0:Xx(String(e)),a=Wx(n||1);return{next:()=>a(),id:(o=9)=>{const r="abcdefghijklmnopqrstuvwxyz0123456789";let c="";for(let d=0;d<o;d++){const h=Math.floor(a()*r.length)%r.length;c+=r[h]}return c}}},ws=(e,n,a=9,o="")=>{const r=`${e}:${n}:${o}`,c=Dl(r),d="abcdefghijklmnopqrstuvwxyz0123456789";let h="";for(let g=0;g<a;g++){const m=Math.floor(c.next()*d.length)%d.length;h+=d[m]}return h},kl=(e,n)=>{const a=`${e}:${n}`;return Dl(a).next()},ka=e=>{const n=e.rngSeed||"default",a=e.rngCounter||0;return{value:kl(n,a),nextState:{...e,rngCounter:a+1}}},Ne={getTileAt(e,n){const a=ue(n);let o;return e.tiles&&(e.tiles instanceof Map?o=e.tiles.get(a):Array.isArray(e.tiles)?o=e.tiles.find(r=>Array.isArray(r)&&r[0]===a||r.position&&se(r.position,n)):o=e.tiles[a]),o||{position:n,baseId:"STONE",traits:new Set(["WALKABLE"]),effects:[]}},getTraitsForTile(e,n){const a=new Set,o=n.position;return la(o,e.gridWidth,e.gridHeight)?(n.baseId==="LAVA"&&(a.add("HAZARDOUS"),a.add("LIQUID"),a.add("LAVA")),n.baseId==="WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),n.traits.forEach(c=>a.add(c)),n.effects.forEach(c=>{c.id==="FIRE"&&(a.add("FIRE"),a.add("HAZARDOUS")),c.id==="ICE_WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),c.id==="SMOKE"&&a.add("BLOCKS_LOS")}),a):(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR"),a)},getTraitsAt(e,n){const a=this.getTileAt(e,n);return this.getTraitsForTile(e,a)},isPassable(e,n){const a=this.getTraitsAt(e,n);return!a.has("BLOCKS_MOVEMENT")&&!a.has("HAZARDOUS")},isWalkable(e,n){return!this.getTraitsAt(e,n).has("BLOCKS_MOVEMENT")},isLosBlocking(e,n){return this.getTraitsAt(e,n).has("BLOCKS_LOS")},isAnchorable(e,n){return this.getTraitsAt(e,n).has("ANCHOR")},hasTrait(e,n,a){return this.getTraitsAt(e,n).has(a)}},Gx=(e,n)=>Array(n).fill(0n),sd=(e,n,a)=>{if(!Number.isInteger(n.q)||!Number.isInteger(n.r))return[...e];if(n.r<0||n.r>=e.length||n.q<0)return[...e];const o=[...e];return o[n.r]|=1n<<BigInt(n.q),o},wd=(e,n)=>n.r<0||n.r>=e.length?!0:(e[n.r]&1n<<BigInt(n.q))!==0n,iy=(e,n)=>{if(n.playerStart&&se(e,n.playerStart)||n.stairsPosition&&se(e,n.stairsPosition)||n.shrinePosition&&se(e,n.shrinePosition))return!0;if(n.tiles){const a=Ne.getTraitsAt(n,e);if(a.has("HAZARDOUS")||a.has("BLOCKS_MOVEMENT"))return!0}return!1},Wn=(e,n)=>{if(e)return e.find(a=>a&&a.position&&se(a.position,n))},ye=(e,n)=>se(e.player.position,n)?e.player:Wn(e.enemies,n),Jx=(e,n)=>!!e.shrinePosition&&se(n,e.shrinePosition),Qx=(e,n)=>!(!se(n,e.stairsPosition)||e.enemies.some(o=>o.subtype==="sentinel"&&o.hp>0)),Zx=(e,n,a,o)=>{const r=be(a,o);if(r===0)return[];const c=(o.q-a.q)/r,d=(o.r-a.r)/r,h=(o.s-a.s)/r,g=[],m=new Set,f=2;for(let b=1;b<=f;b++){const x={q:o.q+Math.round(c*b),r:o.r+Math.round(d*b),s:o.s+Math.round(h*b)};if(la(x,e.gridWidth,e.gridHeight)){const T=`${x.q},${x.r}`;m.has(T)||(m.add(T),g.push(x))}}return g},od=(e,n,a)=>Math.max(n,Math.min(a,e)),To=e=>Math.round(e*1e3)/1e3,Ud=e=>{const n=Math.max(0,e.body),a=Math.max(0,e.mind),o=Math.max(0,e.instinct);return{bodyDamageMultiplier:To(1+n/20),bodyMitigation:To(od(n*.01,0,.5)),mindStatusDurationBonus:Math.floor(a/15),mindMagicMultiplier:To(1+a/20),instinctInitiativeBonus:o*2,instinctCriticalMultiplier:To(1+od(o,0,10)*.02),instinctSparkDiscountMultiplier:To(1-od(o,0,100)/100)}},Pl=e=>{const n=Math.max(0,e.body),a=Math.max(0,e.mind),o=Math.max(0,e.instinct),r={base:0,body:5,mind:2,instinct:3},c=Math.floor(n*r.body+a*r.mind+o*r.instinct+r.base);return Math.max(1,c)},Vt={body:0,mind:0,instinct:0},ev=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),Ts=e=>{const n={};for(const[a,o]of Object.entries(e))n[a]=ev(o);return n},tv={neutral:{id:"neutral",default:Vt,archetype:Ts({VANGUARD:Vt,SKIRMISHER:Vt,FIREMAGE:Vt,NECROMANCER:Vt,HUNTER:Vt,ASSASSIN:Vt}),enemySubtype:Ts({footman:Vt,sprinter:Vt,raider:Vt,pouncer:Vt,shieldBearer:Vt,archer:Vt,bomber:Vt,warlock:Vt,sentinel:Vt}),companionSubtype:Ts({falcon:Vt,skeleton:Vt})},live:{id:"live",default:Vt,archetype:Ts({VANGUARD:{body:9,mind:4,instinct:5},SKIRMISHER:{body:7,mind:6,instinct:10},FIREMAGE:{body:2,mind:9,instinct:4},NECROMANCER:{body:5,mind:9,instinct:5},HUNTER:{body:3,mind:4,instinct:8},ASSASSIN:{body:3,mind:3,instinct:9}}),enemySubtype:Ts({footman:{body:0,mind:0,instinct:0},sprinter:{body:0,mind:0,instinct:0},raider:{body:.4,mind:0,instinct:.2},pouncer:{body:.4,mind:0,instinct:.2},shieldBearer:{body:1,mind:0,instinct:.4},archer:{body:.2,mind:0,instinct:.2},bomber:{body:.4,mind:.2,instinct:.2},warlock:{body:.4,mind:.6,instinct:.2},sentinel:{body:4,mind:2,instinct:2}}),companionSubtype:Ts({falcon:{body:2,mind:2,instinct:9},skeleton:{body:15,mind:1,instinct:4}})}},nv=e=>e?.toLowerCase()==="neutral"?"neutral":"live",iv=()=>globalThis?.process?.env?.HOP_TRINITY_PROFILE,av=e=>tv[nv(iv())];function Md(e,n){return e?.get(n)}const Xn={outgoingPhysical:1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},sv={VANGUARD:Xn,SKIRMISHER:Xn,FIREMAGE:Xn,NECROMANCER:Xn,HUNTER:Xn,ASSASSIN:Xn},ov={footman:{outgoingPhysical:3,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},sprinter:{outgoingPhysical:2.8,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},raider:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},pouncer:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},shieldBearer:{outgoingPhysical:3.5,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},archer:{outgoingPhysical:2.6,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},bomber:{outgoingPhysical:2.8,outgoingMagical:3,incomingPhysical:1,incomingMagical:1},warlock:{outgoingPhysical:1.5,outgoingMagical:3.5,incomingPhysical:1,incomingMagical:1},sentinel:{outgoingPhysical:4,outgoingMagical:4,incomingPhysical:1,incomingMagical:1}},rv={falcon:{outgoingPhysical:1.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},skeleton:{outgoingPhysical:1.1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1}},ko=e=>({outgoingPhysical:e.outgoingPhysical,outgoingMagical:e.outgoingMagical,incomingPhysical:e.incomingPhysical,incomingMagical:e.incomingMagical}),Mg=e=>e.type==="player"?ko(sv[(e.archetype||"VANGUARD").toUpperCase()]||Xn):e.companionOf&&e.subtype?ko(rv[e.subtype]||Xn):e.subtype?ko(ov[e.subtype]||Xn):ko(Xn),Og=e=>{const n=Md(e.components,"combat_profile");return n?{outgoingPhysical:Number.isFinite(n.outgoingPhysical)?n.outgoingPhysical:1,outgoingMagical:Number.isFinite(n.outgoingMagical)?n.outgoingMagical:1,incomingPhysical:Number.isFinite(n.incomingPhysical)?n.incomingPhysical:1,incomingMagical:Number.isFinite(n.incomingMagical)?n.incomingMagical:1}:ko(Xn)},lv=(e,n)=>{const a=Og(e);return n==="magical"?a.outgoingMagical:a.outgoingPhysical},cv=(e,n)=>{const a=Og(e);return n==="magical"?a.incomingMagical:a.incomingPhysical},Eo=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),Cg=e=>{if(e.trinity)return Eo(e.trinity);const n=av(),a=n.default;if(e.type==="player"){const o=(e.archetype||"VANGUARD").toUpperCase();return Eo(n.archetype[o]||a)}if(e.companionOf&&e.subtype){const o=e.subtype;if(n.companionSubtype[o])return Eo(n.companionSubtype[o])}return e.subtype?Eo(n.enemySubtype[e.subtype]||a):Eo(a)},No=e=>{const n=new Map(e.components||[]),a=n.has("trinity"),o=n.has("combat_profile");if(a&&o)return e;const r=Cg({id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:e.factionId,archetype:e.archetype,companionOf:e.companionOf}),c=Mg({type:e.type,archetype:e.archetype,subtype:e.subtype,companionOf:e.companionOf});return a||n.set("trinity",{type:"trinity",...r}),o||n.set("combat_profile",{type:"combat_profile",...c}),{...e,components:n}};function uv(e){return e.map(n=>({id:n,name:String(n),description:String(n),slot:"utility",cooldown:0,currentCooldown:0,range:0,upgrades:[],activeUpgrades:[]}))}function ra(e){const n=e.activeSkills?[...e.activeSkills]:uv(e.skills||[]),a=new Map(e.components||[]),o=Cg(e),r=e.combatProfile||Mg(e);a.has("trinity")||a.set("trinity",{type:"trinity",...o}),a.has("combat_profile")||a.set("combat_profile",{type:"combat_profile",...r});const c=Pl(o),d=Math.max(1,e.maxHp??c),h=Math.min(d,Math.max(0,e.hp??d));return e.weightClass&&a.set("physics",{type:"physics",weightClass:e.weightClass}),e.archetype&&a.set("archetype",{type:"archetype",archetype:e.archetype}),{id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:h,maxHp:d,speed:e.speed,factionId:e.factionId,initiative:e.initiative,statusEffects:[],temporaryArmor:0,activeSkills:n,weightClass:e.weightClass,archetype:e.archetype,components:a,isFlying:e.isFlying,companionOf:e.companionOf,isVisible:!0}}function dv(e){const n=ra({id:e.id,type:"enemy",subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:"enemy",skills:e.skills,weightClass:e.weightClass||"Standard",trinity:e.trinity});return n.enemyType=e.enemyType,n}function kg(e){if(e.companionType==="falcon"){const n=ra({id:e.id||`falcon-${e.ownerId}`,type:"enemy",subtype:"falcon",position:e.position,speed:95,factionId:"player",skills:["BASIC_MOVE","FALCON_PECK","FALCON_APEX_STRIKE","FALCON_HEAL","FALCON_SCOUT","FALCON_AUTO_ROOST"],weightClass:"Light",isFlying:!0,companionOf:e.ownerId,trinity:e.trinity});return n.companionState={mode:"roost",orbitStep:0},n}return e.companionType==="skeleton"?ra({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:"skeleton",position:e.position,hp:2,maxHp:2,speed:50,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity}):ra({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:e.companionType,position:e.position,speed:80,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity})}function fv(e){return kg({companionType:"falcon",ownerId:e.ownerId,position:e.position})}function mv(e){const n=Vx(e);return n.length>0?n:["BASIC_MOVE"]}class ay extends Error{issues;constructor(n,a){super(`${n} validation failed:
${a.map(o=>`${o.path}: ${o.message}`).join(`
`)}`),this.name="ContractValidationError",this.issues=a}}const Dt=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),Oi=e=>typeof e=="number"&&Number.isFinite(e),Kn=e=>Number.isInteger(e),ut=e=>typeof e=="string",de=(e,n,a)=>e.push({path:n,message:a}),pv=e=>{if(!ut(e))return e;try{return JSON.parse(e)}catch(n){throw new Error(`Invalid JSON: ${n.message}`)}},Ro=(e,n,a,o={})=>{if(!Array.isArray(e))return de(n,a,"Expected array");const r=new Set;o.nonEmpty&&e.length===0&&de(n,a,"Must not be empty"),e.forEach((c,d)=>{if(!ut(c)||c.length===0)return de(n,`${a}[${d}]`,"Expected non-empty string");o.unique&&(r.has(c)&&de(n,`${a}[${d}]`,`Duplicate "${c}"`),r.add(c))})},sy=(e,n,a)=>{if(!Dt(e))return de(n,a,"Expected object");Oi(e.base)||de(n,`${a}.base`,"Expected number"),e.min!==void 0&&!Oi(e.min)&&de(n,`${a}.min`,"Expected number"),e.max!==void 0&&!Oi(e.max)&&de(n,`${a}.max`,"Expected number"),Oi(e.min)&&Oi(e.max)&&e.min>e.max&&de(n,a,"min must be <= max")},hv=(e,n,a)=>Dt(e)?((!ut(e.id)||e.id.length===0)&&de(n,`${a}.id`,"Expected non-empty string"),Ro(e.tags,n,`${a}.tags`,{nonEmpty:!0,unique:!0}),ut(e.kind)?e.kind==="DEAL_DAMAGE"?(sy(e.amount,n,`${a}.amount`),(!Dt(e.target)||!ut(e.target.selector))&&de(n,`${a}.target`,"Expected selector"),!0):e.kind==="APPLY_STATUS"?((!ut(e.statusId)||e.statusId.length===0)&&de(n,`${a}.statusId`,"Expected statusId"),(!Kn(e.duration)||e.duration<0)&&de(n,`${a}.duration`,"Expected integer >= 0"),(!Dt(e.target)||!ut(e.target.selector))&&de(n,`${a}.target`,"Expected selector"),!0):e.kind==="APPLY_FORCE"?Dt(e.force)?((!ut(e.force.mode)||!new Set(["push","pull"]).has(e.force.mode))&&de(n,`${a}.force.mode`,"Expected push|pull"),(!ut(e.force.direction)||!new Set(["source_to_target","target_to_source"]).has(e.force.direction))&&de(n,`${a}.force.direction`,"Invalid direction"),(!Kn(e.force.maxDistance)||e.force.maxDistance<0)&&de(n,`${a}.force.maxDistance`,"Expected integer >= 0"),sy(e.force.magnitude,n,`${a}.force.magnitude`),Dt(e.force.collision)||de(n,`${a}.force.collision`,"Expected object"),!0):(de(n,`${a}.force`,"Expected object"),!0):e.kind==="MESSAGE"?((!ut(e.text)||e.text.length===0)&&de(n,`${a}.text`,"Expected non-empty string"),!0):(de(n,`${a}.kind`,"Unknown kind"),!1):(de(n,`${a}.kind`,"Expected kind"),!1)):(de(n,a,"Expected object"),!1),yv=(e,n,a)=>{if(!Dt(e))return de(n,a,"Expected object");if(!ut(e.method))return de(n,`${a}.method`,"Expected method");if(e.method==="fixed"){Oi(e.value)||de(n,`${a}.value`,"Expected number");return}if(e.method==="uniform_int"){Kn(e.min)||de(n,`${a}.min`,"Expected integer"),Kn(e.max)||de(n,`${a}.max`,"Expected integer"),Kn(e.min)&&Kn(e.max)&&e.min>e.max&&de(n,a,"min must be <= max");return}if(e.method==="triangular_int"){Kn(e.min)||de(n,`${a}.min`,"Expected integer"),Kn(e.mode)||de(n,`${a}.mode`,"Expected integer"),Kn(e.max)||de(n,`${a}.max`,"Expected integer");return}if(e.method==="weighted_table"){if(!Array.isArray(e.table)||e.table.length===0)return de(n,`${a}.table`,"Expected non-empty array");e.table.forEach((o,r)=>{if(!Dt(o))return de(n,`${a}.table[${r}]`,"Expected object");Oi(o.value)||de(n,`${a}.table[${r}].value`,"Expected number"),(!Oi(o.weight)||o.weight<=0)&&de(n,`${a}.table[${r}].weight`,"Expected number > 0")});return}de(n,`${a}.method`,"Unknown propensity method")},gv=e=>{const n=[];if(!Dt(e))return de(n,"$","Expected object"),n;if((!ut(e.version)||!/^1\./.test(e.version))&&de(n,"$.version","Expected v1.x"),(!ut(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&de(n,"$.id","Expected uppercase id"),(!ut(e.name)||e.name.length===0)&&de(n,"$.name","Expected non-empty string"),(!ut(e.actorType)||!new Set(["player","enemy"]).has(e.actorType))&&de(n,"$.actorType","Expected player|enemy"),(!ut(e.factionId)||e.factionId.length===0)&&de(n,"$.factionId","Expected non-empty string"),(!Dt(e.coordSpace)||e.coordSpace.system!=="cube-axial"||e.coordSpace.pointFormat!=="qrs")&&de(n,"$.coordSpace","Expected {system:cube-axial,pointFormat:qrs}"),Dt(e.instantiate)?((!ut(e.instantiate.rngStream)||e.instantiate.rngStream.length===0)&&de(n,"$.instantiate.rngStream","Expected non-empty string"),(!ut(e.instantiate.counterMode)||!new Set(["consume_global","stateless"]).has(e.instantiate.counterMode))&&de(n,"$.instantiate.counterMode","Expected consume_global|stateless"),Ro(e.instantiate.drawOrder,n,"$.instantiate.drawOrder",{nonEmpty:!0,unique:!0})):de(n,"$.instantiate","Expected object"),!Dt(e.propensities))de(n,"$.propensities","Expected object");else{const a=e.propensities;["body","mind","instinct","speed","mass"].forEach(o=>{o in a||de(n,`$.propensities.${o}`,"Missing required propensity")}),Object.entries(a).forEach(([o,r])=>yv(r,n,`$.propensities.${o}`))}return Dt(e.skillLoadout)?(Ro(e.skillLoadout.baseSkillIds,n,"$.skillLoadout.baseSkillIds",{nonEmpty:!0,unique:!0}),e.skillLoadout.passiveSkillIds!==void 0&&Ro(e.skillLoadout.passiveSkillIds,n,"$.skillLoadout.passiveSkillIds",{unique:!0})):de(n,"$.skillLoadout","Expected object"),n},bv=e=>{const n=[];return Dt(e)?((!ut(e.version)||!/^1\./.test(e.version))&&de(n,"$.version","Expected v1.x"),(!ut(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&de(n,"$.id","Expected uppercase id"),(!ut(e.name)||e.name.length===0)&&de(n,"$.name","Expected non-empty string"),(!ut(e.slot)||!new Set(["offensive","defensive","utility","passive"]).has(e.slot))&&de(n,"$.slot","Invalid slot"),Ro(e.keywords,n,"$.keywords",{unique:!0}),Dt(e.targeting)?((!ut(e.targeting.mode)||!new Set(["self","single","line","radius","global"]).has(e.targeting.mode))&&de(n,"$.targeting.mode","Invalid mode"),(!Kn(e.targeting.range)||e.targeting.range<0)&&de(n,"$.targeting.range","Expected integer >= 0"),typeof e.targeting.requiresLos!="boolean"&&de(n,"$.targeting.requiresLos","Expected boolean"),typeof e.targeting.allowOccupied!="boolean"&&de(n,"$.targeting.allowOccupied","Expected boolean")):de(n,"$.targeting","Expected object"),(!Dt(e.stackPolicy)||e.stackPolicy.resolveOrder!=="LIFO")&&de(n,"$.stackPolicy.resolveOrder","MVP requires LIFO"),Dt(e.baseAction)?(Dt(e.baseAction.costs)?((!Oi(e.baseAction.costs.energy)||e.baseAction.costs.energy<0)&&de(n,"$.baseAction.costs.energy","Expected number >= 0"),(!Kn(e.baseAction.costs.cooldown)||e.baseAction.costs.cooldown<0)&&de(n,"$.baseAction.costs.cooldown","Expected integer >= 0"),typeof e.baseAction.costs.consumesTurn!="boolean"&&de(n,"$.baseAction.costs.consumesTurn","Expected boolean")):de(n,"$.baseAction.costs","Expected object"),!Array.isArray(e.baseAction.effects)||e.baseAction.effects.length===0?de(n,"$.baseAction.effects","Expected non-empty array"):e.baseAction.effects.forEach((a,o)=>hv(a,n,`$.baseAction.effects[${o}]`))):de(n,"$.baseAction","Expected object"),Array.isArray(e.upgrades)?e.upgrades.forEach((a,o)=>{if(!Dt(a))return de(n,`$.upgrades[${o}]`,"Expected object");(!ut(a.id)||!/^[A-Z0-9_]+$/.test(a.id))&&de(n,`$.upgrades[${o}].id`,"Expected uppercase id"),(!ut(a.name)||a.name.length===0)&&de(n,`$.upgrades[${o}].name`,"Expected non-empty string"),Array.isArray(a.modifiers)||de(n,`$.upgrades[${o}].modifiers`,"Expected array")}):de(n,"$.upgrades","Expected array"),n):(de(n,"$","Expected object"),n)},xv=e=>{const n=pv(e),a=[];if(!Dt(n))throw new ay("TacticalDataPack",[{path:"$",message:"Expected pack object"}]);if((!ut(n.version)||!/^1\./.test(n.version))&&a.push({path:"$.version",message:"Expected v1.x string"}),Array.isArray(n.units)?n.units.forEach((o,r)=>{gv(o).forEach(d=>a.push({path:`$.units[${r}]${d.path.slice(1)}`,message:d.message}))}):a.push({path:"$.units",message:"Expected array"}),Array.isArray(n.skills)?n.skills.forEach((o,r)=>{bv(o).forEach(d=>a.push({path:`$.skills[${r}]${d.path.slice(1)}`,message:d.message}))}):a.push({path:"$.skills",message:"Expected array"}),a.length>0)throw new ay("TacticalDataPack",a);return n},vv=e=>({definition:e,drawOrder:[...e.instantiate.drawOrder],skillIds:[...e.skillLoadout.baseSkillIds],passiveSkillIds:[...e.skillLoadout.passiveSkillIds||[]]}),Sv={Light:3,Standard:5,Heavy:8,Anchored:12,OuterWall:20},Av=e=>({version:"1.0.0",id:e.id,name:e.name,actorType:"enemy",subtype:e.subtype,factionId:"enemy",weightClass:e.weightClass,coordSpace:{system:"cube-axial",pointFormat:"qrs"},instantiate:{rngStream:"enemy.instantiate",seedSalt:e.subtype,counterMode:"consume_global",drawOrder:["body","mind","instinct","speed","mass"],includeRollTrace:!1},propensities:{body:{method:"fixed",value:e.trinity.body},mind:{method:"fixed",value:e.trinity.mind},instinct:{method:"fixed",value:e.trinity.instinct},speed:{method:"fixed",value:e.speed},mass:{method:"fixed",value:Sv[e.weightClass]}},derivedStats:{maxHp:{formula:"trinity_hp_v1"}},physics:{collisionPolicy:"crush_damage",crushModel:{baseDamage:0,impulseMultiplier:1,massDivider:1,minDamage:1}},skillLoadout:{baseSkillIds:e.baseSkills,passiveSkillIds:e.passiveSkills||[]},runtimeDefaults:{startingHp:"maxHp",temporaryArmor:0,isVisible:!0}}),Tv={footman:"ENEMY_FOOTMAN_V1",sprinter:"ENEMY_SPRINTER_V1",raider:"ENEMY_RAIDER_V1",pouncer:"ENEMY_POUNCER_V1",shieldBearer:"ENEMY_SHIELDBEARER_V1",archer:"ENEMY_ARCHER_V1",bomber:"ENEMY_BOMBER_V1",warlock:"ENEMY_WARLOCK_V1",sentinel:"ENEMY_SENTINEL_V1"},Mi=(e,n={})=>{const a=wg(e);if(!a)throw new Error(`Missing bestiary entry for ${e}`);return Av({id:Tv[e],name:a.name,subtype:a.subtype,weightClass:a.stats.weightClass,speed:a.stats.speed,trinity:a.trinity,baseSkills:n.baseSkills??a.skills.base,passiveSkills:n.passiveSkills??a.skills.passive})},Ev={version:"1.0.0",id:"SHIELD_BASH_V1",name:"Shield Bash V1",description:"Data-driven migration variant of shield bash.",slot:"offensive",keywords:["Momentum"],intentTags:["damage","control","move"],targeting:{mode:"single",range:1,requiresLos:!0,allowOccupied:!0,deterministicSort:"distance_then_q_then_r"},stackPolicy:{resolveOrder:"LIFO",reactionWindow:"automated",playerPriority:!1,emitTickEvents:!0},baseAction:{costs:{energy:0,cooldown:2,consumesTurn:!0},effects:[{id:"shield_bash_v1_force",kind:"APPLY_FORCE",tags:["movement","momentum"],target:{selector:"targetActor"},force:{mode:"push",direction:"source_to_target",magnitude:{base:2,scaling:[{stat:"body",coefficient:.2}],min:1,round:"floor"},maxDistance:3,collision:{onBlocked:"crush_damage",crushDamage:{base:1,scaling:[{stat:"momentum",coefficient:1}],min:1,round:"floor"}}}},{id:"shield_bash_v1_damage",kind:"DEAL_DAMAGE",tags:["damage","physical"],target:{selector:"targetActor"},amount:{base:2,scaling:[{stat:"body",coefficient:.4}],min:1,round:"floor"},damageClass:"physical",reason:"shield_bash_v1"}]},reactivePassives:[],upgrades:[],inhibit:{filterMode:"exclude_matching_tags",removableTags:["movement","momentum"]},preview:{dryRunEnabled:!0,eventMap:{APPLY_FORCE:"UnitMoved",DEAL_DAMAGE:"DamageTaken"}}},_v={version:"1.0.0",units:[Mi("footman",{passiveSkills:[]}),Mi("sprinter"),Mi("raider",{baseSkills:["DASH"],passiveSkills:[]}),Mi("pouncer",{baseSkills:["BASIC_MOVE","GRAPPLE_HOOK"],passiveSkills:[]}),Mi("shieldBearer",{baseSkills:["BASIC_MOVE","SHIELD_BASH"],passiveSkills:[]}),Mi("archer",{baseSkills:["BASIC_MOVE","ARCHER_SHOT"],passiveSkills:[]}),Mi("bomber",{baseSkills:["BASIC_MOVE","BOMB_TOSS"],passiveSkills:[]}),Mi("warlock",{baseSkills:["BASIC_MOVE","SENTINEL_BLAST"],passiveSkills:[]}),Mi("sentinel",{baseSkills:["BASIC_MOVE","SENTINEL_TELEGRAPH","SENTINEL_BLAST"],passiveSkills:[]})],skills:[Ev]},wv=new Map,Ng=new Map,Mv=e=>(wv.set(e.id,e),e.subtype&&Ng.set(e.subtype,e),e),Ov=e=>e.map(Mv),Cv=e=>Ng.get(e);function Dn(e,n){const a=e.tiles.get(ue(n));return!!(a?.traits.has("BLOCKS_LOS")||a?.baseId==="WALL")}function La(e,n){const a=e.tiles.get(ue(n));return a?.baseId==="LAVA"||a?.traits.has("LIQUID")||!1}function ca(e,n,a){const o=ye(e,n);return!!o&&o.id!==a}function kt(e,n,a){const o=be(e,n);return o>=1&&o<=a}function Pn(e,n){const a=Gn(e,n);return{isAxial:a!==-1,directionIndex:a}}function qd(e,n,a={}){const{checkWalls:o=!0,checkActors:r=!0,checkLava:c=!1,excludeActorId:d}=a;for(const h of n){if(o&&Dn(e,h))return{obstacle:"wall",position:h};if(c&&La(e,h))return{obstacle:"lava",position:h};if(r){const g=ye(e,h);if(g&&g.id!==d)return{obstacle:"actor",position:h,actor:g}}}return{}}function $d(e,n,a,o={}){const c=ht(n,a).slice(1),{stopAtWalls:d=!0,stopAtActors:h=!0,stopAtLava:g=!1,excludeActorId:m}=o,f=qd(e,c,{checkWalls:d,checkActors:h,checkLava:g,excludeActorId:m});return f.obstacle&&f.position&&!se(f.position,a)?{isValid:!1,blockedBy:f.obstacle,blockedAt:f.position}:{isValid:!0}}function Nl(e,n,a,o,r){const d=ht(n,a).slice(1),h=qd(e,d,{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:r});return h.obstacle==="actor"&&h.actor?.id===o&&!!h.position&&se(h.position,a)}function kv(e,n){const a=Ne.getTraitsAt(e,n),o=a.has("HAZARDOUS")||a.has("LAVA")||a.has("FIRE")||a.has("VOID"),r=a.has("LAVA")||a.has("FIRE");return{isHazard:o,isFireHazard:r}}function ki(e,n,a){const{isHazard:o,isFireHazard:r}=kv(e,a);return!!(!o||n.isFlying||(n.activeSkills?.some(d=>d.id==="ABSORB_FIRE")||n.statusEffects?.some(d=>d.type==="fire_immunity"))&&r)}function Rg(e,n,a,o){return ki(e,n,a)?!0:new Set(["JUMP","VAULT","GRAPPLE_HOOK","DASH"]).has(o)}const en=(e,n,a)=>Math.max(n,Math.min(a,e)),jt=e=>Math.round(e*1e3)/1e3,Nv=()=>globalThis?.process?.env?.HOP_COMBAT_INTERACTION_MODEL,Rv=e=>e.length===0?1:e.reduce((n,a)=>n*a.multiplier,1),Iv=e=>{let n=1;if(e.inDangerPreviewHex&&(n+=.15),typeof e.proximityDistance=="number"){const a=en(e.proximityDistance,0,6);n+=(6-a)*.02}return n},Lv=(e,n,a,o,r,c,d,h)=>{if(!n)return{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1};const g=a==="physical"?.85+e.instinct*.015+e.body*.005:.85+e.mind*.015+e.instinct*.005,m=a==="physical"?n.instinct*.012+n.body*.004:n.instinct*.008+n.mind*.008,f=en(g-m,.1,.99);if(typeof o!="number")return{multiplier:f,pressure:jt(g-m),rangePressure:0,rangeMultiplier:1};const b={min:en(r??(a==="physical"?1:2),1,6),max:en(c??(a==="physical"?2:4),1,6)};if(b.max<b.min){const N=b.min;b.min=b.max,b.max=N}const x={min:en(d??(a==="physical"?1:2),1,6),max:en(h??(a==="physical"?3:5),1,6)};if(x.max<x.min){const N=x.min;x.min=x.max,x.max=N}const T=en(o,1,6),S=Math.max(0,b.min-T),A=Math.max(0,T-b.max),O=S*.06+A*.1,_=e.instinct*.015,E=(T>=x.min&&T<=x.max?.05:0)+n.instinct*.006,w=_-O-E,C=en(1+w,.55,1.25);return{multiplier:en(f*C,.05,.99),pressure:jt(g-m),rangePressure:jt(w),rangeMultiplier:jt(C)}},Hv=(e,n)=>{if(!e)return{multiplier:1,pressure:0};const a=en(n==="physical"?e.body*.01+e.instinct*.004:e.mind*.01+e.instinct*.004,0,.75);return{multiplier:1-a,pressure:jt(a)}},Bv=(e,n,a,o)=>{if(!n)return{multiplier:o,critPressure:0,resistancePressure:0};const r=en(a==="physical"?.05+e.instinct*.01:.05+e.mind*.01,0,.75),c=en(a==="physical"?n.body*.006+n.instinct*.004:n.mind*.006+n.instinct*.004,0,.7);return{multiplier:1+en(r-c,0,.75)*(o-1),critPressure:jt(r),resistancePressure:jt(c)}},jv=(e,n,a,o,r)=>{const c=e.scaling.filter(b=>b.attribute==="body").reduce((b,x)=>b+(e.trinity.body||0)*x.coefficient,0),d=e.scaling.filter(b=>b.attribute==="mind").reduce((b,x)=>b+(e.trinity.mind||0)*x.coefficient,0),h=e.scaling.filter(b=>b.attribute==="instinct").reduce((b,x)=>b+(e.trinity.instinct||0)*x.coefficient,0),g=e.damageClass==="physical"?Math.max(0,e.basePower*(n.bodyDamageMultiplier-1)):0,m=e.damageClass==="magical"?Math.max(0,e.basePower*(n.mindMagicMultiplier-1)):0,f=Math.max(0,(r-1)*(a+o));return{body:Math.max(0,g+c),mind:Math.max(0,m+d),instinct:Math.max(0,h+f)}},Dv=(e,n)=>{if(e<=0)return e;const a=Ud(n).mindStatusDurationBonus;return e+a},Pv=e=>Ud(e).instinctInitiativeBonus,Pt=e=>{const n=Ud(e.trinity),a=e.damageClass||"physical",o=Nv()==="triangle"?"triangle":"legacy",r=e.interactionModel||o,c=a==="magical"?n.mindMagicMultiplier:n.bodyDamageMultiplier,d=e.basePower*c,h=e.scaling.reduce((H,D)=>{const G=e.trinity[D.attribute]||0;return H+G*D.coefficient},0),g=Rv(e.statusMultipliers),m=Iv(e),f=n.instinctCriticalMultiplier,b=r==="triangle"?Lv(e.trinity,e.targetTrinity,a,e.engagementRange,e.optimalRangeMin,e.optimalRangeMax,e.targetOptimalRangeMin,e.targetOptimalRangeMax):{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1},x=r==="triangle"?Hv(e.targetTrinity,a):{multiplier:1,pressure:0},T=r==="triangle"?Bv(e.trinity,e.targetTrinity,a,f):{multiplier:f,critPressure:0,resistancePressure:0},S=(d+h)*g*m*b.multiplier*x.multiplier*T.multiplier*(e.attackPowerMultiplier??1)*(e.targetDamageTakenMultiplier??1),A=Math.max(0,Math.floor(S)),O=jv(e,n,d,h,f),_=Math.max(1e-6,O.body+O.mind+O.instinct),E=jt(O.body/_),w=jt(O.mind/_),C=jt(O.instinct/_),I=Math.max(1,e.theoreticalMaxPower??S),N=en(A/I,0,1);return{basePower:e.basePower,bodyScaledPower:jt(d),scalingPower:jt(h),statusMultiplier:jt(g),riskMultiplier:jt(m),criticalMultiplier:jt(f),hitMultiplier:jt(b.multiplier),rangeMultiplier:jt(b.rangeMultiplier),mitigationMultiplier:jt(x.multiplier),critExpectedMultiplier:jt(T.multiplier),finalPower:A,bodyContribution:E,mindContribution:w,instinctContribution:C,scoreEvent:{skillId:e.skillId,attackerId:e.attackerId,targetId:e.targetId,finalPower:A,efficiency:jt(N),riskBonusApplied:!!e.inDangerPreviewHex,damageClass:a,hitPressure:b.pressure,rangePressure:b.rangePressure,mitigationPressure:x.pressure,critPressure:T.critPressure,resistancePressure:T.resistancePressure,bodyContribution:E,mindContribution:w,instinctContribution:C}}},Ie=e=>{const n=Md(e.components,"trinity");if(n)return{body:n.body,mind:n.mind,instinct:n.instinct};const a=Md(e.components,"stats"),o=a?.strength??0,r=a?.defense??0,c=a?.evasion??0;return{body:o,mind:r,instinct:c}},Uv=(e,n)=>e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n),qv=(e,n,a)=>!!(e.player.id!==a&&se(e.player.position,n)||e.enemies.some(o=>o.id!==a&&o.hp>0&&se(o.position,n))||e.companions?.some(o=>o.id!==a&&o.hp>0&&se(o.position,n))),oy=(e,n)=>{const a={q:n.q-e.q,r:n.r-e.r,s:n.s-e.s};let o=Io[0],r=Number.NEGATIVE_INFINITY;for(const c of Io){const d=c.q*a.q+c.r*a.r+c.s*a.s;d>r&&(r=d,o=c)}return o},$v=(e,n)=>{const a=Uv(e,n.targetActorId);if(!a)return{effects:[],destination:null,collided:!1};const o=Math.max(0,Math.min(n.maxDistance,Math.floor(n.magnitude)));if(o<=0)return{effects:[],destination:a.position,collided:!1};const r=a.position,c=n.mode==="push"?oy(n.source,r):oy(r,n.source),d=[r];let h=r,g=!1;for(let f=0;f<o;f++){const b=rn(h,c);if(!Ne.isWalkable(e,b)||qv(e,b,a.id)){g=!0;break}d.push(b),h=b}const m=[];return se(h,r)||m.push({type:"Displacement",target:a.id,destination:h,path:d,simulatePath:!0}),g&&n.collision.onBlocked==="crush_damage"&&m.push({type:"Damage",target:a.id,amount:Math.max(0,Math.floor(n.collision.crushDamage??0)),reason:n.damageReason||"crush"}),{effects:m,destination:h,collided:g}},Zr=e=>JSON.parse(JSON.stringify(e)),zv=(e,n)=>n==="floor"?Math.floor(e):n==="round"?Math.round(e):n==="ceil"?Math.ceil(e):e,rd=(e,n)=>{let a=e.base;for(const o of e.scaling||[])a+=(n[o.stat]??0)*o.coefficient;return a=zv(a,e.round),e.min!==void 0&&(a=Math.max(e.min,a)),e.max!==void 0&&(a=Math.min(e.max,a)),a},Vv=(e,n,a,o)=>{const r=n.split(".");let c=e;for(let g=0;g<r.length-1;g++){const m=r[g],f=c[m];if(!f||typeof f!="object")return;c=f}const d=r[r.length-1],h=Number(c[d]);Number.isFinite(h)&&(a==="set"&&(c[d]=o),a==="add"&&(c[d]=h+o),a==="multiply"&&(c[d]=h*o))},Yv=(e,n,a)=>{let o=Zr(e.baseAction.effects);const r=Zr(e.reactivePassives||[]),c=new Set(e.keywords),d={};for(const h of e.upgrades)d[h.id]=h;for(const h of n){const g=d[h];if(g)for(const m of g.modifiers){if(m.op==="add_effect"&&o.push(Zr(m.effect)),m.op==="remove_effect_by_tag"&&(o=o.filter(f=>!f.tags.includes(m.tag))),m.op==="modify_number"){const f=o.find(b=>b.id===m.effectId);f&&Vv(f,m.field,m.mode,m.value)}m.op==="add_keyword"&&c.add(m.keyword),m.op==="remove_keyword"&&c.delete(m.keyword),m.op==="add_reaction"&&r.push(Zr(m.reaction))}}return e.inhibit?.filterMode==="exclude_matching_tags"&&a.size>0&&(o=o.filter(h=>!h.tags.some(g=>a.has(g)))),{effects:o,reactions:r,keywords:c}},Kv=(e,n)=>{const a=Ie(e),o=Number(n?.momentum??0),r=Number(n?.mass??1);return{body:a.body,mind:a.mind,instinct:a.instinct,mass:Number.isFinite(r)?r:1,speed:e.speed||1,momentum:Number.isFinite(o)?o:0}},ld=(e,n)=>n?ye(e,n)?.id:void 0,Fv=(e,n,a,o,r)=>{if(o.kind==="MESSAGE")return[{type:"Message",text:o.text}];if(o.kind==="DEAL_DAMAGE"){const g=Math.max(0,Math.floor(rd(o.amount,r))),m=ld(e,a);return[{type:"Damage",target:o.target.selector==="targetActor"?m||"targetActor":o.target.selector==="self"?n.id:a||"targetActor",amount:g,reason:o.reason}]}if(o.kind==="APPLY_STATUS"){const g=ld(e,a);return[{type:"ApplyStatus",target:o.target.selector==="targetActor"?g||"targetActor":o.target.selector==="self"?n.id:a||"targetActor",status:o.statusId,duration:o.duration}]}const c=ld(e,a);if(!c)return[];const d=rd(o.force.magnitude,r),h=o.force.collision.crushDamage?rd(o.force.collision.crushDamage,r):0;return $v(e,{source:n.position,targetActorId:c,mode:o.force.mode,magnitude:d,maxDistance:o.force.maxDistance,collision:{onBlocked:o.force.collision.onBlocked,crushDamage:h}}).effects},Xv=(e,n,a,o)=>{const r=[];for(let c=0;c<e.gridWidth;c++)for(let d=0;d<e.gridHeight;d++){const h=on(c,d);la(h,e.gridWidth,e.gridHeight)&&be(n,h)<=a&&r.push(h)}return r.sort((c,d)=>{if(o==="q_then_r")return c.q===d.q?c.r-d.r:c.q-d.q;if(o==="r_then_q")return c.r===d.r?c.q-d.q:c.r-d.r;const h=be(n,c),g=be(n,d);return h!==g?h-g:c.q===d.q?c.r-d.r:c.q-d.q}),r},Wv=e=>{const n=e.baseAction.effects.find(r=>r.kind==="DEAL_DAMAGE"),a=e.baseAction.effects.find(r=>r.kind==="APPLY_FORCE"),o={};return e.upgrades.forEach(r=>{o[r.id]={id:r.id,name:r.name,description:r.description||r.name}}),{id:e.id,name:e.name,description:e.description||e.name,slot:e.slot,icon:"data-driven",baseVariables:{range:e.targeting.range,cost:e.baseAction.costs.energy,cooldown:e.baseAction.costs.cooldown,damage:n?.amount?.base,momentum:a?.force?.magnitude?.base},execute:(r,c,d,h=[],g={})=>{const m=new Set(g.inhibitTags||[]),f=Yv(e,h,m),b=Kv(c,g),T=[...(f.reactions||[]).filter(A=>A.trigger==="ON_DECLARE").flatMap(A=>A.effects),...f.effects],S=[];for(const A of T)S.push(...Fv(r,c,d,A,b));return{effects:S,messages:[],consumesTurn:e.baseAction.costs.consumesTurn}},getValidTargets:(r,c)=>{if(e.targeting.mode==="self")return[c];let d=Xv(r,c,e.targeting.range,e.targeting.deterministicSort);return(e.targeting.mode==="single"||e.targeting.mode==="radius"||e.targeting.mode==="line")&&(e.targeting.requiresLos&&(d=d.filter(h=>$d(r,c,h).isValid)),e.targeting.allowOccupied||(d=d.filter(h=>!ye(r,h)))),d},upgrades:o}},Gv=new Map,Ig=new Map,Jv=e=>{const n=Wv(e);return Gv.set(e.id,e),Ig.set(e.id,n),n},Qv=e=>e.map(Jv),Zv=()=>{const e={};for(const[n,a]of Ig.entries())e[n]=a;return e};let Lg=!1;const eS=(e=_v)=>{const n=xv(e);return Ov(n.units),Qv(n.skills),Lg=!0,{unitsRegistered:n.units.length,skillsRegistered:n.skills.length}},Hg=()=>Lg?{unitsRegistered:0,skillsRegistered:0}:eS(),Bg=(e,n="none")=>n==="floor"?Math.floor(e):n==="round"?Math.round(e):n==="ceil"?Math.ceil(e):e,jg=(e,n)=>n?Math.max(n.min,Math.min(n.max,e)):e,el=(e,n)=>jg(Bg(e,n.round),n.clamp),tS=(e,n)=>{if(e.method==="fixed")return{value:el(e.value,e),before:-1,after:-1,usedRng:!1};if(e.method==="uniform_int"){const d=n(),h=e.max-e.min+1,g=e.min+Math.floor(d.value*h)%Math.max(1,h);return{value:el(g,e),before:d.before,after:d.after,usedRng:!0}}if(e.method==="triangular_int"){const d=n(),h=e.min,g=e.mode,m=e.max,f=(g-h)/Math.max(1e-9,m-h),b=d.value<f?h+Math.sqrt(d.value*(m-h)*(g-h)):m-Math.sqrt((1-d.value)*(m-h)*(m-g));return{value:el(b,e),before:d.before,after:d.after,usedRng:!0}}const a=n(),o=e.table.reduce((d,h)=>d+h.weight,0);let r=a.value*Math.max(1e-9,o),c=e.table[e.table.length-1].value;for(const d of e.table)if(r-=d.weight,r<=0){c=d.value;break}return{value:el(c,e),before:a.before,after:a.after,usedRng:!0}},ry=(e,n,a)=>{if(e.formula==="trinity_hp_v1")return Pl(a);const o=e.base??0,c=(e.terms||[]).reduce((h,g)=>h+(n[g.stat]??0)*g.coefficient,o),d=Bg(c,e.round);return jg(d,e.clamp)},nS=(e,n)=>!n||Object.keys(n).length===0?e:{...e,activeSkills:(e.activeSkills||[]).map(a=>{const o=n[a.id];return o===void 0?a:{...a,currentCooldown:Math.max(0,o)}})},iS=e=>e.id.toLowerCase(),aS=(e,n,a)=>{const o=n.definition,r=[];let c={rngSeed:e.rngSeed||"default",rngCounter:Math.max(0,e.rngCounter||0)},d=0;const h=`${c.rngSeed}:${o.instantiate.rngStream}:${o.instantiate.seedSalt||o.id}`,g=()=>{if(o.instantiate.counterMode==="consume_global"){const C=c.rngCounter,I=kl(c.rngSeed,C);return c={...c,rngCounter:C+1},{value:I,before:C,after:c.rngCounter}}const E=d;return{value:kl(h,d++),before:E,after:d}},m={};for(const E of n.drawOrder){const w=o.propensities[E];if(!w)continue;const C=tS(w,g);m[E]=C.value,C.usedRng&&r.push({key:E,method:w.method,value:C.value,counterBefore:C.before,counterAfter:C.after})}const f={body:m.body??0,mind:m.mind??0,instinct:m.instinct??0},b=o.derivedStats||{},x=b.maxHp?ry(b.maxHp,m,f):Pl(f),T=m.speed??1,S=m.mass??1,A=o.runtimeDefaults?.startingHp==="explicit"?Math.max(0,o.runtimeDefaults.explicitHp??x):x,O=ra({id:a.actorId||iS(o),type:o.actorType,subtype:a.subtype||o.subtype,position:a.position,hp:A,maxHp:x,speed:T,factionId:a.factionId||o.factionId,weightClass:o.weightClass,skills:[...n.skillIds,...n.passiveSkillIds],trinity:f});let _=nS(O,o.skillLoadout.startCooldowns);o.runtimeDefaults?.temporaryArmor!==void 0&&(_={..._,temporaryArmor:Math.max(0,o.runtimeDefaults.temporaryArmor)}),o.runtimeDefaults?.isVisible!==void 0&&(_={..._,isVisible:o.runtimeDefaults.isVisible}),m.maxHp=x,m.speed=T,m.mass=S;for(const[E,w]of Object.entries(b))E!=="maxHp"&&(m[E]=ry(w,m,f));return{actor:_,stats:m,trinity:f,speed:T,mass:S,nextCursor:c,rollTrace:r}},sS=(e,n,a)=>aS(e,vv(n),a),oS=(e,n)=>{const a=Dl(n),o=zx(_l,wl),r=[],c=o,d=Math.floor(_l/2),h=on(d,wl-1),g=on(d,0);let m;if(e%1===0){const w=c.filter(C=>!se(C,h)&&!se(C,g)&&be(C,h)>=3);w.length>0&&(m=w[Math.floor(a.next()*w.length)])}const b=Math.floor(c.length*Kx),x=[],T={playerStart:h,stairsPosition:g,shrinePosition:m},A=[...c.filter(w=>!iy(w,T))].sort(()=>a.next()-.5);for(let w=0;w<b;w++)w<A.length&&x.push(A[w]);const O=c.filter(w=>!iy(w,{playerStart:h,stairsPosition:g,shrinePosition:m})&&!r.some(C=>se(C,w))&&!x.some(C=>se(C,w))&&be(w,h)>=3),_={id:"arena",type:"combat",center:on(Math.floor(_l/2),Math.floor(wl/2)),hexes:o,connections:[]},E=new Map;for(const w of o)E.set(`${w.q},${w.r}`,{baseId:"STONE",position:w,traits:new Set(_s.STONE.defaultTraits),effects:[]});for(const w of r)E.set(`${w.q},${w.r}`,{baseId:"WALL",position:w,traits:new Set(_s.WALL.defaultTraits),effects:[]});for(const w of x)E.set(`${w.q},${w.r}`,{baseId:"LAVA",position:w,traits:new Set(_s.LAVA.defaultTraits),effects:[]});return{rooms:[_],allHexes:o,stairsPosition:g,shrinePosition:m,spawnPositions:O,playerSpawn:h,tiles:E}},rS=(e,n,a)=>{Hg();const o=Dl(a+":enemies"),r=ny[Math.min(e,ny.length-1)],c=ad[e]||ad[Math.max(...Object.keys(ad).map(Number))];let d={rngSeed:`${a}:enemy-propensity`,rngCounter:0};const h=[];let g=r;const m=[];for(;g>0&&m.length<n.length;){const f=c.filter(D=>{const G=_d[D];return G&&G.cost<=g});if(f.length===0)break;const b=Math.floor(o.next()*f.length),x=f[b],T=_d[x],S=n.filter(D=>!m.some(G=>se(G,D)));if(S.length===0)break;const A=Math.floor(o.next()*S.length),O=S[A];m.push(O);const _=Math.floor(e/5),E=T.weightClass||"Standard",w=(d.rngCounter<<8)+h.length,C=`enemy_${h.length}_${ws(a,w,6,x)}`,I=Cv(x);let N;if(I){const D=sS(d,I,{actorId:C,position:O,subtype:x,factionId:"enemy"});d=D.nextCursor,N=D.actor}else N=dv({id:C,subtype:x,position:O,speed:T.speed||50,skills:mv(x),weightClass:E,enemyType:T.type});const H=_>0?{...N,hp:N.hp+_,maxHp:N.maxHp+_}:N;h.push({...H,subtype:x,enemyType:T.type,actionCooldown:T.actionCooldown??H.actionCooldown,isVisible:!0}),g-=T.cost}return h},lS=e=>Fx[e]||"inferno",na=(e,n)=>e.includes(n),cS=e=>{const n=new Set,a=e.id;return((e.baseVariables.damage||0)>0||/(ATTACK|THROW|BLAST|FIREBALL|BASH|PECK|EXPLOSION|SPEAR|SHOOT)/.test(a))&&n.add("damage"),/(MOVE|DASH|JUMP|ROLL|VAULT|STEP|GRAPPLE|WITHDRAWAL|WALK)/.test(a)&&n.add("move"),/(HEAL|ABSORB)/.test(a)&&n.add("heal"),/(SHIELD|PROTECT|BULWARK)/.test(a)&&n.add("protect"),/(STUN|TRAP|SMOKE|TELEGRAPH|ROOT|SWAP|SCOUT)/.test(a)&&n.add("control"),/(RAISE|FALCON|SUMMON)/.test(a)&&n.add("summon"),/(FIRE|LAVA|HAZARD|TRAP)/.test(a)&&n.add("hazard"),e.slot==="offensive"&&n.add("damage"),e.slot==="defensive"&&n.add("protect"),e.slot==="utility"&&n.add("utility"),(e.baseVariables.cooldown>0||e.baseVariables.cost>0)&&n.add("economy"),n.size||n.add("utility"),[...n]},uS={BASIC_MOVE:{intentTags:["move","objective","utility"],target:{pattern:"single"},estimates:{movement:1}},BASIC_ATTACK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:4}},AUTO_ATTACK:{intentTags:["damage","utility"],target:{pattern:"single"},estimates:{damage:2}},DASH:{intentTags:["move","damage","utility"],target:{pattern:"line"},estimates:{movement:2,damage:2},risk:{noProgressCastPenalty:5}},JUMP:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2},risk:{noProgressCastPenalty:6}},SHIELD_BASH:{intentTags:["damage","control","protect"],target:{pattern:"single"},estimates:{damage:3,control:2},risk:{requireEnemyContact:!0,noContactPenalty:5,noProgressCastPenalty:7}},BULWARK_CHARGE:{intentTags:["move","protect","damage"],target:{pattern:"line"},estimates:{movement:2,damage:4,shielding:2}},VAULT:{intentTags:["move","utility","control"],target:{pattern:"single"},estimates:{movement:3,control:2}},GRAPPLE_HOOK:{intentTags:["move","control"],target:{pattern:"line"},estimates:{movement:3,control:2}},SHIELD_THROW:{intentTags:["damage","control"],target:{pattern:"line"},estimates:{damage:6,control:2}},SPEAR_THROW:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:5}},ARCHER_SHOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:2},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:4}},FIREBALL:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:5,control:1}},FIREWALL:{intentTags:["hazard","control","damage"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:5,control:3}},FIREWALK:{intentTags:["move","hazard","utility"],target:{pattern:"single"},estimates:{movement:3},risk:{noProgressCastPenalty:8}},ABSORB_FIRE:{intentTags:["heal","hazard","utility"],target:{pattern:"self"},estimates:{healing:6},risk:{noProgressCastPenalty:2}},BOMB_TOSS:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:2}},TIME_BOMB:{intentTags:["damage","hazard","utility"],target:{pattern:"self"},estimates:{damage:6,control:1}},CORPSE_EXPLOSION:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:1}},RAISE_DEAD:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:5}},SOUL_SWAP:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:2}},MULTI_SHOOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5}},SET_TRAP:{intentTags:["control","hazard"],target:{pattern:"single"},estimates:{control:3}},SWIFT_ROLL:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2}},SNEAK_ATTACK:{intentTags:["damage","move"],target:{pattern:"single"},estimates:{damage:8,movement:2},risk:{requireEnemyContact:!0,noContactPenalty:3,noProgressCastPenalty:4}},SMOKE_SCREEN:{intentTags:["control","protect","utility"],target:{pattern:"radius",aoeRadius:1},estimates:{control:4,shielding:4}},SHADOW_STEP:{intentTags:["move","damage","utility"],target:{pattern:"single"},estimates:{movement:3,damage:3}},FALCON_COMMAND:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:4,control:2}},FALCON_PECK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:3}},FALCON_APEX_STRIKE:{intentTags:["damage","control"],target:{pattern:"single"},estimates:{damage:5,control:1}},FALCON_HEAL:{intentTags:["heal","utility"],target:{pattern:"single"},estimates:{healing:4}},FALCON_SCOUT:{intentTags:["control","utility"],target:{pattern:"self"},estimates:{control:3}},FALCON_AUTO_ROOST:{intentTags:["summon","utility"],target:{pattern:"self"},estimates:{summon:2}},KINETIC_TRI_TRAP:{intentTags:["control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{control:5,damage:4}},WITHDRAWAL:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:1}},SENTINEL_TELEGRAPH:{intentTags:["control","objective"],target:{pattern:"radius",aoeRadius:2},estimates:{control:3}},SENTINEL_BLAST:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:7}},THEME_HAZARDS:{intentTags:["hazard","control"],target:{pattern:"global"},estimates:{control:2}}},dS=(e,n)=>n?{...e,...n,target:{...e.target,...n.target||{}},estimates:{...e.estimates,...n.estimates||{}},economy:{...e.economy,...n.economy||{}},risk:{...e.risk,...n.risk||{}}}:e,fS=e=>{const n=cS(e),a=(na(n,"move"),"single"),o={id:e.id,intentTags:n,target:{range:Math.max(0,e.baseVariables.range||0),pattern:a},estimates:{damage:Math.max(0,e.baseVariables.damage||0),movement:na(n,"move")?Math.max(1,Math.min(3,e.baseVariables.range||1)):0,healing:na(n,"heal")?2:0,shielding:na(n,"protect")?1:0,control:na(n,"control")?1:0,summon:na(n,"summon")?1:0},economy:{cost:Math.max(0,e.baseVariables.cost||0),cooldown:Math.max(0,e.baseVariables.cooldown||0),consumesTurn:!0},risk:{selfExposure:na(n,"move")?.5:0,hazardAffinity:na(n,"hazard")?.5:0},complexity:1};return dS(o,uS[e.id])},mS=e=>{const n=[];return(!e.intentTags||e.intentTags.length===0)&&n.push("intentTags must not be empty"),(!Number.isFinite(e.target.range)||e.target.range<0)&&n.push("target.range must be >= 0"),e.target.pattern||n.push("target.pattern is required"),(!Number.isFinite(e.economy.cooldown)||e.economy.cooldown<0)&&n.push("economy.cooldown must be >= 0"),(!Number.isFinite(e.economy.cost)||e.economy.cost<0)&&n.push("economy.cost must be >= 0"),(!Number.isFinite(e.complexity)||e.complexity<0)&&n.push("complexity must be >= 0"),n},pS=e=>{const n=[],a=[];for(const[o,r]of Object.entries(e)){const c=r.intentProfile||fS(r);r.intentProfile=c;const d=mS(c);d.length>0&&a.push({skillId:o,errors:d}),c||n.push(o)}return{missing:n,invalid:a}},hS={id:"ABSORB_FIRE",name:"Absorb Fire",description:"Fire heals you instead of harming you.",slot:"passive",icon:"",baseVariables:{cost:0,cooldown:0,range:0},execute:(e,n,a)=>({effects:[],messages:[]}),getValidTargets:()=>[],upgrades:{}},yS={id:"grapple_hook",name:"Grapple Hook",description:"Tests for grapple hook mechanics including LoS, lava sinking, and weight-based behavior",scenarios:[{id:"hook_lava_intercept",title:"Lava Interceptor & LoS",description:"Verify LoS blocking and Lava killing targets.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["lava","line-of-sight","displacement"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},["GRAPPLE_HOOK"]),e.spawnEnemy("footman",{q:4,r:4,s:-8},"target1"),e.spawnEnemy("footman",{q:7,r:3,s:-10},"hidden"),e.setTile({q:6,r:4,s:-10},"wall"),e.setTile({q:4,r:5,s:-9},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:3,s:-10}),e.useSkill("GRAPPLE_HOOK",{q:4,r:4,s:-8}),e.wait(),e.wait()},verify:(e,n)=>{const a=e.player,o=e.enemies.find(c=>c.id==="target1"),r={playerInOriginalPosition:a.position.q===4&&a.position.r===6&&a.position.s===-10,target1Dead:!o,losWarning:n.some(c=>c.includes("Line of sight"))};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Logs:",n)),Object.values(r).every(c=>c===!0)}},{id:"hook_wall_anchor_zip",title:"Heavy Zip to Wall",description:"Verify zipping to a wall and stunning nearby enemies.",relatedSkills:["GRAPPLE_HOOK"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["wall","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK"]),e.setTile({q:6,r:3,s:-9},"wall"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"blocker"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"stunMe"),e.spawnEnemy("footman",{q:7,r:5,s:-12},"noStun")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:6,r:3,s:-9}),e.useSkill("GRAPPLE_HOOK",{q:6,r:6,s:-12})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="stunMe"),o=e.enemies.find(c=>c.id==="noStun"),r={stunnedEnemy:!!(a&&a.statusEffects.some(c=>c.type==="stunned")),safeEnemy:!!(o&&!o.statusEffects.some(c=>c.type==="stunned")),zipLog:n.some(c=>c.includes("Zipped")),lavaSinkLog:n.some(c=>c.includes("Lava Sink"))};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Player Pos:",e.player.position),console.log("Victim Status:",a?.statusEffects)),Object.values(r).every(c=>c===!0)}}]},gS={id:"shield_throw",name:"Shield Throw",description:"Tests for shield throw mechanics including push, stun, and collision behavior",scenarios:[{id:"shield_stun_push",title:"Standard Push",description:"Verify 4-tile push in a straight line.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="victim"),o={victimAt1:a?.position.r===1,victimStunned:n?.some(r=>r.includes("stunned"))};return Object.values(o).some(r=>r===!1)&&(console.log(" Shield Throw Failed:",o),console.log("Enemy Pos:",a?.position),console.log("Logs:",n)),Object.values(o).every(r=>r===!0)}},{id:"shield_unit_collision",title:"Unit Collision",description:"Verify push stops when hitting another unit.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim"),e.spawnEnemy("shieldbearer",{q:3,r:3,s:-6},"obstacle"),e.setTile({q:3,r:1,s:-4},"lava")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="victim"),o=e.enemies.find(c=>c.id==="obstacle"),r={victimPushed:(a?.position.r??5)===3,obstacleDead:!o};return Object.values(r).some(c=>c===!1)&&(console.log(" Shield Throw Failed:",r),console.log("Victim Pushed:",r.victimPushed),console.log("Victim Pos:",a?.position),console.log("Obstacle Dead:",r.obstacleDead),console.log("Logs:",n)),Object.values(r).every(c=>c===!0)}}]},bS={id:"auto_attack",name:"Auto Attack",description:"Tests for auto-attack passive skill including turn-start memory and friendly fire logic",scenarios:[{id:"auto_attack_persistence_stress_test",title:"Persistence: Three-Point Validation",description:"Verifies that Auto-Attack only hits units that were adjacent at BOTH start and end.",relatedSkills:["AUTO_ATTACK","BASIC_MOVE"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","spatial-memory","edge-case"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["AUTO_ATTACK","BASIC_MOVE"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"persistent_foe"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"new_neighbor"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"former_neighbor"),e.state.player.previousPosition={q:4,r:5,s:-9}},run:e=>{e.move({q:4,r:6,s:-10})},verify:(e,n)=>{const a=e.enemies.find(d=>d.id==="persistent_foe"),o=e.enemies.find(d=>d.id==="new_neighbor"),r=e.enemies.find(d=>d.id==="former_neighbor"),c={persistentDead:!a||a.hp<a.maxHp,ignoredNew:o&&o.hp===o.maxHp,ignoredFormer:r&&r.hp===r.maxHp,logFound:n.some(d=>d.includes("attacked footman"))};return Object.values(c).some(d=>d===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n)),Object.values(c).every(d=>d===!0)}},{id:"enemy_auto_attack_no_friendly_fire",title:"Enemy Auto-Attack: Team Alignment",description:"Ensures enemy passives only target the player and not their own allies.",relatedSkills:["AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","alignment","friendly-fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},[]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"enemy_attacker");const n=e.state.enemies.find(a=>a.id==="enemy_attacker");n&&(n.activeSkills=[{id:"AUTO_ATTACK",range:1}],n.previousPosition={q:3,r:5,s:-8}),e.spawnEnemy("shieldBearer",{q:2,r:6,s:-8},"enemy_ally"),n.previousPosition={q:3,r:5,s:-8},e.state.player.previousPosition={q:3,r:6,s:-9}},run:e=>{e.wait()},verify:(e,n)=>{const a=e.player,o=e.enemies.find(c=>c.id==="enemy_ally"),r={playerHit:a.hp<a.maxHp,allySafe:o&&o.hp===o.maxHp,hitPlayerLog:n.some(c=>c.includes("attacked you")),hitAllyLog:!n.some(c=>c.includes("attacked enemy_ally"))};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n)),Object.values(r).every(c=>c===!0)}}]},xS={id:"integration",name:"Integration Tests",description:"Multi-skill integration scenarios testing complex interactions",scenarios:[{id:"environmental_chain_reaction",title:"Environmental Chain Reaction",description:"Test complex environmental interactions with multiple hazards",relatedSkills:["GRAPPLE_HOOK","SHIELD_THROW"],category:"hazards",difficulty:"advanced",isTutorial:!1,tags:["lava","wall","environmental-kill","chain-reaction"],setup:e=>{e.setPlayer({q:5,r:4,s:-9},["GRAPPLE_HOOK","SHIELD_THROW"]),e.spawnEnemy("shieldbearer",{q:5,r:2,s:-7},"victim1"),e.spawnEnemy("footman",{q:5,r:6,s:-11},"victim2"),e.spawnEnemy("footman",{q:5,r:7,s:-12},"victim3"),e.setTile({q:5,r:8,s:-13},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:5,r:2,s:-7}),e.useSkill("SHIELD_THROW",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.player.position.q===5&&e.player.position.r===3,o=!e.enemies.find(m=>m.id==="victim3")||!!e.dyingEntities?.find(m=>m.id==="victim3"),r=!e.enemies.find(m=>m.id==="victim2")||!!e.dyingEntities?.find(m=>m.id==="victim2"),c=e.enemies.find(m=>m.id==="victim1"),d=c&&n.some(m=>m.includes("stunned")),h=c&&c.position.q===5&&c.position.r===6,g=[a,o,r,d,h];return Object.values(g).some(m=>m===!1)&&(console.log(" Environmental Chain Reaction Failed:",g),console.log("Player at 5,3:",a),console.log("Player Pos:",e.player.position),console.log("Logs found:",n),console.log("Victim1 at 5,6:",h),console.log("Victim1 Pos:",c?.position),console.log("Victim1 Stunned:",d),console.log("Victim2 Dead:",r),console.log("Victim3 Dead:",o)),Object.values(g).every(m=>m===!0)}},{id:"auto_attack_after_grapple",title:"Auto-Attack After Grapple",description:"Verify auto-attack triggers correctly after grapple displacement",relatedSkills:["GRAPPLE_HOOK","AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","displacement","integration"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK","AUTO_ATTACK"]),e.state.player.previousPosition={q:4,r:6,s:-10},e.spawnEnemy("footman",{q:7,r:6,s:-13},"grappleHookTarget"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"safe"),e.spawnEnemy("footman",{q:4,r:5,s:-9},"auto-attacked"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"safe2")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:6,s:-13})},verify:(e,n)=>{const a=e.enemies.find(h=>h.id==="grappleHookTarget"),o=e.enemies.find(h=>h.id==="auto-attacked"),r=e.enemies.find(h=>h.id==="safe"),c=e.enemies.find(h=>h.id==="safe2"),d={targetPulled:!!(a&&a.position.q<7),targetNotHit:!!(a&&a.hp===a.maxHp),safeNotHit:!!(r&&r.hp===r.maxHp),safe2NotHit:!!(c&&c.hp===c.maxHp),autoattackedDead:!o||o.hp<=0};return Object.values(d).some(h=>h===!1)&&(console.log(" Scenario Failed Details:",d),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n),console.log("target Pos:",a?.position.q),console.log("target Pulled:",d.targetPulled),console.log("target Not Hit:",d.targetNotHit),console.log("safe Not Hit:",d.safeNotHit),console.log("safe2 Not Hit:",d.safe2NotHit),console.log("autoattacked Dead:",d.autoattackedDead)),Object.values(d).every(h=>h===!0)}}]},vS="modulepreload",SS=function(e){return"/Hop/"+e},ly={},AS=function(n,a,o){let r=Promise.resolve();if(a&&a.length>0){let m=function(f){return Promise.all(f.map(b=>Promise.resolve(b).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};var d=m;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),g=h?.nonce||h?.getAttribute("nonce");r=m(a.map(f=>{if(f=SS(f),f in ly)return;ly[f]=!0;const b=f.endsWith(".css"),x=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${x}`))return;const T=document.createElement("link");if(T.rel=b?"stylesheet":vS,b||(T.as="script"),T.crossOrigin="",T.href=f,g&&T.setAttribute("nonce",g),document.head.appendChild(T),b)return new Promise((S,A)=>{T.addEventListener("load",S),T.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${f}`)))})}))}function c(h){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=h,window.dispatchEvent(g),!g.defaultPrevented)throw h}return r.then(h=>{for(const g of h||[])g.status==="rejected"&&c(g.reason);return n().catch(c)})},TS=async(e,n)=>{if(typeof window>"u")try{(await AS(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])).appendFileSync(e,n)}catch(a){console.warn(`Failed to persist log to ${e}:`,a)}},ES={id:"basic_attack",name:"Basic Attack",description:"Tests for basic melee attack mechanics including range and move-to-attack logic",scenarios:[{id:"basic_attack_player_mechanics",title:"Player Basic Attack: Range & Bump",description:"Validates range enforcement, turn accounting, and bump-attack redirection.",relatedSkills:["BASIC_ATTACK"],category:"combat",tags:["melee","targeting","bump-attack"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"far_victim")},run:e=>{e.useSkill("BASIC_ATTACK",{q:3,r:4,s:-7}),e.move({q:3,r:5,s:-8})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="adj_victim"),o=e.enemies.find(c=>c.id==="far_victim"),r={farStaysAlive:o&&o.hp===o.maxHp,rangeError:n.some(c=>c.includes("out of range")),adjTookDamage:!a||a.hp<=a.maxHp,playerPositionHeld:se(e.player.position,{q:3,r:6,s:-9}),oneTurnConsumed:e.turnsSpent===1};if(Object.values(r).some(c=>c===!1)){const c=` Basic Attack Failed: ${JSON.stringify(r)}
Current Player Pos: ${JSON.stringify(e.player.position)}
Logs: ${JSON.stringify(n)}
`;console.log(c),TS("integration_debug.txt",c)}return Object.values(r).every(c=>c===!0)}}]},_S={id:"spear_throw",name:"Spear Throw",description:"Tests for spear throw mechanics including range, LoS, and spear retrieval",scenarios:[{id:"spear_kill",title:"Spear Kill",description:"Throw spear to kill an enemy and verify item spawn.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["projectile","combat","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:3,r:4,s:-7},"target"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=!e.enemies.find(c=>c.id==="target"),o=!!e.spearPosition&&e.spearPosition.q===3&&e.spearPosition.r===4,r=n.some(c=>c.includes("Spear killed"));return a&&o&&r}},{id:"spear_miss_spawn",title:"Spear Rejects Empty Tile",description:"Enemy-only contract: empty tiles are invalid targets and do not spawn spear.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=n.some(r=>r.includes("No enemy at target.")),o=e.hasSpear===!0&&!e.spearPosition;return a&&o}},{id:"spear_wall_block",title:"Spear Wall Block",description:"Spear throw is blocked by walls.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["projectile","wall","boundary"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),e.setTile({q:4,r:4,s:-8},"wall"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:4,r:3,s:-7})},verify:(e,n)=>{const a=n.some(c=>c.includes("No clear line of sight to enemy.")),o=!!e.enemies.find(c=>c.id==="target"),r=e.hasSpear===!0&&!e.spearPosition;return a&&o&&r}}]},wS={id:"dash",name:"Dash",description:"Tests for dash mechanics including path validation and shield-based enemy shunting",scenarios:[{id:"dash_shunt_lava",title:"Shunt into Lava",description:"Shunt an enemy into lava for an environmental kill.",relatedSkills:["DASH"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:5,s:-8},["DASH"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"victim"),e.setTile({q:7,r:5,s:-12},"lava"),e.state.hasShield=!0},run:e=>{e.useSkill("DASH",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="victim"),o={playerPosition:e.player.position.q===5&&e.player.position.r===5,victimDead:!a};return Object.values(o).some(r=>r===!1)&&(console.log(" Dash Shunt Lava Failed:",o),console.log("Final State:",e.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",n)),Object.values(o).every(r=>r===!0)}},{id:"dash_comprehensive_validation",title:"Dash: Constraints & Shunt Physics",description:"Validates range limits, wall blocking, and Shield Shunt displacement in one sequence.",relatedSkills:["DASH"],category:"movement",difficulty:"advanced",isTutorial:!1,tags:["stress-test","collision","range"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["DASH"]),e.state.hasShield=!0,e.setTile({q:4,r:4,s:-8},"wall"),e.setTile({q:6,r:5,s:-11},"wall"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"victim")},run:e=>{e.useSkill("DASH",{q:4,r:7,s:-11}),e.useSkill("DASH",{q:7,r:4,s:-11}),e.useSkill("DASH",{q:6,r:6,s:-12}),e.useSkill("DASH",{q:4,r:5,s:-9})},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="victim"),o={finalPositionCorrect:e.player.position.q===4&&e.player.position.r===6,victimPushed:!!(a&&a.position.q===4&&a.position.r===5),wallErrorFound:n.some(r=>r.includes("wall blocks")),axialRangeErrorFound:n.some(r=>r.includes("Axial only!")),shuntSuccess:n.some(r=>r.includes("Shield Shunt")),twoTurnSpent:e.turnsSpent===2};return Object.values(o).some(r=>r===!1)&&(console.log(" Dash Stress Test Failed:",o),console.log("Final State:",e.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",n)),Object.values(o).every(r=>r===!0)}}]},MS={id:"jump",name:"Jump",description:"Tests for jump mechanics including range validation and stunning landing",scenarios:[{id:"jump_basic",title:"Basic Jump",description:"Jump to a tile.",relatedSkills:["JUMP"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","leap"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.setTile({q:3,r:5,s:-8},"lava")},run:e=>{e.useSkill("JUMP",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=se(e.player.position,{q:3,r:4,s:-7}),o=wd(e.occupancyMask,{q:3,r:4}),r=!wd(e.occupancyMask,{q:3,r:6}),c={playerInPosition:a,spatialMaskRefreshed:o&&r,noLavaDamage:e.player.hp===e.player.maxHp,jumpedSuccessfully:n.some(d=>d.includes("Jumped"))};return Object.values(c).some(d=>d===!1)&&(console.error(" Jump Basic Failed:",c),console.error("Final State:",e.player.position),console.error("Logs:",n)),Object.values(c).every(d=>d===!0)}},{id:"jump_stunning_landing",title:"Stunning Landing",description:"Jump into a group of enemies and ensure neighbors are stunned.",relatedSkills:["JUMP"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["movement","stun","aoe"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.addUpgrade("JUMP","STUNNING_LANDING"),e.spawnEnemy("footman",{q:3,r:7,s:-10},"neighbor_1"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"neighbor_2"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"distant_enemy")},run:e=>{e.useSkill("JUMP",{q:3,r:8,s:-11})},verify:(e,n,a=[])=>{const o={n1StunnedMessage:n.some(r=>r.includes("stunned by landing impact")),hasShakeJuice:a.some(r=>r.type==="shake"),hasStunBurstVFX:a.some(r=>r.type==="vfx"&&r.payload.type==="stunBurst"),hasStunnedCombatText:a.some(r=>r.type==="combat_text"&&r.payload.text==="STUNNED"),playerAtTarget:se(e.player.position,{q:3,r:8,s:-11}),oneTurnSpent:e.turnsSpent===1};return Object.values(o).some(r=>r===!1)&&(console.error(" Jump Stunning Landing Failed:",o),console.error("Final State:",e.player.position),console.error("turnsSpent:",e.turnsSpent),console.error("Logs:",n)),Object.values(o).every(r=>r===!0)}}]},OS={id:"shield_bash",name:"Shield Bash",description:"Tests for shield bash mechanics including push, stun, and collision behavior",scenarios:[{id:"bash_push",title:"Shield Push",description:"Push an enemy into lava.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","lava"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.setTile({q:3,r:4,s:-7},"lava"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,n)=>{const a={enemyGone:e.enemies.length===0,messageOk:n.some(o=>o.includes("Lava"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n)),Object.values(a).every(o=>o===!0)}},{id:"bash_wall_stun",title:"Wall Slam Stun",description:"Bash enemy into wall to cause a stun.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"victim"),e.setTile({q:3,r:4,s:-7},"wall")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="victim");if(!a)return!1;const o=se(a.position,{q:3,r:5,s:-8}),r=n.some(c=>c.includes("into obstacle"));return o&&r}}]},CS={id:"bulwark_charge",name:"Bulwark Charge",description:"Tests for bulwark charge mechanics including chain pushing and wall slamming",scenarios:[{id:"chain_stun",title:"The Chain-Stun",description:"Wall prevents chain movement, causing all members to be stunned.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["chain","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,n)=>!0},{id:"bulwark_chain_push",title:"Bulwark Chain Push",description:"Push a chain of enemies successfully.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["chain","push","displacement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"A"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"B"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,n)=>!0}]},kS={id:"vault",name:"Vault",description:"Tests for vault mechanics including state-shifting behavior between odd and even turns",scenarios:[{id:"vault_shift_stun",title:"Vault Stun (Odd Turn)",description:"Verify vault stuns neighbors on Turn 1.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","stun","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>{const a={stunned:n.some(o=>o.includes("Stun Vault executed!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Stun Failed:",a),console.log("Logs:",n)),Object.values(a).every(o=>o===!0)}},{id:"vault_shift_normal",title:"Vault Normal (Even Turn)",description:"Verify vault is normal on Turn 2.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:3,s:-7},"victim")},run:e=>{e.wait(),e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>{const a={vaulted:n.some(o=>o.includes("Vaulted!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Normal Failed:",a),console.log("Logs:",n)),Object.values(a).every(o=>o===!0)}}]},NS={id:"basic_move",name:"Basic Move",description:"Fundamental movement mechanics",scenarios:[{id:"walk_to_tile",title:"Movement 101",description:"Move your character from the center to an adjacent tile.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","basics"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.setTile({q:4,r:6,s:-10},"wall")},run:e=>{e.move({q:4,r:6,s:-10}),e.move({q:4,r:4,s:-8})},verify:(e,n)=>{const a={positionCorrect:se(e.player.position,{q:4,r:4,s:-8}),logFound:n.some(o=>o.includes("blocked")),oneTurnSpent:e.turnsSpent===1};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Final Position:",e.player.position),console.log("Logs found:",n)),Object.values(a).every(o=>o===!0)}},{id:"free_move_out_of_combat",title:"Exploration Mode",description:"Verify that movement range expands only when no enemies are present.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["movement","exploration","free-move"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE","BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim")},run:e=>{e.move({q:7,r:1,s:-8}),e.useSkill("BASIC_ATTACK",{q:3,r:5,s:-8}),e.move({q:7,r:1,s:-8})},verify:(e,n)=>{const a=n.filter(c=>c.toLowerCase().includes("out of reach")).length,o=n.some(c=>c.toLowerCase().includes("you attacked")),r={wasBlockedInitially:a===1,attackLogs:o,reachedDistantHex:se(e.player.position,{q:7,r:1,s:-8})};return Object.values(r).some(c=>c===!1)&&(console.log(" Free Move Scenario Failed:",r),console.log("Final Position:",e.player.position),console.log("Logs found:",n)),Object.values(r).every(c=>c===!0)}},{id:"invalid_enemy_move_intent_is_rejected_pre_execution",title:"Move Intent Rejected Before Execution",description:"Enemy AI may decide to move, but execution must not run a skill the actor does not own.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["movement","validation","intent"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"attacker_without_move");const n=e.getEnemy("attacker_without_move");n&&(n.activeSkills=(n.activeSkills||[]).filter(a=>a.id!=="BASIC_MOVE"))},run:e=>{e.wait()},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="attacker_without_move"),o={enemyDidNotMove:!!a&&se(a.position,{q:7,r:5,s:-12}),noMissingSkillRuntimeError:!n.some(r=>r.includes("does not have skill BASIC_MOVE"))};return Object.values(o).some(r=>r===!1)&&(console.log("Invalid Enemy Move Intent Rejection Failed:",o),console.log("Enemy:",a),console.log("Logs:",n)),Object.values(o).every(r=>r===!0)}},{id:"single_enemy_single_action_per_turn",title:"Single Action Per Actor Turn",description:"Each actor resolves exactly one action per turn in normal flow.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["turn-loop","movement","integrity"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"single_actor")},run:e=>{e.wait()},verify:(e,n)=>{const a={q:7,r:5,s:-12},o=e.enemies.find(d=>d.id==="single_actor"),r=o?be(a,o.position):-1,c={enemyExists:!!o,movedExactlyOneTile:r===1,noZeroEffectMoveWarning:!n.some(d=>d.includes("produced ZERO effects"))};return Object.values(c).some(d=>d===!1)&&(console.log("Single Action Per Actor Turn Failed:",c),console.log("Enemy:",o),console.log("Logs:",n)),Object.values(c).every(d=>d===!0)}}]},ia=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},SENTINEL_TELEGRAPH:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Telegraph",description:"Marks blast zone."},SENTINEL_BLAST:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Blast",description:"Massive area blast."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},RS={id:"sentinel_blast",name:"Sentinel Blast",description:"Sentinel unique area-of-effect attack",scenarios:[{id:"blast_aoe",title:"Blast Away",description:"Use Sentinel Blast to hit multiple enemies.",relatedSkills:["SENTINEL_BLAST"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["aoe","damage","sentinel"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SENTINEL_BLAST"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"center"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"side")},run:e=>{e.useSkill("SENTINEL_BLAST",{q:3,r:5,s:-8})},verify:(e,n)=>n.some(a=>a.includes("massive blast"))},{id:"sentinel_playlist_two_turn_timing",title:"Playlist: Telegraph then Execute",description:"Boss uses a 2-turn skill playlist: telegraph first, blast on next turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["boss","playlist","telegraph"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const n=e.getEnemy("boss");n&&(n.activeSkills=[ia("BASIC_MOVE"),ia("BASIC_ATTACK"),ia("SENTINEL_TELEGRAPH"),ia("SENTINEL_BLAST")])},run:e=>{e.wait(),e.logs.push(`HP_AFTER_TELEGRAPH=${e.state.player.hp}`),e.wait()},verify:(e,n)=>{const a=n.find(c=>c.startsWith("HP_AFTER_TELEGRAPH=")),o=a?Number(a.split("=")[1]):-1,r={telegraphEmitted:n.some(c=>c.includes("marks the impact zone")),executeEmitted:n.some(c=>c.includes("massive blast")),noDamageOnTelegraphTurn:o===e.player.maxHp,damageOnExecuteTurn:e.player.hp<e.player.maxHp};return Object.values(r).some(c=>c===!1)&&(console.log("Sentinel Playlist Timing Failed:",r),console.log("Logs:",n),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(r).every(c=>c===!0)}},{id:"sentinel_playlist_interruption_by_stun",title:"Playlist: Interruption Cancels Execute",description:"Stunning the boss during telegraph cancels the follow-up execute turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["boss","playlist","interruption","stun"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const n=e.getEnemy("boss");n&&(n.activeSkills=[ia("BASIC_MOVE"),ia("BASIC_ATTACK"),ia("SENTINEL_TELEGRAPH"),ia("SENTINEL_BLAST")])},run:e=>{e.wait(),e.applyStatus("boss","stunned",1),e.wait()},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="boss"),o={telegraphEmitted:n.some(r=>r.includes("marks the impact zone")),executeCancelled:!n.some(r=>r.includes("massive blast")),playerUnharmed:e.player.hp===e.player.maxHp,bossStillExists:!!a};return Object.values(o).some(r=>r===!1)&&(console.log("Sentinel Playlist Interruption Failed:",o),console.log("Logs:",n),console.log("Player HP:",e.player.hp,"/",e.player.maxHp),console.log("Boss:",a)),Object.values(o).every(r=>r===!0)}}]},IS={id:"fireball",name:"Fireball",description:"Validates axial targeting, AoE damage, and environmental fire placement.",scenarios:[{id:"fireball_axial_aoe",title:"Axial Alignment & AoE Spread",description:"Verify the skill only fires axially and damages all neighbors at the impact site.",relatedSkills:["FIREBALL"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["aoe","axial","fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["FIREBALL"]),e.spawnEnemy("footman",{q:5,r:4,s:-9},"primary_target"),e.spawnEnemy("footman",{q:6,r:4,s:-10},"neighbor_target"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"diagonal_enemy"),e.setTile({q:6,r:3,s:-9},"wall"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava")},run:e=>{e.useSkill("FIREBALL",{q:7,r:5,s:-12}),e.useSkill("FIREBALL",{q:5,r:4,s:-9})},verify:()=>!0},{id:"fireball_max_range_edge",title:"Max Range & Fire Duration",description:"Verify fireball at exactly range 3 and check fire duration persistence.",relatedSkills:["FIREBALL"],category:"balancing",difficulty:"intermediate",isTutorial:!1,tags:["range","persistence"],setup:e=>{e.setPlayer({q:0,r:0,s:0},["FIREBALL"]),e.setTile({q:0,r:3,s:-3},"grass")},run:e=>{e.useSkill("FIREBALL",{q:0,r:3,s:-3}),e.wait(),e.wait()},verify:()=>!0}]},LS={id:"hazards_v1",name:"Hazard Consolidation",description:"Verifies centralized hazard logic and flight immunity",scenarios:[{id:"Jump Over Lava",title:"Jump Over Lava",description:"Jumping over lava should not result in damage.",relatedSkills:["JUMP"],category:"hazards",tags:["lava","jump"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["JUMP"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("JUMP",{q:4,r:7,s:-11})},verify:e=>{const n=e.player,a={playerPos:se(n.position,{q:4,r:7,s:-11}),isAlive:n.hp===n.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Walk Into Lava",title:"Walk Into Lava",description:"Walking into lava should be invalid unless the mover is hazard-safe.",relatedSkills:["BASIC_MOVE"],category:"hazards",tags:["lava","walk"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["BASIC_MOVE"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:8,s:-12})},verify:e=>{const n=e.player,a={playerPos:se(n.position,{q:4,r:9,s:-13}),hpUnchanged:n.hp===n.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Falcon Flying Over Lava",title:"Falcon Flying Over Lava",description:"Flying units (Falcon) should ignore lava during transit and stay.",relatedSkills:["FALCON_COMMAND"],category:"hazards",tags:["lava","falcon","flight"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.wait()},verify:e=>{const n=e.enemies.find(o=>o.id==="my-falcon"),a={falconExists:!!n,falconAlive:(n?.hp||0)>0,falconPos:se(n?.position,{q:4,r:8,s:-12})};return Object.values(a).every(o=>o===!0)}}]},HS={id:"falcon_command_v2",name:"Falcon's Command",description:"Validates Predator/Scout mode transitions and spatial orbit logic.",scenarios:[{id:"falcon_predator_strike_path",title:"Predator Mode: Apex Strike Geometry",description:`
                Tests the Falcon's flight path from its current position to the Target.
                Layout:
                   (F)  <- Falcon Start (6, 5, -11)
                      .
                         (T) <- Target/Prey (8, 5, -13)
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:2,s:-6},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:2,s:-6}),e.wait()},verify:(e,n)=>{const a=e.companions?.find(c=>c.id==="my-falcon"),o=e.enemies.find(c=>c.id==="prey"),r={modeSet:a?.companionState?.mode==="predator",targetLocked:a?.companionState?.markTarget==="prey",movedCloser:a&&be(a.position,{q:4,r:2,s:-6})<7,preyHealthy:o?.hp===o?.maxHp,turnSpent:e.turnsSpent===2};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Falcon Predator Strike Failed:",r),console.log("Falcon:",a)),Object.values(r).every(c=>c===!0)}},{id:"falcon_scout_orbit",title:"Scout Mode: Hex Ring Orbit",description:`
                Ensures that in Scout mode, the Falcon rotates around the mark 
                on the flat-top hex ring.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:3,r:6,s:-9}),e.wait(),e.wait()},verify:(e,n)=>{const a=e.companions?.find(c=>c.id==="my-falcon"),o={q:3,r:6,s:-9},r={isScout:a?.companionState?.mode==="scout",onOrbitRing:a&&be(a.position,o)===1,hasRotated:a&&!!a.previousPosition&&!se(a.position,a.previousPosition),turnSpent:e.turnsSpent===3};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Falcon Scout Orbit Failed:",r),console.log("Falcon:",a)),Object.values(r).every(c=>c===!0)}},{id:"falcon_roost_mode",title:"Roost Mode: Return and Heal",description:`
                Ensures that when targeting self, the Falcon returns to the Hunter
                and provides a heal on arrival.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","roost","heal"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=2,e.spawnFalcon({q:3,r:6,s:-9},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:9,s:-13}),e.wait(),e.wait()},verify:(e,n)=>{const a=e.companions?.find(c=>c.id==="my-falcon"),o=e.player,r={modeRoost:a?.companionState?.mode==="roost",healed:o.hp>2,closeToHunter:a&&be(a.position,o.position)<=1};return Object.values(r).some(c=>c===!1)&&console.log(" Scenario Falcon Roost Heal Failed:",r),Object.values(r).every(c=>c===!0)}},{id:"falcon_predator_auto_return",title:"Predator Mode: Auto-Roost on Kill",description:`
                Ensures that if a marked predator target dies, the Falcon
                automatically reverts to Roost mode.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!0,tags:["falcon","predator","cleanup"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=1,e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:7,s:-11}),e.wait(),e.wait(),e.wait()},verify:(e,n)=>{const a=e.companions?.find(d=>d.id==="my-falcon"),o=e.enemies.find(d=>d.id==="prey"),r=e.player,c={preyDead:!o,autoRoost:a?.companionState?.mode==="roost",healed:r.hp>1};return Object.values(c).some(d=>d===!1),Object.values(c).every(d=>d===!0)}},{id:"falcon_command_metadata_null_safety",title:"Command Metadata Null-Safety",description:`
                Ensures FALCON_COMMAND name/description resolution is safe
                when player context is remapped in harness-like states.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["falcon","null-safety","metadata"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.id="hunter_remapped"},run:e=>{e.wait()},verify:(e,n)=>{const a={playerIdRemapped:e.player.id==="hunter_remapped",noRuntimeReferenceError:!n.some(o=>o.toLowerCase().includes("cannot read properties"))};return Object.values(a).some(o=>o===!1)&&console.log("Falcon Command Metadata Null-Safety Failed:",a),Object.values(a).every(o=>o===!0)}}]},BS={id:"kinetic_tri_trap",name:"Kinetic Tri-Trap",description:"Tests for trap deployment and fling mechanics",scenarios:[{id:"tri_trap_basic_deployment",title:"Trap Deployment",description:"Deploy 3 traps on axial tiles at range 2.",relatedSkills:["KINETIC_TRI_TRAP"],category:"deployment",difficulty:"beginner",isTutorial:!0,tags:["trap","deployment"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.player.position,o=e.traps||[],r={countIsThree:o.length===3,isAtRangeTwo:o.every(c=>be(c.position,a)===2),isAxialToPlayer:o.every(c=>c.position.q===a.q||c.position.r===a.r||c.position.s===a.s),trapsHidden:o.every(c=>!c.isRevealed)};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Tri-Trap Deployment Failed:",r),console.log("Traps:",e.traps),console.log("Logs:",n)),Object.values(r).every(c=>c===!0)}},{id:"tri_trap_state_tracking",title:"Trap State Tracking",description:"Traps are tracked with correct owner and hidden state.",relatedSkills:["KINETIC_TRI_TRAP"],category:"state",difficulty:"intermediate",isTutorial:!1,tags:["trap","state"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10}),e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.traps,o={trapsExist:a&&a.length>0,allHidden:a?.every(r=>!r.isRevealed)??!1,allZeroCooldown:a?.every(r=>r.cooldown===0)??!1,deployMessage:n.some(r=>r.includes("trap")||r.includes("Trap")),trapsCount:a?.length===3};return Object.values(o).some(r=>r===!1)&&(console.log(" Trap State Failed:",o),console.log("Traps:",e.traps)),Object.values(o).every(r=>r===!0)}}]},jS={id:"withdrawal",name:"Withdrawal",description:"Tests for shot + backroll mechanics and passive reaction",scenarios:[{id:"withdrawal_basic",title:"Shot and Backroll",description:"Shoot adjacent enemy and backroll to safety.",relatedSkills:["WITHDRAWAL"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["shot","backroll","displacement"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="target"),o={enemyDamagedOrDead:!a||a.hp<a.maxHp,playerMoved:e.player.position.q!==5||e.player.position.r!==5,playerBackrolled:e.player.position.q<5,shotFired:n.some(r=>r.includes("Withdrawal")||r.includes("shot"))};return Object.values(o).some(r=>r===!1)&&(console.log(" Withdrawal Failed:",o),console.log("Player:",e.player.position),console.log("Target HP:",a?.hp)),Object.values(o).every(r=>r===!0)}},{id:"withdrawal_wall_block",title:"Backroll Blocked by Wall",description:"Backroll finds alternate safe spot when wall blocks retreat.",relatedSkills:["WITHDRAWAL"],category:"collision",difficulty:"intermediate",isTutorial:!1,tags:["backroll","wall","pathfinding"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.setTile({q:4,r:5,s:-9},"wall"),e.setTile({q:3,r:5,s:-8},"wall"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,n)=>{const a={playerNotOnWall:!se(e.player.position,{q:4,r:5,s:-9}),playerMoved:e.player.position.q!==5||e.player.position.r!==5};return Object.values(a).some(o=>o===!1)&&(console.log(" Wall Block Failed:",a),console.log("Player:",e.player.position)),Object.values(a).every(o=>o===!0)}}]},DS={id:"absorb_fire",name:"Absorb Fire Passive",description:"Verifies that fire damage is converted to healing.",scenarios:[{id:"Absorb Fire Damage",title:"Stand on Fire",description:"Player with Absorb Fire should be healed when standing on fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",tags:["fire","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE"]),e.state.player.hp=1,e.setTile({q:4,r:5,s:-9},"stone");const n={q:4,r:5,s:-9},a=e.getTileAt(n);a&&a.effects.push({id:"FIRE",duration:3,potency:1})},run:e=>{e.wait()},verify:e=>{const n=e.player;return n.hp<=1&&console.log("Stand on Fire Failed: HP did not increase",n.hp),n.hp>1}},{id:"Absorb Lava Damage",title:"Walk into Lava",description:"Player with Absorb Fire should be healed when walking into lava.",relatedSkills:["ABSORB_FIRE","BASIC_MOVE"],category:"passive",tags:["lava","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE","BASIC_MOVE"]),e.state.player.hp=1,e.setTile({q:4,r:6,s:-10},"lava")},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:6,s:-10})},verify:e=>{const n=e.player,a={alive:n.hp>0,healed:n.hp===n.maxHp,onLava:se(n.position,{q:4,r:6,s:-10})};return(!a.alive||!a.healed||!a.onLava)&&(console.log("Walk into Lava Failed:",a,"HP:",n.hp,"MaxHP:",n.maxHp),console.log("Player Pos:",n.position)),Object.values(a).every(o=>o===!0)}}]},PS={id:"tile_interactions",name:"Tile Interactions",description:"Verifies interactions with special tiles like Shrines and Stairs.",scenarios:[{id:"shrine_interaction",title:"Shrine Interaction",description:"Moving onto a shrine should trigger an upgrade choice.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["shrine","upgrade"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.shrinePosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"SHRINE",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","SHRINE"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const n={playerOnShrine:se(e.player.position,{q:4,r:6,s:-10}),isChoosingUpgrade:e.pendingStatus?.status==="choosing_upgrade",hasOptions:e.pendingStatus?.shrineOptions?.length>0};return Object.values(n).every(a=>a===!0)}},{id:"stairs_interaction",title:"Stairs Interaction",description:"Moving onto stairs should trigger level transition.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["stairs","portal"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.stairsPosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"STAIRS",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","STAIRS"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const n={playerOnStairs:se(e.player.position,{q:4,r:6,s:-10}),isTransitioning:e.pendingStatus?.status==="playing"||e.pendingStatus?.status==="won",messageFound:e.message.some(a=>a.includes("Descending")||a.includes("Cleared"))};return Object.values(n).every(a=>a===!0)}}]},US={id:"telegraph_projection",name:"Telegraph Projection",description:"Deterministic intent previews for next-turn danger tiles.",scenarios:[{id:"telegraph_projection_is_deterministic",title:"Projection Determinism",description:"Same state should always produce the same danger projection.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","determinism"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"threat")},run:e=>{e.wait()},verify:e=>{const n=e.intentPreview,a=n?.dangerTiles||[],o=n?.projections||[],r=a.map(f=>`${f.q},${f.r},${f.s}`),c=new Set(r),d=r.every((f,b)=>b===0||r[b-1].localeCompare(f)<=0),h=o.map(f=>`${f.actorId}|${f.skillId}|${f.targetHex?`${f.targetHex.q},${f.targetHex.r},${f.targetHex.s}`:"none"}`),g=h.every((f,b)=>b===0||h[b-1].localeCompare(f)<=0),m={hasEnginePreview:!!n,noDuplicateTiles:c.size===r.length,tilesAreSorted:d,projectionsAreSorted:g};return Object.values(m).some(f=>f===!1)&&(console.log("Telegraph Projection Determinism Failed:",m),console.log("Engine Preview:",n)),Object.values(m).every(f=>f===!0)}},{id:"telegraph_projection_matches_execute_footprint",title:"Projection Matches Execute Footprint",description:"Projected danger tiles should include the tile actually damaged on execution.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","parity","combat"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:4,r:2,s:-6},"threat")},run:e=>{e.wait();const o=e.state.intentPreview?.projections?.find(r=>r.actorId==="threat")?.dangerTiles?.[0];o?e.logs.push(`PREVIEW_TILE=${o.q},${o.r},${o.s}`):e.logs.push("PREVIEW_TILE=none"),e.wait()},verify:(e,n)=>{const a=e.enemies.find(h=>h.id==="threat"),r=n.find(h=>h.startsWith("PREVIEW_TILE="))?.split("=")[1]||"none",c=r==="none"?void 0:(()=>{const[h,g,m]=r.split(",").map(f=>Number(f));return{q:h,r:g,s:m}})(),d={previewProducedTile:!!c,projectedTileMatchesExecute:!!c&&!!a&&se(a.position,c)};return Object.values(d).some(h=>h===!1)&&(console.log("Telegraph Projection Parity Failed:",d),console.log("Logs:",n),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(d).every(h=>h===!0)}}]},cd=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},DASH:{slot:"passive",range:4,cooldown:0,name:"Kinetic Dash",description:"Dash in a straight line."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},qS={id:"raider_dash",name:"Raider Dash",description:"Parity checks for enemy Raider reusing the player DASH contract.",scenarios:[{id:"player_dash_stops_before_adjacent_enemy",title:"Parity Baseline: Player Dash Stops Before Blocker",description:"Player DASH should stop on the tile before an occupied target.",relatedSkills:["DASH"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["parity","dash","reuse"],setup:e=>{e.setPlayer({q:4,r:2,s:-6},["DASH"]),e.spawnEnemy("footman",{q:4,r:6,s:-10},"blocker"),e.state.hasShield=!1},run:e=>{e.useSkill("DASH",{q:4,r:6,s:-10})},verify:(e,n)=>{const a={playerStoppedBeforeBlocker:e.player.position.q===4&&e.player.position.r===5,dashResolved:n.some(o=>o.includes("Stopped by an obstacle")||o.includes("Dashed!")||o.includes("Shield Shunt"))};return Object.values(a).every(o=>o===!0)}},{id:"raider_ai_uses_dash_with_player_contract",title:"Parity: Raider Uses Same Dash Stop Rule",description:"Raider AI selects DASH and lands on the same stop tile as player-owned DASH in mirrored geometry.",relatedSkills:["DASH"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","dash"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("raider",{q:4,r:2,s:-6},"raider"),e.state.hasShield=!1;const n=e.getEnemy("raider");n&&(n.activeSkills=[cd("BASIC_MOVE"),cd("BASIC_ATTACK"),cd("DASH")])},run:e=>{e.wait()},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="raider"),o={raiderStillAlive:!!a,raiderStoppedBeforePlayer:!!a&&a.position.q===4&&a.position.r===5,playerUnharmed:e.player.hp===e.player.maxHp,dashResolved:n.some(r=>r.includes("Stopped by an obstacle")||r.includes("Dashed!")||r.includes("Shield Shunt"))};return Object.values(o).every(r=>r===!0)}}]},ud=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},GRAPPLE_HOOK:{slot:"offensive",range:4,cooldown:0,name:"Grapple Hook",description:"Pull and swap with target."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},$S={id:"pouncer_hook",name:"Pouncer Hook",description:"Second archetype reuse: enemy uses player GRAPPLE_HOOK via normal skill execution.",scenarios:[{id:"pouncer_uses_grapple_hook_deterministically",title:"Pouncer Uses Grapple Hook Through Skill Pipeline",description:"Pouncer selects GRAPPLE_HOOK from AI and resolves via standard USE_SKILL execution.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","determinism"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("pouncer",{q:4,r:2,s:-6},"pouncer");const n=e.getEnemy("pouncer");n&&(n.activeSkills=[ud("BASIC_MOVE"),ud("BASIC_ATTACK"),ud("GRAPPLE_HOOK")])},run:e=>{e.wait()},verify:(e,n)=>{const o={pouncerStillAlive:!!e.enemies.find(r=>r.id==="pouncer"),grappleExecuted:n.filter(r=>r.includes("Vaulted and Flung!")).length>=1,deterministicStatus:n.filter(r=>r.includes("You are stunned!")).length===1,noZeroEffectWarning:!n.some(r=>r.includes("produced ZERO effects"))};return Object.values(o).every(r=>r===!0)}}]},zS={id:"ice",name:"Ice Terrain",description:"ICE/SLIPPERY terrain behavior for pass-through momentum and landing slide.",scenarios:[{id:"ice_pass_preserves_dash_momentum",title:"Ice Pass: Dash Carries Momentum",description:"Passing through ICE during DASH should preserve momentum and carry movement beyond nominal target.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","ice","momentum","pass"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:6,r:4,s:-10})},verify:e=>e.player.position.q>6},{id:"ice_land_slides_after_basic_move",title:"Ice Land: Basic Move Slides Forward",description:"Landing on ICE with BASIC_MOVE should slide one hex in the move direction when the next tile is walkable.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["terrain","ice","slide","land"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_MOVE"]),e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor")},run:e=>{e.move({q:5,r:4,s:-9})},verify:e=>e.player.position.q===6&&e.player.position.r===4}]},VS={id:"snare",name:"Snare Terrain",description:"Snare tile effect movement restriction and status interaction.",scenarios:[{id:"snare_interrupts_dash_and_roots_actor",title:"Snare Interrupts Dash",description:"DASH into a snare tile should halt movement at snare and apply rooted status.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","snare","movement-restriction"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.state.tiles.set("5,4",{baseId:"STONE",position:{q:5,r:4,s:-9},traits:new Set(["WALKABLE"]),effects:[{id:"SNARE",duration:-1,potency:1}]}),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:7,r:4,s:-11})},verify:(e,n)=>{const a=e.player.statusEffects.some(r=>r.type==="rooted"),o={stoppedAtSnare:e.player.position.q===5&&e.player.position.r===4,rootedApplied:a,snareMessageLogged:n.some(r=>r.includes("Snared! Movement halted."))};return Object.values(o).every(r=>r===!0)}}]},YS={id:"relics",name:"Relics",description:"Passive relic behaviors using existing engine hooks only.",scenarios:[{id:"relic_ember_ward_reduces_fire_damage",title:"Relic: Ember Ward",description:"Equipping Ember Ward reduces incoming fire damage by 1.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"beginner",isTutorial:!1,tags:["relic","fire","passive"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_EMBER_WARD"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,n)=>{const a={hpUnchanged:e.player.hp===e.player.maxHp,relicMessageSeen:n.some(o=>o.includes("Ember Ward dampens the flames."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_cinder_orb_stacks_with_absorb_fire",title:"Relic: Cinder Orb Stacking",description:"Cinder Orb adds bonus healing when fire damage is converted by Absorb Fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",difficulty:"advanced",isTutorial:!1,tags:["relic","stacking","absorb-fire"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["ABSORB_FIRE"]),e.state.player={...e.state.player,hp:1,maxHp:3},e.state.upgrades=[...e.state.upgrades||[],"RELIC_CINDER_ORB"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,n)=>{const a={healedByStacking:e.player.hp===3,stackingMessageSeen:n.some(o=>o.includes("Cinder Orb amplifies the absorption."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_steady_plates_end_to_end",title:"Relic: Steady Plates",description:"Steady Plates grants turn-start armor that resolves against incoming damage in the same round.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"intermediate",isTutorial:!1,tags:["relic","armor","turn-start"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_STEADY_PLATES"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,n)=>{const a={playerHpProtected:e.player.hp===e.player.maxHp,damageEventOccurred:n.some(o=>o.includes("player burns!")),armorPresentAfterCycle:e.player.temporaryArmor>=0&&e.player.temporaryArmor<=2,relicTriggerMessageSeen:n.some(o=>o.includes("Steady Plates harden your stance."))};return Object.values(a).every(o=>o===!0)}}]},KS=250,FS=700,XS=100,WS=8,GS=220,JS=260,QS=40,Dg=(e,n)=>{const a=e.floor||0,o=e.player?.hp||0,r=e.turnsSpent??e.turnNumber??0,c=e.kills||0,d=e.environmentalKills||0,h=e.hazardBreaches||0,g=(n||[]).filter(m=>m.success).length*KS;return a*FS+o*XS+c*GS+d*JS-r*WS-h*QS+g},ZS=e=>{if(typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const n=e instanceof Date?e:new Date,a=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${a}-${o}-${r}`},eA=e=>`daily:${e}`,tA=e=>{const n=18+Math.floor(kl(e,0)*8);return[{id:"TURN_LIMIT",label:`Finish within ${n} turns`,target:n},{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}]},Ml=e=>(e.runObjectives||[]).map(a=>{if(a.id==="TURN_LIMIT"){const r=e.turnsSpent||0;return{...a,value:r,success:r<=a.target}}const o=e.hazardBreaches||0;return{...a,value:o,success:o<=a.target}}),Lo=e=>{const n=e.initialSeed??e.rngSeed??"0",a=Ml(e),o=e.combatScoreEvents||[],r=o.length?Number((o.reduce((d,h)=>d+h.efficiency,0)/o.length).toFixed(4)):0,c=o.filter(d=>d.riskBonusApplied).length;return{seed:n,actionLog:e.actionLog,score:Dg(e,a),floor:e.floor,objectives:a,combatTelemetry:{events:o.length,avgEfficiency:r,riskBonusEvents:c}}},nA={id:"objectives",name:"Objectives",description:"Daily objective validation for turn-limit and hazard constraints.",scenarios:[{id:"objective_turn_limit_boundary",title:"Objective: Turn Limit Boundary",description:"Turn-limit objective passes at boundary and fails above boundary.",relatedSkills:["BASIC_MOVE"],category:"progression",difficulty:"intermediate",isTutorial:!1,tags:["objective","turn-limit"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"TURN_LIMIT",label:"Finish within 1 turns",target:1}]},run:e=>{e.wait()},verify:e=>{const a=Ml(e)[0]?.success===!0,o=Lo(e).score,r=Ml({...e,turnsSpent:(e.turnsSpent||0)+1}),c={...e,turnsSpent:(e.turnsSpent||0)+1},d=Lo(c).score,h=r[0]?.success===!1,g=d<o;return a&&h&&g}},{id:"objective_hazard_constraint_fail_on_hazard",title:"Objective: Hazard Constraint",description:"Hazard objective fails after prohibited hazard interaction.",relatedSkills:["BASIC_MOVE"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["objective","hazard"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:e=>{const n=Ml(e)[0];return(e.hazardBreaches||0)>0&&!!n&&n.success===!1}}]},iA={id:"necromancer",name:"Necromancer",description:"Corpse persistence and summon migration contracts.",scenarios:[{id:"necromancer_corpse_persistence",title:"Corpse Persists Until Consumed",description:"Kill an enemy, wait 5 turns, then Raise Dead succeeds from corpse tile trait.",relatedSkills:["BASIC_ATTACK","RAISE_DEAD"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","corpse","persistence"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_ATTACK","RAISE_DEAD"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"dummy");const n=e.getEnemy("dummy");n&&(n.hp=1,n.maxHp=1)},run:e=>{const n={q:5,r:4,s:-9};e.useSkill("BASIC_ATTACK",n);for(let a=0;a<5;a++)e.wait();e.useSkill("RAISE_DEAD",n)},verify:e=>{const n=ue({q:5,r:4}),a=e.tiles.get(n),o=e.enemies.find(h=>h.subtype==="skeleton"&&h.factionId==="player"),r=e.companions?.find(h=>h.id===o?.id),c=new Set((o?.activeSkills||[]).map(h=>h.id)),d={corpseConsumed:!a?.traits?.has("CORPSE"),skeletonRaised:!!o,skeletonOnCorpseTile:!!o&&o.position.q===5&&o.position.r===4,companionRegistered:!!r,hasBasicLoadout:c.has("BASIC_MOVE")&&c.has("BASIC_ATTACK")};return Object.values(d).every(Boolean)}},{id:"summon_floor_transition",title:"Summon Persists Across Floor Transition",description:"Raised skeleton migrates with player to floor 2.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","summon","floor-transition"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["RAISE_DEAD"],"VANGUARD");const n={q:5,r:4,s:-9},a=ue(n),o=e.getTileAt(n);e.state.tiles.set(a,{...o,position:n,traits:new Set([...o?.traits||[],"CORPSE"])})},run:e=>{const n={q:5,r:4,s:-9};e.useSkill("RAISE_DEAD",n),e.state.player={...e.state.player,position:{...e.state.stairsPosition}},e.wait(),e.dispatchSync({type:"RESOLVE_PENDING"})},verify:e=>{const n=e.enemies.find(o=>o.subtype==="skeleton"&&o.factionId==="player"&&o.companionOf===e.player.id),a={floorAdvanced:e.floor===2,summonStillPresent:!!n,summonTracksOwner:!!n&&n.companionOf===e.player.id};return Object.values(a).every(Boolean)}},{id:"companion_does_not_block_free_move",title:"Companion Does Not Block Exploration Free Move",description:"Friendly skeleton companion should not count as hostile for BASIC_MOVE exploration range.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","companion","movement"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"friendly_skeleton");const n=e.getEnemy("friendly_skeleton");n&&(n.subtype="skeleton",n.factionId="player",n.companionOf=e.state.player.id,n.activeSkills=n.activeSkills||[],e.state.companions=[...e.state.companions||[],n])},run:e=>{e.move({q:7,r:1,s:-8})},verify:e=>{const n={movedFar:e.player.position.q===7&&e.player.position.r===1,turnsAdvanced:e.turnsSpent>=1};return Object.values(n).every(Boolean)}},{id:"raise_dead_pushes_ally_from_target_hex",title:"Raise Dead Pushes Ally Occupant",description:"If corpse tile is occupied by an ally, ally is displaced and summon succeeds without overlap.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","occupancy","push"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["RAISE_DEAD"],"VANGUARD");const n={q:5,r:5,s:-10},a=ue(n),o=e.getTileAt(n);e.state.tiles.set(a,{...o,position:n,traits:new Set([...o?.traits||[],"CORPSE"])}),e.spawnEnemy("footman",n,"ally_blocker");const r=e.getEnemy("ally_blocker");r&&(r.subtype="skeleton",r.factionId="player",r.companionOf=e.state.player.id,e.state.companions=[...e.state.companions||[],r])},run:e=>{e.useSkill("RAISE_DEAD",{q:5,r:5,s:-10})},verify:e=>{const n=e.enemies.filter(h=>h.subtype==="skeleton"&&h.factionId==="player"),a=new Set;let o=!1;n.forEach(h=>{const g=ue(h.position);a.has(g)&&(o=!0),a.add(g)});const r=n.some(h=>h.position.q===5&&h.position.r===5),c=n.some(h=>h.id==="ally_blocker"&&!(h.position.q===5&&h.position.r===5));return Object.values({raisedAtCorpse:r,pushedExists:c,noOverlap:!o}).every(Boolean)}}]},aA={id:"archer_shot",name:"Archer Shot",description:"Tests for dedicated archer ranged line-shot targeting, LoS, and axial validation.",scenarios:[{id:"archer_shot_clear_lane_hit",title:"Archer Shot: Clear Lane Hit",description:"A valid axial target in clear line of sight is damaged.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","line-of-sight","axial"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:3,r:4,s:-7},"target")},run:e=>{e.useSkill("ARCHER_SHOT",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="target"),o=!a||a.hp<a.maxHp,r=n.some(c=>c.includes("Archer shot!"));return o&&r}},{id:"archer_shot_wall_blocked",title:"Archer Shot: Wall Blocks Line of Sight",description:"Archer Shot fails when a wall blocks the line to the target actor.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","line-of-sight","wall"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),e.setTile({q:4,r:4,s:-8},"wall")},run:e=>{e.useSkill("ARCHER_SHOT",{q:4,r:3,s:-7})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="target"),o=!!a&&a.hp===a.maxHp,r=n.some(c=>c.includes("No clear line of sight"));return o&&r}},{id:"archer_shot_rejects_non_axial",title:"Archer Shot: Non-Axial Target Rejected",description:"Archer Shot enforces axial targeting and rejects diagonal targets.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","axial","targeting"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:4,r:4,s:-8},"target")},run:e=>{e.useSkill("ARCHER_SHOT",{q:4,r:4,s:-8})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="target"),o=!!a&&a.hp===a.maxHp,r=n.some(c=>c.includes("Target must be axial"));return o&&r}}]};function sA(e){return{id:e.id,title:e.title,description:e.description,rationale:e.rationale,setup:e.setup,run:e.run,verify:e.verify}}const oA=[yS,gS,bS,xS,ES,_S,wS,MS,OS,CS,kS,LS,NS,RS,IS,HS,BS,jS,DS,PS,US,qS,$S,zS,VS,YS,nA,iA,aA],rA=oA.flatMap(e=>e.scenarios);function lA(e){return rA.filter(n=>n.relatedSkills.includes(e))}function Ze(e){return lA(e).map(sA)}const cA={id:"ARCHER_SHOT",name:"Archer Shot",description:"Fire an arrow in a straight line at a hostile target.",slot:"offensive",icon:"",baseVariables:{range:4,cost:0,cooldown:0,damage:1},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};if(!kt(n.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const c=Pn(n.position,a);if(!c.isAxial)return{effects:o,messages:["Target must be axial."],consumesTurn:!1};const d=ye(e,a);if(!d||d.id===n.id)return{effects:o,messages:["No target at location."],consumesTurn:!1};if(d.factionId===n.factionId)return{effects:o,messages:["Cannot target ally."],consumesTurn:!1};if(!Nl(e,n.position,a,d.id,n.id))return{effects:o,messages:["No clear line of sight."],consumesTurn:!1};const h=Ie(n),g=Pt({attackerId:n.id,targetId:d.id,skillId:"ARCHER_SHOT",basePower:1,trinity:h,targetTrinity:Ie(d),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]}),m=ht(n.position,a),f=g.finalPower>=4?"high":g.finalPower>=2?"medium":"low",b=c.directionIndex>=0?Yt(c.directionIndex):void 0;return o.push({type:"Juice",effect:"aimingLaser",target:a,intensity:"low",metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"anticipation",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},path:m,skillId:"ARCHER_SHOT",timing:{durationMs:70,ttlMs:90}}}),o.push({type:"Juice",effect:"spearTrail",path:m,target:a,intensity:f,metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"ARCHER_SHOT",timing:{delayMs:50,durationMs:80,ttlMs:110}}}),o.push({type:"Juice",effect:"lightImpact",target:d.id,intensity:f,direction:b,metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},contactRef:{kind:"contact_world"},contactHex:d.position,contactFromHex:n.position,contactToHex:d.position,skillId:"ARCHER_SHOT",timing:{delayMs:95,durationMs:60,ttlMs:110}}}),o.push({type:"Damage",target:d.id,amount:g.finalPower,reason:"archer_shot",scoreEvent:g.scoreEvent}),r.push("Archer shot!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ye(e,n);return a?[e.player,...e.enemies,...e.companions||[]].filter(r=>!!r&&r.hp>0).filter(r=>r.id!==a.id&&r.factionId!==a.factionId&&kt(n,r.position,4)&&Pn(n,r.position).isAxial&&Nl(e,n,r.position,r.id,a.id)).map(r=>r.position).filter((r,c,d)=>d.findIndex(h=>se(h,r))===c):[]},upgrades:{},scenarios:Ze("ARCHER_SHOT")},sa=(e,n)=>{let a=n,o=e.temporaryArmor||0,r=e.hp;if(o>0){const c=Math.min(o,a);o-=c,a-=c}return r=Math.max(0,r-a),{...e,hp:r,temporaryArmor:o}},Od=(e,n,a,o)=>{const c=Yx[n]?.tickWindow||"END_OF_TURN",d=n.toUpperCase();if(e.statusEffects.find(m=>m.id===d))return{...e,statusEffects:e.statusEffects.map(m=>m.id===d?{...m,duration:Math.max(m.duration,a),tickWindow:c,stacks:o||m.stacks}:m)};const g={id:d,type:n,duration:a,tickWindow:c,stacks:o||1};return{...e,statusEffects:[...e.statusEffects,g]}},uA=(e,n)=>({...e,hp:Math.min(e.maxHp,e.hp+n)}),dA=(e,n,a=!0)=>{const o=e.maxHp+n,r=a?Math.min(o,e.hp+n):e.hp;return{...e,maxHp:o,hp:r}},fA=e=>{const n=[];return e.player.hp<=0&&e.gameStatus==="playing"&&n.push({type:"GameOver",reason:"PLAYER_DIED"}),n},cy=e=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(n=>({...n,currentCooldown:Math.max(0,n.currentCooldown-1)}))}:e,mA=(e,n,a)=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(o=>o.id===n&&!o.activeUpgrades.includes(a)?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}:e,uy=(e,n,a)=>{const o=a.preserveInputOrder===!1?[...n]:[...n].reverse(),r=a.describe||(()=>"UNKNOWN");let c=e;const d=[];let h=a.startTick||1;for(;o.length>0;){const g=o.length,m=o.pop();c=a.apply(c,m);const f=a.getReactions?.(c,m)||[];if(f.length>0)for(let b=f.length-1;b>=0;b--)o.push(f[b]);d.push({tick:h++,effectType:r(m),depthBefore:g,depthAfter:o.length,reactionsQueued:f.length})}return{state:c,trace:d,resolvedCount:d.length}},pA={ModifyCooldown:(e,n,a)=>{const o=c=>({...c,activeSkills:c.activeSkills?.map(d=>d.id!==n.skillId?d:{...d,currentCooldown:n.setExact?n.amount:Math.max(0,d.currentCooldown+n.amount)})}),r=a.sourceId||e.player.id;return r===e.player.id?{...e,player:o(e.player)}:{...e,enemies:e.enemies.map(c=>c.id===r?o(c):c),companions:e.companions?.map(c=>c.id===r?o(c):c)}},SetStealth:(e,n)=>{const a=o=>({...o,stealthCounter:(o.stealthCounter||0)+n.amount});return n.target==="self"?{...e,player:a(e.player)}:{...e,enemies:e.enemies.map(o=>o.id===n.target?a(o):o),companions:e.companions?.map(o=>o.id===n.target?a(o):o)}},UpdateCompanionState:(e,n,a)=>{const o=n.target==="self"?a.sourceId||e.player.id:n.target,r=c=>c.id!==o?c:{...c,companionState:{...c.companionState,mode:n.mode||c.companionState?.mode,markTarget:n.markTarget!==void 0?n.markTarget:c.companionState?.markTarget,orbitStep:n.mode==="scout"?0:c.companionState?.orbitStep,apexStrikeCooldown:n.apexStrikeCooldown!==void 0?n.apexStrikeCooldown:c.companionState?.apexStrikeCooldown,healCooldown:n.healCooldown!==void 0?n.healCooldown:c.companionState?.healCooldown}};return{...e,enemies:e.enemies.map(r),companions:e.companions?.map(r)}}},hA={SpawnCorpse:(e,n,a,o)=>o.addCorpseTraitAt(e,n.position),RemoveCorpse:(e,n,a,o)=>{const r=o.removeCorpseTraitAt(e,n.position);return{...r,dyingEntities:(r.dyingEntities||[]).filter(c=>!se(c.position,n.position))}}},yA=/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*/i,gA=e=>yA.test(e),zd=(e,n="INFO",a="SYSTEM")=>e?gA(e)?e:`[${n}|${a}] ${e}`:"",bA=(e,n="INFO",a="SYSTEM")=>e.map(o=>zd(o,n,a)).filter(Boolean),xt=(e,n,a,o,r=50)=>{const c=zd(n,a,o),d=[...e||[]];return c&&d[d.length-1]===c?d.slice(-r):[...d,c].slice(-r)},oi=(e,n,a,o,r=50)=>{const c=[...e||[]];let d;for(const h of bA(n,a,o))h&&d===h||(c.push(h),d=h);return c.slice(-r)},xA=["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage"],vA=["fire_damage","lava_sink","burning","hazard_intercept","lava_tick","oil_explosion","void_sink"],dy=(e,n)=>!!e&&n.includes(e),_o=e=>e?.statusEffects?.some(n=>n.type==="marked_predator")?1:0,SA={Damage:(e,n,a,o)=>{let r={...e};dy(n.reason,xA)&&(r=o.appendTimelineEvent(r,"HAZARD_CHECK","Damage",{reason:n.reason,amount:n.amount,target:n.target},a,!0,200)),r=o.appendTimelineEvent(r,"DAMAGE_APPLY","Damage",{reason:n.reason,amount:n.amount,target:n.target,scoreEvent:n.scoreEvent},a,!0,180);let d="",h=null,g,m,f=n.amount;typeof n.target=="string"?n.target==="targetActor"?d=a.targetId||"":n.target!=="area"&&(d=n.target):h=n.target;const b=dy(n.reason,vA),x=r.upgrades?.includes("RELIC_EMBER_WARD"),T=r.upgrades?.includes("RELIC_CINDER_ORB");if(b&&d){const A=(d===r.player.id?r.player:r.enemies.find(_=>_.id===d))?.activeSkills?.some(_=>_.id==="ABSORB_FIRE");let O=n.amount;if(d===r.player.id&&x&&(O=Math.max(0,O-1),r.message=xt(r.message,"Ember Ward dampens the flames.","INFO","COMBAT")),A){const _=O+(d===r.player.id&&T?1:0);return d===r.player.id&&T&&(r.message=xt(r.message,"Cinder Orb amplifies the absorption.","INFO","COMBAT")),o.applyAtomicEffect(r,{type:"Heal",target:d,amount:_})}}if(d)if(d===r.player.id){const S=r.player,A=n.scoreEvent?.damageClass||"physical",O=o.scaleCombatProfileDamage(r,n.amount,a.sourceId,S,A,n.reason);let _=O.amount;_+=_o(S),b&&x&&(_=Math.max(0,_-1)),n.scoreEvent&&(r.combatScoreEvents=[...r.combatScoreEvents||[],{...n.scoreEvent,finalPower:_,traitOutgoingMultiplier:O.outgoing,traitIncomingMultiplier:O.incoming,traitTotalMultiplier:O.total}].slice(-500)),r.player=sa(r.player,_),g=r.player.id,m=r.player.position,f=_,b&&(r.hazardBreaches=(r.hazardBreaches||0)+1),b&&T&&(r.player=uA(r.player,1),r.message=xt(r.message,"Cinder Orb restores 1 HP.","INFO","COMBAT"))}else{const S=r.enemies.find(I=>I.id===d),A=d===r.player.id?r.player.position:S?.position,O=[],_=n.scoreEvent?.damageClass||"physical",E=o.scaleCombatProfileDamage(r,n.amount,a.sourceId,S,_,n.reason),w=E.amount+_o(S);g=d||S?.id,m=A||S?.position,f=w;const C=I=>{if(I.id===d){const N=sa(I,w);return N.hp<=0&&(r.dyingEntities=[...r.dyingEntities||[],I],O.push(I.position)),N}return I};if(n.scoreEvent&&(r.combatScoreEvents=[...r.combatScoreEvents||[],{...n.scoreEvent,finalPower:w,traitOutgoingMultiplier:E.outgoing,traitIncomingMultiplier:E.incoming,traitTotalMultiplier:E.total}].slice(-500)),r.enemies=r.enemies.map(C).filter(I=>I.hp>0),r.companions&&(r.companions=r.companions.map(C).filter(I=>I.hp>0)),O.length>0&&(r=o.appendTimelineEvent(r,"DEATH_RESOLVE","Damage",{targetActorId:d,reason:n.reason||"damage"},{...a,targetId:d},!0,260)),O.forEach(I=>{r=o.addCorpseTraitAt(r,I)}),A&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"impact",position:A}}]),d===r.player.id&&(r.player.stealthCounter||0)>0)r.player={...r.player,stealthCounter:Math.max(0,(r.player.stealthCounter||0)-1)};else if(d!==r.player.id){const I=N=>N.id===d?{...N,stealthCounter:Math.max(0,(N.stealthCounter||0)-1)}:N;r.enemies=r.enemies.map(I),r.companions&&(r.companions=r.companions.map(I))}d===r.player.id&&r.player.archetype==="HUNTER"&&n.source&&Gn(n.source,r.player.position)!==-1&&(r.message=xt(r.message,"You roll away!","INFO","COMBAT")),S&&S.archetype==="HUNTER"&&n.source&&Gn(n.source,S.position)!==-1&&(r.message=xt(r.message,`${S.subtype||S.id} rolls away!`,"INFO","COMBAT"))}else if(h){const S=o.resolveActorAt(r,h),A=n.scoreEvent?.damageClass||"physical",O=o.scaleCombatProfileDamage(r,n.amount,a.sourceId,S,A,n.reason),_=O.amount;g=S?.id,m=h,f=_+_o(S||void 0),r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"impact",position:h}}],n.scoreEvent&&S&&(r.combatScoreEvents=[...r.combatScoreEvents||[],{...n.scoreEvent,targetId:S.id,finalPower:_,traitOutgoingMultiplier:O.outgoing,traitIncomingMultiplier:O.incoming,traitTotalMultiplier:O.total}].slice(-500)),se(r.player.position,h)&&(r.player=sa(r.player,_+_o(r.player)),b&&(r.hazardBreaches=(r.hazardBreaches||0)+1));const E=I=>{if(se(I.position,h)){const N=sa(I,_+_o(I));return N.hp<=0&&(r.dyingEntities=[...r.dyingEntities||[],I],C.push(I.id),w.push(I.position)),N}return I},w=[],C=[];r.enemies=r.enemies.map(E).filter(I=>I.hp>0),r.companions&&(r.companions=r.companions.map(E).filter(I=>I.hp>0)),C.forEach(I=>{r=o.appendTimelineEvent(r,"DEATH_RESOLVE","Damage",{targetActorId:I,reason:n.reason||"area_damage"},{...a,targetId:I},!0,260)}),w.forEach(I=>{r=o.addCorpseTraitAt(r,I)})}return f>0&&(r=o.appendSimulationEvent(r,{type:"DamageTaken",targetId:g||d||void 0,position:m,payload:{amount:f,reason:n.reason,sourceId:a.sourceId}})),r}},$e={getNeighbors(e){return Xe(e)},isTileBlocked(e,n){return!e.occupancyMask||e.occupancyMask.length===0?!1:wd(e.occupancyMask,n)},refreshOccupancyMask(e){let n=Gx(e.gridWidth,e.gridHeight);return e.tiles?.forEach(a=>{(a.baseId==="WALL"||a.traits?.has("BLOCKS_MOVEMENT"))&&(n=sd(n,a.position))}),e.player&&(n=sd(n,e.player.position)),e.enemies?.forEach(a=>{n=sd(n,a.position)}),n},getMovementRange(e,n,a){const o=new Map,r=[],c=g=>`${g.q},${g.r}`,d=ye(e,n),h=[{p:n,cost:0}];for(o.set(c(n),0);h.length;){const g=h.shift();if(!(g.cost>=a))for(const m of this.getNeighbors(g.p)){if(!this.isWithinBounds(e,m)||!Ne.isWalkable(e,m))continue;const f=ye(e,m),b=f&&!se(m,n),x=b&&d&&f.factionId===d.factionId;if(b&&!x)continue;const T=c(m),S=g.cost+1;(!o.has(T)||o.get(T)>S)&&(o.set(T,S),x||r.push(m),h.push({p:m,cost:S}))}}return r},getAxialTargets(e,n,a,o={}){const{includeWalls:r=!1,includeActors:c=!0,stopAtObstacles:d=!0}=o,h=[];for(let g=0;g<6;g++)for(let m=1;m<=a;m++){const f=rn(n,Pd(g,m));if(!this.isWithinBounds(e,f))break;const x=Ne.getTileAt(e,f)?.baseId==="WALL",T=ye(e,f);if(x){if(r&&h.push(f),d)break}else if(T){if(c&&h.push(f),d)break}else h.push(f)}return h},getAreaTargets(e,n,a){const o=[];for(let r=-a;r<=a;r++)for(let c=Math.max(-a,-r-a);c<=Math.min(a,-r+a);c++){const d=rn(n,on(r,c));this.isWithinBounds(e,d)&&o.push(d)}return o},isWithinBounds(e,n){return la(n,e.gridWidth,e.gridHeight)},getAxialTargetsWithOptions(e,n,a,o){return this.getAxialTargets(e,n,a,o)}};class Na{static hasFireProtection(n){return n.statusEffects.some(a=>a.type==="fire_immunity")||n.activeSkills?.some(a=>a.id==="ABSORB_FIRE")||!1}static isFireHazard(n,a){return n.baseId==="LAVA"||a.has("LAVA")||a.has("FIRE")}static mergeResults(n,a){n.effects.push(...a.effects),n.messages.push(...a.messages),a.newMomentum!==void 0&&(n.newMomentum=a.newMomentum),a.interrupt&&(n.interrupt=!0),a.modifyTile&&(n.modifyTile={...n.modifyTile,...a.modifyTile})}static processEntry(n,a,o){const r={effects:[],messages:[],interrupt:!1},c={tile:a,actor:n,state:o,isFinalDestination:!0,source:n.previousPosition},d=Ne.getTraitsForTile(o,a);d.has("HAZARDOUS")&&!n.isFlying&&(this.isFireHazard(a,d)&&this.hasFireProtection(n)||(a.baseId==="LAVA"||d.has("LAVA")?this.mergeResults(r,{effects:[{type:"Damage",target:n.id,amount:99,reason:"lava_sink"},{type:"Juice",effect:"lavaSink",target:n.position}],messages:["Lava Sink! You were engulfed by lava!"],interrupt:!0}):(a.baseId==="VOID"||d.has("VOID"))&&this.mergeResults(r,{effects:[{type:"Damage",target:n.id,amount:99,reason:"void_sink"},{type:"Juice",effect:"lavaSink",target:n.position}],messages:["Void consumes your soul!"],interrupt:!0})));for(const h of a.effects){const g=Qr[h.id];if(!g?.onEnter)continue;const m=g.onEnter(c);if(this.mergeResults(r,m),r.interrupt)break}return r.messages.length===0&&r.effects.some(h=>h.type==="LavaSink")&&r.messages.push("Lava Sink! You were engulfed by lava!"),r}static processTransition(n,a,o,r,c={}){const{ignoreActors:d=!1,ignoreGroundHazards:h=!1}=c,g={effects:[],messages:[],newMomentum:r!==void 0?Math.max(0,r-1):void 0,interrupt:!1},m=Ne.getTraitsForTile(o,a);if(m.has("BLOCKS_MOVEMENT")||!d&&(o.enemies.find(x=>x.id!==n.id&&x.hp>0&&se(x.position,a.position))||(n.id!==o.player.id&&se(o.player.position,a.position)?o.player:void 0)))return g.interrupt=!0,g.newMomentum=0,g;const f={tile:a,actor:n,state:o,momentum:r,isFinalDestination:!1,source:n.previousPosition};m.has("HAZARDOUS")&&!n.isFlying&&!h?this.isFireHazard(a,m)&&this.hasFireProtection(n)?this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:99,reason:"hazard_intercept"}],messages:["Flames surge through you."],interrupt:!1}):this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:99,reason:"hazard_intercept"},{type:"Juice",effect:"lavaSink",target:a.position}],messages:[a.baseId==="LAVA"||m.has("LAVA")?"Sunk in Lava!":"Consumed by Void!"],interrupt:!0}):m.has("SLIPPERY")?g.newMomentum=Math.max(1,r||0):m.has("LIQUID")&&r!==void 0&&r>0&&(g.newMomentum=Math.max(0,r-1));for(const b of a.effects){const x=Qr[b.id];if(!x?.onPass)continue;const T=x.onPass(f);if(this.mergeResults(g,T),g.interrupt)break}if(!g.interrupt&&!n.isFlying&&!h&&o.traps){const b=o.traps.find(x=>se(x.position,a.position)&&x.cooldown===0&&x.ownerId!==n.id);if(b){const x=a.position.q-b.position.q||1,T=a.position.r-b.position.r||0;let S=0;x>0&&T===0?S=0:x>0&&T<0?S=1:x===0&&T<0?S=2:x<0&&T===0?S=3:x<0&&T>0?S=4:S=5;const A=3;let O=a.position;const E=(w=>[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0},{q:0,r:1,s:-1}][w%6])(S);for(let w=0;w<A;w++){const C={q:O.q+E.q,r:O.r+E.r,s:O.s+E.s};if(!Ne.isWalkable(o,C))break;O=C}if(this.mergeResults(g,{effects:[{type:"SetTrapCooldown",position:b.position,ownerId:b.ownerId,cooldown:b.resetCooldown??2},{type:"Displacement",target:n.id,destination:O,source:a.position,isFling:!0},{type:"Juice",effect:"kineticWave",target:a.position,intensity:"high"},{type:"Juice",effect:"combat_text",target:a.position,text:"TRAP!"}],messages:[`${n.subtype||"Unit"} triggered a kinetic trap!`],interrupt:!0}),b.volatileCore&&this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:1,reason:"trap_volatile_core"}],messages:["Volatile core detonates!"]}),b.chainReaction&&o.traps){const w=o.traps.filter(C=>C.ownerId===b.ownerId&&C.cooldown===0&&!se(C.position,b.position)&&Xe(b.position).some(I=>se(I,C.position)));for(const C of w)this.mergeResults(g,{effects:[{type:"SetTrapCooldown",position:C.position,ownerId:C.ownerId,cooldown:C.resetCooldown??2}],messages:["Chain reaction sparks nearby traps!"]}),C.volatileCore&&this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:1,reason:"trap_chain_volatile"}],messages:["Chain blast!"]})}}}return g}static processStay(n,a,o){const r={effects:[],messages:[]},c={tile:a,actor:n,state:o,isFinalDestination:!1},d=Ne.getTraitsForTile(o,a);if((a.baseId==="LAVA"||d.has("LAVA"))&&!n.isFlying&&!n.statusEffects.some(h=>h.type==="fire_immunity")){const h=n.id==="player";this.mergeResults(r,{effects:[{type:"Damage",target:n.id,amount:h?1:99,reason:"lava_tick"}],messages:["Lava Sink! You were engulfed by lava!"]})}for(const h of a.effects){const g=Qr[h.id];if(!g?.onStay)continue;const m=g.onStay(c);this.mergeResults(r,m)}return r}static applyEffect(n,a,o,r,c,d){const h=Qr[a];if(!h)return{effects:[],messages:[]};const g={effects:[],messages:[]};for(const m of n.effects){const f=h.interactsWith?.[m.id];if(f){const b=f({tile:n,state:c,potency:r,sourceId:d});return this.mergeResults(g,b),g}}if(h.onApply){const m=h.onApply({tile:n,state:c,potency:r,sourceId:d});this.mergeResults(g,m)}return g.modifyTile?.effects?g.modifyTile&&(n.effects=g.modifyTile.effects):n.effects.push({id:a,duration:o,potency:r,sourceId:d}),g}static processPath(n,a,o,r,c={}){let d=n.position,h=r,g={effects:[],messages:[],newMomentum:r,interrupt:!1};for(const m of a){const f=Ne.getTileAt(o,m),b=Ne.getTraitsForTile(o,f),x=this.processTransition(n,f,o,h,c);if(x.interrupt&&b.has("BLOCKS_MOVEMENT")){g.interrupt=!0;break}if(d=m,this.mergeResults(g,x),g.interrupt){g.interrupt=!0;break}if(h=g.newMomentum,h!==void 0&&h<=0)break}return{lastValidPos:d,result:g,interrupt:!!g.interrupt}}static getMovementCost(n,a){const o=Ne.getTraitsForTile(n,a);let r=1;return o.has("HAZARDOUS")&&(r+=5),o.has("LIQUID")&&(r+=1),o.has("FIRE")&&(r+=2),r}}const AA={Displacement:(e,n,a,o)=>{let r={...e},c="";if(n.target==="self"?c=a.sourceId||r.player.id:n.target==="targetActor"?c=a.targetId||"":c=n.target,!c)return r;const d=(N,H)=>H===N.player.id?N.player:N.enemies.find(D=>D.id===H),h=d(r,c);if(!h)return r;const g=n.source||h.position,m=Math.min(3200,Math.max(0,o.getBlockingTimelineDurationMs(r.timelineEvents)));let f=!1;const b=!(n.simulatePath||n.path||n.isFling);if(g&&(r=o.appendTimelineEvent(r,"MOVE_START","Displacement",{origin:g,destination:n.destination,targetActorId:c},{...a,targetId:c},!0,220)),!g)return r;const x=n.path||ht(g,n.destination),T=n.simulatePath||n.isFling||!!n.path;let S=n.destination;if(T&&x){const N=d(r,c);if(!N)return r;const H=Na.processPath(N,x.slice(1),r,x.length-1,{ignoreActors:n.ignoreCollision,ignoreGroundHazards:n.ignoreGroundHazards});S=H.lastValidPos,c===r.player.id?r.player={...r.player,position:S}:r.enemies=r.enemies.map(G=>G.id===c?{...G,position:S}:G),f||(r=o.appendTimelineEvent(r,"MOVE_END","Displacement",{destination:S,targetActorId:c},{...a,targetId:c},!0,260),f=!0),H.result.effects.length>0&&(r=o.appendTimelineEvent(r,"ON_PASS","TilePath",{path:x.slice(1),targetActorId:c},{...a,targetId:c},!1,80),r=o.applyEffects(r,H.result.effects,{targetId:c})),H.result.messages.length>0&&(r.message=oi(r.message,H.result.messages,"INFO","HAZARD"));const D=c===r.player.id||r.enemies.some(G=>G.id===c);if(!H.interrupt&&D){const G=Ne.getTileAt(r,S);r=o.appendTimelineEvent(r,"ON_ENTER","TileEnter",{position:S,targetActorId:c,tileBaseId:G?.baseId},{...a,targetId:c},!1,80);const P=d(r,c);if(!P)return r;const Y=Na.processEntry(P,G,r);Y.effects.length>0&&(r=o.applyEffects(r,Y.effects,{targetId:c})),Y.messages.length>0&&(r.message=oi(r.message,Y.messages,"INFO","HAZARD"))}if(H.result.newMomentum&&H.result.newMomentum>0){const G=H.lastValidPos,P=x.length>1?x[x.length-2]:g,Y=Gn(P,G);if(Y!==-1){const F=Yt(Y);let Z=G,z=5;for(;z>0;){const q=rn(Z,F);if(!Ne.isWalkable(r,q)||(c===r.player.id?r.enemies.find(X=>X.hp>0&&se(X.position,q)):se(r.player.position,q)?r.player:r.enemies.find(X=>X.id!==c&&X.hp>0&&se(X.position,q))))break;const $=Ne.getTileAt(r,q);if($){const X=Na.processTransition(h,$,r,1);if(Z=q,X.effects.length>0&&(r=o.applyEffects(r,X.effects,{targetId:c})),X.messages.length>0&&(r.message=oi(r.message,X.messages,"INFO","HAZARD")),X.newMomentum===0||X.interrupt)break}else{Z=q;break}z--}S=Z}}}const A=[...r.visualEvents||[]],O=!!(n.ignoreCollision||n.isFling),_=O?A.reduce((N,H)=>{if(H.type!=="kinetic_trace")return N;const D=H.payload;return D&&(D.movementType??"slide")==="slide"?N+1:N},0):0,E=b?0:O?Math.min(640,_*90):0,w=Math.max(m,E),C={actorId:c,origin:g,path:n.path||(b?[g,S]:ht(g,S)),destination:S,movementType:b?"teleport":"slide",durationMs:n.animationDuration??(b?180:Math.max(120,(n.path?.length||ht(g,S).length)*110)),startDelayMs:w,wasLethal:r.tiles.get(ue(S))?.traits.has("HAZARDOUS")||!1},I=A;if(b)I.push({type:"kinetic_trace",payload:C});else{let N=!1;for(let H=I.length-1;H>=0;H--){const D=I[H];if(D.type!=="kinetic_trace")continue;const G=D.payload;if(!(!G||G.actorId!==c)){if((G.movementType??"slide")==="slide"&&se(G.destination,C.origin)){const P=G.path&&G.path.length>0?G.path:[G.origin,G.destination],Y=C.path&&C.path.length>0?C.path:[C.origin,C.destination],F=[...P,...Y.slice(1)];I[H]={type:"kinetic_trace",payload:{...C,origin:G.origin,path:F,durationMs:(G.durationMs||0)+(C.durationMs||0),startDelayMs:Math.min(G.startDelayMs??w,w),movementType:"slide",wasLethal:!!(G.wasLethal||C.wasLethal)}},N=!0}break}}N||I.push({type:"kinetic_trace",payload:C})}if(r.visualEvents=I,c===r.player.id)r.player={...r.player,position:S,previousPosition:b?S:r.player.position};else{const N=H=>H.id===c?{...H,position:S,previousPosition:b?S:H.position}:H;r.enemies=r.enemies.map(N),r.companions&&(r.companions=r.companions.map(N))}return r.occupancyMask=$e.refreshOccupancyMask(r),f||(r=o.appendTimelineEvent(r,"MOVE_END","Displacement",{destination:S,targetActorId:c},{...a,targetId:c},!0,260)),r=o.appendSimulationEvent(r,{type:"UnitMoved",actorId:c,position:S,payload:{origin:g,destination:S,movementType:C.movementType}}),r}},tl=Math.sqrt(3),fy=(e,n)=>{if(n)return e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n)},my=e=>{if(e)return{actorId:e.id,hex:e.position}},Pg=(e,n,a=ee)=>{if(!e||!n||be(e,n)!==1)return;const o=Gn(e,n);if(o<0)return;const r=Ee(e,a),d=[{x:a,y:0},{x:a/2,y:-(tl*a)/2},{x:-a/2,y:-(tl*a)/2},{x:-a,y:0},{x:-a/2,y:tl*a/2},{x:a/2,y:tl*a/2}][o];return d?{x:r.x+d.x,y:r.y+d.y}:void 0},dd=(e,n,a)=>{if(a)switch(a.kind){case"source_actor":return my(fy(e,n.sourceId));case"target_actor":return my(fy(e,n.targetId));case"source_hex":return n.sourceHex?{hex:n.sourceHex}:void 0;case"target_hex":return n.targetHex?{hex:n.targetHex}:void 0;case"contact_hex":return n.contactHex?{hex:n.contactHex}:void 0;case"contact_world":return!n.contactWorld&&!n.contactHex?void 0:{world:n.contactWorld,hex:n.contactHex};case"custom_hex":return{hex:a.hex};case"custom_world":return{world:a.world};default:return}},Ug=(e,n)=>{const a=e.turnNumber||0,o=e.stackTrace?.length||0,r=n.sourceId||"env",c=n.skillId||"none",d=n.phase||"instant",h=n.salt?`.${n.salt}`:"";return`t${a}.k${o}.${r}.${c}.${d}${h}`},TA=e=>{const n=String(e).toLowerCase();return n.includes("fire")||n.includes("lava")||n.includes("explosion")?"fire":n.includes("kinetic")||n.includes("momentum")||n.includes("wallcrack")?"kinetic":n.includes("void")?"void":n.includes("arcane")?"arcane":n.includes("hidden")||n.includes("shadow")?"shadow":"neutral"},EA=(e,n={})=>{const a=TA(e),o={signature:`UI.SPAWN.${a.toUpperCase()}.${String(e).toUpperCase()}`,family:"ui",primitive:"spawn",phase:"instant",element:a,variant:e,intensity:"medium"};switch(e){case"impact":return{...o,signature:"ATK.STRIKE.PHYSICAL.IMPACT",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"impact",targetRef:{kind:"target_hex"},contactRef:{kind:"contact_world"}};case"flash":return{...o,signature:`ATK.BLAST.${n.color?"ARCANE":"NEUTRAL"}.FLASH`,family:"attack",primitive:"blast",phase:"impact",element:n.color?"arcane":"neutral",variant:"flash",targetRef:{kind:"target_hex"}};case"spearTrail":return{...o,signature:"ATK.SHOOT.PHYSICAL.SPEAR_TRAIL",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"spear",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"}};case"explosion_ring":return{...o,signature:"ATK.BLAST.FIRE.EXPLOSION_RING",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"explosion_ring",targetRef:{kind:"target_hex"},intensity:"high"};case"lavaRipple":return{...o,signature:"ENV.HAZARD.FIRE.LAVA_RIPPLE",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_ripple",targetRef:{kind:"target_hex"}};case"lavaSink":return{...o,signature:"ENV.HAZARD.FIRE.SINK",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_sink",targetRef:{kind:"target_hex"},intensity:"high"};case"wallCrack":return{...o,signature:"ENV.COLLISION.KINETIC.WALL_CRACK",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"wall_crack",contactRef:{kind:"contact_world"},targetRef:{kind:"target_hex"},intensity:"high"};case"kineticWave":return{...o,signature:"ATK.PULSE.KINETIC.WAVE",family:"attack",primitive:"pulse",phase:"impact",element:"kinetic",variant:"kinetic_wave",targetRef:{kind:"target_hex"}};case"dashBlur":return{...o,signature:"MOVE.DASH.NEUTRAL.BLUR",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"dash_blur",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"}};case"hiddenFade":return{...o,signature:"STATE.FADE.SHADOW.HIDDEN",family:"status",primitive:"state_fade",phase:"instant",element:"shadow",variant:"hidden_fade",targetRef:{kind:"target_hex"}};case"combat_text":return{...o,signature:"UI.TEXT.NEUTRAL.POPUP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"combat_text",targetRef:{kind:"target_hex"}};case"shake":return{...o,signature:"UI.SHAKE.NEUTRAL.CAMERA",family:"ui",primitive:"shake",phase:"instant",element:"neutral",variant:"camera_shake"};case"freeze":return{...o,signature:"UI.FREEZE.NEUTRAL.HITSTOP",family:"ui",primitive:"freeze",phase:"instant",element:"neutral",variant:"freeze"};case"stunBurst":return{...o,signature:"STATE.APPLY.NEUTRAL.STUN_BURST",family:"status",primitive:"status_apply",phase:"impact",element:"neutral",variant:"stun_burst",targetRef:{kind:"target_hex"}};default:return{...o,signature:`UI.SPAWN.${a.toUpperCase()}.${String(e).toUpperCase()}`,variant:String(e).toLowerCase()}}},_A=(e,n)=>{const a=n.template,o=n.phase||a.phase||"instant",r=n.sequenceId||Ug(e,{sourceId:n.sourceId,skillId:n.skillId,phase:o}),c=dd(e,n,a.sourceRef),d=dd(e,n,a.targetRef),h=dd(e,n,a.contactRef),g={protocol:"juice-signature/v1",signature:n.signature||a.signature,family:a.family,primitive:a.primitive,phase:o,element:n.element||a.element,variant:n.variant||a.variant,intensity:n.intensity||a.intensity,source:c,target:d,contact:h,area:n.area||a.area,direction:n.direction||a.direction,path:n.path||a.path,text:n.text||a.text,camera:n.camera||a.camera,timing:n.timing||a.timing,flags:{...a.flags||{},...n.flags||{}},meta:{turnNumber:e.turnNumber||0,stackTick:e.stackTrace?.length||0,sequenceId:r,sourceId:n.sourceId,targetId:n.targetId,skillId:n.skillId,reason:n.reason,...n.meta||{}}};return g.flags&&Object.keys(g.flags).length===0&&delete g.flags,g.meta&&Object.keys(g.meta).length===0&&delete g.meta,{type:"juice_signature",payload:g}},qg=(e,n)=>{const a=_A(e,n);return{...e,visualEvents:[...e.visualEvents||[],a]}},wA={Impact:(e,n,a,o)=>{let r={...e};const c=n.target,d=c===r.player.id?r.player:r.enemies.find(f=>f.id===c);if(!d)return r;const h=n.direction,g=h?{q:d.position.q+h.q,r:d.position.r+h.r,s:d.position.s+h.s}:void 0,m=g?Pg(d.position,g):void 0;if(r=qg(r,{template:{signature:h?"ENV.COLLISION.KINETIC.IMPACT":"ATK.STRIKE.PHYSICAL.IMPACT",family:h?"environment":"attack",primitive:h?"collision":"strike",phase:"impact",element:h?"kinetic":"physical",variant:"impact",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},contactRef:{kind:"contact_world"}},sourceId:a.sourceId,targetId:c,sourceHex:o.resolveActorById(r,a.sourceId)?.position,targetHex:d.position,contactHex:g,contactWorld:m,direction:n.direction,intensity:n.damage>1?"high":"medium",flags:{blocked:!!h},meta:{legacyJuiceId:"impact",legacyMirrored:!0,reason:"impact"}}),n.damage>0)if(c===r.player.id)r.player=sa(r.player,n.damage);else{const f=b=>b.id===c?sa(b,n.damage):b;r.enemies=r.enemies.map(f).filter(b=>b.hp>0),r.companions&&(r.companions=r.companions.map(f).filter(b=>b.hp>0))}return r}},MA={PickupShield:(e,n)=>{let a={...e};const o=n.position||a.shieldPosition;if(o&&a.shieldPosition&&se(a.shieldPosition,o)){a.hasShield=!0,a.shieldPosition=void 0;const r={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Shield Bash.",slot:"utility",cooldown:3,currentCooldown:0,range:1,upgrades:[],activeUpgrades:[]};a.player.activeSkills.some(c=>c.id==="BULWARK_CHARGE")||(a.player={...a.player,activeSkills:[...a.player.activeSkills,r]})}return a},PickupSpear:(e,n)=>{let a={...e};const o=n.position||a.spearPosition;return o&&a.spearPosition&&se(a.spearPosition,o)&&(a.hasSpear=!0,a.spearPosition=void 0),a},SpawnItem:(e,n,a)=>{let o={...e};if(n.itemType==="spear")return o.spearPosition=n.position,a.sourceId===o.player.id&&(o.hasSpear=!1),o;if(n.itemType==="bomb"){const r=o.initialSeed??o.rngSeed??"0",c=(o.turnNumber<<16)+(o.actionLog?.length??0)+o.enemies.length,d=`bomb-${ws(r,c,8,"bomb")}`,h=ra({id:d,type:"enemy",subtype:"bomb",factionId:"enemy",position:n.position,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return h.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.enemies=[...o.enemies,h],o}return n.itemType==="shield"&&(o.shieldPosition=n.position,o.hasShield=!1),o},LavaSink:(e,n,a,o)=>{let r={...e};r=o.appendTimelineEvent(r,"HAZARD_CHECK","LavaSink",{target:n.target},a,!0,240);const c=n.target,d=c===r.player.id?r.player:r.enemies.find(h=>h.id===c);return d&&(r=o.appendTimelineEvent(r,"DEATH_RESOLVE","LavaSink",{targetId:c},{...a,targetId:c},!0,280),c===r.player.id?r.player=sa(r.player,99):(r.enemies=r.enemies.filter(h=>h.id!==c),r.dyingEntities=[...r.dyingEntities||[],d],r=o.addCorpseTraitAt(r,d.position)),r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:d.position}}]),r}},OA={Juice:(e,n,a,o)=>{let r={...e};const c=n.metadata||{},d=typeof c.phase=="string"?c.phase:void 0,g={...EA(n.effect,{color:n.color,text:n.text}),...typeof c.signature=="string"?{signature:c.signature}:{},...typeof c.family=="string"?{family:c.family}:{},...typeof c.primitive=="string"?{primitive:c.primitive}:{},...typeof c.element=="string"?{element:c.element}:{},...typeof c.variant=="string"?{variant:c.variant}:{},...typeof c.sourceRef=="object"&&c.sourceRef?{sourceRef:c.sourceRef}:{},...typeof c.targetRef=="object"&&c.targetRef?{targetRef:c.targetRef}:{},...typeof c.contactRef=="object"&&c.contactRef?{contactRef:c.contactRef}:{}},m=o.resolveActorById(r,a.sourceId);let f,b;typeof n.target=="string"?(f=n.target==="targetActor"?a.targetId||void 0:n.target,b=o.resolveActorById(r,f)?.position):n.target?(b=n.target,f=o.resolveActorAt(r,n.target)?.id):a.targetId&&(f=a.targetId,b=o.resolveActorById(r,a.targetId)?.position);const x=c.contactHex&&typeof c.contactHex.q=="number"?c.contactHex:void 0;let T=c.contactWorld&&typeof c.contactWorld.x=="number"?c.contactWorld:void 0;if(!T){const S=c.contactFromHex&&typeof c.contactFromHex.q=="number"?c.contactFromHex:void 0,A=c.contactToHex&&typeof c.contactToHex.q=="number"?c.contactToHex:void 0;T=Pg(S,A)}if(r=qg(r,{template:g,sourceId:a.sourceId,targetId:f,skillId:typeof c.skillId=="string"?c.skillId:void 0,reason:typeof c.reason=="string"?c.reason:void 0,sourceHex:m?.position,targetHex:b,contactHex:x,contactWorld:T,path:n.path,direction:n.direction,phase:d,sequenceId:typeof c.sequenceId=="string"?c.sequenceId:Ug(r,{sourceId:a.sourceId,skillId:typeof c.skillId=="string"?c.skillId:void 0,phase:d||g.phase,salt:n.effect}),intensity:n.intensity,text:n.text?{value:n.text,tone:typeof c.textTone=="string"?c.textTone:"system",color:n.color}:void 0,timing:typeof c.timing=="object"&&c.timing?c.timing:n.duration?{durationMs:n.duration,ttlMs:n.duration}:void 0,camera:typeof c.camera=="object"&&c.camera?c.camera:n.effect==="shake"?{shake:n.intensity||"medium"}:n.effect==="freeze"?{freezeMs:Math.max(0,Number(n.duration||80))}:void 0,area:typeof c.area=="object"&&c.area?c.area:void 0,flags:typeof c.flags=="object"&&c.flags?c.flags:void 0,meta:{legacyJuiceId:n.effect,legacyMirrored:o.legacyMirroredJuiceIds.has(n.effect),...typeof c.statusId=="string"?{statusId:c.statusId}:{}}}),n.effect==="combat_text"&&n.text&&(r.message=xt(r.message,n.text,"VERBOSE","SYSTEM")),n.effect==="shake"&&(r.visualEvents=[...r.visualEvents||[],{type:"shake",payload:{intensity:n.intensity||"medium",direction:n.direction}}]),n.effect==="freeze"&&(r.visualEvents=[...r.visualEvents||[],{type:"freeze",payload:{durationMs:Math.max(0,Number(n.duration||80))}}]),n.effect==="impact"&&n.target){const S=typeof n.target=="string"?n.target===r.player.id?r.player.position:r.enemies.find(A=>A.id===n.target)?.position:n.target;S&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"impact",position:S}}])}if(n.effect==="flash"&&n.target){const S=typeof n.target=="string"?n.target===r.player.id?r.player.position:r.enemies.find(A=>A.id===n.target)?.position:n.target;S&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"flash",position:S}}])}if(n.effect==="spearTrail"&&n.path&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"spear_trail",path:n.path}}]),n.effect==="lavaSink"&&n.target){const S=typeof n.target=="string"?n.target===r.player.id?r.player.position:r.enemies.find(A=>A.id===n.target)?.position:n.target;if(S){const A=r.enemies.find(O=>se(O.position,S));A&&(r.dyingEntities=[...r.dyingEntities||[],A],r.enemies=r.enemies.filter(O=>!se(O.position,S)),r.companions&&(r.companions=r.companions.filter(O=>!se(O.position,S))),r=o.addCorpseTraitAt(r,S),r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:S}}])}}return r}},CA={Message:(e,n,a,o)=>{let r=e;return r.message=[...r.message,zd(n.text,"INFO","SYSTEM")].slice(-50),r=o.appendSimulationEvent(r,{type:"MessageLogged",payload:{text:n.text}}),r},GameOver:e=>({...e,gameStatus:"lost"})},kA={Heal:(e,n,a,o)=>{let r={...e};const c=m=>({...m,hp:Math.min(m.maxHp,m.hp+n.amount)}),d=n.target==="targetActor"?a.targetId:n.target;let h,g;if(d){const m=d===r.player.id?r.player:r.enemies.find(f=>f.id===d)||r.companions?.find(f=>f.id===d);if(m){const f=d===r.player.id?"You":m.subtype||m.id;if(r.message=xt(r.message,`${f} recover ${n.amount} HP.`,"INFO","COMBAT"),d===r.player.id)r.player=c(r.player),h=r.player.id,g=r.player.position;else{const b=x=>x.id===d?c(x):x;r.enemies=r.enemies.map(b),r.companions&&(r.companions=r.companions.map(b)),h=m.id,g=m.position}}}return h&&(r=o.appendSimulationEvent(r,{type:"Healed",targetId:h,position:g,payload:{amount:n.amount,sourceId:a.sourceId}})),r},ApplyStatus:(e,n,a,o)=>{let r={...e};r=o.appendTimelineEvent(r,"STATUS_APPLY","ApplyStatus",{status:n.status,duration:n.duration,target:n.target},a,!0,160);let c="",d=null;typeof n.target=="string"?n.target==="targetActor"?c=a.targetId||"":c=n.target:d=n.target;let h=d;const g=a.sourceId?o.resolveActorById(r,a.sourceId):void 0,m=g?Dv(n.duration,Ie(g)):n.duration;if(c){const b=c===r.player.id?r.player:r.enemies.find(x=>x.id===c)||r.companions?.find(x=>x.id===c);if(b){h=b.position;const x=c===r.player.id?"You":`${b.subtype||"enemy"}#${b.id}`,T=c===r.player.id?"are":"is";if(r.message=xt(r.message,`${x} ${T} ${n.status}!`,"INFO","COMBAT"),c===r.player.id)r.player=Od(r.player,n.status,m);else{const S=A=>A.id===c?Od(A,n.status,m):A;r.enemies=r.enemies.map(S),r.companions&&(r.companions=r.companions.map(S))}}}n.status==="stunned"&&h&&(r.visualEvents=[...r.visualEvents||[],{type:"shake",payload:{intensity:"low"}},{type:"vfx",payload:{type:"stunBurst",position:h}},{type:"combat_text",payload:{text:"STUNNED",position:h}}]);const f=c||(h?o.resolveActorAt(r,h)?.id:void 0);return r=o.appendSimulationEvent(r,{type:"StatusApplied",targetId:f,position:h||void 0,payload:{status:n.status,duration:m,sourceId:a.sourceId}}),r}},py={player:100,footman:50,archer:60,shieldBearer:40,bomber:30,warlock:55,bomb:10},Cd=e=>{let n=e.speed;if(n===void 0){const o=e.subtype;n=e.type==="player"?py.player:py[o]??50}return e.statusEffects?.some(o=>o.type==="stunned")&&(n-=100),n+=Pv(Ie(e)),n},Ha=e=>{const n=[];n.push({actorId:e.player.id,initiative:Cd(e.player),hasActed:!1,turnStartPosition:void 0});for(const a of e.enemies)n.push({actorId:a.id,initiative:Cd(a),hasActed:!1,turnStartPosition:void 0});return n.sort((a,o)=>o.initiative!==a.initiative?o.initiative-a.initiative:a.actorId==="player"?-1:o.actorId==="player"?1:a.actorId.localeCompare(o.actorId)),{entries:n,currentIndex:-1,round:1}},NA=e=>e.currentIndex<0||e.currentIndex>=e.entries.length?null:e.entries[e.currentIndex],RA=e=>{let n=e.initiativeQueue;n||(n=Ha(e));let a=n.currentIndex+1;for(;a<n.entries.length&&n.entries[a].hasActed;)a++;return a>=n.entries.length?(n=Ha(e),n.round=(e.initiativeQueue?.round??0)+1,a=0,{queue:{...n,currentIndex:a},actorId:n.entries[a]?.actorId??null,newRound:!0}):{queue:{...n,currentIndex:a},actorId:n.entries[a]?.actorId??null,newRound:!1}},IA=(e,n)=>{const a=e.initiativeQueue;if(!a)return Ha(e);const o=a.entries.map(r=>{if(r.actorId===n.id){if(r.turnStartPosition)return r;const d=Xe(n.position).map(h=>ye(e,h)?.id).filter(Boolean);return{...r,turnStartPosition:{...n.position},turnStartNeighborIds:d}}return r});return{...a,entries:o}},LA=(e,n)=>{const a=e.initiativeQueue;if(!a)return Ha(e);const o=a.entries.map(r=>r.actorId===n?{...r,hasActed:!0}:r);return{...a,entries:o}},HA=(e,n)=>{const a=e.initiativeQueue;return a?a.entries.find(r=>r.actorId===n)?.turnStartPosition??null:null},BA=(e,n)=>{const a=e.initiativeQueue;return a?a.entries.find(r=>r.actorId===n)?.turnStartNeighborIds??null:null},Ho=e=>{const n=e.initiativeQueue;if(!n)return!0;if(n.currentIndex<0||n.currentIndex>=n.entries.length)return!1;const a=n.entries[n.currentIndex];return a.actorId===e.player.id&&!a.hasActed},fd=(e,n)=>{const a=e.entries.filter(c=>c.actorId!==n);let o=e.currentIndex;const r=e.entries.findIndex(c=>c.actorId===n);return r>=0&&r<=e.currentIndex&&o--,{...e,entries:a,currentIndex:Math.min(o,a.length-1)}},jA=(e,n)=>{const a={actorId:n.id,initiative:Cd(n),hasActed:!0,turnStartPosition:void 0};return{...e,entries:[...e.entries,a]}},DA={UpdateComponent:(e,n,a)=>{let o={...e};const r=(c,d,h)=>{const g=new Map(c.components||[]);return g.set(d,h),{...c,components:g}};if(n.target==="self")return o.player=r(o.player,n.key,n.value),o;if(n.target==="targetActor"&&a.targetId){if(a.targetId===o.player.id)return o.player=r(o.player,n.key,n.value),o;const c=d=>d.id===a.targetId?r(d,n.key,n.value):d;o.enemies=o.enemies.map(c),o.companions&&(o.companions=o.companions.map(c))}return o},SpawnActor:(e,n)=>{let a={...e};const o=No(n.actor);return a.enemies=[...a.enemies,o],o.companionOf&&(a.companions=[...a.companions||[],o]),a.initiativeQueue&&(a.initiativeQueue=jA(a.initiativeQueue,o)),a},PlaceFire:(e,n,a)=>{let o={...e,tiles:new Map(e.tiles)};const r=ue(n.position);let c=o.tiles.get(r);c?c={...c,traits:new Set(c.traits),effects:[...c.effects]}:c={baseId:"STONE",position:n.position,traits:new Set(_s.STONE.defaultTraits),effects:[]},o.tiles.set(r,c);const d=Na.applyEffect(c,"FIRE",n.duration,1,o,a.sourceId);return d.messages.length>0&&(o.message=oi(o.message,d.messages,"INFO","HAZARD")),o}},PA={PlaceTrap:(e,n)=>{const a=e.traps||[];return{...e,traps:[...a,{position:n.position,ownerId:n.ownerId,isRevealed:!1,cooldown:0,volatileCore:n.volatileCore,chainReaction:n.chainReaction,resetCooldown:n.resetCooldown}]}},RemoveTrap:(e,n)=>e.traps?{...e,traps:n.ownerId?e.traps.filter(a=>a.ownerId!==n.ownerId):e.traps.filter(a=>!se(a.position,n.position))}:e,SetTrapCooldown:(e,n)=>e.traps?{...e,traps:e.traps.map(a=>n.ownerId&&a.ownerId!==n.ownerId||!se(a.position,n.position)?a:{...a,cooldown:Math.max(0,n.cooldown)})}:e},UA={...CA,...hA,...SA,...AA,...MA,...PA,...pA,...kA,...wA,...OA,...DA},qA=(e,n,a,o)=>{const r=UA[n.type];return typeof r!="function"?null:r(e,n,a,o)};var hy={};const $A=(e,n)=>{const a=ue(n);let o=e;o.tiles===e.tiles&&(o={...o,tiles:new Map(o.tiles)});let r=o.tiles.get(a);return r?r={...r,traits:new Set(r.traits),effects:[...r.effects]}:r={baseId:"STONE",position:n,traits:new Set(_s.STONE.defaultTraits),effects:[]},r.traits.add("CORPSE"),o.tiles.set(a,r),o},zA=(e,n)=>{const a=ue(n),o=e.tiles.get(a);if(!o||!o.traits.has("CORPSE"))return e;let r=e;r.tiles===e.tiles&&(r={...r,tiles:new Map(r.tiles)});const c={...o,traits:new Set(o.traits),effects:[...o.effects]};return c.traits.delete("CORPSE"),r.tiles.set(a,c),r},VA=typeof process<"u"&&(hy?.HOP_ENGINE_WARN==="1"||hy?.HOP_ENGINE_DEBUG==="1"),yy={INTENT_START:1,MOVE_START:2,MOVE_END:3,ON_PASS:4,ON_ENTER:5,HAZARD_CHECK:6,STATUS_APPLY:7,DAMAGE_APPLY:8,DEATH_RESOLVE:9,INTENT_END:10},YA=e=>{const n=e||[];let a=0;for(const o of n)o.blocking&&(a+=Number(o.suggestedDurationMs||0));return a},KA=(e,n,a,o,r,c,d)=>{const h=e.timelineEvents||[],g=h.length,m=e.turnNumber||0,f=r.sourceId||r.targetId,b=r.stepId||`${m}:${f||"system"}`,x=r.stepId||b,T=x?[...h].reverse().find(A=>(A.stepId||A.groupId)===x):void 0;if(T){const A=yy[T.phase]||0,O=yy[n]||0;A>O&&VA&&console.warn("[TURN_STACK] Non-monotonic timeline phase order detected.",{stepId:x,previous:T.phase,next:n})}const S=`${x}:${g}:${n}`;return{...e,timelineEvents:[...h,{id:S,turn:m,actorId:f,stepId:x,phase:n,type:a,payload:o,blocking:c,groupId:b,suggestedDurationMs:d}]}},FA=(e,n)=>{const a=e.simulationEvents||[],o=`sim:${e.turnNumber||0}:${a.length}:${n.type}`;return{...e,simulationEvents:[...a,{...n,id:o,turn:e.turnNumber||0}]}},$g=(e,n)=>{if(n)return e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n)},XA=(e,n)=>{if(n)return se(e.player.position,n)?e.player:e.enemies.find(a=>se(a.position,n))||e.companions?.find(a=>se(a.position,n))},WA=new Set(["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage","burning","oil_explosion"]),GA=new Set(["impact","flash","spearTrail","shake"]),JA=(e,n,a,o,r,c)=>{if(!o)return{amount:n,outgoing:1,incoming:1,total:1};if(c&&WA.has(c))return{amount:n,outgoing:1,incoming:1,total:1};const d=$g(e,a);if(!d)return{amount:n,outgoing:1,incoming:1,total:1};const h=lv(d,r),g=cv(o,r),m=h*g;return{amount:Math.max(0,Math.floor(n*m)),outgoing:h,incoming:g,total:m}},kd=(e,n,a={})=>{const o={...e},r=qA(o,n,a,{applyAtomicEffect:kd,applyEffects:Jn,addCorpseTraitAt:$A,removeCorpseTraitAt:zA,scaleCombatProfileDamage:JA,appendSimulationEvent:FA,appendTimelineEvent:KA,getBlockingTimelineDurationMs:YA,legacyMirroredJuiceIds:GA,resolveActorAt:XA,resolveActorById:$g});return r||o},Jn=(e,n,a={})=>{const o=e.stackTrace?.length||0,r=uy(e,n,{apply:(g,m)=>kd(g,m,a),describe:g=>g.type,preserveInputOrder:!0,startTick:o+1});let c=r.state,d=[...e.stackTrace||[],...r.trace];const h=fA(c);if(h.length>0){const g=uy(c,h,{apply:(m,f)=>kd(m,f,{}),describe:m=>m.type,preserveInputOrder:!0,startTick:d.length+1});c=g.state,d=[...d,...g.trace]}return{...c,stackTrace:d}};function Ci(e){return e.statusEffects?.some(n=>n.type==="stunned")??!1}function QA(e){return e.statusEffects?.some(n=>n.type==="rooted")??!1}function gy(e,n=1){if(!e.statusEffects||e.statusEffects.length===0)return e;const a=e.statusEffects.map(o=>({...o,duration:o.duration-n})).filter(o=>o.duration>0);return{...e,statusEffects:a}}const zg={id:"AUTO_ATTACK",name:"Auto Attack",description:"Automatically strike adjacent enemies that started the turn adjacent to you.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,n,a,o=[],r)=>{const c=[],d=[];let h=0;const g=(e.timelineEvents||[]).some(A=>A.phase==="STATUS_APPLY"&&A.type==="ApplyStatus"&&A.payload?.status==="stunned"&&(A.payload?.target===n.id||typeof A.payload?.target=="object"&&A.payload?.target&&se(A.payload.target,n.position)));if(Ci(n)||g)return{effects:c,messages:d,kills:0};const m=Xe(n.position);let f=1;o.includes("HEAVY_HANDS")&&(f+=1);let b=0;const x=(A,O,_)=>{const E=Gn(n.position,O),w=E>=0?Yt(E):void 0,C=Math.max(0,_-(A.temporaryArmor||0)),I=A.hp-C<=0,N=I?"extreme":_>=4?"high":_>=2?"medium":"low",H=b*80;b+=1,c.push({type:"Juice",effect:"lightImpact",target:A.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"anticipation",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:H,durationMs:70,ttlMs:90}}}),c.push({type:"Juice",effect:"dashBlur",target:A.id,path:[n.position,O],intensity:N==="extreme"?"high":"medium",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"travel",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:H+70,durationMs:50,ttlMs:80}}}),c.push({type:"Juice",effect:"heavyImpact",target:A.id,intensity:N,direction:w,metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},...w?{contactRef:{kind:"contact_world"},contactHex:O,contactToHex:O,contactFromHex:n.position}:{},skillId:"AUTO_ATTACK",camera:{kick:N==="extreme"?"medium":"light",freezeMs:N==="extreme"?50:35},timing:{delayMs:H+120,durationMs:60,ttlMs:120},flags:{lethal:I}}}),c.push({type:"Juice",effect:"lightImpact",target:A.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"aftermath",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:H+180,durationMs:80,ttlMs:110}}})},T=r?.persistentTargetIds||[],S=r?.previousNeighbors||[];if(T.length===0&&S.length===0)return{effects:c,messages:d,kills:0};for(const A of m){const O=ye(e,A);if(!O||O.hp<=0||O.id===n.id||n.factionId===O.factionId)continue;if(T.length>0?T.includes(O.id):S.some(E=>se(E,A))){const E=Pt({attackerId:n.id,targetId:O.id,skillId:"AUTO_ATTACK",basePower:f,trinity:Ie(n),targetTrinity:Ie(O),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});x(O,A,E.finalPower),c.push({type:"Damage",target:A,amount:E.finalPower,reason:"auto_attack",scoreEvent:E.scoreEvent});const w=n.factionId==="player"?"You":`${n.subtype||"enemy"}#${n.id}`,C=O.factionId==="player"?"you":`${O.subtype||"enemy"}#${O.id}`;d.push(`${w} attacked ${C}!`),O.hp<=f&&h++}}if(o.includes("CLEAVE")&&c.length>0)for(const A of m){if(c.some(N=>N.type==="Damage"&&typeof N.target=="object"&&"q"in N.target&&se(N.target,A)))continue;const _=ye(e,A);if(!_||_.id===n.id||!(n.factionId!==_.factionId))continue;const w=Pt({attackerId:n.id,targetId:_.id,skillId:"AUTO_ATTACK",basePower:f,trinity:Ie(n),targetTrinity:Ie(_),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});x(_,A,w.finalPower),c.push({type:"Damage",target:A,amount:w.finalPower,reason:"auto_attack",scoreEvent:w.scoreEvent});const C=n.factionId==="player"?"You":`${n.subtype||"enemy"}#${n.id}`,I=_.factionId==="player"?"you":`${_.subtype||"enemy"}#${_.id}`;d.push(`${C} cleaved ${I}!`),_.hp<=f&&h++}return{effects:c,messages:d,kills:h}},upgrades:{HEAVY_HANDS:{id:"HEAVY_HANDS",name:"Heavy Hands",description:"Auto-attack damage +1"},CLEAVE:{id:"CLEAVE",name:"Cleave",description:"When auto-attack triggers, hit ALL adjacent enemies"}},scenarios:Ze("AUTO_ATTACK")},ZA=(e,n,a,o,r,c)=>{if(!n.activeSkills?.some(x=>x.id==="AUTO_ATTACK"))return{state:e,kills:0,messages:[]};const g=n.activeSkills?.find(x=>x.id==="AUTO_ATTACK")?.activeUpgrades||[],m=new Map;if(e.initiativeQueue)for(const x of e.initiativeQueue.entries)x.turnStartPosition&&m.set(x.actorId,x.turnStartPosition);const f=zg.execute(e,n,void 0,g,{previousNeighbors:a,attackerTurnStartPosition:o,allActorsTurnStartPositions:m,persistentTargetIds:r});return{state:Jn(e,f.effects,{sourceId:n.id,targetId:void 0,stepId:c}),kills:f.kills||0,messages:f.messages}},eT={id:"BASIC_ATTACK",name:"Basic Attack",description:"Strike an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,n,a,o=[])=>{const r=[],c=[],d=(e.timelineEvents||[]).some(C=>C.phase==="STATUS_APPLY"&&C.type==="ApplyStatus"&&C.payload?.status==="stunned"&&(C.payload?.target===n.id||typeof C.payload?.target=="object"&&C.payload?.target&&se(C.payload.target,n.position)));if(Ci(n)||d)return c.push("Cannot attack while stunned!"),{effects:r,messages:c,consumesTurn:!0};if(!a)return c.push("Select a target!"),{effects:r,messages:c,consumesTurn:!1};if(!kt(n.position,a,1))return c.push("Target out of range!"),{effects:r,messages:c,consumesTurn:!1};const g=ye(e,a);if(!g||g.id===n.id)return c.push("No enemy at target!"),{effects:r,messages:c,consumesTurn:!1};if(g.factionId===n.factionId)return c.push("Cannot attack friendlies!"),{effects:r,messages:c,consumesTurn:!1};if(g.subtype==="bomb")return c.push("Cannot attack a bomb!"),{effects:r,messages:c,consumesTurn:!1};let m=1;o.includes("POWER_STRIKE")&&(m+=2);const f=se(n.previousPosition||n.position,n.position);o.includes("EXTENDED_REACH")&&f&&(m+=1);const b=Pt({attackerId:n.id,targetId:g.id,skillId:"BASIC_ATTACK",basePower:m,trinity:Ie(n),targetTrinity:Ie(g),damageClass:"physical",scaling:[{attribute:"body",coefficient:.5}],statusMultipliers:[],inDangerPreviewHex:!!e.intentPreview?.dangerTiles?.some(C=>se(C,n.position)),theoreticalMaxPower:m}),x=b.finalPower,T=Math.max(0,x-(g.temporaryArmor||0)),S=g.hp-T<=0,A=Gn(n.position,g.position),O=A>=0?Yt(A):void 0,_=S?"extreme":x>=4?"high":x>=2?"medium":"low";r.push({type:"Juice",effect:"lightImpact",target:"targetActor",intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"anticipation",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:0,durationMs:110,ttlMs:140}}}),r.push({type:"Juice",effect:"dashBlur",target:g.id,path:[n.position,g.position],intensity:_==="extreme"?"high":"medium",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"travel",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:110,durationMs:70,ttlMs:100}}}),r.push({type:"Juice",effect:"heavyImpact",target:g.id,intensity:_,direction:O,metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},...O?{contactRef:{kind:"contact_world"},contactHex:g.position,contactToHex:g.position,contactFromHex:n.position}:{},skillId:"BASIC_ATTACK",camera:{kick:_==="extreme"?"heavy":_==="high"?"medium":"light",freezeMs:_==="extreme"?80:55},timing:{delayMs:180,durationMs:90,ttlMs:150},flags:{lethal:S,..._==="extreme"?{crit:!0}:{}}}}),r.push({type:"Damage",target:"targetActor",amount:x,reason:"basic_attack",scoreEvent:b.scoreEvent}),r.push({type:"Juice",effect:"lightImpact",target:g.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"aftermath",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:280,durationMs:130,ttlMs:170}}});const E=n.type==="player"?"You":`${n.subtype||"enemy"}#${n.id}`,w=g.type==="player"?"you":`${g.subtype||"enemy"}#${g.id}`;return c.push(`${E} attacked ${w}!`),o.includes("VAMPIRIC")&&g.hp-T<=0&&(r.push({type:"Heal",target:n.id,amount:1}),c.push("Vampiric heal!")),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ye(e,n);return a?Xe(n).filter(r=>{const c=ye(e,r);return!!c&&c.subtype!=="bomb"&&c.id!==a.id&&c.factionId!==a.factionId}):[]},upgrades:{EXTENDED_REACH:{id:"EXTENDED_REACH",name:"Disciplined Stance",description:"+1 damage when attacking without moving first."},POWER_STRIKE:{id:"POWER_STRIKE",name:"Power Strike",description:"Damage +2"},VAMPIRIC:{id:"VAMPIRIC",name:"Vampiric",description:"Heal 1 HP on kill"}},scenarios:Ze("BASIC_ATTACK")},tT=e=>{if(!e||e.length===0)return e;let n=!1;const a=e.map(o=>(o.currentCooldown||0)<=0?o:(n=!0,{...o,currentCooldown:0}));return n?a:e},by=e=>{const n=tT(e.activeSkills),a=(e.actionCooldown||0)>0?0:e.actionCooldown;return n===e.activeSkills&&a===e.actionCooldown?e:{...e,activeSkills:n||e.activeSkills,actionCooldown:a}},Vd=e=>e.enemies.filter(a=>a.hp>0&&a.factionId==="enemy").length===0,nT=e=>{if(!Vd(e))return e;const n=by(e.player),a=e.companions?.map(by),o=e.traps?.map(d=>d.cooldown>0?{...d,cooldown:0}:d),r=!!e.companions&&a?.some((d,h)=>d!==e.companions?.[h]),c=!!e.traps&&o?.some((d,h)=>d!==e.traps?.[h]);return n===e.player&&!r&&!c?e:{...e,player:n,...r?{companions:a}:{},...c?{traps:o}:{}}},xy=(e,n)=>Vd(e)?20:Math.max(n.speed||1,1),Vg=(e,n)=>$e.isWithinBounds(e,n)?Ne.getTraitsAt(e,n).has("BLOCKS_MOVEMENT"):!0,vy=(e,n,a,o)=>{const r=new Map,c=[],d=g=>`${g.q},${g.r}`,h=[{p:a,cost:0}];for(r.set(d(a),0);h.length>0;){const g=h.shift();if(!(g.cost>=o))for(const m of Xe(g.p)){if(!$e.isWithinBounds(e,m)||!Ne.isWalkable(e,m)||!Rg(e,n,m,"BASIC_MOVE"))continue;const f=ye(e,m),b=!!f&&f.id!==n.id,x=b&&f.factionId===n.factionId;if(b&&!x)continue;const T=d(m),S=g.cost+1;r.has(T)&&r.get(T)<=S||(r.set(T,S),!x&&ki(e,n,m)&&!Vg(e,m)&&c.push(m),h.push({p:m,cost:S}))}}return c},iT=(e,n,a,o,r)=>{const c=T=>`${T.q},${T.r}`,d=T=>{const[S,A]=T.split(",").map(Number);return{q:S,r:A,s:-S-A}},h=[a],g=new Map([[c(a),0]]),m=new Map([[c(a),null]]);for(;h.length>0;){const T=h.shift(),S=c(T),A=g.get(S);if(!(A>=r))for(const O of Xe(T)){if(!$e.isWithinBounds(e,O)||!Ne.isWalkable(e,O)||!Rg(e,n,O,"BASIC_MOVE"))continue;const _=ye(e,O),E=!!_&&_.id!==n.id,w=E&&_.factionId===n.factionId;if(E&&!w)continue;const C=c(O),I=A+1;g.has(C)&&g.get(C)<=I||(g.set(C,I),m.set(C,S),h.push(O))}}const f=c(o);if(!m.has(f)||Vg(e,o)||!ki(e,n,o))return null;const b=[];let x=f;for(;x;)b.push(d(x)),x=m.get(x)||null;return b.reverse(),b},aT={id:"BASIC_MOVE",name:"Walk",description:"Move to an adjacent or nearby tile within your speed range.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};const c=xy(e,n),h=vy(e,n,n.position,c).some(f=>se(f,a)),g=iT(e,n,n.position,a,c);if(!h||!g||g.length<2)return r.push("Target out of reach or blocked!"),{effects:o,messages:r,consumesTurn:!1};o.push({type:"Displacement",target:"self",destination:a,source:n.position,path:g,simulatePath:!0,ignoreCollision:!0});const m=n.id===e.player.id?"You":`${n.subtype||"enemy"}#${n.id}`;return r.push(`${m} moved to (${a.q}, ${a.r}). [Range ${c}]`),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ye(e,n);if(!a)return[];const o=xy(e,a);return vy(e,a,n,o).filter(c=>!ca(e,c,a.id))},upgrades:{},scenarios:Ze("BASIC_MOVE")},sT={id:"BOMB_TOSS",name:"Bomb Toss",description:"Throw a bomb to a nearby tile.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:2},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};if(!kt(n.position,a,3))return r.push("Out of range!"),{effects:o,messages:r,consumesTurn:!1};if(!Ne.isWalkable(e,a))return r.push("Target blocked!"),{effects:o,messages:r,consumesTurn:!1};if(ye(e,a))return r.push("Target occupied!"),{effects:o,messages:r,consumesTurn:!1};const d=`bomb-${n.id}-${e.turnNumber}-${e.actionLog?.length??0}-${a.q}_${a.r}_${a.s}`,h=ra({id:d,type:"enemy",subtype:"bomb",factionId:n.factionId,position:a,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return h.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.push({type:"SpawnActor",actor:h}),r.push("Bomb tossed!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const o=[];for(let r=-3;r<=3;r++)for(let c=Math.max(-3,-r-3);c<=Math.min(3,-r+3);c++){const d={q:n.q+r,r:n.r+c,s:n.s-r-c};kt(n,d,3)&&Ne.isWalkable(e,d)&&(ye(e,d)||o.push(d))}return o},upgrades:{}},oT={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Charge into an adjacent enemy, pushing a chain. Wall hard-stop stuns the chain.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:3},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};if(be(n.position,a)!==1)return r.push("Target not adjacent!"),{effects:o,messages:r,consumesTurn:!1};const d=Wn(e.enemies,a);if(!d)return r.push("No target!"),{effects:o,messages:r,consumesTurn:!1};const{isAxial:h,directionIndex:g}=Pn(n.position,a);if(!h)return{effects:o,messages:r,consumesTurn:!1};const m=Yt(g),f=[d];let b={q:d.position.q+m.q,r:d.position.r+m.r,s:d.position.s+m.s};for(;;){const S=Wn(e.enemies,b);if(S){if(f.push(S),b={q:b.q+m.q,r:b.r+m.r,s:b.s+m.s},f.length>6)break;continue}break}const x=[];for(let S=0;S<f.length;S++){const A=f[S],O=S===0?2:1,_={q:A.position.q+m.q*O,r:A.position.r+m.r*O,s:A.position.s+m.s*O};x.push({actor:A,dest:_})}let T=!1;for(const S of x){const A=e.tiles.get(ue(S.dest));if(A?.baseId==="WALL"||A?.traits.has("BLOCKS_MOVEMENT")){T=!0;break}if(e.enemies.find(_=>se(_.position,S.dest)&&!f.some(E=>E.id===_.id))){T=!0;break}}if(T){for(const S of f)o.push({type:"ApplyStatus",target:S.position,status:"stunned",duration:1}),r.push("Chain blocked! Stunned.");return{effects:o,messages:r}}for(const S of x)o.push({type:"Displacement",target:S.actor.id,destination:S.dest});return o.push({type:"Displacement",target:"self",destination:d.position}),r.push("Bulwark Charge!"),{effects:o,messages:r}},getValidTargets:(e,n)=>[{q:n.q+1,r:n.r,s:n.s-1},{q:n.q+1,r:n.r-1,s:n.s},{q:n.q,r:n.r-1,s:n.s+1},{q:n.q-1,r:n.r,s:n.s+1},{q:n.q-1,r:n.r+1,s:n.s},{q:n.q,r:n.r+1,s:n.s-1}].filter(o=>!!Wn(e.enemies,o)),upgrades:{},scenarios:[{id:"chain_stun",title:"Chain-Stun",description:"Wall prevents chain, chain gets stunned",setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,n)=>!0}]},rT=(e,n)=>!!e.tiles.get(ue(n))?.traits?.has("CORPSE"),lT=(e,n,a)=>{const o=[];return e.tiles.forEach(r=>{r.traits.has("CORPSE")&&be(n,r.position)<=a&&o.push(r.position)}),o},cT={id:"CORPSE_EXPLOSION",name:"Corpse Explosion",description:"Detonate a target corpse, dealing damage in a 1-tile radius.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:2},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};if(!rT(e,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!kt(n.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};o.push({type:"RemoveCorpse",position:a});const d=[a,...Xe(a)],h=Ie(n),g=!!e.intentPreview?.dangerTiles?.some(m=>se(m,n.position));for(const m of d){const f=ye(e,m),b=Pt({attackerId:n.id,targetId:f?.id||ue(m),skillId:"CORPSE_EXPLOSION",basePower:2,trinity:h,targetTrinity:f?Ie(f):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.25}],statusMultipliers:[],inDangerPreviewHex:g,theoreticalMaxPower:2});o.push({type:"Damage",target:m,amount:b.finalPower,reason:"corpse_explosion",scoreEvent:b.scoreEvent})}return o.push({type:"Juice",effect:"explosion_ring",target:a,metadata:{signature:"ATK.BLAST.VOID.CORPSE_EXPLOSION",family:"attack",primitive:"blast",phase:"impact",element:"void",variant:"corpse_explosion",targetRef:{kind:"target_hex"},skillId:"CORPSE_EXPLOSION"}}),o.push({type:"Juice",effect:"shake",intensity:"high",metadata:{signature:"UI.SHAKE.VOID.CORPSE_EXPLOSION",family:"ui",primitive:"shake",phase:"impact",element:"void",variant:"corpse_explosion_shake",skillId:"CORPSE_EXPLOSION",camera:{shake:"high"}}}),o.push({type:"Juice",effect:"combat_text",target:a,text:"BOOM!",metadata:{signature:"UI.TEXT.VOID.CORPSE_EXPLOSION",family:"ui",primitive:"text",phase:"impact",element:"void",variant:"corpse_explosion_text",targetRef:{kind:"target_hex"},skillId:"CORPSE_EXPLOSION",textTone:"damage"}}),r.push("Corpse exploded!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>lT(e,n,4),upgrades:{},scenarios:Ze("CORPSE_EXPLOSION")},Ni=(e,n)=>e.type!=="Juice"?e:{...e,metadata:{...e.metadata||{},...n}},Yg=e=>!!e&&typeof e.q=="number"&&typeof e.r=="number"&&typeof e.s=="number",Kg=e=>Yg(e)?Math.abs(e.q)+Math.abs(e.r)+Math.abs(e.s)===2:!1,Fg=(e,n)=>({q:e.q-n.q,r:e.r-n.r,s:e.s-n.s}),he={shake:(e,n)=>({type:"Juice",effect:"shake",intensity:e,direction:n,metadata:{signature:"UI.SHAKE.NEUTRAL.CAMERA",family:"ui",primitive:"shake",phase:"instant",element:"neutral",variant:"camera_shake",camera:{shake:e,...n?{kick:e==="extreme"?"heavy":e==="high"?"medium":"light"}:{}}}}),flash:e=>({type:"Juice",effect:"flash",intensity:"high",color:e,metadata:{signature:"ATK.BLAST.NEUTRAL.FLASH",family:"attack",primitive:"blast",phase:"impact",element:"neutral",variant:"flash"}}),freeze:(e=80)=>({type:"Juice",effect:"freeze",duration:e,metadata:{signature:"UI.FREEZE.NEUTRAL.HITSTOP",family:"ui",primitive:"freeze",phase:"instant",element:"neutral",variant:"hitstop",camera:{freezeMs:e},timing:{durationMs:e,ttlMs:e}}}),combatText:(e,n,a)=>({type:"Juice",effect:"combat_text",text:e,target:n,color:a}),momentumTrail:(e,n)=>({type:"Juice",effect:"momentumTrail",path:e,intensity:n}),heavyImpact:(e,n)=>({type:"Juice",effect:"heavyImpact",target:e,direction:n,intensity:"extreme"}),lightImpact:e=>({type:"Juice",effect:"lightImpact",target:e,intensity:"low"}),kineticWave:(e,n,a)=>({type:"Juice",effect:"kineticWave",target:e,direction:n,intensity:a}),stunBurst:e=>({type:"Juice",effect:"stunBurst",target:e,intensity:"medium"}),lavaRipple:e=>({type:"Juice",effect:"lavaRipple",target:e,intensity:"medium"}),wallCrack:(e,n)=>({type:"Juice",effect:"wallCrack",target:e,direction:n,intensity:"high"}),explosionRing:e=>({type:"Juice",effect:"explosion_ring",target:e})};he.combatText=(e=>(n,a,o)=>Ni(e(n,a,o),{signature:"UI.TEXT.NEUTRAL.POPUP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"combat_text",targetRef:typeof a=="string"?{kind:"target_actor"}:{kind:"target_hex"},textTone:/^[-]/.test(n)?"damage":/^\+/.test(n)?"heal":"system"}))(he.combatText);he.momentumTrail=(e=>(n,a)=>Ni(e(n,a),{signature:"MOVE.DASH.KINETIC.MOMENTUM_TRAIL",family:"movement",primitive:"dash",phase:"travel",element:"kinetic",variant:"momentum_trail"}))(he.momentumTrail);he.heavyImpact=(e=>(n,a)=>{const o={signature:"ATK.STRIKE.PHYSICAL.HEAVY",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"heavy_impact",sourceRef:{kind:"source_actor"}};return Yg(n)?(o.targetRef={kind:"target_hex"},a&&Kg(a)&&(o.contactHex=n,o.contactToHex=n,o.contactFromHex=Fg(n,a),o.contactRef={kind:"contact_world"})):o.targetRef={kind:"target_actor"},Ni(e(n,a),o)})(he.heavyImpact);he.lightImpact=(e=>n=>Ni(e(n),{signature:"ATK.STRIKE.PHYSICAL.LIGHT",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"light_impact",sourceRef:{kind:"source_actor"},targetRef:typeof n=="string"?{kind:"target_actor"}:{kind:"target_hex"}}))(he.lightImpact);he.kineticWave=(e=>(n,a,o)=>Ni(e(n,a,o),{signature:"ATK.PULSE.KINETIC.WAVE",family:"attack",primitive:"pulse",phase:"impact",element:"kinetic",variant:"kinetic_wave",targetRef:{kind:"target_hex"},sourceRef:{kind:"source_hex"}}))(he.kineticWave);he.stunBurst=(e=>n=>Ni(e(n),{signature:"STATE.APPLY.NEUTRAL.STUN_BURST",family:"status",primitive:"status_apply",phase:"impact",element:"neutral",variant:"stun_burst",targetRef:typeof n=="string"?{kind:"target_actor"}:{kind:"target_hex"}}))(he.stunBurst);he.lavaRipple=(e=>n=>Ni(e(n),{signature:"ENV.HAZARD.FIRE.LAVA_RIPPLE",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_ripple",targetRef:{kind:"target_hex"}}))(he.lavaRipple);he.wallCrack=(e=>(n,a)=>{const o={signature:"ENV.COLLISION.KINETIC.WALL_CRACK",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"wall_crack",targetRef:{kind:"target_hex"}};return Kg(a)&&(o.contactHex=n,o.contactToHex=n,o.contactFromHex=Fg(n,a),o.contactRef={kind:"contact_world"}),Ni(e(n,a),o)})(he.wallCrack);he.explosionRing=(e=>n=>Ni(e(n),{signature:"ATK.BLAST.FIRE.EXPLOSION_RING",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"explosion_ring",targetRef:{kind:"target_hex"}}))(he.explosionRing);const _t={GRAPPLE_HOOK:{anticipation:(e,n)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,n],intensity:"low",color:"#00ff88"}],execution:e=>[{type:"Juice",effect:"hookCable",path:e,intensity:"medium",duration:200,color:"#00ff88"},he.shake("low")],impact:(e,n)=>[{type:"Juice",effect:"grappleHookWinch",target:e,direction:n,intensity:"high",duration:150},he.shake("medium",n)],resolution:(e,n)=>[he.momentumTrail(e,n>6?"high":"medium"),he.kineticWave(e[0],e[e.length-1],"high")]},SHIELD_THROW:{anticipation:(e,n)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,n],intensity:"medium",color:"#4169e1"}],execution:e=>[{type:"Juice",effect:"shieldArc",path:e,intensity:"high",duration:300,metadata:{rotation:720}},{type:"Juice",effect:"shieldSpin",path:e,intensity:"medium"}],impact:(e,n)=>[he.heavyImpact(e,n),he.shake("high",n),he.freeze(120),he.combatText("IMPACT!",e,"#ff4444")],resolution:e=>[he.kineticWave(e[0],e[e.length-1],"high"),he.momentumTrail(e,"high")]},DASH:{anticipation:(e,n)=>[{type:"Juice",effect:"chargeUp",target:e,direction:n,intensity:"medium",duration:100}],execution:e=>[{type:"Juice",effect:"dashBlur",path:e,intensity:"high",duration:150},he.momentumTrail(e,"medium")],impact:(e,n,a)=>a?[he.heavyImpact(e,n),he.shake("extreme",n),he.freeze(100),he.combatText("SHUNT!",e,"#ffaa00")]:[he.lightImpact(e)],resolution:e=>e?[he.kineticWave(e[0],e[e.length-1],"high"),he.momentumTrail(e,"high")]:[]},SPEAR_THROW:{anticipation:(e,n)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,n],intensity:"low",color:"#ff6b6b"}],execution:e=>[{type:"Juice",effect:"spearTrail",path:e,intensity:"high",duration:150},{type:"Juice",effect:"spearWhistle",path:e,intensity:"medium",metadata:{pitch:"rising"}}],impact:(e,n)=>n?[he.heavyImpact(e),he.shake("medium"),he.freeze(60),he.combatText("LETHAL",e,"#ff0000")]:[he.lightImpact(e),he.combatText("MISS",e,"#888888")],resolution:()=>[]},VAULT:{anticipation:(e,n)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,n],intensity:"low",color:"#00ddff",metadata:{arc:"high"}}],execution:e=>[{type:"Juice",effect:"vaultLeap",path:e,intensity:"medium",duration:250,metadata:{arc:"parabolic"}}],impact:(e,n)=>n?[he.heavyImpact(e),he.shake("medium"),he.stunBurst(e),he.combatText("STUN!",e,"#ffff00")]:[he.lightImpact(e)],resolution:()=>[]}},md={lavaSink:e=>[{type:"Juice",effect:"lavaSink",target:e,intensity:"extreme",duration:500,metadata:{particleCount:50}},he.lavaRipple(e),he.shake("high"),he.combatText("CONSUMED",e,"#ff4400")],wallImpact:(e,n,a)=>{const o=[he.wallCrack(e,n),he.shake("high",n)];return a&&(o.push(he.stunBurst(e)),o.push(he.combatText("STUNNED",e,"#ffaa00"))),o},voidConsume:e=>[{type:"Juice",effect:"voidConsume",target:e,intensity:"extreme",duration:800,color:"#000000"},he.freeze(150),he.combatText("VOID",e,"#8800ff")]};function Ul(e,n){const{origin:a,direction:o,momentum:r}=n,c=[];c.push(he.kineticWave(a,o,r>6?"high":"medium"));const d=rn(a,{q:o.q*(r+10),r:o.r*(r+10),s:o.s*(r+10)}),h=ht(a,d);let g=r,m=uT(e,h);for(;g>0&&m.length>0;){const f=dT(m);if(f.length===0)break;const b=f.length;if(g<b){const E=f[f.length-1],w=g;g=0;const C=[h[E.pos1D]];for(let I=0;I<w;I++){const N=E.pos1D+1,H=h[N];if(!H||!la(H,e.gridWidth,e.gridHeight)||Sy(e,H)){c.push({type:"Impact",target:E.id,damage:w-I,direction:o});break}if(E.pos1D=N,C.push(H),Ay(e,H)){c.push({type:"LavaSink",target:E.id}),c.push(...md.lavaSink(H));break}}C.length>1&&(c.push({type:"Displacement",target:E.id,destination:C[C.length-1],path:C,animationDuration:C.length*80}),c.push(he.momentumTrail(C,"medium")));break}const x=f[f.length-1],T=x.pos1D+1,S=h[T];if(!S||!la(S,e.gridWidth,e.gridHeight)||Sy(e,S)){c.push({type:"ApplyStatus",target:x.id,status:"stunned",duration:1}),S&&c.push(...md.wallImpact(S,o,!0));break}const A=new Map;for(const E of f){const w=h[E.pos1D];E.pos1D+=1;const C=h[E.pos1D];A.set(E.id,[w,C])}const O=[...f].reverse();for(const E of O){const w=A.get(E.id);w&&c.push({type:"Displacement",target:E.id,destination:w[w.length-1],path:w,ignoreCollision:!0,animationDuration:150})}const _=Array.from(A.values()).flat();_.length>0&&c.push(he.momentumTrail(_,b>2?"high":"medium")),g-=b;for(let E=m.length-1;E>=0;E--){const w=m[E],C=h[w.pos1D];Ay(e,C)&&(c.push({type:"LavaSink",target:w.id}),c.push(...md.lavaSink(C)),m.splice(E,1))}if(g>0){const E=f[f.length-1];m=m.filter(C=>C.pos1D>=E.pos1D);const w=m.filter(C=>C.pos1D>E.pos1D);m=[E,...w]}}return c}function uT(e,n){const a=[],o=[e.player,...e.enemies];for(const r of o){const c=n.findIndex(d=>se(d,r.position));c!==-1&&a.push({id:r.id,pos1D:c})}return a.sort((r,c)=>r.pos1D-c.pos1D)}function dT(e){if(e.length===0)return[];const n=[];let a=e[0];n.push(a);for(let o=1;o<e.length;o++){const r=e[o];if(r.pos1D===a.pos1D||r.pos1D===a.pos1D+1)n.push(r),a=r;else break}return n}function Sy(e,n){const a=Ne.getTraitsAt(e,n);return a.has("BLOCKS_MOVEMENT")||a.has("BLOCKS_LOS")}function Ay(e,n){const a=Ne.getTraitsAt(e,n);return a.has("HAZARDOUS")||a.has("LIQUID")}const fT={id:"DASH",name:"Kinetic Dash",description:"Dash in a straight line. With a shield, slam into enemies and send them flying!",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:0},execute:(e,n,a,o=[])=>{const r=[],c=[],d=o.includes("MOMENTUM_SURGE"),h=o.includes("DASH_CHAIN_REACTION")||o.includes("CHAIN_REACTION");if(!a)return{effects:r,messages:c,consumesTurn:!1};const{isAxial:g,directionIndex:m}=Pn(n.position,a),b=e.enemies.filter(_=>_.hp>0).length===0?20:4;if(!kt(n.position,a,b))return{effects:r,messages:["Out of range!"],consumesTurn:!1};if(!g)return{effects:r,messages:["Axial only! Dash must be in a straight line."],consumesTurn:!1};r.push(..._t.DASH.anticipation(n.position,a));const x=Yt(m),T=ht(n.position,a),S=qd(e,T.slice(1),{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:n.id});let A=a;if(S.obstacle){if(S.obstacle==="wall")return{effects:r,messages:["A wall blocks the way!"],consumesTurn:!1};if(S.obstacle==="lava")return{effects:r,messages:["Lava blocks the way!"],consumesTurn:!1};const _=T.findIndex(E=>se(E,S.position));A=T[_-1]||n.position}if(S.obstacle==="actor"?S.actor:null){const _=ht(n.position,A);r.push(..._t.DASH.execution(_));const E=[{type:"Displacement",target:"self",destination:A,path:_,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:_.length*60}],w=Jn(e,E,{sourceId:n.id});if(e.hasShield){r.push(..._t.DASH.impact(A,x,!0));const C=5+(e.hasShield&&d?2:0)+(h?1:0),I=Ul(w,{origin:A,direction:x,momentum:C});return{effects:[...r,...E,...I],messages:[...c,"Shield Shunt!"],consumesTurn:!0}}else return r.push(..._t.DASH.impact(A,x,!1)),{effects:[...r,...E],messages:[...c,"Stopped by an obstacle (Need shield to shunt)."],consumesTurn:!se(n.position,A)}}else{const _=ht(n.position,A);r.push(..._t.DASH.execution(_));const E={type:"Displacement",target:"self",destination:A,path:_,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:_.length*60};return{effects:[...r,E],messages:[...c,"Dashed!"],consumesTurn:!se(n.position,A)}}},getValidTargets:(e,n)=>{const o=e.enemies.filter(c=>c.hp>0).length===0?20:4,r=ye(e,n);return r?$e.getAxialTargets(e,n,o,{stopAtObstacles:!0,includeActors:!0,includeWalls:!1}).filter(c=>ki(e,r,c)):[]},upgrades:{MOMENTUM_SURGE:{id:"MOMENTUM_SURGE",name:"Momentum Surge",description:"+2 Momentum when dashing with shield"},DASH_CHAIN_REACTION:{id:"DASH_CHAIN_REACTION",name:"Chain Reaction",description:"Enemies pushed into other enemies transfer momentum"}},scenarios:Ze("DASH")},mT={id:"FALCON_APEX_STRIKE",name:"Apex Strike",description:"The falcon dives into a target for lethal damage.",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:2,damage:40},execute:(e,n,a,o=[])=>{const r=[],c=[],d=n.companionOf,g=(d?d===e.player.id?e.player:e.enemies.find(x=>x.id===d):void 0)?.activeSkills?.find(x=>x.id==="FALCON_COMMAND")?.activeUpgrades||[],m=o.includes("APEX_PREDATOR")||g.includes("APEX_PREDATOR");if(!a)return{effects:r,messages:c,consumesTurn:!1};const f=ye(e,a);if(!f)return{effects:r,messages:c,consumesTurn:!1};if(n.companionState?.apexStrikeCooldown&&n.companionState.apexStrikeCooldown>0)return{effects:r,messages:c,consumesTurn:!1};const b=Pt({attackerId:n.id,targetId:f.id,skillId:"FALCON_APEX_STRIKE",basePower:40,trinity:Ie(n),targetTrinity:Ie(f),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return r.push({type:"Damage",target:f.id,amount:b.finalPower,reason:"apex_strike",scoreEvent:b.scoreEvent}),r.push({type:"Juice",effect:"impact",target:a,intensity:"high",metadata:{signature:"ATK.STRIKE.PHYSICAL.FALCON_APEX_STRIKE",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"falcon_apex_strike",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"FALCON_APEX_STRIKE",camera:{kick:"medium"}}}),r.push({type:"UpdateCompanionState",target:n.id,apexStrikeCooldown:m?1:2}),c.push(`Falcon executes APEX STRIKE on ${f.subtype||"enemy"}!`),{effects:r,messages:c,consumesTurn:!0}},upgrades:{},getValidTargets:(e,n)=>{const a=[];return e.enemies.forEach(o=>{be(n,o.position)<=4&&a.push(o.position)}),a}},pT={id:"FALCON_AUTO_ROOST",name:"Auto Roost",description:"Automatically returns the falcon to roost mode when mark is lost.",slot:"passive",icon:"R",baseVariables:{range:0,cost:0,cooldown:0},execute:(e,n,a)=>({effects:[{type:"UpdateCompanionState",target:n.id,mode:"roost",markTarget:void 0}],messages:["Falcon loses prey and returns to roost mode."],consumesTurn:!0}),getValidTargets:(e,n)=>[n],upgrades:{}};function pd(e,n){return e.enemies.find(a=>a.companionOf===n&&a.subtype==="falcon")}const hT={id:"FALCON_COMMAND",name:e=>{const n=e?.player?.id;if(!n)return"Summon Falcon";const a=pd(e,n);if(!a)return"Summon Falcon";const o=a.companionState?.mode||"roost";return o==="scout"?"Falcon: Scout":o==="predator"?"Falcon: Hunt":"Falcon: Roost"},description:e=>{const n=e?.player?.id;if(!n)return"Call your Falcon companion.";const a=pd(e,n);if(!a)return"Call your Falcon companion.";const o=a.companionState?.mode||"roost";return o==="scout"?"Click tile to set patrol zone. Falcon orbits and attacks nearby enemies.":o==="predator"?"Click enemy to mark as prey. Falcon pursues and uses Apex Strike.":"Falcon returns to you. Heals and cleanses 1 debuff on arrival."},slot:"offensive",icon:"",baseVariables:{range:6,cost:0,cooldown:0},execute:(e,n,a)=>{const o=[],r=[];let c=pd(e,n.id);if(!c){const g=fv({ownerId:n.id,position:Xe(n.position)[0]});return o.push({type:"SpawnActor",actor:g}),o.push({type:"Message",text:"Your Falcon companion awakens!"}),r.push("Falcon summoned!"),{effects:o,messages:r,consumesTurn:!0}}const d=a?ye(e,a):void 0;return!a||se(a,n.position)||!!(d&&d.id===n.id)?(r.push("Falcon returns to roost."),o.push({type:"Juice",effect:"combat_text",target:n.position,text:"Roost",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_ROOST",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_roost",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"system"}}),o.push({type:"UpdateCompanionState",target:c.id,mode:"roost"}),{effects:o,messages:r,consumesTurn:!0}):d&&d.factionId==="enemy"?(r.push(`Falcon marks ${d.subtype||"enemy"} as prey!`),o.push({type:"Juice",effect:"combat_text",target:a,text:" Marked",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_MARK",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_mark",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"status"}}),o.push({type:"ApplyStatus",target:d.id,status:"marked_predator",duration:-1}),o.push({type:"UpdateCompanionState",target:c.id,mode:"predator",markTarget:d.id}),{effects:o,messages:r,consumesTurn:!0}):(r.push("Falcon set to patrol zone."),o.push({type:"Juice",effect:"combat_text",target:a,text:" Patrol",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_PATROL",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_patrol",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"system"}}),o.push({type:"UpdateCompanionState",target:c.id,mode:"scout",markTarget:a}),{effects:o,messages:r,consumesTurn:!0})},getValidTargets:(e,n)=>$e.getAreaTargets(e,n,6).filter(o=>(se(o,n),!0)),upgrades:{KEEN_SIGHT:{id:"KEEN_SIGHT",name:"Keen Sight",description:"Falcon reveals hidden enemies within 3 tiles of its position."},FALCON_TWIN_TALONS:{id:"FALCON_TWIN_TALONS",name:"Twin Talons",description:"Basic Peck hits 2 targets instead of 1."},APEX_PREDATOR:{id:"APEX_PREDATOR",name:"Apex Predator",description:"Apex Strike cooldown reduced by 1. Marked enemies take +1 damage from all sources."}},scenarios:Ze("FALCON_COMMAND")},yT={id:"FALCON_HEAL",name:"Roost Heal",description:"The falcon roosts and restores health to its companion.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:1},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};const c=ye(e,a);return c?n.companionState?.healCooldown&&n.companionState.healCooldown>0?{effects:o,messages:r,consumesTurn:!1}:(o.push({type:"Heal",target:c.id,amount:1}),o.push({type:"Juice",effect:"flash",target:c.position,color:"#00ff88",metadata:{signature:"STATE.APPLY.HOLY.FALCON_HEAL",family:"status",primitive:"status_apply",phase:"impact",element:"holy",variant:"falcon_heal",targetRef:{kind:"target_hex"},skillId:"FALCON_HEAL"}}),o.push({type:"UpdateCompanionState",target:n.id,healCooldown:1}),r.push("Falcon roosts. You feel restored."),{effects:o,messages:r,consumesTurn:!0}):{effects:o,messages:r,consumesTurn:!1}},upgrades:{},getValidTargets:(e,n)=>{const a=[],o=e.player;return be(n,o.position)<=1&&a.push(o.position),a}},gT={id:"FALCON_PECK",name:"Peck",description:"The falcon pecks an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,n,a,o=[])=>{const r=[],c=[],d=n.companionOf,g=(d?d===e.player.id?e.player:e.enemies.find(x=>x.id===d):void 0)?.activeSkills?.find(x=>x.id==="FALCON_COMMAND")?.activeUpgrades||[],m=o.includes("TWIN_TALONS")||g.includes("TWIN_TALONS")||g.includes("FALCON_TWIN_TALONS");if(!a)return{effects:r,messages:c,consumesTurn:!1};const f=ye(e,a);if(!f||f.factionId==="player")return{effects:r,messages:c,consumesTurn:!1};if(be(n.position,a)>1)return{effects:r,messages:c,consumesTurn:!1};const b=[f];if(m){const x=Xe(n.position).map(T=>ye(e,T)).filter(T=>!!T&&T.id!==f.id&&T.factionId==="enemy")[0];x&&b.push(x)}for(const x of b){const T=Pt({attackerId:n.id,targetId:x.id,skillId:"FALCON_PECK",basePower:1,trinity:Ie(n),targetTrinity:Ie(x),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:x.id,amount:T.finalPower,reason:"falcon_peck",scoreEvent:T.scoreEvent})}return r.push({type:"Juice",effect:"combat_text",target:a,text:"Peck!",intensity:"low",metadata:{signature:"UI.TEXT.PHYSICAL.FALCON_PECK",family:"ui",primitive:"text",phase:"instant",element:"physical",variant:"falcon_peck",targetRef:{kind:"target_hex"},skillId:"FALCON_PECK",textTone:"damage"}}),c.push(m&&b.length>1?`Falcon pecked ${b.length} enemies!`:`Falcon pecked ${f.subtype||"enemy"}!`),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>Xe(n).filter(a=>{const o=ye(e,a);return o&&o.factionId==="enemy"}),upgrades:{TWIN_TALONS:{id:"TWIN_TALONS",name:"Twin Talons",description:"Peck hits 2 adjacent targets instead of 1."}},scenarios:Ze("FALCON_PECK")},bT={id:"FALCON_SCOUT",name:"Scout Orbit",description:"The actor orbits a target point in a hexagonal ring.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,n,a)=>{const o=[],r=[],c=n.companionState?.markTarget;if(!c||typeof c!="object")return{effects:o,messages:r,consumesTurn:!1};const d=c,h=Xe(d);let g;if(be(n.position,d)!==1)g=h.sort((m,f)=>be(n.position,m)-be(n.position,f))[0];else{const f=(h.findIndex(b=>se(b,n.position))+1)%6;g=h[f]}return $e.isWithinBounds(e,g)&&Ne.isWalkable(e,g)&&!ye(e,g)?(o.push({type:"Displacement",target:n.id,destination:g,source:n.position,simulatePath:!0}),{effects:o,messages:r,consumesTurn:!0}):{effects:o,messages:r,consumesTurn:!1}},upgrades:{},getValidTargets:(e,n)=>[]},xT=new Set(["FIREBALL","FIREWALL","FIREWALK","ABSORB_FIRE"]),Xg=(e,n)=>{const a=Ne.getTileAt(e,n),o=Ne.getTraitsForTile(e,a),r=c=>a.effects.some(d=>d.id===c);return a.baseId==="VOID"||o.has("VOID")||o.has("PIT")?"VOID_TOUCHED":a.baseId==="ICE"||r("ICE_WALL")?"FROZEN":a.baseId==="LAVA"||o.has("LAVA")||o.has("FIRE")||r("FIRE")?"MELTED":r("WET")||r("STEAM")?"SOAKED":"STABLE"},Wg=(e,n)=>xT.has(e)&&n==="MELTED"?1.15:1,vT={id:"FIREBALL",name:"Fireball",description:"Launch a sphere of flame. Range 3, Axial. Deals damage and leaves fire.",slot:"offensive",icon:"",baseVariables:{range:3,cost:1,cooldown:2},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};const{isAxial:c}=Pn(n.position,a);if(!kt(n.position,a,3)||!c)return{effects:o,messages:["Invalid target! Range 3, Axial only."],consumesTurn:!1};const d=[a,...Xe(a)],h=Ie(n),g=!!e.intentPreview?.dangerTiles?.some(m=>se(m,n.position));for(const m of d){const f=ye(e,m),b=Xg(e,m),x=Wg("FIREBALL",b),T=Pt({attackerId:n.id,targetId:f?.id||ue(m),skillId:"FIREBALL",basePower:1,trinity:h,targetTrinity:f?Ie(f):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:x===1?[]:[{id:`surface_${b}`,multiplier:x}],inDangerPreviewHex:g,theoreticalMaxPower:1});o.push({type:"Damage",target:m,amount:T.finalPower,reason:"fireball",scoreEvent:T.scoreEvent}),o.push({type:"PlaceFire",position:m,duration:3})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ff4400",metadata:{signature:"ATK.BLAST.FIRE.FIREBALL_IMPACT",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"fireball",targetRef:{kind:"target_hex"},skillId:"FIREBALL"}}),o.push({type:"Juice",effect:"shake",intensity:"medium",metadata:{signature:"UI.SHAKE.FIRE.FIREBALL",family:"ui",primitive:"shake",phase:"impact",element:"fire",variant:"fireball_shake",skillId:"FIREBALL",camera:{shake:"medium"}}}),r.push("Fireball!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>$e.getAxialTargets(e,n,3),upgrades:{},scenarios:Ze("FIREBALL")},ST={id:"FIREWALK",name:"Firewalk",description:"Teleport to a fire or lava tile. Grants 2 turns of Fire Immunity.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};if(!kt(n.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const c=e.tiles.get(ue(a)),d=c?.effects.some(g=>g.id==="FIRE"),h=c?.baseId==="LAVA"||c?.traits.has("LIQUID");return!d&&!h?{effects:o,messages:["Can only teleport to Fire or Lava!"],consumesTurn:!1}:ca(e,a,n.id)?{effects:o,messages:["Target position occupied!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a,source:n.position,simulatePath:!1}),o.push({type:"ApplyStatus",target:"self",status:"fire_immunity",duration:2}),o.push({type:"Juice",effect:"flash",target:a,color:"#ff8800",metadata:{signature:"MOVE.BLINK.FIRE.FIREWALK",family:"movement",primitive:"blink",phase:"impact",element:"fire",variant:"firewalk",targetRef:{kind:"target_hex"},skillId:"FIREWALK"}}),r.push("Firewalk!"),{effects:o,messages:r,consumesTurn:!0})},getValidTargets:(e,n)=>{const a=[];return e.tiles.forEach(o=>{const r=be(n,o.position);if(r>0&&r<=4){const c=o.effects.some(h=>h.id==="FIRE"),d=o.baseId==="LAVA"||o.traits.has("LIQUID");(c||d)&&a.push(o.position)}}),a},upgrades:{},scenarios:Ze("FIREWALK")},AT={id:"FIREWALL",name:"Firewall",description:"Create a wall of flames 5 tiles wide. Area denial.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:4},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};const{isAxial:c,directionIndex:d}=Pn(n.position,a);if(!c)return{effects:o,messages:["Axial targeting only!"],consumesTurn:!1};const h=(d+2)%6,g=(d+5)%6,m=[a];let f=a;for(let x=0;x<2;x++)f=rn(f,Yt(h)),$e.isWithinBounds(e,f)&&m.push(f);let b=a;for(let x=0;x<2;x++)b=rn(b,Yt(g)),$e.isWithinBounds(e,b)&&m.push(b);for(const x of m)if(!Dn(e,x)){o.push({type:"PlaceFire",position:x,duration:3});const T=ye(e,x);if(T){const S=Xg(e,x),A=Wg("FIREWALL",S),O=Pt({attackerId:n.id,targetId:T.id,skillId:"FIREWALL",basePower:1,trinity:Ie(n),targetTrinity:Ie(T),damageClass:"magical",scaling:[{attribute:"mind",coefficient:.15}],statusMultipliers:A===1?[]:[{id:`surface_${S}`,multiplier:A}]});o.push({type:"Damage",target:T.id,amount:O.finalPower,reason:"firewall_impact",scoreEvent:O.scoreEvent})}}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffaa00",metadata:{signature:"ATK.BLAST.FIRE.FIREWALL",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"firewall",targetRef:{kind:"target_hex"},skillId:"FIREWALL"}}),r.push("Firewall raised!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>$e.getAxialTargets(e,n,4),upgrades:{},scenarios:Ze("FIREWALL")};function TT(e,n,a,o){const r=be(n.position,a);if(r<=1)return[];const c=Gn(a,n.position),d=Yt(c);return Ul(e,{origin:a,direction:d,momentum:Math.min(o,r-1)})}function ET(e,n){return[{type:"Displacement",target:e.id,destination:n.position},{type:"Displacement",target:n.id,destination:e.position}]}function _T(e,n,a,o){return Ul(e,{origin:n,direction:a,momentum:o})}const wT={id:"GRAPPLE_HOOK",name:"Grapple Hook",description:"Pull/Zip mechanism with multi-phase kinetic resolution.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3,momentum:4},execute:(e,n,a,o=[])=>{let r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};const{directionIndex:h}=Pn(n.position,a),g=Yt(h);r.push(..._t.GRAPPLE_HOOK.anticipation(n.position,a));const{isValid:m,blockedBy:f}=$d(e,n.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:n.id});if(!m)return c.push(`Line of sight blocked by ${f}!`),{effects:r,messages:c,consumesTurn:!1};const b=a,x=ye(e,b),T=Ne.getTraitsAt(e,b),A=T.has("BLOCKS_MOVEMENT")||T.has("ANCHOR")?"Heavy":x?.weightClass||"Standard";if(A==="Heavy"||A==="Anchored"){const O=Ed(b,g);r.push(..._t.GRAPPLE_HOOK.execution(ht(n.position,O))),r.push({type:"Displacement",target:n.id,destination:O,ignoreGroundHazards:!0});const _=Ne.getTileAt(e,O);if(_){const w=Na.processEntry(n,_,e);r.push(...w.effects),c.push(...w.messages)}const E=Xe(O);for(const w of E){const C=ye(e,w);C&&C.id!==n.id&&(r.push({type:"Impact",target:C.id,damage:0,direction:g}),r.push({type:"ApplyStatus",target:C.id,status:"stunned",duration:2}),r.push(he.stunBurst(w)))}return r.push(he.heavyImpact(O,g)),r.push(he.shake("high",g)),c.push("Zipped to anchor!"),{effects:r,messages:c,consumesTurn:!0}}else if(x){const O=be(n.position,b),_=Yt((h+3)%6),E=n.position;r.push(..._t.GRAPPLE_HOOK.execution(ht(n.position,a)));const w=TT(e,n,b,O-1),C=Jn(e,w,{sourceId:n.id,targetId:x.id}),I=C.enemies.find(Y=>Y.id===x.id)||(C.player.id===x.id?C.player:null);if(!I)return c.push(`${x.subtype||"Enemy"} neutralized during pull.`),{effects:[...r,...w],messages:c,consumesTurn:!0};const N=ET(n,I),H=I.position;r.push(..._t.GRAPPLE_HOOK.impact(H,g));const D=Jn(C,N,{sourceId:n.id,targetId:x.id}),G=_T(D,E,_,4),P=ht(E,rn(E,Pd(h,6)));return r.push(..._t.GRAPPLE_HOOK.resolution(P,4)),{effects:[...r,...w,...N,...G],messages:["Vaulted and Flung!"],consumesTurn:!0}}else return c.push("Hook missed."),{effects:r,messages:c,consumesTurn:!1}},getValidTargets:(e,n)=>{const a=ye(e,n);return a?$e.getAxialTargets(e,n,4,{includeWalls:!0,includeActors:!0,stopAtObstacles:!0}).filter(o=>{const{directionIndex:r}=Pn(n,o),c=Yt(r),d=ye(e,o),h=Ne.getTraitsAt(e,o),m=h.has("BLOCKS_MOVEMENT")||h.has("ANCHOR")?Ed(o,c):d?o:void 0;return m?ki(e,a,m):!1}):[]},upgrades:{},scenarios:Ze("GRAPPLE_HOOK")},MT={id:"JUMP",name:"Jump",description:"Leap to an empty tile within range. Can cross lava but not walls.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,n,a,o=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!n||!n.position)return{effects:r,messages:c,consumesTurn:!1};const d=o.includes("JUMP_RANGE"),h=o.includes("STUNNING_LANDING"),g=o.includes("METEOR_IMPACT"),m=o.includes("FREE_JUMP"),f=2+(d?1:0);if(!kt(n.position,a,f))return c.push("Target out of range!"),{effects:r,messages:c,consumesTurn:!1};const b=ye(e,a),x=Dn(e,a),T=ki(e,n,a);if(x)return c.push("Cannot jump into a wall!"),{effects:r,messages:c,consumesTurn:!1};if(!T)return c.push("Cannot land on hazard!"),{effects:r,messages:c,consumesTurn:!1};if(b&&!g)return c.push("Target hex is blocked!"),{effects:r,messages:c,consumesTurn:!1};if(b&&g){const S=Pt({attackerId:n.id,targetId:b.id,skillId:"JUMP",basePower:99,trinity:Ie(n),targetTrinity:Ie(b),damageClass:"physical",scaling:[{attribute:"body",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:b.id,amount:S.finalPower,scoreEvent:S.scoreEvent}),c.push(`Meteor Impact killed ${b.subtype||"enemy"}!`)}if(r.push({type:"Message",text:"Jumped!"}),r.push({type:"Displacement",target:"self",destination:a,ignoreCollision:!0,ignoreGroundHazards:!0,simulatePath:!0}),h){const S=Xe(a);let A=!1;for(const O of S){const _=ye(e,O);_&&_.id!==n.id&&(r.push({type:"ApplyStatus",target:_.id,status:"stunned",duration:1}),A=!0)}A&&c.push("Enemies stunned by landing impact!")}return r.push({type:"Juice",effect:"shake",target:a,intensity:"medium",metadata:{signature:"MOVE.LEAP.NEUTRAL.JUMP_LAND",family:"movement",primitive:"leap",phase:"impact",element:"neutral",variant:"jump_landing",targetRef:{kind:"target_hex"},skillId:"JUMP",camera:{shake:"medium",kick:"light"}}}),{effects:r,messages:c,consumesTurn:!m}},getValidTargets:(e,n)=>{const a=ye(e,n);if(!a)return[];const o=a.activeSkills?.find(h=>h.id==="JUMP"),r=new Set(o?.activeUpgrades||[]),c=2+(r.has("JUMP_RANGE")?1:0),d=r.has("METEOR_IMPACT");return $e.getAreaTargets(e,n,c).filter(h=>{if(se(h,n)||Dn(e,h)||!ki(e,a,h))return!1;const g=ye(e,h);return!(g&&g.id!==a.id&&!d)})},upgrades:{JUMP_RANGE:{id:"JUMP_RANGE",name:"Extended Jump",description:"Jump range +1"},JUMP_COOLDOWN:{id:"JUMP_COOLDOWN",name:"Nimble",description:"Jump cooldown -1",modifyCooldown:-1},STUNNING_LANDING:{id:"STUNNING_LANDING",name:"Stunning Landing",description:"All enemies within 1 hex of landing are stunned"},METEOR_IMPACT:{id:"METEOR_IMPACT",name:"Meteor Impact",description:"Can land on enemies to kill them"},FREE_JUMP:{id:"FREE_JUMP",name:"Free Jump",description:"Can move after jumping"}},scenarios:Ze("JUMP")},Ty=2,OT=3,CT=3,kT=2;function NT(e,n){const a=[];for(let o=0;o<6;o++){let r=e;for(let c=0;c<n;c++)r=rn(r,Yt(o));a.push(r)}return a}function RT(e,n,a){return NT(n,a).filter(r=>!(!$e.isWithinBounds(e,r)||!Ne.isWalkable(e,r)||ye(e,r)))}const IT={id:"KINETIC_TRI_TRAP",name:"Kinetic Tri-Trap",description:"Deploy 3 hidden traps on axial tiles. Triggered enemies are flung away.",slot:"defensive",icon:"",baseVariables:{range:Ty,cost:0,cooldown:CT},execute:(e,n,a,o=[])=>{const r=[],c=[];let d=e;const h=o.includes("VOLATILE_CORE"),g=o.includes("TRAP_CHAIN_REACTION")||o.includes("CHAIN_REACTION"),m=o.includes("QUICK_RELOAD"),f=RT(e,n.position,Ty);if(f.length===0)return{effects:r,messages:["No valid trap positions!"],consumesTurn:!1};const b=Math.min(OT,f.length),x=[];r.push({type:"RemoveTrap",position:{q:0,r:0,s:0},ownerId:n.id});const T=[...f];for(let S=0;S<b&&T.length!==0;S++){const{value:A,nextState:O}=ka(d);d=O;const _=Math.floor(A*T.length)%T.length;x.push(T[_]),T.splice(_,1)}for(const S of x)r.push({type:"PlaceTrap",position:S,ownerId:n.id,volatileCore:h,chainReaction:g,resetCooldown:m?1:kT}),r.push({type:"Juice",effect:"flash",target:S,intensity:"low",color:"#ffaa00",metadata:{signature:"ENV.TRAP.KINETIC.DEPLOY",family:"environment",primitive:"spawn",phase:"impact",element:"kinetic",variant:"kinetic_tri_trap_deploy",targetRef:{kind:"target_hex"},skillId:"KINETIC_TRI_TRAP"}});return c.push(`${x.length} traps deployed.`),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>[n],upgrades:{VOLATILE_CORE:{id:"VOLATILE_CORE",name:"Volatile Core",description:"Traps deal 1 damage when triggered."},TRAP_CHAIN_REACTION:{id:"TRAP_CHAIN_REACTION",name:"Chain Reaction",description:"When a trap triggers, adjacent traps also activate."},QUICK_RELOAD:{id:"QUICK_RELOAD",name:"Quick Reload",description:"Individual trap reset cooldown reduced to 1."}},scenarios:Ze("KINETIC_TRI_TRAP")},LT={id:"MULTI_SHOOT",name:"Multi-Shoot",description:"A spread of arrows. Axial range 4. Deals damage to target and neighbors.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:1},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};const{isAxial:c}=Pn(n.position,a);if(!kt(n.position,a,4)||!c)return{effects:o,messages:["Invalid target! Axial range 4 only."],consumesTurn:!1};const d=[a,...Xe(a)],h=Ie(n);for(const g of d){const m=ye(e,g),f=Pt({attackerId:n.id,targetId:m?.id||ue(g),skillId:"MULTI_SHOOT",basePower:1,trinity:h,targetTrinity:m?Ie(m):void 0,damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.1},{attribute:"mind",coefficient:.1}],statusMultipliers:[]});o.push({type:"Damage",target:g,amount:f.finalPower,reason:"multi_shoot",scoreEvent:f.scoreEvent})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffff00",metadata:{signature:"ATK.SHOOT.PHYSICAL.MULTI_SHOOT",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"multi_shoot",targetRef:{kind:"target_hex"},skillId:"MULTI_SHOOT"}}),r.push("Multi-Shoot!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>$e.getAxialTargets(e,n,4),upgrades:{},scenarios:Ze("MULTI_SHOOT")},HT=(e,n)=>n.q>=0&&n.q<e.gridWidth&&n.r>=0&&n.r<e.gridHeight,BT=(e,n,a)=>Xe(a).filter(r=>HT(e,r)).filter(r=>Ne.isWalkable(e,r)).filter(r=>!ye(e,r)).sort((r,c)=>{const d=be(r,n.position),h=be(c,n.position);return d!==h?d-h:r.q!==c.q?r.q-c.q:r.r-c.r})[0]||null,jT=(e,n)=>n.id!==e.id&&n.factionId===e.factionId;function Ey(e,n,a,o="fail"){const r=ye(e,a);if(!r)return{ok:!0,spawnPosition:a,effects:[],messages:[]};if(o==="push_friendly"){if(!jT(n,r))return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."};const c=BT(e,n,a);return c?{ok:!0,spawnPosition:a,effects:[{type:"Displacement",target:r.id,destination:c,source:r.position,simulatePath:!0}],messages:["Ally repositions to make room."]}:{ok:!1,effects:[],messages:[],failureMessage:"No space to reposition ally."}}return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."}}const DT=(e,n)=>!!e.tiles.get(ue(n))?.traits?.has("CORPSE"),PT=(e,n,a)=>{const o=[];return e.tiles.forEach(r=>{r.traits.has("CORPSE")&&be(n,r.position)<=a&&o.push(r.position)}),o},UT=e=>{const n=e.initialSeed??e.rngSeed??"0",a=new Set([...e.enemies.map(c=>c.id),...(e.companions||[]).map(c=>c.id)]);let o=(e.floor<<20)+(e.turnNumber<<12)+(e.actionLog?.length??0)+(e.rngCounter??0),r=`skeleton_${ws(n,o,8,"skeleton")}`;for(;a.has(r);)o+=1,r=`skeleton_${ws(n,o,8,"skeleton")}`;return r},qT={id:"RAISE_DEAD",name:"Raise Dead",description:"Reanimate a target corpse into a Skeleton minion (Faction: Player).",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};if(!DT(e,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!kt(n.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const d=Ey(e,n,a,"push_friendly");if(!d.ok)return{effects:o,messages:[d.failureMessage||"Target tile occupied."],consumesTurn:!1};o.push(...d.effects),r.push(...d.messages),o.push({type:"RemoveCorpse",position:a});const h=kg({companionType:"skeleton",ownerId:n.id,id:UT(e),position:a});return o.push({type:"SpawnActor",actor:h}),o.push({type:"Juice",effect:"flash",target:a,color:"#aaaaaa",metadata:{signature:"STATE.SPAWN.VOID.RAISE_DEAD",family:"status",primitive:"spawn",phase:"impact",element:"void",variant:"raise_dead",targetRef:{kind:"target_hex"},skillId:"RAISE_DEAD"}}),r.push("Skeleton raised!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ye(e,n);return a?PT(e,n,4).filter(o=>Ey(e,a,o,"push_friendly").ok):[]},upgrades:{},scenarios:Ze("RAISE_DEAD")},$T={id:"SENTINEL_BLAST",name:"Sentinel Blast",description:"A massive energy surge from the Sentinel.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:2},execute:(e,n,a)=>{if(!a)return{effects:[],messages:[]};const o=Ie(n),r=ye(e,a),c=Pt({attackerId:n.id,targetId:r?.id||ue(a),skillId:"SENTINEL_BLAST",basePower:2,trinity:o,targetTrinity:r?Ie(r):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:[]}),d=[{type:"Damage",target:a,amount:c.finalPower,scoreEvent:c.scoreEvent},{type:"Juice",effect:"shake",intensity:"high",metadata:{signature:"ATK.BLAST.ARCANE.SENTINEL_BLAST",family:"attack",primitive:"blast",phase:"impact",element:"arcane",variant:"sentinel_blast",targetRef:{kind:"target_hex"},skillId:"SENTINEL_BLAST",camera:{shake:"high"}}}];return Xe(a).forEach(g=>{const m=ye(e,g),f=Pt({attackerId:n.id,targetId:m?.id||ue(g),skillId:"SENTINEL_BLAST",basePower:1,trinity:o,targetTrinity:m?Ie(m):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.1}],statusMultipliers:[]});d.push({type:"Damage",target:g,amount:f.finalPower,scoreEvent:f.scoreEvent})}),{effects:d,messages:["The Sentinel unleashed a massive blast!"],consumesTurn:!0}},getValidTargets:(e,n)=>$e.getAreaTargets(e,n,3),upgrades:{},scenarios:Ze("SENTINEL_BLAST")},zT={id:"SENTINEL_TELEGRAPH",name:"Sentinel Telegraph",description:"The Sentinel marks an impact zone for a delayed blast.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0},execute:(e,n,a)=>a?{effects:[{type:"Juice",effect:"combat_text",target:a,text:"TELEGRAPH",metadata:{signature:"UI.TEXT.ARCANE.SENTINEL_TELEGRAPH",family:"ui",primitive:"text",phase:"telegraph",element:"arcane",variant:"sentinel_telegraph",targetRef:{kind:"target_hex"},skillId:"SENTINEL_TELEGRAPH",textTone:"system"}}],messages:["The Sentinel marks the impact zone."],consumesTurn:!0}:{effects:[],messages:[],consumesTurn:!0},getValidTargets:(e,n)=>$e.getAreaTargets(e,n,3),upgrades:{},scenarios:Ze("SENTINEL_TELEGRAPH")},VT={id:"SET_TRAP",name:"Set Trap",description:"Place a hidden trap. Roots units for 3 turns.",slot:"utility",icon:"",baseVariables:{range:1,cost:1,cooldown:2},execute:(e,n,a)=>{const o=[],r=[];return a?Dn(e,a)||La(e,a)?{effects:o,messages:["Cannot place trap here!"],consumesTurn:!1}:(o.push({type:"PlaceTrap",position:a,ownerId:n.id}),o.push({type:"Juice",effect:"combat_text",target:a,text:"Trapped",metadata:{signature:"UI.TEXT.NEUTRAL.SET_TRAP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"set_trap",targetRef:{kind:"target_hex"},skillId:"SET_TRAP",textTone:"status"}}),r.push("Trap set."),{effects:o,messages:r,consumesTurn:!0}):{effects:o,messages:r,consumesTurn:!1}},getValidTargets:(e,n)=>Xe(n).filter(a=>!Dn(e,a)&&!La(e,a)),upgrades:{},scenarios:Ze("SET_TRAP")},YT={id:"SHADOW_STEP",name:"Shadow Step",description:"Teleport through the shadows. Only works while invisible. Extends stealth.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,n,a)=>{const o=[],r=[];return a?(n.stealthCounter||0)>0?kt(n.position,a,2)?Dn(e,a)||La(e,a)||ca(e,a,n.id)?{effects:o,messages:["Cannot step there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:a,metadata:{signature:"MOVE.BLINK.SHADOW.SHADOW_STEP",family:"movement",primitive:"blink",phase:"instant",element:"shadow",variant:"shadow_step_arrival",targetRef:{kind:"target_hex"},skillId:"SHADOW_STEP"}}),r.push("Shadow stepped!"),{effects:o,messages:r,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:["Must be invisible to Shadow Step!"],consumesTurn:!1}:{effects:o,messages:r,consumesTurn:!1}},getValidTargets:(e,n)=>(e.player.stealthCounter||0)>0?$e.getAreaTargets(e,n,2).filter(r=>se(r,n)?!1:!Dn(e,r)&&!La(e,r)&&!ca(e,r)):[],upgrades:{},scenarios:Ze("SHADOW_STEP")},KT={id:"SHIELD_BASH",name:"Shield Bash",description:"Push an enemy 1 tile. If they hit a wall or another enemy, they are stunned.",slot:"defensive",icon:"",baseVariables:{range:1,cost:0,cooldown:2},execute:(e,n,a,o=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!n||!n.position)return{effects:r,messages:c,consumesTurn:!1};const d=o.includes("SHIELD_RANGE"),h=o.includes("ARC_BASH"),g=o.includes("BASH_360"),m=o.includes("WALL_SLAM"),f=1+(d?1:0);if(!kt(n.position,a,f))return c.push("Target out of range!"),{effects:r,messages:c,consumesTurn:!1};let b=[];if(g)b=Xe(n.position);else if(h){b=[a];const A=Xe(a);for(const O of A)be(O,n.position)===1&&b.length<3&&b.push(O)}else b=[a];const x=new Map;e.enemies.forEach(A=>x.set(A.id,A.position)),e.player&&x.set(e.player.id,e.player.position);const T=A=>{for(const[O,_]of Array.from(x.entries()))if(se(_,A))return O===e.player.id?e.player:e.enemies.find(E=>E.id===O)},S=(A,O)=>{const _=T(O);if(!_||_.id===n.id)return;const E=Gn(A,O),w=Yt(E),C=rn(O,w),I=e.tiles.get(ue(C)),N=I?.baseId==="WALL"||I?.traits.has("BLOCKS_MOVEMENT"),H=!$e.isWithinBounds(e,C),D=T(C);N||H||D&&D.id!==_.id?(r.push({type:"ApplyStatus",target:_.id,status:"stunned",duration:1}),c.push(`Bashed ${_.subtype||"enemy"} into obstacle!`),r.push({type:"Juice",effect:"shake",target:O,direction:w,intensity:"medium",metadata:{signature:"ENV.COLLISION.KINETIC.SHIELD_BASH",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"shield_bash_collision",targetRef:{kind:"target_hex"},skillId:"SHIELD_BASH",camera:{shake:"medium",kick:"medium"}}}),D&&m&&S(O,C)):(r.push({type:"Displacement",target:_.id,destination:C,simulatePath:!0}),x.set(_.id,C),c.push(`Pushed ${_.subtype||"enemy"}!`))};for(const A of b)S(n.position,A);return{effects:r,messages:c}},getValidTargets:(e,n)=>{const a=ye(e,n);if(!a)return[];const r=1+(a.activeSkills?.find(c=>c.id==="SHIELD_BASH")?.activeUpgrades?.includes("SHIELD_RANGE")?1:0);return $e.getAreaTargets(e,n,r).filter(c=>{const d=ye(e,c);return!!d&&d.id!==a.id&&d.factionId!==a.factionId})},upgrades:{SHIELD_RANGE:{id:"SHIELD_RANGE",name:"Extended Bash",description:"Range +1"},SHIELD_COOLDOWN:{id:"SHIELD_COOLDOWN",name:"Quick Recovery",description:"Cooldown -1",modifyCooldown:-1},ARC_BASH:{id:"ARC_BASH",name:"Arc Bash",description:"Bash hits 3-hex frontal arc (+1 cooldown)",modifyCooldown:1},BASH_360:{id:"BASH_360",name:"360 Bash",description:"Bash hits all neighbors (+1 cooldown)",modifyCooldown:1},PASSIVE_PROTECTION:{id:"PASSIVE_PROTECTION",name:"Passive Protection",description:"+1 temp armor when shield not on cooldown"},WALL_SLAM:{id:"WALL_SLAM",name:"Wall Slam",description:"Enemies bashed into obstacles trigger a cascade and stun"}},scenarios:Ze("SHIELD_BASH")},FT={id:"SHIELD_THROW",name:"Shield Throw",description:"Throw your shield to strike and push enemies. Triggers a kinetic pulse on impact.",slot:"defensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,n,a,o=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!e.hasShield)return c.push("Shield not in hand!"),{effects:r,messages:c,consumesTurn:!1};r.push(..._t.SHIELD_THROW.anticipation(n.position,a));const{isValid:d,blockedBy:h,blockedAt:g}=$d(e,n.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:n.id});if(!d&&h==="wall")return c.push("Shield hit a wall mid-flight!"),r.push({type:"SpawnItem",itemType:"shield",position:g}),{effects:r,messages:c,consumesTurn:!0};const m=ye(e,a);if(!m)return c.push("Shield missed: No target at location."),r.push({type:"SpawnItem",itemType:"shield",position:a}),{effects:r,messages:c,consumesTurn:!0};const f=ht(n.position,a);r.push(..._t.SHIELD_THROW.execution(f));const b=4,{directionIndex:x}=Pn(n.position,a),T=Yt(x);r.push({type:"ApplyStatus",target:m.id,status:"stunned",duration:1}),r.push(..._t.SHIELD_THROW.impact(a,T));const S=Ul(e,{origin:a,direction:T,momentum:b}),A=S.filter(w=>w.type==="Displacement"&&w.target===m.id),O=A[A.length-1],_=O&&"destination"in O?O.destination:a,E=ht(a,_);return E.length>1&&r.push(..._t.SHIELD_THROW.resolution(E)),r.push({type:"SpawnItem",itemType:"shield",position:_}),c.push("Direct hit! Shield triggered kinetic pulse."),{effects:[...r,...S],messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>$e.getAxialTargets(e,n,4),upgrades:{},scenarios:Ze("SHIELD_THROW")},XT={id:"SMOKE_SCREEN",name:"Smoke Screen",description:"Vanish into a cloud of smoke. Adds +2 to stealth counter.",slot:"utility",icon:"",baseVariables:{range:0,cost:0,cooldown:2},execute:(e,n,a)=>{const o=[],r=[];return o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:n.position,metadata:{signature:"STATE.FADE.SHADOW.SMOKE_SCREEN",family:"status",primitive:"state_fade",phase:"instant",element:"shadow",variant:"smoke_screen",targetRef:{kind:"target_hex"},skillId:"SMOKE_SCREEN"}}),r.push("Smoke Screen!"),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>[n],upgrades:{},scenarios:Ze("SMOKE_SCREEN")},WT={id:"SNEAK_ATTACK",name:"Sneak Attack",description:"Attack an adjacent enemy. Deals massive damage if executed from stealth.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};const c=Wn(e.enemies,a);if(!c)return{effects:o,messages:["No target!"],consumesTurn:!1};if(!kt(n.position,a,1))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const d=(n.stealthCounter||0)>0,h=d?3:1,g=Pt({attackerId:n.id,targetId:c.id,skillId:"SNEAK_ATTACK",basePower:h,trinity:Ie(n),targetTrinity:Ie(c),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.25}],statusMultipliers:[]});return o.push({type:"Damage",target:c.id,amount:g.finalPower,reason:"sneak_attack",source:n.position,scoreEvent:g.scoreEvent}),d?(o.push({type:"Juice",effect:"flash",target:a,color:"#ff0000",metadata:{signature:"ATK.STRIKE.SHADOW.SNEAK_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"shadow",variant:"sneak_attack",targetRef:{kind:"target_hex"},skillId:"SNEAK_ATTACK",flags:{crit:!0}}}),r.push("SNEAK ATTACK!")):r.push("Sneak attack (No stealth bonus)."),{effects:o,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>Xe(n).filter(a=>!!Wn(e.enemies,a)),upgrades:{},scenarios:Ze("SNEAK_ATTACK")},GT={id:"SOUL_SWAP",name:"Soul Swap",description:"Instantly swap positions with a player-aligned minion.",slot:"utility",icon:"",baseVariables:{range:6,cost:0,cooldown:3},execute:(e,n,a)=>{const o=[],r=[];if(!a)return{effects:o,messages:r,consumesTurn:!1};if(!kt(n.position,a,6))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const c=ye(e,a);return!c||c.factionId!=="player"||c.id===n.id?{effects:o,messages:["Target must be a minion!"],consumesTurn:!1}:(o.push({type:"Displacement",target:n.id,destination:a}),o.push({type:"Displacement",target:c.id,destination:n.position}),o.push({type:"Juice",effect:"flash",target:a,color:"#330066",metadata:{signature:"MOVE.BLINK.ARCANE.SOUL_SWAP_ARRIVE",family:"movement",primitive:"blink",phase:"instant",element:"arcane",variant:"soul_swap_arrival",targetRef:{kind:"target_hex"},skillId:"SOUL_SWAP"}}),o.push({type:"Juice",effect:"flash",target:n.position,color:"#330066",metadata:{signature:"MOVE.BLINK.ARCANE.SOUL_SWAP_DEPART",family:"movement",primitive:"blink",phase:"instant",element:"arcane",variant:"soul_swap_departure",targetRef:{kind:"target_hex"},skillId:"SOUL_SWAP"}}),r.push("Soul Swapped!"),{effects:o,messages:r,consumesTurn:!0})},getValidTargets:(e,n)=>e.enemies.filter(a=>a.factionId==="player"&&kt(n,a.position,6)).map(a=>a.position),upgrades:{},scenarios:Ze("SOUL_SWAP")},JT={id:"SPEAR_THROW",name:e=>e.hasSpear?"Spear Throw":"Recall Spear",description:e=>e.hasSpear?"Throw your spear to instantly kill an enemy.":"Recall your spear, damaging enemies in its path.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:1},execute:(e,n,a,o=[])=>{const r=[],c=[],d=Ie(n),h=o.includes("SPEAR_RANGE"),g=o.includes("RECALL"),m=o.includes("RECALL_DAMAGE"),f=o.includes("LUNGE"),b=o.includes("LUNGE_ARC"),x=o.includes("DEEP_BREATH"),T=o.includes("SPEAR_CLEAVE")||o.includes("CLEAVE"),S=3+(h?1:0);if(e.hasSpear){if(!a)return{effects:r,messages:c,consumesTurn:!1};if(f&&be(n.position,a)===2){const C=ye(e,a);if(C&&C.id!==n.id){const I=Pt({attackerId:n.id,targetId:C.id,skillId:"SPEAR_THROW",basePower:99,trinity:d,targetTrinity:Ie(C),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return r.push({type:"Displacement",target:"self",destination:a,simulatePath:!0}),r.push({type:"Damage",target:C.id,amount:I.finalPower,scoreEvent:I.scoreEvent}),c.push(`Lunged and killed ${C.subtype||"enemy"} !`),b&&Xe(a).forEach(N=>{const H=ye(e,N);if(H&&H.id!==n.id&&H.id!==C.id){const D=Pt({attackerId:n.id,targetId:H.id,skillId:"SPEAR_THROW",basePower:1,trinity:d,targetTrinity:Ie(H),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:H.id,amount:D.finalPower,scoreEvent:D.scoreEvent})}}),x&&r.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0}),{effects:r,messages:c}}}if(!kt(n.position,a,S))return c.push("Out of range!"),{effects:r,messages:c,consumesTurn:!1};const A=Wn(e.enemies,a);if(!A)return c.push("No enemy at target."),{effects:r,messages:c,consumesTurn:!1};if(!Pn(n.position,a).isAxial)return c.push("Target must be axial."),{effects:r,messages:c,consumesTurn:!1};if(!Nl(e,n.position,a,A.id,n.id))return c.push("No clear line of sight to enemy."),{effects:r,messages:c,consumesTurn:!1};r.push(..._t.SPEAR_THROW.anticipation(n.position,a));const E=a,w=A;if(r.push(..._t.SPEAR_THROW.execution(ht(n.position,E))),w){const C=Pt({attackerId:n.id,targetId:w.id,skillId:"SPEAR_THROW",basePower:99,trinity:d,targetTrinity:Ie(w),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});r.push(..._t.SPEAR_THROW.impact(E,!0)),r.push({type:"Damage",target:w.id,amount:C.finalPower,scoreEvent:C.scoreEvent}),c.push(`Spear killed ${w.subtype||"enemy"} !`),x&&r.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0})}else r.push(..._t.SPEAR_THROW.impact(E,!1)),c.push("Spear thrown.");r.push({type:"SpawnItem",itemType:"spear",position:E}),g&&(r.push({type:"PickupSpear",position:E}),c.push("Spear auto-retrieved."))}else{const A=e.spearPosition;if(!A)return c.push("Spear is lost!"),{effects:r,messages:c,consumesTurn:!1};const O=ht(A,n.position);if(m&&O.forEach(_=>{const E=Wn(e.enemies,_);if(E){const w=Pt({attackerId:n.id,targetId:E.id,skillId:"SPEAR_THROW",basePower:1,trinity:d,targetTrinity:Ie(E),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:E.id,amount:w.finalPower,scoreEvent:w.scoreEvent}),c.push(`Spear recall hit ${E.subtype||"enemy"} !`)}}),r.push({type:"PickupSpear",position:A}),c.push("Spear recalled."),T){for(const _ of Xe(A)){const E=Wn(e.enemies,_);if(!E)continue;const w=Pt({attackerId:n.id,targetId:E.id,skillId:"SPEAR_THROW",basePower:1,trinity:d,targetTrinity:Ie(E),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1}],statusMultipliers:[]});r.push({type:"Damage",target:E.id,amount:w.finalPower,scoreEvent:w.scoreEvent})}c.push("Cleave triggered on pickup.")}r.push({type:"Juice",effect:"spearTrail",path:O,intensity:"medium",metadata:{signature:"ATK.SHOOT.PHYSICAL.SPEAR_RETURN",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"spear_return",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"},skillId:"SPEAR_THROW"}})}return{effects:r,messages:c}},getValidTargets:(e,n)=>{if(!e.hasSpear)return[];const a=ye(e,n);if(!a)return[];const c=3+(a.activeSkills?.find(h=>h.id==="SPEAR_THROW")?.activeUpgrades?.includes("SPEAR_RANGE")?1:0);return e.enemies.filter(h=>h.hp>0).filter(h=>{const g=h.position;return!Pn(n,g).isAxial||!kt(n,g,c)?!1:Nl(e,n,g,h.id,a.id)}).map(h=>h.position)},upgrades:{SPEAR_RANGE:{id:"SPEAR_RANGE",name:"Extended Reach",description:"Range +1"},RECALL:{id:"RECALL",name:"Recall",description:"Spear automatically returns (handled internally if active, or via manual recall)"},RECALL_DAMAGE:{id:"RECALL_DAMAGE",name:"Returning Edge",description:"Damage enemies in path when recalling spear"},LUNGE:{id:"LUNGE",name:"Lunge",description:"If an enemy is exactly 2 hexes away, move to them and kill"},LUNGE_ARC:{id:"LUNGE_ARC",name:"Lunge Sweeping",description:"Lunge hits neighbors of the target"},DEEP_BREATH:{id:"DEEP_BREATH",name:"Deep Breath",description:"Reset Jump cooldown on spear kill"},SPEAR_CLEAVE:{id:"SPEAR_CLEAVE",name:"Cleave",description:"Damage all neighbors when picking up spear"}},scenarios:Ze("SPEAR_THROW")},QT={id:"SWIFT_ROLL",name:"Swift Roll",description:"Quickly dodge 2 tiles. Passive: Automatically roll away from attackers when hit.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,n,a)=>{const o=[],r=[];return a?kt(n.position,a,2)?Dn(e,a)||La(e,a)||ca(e,a,n.id)?{effects:o,messages:["Cannot roll there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"Juice",effect:"dashBlur",target:a,path:[n.position,a],metadata:{signature:"MOVE.DASH.NEUTRAL.SWIFT_ROLL",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"swift_roll",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"},skillId:"SWIFT_ROLL"}}),r.push("Swift roll!"),{effects:o,messages:r,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:r,consumesTurn:!1}},getValidTargets:(e,n)=>$e.getAreaTargets(e,n,2).filter(o=>se(o,n)?!1:!Dn(e,o)&&!La(e,o)&&!ca(e,o)),upgrades:{},scenarios:Ze("SWIFT_ROLL")},ZT={id:"THEME_HAZARDS",name:"Theme Hazards",description:"Internal skill for testing floor themes.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0},execute:e=>({effects:[],messages:[]}),upgrades:{},scenarios:Ze("THEME_HAZARDS")},e1={id:"TIME_BOMB",name:"Time Bomb",description:"Detonates when the fuse reaches zero.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0,damage:1},execute:(e,n,a)=>{const o=n.statusEffects.find(h=>h.type==="time_bomb");if(o&&o.duration>1)return{effects:[],messages:[],consumesTurn:!0};const r=n.position,d=[r,...Xe(r)].map(h=>({type:"Damage",target:h,amount:1,reason:"bomb_explosion"}));return d.push({type:"Damage",target:n.id,amount:999,reason:"bomb_explosion"}),d.push({type:"Juice",effect:"explosion_ring",target:r,intensity:"high",metadata:{signature:"ATK.BLAST.FIRE.TIME_BOMB",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"time_bomb",targetRef:{kind:"target_hex"},skillId:"TIME_BOMB"}}),{effects:d,messages:["A bomb exploded!"],consumesTurn:!0}},getValidTargets:(e,n)=>[n],upgrades:{}},t1={id:"VAULT",name:e=>e.turnNumber%2!==0?"Stun Vault":"Vault",description:e=>e.turnNumber%2!==0?"Leap to an empty tile and stun neighbors. (Odd Turn)":"Leap to an empty tile. (Even Turn)",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:0},execute:(e,n,a,o=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!kt(n.position,a,2))return c.push("Out of range!"),{effects:r,messages:c,consumesTurn:!1};if(Dn(e,a)||ca(e,a))return c.push("Blocked!"),{effects:r,messages:c,consumesTurn:!1};if(!ki(e,n,a))return c.push("Blocked!"),{effects:r,messages:c,consumesTurn:!1};const d=e.turnNumber%2!==0;r.push(..._t.VAULT.anticipation(n.position,a));const h=ht(n.position,a);if(r.push(..._t.VAULT.execution(h)),r.push({type:"Displacement",target:"self",destination:a,path:h,ignoreGroundHazards:!0,animationDuration:250}),d){c.push("Stun Vault executed!");const g=Xe(a);for(const m of g)Wn(e.enemies,m)&&r.push({type:"ApplyStatus",target:m,status:"stunned",duration:1});r.push(..._t.VAULT.impact(a,!0)),c.push("Slam landing! Neighbors stunned.")}else r.push(..._t.VAULT.impact(a,!1)),c.push("Vaulted!");return{effects:r,messages:c}},getValidTargets:(e,n)=>{const o=ye(e,n);return o?$e.getAreaTargets(e,n,2).filter(r=>se(r,n)?!1:!Dn(e,r)&&!ca(e,r)&&ki(e,o,r)):[]},upgrades:{},scenarios:[{id:"vault_shift_stun",title:"Vault State-Shifting: Stun (Turn 1)",description:"Verify vault stuns on Turn 1 (Odd).",setup:e=>{e.setTurn(1),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>n.some(a=>a.includes("Stun Vault executed!"))},{id:"vault_shift_normal",title:"Vault State-Shifting: Normal (Turn 2)",description:"Verify vault is normal on Turn 2 (Even).",setup:e=>{e.setTurn(2),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>n.some(a=>a.includes("Vaulted!"))&&!n.some(a=>a.includes("Slam landing!"))}]},_y=1,wy=1,n1=1,Gg=2,i1=2;function a1(e,n,a,o=Gg){const r=Gn(a,n);if(r===-1)return null;const c=Yt(r);for(let h=o;h>=n1;h--){let g=n,m=!0;for(let f=0;f<h;f++){if(g=rn(g,c),!$e.isWithinBounds(e,g)){m=!1;break}if(!Ne.isWalkable(e,g)){m=!1;break}}if(m&&!ye(e,g))return g}const d=[(r+1)%6,(r+5)%6];for(const h of d){const g=Yt(h);let m=rn(n,g);if($e.isWithinBounds(e,m)&&Ne.isWalkable(e,m)&&!ye(e,m))return m}return null}const s1={id:"WITHDRAWAL",name:"Withdrawal",description:"Quick shot + tactical backroll. Auto-triggers when enemies close in.",slot:"utility",icon:"",baseVariables:{range:_y,cost:0,cooldown:i1,damage:wy},execute:(e,n,a,o=[])=>{const r=[],c=[],d=o.includes("PARTING_SHOT"),h=o.includes("NIMBLE_FEET");if(!a)return{effects:r,messages:["No target!"],consumesTurn:!1};if(be(n.position,a)>_y)return{effects:r,messages:["Target out of range!"],consumesTurn:!1};const m=ye(e,a);if(!m)return{effects:r,messages:["No enemy at target!"],consumesTurn:!1};if(m.factionId===n.factionId)return{effects:r,messages:["Cannot target allies!"],consumesTurn:!1};const f=Pt({attackerId:n.id,targetId:m.id,skillId:"WITHDRAWAL",basePower:wy+(d?1:0),trinity:Ie(n),targetTrinity:Ie(m),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});r.push({type:"Damage",target:m.id,amount:f.finalPower,scoreEvent:f.scoreEvent}),r.push({type:"Juice",effect:"impact",target:a,metadata:{signature:"ATK.SHOOT.PHYSICAL.WITHDRAWAL",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"withdrawal_shot",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"WITHDRAWAL"}}),c.push(`Withdrawal shot hits ${m.subtype||"enemy"}!`);const b=h?3:Gg,x=a1(e,n.position,a,b);return x?(r.push({type:"Displacement",target:"self",destination:x,source:n.position}),r.push({type:"Juice",effect:"dashBlur",target:x,path:[n.position,x],metadata:{signature:"MOVE.DASH.NEUTRAL.WITHDRAWAL_BACKROLL",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"withdrawal_backroll",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"WITHDRAWAL"}}),c.push("Backroll!")):c.push("No safe retreat available!"),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>Xe(n).filter(a=>{const o=ye(e,a);return o&&o.factionId==="enemy"}),upgrades:{PARTING_SHOT:{id:"PARTING_SHOT",name:"Parting Shot",description:"Withdrawal deals +1 damage."},NIMBLE_FEET:{id:"NIMBLE_FEET",name:"Nimble Feet",description:"Backroll distance increased to 3 hexes."},HAIR_TRIGGER:{id:"HAIR_TRIGGER",name:"Hair Trigger",description:"Passive reaction does not consume cooldown."}},scenarios:Ze("WITHDRAWAL")},o1={ABSORB_FIRE:hS,ARCHER_SHOT:cA,AUTO_ATTACK:zg,BASIC_ATTACK:eT,BASIC_MOVE:aT,BOMB_TOSS:sT,BULWARK_CHARGE:oT,CORPSE_EXPLOSION:cT,DASH:fT,FALCON_APEX_STRIKE:mT,FALCON_AUTO_ROOST:pT,FALCON_COMMAND:hT,FALCON_HEAL:yT,FALCON_PECK:gT,FALCON_SCOUT:bT,FIREBALL:vT,FIREWALK:ST,FIREWALL:AT,GRAPPLE_HOOK:wT,JUMP:MT,KINETIC_TRI_TRAP:IT,MULTI_SHOOT:LT,RAISE_DEAD:qT,SENTINEL_BLAST:$T,SENTINEL_TELEGRAPH:zT,SET_TRAP:VT,SHADOW_STEP:YT,SHIELD_BASH:KT,SHIELD_THROW:FT,SMOKE_SCREEN:XT,SNEAK_ATTACK:WT,SOUL_SWAP:GT,SPEAR_THROW:JT,SWIFT_ROLL:QT,THEME_HAZARDS:ZT,TIME_BOMB:e1,VAULT:t1,WITHDRAWAL:s1},ql=o1,nl=pS(ql);if(nl.missing.length>0||nl.invalid.length>0){const e=nl.missing.join(", "),n=nl.invalid.map(a=>`${a.skillId}: ${a.errors.join("; ")}`).join(" | ");throw new Error(`Skill intent profile validation failed. missing=[${e}] invalid=[${n}]`)}const Es=()=>({...ql,...Zv()});function aa(e){const a=Es()[e];return a?{id:e,name:a.name,description:typeof a.description=="function"?a.description({}):a.description,slot:a.slot,cooldown:a.baseVariables.cooldown||0,currentCooldown:0,range:a.baseVariables.range||0,upgrades:Object.keys(a.upgrades||{}),activeUpgrades:[]}:null}function r1(){return[aa("BASIC_MOVE"),aa("BASIC_ATTACK"),aa("AUTO_ATTACK"),aa("SPEAR_THROW"),aa("SHIELD_BASH"),aa("JUMP")].filter(Boolean)}const l1={...ql,get:e=>Es()[e],getAllUpgrades:()=>{const e=Es();return Object.values(e).flatMap(n=>Object.values(n.upgrades||{}).map(a=>({...a,skillId:n.id})))},getUpgrade:e=>{const n=Es();for(const a of Object.values(n))if(a.upgrades?.[e])return a.upgrades[e]},getSkillForUpgrade:e=>{const n=Es();for(const[a,o]of Object.entries(n))if(o.upgrades?.[e])return a},getSkillRange:(e,n)=>{const a=(e.activeSkills||[]).find(c=>c.id===n),o=Es()[n];if(!o)return a?.range||0;let r=o.baseVariables.range;return a?.activeUpgrades&&a.activeUpgrades.forEach(c=>{const d=o.upgrades[c];d?.modifyRange&&(r+=d.modifyRange)}),r}},Xt=l1,c1=Xt.getSkillRange,u1=e=>Xt.get(e),d1=(e,n)=>{const a=n.initialSeed??n.rngSeed??"0",o=n.commandLog?.length??0;return{id:ws(a,o,9,"cmd"),timestamp:n.turnNumber,action:e}},f1=(e,n,a)=>{const o=a.initialSeed??a.rngSeed??"0",r=a.undoStack?.length??0;return{id:ws(o,r,9,"delta"),undoData:{player:{...e.player},enemies:[...e.enemies],turnNumber:e.turnNumber,gameStatus:e.gameStatus}}},Os={VANGUARD:{id:"VANGUARD",name:"Vanguard",description:"Direct damage, brawling, and area denial.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK","SPEAR_THROW","SHIELD_BASH","JUMP"]},SKIRMISHER:{id:"SKIRMISHER",name:"Skirmisher",description:"Zero direct damage. Kinetic momentum and environmental lethality.",startingUpgrades:[],startingSkills:["DASH","GRAPPLE_HOOK","SHIELD_THROW","VAULT"]},FIREMAGE:{id:"FIREMAGE",name:"Fire Mage",description:"Area control with fire and high-damage spells.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","ABSORB_FIRE","FIREBALL","FIREWALL","FIREWALK"]},NECROMANCER:{id:"NECROMANCER",name:"Necromancer",description:"Utilize death and reanimation.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","CORPSE_EXPLOSION","RAISE_DEAD","SOUL_SWAP"]},HUNTER:{id:"HUNTER",name:"Hunter",description:"Ranged precision and traps.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","FALCON_COMMAND","KINETIC_TRI_TRAP","WITHDRAWAL"]},ASSASSIN:{id:"ASSASSIN",name:"Assassin",description:"Stealth and high burst damage.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","SNEAK_ATTACK","SMOKE_SCREEN","SHADOW_STEP"]}},Jg=e=>{const n=e.startingSkills.map(o=>aa(o)).filter(Boolean),a=e.id;return{upgrades:[...e.startingUpgrades],activeSkills:n,archetype:a}},m1=e=>e.some(n=>n.id==="BASIC_MOVE"||n.id==="DASH"),Qg=(e=[])=>{if(m1(e))return e;const n=aa("BASIC_MOVE");return n?[n,...e]:e},Yd=e=>{const n=e.activeSkills||[],a=Qg(n);return a===n?e:{...e,activeSkills:a}},p1=(e,n,a,o)=>{const r=(e.pendingFrames?.length??0)+1;return{id:`${e.turnNumber}:${a}:${n}:${r}`,type:n,status:a,createdTurn:e.turnNumber,blocking:!0,payload:o}},h1=(e,n,a,o)=>{const r=p1(e,a,n.status,o);return{...e,pendingStatus:n,pendingFrames:[...e.pendingFrames||[],r]}};function y1(e){let n=e;const a=[],o=[],r=new Map(n.tiles);for(const[c,d]of r.entries()){const h=[];let g=!1;for(const b of d.effects){if(b.duration===-1){h.push(b);continue}const x=b.duration-1;x>0?(h.push({...b,duration:x}),g=!0):(a.push(`The ${b.id.toLowerCase()} died down.`),g=!0)}g&&r.set(c,{...d,effects:h});const m=[n.player,...n.enemies],f=b=>`${b.q},${b.r}`;for(const b of m)if(f(b.position)===c){const x=Na.processStay(b,d,n);o.push(...x.effects),a.push(...x.messages)}}return n={...n,tiles:r},o.length>0&&(n=Jn(n,o)),{state:n,messages:a}}const g1=e=>(Array.isArray(e.tiles)&&(e.tiles=new Map(e.tiles.map(([n,a])=>[n,{...a,traits:new Set(a.traits)}]))),e.player=Yd(No(e.player)),e.enemies=(e.enemies||[]).map(No),e.companions&&(e.companions=e.companions.map(No)),e),b1=(e,n)=>{if(!(e.pendingStatus?.shrineOptions||e.shrineOptions||[]).includes(n))return{...e,message:xt(e.message,`Upgrade ${n} was not offered.`,"CRITICAL","SYSTEM")};let o=e.player,r=!1;const c=Xt.getUpgrade(n);if(c){const d=Xt.getSkillForUpgrade(n),h=!!d&&o.activeSkills.some(g=>g.id===d);if(d&&h){const g=JSON.stringify(o.activeSkills);o=mA(o,d,n),r=JSON.stringify(o.activeSkills)!==g}}else n==="EXTRA_HP"&&(o=dA(o,1,!0),r=!0);return!r&&n!=="EXTRA_HP"?{...e,message:xt(e.message,`Upgrade ${n} could not be applied.`,"CRITICAL","SYSTEM")}:{...e,player:o,upgrades:e.upgrades.includes(n)?e.upgrades:[...e.upgrades,n],gameStatus:"playing",shrinePosition:void 0,shrineOptions:void 0,pendingStatus:void 0,pendingFrames:void 0,message:xt(e.message,`Gained ${c?.name||n}!`,"INFO","OBJECTIVE")}},x1=(e,n)=>{const a=e.pendingFrames||[];if(a.length>1)return{...e,pendingFrames:a.slice(1)};if(!e.pendingStatus)return a.length===1?{...e,pendingFrames:[]}:e;const{status:o,shrineOptions:r,completedRun:c}=e.pendingStatus;if(o==="playing"&&e.gameStatus==="playing"){const d=e.initialSeed??e.rngSeed??"0",h=`${d}:${e.floor+1}`,g=e.enemies.filter(f=>f.hp>0&&f.factionId==="player"&&f.companionOf===e.player.id).sort((f,b)=>f.id.localeCompare(b.id)),m=n.generateInitialState(e.floor+1,h,d,{...e.player,hp:Math.min(e.player.maxHp,e.player.hp+1),upgrades:e.upgrades});if(g.length>0){const f=[m.player.position,...Xe(m.player.position)],b=[m.player,...m.enemies],x=[];for(let T=0;T<g.length;T++){const S=g[T],A=f[f.length-1]||m.player.position,O=f.find(E=>!b.some(C=>se(C.position,E))&&Ne.isWalkable(m,E))||A,_={...S,position:O,previousPosition:O};b.push(_),x.push(_)}m.enemies=[...m.enemies,...x],m.companions=[...m.companions||[],...x.filter(T=>T.companionOf===e.player.id)],m.initiativeQueue=Ha(m),m.occupancyMask=$e.refreshOccupancyMask(m)}return{...m,actionLog:[...e.actionLog||[]],dailyRunDate:e.dailyRunDate,runObjectives:e.runObjectives,hazardBreaches:e.hazardBreaches||0,pendingFrames:void 0}}return{...e,gameStatus:o,shrineOptions:r||e.shrineOptions,completedRun:c||e.completedRun,pendingStatus:void 0,pendingFrames:void 0}},v1=(e,n,a)=>{let o=e;const r=[],c=o.player.position;if(o.spearPosition&&se(c,o.spearPosition)){if(!!o.player.activeSkills?.find(m=>m.id==="SPEAR_THROW")?.activeUpgrades?.some(m=>m==="SPEAR_CLEAVE"||m==="CLEAVE")){const m=Xe(c).map(f=>o.enemies.find(b=>b.hp>0&&se(b.position,f))).filter(f=>!!f&&f.factionId!==o.player.factionId);if(m.length>0){const f=m.map(b=>({type:"Damage",target:b.id,amount:1,reason:"spear_cleave_pickup"}));o=Jn(o,f,{sourceId:o.player.id,stepId:n}),r.push(`Spear cleave hit ${m.length} target(s).`)}}o={...o,hasSpear:!0,spearPosition:void 0,message:xt(o.message,"Picked up your spear.","INFO","OBJECTIVE")}}const d=y1(o);if(o=d.state,r.push(...d.messages),o={...o,turnNumber:o.turnNumber+1,turnsSpent:(o.turnsSpent||0)+1},o.traps&&o.traps.length>0&&(o={...o,traps:o.traps.map(h=>({...h,cooldown:Math.max(0,h.cooldown-1)}))}),o=nT(o),Jx(o,o.player.position)){const h=o.player.activeSkills||[],g=new Set(h.map(S=>S.id)),m=new Map;for(const S of h)m.set(S.id,new Set(S.activeUpgrades||[]));const f=Xt.getAllUpgrades().filter(S=>g.has(S.skillId)).filter(S=>{if(o.upgrades.includes(S.id))return!1;const A=m.get(S.skillId);return!A||!A.has(S.id)}).map(S=>S.id).filter((S,A,O)=>O.indexOf(S)===A),b=[];let x={...o};for(let S=0;S<3&&f.length>0;S++){const A=ka(x);x=A.nextState;const O=Math.floor(A.value*f.length);b.push(f[O]),f.splice(O,1)}const T=b.length>0?b:["EXTRA_HP"];return{state:a.withPendingFrame({...o,rngCounter:x.rngCounter,message:xt(o.message,"A holy shrine! Choose an upgrade.","INFO","OBJECTIVE")},{status:"choosing_upgrade",shrineOptions:T},"SHRINE_CHOICE",{shrineOptions:T}),messages:r,haltTurnLoop:!0}}if(Qx(o,o.player.position)){if(o.floor>=10){const g=Lo(o);return{state:a.withPendingFrame({...o,message:xt(o.message,`Arcade Cleared! Final Score: ${g.score}`,"INFO","OBJECTIVE")},{status:"won",completedRun:g},"RUN_WON",{score:g.score??0}),messages:r,haltTurnLoop:!0}}return{state:a.withPendingFrame({...o,message:xt(o.message,"Descending to the next level...","INFO","OBJECTIVE")},{status:"playing"},"STAIRS_TRANSITION",{nextFloor:o.floor+1}),messages:r,haltTurnLoop:!0}}return{state:o,messages:r,haltTurnLoop:!1}},My=(e,n)=>{const a=n.q-e.q,o=n.r-e.r;return a>0&&o===0?0:a>0&&o<0?1:a===0&&o<0?2:a<0&&o===0?3:a<0&&o>0?4:5},wn=(e,n,a,o=[],r)=>{if(QA(e))return{position:e.position,state:a};const c=$e.getNeighbors(e.position);let d=[],h=r!==void 0?Math.abs(be(e.position,n)-r):be(e.position,n);for(const b of c){if(!$e.isWithinBounds(a,b))continue;const x=a.tiles.get(ue(b)),T=x?.traits.has("BLOCKS_LOS")||x?.baseId==="WALL",S=o.some(E=>se(E,b))||a.enemies.some(E=>E.id!==e.id&&se(E.position,b))||se(b,n);if(T||S)continue;const A=x?Na.getMovementCost(a,x):1,_=(r!==void 0?Math.abs(be(b,n)-r):be(b,n))+(A-1);_<h?(h=_,d=[b]):_===h&&d.push(b)}if(d.length===0)return{position:e.position,state:a};if(d.length===1)return{position:d[0],state:a};const{value:g,nextState:m}=ka(a),f=Math.floor(g*d.length)%d.length;return{position:d[f],state:m}},S1=(e,n,a)=>{if(be(e.position,n)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};let r=e.position,c=a;for(let h=0;h<2&&!(be(r,n)<=1);h++){const g={...e,position:r},{position:m,state:f}=wn(g,n,c,a.occupiedCurrentTurn);r=m,c=f}const d=!se(r,e.position);return{entity:{...e,position:r,intent:d?"Moving":"BASIC_ATTACK",intentPosition:d?void 0:{...n}},nextState:c,message:d?`${e.subtype} moves to (${r.q}, ${r.r})`:void 0}},A1=(e,n,a)=>{const o=be(e.position,n),r=My(e.position,n);if(o===1)return{entity:{...e,facing:r,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:c,state:d}=wn(e,n,a,a.occupiedCurrentTurn),h=!se(c,e.position);return{entity:{...e,position:c,facing:h?My(e.position,c):r,intent:h?"Advancing":"BASIC_ATTACK",intentPosition:h?void 0:{...n}},nextState:d,message:h?`${e.subtype} advances to (${c.q}, ${c.r})`:void 0}},T1=(e,n,a)=>{const o=be(e.position,n);let r=a;const{value:c,nextState:d}=ka(r);r=d;let h=e.position;if(o<=2||c<.3){const{value:b,nextState:x}=ka(r);r=x;const{value:T,nextState:S}=ka(r);r=S;const A=Math.floor(b*6),O=3+Math.floor(T*3);let _=e.position;for(let w=0;w<O;w++)_=rn(_,Yt(A));!$e.isWithinBounds(a,_)||!Ne.isWalkable(a,_)||a.occupiedCurrentTurn?.some(w=>se(w,_))||a.enemies.some(w=>w.id!==e.id&&se(w.position,_))||se(_,n)||(h=_)}const g=!se(h,e.position),m=be(h,n),f=!g&&m>=2&&m<=4;return{entity:{...e,position:h,intent:g?"Repositioning":f?"Casting":"Preparing",intentPosition:f?{...n}:void 0},nextState:r,message:g?`${e.subtype} teleports to (${h.q}, ${h.r})`:void 0}},E1=(e,n,a)=>{const o=be(e.position,n);if(o===1)return{entity:{...e,isVisible:!0,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:r,state:c}=wn(e,n,a,a.occupiedCurrentTurn),d=!se(r,e.position);return{entity:{...e,position:r,isVisible:d?!1:o<=1,intent:d?"Moving":"BASIC_ATTACK",intentPosition:d?void 0:{...n}},nextState:c,message:d?"You hear footsteps nearby...":void 0}},_1={sentinel:{telegraphSkillId:"SENTINEL_TELEGRAPH",executeSkillId:"SENTINEL_BLAST",triggerRange:3,telegraphMessage:"The Sentinel marks the blast zone..."}},w1=(e,n,a,o)=>{const c=be(e.position,n)<=o.triggerRange,d=a.turnNumber%2===0,h=!d;if(c&&h&&Ci(e))return{entity:{...e,intent:"Preparing",intentPosition:void 0},nextState:a,message:`${e.subtype} loses focus!`};if(c&&d)return{entity:{...e,intent:o.telegraphSkillId,intentPosition:{...n}},nextState:a,message:o.telegraphMessage};if(c&&h)return{entity:{...e,intent:o.executeSkillId,intentPosition:{...n}},nextState:a};const{position:g,state:m}=wn(e,n,a,a.occupiedCurrentTurn);return{entity:{...e,position:g,intent:"Moving",intentPosition:void 0},nextState:m}},M1=(e,n,a)=>{const o=e.actionCooldown??0;if(o>0)return{entity:{...e,actionCooldown:o-1,intent:"Charging Power"},nextState:a};const r=be(e.position,n);if(r>=1&&r<=3)return{entity:{...e,actionCooldown:2,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:c,state:d}=wn(e,n,a,a.occupiedCurrentTurn),h=!se(c,e.position);return{entity:{...e,position:c,intent:h?"Lumbering":"Waiting",actionCooldown:0},nextState:d,message:h?`${e.subtype} lumbers to (${c.q}, ${c.r})`:void 0}},O1=(e,n,a)=>{const o=be(e.position,n);if(o>4){const{position:f,state:b}=wn(e,n,a,a.occupiedCurrentTurn),x=!se(f,e.position);return{entity:{...e,position:f,intent:x?"Following":"Waiting"},nextState:b,message:x?`${e.subtype} follows you.`:void 0}}const r=a.enemies.filter(f=>f.factionId==="enemy").sort((f,b)=>be(e.position,f.position)-be(e.position,b.position))[0];if(!r){if(o>1){const{position:f,state:b}=wn(e,n,a,a.occupiedCurrentTurn);return{entity:{...e,position:f,intent:"Idle"},nextState:b}}return{entity:{...e,intent:"Idle"},nextState:a}}if(be(e.position,r.position)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...r.position}},nextState:a};const{position:d,state:h}=wn(e,r.position,a,a.occupiedCurrentTurn),g=!se(d,e.position),m=be(d,r.position);return{entity:{...e,position:d,intent:g?"Advancing":m===1?"BASIC_ATTACK":"Waiting",intentPosition:g||m>1?void 0:{...r.position}},nextState:h,message:g?`${e.subtype} attacks ${r.subtype}!`:void 0}},C1=(e,n,a)=>{const o=be(e.position,n);if((e.position.q===n.q||e.position.r===n.r||e.position.s===n.s)&&o>=2&&o<=4)return{entity:{...e,intent:"DASH",intentPosition:{...n}},nextState:a};const{position:c,state:d}=wn(e,n,a,a.occupiedCurrentTurn),h=!se(c,e.position),g=be(c,n);return{entity:{...e,position:c,intent:h?"Moving":g===1?"BASIC_ATTACK":"Waiting",intentPosition:h||g>1?void 0:{...n}},nextState:d,message:h?`${e.subtype} moves to (${c.q}, ${c.r})`:void 0}},k1=(e,n,a)=>{const o=be(e.position,n);if((e.position.q===n.q||e.position.r===n.r||e.position.s===n.s)&&o>=2&&o<=4)return{entity:{...e,intent:"GRAPPLE_HOOK",intentPosition:{...n}},nextState:a};const{position:c,state:d}=wn(e,n,a,a.occupiedCurrentTurn),h=!se(c,e.position);return{entity:{...e,position:c,intent:h?"Moving":"Waiting",intentPosition:void 0},nextState:d,message:h?`${e.subtype} moves to (${c.q}, ${c.r})`:void 0}},N1=(e,n,a)=>{const o=be(e.position,n),r=e.activeSkills?.some(f=>f.id==="ARCHER_SHOT")?"ARCHER_SHOT":"SPEAR_THROW",c=Xt.get(r);if(o>1&&!!c?.getValidTargets&&c.getValidTargets(a,e.position).some(f=>se(f,n)))return{entity:{...e,intent:r,intentPosition:{...n}},nextState:a};if(o===1&&e.activeSkills?.some(f=>f.id==="BASIC_ATTACK"))return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:h,state:g}=wn(e,n,a,a.occupiedCurrentTurn),m=!se(h,e.position);return{entity:{...e,position:h,intent:m?"Moving":"Idle",intentPosition:void 0},nextState:g,message:m?`${e.subtype} moves to (${h.q}, ${h.r})`:void 0}},R1=(e,n,a)=>{const o=be(e.position,n),r=e.actionCooldown??0;if(r===0&&o>=2&&o<=3){const m=$e.getNeighbors(n).filter(f=>{const b=!Ne.isWalkable(a,f),x=a.enemies.some(T=>se(T.position,f));return $e.isWithinBounds(a,f)&&!b&&!x&&!se(f,n)});if(m.length>0){const{value:f,nextState:b}=ka(a),x=Math.floor(f*m.length)%m.length,T=m[x];return{entity:{...e,intent:"Bombing",intentPosition:T,actionCooldown:2},nextState:b}}}const{position:d,state:h}=wn(e,n,a,a.occupiedCurrentTurn,2.5),g=!se(d,e.position);return{entity:{...e,position:d,intent:g?"Moving":"Waiting",intentPosition:void 0,actionCooldown:Math.max(0,r-1)},nextState:h,message:g?`${e.subtype} repositioning to (${d.q}, ${d.r})`:void 0}},I1=(e,n,a)=>{if(be(e.position,n)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:r,state:c}=wn(e,n,a,a.occupiedCurrentTurn),d=!se(r,e.position),h=be(r,n);return{entity:{...e,position:r,intent:d?"Moving":h===1?"BASIC_ATTACK":"Waiting",intentPosition:d||h>1?void 0:{...n}},nextState:c,message:d?`${e.subtype} moves to (${r.q}, ${r.r})`:void 0}},L1={sprinter:S1,shieldBearer:A1,warlock:T1,assassin:E1,golem:M1,sentinel:(e,n,a)=>w1(e,n,a,_1.sentinel),raider:C1,pouncer:k1,archer:N1,bomber:R1},H1=(e,n,a)=>{if(e.factionId==="player")return O1(e,n,a);if((a.player.stealthCounter||0)>0)return{entity:{...e,intent:"Searching",intentPosition:void 0},nextState:a};const r=e.subtype?L1[e.subtype]:void 0;return r?r(e,n,a):I1(e,n,a)},il={weightsByIntent:{offense:{survival:2.1,lethality:6.5,position:2.4,objective:.5,status:2.5,tempo:1.6,resource:1},defense:{survival:4.8,lethality:3.6,position:3,objective:.8,status:2.2,tempo:1.6,resource:1},positioning:{survival:2.3,lethality:3.8,position:3.1,objective:6,status:1.4,tempo:1.6,resource:1},control:{survival:2.3,lethality:4.2,position:2.8,objective:.6,status:3.4,tempo:1.6,resource:1}},thresholds:{defenseHpRatio:.45,defensePressureHpRatio:.65,defensePressureAdjacentHostiles:2,controlMinHostiles:3}};({...il.weightsByIntent,offense:{...il.weightsByIntent.offense},control:{...il.weightsByIntent.control}},{...il.thresholds});class Oy{getFalconIntent(n,a){const o=a.companionState?.mode||"roost",r=a.companionOf===n.player.id?n.player:n.enemies.find(d=>d.id===a.companionOf),c={expectedValue:0,reasoningCode:`FALCON_${o.toUpperCase()}`,isGhost:!1,rngConsumption:0};if(o==="scout")return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_SCOUT",targetHex:a.position,priority:10,metadata:c};if(o==="predator"&&typeof a.companionState?.markTarget=="string"){const d=n.enemies.find(g=>g.id===a.companionState.markTarget&&g.hp>0);if(!d)return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_AUTO_ROOST",targetHex:a.position,priority:9,metadata:{...c,reasoningCode:"FALCON_AUTO_ROOST"}};const h=be(a.position,d.position);return h<=4?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_APEX_STRIKE",targetHex:d.position,primaryTargetId:d.id,priority:10,metadata:c}:h<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_PECK",targetHex:d.position,primaryTargetId:d.id,priority:9,metadata:c}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(n,a,d.position),primaryTargetId:d.id,priority:7,metadata:c}}return r?be(a.position,r.position)<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_HEAL",targetHex:r.position,primaryTargetId:r.id,priority:10,metadata:c}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(n,a,r.position),primaryTargetId:r.id,priority:7,metadata:c}:{type:"WAIT",actorId:a.id,skillId:"WAIT_SKILL",priority:1,metadata:{...c,reasoningCode:"FALCON_WAIT"}}}findStepToward(n,a,o){const r=Xe(a.position).filter(c=>$e.isWithinBounds(n,c)).filter(c=>Ne.isWalkable(n,c)).filter(c=>{const d=ye(n,c);return!d||d.id===a.id});return r.length===0?a.position:r.sort((c,d)=>be(c,o)-be(d,o))[0]}getIntent(n,a){if(a.subtype==="falcon")return this.getFalconIntent(n,a);if(a.subtype==="bomb")return{type:"USE_SKILL",actorId:a.id,skillId:"TIME_BOMB",targetHex:a.position,priority:10,metadata:{expectedValue:0,reasoningCode:"BOMB_FUSE_TICK",isGhost:!1,rngConsumption:0}};const o=n.player.position,r=H1(a,o,{...n,occupiedCurrentTurn:n.occupiedCurrentTurn}),{entity:c,message:d}=r;let h="WAIT",g="WAIT_SKILL",m,f,b=10;const x=c.intent||"Waiting";if(x==="Moving"||x==="Advancing"||x==="Repositioning"||x==="Lumbering")h="MOVE",g="BASIC_MOVE",m=c.position;else if(x==="BASIC_ATTACK"){if(h="ATTACK",g="BASIC_ATTACK",m=c.intentPosition,m){const S=n.player.position.q===m.q&&n.player.position.r===m.r?n.player:n.enemies.find(A=>A.position.q===m?.q&&A.position.r===m?.r);S&&S.factionId!==a.factionId&&(f=S.id)}}else x==="SPEAR_THROW"?(h="USE_SKILL",g="SPEAR_THROW",m=c.intentPosition):x==="ARCHER_SHOT"?(h="USE_SKILL",g="ARCHER_SHOT",m=c.intentPosition):x==="DASH"?(h="USE_SKILL",g="DASH",m=c.intentPosition):x==="GRAPPLE_HOOK"?(h="USE_SKILL",g="GRAPPLE_HOOK",m=c.intentPosition):x==="Bombing"?(h="USE_SKILL",g="BOMB_TOSS",m=c.intentPosition):x==="SENTINEL_BLAST"?(h="USE_SKILL",g="SENTINEL_BLAST",m=c.intentPosition):x==="SENTINEL_TELEGRAPH"?(h="USE_SKILL",g="SENTINEL_TELEGRAPH",m=c.intentPosition):(x==="Charging Power"||x==="Preparing")&&(h="WAIT",g="WAIT_SKILL");if(g==="ARCHER_SHOT"&&!a.activeSkills?.some(S=>S.id==="ARCHER_SHOT")&&a.activeSkills?.some(S=>S.id==="SPEAR_THROW")&&(g="SPEAR_THROW"),!(g==="WAIT_SKILL"||a.activeSkills?.some(S=>S.id===g)))h="WAIT",g="WAIT_SKILL",m=void 0,f=void 0;else if(g!=="WAIT_SKILL"){const S=Xt.get(g);S?.getValidTargets&&m&&(S.getValidTargets(n,a.position).some(_=>se(_,m))||(h="WAIT",g="WAIT_SKILL",m=void 0,f=void 0))}return{type:h,actorId:a.id,skillId:g,primaryTargetId:f,targetHex:m,priority:b,metadata:{expectedValue:0,reasoningCode:x.toUpperCase().replace(" ","_"),isGhost:!1,rngConsumption:(d?.includes("teleports")||d?.includes("Bombing"),(r.nextState.rngCounter||0)-(n.rngCounter||0))}}}}class Nd{inputQueue=[];resolveInput;pushIntent(n){this.inputQueue.push(n),this.resolveInput&&(this.resolveInput(n),this.resolveInput=void 0)}getIntent(n,a){return this.inputQueue.length>0?this.inputQueue.shift():new Promise(o=>{this.resolveInput=o})}}class Kd{static strategies=new Map;static defaultEnemyStrategy=new Oy;static defaultPlayerStrategy=new Nd;static register(n,a){this.strategies.set(n,a)}static resolve(n){return this.strategies.has(n.id)?this.strategies.get(n.id):n.type==="player"?this.defaultPlayerStrategy:this.defaultEnemyStrategy}static reset(){this.strategies.clear(),this.defaultEnemyStrategy=new Oy,this.defaultPlayerStrategy=new Nd}}const B1=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP"]),hd=(e,n)=>{const a=Kd.resolve(e.player);a instanceof Nd&&a.pushIntent(n)},yd={expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1},j1=(e,n,a)=>{if(B1.has(n.type)&&!Ho(e))return e;switch(n.type){case"SELECT_UPGRADE":return"payload"in n?b1(e,n.payload):e;case"USE_SKILL":{const{skillId:o,target:r}=n.payload;return hd(e,{type:"USE_SKILL",actorId:e.player.id,skillId:o,targetHex:r,priority:10,metadata:yd}),a.processNextTurn(e,!0)}case"MOVE":{if(!("payload"in n))return e;const o=n.payload,r=e.player.activeSkills||[],c=Wn(e.enemies,o),d=["BASIC_ATTACK","BASIC_MOVE","DASH"],h=r.filter(f=>f.slot==="passive"),g=[...h.filter(f=>d.includes(f.id)),...h.filter(f=>!d.includes(f.id))];let m;for(const f of g){const b=Xt.get(f.id);if(!b?.getValidTargets)continue;if(b.getValidTargets(e,e.player.position).some(T=>se(T,o))){m=f.id;break}}if(!m){const f=r.some(x=>x.id==="BASIC_ATTACK"),b=r.some(x=>x.id==="BASIC_MOVE");if(c&&f)m="BASIC_ATTACK";else if(!c&&b)m="BASIC_MOVE";else return{...e,message:xt(e.message,c?"No valid passive attack for target.":"No valid passive movement for target.","CRITICAL","SYSTEM")}}return hd(e,{type:c?"ATTACK":"MOVE",actorId:e.player.id,skillId:m,targetHex:o,primaryTargetId:c?.id,priority:10,metadata:yd}),a.processNextTurn(e,!0)}case"WAIT":return hd(e,{type:"WAIT",actorId:e.player.id,skillId:"WAIT",priority:10,metadata:yd}),a.processNextTurn(e,!0);case"APPLY_LOADOUT":{if(!("payload"in n))return e;const o=n.payload,r=Jg(o);return{...e,player:{...e.player,activeSkills:r.activeSkills,archetype:r.archetype},upgrades:r.upgrades,hasSpear:o.startingSkills.includes("SPEAR_THROW"),hasShield:o.startingSkills.includes("SHIELD_THROW")||e.hasShield,selectedLoadoutId:o.id,message:xt(e.message,`${o.name} selected.`,"INFO","SYSTEM")}}case"START_RUN":{const{loadoutId:o,seed:r,mode:c,date:d}=n.payload,h=Os[o];if(!h)return e;if(c==="daily"){const g=ZS(d),m=eA(g);return{...a.generateInitialState(1,r||m,void 0,void 0,h),dailyRunDate:g,runObjectives:tA(m),hazardBreaches:0}}return a.generateInitialState(1,r,void 0,void 0,h)}case"ADVANCE_TURN":return e.pendingStatus||(e.pendingFrames?.length??0)>0?(a.warnTurnStackInvariant("Ignored ADVANCE_TURN while pendingStatus is active.",{status:e.pendingStatus?.status,pendingFrames:e.pendingFrames?.length??0,turnNumber:e.turnNumber}),e):a.processNextTurn(e,!1);case"RESOLVE_PENDING":return x1(e,{generateInitialState:a.generateInitialState});case"EXIT_TO_HUB":return a.generateHubState();default:return e}},D1=(e,n,a,o)=>{let r=e;const c=[],d=a?e.enemies.filter(g=>g.id===a):e.enemies,h=[...r.enemies];return d.forEach(g=>{const m=r.enemies.find(f=>f.id===g.id);if(m){if(Ci(m)){const f=h.findIndex(b=>b.id===g.id);f!==-1&&(h[f]={...h[f],intent:void 0,intentPosition:void 0});return}if(m.intent&&m.intentPosition){let f=!1;const b=Xt.get(m.intent);let x=m.activeSkills?.find(T=>T.id===m.intent);if(!x&&m.intent==="ARCHER_SHOT"&&(x=m.activeSkills?.find(T=>T.id==="SPEAR_THROW")),b&&x){const S=(b.getValidTargets?b.getValidTargets(r,m.position):[]).some(_=>se(_,r.player.position));let A=m.intentPosition;if(S)A=r.player.position;else{const _=h.findIndex(E=>E.id===g.id);_!==-1&&(h[_]={...h[_],intent:void 0,intentPosition:void 0});return}const O=b.execute(r,m,A,x.activeUpgrades);r=Jn(r,O.effects,{sourceId:m.id,targetId:r.player.id,stepId:o}),c.push(...O.messages),f=!0}else if(m.subtype!=="bomber"){if(se(m.intentPosition,n)){r={...r,player:sa(r.player,1)};const T=`${m.subtype||"enemy"}#${m.id}`;c.push(`${T} hit you! (HP: ${r.player.hp}/${r.player.maxHp})`),f=!0}}if(f){const T=h.findIndex(S=>S.id===g.id);T!==-1&&(h[T]={...h[T],intent:void 0,intentPosition:void 0})}}}}),r={...r,enemies:h},{state:r,messages:c}},Zg=(e,n,a)=>Ci(a)?{...e,type:"WAIT",skillId:"WAIT_SKILL",priority:0,metadata:{...e.metadata,reasoningCode:"STATUS_STUNNED"}}:e;class e0{static execute(n,a,o){return this.resolveExecution(n,a,o)}static simulate(n,a,o){return this.resolveExecution(n,a,o)}static resolveExecution(n,a,o){const r=[],c=[],d=Xt.get(n.skillId);if(!d&&n.type!=="WAIT")return{effects:[],messages:[`Failed to execute unknown skill: ${n.skillId}`],consumesTurn:!1};if(n.type==="WAIT")return{effects:[],messages:[],consumesTurn:!0};if(!(n.skillId==="WAIT_SKILL"||a.activeSkills.some(A=>A.id===n.skillId)))return{effects:[],messages:[`Actor ${a.id} does not have skill ${n.skillId} in loadout!`],consumesTurn:!1};const g=a.activeSkills.find(A=>A.id===n.skillId),m=a.factionId==="player"&&Vd(o);if(!m&&g&&(g.currentCooldown||0)>0)return{effects:[],messages:[`${n.skillId} is on cooldown (${g.currentCooldown}).`],consumesTurn:a.type!=="player"};let f=n.targetHex,b=n.primaryTargetId;if(!f&&d&&(f=this.findOptimalTargetHex(n,a,o,d.baseVariables.range)),!f)return{effects:[],messages:[`No valid target found for ${n.skillId}`],consumesTurn:!1};if(f&&!b){const A=ye(o,f);A&&(b=A.id)}const x=g?.activeUpgrades||[],T=d.execute(o,a,f,x),S=[...r,...T.effects];if(T.consumesTurn!==!1&&!m){let O=d.baseVariables.cooldown||0;for(const _ of x){const E=d.upgrades?.[_];typeof E?.modifyCooldown=="number"&&(O+=E.modifyCooldown)}O=Math.max(0,O),O>0&&S.push({type:"ModifyCooldown",skillId:n.skillId,amount:O+1,setExact:!0})}return{effects:S,messages:[...c,...T.messages],consumesTurn:T.consumesTurn??!0,targetId:b,kills:T.kills||0}}static findOptimalTargetHex(n,a,o,r){if(n.primaryTargetId){const c=o.enemies.find(d=>d.id===n.primaryTargetId)||(o.player.id===n.primaryTargetId?o.player:void 0);if(c&&(n.type==="ATTACK"||n.type==="USE_SKILL"))return c.position}}}const Rd=(e,n)=>e.q!==n.q?e.q-n.q:e.r!==n.r?e.r-n.r:e.s-n.s,Ol=(e,n)=>e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n),P1=(e,n)=>{if(n.primaryTargetId)return Ol(e,n.primaryTargetId);if(n.targetHex)return ye(e,n.targetHex)},U1=(e,n,a)=>{const o=new Map,r=P1(e,n),c=d=>{d&&o.set(ue(d),d)};return a.forEach(d=>{d.type==="Damage"?typeof d.target=="string"&&d.target!=="targetActor"&&d.target!=="area"?c(Ol(e,d.target)?.position):d.target==="targetActor"?c(r?.position):d.target==="area"?c(d.source):typeof d.target=="object"&&"q"in d.target&&c(d.target):d.type==="Impact"||d.type==="LavaSink"?c(Ol(e,d.target)?.position):d.type==="Displacement"&&c(d.destination)}),[...o.values()].sort(Rd)},Cy=e=>{const n=[];e.enemies.filter(r=>r.hp>0&&r.factionId!==e.player.factionId).forEach(r=>{const d=Kd.resolve(r).getIntent(e,r);if(d instanceof Promise)return;const h=Zg(d,e,r);let g=h;h.skillId==="SENTINEL_TELEGRAPH"&&(g={...h,skillId:"SENTINEL_BLAST"});const m=e0.simulate(g,r,e),f=U1(e,g,m.effects);f.length!==0&&n.push({actorId:r.id,skillId:h.skillId,targetHex:h.targetHex,dangerTiles:f})}),n.sort((r,c)=>r.actorId!==c.actorId?r.actorId.localeCompare(c.actorId):r.skillId!==c.skillId?r.skillId.localeCompare(c.skillId):!r.targetHex&&!c.targetHex?0:r.targetHex?c.targetHex?Rd(r.targetHex,c.targetHex):1:-1);const o=new Map;return n.forEach(r=>r.dangerTiles.forEach(c=>o.set(ue(c),c))),{sourceTurn:e.turnNumber,dangerTiles:[...o.values()].sort(Rd),projections:n}},q1=e=>(a,o=!1)=>{if(a.pendingStatus||(a.pendingFrames?.length??0)>0)return e.warnTurnStackInvariant("Blocked processNextTurn while pendingStatus is active.",{status:a.pendingStatus?.status,pendingFrames:a.pendingFrames?.length??0,turnNumber:a.turnNumber}),a;let r=a;const c=[],d=[];let h=0;const g=100;let m=!1;for(;h<g;){if(h++,r.player.hp<=0&&r.pendingStatus?.status!=="lost"){const q=Lo(r);return e.withPendingFrame({...r,message:xt(r.message,"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:q},"RUN_LOST",{reason:"GLOBAL_DEATH_CHECK"})}r.occupancyMask=$e.refreshOccupancyMask(r);let b;if((o&&h===1||m)&&r.initiativeQueue){m=!1;const q=r.initiativeQueue;q.entries.length>0&&q.currentIndex>=0&&q.currentIndex<q.entries.length&&(b=q.entries[q.currentIndex].actorId)}else{const q=RA(r);r={...r,initiativeQueue:q.queue},b=q.actorId??void 0}if(!b)break;const x=b==="player"?r.player:r.enemies.find(q=>q.id===b),T=`${r.turnNumber}:${r.initiativeQueue?.round??0}:${b}:${h}`;if(!x||x.hp<=0){r={...r,initiativeQueue:fd(r.initiativeQueue,b)};continue}if(NA(r.initiativeQueue)?.turnStartPosition||(r={...r,initiativeQueue:IA(r,x)}),!o||h>1){const q=e.executeStatusWindow(r,b,"START_OF_TURN",T);if(r=q.state,c.push(...q.messages),b==="player"&&r.upgrades?.includes("RELIC_STEADY_PLATES")){const $=Math.min(2,(r.player.temporaryArmor||0)+1);$!==(r.player.temporaryArmor||0)&&(r={...r,player:{...r.player,temporaryArmor:$}},c.push(xt([],"Steady Plates harden your stance.","INFO","COMBAT")[0]))}if(b==="player"){const $=r.player.activeSkills?.find(le=>le.id==="SHIELD_BASH");if(!!$?.activeUpgrades?.includes("PASSIVE_PROTECTION")&&($?.currentCooldown||0)===0){const le=Math.max(r.player.temporaryArmor||0,1);le!==(r.player.temporaryArmor||0)&&(r={...r,player:{...r.player,temporaryArmor:le}},c.push(xt([],"Passive Protection braces your guard.","INFO","COMBAT")[0]))}}const B=D1(r,r.player.position,b,T);r=B.state,c.push(...B.messages)}const A=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!A||A.hp<=0){r={...r,initiativeQueue:fd(r.initiativeQueue,b),message:oi(r.message,c,"INFO","SYSTEM")};continue}const O=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!O||O.hp<=0)continue;let _,E=!1;if(Ci(O))E=!0,_={type:"WAIT",actorId:O.id,skillId:"WAIT_SKILL",priority:0,metadata:{expectedValue:0,reasoningCode:"STATUS_STUNNED_AUTOSKIP",isGhost:!1}},b==="player"?c.push("You are stunned and skip your turn."):c.push(`${O.subtype||"Enemy"} is stunned and skips its turn.`);else{const B=Kd.resolve(O).getIntent(r,O);if(B instanceof Promise){const $=Cy(r);return{...r,intentPreview:$,message:oi(r.message,c,"INFO","SYSTEM"),dyingEntities:[...r.dyingEntities||[],...d]}}_=B}const w=A.activeSkills.map(q=>q.id).join(", ");e.engineDebug&&(console.log(`[ENGINE] Actor: ${b} | Loadout: [${w}] | Pos: ${JSON.stringify(A.position)}`),console.log(`[ENGINE] Intent: ${_.type} | Skill: ${_.skillId} | TargetHex: ${_.targetHex?JSON.stringify(_.targetHex):"none"} | TargetId: ${_.primaryTargetId||"none"}`)),_.metadata.rngConsumption&&(r={...r,rngCounter:(r.rngCounter||0)+_.metadata.rngConsumption}),_=Zg(_,r,O);const{effects:C,messages:I,consumesTurn:N,targetId:H,kills:D}=e0.execute(_,O,r);if(e.engineDebug&&console.log(`[ENGINE] ${b} intends ${_.type} (${_.skillId}) onto ${H||(_.targetHex?JSON.stringify(_.targetHex):"self")}`),e.engineWarn&&C.length===0&&_.type!=="WAIT"){const q=`[ENGINE] WARNING: Intent ${_.type} (${_.skillId}) for actor ${b} produced ZERO effects!`;console.warn(q)}const G=r,P=Jn(r,C,{sourceId:b,targetId:H,stepId:T});if(b==="player"&&(P.kills=(P.kills||0)+(D||0)),N===!1){r={...G,message:oi(r.message,I,"INFO","COMBAT")},m=!0;continue}if(r=P,c.push(...I),b!=="player"){const q=r.enemies.find(B=>B.id===b);if(q?.subtype==="bomber"){const B=_.skillId==="BOMB_TOSS"?2:Math.max(0,(q.actionCooldown??0)-1);q.actionCooldown!==B&&(r={...r,enemies:r.enemies.map($=>$.id===b?{...$,actionCooldown:B}:$)})}}const Y=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!Y||Y.hp<=0){if(b==="player"){const q=Lo(r);return e.withPendingFrame({...r,message:xt(oi(r.message,c,"INFO","SYSTEM"),"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:q},"RUN_LOST",{reason:"SELF_ACTION_DEATH"})}r={...r,enemies:r.enemies.filter(q=>q.id!==b),initiativeQueue:fd(r.initiativeQueue,b),message:oi(r.message,c,"INFO","SYSTEM")};continue}const F=e.executeStatusWindow(r,b,"END_OF_TURN",T);r=F.state,c.push(...F.messages),r={...r,enemies:r.enemies.map(q=>q.id===b?cy(gy(q)):q),player:b==="player"?cy(gy(r.player)):r.player,initiativeQueue:LA(r,b)};const Z=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!(E||_.metadata?.reasoningCode==="STATUS_STUNNED"||_.metadata?.reasoningCode==="STATUS_STUNNED_AUTOSKIP")&&Z&&Z.hp>0){const q=HA(r,b)||Z.previousPosition||Z.position,B=BA(r,b)??void 0,$=ZA(r,Z,Xe(q),q,B,T);r=$.state,c.push(...$.messages),b==="player"&&(r.kills=(r.kills||0)+$.kills)}if(b==="player"){const q=e.applyPlayerEndOfTurnRules(r,T,{withPendingFrame:e.withPendingFrame});if(r=q.state,q.haltTurnLoop)return r;c.push(...q.messages)}}const f=Cy(r);return{...r,intentPreview:f,message:oi(r.message,c,"INFO","SYSTEM"),dyingEntities:[...r.dyingEntities||[],...d]}};var t0={};const n0=typeof process<"u"&&t0?.HOP_ENGINE_DEBUG==="1",i0=typeof process<"u"&&t0?.HOP_ENGINE_WARN==="1",$1=n0||i0,a0=(e,n)=>{if($1){if(n){console.warn(`[TURN_STACK] ${e}`,n);return}console.warn(`[TURN_STACK] ${e}`)}},Rl=()=>{const e=Ba();return{...e,gameStatus:"hub",message:[xt([],"Welcome to the Strategic Hub. Select your loadout.","INFO","SYSTEM")[0]],player:{...e.player,activeSkills:[]},hasSpear:!1,hasShield:!1}},Ba=(e=1,n,a,o,r)=>{Hg();const c=n||String(Date.now()),d=lS(e),h=oS(e,c),g=rS(e,h.spawnPositions||[],c),m=o?{hp:o.hp,maxHp:o.maxHp,speed:o.speed||ty.speed}:{speed:ty.speed},f=o?.upgrades||(r?r.startingUpgrades:[]),b=r?Jg(r):{activeSkills:r1(),archetype:"VANGUARD"},x=Qg(o?.activeSkills||b.activeSkills),T=o?.archetype||b.archetype,S=h.tiles||new Map,O={turnNumber:1,player:{...ra({id:"player",type:"player",position:h.playerSpawn,hp:m.hp,maxHp:m.maxHp,speed:m.speed,factionId:"player",activeSkills:x,archetype:T,weightClass:"Standard",components:new Map}),previousPosition:h.playerSpawn},enemies:g.map(_=>({..._,previousPosition:_.position,statusEffects:_.statusEffects||[],temporaryArmor:_.temporaryArmor||0})),gridWidth:_l,gridHeight:wl,gameStatus:"playing",message:e===1?[xt([],"Welcome to the arena. Survive.","INFO","SYSTEM")[0]]:xt(o?.message||[],`Floor ${e} - ${d.charAt(0).toUpperCase()+d.slice(1)}. Be careful.`,"INFO","OBJECTIVE"),hasSpear:!0,stairsPosition:h.stairsPosition,occupancyMask:[0n],shrinePosition:h.shrinePosition,shrineOptions:void 0,hasShield:!0,floor:e,upgrades:f,rooms:h.rooms,theme:d,commandLog:[],undoStack:[],rngSeed:c,initialSeed:a??(e===1?c:void 0),rngCounter:0,actionLog:[],kills:o&&o.kills||0,environmentalKills:o&&o.environmentalKills||0,turnsSpent:o&&o.turnsSpent||0,dailyRunDate:o?.dailyRunDate,runObjectives:o?.runObjectives||[],hazardBreaches:o?.hazardBreaches||0,completedRun:void 0,combatScoreEvents:o?.combatScoreEvents||[],dyingEntities:[],visualEvents:[],timelineEvents:[],intentPreview:void 0,initiativeQueue:void 0,tiles:S};return O.initiativeQueue=Ha(O),O.occupancyMask=$e.refreshOccupancyMask(O),O},z1=(e,n,a,o)=>{const r=n==="player"?e.player:e.enemies.find(g=>g.id===n);if(!r)return{state:e,messages:[]};const c=[],d=[];return r.statusEffects.forEach(g=>{if(g.tickWindow===a&&g.onTick){const m=g.onTick(r,e);m&&c.push(...m)}}),{state:Jn(e,c,{sourceId:n,stepId:o}),messages:d}},V1=q1({executeStatusWindow:z1,withPendingFrame:h1,applyPlayerEndOfTurnRules:v1,warnTurnStackInvariant:a0,engineDebug:n0,engineWarn:i0}),Y1=(e,n)=>{const a=Yd(e.player),o=a===e.player?e:{...e,player:a};if(o.gameStatus!=="playing"&&n.type!=="RESET"&&n.type!=="SELECT_UPGRADE"&&n.type!=="LOAD_STATE"&&n.type!=="APPLY_LOADOUT"&&n.type!=="START_RUN"&&n.type!=="EXIT_TO_HUB")return o;const r={...o,isShaking:!1,lastSpearPath:void 0,dyingEntities:[],occupiedCurrentTurn:void 0,visualEvents:[],timelineEvents:[]};switch(n.type){case"LOAD_STATE":return g1(n.payload);case"RESET":{const x=e.player.archetype==="SKIRMISHER"?"SKIRMISHER":"VANGUARD",T=Os[x];return Ba(1,n.payload?.seed||String(Date.now()),void 0,void 0,T)}case"EXIT_TO_HUB":return Rl()}if(o.gameStatus!=="playing"&&n.type!=="SELECT_UPGRADE"&&n.type!=="APPLY_LOADOUT"&&n.type!=="START_RUN")return o;const c=d1(n,o),d=o;let h={...r,initiativeQueue:r.initiativeQueue};const m=((b,x)=>j1(b,x,{processNextTurn:V1,generateInitialState:Ba,generateHubState:Rl,warnTurnStackInvariant:a0}))(h,n),f=f1(d,m,e);return c.delta=f,{...m,commandLog:[...m.commandLog||[],c],undoStack:[...m.undoStack||[],f],actionLog:[...m.actionLog||[],n]}},ky={skill:{staticWeight:.5,powerCoeff:1,reachCoeff:1,safetyCoeff:1,tempoCoeff:1,complexityCoeff:1,perSkillScalar:{}},policy:{offenseWeight:1,defenseWeight:1,positioningWeight:1,statusWeight:1,riskPenaltyWeight:1}};({...ky.policy},{...ky.skill});const K1=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP","ADVANCE_TURN","SELECT_UPGRADE","RESOLVE_PENDING"]),F1=e=>typeof e=="object"&&e!==null,s0=e=>{if(!Array.isArray(e))return{valid:!1,actions:[],errors:["Replay actions must be an array."]};const n=[],a=[];return e.forEach((o,r)=>{if(!F1(o)||typeof o.type!="string"){a.push(`Action[${r}] is not a valid action object with a "type" field.`);return}if(!K1.has(o.type)){a.push(`Action[${r}] type "${o.type}" is not replayable.`);return}n.push(o)}),{valid:a.length===0,actions:n,errors:a}},Oa=e=>({q:e.q,r:e.r,s:e.s}),X1=e=>{if(e){if(e instanceof Map)return new Map(Array.from(e.entries()).map(([n,a])=>[n,typeof a=="object"&&a!==null?{...a}:a]));if(Array.isArray(e))return new Map(e);if(typeof e=="object")return new Map(Object.entries(e).map(([n,a])=>[n,typeof a=="object"&&a!==null?{...a}:a]))}},al=e=>({...e,position:Oa(e.position),previousPosition:e.previousPosition?Oa(e.previousPosition):void 0,intentPosition:e.intentPosition?Oa(e.intentPosition):void 0,statusEffects:e.statusEffects.map(n=>({...n})),activeSkills:e.activeSkills.map(n=>({...n,upgrades:[...n.upgrades||[]],activeUpgrades:[...n.activeUpgrades||[]]})),components:X1(e.components),companionState:e.companionState?{...e.companionState,markTarget:typeof e.companionState.markTarget=="object"&&e.companionState.markTarget?Oa(e.companionState.markTarget):e.companionState.markTarget}:void 0}),W1=e=>({...e,player:al(e.player),enemies:e.enemies.map(al),companions:e.companions?.map(al),dyingEntities:e.dyingEntities?.map(al),message:[...e.message],visualEvents:[...e.visualEvents||[]],simulationEvents:[...e.simulationEvents||[]],stackTrace:e.stackTrace?e.stackTrace.map(n=>({...n})):void 0,timelineEvents:e.timelineEvents?e.timelineEvents.map(n=>({...n})):void 0,occupancyMask:[...e.occupancyMask],tiles:new Map(Array.from(e.tiles.entries()).map(([n,a])=>[n,{...a,position:Oa(a.position),traits:new Set(a.traits),effects:a.effects.map(o=>({...o}))}])),traps:e.traps?.map(n=>({...n,position:Oa(n.position)})),lastSpearPath:e.lastSpearPath?.map(Oa),actionLog:e.actionLog?[...e.actionLog]:void 0}),Ny=(e,n)=>e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n),G1=(e,n)=>{if(n)return ye(e,n)?.id},J1=(e,n)=>{const a=Ny(e,n.actorId);if(!a)return{ok:!1,reason:`Actor ${n.actorId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const o=Xt.get(n.skillId);if(!o)return{ok:!1,reason:`Skill ${n.skillId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};if(n.target&&o.getValidTargets&&!o.getValidTargets(e,a.position).some(x=>ue(x)===ue(n.target)))return{ok:!1,reason:`Target ${ue(n.target)} is invalid`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const r=W1(e),c=Ny(r,n.actorId),d=o.execute(r,c,n.target,n.activeUpgrades||[],n.context||{}),h=r.simulationEvents?.length||0,g=r.stackTrace?.length||0,m=G1(r,n.target),f=Jn(r,d.effects,{sourceId:c.id,targetId:m});return{ok:!0,effects:d.effects,messages:d.messages,consumesTurn:d.consumesTurn,predictedState:f,simulationEvents:(f.simulationEvents||[]).slice(h),stackTrace:(f.stackTrace||[]).slice(g)}},Q1=e=>({q:e.q,r:e.r,s:e.s}),Z1=e=>{const n=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]];return{turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:n.map(a=>({id:a.id,position:Q1(a.position)}))}},eE=(e,n)=>{const a=[],o=new Map(e.actors.map(c=>[c.id,c.position])),r=new Map(n.actors.map(c=>[c.id,c.position]));for(const[c,d]of o.entries()){const h=r.get(c);if(!h){a.push({actorId:c,expected:d,reason:"missing_in_ui"});continue}ue(d)!==ue(h)&&a.push({actorId:c,expected:d,actual:h,reason:"position_mismatch"})}for(const[c,d]of r.entries())o.has(c)||a.push({actorId:c,actual:d,reason:"missing_in_engine"});return{ok:a.length===0,mismatches:a}},wo={player:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},vanguard:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},skirmisher:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#fbbf24",isRanged:!1},firemage:{icon:"",shape:"square",color:"#ef4444",borderColor:"#fbbf24",isRanged:!0},necromancer:{icon:"",shape:"square",color:"#6b21a8",borderColor:"#9333ea",isRanged:!0},hunter:{icon:"",shape:"square",color:"#10b981",borderColor:"#ffffff",isRanged:!0},assassin_player:{icon:"",shape:"square",color:"#1f2937",borderColor:"#ffffff",isRanged:!1},footman:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1},sprinter:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1,size:.9},spear:{icon:"",shape:"circle",color:"#ffffff",borderColor:"#3b82f6",isRanged:!1,size:.8,opacity:.9},shieldBearer:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#fbbf24",isRanged:!1,showFacing:!0},golem:{icon:"",shape:"diamond",color:"#78716c",borderColor:"#ffffff",isRanged:!1,size:1.2},assassin:{icon:"",shape:"diamond",color:"#6b21a8",borderColor:"#ffffff",isRanged:!1},archer:{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},bomber:{icon:"",shape:"circle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},warlock:{icon:"",shape:"triangle",color:"#9333ea",borderColor:"#ffffff",isRanged:!0},bomb:{icon:"",shape:"circle",color:"#1f2937",borderColor:"#000000",isRanged:!1,showTimer:!0},falcon:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},skeleton:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},sentinel:{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!0,size:1.5}};function Bo(e,n,a,o){if(e&&wo[e])return wo[e];if(n==="player"&&o){const r=o==="ASSASSIN"?"assassin_player":o.toLowerCase();if(wo[r])return wo[r]}return n==="player"?wo.player:a==="ranged"?{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0}:a==="boss"?{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!1,size:1.5}:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1}}function tE(e){return e.isFlying===!0}const nE=["catacombs","inferno","throne","frozen","void"],sl=["off","repeat","cover"],Ry=64,Iy=192,ol=64,rl=512,iE=["normal","multiply","overlay","soft-light","screen","color-dodge"],Ly=["off","multiply","overlay","soft-light","screen","color-dodge","normal"],aE=["#8b6f4a","#8f4a2e","#5b6d41","#536e8e","#5f5977","#b79a73","#d15a3a","#3e4f3a"],sE=["native","additive","custom"],an=(e,n,a)=>Math.min(a,Math.max(n,e)),at=(e,n)=>{const a=Number(e);return Number.isFinite(a)?a:n},Hy=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,d,h]=a.slice(1).split("");return`#${c}${c}${d}${d}${h}${h}`.toLowerCase()}return n},o0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",By=e=>e==="off"?"off":o0(e),oE=({settings:e,setSettings:n,pathSets:a,copyStatus:o,onBack:r,onReset:c,onCopySettings:d,tintPickerColor:h,mountainTintPickerColor:g})=>y.jsxs("aside",{className:"w-[420px] border-r border-white/10 bg-[#02040a] overflow-y-auto",children:[y.jsxs("div",{className:"sticky top-0 z-20 border-b border-white/10 bg-[#02040a]/95 backdrop-blur p-4",children:[y.jsxs("div",{className:"flex items-center justify-between gap-3",children:[y.jsx("button",{type:"button",onClick:r,className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-[11px] font-black uppercase tracking-[0.18em]",children:"Back"}),y.jsx("button",{type:"button",onClick:c,className:"px-3 py-2 rounded-lg border border-amber-300/40 bg-amber-500/10 hover:bg-amber-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Reset"}),y.jsx("button",{type:"button",onClick:d,className:"px-3 py-2 rounded-lg border border-cyan-300/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Copy JSON"})]}),y.jsxs("div",{className:"mt-3 text-[10px] uppercase tracking-[0.22em] text-white/50",children:["Hop / Biomes ",o?`* ${o}`:""]})]}),y.jsxs("div",{className:"p-4 space-y-6",children:[y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/75",children:"Preview"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Theme"}),y.jsx("select",{value:e.theme,onChange:m=>n(f=>f&&{...f,theme:m.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:nE.map(m=>y.jsx("option",{value:m,children:m},m))}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed"}),y.jsx("input",{value:e.seed,onChange:m=>n(f=>f&&{...f,seed:m.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),y.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[y.jsx("input",{type:"checkbox",checked:e.injectHazards,onChange:m=>n(f=>f&&{...f,injectHazards:m.target.checked})}),"Inject synthetic lava/fire patches for mask testing"]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-cyan-200",children:"Undercurrent"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),y.jsx("input",{list:"sandbox-undercurrent-paths",value:e.undercurrent.path,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,path:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsx("datalist",{id:"sandbox-undercurrent-paths",children:a.undercurrent.map(m=>y.jsx("option",{value:m},m))}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),y.jsx("select",{value:e.undercurrent.mode,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:sl.map(m=>y.jsx("option",{value:m,children:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),y.jsx("input",{type:"number",min:Ry,max:Iy,step:16,value:e.undercurrent.scalePx,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scalePx:an(at(m.target.value,f.undercurrent.scalePx),Ry,Iy)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.undercurrent.opacity,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,opacity:an(at(m.target.value,f.undercurrent.opacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll X"}),y.jsx("input",{type:"number",step:5,value:e.undercurrent.scrollX,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scrollX:at(m.target.value,f.undercurrent.scrollX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll Y"}),y.jsx("input",{type:"number",step:5,value:e.undercurrent.scrollY,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scrollY:at(m.target.value,f.undercurrent.scrollY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Duration"}),y.jsx("input",{type:"number",min:1e3,step:500,value:e.undercurrent.scrollDurationMs,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scrollDurationMs:Math.max(1e3,at(m.target.value,f.undercurrent.scrollDurationMs))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),y.jsx("input",{type:"number",step:4,value:e.undercurrent.offsetX,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,offsetX:at(m.target.value,f.undercurrent.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),y.jsx("input",{type:"number",step:4,value:e.undercurrent.offsetY,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,offsetY:at(m.target.value,f.undercurrent.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-amber-200",children:"Crust"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),y.jsx("input",{list:"sandbox-crust-paths",value:e.crust.path,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,path:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsx("datalist",{id:"sandbox-crust-paths",children:a.crust.map(m=>y.jsx("option",{value:m},m))}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),y.jsx("select",{value:e.crust.mode,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:sl.map(m=>y.jsx("option",{value:m,children:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),y.jsx("input",{type:"number",min:64,step:16,value:e.crust.scalePx,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,scalePx:Math.max(64,at(m.target.value,f.crust.scalePx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),y.jsx("input",{type:"number",min:1,max:1,step:.01,value:1,onChange:()=>n(m=>m&&{...m,crust:{...m.crust,opacity:1}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed Shift Budget"}),y.jsx("input",{type:"number",min:0,step:8,value:e.crust.seedShiftPx,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,seedShiftPx:Math.max(0,at(m.target.value,f.crust.seedShiftPx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),y.jsx("input",{type:"number",step:4,value:e.crust.offsetX,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,offsetX:at(m.target.value,f.crust.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),y.jsx("input",{type:"number",step:4,value:e.crust.offsetY,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,offsetY:at(m.target.value,f.crust.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-rose-200",children:"Walls / Mountains"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mountain Asset"}),y.jsx("input",{list:"sandbox-mountain-paths",value:e.walls.mountainPath,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainPath:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs",placeholder:"/assets/biomes/biome.volcano.mountain.01.webp"}),y.jsx("datalist",{id:"sandbox-mountain-paths",children:a.mountain.map(m=>y.jsx("option",{value:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale"}),y.jsx("input",{type:"number",min:.2,max:3,step:.01,value:e.walls.mountainScale,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainScale:an(at(m.target.value,f.walls.mountainScale),.2,3)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor X"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainAnchorX,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainAnchorX:an(at(m.target.value,f.walls.mountainAnchorX),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),y.jsx("input",{type:"number",step:2,value:e.walls.mountainOffsetX,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainOffsetX:at(m.target.value,f.walls.mountainOffsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),y.jsx("input",{type:"number",step:2,value:e.walls.mountainOffsetY,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainOffsetY:at(m.target.value,f.walls.mountainOffsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor Y"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainAnchorY,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainAnchorY:an(at(m.target.value,f.walls.mountainAnchorY),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Crust Blend"}),y.jsx("select",{value:e.walls.mountainCrustBlendMode,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainCrustBlendMode:By(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Ly.map(m=>y.jsx("option",{value:m,children:m},`mountain-blend-${m}`))})]}),y.jsxs("div",{children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Blend Opacity ",e.walls.mountainCrustBlendOpacity.toFixed(2)]}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainCrustBlendOpacity,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainCrustBlendOpacity:an(at(m.target.value,f.walls.mountainCrustBlendOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Mountain Tint"}),y.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[y.jsx("input",{type:"color",value:g,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintColor:m.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Mountain Tint Color Picker"}),y.jsx("input",{value:e.walls.mountainTintColor,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintColor:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Tint Blend"}),y.jsx("select",{value:e.walls.mountainTintBlendMode,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintBlendMode:By(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Ly.map(m=>y.jsx("option",{value:m,children:m},`mountain-tint-blend-${m}`))})]}),y.jsxs("div",{children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",e.walls.mountainTintOpacity.toFixed(2)]}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainTintOpacity,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintOpacity:an(at(m.target.value,f.walls.mountainTintOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Wall Layout Mode"}),y.jsx("select",{value:e.walls.mode,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:sE.map(m=>y.jsx("option",{value:m,children:m},`wall-mode-${m}`))}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Interior Density ",e.walls.interiorDensity.toFixed(2)]}),y.jsx("input",{type:"range",min:0,max:.45,step:.01,value:e.walls.interiorDensity,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,interiorDensity:an(at(m.target.value,f.walls.interiorDensity),0,.45)}}),className:"w-full"})]}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Cluster Bias ",e.walls.clusterBias.toFixed(2)]}),y.jsx("input",{type:"range",min:0,max:1,step:.01,value:e.walls.clusterBias,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,clusterBias:an(at(m.target.value,f.walls.clusterBias),0,1)}}),className:"w-full"})]}),y.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[y.jsx("input",{type:"checkbox",checked:e.walls.keepPerimeter,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,keepPerimeter:m.target.checked}})}),"Keep perimeter walls (custom mode)"]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-fuchsia-200",children:"Crust Materials"}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Detail A"}),y.jsx("input",{list:"sandbox-detail-paths",value:e.materials.detailA.path,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,path:m.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsx("datalist",{id:"sandbox-detail-paths",children:a.detail.map(m=>y.jsx("option",{value:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsx("select",{value:e.materials.detailA.mode,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,mode:m.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:sl.map(m=>y.jsx("option",{value:m,children:m},`detail-a-${m}`))}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.materials.detailA.opacity,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,opacity:an(at(m.target.value,f.materials.detailA.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsx("input",{type:"number",min:ol,max:rl,step:16,value:e.materials.detailA.scalePx,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,scalePx:an(at(m.target.value,f.materials.detailA.scalePx),ol,rl)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Detail B"}),y.jsx("input",{list:"sandbox-detail-paths",value:e.materials.detailB.path,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,path:m.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsx("select",{value:e.materials.detailB.mode,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,mode:m.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:sl.map(m=>y.jsx("option",{value:m,children:m},`detail-b-${m}`))}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.materials.detailB.opacity,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,opacity:an(at(m.target.value,f.materials.detailB.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsx("input",{type:"number",min:ol,max:rl,step:16,value:e.materials.detailB.scalePx,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,scalePx:an(at(m.target.value,f.materials.detailB.scalePx),ol,rl)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Tint"}),y.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[y.jsx("input",{type:"color",value:h,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintColor:m.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Tint Color Picker"}),y.jsx("input",{value:e.materials.tintColor,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintColor:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),y.jsx("div",{className:"grid grid-cols-8 gap-2",children:aE.map(m=>y.jsx("button",{type:"button",onClick:()=>n(f=>f&&{...f,materials:{...f.materials,tintColor:m}}),className:`h-6 rounded border ${Hy(e.materials.tintColor)===Hy(m)?"border-white":"border-white/20"}`,style:{backgroundColor:m},title:m},`tint-swatch-${m}`))}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",e.materials.tintOpacity.toFixed(2)]}),y.jsx("input",{type:"range",min:0,max:1,step:.01,value:e.materials.tintOpacity,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintOpacity:an(at(m.target.value,f.materials.tintOpacity),0,1)}}),className:"w-full"})]}),y.jsx("select",{value:e.materials.tintBlend,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintBlend:o0(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:iE.map(m=>y.jsx("option",{value:m,children:m},`blend-${m}`))})]}),y.jsxs("section",{className:"space-y-3 pb-8",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-emerald-200",children:"Clutter"}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Density"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.clutter.density,onChange:m=>n(f=>f&&{...f,clutter:{...f.clutter,density:an(at(m.target.value,f.clutter.density),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Max / Hex"}),y.jsx("input",{type:"number",min:0,max:5,step:1,value:e.clutter.maxPerHex,onChange:m=>n(f=>f&&{...f,clutter:{...f.clutter,maxPerHex:Math.max(0,Math.floor(at(m.target.value,f.clutter.maxPerHex)))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Bleed Max"}),y.jsx("input",{type:"number",min:1,max:2,step:.01,value:e.clutter.bleedScaleMax,onChange:m=>n(f=>f&&{...f,clutter:{...f.clutter,bleedScaleMax:an(at(m.target.value,f.clutter.bleedScaleMax),1,2)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]})]})]}),Id="/Hop",r0=/^[a-z0-9]+(?:[._-][a-z0-9]+)*$/,jo=/^\/assets\/[a-z0-9/_\-.]+$/,Fd=["ground","decal","prop","unit","fx","ui"],rE=["svg","webp","avif","png","jpg","jpeg"],jy=["svg","webp","avif","png"],Dy=["svg","webp","avif","png","jpg","jpeg"],Py=["svg","webp","avif","png"],Uy=["svg"],Ld=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,lE=Ld(Id,"assets/manifest.json"),Ra=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?Ld(Id,e.slice(1)):e:Ld(Id,e),Ms=e=>{if(e)return{...e,default:Ra(e.default),themes:Object.fromEntries(Object.entries(e.themes||{}).map(([n,a])=>[n,Ra(a)]))}},qy=e=>{if(e)return{...e,scale:e.scale??e.mountainScale,offsetX:e.offsetX??e.mountainOffsetX,offsetY:e.offsetY??e.mountainOffsetY,anchorX:e.anchorX??e.mountainAnchorX,anchorY:e.anchorY??e.mountainAnchorY,crustBlendMode:e.crustBlendMode??e.mountainCrustBlendMode,crustBlendOpacity:e.crustBlendOpacity??e.mountainCrustBlendOpacity,tintColor:e.tintColor??e.mountainTintColor,tintBlendMode:e.tintBlendMode??e.mountainTintBlendMode,tintOpacity:e.tintOpacity??e.mountainTintOpacity}},cE=e=>{if(e)return{...e,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([n,a])=>[n,String(a)]))}},Il=e=>{if(e)return{detailA:Ms(e.detailA),detailB:Ms(e.detailB),tint:cE(e.tint)}},Hd=e=>{if(e)return{...e}},l0=e=>{if(!e)return;const n=qy(e);return{...n,mountainPath:n?.mountainPath?Ra(n.mountainPath):n?.mountainPath,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([a,o])=>[a,{...qy(o),mountainPath:o?.mountainPath?Ra(o.mountainPath):o?.mountainPath}]))}},uE=e=>{if(e)return{...e,biomeLayers:e.biomeLayers?{undercurrent:Ms(e.biomeLayers.undercurrent),crust:Ms(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:Il(e.biomeMaterials.undercurrent),crust:Il(e.biomeMaterials.crust)}:void 0,walls:l0(e.walls),assetOverrides:Object.fromEntries(Object.entries(e.assetOverrides||{}).map(([n,a])=>[n,{...a,mountainSettings:Hd(a?.mountainSettings)}]))}},dE=e=>({...e,biomeUnderlay:e.biomeUnderlay?{...e.biomeUnderlay,default:Ra(e.biomeUnderlay.default),themes:Object.fromEntries(Object.entries(e.biomeUnderlay.themes||{}).map(([n,a])=>[n,Ra(a)]))}:void 0,biomeLayers:e.biomeLayers?{undercurrent:Ms(e.biomeLayers.undercurrent),crust:Ms(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:Il(e.biomeMaterials.undercurrent),crust:Il(e.biomeMaterials.crust)}:void 0,walls:l0(e.walls),biomePresets:Object.fromEntries(Object.entries(e.biomePresets||{}).map(([n,a])=>[n,uE(a)||{}])),assets:e.assets.map(n=>({...n,path:Ra(n.path),mountainSettings:Hd(n.mountainSettings),mountainSettingsByTheme:Object.fromEntries(Object.entries(n.mountainSettingsByTheme||{}).map(([a,o])=>[a,Hd(o)||{}]))}))}),$y={version:"1.0.0",gridTopology:"flat-top-hex",tileUnitPx:256,tileAspectRatio:1.154700538,layers:[...Fd],assets:[]};let ll=null;const zy=e=>typeof e=="string"&&Fd.includes(e),Vy=e=>typeof e=="string"&&["tile","decal","prop","unit","fx","ui"].includes(e),Yy=e=>typeof e=="string"&&rE.includes(e),Ia=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if((typeof e.default!="string"||!jo.test(e.default))&&a.push(`"${n}.default" must be a /assets/... path.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${n}.themes" must be an object when provided.`);else for(const[o,r]of Object.entries(e.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${n}.themes" contains an invalid theme key.`),(typeof r!="string"||!jo.test(r))&&a.push(`"${n}.themes.${o}" must be a /assets/... path.`);if(e.mode!==void 0&&e.mode!=="off"&&e.mode!=="cover"&&e.mode!=="repeat"&&a.push(`"${n}.mode" must be one of "off", "cover", or "repeat".`),e.scalePx!==void 0&&(!Number.isFinite(e.scalePx)||Number(e.scalePx)<=0)&&a.push(`"${n}.scalePx" must be > 0 when provided.`),e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&a.push(`"${n}.opacity" must be in [0, 1] when provided.`),e.seedShiftPx!==void 0&&(!Number.isFinite(e.seedShiftPx)||Number(e.seedShiftPx)<0)&&a.push(`"${n}.seedShiftPx" must be >= 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&a.push(`"${n}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&a.push(`"${n}.offsetY" must be a finite number when provided.`),e.scroll!==void 0){const o=e.scroll;!o||typeof o!="object"?a.push(`"${n}.scroll" must be an object when provided.`):(o.x!==void 0&&!Number.isFinite(o.x)&&a.push(`"${n}.scroll.x" must be a finite number.`),o.y!==void 0&&!Number.isFinite(o.y)&&a.push(`"${n}.scroll.y" must be a finite number.`),o.durationMs!==void 0&&(!Number.isFinite(o.durationMs)||Number(o.durationMs)<=0)&&a.push(`"${n}.scroll.durationMs" must be > 0 when provided.`))}},fE=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if((typeof e.default!="string"||e.default.trim().length===0)&&a.push(`"${n}.default" must be a non-empty color string.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${n}.themes" must be an object when provided.`);else for(const[o,r]of Object.entries(e.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${n}.themes" contains an invalid theme key.`),(typeof r!="string"||r.trim().length===0)&&a.push(`"${n}.themes.${o}" must be a non-empty color string.`);e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&a.push(`"${n}.opacity" must be in [0, 1] when provided.`),e.blendMode!==void 0&&e.blendMode!=="normal"&&e.blendMode!=="multiply"&&e.blendMode!=="overlay"&&e.blendMode!=="soft-light"&&e.blendMode!=="screen"&&e.blendMode!=="color-dodge"&&a.push(`"${n}.blendMode" must be one of "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`)},Do=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}e.scale!==void 0&&(!Number.isFinite(e.scale)||Number(e.scale)<=0)&&a.push(`"${n}.scale" must be > 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&a.push(`"${n}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&a.push(`"${n}.offsetY" must be a finite number when provided.`),e.anchorX!==void 0&&(!Number.isFinite(e.anchorX)||Number(e.anchorX)<0||Number(e.anchorX)>1)&&a.push(`"${n}.anchorX" must be in [0, 1] when provided.`),e.anchorY!==void 0&&(!Number.isFinite(e.anchorY)||Number(e.anchorY)<0||Number(e.anchorY)>1)&&a.push(`"${n}.anchorY" must be in [0, 1] when provided.`),e.crustBlendMode!==void 0&&e.crustBlendMode!=="off"&&e.crustBlendMode!=="normal"&&e.crustBlendMode!=="multiply"&&e.crustBlendMode!=="overlay"&&e.crustBlendMode!=="soft-light"&&e.crustBlendMode!=="screen"&&e.crustBlendMode!=="color-dodge"&&a.push(`"${n}.crustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.tintBlendMode!==void 0&&e.tintBlendMode!=="off"&&e.tintBlendMode!=="normal"&&e.tintBlendMode!=="multiply"&&e.tintBlendMode!=="overlay"&&e.tintBlendMode!=="soft-light"&&e.tintBlendMode!=="screen"&&e.tintBlendMode!=="color-dodge"&&a.push(`"${n}.tintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.crustBlendOpacity!==void 0&&(!Number.isFinite(e.crustBlendOpacity)||Number(e.crustBlendOpacity)<0||Number(e.crustBlendOpacity)>1)&&a.push(`"${n}.crustBlendOpacity" must be in [0, 1] when provided.`),e.tintOpacity!==void 0&&(!Number.isFinite(e.tintOpacity)||Number(e.tintOpacity)<0||Number(e.tintOpacity)>1)&&a.push(`"${n}.tintOpacity" must be in [0, 1] when provided.`),e.tintColor!==void 0&&(typeof e.tintColor!="string"||e.tintColor.trim().length===0)&&a.push(`"${n}.tintColor" must be a non-empty color string when provided.`)},c0=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if(e.mode!==void 0&&e.mode!=="native"&&e.mode!=="additive"&&e.mode!=="custom"&&a.push(`"${n}.mode" must be one of "native", "additive", or "custom".`),e.interiorDensity!==void 0&&(!Number.isFinite(e.interiorDensity)||Number(e.interiorDensity)<0||Number(e.interiorDensity)>1)&&a.push(`"${n}.interiorDensity" must be in [0, 1] when provided.`),e.clusterBias!==void 0&&(!Number.isFinite(e.clusterBias)||Number(e.clusterBias)<0||Number(e.clusterBias)>1)&&a.push(`"${n}.clusterBias" must be in [0, 1] when provided.`),e.keepPerimeter!==void 0&&typeof e.keepPerimeter!="boolean"&&a.push(`"${n}.keepPerimeter" must be a boolean when provided.`),e.mountainPath!==void 0&&(typeof e.mountainPath!="string"||!jo.test(e.mountainPath))&&a.push(`"${n}.mountainPath" must be a /assets/... path when provided.`),e.mountainScale!==void 0&&(!Number.isFinite(e.mountainScale)||Number(e.mountainScale)<=0)&&a.push(`"${n}.mountainScale" must be > 0 when provided.`),e.mountainOffsetX!==void 0&&!Number.isFinite(e.mountainOffsetX)&&a.push(`"${n}.mountainOffsetX" must be a finite number when provided.`),e.mountainOffsetY!==void 0&&!Number.isFinite(e.mountainOffsetY)&&a.push(`"${n}.mountainOffsetY" must be a finite number when provided.`),e.mountainAnchorX!==void 0&&(!Number.isFinite(e.mountainAnchorX)||Number(e.mountainAnchorX)<0||Number(e.mountainAnchorX)>1)&&a.push(`"${n}.mountainAnchorX" must be in [0, 1] when provided.`),e.mountainAnchorY!==void 0&&(!Number.isFinite(e.mountainAnchorY)||Number(e.mountainAnchorY)<0||Number(e.mountainAnchorY)>1)&&a.push(`"${n}.mountainAnchorY" must be in [0, 1] when provided.`),e.mountainCrustBlendMode!==void 0&&e.mountainCrustBlendMode!=="off"&&e.mountainCrustBlendMode!=="normal"&&e.mountainCrustBlendMode!=="multiply"&&e.mountainCrustBlendMode!=="overlay"&&e.mountainCrustBlendMode!=="soft-light"&&e.mountainCrustBlendMode!=="screen"&&e.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${n}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(e.mountainCrustBlendOpacity)||Number(e.mountainCrustBlendOpacity)<0||Number(e.mountainCrustBlendOpacity)>1)&&a.push(`"${n}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),e.mountainTintColor!==void 0&&(typeof e.mountainTintColor!="string"||e.mountainTintColor.trim().length===0)&&a.push(`"${n}.mountainTintColor" must be a non-empty color string when provided.`),e.mountainTintBlendMode!==void 0&&e.mountainTintBlendMode!=="off"&&e.mountainTintBlendMode!=="normal"&&e.mountainTintBlendMode!=="multiply"&&e.mountainTintBlendMode!=="overlay"&&e.mountainTintBlendMode!=="soft-light"&&e.mountainTintBlendMode!=="screen"&&e.mountainTintBlendMode!=="color-dodge"&&a.push(`"${n}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainTintOpacity!==void 0&&(!Number.isFinite(e.mountainTintOpacity)||Number(e.mountainTintOpacity)<0||Number(e.mountainTintOpacity)>1)&&a.push(`"${n}.mountainTintOpacity" must be in [0, 1] when provided.`),Do(e,n,a),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${n}.themes" must be an object when provided.`);else for(const[o,r]of Object.entries(e.themes)){if(typeof o!="string"||o.trim().length===0){a.push(`"${n}.themes" contains an invalid theme key.`);continue}if(!r||typeof r!="object"){a.push(`"${n}.themes.${o}" must be an object.`);continue}r.mountainPath!==void 0&&(typeof r.mountainPath!="string"||!jo.test(r.mountainPath))&&a.push(`"${n}.themes.${o}.mountainPath" must be a /assets/... path when provided.`);const c=r;c.mountainScale!==void 0&&(!Number.isFinite(c.mountainScale)||Number(c.mountainScale)<=0)&&a.push(`"${n}.themes.${o}.mountainScale" must be > 0 when provided.`),c.mountainOffsetX!==void 0&&!Number.isFinite(c.mountainOffsetX)&&a.push(`"${n}.themes.${o}.mountainOffsetX" must be a finite number when provided.`),c.mountainOffsetY!==void 0&&!Number.isFinite(c.mountainOffsetY)&&a.push(`"${n}.themes.${o}.mountainOffsetY" must be a finite number when provided.`),c.mountainAnchorX!==void 0&&(!Number.isFinite(c.mountainAnchorX)||Number(c.mountainAnchorX)<0||Number(c.mountainAnchorX)>1)&&a.push(`"${n}.themes.${o}.mountainAnchorX" must be in [0, 1] when provided.`),c.mountainAnchorY!==void 0&&(!Number.isFinite(c.mountainAnchorY)||Number(c.mountainAnchorY)<0||Number(c.mountainAnchorY)>1)&&a.push(`"${n}.themes.${o}.mountainAnchorY" must be in [0, 1] when provided.`),c.mountainCrustBlendMode!==void 0&&c.mountainCrustBlendMode!=="off"&&c.mountainCrustBlendMode!=="normal"&&c.mountainCrustBlendMode!=="multiply"&&c.mountainCrustBlendMode!=="overlay"&&c.mountainCrustBlendMode!=="soft-light"&&c.mountainCrustBlendMode!=="screen"&&c.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${n}.themes.${o}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),c.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(c.mountainCrustBlendOpacity)||Number(c.mountainCrustBlendOpacity)<0||Number(c.mountainCrustBlendOpacity)>1)&&a.push(`"${n}.themes.${o}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),c.mountainTintBlendMode!==void 0&&c.mountainTintBlendMode!=="off"&&c.mountainTintBlendMode!=="normal"&&c.mountainTintBlendMode!=="multiply"&&c.mountainTintBlendMode!=="overlay"&&c.mountainTintBlendMode!=="soft-light"&&c.mountainTintBlendMode!=="screen"&&c.mountainTintBlendMode!=="color-dodge"&&a.push(`"${n}.themes.${o}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),c.mountainTintOpacity!==void 0&&(!Number.isFinite(c.mountainTintOpacity)||Number(c.mountainTintOpacity)<0||Number(c.mountainTintOpacity)>1)&&a.push(`"${n}.themes.${o}.mountainTintOpacity" must be in [0, 1] when provided.`),c.mountainTintColor!==void 0&&(typeof c.mountainTintColor!="string"||c.mountainTintColor.trim().length===0)&&a.push(`"${n}.themes.${o}.mountainTintColor" must be a non-empty color string when provided.`),Do(r,`${n}.themes.${o}`,a)}},Ll=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}e.detailA!==void 0&&Ia(e.detailA,`${n}.detailA`,a),e.detailB!==void 0&&Ia(e.detailB,`${n}.detailB`,a),e.tint!==void 0&&fE(e.tint,`${n}.tint`,a),e.detailA===void 0&&e.detailB===void 0&&e.tint===void 0&&a.push(`"${n}" must define at least one of "detailA", "detailB", or "tint".`)},mE=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if(e.seed!==void 0&&(typeof e.seed!="string"||e.seed.trim().length===0)&&a.push(`"${n}.seed" must be a non-empty string when provided.`),e.injectHazards!==void 0&&typeof e.injectHazards!="boolean"&&a.push(`"${n}.injectHazards" must be a boolean when provided.`),e.biomeLayers!==void 0){const o=e.biomeLayers;if(!o||typeof o!="object")a.push(`"${n}.biomeLayers" must be an object when provided.`);else if(o.undercurrent!==void 0&&Ia(o.undercurrent,`${n}.biomeLayers.undercurrent`,a),o.crust!==void 0&&Ia(o.crust,`${n}.biomeLayers.crust`,a),o.clutter!==void 0){const r=o.clutter;!r||typeof r!="object"?a.push(`"${n}.biomeLayers.clutter" must be an object when provided.`):(r.density!==void 0&&(!Number.isFinite(r.density)||Number(r.density)<0||Number(r.density)>1)&&a.push(`"${n}.biomeLayers.clutter.density" must be in [0, 1] when provided.`),r.maxPerHex!==void 0&&(!Number.isFinite(r.maxPerHex)||Number(r.maxPerHex)<0)&&a.push(`"${n}.biomeLayers.clutter.maxPerHex" must be >= 0 when provided.`),r.bleedScaleMax!==void 0&&(!Number.isFinite(r.bleedScaleMax)||Number(r.bleedScaleMax)<1||Number(r.bleedScaleMax)>2)&&a.push(`"${n}.biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.`),r.tags!==void 0&&(!Array.isArray(r.tags)||!r.tags.every(c=>typeof c=="string"&&c.length>0))&&a.push(`"${n}.biomeLayers.clutter.tags" must be a string array when provided.`))}}if(e.biomeMaterials!==void 0){const o=e.biomeMaterials;!o||typeof o!="object"?a.push(`"${n}.biomeMaterials" must be an object when provided.`):(o.undercurrent!==void 0&&Ll(o.undercurrent,`${n}.biomeMaterials.undercurrent`,a),o.crust!==void 0&&Ll(o.crust,`${n}.biomeMaterials.crust`,a))}if(e.walls!==void 0&&c0(e.walls,`${n}.walls`,a),e.assetOverrides!==void 0)if(!e.assetOverrides||typeof e.assetOverrides!="object")a.push(`"${n}.assetOverrides" must be an object when provided.`);else for(const[o,r]of Object.entries(e.assetOverrides)){if(!r0.test(o)){a.push(`"${n}.assetOverrides" contains invalid asset id "${o}".`);continue}if(!r||typeof r!="object"){a.push(`"${n}.assetOverrides.${o}" must be an object.`);continue}r.mountainSettings!==void 0&&Do(r.mountainSettings,`${n}.assetOverrides.${o}.mountainSettings`,a)}},pE=e=>{const n=[];if(!e||typeof e!="object")return{valid:!1,errors:["Manifest is not an object."]};const a=e;if((typeof a.version!="string"||a.version.length===0)&&n.push('Missing or invalid "version".'),a.gridTopology!=="flat-top-hex"&&n.push('Only "flat-top-hex" gridTopology is supported.'),(!Number.isFinite(a.tileUnitPx)||Number(a.tileUnitPx)<=0)&&n.push('Missing or invalid "tileUnitPx".'),(!Number.isFinite(a.tileAspectRatio)||Number(a.tileAspectRatio)<=0)&&n.push('Missing or invalid "tileAspectRatio".'),a.biomeUnderlay!==void 0&&Ia(a.biomeUnderlay,"biomeUnderlay",n),a.biomeLayers!==void 0){const r=a.biomeLayers;if(!r||typeof r!="object")n.push('"biomeLayers" must be an object when provided.');else if(r.undercurrent!==void 0&&Ia(r.undercurrent,"biomeLayers.undercurrent",n),r.crust!==void 0&&Ia(r.crust,"biomeLayers.crust",n),!r.undercurrent&&!r.crust&&n.push('"biomeLayers" must define at least one of "undercurrent" or "crust".'),r.clutter!==void 0){const c=r.clutter;!c||typeof c!="object"?n.push('"biomeLayers.clutter" must be an object when provided.'):(c.density!==void 0&&(!Number.isFinite(c.density)||Number(c.density)<0||Number(c.density)>1)&&n.push('"biomeLayers.clutter.density" must be in [0, 1] when provided.'),c.maxPerHex!==void 0&&(!Number.isFinite(c.maxPerHex)||Number(c.maxPerHex)<0)&&n.push('"biomeLayers.clutter.maxPerHex" must be >= 0 when provided.'),c.bleedScaleMax!==void 0&&(!Number.isFinite(c.bleedScaleMax)||Number(c.bleedScaleMax)<1||Number(c.bleedScaleMax)>2)&&n.push('"biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.'),c.tags!==void 0&&(!Array.isArray(c.tags)||!c.tags.every(d=>typeof d=="string"&&d.length>0))&&n.push('"biomeLayers.clutter.tags" must be a string array when provided.'))}}if(a.biomeMaterials!==void 0){const r=a.biomeMaterials;!r||typeof r!="object"?n.push('"biomeMaterials" must be an object when provided.'):(r.undercurrent!==void 0&&Ll(r.undercurrent,"biomeMaterials.undercurrent",n),r.crust!==void 0&&Ll(r.crust,"biomeMaterials.crust",n),r.undercurrent===void 0&&r.crust===void 0&&n.push('"biomeMaterials" must define at least one of "undercurrent" or "crust".'))}if(a.walls!==void 0&&c0(a.walls,"walls",n),a.biomePresets!==void 0)if(!a.biomePresets||typeof a.biomePresets!="object")n.push('"biomePresets" must be an object when provided.');else for(const[r,c]of Object.entries(a.biomePresets)){if(typeof r!="string"||r.trim().length===0){n.push('"biomePresets" contains an invalid theme key.');continue}mE(c,`biomePresets.${r}`,n)}if(!Array.isArray(a.layers)||a.layers.length===0||!a.layers.every(zy))n.push('Missing or invalid "layers".');else for(const r of Fd)a.layers.includes(r)||n.push(`Missing required layer "${r}" in "layers".`);if(!Array.isArray(a.assets))return n.push('Missing or invalid "assets".'),{valid:n.length===0,errors:n};const o=new Set;for(const[r,c]of a.assets.entries()){const d=`assets[${r}]`;if(!c||typeof c!="object"){n.push(`${d} is not an object.`);continue}const h=c;if(typeof h.id!="string"||!r0.test(h.id)?n.push(`${d}.id is invalid; expected lowercase tokenized id.`):o.has(h.id)?n.push(`${d}.id is duplicated (${h.id}).`):o.add(h.id),Vy(h.type)||n.push(`${d}.type is invalid.`),zy(h.layer)||n.push(`${d}.layer is invalid.`),Yy(h.recommendedFormat)||n.push(`${d}.recommendedFormat is invalid.`),Vy(h.type)&&Yy(h.recommendedFormat)&&((h.type==="tile"||h.type==="decal"||h.type==="prop")&&!Dy.includes(h.recommendedFormat)&&n.push(`${d}.recommendedFormat must be one of ${Dy.join(", ")} for ${h.type}.`),h.type==="ui"&&!Uy.includes(h.recommendedFormat)&&n.push(`${d}.recommendedFormat must be one of ${Uy.join(", ")} for ui.`),h.type==="unit"&&!jy.includes(h.recommendedFormat)&&n.push(`${d}.recommendedFormat must be one of ${jy.join(", ")} for units.`),h.type==="fx"&&!Py.includes(h.recommendedFormat)&&n.push(`${d}.recommendedFormat must be one of ${Py.join(", ")} for fx.`)),(typeof h.path!="string"||!jo.test(h.path))&&n.push(`${d}.path is invalid; expected /assets/...`),(!Number.isFinite(h.width)||Number(h.width)<=0)&&n.push(`${d}.width must be > 0.`),(!Number.isFinite(h.height)||Number(h.height)<=0)&&n.push(`${d}.height must be > 0.`),h.mountainSettings!==void 0&&Do(h.mountainSettings,`${d}.mountainSettings`,n),h.mountainSettingsByTheme!==void 0)if(!h.mountainSettingsByTheme||typeof h.mountainSettingsByTheme!="object")n.push(`${d}.mountainSettingsByTheme must be an object when provided.`);else for(const[g,m]of Object.entries(h.mountainSettingsByTheme)){if(typeof g!="string"||g.trim().length===0){n.push(`${d}.mountainSettingsByTheme contains an invalid theme key.`);continue}Do(m,`${d}.mountainSettingsByTheme.${g}`,n)}}return{valid:n.length===0,errors:n}},hE=async()=>ll||(ll=fetch(lE).then(async e=>{if(!e.ok)throw new Error(`Asset manifest fetch failed: ${e.status}`);return e.json()}).then(e=>{const n=pE(e);return n.valid?dE(e):(console.warn("[HOP_ASSETS] Invalid manifest; using fallback.",n.errors),$y)}).catch(e=>(console.warn("[HOP_ASSETS] Failed to load manifest; using fallback.",e),$y)),ll),Xd=(e,n)=>{if(!e)return;const a=String(n||"").toLowerCase();if(a)return e.biomePresets?.[a]},Ky="/Hop",yE=64,gE=192,Fy=64,Xy=512,vt=(e,n,a)=>Math.min(a,Math.max(n,e)),Wy=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,Mo=e=>{const n=e.trim();return!n||/^(?:[a-z]+:)?\/\//i.test(n)||n.startsWith("data:")?n:n.startsWith("/")?n.startsWith("/assets/")?Wy(Ky,n.slice(1)):n:Wy(Ky,n)},Gy=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,d,h]=a.slice(1).split("");return`#${c}${c}${d}${d}${h}${h}`.toLowerCase()}return n},u0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",cl=e=>e==="off"?"off":u0(e),bE=(e,n,a)=>{if(!e||!n)return null;const o=Mo(n.undercurrent.path),r=Mo(n.crust.path),c=Mo(n.materials.detailA.path),d=Mo(n.materials.detailB.path),h=Xd(e,a),g=h?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,m=h?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),f=h?.biomeMaterials?.crust??e.biomeMaterials?.crust,b=g||o?{...g||{default:o||r||""},default:o||g?.default||"",themes:{...g?.themes||{},[a]:o||g?.default||""},mode:n.undercurrent.mode,scalePx:vt(n.undercurrent.scalePx,yE,gE),opacity:vt(n.undercurrent.opacity,0,1),offsetX:n.undercurrent.offsetX,offsetY:n.undercurrent.offsetY,scroll:{x:n.undercurrent.scrollX,y:n.undercurrent.scrollY,durationMs:Math.max(1e3,n.undercurrent.scrollDurationMs)}}:void 0,x=m||r?{...m||{default:r||o||""},default:r||m?.default||"",themes:{...m?.themes||{},[a]:r||m?.default||""},mode:n.crust.mode,scalePx:Math.max(64,n.crust.scalePx),opacity:1,seedShiftPx:Math.max(0,n.crust.seedShiftPx),offsetX:n.crust.offsetX,offsetY:n.crust.offsetY}:void 0,T=c||f?.detailA?.default||"",S={...f?.detailA?.themes||{}};T&&(S[a]=T);const A=T?{...f?.detailA||{default:T},default:T,themes:S,mode:n.materials.detailA.mode,scalePx:vt(n.materials.detailA.scalePx,Fy,Xy),opacity:vt(n.materials.detailA.opacity,0,1)}:void 0,O=d||f?.detailB?.default||"",_={...f?.detailB?.themes||{}};O&&(_[a]=O);const E=O?{...f?.detailB||{default:O},default:O,themes:_,mode:n.materials.detailB.mode,scalePx:vt(n.materials.detailB.scalePx,Fy,Xy),opacity:vt(n.materials.detailB.opacity,0,1)}:void 0,w=String(n.materials.tintColor||"").trim()||f?.tint?.default||"#8b6f4a",C={...f?.tint?.themes||{}};C[a]=w;const I={...f?.tint||{default:w},default:w,themes:C,opacity:vt(n.materials.tintOpacity,0,1),blendMode:u0(n.materials.tintBlend)},N=A||E||I?{...f||{},detailA:A,detailB:E,tint:I}:void 0,H=Mo(n.walls.mountainPath),D=h?.walls,G={...D||e.walls?.themes?.[a]||{},mountainPath:H,scale:vt(n.walls.mountainScale,.2,3),offsetX:n.walls.mountainOffsetX,offsetY:n.walls.mountainOffsetY,anchorX:vt(n.walls.mountainAnchorX,0,1),anchorY:vt(n.walls.mountainAnchorY,0,1),crustBlendMode:cl(n.walls.mountainCrustBlendMode),crustBlendOpacity:vt(n.walls.mountainCrustBlendOpacity,0,1),tintColor:Gy(n.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:cl(n.walls.mountainTintBlendMode),tintOpacity:vt(n.walls.mountainTintOpacity,0,1),mountainScale:vt(n.walls.mountainScale,.2,3),mountainOffsetX:n.walls.mountainOffsetX,mountainOffsetY:n.walls.mountainOffsetY,mountainAnchorX:vt(n.walls.mountainAnchorX,0,1),mountainAnchorY:vt(n.walls.mountainAnchorY,0,1),mountainCrustBlendMode:cl(n.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:vt(n.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Gy(n.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:cl(n.walls.mountainTintBlendMode),mountainTintOpacity:vt(n.walls.mountainTintOpacity,0,1)},P={...e.walls||{},...D||{},mode:n.walls.mode,interiorDensity:vt(n.walls.interiorDensity,0,.45),clusterBias:vt(n.walls.clusterBias,0,1),keepPerimeter:!!n.walls.keepPerimeter,mountainPath:H,scale:G.scale,offsetX:G.offsetX,offsetY:G.offsetY,anchorX:G.anchorX,anchorY:G.anchorY,crustBlendMode:G.crustBlendMode,crustBlendOpacity:G.crustBlendOpacity,tintColor:G.tintColor,tintBlendMode:G.tintBlendMode,tintOpacity:G.tintOpacity,mountainScale:G.mountainScale,mountainOffsetX:G.mountainOffsetX,mountainOffsetY:G.mountainOffsetY,mountainAnchorX:G.mountainAnchorX,mountainAnchorY:G.mountainAnchorY,mountainCrustBlendMode:G.mountainCrustBlendMode,mountainCrustBlendOpacity:G.mountainCrustBlendOpacity,mountainTintColor:G.mountainTintColor,mountainTintBlendMode:G.mountainTintBlendMode,mountainTintOpacity:G.mountainTintOpacity,themes:{...e.walls?.themes||{},[a]:G}},Y={...h?.biomeLayers||{},undercurrent:b,crust:x,clutter:{...h?.biomeLayers?.clutter||e.biomeLayers?.clutter||{},density:vt(n.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(n.clutter.maxPerHex)),bleedScaleMax:vt(n.clutter.bleedScaleMax,1,2)}},F={...h?.biomeMaterials||{},crust:N},Z={...h||{},seed:n.seed.trim()||"biome-sandbox-seed",injectHazards:n.injectHazards,biomeLayers:Y,biomeMaterials:F,walls:P};return{...e,biomeLayers:{...e.biomeLayers||{},undercurrent:b,crust:x,clutter:{...e.biomeLayers?.clutter||{},density:vt(n.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(n.clutter.maxPerHex)),bleedScaleMax:vt(n.clutter.bleedScaleMax,1,2)}},biomeMaterials:{...e.biomeMaterials||{},crust:N},walls:P,biomePresets:{...e.biomePresets||{},[a]:Z}}},xE=({presets:e,activePreset:n,onSelectPreset:a,onResetView:o})=>y.jsx("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 z-30 flex items-center gap-1.5 pointer-events-auto",children:y.jsxs("div",{className:"flex items-center gap-1 rounded-xl border border-white/15 bg-black/35 backdrop-blur-sm p-1",children:[e.map(r=>{const c=n===r;return y.jsx("button",{type:"button",onPointerDown:d=>d.stopPropagation(),onClick:()=>a(r),className:`px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest transition-colors ${c?"bg-white text-black":"bg-white/5 text-white/70 hover:bg-white/10"}`,"aria-label":`Set zoom to ${r} tiles wide`,children:r},`zoom-${r}`)}),y.jsx("button",{type:"button",onPointerDown:r=>r.stopPropagation(),onClick:o,className:"px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-white/5 text-white/70 hover:bg-white/10","aria-label":"Reset camera to player",children:"Fit"})]})}),vE=({boardProps:e})=>y.jsx("g",{"data-layer":"ui-objective-markers",pointerEvents:"none",children:e.map(n=>{const{x:a,y:o}=Ee(n.position,ee),r=n.kind==="shrine",c=r?"#c2410c":"#15803d",d=r?"S":"E",h=a+ee*.52,g=o-ee*.52;return y.jsxs("g",{transform:`translate(${h},${g})`,children:[y.jsx("circle",{r:14,fill:"none",stroke:"rgba(255,255,255,0.55)",strokeWidth:2,style:{animation:`shrineGlow ${r?1.6:1.9}s ease-in-out infinite`}}),y.jsx("circle",{r:10.5,fill:c,stroke:"#ffffff",strokeWidth:2}),y.jsx("text",{x:0,y:0,textAnchor:"middle",dy:".34em",fill:"#ffffff",fontSize:10,fontWeight:900,style:{textShadow:"0 1px 2px rgba(0,0,0,0.7)"},children:d})]},`marker-${n.id}`)})}),SE={catacombs:.2,inferno:.16,throne:.24,frozen:.45,void:.08},AE=(e,n)=>{const a=Math.max(e,n),o=Math.min(e,n);return(a+.05)/(o+.05)},TE=(e,n,a=24,o,r,c=1)=>{const d=Bo(e.subtype,e.type,e.enemyType,e.archetype),{icon:h,shape:g,color:m,borderColor:f,size:b=1}=d,x=a*b,T=e.statusEffects?.find(_=>_.type==="time_bomb"),S=T?Math.max(0,T.duration):e.actionCooldown??0,A=`contrast(${c.toFixed(2)}) brightness(${(c>1?1.12:1.04).toFixed(2)})`,O=n?`drop-shadow(0 3px 4px rgba(0,0,0,0.45)) drop-shadow(0 0 2px rgba(255,255,255,0.5)) saturate(1.08) ${A}`:`drop-shadow(0 3px 4px rgba(0,0,0,0.50)) drop-shadow(0 0 2px rgba(255,255,255,0.35)) saturate(1.0) ${A}`;return y.jsxs("g",{children:[y.jsx("title",{children:n?"Player":`${e.subtype||"Enemy"}`}),o&&y.jsx("image",{href:o,x:-x,y:-x,width:x*2,height:x*2,preserveAspectRatio:"xMidYMid meet",onError:r,style:{filter:O,opacity:n?1:.97}}),!o&&g==="square"&&y.jsx("rect",{x:-x*.8,y:-x*.8,width:x*1.6,height:x*1.6,fill:m,stroke:f,strokeWidth:2}),!o&&g==="diamond"&&y.jsx("path",{d:`M0 ${-x*.8} L${x*.6} 0 L0 ${x*.8} L${-x*.6} 0 Z`,fill:m,stroke:f,strokeWidth:1}),!o&&g==="triangle"&&y.jsx("path",{d:`M0 ${-x*.8} L${x*.7} ${x*.5} L${-x*.7} ${x*.5} Z`,fill:m,stroke:f,strokeWidth:1}),!o&&g==="circle"&&y.jsx("circle",{r:x*.7,fill:m,stroke:f,strokeWidth:1}),e.subtype==="bomb"&&y.jsx("text",{y:x*.2,textAnchor:"middle",fill:"#fff",fontSize:"10",fontWeight:"bold",children:S}),!o&&!n&&e.subtype!=="bomb"&&y.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:x*.8,opacity:.8,children:h}),!o&&n&&y.jsx("path",{d:`M0 ${-x*.4} L0 ${x*.4} M${-x*.15} ${-x*.2} L0 ${-x*.5} L${x*.15} ${-x*.2}`,stroke:f,strokeWidth:2,fill:"none"})]})},EE=({entity:e,isSpear:n,isDying:a,movementTrace:o,waapiControlled:r=!1,assetHref:c,fallbackAssetHref:d,floorTheme:h,visualPose:g})=>{const[m,f]=k.useState(e.position),[b,x]=k.useState(()=>Ee(e.position,ee)),[T,S]=k.useState(e.previousPosition),[A,O]=k.useState(220),[_,E]=k.useState("cubic-bezier(0.22, 1, 0.36, 1)"),[w,C]=k.useState("none"),I=k.useRef(!1),N=k.useRef(e.position),H=k.useRef([]),D=k.useRef(null),[G,P]=k.useState(!1),Y=k.useRef(e.hp),F=e.type==="player",Z=typeof window<"u"&&!!window.__HOP_DEBUG_MOVEMENT,[z,q]=k.useState(c||d),[B,$]=k.useState(!1);k.useEffect(()=>{q(c||d),$(!1)},[c,d,e.id]);const X=()=>{if(!B&&d&&z!==d){q(d),$(!0);return}q(void 0)};k.useEffect(()=>{const ft=()=>{for(const St of H.current)clearTimeout(St);H.current=[],D.current!==null&&(cancelAnimationFrame(D.current),D.current=null)};if(r){ft(),I.current=!1;const St=!!(o&&o.actorId===e.id&&o.destination&&se(o.destination,e.position)),qt=!se(e.position,N.current);N.current=e.position,qt&&!St&&(f(e.position),S(e.previousPosition),x(Ee(e.position,ee))),w!=="none"&&C("none"),A!==0&&O(0),_!=="linear"&&E("linear");return}if(!se(e.position,N.current)){N.current=e.position;const St=o&&o.actorId===e.id&&o.destination&&se(o.destination,e.position)&&Array.isArray(o.path)&&o.path.length>0,qt=St?o.path:void 0,Zn=St?o.movementType:void 0,yn=St?Math.max(0,o.startDelayMs??0):0;if(Z){const ln=e.previousPosition?ht(e.previousPosition,e.position).length:0;console.log("[HOP_MOVE]",{actorId:e.id,movementType:Zn||"fallback",usedEngineTrace:St,tracePathLength:qt?.length||0,tracePath:qt||[],startDelayMs:yn,fallbackPathLength:ln,origin:o?.origin||e.previousPosition,destination:e.position})}if(Zn==="teleport"&&St&&o.origin){ft(),I.current=!0;const ln=o.durationMs??180,De=Math.max(80,Math.floor(ln/2)),et=()=>{O(0),E("linear"),S(o.origin),f(o.origin),x(Ee(o.origin,ee)),C("out");const st=window.setTimeout(()=>{f(e.position),S(e.position),x(Ee(e.position,ee)),C("in")},De),Mn=window.setTimeout(()=>{C("none"),I.current=!1},De*2);H.current.push(st,Mn)};if(yn>0){const st=window.setTimeout(et,yn);H.current.push(st)}else et();return()=>{ft(),I.current=!1}}const ua=!!(e.previousPosition&&!se(e.position,e.previousPosition));if(!!(qt&&qt.length>1)||ua){let De=qt||(e.previousPosition?ht(e.previousPosition,e.position):[]);if(St&&o?.origin&&De.length>1&&se(De[De.length-1],o.origin)&&!se(De[0],o.origin)&&(De=[...De].reverse()),De.length>1){ft(),I.current=!0;const et=Math.max(1,De.length-1),st=o?.durationMs?o.durationMs/et:0,Mn=Math.max(90,Math.min(130,st||112)),Ae=Mn*et,Re=De.map(At=>Ee(At,ee)),We=performance.now(),lt=At=>At<.5?4*At*At*At:1-Math.pow(-2*At+2,3)/2;C("none"),O(0),E("linear"),f(De[0]),S(De[0]),x(Re[0]);let ct=-1;const $t=At=>{const gn=Math.max(0,At-We),bn=Math.min(et-1,Math.floor(gn/Mn)),ri=bn*Mn,ei=gn-ri,$n=Math.max(0,Math.min(1,ei/Mn)),Rt=lt($n);bn!==ct&&(S(De[bn]),f(De[Math.min(De.length-1,bn+1)]),ct=bn);const yt=Re[bn],tn=Re[Math.min(Re.length-1,bn+1)];if(x({x:yt.x+(tn.x-yt.x)*Rt,y:yt.y+(tn.y-yt.y)*Rt}),gn<Ae){D.current=requestAnimationFrame($t);return}I.current=!1,f(e.position),S(e.previousPosition),x(Re[Re.length-1]),D.current=null};if(yn>0){const At=window.setTimeout(()=>{D.current=requestAnimationFrame($t)},yn);H.current.push(At)}else D.current=requestAnimationFrame($t);return()=>{ft(),I.current=!1}}}C("none"),O(220),E("cubic-bezier(0.22, 1, 0.36, 1)"),f(e.position),S(e.previousPosition),x(Ee(e.position,ee))}},[e.position,e.previousPosition,o,e.id,r]);const{x:le,y:fe}=b||Ee(m,ee);k.useEffect(()=>{if(e.hp<Y.current){P(!0);const ft=setTimeout(()=>P(!1),150);return()=>clearTimeout(ft)}Y.current=e.hp},[e.hp]);let R="";const W=T;if(W&&!se(m,W)){const ft=Gn(W,m);if(ft!==-1){const St=ft*60;R=`rotate(${St}) scale(1.15, 0.85) rotate(${-St})`}}const Q=e.isVisible===!1;if(n){const ft=Bo("spear","enemy");return y.jsx("g",{style:{pointerEvents:"none"},children:y.jsx("g",{transform:`translate(${le},${fe})`,children:y.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:"20",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5))"},children:ft.icon})})})}const ne=Bo(e.subtype,e.type,e.enemyType,e.archetype),re=tE(e),ce=F?1.34:.92,me=F?-9:-2,Ce=F?24:18,ve=String(h||"").toLowerCase(),_e=SE[ve]??.22,Ue=AE(_e,F?.87:.82)<4.5?1.22:1.06,qe=F?"#22e7ff":"rgba(255,120,120,0.7)",Ge=F?"rgba(34,231,255,0.20)":"rgba(239,68,68,0.16)",dt=F?"rgba(34,231,255,0.36)":"rgba(255,90,90,0.28)",Te=F?ee*.48:ee*.42,rt=F?ee*.17:ee*.145,wt=F?ee*.32:ee*.3,Ut=g?.offsetX??0,Mt=g?.offsetY??0,Un=g?.scaleX??1,qn=g?.scaleY??1,Qn=Math.abs(Ut)>.01||Math.abs(Mt)>.01||Math.abs(Un-1)>.01||Math.abs(qn-1)>.01?`translate(${Ut},${Mt}) scale(${Un},${qn})`:void 0;return y.jsx("g",{style:{pointerEvents:"none"},children:y.jsx("g",{"data-actor-node":e.id,style:{transition:r?"none":`transform ${A}ms ${_}`,transform:`translate(${le}px, ${fe}px)`},className:a?"animate-lava-sink":"",children:y.jsx("g",{transform:Qn,children:y.jsxs("g",{transform:R,className:`${G?"entity-damaged":""} ${!a&&!Ci(e)?"animate-idle":""} ${w==="out"?"entity-teleport-out":""} ${w==="in"?"entity-teleport-in":""}`,opacity:Q?.3:ne.opacity||1,style:{filter:Q?"blur(1px)":"none"},children:[y.jsxs("g",{transform:`translate(0,${wt})`,children:[y.jsx("ellipse",{cx:0,cy:0,rx:Te,ry:rt,fill:Ge,stroke:qe,strokeWidth:2,opacity:.95,style:{filter:`drop-shadow(0 0 5px ${dt})`}}),y.jsx("ellipse",{cx:0,cy:0,rx:Te*1.14,ry:rt*1.14,fill:"none",stroke:qe,strokeWidth:F?1.8:1.6,opacity:F?.62:.54})]}),re&&y.jsx("ellipse",{cx:0,cy:ee*.3,rx:ee*.4,ry:ee*.15,fill:"black",opacity:.2}),y.jsx("g",{transform:`translate(0,${me}) scale(${ce})`,children:TE(e,F,Ce,z,X,Ue)}),Ci(e)&&y.jsxs("g",{transform:`translate(0, -${ee*.8})`,className:"stun-icon",children:[y.jsx("text",{fontSize:"14",textAnchor:"middle",children:"*"}),y.jsx("text",{fontSize:"8",textAnchor:"middle",dy:"-3",dx:"6",children:"+"})]}),ne.showFacing&&e.facing!==void 0&&!Ci(e)&&y.jsx("line",{x1:0,y1:0,x2:Math.cos((e.facing*60-90)*Math.PI/180)*ee*.5,y2:Math.sin((e.facing*60-90)*Math.PI/180)*ee*.5,stroke:ne.borderColor,strokeWidth:3,strokeLinecap:"round"}),y.jsx("title",{children:`${e.subtype||e.type} - HP ${e.hp}/${e.maxHp}${e.intent?` - ${e.intent}`:""}`})]})})})})},Jy=e=>{if(!e)return"";const n=(e.path||[]).map(a=>`${a.q},${a.r},${a.s}`).join(";");return`${e.actorId}|${e.movementType||""}|${e.destination?.q??""},${e.destination?.r??""},${e.destination?.s??""}|${n}|${e.durationMs??""}|${e.startDelayMs??0}|${e.wasLethal?1:0}`},Qy=(e=[])=>e.map(n=>`${n.id}:${n.duration??""}:${n.stacks??""}`).join("|"),ul=Fn.memo(EE,(e,n)=>{const a=e.entity,o=n.entity;return e.isSpear===n.isSpear&&e.isDying===n.isDying&&e.waapiControlled===n.waapiControlled&&e.assetHref===n.assetHref&&e.fallbackAssetHref===n.fallbackAssetHref&&e.floorTheme===n.floorTheme&&(e.visualPose?.offsetX??0)===(n.visualPose?.offsetX??0)&&(e.visualPose?.offsetY??0)===(n.visualPose?.offsetY??0)&&(e.visualPose?.scaleX??1)===(n.visualPose?.scaleX??1)&&(e.visualPose?.scaleY??1)===(n.visualPose?.scaleY??1)&&Jy(e.movementTrace)===Jy(n.movementTrace)&&a.id===o.id&&a.hp===o.hp&&a.maxHp===o.maxHp&&a.facing===o.facing&&a.intent===o.intent&&a.isVisible===o.isVisible&&a.position.q===o.position.q&&a.position.r===o.position.r&&a.position.s===o.position.s&&(a.previousPosition?.q??0)===(o.previousPosition?.q??0)&&(a.previousPosition?.r??0)===(o.previousPosition?.r??0)&&(a.previousPosition?.s??0)===(o.previousPosition?.s??0)&&(a.intentPosition?.q??0)===(o.intentPosition?.q??0)&&(a.intentPosition?.r??0)===(o.intentPosition?.r??0)&&(a.intentPosition?.s??0)===(o.intentPosition?.s??0)&&Qy(a.statusEffects)===Qy(o.statusEffects)}),_E=["white","blue","black","red","green"],Zy={white:{label:"Plains / Mesa",floorAssetId:"tile.catacombs.floor.01",hazardAssetId:"tile.catacombs.lava.01"},blue:{label:"Islands / Coast",floorAssetId:"tile.frozen.floor.01",hazardAssetId:"tile.catacombs.lava.01"},black:{label:"Swamp / Wastes",floorAssetId:"tile.void.floor.01",hazardAssetId:"tile.catacombs.lava.01"},red:{label:"Mountains / Volcanic",floorAssetId:"tile.inferno.floor.01",hazardAssetId:"tile.inferno.lava.01"},green:{label:"Forest / Jungle",floorAssetId:"tile.throne.floor.01",hazardAssetId:"tile.catacombs.lava.01"}},wE={catacombs:"white",frozen:"blue",void:"black",inferno:"red",throne:"green"},ME=e=>{if(typeof e!="string")return;const n=e.toLowerCase();return _E.includes(n)?n:void 0},OE=()=>{if(!(typeof window>"u"))return ME(window.__HOP_FORCE_BIOME)},CE=e=>{const n=OE();if(n)return n;const a=String(e||"").toLowerCase();return wE[a]||"white"},kE=e=>{const n=CE(e.theme);return e.isWall?"tile.catacombs.wall.01":e.isLava?Zy[n].hazardAssetId:e.isFire?"tile.catacombs.fire.01":Zy[n].floorAssetId},eg=e=>{if(e.isStairs)return"prop.core.stairs.01";if(e.isShrine)return"prop.core.shrine.01"},oa=e=>{if(e.type==="player")switch(e.archetype){case"FIREMAGE":return"unit.player.firemage.04";case"SKIRMISHER":return"unit.player.skirmisher.01";case"HUNTER":return"unit.player.hunter.01";case"NECROMANCER":return"unit.player.necromancer.01";case"ASSASSIN":return"unit.player.assassin.01";default:return"unit.player.vanguard.01"}switch(e.subtype){case"footman":return"unit.enemy.footman.01";case"shield_bearer":return"unit.enemy.shield_bearer.01";case"archer":return"unit.enemy.archer.01";case"warlock":return"unit.enemy.warlock.01";case"bomber":return"unit.enemy.bomber.01";case"bomb":return"unit.enemy.bomb.01";default:return e.enemyType==="boss"?"unit.enemy.boss.01":"unit.enemy.footman.01"}},tg="/Hop",ng=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,NE=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?ng(tg,e.slice(1)):e:ng(tg,e),RE={"unit.player.vanguard.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.firemage.04":"/assets/units/unit.player.firemage.02.svg","unit.player.skirmisher.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.hunter.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.necromancer.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.assassin.01":"/assets/units/unit.player.skirmisher.01.svg","unit.enemy.footman.01":"/assets/units/unit.enemy.footman.01.svg","unit.enemy.shield_bearer.01":"/assets/units/unit.enemy.shield_bearer.01.svg","unit.enemy.archer.01":"/assets/units/unit.enemy.archer.01.svg","unit.enemy.warlock.01":"/assets/units/unit.enemy.warlock.01.svg","unit.enemy.bomber.01":"/assets/units/unit.enemy.bomber.01.svg","unit.enemy.bomb.01":"/assets/units/unit.enemy.bomb.01.svg","unit.enemy.boss.01":"/assets/units/unit.enemy.boss.01.svg"},Ca=e=>{const n=oa(e),a=RE[n];return a?NE(a):void 0},IE=e=>{if(e==="impact")return"fx.core.impact.01";if(e==="vaporize")return"fx.core.vaporize.01";if(e==="lava_ripple")return"fx.core.lava_ripple.01";if(e==="explosion_ring")return"fx.core.explosion_ring.01"},LE=()=>"ui.core.hp_frame.01",HE=()=>"decal.combat.blood.01",BE=new Set(["impact","flash","combat_text","spear_trail","vaporize","lava_ripple","explosion_ring"]),jE=({effects:e,assetById:n})=>{const a=n.get(LE())?.path;return y.jsx("g",{style:{pointerEvents:"none"},children:e.map(o=>{if(Date.now()<o.startTime||!o.position&&!o.worldPosition)return null;const c=o.position?Ee(o.position,ee):{x:0,y:0},d=o.worldPosition?.x??c.x,h=o.worldPosition?.y??c.y,g=BE.has(o.type)?IE(o.type):void 0,m=g?n.get(g)?.path:void 0;if(o.type==="basic_attack_strike"){const f=o.payload||{},b=f.source,x=f.target,T=String(f.phase||"impact");if(!b||!x)return null;const S=Ee(b,ee),A=f.contactWorld&&typeof f.contactWorld.x=="number"&&typeof f.contactWorld.y=="number"?f.contactWorld:{x:d,y:h},O=A.x-S.x,_=A.y-S.y,E=Math.max(1,Math.hypot(O,_)),w=O/E,C=_/E,I=String(f.intensity||"medium"),N=Math.max(120,Math.min(360,Number(o.ttlMs||180))),H=`${Math.round(N*.85)}ms`,D=I==="extreme"?ee*.34:I==="high"?ee*.28:ee*.22;if(T!=="impact")return null;const G=I==="extreme"?"rgba(253,224,71,0.98)":I==="high"?"rgba(255,255,255,0.96)":"rgba(226,232,240,0.95)",P=I==="extreme"?"rgba(251,191,36,0.9)":"rgba(255,255,255,0.92)";return y.jsx("g",{children:y.jsxs("g",{className:"juice-basic-strike-spark",style:{animationDuration:H},children:[y.jsx("circle",{cx:A.x,cy:A.y,r:D*1.65,fill:"rgba(255,255,255,0.16)",stroke:"rgba(255,255,255,0.55)",strokeWidth:1.4}),y.jsx("circle",{cx:A.x,cy:A.y,r:D*.62,fill:P}),y.jsx("circle",{cx:A.x,cy:A.y,r:D*1.2,fill:"none",stroke:G,strokeWidth:2.4}),y.jsx("path",{d:`M ${A.x-w*D*1.6} ${A.y-C*D*1.6} L ${A.x+w*D*1.6} ${A.y+C*D*1.6}`,stroke:G,strokeWidth:2.1,strokeLinecap:"round"}),y.jsx("path",{d:`M ${A.x-C*D*1.35} ${A.y+w*D*1.35} L ${A.x+C*D*1.35} ${A.y-w*D*1.35}`,stroke:"rgba(255,255,255,0.9)",strokeWidth:1.8,strokeLinecap:"round"})]})},o.id)}if(o.type==="archer_shot_signature"){const f=o.payload||{},b=f.source,x=f.target,T=String(f.phase||"travel");if(!b||!x)return null;const S=Ee(b,ee),A=Ee(x,ee),O=f.contactWorld&&typeof f.contactWorld.x=="number"&&typeof f.contactWorld.y=="number"?f.contactWorld:{x:d,y:h},_=T==="impact"?O:A,E=_.x-S.x,w=_.y-S.y,C=Math.max(1,Math.hypot(E,w)),I=E/C,N=w/C,H=String(f.intensity||"medium");if(T==="anticipation")return y.jsxs("g",{className:"animate-arrow-shot",opacity:.95,children:[y.jsx("line",{x1:S.x,y1:S.y,x2:A.x,y2:A.y,stroke:"rgba(248,113,113,0.75)",strokeWidth:1.5,strokeDasharray:"4 5",strokeLinecap:"round"}),y.jsx("circle",{cx:A.x,cy:A.y,r:ee*.18,fill:"none",stroke:"rgba(254,202,202,0.9)",strokeWidth:1.5})]},o.id);if(T==="travel"){const G=Math.min(C*.22,ee*.75),P=_.x-I*G,Y=_.y-N*G,F=7.5,Z=_.x-I*F-N*(F*.52),z=_.y-N*F+I*(F*.52),q=_.x-I*F+N*(F*.52),B=_.y-N*F-I*(F*.52);return y.jsxs("g",{className:"animate-arrow-shot",children:[y.jsx("line",{x1:S.x,y1:S.y,x2:_.x,y2:_.y,stroke:"rgba(180,83,9,0.38)",strokeWidth:3.2,strokeLinecap:"round",strokeDasharray:"8 9"}),y.jsx("line",{x1:P,y1:Y,x2:_.x,y2:_.y,stroke:"rgba(254,240,138,0.98)",strokeWidth:2.2,strokeLinecap:"round"}),y.jsx("path",{d:`M ${_.x} ${_.y} L ${Z} ${z} M ${_.x} ${_.y} L ${q} ${B}`,stroke:"rgba(255,251,235,0.98)",strokeWidth:1.9,strokeLinecap:"round"}),y.jsx("circle",{cx:S.x,cy:S.y,r:ee*.08,fill:"rgba(251,191,36,0.55)"})]},o.id)}const D=H==="extreme"||H==="high"?ee*.24:ee*.19;return y.jsxs("g",{className:"animate-impact",children:[y.jsx("circle",{cx:O.x,cy:O.y,r:D*1.35,fill:"rgba(251,191,36,0.14)",stroke:"rgba(254,243,199,0.72)",strokeWidth:1.4}),y.jsx("line",{x1:O.x-I*D*1.6,y1:O.y-N*D*1.6,x2:O.x+I*D*1.25,y2:O.y+N*D*1.25,stroke:"rgba(255,251,235,0.95)",strokeWidth:2,strokeLinecap:"round"}),y.jsx("path",{d:`M ${O.x+I*D*1.2} ${O.y+N*D*1.2} L ${O.x+I*D*1.75-N*D*.45} ${O.y+N*D*1.75+I*D*.45} M ${O.x+I*D*1.2} ${O.y+N*D*1.2} L ${O.x+I*D*1.75+N*D*.45} ${O.y+N*D*1.75-I*D*.45}`,stroke:"rgba(254,240,138,0.9)",strokeWidth:1.5,strokeLinecap:"round"})]},o.id)}if(o.type==="melee_lunge"||o.type==="arrow_shot"||o.type==="arcane_bolt"||o.type==="generic_line"){const f=o.payload?.source;if(!f)return null;const b=Ee(f,ee),x=d-b.x,T=h-b.y,S=Math.max(1,Math.hypot(x,T)),A=x/S,O=T/S,_=d-A*Math.min(S*.18,14),E=h-O*Math.min(S*.18,14),w=o.type==="arrow_shot"?7:5,C=d-A*w-O*(w*.55),I=h-O*w+A*(w*.55),N=d-A*w+O*(w*.55),H=h-O*w-A*(w*.55);if(o.type==="melee_lunge")return y.jsxs("g",{className:"animate-melee-lunge",children:[y.jsx("line",{x1:b.x,y1:b.y,x2:_,y2:E,stroke:"rgba(255,255,255,0.35)",strokeWidth:5,strokeLinecap:"round"}),y.jsx("line",{x1:_,y1:E,x2:d,y2:h,stroke:"rgba(255,255,255,0.85)",strokeWidth:3,strokeLinecap:"round"})]},o.id);if(o.type==="arrow_shot"||o.type==="generic_line"){const D=o.type==="generic_line"?"rgba(255,255,255,0.85)":"rgba(253,230,138,0.9)",G=o.type==="generic_line"?"rgba(255,255,255,0.9)":"rgba(254,243,199,0.95)";return y.jsxs("g",{className:o.type==="generic_line"?"animate-melee-lunge":"animate-arrow-shot",children:[y.jsx("line",{x1:b.x,y1:b.y,x2:d,y2:h,stroke:D,strokeWidth:o.type==="generic_line"?2:2.5,strokeLinecap:"round",strokeDasharray:o.type==="generic_line"?"6 6":"10 8"}),y.jsx("path",{d:`M ${d} ${h} L ${C} ${I} M ${d} ${h} L ${N} ${H}`,stroke:G,strokeWidth:2,strokeLinecap:"round"})]},o.id)}return y.jsxs("g",{className:"animate-arcane-bolt",children:[y.jsx("line",{x1:b.x,y1:b.y,x2:d,y2:h,stroke:"rgba(34,211,238,0.92)",strokeWidth:4,strokeLinecap:"round",strokeDasharray:"12 10"}),y.jsx("line",{x1:b.x,y1:b.y,x2:d,y2:h,stroke:"rgba(207,250,254,0.85)",strokeWidth:1.8,strokeLinecap:"round"}),y.jsx("circle",{cx:d,cy:h,r:ee*.22,fill:"rgba(34,211,238,0.35)"})]},o.id)}if(o.type==="kinetic_wave"||o.type==="generic_ring"){const f=o.type==="kinetic_wave"?"rgba(125,211,252,0.9)":"rgba(255,255,255,0.7)",b=o.type==="kinetic_wave"?"rgba(56,189,248,0.14)":"rgba(255,255,255,0.08)";return y.jsx("g",{className:"animate-explosion-ring",children:y.jsx("circle",{cx:d,cy:h,r:ee*(o.type==="kinetic_wave"?1.5:1.1),fill:b,stroke:f,strokeWidth:o.type==="kinetic_wave"?3:2,strokeDasharray:o.type==="kinetic_wave"?"10 6":"6 4"})},o.id)}if(o.type==="wall_crack"){const f=o.payload||{},b=f.source,x=f.target,T=b&&x?Math.atan2(Ee(x,ee).y-Ee(b,ee).y,Ee(x,ee).x-Ee(b,ee).x):0,S=ee*.32,A=T+Math.PI/2,O=d-Math.cos(T)*S,_=h-Math.sin(T)*S,E=d+Math.cos(T)*S,w=h+Math.sin(T)*S;return y.jsxs("g",{className:"animate-impact",children:[y.jsx("line",{x1:O,y1:_,x2:E,y2:w,stroke:"rgba(255,255,255,0.95)",strokeWidth:2.2,strokeLinecap:"round"}),y.jsx("line",{x1:d-Math.cos(A)*S*.8,y1:h-Math.sin(A)*S*.8,x2:d+Math.cos(A)*S*.8,y2:h+Math.sin(A)*S*.8,stroke:"rgba(147,197,253,0.9)",strokeWidth:1.7,strokeLinecap:"round"}),y.jsx("circle",{cx:d,cy:h,r:3.5,fill:"rgba(255,255,255,0.9)"})]},o.id)}if(o.type==="dash_blur"){const f=o.payload?.path;if(!f||f.length<2)return null;const b=f.map(x=>{const T=Ee(x,ee);return`${T.x},${T.y}`}).join(" ");return y.jsx("polyline",{points:b,fill:"none",stroke:"rgba(255,255,255,0.4)",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-arrow-shot",opacity:.6},o.id)}if(o.type==="hidden_fade")return y.jsxs("g",{className:"animate-flash",children:[y.jsx("circle",{cx:d,cy:h,r:ee*.78,fill:"rgba(168,85,247,0.16)",stroke:"rgba(196,181,253,0.75)",strokeWidth:2}),y.jsx("circle",{cx:d,cy:h,r:ee*.34,fill:"rgba(30,27,75,0.35)"})]},o.id);if(o.type==="impact")return m?y.jsx("image",{href:m,x:d-ee*.75,y:h-ee*.75,width:ee*1.5,height:ee*1.5,preserveAspectRatio:"xMidYMid meet",className:"animate-impact",opacity:"0.9"},o.id):y.jsx("circle",{cx:d,cy:h,r:ee*.5,fill:"none",stroke:"#ffffff",strokeWidth:"2",className:"animate-impact"},o.id);if(o.type==="combat_text"){const f=String(o.payload.text||""),b=o.payload.color||(f.startsWith("-")?"#fb7185":"#86efac");return y.jsxs("g",{transform:`translate(${d}, ${h-10})`,children:[a&&y.jsx("image",{href:a,x:-46,y:-24,width:92,height:24,preserveAspectRatio:"xMidYMid meet",opacity:"0.78"}),y.jsx("text",{textAnchor:"middle",fill:b,fontSize:"16",fontWeight:"black",className:"animate-float-up",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.8))",paintOrder:"stroke",stroke:"#000",strokeWidth:"4px"},children:f})]},o.id)}if(o.type==="flash")return y.jsx("circle",{cx:d,cy:h,r:ee*2,fill:"#ffffff",className:"animate-flash"},o.id);if(o.type==="spear_trail"){const b=o.payload.path.map(x=>{const T=Ee(x,ee);return`${T.x},${T.y}`}).join(" ");return y.jsx("polyline",{points:b,fill:"none",stroke:"#ffffff",strokeWidth:"4",strokeLinecap:"round",className:"animate-spear-trail"},o.id)}return o.type==="vaporize"?m?y.jsx("image",{href:m,x:d-ee*.95,y:h-ee*.95,width:ee*1.9,height:ee*1.9,preserveAspectRatio:"xMidYMid meet",className:"animate-vaporize",opacity:"0.9"},o.id):y.jsxs("g",{children:[y.jsx("circle",{cx:d,cy:h,r:ee*.6,fill:"#f97316",className:"animate-vaporize",opacity:"0.8"}),y.jsx("circle",{cx:d,cy:h,r:ee*1.2,fill:"none",stroke:"#f97316",strokeWidth:"2",className:"animate-ping"})]},o.id):o.type==="lava_ripple"?m?y.jsx("image",{href:m,x:d-ee,y:h-ee,width:ee*2,height:ee*2,preserveAspectRatio:"xMidYMid meet",className:"animate-ping",opacity:"0.85"},o.id):y.jsx("circle",{cx:d,cy:h,r:ee*.8,fill:"none",stroke:"#ea580c",strokeWidth:"3",className:"animate-ping"},o.id):o.type==="explosion_ring"?m?y.jsx("image",{href:m,x:d-ee*1.35,y:h-ee*1.35,width:ee*2.7,height:ee*2.7,preserveAspectRatio:"xMidYMid meet",className:"animate-explosion-ring",opacity:"0.88"},o.id):y.jsx("circle",{cx:d,cy:h,r:ee*2.5,fill:"rgba(255, 120, 0, 0.2)",stroke:"#ffaa00",strokeWidth:"4",className:"animate-explosion-ring"},o.id):null})})},DE={"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|anticipation":{rendererId:"basic_attack_strike",ttlMs:130},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|travel":{rendererId:"basic_attack_strike",ttlMs:110},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|impact":{rendererId:"basic_attack_strike",ttlMs:180},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|aftermath":{rendererId:"basic_attack_strike",ttlMs:190},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|anticipation":{rendererId:"basic_attack_strike",ttlMs:100},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|travel":{rendererId:"basic_attack_strike",ttlMs:90},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|impact":{rendererId:"basic_attack_strike",ttlMs:140},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|aftermath":{rendererId:"basic_attack_strike",ttlMs:120},"ATK.SHOOT.PHYSICAL.ARROW|anticipation":{rendererId:"archer_shot_signature",ttlMs:110},"ATK.SHOOT.PHYSICAL.ARROW|travel":{rendererId:"archer_shot_signature",ttlMs:160,skipIfLegacyMirrored:!0},"ATK.SHOOT.PHYSICAL.ARROW|impact":{rendererId:"archer_shot_signature",ttlMs:150}},PE={"ATK.STRIKE.PHYSICAL.IMPACT":{rendererId:"impact",ttlMs:420,skipIfLegacyMirrored:!0},"ATK.STRIKE.PHYSICAL.HEAVY":{rendererId:"melee_lunge",ttlMs:280},"ATK.STRIKE.PHYSICAL.LIGHT":{rendererId:"impact",ttlMs:380},"ATK.SHOOT.PHYSICAL.SPEAR_TRAIL":{rendererId:"spear_trail",ttlMs:520,skipIfLegacyMirrored:!0},"ATK.SHOOT.PHYSICAL.SPEAR_RETURN":{rendererId:"spear_trail",ttlMs:520},"ATK.BLAST.FIRE.EXPLOSION_RING":{rendererId:"explosion_ring",ttlMs:980},"ATK.BLAST.FIRE.TIME_BOMB":{rendererId:"explosion_ring",ttlMs:980},"ATK.BLAST.FIRE.FIREBALL_IMPACT":{rendererId:"explosion_ring",ttlMs:740},"ATK.BLAST.VOID.CORPSE_EXPLOSION":{rendererId:"generic_ring",ttlMs:840},"ENV.HAZARD.FIRE.LAVA_RIPPLE":{rendererId:"lava_ripple",ttlMs:820},"ENV.COLLISION.KINETIC.WALL_CRACK":{rendererId:"wall_crack",ttlMs:700},"ENV.COLLISION.KINETIC.IMPACT":{rendererId:"wall_crack",ttlMs:520},"ATK.PULSE.KINETIC.WAVE":{rendererId:"kinetic_wave",ttlMs:540},"MOVE.DASH.NEUTRAL.BLUR":{rendererId:"dash_blur",ttlMs:320},"MOVE.DASH.NEUTRAL.SWIFT_ROLL":{rendererId:"dash_blur",ttlMs:320},"MOVE.DASH.KINETIC.MOMENTUM_TRAIL":{rendererId:"dash_blur",ttlMs:360},"STATE.FADE.SHADOW.HIDDEN":{rendererId:"hidden_fade",ttlMs:360},"STATE.FADE.SHADOW.SMOKE_SCREEN":{rendererId:"hidden_fade",ttlMs:420},"MOVE.BLINK.SHADOW.SHADOW_STEP":{rendererId:"hidden_fade",ttlMs:380},"MOVE.BLINK.ARCANE.SOUL_SWAP_ARRIVE":{rendererId:"flash",ttlMs:280},"MOVE.BLINK.ARCANE.SOUL_SWAP_DEPART":{rendererId:"flash",ttlMs:280},"STATE.APPLY.NEUTRAL.STUN_BURST":{rendererId:"generic_ring",ttlMs:560},"UI.TEXT.NEUTRAL.POPUP":{rendererId:"combat_text",ttlMs:1100},"UI.SHAKE.NEUTRAL.CAMERA":{rendererId:"none",ttlMs:1,skipIfLegacyMirrored:!0},"UI.FREEZE.NEUTRAL.HITSTOP":{rendererId:"none",ttlMs:1}},UE={"attack|shoot|physical|travel":{rendererId:"arrow_shot",ttlMs:320},"attack|shoot|arcane|travel":{rendererId:"arcane_bolt",ttlMs:340},"attack|shoot|fire|travel":{rendererId:"arcane_bolt",ttlMs:340},"attack|strike|physical|impact":{rendererId:"melee_lunge",ttlMs:260},"attack|blast|fire|impact":{rendererId:"explosion_ring",ttlMs:900},"attack|pulse|kinetic|impact":{rendererId:"kinetic_wave",ttlMs:520},"environment|collision|kinetic|impact":{rendererId:"wall_crack",ttlMs:700},"status|state_fade|shadow|instant":{rendererId:"hidden_fade",ttlMs:360},"ui|text|neutral|instant":{rendererId:"combat_text",ttlMs:1e3}},qE={"attack|blast|impact":{rendererId:"generic_ring",ttlMs:680},"attack|shoot|travel":{rendererId:"generic_line",ttlMs:300},"attack|strike|impact":{rendererId:"impact",ttlMs:400},"environment|hazard_burst|impact":{rendererId:"generic_ring",ttlMs:760},"status|status_apply|impact":{rendererId:"flash",ttlMs:320},"ui|text|instant":{rendererId:"combat_text",ttlMs:1e3}},$E={"movement|dash":{rendererId:"dash_blur",ttlMs:300},"movement|blink":{rendererId:"flash",ttlMs:260},"attack|pulse":{rendererId:"kinetic_wave",ttlMs:500},"attack|blast":{rendererId:"generic_ring",ttlMs:700},"attack|shoot":{rendererId:"generic_line",ttlMs:280},"attack|strike":{rendererId:"impact",ttlMs:380},"environment|collision":{rendererId:"wall_crack",ttlMs:650},"ui|text":{rendererId:"combat_text",ttlMs:1e3}},zE=new Set(["impact","flash","spearTrail","shake"]),VE=e=>{const n=`${e.signature}|${e.phase}`,a=DE[n];if(a)return{key:`sigp:${n}`,recipe:a};const o=PE[e.signature];if(o)return{key:`sig:${e.signature}`,recipe:o};const r=`${e.family}|${e.primitive}|${e.element||"neutral"}|${e.phase}`,c=UE[r];if(c)return{key:`fpel:${r}`,recipe:c};const d=`${e.family}|${e.primitive}|${e.phase}`,h=qE[d];if(h)return{key:`fpp:${d}`,recipe:h};const g=`${e.family}|${e.primitive}`,m=$E[g];return m?{key:`fp:${g}`,recipe:m}:{key:"fallback:none",recipe:{rendererId:"none",ttlMs:1}}},YE=({payload:e,reducedMotion:n})=>{const{key:a,recipe:o}=VE(e);if(o.skipIfLegacyMirrored&&e.meta?.legacyMirrored&&e.meta?.legacyJuiceId&&zE.has(String(e.meta.legacyJuiceId)))return null;let r=Math.max(1,Number(e.timing?.ttlMs??e.timing?.durationMs??o.ttlMs));return n&&(r=Math.max(1,Math.floor(r*.7))),{key:a,ttlMs:r,recipe:o,payload:e}},gd=e=>{const n=e?.hex;if(n&&typeof n.q=="number"&&typeof n.r=="number"&&typeof n.s=="number")return n},bd=e=>{const n=e?.world;if(n&&typeof n.x=="number"&&typeof n.y=="number")return n},KE=({incoming:e,now:n,reducedMotion:a,recentSignatureImpactByTile:o})=>{const r=[];return e.forEach((c,d)=>{if(c.type!=="juice_signature")return;const h=c.payload;if(!h||h.protocol!=="juice-signature/v1")return;const g=YE({payload:h,reducedMotion:a});if(!g||g.recipe.rendererId==="none")return;const m=gd(h.contact),f=gd(h.target),b=gd(h.source),x=bd(h.contact),T=bd(h.target),S=bd(h.source),A=m||f||b,O=x||T||S,_={id:`sig-${n}-${d}`,startTime:n+Math.max(0,Number(h.timing?.delayMs||0)),ttlMs:g.ttlMs};if((h.signature==="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"||h.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK")&&h.phase==="impact"&&f){const w=ue(f);o.set(w,{at:n,signature:h.signature})}const E=h.text?.value;switch(g.recipe.rendererId){case"basic_attack_strike":{if(!b||!f)return;r.push({..._,type:"basic_attack_strike",position:f,worldPosition:x||O,payload:{phase:h.phase,intensity:h.intensity||"medium",signature:h.signature,source:b,target:f,sourceActorId:h.source?.actorId,targetActorId:h.target?.actorId,contactWorld:x,contactHex:m,direction:h.direction,flags:h.flags||{}}});return}case"archer_shot_signature":{const w=f||m;if(!b||!w)return;r.push({..._,type:"archer_shot_signature",position:w,worldPosition:x||O,payload:{phase:h.phase,intensity:h.intensity||"medium",source:b,target:w,contactWorld:x,path:h.path||(h.area?.kind==="path"?h.area.points:void 0),signature:h.signature}});return}case"impact":case"flash":case"lava_ripple":case"explosion_ring":case"kinetic_wave":case"wall_crack":case"hidden_fade":case"generic_ring":{if(!A&&!O)return;r.push({..._,type:g.recipe.rendererId,position:A,worldPosition:O,payload:{signature:h.signature,color:h.text?.color,element:h.element,variant:h.variant,source:b,target:f}});return}case"combat_text":{if(!E||!A&&!O)return;r.push({..._,type:"combat_text",position:A,worldPosition:O,payload:{text:E,color:h.text?.color}});return}case"spear_trail":{if((!h.path||h.path.length===0)&&h.area?.kind!=="path")return;const w=h.path||(h.area?.kind==="path"?h.area.points:[]);if(!w||w.length===0)return;r.push({..._,type:"spear_trail",position:w[0],payload:{path:w}});return}case"melee_lunge":case"arrow_shot":case"arcane_bolt":case"generic_line":{const w=f||m;if(!w||!b)return;r.push({..._,type:g.recipe.rendererId,position:w,payload:{source:b,signature:h.signature,element:h.element}});return}case"dash_blur":{const w=h.path||(h.area?.kind==="path"?h.area.points:void 0);if(!w||w.length<2)return;r.push({..._,type:"dash_blur",position:w[w.length-1],payload:{path:w,source:w[0]}});return}default:return}}),r},FE=({incoming:e,now:n})=>{const a=[];return e.forEach((o,r)=>{const c=`juice-${n}-${r}`;o.type==="vfx"&&o.payload?.type==="impact"?o.payload.position&&a.push({id:c,type:"impact",position:o.payload.position,startTime:n}):o.type==="vfx"&&o.payload?.type==="flash"?o.payload.position&&a.push({id:c,type:"flash",position:o.payload.position,startTime:n}):o.type==="vfx"&&o.payload?.type==="spear_trail"?o.payload.path&&o.payload.path.length>0&&a.push({id:c,type:"spear_trail",position:o.payload.path[0],payload:o.payload,startTime:n}):o.type==="vfx"&&o.payload?.type==="vaporize"?o.payload.position&&a.push({id:c,type:"vaporize",position:o.payload.position,startTime:n}):o.type==="vfx"&&o.payload?.type==="lava_ripple"?o.payload.position&&a.push({id:c,type:"lava_ripple",position:o.payload.position,startTime:n}):o.type==="vfx"&&o.payload?.type==="explosion_ring"&&o.payload.position&&a.push({id:c,type:"explosion_ring",position:o.payload.position,startTime:n})}),a},XE=({incoming:e,now:n,startIndex:a,actorById:o,recentSignatureImpactByTile:r,classifyDamageCueType:c})=>{const d=[];return e.forEach((h,g)=>{if(h.type!=="DamageTaken"||!h.position)return;const m=h.position,f=String(h.payload?.sourceId||""),b=f?o.get(f):void 0,x=String(h.payload?.reason||""),T=r.get(ue(m)),S=T?.signature==="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"||T?.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK",A=!!(T&&S&&n-T.at<=260),O=x.includes("basic_attack")||x.includes("auto_attack");if(b?.position){const _=Ee(b.position,ee),E=Ee(m,ee),w=Math.hypot(E.x-_.x,E.y-_.y),C=A&&O?null:c(b.subtype,x,w);C&&d.push({id:`sim-cue-${n}-${a+g}`,type:C,position:m,payload:{source:b.position,sourceSubtype:b.subtype,reason:x},startTime:n})}A&&O||d.push({id:`sim-impact-${n}-${a+g}`,type:"impact",position:m,startTime:n})}),d},WE=e=>new Promise(n=>setTimeout(n,e)),GE=e=>{if(!e)return null;const n=e.position||e.destination||e.origin||e.target;return n&&typeof n.q=="number"&&typeof n.r=="number"&&typeof n.s=="number"?n:null},ig=e=>{if(e.ttlMs&&e.ttlMs>0)return e.ttlMs;const n=e.type;return n==="basic_attack_strike"?180:n==="archer_shot_signature"?170:n==="impact"?400:n==="combat_text"?1e3:n==="flash"?300:n==="melee_lunge"?240:n==="arrow_shot"?260:n==="arcane_bolt"?320:n==="kinetic_wave"?520:n==="wall_crack"?700:n==="dash_blur"?320:n==="hidden_fade"?360:n==="generic_ring"?700:n==="generic_line"?280:n==="spear_trail"?500:n==="vaporize"?600:n==="lava_ripple"?800:n==="explosion_ring"?1e3:2e3},ag=.72,JE=(e,n,a)=>{const o=String(e||"").toLowerCase(),r=String(n||"").toLowerCase();return r.includes("lava")||r.includes("fire")||r.includes("hazard")||r.includes("burn")||r.includes("crush")||r.includes("collision")||o==="bomber"||r.includes("bomb")||r.includes("explosion")?null:o==="warlock"||r.includes("arcane")||r.includes("force")||r.includes("spell")?"arcane_bolt":o==="archer"||r.includes("arrow")||r.includes("spear_throw")?"arrow_shot":a<=ee*2.05||r.includes("basic_attack")||r.includes("melee")?"melee_lunge":null},QE=({visualEvents:e,timelineEvents:n=[],simulationEvents:a=[],actorSnapshots:o=[],onBusyStateChange:r,assetManifest:c})=>{const[d,h]=k.useState([]),g=k.useRef(null),m=k.useRef(null),f=k.useRef(null),b=k.useRef(0),x=k.useRef([]),T=k.useRef(!1),[S,A]=k.useState(!1),O=k.useRef(!1),_=k.useRef(new Map),E=k.useRef(null),w=k.useRef(Date.now()),C=k.useRef(new Map),I=650,N=3500,H=k.useMemo(()=>{const P=new Map;for(const Y of c?.assets||[])P.set(Y.id,Y);return P},[c]),D=k.useMemo(()=>{const P=new Map;for(const Y of o)P.set(Y.id,Y);return P},[o]);k.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const P=window.matchMedia("(prefers-reduced-motion: reduce)"),Y=()=>{O.current=P.matches};return Y(),P.addEventListener?.("change",Y),()=>P.removeEventListener?.("change",Y)},[]),k.useEffect(()=>{if(!e.length)return;const P=new Map(_.current),Y=Date.now();for(const F of e){if(F.type!=="kinetic_trace")continue;const Z=F.payload;if(!Z?.actorId)continue;const z=Number(Z.durationMs??0);z>0&&P.set(String(Z.actorId),{durationMs:z,seenAt:Y})}_.current=P},[e]),k.useEffect(()=>{r?.(S)},[S,r]);const G=P=>{const Y=Date.now(),F=GE(P.payload);if(!F)return;const Z=[],z=`${P.id}:${Y}`;P.phase==="HAZARD_CHECK"?Z.push({id:`${z}:haz`,type:"combat_text",position:F,payload:{text:"!"},startTime:Y}):P.phase==="DEATH_RESOLVE"&&Z.push({id:`${z}:vapor`,type:"vaporize",position:F,startTime:Y}),Z.length>0&&h(q=>[...q,...Z])};return k.useEffect(()=>{if(!n.length||g.current===n)return;g.current=n;const P=n;P.length&&(x.current.push(...P),!T.current&&(T.current=!0,A(!0),(async()=>{try{const Y=Date.now();for(;x.current.length>0;){if(Date.now()-Y>N){console.warn("[HOP_JUICE] Timeline queue exceeded runtime budget; flushing remaining events.",{queued:x.current.length});break}const F=x.current.shift();G(F);let Z=F.blocking?Math.round((F.suggestedDurationMs??140)*ag):0;if(F.phase==="MOVE_END"){const $=F.payload?.targetActorId;if($){const X=_.current.get($),le=X?Date.now()-X.seenAt<=2500:!1;X&&le&&X.durationMs>0&&(Z=Math.max(Z,Math.min(I,Math.round(X.durationMs*ag))))}}let z=0;F.phase==="MOVE_END"?z=Math.min(460,Math.max(70,Z)):F.phase==="DEATH_RESOLVE"?z=Math.min(120,Math.max(55,Z)):F.phase==="DAMAGE_APPLY"?z=Math.min(80,Math.max(35,Z)):F.phase==="HAZARD_CHECK"?z=Math.min(70,Math.max(30,Z)):F.blocking&&(z=Math.min(70,Math.max(0,Z)));const q=F.phase==="MOVE_END"?Z:O.current?Math.min(70,Math.floor(z*.5)):z,B=Math.max(0,Math.min(I,q));B>0&&await WE(B)}}catch(Y){console.error("[HOP_JUICE] Timeline queue processing failed; releasing busy lock.",Y)}finally{x.current=[],T.current=!1,A(!1)}})()))},[n]),k.useEffect(()=>{if(f.current===e)return;f.current=e;const P=e;if(!P.length)return;const Y=Date.now(),F=KE({incoming:P,now:Y,reducedMotion:O.current,recentSignatureImpactByTile:C.current});F.length>0&&h(Z=>[...Z,...F])},[e]),k.useEffect(()=>{if(n.length>0){m.current=e;return}if(m.current===e)return;m.current=e;const P=e;if(!P.length)return;const Y=Date.now(),F=FE({incoming:P,now:Y});F.length>0&&h(Z=>[...Z,...F])},[e,n.length]),k.useEffect(()=>{a.length<b.current&&(b.current=0);const P=b.current;if(P>=a.length)return;const Y=a.slice(P);b.current=a.length;const F=Date.now(),Z=XE({incoming:Y,now:F,startIndex:P,actorById:D,recentSignatureImpactByTile:C.current,classifyDamageCueType:JE});Z.length>0&&h(z=>[...z,...Z])},[a,D]),k.useEffect(()=>{if(E.current!==null&&(window.clearTimeout(E.current),E.current=null),d.length===0)return;const P=Date.now();let Y=1/0;for(const Z of d){if(Z.startTime>P){const B=Z.startTime-P;B>0&&B<Y&&(Y=B);continue}const z=P-Z.startTime,q=ig(Z)-z;q>0&&q<Y&&(Y=q)}if(!Number.isFinite(Y)){h([]);return}const F=Math.max(16,Math.min(180,Math.floor(Y)));return E.current=window.setTimeout(()=>{const Z=Date.now();h(z=>{const q=w.current;w.current=Z;const B=z.filter(X=>Z<X.startTime+ig(X));return B.length!==z.length?B:z.some(X=>q<X.startTime&&X.startTime<=Z)?[...z]:z})},F),()=>{E.current!==null&&(window.clearTimeout(E.current),E.current=null)}},[d]),y.jsx(jE,{effects:d,assetById:H})},ZE=({gameState:e,latestTraceByActor:n,entityVisualPoseById:a,assetById:o,biomeThemeKey:r,juiceActorSnapshots:c,assetManifest:d,onJuiceBusyStateChange:h})=>y.jsxs("g",{children:[e.lastSpearPath&&e.lastSpearPath.length>=2&&(()=>{const m=e.lastSpearPath.map(f=>Ee(f,ee)).map((f,b)=>`${b===0?"M":"L"} ${f.x} ${f.y}`).join(" ");return y.jsx("path",{d:m,stroke:"rgba(255, 255, 255, 0.15)",strokeWidth:"2",fill:"none",strokeDasharray:"4 2",strokeLinecap:"round"})})(),e.spearPosition&&y.jsx(ul,{entity:{id:"spear",type:"player",subtype:"footman",position:e.spearPosition,hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],speed:0,factionId:"player"},isSpear:!0}),y.jsx(ul,{entity:e.player,movementTrace:n[e.player.id],waapiControlled:!0,visualPose:a.get(e.player.id),assetHref:o.get(oa(e.player))?.path,fallbackAssetHref:Ca(e.player),floorTheme:r},`player-${e.floor}`),e.enemies.map(g=>y.jsx(ul,{entity:g,movementTrace:n[g.id],waapiControlled:!0,visualPose:a.get(g.id),assetHref:o.get(oa(g))?.path,fallbackAssetHref:Ca(g),floorTheme:r},`${g.id}-${e.floor}`)),e.dyingEntities?.map(g=>y.jsx(ul,{entity:g,isDying:!0,movementTrace:n[g.id],waapiControlled:!0,visualPose:a.get(g.id),assetHref:o.get(oa(g))?.path,fallbackAssetHref:Ca(g),floorTheme:r},`dying-${g.id}-${e.floor}-${e.turnNumber}`)),y.jsx(QE,{visualEvents:e.visualEvents||[],timelineEvents:e.timelineEvents||[],simulationEvents:e.simulationEvents||[],actorSnapshots:c,onBusyStateChange:h,assetManifest:d},`juice-${e.floor}`)]}),xd=e=>{const n=[];for(let a=0;a<6;a++){const o=60*a,r=Math.PI/180*o,c=e*Math.cos(r),d=e*Math.sin(r);n.push(`${c},${d}`)}return n.join(" ")},e_=()=>typeof window>"u"?!1:!!window.__HOP_DEBUG_HEX_COORDS,t_=[{cx:-8,cy:-6,r:3,delay:0},{cx:6,cy:2,r:2.5,delay:.3},{cx:-3,cy:8,r:2,delay:.6}],n_=e=>{const n=[[-.6,.42],[-.5,.15],[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2],[.48,.1],[.6,.4],[.4,.48],[-.48,.48]],a=[[-.48,.48],[-.6,.42],[-.34,-.18],[-.18,-.24],[-.28,.28]],o=[[.6,.4],[.4,.48],[.2,.28],[.3,-.2],[.48,.1]],r=[[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2]],c=[[-.46,.1],[-.3,-.12],[-.1,-.24],[0,-.4]],d=h=>h.map(([g,m])=>`${(g*e).toFixed(2)},${(m*e).toFixed(2)}`).join(" ");return{body:d(n),leftFace:d(a),rightFace:d(o),ridgeA:d(r),ridgeB:d(c)}},i_=({hex:e,onClick:n,isValidMove:a,isTargeted:o,isStairs:r,isLava:c,isShrine:d,isWall:h,isFire:g,onMouseEnter:m,assetHref:f,interactionOnly:b})=>{const[x,T]=k.useState(!1);k.useEffect(()=>{T(!1)},[f]);const{x:S,y:A}=Ee(e,ee),O=e_(),_=xd(ee-2),E=n_(ee-2),w=`hex-clip-${e.q}-${e.r}-${e.s}`;let C=Jr.floor,I="rgba(0,0,0,0.2)",N="default";h?(C=Jr.wall,I="#1f2937"):c?(C="#7f1d1d",I="#7f1d1d"):g?(C="#7c2d12",I="#ea580c"):r?(C=Jr.portal,I="#000000"):d&&(C=Jr.shrine,I="#c2410c"),b&&(C="transparent",I="rgba(255,255,255,0.10)"),a&&(I="rgba(255,255,255,0.78)",N="pointer"),o&&(I="#f97316");const H=!!f&&!b&&!x;return y.jsxs("g",{transform:`translate(${S},${A})`,onClick:()=>n(e),onMouseEnter:()=>m?.(e),style:{cursor:N},className:"hex-tile transition-colors duration-200",children:[h&&H&&y.jsx("polygon",{points:xd(ee-2),fill:"#111827",transform:"translate(0, 4)"}),!H&&(h?y.jsxs("g",{"data-wall-fallback":"relief",children:[y.jsx("ellipse",{cx:"0",cy:ee*.56,rx:ee*.56,ry:ee*.18,fill:"rgba(3,7,18,0.55)"}),y.jsx("polygon",{points:_,fill:"#0f172a",transform:"translate(0, 5)",opacity:"0.92"}),y.jsx("polygon",{points:_,fill:"#1f2937",transform:"translate(0, 2)",opacity:"0.98"}),y.jsx("polygon",{points:_,fill:"#273447"}),y.jsx("polygon",{points:E.body,fill:"#4b5563",opacity:"0.96"}),y.jsx("polygon",{points:E.leftFace,fill:"#6b7280",opacity:"0.9"}),y.jsx("polygon",{points:E.rightFace,fill:"#374151",opacity:"0.95"}),y.jsx("polyline",{points:E.ridgeA,fill:"none",stroke:"rgba(229,231,235,0.55)",strokeWidth:"1.1",strokeLinecap:"round",strokeLinejoin:"round"}),y.jsx("polyline",{points:E.ridgeB,fill:"none",stroke:"rgba(17,24,39,0.58)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"}),y.jsx("polygon",{points:_,fill:"none",stroke:I,strokeWidth:o||a?"2":"1"})]}):y.jsx("polygon",{points:_,fill:C,stroke:I,strokeWidth:o||a?"2":"1"})),H&&y.jsxs(y.Fragment,{children:[y.jsx("defs",{children:y.jsx("clipPath",{id:w,children:y.jsx("polygon",{points:_})})}),y.jsx("image",{href:f,x:-ee,y:-31.176,width:ee*2,height:ee*1.732,preserveAspectRatio:"xMidYMid slice",clipPath:`url(#${w})`,onError:()=>T(!0)}),y.jsx("polygon",{points:_,fill:"none",stroke:I,strokeWidth:o||a?"2":"1"})]}),c&&!b&&y.jsxs("g",{className:"lava-bubbles",children:[t_.map((D,G)=>y.jsx("circle",{cx:D.cx,cy:D.cy,r:D.r,fill:"#fbbf24",opacity:"0.7",style:{animation:`lavaBubble 2s ease-in-out ${D.delay}s infinite`}},G)),y.jsx("polygon",{points:xd(ee-4),fill:"none",stroke:"#f97316",strokeWidth:"1",opacity:"0.35"})]}),g&&!b&&y.jsxs("g",{className:"fire-embers",children:[y.jsx("circle",{cx:"-6",cy:"4",r:"2",fill:"#fbbf24",opacity:"0.75",style:{animation:"lavaBubble 1.6s ease-in-out 0s infinite"}}),y.jsx("circle",{cx:"4",cy:"-6",r:"1.5",fill:"#fcd34d",opacity:"0.75",style:{animation:"lavaBubble 1.4s ease-in-out 0.5s infinite"}})]}),O&&y.jsx("text",{x:"0",y:"0",textAnchor:"middle",fill:"rgba(0,0,0,0.15)",fontSize:"8",dy:".3em",pointerEvents:"none",children:`${e.q},${e.r}`})]})},a_=Fn.memo(i_,(e,n)=>e.hex.q===n.hex.q&&e.hex.r===n.hex.r&&e.hex.s===n.hex.s&&e.onClick===n.onClick&&e.onMouseEnter===n.onMouseEnter&&e.isCenter===n.isCenter&&e.isSelected===n.isSelected&&e.isValidMove===n.isValidMove&&e.isTargeted===n.isTargeted&&e.isStairs===n.isStairs&&e.isLava===n.isLava&&e.isShrine===n.isShrine&&e.isWall===n.isWall&&e.isFire===n.isFire&&e.assetHref===n.assetHref&&e.interactionOnly===n.interactionOnly),s_=({gameState:e,selectedSkillId:n,showMovementRange:a,hoveredTile:o,enginePreviewGhost:r})=>{const c=e.player.position,d=k.useMemo(()=>{const x=new Set;for(const T of e.enemies)T.hp>0&&x.add(ue(T.position));return x},[e.enemies]),h=k.useMemo(()=>{if(!a||n)return[];const x=new Set(e.player.activeSkills.map(O=>O.id)),T=["BASIC_MOVE","DASH"],S=new Set,A=[];return T.forEach(O=>{if(x.has(O)){const _=Xt.get(O);_?.getValidTargets&&_.getValidTargets(e,c).forEach(w=>{const C=ue(w);S.has(C)||(S.add(C),A.push(w))})}}),A.length===0?[{q:c.q+1,r:c.r,s:c.s-1},{q:c.q+1,r:c.r-1,s:c.s},{q:c.q,r:c.r-1,s:c.s+1},{q:c.q-1,r:c.r,s:c.s+1},{q:c.q-1,r:c.r+1,s:c.s},{q:c.q,r:c.r+1,s:c.s-1}].filter(_=>la(_,e.gridWidth,e.gridHeight)):A},[e,a,n,c]),g=k.useMemo(()=>{const x=new Set;for(const T of h)x.add(ue(T));return x},[h]),m=k.useMemo(()=>{if(!n)return[];const x=Xt.get(n),T=c1(e.player,n)||x?.baseVariables?.range||0,S=x?.getValidTargets?x.getValidTargets(e,c):[],A=new Set(S.map(ue)),O=[];if(n==="DASH"||n==="SPEAR_THROW"||n==="SHIELD_THROW"||n==="GRAPPLE_HOOK")for(let E=0;E<6;E++)for(let w=1;w<=T;w++){const C=rn(c,Pd(E,w));if(!la(C,e.gridWidth,e.gridHeight))break;const I=Ne.isLosBlocking(e,C),N=d.has(ue(C)),G=ht(c,C).slice(1,-1).some(Y=>Ne.isLosBlocking(e,Y)||d.has(ue(Y))),P=A.has(ue(C));if(O.push({p:C,isValidTarget:P,isBlocked:G,isWall:I,isEnemy:N}),I||N)break}else S.forEach(E=>{const w=Ne.isLosBlocking(e,E),C=d.has(ue(E));O.push({p:E,isValidTarget:!0,isBlocked:!1,isWall:w,isEnemy:C})});return O},[e,n,c,d]),f=k.useMemo(()=>{const x=new Map;for(const T of m)x.set(ue(T.p),T);return x},[m]),b=k.useMemo(()=>{if(r)return r;if(a&&o&&!n&&g.has(ue(o)))return{path:ht(c,o),aoe:[],hasEnemy:!1,target:o};if(!n||!o)return null;const x=f.get(ue(o));if(!x||!x.isValidTarget||x.isBlocked)return null;const T=ht(c,o),S=Zx(e,n,c,o),A=x.isEnemy;return{path:T,aoe:S,hasEnemy:A,target:o}},[r,e,n,o,f,g,a,c]);return y.jsx("g",{pointerEvents:"none",children:b&&y.jsxs("g",{children:[(()=>{const x=b.path.map(E=>Ee(E,ee)),T=x.map((E,w)=>`${w===0?"M":"L"} ${E.x} ${E.y}`).join(" "),S=x[x.length-1],A=x[x.length-2]||{x:S.x-1,y:S.y},O=Math.atan2(S.y-A.y,S.x-A.x),_=8;return y.jsxs("g",{children:[y.jsx("path",{d:T,stroke:"rgba(255,255,255,0.9)",strokeWidth:"2.25",fill:"none",opacity:"0.85",style:{filter:"drop-shadow(0 0 4px rgba(255,255,255,0.22))"}}),y.jsx("path",{d:`M ${S.x} ${S.y} L ${S.x-_*Math.cos(O-Math.PI/6)} ${S.y-_*Math.sin(O-Math.PI/6)} M ${S.x} ${S.y} L ${S.x-_*Math.cos(O+Math.PI/6)} ${S.y-_*Math.sin(O+Math.PI/6)}`,stroke:"rgba(255,255,255,0.95)",strokeWidth:"2",opacity:"0.9"})]})})(),b.hasEnemy&&(()=>{const{x,y:T}=Ee(b.target,ee),S=ee*.7;return y.jsxs("g",{children:[y.jsx("circle",{cx:x,cy:T,r:S,fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4 2"}),y.jsx("line",{x1:x-S,y1:T,x2:x+S,y2:T,stroke:"#ef4444",strokeWidth:"1"}),y.jsx("line",{x1:x,y1:T-S,x2:x,y2:T+S,stroke:"#ef4444",strokeWidth:"1"})]})})(),!b.hasEnemy&&(()=>{const{x,y:T}=Ee(b.target,ee);return y.jsx("circle",{cx:x,cy:T,r:ee*.36,fill:"rgba(255,255,255,0.14)",stroke:"rgba(255,255,255,0.65)",strokeWidth:1.5})})(),Array.from(new Map(b.aoe.map(x=>[ue(x),x])).values()).map(x=>{const{x:T,y:S}=Ee(x,ee);return y.jsx("circle",{cx:T,cy:S,r:ee*.6,fill:"rgba(239, 68, 68, 0.2)",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,strokeDasharray:"4 2"},`aoe-${x.q}-${x.r}`)})]})})},o_=({gameState:e,selectedSkillId:n,showMovementRange:a,hoveredTile:o,enginePreviewGhost:r,cells:c,tileVisualFlags:d,movementTargetSet:h,hasPrimaryMovementSkills:g,fallbackNeighborSet:m,selectedSkillTargetSet:f,stairsKey:b,shrineKey:x,mountainCoveredWallKeys:T,hybridInteractionLayerEnabled:S,assetById:A,onTileClick:O,onTileHover:_,decals:E})=>y.jsxs(y.Fragment,{children:[y.jsx("g",{"data-layer":"interaction-preview",children:y.jsx(s_,{gameState:e,selectedSkillId:n,showMovementRange:a,hoveredTile:o,enginePreviewGhost:r})}),y.jsxs("g",{"data-layer":"interaction-tiles",children:[c.map(w=>{const C=ue(w),I=d.get(C)||{isWall:!1,isLava:!1,isFire:!1},N=I.isWall,H=I.isLava,D=I.isFire,G=a&&!n&&h.has(C)||a&&!n&&!g&&m.has(C)&&!N,Y=!!n&&f.has(C)||G,F=C===b,Z=x?C===x:!1,z=N&&!T.has(C),q=S&&!z,B=kE({isWall:z,isLava:H,isFire:D,theme:e.theme}),$=q?void 0:A.get(B)?.path;return y.jsx(a_,{hex:w,onClick:O,isValidMove:Y,isTargeted:!1,isStairs:F,isLava:H,isFire:D,isShrine:Z,isWall:z,onMouseEnter:_,assetHref:$,interactionOnly:q},C)}),y.jsx("g",{children:E.map(w=>{const{x:C,y:I}=Ee(w.position,ee),N=Date.now()-w.createdAt,H=Math.max(.18,.75-N/12e3*.57);return y.jsx("image",{href:w.href,x:C-ee*.7,y:I-ee*.7,width:ee*1.4,height:ee*1.4,preserveAspectRatio:"xMidYMid meet",opacity:H},w.id)})})]})]}),r_=({cells:e,gridPoints:n})=>y.jsx("g",{"data-layer":"interaction-ui-grid",pointerEvents:"none",shapeRendering:"crispEdges",children:e.map(a=>{const{x:o,y:r}=Ee(a,ee);return y.jsx("g",{transform:`translate(${o},${r})`,children:y.jsx("polygon",{points:n,fill:"none",stroke:"rgba(201,224,255,0.12)",strokeWidth:.9})},`grid-${ue(a)}`)})}),l_=e=>e.replace(/[^a-zA-Z0-9_-]/g,"-"),c_=({sprites:e,floor:n,manifestUnitToBoardScale:a,mountainSettingsByAssetId:o,resolveMountainSettings:r})=>y.jsx("g",{"data-layer":"clutter-obstacles",pointerEvents:"none",children:e.map(c=>{const{x:d,y:h}=Ee(c.position,ee);if(c.asset?.path){const g=Math.min(1,Math.max(0,c.asset.anchor?.x??.5)),m=Math.min(1,Math.max(0,c.asset.anchor?.y??.5)),f=c.kind==="mountain",b=f?o.get(c.asset.id)||r(c.asset):null,x=b?b.anchorX:g,T=b?b.anchorY:m,S=d+(b?b.offsetX:0),A=h+(b?b.offsetY:0),O=Math.max(8,c.asset.width*a*c.renderScale),_=Math.max(8,c.asset.height*a*c.renderScale),E=c.kind==="shrine",w=c.kind==="stairs",C=E||w,I=E?"rgba(251,146,60,0.25)":"rgba(74,222,128,0.22)",N=E?"#fdba74":"#86efac",H=d,D=h-_*T+_*.84,G=Math.max(14,O*.32),P=Math.max(8,_*.14);return y.jsxs("g",{children:[C&&y.jsxs(y.Fragment,{children:[y.jsx("ellipse",{cx:H,cy:D,rx:G,ry:P,fill:I,opacity:.95}),y.jsx("ellipse",{cx:H,cy:D,rx:G*1.14,ry:P*1.14,fill:"none",stroke:N,strokeWidth:2,opacity:.72,style:{animation:`shrineGlow ${E?1.8:2.4}s ease-in-out infinite`}})]}),(()=>{const Y=C?E?"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(251,146,60,0.45)) saturate(1.08) contrast(1.06)":"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(74,222,128,0.42)) saturate(1.08) contrast(1.06)":f?"drop-shadow(0 7px 10px rgba(0,0,0,0.56)) saturate(1.04) contrast(1.08)":"drop-shadow(0 5px 8px rgba(0,0,0,0.48)) saturate(0.98) contrast(1.04)",F=C?.99:f?.96:.9,Z=!!(b&&b.crustBlendMode!=="off"&&b.crustBlendOpacity>0),z=!!(b&&b.tintBlendMode!=="off"&&b.tintOpacity>0),q=b?.crustBlendMode!=="off"?b?.crustBlendMode:void 0,B=b?.tintBlendMode!=="off"?b?.tintBlendMode:void 0,$=S-O*x,X=A-_*T,le=l_(c.id),fe=`mountain-ground-gradient-${n}-${le}`,R=`mountain-ground-mask-${n}-${le}`,W=`mountain-tint-filter-${n}-${le}`;return y.jsxs(y.Fragment,{children:[(Z||z)&&y.jsxs("defs",{children:[Z&&y.jsxs(y.Fragment,{children:[y.jsxs("linearGradient",{id:fe,x1:"0",y1:"0",x2:"0",y2:"1",children:[y.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0"}),y.jsx("stop",{offset:"42%",stopColor:"#ffffff",stopOpacity:"0.04"}),y.jsx("stop",{offset:"64%",stopColor:"#ffffff",stopOpacity:"0.42"}),y.jsx("stop",{offset:"82%",stopColor:"#ffffff",stopOpacity:"0.82"}),y.jsx("stop",{offset:"100%",stopColor:"#ffffff",stopOpacity:"1"})]}),y.jsx("mask",{id:R,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:y.jsx("rect",{x:$,y:X,width:O,height:_,fill:`url(#${fe})`})})]}),z&&y.jsx("filter",{id:W,x:"-10%",y:"-10%",width:"120%",height:"120%",children:y.jsx("feColorMatrix",{type:"matrix",values:b?.tintMatrixValues})})]}),y.jsx("image",{href:c.asset.path,x:$,y:X,width:O,height:_,preserveAspectRatio:"xMidYMid meet",opacity:F,style:{filter:Y}}),Z&&y.jsx("image",{href:c.asset.path,x:$,y:X,width:O,height:_,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.9,b?.crustBlendOpacity||0),mask:`url(#${R})`,style:{mixBlendMode:q,filter:"brightness(0.92) saturate(0.76) contrast(1.03)"}}),z&&y.jsx("image",{href:c.asset.path,x:$,y:X,width:O,height:_,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.95,b?.tintOpacity||0),filter:`url(#${W})`,style:{mixBlendMode:B}})]})})()]},c.id)}return c.fallback==="shrine"?y.jsxs("g",{transform:`translate(${d},${h})`,children:[y.jsx("polygon",{points:"0,-18 8,-4 5,12 -5,12 -8,-4",fill:"#f97316",stroke:"#fff",strokeWidth:"1",opacity:"0.9"}),y.jsx("polygon",{points:"-2,-14 2,-14 1,-2 -1,-2",fill:"rgba(255,255,255,0.6)"}),y.jsx("circle",{cx:"0",cy:"0",r:"14",fill:"none",stroke:"#fdba74",strokeWidth:"2",opacity:"0.4",style:{animation:"shrineGlow 2s ease-in-out infinite"}})]},c.id):y.jsxs("g",{transform:`translate(${d},${h})`,children:[y.jsx("rect",{x:"-12",y:"6",width:"8",height:"4",fill:"#1f2937",rx:"1"}),y.jsx("rect",{x:"-6",y:"2",width:"8",height:"4",fill:"#374151",rx:"1"}),y.jsx("rect",{x:"0",y:"-2",width:"8",height:"4",fill:"#4b5563",rx:"1"}),y.jsx("rect",{x:"6",y:"-6",width:"8",height:"4",fill:"#6b7280",rx:"1"}),y.jsx("path",{d:"M 2 -14 L 2 -20 L -4 -20 L 2 -26 L 8 -20 L 2 -20",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1"})]},c.id)})}),u_=({cells:e,biomeClipId:n,biomeClipPoints:a,maskHexPoints:o,biomeFrame:r,biomeCoverFrame:c,undercurrentHref:d,undercurrentMode:h,undercurrentPatternId:g,undercurrentScalePx:m,undercurrentOffset:f,undercurrentScroll:b,undercurrentOpacity:x,crustHref:T,crustMode:S,crustPatternId:A,crustScalePx:O,crustPatternShift:_,crustOpacity:E,crustDetailAHref:w,crustDetailAMode:C,crustDetailAPatternId:I,crustDetailAScalePx:N,crustDetailAShift:H,crustDetailAScroll:D,crustDetailAOpacity:G,crustDetailBHref:P,crustDetailBMode:Y,crustDetailBPatternId:F,crustDetailBScalePx:Z,crustDetailBShift:z,crustDetailBScroll:q,crustDetailBOpacity:B,crustMaskEnabled:$,crustMaskId:X,crustMaskHoles:le,crustTintActive:fe,crustTintColor:R,crustTintOpacity:W,crustTintBlendMode:Q})=>y.jsxs(y.Fragment,{children:[y.jsxs("defs",{children:[y.jsx("clipPath",{id:n,clipPathUnits:"userSpaceOnUse",children:e.map(ne=>{const{x:re,y:ce}=Ee(ne,ee);return y.jsx("polygon",{points:a,transform:`translate(${re},${ce})`},`biome-clip-${ue(ne)}`)})}),d&&h==="repeat"&&y.jsxs("pattern",{id:g,patternUnits:"userSpaceOnUse",width:m,height:m,patternTransform:`translate(${f.x} ${f.y})`,children:[y.jsx("image",{href:d,x:"0",y:"0",width:m,height:m,preserveAspectRatio:"xMidYMid slice"}),(b.x!==0||b.y!==0)&&y.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${f.x} ${f.y}`,to:`${f.x+b.x} ${f.y+b.y}`,dur:`${b.durationMs}ms`,repeatCount:"indefinite"})]}),T&&S==="repeat"&&y.jsx("pattern",{id:A,patternUnits:"userSpaceOnUse",width:O,height:O,patternTransform:`translate(${_.x} ${_.y})`,children:y.jsx("image",{href:T,x:"0",y:"0",width:O,height:O,preserveAspectRatio:"xMidYMid slice"})}),w&&C==="repeat"&&y.jsxs("pattern",{id:I,patternUnits:"userSpaceOnUse",width:N,height:N,patternTransform:`translate(${H.x} ${H.y})`,children:[y.jsx("image",{href:w,x:"0",y:"0",width:N,height:N,preserveAspectRatio:"xMidYMid slice"}),(D.x!==0||D.y!==0)&&y.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${H.x} ${H.y}`,to:`${H.x+D.x} ${H.y+D.y}`,dur:`${D.durationMs}ms`,repeatCount:"indefinite"})]}),P&&Y==="repeat"&&y.jsxs("pattern",{id:F,patternUnits:"userSpaceOnUse",width:Z,height:Z,patternTransform:`translate(${z.x} ${z.y})`,children:[y.jsx("image",{href:P,x:"0",y:"0",width:Z,height:Z,preserveAspectRatio:"xMidYMid slice"}),(q.x!==0||q.y!==0)&&y.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${z.x} ${z.y}`,to:`${z.x+q.x} ${z.y+q.y}`,dur:`${q.durationMs}ms`,repeatCount:"indefinite"})]}),$&&y.jsxs("mask",{id:X,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",x:c.x,y:c.y,width:c.width,height:c.height,children:[y.jsx("rect",{x:c.x,y:c.y,width:c.width,height:c.height,fill:"white"}),le.map(ne=>y.jsx("polygon",{points:o,transform:`translate(${ne.x},${ne.y})`,fill:"black",opacity:1},`hole-${ne.key}`))]})]}),y.jsxs("g",{"data-layer":"biome-undercurrent",pointerEvents:"none",clipPath:`url(#${n})`,children:[d&&h==="repeat"&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${g})`,opacity:x}),d&&h==="cover"&&y.jsx("image",{href:d,x:c.x+f.x,y:c.y+f.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:x})]}),y.jsxs("g",{"data-layer":"biome-crust",pointerEvents:"none",clipPath:`url(#${n})`,children:[T&&S==="repeat"&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${A})`,opacity:E,mask:`url(#${X})`}),T&&S==="cover"&&y.jsx("image",{href:T,x:c.x+_.x,y:c.y+_.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:E,mask:`url(#${X})`}),w&&C==="repeat"&&G>0&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${I})`,opacity:G,mask:`url(#${X})`}),w&&C==="cover"&&G>0&&y.jsx("image",{href:w,x:c.x+H.x,y:c.y+H.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:G,mask:`url(#${X})`}),P&&Y==="repeat"&&B>0&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${F})`,opacity:B,mask:`url(#${X})`}),P&&Y==="cover"&&B>0&&y.jsx("image",{href:P,x:c.x+z.x,y:c.y+z.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:B,mask:`url(#${X})`}),fe&&R&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:R,opacity:W,mask:`url(#${X})`,style:Q!=="normal"?{mixBlendMode:Q}:void 0})]})]}),d_=({svgRef:e,onMove:n,zoomPreset:a,setHoveredTile:o,setIsCameraPanning:r,cameraPanOffsetRef:c,isCameraPanningRef:d,isPinchingRef:h,suppressTileClickUntilRef:g,activePointersRef:m,dragStateRef:f,pinchStateRef:b,animateCameraToTarget:x,updatePanFromWorldDelta:T,setZoomPresetAnimated:S})=>{const A=k.useCallback((P,Y)=>{const F=e.current;if(!F||!F.getScreenCTM)return null;const Z=F.getScreenCTM();if(!Z)return null;const z=F.createSVGPoint();z.x=P,z.y=Y;const q=z.matrixTransform(Z.inverse());return{x:q.x,y:q.y}},[e]),O=k.useCallback(()=>{c.current={x:0,y:0},x({panOffset:{x:0,y:0},durationMs:220})},[x,c]),_=k.useCallback(P=>{Date.now()<g.current||n(P)},[n,g]),E=k.useCallback(P=>{d.current||h.current||o(P)},[d,h,o]),w=k.useCallback(()=>Array.from(m.current.entries()),[m]),C=k.useCallback(P=>{if(P.pointerType==="mouse"&&P.button!==0)return;if(m.current.set(P.pointerId,{x:P.clientX,y:P.clientY}),P.pointerType!=="mouse")try{P.currentTarget.setPointerCapture(P.pointerId)}catch{}const Y=w();if(Y.length>=2){h.current=!0,d.current=!1,r(!1),f.current.didPan=!0,g.current=Date.now()+250;const[F,Z]=Y,z=F[1].x-Z[1].x,q=F[1].y-Z[1].y;b.current={startDistance:Math.hypot(z,q),startPreset:a,appliedPreset:a};return}f.current={activePointerId:P.pointerId,startClient:{x:P.clientX,y:P.clientY},lastWorld:A(P.clientX,P.clientY),didPan:!1}},[m,A,f,w,d,h,b,r,g,a]),I=k.useCallback(P=>{if(!m.current.has(P.pointerId))return;m.current.set(P.pointerId,{x:P.clientX,y:P.clientY});const Y=w();if(h.current||Y.length>=2){if(Y.length>=2){h.current=!0;const[le,fe]=Y,R=le[1].x-fe[1].x,W=le[1].y-fe[1].y,Q=Math.max(1,Math.hypot(R,W));if(!b.current)b.current={startDistance:Q,startPreset:a,appliedPreset:a};else{const ne=Q/Math.max(1,b.current.startDistance);let re=b.current.startPreset;ne>1.08&&(re=7),ne<.92&&(re=11),re!==b.current.appliedPreset&&(b.current.appliedPreset=re,S(re))}g.current=Date.now()+250,P.preventDefault()}return}const F=f.current;if(!F.startClient||F.activePointerId!==P.pointerId)return;const Z=P.clientX-F.startClient.x,z=P.clientY-F.startClient.y,q=Math.hypot(Z,z);if(!F.didPan&&q>10&&(F.didPan=!0,d.current=!0,r(!0),g.current=Date.now()+250,o(null)),!F.didPan)return;const $=A(P.clientX,P.clientY);if(!F.lastWorld||!$)return;const X={x:F.lastWorld.x-$.x,y:F.lastWorld.y-$.y};F.lastWorld=$,T(X),P.preventDefault()},[m,A,f,w,d,h,b,o,r,S,g,T,a]),N=k.useCallback(P=>{m.current.delete(P);const Y=w();Y.length<2&&(h.current=!1,b.current=null);const F=f.current;F.activePointerId===P&&(F.didPan&&(g.current=Date.now()+250),f.current={activePointerId:Y[0]?.[0]??null,startClient:Y[0]?{...Y[0][1]}:null,lastWorld:Y[0]?A(Y[0][1].x,Y[0][1].y):null,didPan:!1}),m.current.size===0&&(d.current=!1,r(!1))},[m,A,f,w,d,h,b,r,g]),H=k.useCallback(P=>{N(P.pointerId);try{P.currentTarget.releasePointerCapture(P.pointerId)}catch{}},[N]),D=k.useCallback(P=>{N(P.pointerId)},[N]),G=k.useCallback(P=>{if((P.ctrlKey||P.deltaY!==0)&&P.preventDefault(),Math.abs(P.deltaY)<.1)return;const Y=P.deltaY<0?7:11;S(Y),g.current=Date.now()+120},[S,g]);return{handleResetView:O,handleTileClick:_,handleHoverTile:E,handleBoardPointerDown:C,handleBoardPointerMove:I,handleBoardPointerUp:H,handleBoardPointerCancel:D,handleBoardWheel:G}},f_=[7,11],sg=(e,n,a)=>e<n?n:e>a?a:e,m_=e=>({top:Math.max(0,Number(e?.top??0)),right:Math.max(0,Number(e?.right??0)),bottom:Math.max(0,Number(e?.bottom??0)),left:Math.max(0,Number(e?.left??0))}),Wd=e=>{const n=m_(e.insets),a=Math.max(1,Number(e.width||0)-n.left-n.right),o=Math.max(1,Number(e.height||0)-n.top-n.bottom);return{width:a,height:o,insets:n}},p_=(e,n,a=0)=>{const o=Math.max(1,n),r=1.5*o,c=2*o;return(Math.max(1,e)-1)*r+c+Math.max(0,a)*2},h_=(e,n,a,o=0)=>{const r=Wd(e),c=p_(n,a,o);return r.width/Math.max(1,c)},y_=(e,n)=>{const a=Wd(e),o=Math.max(1,n.width),r=Math.max(1,n.height);return Math.min(a.width/o,a.height/r)},g_=(e,n)=>({x:e.x-n,y:e.y-n,width:e.width+n*2,height:e.height+n*2}),b_=(e,n)=>{const a=Math.max(1e-6,e),o=Math.max(1e-6,n);return Math.max(a,o)},og=(e,n)=>{const a=Wd(e),o=Math.max(1e-6,n);return{width:a.width/o,height:a.height/o}},x_=(e,n,a)=>{const o=n.width/2,r=n.height/2,c=a.x+o,d=a.x+a.width-o,h=a.y+r,g=a.y+a.height-r;return{x:c>d?a.x+a.width/2:sg(e.x,c,d),y:h>g?a.y+a.height/2:sg(e.y,h,g)}},rg=(e,n)=>({x:e.x-n.width/2,y:e.y-n.height/2,width:n.width,height:n.height}),v_=({baseViewBox:e,playerWorld:n,playerPosition:a,floor:o,cameraSafeInsetsPx:r})=>{const[c,d]=k.useState(11),[h,g]=k.useState({width:0,height:0}),[m,f]=k.useState(!1),b=k.useRef(null),x=k.useRef(null),T=k.useRef(null),S=k.useRef(null),A=k.useRef({x:0,y:0}),O=k.useRef(!1),_=k.useRef(!1),E=k.useRef(0),w=k.useRef(new Map),C=k.useRef({activePointerId:null,startClient:null,lastWorld:null,didPan:!1}),I=k.useRef(null),N=k.useRef(null),H=k.useRef(null),D=k.useRef(!1),G=k.useRef(""),P=k.useRef(""),Y=k.useRef(11),F=k.useRef(!1),Z=k.useCallback(()=>{S.current!==null&&(window.cancelAnimationFrame(S.current),S.current=null),F.current=!1},[]),z=k.useCallback(Q=>{const ne=b.current;ne&&ne.setAttribute("viewBox",`${Q.x} ${Q.y} ${Q.width} ${Q.height}`)},[]),q=k.useCallback(Q=>{T.current=Q,z(Q.viewBox)},[z]),B=k.useCallback(Q=>{const ne=Math.max(1,h.width),re=Math.max(1,h.height),ce=Q?.zoomPreset??c,me=Q?.panOffset??A.current,ve={width:ne,height:re,insets:r||{}},_e=ee*.75,ke=g_(e,_e),ze=h_(ve,ce,ee,ee*.2),Ue=y_(ve,ke),qe=b_(Ue,ze),Ge=og(ve,qe),dt={x:n.x+me.x,y:n.y+me.y},Te=x_(dt,Ge,ke),rt=rg(Te,Ge);return{center:Te,scale:qe,viewBox:rt}},[h.width,h.height,c,r,e,n.x,n.y]),$=k.useCallback((Q,ne=220)=>{const re=T.current;if(!re){q(Q);return}Z();const ce=re.center,me=re.scale,Ce=Q.center,ve=Q.scale,_e=performance.now();F.current=!0;const ke=Ue=>1-Math.pow(1-Ue,3),ze=Ue=>{const qe=Math.min(1,(Ue-_e)/Math.max(1,ne)),Ge=ke(qe),dt=me+(ve-me)*Ge,Te={x:ce.x+(Ce.x-ce.x)*Ge,y:ce.y+(Ce.y-ce.y)*Ge},rt={width:Math.max(1,h.width),height:Math.max(1,h.height),insets:r||{}},wt=og(rt,dt),Ut=rg(Te,wt);q({center:Te,scale:dt,viewBox:Ut}),qe<1?S.current=window.requestAnimationFrame(ze):(S.current=null,F.current=!1,q(Q))};S.current=window.requestAnimationFrame(ze)},[Z,q,h.width,h.height,r]),X=k.useCallback(Q=>{Z(),q(B(Q))},[Z,q,B]),le=k.useCallback(Q=>{const ne=B(Q);$(ne,Q?.durationMs??220)},[$,B]);k.useEffect(()=>{const Q=x.current;if(!Q)return;const ne=()=>{const ce=Q.getBoundingClientRect();g(me=>{const Ce=Math.round(ce.width),ve=Math.round(ce.height);return me.width===Ce&&me.height===ve?me:{width:Ce,height:ve}})};if(ne(),typeof ResizeObserver>"u")return window.addEventListener("resize",ne),()=>window.removeEventListener("resize",ne);const re=new ResizeObserver(()=>ne());return re.observe(Q),()=>re.disconnect()},[]),k.useEffect(()=>{if(h.width<=0||h.height<=0)return;const Q=`${e.x}:${e.y}:${e.width}:${e.height}`,ne=`${h.width}:${h.height}:${r?.top??0}:${r?.right??0}:${r?.bottom??0}:${r?.left??0}`,re=ue(a);if(!D.current){D.current=!0,N.current=re,H.current=o??null,G.current=ne,P.current=Q,Y.current=c,X({panOffset:{x:0,y:0}});return}if((o??null)!==H.current){H.current=o??null,P.current=Q,G.current=ne,N.current=re,Y.current=c,A.current={x:0,y:0},X({panOffset:{x:0,y:0}});return}if(o!==void 0&&Q!==P.current){P.current=Q,G.current=ne,N.current=re,Y.current=c,A.current={x:0,y:0},X({panOffset:{x:0,y:0}});return}if(ne!==G.current){G.current=ne,P.current=Q,X();return}if(c!==Y.current){Y.current=c,le();return}if(re!==N.current){N.current=re;const ce={x:0,y:0};A.current=ce,le({panOffset:ce,durationMs:210});return}},[h.width,h.height,e.x,e.y,e.width,e.height,r,o,a,c,X,le]),k.useEffect(()=>()=>Z(),[Z]);const fe=k.useCallback(Q=>{const ne={x:A.current.x+Q.x,y:A.current.y+Q.y};A.current=ne,Z(),q(B({panOffset:ne}))},[Z,q,B]),R=k.useCallback(Q=>{d(ne=>ne===Q?ne:Q)},[]),W=T.current?.viewBox||e;return{svgRef:b,boardViewportRef:x,zoomPreset:c,isCameraPanning:m,setIsCameraPanning:f,cameraPanOffsetRef:A,isCameraPanningRef:O,isPinchingRef:_,suppressTileClickUntilRef:E,activePointersRef:w,dragStateRef:C,pinchStateRef:I,cancelCameraAnimation:Z,animateCameraToTarget:le,updatePanFromWorldDelta:fe,setZoomPresetAnimated:R,renderedViewBox:W}},S_=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619);return n>>>0},Oo=e=>S_(e)/4294967295,A_=e=>{const n=(e.tags||[]).map(o=>o.toLowerCase()),a=[e.id.toLowerCase(),...n];for(const o of a){const r=o.match(/(?:cluster|hex)[-_]?([123])\b/);if(r)return Number(r[1]);if(o.includes("1-hex")||o.includes("single"))return 1;if(o.includes("2-hex")||o.includes("double"))return 2;if(o.includes("3-hex")||o.includes("triple"))return 3}return 1},T_=({assetManifest:e,biomeThemeKey:n,biomeSeed:a,mountainAssetPathOverride:o,wallsMountainPath:r,wallsThemeMountainPath:c,clutterLayer:d,cells:h,tileVisualFlags:g,boardProps:m,resolveMountainSettings:f})=>{const b=k.useMemo(()=>{const w=(e?.assets||[]).filter(H=>{if(H.type!=="prop")return!1;const D=H.id.toLowerCase(),G=new Set((H.tags||[]).map(F=>F.toLowerCase()));if(!(D.includes("mountain")||G.has("mountain")))return!1;if(!H.theme)return!0;const Y=H.theme.toLowerCase();return Y===n||Y==="core"}).sort((H,D)=>H.id.localeCompare(D.id)),C=String(c||r||"").trim(),I=String(o||C).trim();if(!I)return w;const N=w.find(H=>H.path===I);return N?[N]:[]},[e?.assets,n,o,r,c]),x=k.useMemo(()=>{const E=new Map;for(const w of b)E.set(w.id,f(w));return E},[b,f]),T=k.useMemo(()=>{if(!b.length)return[];const E=b.filter(I=>A_(I)===1),w=E.length?E:b,C=h.filter(I=>g.get(ue(I))?.isWall).sort((I,N)=>ue(I).localeCompare(ue(N)));return C.length?C.map(I=>{const N=ue(I),H=Math.floor(Oo(`${a}|mountain-tile|${N}|asset`)*w.length)%w.length,D=w[H],G=x.get(D.id)||f(D),{y:P}=Ee(I,ee);return{id:`mountain-${N}-${D.id}`,kind:"mountain",position:I,asset:D,renderScale:G.scale,zAnchorY:P+ee*.42+G.offsetY}}):[]},[b,h,g,a,x,f]),S=k.useMemo(()=>{const E=new Set((d?.tags?.length?d.tags:["clutter","obstacle"]).map(w=>w.toLowerCase()));return(e?.assets||[]).filter(w=>{if(w.type!=="prop"&&w.type!=="decal"||w.id.toLowerCase().includes("mountain"))return!1;const I=(w.tags||[]).map(N=>N.toLowerCase());return I.includes("mountain")||!I.some(N=>E.has(N))?!1:w.theme?w.theme.toLowerCase()===n||w.theme.toLowerCase()==="core":!0})},[e?.assets,d?.tags,n]),A=k.useMemo(()=>{if(!S.length)return[];const E=Math.min(.6,Math.max(0,Number(d?.density??.08))),w=Math.max(1,Math.floor(Number(d?.maxPerHex??1))),C=Math.min(2,Math.max(1,Number(d?.bleedScaleMax??2))),I=[];for(const N of h){const H=ue(N),D=g.get(H);if(D?.isWall||D?.isLava||D?.isFire)continue;const{y:G}=Ee(N,ee);for(let P=0;P<w;P++){if(Oo(`${a}|clutter|${H}|slot:${P}|roll`)>E/(P+1))continue;const F=Math.floor(Oo(`${a}|clutter|${H}|slot:${P}|pick`)*S.length)%S.length,Z=S[F],z=1+Oo(`${a}|clutter|${H}|slot:${P}|scale`)*(C-1),q=(Oo(`${a}|clutter|${H}|slot:${P}|depth`)-.5)*ee*.28;I.push({id:`clutter-${H}-${P}-${Z.id}`,kind:"clutter",position:N,asset:Z,renderScale:z,zAnchorY:G+q})}}return I},[h,g,S,d?.density,d?.maxPerHex,d?.bleedScaleMax,a]),O=k.useMemo(()=>{const E=[...T,...A];for(const w of m){const{y:C}=Ee(w.position,ee),I=w.kind==="shrine";E.push({id:w.id,kind:w.kind,position:w.position,asset:w.asset,renderScale:Math.min(2,I?1.5:1.42),zAnchorY:C+(I?ee*.32:ee*.28),fallback:w.kind})}return E.sort((w,C)=>w.zAnchorY===C.zAnchorY?w.id.localeCompare(C.id):w.zAnchorY-C.zAnchorY),E},[T,A,m]),_=k.useMemo(()=>{const E=new Set;for(const w of T)E.add(ue(w.position));return E},[T]);return{mountainSettingsByAssetId:x,depthSortedSprites:O,mountainCoveredWallKeys:_}},vd=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619);return n>>>0},dl=(e,n)=>{if(e)return n&&e.themes?.[n]?e.themes[n]:e.default},fl=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"cover":"off",Sd=e=>Math.min(1,Math.max(0,Number(e?.opacity??1))),ml=(e,n,a=64,o=Number.POSITIVE_INFINITY)=>{const r=Number(e?.scalePx||n);return Math.min(o,Math.max(a,r))},lg=e=>({x:Number(e?.scroll?.x??0),y:Number(e?.scroll?.y??0),durationMs:Math.max(1e3,Number(e?.scroll?.durationMs??18e3))}),E_=(e,n)=>{if(e)return n&&e.themes?.[n]?e.themes[n]:e.default},__=e=>Math.min(1,Math.max(0,Number(e?.opacity??0))),d0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",f0=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,d,h]=a.slice(1).split("");return`#${c}${c}${d}${d}${h}${h}`.toLowerCase()}return n},w_=e=>{const a=f0(e).slice(1);return{r:parseInt(a.slice(0,2),16)/255,g:parseInt(a.slice(2,4),16)/255,b:parseInt(a.slice(4,6),16)/255}},cg=(e,n)=>e==="off"?"off":e?d0(e):n,ug=e=>{const n=[];for(let a=0;a<6;a++){const o=Math.PI/180*(60*a);n.push(`${e*Math.cos(o)},${e*Math.sin(o)}`)}return n.join(" ")},M_=({cells:e,gameState:n,bounds:a,assetManifest:o,biomeDebug:r})=>{const c=k.useMemo(()=>{const Ae=new Map;for(const Re of e){const We=ue(Re),lt=Ne.getTraitsAt(n,Re),ct=lt.has("BLOCKS_MOVEMENT")&&lt.has("BLOCKS_LOS"),$t=lt.has("LAVA")||lt.has("HAZARDOUS")&&lt.has("LIQUID"),At=lt.has("FIRE");Ae.set(We,{isWall:ct,isLava:!ct&&$t,isFire:!ct&&At})}return Ae},[e,n.tiles]),d=k.useMemo(()=>{const Ae=new Map;for(const Re of o?.assets||[])Ae.set(Re.id,Re);return Ae},[o]),h=k.useMemo(()=>d.get(HE())?.path,[d]),g=k.useMemo(()=>Math.max(1,o?.tileUnitPx||256),[o?.tileUnitPx]),m=k.useMemo(()=>ee*2/g,[g]),f=k.useMemo(()=>String(n.theme||"").toLowerCase(),[n.theme]),b=k.useMemo(()=>`${n.initialSeed||n.rngSeed||n.turnNumber}:${n.floor}:${f}`,[n.initialSeed,n.rngSeed,n.turnNumber,n.floor,f]),x=k.useMemo(()=>Xd(o,f),[o,f]),T=k.useMemo(()=>{const Ae=o?.biomeUnderlay;if(Ae)return{default:Ae.default,themes:Ae.themes,mode:Ae.mode,scalePx:Ae.scalePx,opacity:Ae.opacity}},[o?.biomeUnderlay]),S=k.useMemo(()=>x?.biomeLayers?.undercurrent||o?.biomeLayers?.undercurrent,[x?.biomeLayers?.undercurrent,o?.biomeLayers?.undercurrent]),A=k.useMemo(()=>x?.biomeLayers?.crust||o?.biomeLayers?.crust||T,[x?.biomeLayers?.crust,o?.biomeLayers?.crust,T]),O=k.useMemo(()=>x?.biomeLayers?.clutter||o?.biomeLayers?.clutter,[x?.biomeLayers?.clutter,o?.biomeLayers?.clutter]),_=k.useMemo(()=>dl(S,f),[S,f]),E=k.useMemo(()=>fl(S),[S]),w=k.useMemo(()=>ml(S,g,64,192),[S,g]),C=k.useMemo(()=>Sd(S),[S]),I=k.useMemo(()=>({x:Number(S?.scroll?.x??120),y:Number(S?.scroll?.y??90),durationMs:Math.max(1e3,Number(S?.scroll?.durationMs??92e3))}),[S?.scroll?.x,S?.scroll?.y,S?.scroll?.durationMs]),N=k.useMemo(()=>({x:Number(S?.offsetX??0)+Number(r?.undercurrentOffset?.x??0),y:Number(S?.offsetY??0)+Number(r?.undercurrentOffset?.y??0)}),[S?.offsetX,S?.offsetY,r?.undercurrentOffset?.x,r?.undercurrentOffset?.y]),H=k.useMemo(()=>dl(A,f),[A,f]),D=k.useMemo(()=>fl(A),[A]),G=k.useMemo(()=>ml(A,g,64),[A,g]),P=1,Y=k.useMemo(()=>{const Ae=Math.max(0,Number(A?.seedShiftPx??ee*5));if(Ae===0)return{x:0,y:0};const Re=vd(`${b}|crust-offset`),We=((Re&65535)/65535*2-1)*Ae,lt=((Re>>>16&65535)/65535*2-1)*Ae;return{x:We,y:lt}},[A?.seedShiftPx,b]),F=k.useMemo(()=>({x:Number(A?.offsetX??0)+Number(r?.crustOffset?.x??0),y:Number(A?.offsetY??0)+Number(r?.crustOffset?.y??0)}),[A?.offsetX,A?.offsetY,r?.crustOffset?.x,r?.crustOffset?.y]),Z=k.useMemo(()=>({x:Y.x+F.x,y:Y.y+F.y}),[Y.x,Y.y,F.x,F.y]),z=k.useMemo(()=>o?.walls,[o?.walls]),q=k.useMemo(()=>x?.walls||z?.themes?.[f],[x?.walls,z?.themes,f]),B=k.useMemo(()=>x?.biomeMaterials?.crust||o?.biomeMaterials?.crust,[x?.biomeMaterials?.crust,o?.biomeMaterials?.crust]),$=k.useMemo(()=>B?.detailA,[B?.detailA]),X=k.useMemo(()=>B?.detailB,[B?.detailB]),le=k.useMemo(()=>dl($,f),[$,f]),fe=k.useMemo(()=>dl(X,f),[X,f]),R=k.useMemo(()=>fl($),[$]),W=k.useMemo(()=>fl(X),[X]),Q=k.useMemo(()=>ml($,G,64),[$,G]),ne=k.useMemo(()=>ml(X,G,64),[X,G]),re=k.useMemo(()=>Sd($),[$]),ce=k.useMemo(()=>Sd(X),[X]),me=k.useMemo(()=>lg($),[$?.scroll?.x,$?.scroll?.y,$?.scroll?.durationMs]),Ce=k.useMemo(()=>lg(X),[X?.scroll?.x,X?.scroll?.y,X?.scroll?.durationMs]),ve=k.useMemo(()=>{const Ae=ee*.75,Re=vd(`${b}|crust-detail-a-offset`),We=((Re&65535)/65535*2-1)*Ae,lt=((Re>>>16&65535)/65535*2-1)*Ae;return{x:We,y:lt}},[b]),_e=k.useMemo(()=>{const Ae=ee*.75,Re=vd(`${b}|crust-detail-b-offset`),We=((Re&65535)/65535*2-1)*Ae,lt=((Re>>>16&65535)/65535*2-1)*Ae;return{x:We,y:lt}},[b]),ke=k.useMemo(()=>({x:Z.x+ve.x,y:Z.y+ve.y}),[Z.x,Z.y,ve.x,ve.y]),ze=k.useMemo(()=>({x:Z.x+_e.x,y:Z.y+_e.y}),[Z.x,Z.y,_e.x,_e.y]),Ue=k.useMemo(()=>B?.tint,[B?.tint]),qe=k.useMemo(()=>E_(Ue,f),[Ue,f]),Ge=k.useMemo(()=>__(Ue),[Ue?.opacity]),dt=k.useMemo(()=>d0(Ue?.blendMode),[Ue?.blendMode]),Te=!!(qe&&Ge>0),rt=k.useMemo(()=>Te?Math.min(.55,Math.max(.15,Ge*.9)):0,[Te,Ge]),wt=k.useCallback(Ae=>{const Re=Ae?.mountainSettings,We=Ae?.mountainSettingsByTheme?.[f],ct=(Ae?x?.assetOverrides?.[Ae.id]:void 0)?.mountainSettings,$t=Math.min(3,Math.max(.2,Number(r?.mountainScale??ct?.scale??We?.scale??q?.scale??z?.scale??Re?.scale??.95))),At=Number(r?.mountainOffset?.x??ct?.offsetX??We?.offsetX??q?.offsetX??z?.offsetX??Re?.offsetX??0),gn=Number(r?.mountainOffset?.y??ct?.offsetY??We?.offsetY??q?.offsetY??z?.offsetY??Re?.offsetY??0),bn=Math.min(1,Math.max(0,Number(r?.mountainAnchor?.x??ct?.anchorX??We?.anchorX??q?.anchorX??z?.anchorX??Re?.anchorX??.5))),ri=Math.min(1,Math.max(0,Number(r?.mountainAnchor?.y??ct?.anchorY??We?.anchorY??q?.anchorY??z?.anchorY??Re?.anchorY??.78))),ei=cg(r?.mountainCrustBlendMode??ct?.crustBlendMode??We?.crustBlendMode??q?.crustBlendMode??z?.crustBlendMode??Re?.crustBlendMode,dt),$n=Math.min(1,Math.max(0,Number(r?.mountainCrustBlendOpacity??ct?.crustBlendOpacity??We?.crustBlendOpacity??q?.crustBlendOpacity??z?.crustBlendOpacity??Re?.crustBlendOpacity??rt))),Rt=f0(String(r?.mountainTintColor??ct?.tintColor??We?.tintColor??q?.tintColor??z?.tintColor??Re?.tintColor??qe??"#8b6f4a")),yt=cg(r?.mountainTintBlendMode??ct?.tintBlendMode??We?.tintBlendMode??q?.tintBlendMode??z?.tintBlendMode??Re?.tintBlendMode,"soft-light"),tn=Math.min(1,Math.max(0,Number(r?.mountainTintOpacity??ct?.tintOpacity??We?.tintOpacity??q?.tintOpacity??z?.tintOpacity??Re?.tintOpacity??0))),ti=w_(Rt);return{scale:$t,offsetX:At,offsetY:gn,anchorX:bn,anchorY:ri,crustBlendMode:ei,crustBlendOpacity:$n,tintColor:Rt,tintBlendMode:yt,tintOpacity:tn,tintMatrixValues:`0 0 0 0 ${ti.r.toFixed(4)} 0 0 0 0 ${ti.g.toFixed(4)} 0 0 0 0 ${ti.b.toFixed(4)} 0 0 0 1 0`}},[f,r?.mountainScale,r?.mountainOffset?.x,r?.mountainOffset?.y,r?.mountainAnchor?.x,r?.mountainAnchor?.y,r?.mountainCrustBlendMode,r?.mountainCrustBlendOpacity,r?.mountainTintColor,r?.mountainTintBlendMode,r?.mountainTintOpacity,x?.assetOverrides,z,q,dt,qe,rt]),Ut=!!(le&&R!=="off"&&re>0||fe&&W!=="off"&&ce>0||Te),Mt=!!(_&&E!=="off"||H&&D!=="off"||Ut),Un=k.useMemo(()=>`biome-undercurrent-${n.floor}`,[n.floor]),qn=k.useMemo(()=>`biome-crust-${n.floor}`,[n.floor]),Nt=k.useMemo(()=>`biome-crust-mask-${n.floor}`,[n.floor]),Qn=k.useMemo(()=>`biome-crust-detail-a-${n.floor}`,[n.floor]),ft=k.useMemo(()=>`biome-crust-detail-b-${n.floor}`,[n.floor]),St=!!(H&&D!=="off"||le&&R!=="off"&&re>0||fe&&W!=="off"&&ce>0||Te),qt=k.useMemo(()=>{const Ae=[];for(const Re of e){const We=ue(Re),lt=c.get(We);if(!lt||!lt.isLava&&!lt.isFire)continue;const{x:ct,y:$t}=Ee(Re,ee);Ae.push({key:We,x:ct,y:$t})}return Ae},[e,c]),Zn=k.useMemo(()=>{const Ae=eg({isStairs:!0});return Ae?d.get(Ae):void 0},[d]),yn=k.useMemo(()=>{const Ae=eg({isShrine:!0});return Ae?d.get(Ae):void 0},[d]),ua=k.useMemo(()=>{const Ae=[];return n.stairsPosition&&Ae.push({id:`stairs-${ue(n.stairsPosition)}`,kind:"stairs",position:n.stairsPosition,asset:Zn}),n.shrinePosition&&Ae.push({id:`shrine-${ue(n.shrinePosition)}`,kind:"shrine",position:n.shrinePosition,asset:yn}),Ae},[n.stairsPosition,n.shrinePosition,Zn,yn]),ja=k.useMemo(()=>ug(ee+1),[]),ln=k.useMemo(()=>ug(ee-2),[]),De=k.useMemo(()=>`biome-map-clip-${n.floor}`,[n.floor]),et=k.useMemo(()=>({x:a.minX-ee*2,y:a.minY-ee*2,width:a.width+ee*4,height:a.height+ee*4}),[a.minX,a.minY,a.width,a.height]),st=k.useMemo(()=>{const Ae=Math.max(Math.abs(Number(N?.x??0)),Math.abs(Number(N?.y??0)),Math.abs(Number(Z?.x??0)),Math.abs(Number(Z?.y??0)),Math.abs(Number(ke?.x??0)),Math.abs(Number(ke?.y??0)),Math.abs(Number(ze?.x??0)),Math.abs(Number(ze?.y??0)));return Math.min(ee*32,Math.max(ee*8,Math.ceil(Ae+ee*6)))},[N?.x,N?.y,Z?.x,Z?.y,ke?.x,ke?.y,ze?.x,ze?.y]),Mn=k.useMemo(()=>({x:et.x-st,y:et.y-st,width:et.width+st*2,height:et.height+st*2}),[et.x,et.y,et.width,et.height,st]);return{tileVisualFlags:c,assetById:d,deathDecalHref:h,manifestUnitToBoardScale:m,biomeThemeKey:f,biomeSeed:b,clutterLayer:O,wallsProfile:z,wallsThemeOverride:q,boardProps:ua,resolveMountainSettings:wt,hybridInteractionLayerEnabled:Mt,backdropLayerProps:{biomeClipId:De,biomeClipPoints:ln,maskHexPoints:ja,biomeFrame:et,biomeCoverFrame:Mn,undercurrentHref:_,undercurrentMode:E,undercurrentPatternId:Un,undercurrentScalePx:w,undercurrentOffset:N,undercurrentScroll:I,undercurrentOpacity:C,crustHref:H,crustMode:D,crustPatternId:qn,crustScalePx:G,crustPatternShift:Z,crustOpacity:P,crustDetailAHref:le,crustDetailAMode:R,crustDetailAPatternId:Qn,crustDetailAScalePx:Q,crustDetailAShift:ke,crustDetailAScroll:me,crustDetailAOpacity:re,crustDetailBHref:fe,crustDetailBMode:W,crustDetailBPatternId:ft,crustDetailBScalePx:ne,crustDetailBShift:ze,crustDetailBScroll:Ce,crustDetailBOpacity:ce,crustMaskEnabled:St,crustMaskId:Nt,crustMaskHoles:qt,crustTintActive:Te,crustTintColor:qe,crustTintOpacity:Ge,crustTintBlendMode:dt}}},O_=({gameState:e,playerPos:n,selectedSkillId:a,showMovementRange:o,hoveredTile:r,enginePreviewGhost:c})=>{const d=k.useMemo(()=>{const A={};for(const O of e.visualEvents||[]){if(O.type!=="kinetic_trace")continue;const _=O.payload;_?.actorId&&(A[_.actorId]=_)}return A},[e.visualEvents]),h=k.useMemo(()=>{if(!o||a)return[];const A=["BASIC_MOVE","DASH"],O=new Set(e.player.activeSkills.map(w=>w.id)),_=new Set,E=[];for(const w of A){if(!O.has(w))continue;const C=Xt.get(w);if(!C?.getValidTargets)continue;const I=C.getValidTargets(e,n);for(const N of I){const H=ue(N);_.has(H)||(_.add(H),E.push(N))}}return E},[o,a,e,n]),g=k.useMemo(()=>{const A=new Set;for(const O of h)A.add(ue(O));return A},[h]),m=k.useMemo(()=>e.player.activeSkills.some(A=>A.id==="BASIC_MOVE"||A.id==="DASH"),[e.player.activeSkills]),f=k.useMemo(()=>ue(e.stairsPosition),[e.stairsPosition]),b=k.useMemo(()=>e.shrinePosition?ue(e.shrinePosition):null,[e.shrinePosition]),x=k.useMemo(()=>{const A=[{q:n.q+1,r:n.r,s:n.s-1},{q:n.q+1,r:n.r-1,s:n.s},{q:n.q,r:n.r-1,s:n.s+1},{q:n.q-1,r:n.r,s:n.s+1},{q:n.q-1,r:n.r+1,s:n.s},{q:n.q,r:n.r+1,s:n.s-1}],O=new Set;for(const _ of A)jl(_.q,_.r,e.gridWidth,e.gridHeight)&&O.add(ue(_));return O},[n,e.gridWidth,e.gridHeight]),T=k.useMemo(()=>{const A=new Set;if(!a)return A;const O=Xt.get(a);if(!O?.getValidTargets)return A;const _=O.getValidTargets(e,n);for(const E of _)A.add(ue(E));return A},[a,e,n]),S=k.useMemo(()=>{if(c)return c;if(!r)return null;const A=ue(r);if(o&&!a)return g.has(A)||!m&&x.has(A)?{path:ht(n,r),aoe:[],hasEnemy:!1,target:r}:null;if(!a)return null;const O=e.player.activeSkills.find(C=>C.id===a),_=J1(e,{actorId:e.player.id,skillId:a,target:r,activeUpgrades:O?.activeUpgrades||[]});if(!_.ok)return null;const E=new Map;for(const C of _.simulationEvents)C.position&&(C.type!=="DamageTaken"&&C.type!=="StatusApplied"&&C.type!=="UnitMoved"||E.set(ue(C.position),C.position));const w=_.simulationEvents.some(C=>(C.type==="DamageTaken"||C.type==="StatusApplied")&&!!C.targetId&&C.targetId!==e.player.id);return{path:ht(n,r),aoe:[...E.values()],hasEnemy:w,target:r}},[c,r,o,a,g,m,x,e,n]);return{latestTraceByActor:d,movementTargetSet:g,hasPrimaryMovementSkills:m,stairsKey:f,shrineKey:b,fallbackNeighborSet:x,selectedSkillTargetSet:T,resolvedEnginePreviewGhost:S}},C_=({gameState:e,deathDecalHref:n,decals:a,setDecals:o,setEntityPoseEffects:r,setEntityPoseNowMs:c,onSimulationEvents:d})=>{const h=k.useRef(null),g=k.useRef(null),m=k.useRef(0),f=k.useRef(0),b=k.useCallback(T=>{if(!T)return null;const S=T.position||T.destination||T.origin||T.target;return S&&typeof S.q=="number"&&typeof S.r=="number"&&typeof S.s=="number"?S:null},[]);return k.useEffect(()=>{if(!n)return;const T=e.timelineEvents||[],S=e.visualEvents||[];if(h.current===T&&g.current===S)return;const A=h.current===T?[]:T;h.current=T;const O=g.current===S?[]:S;g.current=S;const _=[],E=Date.now();for(const w of A){if(w.phase!=="DEATH_RESOLVE")continue;const C=b(w.payload);C&&_.push({id:`decal-tl-${w.id}-${E}-${_.length}`,position:C,href:n,createdAt:E})}for(const w of O){if(w.type!=="vfx")continue;const C=w.payload?.type;if(C!=="vaporize"&&C!=="explosion_ring")continue;const I=b(w.payload);I&&_.push({id:`decal-vx-${C}-${E}-${_.length}`,position:I,href:n,createdAt:E})}_.length>0&&o(w=>[...w,..._].slice(-80))},[e.timelineEvents,e.visualEvents,n,b,o]),k.useEffect(()=>{const T=e.simulationEvents||[];T.length<m.current&&(m.current=0);const S=T.slice(m.current);m.current=T.length,S.length>0&&d?.(S)},[e.simulationEvents,d]),k.useEffect(()=>{const T=e.simulationEvents||[];T.length<f.current&&(f.current=0);const S=T.slice(f.current);if(f.current=T.length,S.length===0)return;const A=Date.now(),O=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]],_=new Map(O.map(C=>[C.id,C])),E=[],w=(C,I,N,H,D,G)=>{C&&E.push({id:`${I}:${C}:${D}`,actorId:C,startTime:D,endTime:D+Math.max(35,G),easing:"out",from:N,to:H})};for(const C of S){if(C.type!=="DamageTaken")continue;const I=String(C.targetId||""),N=I?_.get(I):void 0;if(!N)continue;const H=C.payload||{},D=String(H.reason||"").toLowerCase(),G=String(H.sourceId||"");if(!G||!D||D.includes("basic_attack"))continue;const P=_.get(G);if(!(D.includes("spear")||D.includes("multi_shoot")||D.includes("withdrawal")||P?.subtype==="archer"&&!D.includes("crush")))continue;const F=P?Ee(P.position,ee):void 0,Z=Ee(N.position,ee);let z=0,q=1;if(F){const X=Z.x-F.x,le=Z.y-F.y,fe=Math.hypot(X,le);fe>.001&&(z=X/fe,q=le/fe)}const B=P?.subtype==="archer"?10:8,$=100;w(N.id,"projectile-hit",{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:z*B,offsetY:q*B,scaleX:1.02,scaleY:.95},A,$),w(N.id,"projectile-hit-return",{offsetX:z*(B*.35),offsetY:q*(B*.35),scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},A+Math.floor($*.5),130)}E.length>0&&(c(A),r(C=>[...C,...E]))},[e.simulationEvents,e.player,e.enemies,e.companions,e.dyingEntities,r,c]),k.useEffect(()=>{if(a.length===0)return;const T=12e3,S=window.setTimeout(()=>{const A=Date.now();o(O=>O.filter(_=>A-_.createdAt<T))},1e3);return()=>window.clearTimeout(S)},[a,o]),{resetBoardEventEffects:k.useCallback(()=>{o([]),r([]),c(0),h.current=null,g.current=null,m.current=0,f.current=0},[o,r,c])}},pl=(e,n,a)=>e+(n-e)*a,k_=e=>1-Math.pow(1-e,3),N_=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,R_=({gameState:e,assetById:n,entityPoseEffects:a,entityPoseNowMs:o,onMirrorSnapshot:r})=>{const c=k.useMemo(()=>{const g=new Map;g.set(e.player.id,e.player.position);for(const m of e.enemies)g.set(m.id,m.position);for(const m of e.companions||[])g.set(m.id,m.position);for(const m of e.dyingEntities||[])g.set(m.id,m.position);return g},[e.player.id,e.player.position,e.enemies,e.companions,e.dyingEntities]),d=k.useMemo(()=>[{id:e.player.id,position:e.player.position,subtype:e.player.subtype||"player",assetHref:n.get(oa(e.player))?.path,fallbackAssetHref:Ca(e.player)},...e.enemies.map(g=>({id:g.id,position:g.position,subtype:g.subtype,assetHref:n.get(oa(g))?.path,fallbackAssetHref:Ca(g)})),...(e.companions||[]).map(g=>({id:g.id,position:g.position,subtype:g.subtype,assetHref:n.get(oa(g))?.path,fallbackAssetHref:Ca(g)})),...(e.dyingEntities||[]).map(g=>({id:g.id,position:g.position,subtype:g.subtype,assetHref:n.get(oa(g))?.path,fallbackAssetHref:Ca(g)}))],[n,e.player,e.enemies,e.companions,e.dyingEntities]),h=k.useMemo(()=>{const g=new Map,m=o||Date.now();for(const f of a){if(m<f.startTime||m>f.endTime)continue;const b=Math.max(1,f.endTime-f.startTime),x=Math.max(0,Math.min(1,(m-f.startTime)/b)),T=f.easing==="inOut"?N_(x):k_(x),S={offsetX:pl(f.from.offsetX,f.to.offsetX,T),offsetY:pl(f.from.offsetY,f.to.offsetY,T),scaleX:pl(f.from.scaleX,f.to.scaleX,T),scaleY:pl(f.from.scaleY,f.to.scaleY,T)},A=g.get(f.actorId);if(!A){g.set(f.actorId,S);continue}g.set(f.actorId,{offsetX:(A.offsetX??0)+(S.offsetX??0),offsetY:(A.offsetY??0)+(S.offsetY??0),scaleX:(A.scaleX??1)*(S.scaleX??1),scaleY:(A.scaleY??1)*(S.scaleY??1)})}return g},[a,o]);return k.useEffect(()=>{if(!r)return;const g={turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:[...c.entries()].map(([m,f])=>({id:m,position:{q:f.q,r:f.r,s:f.s}}))};r(g)},[r,e.turnNumber,e.stackTrace,c]),{actorPositionById:c,juiceActorSnapshots:d,entityVisualPoseById:h}},hl=e=>{if(!e||typeof e.q!="number"||typeof e.r!="number"||typeof e.s!="number")return null;const{x:n,y:a}=Ee(e,ee),o=Math.hypot(n,a);return!Number.isFinite(o)||o<=1e-4?null:{x:n/o,y:a/o}},yl=e=>{const n=e?.hex;if(n&&typeof n.q=="number"&&typeof n.r=="number"&&typeof n.s=="number")return n},gl=e=>{const n=e?.world;if(n&&typeof n.x=="number"&&typeof n.y=="number")return n},I_=({gameState:e})=>{const[n,a]=k.useState(!1),[o,r]=k.useState(!1),[c,d]=k.useState({x:0,y:0}),[h,g]=k.useState(!1),[m,f]=k.useState([]),[b,x]=k.useState([]),[T,S]=k.useState(0),A=k.useRef(null),O=k.useRef(null),_=k.useRef(null),E=k.useRef(null);k.useRef(!1),k.useEffect(()=>{},[]),k.useEffect(()=>{const C=e.visualEvents||[];if(_.current===C)return;_.current=C;const I=C;if(I.length===0)return;const N=Date.now(),H=[],D=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]],G=new Map(D.map(F=>[F.id,F])),P=F=>{if(F){for(const Z of D)if(se(Z.position,F))return Z.id}},Y=(F,Z,z,q,B,$,X)=>{F&&H.push({id:`${Z}:${F}:${B}`,actorId:F,startTime:B,endTime:B+Math.max(30,$),easing:X,from:z,to:q})};for(let F=0;F<I.length;F++){const Z=I[F];if(Z.type!=="juice_signature")continue;const z=Z.payload;if(!z||z.protocol!=="juice-signature/v1"||z.signature!=="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"&&z.signature!=="ATK.STRIKE.PHYSICAL.AUTO_ATTACK")continue;const q=String(z.phase||"impact"),B=yl(z.source),$=yl(z.target),X=String(z.meta?.sourceId||z.source?.actorId||"")||P(B),le=z.target?.actorId||P($);if(!B||!$||!X)continue;const fe=Ee(B,ee),R=Ee($,ee),W=gl(z.contact)||R;let Q=W.x-fe.x,ne=W.y-fe.y,re=Math.hypot(Q,ne);if(!Number.isFinite(re)||re<.001){const wt=hl(z.direction);if(wt)Q=wt.x,ne=wt.y,re=1;else{const Ut=Ee($,ee);Q=Ut.x-fe.x,ne=Ut.y-fe.y,re=Math.max(1,Math.hypot(Q,ne))}}const ce=Q/Math.max(1,re),me=ne/Math.max(1,re),Ce=Math.max(0,Number(z.timing?.delayMs||0)),ve=Math.max(40,Number(z.timing?.durationMs||z.timing?.ttlMs||110)),_e=N+Ce,ke=String(z.meta?.sequenceId||`strike-${N}-${F}`),ze=String(z.intensity||"medium"),Ue=z.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK",qe=ze==="extreme"?16:ze==="high"?13:ze==="low"?8:11,Ge=Math.min(ee*(Ue?.3:.46),re*(Ue?.22:.32)),dt=Math.min(ee*(Ue?.55:.82),re*(Ue?.62:.9)),Te=Math.min(ee*(Ue?.62:.9),re*(Ue?.72:.98)),rt=Math.min(ee*(Ue?.22:.34),re*(Ue?.24:.36));if(q==="anticipation"){Y(X,`${ke}:anticipation`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:-ce*Ge,offsetY:-me*Ge,scaleX:.92,scaleY:1.08},_e,ve,"out");continue}if(q==="travel"){Y(X,`${ke}:travel`,{offsetX:-ce*Ge,offsetY:-me*Ge,scaleX:.94,scaleY:1.06},{offsetX:ce*dt,offsetY:me*dt,scaleX:1.09,scaleY:.93},_e,ve,"inOut");continue}if(q==="impact"){Y(X,`${ke}:impact-src`,{offsetX:ce*(Te*.92),offsetY:me*(Te*.92),scaleX:1.06,scaleY:.95},{offsetX:ce*Te,offsetY:me*Te,scaleX:1.02,scaleY:.98},_e,ve,"out"),Y(le,`${ke}:impact-tgt`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:ce*qe,offsetY:me*qe,scaleX:1.03,scaleY:.94},_e,ve,"out");continue}q==="aftermath"&&(Y(X,`${ke}:after-src`,{offsetX:ce*rt,offsetY:me*rt,scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},_e,ve,"out"),Y(le,`${ke}:after-tgt`,{offsetX:ce*(qe*.35),offsetY:me*(qe*.35),scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},_e,ve,"out"))}for(let F=0;F<I.length;F++){const Z=I[F];if(Z.type!=="juice_signature")continue;const z=Z.payload;if(!z||z.protocol!=="juice-signature/v1")continue;const q=String(z.signature||"");if(String(z.phase||"impact")!=="impact")continue;const $=Math.max(0,Number(z.timing?.delayMs||0)),X=Math.max(45,Number(z.timing?.durationMs||z.timing?.ttlMs||110)),le=N+$,fe=yl(z.source),R=yl(z.target),W=gl(z.source),Q=gl(z.target),ne=gl(z.contact),re=String(z.meta?.sourceId||z.source?.actorId||""),me=(re?G.get(re):void 0)?.id||P(fe),Ce=z.target?.actorId||P(R),_e=(()=>{const ke=hl(z.direction);if(ke)return ke;const ze=fe?Ee(fe,ee):W,Ue=ne||Q||(R?Ee(R,ee):void 0);if(ze&&Ue){const qe=Ue.x-ze.x,Ge=Ue.y-ze.y,dt=Math.hypot(qe,Ge);if(dt>.001)return{x:qe/dt,y:Ge/dt}}return null})();if(_e){if(q==="ATK.PULSE.KINETIC.WAVE"){Y(me,`${z.meta?.sequenceId||q}:pulse-caster`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:-_e.x*8,offsetY:-_e.y*8,scaleX:.96,scaleY:1.05},le,Math.max(40,Math.floor(X*.5)),"out"),Y(me,`${z.meta?.sequenceId||q}:pulse-caster-return`,{offsetX:-_e.x*(8*.6),offsetY:-_e.y*(8*.6),scaleX:.98,scaleY:1.02},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},le+Math.floor(X*.45),Math.max(50,Math.floor(X*.65)),"out"),Y(Ce,`${z.meta?.sequenceId||q}:pulse-target`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:_e.x*10,offsetY:_e.y*10,scaleX:1.03,scaleY:.95},le,X,"out");continue}if(q.startsWith("ENV.COLLISION.KINETIC.")){const ke=q==="ENV.COLLISION.KINETIC.SHIELD_BASH"?14:10,ze=q==="ENV.COLLISION.KINETIC.SHIELD_BASH"?7:0;ze>0&&Y(me,`${z.meta?.sequenceId||q}:collision-source`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:_e.x*ze,offsetY:_e.y*ze,scaleX:1.03,scaleY:.97},le,Math.max(45,Math.floor(X*.55)),"out"),Y(Ce,`${z.meta?.sequenceId||q}:collision-target`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:_e.x*ke,offsetY:_e.y*ke,scaleX:1.02,scaleY:.92},le,X,"out");continue}}}H.length>0&&(S(N),x(F=>[...F,...H]))},[e.visualEvents,e.player,e.enemies,e.companions,e.dyingEntities]),k.useEffect(()=>{if(typeof window>"u"||b.length===0)return;let C=!1;const I=()=>{if(C)return;const N=Date.now();S(N),x(H=>{const D=H.filter(G=>N<G.endTime+16);return D.length===H.length?H:D}),E.current=window.requestAnimationFrame(I)};return E.current=window.requestAnimationFrame(I),()=>{C=!0,E.current!==null&&(window.cancelAnimationFrame(E.current),E.current=null)}},[b.length]),k.useEffect(()=>{const C=e.visualEvents||[];if(A.current===C)return;A.current=C;const I=C;if(I.length===0)return;let N=0,H=0,D=0,G={x:0,y:0},P=0;const Y={low:110,medium:160,high:210,extreme:260},F={light:6,medium:10,heavy:14},Z={light:65,medium:85,heavy:110},z=[],q=R=>{R<=0||(a(!0),z.push(window.setTimeout(()=>a(!1),R)))},B=R=>{R<=0||(r(!0),z.push(window.setTimeout(()=>r(!1),R)))},$=(R,W)=>{W<=0||!R.x&&!R.y||(d(R),z.push(window.setTimeout(()=>d({x:0,y:0}),W)))};for(const R of I){if(R.type==="juice_signature"){const W=R.payload;if(W?.protocol==="juice-signature/v1"){const Q=Math.max(0,Number(W.timing?.delayMs||0)),ne=W.camera?.shake,re=Number(W.camera?.freezeMs||0),ce=String(W.camera?.kick||"none"),me=ce!=="none"?hl(W.direction):null,Ce=F[ce]||0,ve=Z[ce]||80;if(Q>0&&(ne||re>0||me&&Ce>0)){z.push(window.setTimeout(()=>{ne&&q(Y[String(ne)]||160),re>0&&B(Math.min(220,re)),me&&Ce>0&&$({x:me.x*Ce,y:me.y*Ce},ve)},Q));continue}if(ne&&(N=Math.max(N,Y[String(ne)]||160)),re>0&&(H=Math.max(H,Math.min(220,re))),ce!=="none"){const _e=hl(W.direction),ke=F[ce]||0;_e&&ke>0&&ke>=P&&(P=ke,G={x:_e.x*ke,y:_e.y*ke},D=Math.max(D,Z[ce]||80))}continue}}if(R.type==="shake"){const W=String(R.payload?.intensity||"medium");N=Math.max(N,Y[W]||160)}else R.type==="freeze"&&(H=Math.max(H,Math.min(220,Math.max(50,Number(R.payload?.durationMs||80)))))}let X,le,fe;return N>0&&(a(!0),X=window.setTimeout(()=>a(!1),N)),H>0&&(r(!0),le=window.setTimeout(()=>r(!1),H)),D>0&&(G.x!==0||G.y!==0)&&(d(G),fe=window.setTimeout(()=>d({x:0,y:0}),D)),()=>{X&&window.clearTimeout(X),le&&window.clearTimeout(le),fe&&window.clearTimeout(fe);for(const R of z)window.clearTimeout(R)}},[e.visualEvents]),k.useEffect(()=>{},[e.visualEvents,h]);const w=k.useCallback(()=>{f([]),a(!1),r(!1),d({x:0,y:0}),x([]),S(0),A.current=null,O.current=null,_.current=null,E.current!==null&&(window.cancelAnimationFrame(E.current),E.current=null)},[]);return{isShaking:n,isFrozen:o,cameraKickOffsetPx:c,juiceDebugOverlayEnabled:h,juiceDebugEntries:m,entityPoseEffects:b,entityPoseNowMs:T,setEntityPoseEffects:x,setEntityPoseNowMs:S,resetBoardJuicePresentation:w}},L_=({visualEvents:e,turnNumber:n,actorPositionById:a,svgRef:o,cancelCameraAnimation:r})=>{const[c,d]=k.useState(!1),h=k.useRef([]),g=k.useRef(!1),m=k.useRef([]),f=k.useRef(0),b=k.useRef(""),x=k.useMemo(()=>(e||[]).filter(E=>E.type==="kinetic_trace").map(E=>E.payload).filter(E=>{if(!E?.actorId||!E.origin||!E.destination)return!1;const w=a.get(E.actorId);return!!w&&ue(w)===ue(E.destination)}),[e,a]),T=k.useMemo(()=>{if(!x.length)return"";const E=n??0,w=x.map(C=>{const I=(C.path||[]).map(N=>`${N.q},${N.r},${N.s}`).join(">");return[C.actorId,`${C.origin.q},${C.origin.r},${C.origin.s}`,`${C.destination.q},${C.destination.r},${C.destination.s}`,C.movementType||"slide",C.startDelayMs||0,C.durationMs||0,I].join("|")}).join("||");return`${E}::${w}`},[x,n]),S=k.useCallback(async(E,w,C,I)=>{if(I!==f.current)return;const N=E.animate(w,{...C,fill:C.fill??"forwards"});m.current.push(N);try{await N.finished}catch{}finally{m.current=m.current.filter(H=>H!==N)}},[]),A=k.useCallback(async(E,w,C)=>{if(w!==f.current)return;const I=.76,N=o.current?.querySelector(`[data-actor-node="${E.actorId}"]`),H=X=>{const le=Ee(X,ee);return`translate(${le.x}px, ${le.y}px)`},D=Math.max(0,E.startDelayMs||0),G=Math.max(0,performance.now()-C),P=Math.round(D*I),Y=Math.max(0,P-G),F=E.path&&E.path.length>1?E.path:[E.origin,E.destination],Z=Math.max(1,F.length-1),z=Math.max(90,Math.round((E.durationMs||Z*110)*I));if(!N){const X=Math.max(0,Y+z);X>0&&await new Promise(le=>window.setTimeout(le,X));return}if(Y>0&&(await new Promise(X=>window.setTimeout(X,Y)),w!==f.current))return;if((E.movementType||"slide")==="teleport"){const X=Math.max(100,Math.round((E.durationMs||180)*I));await S(N,[{transform:H(E.origin),opacity:1,offset:0},{transform:H(E.origin),opacity:0,offset:.45},{transform:H(E.destination),opacity:0,offset:.55},{transform:H(E.destination),opacity:1,offset:1}],{duration:X,easing:"linear"},w),w===f.current&&(N.style.transform=H(E.destination),N.style.opacity="1");return}const q=[...F],B=q[q.length-1];(!B||B.q!==E.destination.q||B.r!==E.destination.r||B.s!==E.destination.s)&&q.push(E.destination);const $=q.map((X,le)=>({transform:H(X),offset:q.length===1?1:le/(q.length-1)}));$[$.length-1]={...$[$.length-1],transform:H(E.destination),offset:1},await S(N,$,{duration:z,easing:"linear"},w),w===f.current&&(N.style.transform=H(E.destination),N.style.opacity="1")},[S,o]),O=k.useCallback(async()=>{if(g.current)return;g.current=!0,d(!0);const E=++f.current,w=performance.now();try{for(;h.current.length>0&&E===f.current;){const C=h.current.shift();C&&await A(C,E,w)}}finally{E===f.current&&(g.current=!1,d(!1))}},[A]);k.useEffect(()=>{if(!T){b.current="";return}T!==b.current&&(b.current=T,h.current.push(...x),O())},[T,x,O]);const _=k.useCallback((E=!0)=>{f.current++,h.current=[],g.current=!1,m.current.forEach(w=>{try{w.cancel()}catch{}}),m.current=[],d(!1),E&&(b.current="")},[]);return k.useEffect(()=>()=>{r(),_(!1)},[r,_]),{movementBusy:c,resetMovementPlayback:_}},H_=e=>{const n=[];for(let a=0;a<6;a++){const o=Math.PI/180*(60*a);n.push(`${e*Math.cos(o)},${e*Math.sin(o)}`)}return n.join(" ")},m0=({gameState:e,onMove:n,selectedSkillId:a,showMovementRange:o,onBusyStateChange:r,assetManifest:c,biomeDebug:d,onSimulationEvents:h,onMirrorSnapshot:g,enginePreviewGhost:m,cameraSafeInsetsPx:f})=>{const[b,x]=k.useState(null),[T,S]=k.useState(!1),[A,O]=k.useState([]),_=e.player.position,E=k.useMemo(()=>{let Rt=e.rooms?.[0]?.hexes;if(!Rt||Rt.length===0){Rt=[];for(let yt=0;yt<e.gridWidth;yt++)for(let tn=0;tn<e.gridHeight;tn++)Rt.push({q:yt,r:tn,s:-yt-tn})}return Rt.filter(yt=>jl(yt.q,yt.r,e.gridWidth,e.gridHeight))},[e.rooms,e.gridWidth,e.gridHeight]),{isShaking:w,isFrozen:C,cameraKickOffsetPx:I,entityPoseEffects:N,entityPoseNowMs:H,setEntityPoseEffects:D,setEntityPoseNowMs:G,resetBoardJuicePresentation:P}=I_({gameState:e}),Y=k.useMemo(()=>{if(E.length===0)return{minX:0,minY:0,width:100,height:100};let Rt=1/0,yt=1/0,tn=-1/0,ti=-1/0;return E.forEach(Cs=>{const{x:Da,y:ks}=Ee(Cs,ee);Rt=Math.min(Rt,Da-ee),yt=Math.min(yt,ks-ee),tn=Math.max(tn,Da+ee),ti=Math.max(ti,ks+ee)}),{minX:Rt,minY:yt,width:tn-Rt,height:ti-yt}},[E]),F=k.useMemo(()=>{const{x:Rt,y:yt}=Ee(_,ee);return{x:Rt,y:yt}},[_]),Z=k.useMemo(()=>({x:Y.minX,y:Y.minY,width:Y.width,height:Y.height}),[Y.minX,Y.minY,Y.width,Y.height]),{svgRef:z,boardViewportRef:q,zoomPreset:B,isCameraPanning:$,setIsCameraPanning:X,cameraPanOffsetRef:le,isCameraPanningRef:fe,isPinchingRef:R,suppressTileClickUntilRef:W,activePointersRef:Q,dragStateRef:ne,pinchStateRef:re,cancelCameraAnimation:ce,animateCameraToTarget:me,updatePanFromWorldDelta:Ce,setZoomPresetAnimated:ve,renderedViewBox:_e}=v_({baseViewBox:Z,playerWorld:F,playerPosition:_,floor:e.floor,cameraSafeInsetsPx:f}),{latestTraceByActor:ke,movementTargetSet:ze,hasPrimaryMovementSkills:Ue,stairsKey:qe,shrineKey:Ge,fallbackNeighborSet:dt,selectedSkillTargetSet:Te,resolvedEnginePreviewGhost:rt}=O_({gameState:e,playerPos:_,selectedSkillId:a,showMovementRange:o,hoveredTile:b,enginePreviewGhost:m}),{tileVisualFlags:wt,assetById:Ut,deathDecalHref:Mt,manifestUnitToBoardScale:Un,biomeThemeKey:qn,biomeSeed:Nt,clutterLayer:Qn,wallsProfile:ft,wallsThemeOverride:St,boardProps:qt,resolveMountainSettings:Zn,hybridInteractionLayerEnabled:yn,backdropLayerProps:ua}=M_({cells:E,gameState:e,bounds:Y,assetManifest:c,biomeDebug:d}),{mountainSettingsByAssetId:ja,depthSortedSprites:ln,mountainCoveredWallKeys:De}=T_({assetManifest:c,biomeThemeKey:qn,biomeSeed:Nt,mountainAssetPathOverride:d?.mountainAssetPath,wallsMountainPath:ft?.mountainPath,wallsThemeMountainPath:St?.mountainPath,clutterLayer:Qn,cells:E,tileVisualFlags:wt,boardProps:qt,resolveMountainSettings:Zn}),{resetBoardEventEffects:et}=C_({gameState:e,deathDecalHref:Mt,decals:A,setDecals:O,setEntityPoseEffects:D,setEntityPoseNowMs:G,onSimulationEvents:h}),{handleResetView:st,handleTileClick:Mn,handleHoverTile:Ae,handleBoardPointerDown:Re,handleBoardPointerMove:We,handleBoardPointerUp:lt,handleBoardPointerCancel:ct,handleBoardWheel:$t}=d_({svgRef:z,onMove:n,zoomPreset:B,setHoveredTile:x,setIsCameraPanning:X,cameraPanOffsetRef:le,isCameraPanningRef:fe,isPinchingRef:R,suppressTileClickUntilRef:W,activePointersRef:Q,dragStateRef:ne,pinchStateRef:re,animateCameraToTarget:me,updatePanFromWorldDelta:Ce,setZoomPresetAnimated:ve}),{actorPositionById:At,juiceActorSnapshots:gn,entityVisualPoseById:bn}=R_({gameState:e,assetById:Ut,entityPoseEffects:N,entityPoseNowMs:H,onMirrorSnapshot:g}),{movementBusy:ri,resetMovementPlayback:ei}=L_({visualEvents:e.visualEvents,turnNumber:e.turnNumber,actorPositionById:At,svgRef:z,cancelCameraAnimation:ce});k.useEffect(()=>{r?.(ri||T)},[ri,T,r]),k.useLayoutEffect(()=>{ce(),ei(),et(),P()},[e.floor,ce,ei,et,P]);const $n=k.useMemo(()=>H_(ee-1),[]);return y.jsxs("div",{ref:q,className:`relative w-full h-full flex justify-center items-center overflow-hidden transition-transform duration-75 ${w?"animate-shake":""} ${$?"cursor-grabbing":""}`,children:[y.jsxs("div",{className:"relative w-full h-full",style:{transform:`translate3d(${I.x}px, ${I.y}px, 0)`,transition:"transform 85ms ease-out",willChange:I.x||I.y?"transform":void 0},children:[C&&y.jsx("div",{className:"absolute inset-0 z-20 pointer-events-none bg-white/10",style:{boxShadow:"inset 0 0 60px rgba(255,255,255,0.18)",animation:"flash 120ms ease-out"}}),y.jsxs("svg",{ref:z,width:"100%",height:"100%",viewBox:`${_e.x} ${_e.y} ${_e.width} ${_e.height}`,preserveAspectRatio:"xMidYMid meet",shapeRendering:"geometricPrecision",className:"max-h-full max-w-full",onMouseLeave:()=>x(null),onWheel:$t,onPointerDown:Re,onPointerMove:We,onPointerUp:lt,onPointerCancel:ct,style:{touchAction:"none"},children:[y.jsx(u_,{cells:E,...ua}),y.jsx(o_,{gameState:e,selectedSkillId:a,showMovementRange:o,hoveredTile:b,enginePreviewGhost:rt,cells:E,tileVisualFlags:wt,movementTargetSet:ze,hasPrimaryMovementSkills:Ue,fallbackNeighborSet:dt,selectedSkillTargetSet:Te,stairsKey:qe,shrineKey:Ge,mountainCoveredWallKeys:De,hybridInteractionLayerEnabled:yn,assetById:Ut,onTileClick:Mn,onTileHover:Ae,decals:A}),y.jsx(c_,{sprites:ln,floor:e.floor,manifestUnitToBoardScale:Un,mountainSettingsByAssetId:ja,resolveMountainSettings:Zn}),y.jsx(ZE,{gameState:e,latestTraceByActor:ke,entityVisualPoseById:bn,assetById:Ut,biomeThemeKey:qn,juiceActorSnapshots:gn,assetManifest:c,onJuiceBusyStateChange:S}),y.jsx(r_,{cells:E,gridPoints:$n}),y.jsx(vE,{boardProps:qt})]})]}),!1,y.jsx(xE,{presets:f_,activePreset:B,onSelectPreset:ve,onResetView:st})]})},B_=({theme:e,previewState:n,previewManifest:a})=>y.jsxs("main",{className:"flex-1 relative bg-[#050914] overflow-hidden",children:[y.jsxs("div",{className:"absolute top-4 right-5 z-20 px-3 py-2 rounded-lg border border-white/15 bg-black/35 text-[10px] font-black uppercase tracking-[0.2em]",children:["Theme: ",e]}),y.jsx("div",{className:"w-full h-full p-6",children:y.jsx("div",{className:"w-full h-full rounded-[28px] border border-white/10 bg-[#030712]/70 overflow-hidden",children:y.jsx(m0,{gameState:n,onMove:()=>{},selectedSkillId:null,showMovementRange:!1,assetManifest:a})})})]}),bl="/Hop",dg=64,fg=192,xl=64,vl=512,bt=(e,n,a)=>Math.min(a,Math.max(n,e)),j_=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,Co=e=>{const n=e.trim();if(!n||/^\/assets\/[a-z0-9/_\-.]+$/i.test(n))return n;const o=`${bl.endsWith("/")?bl:`${bl}/`}assets/`;return n.startsWith(o)?`/assets/${n.slice(o.length)}`:n.startsWith("/")?n:j_(bl,n)},Sl=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,d,h]=a.slice(1).split("");return`#${c}${c}${d}${d}${h}${h}`.toLowerCase()}return n},Bd=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",Al=e=>e==="off"?"off":Bd(e),D_=e=>{const n=e.theme.toLowerCase(),a=Co(e.undercurrent.path),o=Co(e.crust.path),r=Co(e.materials.detailA.path),c=Co(e.materials.detailB.path),h={mountainPath:Co(e.walls.mountainPath),mountainScale:bt(e.walls.mountainScale,.2,3),mountainOffsetX:e.walls.mountainOffsetX,mountainOffsetY:e.walls.mountainOffsetY,mountainAnchorX:bt(e.walls.mountainAnchorX,0,1),mountainAnchorY:bt(e.walls.mountainAnchorY,0,1),mountainCrustBlendMode:Al(e.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:bt(e.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Sl(e.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:Al(e.walls.mountainTintBlendMode),mountainTintOpacity:bt(e.walls.mountainTintOpacity,0,1),scale:bt(e.walls.mountainScale,.2,3),offsetX:e.walls.mountainOffsetX,offsetY:e.walls.mountainOffsetY,anchorX:bt(e.walls.mountainAnchorX,0,1),anchorY:bt(e.walls.mountainAnchorY,0,1),crustBlendMode:Al(e.walls.mountainCrustBlendMode),crustBlendOpacity:bt(e.walls.mountainCrustBlendOpacity,0,1),tintColor:Sl(e.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:Al(e.walls.mountainTintBlendMode),tintOpacity:bt(e.walls.mountainTintOpacity,0,1)},g={seed:e.seed.trim()||"biome-sandbox-seed",injectHazards:e.injectHazards,biomeLayers:{undercurrent:{default:a,mode:e.undercurrent.mode,scalePx:bt(e.undercurrent.scalePx,dg,fg),opacity:bt(e.undercurrent.opacity,0,1),offsetX:e.undercurrent.offsetX,offsetY:e.undercurrent.offsetY,scroll:{x:e.undercurrent.scrollX,y:e.undercurrent.scrollY,durationMs:Math.max(1e3,e.undercurrent.scrollDurationMs)}},crust:{default:o,mode:e.crust.mode,scalePx:Math.max(64,e.crust.scalePx),opacity:1,seedShiftPx:e.crust.seedShiftPx,offsetX:e.crust.offsetX,offsetY:e.crust.offsetY},clutter:{density:e.clutter.density,maxPerHex:e.clutter.maxPerHex,bleedScaleMax:e.clutter.bleedScaleMax}},walls:{mode:e.walls.mode,interiorDensity:e.walls.interiorDensity,clusterBias:e.walls.clusterBias,keepPerimeter:e.walls.keepPerimeter,...h},biomeMaterials:{crust:{detailA:{default:r,mode:e.materials.detailA.mode,scalePx:bt(e.materials.detailA.scalePx,xl,vl),opacity:bt(e.materials.detailA.opacity,0,1)},detailB:{default:c,mode:e.materials.detailB.mode,scalePx:bt(e.materials.detailB.scalePx,xl,vl),opacity:bt(e.materials.detailB.opacity,0,1)},tint:{default:Sl(e.materials.tintColor,"#8b6f4a"),opacity:bt(e.materials.tintOpacity,0,1),blendMode:Bd(e.materials.tintBlend)}}}};return{theme:e.theme,seed:e.seed.trim()||"biome-sandbox-seed",injectHazards:e.injectHazards,biomeLayers:{undercurrent:{default:a,mode:e.undercurrent.mode,scalePx:bt(e.undercurrent.scalePx,dg,fg),opacity:bt(e.undercurrent.opacity,0,1),offsetX:e.undercurrent.offsetX,offsetY:e.undercurrent.offsetY,scroll:{x:e.undercurrent.scrollX,y:e.undercurrent.scrollY,durationMs:Math.max(1e3,e.undercurrent.scrollDurationMs)}},crust:{default:o,mode:e.crust.mode,scalePx:Math.max(64,e.crust.scalePx),opacity:1,seedShiftPx:e.crust.seedShiftPx,offsetX:e.crust.offsetX,offsetY:e.crust.offsetY},clutter:{density:e.clutter.density,maxPerHex:e.clutter.maxPerHex,bleedScaleMax:e.clutter.bleedScaleMax}},walls:{mode:e.walls.mode,interiorDensity:e.walls.interiorDensity,clusterBias:e.walls.clusterBias,keepPerimeter:e.walls.keepPerimeter,...h,themes:{[n]:h}},biomeMaterials:{crust:{detailA:{default:r,mode:e.materials.detailA.mode,scalePx:bt(e.materials.detailA.scalePx,xl,vl),opacity:bt(e.materials.detailA.opacity,0,1)},detailB:{default:c,mode:e.materials.detailB.mode,scalePx:bt(e.materials.detailB.scalePx,xl,vl),opacity:bt(e.materials.detailB.opacity,0,1)},tint:{default:Sl(e.materials.tintColor,"#8b6f4a"),opacity:bt(e.materials.tintOpacity,0,1),blendMode:Bd(e.materials.tintBlend)}}},biomePresets:{[n]:g}}},P_=e=>k.useMemo(()=>{const n=new Set,a=new Set,o=new Set,r=new Set;if(!e)return{undercurrent:[],crust:[],detail:[],mountain:[]};const c=d=>{if(d){d.default&&(n.add(d.default),a.add(d.default),o.add(d.default));for(const h of Object.values(d.themes||{}))n.add(h),a.add(h),o.add(h)}};c(e.biomeLayers?.undercurrent),c(e.biomeLayers?.crust);for(const d of Object.values(e.biomePresets||{}))c(d?.biomeLayers?.undercurrent),c(d?.biomeLayers?.crust),d?.biomeMaterials?.crust?.detailA&&c(d.biomeMaterials.crust.detailA),d?.biomeMaterials?.crust?.detailB&&c(d.biomeMaterials.crust.detailB);if(e.biomeUnderlay){e.biomeUnderlay.default&&a.add(e.biomeUnderlay.default);for(const d of Object.values(e.biomeUnderlay.themes||{}))a.add(d)}e.biomeMaterials?.crust?.detailA&&c(e.biomeMaterials.crust.detailA),e.biomeMaterials?.crust?.detailB&&c(e.biomeMaterials.crust.detailB);for(const d of e.assets||[]){const h=new Set((d.tags||[]).map(m=>m.toLowerCase())),g=d.type==="prop"&&(d.id.toLowerCase().includes("mountain")||h.has("mountain"));(h.has("floor")||h.has("stone")||h.has("void")||h.has("frozen")||h.has("inferno"))&&(a.add(d.path),o.add(d.path)),(h.has("lava")||h.has("hazard")||h.has("fire")||h.has("quicksand"))&&n.add(d.path),(d.type==="decal"||d.type==="prop"||d.type==="tile")&&o.add(d.path),g&&r.add(d.path)}e.walls?.mountainPath&&r.add(e.walls.mountainPath);for(const d of Object.values(e.walls?.themes||{}))d?.mountainPath&&r.add(d.mountainPath);for(const d of Object.values(e.biomePresets||{})){d?.walls?.mountainPath&&r.add(d.walls.mountainPath);for(const h of Object.values(d?.walls?.themes||{}))h?.mountainPath&&r.add(h.mountainPath)}return{undercurrent:Array.from(n).sort((d,h)=>d.localeCompare(h)),crust:Array.from(a).sort((d,h)=>d.localeCompare(h)),detail:Array.from(o).sort((d,h)=>d.localeCompare(h)),mountain:Array.from(r).sort((d,h)=>d.localeCompare(h))}},[e]),mg="hop_biome_sandbox_settings_v1",p0=64,h0=192,Hl=64,Bl=512,U_=[{q:1,r:0,s:-1},{q:0,r:1,s:-1},{q:-1,r:1,s:0},{q:-1,r:0,s:1},{q:0,r:-1,s:1},{q:1,r:-1,s:0}],Cl=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,d,h]=a.slice(1).split("");return`#${c}${c}${d}${d}${h}${h}`.toLowerCase()}return n},q_=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619);return n>>>0},pg=e=>q_(e)/4294967295,y0=e=>e.has("BLOCKS_MOVEMENT")&&e.has("BLOCKS_LOS"),$_=e=>e.has("LAVA")||e.has("FIRE")||e.has("HAZARDOUS")&&e.has("LIQUID"),Gd=e=>U_.map(n=>ue({q:e.q+n.q,r:e.r+n.r,s:e.s+n.s})),z_=e=>{const n=new Set;for(const[a,o]of e.entries())Gd(o.position).some(c=>!e.has(c))&&n.add(a);return n},V_=(e,n,a)=>{const o=new Set,r=[{point:n,depth:0}];for(;r.length>0;){const c=r.shift(),d=ue(c.point);if(!o.has(d)&&e.has(d)&&(o.add(d),!(c.depth>=a)))for(const h of Gd(c.point)){const g=e.get(h);g&&r.push({point:g.position,depth:c.depth+1})}}return o},Ad=(e,n,a)=>{const o=e.get(n);if(!o)return;const r=new Set(Array.from(o.traits));a?(r.add("BLOCKS_MOVEMENT"),r.add("BLOCKS_LOS"),r.delete("LAVA"),r.delete("FIRE"),r.delete("LIQUID"),r.delete("HAZARDOUS")):(r.delete("BLOCKS_MOVEMENT"),r.delete("BLOCKS_LOS")),e.set(n,{...o,traits:r})},Fe=(e,n,a)=>Math.min(a,Math.max(n,e)),Tl=(e,n)=>e?n&&e.themes?.[n]?e.themes[n]:e.default||"":"",El=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"repeat":"off",Y_=(e,n)=>e?n&&e.themes?.[n]?e.themes[n]:e.default||"#8b6f4a":"#8b6f4a",Jd=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",jd=e=>e==="off"?"off":Jd(e),Td=(e,n,a,o)=>{const r=e?.[a]??e?.[o];return r!==void 0?r:n?.[a]??n?.[o]},K_=e=>{switch(e){case"inferno":return 4;case"throne":return 6;case"frozen":return 8;case"void":return 10;default:return 1}},F_=e=>{const n=new Map;for(const[a,o]of e.tiles.entries())n.set(a,{...o,traits:new Set(o.traits),effects:Array.isArray(o.effects)?[...o.effects]:[]});return n},X_=(e,n)=>{const a=(c,d,h)=>{const m=ue({q:c,r:d}),f=e.get(m);if(!f)return;const b=new Set(Array.from(f.traits));if(!y0(b)){for(const x of h)b.add(x);e.set(m,{...f,traits:b})}},o=[[0,0],[1,0],[0,1],[-1,1],[-1,0],[0,-1],[1,-1],[2,-1],[2,0],[1,1],[-2,1],[-2,0],[-1,-1]];for(const[c,d]of o)a(n.q+c,n.r+d,["HAZARDOUS","LIQUID","LAVA"]);const r=[[3,-1],[3,0],[2,1],[-3,1],[-3,0],[-2,-1]];for(const[c,d]of r)a(n.q+c,n.r+d,["HAZARDOUS","FIRE"])},W_=(e,n,a,o)=>{const r=o.mode,c=z_(e),d=V_(e,a,2),h=Array.from(e.keys()).sort((T,S)=>T.localeCompare(S));if(r==="custom")for(const T of h){if(d.has(T)){Ad(e,T,!1);continue}const S=o.keepPerimeter&&c.has(T);Ad(e,T,S)}if(r==="native")return;const g=Fe(Number(o.interiorDensity||0),0,.45),m=Fe(Number(o.clusterBias||0),0,1);if(g<=0&&m<=0)return;const f=h.filter(T=>{if(c.has(T)||d.has(T))return!1;const S=e.get(T);if(!S)return!1;const A=S.traits;return!$_(A)}),b=T=>{const S=e.get(T);return S?y0(S.traits):!1},x=new Set;for(const T of f){if(b(T))continue;pg(`${n}|sandbox-wall-seed|${T}`)<g&&x.add(T)}for(let T=0;T<2;T++)for(const S of f){if(b(S)||x.has(S))continue;const A=e.get(S);if(!A)continue;const O=Gd(A.position).filter(C=>e.has(C));let _=0;for(const C of O)(b(C)||x.has(C))&&_++;if(_===0)continue;const E=m*(_/6);pg(`${n}|sandbox-wall-grow|pass:${T}|${S}`)<E&&x.add(S)}for(const T of x)Ad(e,T,!0)},G_=(e,n,a,o)=>{const r=K_(e),c=n.trim()||"biome-sandbox-seed",d=Ba(r,c,c,void 0,Os.VANGUARD),h=F_(d);return W_(h,c,d.player.position,o),a&&X_(h,d.player.position),{...d,floor:r,theme:e,rngSeed:c,initialSeed:c,turnNumber:1,tiles:h,visualEvents:[],timelineEvents:[],intentPreview:void 0}},hg=(e,n)=>{const a=n.toLowerCase(),o=Xd(e,a),r=o?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,c=o?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),d=o?.biomeMaterials?.crust??e.biomeMaterials?.crust,h=d?.detailA,g=d?.detailB,m=d?.tint,f=o?.walls||e.walls,b=o?.walls?o.walls:e.walls?.themes?.[a],x=(e.assets||[]).filter(N=>{if(N.type!=="prop")return!1;const H=N.id.toLowerCase(),D=new Set((N.tags||[]).map(P=>P.toLowerCase()));if(!H.includes("mountain")&&!D.has("mountain"))return!1;if(!N.theme)return!0;const G=N.theme.toLowerCase();return G===a||G==="core"}).sort((N,H)=>N.id.localeCompare(H.id)),S=String(b?.mountainPath??f?.mountainPath??"").trim()||x.find(N=>N.path.toLowerCase().includes("biome.volcano.mountain.03.webp"))?.path||x[0]?.path||"",A=x.find(N=>N.path===S)||x[0],O=A?.mountainSettings,_=A?.mountainSettingsByTheme?.[a],E=A?o?.assetOverrides?.[A.id]?.mountainSettings:void 0,w=(N,H,D)=>{const P=Td(b,f,N,H)??E?.[N]??_?.[N]??O?.[N]??D,Y=Number(P);return Number.isFinite(Y)?Y:D},C=(N,H,D)=>{const P=Td(b,f,N,H)??E?.[N]??_?.[N]??O?.[N]??D;return jd(P)},I=(N,H,D)=>{const P=Td(b,f,N,H)??E?.[N]??_?.[N]??O?.[N]??D;return Cl(String(P||""),D)};return{theme:n,seed:String(o?.seed||"biome-sandbox-seed"),injectHazards:o?.injectHazards!==void 0?!!o.injectHazards:!0,undercurrent:{path:Tl(r,a),mode:El(r),scalePx:Fe(Number(r?.scalePx??e.tileUnitPx??256),p0,h0),opacity:Fe(Number(r?.opacity??.6),0,1),scrollX:Number(r?.scroll?.x??120),scrollY:Number(r?.scroll?.y??90),scrollDurationMs:Math.max(1e3,Number(r?.scroll?.durationMs??92e3)),offsetX:Number(r?.offsetX??0),offsetY:Number(r?.offsetY??0)},crust:{path:Tl(c,a),mode:El(c),scalePx:Math.max(64,Number(c?.scalePx??e.tileUnitPx??256)),opacity:1,seedShiftPx:Math.max(0,Number(c?.seedShiftPx??96)),offsetX:Number(c?.offsetX??0),offsetY:Number(c?.offsetY??0)},clutter:{density:Fe(Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.density??.14),0,1),maxPerHex:Math.max(0,Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.maxPerHex??1)),bleedScaleMax:Fe(Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.bleedScaleMax??2),1,2)},walls:{mode:f?.mode==="native"||f?.mode==="additive"||f?.mode==="custom"?f.mode:"custom",interiorDensity:Fe(Number(f?.interiorDensity??.05),0,.45),clusterBias:Fe(Number(f?.clusterBias??0),0,1),keepPerimeter:f?.keepPerimeter!==void 0?!!f.keepPerimeter:!0,mountainPath:S,mountainScale:Fe(w("scale","mountainScale",.53),.2,3),mountainOffsetX:w("offsetX","mountainOffsetX",0),mountainOffsetY:w("offsetY","mountainOffsetY",0),mountainAnchorX:Fe(w("anchorX","mountainAnchorX",.5),0,1),mountainAnchorY:Fe(w("anchorY","mountainAnchorY",.55),0,1),mountainCrustBlendMode:C("crustBlendMode","mountainCrustBlendMode","multiply"),mountainCrustBlendOpacity:Fe(w("crustBlendOpacity","mountainCrustBlendOpacity",1),0,1),mountainTintColor:I("tintColor","mountainTintColor","#7d7d7d"),mountainTintBlendMode:C("tintBlendMode","mountainTintBlendMode","overlay"),mountainTintOpacity:Fe(w("tintOpacity","mountainTintOpacity",1),0,1)},materials:{detailA:{path:Tl(h,a),mode:El(h),scalePx:Fe(Number(h?.scalePx??192),Hl,Bl),opacity:Fe(Number(h?.opacity??0),0,1)},detailB:{path:Tl(g,a),mode:El(g),scalePx:Fe(Number(g?.scalePx??256),Hl,Bl),opacity:Fe(Number(g?.opacity??0),0,1)},tintColor:Y_(m,a),tintOpacity:Fe(Number(m?.opacity??0),0,1),tintBlend:Jd(m?.blendMode)}}},J_=e=>{if(!e)return null;try{const n=JSON.parse(e);return!n||typeof n!="object"?null:n}catch{return null}},yg=(e,n)=>{const a=Number(e);return Number.isFinite(a)?a:n},Q_=({assetManifest:e,onBack:n})=>{const a=k.useRef(!1),[o,r]=k.useState(""),[c,d]=k.useState(null);k.useEffect(()=>{if(!e||a.current)return;const S=hg(e,"inferno"),A=J_(localStorage.getItem(mg));if(!A){d(S),a.current=!0;return}d({...S,...A,undercurrent:{...S.undercurrent,...A.undercurrent||{},scalePx:Fe(Number((A.undercurrent||{}).scalePx??S.undercurrent.scalePx),p0,h0)},crust:{...S.crust,...A.crust||{},opacity:1},clutter:{...S.clutter,...A.clutter||{}},walls:{...S.walls,...A.walls||{},mode:(A.walls||{}).mode==="native"||(A.walls||{}).mode==="additive"||(A.walls||{}).mode==="custom"?(A.walls||{}).mode:S.walls.mode,interiorDensity:Fe(Number((A.walls||{}).interiorDensity??S.walls.interiorDensity),0,.45),clusterBias:Fe(Number((A.walls||{}).clusterBias??S.walls.clusterBias),0,1),keepPerimeter:(A.walls||{}).keepPerimeter!==void 0?!!(A.walls||{}).keepPerimeter:S.walls.keepPerimeter,mountainPath:String((A.walls||{}).mountainPath||S.walls.mountainPath||""),mountainScale:Fe(Number((A.walls||{}).mountainScale??S.walls.mountainScale),.2,3),mountainOffsetX:yg(String((A.walls||{}).mountainOffsetX??S.walls.mountainOffsetX),S.walls.mountainOffsetX),mountainOffsetY:yg(String((A.walls||{}).mountainOffsetY??S.walls.mountainOffsetY),S.walls.mountainOffsetY),mountainAnchorX:Fe(Number((A.walls||{}).mountainAnchorX??S.walls.mountainAnchorX),0,1),mountainAnchorY:Fe(Number((A.walls||{}).mountainAnchorY??S.walls.mountainAnchorY),0,1),mountainCrustBlendMode:jd((A.walls||{}).mountainCrustBlendMode??S.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:Fe(Number((A.walls||{}).mountainCrustBlendOpacity??S.walls.mountainCrustBlendOpacity),0,1),mountainTintColor:Cl(String((A.walls||{}).mountainTintColor??S.walls.mountainTintColor),S.walls.mountainTintColor),mountainTintBlendMode:jd((A.walls||{}).mountainTintBlendMode??S.walls.mountainTintBlendMode),mountainTintOpacity:Fe(Number((A.walls||{}).mountainTintOpacity??S.walls.mountainTintOpacity),0,1)},materials:{...S.materials,...A.materials||{},detailA:{...S.materials.detailA,...(A.materials||{}).detailA||{},scalePx:Fe(Number(((A.materials||{}).detailA||{}).scalePx??S.materials.detailA.scalePx),Hl,Bl),opacity:Fe(Number(((A.materials||{}).detailA||{}).opacity??S.materials.detailA.opacity),0,1)},detailB:{...S.materials.detailB,...(A.materials||{}).detailB||{},scalePx:Fe(Number(((A.materials||{}).detailB||{}).scalePx??S.materials.detailB.scalePx),Hl,Bl),opacity:Fe(Number(((A.materials||{}).detailB||{}).opacity??S.materials.detailB.opacity),0,1)},tintOpacity:Fe(Number((A.materials||{}).tintOpacity??S.materials.tintOpacity),0,1),tintBlend:Jd((A.materials||{}).tintBlend)}}),a.current=!0},[e]),k.useEffect(()=>{c&&localStorage.setItem(mg,JSON.stringify(c))},[c]);const h=c?.theme?.toLowerCase()||"inferno",g=k.useMemo(()=>Cl(c?.materials.tintColor||"#8b6f4a"),[c?.materials.tintColor]),m=k.useMemo(()=>Cl(c?.walls.mountainTintColor||"#8b6f4a"),[c?.walls.mountainTintColor]),f=P_(e),b=k.useMemo(()=>bE(e,c,h),[e,c,h]),x=k.useMemo(()=>c?G_(c.theme,c.seed,c.injectHazards,c.walls):null,[c]),T=async()=>{if(!c)return;const S=D_(c);try{await navigator.clipboard.writeText(JSON.stringify(S,null,2)),r("Copied"),window.setTimeout(()=>r(""),1600)}catch{r("Copy failed"),window.setTimeout(()=>r(""),1600)}};return!e||!c||!b||!x?y.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex items-center justify-center",children:[y.jsx("button",{type:"button",onClick:n,className:"absolute top-5 left-5 px-4 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-[0.2em]",children:"Back"}),y.jsx("div",{className:"text-sm text-white/70 uppercase tracking-[0.25em] font-black",children:"Loading Biome Sandbox..."})]}):y.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex",children:[y.jsx(oE,{settings:c,setSettings:d,pathSets:f,copyStatus:o,onBack:n,onReset:()=>d(hg(e,c.theme)),onCopySettings:T,tintPickerColor:g,mountainTintPickerColor:m}),y.jsx(B_,{theme:c.theme,previewState:x,previewManifest:b})]})},Z_=(e,n)=>{const a=new Set(e.map(h=>h.type)),o=a.has("ADVANCE_TURN"),r=a.has("RESOLVE_PENDING"),c=e.length,d=n>=5&&c<Math.max(25,n*4);return{actionCount:c,hasTurnAdvance:o,hasPendingResolve:r,suspiciouslyShort:d}},ew=()=>{const[e,n]=k.useState(null);return k.useEffect(()=>{let a=!0;return hE().then(o=>{a&&(n(o),window.__HOP_ASSET_MANIFEST=o)}),()=>{a=!1}},[]),e},tw=e=>{k.useEffect(()=>{if(!(typeof window<"u"&&!!window.__HOP_DEBUG_PERF))return;let a=0,o=performance.now(),r=0,c=0,d=o;const h=g=>{const m=g-o;if(o=g,r++,c+=m,g-d>=2e3){const f=c/Math.max(1,r),b=1e3/Math.max(1,f);console.log("[HOP_PERF]",{fps:Number(b.toFixed(1)),avgFrameMs:Number(f.toFixed(2)),frames:r}),d=g,r=0,c=0}a=requestAnimationFrame(h)};return a=requestAnimationFrame(h),()=>cancelAnimationFrame(a)},e)},nw=(e,n)=>{k.useEffect(()=>{n&&(window.state=e,window.QUERY={tile:(a,o)=>{const c=ue({q:a,r:o});return console.log(`Checking Map for Key: "${c}"`),e.tiles.get(c)},whereAmI:()=>{const a=e.player.position,o=ue(a),r=e.tiles.get(o);return{coords:a,key:o,tileExists:!!r,tileData:r}},dumpKeys:()=>Array.from(e.tiles.keys())})},[e,n])},iw=e=>e instanceof Map?e:Array.isArray(e)?new Map(e):e&&typeof e=="object"?new Map(Object.entries(e)):new Map,gg=e=>{const n={...e,components:iw(e?.components)},a=No(n),r=(a.components??new Map).get("trinity");if(!r)return a;const c=Pl({body:Number(r.body||0),mind:Number(r.mind||0),instinct:Number(r.instinct||0)});return{...a,maxHp:c,hp:Math.min(c,Math.max(0,Number(a.hp??c)))}},aw=()=>{const e=localStorage.getItem("hop_save");if(!e)return Rl();try{const n=JSON.parse(e);if(n.tiles){const a=Array.isArray(n.tiles)?n.tiles:Object.entries(n.tiles);n.tiles=new Map(a.map(([o,r])=>[o,{...r,traits:new Set(r.traits)}]))}return Array.isArray(n.occupancyMask)&&(n.occupancyMask=n.occupancyMask.map(a=>typeof a=="string"?BigInt(a):a)),n.player=Yd(gg(n.player)),n.enemies=Array.isArray(n.enemies)?n.enemies.map(gg):[],n}catch(n){return console.error("Failed to hydrate Map state:",n),Rl()}},sw=()=>{const[e,n]=k.useReducer(Y1,null,aw),a=k.useRef(null),o=k.useRef(""),r=e.gameStatus==="playing"||e.gameStatus==="choosing_upgrade",c=`${e.gameStatus}|${e.floor}|${e.turnNumber}|${e.player.hp}|${ue(e.player.position)}|${e.enemies.length}|${e.actionLog?.length??0}|${e.message?.length??0}`;return k.useEffect(()=>{if(a.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(a.current):window.clearTimeout(a.current),a.current=null),!r){o.current="",localStorage.removeItem("hop_save");return}if(c===o.current)return;const d=()=>{const h={...e,tiles:Array.from(e.tiles.entries()).map(([m,f])=>[m,{...f,traits:Array.from(f.traits)}])},g=m=>JSON.stringify(m,(f,b)=>typeof b=="bigint"?b.toString():b);localStorage.setItem("hop_save",g(h)),o.current=c,a.current=null};return typeof window.requestIdleCallback=="function"?a.current=window.requestIdleCallback(d,{timeout:500}):a.current=window.setTimeout(d,120),()=>{a.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(a.current):window.clearTimeout(a.current),a.current=null)}},[e,r,c]),[e,n]},ow=({dispatchWithTrace:e})=>{const[n,a]=k.useState(!1),[o,r]=k.useState([]),[c,d]=k.useState(!1),[h,g]=k.useState(null),m=k.useRef(0),f=k.useCallback(()=>{d(!1),a(!1),g(null),r([]),m.current=0},[]),b=k.useCallback(T=>{if(!T)return;const S=s0(T.actions||[]);if(!S.valid){const E=`Replay rejected: ${S.errors.slice(0,3).join(" | ")}`;g(E),console.error("[HOP_REPLAY] Invalid replay actions",{replayId:T.id,errors:S.errors});return}g(null),a(!0),r(S.actions),d(!1),m.current=0;const A=T.seed||T.id||String(Date.now()),O=T.loadoutId?Os[T.loadoutId]:void 0,_=Ba(1,A,A,void 0,O);e({type:"LOAD_STATE",payload:_},"replay_start")},[e]),x=k.useCallback(()=>{const T=m.current;if(T>=o.length){d(!1);return}e(o[T],"replay_step"),m.current=T+1},[e,o]);return k.useEffect(()=>{if(!c||!n)return;const T=window.setInterval(x,500);return()=>window.clearInterval(T)},[c,n,x]),{isReplayMode:n,replayActions:o,replayActive:c,replayError:h,replayIndexRef:m,setReplayActive:d,resetReplayUi:f,startReplay:b,stepReplay:x}},rw=({gameState:e,appendTurnTrace:n})=>{const a=k.useRef([]),o=k.useRef(null),r=k.useRef(""),[c,d]=k.useState([]),h=k.useCallback(f=>{const b=Date.now();d(x=>[...x,{...f,createdAt:b}].slice(-4))},[]),g=k.useCallback(f=>{if(!(!f||f.length===0)){a.current=[...a.current,...f].slice(-600),window.__HOP_SIM_EVENTS=a.current,window.dispatchEvent(new CustomEvent("hop:simulation-events",{detail:{turn:e.turnNumber,events:f}})),n("SIM_EVENTS",{count:f.length,lastType:f[f.length-1]?.type??"unknown"});for(const b of f)if(b.type==="DamageTaken"&&b.targetId===e.player.id){const x=Math.max(0,Number(b.payload?.amount||0));x>0&&h({id:`sim-toast-${b.id}`,text:`-${x} HP`,tone:"damage"})}else if(b.type==="Healed"&&b.targetId===e.player.id){const x=Math.max(0,Number(b.payload?.amount||0));x>0&&h({id:`sim-toast-${b.id}`,text:`+${x} HP`,tone:"heal"})}else if(b.type==="StatusApplied"&&b.targetId===e.player.id){const T=String(b.payload?.status||"Status").split("_").filter(Boolean).map(S=>S.charAt(0).toUpperCase()+S.slice(1)).join(" ");h({id:`sim-toast-${b.id}`,text:T,tone:"status"})}else if(b.type==="MessageLogged"){const x=String(b.payload?.text||"").trim();if(!x)continue;const T=x.toLowerCase();if(!(T.includes("stun")||T.includes("snare")||T.includes("lava")||T.includes("fire")||T.includes("burn")||T.includes("heal")||T.includes("shrine")||T.includes("stairs")||T.includes("roll away")||T.includes("ward")||T.includes("orb")))continue;const A=x.length>52?`${x.slice(0,49)}...`:x;h({id:`sim-toast-${b.id}`,text:A,tone:"system"})}}},[n,e.turnNumber,e.player.id,h]),m=k.useCallback(f=>{o.current=f,window.__HOP_UI_MIRROR=f},[]);return k.useEffect(()=>(window.__HOP_SIM_EVENTS=a.current,window.__HOP_DUMP_SIM_EVENTS=()=>[...a.current],window.__HOP_CLEAR_SIM_EVENTS=()=>{a.current=[],window.__HOP_SIM_EVENTS=[]},window.__HOP_DUMP_MIRROR=()=>window.__HOP_MIRROR_LAST,()=>{delete window.__HOP_DUMP_SIM_EVENTS,delete window.__HOP_CLEAR_SIM_EVENTS,delete window.__HOP_DUMP_MIRROR}),[]),k.useEffect(()=>{if(c.length===0)return;const f=window.setTimeout(()=>{const b=Date.now();d(x=>x.filter(T=>b-T.createdAt<2200))},180);return()=>window.clearTimeout(f)},[c]),k.useEffect(()=>{const f=Z1(e);window.__HOP_ENGINE_MIRROR=f;const b=o.current;if(!b||b.turn!==f.turn||b.stackTick!==f.stackTick)return;const x=eE(f,b),T=`${f.turn}:${f.stackTick}:${x.ok?"ok":x.mismatches.length}`;T!==r.current&&(r.current=T,window.__HOP_MIRROR_LAST={engineSnapshot:f,uiSnapshot:b,result:x},x.ok||(n("MIRROR_MISMATCH",{count:x.mismatches.length}),console.warn("[HOP_MIRROR] snapshot mismatch detected",x.mismatches)))},[e,n]),{mobileToasts:c,handleSimulationEvents:g,handleUiMirrorSnapshot:m}},lw=e=>{const n=e||[],a=n.length>0?n[n.length-1]:void 0;return`${n.length}:${a?.type??"none"}`},cw=e=>{const n=e||[],a=n.length>0?n[n.length-1]:void 0;return`${n.length}:${a?.id??"none"}:${a?.phase??"none"}`},uw=({gameState:e,turnDriver:n,isBusy:a,isReplayMode:o,postCommitInputLock:r,setPostCommitInputLock:c,appendTurnTrace:d,dispatchWithTrace:h})=>{const[g,m]=k.useState(0),f=k.useRef(null),b=k.useRef(null),x=k.useRef(null),T=k.useRef(null),S=k.useRef(""),A=k.useRef(""),O=k.useRef(!1),_=k.useRef(""),E=k.useRef(""),w=k.useRef(!1),C=k.useRef(0),I=220,N=900,H=e.pendingFrames?.length??0,D=lw(e.visualEvents),G=cw(e.timelineEvents),P=`${e.pendingStatus?.status??"none"}:${H}`,Y=k.useCallback((Z="unknown")=>{r&&d("LOCK_RELEASE",{reason:Z,lockTurn:f.current,expectedActionLogLength:b.current}),c(!1),f.current=null,b.current=null,x.current=null,O.current=!1,_.current="",E.current="",T.current!==null&&(window.clearTimeout(T.current),T.current=null)},[d,r,c]);return k.useEffect(()=>{if(!n.shouldAdvanceQueue)return;d("QUEUE_SCHEDULE",{delayMs:n.queueAdvanceDelayMs});const Z=window.setTimeout(()=>{h({type:"ADVANCE_TURN"},"queue_pump")},n.queueAdvanceDelayMs);return()=>window.clearTimeout(Z)},[n.shouldAdvanceQueue,n.queueAdvanceDelayMs,e.turnNumber,e.initiativeQueue,e.player.id,e.enemies,h,d]),k.useEffect(()=>{a||(S.current=D,A.current=G)},[a,D,G]),k.useEffect(()=>{w.current=!1,C.current=performance.now()},[P]),k.useEffect(()=>{(e.pendingStatus||H>0)&&a&&(w.current=!0)},[e.pendingStatus,H,a]),k.useEffect(()=>{r&&a&&(O.current=!0)},[r,a]),k.useEffect(()=>{if(!r)return;const Z=window.setTimeout(()=>{m(z=>z+1)},120);return()=>window.clearTimeout(Z)},[r,g]),k.useEffect(()=>{const Z=!a&&D===S.current&&G===A.current,z=(e.timelineEvents||[]).some(Q=>Q.blocking),q=(e.timelineEvents||[]).filter(Q=>Q.blocking).reduce((Q,ne)=>Q+(ne.suggestedDurationMs||0),0),B=(e.visualEvents||[]).reduce((Q,ne)=>{if(ne.type!=="kinetic_trace")return Q;const re=ne.payload;if(!re)return Q;const ce=Math.max(0,Number(re.startDelayMs||0)),me=Math.max(0,Number(re.durationMs||0));return Math.max(Q,ce+me)},0),$=Math.max(q,B),X=$>0?Math.max(160,Math.min(3200,$+40)):0,le=Math.max(0,performance.now()-C.current),fe=!z||w.current,R=!z||le>=X,W=Z&&(fe||R);if(n.shouldResolvePending){if(W){d("PENDING_RESOLVE_READY",{noPendingAnimations:Z,hasBlockingTimeline:z,movementTraceBudgetMs:B,elapsedPendingMs:le,requiredFallbackDelayMs:X}),h({type:"RESOLVE_PENDING"},"pending_ready");return}if(!a&&z&&!w.current){d("PENDING_RESOLVE_WAIT",{movementTraceBudgetMs:B,elapsedPendingMs:le,requiredFallbackDelayMs:X});const Q=Math.max(0,X-le),ne=window.setTimeout(()=>{h({type:"RESOLVE_PENDING"},"pending_fallback_delay")},Q);return()=>window.clearTimeout(ne)}}},[n.shouldResolvePending,e.timelineEvents,e.visualEvents,a,D,G,h,d]),k.useEffect(()=>{if(!r)return;if(o||e.gameStatus!=="playing"){Y("mode_or_status_change");return}if(e.pendingStatus||(e.pendingFrames?.length??0)>0){Y("pending_intercept");return}const Z=f.current,z=b.current,q=x.current!==null?Math.max(0,performance.now()-x.current):Number.POSITIVE_INFINITY,B=Z!==null?e.turnNumber>Z:!1,$=z!==null?(e.actionLog?.length??0)>=z:!1,X=q>=I,le=D!==_.current||G!==E.current,fe=!B&&!$,R=!O.current&&le&&q<N,W=e.gameStatus==="playing"&&!o&&!a&&!e.pendingStatus&&(e.pendingFrames?.length??0)===0&&Ho(e);if(R){d("LOCK_WAIT_FOR_BUSY",{lockAgeMs:q,visualsChangedSinceArm:le});return}if(W&&fe&&q>450){Y("no_progress_timeout");return}W&&X&&(B||$||q>1500)&&Y(B?"turn_advanced":$?"action_committed":"age_fallback")},[r,o,e.gameStatus,e.turnNumber,e.pendingStatus,e.pendingFrames,e.initiativeQueue,e.actionLog,a,e.player.id,e.enemies,d,D,G,g,Y]),k.useEffect(()=>{e.gameStatus!=="playing"&&r&&Y("not_playing")},[e.gameStatus,r,Y]),k.useEffect(()=>{if(r)return T.current!==null&&window.clearTimeout(T.current),T.current=window.setTimeout(()=>{if(r){const Z=Array.isArray(window.__HOP_TURN_TRACE)?window.__HOP_TURN_TRACE:[];console.error("[HOP_INPUT_LOCK] Watchdog released stuck post-commit lock",{turnNumber:e.turnNumber,pendingStatus:e.pendingStatus?.status,pendingFrames:e.pendingFrames?.length??0,playerTurn:Ho(e),isBusy:a,actionLogLength:e.actionLog?.length??0,traceTail:Z.slice(-40)}),d("LOCK_WATCHDOG_RELEASE"),Y("watchdog")}},8e3),()=>{T.current!==null&&(window.clearTimeout(T.current),T.current=null)}},[r,e.turnNumber,e.pendingStatus,e.actionLog,a,e.initiativeQueue,e.player.id,e.enemies,d,Y]),k.useEffect(()=>{if(!r)return;const Z=window.setTimeout(()=>{d("LOCK_STALL_SNAPSHOT",{lockAgeMs:x.current!==null?Math.max(0,performance.now()-x.current):null})},2500);return()=>window.clearTimeout(Z)},[r,d]),{armPostCommitLock:k.useCallback(()=>{T.current!==null&&(window.clearTimeout(T.current),T.current=null),f.current=e.turnNumber,b.current=(e.actionLog?.length??0)+1,x.current=performance.now(),O.current=!1,_.current=D,E.current=G,c(!0),d("LOCK_ARM",{lockTurn:e.turnNumber,expectedActionLogLength:(e.actionLog?.length??0)+1,eventHashAtArm:D,timelineHashAtArm:G})},[e.turnNumber,e.actionLog,D,G,c,d])}},dw=e=>{const{gameStatus:n,isReplayMode:a,isBusy:o,postCommitInputLock:r,isPlayerTurn:c,hasPendingStatus:d,pendingFrameCount:h}=e,g=d||h>0;let m="IDLE";return a?m="REPLAY":n!=="playing"?m="IDLE":g?m=o?"INTERCEPT_ANIMATING":"INTERCEPT_READY":o?m="PLAYBACK":r&&c?m="POST_COMMIT_LOCK":r&&!c?m="POST_COMMIT_QUEUE":c?m="INPUT_OPEN":m="QUEUE_ADVANCE",{phase:m,canPlayerInput:m==="INPUT_OPEN",shouldAdvanceQueue:m==="QUEUE_ADVANCE"||m==="POST_COMMIT_QUEUE",shouldResolvePending:m==="INTERCEPT_READY",queueAdvanceDelayMs:380}},fw=({gameState:e,dispatch:n,isReplayMode:a,isBusy:o,postCommitInputLock:r,dispatchWithTraceProxyRef:c,summarizeActionPayload:d})=>{const h=e.pendingFrames?.length??0,g=k.useMemo(()=>dw({gameStatus:e.gameStatus,isReplayMode:a,isBusy:o,postCommitInputLock:r,isPlayerTurn:Ho(e),hasPendingStatus:!!e.pendingStatus,pendingFrameCount:h}),[e.gameStatus,a,o,r,e.pendingStatus,h,e.initiativeQueue,e.player.id,e.enemies]),m=!g.canPlayerInput,f=k.useRef([]),b=k.useRef(0),x=k.useRef(""),T=e.initiativeQueue?.entries?.[Math.max(0,e.initiativeQueue.currentIndex??0)]?.actorId??e.initiativeQueue?.entries?.[0]?.actorId??"none",S=k.useCallback((O,_)=>{const E={id:++b.current,t:Date.now(),event:O,turnNumber:e.turnNumber,phase:g.phase,gameStatus:e.gameStatus,playerTurn:Ho(e),isBusy:o,postCommitInputLock:r,pendingStatus:e.pendingStatus?.status??"none",pendingFrames:e.pendingFrames?.length??0,canPlayerInput:g.canPlayerInput,shouldAdvanceQueue:g.shouldAdvanceQueue,shouldResolvePending:g.shouldResolvePending,actionLogLength:e.actionLog?.length??0,queueHead:T,details:_};f.current.push(E),f.current.length>800&&f.current.splice(0,f.current.length-800)},[e.turnNumber,e.gameStatus,e.pendingStatus,e.pendingFrames,e.actionLog,e.initiativeQueue,e.player.id,e.enemies,g.phase,g.canPlayerInput,g.shouldAdvanceQueue,g.shouldResolvePending,o,r,T]),A=k.useCallback((O,_)=>{S("DISPATCH",{source:_,actionType:O.type,payload:d(O)}),n(O)},[S,n,d]);return c&&(c.current=A),k.useEffect(()=>{const O=[g.phase,e.turnNumber,e.gameStatus,e.pendingStatus?.status??"none",e.pendingFrames?.length??0,o?1:0,r?1:0,T].join("|");O!==x.current&&(S("TURN_STATE"),x.current=O)},[g.phase,e.turnNumber,e.gameStatus,e.pendingStatus,e.pendingFrames,o,r,T,S]),k.useEffect(()=>(window.__HOP_TURN_TRACE=f.current,window.__HOP_DUMP_TURN_TRACE=()=>[...f.current],window.__HOP_PRINT_TURN_TRACE=(O=80)=>{const _=f.current.slice(-Math.max(1,Math.floor(O)));return console.table(_.map(E=>({id:E.id,event:E.event,turn:E.turnNumber,phase:E.phase,status:E.gameStatus,playerTurn:E.playerTurn,busy:E.isBusy,lock:E.postCommitInputLock,pending:`${E.pendingStatus}/${E.pendingFrames}`,queueHead:E.queueHead,actionLog:E.actionLogLength,details:E.details?JSON.stringify(E.details):""}))),_},window.__HOP_CLEAR_TURN_TRACE=()=>{f.current.length=0,b.current=0},f.current.push({id:++b.current,t:Date.now(),event:"TRACE_READY",turnNumber:0,phase:"INIT",gameStatus:"init",playerTurn:!1,isBusy:!1,postCommitInputLock:!1,pendingStatus:"none",pendingFrames:0,canPlayerInput:!1,shouldAdvanceQueue:!1,shouldResolvePending:!1,actionLogLength:0,queueHead:"none"}),()=>{delete window.__HOP_DUMP_TURN_TRACE,delete window.__HOP_PRINT_TURN_TRACE,delete window.__HOP_CLEAR_TURN_TRACE}),[]),{turnDriver:g,isInputLocked:m,appendTurnTrace:S,dispatchWithTrace:A}},mw=()=>{const[e,n]=k.useState(()=>window.location.pathname);k.useEffect(()=>{const r=()=>n(window.location.pathname);return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const a=r=>{window.location.pathname!==r&&window.history.pushState({},"",r),n(r)},o=k.useMemo(()=>{const r=e.toLowerCase().startsWith("/hop")?"/Hop":"",c=`${r||""}`||"/",d=`${r}/Arcade`||"/Arcade",h=`${r}/Biomes`||"/Biomes",m=e.toLowerCase().replace(/\/+$/,""),f=m.endsWith("/arcade")||m.endsWith("/arcarde"),b=m.endsWith("/biomes");return{hubPath:c,arcadePath:d,biomesPath:h,isArcadeRoute:f,isBiomesRoute:b}},[e]);return{pathname:e,navigateTo:a,...o}},pw=({onSelect:e})=>y.jsxs("div",{className:"relative z-50 flex flex-col items-center justify-center p-8 gap-8 animate-in fade-in zoom-in duration-500",children:[y.jsxs("div",{className:"text-center space-y-2",children:[y.jsx("h1",{className:"text-4xl font-black uppercase tracking-widest text-white mb-2",children:"Select Class"}),y.jsx("p",{className:"text-white/40 text-sm uppercase tracking-wider",children:"Choose your combat doctrine"})]}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl",children:Object.values(Os).map(n=>y.jsxs("button",{onClick:()=>{console.log("Archetype Selected:",n.id),e(n)},className:"group relative flex flex-col items-start p-8 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/30 rounded-3xl transition-all hover:scale-[1.02] text-left cursor-pointer",children:[y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 rounded-3xl transition-opacity"}),y.jsxs("div",{className:"relative z-10 w-full",children:[y.jsxs("div",{className:"flex justify-between items-start mb-4",children:[y.jsx("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10 group-hover:border-white/30 transition-colors",children:y.jsx("span",{className:"text-3xl",children:Bo(n.id==="ASSASSIN"?"assassin_player":n.id.toLowerCase(),"player").icon})}),y.jsx("div",{className:"px-3 py-1 bg-white/5 rounded-full border border-white/10 text-[10px] font-bold uppercase tracking-widest text-white/50",children:n.id==="VANGUARD"?"Standard":"Advanced"})]}),y.jsx("h3",{className:"text-2xl font-black uppercase tracking-wide text-white mb-2",children:n.name}),y.jsx("p",{className:"text-white/60 text-sm leading-relaxed mb-6 h-12",children:n.description}),y.jsxs("div",{className:"space-y-3",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/30 font-bold border-b border-white/5 pb-1",children:"Starting Loadout"}),y.jsx("div",{className:"flex flex-wrap gap-2",children:n.startingSkills.map(a=>y.jsx("div",{className:"px-2 py-1 bg-black/40 rounded border border-white/10 text-[10px] text-blue-200",children:a.replace("_"," ")},a))})]})]})]},n.id))})]}),hw="hop_replays_v1",yw="hop_leaderboard_v1",bg=()=>{try{const e=localStorage.getItem(hw);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load replays",e),[]}},xg=()=>{try{const e=localStorage.getItem(yw);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load leaderboard",e),[]}},vg=e=>{const n=Array.isArray(e.actions)?e.actions:[],a=new Set(n.map(m=>m?.type)),o=a.has("ADVANCE_TURN"),r=a.has("RESOLVE_PENDING"),c=(e.floor||0)>=5&&n.length<Math.max(25,(e.floor||0)*4),d=(e.replayVersion??1)<2,h=n.length===0,g=h?"invalid replay":c?"truncated replay":d?"legacy replay":null;return{isLegacy:d,invalid:h,suspicious:c||e.floor>1&&!r,label:g,hasTurnAdvance:o,hasPendingResolve:r,actionCount:n.length}},Sg=({onStartReplay:e})=>{const[n,a]=k.useState(()=>bg()),[o,r]=k.useState(()=>xg()),[c,d]=k.useState(""),[h,g]=k.useState(""),[m,f]=k.useState(""),[b,x]=k.useState(null);k.useEffect(()=>{const A=()=>{a(bg()),r(xg())};return window.addEventListener("storage",A),()=>window.removeEventListener("storage",A)},[]);const T=()=>{x(null);try{const A=m.trim();if(!A)return x("Paste actions JSON first."),null;const O=JSON.parse(A);let _=c.trim()||void 0,E=h.trim()||void 0,w=[];return Array.isArray(O)?w=O:O&&typeof O=="object"&&(w=Array.isArray(O.actions)?O.actions:[],_=_||(typeof O.seed=="string"?O.seed:void 0),E=E||(typeof O.loadoutId=="string"?O.loadoutId:void 0)),!Array.isArray(w)||w.length===0?(x('No actions found. Provide a JSON action array or object with "actions".'),null):w.filter(N=>N&&typeof N.type=="string").length===0?(x('Actions must be objects with a "type" field.'),null):{id:`manual-${Date.now()}`,seed:_,loadoutId:E,actions:w,score:0,floor:1,date:new Date().toISOString(),replayVersion:2,diagnostics:{actionCount:w.length,hasTurnAdvance:w.some(N=>N?.type==="ADVANCE_TURN"),hasPendingResolve:w.some(N=>N?.type==="RESOLVE_PENDING"),suspiciouslyShort:!1}}}catch(A){return x(`Invalid JSON: ${A?.message||"parse error"}`),null}},S=()=>{const A=T();A&&e(A)};return y.jsxs("div",{className:"flex flex-col gap-8",children:[y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-4",children:[y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-emerald-400",children:"Manual Replay"}),y.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Paste from UPA"})]}),y.jsxs("div",{className:"space-y-2 p-3 rounded-2xl border border-white/5 bg-white/[0.02]",children:[y.jsx("input",{value:c,onChange:A=>d(A.target.value),placeholder:"Seed (optional if included in JSON)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),y.jsx("input",{value:h,onChange:A=>g(A.target.value),placeholder:"Loadout ID (optional)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),y.jsx("textarea",{value:m,onChange:A=>f(A.target.value),placeholder:'Paste JSON actions array, or object: {"seed":"...","loadoutId":"...","actions":[...]}',rows:6,className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40 font-mono"}),b&&y.jsx("div",{className:"text-[10px] text-red-400 font-bold uppercase tracking-wider",children:b}),y.jsx("button",{onClick:S,className:"w-full py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 text-xs font-black uppercase tracking-widest transition-colors",children:"Start Manual Replay"})]})]}),y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-4",children:[y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400",children:"Hall of Fame"}),y.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Top 5 Only"})]}),y.jsxs("div",{className:"space-y-2",children:[o.length===0&&y.jsx("div",{className:"p-4 rounded-xl border border-white/5 bg-white/[0.02] text-center",children:y.jsx("span",{className:"text-[10px] text-white/30 uppercase font-black",children:"No Champions Yet"})}),o.slice(0,5).map((A,O)=>{const _={id:A.id,seed:A.seed,loadoutId:A.loadoutId,actions:A.actions||[],score:A.score,floor:A.floor,date:A.date,replayVersion:A.replayVersion,diagnostics:A.diagnostics},E=vg(_);return y.jsxs("button",{onClick:()=>e(_),className:"w-full group relative flex items-center gap-4 p-4 bg-white/[0.03] hover:bg-white/[0.07] border border-white/5 hover:border-indigo-500/30 rounded-2xl transition-all text-left",children:[y.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-indigo-500/10 rounded-lg text-indigo-400 font-black text-sm border border-indigo-500/20",children:O+1}),y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[y.jsx("span",{className:"font-black text-white uppercase text-xs truncate tracking-wider",children:A.name}),y.jsx("span",{className:"text-[10px] font-black text-indigo-400 tabular-nums",children:A.score.toLocaleString()})]}),y.jsxs("div",{className:"text-[9px] text-white/30 font-bold uppercase tracking-widest",children:["Floor ",A.floor," * ",new Date(A.date).toLocaleDateString()," * ",E.actionCount," acts"]}),E.label&&y.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:E.label})]}),y.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-indigo-400 text-xs",children:"Play"})]},A.id)})]})]}),y.jsxs("section",{children:[y.jsx("div",{className:"flex items-center justify-between mb-4",children:y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Recent Simulations"})}),y.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar pr-2",children:[n.length===0&&y.jsx("div",{className:"text-center py-4",children:y.jsx("span",{className:"text-[10px] text-white/10 uppercase font-bold",children:"Log Empty"})}),n.slice(0,10).map(A=>{const O=vg(A);return y.jsxs("button",{onClick:()=>e(A),className:"w-full flex items-center justify-between p-3 hover:bg-white/[0.04] rounded-xl transition-colors text-left group",children:[y.jsxs("div",{className:"min-w-0",children:[y.jsxs("div",{className:"text-[10px] font-bold text-white/60 mb-0.5 truncate uppercase",children:["Score: ",y.jsx("span",{className:"text-white",children:A.score})," * F",A.floor," * ",O.actionCount," acts"]}),y.jsx("div",{className:"text-[9px] text-white/20 font-medium",children:new Date(A.date).toLocaleTimeString()}),O.label&&y.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:O.label})]}),y.jsx("div",{className:"text-[10px] text-white/0 group-hover:text-white/40 font-black uppercase tracking-widest transition-all",children:"Replay"})]},A.id)})]})]})]})};class gw{state;constructor(){this.state=Ba(1,"tutorial-seed"),this.state.enemies=[],this.state.tiles=new Map}setPlayer(n,a){this.state.player={...this.state.player,position:n,previousPosition:n,activeSkills:a.map(o=>{const r=Xt.get(o);return{id:o,name:typeof r?.name=="function"?r.name(this.state):r?.name||o,description:r?.description||"",slot:r?.slot||"offensive",cooldown:r?.baseVariables.cooldown||0,currentCooldown:0,range:r?.baseVariables.range||0,upgrades:Object.keys(r?.upgrades||{}),activeUpgrades:[]}})}}spawnEnemy(n,a,o){const r=_d[n]||{hp:1,maxHp:1};this.state.enemies.push({id:o,type:"enemy",subtype:n,position:a,previousPosition:a,hp:r.hp,maxHp:r.maxHp,enemyType:r.type||"melee",statusEffects:[],temporaryArmor:0,activeSkills:[],speed:r.speed||1,factionId:"enemy"})}spawnFalcon(n,a){const o={id:a,type:"enemy",subtype:"falcon",factionId:"player",speed:95,position:{...n},previousPosition:{...n},hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],isFlying:!0,companionOf:"player",companionState:{mode:"roost",orbitStep:0,apexStrikeCooldown:0}};this.state.enemies.push(o),this.state.companions||(this.state.companions=[]),this.state.companions.push(o)}spawnCompanion(n,a,o){n==="falcon"&&this.spawnFalcon(a,o)}setTile(n,a){const o=a.toUpperCase(),r=ue(n),c=_s[o];if(!c){console.warn(`Attempted to set unknown tile type: ${o}`);return}this.state.tiles.set(r,{baseId:o,position:n,traits:new Set(c.defaultTraits||[]),effects:[],occupantId:void 0})}addUpgrade(n,a){this.state.player.activeSkills=(this.state.player.activeSkills||[]).map(o=>o.id===n?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}useSkill(n,a){}wait(){}move(n){}getEnemy(n){return this.state.enemies.find(a=>a.id===n)}setTurn(n){this.state.turnNumber=n}exitToHub(){}applyStatus(n,a){const o=this.state.enemies.findIndex(r=>r.id===n);o!==-1&&(this.state.enemies[o]=Od(this.state.enemies[o],a,1))}}const Ag=({onLoadScenario:e})=>{const n=Object.values(ql),a=o=>{const r=new gw;o.setup(r),r.state.initiativeQueue=Ha(r.state),e(r.state,o.description)};return y.jsx("div",{className:"flex flex-col gap-4",children:n.map(o=>y.jsxs("div",{className:"flex flex-col gap-2",children:[y.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-white/50",children:typeof o.name=="function"?o.name(Ba(1,"temp")):o.name}),y.jsx("div",{className:"flex flex-col gap-1",children:o.scenarios?.map(r=>y.jsx("button",{onClick:()=>a(r),className:"text-left px-3 py-2 bg-white/5 hover:bg-white/10 rounded text-xs text-white/80 transition-colors border border-transparent hover:border-white/20",children:r.title},r.id))})]},o.id))})},bw=({gameState:e,onSelectLoadout:n,onStartRun:a,onOpenArcade:o,onLoadScenario:r,onStartReplay:c})=>y.jsxs("div",{className:"w-full h-full flex flex-col bg-[#020617]",children:[y.jsx("header",{className:"border-b border-white/5 px-4 sm:px-6 lg:px-12 py-3 sm:py-4 bg-[#030712]/50 backdrop-blur-xl z-30",children:y.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[y.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[y.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-indigo-500 rounded-lg flex items-center justify-center font-black text-lg sm:text-xl shadow-[0_0_20px_rgba(99,102,241,0.5)]",children:"H"}),y.jsxs("div",{children:[y.jsxs("h1",{className:"text-base sm:text-lg font-black uppercase tracking-tighter leading-none italic",children:["Hop ",y.jsx("span",{className:"text-indigo-500",children:"Engine"})]}),y.jsx("div",{className:"text-[9px] sm:text-[10px] font-bold text-white/30 tracking-[0.22em] sm:tracking-[0.3em] uppercase mt-1",children:"Strategic Hub v5.0"})]})]}),y.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 lg:gap-8",children:[y.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 sm:bg-transparent sm:border-0 sm:p-0",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/40 mb-1",children:"Current Loadout"}),y.jsx("div",{className:"text-sm font-bold text-indigo-400 truncate",children:e.selectedLoadoutId||"No Archetype Selected"})]}),e.selectedLoadoutId&&y.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:items-center sm:gap-3",children:[y.jsxs("button",{onClick:()=>a("normal"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center leading-tight",children:[y.jsx("span",{children:"Start Run"}),y.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"10 Floors | Boss Defeat"})]}),y.jsxs("button",{onClick:()=>a("daily"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(16,185,129,0.3)] flex flex-col items-center justify-center leading-tight",children:[y.jsx("span",{children:"Daily"}),y.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"Seeded Challenge"})]})]})]})]})}),y.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-y-auto lg:overflow-hidden",children:[y.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-12 custom-scrollbar",children:y.jsxs("div",{className:"max-w-4xl mx-auto",children:[y.jsxs("div",{className:"mb-6 sm:mb-10 lg:mb-12",children:[y.jsx("button",{onClick:o,className:"mb-4 sm:mb-5 w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 font-black uppercase tracking-widest text-xs sm:text-sm transition-all",children:"Arcade Mode"}),y.jsxs("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-black uppercase tracking-tighter mb-2 italic",children:["Select Your ",y.jsx("span",{className:"text-indigo-500",children:"Archetype"})]}),y.jsx("p",{className:"text-sm sm:text-base text-white/40 max-w-xl",children:"Choose your tactical specialty. Each archetype provides unique skills and modifies your core interaction with the engine."})]}),y.jsx(pw,{onSelect:n})]})}),y.jsxs("section",{className:"lg:hidden border-t border-white/5 bg-[#030712]/50 backdrop-blur-sm p-4 sm:p-6 space-y-4",children:[y.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[y.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[y.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Historical Replay"}),y.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),y.jsx("div",{className:"mt-3",children:y.jsx(Sg,{gameState:e,onStartReplay:c})})]}),y.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[y.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[y.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Training Simulations"}),y.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),y.jsx("div",{className:"mt-3",children:y.jsx(Ag,{onLoadScenario:r})})]})]}),y.jsx("aside",{className:"hidden lg:flex w-[450px] border-l border-white/5 bg-[#030712]/80 backdrop-blur-md flex-col z-20",children:y.jsxs("div",{className:"p-8 flex flex-col gap-12 h-full overflow-y-auto custom-scrollbar",children:[y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-6",children:[y.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Historical Replay"}),y.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]}),y.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:y.jsx(Sg,{gameState:e,onStartReplay:c})})]}),y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-6",children:[y.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Training Simulations"}),y.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]}),y.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:y.jsx(Ag,{onLoadScenario:r})})]}),y.jsx("div",{className:"mt-auto pt-8 border-t border-white/5 opacity-20 hover:opacity-100 transition-opacity",children:y.jsx("div",{className:"text-[10px] font-bold uppercase tracking-[0.4em] mb-2 text-center text-white/50",children:"Engine Status: Online"})})]})})]})]}),xw={VANGUARD:"V",HUNTER:"H",FIREMAGE:"F",NECROMANCER:"N",SKIRMISHER:"S"},Tg=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return n>>>0},vw=(e=new Date)=>e.toISOString().slice(0,10),Sw=(e,n)=>{if(e.length<2)throw new Error("Arcade mode requires at least two loadouts.");const o=Tg(`arcade-a:${n}`)%e.length,r=e[o],c=e.filter(m=>m.id!==r.id),h=Tg(`arcade-b:${n}`)%c.length,g=c[h];return[r,g]},Aw=({onBack:e,onLaunchArcade:n})=>{const a=Fn.useMemo(()=>Object.values(Os),[]),o=Fn.useMemo(()=>vw(),[]),[r,c]=Fn.useMemo(()=>Sw(a,o),[a,o]);return y.jsxs("div",{className:"w-full h-full flex flex-col bg-[#040a18]",children:[y.jsxs("header",{className:"h-20 border-b border-white/10 flex items-center justify-between px-12 bg-[#050b1f]/80 backdrop-blur-xl z-30",children:[y.jsxs("div",{children:[y.jsxs("h1",{className:"text-xl font-black uppercase tracking-tight italic",children:["Hop ",y.jsx("span",{className:"text-emerald-400",children:"Arcade"})]}),y.jsxs("div",{className:"text-[10px] uppercase tracking-[0.3em] text-white/40 mt-1",children:["Daily Draft ",o]})]}),y.jsx("button",{onClick:e,className:"px-5 py-2.5 rounded-xl border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-widest",children:"Back to Strategic Hub"})]}),y.jsx("main",{className:"flex-1 overflow-y-auto p-12",children:y.jsxs("div",{className:"max-w-5xl mx-auto",children:[y.jsxs("div",{className:"mb-10",children:[y.jsx("h2",{className:"text-4xl font-black uppercase tracking-tight italic mb-3",children:"Arcade Mode"}),y.jsx("p",{className:"text-white/60 max-w-3xl",children:"Pick one of two daily archetypes and run the seeded challenge. Both options share the same seed for fair comparison."})]}),y.jsx("div",{className:"flex flex-col gap-6",children:[r,c].map((d,h)=>{const g=h===1,m=xw[d.id]||d.id.slice(0,1);return y.jsx("button",{onClick:()=>n(d.id),className:"w-full text-left group rounded-3xl border border-white/10 bg-gradient-to-r from-white/[0.06] to-white/[0.02] hover:from-emerald-500/20 hover:to-cyan-500/10 transition-all p-6",children:y.jsxs("div",{className:`flex items-center justify-between gap-6 ${g?"flex-row-reverse":""}`,children:[y.jsxs("div",{className:"flex items-center gap-4 min-w-[200px]",children:[y.jsx("div",{className:`w-20 h-20 rounded-2xl border border-white/15 bg-[#0b1733] flex items-center justify-center text-4xl font-black text-emerald-300 shadow-[0_0_35px_rgba(16,185,129,0.25)] ${g?"-scale-x-100":""}`,children:m}),y.jsxs("div",{children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Daily Archetype"}),y.jsx("div",{className:"text-2xl font-black uppercase tracking-tight",children:d.name})]})]}),y.jsxs("div",{className:"flex-1",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/40 mb-2",children:"Starting Skills"}),y.jsx("div",{className:"flex flex-wrap gap-2",children:d.startingSkills.slice(0,6).map(f=>y.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full border border-white/20 bg-white/5 font-bold tracking-wide",children:f},f))})]}),y.jsxs("div",{className:"text-right min-w-[150px]",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Launch"}),y.jsx("div",{className:"text-sm font-black uppercase tracking-widest text-emerald-300 group-hover:text-emerald-200",children:"Start Arcade Run"})]})]})},d.id)})})]})})]})},Tw=({replayError:e})=>e?y.jsx("div",{className:"absolute top-4 right-4 z-40 max-w-xl px-4 py-3 rounded-xl border border-red-400/40 bg-red-900/70 text-red-100 text-xs font-bold tracking-wide",children:e}):null,g0=({tutorialInstructions:e,onDismiss:n})=>e?y.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[y.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),y.jsx("p",{className:"text-white text-sm",children:e}),y.jsx("button",{onClick:n,className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:"X"})]}):null,Ew=({visible:e})=>e?y.jsx("div",{className:"absolute inset-0 z-40 pointer-events-auto",children:y.jsx("div",{className:"absolute top-3 sm:top-4 lg:top-6 left-1/2 -translate-x-1/2 h-10 w-10 rounded-full bg-black/55 border border-white/15 text-lg flex items-center justify-center text-white/80 animate-pulse","aria-label":"Resolving turn",title:"Resolving turn",children:"..."})}):null,_w=({mobileToasts:e})=>e.length===0?null:y.jsx("div",{className:"lg:hidden fixed left-1/2 -translate-x-1/2 top-16 z-50 pointer-events-none flex flex-col gap-2 w-[min(92vw,26rem)]",children:e.map(n=>{const a=n.tone==="damage"?"border-red-400/30 bg-red-950/75 text-red-100":n.tone==="heal"?"border-emerald-400/30 bg-emerald-950/70 text-emerald-100":n.tone==="status"?"border-cyan-300/30 bg-cyan-950/70 text-cyan-100":"border-white/15 bg-black/65 text-white/85";return y.jsx("div",{className:`rounded-xl border px-3 py-2 backdrop-blur-md shadow-[0_4px_20px_rgba(0,0,0,0.35)] text-xs font-bold tracking-wide ${a}`,children:n.text},n.id)})}),ww=({visible:e,onReset:n})=>e?y.jsxs("div",{className:"fixed inset-0 bg-red-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[y.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:"X"}),y.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Identity Deleted"}),y.jsx("p",{className:"text-red-200/60 mb-12 text-xl font-medium tracking-widest uppercase",children:"Simulation Terminated"}),y.jsx("button",{onClick:n,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Reinitialize Simulation"})]}):null,Mw=({visible:e,score:n,onExitToHub:a})=>e?y.jsxs("div",{className:"fixed inset-0 bg-indigo-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[y.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:"OK"}),y.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Arcade Mode Cleared"}),y.jsx("p",{className:"text-indigo-200/60 mb-2 text-xl font-medium tracking-widest uppercase",children:"The Sentinel has fallen"}),y.jsxs("p",{className:"text-white/20 mb-12 text-sm font-bold uppercase tracking-[0.3em]",children:["Score: ",n]}),y.jsx("button",{onClick:a,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Return to Command Center"})]}):null,Ow=({floorIntro:e})=>e?y.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[150] pointer-events-none animate-in fade-in duration-700",children:y.jsxs("div",{className:"text-center",children:[y.jsxs("div",{className:"text-indigo-500 font-black text-2xl uppercase tracking-[0.5em] mb-4 animate-in slide-in-from-bottom-8 duration-1000",children:["Floor ",e.floor]}),y.jsx("h2",{className:"text-8xl font-black text-white uppercase tracking-tighter italic animate-in slide-in-from-top-12 duration-1000",children:e.theme}),y.jsx("div",{className:"h-1 w-64 bg-white/20 mx-auto mt-8 rounded-full overflow-hidden",children:y.jsx("div",{className:"h-full bg-indigo-500 animate-[progress_3s_linear]"})})]})}):null,Cw=({isReplayMode:e,replayIndex:n,replayLength:a,replayActive:o,onToggleReplay:r,onStepReplay:c,onCloseReplay:d})=>e?y.jsxs("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 bg-[#030712]/90 border border-indigo-500/30 p-6 rounded-3xl backdrop-blur-2xl shadow-[0_0_50px_rgba(79,70,229,0.2)] z-[250] flex items-center gap-8 animate-in slide-in-from-bottom-8 duration-500",children:[y.jsxs("div",{className:"flex flex-col",children:[y.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 mb-1",children:"Replay System"}),y.jsxs("span",{className:"text-white font-bold text-sm",children:["Step ",n," / ",a]})]}),y.jsx("div",{className:"h-8 w-px bg-white/10"}),y.jsxs("div",{className:"flex items-center gap-4",children:[y.jsx("button",{onClick:r,className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${o?"bg-indigo-500 text-white shadow-[0_0_20px_rgba(79,70,229,0.5)]":"bg-white/5 text-white/50 hover:bg-white/10"}`,children:o?"PAUSE":"PLAY"}),y.jsx("button",{onClick:c,disabled:o,className:"w-12 h-12 bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:hover:bg-white/5 text-white rounded-xl flex items-center justify-center transition-all",children:"NEXT"})]}),y.jsx("div",{className:"h-8 w-px bg-white/10"}),y.jsx("button",{onClick:d,className:"px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl font-bold uppercase text-xs tracking-widest transition-all",children:"Close"})]}):null,kw=({gameState:e,isArcadeRoute:n,hubPath:a,arcadePath:o,biomesPath:r,replayError:c,tutorialInstructions:d,navigateTo:h,onStartArcadeRun:g,onSelectLoadout:m,onStartRun:f,onLoadScenario:b,onStartReplay:x,onDismissTutorial:T})=>y.jsxs("div",{className:"w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[!n&&y.jsx("button",{type:"button",onClick:()=>h(r),className:"absolute top-4 right-4 z-40 px-4 py-2 rounded-xl border border-cyan-300/35 bg-cyan-500/10 hover:bg-cyan-500/20 text-[10px] font-black uppercase tracking-[0.2em]",children:"Biome Sandbox"}),n?y.jsx(Aw,{onBack:()=>h(a),onLaunchArcade:g}):y.jsx(bw,{gameState:e,onSelectLoadout:m,onStartRun:f,onOpenArcade:()=>h(o),onLoadScenario:b,onStartReplay:x}),y.jsx(Tw,{replayError:c}),y.jsx(g0,{tutorialInstructions:d,onDismiss:T})]}),Nw=({gameState:e})=>{const{initiativeQueue:n,player:a,enemies:o}=e;if(!n||!n.entries||n.entries.length===0)return null;const r=n.entries.map(c=>c.actorId===a.id?a:o.find(d=>d.id===c.actorId)).filter(c=>!!c);return y.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-white/5 border border-white/10 rounded-2xl backdrop-blur-md",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Turn Sequence"}),y.jsx("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-none",children:r.map((c,d)=>{const h=c.id===a.id,g=d===n.currentIndex,f=n.entries.find(b=>b.actorId===c.id)?.hasActed;return y.jsxs("div",{className:`flex flex-col items-center shrink-0 transition-all duration-300 ${g?"scale-110":"opacity-60 scale-90"}`,children:[y.jsxs("div",{className:`
                                w-10 h-10 rounded-xl flex items-center justify-center border-2 transition-all relative
                                ${h?"bg-blue-500/20 border-blue-500/50":"bg-red-500/20 border-red-500/50"}
                                ${g?"shadow-[0_0_15px_rgba(255,255,255,0.2)] border-white/80":""}
                                ${f?"grayscale":""}
                            `,children:[y.jsx("span",{className:"text-xl",children:Bo(c.subtype,c.type,c.enemyType,c.archetype).icon}),g&&y.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping"}),f&&!g&&y.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-[#030712] text-[8px]",children:""})]}),y.jsx("div",{className:"w-8 h-1 bg-white/10 rounded-full mt-2 overflow-hidden",children:y.jsx("div",{className:`h-full ${h?"bg-blue-400":"bg-red-400"}`,style:{width:`${c.hp/c.maxHp*100}%`}})}),y.jsx("span",{className:`text-[8px] font-bold uppercase mt-1 ${h?"text-blue-300":"text-red-300"} ${g?"text-white":""}`,children:h?"You":c.subtype||"Enemy"})]},`${c.id}-${d}`)})})]})},Rw=({gameState:e,onReset:n,onWait:a,onExitToHub:o,inputLocked:r=!1,compact:c=!1,hideInitiativeQueue:d=!1,hideLog:h=!1})=>{const g=Dg(e),m=Array.isArray(e.message)?e.message:[],f=Fn.useRef(null),[b,x]=Fn.useState("all"),[T,S]=Fn.useState("all"),A=(E,w)=>{const C=E||"",I=C.toLowerCase(),N=C.match(/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*(.*)$/i);if(N){const G=N[1].toLowerCase(),P=N[2].toLowerCase(),Y=N[3]||"",F=P.includes("combat")?"combat":P.includes("hazard")?"hazard":P.includes("objective")||P.includes("score")?"objective":P.includes("ai")?"ai":"system";return{idx:w,raw:E,text:Y,level:G,channel:F}}const H=/(attacked|killed|blast|stunned|damage|hit|healed|shield|bash|spear|fireball|jump|dash)/i.test(I)?"combat":/(lava|burn|hazard|void|sink|fire damage)/i.test(I)?"hazard":/(score|objective|floor|stairs|descending|arcade cleared)/i.test(I)?"objective":/(enemy|falcon|intent|telegraph|moves to|repositioning|attacks)/i.test(I)?"ai":"system",D=/(fallen|warning|error|failed|invalid|blocked|cannot)/i.test(I)?"critical":/(debug|trace|telemetry|seed|counter|rng)/i.test(I)?"debug":/(marks the impact zone|telegraph|planning|intent)/i.test(I)?"verbose":"info";return{idx:w,raw:E,text:C,level:D,channel:H}},O=Fn.useMemo(()=>m.map((E,w)=>A(E,w)),[m]),_=Fn.useMemo(()=>O.filter(E=>(b==="all"||E.level===b)&&(T==="all"||E.channel===T)),[O,b,T]);return Fn.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[_]),y.jsxs("div",{className:"flex flex-col h-full max-h-screen",children:[y.jsxs("div",{className:`flex flex-col overflow-y-auto flex-1 min-h-0 ${c?"gap-4 p-4":"gap-8 p-8"}`,children:[y.jsxs("div",{className:"flex justify-between items-start",children:[y.jsxs("div",{children:[y.jsx("h1",{className:`${c?"text-base":"text-xl"} font-black uppercase tracking-widest text-white/90 mb-1`,children:"Hoplite"}),y.jsx("p",{className:"text-[10px] font-bold text-white/30 uppercase tracking-[0.2em]",children:"Tactical Arena"})]}),y.jsx("div",{className:`px-2 py-1 bg-white/10 rounded border border-white/20 text-[10px] font-black text-white/60 ${c?"hidden sm:block":""}`,children:"V2.1.0"})]}),!d&&y.jsx(Nw,{gameState:e}),y.jsxs("div",{className:c?"space-y-4":"space-y-6",children:[y.jsxs("div",{className:"flex flex-col",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Vitality"}),y.jsxs("div",{className:"flex items-end gap-2",children:[y.jsx("span",{className:`${c?"text-3xl":"text-4xl"} font-black text-red-500 leading-none`,children:e.player.hp}),y.jsx("span",{className:"text-xl text-white/20 font-bold leading-none mb-1",children:"/"}),y.jsx("span",{className:"text-xl text-gray-500 font-bold leading-none mb-1",children:e.player.maxHp})]})]}),y.jsxs("div",{className:"flex flex-col",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Guardian Plating"}),y.jsxs("div",{className:"flex items-center gap-3",children:[y.jsx("div",{className:`w-3 h-3 rounded-sm ${e.player.temporaryArmor?"bg-blue-400 rotate-45":"bg-white/5 border border-white/10"}`}),y.jsx("span",{className:"text-2xl font-black text-blue-400 leading-none",children:e.player.temporaryArmor||0})]})]}),e.enemies.filter(E=>E.subtype==="sentinel").map(E=>y.jsxs("div",{className:"pt-4 animate-in slide-in-from-right-8 duration-500",children:[y.jsxs("div",{className:"flex justify-between items-end mb-2",children:[y.jsx("span",{className:"text-xs font-black text-red-500 uppercase tracking-tighter italic",children:"Sentinel Directive"}),y.jsxs("span",{className:"text-lg font-black",children:[E.hp," ",y.jsxs("span",{className:"text-white/20 text-xs",children:["/ ",E.maxHp]})]})]}),y.jsx("div",{className:"h-4 w-full bg-red-950/30 rounded-md border border-red-500/20 overflow-hidden",children:y.jsx("div",{className:"h-full bg-gradient-to-r from-red-600 to-red-400 shadow-[0_0_20px_rgba(239,68,68,0.4)] transition-all duration-300",style:{width:`${E.hp/E.maxHp*100}%`}})})]},E.id))]}),y.jsxs("div",{className:`${c?"py-4 space-y-4":"py-8 space-y-6"} border-y border-white/5`,children:[y.jsxs("div",{className:"flex flex-col gap-3",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Arcade Progress"}),y.jsxs("span",{className:"text-xl font-black",children:[e.floor," ",y.jsx("span",{className:"text-white/20 text-sm",children:"/ 10"})]})]}),y.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden border border-white/5",children:y.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.4)] transition-all duration-1000 ease-out",style:{width:`${e.floor/10*100}%`}})})]}),y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Current Score"}),y.jsx("span",{className:"text-xl font-black text-white",children:g.toLocaleString()})]})]}),y.jsxs("div",{className:`flex flex-col ${c?"gap-2":"gap-3"}`,children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Directives"}),y.jsxs("button",{disabled:r,onClick:a,className:`w-full flex justify-between items-center ${c?"px-3 py-2.5":"px-4 py-3"} border rounded-xl transition-all group ${r?"bg-white/[0.03] border-white/5 text-white/30 cursor-not-allowed opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}`,children:[y.jsx("span",{className:"text-sm font-bold text-white/70",children:"Secure & Wait"}),y.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),y.jsxs("button",{onClick:n,className:`w-full flex justify-between items-center ${c?"px-3 py-2.5":"px-4 py-3"} bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-xl transition-all group`,children:[y.jsx("span",{className:"text-sm font-bold text-red-400/80",children:"Reset Chronology"}),y.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),y.jsxs("button",{onClick:o,className:`w-full flex justify-between items-center ${c?"px-3 py-2.5":"px-4 py-3"} bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all group`,children:[y.jsx("span",{className:"text-sm font-bold text-white/70",children:"Return to Hub"}),y.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]})]})]}),!h&&m.length>0&&y.jsxs("div",{className:`${c?"p-4":"p-8"} border-t border-white/5 bg-[#030712]/80 backdrop-blur-sm`,children:[y.jsxs("div",{className:"flex items-center justify-between mb-3",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold block",children:"Tactical Log"}),y.jsxs("div",{className:`items-center gap-2 ${c?"hidden sm:flex":"flex"}`,children:[y.jsxs("select",{value:T,onChange:E=>S(E.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[y.jsx("option",{value:"all",children:"All Channels"}),y.jsx("option",{value:"combat",children:"Combat"}),y.jsx("option",{value:"hazard",children:"Hazard"}),y.jsx("option",{value:"objective",children:"Objective"}),y.jsx("option",{value:"ai",children:"AI"}),y.jsx("option",{value:"system",children:"System"})]}),y.jsxs("select",{value:b,onChange:E=>x(E.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[y.jsx("option",{value:"all",children:"All Levels"}),y.jsx("option",{value:"info",children:"Info"}),y.jsx("option",{value:"verbose",children:"Verbose"}),y.jsx("option",{value:"debug",children:"Debug"}),y.jsx("option",{value:"critical",children:"Critical"})]})]})]}),y.jsxs("div",{ref:f,className:"flex flex-col gap-2 bg-white/[0.02] border border-white/5 p-4 rounded-2xl overflow-y-auto max-h-[140px]",children:[_.slice(-20).map(E=>y.jsxs("div",{className:"flex gap-2 items-start",children:[y.jsxs("span",{className:"text-[10px] text-white/20 font-bold mt-1 leading-none shrink-0",children:["[",E.idx,"]"]}),y.jsx("span",{className:`text-[9px] mt-1 px-1.5 py-0.5 rounded border shrink-0 ${E.level==="critical"?"text-red-300 border-red-400/40 bg-red-500/10":E.level==="debug"?"text-cyan-300 border-cyan-400/40 bg-cyan-500/10":E.level==="verbose"?"text-amber-300 border-amber-400/40 bg-amber-500/10":"text-white/60 border-white/20 bg-white/5"}`,children:E.level.toUpperCase()}),y.jsx("span",{className:"text-[9px] mt-1 px-1.5 py-0.5 rounded border border-white/20 bg-white/5 text-white/60 shrink-0",children:E.channel.toUpperCase()}),y.jsx("p",{className:"text-[11px] leading-tight text-white/70 font-medium whitespace-pre-wrap",children:E.text})]},E.idx)),_.length===0&&y.jsx("div",{className:"text-[11px] text-white/40 italic",children:"No messages match current filters."})]})]})]})},Iw=({onSelect:e,gameState:n})=>{const a=n.player,r=(n.pendingStatus?.shrineOptions||n.shrineOptions||["EXTRA_HP"]).map(c=>{if(c==="EXTRA_HP")return{id:"EXTRA_HP",label:"Extra Heart",desc:"Increases your Max HP by 1 and heals you to full.",color:"bg-red-900/40 border-red-500"};const d=Xt.getUpgrade(c),h=Xt.getSkillForUpgrade(c),g=a.activeSkills?.find(f=>f.id===h),m=g?.slot==="offensive"?"bg-orange-900/40 border-orange-500":g?.slot==="defensive"?"bg-blue-900/40 border-blue-500":"bg-green-900/40 border-green-500";return{id:c,label:d?d.name:c,desc:d?.description||"Unknown upgrade.",color:m}});return y.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-[100] p-4",children:y.jsxs("div",{className:"bg-gray-900 p-8 rounded-3xl border-2 border-slate-700 max-w-2xl w-full shadow-2xl relative overflow-hidden",children:[y.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-blue-500 to-green-500"}),y.jsx("h2",{className:"text-4xl font-black text-white mb-2 text-center tracking-tight",children:"SHRINE BLESSING"}),y.jsx("p",{className:"text-slate-400 mb-8 text-center text-lg",children:"The gods offer you a choice. Choose wisely."}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(c=>y.jsxs("button",{onClick:()=>e(c.id),className:`
                                relative p-6 border-2 rounded-2xl text-left transition-all group overflow-hidden
                                hover:scale-[1.02] active:scale-[0.98]
                                ${c.color} hover:bg-slate-800
                            `,children:[y.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-blue-200",children:c.label}),y.jsx("p",{className:"text-sm text-slate-400 group-hover:text-slate-300 leading-relaxed",children:c.desc}),y.jsx("div",{className:"absolute -right-2 -bottom-2 opacity-0 group-hover:opacity-10 scale-0 group-hover:scale-150 transition-all font-bold text-4xl",children:"*"})]},c.id))})]})})},Eg=({skills:e,selectedSkillId:n,onSelectSkill:a,hasSpear:o,gameState:r,inputLocked:c=!1,compact:d=!1})=>{const h=["offensive","defensive","utility"];return y.jsx("div",{className:d?"grid grid-cols-3 gap-2 sm:grid-cols-4":"flex flex-col gap-4",children:h.flatMap(g=>e.filter(f=>f.slot===g).map(f=>{const b=n===f.id,x=f.currentCooldown>0,T=f.id==="SPEAR_THROW",S=c||x&&!T||T&&!o,A=u1(f.id),O=A?.name||f.name,_=typeof O=="function"?O(r):O,E=A?.icon||"";return y.jsxs("button",{disabled:S,onClick:()=>a(b?null:f.id),className:`
                            relative w-full ${d?"h-20 rounded-xl gap-0.5":"h-24 rounded-2xl gap-1"} flex flex-col items-center justify-center
                            border transition-all transform hover:translate-x-1
                            ${b?"bg-blue-600 border-white shadow-[0_0_20px_rgba(59,130,246,0.5)]":"bg-white/5 border-white/10 hover:border-blue-500/50"}
                            ${S?"opacity-40 grayscale pointer-events-none":"cursor-pointer"}
                        `,children:[y.jsx("span",{className:d?"text-2xl":"text-3xl",children:E}),y.jsx("span",{className:`${d?"text-[9px] tracking-[0.12em]":"text-[10px] tracking-widest"} uppercase font-bold text-white/50 text-center px-2 leading-tight`,children:_}),x&&!T&&y.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-black/40 ${d?"rounded-xl":"rounded-2xl"} backdrop-blur-[2px]`,children:y.jsx("span",{className:`${d?"text-2xl":"text-3xl"} font-black text-white`,children:f.currentCooldown})}),y.jsx("div",{className:`absolute ${d?"-top-1 left-2 px-1.5":"-top-2 left-4 px-2"} py-0.5 bg-[#030712] rounded-full border border-white/10 text-[8px] uppercase font-black tracking-widest text-white/40`,children:g})]},f.id)}))})},Lw=({gameState:e,selectedSkillId:n,showMovementRange:a,isInputLocked:o,isReplayMode:r,replayActionsLength:c,replayIndex:d,replayActive:h,mobileToasts:g,tutorialInstructions:m,floorIntro:f,assetManifest:b,onSetBoardBusy:x,onTileClick:T,onSimulationEvents:S,onMirrorSnapshot:A,onReset:O,onWait:_,onExitToHub:E,onSelectSkill:w,onSelectUpgrade:C,onDismissTutorial:I,onToggleReplay:N,onStepReplay:H,onCloseReplay:D})=>y.jsxs("div",{className:"flex flex-col lg:flex-row w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[y.jsx("div",{className:"lg:hidden shrink-0 border-b border-white/5 bg-[#030712]/95 backdrop-blur-sm z-20",children:y.jsxs("div",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[y.jsxs("div",{className:"min-w-0",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"Level"}),y.jsxs("div",{className:"text-lg font-black text-white leading-none",children:[e.floor,y.jsx("span",{className:"text-white/25 text-sm ml-1",children:"/ 10"})]})]}),y.jsxs("div",{className:"ml-auto min-w-0 text-right",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"HP"}),y.jsxs("div",{className:"text-lg font-black text-red-400 leading-none",children:[e.player.hp,y.jsxs("span",{className:"text-white/25 text-sm ml-1",children:["/ ",e.player.maxHp]})]})]})]})}),y.jsx("aside",{className:"hidden lg:flex w-80 border-r border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:y.jsx(Rw,{gameState:e,onReset:O,onWait:_,onExitToHub:E,inputLocked:o})}),y.jsx("main",{className:"flex-1 min-h-0 relative flex items-center justify-center bg-[#020617] overflow-hidden",children:y.jsx("div",{className:"w-full h-full p-0 sm:p-3 lg:p-8 flex items-center justify-center",children:y.jsxs("div",{className:`w-full h-full relative border border-white/5 bg-[#030712]/50 rounded-none sm:rounded-3xl lg:rounded-[40px] shadow-[inset_0_0_100px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden ${e.isShaking?"animate-shake":""}`,children:[y.jsx(m0,{gameState:e,onMove:T,selectedSkillId:n,showMovementRange:a,onBusyStateChange:x,assetManifest:b,onSimulationEvents:S,onMirrorSnapshot:A}),y.jsx(Ew,{visible:o&&e.gameStatus==="playing"})]})})}),y.jsx(_w,{mobileToasts:e.gameStatus==="playing"?g:[]}),y.jsx("aside",{className:"lg:hidden shrink-0 h-[26svh] min-h-[160px] max-h-[250px] border-t border-white/5 bg-[#030712] z-20 overflow-y-auto",children:y.jsxs("div",{className:"p-3 flex flex-col gap-3 h-full",children:[y.jsxs("div",{className:"flex items-center justify-between gap-2",children:[y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Skills"}),y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx("button",{disabled:o,onClick:_,className:`px-2.5 py-1.5 rounded-lg border text-[10px] font-black uppercase tracking-widest ${o?"bg-white/[0.03] border-white/5 text-white/30 opacity-50":"bg-white/5 border-white/10 text-white/70 active:bg-white/10"}`,children:"Wait"}),y.jsx("button",{onClick:E,className:"px-2.5 py-1.5 rounded-lg border border-white/10 bg-white/5 text-[10px] font-black uppercase tracking-widest text-white/70 active:bg-white/10",children:"Hub"}),y.jsx("button",{onClick:O,className:"px-2.5 py-1.5 rounded-lg border border-red-500/20 bg-red-500/10 text-[10px] font-black uppercase tracking-widest text-red-300/90 active:bg-red-500/20",children:"Reset"})]})]}),y.jsx(Eg,{skills:e.player.activeSkills||[],selectedSkillId:n,onSelectSkill:w,hasSpear:e.hasSpear,gameState:e,inputLocked:o,compact:!0})]})}),y.jsx("aside",{className:"hidden lg:flex w-80 border-l border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:y.jsxs("div",{className:"p-6 flex flex-col gap-8 h-full",children:[y.jsxs("div",{className:"flex-1",children:[y.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30 mb-6",children:"Tactical Skills"}),y.jsx(Eg,{skills:e.player.activeSkills||[],selectedSkillId:n,onSelectSkill:w,hasSpear:e.hasSpear,gameState:e,inputLocked:o})]}),y.jsx("div",{className:"pt-8 border-t border-white/5 text-center",children:y.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/20",children:"Hop Engine v5.0"})})]})}),y.jsx(g0,{tutorialInstructions:m,onDismiss:I}),e.gameStatus==="choosing_upgrade"&&y.jsx(Iw,{onSelect:C,gameState:e}),y.jsx(ww,{visible:e.gameStatus==="lost",onReset:O}),y.jsx(Mw,{visible:e.gameStatus==="won",score:e.completedRun?.score||0,onExitToHub:E}),y.jsx(Ow,{floorIntro:f}),y.jsx(Cw,{isReplayMode:r,replayIndex:d,replayLength:c,replayActive:h,onToggleReplay:N,onStepReplay:H,onCloseReplay:D})]}),Hw=e=>{const n=e.payload;if(!(!n||typeof n!="object")){if("q"in n&&"r"in n)return{q:Number(n.q??0),r:Number(n.r??0),s:Number(n.s??0)};if(e.type==="USE_SKILL"){const a=n;return{skillId:a.skillId??"unknown",target:a.target?{q:a.target.q,r:a.target.r,s:a.target.s}:null}}if(e.type==="START_RUN")return{loadoutId:n.loadoutId??"unknown",mode:n.mode??"normal"};if(e.type==="LOAD_STATE"){const a=n;return{floor:a?.floor??0,gameStatus:a?.gameStatus??"unknown",turnNumber:a?.turnNumber??0,queueLength:Array.isArray(a?.initiativeQueue)?a.initiativeQueue.length:0}}return{}}};function Bw(){const{hubPath:e,arcadePath:n,biomesPath:a,isArcadeRoute:o,isBiomesRoute:r,navigateTo:c}=mw(),[d,h]=sw(),g=typeof window<"u"&&!!window.__HOP_DEBUG_QUERY,m=ew();nw(d,g);const f=k.useRef(()=>{}),b=k.useCallback((Te,rt)=>{f.current(Te,rt)},[]),{isReplayMode:x,replayActions:T,replayActive:S,replayError:A,replayIndexRef:O,setReplayActive:_,resetReplayUi:E,startReplay:w,stepReplay:C}=ow({dispatchWithTrace:b}),I=k.useRef(null);tw([d.gameStatus,x]);const[N,H]=k.useState(null),[D,G]=k.useState(!1),[P,Y]=k.useState(!1),[F,Z]=k.useState(!1),{turnDriver:z,isInputLocked:q,appendTurnTrace:B,dispatchWithTrace:$}=fw({gameState:d,dispatch:h,isReplayMode:x,isBusy:P,postCommitInputLock:F,dispatchWithTraceProxyRef:f,summarizeActionPayload:Hw}),{mobileToasts:X,handleSimulationEvents:le,handleUiMirrorSnapshot:fe}=rw({gameState:d,appendTurnTrace:B}),{armPostCommitLock:R}=uw({gameState:d,turnDriver:z,isBusy:P,isReplayMode:x,postCommitInputLock:F,setPostCommitInputLock:Z,appendTurnTrace:B,dispatchWithTrace:$}),[W,Q]=k.useState(null),[ne,re]=k.useState(null),ce=k.useRef(d.floor);k.useEffect(()=>{if(d.gameStatus==="playing"&&d.floor!==ce.current){re({floor:d.floor,theme:d.theme||"Inferno"}),ce.current=d.floor;const Te=setTimeout(()=>re(null),3e3);return()=>clearTimeout(Te)}},[d.floor,d.gameStatus,d.theme]),k.useEffect(()=>{if(d.gameStatus==="playing"&&d.floor===1&&!ce.current){re({floor:1,theme:d.theme||"Inferno"}),ce.current=1;const Te=setTimeout(()=>re(null),3e3);return()=>clearTimeout(Te)}},[d.gameStatus]);const me=Te=>{q||H(Te)},Ce=Te=>{if(!q){if(N){R(),$({type:"USE_SKILL",payload:{skillId:N,target:Te}},"player_use_skill"),H(null);return}if(se(Te,d.player.position)){G(!D);return}R(),$({type:"MOVE",payload:Te},"player_move"),G(!1)}},ve=Te=>{x||P||$({type:"SELECT_UPGRADE",payload:Te},"upgrade_select")},_e=()=>{$({type:"RESET"},"reset"),H(null),E()},ke=()=>{q||(R(),$({type:"WAIT"},"player_wait"),H(null))},ze=()=>{qe()},Ue=(Te,rt)=>{$({type:"LOAD_STATE",payload:Te},"scenario_load"),Q(rt),H(null)},qe=()=>{$({type:"EXIT_TO_HUB"},"exit_to_hub"),H(null),E(),c(e)};k.useEffect(()=>{if(!x){if((d.gameStatus==="won"||d.gameStatus==="lost")&&I.current!==d.initialSeed){I.current=d.initialSeed||"default";const Te=d.initialSeed??d.rngSeed??"0",rt=d.completedRun?.score||(d.player.hp||0)+(d.floor||0)*100,wt=s0(d.actionLog||[]);if(!wt.valid){console.error("[HOP_REPLAY] Refusing to persist replay with invalid action log",{errors:wt.errors});return}const Ut=Z_(wt.actions,d.floor||0),Mt={id:`run-${Date.now()}`,seed:Te,loadoutId:d.player.archetype,actions:wt.actions,score:rt,floor:d.floor,date:new Date().toISOString(),replayVersion:2,diagnostics:Ut},Un=localStorage.getItem("hop_replays_v1"),qn=Un?JSON.parse(Un):[],Nt=[Mt,...qn].slice(0,100);localStorage.setItem("hop_replays_v1",JSON.stringify(Nt));const Qn=localStorage.getItem("hop_leaderboard_v1");let ft=Qn?JSON.parse(Qn):[];ft.push({id:Mt.id,name:"Player",score:Mt.score,floor:Mt.floor,date:Mt.date,seed:Mt.seed,loadoutId:Mt.loadoutId,actions:Mt.actions,replayVersion:Mt.replayVersion,diagnostics:Mt.diagnostics}),ft.sort((St,qt)=>qt.score-St.score),ft=ft.slice(0,5),localStorage.setItem("hop_leaderboard_v1",JSON.stringify(ft))}d.gameStatus==="hub"&&(I.current=null)}},[d.gameStatus,x,d.initialSeed]);const Ge=Te=>{const rt=d.selectedLoadoutId;if(!rt){console.warn("Start Run called without a selected loadout.");return}$({type:"START_RUN",payload:{loadoutId:rt,mode:Te}},"hub_start_run")},dt=Te=>{$({type:"START_RUN",payload:{loadoutId:Te,mode:"daily"}},"arcade_start_run"),c(e)};return r?y.jsx(Q_,{assetManifest:m,onBack:()=>c(e)}):d.gameStatus==="hub"?y.jsx(kw,{gameState:d,isArcadeRoute:o,hubPath:e,arcadePath:n,biomesPath:a,replayError:A,tutorialInstructions:W,navigateTo:c,onStartArcadeRun:dt,onSelectLoadout:Te=>{$({type:"APPLY_LOADOUT",payload:Te},"hub_select_loadout")},onStartRun:Ge,onLoadScenario:Ue,onStartReplay:w,onDismissTutorial:()=>Q(null)}):y.jsx(Lw,{gameState:d,selectedSkillId:N,showMovementRange:D,isInputLocked:q,isReplayMode:x,replayActionsLength:T.length,replayIndex:O.current,replayActive:S,mobileToasts:X,tutorialInstructions:W,floorIntro:ne,assetManifest:m,onSetBoardBusy:Y,onTileClick:Ce,onSimulationEvents:le,onMirrorSnapshot:fe,onReset:_e,onWait:ke,onExitToHub:qe,onSelectSkill:me,onSelectUpgrade:ve,onDismissTutorial:()=>Q(null),onToggleReplay:()=>_(!S),onStepReplay:C,onCloseReplay:ze})}Px.createRoot(document.getElementById("root")).render(y.jsx(k.StrictMode,{children:y.jsx(Bw,{})}));
