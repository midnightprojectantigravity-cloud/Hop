(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function a(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(r){if(r.ep)return;r.ep=!0;const c=a(r);fetch(r.href,c)}})();function lS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ad={exports:{}},To={};var iy;function cS(){if(iy)return To;iy=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function a(s,r,c){var u=null;if(c!==void 0&&(u=""+c),r.key!==void 0&&(u=""+r.key),"key"in r){c={};for(var p in r)p!=="key"&&(c[p]=r[p])}else c=r;return r=c.ref,{$$typeof:e,type:s,key:u,ref:r!==void 0?r:null,props:c}}return To.Fragment=n,To.jsx=a,To.jsxs=a,To}var ay;function uS(){return ay||(ay=1,ad.exports=cS()),ad.exports}var y=uS(),sd={exports:{}},we={};var sy;function dS(){if(sy)return we;sy=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),c=Symbol.for("react.consumer"),u=Symbol.for("react.context"),p=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),m=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),b=Symbol.for("react.activity"),S=Symbol.iterator;function T(I){return I===null||typeof I!="object"?null:(I=S&&I[S]||I["@@iterator"],typeof I=="function"?I:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,_={};function E(I,K,G){this.props=I,this.context=K,this.refs=_,this.updater=G||v}E.prototype.isReactComponent={},E.prototype.setState=function(I,K){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,K,"setState")},E.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function w(){}w.prototype=E.prototype;function M(I,K,G){this.props=I,this.context=K,this.refs=_,this.updater=G||v}var C=M.prototype=new w;C.constructor=M,A(C,E.prototype),C.isPureReactComponent=!0;var L=Array.isArray;function k(){}var R={H:null,A:null,T:null,S:null},H=Object.prototype.hasOwnProperty;function D(I,K,G){var ne=G.ref;return{$$typeof:e,type:I,key:K,ref:ne!==void 0?ne:null,props:G}}function $(I,K){return D(I.type,K,I.props)}function J(I){return typeof I=="object"&&I!==null&&I.$$typeof===e}function te(I){var K={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(G){return K[G]})}var ae=/\/+/g;function W(I,K){return typeof I=="object"&&I!==null&&I.key!=null?te(""+I.key):K.toString(36)}function q(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(k,k):(I.status="pending",I.then(function(K){I.status==="pending"&&(I.status="fulfilled",I.value=K)},function(K){I.status==="pending"&&(I.status="rejected",I.reason=K)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function P(I,K,G,ne,re){var ce=typeof I;(ce==="undefined"||ce==="boolean")&&(I=null);var pe=!1;if(I===null)pe=!0;else switch(ce){case"bigint":case"string":case"number":pe=!0;break;case"object":switch(I.$$typeof){case e:case n:pe=!0;break;case f:return pe=I._init,P(pe(I._payload),K,G,ne,re)}}if(pe)return re=re(I),pe=ne===""?"."+W(I,0):ne,L(re)?(G="",pe!=null&&(G=pe.replace(ae,"$&/")+"/"),P(re,K,G,"",function(_e){return _e})):re!=null&&(J(re)&&(re=$(re,G+(re.key==null||I&&I.key===re.key?"":(""+re.key).replace(ae,"$&/")+"/")+pe)),K.push(re)),1;pe=0;var ke=ne===""?".":ne+":";if(L(I))for(var Se=0;Se<I.length;Se++)ne=I[Se],ce=ke+W(ne,Se),pe+=P(ne,K,G,ce,re);else if(Se=T(I),typeof Se=="function")for(I=Se.call(I),Se=0;!(ne=I.next()).done;)ne=ne.value,ce=ke+W(ne,Se++),pe+=P(ne,K,G,ce,re);else if(ce==="object"){if(typeof I.then=="function")return P(q(I),K,G,ne,re);throw K=String(I),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return pe}function z(I,K,G){if(I==null)return I;var ne=[],re=0;return P(I,ne,"","",function(ce){return K.call(G,ce,re++)}),ne}function X(I){if(I._status===-1){var K=I._result;K=K(),K.then(function(G){(I._status===0||I._status===-1)&&(I._status=1,I._result=G)},function(G){(I._status===0||I._status===-1)&&(I._status=2,I._result=G)}),I._status===-1&&(I._status=0,I._result=K)}if(I._status===1)return I._result.default;throw I._result}var le=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},fe={map:z,forEach:function(I,K,G){z(I,function(){K.apply(this,arguments)},G)},count:function(I){var K=0;return z(I,function(){K++}),K},toArray:function(I){return z(I,function(K){return K})||[]},only:function(I){if(!J(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return we.Activity=b,we.Children=fe,we.Component=E,we.Fragment=a,we.Profiler=r,we.PureComponent=M,we.StrictMode=s,we.Suspense=g,we.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=R,we.__COMPILER_RUNTIME={__proto__:null,c:function(I){return R.H.useMemoCache(I)}},we.cache=function(I){return function(){return I.apply(null,arguments)}},we.cacheSignal=function(){return null},we.cloneElement=function(I,K,G){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var ne=A({},I.props),re=I.key;if(K!=null)for(ce in K.key!==void 0&&(re=""+K.key),K)!H.call(K,ce)||ce==="key"||ce==="__self"||ce==="__source"||ce==="ref"&&K.ref===void 0||(ne[ce]=K[ce]);var ce=arguments.length-2;if(ce===1)ne.children=G;else if(1<ce){for(var pe=Array(ce),ke=0;ke<ce;ke++)pe[ke]=arguments[ke+2];ne.children=pe}return D(I.type,re,ne)},we.createContext=function(I){return I={$$typeof:u,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:c,_context:I},I},we.createElement=function(I,K,G){var ne,re={},ce=null;if(K!=null)for(ne in K.key!==void 0&&(ce=""+K.key),K)H.call(K,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(re[ne]=K[ne]);var pe=arguments.length-2;if(pe===1)re.children=G;else if(1<pe){for(var ke=Array(pe),Se=0;Se<pe;Se++)ke[Se]=arguments[Se+2];re.children=ke}if(I&&I.defaultProps)for(ne in pe=I.defaultProps,pe)re[ne]===void 0&&(re[ne]=pe[ne]);return D(I,ce,re)},we.createRef=function(){return{current:null}},we.forwardRef=function(I){return{$$typeof:p,render:I}},we.isValidElement=J,we.lazy=function(I){return{$$typeof:f,_payload:{_status:-1,_result:I},_init:X}},we.memo=function(I,K){return{$$typeof:m,type:I,compare:K===void 0?null:K}},we.startTransition=function(I){var K=R.T,G={};R.T=G;try{var ne=I(),re=R.S;re!==null&&re(G,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(k,le)}catch(ce){le(ce)}finally{K!==null&&G.types!==null&&(K.types=G.types),R.T=K}},we.unstable_useCacheRefresh=function(){return R.H.useCacheRefresh()},we.use=function(I){return R.H.use(I)},we.useActionState=function(I,K,G){return R.H.useActionState(I,K,G)},we.useCallback=function(I,K){return R.H.useCallback(I,K)},we.useContext=function(I){return R.H.useContext(I)},we.useDebugValue=function(){},we.useDeferredValue=function(I,K){return R.H.useDeferredValue(I,K)},we.useEffect=function(I,K){return R.H.useEffect(I,K)},we.useEffectEvent=function(I){return R.H.useEffectEvent(I)},we.useId=function(){return R.H.useId()},we.useImperativeHandle=function(I,K,G){return R.H.useImperativeHandle(I,K,G)},we.useInsertionEffect=function(I,K){return R.H.useInsertionEffect(I,K)},we.useLayoutEffect=function(I,K){return R.H.useLayoutEffect(I,K)},we.useMemo=function(I,K){return R.H.useMemo(I,K)},we.useOptimistic=function(I,K){return R.H.useOptimistic(I,K)},we.useReducer=function(I,K,G){return R.H.useReducer(I,K,G)},we.useRef=function(I){return R.H.useRef(I)},we.useState=function(I){return R.H.useState(I)},we.useSyncExternalStore=function(I,K,G){return R.H.useSyncExternalStore(I,K,G)},we.useTransition=function(){return R.H.useTransition()},we.version="19.2.3",we}var oy;function Xd(){return oy||(oy=1,sd.exports=dS()),sd.exports}var N=Xd();const Vn=lS(N);var od={exports:{}},Eo={},rd={exports:{}},ld={};var ry;function fS(){return ry||(ry=1,(function(e){function n(P,z){var X=P.length;P.push(z);e:for(;0<X;){var le=X-1>>>1,fe=P[le];if(0<r(fe,z))P[le]=z,P[X]=fe,X=le;else break e}}function a(P){return P.length===0?null:P[0]}function s(P){if(P.length===0)return null;var z=P[0],X=P.pop();if(X!==z){P[0]=X;e:for(var le=0,fe=P.length,I=fe>>>1;le<I;){var K=2*(le+1)-1,G=P[K],ne=K+1,re=P[ne];if(0>r(G,X))ne<fe&&0>r(re,G)?(P[le]=re,P[ne]=X,le=ne):(P[le]=G,P[K]=X,le=K);else if(ne<fe&&0>r(re,X))P[le]=re,P[ne]=X,le=ne;else break e}}return z}function r(P,z){var X=P.sortIndex-z.sortIndex;return X!==0?X:P.id-z.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var u=Date,p=u.now();e.unstable_now=function(){return u.now()-p}}var g=[],m=[],f=1,b=null,S=3,T=!1,v=!1,A=!1,_=!1,E=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function C(P){for(var z=a(m);z!==null;){if(z.callback===null)s(m);else if(z.startTime<=P)s(m),z.sortIndex=z.expirationTime,n(g,z);else break;z=a(m)}}function L(P){if(A=!1,C(P),!v)if(a(g)!==null)v=!0,k||(k=!0,te());else{var z=a(m);z!==null&&q(L,z.startTime-P)}}var k=!1,R=-1,H=5,D=-1;function $(){return _?!0:!(e.unstable_now()-D<H)}function J(){if(_=!1,k){var P=e.unstable_now();D=P;var z=!0;try{e:{v=!1,A&&(A=!1,w(R),R=-1),T=!0;var X=S;try{t:{for(C(P),b=a(g);b!==null&&!(b.expirationTime>P&&$());){var le=b.callback;if(typeof le=="function"){b.callback=null,S=b.priorityLevel;var fe=le(b.expirationTime<=P);if(P=e.unstable_now(),typeof fe=="function"){b.callback=fe,C(P),z=!0;break t}b===a(g)&&s(g),C(P)}else s(g);b=a(g)}if(b!==null)z=!0;else{var I=a(m);I!==null&&q(L,I.startTime-P),z=!1}}break e}finally{b=null,S=X,T=!1}z=void 0}}finally{z?te():k=!1}}}var te;if(typeof M=="function")te=function(){M(J)};else if(typeof MessageChannel<"u"){var ae=new MessageChannel,W=ae.port2;ae.port1.onmessage=J,te=function(){W.postMessage(null)}}else te=function(){E(J,0)};function q(P,z){R=E(function(){P(e.unstable_now())},z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_next=function(P){switch(S){case 1:case 2:case 3:var z=3;break;default:z=S}var X=S;S=z;try{return P()}finally{S=X}},e.unstable_requestPaint=function(){_=!0},e.unstable_runWithPriority=function(P,z){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var X=S;S=P;try{return z()}finally{S=X}},e.unstable_scheduleCallback=function(P,z,X){var le=e.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?le+X:le):X=le,P){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=X+fe,P={id:f++,callback:z,priorityLevel:P,startTime:X,expirationTime:fe,sortIndex:-1},X>le?(P.sortIndex=X,n(m,P),a(g)===null&&P===a(m)&&(A?(w(R),R=-1):A=!0,q(L,X-le))):(P.sortIndex=fe,n(g,P),v||T||(v=!0,k||(k=!0,te()))),P},e.unstable_shouldYield=$,e.unstable_wrapCallback=function(P){var z=S;return function(){var X=S;S=z;try{return P.apply(this,arguments)}finally{S=X}}}})(ld)),ld}var ly;function mS(){return ly||(ly=1,rd.exports=fS()),rd.exports}var cd={exports:{}},nn={};var cy;function pS(){if(cy)return nn;cy=1;var e=Xd();function n(g){var m="https://react.dev/errors/"+g;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)m+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+g+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var s={d:{f:a,r:function(){throw Error(n(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},r=Symbol.for("react.portal");function c(g,m,f){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:r,key:b==null?null:""+b,children:g,containerInfo:m,implementation:f}}var u=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function p(g,m){if(g==="font")return"";if(typeof m=="string")return m==="use-credentials"?m:""}return nn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,nn.createPortal=function(g,m){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!m||m.nodeType!==1&&m.nodeType!==9&&m.nodeType!==11)throw Error(n(299));return c(g,m,null,f)},nn.flushSync=function(g){var m=u.T,f=s.p;try{if(u.T=null,s.p=2,g)return g()}finally{u.T=m,s.p=f,s.d.f()}},nn.preconnect=function(g,m){typeof g=="string"&&(m?(m=m.crossOrigin,m=typeof m=="string"?m==="use-credentials"?m:"":void 0):m=null,s.d.C(g,m))},nn.prefetchDNS=function(g){typeof g=="string"&&s.d.D(g)},nn.preinit=function(g,m){if(typeof g=="string"&&m&&typeof m.as=="string"){var f=m.as,b=p(f,m.crossOrigin),S=typeof m.integrity=="string"?m.integrity:void 0,T=typeof m.fetchPriority=="string"?m.fetchPriority:void 0;f==="style"?s.d.S(g,typeof m.precedence=="string"?m.precedence:void 0,{crossOrigin:b,integrity:S,fetchPriority:T}):f==="script"&&s.d.X(g,{crossOrigin:b,integrity:S,fetchPriority:T,nonce:typeof m.nonce=="string"?m.nonce:void 0})}},nn.preinitModule=function(g,m){if(typeof g=="string")if(typeof m=="object"&&m!==null){if(m.as==null||m.as==="script"){var f=p(m.as,m.crossOrigin);s.d.M(g,{crossOrigin:f,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0})}}else m==null&&s.d.M(g)},nn.preload=function(g,m){if(typeof g=="string"&&typeof m=="object"&&m!==null&&typeof m.as=="string"){var f=m.as,b=p(f,m.crossOrigin);s.d.L(g,f,{crossOrigin:b,integrity:typeof m.integrity=="string"?m.integrity:void 0,nonce:typeof m.nonce=="string"?m.nonce:void 0,type:typeof m.type=="string"?m.type:void 0,fetchPriority:typeof m.fetchPriority=="string"?m.fetchPriority:void 0,referrerPolicy:typeof m.referrerPolicy=="string"?m.referrerPolicy:void 0,imageSrcSet:typeof m.imageSrcSet=="string"?m.imageSrcSet:void 0,imageSizes:typeof m.imageSizes=="string"?m.imageSizes:void 0,media:typeof m.media=="string"?m.media:void 0})}},nn.preloadModule=function(g,m){if(typeof g=="string")if(m){var f=p(m.as,m.crossOrigin);s.d.m(g,{as:typeof m.as=="string"&&m.as!=="script"?m.as:void 0,crossOrigin:f,integrity:typeof m.integrity=="string"?m.integrity:void 0})}else s.d.m(g)},nn.requestFormReset=function(g){s.d.r(g)},nn.unstable_batchedUpdates=function(g,m){return g(m)},nn.useFormState=function(g,m,f){return u.H.useFormState(g,m,f)},nn.useFormStatus=function(){return u.H.useHostTransitionStatus()},nn.version="19.2.3",nn}var uy;function hS(){if(uy)return cd.exports;uy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),cd.exports=pS(),cd.exports}var dy;function yS(){if(dy)return Eo;dy=1;var e=mS(),n=Xd(),a=hS();function s(t){var i="https://react.dev/errors/"+t;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)i+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function r(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function c(t){var i=t,o=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(o=i.return),t=i.return;while(t)}return i.tag===3?o:null}function u(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function p(t){if(t.tag===31){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function g(t){if(c(t)!==t)throw Error(s(188))}function m(t){var i=t.alternate;if(!i){if(i=c(t),i===null)throw Error(s(188));return i!==t?null:t}for(var o=t,l=i;;){var d=o.return;if(d===null)break;var h=d.alternate;if(h===null){if(l=d.return,l!==null){o=l;continue}break}if(d.child===h.child){for(h=d.child;h;){if(h===o)return g(d),t;if(h===l)return g(d),i;h=h.sibling}throw Error(s(188))}if(o.return!==l.return)o=d,l=h;else{for(var x=!1,O=d.child;O;){if(O===o){x=!0,o=d,l=h;break}if(O===l){x=!0,l=d,o=h;break}O=O.sibling}if(!x){for(O=h.child;O;){if(O===o){x=!0,o=h,l=d;break}if(O===l){x=!0,l=h,o=d;break}O=O.sibling}if(!x)throw Error(s(189))}}if(o.alternate!==l)throw Error(s(190))}if(o.tag!==3)throw Error(s(188));return o.stateNode.current===o?t:i}function f(t){var i=t.tag;if(i===5||i===26||i===27||i===6)return t;for(t=t.child;t!==null;){if(i=f(t),i!==null)return i;t=t.sibling}return null}var b=Object.assign,S=Symbol.for("react.element"),T=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),w=Symbol.for("react.consumer"),M=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),k=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),D=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),J=Symbol.iterator;function te(t){return t===null||typeof t!="object"?null:(t=J&&t[J]||t["@@iterator"],typeof t=="function"?t:null)}var ae=Symbol.for("react.client.reference");function W(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===ae?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case A:return"Fragment";case E:return"Profiler";case _:return"StrictMode";case L:return"Suspense";case k:return"SuspenseList";case D:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case v:return"Portal";case M:return t.displayName||"Context";case w:return(t._context.displayName||"Context")+".Consumer";case C:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case R:return i=t.displayName||null,i!==null?i:W(t.type)||"Memo";case H:i=t._payload,t=t._init;try{return W(t(i))}catch{}}return null}var q=Array.isArray,P=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,z=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X={pending:!1,data:null,method:null,action:null},le=[],fe=-1;function I(t){return{current:t}}function K(t){0>fe||(t.current=le[fe],le[fe]=null,fe--)}function G(t,i){fe++,le[fe]=t.current,t.current=i}var ne=I(null),re=I(null),ce=I(null),pe=I(null);function ke(t,i){switch(G(ce,i),G(re,t),G(ne,null),i.nodeType){case 9:case 11:t=(t=i.documentElement)&&(t=t.namespaceURI)?wh(t):0;break;default:if(t=i.tagName,i=i.namespaceURI)i=wh(i),t=Mh(i,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}K(ne),G(ne,t)}function Se(){K(ne),K(re),K(ce)}function _e(t){t.memoizedState!==null&&G(pe,t);var i=ne.current,o=Mh(i,t.type);i!==o&&(G(re,t),G(ne,o))}function Ce(t){re.current===t&&(K(ne),K(re)),pe.current===t&&(K(pe),vo._currentValue=X)}var ze,$e;function Ae(t){if(ze===void 0)try{throw Error()}catch(o){var i=o.stack.trim().match(/\n( *(at )?)/);ze=i&&i[1]||"",$e=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ze+t+$e}var qe=!1;function gt(t,i){if(!t||qe)return"";qe=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(i){var oe=function(){throw Error()};if(Object.defineProperty(oe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(oe,[])}catch(Z){var F=Z}Reflect.construct(t,[],oe)}else{try{oe.call()}catch(Z){F=Z}t.call(oe.prototype)}}else{try{throw Error()}catch(Z){F=Z}(oe=t())&&typeof oe.catch=="function"&&oe.catch(function(){})}}catch(Z){if(Z&&F&&typeof Z.stack=="string")return[Z.stack,F.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var h=l.DetermineComponentFrameRoot(),x=h[0],O=h[1];if(x&&O){var B=x.split(`
`),Y=O.split(`
`);for(d=l=0;l<B.length&&!B[l].includes("DetermineComponentFrameRoot");)l++;for(;d<Y.length&&!Y[d].includes("DetermineComponentFrameRoot");)d++;if(l===B.length||d===Y.length)for(l=B.length-1,d=Y.length-1;1<=l&&0<=d&&B[l]!==Y[d];)d--;for(;1<=l&&0<=d;l--,d--)if(B[l]!==Y[d]){if(l!==1||d!==1)do if(l--,d--,0>d||B[l]!==Y[d]){var ie=`
`+B[l].replace(" at new "," at ");return t.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",t.displayName)),ie}while(1<=l&&0<=d);break}}}finally{qe=!1,Error.prepareStackTrace=o}return(o=t?t.displayName||t.name:"")?Ae(o):""}function bt(t,i){switch(t.tag){case 26:case 27:case 5:return Ae(t.type);case 16:return Ae("Lazy");case 13:return t.child!==i&&i!==null?Ae("Suspense Fallback"):Ae("Suspense");case 19:return Ae("SuspenseList");case 0:case 15:return gt(t.type,!1);case 11:return gt(t.type.render,!1);case 1:return gt(t.type,!0);case 31:return Ae("Activity");default:return""}}function Yt(t){try{var i="",o=null;do i+=bt(t,o),o=t,t=t.return;while(t);return i}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var en=Object.prototype.hasOwnProperty,Kt=e.unstable_scheduleCallback,Xn=e.unstable_cancelCallback,Ii=e.unstable_shouldYield,ri=e.unstable_requestPaint,qt=e.unstable_now,fa=e.unstable_getCurrentPriorityLevel,jt=e.unstable_ImmediatePriority,Ot=e.unstable_UserBlockingPriority,Ft=e.unstable_NormalPriority,Jn=e.unstable_LowPriority,yn=e.unstable_IdlePriority,ma=e.log,Ua=e.unstable_setDisableYieldValue,ln=null,De=null;function Ze(t){if(typeof ma=="function"&&Ua(t),De&&typeof De.setStrictMode=="function")try{De.setStrictMode(ln,t)}catch{}}var at=Math.clz32?Math.clz32:Re,wn=Math.log,Te=Math.LN2;function Re(t){return t>>>=0,t===0?32:31-(wn(t)/Te|0)|0}var Ge=256,ot=262144,rt=4194304;function Dt(t){var i=t&42;if(i!==0)return i;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function xt(t,i,o){var l=t.pendingLanes;if(l===0)return 0;var d=0,h=t.suspendedLanes,x=t.pingedLanes;t=t.warmLanes;var O=l&134217727;return O!==0?(l=O&~h,l!==0?d=Dt(l):(x&=O,x!==0?d=Dt(x):o||(o=O&~t,o!==0&&(d=Dt(o))))):(O=l&~h,O!==0?d=Dt(O):x!==0?d=Dt(x):o||(o=l&~t,o!==0&&(d=Dt(o)))),d===0?0:i!==0&&i!==d&&(i&h)===0&&(h=d&-d,o=i&-i,h>=o||h===32&&(o&4194048)!==0)?i:d}function gn(t,i){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&i)===0}function bn(t,i){switch(t){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function li(){var t=rt;return rt<<=1,(rt&62914560)===0&&(rt=4194304),t}function Qn(t){for(var i=[],o=0;31>o;o++)i.push(t);return i}function Dn(t,i){t.pendingLanes|=i,i!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function Ct(t,i,o,l,d,h){var x=t.pendingLanes;t.pendingLanes=o,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=o,t.entangledLanes&=o,t.errorRecoveryDisabledLanes&=o,t.shellSuspendCounter=0;var O=t.entanglements,B=t.expirationTimes,Y=t.hiddenUpdates;for(o=x&~o;0<o;){var ie=31-at(o),oe=1<<ie;O[ie]=0,B[ie]=-1;var F=Y[ie];if(F!==null)for(Y[ie]=null,ie=0;ie<F.length;ie++){var Z=F[ie];Z!==null&&(Z.lane&=-536870913)}o&=~oe}l!==0&&ft(t,l,0),h!==0&&d===0&&t.tag!==0&&(t.suspendedLanes|=h&~(x&~i))}function ft(t,i,o){t.pendingLanes|=i,t.suspendedLanes&=~i;var l=31-at(i);t.entangledLanes|=i,t.entanglements[l]=t.entanglements[l]|1073741824|o&261930}function tn(t,i){var o=t.entangledLanes|=i;for(t=t.entanglements;o;){var l=31-at(o),d=1<<l;d&i|t[l]&i&&(t[l]|=i),o&=~d}}function Zn(t,i){var o=i&-i;return o=(o&42)!==0?1:ks(o),(o&(t.suspendedLanes|i))!==0?0:o}function ks(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function $a(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Rs(){var t=z.p;return t!==0?t:(t=window.event,t===void 0?32:Xh(t.type))}function ff(t,i){var o=z.p;try{return z.p=t,i()}finally{z.p=o}}var Li=Math.random().toString(36).slice(2),Wt="__reactFiber$"+Li,cn="__reactProps$"+Li,qa="__reactContainer$"+Li,Gl="__reactEvents$"+Li,J0="__reactListeners$"+Li,Q0="__reactHandles$"+Li,mf="__reactResources$"+Li,Is="__reactMarker$"+Li;function Xl(t){delete t[Wt],delete t[cn],delete t[Gl],delete t[J0],delete t[Q0]}function za(t){var i=t[Wt];if(i)return i;for(var o=t.parentNode;o;){if(i=o[qa]||o[Wt]){if(o=i.alternate,i.child!==null||o!==null&&o.child!==null)for(t=Lh(t);t!==null;){if(o=t[Wt])return o;t=Lh(t)}return i}t=o,o=t.parentNode}return null}function Va(t){if(t=t[Wt]||t[qa]){var i=t.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return t}return null}function Ls(t){var i=t.tag;if(i===5||i===26||i===27||i===6)return t.stateNode;throw Error(s(33))}function Ya(t){var i=t[mf];return i||(i=t[mf]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function zt(t){t[Is]=!0}var pf=new Set,hf={};function pa(t,i){Ka(t,i),Ka(t+"Capture",i)}function Ka(t,i){for(hf[t]=i,t=0;t<i.length;t++)pf.add(i[t])}var Z0=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),yf={},gf={};function eb(t){return en.call(gf,t)?!0:en.call(yf,t)?!1:Z0.test(t)?gf[t]=!0:(yf[t]=!0,!1)}function zo(t,i,o){if(eb(i))if(o===null)t.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":t.removeAttribute(i);return;case"boolean":var l=i.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){t.removeAttribute(i);return}}t.setAttribute(i,""+o)}}function Vo(t,i,o){if(o===null)t.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(i);return}t.setAttribute(i,""+o)}}function ci(t,i,o,l){if(l===null)t.removeAttribute(o);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(o);return}t.setAttributeNS(i,o,""+l)}}function Mn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function bf(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function tb(t,i,o){var l=Object.getOwnPropertyDescriptor(t.constructor.prototype,i);if(!t.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var d=l.get,h=l.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return d.call(this)},set:function(x){o=""+x,h.call(this,x)}}),Object.defineProperty(t,i,{enumerable:l.enumerable}),{getValue:function(){return o},setValue:function(x){o=""+x},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Jl(t){if(!t._valueTracker){var i=bf(t)?"checked":"value";t._valueTracker=tb(t,i,""+t[i])}}function vf(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var o=i.getValue(),l="";return t&&(l=bf(t)?t.checked?"true":"false":t.value),t=l,t!==o?(i.setValue(t),!0):!1}function Yo(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var nb=/[\n"\\]/g;function On(t){return t.replace(nb,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Ql(t,i,o,l,d,h,x,O){t.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?t.type=x:t.removeAttribute("type"),i!=null?x==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+Mn(i)):t.value!==""+Mn(i)&&(t.value=""+Mn(i)):x!=="submit"&&x!=="reset"||t.removeAttribute("value"),i!=null?Zl(t,x,Mn(i)):o!=null?Zl(t,x,Mn(o)):l!=null&&t.removeAttribute("value"),d==null&&h!=null&&(t.defaultChecked=!!h),d!=null&&(t.checked=d&&typeof d!="function"&&typeof d!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?t.name=""+Mn(O):t.removeAttribute("name")}function Sf(t,i,o,l,d,h,x,O){if(h!=null&&typeof h!="function"&&typeof h!="symbol"&&typeof h!="boolean"&&(t.type=h),i!=null||o!=null){if(!(h!=="submit"&&h!=="reset"||i!=null)){Jl(t);return}o=o!=null?""+Mn(o):"",i=i!=null?""+Mn(i):o,O||i===t.value||(t.value=i),t.defaultValue=i}l=l??d,l=typeof l!="function"&&typeof l!="symbol"&&!!l,t.checked=O?t.checked:!!l,t.defaultChecked=!!l,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(t.name=x),Jl(t)}function Zl(t,i,o){i==="number"&&Yo(t.ownerDocument)===t||t.defaultValue===""+o||(t.defaultValue=""+o)}function Fa(t,i,o,l){if(t=t.options,i){i={};for(var d=0;d<o.length;d++)i["$"+o[d]]=!0;for(o=0;o<t.length;o++)d=i.hasOwnProperty("$"+t[o].value),t[o].selected!==d&&(t[o].selected=d),d&&l&&(t[o].defaultSelected=!0)}else{for(o=""+Mn(o),i=null,d=0;d<t.length;d++){if(t[d].value===o){t[d].selected=!0,l&&(t[d].defaultSelected=!0);return}i!==null||t[d].disabled||(i=t[d])}i!==null&&(i.selected=!0)}}function xf(t,i,o){if(i!=null&&(i=""+Mn(i),i!==t.value&&(t.value=i),o==null)){t.defaultValue!==i&&(t.defaultValue=i);return}t.defaultValue=o!=null?""+Mn(o):""}function Af(t,i,o,l){if(i==null){if(l!=null){if(o!=null)throw Error(s(92));if(q(l)){if(1<l.length)throw Error(s(93));l=l[0]}o=l}o==null&&(o=""),i=o}o=Mn(i),t.defaultValue=o,l=t.textContent,l===o&&l!==""&&l!==null&&(t.value=l),Jl(t)}function Wa(t,i){if(i){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=i;return}}t.textContent=i}var ib=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Tf(t,i,o){var l=i.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?l?t.setProperty(i,""):i==="float"?t.cssFloat="":t[i]="":l?t.setProperty(i,o):typeof o!="number"||o===0||ib.has(i)?i==="float"?t.cssFloat=o:t[i]=(""+o).trim():t[i]=o+"px"}function Ef(t,i,o){if(i!=null&&typeof i!="object")throw Error(s(62));if(t=t.style,o!=null){for(var l in o)!o.hasOwnProperty(l)||i!=null&&i.hasOwnProperty(l)||(l.indexOf("--")===0?t.setProperty(l,""):l==="float"?t.cssFloat="":t[l]="");for(var d in i)l=i[d],i.hasOwnProperty(d)&&o[d]!==l&&Tf(t,d,l)}else for(var h in i)i.hasOwnProperty(h)&&Tf(t,h,i[h])}function ec(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ab=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),sb=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ko(t){return sb.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function ui(){}var tc=null;function nc(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ga=null,Xa=null;function _f(t){var i=Va(t);if(i&&(t=i.stateNode)){var o=t[cn]||null;e:switch(t=i.stateNode,i.type){case"input":if(Ql(t,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),i=o.name,o.type==="radio"&&i!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+On(""+i)+'"][type="radio"]'),i=0;i<o.length;i++){var l=o[i];if(l!==t&&l.form===t.form){var d=l[cn]||null;if(!d)throw Error(s(90));Ql(l,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(i=0;i<o.length;i++)l=o[i],l.form===t.form&&vf(l)}break e;case"textarea":xf(t,o.value,o.defaultValue);break e;case"select":i=o.value,i!=null&&Fa(t,!!o.multiple,i,!1)}}}var ic=!1;function wf(t,i,o){if(ic)return t(i,o);ic=!0;try{var l=t(i);return l}finally{if(ic=!1,(Ga!==null||Xa!==null)&&(Ir(),Ga&&(i=Ga,t=Xa,Xa=Ga=null,_f(i),t)))for(i=0;i<t.length;i++)_f(t[i])}}function Bs(t,i){var o=t.stateNode;if(o===null)return null;var l=o[cn]||null;if(l===null)return null;o=l[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(s(231,i,typeof o));return o}var di=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ac=!1;if(di)try{var Hs={};Object.defineProperty(Hs,"passive",{get:function(){ac=!0}}),window.addEventListener("test",Hs,Hs),window.removeEventListener("test",Hs,Hs)}catch{ac=!1}var Bi=null,sc=null,Fo=null;function Mf(){if(Fo)return Fo;var t,i=sc,o=i.length,l,d="value"in Bi?Bi.value:Bi.textContent,h=d.length;for(t=0;t<o&&i[t]===d[t];t++);var x=o-t;for(l=1;l<=x&&i[o-l]===d[h-l];l++);return Fo=d.slice(t,1<l?1-l:void 0)}function Wo(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function Go(){return!0}function Of(){return!1}function un(t){function i(o,l,d,h,x){this._reactName=o,this._targetInst=d,this.type=l,this.nativeEvent=h,this.target=x,this.currentTarget=null;for(var O in t)t.hasOwnProperty(O)&&(o=t[O],this[O]=o?o(h):h[O]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?Go:Of,this.isPropagationStopped=Of,this}return b(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Go)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Go)},persist:function(){},isPersistent:Go}),i}var ha={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Xo=un(ha),Ps=b({},ha,{view:0,detail:0}),ob=un(Ps),oc,rc,js,Jo=b({},Ps,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cc,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==js&&(js&&t.type==="mousemove"?(oc=t.screenX-js.screenX,rc=t.screenY-js.screenY):rc=oc=0,js=t),oc)},movementY:function(t){return"movementY"in t?t.movementY:rc}}),Cf=un(Jo),rb=b({},Jo,{dataTransfer:0}),lb=un(rb),cb=b({},Ps,{relatedTarget:0}),lc=un(cb),ub=b({},ha,{animationName:0,elapsedTime:0,pseudoElement:0}),db=un(ub),fb=b({},ha,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),mb=un(fb),pb=b({},ha,{data:0}),Nf=un(pb),hb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yb={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},gb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bb(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=gb[t])?!!i[t]:!1}function cc(){return bb}var vb=b({},Ps,{key:function(t){if(t.key){var i=hb[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Wo(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yb[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cc,charCode:function(t){return t.type==="keypress"?Wo(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Wo(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Sb=un(vb),xb=b({},Jo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),kf=un(xb),Ab=b({},Ps,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cc}),Tb=un(Ab),Eb=b({},ha,{propertyName:0,elapsedTime:0,pseudoElement:0}),_b=un(Eb),wb=b({},Jo,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Mb=un(wb),Ob=b({},ha,{newState:0,oldState:0}),Cb=un(Ob),Nb=[9,13,27,32],uc=di&&"CompositionEvent"in window,Ds=null;di&&"documentMode"in document&&(Ds=document.documentMode);var kb=di&&"TextEvent"in window&&!Ds,Rf=di&&(!uc||Ds&&8<Ds&&11>=Ds),If=" ",Lf=!1;function Bf(t,i){switch(t){case"keyup":return Nb.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ja=!1;function Rb(t,i){switch(t){case"compositionend":return Hf(i);case"keypress":return i.which!==32?null:(Lf=!0,If);case"textInput":return t=i.data,t===If&&Lf?null:t;default:return null}}function Ib(t,i){if(Ja)return t==="compositionend"||!uc&&Bf(t,i)?(t=Mf(),Fo=sc=Bi=null,Ja=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Rf&&i.locale!=="ko"?null:i.data;default:return null}}var Lb={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pf(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!Lb[t.type]:i==="textarea"}function jf(t,i,o,l){Ga?Xa?Xa.push(l):Xa=[l]:Ga=l,i=Ur(i,"onChange"),0<i.length&&(o=new Xo("onChange","change",null,o,l),t.push({event:o,listeners:i}))}var Us=null,$s=null;function Bb(t){Sh(t,0)}function Qo(t){var i=Ls(t);if(vf(i))return t}function Df(t,i){if(t==="change")return i}var Uf=!1;if(di){var dc;if(di){var fc="oninput"in document;if(!fc){var $f=document.createElement("div");$f.setAttribute("oninput","return;"),fc=typeof $f.oninput=="function"}dc=fc}else dc=!1;Uf=dc&&(!document.documentMode||9<document.documentMode)}function qf(){Us&&(Us.detachEvent("onpropertychange",zf),$s=Us=null)}function zf(t){if(t.propertyName==="value"&&Qo($s)){var i=[];jf(i,$s,t,nc(t)),wf(Bb,i)}}function Hb(t,i,o){t==="focusin"?(qf(),Us=i,$s=o,Us.attachEvent("onpropertychange",zf)):t==="focusout"&&qf()}function Pb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Qo($s)}function jb(t,i){if(t==="click")return Qo(i)}function Db(t,i){if(t==="input"||t==="change")return Qo(i)}function Ub(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var vn=typeof Object.is=="function"?Object.is:Ub;function qs(t,i){if(vn(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var o=Object.keys(t),l=Object.keys(i);if(o.length!==l.length)return!1;for(l=0;l<o.length;l++){var d=o[l];if(!en.call(i,d)||!vn(t[d],i[d]))return!1}return!0}function Vf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Yf(t,i){var o=Vf(t);t=0;for(var l;o;){if(o.nodeType===3){if(l=t+o.textContent.length,t<=i&&l>=i)return{node:o,offset:i-t};t=l}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=Vf(o)}}function Kf(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?Kf(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function Ff(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var i=Yo(t.document);i instanceof t.HTMLIFrameElement;){try{var o=typeof i.contentWindow.location.href=="string"}catch{o=!1}if(o)t=i.contentWindow;else break;i=Yo(t.document)}return i}function mc(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}var $b=di&&"documentMode"in document&&11>=document.documentMode,Qa=null,pc=null,zs=null,hc=!1;function Wf(t,i,o){var l=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;hc||Qa==null||Qa!==Yo(l)||(l=Qa,"selectionStart"in l&&mc(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),zs&&qs(zs,l)||(zs=l,l=Ur(pc,"onSelect"),0<l.length&&(i=new Xo("onSelect","select",null,i,o),t.push({event:i,listeners:l}),i.target=Qa)))}function ya(t,i){var o={};return o[t.toLowerCase()]=i.toLowerCase(),o["Webkit"+t]="webkit"+i,o["Moz"+t]="moz"+i,o}var Za={animationend:ya("Animation","AnimationEnd"),animationiteration:ya("Animation","AnimationIteration"),animationstart:ya("Animation","AnimationStart"),transitionrun:ya("Transition","TransitionRun"),transitionstart:ya("Transition","TransitionStart"),transitioncancel:ya("Transition","TransitionCancel"),transitionend:ya("Transition","TransitionEnd")},yc={},Gf={};di&&(Gf=document.createElement("div").style,"AnimationEvent"in window||(delete Za.animationend.animation,delete Za.animationiteration.animation,delete Za.animationstart.animation),"TransitionEvent"in window||delete Za.transitionend.transition);function ga(t){if(yc[t])return yc[t];if(!Za[t])return t;var i=Za[t],o;for(o in i)if(i.hasOwnProperty(o)&&o in Gf)return yc[t]=i[o];return t}var Xf=ga("animationend"),Jf=ga("animationiteration"),Qf=ga("animationstart"),qb=ga("transitionrun"),zb=ga("transitionstart"),Vb=ga("transitioncancel"),Zf=ga("transitionend"),em=new Map,gc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");gc.push("scrollEnd");function Un(t,i){em.set(t,i),pa(i,[t])}var Zo=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Cn=[],es=0,bc=0;function er(){for(var t=es,i=bc=es=0;i<t;){var o=Cn[i];Cn[i++]=null;var l=Cn[i];Cn[i++]=null;var d=Cn[i];Cn[i++]=null;var h=Cn[i];if(Cn[i++]=null,l!==null&&d!==null){var x=l.pending;x===null?d.next=d:(d.next=x.next,x.next=d),l.pending=d}h!==0&&tm(o,d,h)}}function tr(t,i,o,l){Cn[es++]=t,Cn[es++]=i,Cn[es++]=o,Cn[es++]=l,bc|=l,t.lanes|=l,t=t.alternate,t!==null&&(t.lanes|=l)}function vc(t,i,o,l){return tr(t,i,o,l),nr(t)}function ba(t,i){return tr(t,null,null,i),nr(t)}function tm(t,i,o){t.lanes|=o;var l=t.alternate;l!==null&&(l.lanes|=o);for(var d=!1,h=t.return;h!==null;)h.childLanes|=o,l=h.alternate,l!==null&&(l.childLanes|=o),h.tag===22&&(t=h.stateNode,t===null||t._visibility&1||(d=!0)),t=h,h=h.return;return t.tag===3?(h=t.stateNode,d&&i!==null&&(d=31-at(o),t=h.hiddenUpdates,l=t[d],l===null?t[d]=[i]:l.push(i),i.lane=o|536870912),h):null}function nr(t){if(50<fo)throw fo=0,Ou=null,Error(s(185));for(var i=t.return;i!==null;)t=i,i=t.return;return t.tag===3?t.stateNode:null}var ts={};function Yb(t,i,o,l){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(t,i,o,l){return new Yb(t,i,o,l)}function Sc(t){return t=t.prototype,!(!t||!t.isReactComponent)}function fi(t,i){var o=t.alternate;return o===null?(o=Sn(t.tag,i,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=i,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&65011712,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,i=t.dependencies,o.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o.refCleanup=t.refCleanup,o}function nm(t,i){t.flags&=65011714;var o=t.alternate;return o===null?(t.childLanes=0,t.lanes=i,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=o.childLanes,t.lanes=o.lanes,t.child=o.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=o.memoizedProps,t.memoizedState=o.memoizedState,t.updateQueue=o.updateQueue,t.type=o.type,i=o.dependencies,t.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t}function ir(t,i,o,l,d,h){var x=0;if(l=t,typeof t=="function")Sc(t)&&(x=1);else if(typeof t=="string")x=Xv(t,o,ne.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case D:return t=Sn(31,o,i,d),t.elementType=D,t.lanes=h,t;case A:return va(o.children,d,h,i);case _:x=8,d|=24;break;case E:return t=Sn(12,o,i,d|2),t.elementType=E,t.lanes=h,t;case L:return t=Sn(13,o,i,d),t.elementType=L,t.lanes=h,t;case k:return t=Sn(19,o,i,d),t.elementType=k,t.lanes=h,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case M:x=10;break e;case w:x=9;break e;case C:x=11;break e;case R:x=14;break e;case H:x=16,l=null;break e}x=29,o=Error(s(130,t===null?"null":typeof t,"")),l=null}return i=Sn(x,o,i,d),i.elementType=t,i.type=l,i.lanes=h,i}function va(t,i,o,l){return t=Sn(7,t,l,i),t.lanes=o,t}function xc(t,i,o){return t=Sn(6,t,null,i),t.lanes=o,t}function im(t){var i=Sn(18,null,null,0);return i.stateNode=t,i}function Ac(t,i,o){return i=Sn(4,t.children!==null?t.children:[],t.key,i),i.lanes=o,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}var am=new WeakMap;function Nn(t,i){if(typeof t=="object"&&t!==null){var o=am.get(t);return o!==void 0?o:(i={value:t,source:i,stack:Yt(i)},am.set(t,i),i)}return{value:t,source:i,stack:Yt(i)}}var ns=[],is=0,ar=null,Vs=0,kn=[],Rn=0,Hi=null,ei=1,ti="";function mi(t,i){ns[is++]=Vs,ns[is++]=ar,ar=t,Vs=i}function sm(t,i,o){kn[Rn++]=ei,kn[Rn++]=ti,kn[Rn++]=Hi,Hi=t;var l=ei;t=ti;var d=32-at(l)-1;l&=~(1<<d),o+=1;var h=32-at(i)+d;if(30<h){var x=d-d%5;h=(l&(1<<x)-1).toString(32),l>>=x,d-=x,ei=1<<32-at(i)+d|o<<d|l,ti=h+t}else ei=1<<h|o<<d|l,ti=t}function Tc(t){t.return!==null&&(mi(t,1),sm(t,1,0))}function Ec(t){for(;t===ar;)ar=ns[--is],ns[is]=null,Vs=ns[--is],ns[is]=null;for(;t===Hi;)Hi=kn[--Rn],kn[Rn]=null,ti=kn[--Rn],kn[Rn]=null,ei=kn[--Rn],kn[Rn]=null}function om(t,i){kn[Rn++]=ei,kn[Rn++]=ti,kn[Rn++]=Hi,ei=i.id,ti=i.overflow,Hi=t}var Gt=null,ct=null,Ue=!1,Pi=null,In=!1,_c=Error(s(519));function ji(t){var i=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Ys(Nn(i,t)),_c}function rm(t){var i=t.stateNode,o=t.type,l=t.memoizedProps;switch(i[Wt]=t,i[cn]=l,o){case"dialog":Be("cancel",i),Be("close",i);break;case"iframe":case"object":case"embed":Be("load",i);break;case"video":case"audio":for(o=0;o<po.length;o++)Be(po[o],i);break;case"source":Be("error",i);break;case"img":case"image":case"link":Be("error",i),Be("load",i);break;case"details":Be("toggle",i);break;case"input":Be("invalid",i),Sf(i,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":Be("invalid",i);break;case"textarea":Be("invalid",i),Af(i,l.value,l.defaultValue,l.children)}o=l.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||i.textContent===""+o||l.suppressHydrationWarning===!0||Eh(i.textContent,o)?(l.popover!=null&&(Be("beforetoggle",i),Be("toggle",i)),l.onScroll!=null&&Be("scroll",i),l.onScrollEnd!=null&&Be("scrollend",i),l.onClick!=null&&(i.onclick=ui),i=!0):i=!1,i||ji(t,!0)}function lm(t){for(Gt=t.return;Gt;)switch(Gt.tag){case 5:case 31:case 13:In=!1;return;case 27:case 3:In=!0;return;default:Gt=Gt.return}}function as(t){if(t!==Gt)return!1;if(!Ue)return lm(t),Ue=!0,!1;var i=t.tag,o;if((o=i!==3&&i!==27)&&((o=i===5)&&(o=t.type,o=!(o!=="form"&&o!=="button")||zu(t.type,t.memoizedProps)),o=!o),o&&ct&&ji(t),lm(t),i===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(s(317));ct=Ih(t)}else if(i===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(s(317));ct=Ih(t)}else i===27?(i=ct,Qi(t.type)?(t=Wu,Wu=null,ct=t):ct=i):ct=Gt?Bn(t.stateNode.nextSibling):null;return!0}function Sa(){ct=Gt=null,Ue=!1}function wc(){var t=Pi;return t!==null&&(pn===null?pn=t:pn.push.apply(pn,t),Pi=null),t}function Ys(t){Pi===null?Pi=[t]:Pi.push(t)}var Mc=I(null),xa=null,pi=null;function Di(t,i,o){G(Mc,i._currentValue),i._currentValue=o}function hi(t){t._currentValue=Mc.current,K(Mc)}function Oc(t,i,o){for(;t!==null;){var l=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,l!==null&&(l.childLanes|=i)):l!==null&&(l.childLanes&i)!==i&&(l.childLanes|=i),t===o)break;t=t.return}}function Cc(t,i,o,l){var d=t.child;for(d!==null&&(d.return=t);d!==null;){var h=d.dependencies;if(h!==null){var x=d.child;h=h.firstContext;e:for(;h!==null;){var O=h;h=d;for(var B=0;B<i.length;B++)if(O.context===i[B]){h.lanes|=o,O=h.alternate,O!==null&&(O.lanes|=o),Oc(h.return,o,t),l||(x=null);break e}h=O.next}}else if(d.tag===18){if(x=d.return,x===null)throw Error(s(341));x.lanes|=o,h=x.alternate,h!==null&&(h.lanes|=o),Oc(x,o,t),x=null}else x=d.child;if(x!==null)x.return=d;else for(x=d;x!==null;){if(x===t){x=null;break}if(d=x.sibling,d!==null){d.return=x.return,x=d;break}x=x.return}d=x}}function ss(t,i,o,l){t=null;for(var d=i,h=!1;d!==null;){if(!h){if((d.flags&524288)!==0)h=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var x=d.alternate;if(x===null)throw Error(s(387));if(x=x.memoizedProps,x!==null){var O=d.type;vn(d.pendingProps.value,x.value)||(t!==null?t.push(O):t=[O])}}else if(d===pe.current){if(x=d.alternate,x===null)throw Error(s(387));x.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(t!==null?t.push(vo):t=[vo])}d=d.return}t!==null&&Cc(i,t,o,l),i.flags|=262144}function sr(t){for(t=t.firstContext;t!==null;){if(!vn(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Aa(t){xa=t,pi=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Xt(t){return cm(xa,t)}function or(t,i){return xa===null&&Aa(t),cm(t,i)}function cm(t,i){var o=i._currentValue;if(i={context:i,memoizedValue:o,next:null},pi===null){if(t===null)throw Error(s(308));pi=i,t.dependencies={lanes:0,firstContext:i},t.flags|=524288}else pi=pi.next=i;return o}var Kb=typeof AbortController<"u"?AbortController:function(){var t=[],i=this.signal={aborted:!1,addEventListener:function(o,l){t.push(l)}};this.abort=function(){i.aborted=!0,t.forEach(function(o){return o()})}},Fb=e.unstable_scheduleCallback,Wb=e.unstable_NormalPriority,Nt={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Nc(){return{controller:new Kb,data:new Map,refCount:0}}function Ks(t){t.refCount--,t.refCount===0&&Fb(Wb,function(){t.controller.abort()})}var Fs=null,kc=0,os=0,rs=null;function Gb(t,i){if(Fs===null){var o=Fs=[];kc=0,os=Lu(),rs={status:"pending",value:void 0,then:function(l){o.push(l)}}}return kc++,i.then(um,um),i}function um(){if(--kc===0&&Fs!==null){rs!==null&&(rs.status="fulfilled");var t=Fs;Fs=null,os=0,rs=null;for(var i=0;i<t.length;i++)(0,t[i])()}}function Xb(t,i){var o=[],l={status:"pending",value:null,reason:null,then:function(d){o.push(d)}};return t.then(function(){l.status="fulfilled",l.value=i;for(var d=0;d<o.length;d++)(0,o[d])(i)},function(d){for(l.status="rejected",l.reason=d,d=0;d<o.length;d++)(0,o[d])(void 0)}),l}var dm=P.S;P.S=function(t,i){Wp=qt(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&Gb(t,i),dm!==null&&dm(t,i)};var Ta=I(null);function Rc(){var t=Ta.current;return t!==null?t:st.pooledCache}function rr(t,i){i===null?G(Ta,Ta.current):G(Ta,i.pool)}function fm(){var t=Rc();return t===null?null:{parent:Nt._currentValue,pool:t}}var ls=Error(s(460)),Ic=Error(s(474)),lr=Error(s(542)),cr={then:function(){}};function mm(t){return t=t.status,t==="fulfilled"||t==="rejected"}function pm(t,i,o){switch(o=t[o],o===void 0?t.push(i):o!==i&&(i.then(ui,ui),i=o),i.status){case"fulfilled":return i.value;case"rejected":throw t=i.reason,ym(t),t;default:if(typeof i.status=="string")i.then(ui,ui);else{if(t=st,t!==null&&100<t.shellSuspendCounter)throw Error(s(482));t=i,t.status="pending",t.then(function(l){if(i.status==="pending"){var d=i;d.status="fulfilled",d.value=l}},function(l){if(i.status==="pending"){var d=i;d.status="rejected",d.reason=l}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw t=i.reason,ym(t),t}throw _a=i,ls}}function Ea(t){try{var i=t._init;return i(t._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(_a=o,ls):o}}var _a=null;function hm(){if(_a===null)throw Error(s(459));var t=_a;return _a=null,t}function ym(t){if(t===ls||t===lr)throw Error(s(483))}var cs=null,Ws=0;function ur(t){var i=Ws;return Ws+=1,cs===null&&(cs=[]),pm(cs,t,i)}function Gs(t,i){i=i.props.ref,t.ref=i!==void 0?i:null}function dr(t,i){throw i.$$typeof===S?Error(s(525)):(t=Object.prototype.toString.call(i),Error(s(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t)))}function gm(t){function i(U,j){if(t){var V=U.deletions;V===null?(U.deletions=[j],U.flags|=16):V.push(j)}}function o(U,j){if(!t)return null;for(;j!==null;)i(U,j),j=j.sibling;return null}function l(U){for(var j=new Map;U!==null;)U.key!==null?j.set(U.key,U):j.set(U.index,U),U=U.sibling;return j}function d(U,j){return U=fi(U,j),U.index=0,U.sibling=null,U}function h(U,j,V){return U.index=V,t?(V=U.alternate,V!==null?(V=V.index,V<j?(U.flags|=67108866,j):V):(U.flags|=67108866,j)):(U.flags|=1048576,j)}function x(U){return t&&U.alternate===null&&(U.flags|=67108866),U}function O(U,j,V,se){return j===null||j.tag!==6?(j=xc(V,U.mode,se),j.return=U,j):(j=d(j,V),j.return=U,j)}function B(U,j,V,se){var ve=V.type;return ve===A?ie(U,j,V.props.children,se,V.key):j!==null&&(j.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===H&&Ea(ve)===j.type)?(j=d(j,V.props),Gs(j,V),j.return=U,j):(j=ir(V.type,V.key,V.props,null,U.mode,se),Gs(j,V),j.return=U,j)}function Y(U,j,V,se){return j===null||j.tag!==4||j.stateNode.containerInfo!==V.containerInfo||j.stateNode.implementation!==V.implementation?(j=Ac(V,U.mode,se),j.return=U,j):(j=d(j,V.children||[]),j.return=U,j)}function ie(U,j,V,se,ve){return j===null||j.tag!==7?(j=va(V,U.mode,se,ve),j.return=U,j):(j=d(j,V),j.return=U,j)}function oe(U,j,V){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=xc(""+j,U.mode,V),j.return=U,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case T:return V=ir(j.type,j.key,j.props,null,U.mode,V),Gs(V,j),V.return=U,V;case v:return j=Ac(j,U.mode,V),j.return=U,j;case H:return j=Ea(j),oe(U,j,V)}if(q(j)||te(j))return j=va(j,U.mode,V,null),j.return=U,j;if(typeof j.then=="function")return oe(U,ur(j),V);if(j.$$typeof===M)return oe(U,or(U,j),V);dr(U,j)}return null}function F(U,j,V,se){var ve=j!==null?j.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return ve!==null?null:O(U,j,""+V,se);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case T:return V.key===ve?B(U,j,V,se):null;case v:return V.key===ve?Y(U,j,V,se):null;case H:return V=Ea(V),F(U,j,V,se)}if(q(V)||te(V))return ve!==null?null:ie(U,j,V,se,null);if(typeof V.then=="function")return F(U,j,ur(V),se);if(V.$$typeof===M)return F(U,j,or(U,V),se);dr(U,V)}return null}function Z(U,j,V,se,ve){if(typeof se=="string"&&se!==""||typeof se=="number"||typeof se=="bigint")return U=U.get(V)||null,O(j,U,""+se,ve);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case T:return U=U.get(se.key===null?V:se.key)||null,B(j,U,se,ve);case v:return U=U.get(se.key===null?V:se.key)||null,Y(j,U,se,ve);case H:return se=Ea(se),Z(U,j,V,se,ve)}if(q(se)||te(se))return U=U.get(V)||null,ie(j,U,se,ve,null);if(typeof se.then=="function")return Z(U,j,V,ur(se),ve);if(se.$$typeof===M)return Z(U,j,V,or(j,se),ve);dr(j,se)}return null}function he(U,j,V,se){for(var ve=null,Ve=null,be=j,Ne=j=0,je=null;be!==null&&Ne<V.length;Ne++){be.index>Ne?(je=be,be=null):je=be.sibling;var Ye=F(U,be,V[Ne],se);if(Ye===null){be===null&&(be=je);break}t&&be&&Ye.alternate===null&&i(U,be),j=h(Ye,j,Ne),Ve===null?ve=Ye:Ve.sibling=Ye,Ve=Ye,be=je}if(Ne===V.length)return o(U,be),Ue&&mi(U,Ne),ve;if(be===null){for(;Ne<V.length;Ne++)be=oe(U,V[Ne],se),be!==null&&(j=h(be,j,Ne),Ve===null?ve=be:Ve.sibling=be,Ve=be);return Ue&&mi(U,Ne),ve}for(be=l(be);Ne<V.length;Ne++)je=Z(be,U,Ne,V[Ne],se),je!==null&&(t&&je.alternate!==null&&be.delete(je.key===null?Ne:je.key),j=h(je,j,Ne),Ve===null?ve=je:Ve.sibling=je,Ve=je);return t&&be.forEach(function(ia){return i(U,ia)}),Ue&&mi(U,Ne),ve}function xe(U,j,V,se){if(V==null)throw Error(s(151));for(var ve=null,Ve=null,be=j,Ne=j=0,je=null,Ye=V.next();be!==null&&!Ye.done;Ne++,Ye=V.next()){be.index>Ne?(je=be,be=null):je=be.sibling;var ia=F(U,be,Ye.value,se);if(ia===null){be===null&&(be=je);break}t&&be&&ia.alternate===null&&i(U,be),j=h(ia,j,Ne),Ve===null?ve=ia:Ve.sibling=ia,Ve=ia,be=je}if(Ye.done)return o(U,be),Ue&&mi(U,Ne),ve;if(be===null){for(;!Ye.done;Ne++,Ye=V.next())Ye=oe(U,Ye.value,se),Ye!==null&&(j=h(Ye,j,Ne),Ve===null?ve=Ye:Ve.sibling=Ye,Ve=Ye);return Ue&&mi(U,Ne),ve}for(be=l(be);!Ye.done;Ne++,Ye=V.next())Ye=Z(be,U,Ne,Ye.value,se),Ye!==null&&(t&&Ye.alternate!==null&&be.delete(Ye.key===null?Ne:Ye.key),j=h(Ye,j,Ne),Ve===null?ve=Ye:Ve.sibling=Ye,Ve=Ye);return t&&be.forEach(function(rS){return i(U,rS)}),Ue&&mi(U,Ne),ve}function nt(U,j,V,se){if(typeof V=="object"&&V!==null&&V.type===A&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case T:e:{for(var ve=V.key;j!==null;){if(j.key===ve){if(ve=V.type,ve===A){if(j.tag===7){o(U,j.sibling),se=d(j,V.props.children),se.return=U,U=se;break e}}else if(j.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===H&&Ea(ve)===j.type){o(U,j.sibling),se=d(j,V.props),Gs(se,V),se.return=U,U=se;break e}o(U,j);break}else i(U,j);j=j.sibling}V.type===A?(se=va(V.props.children,U.mode,se,V.key),se.return=U,U=se):(se=ir(V.type,V.key,V.props,null,U.mode,se),Gs(se,V),se.return=U,U=se)}return x(U);case v:e:{for(ve=V.key;j!==null;){if(j.key===ve)if(j.tag===4&&j.stateNode.containerInfo===V.containerInfo&&j.stateNode.implementation===V.implementation){o(U,j.sibling),se=d(j,V.children||[]),se.return=U,U=se;break e}else{o(U,j);break}else i(U,j);j=j.sibling}se=Ac(V,U.mode,se),se.return=U,U=se}return x(U);case H:return V=Ea(V),nt(U,j,V,se)}if(q(V))return he(U,j,V,se);if(te(V)){if(ve=te(V),typeof ve!="function")throw Error(s(150));return V=ve.call(V),xe(U,j,V,se)}if(typeof V.then=="function")return nt(U,j,ur(V),se);if(V.$$typeof===M)return nt(U,j,or(U,V),se);dr(U,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,j!==null&&j.tag===6?(o(U,j.sibling),se=d(j,V),se.return=U,U=se):(o(U,j),se=xc(V,U.mode,se),se.return=U,U=se),x(U)):o(U,j)}return function(U,j,V,se){try{Ws=0;var ve=nt(U,j,V,se);return cs=null,ve}catch(be){if(be===ls||be===lr)throw be;var Ve=Sn(29,be,null,U.mode);return Ve.lanes=se,Ve.return=U,Ve}}}var wa=gm(!0),bm=gm(!1),Ui=!1;function Lc(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Bc(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function $i(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function qi(t,i,o){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,(Ke&2)!==0){var d=l.pending;return d===null?i.next=i:(i.next=d.next,d.next=i),l.pending=i,i=nr(t),tm(t,null,o),i}return tr(t,l,i,o),nr(t)}function Xs(t,i,o){if(i=i.updateQueue,i!==null&&(i=i.shared,(o&4194048)!==0)){var l=i.lanes;l&=t.pendingLanes,o|=l,i.lanes=o,tn(t,o)}}function Hc(t,i){var o=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,o===l)){var d=null,h=null;if(o=o.firstBaseUpdate,o!==null){do{var x={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};h===null?d=h=x:h=h.next=x,o=o.next}while(o!==null);h===null?d=h=i:h=h.next=i}else d=h=i;o={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:h,shared:l.shared,callbacks:l.callbacks},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=i:t.next=i,o.lastBaseUpdate=i}var Pc=!1;function Js(){if(Pc){var t=rs;if(t!==null)throw t}}function Qs(t,i,o,l){Pc=!1;var d=t.updateQueue;Ui=!1;var h=d.firstBaseUpdate,x=d.lastBaseUpdate,O=d.shared.pending;if(O!==null){d.shared.pending=null;var B=O,Y=B.next;B.next=null,x===null?h=Y:x.next=Y,x=B;var ie=t.alternate;ie!==null&&(ie=ie.updateQueue,O=ie.lastBaseUpdate,O!==x&&(O===null?ie.firstBaseUpdate=Y:O.next=Y,ie.lastBaseUpdate=B))}if(h!==null){var oe=d.baseState;x=0,ie=Y=B=null,O=h;do{var F=O.lane&-536870913,Z=F!==O.lane;if(Z?(Pe&F)===F:(l&F)===F){F!==0&&F===os&&(Pc=!0),ie!==null&&(ie=ie.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var he=t,xe=O;F=i;var nt=o;switch(xe.tag){case 1:if(he=xe.payload,typeof he=="function"){oe=he.call(nt,oe,F);break e}oe=he;break e;case 3:he.flags=he.flags&-65537|128;case 0:if(he=xe.payload,F=typeof he=="function"?he.call(nt,oe,F):he,F==null)break e;oe=b({},oe,F);break e;case 2:Ui=!0}}F=O.callback,F!==null&&(t.flags|=64,Z&&(t.flags|=8192),Z=d.callbacks,Z===null?d.callbacks=[F]:Z.push(F))}else Z={lane:F,tag:O.tag,payload:O.payload,callback:O.callback,next:null},ie===null?(Y=ie=Z,B=oe):ie=ie.next=Z,x|=F;if(O=O.next,O===null){if(O=d.shared.pending,O===null)break;Z=O,O=Z.next,Z.next=null,d.lastBaseUpdate=Z,d.shared.pending=null}}while(!0);ie===null&&(B=oe),d.baseState=B,d.firstBaseUpdate=Y,d.lastBaseUpdate=ie,h===null&&(d.shared.lanes=0),Fi|=x,t.lanes=x,t.memoizedState=oe}}function vm(t,i){if(typeof t!="function")throw Error(s(191,t));t.call(i)}function Sm(t,i){var o=t.callbacks;if(o!==null)for(t.callbacks=null,t=0;t<o.length;t++)vm(o[t],i)}var us=I(null),fr=I(0);function xm(t,i){t=Ei,G(fr,t),G(us,i),Ei=t|i.baseLanes}function jc(){G(fr,Ei),G(us,us.current)}function Dc(){Ei=fr.current,K(us),K(fr)}var xn=I(null),Ln=null;function zi(t){var i=t.alternate;G(_t,_t.current&1),G(xn,t),Ln===null&&(i===null||us.current!==null||i.memoizedState!==null)&&(Ln=t)}function Uc(t){G(_t,_t.current),G(xn,t),Ln===null&&(Ln=t)}function Am(t){t.tag===22?(G(_t,_t.current),G(xn,t),Ln===null&&(Ln=t)):Vi()}function Vi(){G(_t,_t.current),G(xn,xn.current)}function An(t){K(xn),Ln===t&&(Ln=null),K(_t)}var _t=I(0);function mr(t){for(var i=t;i!==null;){if(i.tag===13){var o=i.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||Ku(o)||Fu(o)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var yi=0,Me=null,et=null,kt=null,pr=!1,ds=!1,Ma=!1,hr=0,Zs=0,fs=null,Jb=0;function At(){throw Error(s(321))}function $c(t,i){if(i===null)return!1;for(var o=0;o<i.length&&o<t.length;o++)if(!vn(t[o],i[o]))return!1;return!0}function qc(t,i,o,l,d,h){return yi=h,Me=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,P.H=t===null||t.memoizedState===null?sp:iu,Ma=!1,h=o(l,d),Ma=!1,ds&&(h=Em(i,o,l,d)),Tm(t),h}function Tm(t){P.H=no;var i=et!==null&&et.next!==null;if(yi=0,kt=et=Me=null,pr=!1,Zs=0,fs=null,i)throw Error(s(300));t===null||Rt||(t=t.dependencies,t!==null&&sr(t)&&(Rt=!0))}function Em(t,i,o,l){Me=t;var d=0;do{if(ds&&(fs=null),Zs=0,ds=!1,25<=d)throw Error(s(301));if(d+=1,kt=et=null,t.updateQueue!=null){var h=t.updateQueue;h.lastEffect=null,h.events=null,h.stores=null,h.memoCache!=null&&(h.memoCache.index=0)}P.H=op,h=i(o,l)}while(ds);return h}function Qb(){var t=P.H,i=t.useState()[0];return i=typeof i.then=="function"?eo(i):i,t=t.useState()[0],(et!==null?et.memoizedState:null)!==t&&(Me.flags|=1024),i}function zc(){var t=hr!==0;return hr=0,t}function Vc(t,i,o){i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~o}function Yc(t){if(pr){for(t=t.memoizedState;t!==null;){var i=t.queue;i!==null&&(i.pending=null),t=t.next}pr=!1}yi=0,kt=et=Me=null,ds=!1,Zs=hr=0,fs=null}function on(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kt===null?Me.memoizedState=kt=t:kt=kt.next=t,kt}function wt(){if(et===null){var t=Me.alternate;t=t!==null?t.memoizedState:null}else t=et.next;var i=kt===null?Me.memoizedState:kt.next;if(i!==null)kt=i,et=t;else{if(t===null)throw Me.alternate===null?Error(s(467)):Error(s(310));et=t,t={memoizedState:et.memoizedState,baseState:et.baseState,baseQueue:et.baseQueue,queue:et.queue,next:null},kt===null?Me.memoizedState=kt=t:kt=kt.next=t}return kt}function yr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function eo(t){var i=Zs;return Zs+=1,fs===null&&(fs=[]),t=pm(fs,t,i),i=Me,(kt===null?i.memoizedState:kt.next)===null&&(i=i.alternate,P.H=i===null||i.memoizedState===null?sp:iu),t}function gr(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return eo(t);if(t.$$typeof===M)return Xt(t)}throw Error(s(438,String(t)))}function Kc(t){var i=null,o=Me.updateQueue;if(o!==null&&(i=o.memoCache),i==null){var l=Me.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(i={data:l.data.map(function(d){return d.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),o===null&&(o=yr(),Me.updateQueue=o),o.memoCache=i,o=i.data[i.index],o===void 0)for(o=i.data[i.index]=Array(t),l=0;l<t;l++)o[l]=$;return i.index++,o}function gi(t,i){return typeof i=="function"?i(t):i}function br(t){var i=wt();return Fc(i,et,t)}function Fc(t,i,o){var l=t.queue;if(l===null)throw Error(s(311));l.lastRenderedReducer=o;var d=t.baseQueue,h=l.pending;if(h!==null){if(d!==null){var x=d.next;d.next=h.next,h.next=x}i.baseQueue=d=h,l.pending=null}if(h=t.baseState,d===null)t.memoizedState=h;else{i=d.next;var O=x=null,B=null,Y=i,ie=!1;do{var oe=Y.lane&-536870913;if(oe!==Y.lane?(Pe&oe)===oe:(yi&oe)===oe){var F=Y.revertLane;if(F===0)B!==null&&(B=B.next={lane:0,revertLane:0,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),oe===os&&(ie=!0);else if((yi&F)===F){Y=Y.next,F===os&&(ie=!0);continue}else oe={lane:0,revertLane:Y.revertLane,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},B===null?(O=B=oe,x=h):B=B.next=oe,Me.lanes|=F,Fi|=F;oe=Y.action,Ma&&o(h,oe),h=Y.hasEagerState?Y.eagerState:o(h,oe)}else F={lane:oe,revertLane:Y.revertLane,gesture:Y.gesture,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},B===null?(O=B=F,x=h):B=B.next=F,Me.lanes|=oe,Fi|=oe;Y=Y.next}while(Y!==null&&Y!==i);if(B===null?x=h:B.next=O,!vn(h,t.memoizedState)&&(Rt=!0,ie&&(o=rs,o!==null)))throw o;t.memoizedState=h,t.baseState=x,t.baseQueue=B,l.lastRenderedState=h}return d===null&&(l.lanes=0),[t.memoizedState,l.dispatch]}function Wc(t){var i=wt(),o=i.queue;if(o===null)throw Error(s(311));o.lastRenderedReducer=t;var l=o.dispatch,d=o.pending,h=i.memoizedState;if(d!==null){o.pending=null;var x=d=d.next;do h=t(h,x.action),x=x.next;while(x!==d);vn(h,i.memoizedState)||(Rt=!0),i.memoizedState=h,i.baseQueue===null&&(i.baseState=h),o.lastRenderedState=h}return[h,l]}function _m(t,i,o){var l=Me,d=wt(),h=Ue;if(h){if(o===void 0)throw Error(s(407));o=o()}else o=i();var x=!vn((et||d).memoizedState,o);if(x&&(d.memoizedState=o,Rt=!0),d=d.queue,Jc(Om.bind(null,l,d,t),[t]),d.getSnapshot!==i||x||kt!==null&&kt.memoizedState.tag&1){if(l.flags|=2048,ms(9,{destroy:void 0},Mm.bind(null,l,d,o,i),null),st===null)throw Error(s(349));h||(yi&127)!==0||wm(l,i,o)}return o}function wm(t,i,o){t.flags|=16384,t={getSnapshot:i,value:o},i=Me.updateQueue,i===null?(i=yr(),Me.updateQueue=i,i.stores=[t]):(o=i.stores,o===null?i.stores=[t]:o.push(t))}function Mm(t,i,o,l){i.value=o,i.getSnapshot=l,Cm(i)&&Nm(t)}function Om(t,i,o){return o(function(){Cm(i)&&Nm(t)})}function Cm(t){var i=t.getSnapshot;t=t.value;try{var o=i();return!vn(t,o)}catch{return!0}}function Nm(t){var i=ba(t,2);i!==null&&hn(i,t,2)}function Gc(t){var i=on();if(typeof t=="function"){var o=t;if(t=o(),Ma){Ze(!0);try{o()}finally{Ze(!1)}}}return i.memoizedState=i.baseState=t,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:t},i}function km(t,i,o,l){return t.baseState=o,Fc(t,et,typeof l=="function"?l:gi)}function Zb(t,i,o,l,d){if(xr(t))throw Error(s(485));if(t=i.action,t!==null){var h={payload:d,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){h.listeners.push(x)}};P.T!==null?o(!0):h.isTransition=!1,l(h),o=i.pending,o===null?(h.next=i.pending=h,Rm(i,h)):(h.next=o.next,i.pending=o.next=h)}}function Rm(t,i){var o=i.action,l=i.payload,d=t.state;if(i.isTransition){var h=P.T,x={};P.T=x;try{var O=o(d,l),B=P.S;B!==null&&B(x,O),Im(t,i,O)}catch(Y){Xc(t,i,Y)}finally{h!==null&&x.types!==null&&(h.types=x.types),P.T=h}}else try{h=o(d,l),Im(t,i,h)}catch(Y){Xc(t,i,Y)}}function Im(t,i,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(l){Lm(t,i,l)},function(l){return Xc(t,i,l)}):Lm(t,i,o)}function Lm(t,i,o){i.status="fulfilled",i.value=o,Bm(i),t.state=o,i=t.pending,i!==null&&(o=i.next,o===i?t.pending=null:(o=o.next,i.next=o,Rm(t,o)))}function Xc(t,i,o){var l=t.pending;if(t.pending=null,l!==null){l=l.next;do i.status="rejected",i.reason=o,Bm(i),i=i.next;while(i!==l)}t.action=null}function Bm(t){t=t.listeners;for(var i=0;i<t.length;i++)(0,t[i])()}function Hm(t,i){return i}function Pm(t,i){if(Ue){var o=st.formState;if(o!==null){e:{var l=Me;if(Ue){if(ct){t:{for(var d=ct,h=In;d.nodeType!==8;){if(!h){d=null;break t}if(d=Bn(d.nextSibling),d===null){d=null;break t}}h=d.data,d=h==="F!"||h==="F"?d:null}if(d){ct=Bn(d.nextSibling),l=d.data==="F!";break e}}ji(l)}l=!1}l&&(i=o[0])}}return o=on(),o.memoizedState=o.baseState=i,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hm,lastRenderedState:i},o.queue=l,o=np.bind(null,Me,l),l.dispatch=o,l=Gc(!1),h=nu.bind(null,Me,!1,l.queue),l=on(),d={state:i,dispatch:null,action:t,pending:null},l.queue=d,o=Zb.bind(null,Me,d,h,o),d.dispatch=o,l.memoizedState=t,[i,o,!1]}function jm(t){var i=wt();return Dm(i,et,t)}function Dm(t,i,o){if(i=Fc(t,i,Hm)[0],t=br(gi)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var l=eo(i)}catch(x){throw x===ls?lr:x}else l=i;i=wt();var d=i.queue,h=d.dispatch;return o!==i.memoizedState&&(Me.flags|=2048,ms(9,{destroy:void 0},ev.bind(null,d,o),null)),[l,h,t]}function ev(t,i){t.action=i}function Um(t){var i=wt(),o=et;if(o!==null)return Dm(i,o,t);wt(),i=i.memoizedState,o=wt();var l=o.queue.dispatch;return o.memoizedState=t,[i,l,!1]}function ms(t,i,o,l){return t={tag:t,create:o,deps:l,inst:i,next:null},i=Me.updateQueue,i===null&&(i=yr(),Me.updateQueue=i),o=i.lastEffect,o===null?i.lastEffect=t.next=t:(l=o.next,o.next=t,t.next=l,i.lastEffect=t),t}function $m(){return wt().memoizedState}function vr(t,i,o,l){var d=on();Me.flags|=t,d.memoizedState=ms(1|i,{destroy:void 0},o,l===void 0?null:l)}function Sr(t,i,o,l){var d=wt();l=l===void 0?null:l;var h=d.memoizedState.inst;et!==null&&l!==null&&$c(l,et.memoizedState.deps)?d.memoizedState=ms(i,h,o,l):(Me.flags|=t,d.memoizedState=ms(1|i,h,o,l))}function qm(t,i){vr(8390656,8,t,i)}function Jc(t,i){Sr(2048,8,t,i)}function tv(t){Me.flags|=4;var i=Me.updateQueue;if(i===null)i=yr(),Me.updateQueue=i,i.events=[t];else{var o=i.events;o===null?i.events=[t]:o.push(t)}}function zm(t){var i=wt().memoizedState;return tv({ref:i,nextImpl:t}),function(){if((Ke&2)!==0)throw Error(s(440));return i.impl.apply(void 0,arguments)}}function Vm(t,i){return Sr(4,2,t,i)}function Ym(t,i){return Sr(4,4,t,i)}function Km(t,i){if(typeof i=="function"){t=t();var o=i(t);return function(){typeof o=="function"?o():i(null)}}if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function Fm(t,i,o){o=o!=null?o.concat([t]):null,Sr(4,4,Km.bind(null,i,t),o)}function Qc(){}function Wm(t,i){var o=wt();i=i===void 0?null:i;var l=o.memoizedState;return i!==null&&$c(i,l[1])?l[0]:(o.memoizedState=[t,i],t)}function Gm(t,i){var o=wt();i=i===void 0?null:i;var l=o.memoizedState;if(i!==null&&$c(i,l[1]))return l[0];if(l=t(),Ma){Ze(!0);try{t()}finally{Ze(!1)}}return o.memoizedState=[l,i],l}function Zc(t,i,o){return o===void 0||(yi&1073741824)!==0&&(Pe&261930)===0?t.memoizedState=i:(t.memoizedState=o,t=Xp(),Me.lanes|=t,Fi|=t,o)}function Xm(t,i,o,l){return vn(o,i)?o:us.current!==null?(t=Zc(t,o,l),vn(t,i)||(Rt=!0),t):(yi&42)===0||(yi&1073741824)!==0&&(Pe&261930)===0?(Rt=!0,t.memoizedState=o):(t=Xp(),Me.lanes|=t,Fi|=t,i)}function Jm(t,i,o,l,d){var h=z.p;z.p=h!==0&&8>h?h:8;var x=P.T,O={};P.T=O,nu(t,!1,i,o);try{var B=d(),Y=P.S;if(Y!==null&&Y(O,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var ie=Xb(B,l);to(t,i,ie,_n(t))}else to(t,i,l,_n(t))}catch(oe){to(t,i,{then:function(){},status:"rejected",reason:oe},_n())}finally{z.p=h,x!==null&&O.types!==null&&(x.types=O.types),P.T=x}}function nv(){}function eu(t,i,o,l){if(t.tag!==5)throw Error(s(476));var d=Qm(t).queue;Jm(t,d,i,X,o===null?nv:function(){return Zm(t),o(l)})}function Qm(t){var i=t.memoizedState;if(i!==null)return i;i={memoizedState:X,baseState:X,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:X},next:null};var o={};return i.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:o},next:null},t.memoizedState=i,t=t.alternate,t!==null&&(t.memoizedState=i),i}function Zm(t){var i=Qm(t);i.next===null&&(i=t.alternate.memoizedState),to(t,i.next.queue,{},_n())}function tu(){return Xt(vo)}function ep(){return wt().memoizedState}function tp(){return wt().memoizedState}function iv(t){for(var i=t.return;i!==null;){switch(i.tag){case 24:case 3:var o=_n();t=$i(o);var l=qi(i,t,o);l!==null&&(hn(l,i,o),Xs(l,i,o)),i={cache:Nc()},t.payload=i;return}i=i.return}}function av(t,i,o){var l=_n();o={lane:l,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},xr(t)?ip(i,o):(o=vc(t,i,o,l),o!==null&&(hn(o,t,l),ap(o,i,l)))}function np(t,i,o){var l=_n();to(t,i,o,l)}function to(t,i,o,l){var d={lane:l,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(xr(t))ip(i,d);else{var h=t.alternate;if(t.lanes===0&&(h===null||h.lanes===0)&&(h=i.lastRenderedReducer,h!==null))try{var x=i.lastRenderedState,O=h(x,o);if(d.hasEagerState=!0,d.eagerState=O,vn(O,x))return tr(t,i,d,0),st===null&&er(),!1}catch{}if(o=vc(t,i,d,l),o!==null)return hn(o,t,l),ap(o,i,l),!0}return!1}function nu(t,i,o,l){if(l={lane:2,revertLane:Lu(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},xr(t)){if(i)throw Error(s(479))}else i=vc(t,o,l,2),i!==null&&hn(i,t,2)}function xr(t){var i=t.alternate;return t===Me||i!==null&&i===Me}function ip(t,i){ds=pr=!0;var o=t.pending;o===null?i.next=i:(i.next=o.next,o.next=i),t.pending=i}function ap(t,i,o){if((o&4194048)!==0){var l=i.lanes;l&=t.pendingLanes,o|=l,i.lanes=o,tn(t,o)}}var no={readContext:Xt,use:gr,useCallback:At,useContext:At,useEffect:At,useImperativeHandle:At,useLayoutEffect:At,useInsertionEffect:At,useMemo:At,useReducer:At,useRef:At,useState:At,useDebugValue:At,useDeferredValue:At,useTransition:At,useSyncExternalStore:At,useId:At,useHostTransitionStatus:At,useFormState:At,useActionState:At,useOptimistic:At,useMemoCache:At,useCacheRefresh:At};no.useEffectEvent=At;var sp={readContext:Xt,use:gr,useCallback:function(t,i){return on().memoizedState=[t,i===void 0?null:i],t},useContext:Xt,useEffect:qm,useImperativeHandle:function(t,i,o){o=o!=null?o.concat([t]):null,vr(4194308,4,Km.bind(null,i,t),o)},useLayoutEffect:function(t,i){return vr(4194308,4,t,i)},useInsertionEffect:function(t,i){vr(4,2,t,i)},useMemo:function(t,i){var o=on();i=i===void 0?null:i;var l=t();if(Ma){Ze(!0);try{t()}finally{Ze(!1)}}return o.memoizedState=[l,i],l},useReducer:function(t,i,o){var l=on();if(o!==void 0){var d=o(i);if(Ma){Ze(!0);try{o(i)}finally{Ze(!1)}}}else d=i;return l.memoizedState=l.baseState=d,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:d},l.queue=t,t=t.dispatch=av.bind(null,Me,t),[l.memoizedState,t]},useRef:function(t){var i=on();return t={current:t},i.memoizedState=t},useState:function(t){t=Gc(t);var i=t.queue,o=np.bind(null,Me,i);return i.dispatch=o,[t.memoizedState,o]},useDebugValue:Qc,useDeferredValue:function(t,i){var o=on();return Zc(o,t,i)},useTransition:function(){var t=Gc(!1);return t=Jm.bind(null,Me,t.queue,!0,!1),on().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,i,o){var l=Me,d=on();if(Ue){if(o===void 0)throw Error(s(407));o=o()}else{if(o=i(),st===null)throw Error(s(349));(Pe&127)!==0||wm(l,i,o)}d.memoizedState=o;var h={value:o,getSnapshot:i};return d.queue=h,qm(Om.bind(null,l,h,t),[t]),l.flags|=2048,ms(9,{destroy:void 0},Mm.bind(null,l,h,o,i),null),o},useId:function(){var t=on(),i=st.identifierPrefix;if(Ue){var o=ti,l=ei;o=(l&~(1<<32-at(l)-1)).toString(32)+o,i="_"+i+"R_"+o,o=hr++,0<o&&(i+="H"+o.toString(32)),i+="_"}else o=Jb++,i="_"+i+"r_"+o.toString(32)+"_";return t.memoizedState=i},useHostTransitionStatus:tu,useFormState:Pm,useActionState:Pm,useOptimistic:function(t){var i=on();i.memoizedState=i.baseState=t;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=o,i=nu.bind(null,Me,!0,o),o.dispatch=i,[t,i]},useMemoCache:Kc,useCacheRefresh:function(){return on().memoizedState=iv.bind(null,Me)},useEffectEvent:function(t){var i=on(),o={impl:t};return i.memoizedState=o,function(){if((Ke&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}},iu={readContext:Xt,use:gr,useCallback:Wm,useContext:Xt,useEffect:Jc,useImperativeHandle:Fm,useInsertionEffect:Vm,useLayoutEffect:Ym,useMemo:Gm,useReducer:br,useRef:$m,useState:function(){return br(gi)},useDebugValue:Qc,useDeferredValue:function(t,i){var o=wt();return Xm(o,et.memoizedState,t,i)},useTransition:function(){var t=br(gi)[0],i=wt().memoizedState;return[typeof t=="boolean"?t:eo(t),i]},useSyncExternalStore:_m,useId:ep,useHostTransitionStatus:tu,useFormState:jm,useActionState:jm,useOptimistic:function(t,i){var o=wt();return km(o,et,t,i)},useMemoCache:Kc,useCacheRefresh:tp};iu.useEffectEvent=zm;var op={readContext:Xt,use:gr,useCallback:Wm,useContext:Xt,useEffect:Jc,useImperativeHandle:Fm,useInsertionEffect:Vm,useLayoutEffect:Ym,useMemo:Gm,useReducer:Wc,useRef:$m,useState:function(){return Wc(gi)},useDebugValue:Qc,useDeferredValue:function(t,i){var o=wt();return et===null?Zc(o,t,i):Xm(o,et.memoizedState,t,i)},useTransition:function(){var t=Wc(gi)[0],i=wt().memoizedState;return[typeof t=="boolean"?t:eo(t),i]},useSyncExternalStore:_m,useId:ep,useHostTransitionStatus:tu,useFormState:Um,useActionState:Um,useOptimistic:function(t,i){var o=wt();return et!==null?km(o,et,t,i):(o.baseState=t,[t,o.queue.dispatch])},useMemoCache:Kc,useCacheRefresh:tp};op.useEffectEvent=zm;function au(t,i,o,l){i=t.memoizedState,o=o(l,i),o=o==null?i:b({},i,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var su={enqueueSetState:function(t,i,o){t=t._reactInternals;var l=_n(),d=$i(l);d.payload=i,o!=null&&(d.callback=o),i=qi(t,d,l),i!==null&&(hn(i,t,l),Xs(i,t,l))},enqueueReplaceState:function(t,i,o){t=t._reactInternals;var l=_n(),d=$i(l);d.tag=1,d.payload=i,o!=null&&(d.callback=o),i=qi(t,d,l),i!==null&&(hn(i,t,l),Xs(i,t,l))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var o=_n(),l=$i(o);l.tag=2,i!=null&&(l.callback=i),i=qi(t,l,o),i!==null&&(hn(i,t,o),Xs(i,t,o))}};function rp(t,i,o,l,d,h,x){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,h,x):i.prototype&&i.prototype.isPureReactComponent?!qs(o,l)||!qs(d,h):!0}function lp(t,i,o,l){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(o,l),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(o,l),i.state!==t&&su.enqueueReplaceState(i,i.state,null)}function Oa(t,i){var o=i;if("ref"in i){o={};for(var l in i)l!=="ref"&&(o[l]=i[l])}if(t=t.defaultProps){o===i&&(o=b({},o));for(var d in t)o[d]===void 0&&(o[d]=t[d])}return o}function cp(t){Zo(t)}function up(t){console.error(t)}function dp(t){Zo(t)}function Ar(t,i){try{var o=t.onUncaughtError;o(i.value,{componentStack:i.stack})}catch(l){setTimeout(function(){throw l})}}function fp(t,i,o){try{var l=t.onCaughtError;l(o.value,{componentStack:o.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function ou(t,i,o){return o=$i(o),o.tag=3,o.payload={element:null},o.callback=function(){Ar(t,i)},o}function mp(t){return t=$i(t),t.tag=3,t}function pp(t,i,o,l){var d=o.type.getDerivedStateFromError;if(typeof d=="function"){var h=l.value;t.payload=function(){return d(h)},t.callback=function(){fp(i,o,l)}}var x=o.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(t.callback=function(){fp(i,o,l),typeof d!="function"&&(Wi===null?Wi=new Set([this]):Wi.add(this));var O=l.stack;this.componentDidCatch(l.value,{componentStack:O!==null?O:""})})}function sv(t,i,o,l,d){if(o.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(i=o.alternate,i!==null&&ss(i,o,d,!0),o=xn.current,o!==null){switch(o.tag){case 31:case 13:return Ln===null?Lr():o.alternate===null&&Tt===0&&(Tt=3),o.flags&=-257,o.flags|=65536,o.lanes=d,l===cr?o.flags|=16384:(i=o.updateQueue,i===null?o.updateQueue=new Set([l]):i.add(l),ku(t,l,d)),!1;case 22:return o.flags|=65536,l===cr?o.flags|=16384:(i=o.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([l])},o.updateQueue=i):(o=i.retryQueue,o===null?i.retryQueue=new Set([l]):o.add(l)),ku(t,l,d)),!1}throw Error(s(435,o.tag))}return ku(t,l,d),Lr(),!1}if(Ue)return i=xn.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=d,l!==_c&&(t=Error(s(422),{cause:l}),Ys(Nn(t,o)))):(l!==_c&&(i=Error(s(423),{cause:l}),Ys(Nn(i,o))),t=t.current.alternate,t.flags|=65536,d&=-d,t.lanes|=d,l=Nn(l,o),d=ou(t.stateNode,l,d),Hc(t,d),Tt!==4&&(Tt=2)),!1;var h=Error(s(520),{cause:l});if(h=Nn(h,o),uo===null?uo=[h]:uo.push(h),Tt!==4&&(Tt=2),i===null)return!0;l=Nn(l,o),o=i;do{switch(o.tag){case 3:return o.flags|=65536,t=d&-d,o.lanes|=t,t=ou(o.stateNode,l,t),Hc(o,t),!1;case 1:if(i=o.type,h=o.stateNode,(o.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||h!==null&&typeof h.componentDidCatch=="function"&&(Wi===null||!Wi.has(h))))return o.flags|=65536,d&=-d,o.lanes|=d,d=mp(d),pp(d,t,o,l),Hc(o,d),!1}o=o.return}while(o!==null);return!1}var ru=Error(s(461)),Rt=!1;function Jt(t,i,o,l){i.child=t===null?bm(i,null,o,l):wa(i,t.child,o,l)}function hp(t,i,o,l,d){o=o.render;var h=i.ref;if("ref"in l){var x={};for(var O in l)O!=="ref"&&(x[O]=l[O])}else x=l;return Aa(i),l=qc(t,i,o,x,h,d),O=zc(),t!==null&&!Rt?(Vc(t,i,d),bi(t,i,d)):(Ue&&O&&Tc(i),i.flags|=1,Jt(t,i,l,d),i.child)}function yp(t,i,o,l,d){if(t===null){var h=o.type;return typeof h=="function"&&!Sc(h)&&h.defaultProps===void 0&&o.compare===null?(i.tag=15,i.type=h,gp(t,i,h,l,d)):(t=ir(o.type,null,l,i,i.mode,d),t.ref=i.ref,t.return=i,i.child=t)}if(h=t.child,!hu(t,d)){var x=h.memoizedProps;if(o=o.compare,o=o!==null?o:qs,o(x,l)&&t.ref===i.ref)return bi(t,i,d)}return i.flags|=1,t=fi(h,l),t.ref=i.ref,t.return=i,i.child=t}function gp(t,i,o,l,d){if(t!==null){var h=t.memoizedProps;if(qs(h,l)&&t.ref===i.ref)if(Rt=!1,i.pendingProps=l=h,hu(t,d))(t.flags&131072)!==0&&(Rt=!0);else return i.lanes=t.lanes,bi(t,i,d)}return lu(t,i,o,l,d)}function bp(t,i,o,l){var d=l.children,h=t!==null?t.memoizedState:null;if(t===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((i.flags&128)!==0){if(h=h!==null?h.baseLanes|o:o,t!==null){for(l=i.child=t.child,d=0;l!==null;)d=d|l.lanes|l.childLanes,l=l.sibling;l=d&~h}else l=0,i.child=null;return vp(t,i,h,o,l)}if((o&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},t!==null&&rr(i,h!==null?h.cachePool:null),h!==null?xm(i,h):jc(),Am(i);else return l=i.lanes=536870912,vp(t,i,h!==null?h.baseLanes|o:o,o,l)}else h!==null?(rr(i,h.cachePool),xm(i,h),Vi(),i.memoizedState=null):(t!==null&&rr(i,null),jc(),Vi());return Jt(t,i,d,o),i.child}function io(t,i){return t!==null&&t.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function vp(t,i,o,l,d){var h=Rc();return h=h===null?null:{parent:Nt._currentValue,pool:h},i.memoizedState={baseLanes:o,cachePool:h},t!==null&&rr(i,null),jc(),Am(i),t!==null&&ss(t,i,l,!0),i.childLanes=d,null}function Tr(t,i){return i=_r({mode:i.mode,children:i.children},t.mode),i.ref=t.ref,t.child=i,i.return=t,i}function Sp(t,i,o){return wa(i,t.child,null,o),t=Tr(i,i.pendingProps),t.flags|=2,An(i),i.memoizedState=null,t}function ov(t,i,o){var l=i.pendingProps,d=(i.flags&128)!==0;if(i.flags&=-129,t===null){if(Ue){if(l.mode==="hidden")return t=Tr(i,l),i.lanes=536870912,io(null,t);if(Uc(i),(t=ct)?(t=Rh(t,In),t=t!==null&&t.data==="&"?t:null,t!==null&&(i.memoizedState={dehydrated:t,treeContext:Hi!==null?{id:ei,overflow:ti}:null,retryLane:536870912,hydrationErrors:null},o=im(t),o.return=i,i.child=o,Gt=i,ct=null)):t=null,t===null)throw ji(i);return i.lanes=536870912,null}return Tr(i,l)}var h=t.memoizedState;if(h!==null){var x=h.dehydrated;if(Uc(i),d)if(i.flags&256)i.flags&=-257,i=Sp(t,i,o);else if(i.memoizedState!==null)i.child=t.child,i.flags|=128,i=null;else throw Error(s(558));else if(Rt||ss(t,i,o,!1),d=(o&t.childLanes)!==0,Rt||d){if(l=st,l!==null&&(x=Zn(l,o),x!==0&&x!==h.retryLane))throw h.retryLane=x,ba(t,x),hn(l,t,x),ru;Lr(),i=Sp(t,i,o)}else t=h.treeContext,ct=Bn(x.nextSibling),Gt=i,Ue=!0,Pi=null,In=!1,t!==null&&om(i,t),i=Tr(i,l),i.flags|=4096;return i}return t=fi(t.child,{mode:l.mode,children:l.children}),t.ref=i.ref,i.child=t,t.return=i,t}function Er(t,i){var o=i.ref;if(o===null)t!==null&&t.ref!==null&&(i.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(s(284));(t===null||t.ref!==o)&&(i.flags|=4194816)}}function lu(t,i,o,l,d){return Aa(i),o=qc(t,i,o,l,void 0,d),l=zc(),t!==null&&!Rt?(Vc(t,i,d),bi(t,i,d)):(Ue&&l&&Tc(i),i.flags|=1,Jt(t,i,o,d),i.child)}function xp(t,i,o,l,d,h){return Aa(i),i.updateQueue=null,o=Em(i,l,o,d),Tm(t),l=zc(),t!==null&&!Rt?(Vc(t,i,h),bi(t,i,h)):(Ue&&l&&Tc(i),i.flags|=1,Jt(t,i,o,h),i.child)}function Ap(t,i,o,l,d){if(Aa(i),i.stateNode===null){var h=ts,x=o.contextType;typeof x=="object"&&x!==null&&(h=Xt(x)),h=new o(l,h),i.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=su,i.stateNode=h,h._reactInternals=i,h=i.stateNode,h.props=l,h.state=i.memoizedState,h.refs={},Lc(i),x=o.contextType,h.context=typeof x=="object"&&x!==null?Xt(x):ts,h.state=i.memoizedState,x=o.getDerivedStateFromProps,typeof x=="function"&&(au(i,o,x,l),h.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof h.getSnapshotBeforeUpdate=="function"||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(x=h.state,typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),x!==h.state&&su.enqueueReplaceState(h,h.state,null),Qs(i,l,h,d),Js(),h.state=i.memoizedState),typeof h.componentDidMount=="function"&&(i.flags|=4194308),l=!0}else if(t===null){h=i.stateNode;var O=i.memoizedProps,B=Oa(o,O);h.props=B;var Y=h.context,ie=o.contextType;x=ts,typeof ie=="object"&&ie!==null&&(x=Xt(ie));var oe=o.getDerivedStateFromProps;ie=typeof oe=="function"||typeof h.getSnapshotBeforeUpdate=="function",O=i.pendingProps!==O,ie||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(O||Y!==x)&&lp(i,h,l,x),Ui=!1;var F=i.memoizedState;h.state=F,Qs(i,l,h,d),Js(),Y=i.memoizedState,O||F!==Y||Ui?(typeof oe=="function"&&(au(i,o,oe,l),Y=i.memoizedState),(B=Ui||rp(i,o,B,l,F,Y,x))?(ie||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(i.flags|=4194308)):(typeof h.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=l,i.memoizedState=Y),h.props=l,h.state=Y,h.context=x,l=B):(typeof h.componentDidMount=="function"&&(i.flags|=4194308),l=!1)}else{h=i.stateNode,Bc(t,i),x=i.memoizedProps,ie=Oa(o,x),h.props=ie,oe=i.pendingProps,F=h.context,Y=o.contextType,B=ts,typeof Y=="object"&&Y!==null&&(B=Xt(Y)),O=o.getDerivedStateFromProps,(Y=typeof O=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(x!==oe||F!==B)&&lp(i,h,l,B),Ui=!1,F=i.memoizedState,h.state=F,Qs(i,l,h,d),Js();var Z=i.memoizedState;x!==oe||F!==Z||Ui||t!==null&&t.dependencies!==null&&sr(t.dependencies)?(typeof O=="function"&&(au(i,o,O,l),Z=i.memoizedState),(ie=Ui||rp(i,o,ie,l,F,Z,B)||t!==null&&t.dependencies!==null&&sr(t.dependencies))?(Y||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(l,Z,B),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(l,Z,B)),typeof h.componentDidUpdate=="function"&&(i.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof h.componentDidUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(i.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(i.flags|=1024),i.memoizedProps=l,i.memoizedState=Z),h.props=l,h.state=Z,h.context=B,l=ie):(typeof h.componentDidUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(i.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(i.flags|=1024),l=!1)}return h=l,Er(t,i),l=(i.flags&128)!==0,h||l?(h=i.stateNode,o=l&&typeof o.getDerivedStateFromError!="function"?null:h.render(),i.flags|=1,t!==null&&l?(i.child=wa(i,t.child,null,d),i.child=wa(i,null,o,d)):Jt(t,i,o,d),i.memoizedState=h.state,t=i.child):t=bi(t,i,d),t}function Tp(t,i,o,l){return Sa(),i.flags|=256,Jt(t,i,o,l),i.child}var cu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function uu(t){return{baseLanes:t,cachePool:fm()}}function du(t,i,o){return t=t!==null?t.childLanes&~o:0,i&&(t|=En),t}function Ep(t,i,o){var l=i.pendingProps,d=!1,h=(i.flags&128)!==0,x;if((x=h)||(x=t!==null&&t.memoizedState===null?!1:(_t.current&2)!==0),x&&(d=!0,i.flags&=-129),x=(i.flags&32)!==0,i.flags&=-33,t===null){if(Ue){if(d?zi(i):Vi(),(t=ct)?(t=Rh(t,In),t=t!==null&&t.data!=="&"?t:null,t!==null&&(i.memoizedState={dehydrated:t,treeContext:Hi!==null?{id:ei,overflow:ti}:null,retryLane:536870912,hydrationErrors:null},o=im(t),o.return=i,i.child=o,Gt=i,ct=null)):t=null,t===null)throw ji(i);return Fu(t)?i.lanes=32:i.lanes=536870912,null}var O=l.children;return l=l.fallback,d?(Vi(),d=i.mode,O=_r({mode:"hidden",children:O},d),l=va(l,d,o,null),O.return=i,l.return=i,O.sibling=l,i.child=O,l=i.child,l.memoizedState=uu(o),l.childLanes=du(t,x,o),i.memoizedState=cu,io(null,l)):(zi(i),fu(i,O))}var B=t.memoizedState;if(B!==null&&(O=B.dehydrated,O!==null)){if(h)i.flags&256?(zi(i),i.flags&=-257,i=mu(t,i,o)):i.memoizedState!==null?(Vi(),i.child=t.child,i.flags|=128,i=null):(Vi(),O=l.fallback,d=i.mode,l=_r({mode:"visible",children:l.children},d),O=va(O,d,o,null),O.flags|=2,l.return=i,O.return=i,l.sibling=O,i.child=l,wa(i,t.child,null,o),l=i.child,l.memoizedState=uu(o),l.childLanes=du(t,x,o),i.memoizedState=cu,i=io(null,l));else if(zi(i),Fu(O)){if(x=O.nextSibling&&O.nextSibling.dataset,x)var Y=x.dgst;x=Y,l=Error(s(419)),l.stack="",l.digest=x,Ys({value:l,source:null,stack:null}),i=mu(t,i,o)}else if(Rt||ss(t,i,o,!1),x=(o&t.childLanes)!==0,Rt||x){if(x=st,x!==null&&(l=Zn(x,o),l!==0&&l!==B.retryLane))throw B.retryLane=l,ba(t,l),hn(x,t,l),ru;Ku(O)||Lr(),i=mu(t,i,o)}else Ku(O)?(i.flags|=192,i.child=t.child,i=null):(t=B.treeContext,ct=Bn(O.nextSibling),Gt=i,Ue=!0,Pi=null,In=!1,t!==null&&om(i,t),i=fu(i,l.children),i.flags|=4096);return i}return d?(Vi(),O=l.fallback,d=i.mode,B=t.child,Y=B.sibling,l=fi(B,{mode:"hidden",children:l.children}),l.subtreeFlags=B.subtreeFlags&65011712,Y!==null?O=fi(Y,O):(O=va(O,d,o,null),O.flags|=2),O.return=i,l.return=i,l.sibling=O,i.child=l,io(null,l),l=i.child,O=t.child.memoizedState,O===null?O=uu(o):(d=O.cachePool,d!==null?(B=Nt._currentValue,d=d.parent!==B?{parent:B,pool:B}:d):d=fm(),O={baseLanes:O.baseLanes|o,cachePool:d}),l.memoizedState=O,l.childLanes=du(t,x,o),i.memoizedState=cu,io(t.child,l)):(zi(i),o=t.child,t=o.sibling,o=fi(o,{mode:"visible",children:l.children}),o.return=i,o.sibling=null,t!==null&&(x=i.deletions,x===null?(i.deletions=[t],i.flags|=16):x.push(t)),i.child=o,i.memoizedState=null,o)}function fu(t,i){return i=_r({mode:"visible",children:i},t.mode),i.return=t,t.child=i}function _r(t,i){return t=Sn(22,t,null,i),t.lanes=0,t}function mu(t,i,o){return wa(i,t.child,null,o),t=fu(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function _p(t,i,o){t.lanes|=i;var l=t.alternate;l!==null&&(l.lanes|=i),Oc(t.return,i,o)}function pu(t,i,o,l,d,h){var x=t.memoizedState;x===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:l,tail:o,tailMode:d,treeForkCount:h}:(x.isBackwards=i,x.rendering=null,x.renderingStartTime=0,x.last=l,x.tail=o,x.tailMode=d,x.treeForkCount=h)}function wp(t,i,o){var l=i.pendingProps,d=l.revealOrder,h=l.tail;l=l.children;var x=_t.current,O=(x&2)!==0;if(O?(x=x&1|2,i.flags|=128):x&=1,G(_t,x),Jt(t,i,l,o),l=Ue?Vs:0,!O&&t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&_p(t,o,i);else if(t.tag===19)_p(t,o,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(d){case"forwards":for(o=i.child,d=null;o!==null;)t=o.alternate,t!==null&&mr(t)===null&&(d=o),o=o.sibling;o=d,o===null?(d=i.child,i.child=null):(d=o.sibling,o.sibling=null),pu(i,!1,d,o,h,l);break;case"backwards":case"unstable_legacy-backwards":for(o=null,d=i.child,i.child=null;d!==null;){if(t=d.alternate,t!==null&&mr(t)===null){i.child=d;break}t=d.sibling,d.sibling=o,o=d,d=t}pu(i,!0,o,null,h,l);break;case"together":pu(i,!1,null,null,void 0,l);break;default:i.memoizedState=null}return i.child}function bi(t,i,o){if(t!==null&&(i.dependencies=t.dependencies),Fi|=i.lanes,(o&i.childLanes)===0)if(t!==null){if(ss(t,i,o,!1),(o&i.childLanes)===0)return null}else return null;if(t!==null&&i.child!==t.child)throw Error(s(153));if(i.child!==null){for(t=i.child,o=fi(t,t.pendingProps),i.child=o,o.return=i;t.sibling!==null;)t=t.sibling,o=o.sibling=fi(t,t.pendingProps),o.return=i;o.sibling=null}return i.child}function hu(t,i){return(t.lanes&i)!==0?!0:(t=t.dependencies,!!(t!==null&&sr(t)))}function rv(t,i,o){switch(i.tag){case 3:ke(i,i.stateNode.containerInfo),Di(i,Nt,t.memoizedState.cache),Sa();break;case 27:case 5:_e(i);break;case 4:ke(i,i.stateNode.containerInfo);break;case 10:Di(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,Uc(i),null;break;case 13:var l=i.memoizedState;if(l!==null)return l.dehydrated!==null?(zi(i),i.flags|=128,null):(o&i.child.childLanes)!==0?Ep(t,i,o):(zi(i),t=bi(t,i,o),t!==null?t.sibling:null);zi(i);break;case 19:var d=(t.flags&128)!==0;if(l=(o&i.childLanes)!==0,l||(ss(t,i,o,!1),l=(o&i.childLanes)!==0),d){if(l)return wp(t,i,o);i.flags|=128}if(d=i.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),G(_t,_t.current),l)break;return null;case 22:return i.lanes=0,bp(t,i,o,i.pendingProps);case 24:Di(i,Nt,t.memoizedState.cache)}return bi(t,i,o)}function Mp(t,i,o){if(t!==null)if(t.memoizedProps!==i.pendingProps)Rt=!0;else{if(!hu(t,o)&&(i.flags&128)===0)return Rt=!1,rv(t,i,o);Rt=(t.flags&131072)!==0}else Rt=!1,Ue&&(i.flags&1048576)!==0&&sm(i,Vs,i.index);switch(i.lanes=0,i.tag){case 16:e:{var l=i.pendingProps;if(t=Ea(i.elementType),i.type=t,typeof t=="function")Sc(t)?(l=Oa(t,l),i.tag=1,i=Ap(null,i,t,l,o)):(i.tag=0,i=lu(null,i,t,l,o));else{if(t!=null){var d=t.$$typeof;if(d===C){i.tag=11,i=hp(null,i,t,l,o);break e}else if(d===R){i.tag=14,i=yp(null,i,t,l,o);break e}}throw i=W(t)||t,Error(s(306,i,""))}}return i;case 0:return lu(t,i,i.type,i.pendingProps,o);case 1:return l=i.type,d=Oa(l,i.pendingProps),Ap(t,i,l,d,o);case 3:e:{if(ke(i,i.stateNode.containerInfo),t===null)throw Error(s(387));l=i.pendingProps;var h=i.memoizedState;d=h.element,Bc(t,i),Qs(i,l,null,o);var x=i.memoizedState;if(l=x.cache,Di(i,Nt,l),l!==h.cache&&Cc(i,[Nt],o,!0),Js(),l=x.element,h.isDehydrated)if(h={element:l,isDehydrated:!1,cache:x.cache},i.updateQueue.baseState=h,i.memoizedState=h,i.flags&256){i=Tp(t,i,l,o);break e}else if(l!==d){d=Nn(Error(s(424)),i),Ys(d),i=Tp(t,i,l,o);break e}else for(t=i.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,ct=Bn(t.firstChild),Gt=i,Ue=!0,Pi=null,In=!0,o=bm(i,null,l,o),i.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Sa(),l===d){i=bi(t,i,o);break e}Jt(t,i,l,o)}i=i.child}return i;case 26:return Er(t,i),t===null?(o=jh(i.type,null,i.pendingProps,null))?i.memoizedState=o:Ue||(o=i.type,t=i.pendingProps,l=$r(ce.current).createElement(o),l[Wt]=i,l[cn]=t,Qt(l,o,t),zt(l),i.stateNode=l):i.memoizedState=jh(i.type,t.memoizedProps,i.pendingProps,t.memoizedState),null;case 27:return _e(i),t===null&&Ue&&(l=i.stateNode=Bh(i.type,i.pendingProps,ce.current),Gt=i,In=!0,d=ct,Qi(i.type)?(Wu=d,ct=Bn(l.firstChild)):ct=d),Jt(t,i,i.pendingProps.children,o),Er(t,i),t===null&&(i.flags|=4194304),i.child;case 5:return t===null&&Ue&&((d=l=ct)&&(l=Pv(l,i.type,i.pendingProps,In),l!==null?(i.stateNode=l,Gt=i,ct=Bn(l.firstChild),In=!1,d=!0):d=!1),d||ji(i)),_e(i),d=i.type,h=i.pendingProps,x=t!==null?t.memoizedProps:null,l=h.children,zu(d,h)?l=null:x!==null&&zu(d,x)&&(i.flags|=32),i.memoizedState!==null&&(d=qc(t,i,Qb,null,null,o),vo._currentValue=d),Er(t,i),Jt(t,i,l,o),i.child;case 6:return t===null&&Ue&&((t=o=ct)&&(o=jv(o,i.pendingProps,In),o!==null?(i.stateNode=o,Gt=i,ct=null,t=!0):t=!1),t||ji(i)),null;case 13:return Ep(t,i,o);case 4:return ke(i,i.stateNode.containerInfo),l=i.pendingProps,t===null?i.child=wa(i,null,l,o):Jt(t,i,l,o),i.child;case 11:return hp(t,i,i.type,i.pendingProps,o);case 7:return Jt(t,i,i.pendingProps,o),i.child;case 8:return Jt(t,i,i.pendingProps.children,o),i.child;case 12:return Jt(t,i,i.pendingProps.children,o),i.child;case 10:return l=i.pendingProps,Di(i,i.type,l.value),Jt(t,i,l.children,o),i.child;case 9:return d=i.type._context,l=i.pendingProps.children,Aa(i),d=Xt(d),l=l(d),i.flags|=1,Jt(t,i,l,o),i.child;case 14:return yp(t,i,i.type,i.pendingProps,o);case 15:return gp(t,i,i.type,i.pendingProps,o);case 19:return wp(t,i,o);case 31:return ov(t,i,o);case 22:return bp(t,i,o,i.pendingProps);case 24:return Aa(i),l=Xt(Nt),t===null?(d=Rc(),d===null&&(d=st,h=Nc(),d.pooledCache=h,h.refCount++,h!==null&&(d.pooledCacheLanes|=o),d=h),i.memoizedState={parent:l,cache:d},Lc(i),Di(i,Nt,d)):((t.lanes&o)!==0&&(Bc(t,i),Qs(i,null,null,o),Js()),d=t.memoizedState,h=i.memoizedState,d.parent!==l?(d={parent:l,cache:l},i.memoizedState=d,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=d),Di(i,Nt,l)):(l=h.cache,Di(i,Nt,l),l!==d.cache&&Cc(i,[Nt],o,!0))),Jt(t,i,i.pendingProps.children,o),i.child;case 29:throw i.pendingProps}throw Error(s(156,i.tag))}function vi(t){t.flags|=4}function yu(t,i,o,l,d){if((i=(t.mode&32)!==0)&&(i=!1),i){if(t.flags|=16777216,(d&335544128)===d)if(t.stateNode.complete)t.flags|=8192;else if(eh())t.flags|=8192;else throw _a=cr,Ic}else t.flags&=-16777217}function Op(t,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!zh(i))if(eh())t.flags|=8192;else throw _a=cr,Ic}function wr(t,i){i!==null&&(t.flags|=4),t.flags&16384&&(i=t.tag!==22?li():536870912,t.lanes|=i,gs|=i)}function ao(t,i){if(!Ue)switch(t.tailMode){case"hidden":i=t.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function ut(t){var i=t.alternate!==null&&t.alternate.child===t.child,o=0,l=0;if(i)for(var d=t.child;d!==null;)o|=d.lanes|d.childLanes,l|=d.subtreeFlags&65011712,l|=d.flags&65011712,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)o|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=l,t.childLanes=o,i}function lv(t,i,o){var l=i.pendingProps;switch(Ec(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ut(i),null;case 1:return ut(i),null;case 3:return o=i.stateNode,l=null,t!==null&&(l=t.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),hi(Nt),Se(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(t===null||t.child===null)&&(as(i)?vi(i):t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,wc())),ut(i),null;case 26:var d=i.type,h=i.memoizedState;return t===null?(vi(i),h!==null?(ut(i),Op(i,h)):(ut(i),yu(i,d,null,l,o))):h?h!==t.memoizedState?(vi(i),ut(i),Op(i,h)):(ut(i),i.flags&=-16777217):(t=t.memoizedProps,t!==l&&vi(i),ut(i),yu(i,d,t,l,o)),null;case 27:if(Ce(i),o=ce.current,d=i.type,t!==null&&i.stateNode!=null)t.memoizedProps!==l&&vi(i);else{if(!l){if(i.stateNode===null)throw Error(s(166));return ut(i),null}t=ne.current,as(i)?rm(i):(t=Bh(d,l,o),i.stateNode=t,vi(i))}return ut(i),null;case 5:if(Ce(i),d=i.type,t!==null&&i.stateNode!=null)t.memoizedProps!==l&&vi(i);else{if(!l){if(i.stateNode===null)throw Error(s(166));return ut(i),null}if(h=ne.current,as(i))rm(i);else{var x=$r(ce.current);switch(h){case 1:h=x.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:h=x.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":h=x.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":h=x.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":h=x.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild);break;case"select":h=typeof l.is=="string"?x.createElement("select",{is:l.is}):x.createElement("select"),l.multiple?h.multiple=!0:l.size&&(h.size=l.size);break;default:h=typeof l.is=="string"?x.createElement(d,{is:l.is}):x.createElement(d)}}h[Wt]=i,h[cn]=l;e:for(x=i.child;x!==null;){if(x.tag===5||x.tag===6)h.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===i)break e;for(;x.sibling===null;){if(x.return===null||x.return===i)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}i.stateNode=h;e:switch(Qt(h,d,l),d){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&vi(i)}}return ut(i),yu(i,i.type,t===null?null:t.memoizedProps,i.pendingProps,o),null;case 6:if(t&&i.stateNode!=null)t.memoizedProps!==l&&vi(i);else{if(typeof l!="string"&&i.stateNode===null)throw Error(s(166));if(t=ce.current,as(i)){if(t=i.stateNode,o=i.memoizedProps,l=null,d=Gt,d!==null)switch(d.tag){case 27:case 5:l=d.memoizedProps}t[Wt]=i,t=!!(t.nodeValue===o||l!==null&&l.suppressHydrationWarning===!0||Eh(t.nodeValue,o)),t||ji(i,!0)}else t=$r(t).createTextNode(l),t[Wt]=i,i.stateNode=t}return ut(i),null;case 31:if(o=i.memoizedState,t===null||t.memoizedState!==null){if(l=as(i),o!==null){if(t===null){if(!l)throw Error(s(318));if(t=i.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(s(557));t[Wt]=i}else Sa(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ut(i),t=!1}else o=wc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=o),t=!0;if(!t)return i.flags&256?(An(i),i):(An(i),null);if((i.flags&128)!==0)throw Error(s(558))}return ut(i),null;case 13:if(l=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(d=as(i),l!==null&&l.dehydrated!==null){if(t===null){if(!d)throw Error(s(318));if(d=i.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(s(317));d[Wt]=i}else Sa(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ut(i),d=!1}else d=wc(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=d),d=!0;if(!d)return i.flags&256?(An(i),i):(An(i),null)}return An(i),(i.flags&128)!==0?(i.lanes=o,i):(o=l!==null,t=t!==null&&t.memoizedState!==null,o&&(l=i.child,d=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(d=l.alternate.memoizedState.cachePool.pool),h=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(h=l.memoizedState.cachePool.pool),h!==d&&(l.flags|=2048)),o!==t&&o&&(i.child.flags|=8192),wr(i,i.updateQueue),ut(i),null);case 4:return Se(),t===null&&ju(i.stateNode.containerInfo),ut(i),null;case 10:return hi(i.type),ut(i),null;case 19:if(K(_t),l=i.memoizedState,l===null)return ut(i),null;if(d=(i.flags&128)!==0,h=l.rendering,h===null)if(d)ao(l,!1);else{if(Tt!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(h=mr(t),h!==null){for(i.flags|=128,ao(l,!1),t=h.updateQueue,i.updateQueue=t,wr(i,t),i.subtreeFlags=0,t=o,o=i.child;o!==null;)nm(o,t),o=o.sibling;return G(_t,_t.current&1|2),Ue&&mi(i,l.treeForkCount),i.child}t=t.sibling}l.tail!==null&&qt()>kr&&(i.flags|=128,d=!0,ao(l,!1),i.lanes=4194304)}else{if(!d)if(t=mr(h),t!==null){if(i.flags|=128,d=!0,t=t.updateQueue,i.updateQueue=t,wr(i,t),ao(l,!0),l.tail===null&&l.tailMode==="hidden"&&!h.alternate&&!Ue)return ut(i),null}else 2*qt()-l.renderingStartTime>kr&&o!==536870912&&(i.flags|=128,d=!0,ao(l,!1),i.lanes=4194304);l.isBackwards?(h.sibling=i.child,i.child=h):(t=l.last,t!==null?t.sibling=h:i.child=h,l.last=h)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=qt(),t.sibling=null,o=_t.current,G(_t,d?o&1|2:o&1),Ue&&mi(i,l.treeForkCount),t):(ut(i),null);case 22:case 23:return An(i),Dc(),l=i.memoizedState!==null,t!==null?t.memoizedState!==null!==l&&(i.flags|=8192):l&&(i.flags|=8192),l?(o&536870912)!==0&&(i.flags&128)===0&&(ut(i),i.subtreeFlags&6&&(i.flags|=8192)):ut(i),o=i.updateQueue,o!==null&&wr(i,o.retryQueue),o=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),l=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(l=i.memoizedState.cachePool.pool),l!==o&&(i.flags|=2048),t!==null&&K(Ta),null;case 24:return o=null,t!==null&&(o=t.memoizedState.cache),i.memoizedState.cache!==o&&(i.flags|=2048),hi(Nt),ut(i),null;case 25:return null;case 30:return null}throw Error(s(156,i.tag))}function cv(t,i){switch(Ec(i),i.tag){case 1:return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return hi(Nt),Se(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 26:case 27:case 5:return Ce(i),null;case 31:if(i.memoizedState!==null){if(An(i),i.alternate===null)throw Error(s(340));Sa()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 13:if(An(i),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(s(340));Sa()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return K(_t),null;case 4:return Se(),null;case 10:return hi(i.type),null;case 22:case 23:return An(i),Dc(),t!==null&&K(Ta),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 24:return hi(Nt),null;case 25:return null;default:return null}}function Cp(t,i){switch(Ec(i),i.tag){case 3:hi(Nt),Se();break;case 26:case 27:case 5:Ce(i);break;case 4:Se();break;case 31:i.memoizedState!==null&&An(i);break;case 13:An(i);break;case 19:K(_t);break;case 10:hi(i.type);break;case 22:case 23:An(i),Dc(),t!==null&&K(Ta);break;case 24:hi(Nt)}}function so(t,i){try{var o=i.updateQueue,l=o!==null?o.lastEffect:null;if(l!==null){var d=l.next;o=d;do{if((o.tag&t)===t){l=void 0;var h=o.create,x=o.inst;l=h(),x.destroy=l}o=o.next}while(o!==d)}}catch(O){Je(i,i.return,O)}}function Yi(t,i,o){try{var l=i.updateQueue,d=l!==null?l.lastEffect:null;if(d!==null){var h=d.next;l=h;do{if((l.tag&t)===t){var x=l.inst,O=x.destroy;if(O!==void 0){x.destroy=void 0,d=i;var B=o,Y=O;try{Y()}catch(ie){Je(d,B,ie)}}}l=l.next}while(l!==h)}}catch(ie){Je(i,i.return,ie)}}function Np(t){var i=t.updateQueue;if(i!==null){var o=t.stateNode;try{Sm(i,o)}catch(l){Je(t,t.return,l)}}}function kp(t,i,o){o.props=Oa(t.type,t.memoizedProps),o.state=t.memoizedState;try{o.componentWillUnmount()}catch(l){Je(t,i,l)}}function oo(t,i){try{var o=t.ref;if(o!==null){switch(t.tag){case 26:case 27:case 5:var l=t.stateNode;break;case 30:l=t.stateNode;break;default:l=t.stateNode}typeof o=="function"?t.refCleanup=o(l):o.current=l}}catch(d){Je(t,i,d)}}function ni(t,i){var o=t.ref,l=t.refCleanup;if(o!==null)if(typeof l=="function")try{l()}catch(d){Je(t,i,d)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(d){Je(t,i,d)}else o.current=null}function Rp(t){var i=t.type,o=t.memoizedProps,l=t.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":o.autoFocus&&l.focus();break e;case"img":o.src?l.src=o.src:o.srcSet&&(l.srcset=o.srcSet)}}catch(d){Je(t,t.return,d)}}function gu(t,i,o){try{var l=t.stateNode;kv(l,t.type,o,i),l[cn]=i}catch(d){Je(t,t.return,d)}}function Ip(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Qi(t.type)||t.tag===4}function bu(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Ip(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Qi(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function vu(t,i,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,i?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(t,i):(i=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,i.appendChild(t),o=o._reactRootContainer,o!=null||i.onclick!==null||(i.onclick=ui));else if(l!==4&&(l===27&&Qi(t.type)&&(o=t.stateNode,i=null),t=t.child,t!==null))for(vu(t,i,o),t=t.sibling;t!==null;)vu(t,i,o),t=t.sibling}function Mr(t,i,o){var l=t.tag;if(l===5||l===6)t=t.stateNode,i?o.insertBefore(t,i):o.appendChild(t);else if(l!==4&&(l===27&&Qi(t.type)&&(o=t.stateNode),t=t.child,t!==null))for(Mr(t,i,o),t=t.sibling;t!==null;)Mr(t,i,o),t=t.sibling}function Lp(t){var i=t.stateNode,o=t.memoizedProps;try{for(var l=t.type,d=i.attributes;d.length;)i.removeAttributeNode(d[0]);Qt(i,l,o),i[Wt]=t,i[cn]=o}catch(h){Je(t,t.return,h)}}var Si=!1,It=!1,Su=!1,Bp=typeof WeakSet=="function"?WeakSet:Set,Vt=null;function uv(t,i){if(t=t.containerInfo,$u=Wr,t=Ff(t),mc(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var l=o.getSelection&&o.getSelection();if(l&&l.rangeCount!==0){o=l.anchorNode;var d=l.anchorOffset,h=l.focusNode;l=l.focusOffset;try{o.nodeType,h.nodeType}catch{o=null;break e}var x=0,O=-1,B=-1,Y=0,ie=0,oe=t,F=null;t:for(;;){for(var Z;oe!==o||d!==0&&oe.nodeType!==3||(O=x+d),oe!==h||l!==0&&oe.nodeType!==3||(B=x+l),oe.nodeType===3&&(x+=oe.nodeValue.length),(Z=oe.firstChild)!==null;)F=oe,oe=Z;for(;;){if(oe===t)break t;if(F===o&&++Y===d&&(O=x),F===h&&++ie===l&&(B=x),(Z=oe.nextSibling)!==null)break;oe=F,F=oe.parentNode}oe=Z}o=O===-1||B===-1?null:{start:O,end:B}}else o=null}o=o||{start:0,end:0}}else o=null;for(qu={focusedElem:t,selectionRange:o},Wr=!1,Vt=i;Vt!==null;)if(i=Vt,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,Vt=t;else for(;Vt!==null;){switch(i=Vt,h=i.alternate,t=i.flags,i.tag){case 0:if((t&4)!==0&&(t=i.updateQueue,t=t!==null?t.events:null,t!==null))for(o=0;o<t.length;o++)d=t[o],d.ref.impl=d.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&h!==null){t=void 0,o=i,d=h.memoizedProps,h=h.memoizedState,l=o.stateNode;try{var he=Oa(o.type,d);t=l.getSnapshotBeforeUpdate(he,h),l.__reactInternalSnapshotBeforeUpdate=t}catch(xe){Je(o,o.return,xe)}}break;case 3:if((t&1024)!==0){if(t=i.stateNode.containerInfo,o=t.nodeType,o===9)Yu(t);else if(o===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Yu(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(s(163))}if(t=i.sibling,t!==null){t.return=i.return,Vt=t;break}Vt=i.return}}function Hp(t,i,o){var l=o.flags;switch(o.tag){case 0:case 11:case 15:Ai(t,o),l&4&&so(5,o);break;case 1:if(Ai(t,o),l&4)if(t=o.stateNode,i===null)try{t.componentDidMount()}catch(x){Je(o,o.return,x)}else{var d=Oa(o.type,i.memoizedProps);i=i.memoizedState;try{t.componentDidUpdate(d,i,t.__reactInternalSnapshotBeforeUpdate)}catch(x){Je(o,o.return,x)}}l&64&&Np(o),l&512&&oo(o,o.return);break;case 3:if(Ai(t,o),l&64&&(t=o.updateQueue,t!==null)){if(i=null,o.child!==null)switch(o.child.tag){case 27:case 5:i=o.child.stateNode;break;case 1:i=o.child.stateNode}try{Sm(t,i)}catch(x){Je(o,o.return,x)}}break;case 27:i===null&&l&4&&Lp(o);case 26:case 5:Ai(t,o),i===null&&l&4&&Rp(o),l&512&&oo(o,o.return);break;case 12:Ai(t,o);break;case 31:Ai(t,o),l&4&&Dp(t,o);break;case 13:Ai(t,o),l&4&&Up(t,o),l&64&&(t=o.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(o=vv.bind(null,o),Dv(t,o))));break;case 22:if(l=o.memoizedState!==null||Si,!l){i=i!==null&&i.memoizedState!==null||It,d=Si;var h=It;Si=l,(It=i)&&!h?Ti(t,o,(o.subtreeFlags&8772)!==0):Ai(t,o),Si=d,It=h}break;case 30:break;default:Ai(t,o)}}function Pp(t){var i=t.alternate;i!==null&&(t.alternate=null,Pp(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&Xl(i)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var mt=null,dn=!1;function xi(t,i,o){for(o=o.child;o!==null;)jp(t,i,o),o=o.sibling}function jp(t,i,o){if(De&&typeof De.onCommitFiberUnmount=="function")try{De.onCommitFiberUnmount(ln,o)}catch{}switch(o.tag){case 26:It||ni(o,i),xi(t,i,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:It||ni(o,i);var l=mt,d=dn;Qi(o.type)&&(mt=o.stateNode,dn=!1),xi(t,i,o),yo(o.stateNode),mt=l,dn=d;break;case 5:It||ni(o,i);case 6:if(l=mt,d=dn,mt=null,xi(t,i,o),mt=l,dn=d,mt!==null)if(dn)try{(mt.nodeType===9?mt.body:mt.nodeName==="HTML"?mt.ownerDocument.body:mt).removeChild(o.stateNode)}catch(h){Je(o,i,h)}else try{mt.removeChild(o.stateNode)}catch(h){Je(o,i,h)}break;case 18:mt!==null&&(dn?(t=mt,Nh(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,o.stateNode),_s(t)):Nh(mt,o.stateNode));break;case 4:l=mt,d=dn,mt=o.stateNode.containerInfo,dn=!0,xi(t,i,o),mt=l,dn=d;break;case 0:case 11:case 14:case 15:Yi(2,o,i),It||Yi(4,o,i),xi(t,i,o);break;case 1:It||(ni(o,i),l=o.stateNode,typeof l.componentWillUnmount=="function"&&kp(o,i,l)),xi(t,i,o);break;case 21:xi(t,i,o);break;case 22:It=(l=It)||o.memoizedState!==null,xi(t,i,o),It=l;break;default:xi(t,i,o)}}function Dp(t,i){if(i.memoizedState===null&&(t=i.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{_s(t)}catch(o){Je(i,i.return,o)}}}function Up(t,i){if(i.memoizedState===null&&(t=i.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{_s(t)}catch(o){Je(i,i.return,o)}}function dv(t){switch(t.tag){case 31:case 13:case 19:var i=t.stateNode;return i===null&&(i=t.stateNode=new Bp),i;case 22:return t=t.stateNode,i=t._retryCache,i===null&&(i=t._retryCache=new Bp),i;default:throw Error(s(435,t.tag))}}function Or(t,i){var o=dv(t);i.forEach(function(l){if(!o.has(l)){o.add(l);var d=Sv.bind(null,t,l);l.then(d,d)}})}function fn(t,i){var o=i.deletions;if(o!==null)for(var l=0;l<o.length;l++){var d=o[l],h=t,x=i,O=x;e:for(;O!==null;){switch(O.tag){case 27:if(Qi(O.type)){mt=O.stateNode,dn=!1;break e}break;case 5:mt=O.stateNode,dn=!1;break e;case 3:case 4:mt=O.stateNode.containerInfo,dn=!0;break e}O=O.return}if(mt===null)throw Error(s(160));jp(h,x,d),mt=null,dn=!1,h=d.alternate,h!==null&&(h.return=null),d.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)$p(i,t),i=i.sibling}var $n=null;function $p(t,i){var o=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:fn(i,t),mn(t),l&4&&(Yi(3,t,t.return),so(3,t),Yi(5,t,t.return));break;case 1:fn(i,t),mn(t),l&512&&(It||o===null||ni(o,o.return)),l&64&&Si&&(t=t.updateQueue,t!==null&&(l=t.callbacks,l!==null&&(o=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=o===null?l:o.concat(l))));break;case 26:var d=$n;if(fn(i,t),mn(t),l&512&&(It||o===null||ni(o,o.return)),l&4){var h=o!==null?o.memoizedState:null;if(l=t.memoizedState,o===null)if(l===null)if(t.stateNode===null){e:{l=t.type,o=t.memoizedProps,d=d.ownerDocument||d;t:switch(l){case"title":h=d.getElementsByTagName("title")[0],(!h||h[Is]||h[Wt]||h.namespaceURI==="http://www.w3.org/2000/svg"||h.hasAttribute("itemprop"))&&(h=d.createElement(l),d.head.insertBefore(h,d.querySelector("head > title"))),Qt(h,l,o),h[Wt]=t,zt(h),l=h;break e;case"link":var x=$h("link","href",d).get(l+(o.href||""));if(x){for(var O=0;O<x.length;O++)if(h=x[O],h.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&h.getAttribute("rel")===(o.rel==null?null:o.rel)&&h.getAttribute("title")===(o.title==null?null:o.title)&&h.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){x.splice(O,1);break t}}h=d.createElement(l),Qt(h,l,o),d.head.appendChild(h);break;case"meta":if(x=$h("meta","content",d).get(l+(o.content||""))){for(O=0;O<x.length;O++)if(h=x[O],h.getAttribute("content")===(o.content==null?null:""+o.content)&&h.getAttribute("name")===(o.name==null?null:o.name)&&h.getAttribute("property")===(o.property==null?null:o.property)&&h.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&h.getAttribute("charset")===(o.charSet==null?null:o.charSet)){x.splice(O,1);break t}}h=d.createElement(l),Qt(h,l,o),d.head.appendChild(h);break;default:throw Error(s(468,l))}h[Wt]=t,zt(h),l=h}t.stateNode=l}else qh(d,t.type,t.stateNode);else t.stateNode=Uh(d,l,t.memoizedProps);else h!==l?(h===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):h.count--,l===null?qh(d,t.type,t.stateNode):Uh(d,l,t.memoizedProps)):l===null&&t.stateNode!==null&&gu(t,t.memoizedProps,o.memoizedProps)}break;case 27:fn(i,t),mn(t),l&512&&(It||o===null||ni(o,o.return)),o!==null&&l&4&&gu(t,t.memoizedProps,o.memoizedProps);break;case 5:if(fn(i,t),mn(t),l&512&&(It||o===null||ni(o,o.return)),t.flags&32){d=t.stateNode;try{Wa(d,"")}catch(he){Je(t,t.return,he)}}l&4&&t.stateNode!=null&&(d=t.memoizedProps,gu(t,d,o!==null?o.memoizedProps:d)),l&1024&&(Su=!0);break;case 6:if(fn(i,t),mn(t),l&4){if(t.stateNode===null)throw Error(s(162));l=t.memoizedProps,o=t.stateNode;try{o.nodeValue=l}catch(he){Je(t,t.return,he)}}break;case 3:if(Vr=null,d=$n,$n=qr(i.containerInfo),fn(i,t),$n=d,mn(t),l&4&&o!==null&&o.memoizedState.isDehydrated)try{_s(i.containerInfo)}catch(he){Je(t,t.return,he)}Su&&(Su=!1,qp(t));break;case 4:l=$n,$n=qr(t.stateNode.containerInfo),fn(i,t),mn(t),$n=l;break;case 12:fn(i,t),mn(t);break;case 31:fn(i,t),mn(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Or(t,l)));break;case 13:fn(i,t),mn(t),t.child.flags&8192&&t.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Nr=qt()),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Or(t,l)));break;case 22:d=t.memoizedState!==null;var B=o!==null&&o.memoizedState!==null,Y=Si,ie=It;if(Si=Y||d,It=ie||B,fn(i,t),It=ie,Si=Y,mn(t),l&8192)e:for(i=t.stateNode,i._visibility=d?i._visibility&-2:i._visibility|1,d&&(o===null||B||Si||It||Ca(t)),o=null,i=t;;){if(i.tag===5||i.tag===26){if(o===null){B=o=i;try{if(h=B.stateNode,d)x=h.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{O=B.stateNode;var oe=B.memoizedProps.style,F=oe!=null&&oe.hasOwnProperty("display")?oe.display:null;O.style.display=F==null||typeof F=="boolean"?"":(""+F).trim()}}catch(he){Je(B,B.return,he)}}}else if(i.tag===6){if(o===null){B=i;try{B.stateNode.nodeValue=d?"":B.memoizedProps}catch(he){Je(B,B.return,he)}}}else if(i.tag===18){if(o===null){B=i;try{var Z=B.stateNode;d?kh(Z,!0):kh(B.stateNode,!1)}catch(he){Je(B,B.return,he)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===t)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break e;for(;i.sibling===null;){if(i.return===null||i.return===t)break e;o===i&&(o=null),i=i.return}o===i&&(o=null),i.sibling.return=i.return,i=i.sibling}l&4&&(l=t.updateQueue,l!==null&&(o=l.retryQueue,o!==null&&(l.retryQueue=null,Or(t,o))));break;case 19:fn(i,t),mn(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Or(t,l)));break;case 30:break;case 21:break;default:fn(i,t),mn(t)}}function mn(t){var i=t.flags;if(i&2){try{for(var o,l=t.return;l!==null;){if(Ip(l)){o=l;break}l=l.return}if(o==null)throw Error(s(160));switch(o.tag){case 27:var d=o.stateNode,h=bu(t);Mr(t,h,d);break;case 5:var x=o.stateNode;o.flags&32&&(Wa(x,""),o.flags&=-33);var O=bu(t);Mr(t,O,x);break;case 3:case 4:var B=o.stateNode.containerInfo,Y=bu(t);vu(t,Y,B);break;default:throw Error(s(161))}}catch(ie){Je(t,t.return,ie)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function qp(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var i=t;qp(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),t=t.sibling}}function Ai(t,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Hp(t,i.alternate,i),i=i.sibling}function Ca(t){for(t=t.child;t!==null;){var i=t;switch(i.tag){case 0:case 11:case 14:case 15:Yi(4,i,i.return),Ca(i);break;case 1:ni(i,i.return);var o=i.stateNode;typeof o.componentWillUnmount=="function"&&kp(i,i.return,o),Ca(i);break;case 27:yo(i.stateNode);case 26:case 5:ni(i,i.return),Ca(i);break;case 22:i.memoizedState===null&&Ca(i);break;case 30:Ca(i);break;default:Ca(i)}t=t.sibling}}function Ti(t,i,o){for(o=o&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var l=i.alternate,d=t,h=i,x=h.flags;switch(h.tag){case 0:case 11:case 15:Ti(d,h,o),so(4,h);break;case 1:if(Ti(d,h,o),l=h,d=l.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(Y){Je(l,l.return,Y)}if(l=h,d=l.updateQueue,d!==null){var O=l.stateNode;try{var B=d.shared.hiddenCallbacks;if(B!==null)for(d.shared.hiddenCallbacks=null,d=0;d<B.length;d++)vm(B[d],O)}catch(Y){Je(l,l.return,Y)}}o&&x&64&&Np(h),oo(h,h.return);break;case 27:Lp(h);case 26:case 5:Ti(d,h,o),o&&l===null&&x&4&&Rp(h),oo(h,h.return);break;case 12:Ti(d,h,o);break;case 31:Ti(d,h,o),o&&x&4&&Dp(d,h);break;case 13:Ti(d,h,o),o&&x&4&&Up(d,h);break;case 22:h.memoizedState===null&&Ti(d,h,o),oo(h,h.return);break;case 30:break;default:Ti(d,h,o)}i=i.sibling}}function xu(t,i){var o=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(o=t.memoizedState.cachePool.pool),t=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(t=i.memoizedState.cachePool.pool),t!==o&&(t!=null&&t.refCount++,o!=null&&Ks(o))}function Au(t,i){t=null,i.alternate!==null&&(t=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==t&&(i.refCount++,t!=null&&Ks(t))}function qn(t,i,o,l){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)zp(t,i,o,l),i=i.sibling}function zp(t,i,o,l){var d=i.flags;switch(i.tag){case 0:case 11:case 15:qn(t,i,o,l),d&2048&&so(9,i);break;case 1:qn(t,i,o,l);break;case 3:qn(t,i,o,l),d&2048&&(t=null,i.alternate!==null&&(t=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==t&&(i.refCount++,t!=null&&Ks(t)));break;case 12:if(d&2048){qn(t,i,o,l),t=i.stateNode;try{var h=i.memoizedProps,x=h.id,O=h.onPostCommit;typeof O=="function"&&O(x,i.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(B){Je(i,i.return,B)}}else qn(t,i,o,l);break;case 31:qn(t,i,o,l);break;case 13:qn(t,i,o,l);break;case 23:break;case 22:h=i.stateNode,x=i.alternate,i.memoizedState!==null?h._visibility&2?qn(t,i,o,l):ro(t,i):h._visibility&2?qn(t,i,o,l):(h._visibility|=2,ps(t,i,o,l,(i.subtreeFlags&10256)!==0||!1)),d&2048&&xu(x,i);break;case 24:qn(t,i,o,l),d&2048&&Au(i.alternate,i);break;default:qn(t,i,o,l)}}function ps(t,i,o,l,d){for(d=d&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var h=t,x=i,O=o,B=l,Y=x.flags;switch(x.tag){case 0:case 11:case 15:ps(h,x,O,B,d),so(8,x);break;case 23:break;case 22:var ie=x.stateNode;x.memoizedState!==null?ie._visibility&2?ps(h,x,O,B,d):ro(h,x):(ie._visibility|=2,ps(h,x,O,B,d)),d&&Y&2048&&xu(x.alternate,x);break;case 24:ps(h,x,O,B,d),d&&Y&2048&&Au(x.alternate,x);break;default:ps(h,x,O,B,d)}i=i.sibling}}function ro(t,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var o=t,l=i,d=l.flags;switch(l.tag){case 22:ro(o,l),d&2048&&xu(l.alternate,l);break;case 24:ro(o,l),d&2048&&Au(l.alternate,l);break;default:ro(o,l)}i=i.sibling}}var lo=8192;function hs(t,i,o){if(t.subtreeFlags&lo)for(t=t.child;t!==null;)Vp(t,i,o),t=t.sibling}function Vp(t,i,o){switch(t.tag){case 26:hs(t,i,o),t.flags&lo&&t.memoizedState!==null&&Jv(o,$n,t.memoizedState,t.memoizedProps);break;case 5:hs(t,i,o);break;case 3:case 4:var l=$n;$n=qr(t.stateNode.containerInfo),hs(t,i,o),$n=l;break;case 22:t.memoizedState===null&&(l=t.alternate,l!==null&&l.memoizedState!==null?(l=lo,lo=16777216,hs(t,i,o),lo=l):hs(t,i,o));break;default:hs(t,i,o)}}function Yp(t){var i=t.alternate;if(i!==null&&(t=i.child,t!==null)){i.child=null;do i=t.sibling,t.sibling=null,t=i;while(t!==null)}}function co(t){var i=t.deletions;if((t.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var l=i[o];Vt=l,Fp(l,t)}Yp(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Kp(t),t=t.sibling}function Kp(t){switch(t.tag){case 0:case 11:case 15:co(t),t.flags&2048&&Yi(9,t,t.return);break;case 3:co(t);break;case 12:co(t);break;case 22:var i=t.stateNode;t.memoizedState!==null&&i._visibility&2&&(t.return===null||t.return.tag!==13)?(i._visibility&=-3,Cr(t)):co(t);break;default:co(t)}}function Cr(t){var i=t.deletions;if((t.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var l=i[o];Vt=l,Fp(l,t)}Yp(t)}for(t=t.child;t!==null;){switch(i=t,i.tag){case 0:case 11:case 15:Yi(8,i,i.return),Cr(i);break;case 22:o=i.stateNode,o._visibility&2&&(o._visibility&=-3,Cr(i));break;default:Cr(i)}t=t.sibling}}function Fp(t,i){for(;Vt!==null;){var o=Vt;switch(o.tag){case 0:case 11:case 15:Yi(8,o,i);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var l=o.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Ks(o.memoizedState.cache)}if(l=o.child,l!==null)l.return=o,Vt=l;else e:for(o=t;Vt!==null;){l=Vt;var d=l.sibling,h=l.return;if(Pp(l),l===o){Vt=null;break e}if(d!==null){d.return=h,Vt=d;break e}Vt=h}}}var fv={getCacheForType:function(t){var i=Xt(Nt),o=i.data.get(t);return o===void 0&&(o=t(),i.data.set(t,o)),o},cacheSignal:function(){return Xt(Nt).controller.signal}},mv=typeof WeakMap=="function"?WeakMap:Map,Ke=0,st=null,Le=null,Pe=0,Xe=0,Tn=null,Ki=!1,ys=!1,Tu=!1,Ei=0,Tt=0,Fi=0,Na=0,Eu=0,En=0,gs=0,uo=null,pn=null,_u=!1,Nr=0,Wp=0,kr=1/0,Rr=null,Wi=null,Ut=0,Gi=null,bs=null,_i=0,wu=0,Mu=null,Gp=null,fo=0,Ou=null;function _n(){return(Ke&2)!==0&&Pe!==0?Pe&-Pe:P.T!==null?Lu():Rs()}function Xp(){if(En===0)if((Pe&536870912)===0||Ue){var t=ot;ot<<=1,(ot&3932160)===0&&(ot=262144),En=t}else En=536870912;return t=xn.current,t!==null&&(t.flags|=32),En}function hn(t,i,o){(t===st&&(Xe===2||Xe===9)||t.cancelPendingCommit!==null)&&(vs(t,0),Xi(t,Pe,En,!1)),Dn(t,o),((Ke&2)===0||t!==st)&&(t===st&&((Ke&2)===0&&(Na|=o),Tt===4&&Xi(t,Pe,En,!1)),ii(t))}function Jp(t,i,o){if((Ke&6)!==0)throw Error(s(327));var l=!o&&(i&127)===0&&(i&t.expiredLanes)===0||gn(t,i),d=l?yv(t,i):Nu(t,i,!0),h=l;do{if(d===0){ys&&!l&&Xi(t,i,0,!1);break}else{if(o=t.current.alternate,h&&!pv(o)){d=Nu(t,i,!1),h=!1;continue}if(d===2){if(h=i,t.errorRecoveryDisabledLanes&h)var x=0;else x=t.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){i=x;e:{var O=t;d=uo;var B=O.current.memoizedState.isDehydrated;if(B&&(vs(O,x).flags|=256),x=Nu(O,x,!1),x!==2){if(Tu&&!B){O.errorRecoveryDisabledLanes|=h,Na|=h,d=4;break e}h=pn,pn=d,h!==null&&(pn===null?pn=h:pn.push.apply(pn,h))}d=x}if(h=!1,d!==2)continue}}if(d===1){vs(t,0),Xi(t,i,0,!0);break}e:{switch(l=t,h=d,h){case 0:case 1:throw Error(s(345));case 4:if((i&4194048)!==i)break;case 6:Xi(l,i,En,!Ki);break e;case 2:pn=null;break;case 3:case 5:break;default:throw Error(s(329))}if((i&62914560)===i&&(d=Nr+300-qt(),10<d)){if(Xi(l,i,En,!Ki),xt(l,0,!0)!==0)break e;_i=i,l.timeoutHandle=Oh(Qp.bind(null,l,o,pn,Rr,_u,i,En,Na,gs,Ki,h,"Throttled",-0,0),d);break e}Qp(l,o,pn,Rr,_u,i,En,Na,gs,Ki,h,null,-0,0)}}break}while(!0);ii(t)}function Qp(t,i,o,l,d,h,x,O,B,Y,ie,oe,F,Z){if(t.timeoutHandle=-1,oe=i.subtreeFlags,oe&8192||(oe&16785408)===16785408){oe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ui},Vp(i,h,oe);var he=(h&62914560)===h?Nr-qt():(h&4194048)===h?Wp-qt():0;if(he=Qv(oe,he),he!==null){_i=h,t.cancelPendingCommit=he(oh.bind(null,t,i,h,o,l,d,x,O,B,ie,oe,null,F,Z)),Xi(t,h,x,!Y);return}}oh(t,i,h,o,l,d,x,O,B)}function pv(t){for(var i=t;;){var o=i.tag;if((o===0||o===11||o===15)&&i.flags&16384&&(o=i.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var l=0;l<o.length;l++){var d=o[l],h=d.getSnapshot;d=d.value;try{if(!vn(h(),d))return!1}catch{return!1}}if(o=i.child,i.subtreeFlags&16384&&o!==null)o.return=i,i=o;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Xi(t,i,o,l){i&=~Eu,i&=~Na,t.suspendedLanes|=i,t.pingedLanes&=~i,l&&(t.warmLanes|=i),l=t.expirationTimes;for(var d=i;0<d;){var h=31-at(d),x=1<<h;l[h]=-1,d&=~x}o!==0&&ft(t,o,i)}function Ir(){return(Ke&6)===0?(mo(0),!1):!0}function Cu(){if(Le!==null){if(Xe===0)var t=Le.return;else t=Le,pi=xa=null,Yc(t),cs=null,Ws=0,t=Le;for(;t!==null;)Cp(t.alternate,t),t=t.return;Le=null}}function vs(t,i){var o=t.timeoutHandle;o!==-1&&(t.timeoutHandle=-1,Lv(o)),o=t.cancelPendingCommit,o!==null&&(t.cancelPendingCommit=null,o()),_i=0,Cu(),st=t,Le=o=fi(t.current,null),Pe=i,Xe=0,Tn=null,Ki=!1,ys=gn(t,i),Tu=!1,gs=En=Eu=Na=Fi=Tt=0,pn=uo=null,_u=!1,(i&8)!==0&&(i|=i&32);var l=t.entangledLanes;if(l!==0)for(t=t.entanglements,l&=i;0<l;){var d=31-at(l),h=1<<d;i|=t[d],l&=~h}return Ei=i,er(),o}function Zp(t,i){Me=null,P.H=no,i===ls||i===lr?(i=hm(),Xe=3):i===Ic?(i=hm(),Xe=4):Xe=i===ru?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,Tn=i,Le===null&&(Tt=1,Ar(t,Nn(i,t.current)))}function eh(){var t=xn.current;return t===null?!0:(Pe&4194048)===Pe?Ln===null:(Pe&62914560)===Pe||(Pe&536870912)!==0?t===Ln:!1}function th(){var t=P.H;return P.H=no,t===null?no:t}function nh(){var t=P.A;return P.A=fv,t}function Lr(){Tt=4,Ki||(Pe&4194048)!==Pe&&xn.current!==null||(ys=!0),(Fi&134217727)===0&&(Na&134217727)===0||st===null||Xi(st,Pe,En,!1)}function Nu(t,i,o){var l=Ke;Ke|=2;var d=th(),h=nh();(st!==t||Pe!==i)&&(Rr=null,vs(t,i)),i=!1;var x=Tt;e:do try{if(Xe!==0&&Le!==null){var O=Le,B=Tn;switch(Xe){case 8:Cu(),x=6;break e;case 3:case 2:case 9:case 6:xn.current===null&&(i=!0);var Y=Xe;if(Xe=0,Tn=null,Ss(t,O,B,Y),o&&ys){x=0;break e}break;default:Y=Xe,Xe=0,Tn=null,Ss(t,O,B,Y)}}hv(),x=Tt;break}catch(ie){Zp(t,ie)}while(!0);return i&&t.shellSuspendCounter++,pi=xa=null,Ke=l,P.H=d,P.A=h,Le===null&&(st=null,Pe=0,er()),x}function hv(){for(;Le!==null;)ih(Le)}function yv(t,i){var o=Ke;Ke|=2;var l=th(),d=nh();st!==t||Pe!==i?(Rr=null,kr=qt()+500,vs(t,i)):ys=gn(t,i);e:do try{if(Xe!==0&&Le!==null){i=Le;var h=Tn;t:switch(Xe){case 1:Xe=0,Tn=null,Ss(t,i,h,1);break;case 2:case 9:if(mm(h)){Xe=0,Tn=null,ah(i);break}i=function(){Xe!==2&&Xe!==9||st!==t||(Xe=7),ii(t)},h.then(i,i);break e;case 3:Xe=7;break e;case 4:Xe=5;break e;case 7:mm(h)?(Xe=0,Tn=null,ah(i)):(Xe=0,Tn=null,Ss(t,i,h,7));break;case 5:var x=null;switch(Le.tag){case 26:x=Le.memoizedState;case 5:case 27:var O=Le;if(x?zh(x):O.stateNode.complete){Xe=0,Tn=null;var B=O.sibling;if(B!==null)Le=B;else{var Y=O.return;Y!==null?(Le=Y,Br(Y)):Le=null}break t}}Xe=0,Tn=null,Ss(t,i,h,5);break;case 6:Xe=0,Tn=null,Ss(t,i,h,6);break;case 8:Cu(),Tt=6;break e;default:throw Error(s(462))}}gv();break}catch(ie){Zp(t,ie)}while(!0);return pi=xa=null,P.H=l,P.A=d,Ke=o,Le!==null?0:(st=null,Pe=0,er(),Tt)}function gv(){for(;Le!==null&&!Ii();)ih(Le)}function ih(t){var i=Mp(t.alternate,t,Ei);t.memoizedProps=t.pendingProps,i===null?Br(t):Le=i}function ah(t){var i=t,o=i.alternate;switch(i.tag){case 15:case 0:i=xp(o,i,i.pendingProps,i.type,void 0,Pe);break;case 11:i=xp(o,i,i.pendingProps,i.type.render,i.ref,Pe);break;case 5:Yc(i);default:Cp(o,i),i=Le=nm(i,Ei),i=Mp(o,i,Ei)}t.memoizedProps=t.pendingProps,i===null?Br(t):Le=i}function Ss(t,i,o,l){pi=xa=null,Yc(i),cs=null,Ws=0;var d=i.return;try{if(sv(t,d,i,o,Pe)){Tt=1,Ar(t,Nn(o,t.current)),Le=null;return}}catch(h){if(d!==null)throw Le=d,h;Tt=1,Ar(t,Nn(o,t.current)),Le=null;return}i.flags&32768?(Ue||l===1?t=!0:ys||(Pe&536870912)!==0?t=!1:(Ki=t=!0,(l===2||l===9||l===3||l===6)&&(l=xn.current,l!==null&&l.tag===13&&(l.flags|=16384))),sh(i,t)):Br(i)}function Br(t){var i=t;do{if((i.flags&32768)!==0){sh(i,Ki);return}t=i.return;var o=lv(i.alternate,i,Ei);if(o!==null){Le=o;return}if(i=i.sibling,i!==null){Le=i;return}Le=i=t}while(i!==null);Tt===0&&(Tt=5)}function sh(t,i){do{var o=cv(t.alternate,t);if(o!==null){o.flags&=32767,Le=o;return}if(o=t.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!i&&(t=t.sibling,t!==null)){Le=t;return}Le=t=o}while(t!==null);Tt=6,Le=null}function oh(t,i,o,l,d,h,x,O,B){t.cancelPendingCommit=null;do Hr();while(Ut!==0);if((Ke&6)!==0)throw Error(s(327));if(i!==null){if(i===t.current)throw Error(s(177));if(h=i.lanes|i.childLanes,h|=bc,Ct(t,o,h,x,O,B),t===st&&(Le=st=null,Pe=0),bs=i,Gi=t,_i=o,wu=h,Mu=d,Gp=l,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,xv(Ft,function(){return dh(),null})):(t.callbackNode=null,t.callbackPriority=0),l=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||l){l=P.T,P.T=null,d=z.p,z.p=2,x=Ke,Ke|=4;try{uv(t,i,o)}finally{Ke=x,z.p=d,P.T=l}}Ut=1,rh(),lh(),ch()}}function rh(){if(Ut===1){Ut=0;var t=Gi,i=bs,o=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||o){o=P.T,P.T=null;var l=z.p;z.p=2;var d=Ke;Ke|=4;try{$p(i,t);var h=qu,x=Ff(t.containerInfo),O=h.focusedElem,B=h.selectionRange;if(x!==O&&O&&O.ownerDocument&&Kf(O.ownerDocument.documentElement,O)){if(B!==null&&mc(O)){var Y=B.start,ie=B.end;if(ie===void 0&&(ie=Y),"selectionStart"in O)O.selectionStart=Y,O.selectionEnd=Math.min(ie,O.value.length);else{var oe=O.ownerDocument||document,F=oe&&oe.defaultView||window;if(F.getSelection){var Z=F.getSelection(),he=O.textContent.length,xe=Math.min(B.start,he),nt=B.end===void 0?xe:Math.min(B.end,he);!Z.extend&&xe>nt&&(x=nt,nt=xe,xe=x);var U=Yf(O,xe),j=Yf(O,nt);if(U&&j&&(Z.rangeCount!==1||Z.anchorNode!==U.node||Z.anchorOffset!==U.offset||Z.focusNode!==j.node||Z.focusOffset!==j.offset)){var V=oe.createRange();V.setStart(U.node,U.offset),Z.removeAllRanges(),xe>nt?(Z.addRange(V),Z.extend(j.node,j.offset)):(V.setEnd(j.node,j.offset),Z.addRange(V))}}}}for(oe=[],Z=O;Z=Z.parentNode;)Z.nodeType===1&&oe.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<oe.length;O++){var se=oe[O];se.element.scrollLeft=se.left,se.element.scrollTop=se.top}}Wr=!!$u,qu=$u=null}finally{Ke=d,z.p=l,P.T=o}}t.current=i,Ut=2}}function lh(){if(Ut===2){Ut=0;var t=Gi,i=bs,o=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||o){o=P.T,P.T=null;var l=z.p;z.p=2;var d=Ke;Ke|=4;try{Hp(t,i.alternate,i)}finally{Ke=d,z.p=l,P.T=o}}Ut=3}}function ch(){if(Ut===4||Ut===3){Ut=0,ri();var t=Gi,i=bs,o=_i,l=Gp;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?Ut=5:(Ut=0,bs=Gi=null,uh(t,t.pendingLanes));var d=t.pendingLanes;if(d===0&&(Wi=null),$a(o),i=i.stateNode,De&&typeof De.onCommitFiberRoot=="function")try{De.onCommitFiberRoot(ln,i,void 0,(i.current.flags&128)===128)}catch{}if(l!==null){i=P.T,d=z.p,z.p=2,P.T=null;try{for(var h=t.onRecoverableError,x=0;x<l.length;x++){var O=l[x];h(O.value,{componentStack:O.stack})}}finally{P.T=i,z.p=d}}(_i&3)!==0&&Hr(),ii(t),d=t.pendingLanes,(o&261930)!==0&&(d&42)!==0?t===Ou?fo++:(fo=0,Ou=t):fo=0,mo(0)}}function uh(t,i){(t.pooledCacheLanes&=i)===0&&(i=t.pooledCache,i!=null&&(t.pooledCache=null,Ks(i)))}function Hr(){return rh(),lh(),ch(),dh()}function dh(){if(Ut!==5)return!1;var t=Gi,i=wu;wu=0;var o=$a(_i),l=P.T,d=z.p;try{z.p=32>o?32:o,P.T=null,o=Mu,Mu=null;var h=Gi,x=_i;if(Ut=0,bs=Gi=null,_i=0,(Ke&6)!==0)throw Error(s(331));var O=Ke;if(Ke|=4,Kp(h.current),zp(h,h.current,x,o),Ke=O,mo(0,!1),De&&typeof De.onPostCommitFiberRoot=="function")try{De.onPostCommitFiberRoot(ln,h)}catch{}return!0}finally{z.p=d,P.T=l,uh(t,i)}}function fh(t,i,o){i=Nn(o,i),i=ou(t.stateNode,i,2),t=qi(t,i,2),t!==null&&(Dn(t,2),ii(t))}function Je(t,i,o){if(t.tag===3)fh(t,t,o);else for(;i!==null;){if(i.tag===3){fh(i,t,o);break}else if(i.tag===1){var l=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Wi===null||!Wi.has(l))){t=Nn(o,t),o=mp(2),l=qi(i,o,2),l!==null&&(pp(o,l,i,t),Dn(l,2),ii(l));break}}i=i.return}}function ku(t,i,o){var l=t.pingCache;if(l===null){l=t.pingCache=new mv;var d=new Set;l.set(i,d)}else d=l.get(i),d===void 0&&(d=new Set,l.set(i,d));d.has(o)||(Tu=!0,d.add(o),t=bv.bind(null,t,i,o),i.then(t,t))}function bv(t,i,o){var l=t.pingCache;l!==null&&l.delete(i),t.pingedLanes|=t.suspendedLanes&o,t.warmLanes&=~o,st===t&&(Pe&o)===o&&(Tt===4||Tt===3&&(Pe&62914560)===Pe&&300>qt()-Nr?(Ke&2)===0&&vs(t,0):Eu|=o,gs===Pe&&(gs=0)),ii(t)}function mh(t,i){i===0&&(i=li()),t=ba(t,i),t!==null&&(Dn(t,i),ii(t))}function vv(t){var i=t.memoizedState,o=0;i!==null&&(o=i.retryLane),mh(t,o)}function Sv(t,i){var o=0;switch(t.tag){case 31:case 13:var l=t.stateNode,d=t.memoizedState;d!==null&&(o=d.retryLane);break;case 19:l=t.stateNode;break;case 22:l=t.stateNode._retryCache;break;default:throw Error(s(314))}l!==null&&l.delete(i),mh(t,o)}function xv(t,i){return Kt(t,i)}var Pr=null,xs=null,Ru=!1,jr=!1,Iu=!1,Ji=0;function ii(t){t!==xs&&t.next===null&&(xs===null?Pr=xs=t:xs=xs.next=t),jr=!0,Ru||(Ru=!0,Tv())}function mo(t,i){if(!Iu&&jr){Iu=!0;do for(var o=!1,l=Pr;l!==null;){if(t!==0){var d=l.pendingLanes;if(d===0)var h=0;else{var x=l.suspendedLanes,O=l.pingedLanes;h=(1<<31-at(42|t)+1)-1,h&=d&~(x&~O),h=h&201326741?h&201326741|1:h?h|2:0}h!==0&&(o=!0,gh(l,h))}else h=Pe,h=xt(l,l===st?h:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(h&3)===0||gn(l,h)||(o=!0,gh(l,h));l=l.next}while(o);Iu=!1}}function Av(){ph()}function ph(){jr=Ru=!1;var t=0;Ji!==0&&Iv()&&(t=Ji);for(var i=qt(),o=null,l=Pr;l!==null;){var d=l.next,h=hh(l,i);h===0?(l.next=null,o===null?Pr=d:o.next=d,d===null&&(xs=o)):(o=l,(t!==0||(h&3)!==0)&&(jr=!0)),l=d}Ut!==0&&Ut!==5||mo(t),Ji!==0&&(Ji=0)}function hh(t,i){for(var o=t.suspendedLanes,l=t.pingedLanes,d=t.expirationTimes,h=t.pendingLanes&-62914561;0<h;){var x=31-at(h),O=1<<x,B=d[x];B===-1?((O&o)===0||(O&l)!==0)&&(d[x]=bn(O,i)):B<=i&&(t.expiredLanes|=O),h&=~O}if(i=st,o=Pe,o=xt(t,t===i?o:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l=t.callbackNode,o===0||t===i&&(Xe===2||Xe===9)||t.cancelPendingCommit!==null)return l!==null&&l!==null&&Xn(l),t.callbackNode=null,t.callbackPriority=0;if((o&3)===0||gn(t,o)){if(i=o&-o,i===t.callbackPriority)return i;switch(l!==null&&Xn(l),$a(o)){case 2:case 8:o=Ot;break;case 32:o=Ft;break;case 268435456:o=yn;break;default:o=Ft}return l=yh.bind(null,t),o=Kt(o,l),t.callbackPriority=i,t.callbackNode=o,i}return l!==null&&l!==null&&Xn(l),t.callbackPriority=2,t.callbackNode=null,2}function yh(t,i){if(Ut!==0&&Ut!==5)return t.callbackNode=null,t.callbackPriority=0,null;var o=t.callbackNode;if(Hr()&&t.callbackNode!==o)return null;var l=Pe;return l=xt(t,t===st?l:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l===0?null:(Jp(t,l,i),hh(t,qt()),t.callbackNode!=null&&t.callbackNode===o?yh.bind(null,t):null)}function gh(t,i){if(Hr())return null;Jp(t,i,!0)}function Tv(){Bv(function(){(Ke&6)!==0?Kt(jt,Av):ph()})}function Lu(){if(Ji===0){var t=os;t===0&&(t=Ge,Ge<<=1,(Ge&261888)===0&&(Ge=256)),Ji=t}return Ji}function bh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Ko(""+t)}function vh(t,i){var o=i.ownerDocument.createElement("input");return o.name=i.name,o.value=i.value,t.id&&o.setAttribute("form",t.id),i.parentNode.insertBefore(o,i),t=new FormData(t),o.parentNode.removeChild(o),t}function Ev(t,i,o,l,d){if(i==="submit"&&o&&o.stateNode===d){var h=bh((d[cn]||null).action),x=l.submitter;x&&(i=(i=x[cn]||null)?bh(i.formAction):x.getAttribute("formAction"),i!==null&&(h=i,x=null));var O=new Xo("action","action",null,l,d);t.push({event:O,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(Ji!==0){var B=x?vh(d,x):new FormData(d);eu(o,{pending:!0,data:B,method:d.method,action:h},null,B)}}else typeof h=="function"&&(O.preventDefault(),B=x?vh(d,x):new FormData(d),eu(o,{pending:!0,data:B,method:d.method,action:h},h,B))},currentTarget:d}]})}}for(var Bu=0;Bu<gc.length;Bu++){var Hu=gc[Bu],_v=Hu.toLowerCase(),wv=Hu[0].toUpperCase()+Hu.slice(1);Un(_v,"on"+wv)}Un(Xf,"onAnimationEnd"),Un(Jf,"onAnimationIteration"),Un(Qf,"onAnimationStart"),Un("dblclick","onDoubleClick"),Un("focusin","onFocus"),Un("focusout","onBlur"),Un(qb,"onTransitionRun"),Un(zb,"onTransitionStart"),Un(Vb,"onTransitionCancel"),Un(Zf,"onTransitionEnd"),Ka("onMouseEnter",["mouseout","mouseover"]),Ka("onMouseLeave",["mouseout","mouseover"]),Ka("onPointerEnter",["pointerout","pointerover"]),Ka("onPointerLeave",["pointerout","pointerover"]),pa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pa("onBeforeInput",["compositionend","keypress","textInput","paste"]),pa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var po="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Mv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(po));function Sh(t,i){i=(i&4)!==0;for(var o=0;o<t.length;o++){var l=t[o],d=l.event;l=l.listeners;e:{var h=void 0;if(i)for(var x=l.length-1;0<=x;x--){var O=l[x],B=O.instance,Y=O.currentTarget;if(O=O.listener,B!==h&&d.isPropagationStopped())break e;h=O,d.currentTarget=Y;try{h(d)}catch(ie){Zo(ie)}d.currentTarget=null,h=B}else for(x=0;x<l.length;x++){if(O=l[x],B=O.instance,Y=O.currentTarget,O=O.listener,B!==h&&d.isPropagationStopped())break e;h=O,d.currentTarget=Y;try{h(d)}catch(ie){Zo(ie)}d.currentTarget=null,h=B}}}}function Be(t,i){var o=i[Gl];o===void 0&&(o=i[Gl]=new Set);var l=t+"__bubble";o.has(l)||(xh(i,t,2,!1),o.add(l))}function Pu(t,i,o){var l=0;i&&(l|=4),xh(o,t,l,i)}var Dr="_reactListening"+Math.random().toString(36).slice(2);function ju(t){if(!t[Dr]){t[Dr]=!0,pf.forEach(function(o){o!=="selectionchange"&&(Mv.has(o)||Pu(o,!1,t),Pu(o,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Dr]||(i[Dr]=!0,Pu("selectionchange",!1,i))}}function xh(t,i,o,l){switch(Xh(i)){case 2:var d=tS;break;case 8:d=nS;break;default:d=Zu}o=d.bind(null,i,o,t),d=void 0,!ac||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(d=!0),l?d!==void 0?t.addEventListener(i,o,{capture:!0,passive:d}):t.addEventListener(i,o,!0):d!==void 0?t.addEventListener(i,o,{passive:d}):t.addEventListener(i,o,!1)}function Du(t,i,o,l,d){var h=l;if((i&1)===0&&(i&2)===0&&l!==null)e:for(;;){if(l===null)return;var x=l.tag;if(x===3||x===4){var O=l.stateNode.containerInfo;if(O===d)break;if(x===4)for(x=l.return;x!==null;){var B=x.tag;if((B===3||B===4)&&x.stateNode.containerInfo===d)return;x=x.return}for(;O!==null;){if(x=za(O),x===null)return;if(B=x.tag,B===5||B===6||B===26||B===27){l=h=x;continue e}O=O.parentNode}}l=l.return}wf(function(){var Y=h,ie=nc(o),oe=[];e:{var F=em.get(t);if(F!==void 0){var Z=Xo,he=t;switch(t){case"keypress":if(Wo(o)===0)break e;case"keydown":case"keyup":Z=Sb;break;case"focusin":he="focus",Z=lc;break;case"focusout":he="blur",Z=lc;break;case"beforeblur":case"afterblur":Z=lc;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=Cf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=lb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=Tb;break;case Xf:case Jf:case Qf:Z=db;break;case Zf:Z=_b;break;case"scroll":case"scrollend":Z=ob;break;case"wheel":Z=Mb;break;case"copy":case"cut":case"paste":Z=mb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=kf;break;case"toggle":case"beforetoggle":Z=Cb}var xe=(i&4)!==0,nt=!xe&&(t==="scroll"||t==="scrollend"),U=xe?F!==null?F+"Capture":null:F;xe=[];for(var j=Y,V;j!==null;){var se=j;if(V=se.stateNode,se=se.tag,se!==5&&se!==26&&se!==27||V===null||U===null||(se=Bs(j,U),se!=null&&xe.push(ho(j,se,V))),nt)break;j=j.return}0<xe.length&&(F=new Z(F,he,null,o,ie),oe.push({event:F,listeners:xe}))}}if((i&7)===0){e:{if(F=t==="mouseover"||t==="pointerover",Z=t==="mouseout"||t==="pointerout",F&&o!==tc&&(he=o.relatedTarget||o.fromElement)&&(za(he)||he[qa]))break e;if((Z||F)&&(F=ie.window===ie?ie:(F=ie.ownerDocument)?F.defaultView||F.parentWindow:window,Z?(he=o.relatedTarget||o.toElement,Z=Y,he=he?za(he):null,he!==null&&(nt=c(he),xe=he.tag,he!==nt||xe!==5&&xe!==27&&xe!==6)&&(he=null)):(Z=null,he=Y),Z!==he)){if(xe=Cf,se="onMouseLeave",U="onMouseEnter",j="mouse",(t==="pointerout"||t==="pointerover")&&(xe=kf,se="onPointerLeave",U="onPointerEnter",j="pointer"),nt=Z==null?F:Ls(Z),V=he==null?F:Ls(he),F=new xe(se,j+"leave",Z,o,ie),F.target=nt,F.relatedTarget=V,se=null,za(ie)===Y&&(xe=new xe(U,j+"enter",he,o,ie),xe.target=V,xe.relatedTarget=nt,se=xe),nt=se,Z&&he)t:{for(xe=Ov,U=Z,j=he,V=0,se=U;se;se=xe(se))V++;se=0;for(var ve=j;ve;ve=xe(ve))se++;for(;0<V-se;)U=xe(U),V--;for(;0<se-V;)j=xe(j),se--;for(;V--;){if(U===j||j!==null&&U===j.alternate){xe=U;break t}U=xe(U),j=xe(j)}xe=null}else xe=null;Z!==null&&Ah(oe,F,Z,xe,!1),he!==null&&nt!==null&&Ah(oe,nt,he,xe,!0)}}e:{if(F=Y?Ls(Y):window,Z=F.nodeName&&F.nodeName.toLowerCase(),Z==="select"||Z==="input"&&F.type==="file")var Ve=Df;else if(Pf(F))if(Uf)Ve=Db;else{Ve=Pb;var be=Hb}else Z=F.nodeName,!Z||Z.toLowerCase()!=="input"||F.type!=="checkbox"&&F.type!=="radio"?Y&&ec(Y.elementType)&&(Ve=Df):Ve=jb;if(Ve&&(Ve=Ve(t,Y))){jf(oe,Ve,o,ie);break e}be&&be(t,F,Y),t==="focusout"&&Y&&F.type==="number"&&Y.memoizedProps.value!=null&&Zl(F,"number",F.value)}switch(be=Y?Ls(Y):window,t){case"focusin":(Pf(be)||be.contentEditable==="true")&&(Qa=be,pc=Y,zs=null);break;case"focusout":zs=pc=Qa=null;break;case"mousedown":hc=!0;break;case"contextmenu":case"mouseup":case"dragend":hc=!1,Wf(oe,o,ie);break;case"selectionchange":if($b)break;case"keydown":case"keyup":Wf(oe,o,ie)}var Ne;if(uc)e:{switch(t){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else Ja?Bf(t,o)&&(je="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(je="onCompositionStart");je&&(Rf&&o.locale!=="ko"&&(Ja||je!=="onCompositionStart"?je==="onCompositionEnd"&&Ja&&(Ne=Mf()):(Bi=ie,sc="value"in Bi?Bi.value:Bi.textContent,Ja=!0)),be=Ur(Y,je),0<be.length&&(je=new Nf(je,t,null,o,ie),oe.push({event:je,listeners:be}),Ne?je.data=Ne:(Ne=Hf(o),Ne!==null&&(je.data=Ne)))),(Ne=kb?Rb(t,o):Ib(t,o))&&(je=Ur(Y,"onBeforeInput"),0<je.length&&(be=new Nf("onBeforeInput","beforeinput",null,o,ie),oe.push({event:be,listeners:je}),be.data=Ne)),Ev(oe,t,Y,o,ie)}Sh(oe,i)})}function ho(t,i,o){return{instance:t,listener:i,currentTarget:o}}function Ur(t,i){for(var o=i+"Capture",l=[];t!==null;){var d=t,h=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||h===null||(d=Bs(t,o),d!=null&&l.unshift(ho(t,d,h)),d=Bs(t,i),d!=null&&l.push(ho(t,d,h))),t.tag===3)return l;t=t.return}return[]}function Ov(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Ah(t,i,o,l,d){for(var h=i._reactName,x=[];o!==null&&o!==l;){var O=o,B=O.alternate,Y=O.stateNode;if(O=O.tag,B!==null&&B===l)break;O!==5&&O!==26&&O!==27||Y===null||(B=Y,d?(Y=Bs(o,h),Y!=null&&x.unshift(ho(o,Y,B))):d||(Y=Bs(o,h),Y!=null&&x.push(ho(o,Y,B)))),o=o.return}x.length!==0&&t.push({event:i,listeners:x})}var Cv=/\r\n?/g,Nv=/\u0000|\uFFFD/g;function Th(t){return(typeof t=="string"?t:""+t).replace(Cv,`
`).replace(Nv,"")}function Eh(t,i){return i=Th(i),Th(t)===i}function tt(t,i,o,l,d,h){switch(o){case"children":typeof l=="string"?i==="body"||i==="textarea"&&l===""||Wa(t,l):(typeof l=="number"||typeof l=="bigint")&&i!=="body"&&Wa(t,""+l);break;case"className":Vo(t,"class",l);break;case"tabIndex":Vo(t,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Vo(t,o,l);break;case"style":Ef(t,l,h);break;case"data":if(i!=="object"){Vo(t,"data",l);break}case"src":case"href":if(l===""&&(i!=="a"||o!=="href")){t.removeAttribute(o);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Ko(""+l),t.setAttribute(o,l);break;case"action":case"formAction":if(typeof l=="function"){t.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof h=="function"&&(o==="formAction"?(i!=="input"&&tt(t,i,"name",d.name,d,null),tt(t,i,"formEncType",d.formEncType,d,null),tt(t,i,"formMethod",d.formMethod,d,null),tt(t,i,"formTarget",d.formTarget,d,null)):(tt(t,i,"encType",d.encType,d,null),tt(t,i,"method",d.method,d,null),tt(t,i,"target",d.target,d,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(o);break}l=Ko(""+l),t.setAttribute(o,l);break;case"onClick":l!=null&&(t.onclick=ui);break;case"onScroll":l!=null&&Be("scroll",t);break;case"onScrollEnd":l!=null&&Be("scrollend",t);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(s(61));if(o=l.__html,o!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=o}}break;case"multiple":t.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":t.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){t.removeAttribute("xlink:href");break}o=Ko(""+l),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""+l):t.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,""):t.removeAttribute(o);break;case"capture":case"download":l===!0?t.setAttribute(o,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(o,l):t.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?t.setAttribute(o,l):t.removeAttribute(o);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?t.removeAttribute(o):t.setAttribute(o,l);break;case"popover":Be("beforetoggle",t),Be("toggle",t),zo(t,"popover",l);break;case"xlinkActuate":ci(t,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":ci(t,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":ci(t,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":ci(t,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":ci(t,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":ci(t,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":ci(t,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":ci(t,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":ci(t,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":zo(t,"is",l);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=ab.get(o)||o,zo(t,o,l))}}function Uu(t,i,o,l,d,h){switch(o){case"style":Ef(t,l,h);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(s(61));if(o=l.__html,o!=null){if(d.children!=null)throw Error(s(60));t.innerHTML=o}}break;case"children":typeof l=="string"?Wa(t,l):(typeof l=="number"||typeof l=="bigint")&&Wa(t,""+l);break;case"onScroll":l!=null&&Be("scroll",t);break;case"onScrollEnd":l!=null&&Be("scrollend",t);break;case"onClick":l!=null&&(t.onclick=ui);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!hf.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(d=o.endsWith("Capture"),i=o.slice(2,d?o.length-7:void 0),h=t[cn]||null,h=h!=null?h[o]:null,typeof h=="function"&&t.removeEventListener(i,h,d),typeof l=="function")){typeof h!="function"&&h!==null&&(o in t?t[o]=null:t.hasAttribute(o)&&t.removeAttribute(o)),t.addEventListener(i,l,d);break e}o in t?t[o]=l:l===!0?t.setAttribute(o,""):zo(t,o,l)}}}function Qt(t,i,o){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Be("error",t),Be("load",t);var l=!1,d=!1,h;for(h in o)if(o.hasOwnProperty(h)){var x=o[h];if(x!=null)switch(h){case"src":l=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,i));default:tt(t,i,h,x,o,null)}}d&&tt(t,i,"srcSet",o.srcSet,o,null),l&&tt(t,i,"src",o.src,o,null);return;case"input":Be("invalid",t);var O=h=x=d=null,B=null,Y=null;for(l in o)if(o.hasOwnProperty(l)){var ie=o[l];if(ie!=null)switch(l){case"name":d=ie;break;case"type":x=ie;break;case"checked":B=ie;break;case"defaultChecked":Y=ie;break;case"value":h=ie;break;case"defaultValue":O=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(s(137,i));break;default:tt(t,i,l,ie,o,null)}}Sf(t,h,O,B,Y,x,d,!1);return;case"select":Be("invalid",t),l=x=h=null;for(d in o)if(o.hasOwnProperty(d)&&(O=o[d],O!=null))switch(d){case"value":h=O;break;case"defaultValue":x=O;break;case"multiple":l=O;default:tt(t,i,d,O,o,null)}i=h,o=x,t.multiple=!!l,i!=null?Fa(t,!!l,i,!1):o!=null&&Fa(t,!!l,o,!0);return;case"textarea":Be("invalid",t),h=d=l=null;for(x in o)if(o.hasOwnProperty(x)&&(O=o[x],O!=null))switch(x){case"value":l=O;break;case"defaultValue":d=O;break;case"children":h=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(s(91));break;default:tt(t,i,x,O,o,null)}Af(t,l,d,h);return;case"option":for(B in o)o.hasOwnProperty(B)&&(l=o[B],l!=null)&&(B==="selected"?t.selected=l&&typeof l!="function"&&typeof l!="symbol":tt(t,i,B,l,o,null));return;case"dialog":Be("beforetoggle",t),Be("toggle",t),Be("cancel",t),Be("close",t);break;case"iframe":case"object":Be("load",t);break;case"video":case"audio":for(l=0;l<po.length;l++)Be(po[l],t);break;case"image":Be("error",t),Be("load",t);break;case"details":Be("toggle",t);break;case"embed":case"source":case"link":Be("error",t),Be("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Y in o)if(o.hasOwnProperty(Y)&&(l=o[Y],l!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,i));default:tt(t,i,Y,l,o,null)}return;default:if(ec(i)){for(ie in o)o.hasOwnProperty(ie)&&(l=o[ie],l!==void 0&&Uu(t,i,ie,l,o,void 0));return}}for(O in o)o.hasOwnProperty(O)&&(l=o[O],l!=null&&tt(t,i,O,l,o,null))}function kv(t,i,o,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,h=null,x=null,O=null,B=null,Y=null,ie=null;for(Z in o){var oe=o[Z];if(o.hasOwnProperty(Z)&&oe!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":B=oe;default:l.hasOwnProperty(Z)||tt(t,i,Z,null,l,oe)}}for(var F in l){var Z=l[F];if(oe=o[F],l.hasOwnProperty(F)&&(Z!=null||oe!=null))switch(F){case"type":h=Z;break;case"name":d=Z;break;case"checked":Y=Z;break;case"defaultChecked":ie=Z;break;case"value":x=Z;break;case"defaultValue":O=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(s(137,i));break;default:Z!==oe&&tt(t,i,F,Z,l,oe)}}Ql(t,x,O,B,Y,ie,h,d);return;case"select":Z=x=O=F=null;for(h in o)if(B=o[h],o.hasOwnProperty(h)&&B!=null)switch(h){case"value":break;case"multiple":Z=B;default:l.hasOwnProperty(h)||tt(t,i,h,null,l,B)}for(d in l)if(h=l[d],B=o[d],l.hasOwnProperty(d)&&(h!=null||B!=null))switch(d){case"value":F=h;break;case"defaultValue":O=h;break;case"multiple":x=h;default:h!==B&&tt(t,i,d,h,l,B)}i=O,o=x,l=Z,F!=null?Fa(t,!!o,F,!1):!!l!=!!o&&(i!=null?Fa(t,!!o,i,!0):Fa(t,!!o,o?[]:"",!1));return;case"textarea":Z=F=null;for(O in o)if(d=o[O],o.hasOwnProperty(O)&&d!=null&&!l.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:tt(t,i,O,null,l,d)}for(x in l)if(d=l[x],h=o[x],l.hasOwnProperty(x)&&(d!=null||h!=null))switch(x){case"value":F=d;break;case"defaultValue":Z=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(s(91));break;default:d!==h&&tt(t,i,x,d,l,h)}xf(t,F,Z);return;case"option":for(var he in o)F=o[he],o.hasOwnProperty(he)&&F!=null&&!l.hasOwnProperty(he)&&(he==="selected"?t.selected=!1:tt(t,i,he,null,l,F));for(B in l)F=l[B],Z=o[B],l.hasOwnProperty(B)&&F!==Z&&(F!=null||Z!=null)&&(B==="selected"?t.selected=F&&typeof F!="function"&&typeof F!="symbol":tt(t,i,B,F,l,Z));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var xe in o)F=o[xe],o.hasOwnProperty(xe)&&F!=null&&!l.hasOwnProperty(xe)&&tt(t,i,xe,null,l,F);for(Y in l)if(F=l[Y],Z=o[Y],l.hasOwnProperty(Y)&&F!==Z&&(F!=null||Z!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(s(137,i));break;default:tt(t,i,Y,F,l,Z)}return;default:if(ec(i)){for(var nt in o)F=o[nt],o.hasOwnProperty(nt)&&F!==void 0&&!l.hasOwnProperty(nt)&&Uu(t,i,nt,void 0,l,F);for(ie in l)F=l[ie],Z=o[ie],!l.hasOwnProperty(ie)||F===Z||F===void 0&&Z===void 0||Uu(t,i,ie,F,l,Z);return}}for(var U in o)F=o[U],o.hasOwnProperty(U)&&F!=null&&!l.hasOwnProperty(U)&&tt(t,i,U,null,l,F);for(oe in l)F=l[oe],Z=o[oe],!l.hasOwnProperty(oe)||F===Z||F==null&&Z==null||tt(t,i,oe,F,l,Z)}function _h(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Rv(){if(typeof performance.getEntriesByType=="function"){for(var t=0,i=0,o=performance.getEntriesByType("resource"),l=0;l<o.length;l++){var d=o[l],h=d.transferSize,x=d.initiatorType,O=d.duration;if(h&&O&&_h(x)){for(x=0,O=d.responseEnd,l+=1;l<o.length;l++){var B=o[l],Y=B.startTime;if(Y>O)break;var ie=B.transferSize,oe=B.initiatorType;ie&&_h(oe)&&(B=B.responseEnd,x+=ie*(B<O?1:(O-Y)/(B-Y)))}if(--l,i+=8*(h+x)/(d.duration/1e3),t++,10<t)break}}if(0<t)return i/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var $u=null,qu=null;function $r(t){return t.nodeType===9?t:t.ownerDocument}function wh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Mh(t,i){if(t===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&i==="foreignObject"?0:t}function zu(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Vu=null;function Iv(){var t=window.event;return t&&t.type==="popstate"?t===Vu?!1:(Vu=t,!0):(Vu=null,!1)}var Oh=typeof setTimeout=="function"?setTimeout:void 0,Lv=typeof clearTimeout=="function"?clearTimeout:void 0,Ch=typeof Promise=="function"?Promise:void 0,Bv=typeof queueMicrotask=="function"?queueMicrotask:typeof Ch<"u"?function(t){return Ch.resolve(null).then(t).catch(Hv)}:Oh;function Hv(t){setTimeout(function(){throw t})}function Qi(t){return t==="head"}function Nh(t,i){var o=i,l=0;do{var d=o.nextSibling;if(t.removeChild(o),d&&d.nodeType===8)if(o=d.data,o==="/$"||o==="/&"){if(l===0){t.removeChild(d),_s(i);return}l--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")l++;else if(o==="html")yo(t.ownerDocument.documentElement);else if(o==="head"){o=t.ownerDocument.head,yo(o);for(var h=o.firstChild;h;){var x=h.nextSibling,O=h.nodeName;h[Is]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&h.rel.toLowerCase()==="stylesheet"||o.removeChild(h),h=x}}else o==="body"&&yo(t.ownerDocument.body);o=d}while(o);_s(i)}function kh(t,i){var o=t;t=0;do{var l=o.nextSibling;if(o.nodeType===1?i?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(i?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),l&&l.nodeType===8)if(o=l.data,o==="/$"){if(t===0)break;t--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||t++;o=l}while(o)}function Yu(t){var i=t.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var o=i;switch(i=i.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Yu(o),Xl(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}t.removeChild(o)}}function Pv(t,i,o,l){for(;t.nodeType===1;){var d=o;if(t.nodeName.toLowerCase()!==i.toLowerCase()){if(!l&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(l){if(!t[Is])switch(i){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(h=t.getAttribute("rel"),h==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(h!==d.rel||t.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||t.getAttribute("title")!==(d.title==null?null:d.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(h=t.getAttribute("src"),(h!==(d.src==null?null:d.src)||t.getAttribute("type")!==(d.type==null?null:d.type)||t.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&h&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(i==="input"&&t.type==="hidden"){var h=d.name==null?null:""+d.name;if(d.type==="hidden"&&t.getAttribute("name")===h)return t}else return t;if(t=Bn(t.nextSibling),t===null)break}return null}function jv(t,i,o){if(i==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!o||(t=Bn(t.nextSibling),t===null))return null;return t}function Rh(t,i){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!i||(t=Bn(t.nextSibling),t===null))return null;return t}function Ku(t){return t.data==="$?"||t.data==="$~"}function Fu(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function Dv(t,i){var o=t.ownerDocument;if(t.data==="$~")t._reactRetry=i;else if(t.data!=="$?"||o.readyState!=="loading")i();else{var l=function(){i(),o.removeEventListener("DOMContentLoaded",l)};o.addEventListener("DOMContentLoaded",l),t._reactRetry=l}}function Bn(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return t}var Wu=null;function Ih(t){t=t.nextSibling;for(var i=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"||o==="/&"){if(i===0)return Bn(t.nextSibling);i--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||i++}t=t.nextSibling}return null}function Lh(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(i===0)return t;i--}else o!=="/$"&&o!=="/&"||i++}t=t.previousSibling}return null}function Bh(t,i,o){switch(i=$r(o),t){case"html":if(t=i.documentElement,!t)throw Error(s(452));return t;case"head":if(t=i.head,!t)throw Error(s(453));return t;case"body":if(t=i.body,!t)throw Error(s(454));return t;default:throw Error(s(451))}}function yo(t){for(var i=t.attributes;i.length;)t.removeAttributeNode(i[0]);Xl(t)}var Hn=new Map,Hh=new Set;function qr(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var wi=z.d;z.d={f:Uv,r:$v,D:qv,C:zv,L:Vv,m:Yv,X:Fv,S:Kv,M:Wv};function Uv(){var t=wi.f(),i=Ir();return t||i}function $v(t){var i=Va(t);i!==null&&i.tag===5&&i.type==="form"?Zm(i):wi.r(t)}var As=typeof document>"u"?null:document;function Ph(t,i,o){var l=As;if(l&&typeof i=="string"&&i){var d=On(i);d='link[rel="'+t+'"][href="'+d+'"]',typeof o=="string"&&(d+='[crossorigin="'+o+'"]'),Hh.has(d)||(Hh.add(d),t={rel:t,crossOrigin:o,href:i},l.querySelector(d)===null&&(i=l.createElement("link"),Qt(i,"link",t),zt(i),l.head.appendChild(i)))}}function qv(t){wi.D(t),Ph("dns-prefetch",t,null)}function zv(t,i){wi.C(t,i),Ph("preconnect",t,i)}function Vv(t,i,o){wi.L(t,i,o);var l=As;if(l&&t&&i){var d='link[rel="preload"][as="'+On(i)+'"]';i==="image"&&o&&o.imageSrcSet?(d+='[imagesrcset="'+On(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(d+='[imagesizes="'+On(o.imageSizes)+'"]')):d+='[href="'+On(t)+'"]';var h=d;switch(i){case"style":h=Ts(t);break;case"script":h=Es(t)}Hn.has(h)||(t=b({rel:"preload",href:i==="image"&&o&&o.imageSrcSet?void 0:t,as:i},o),Hn.set(h,t),l.querySelector(d)!==null||i==="style"&&l.querySelector(go(h))||i==="script"&&l.querySelector(bo(h))||(i=l.createElement("link"),Qt(i,"link",t),zt(i),l.head.appendChild(i)))}}function Yv(t,i){wi.m(t,i);var o=As;if(o&&t){var l=i&&typeof i.as=="string"?i.as:"script",d='link[rel="modulepreload"][as="'+On(l)+'"][href="'+On(t)+'"]',h=d;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":h=Es(t)}if(!Hn.has(h)&&(t=b({rel:"modulepreload",href:t},i),Hn.set(h,t),o.querySelector(d)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(bo(h)))return}l=o.createElement("link"),Qt(l,"link",t),zt(l),o.head.appendChild(l)}}}function Kv(t,i,o){wi.S(t,i,o);var l=As;if(l&&t){var d=Ya(l).hoistableStyles,h=Ts(t);i=i||"default";var x=d.get(h);if(!x){var O={loading:0,preload:null};if(x=l.querySelector(go(h)))O.loading=5;else{t=b({rel:"stylesheet",href:t,"data-precedence":i},o),(o=Hn.get(h))&&Gu(t,o);var B=x=l.createElement("link");zt(B),Qt(B,"link",t),B._p=new Promise(function(Y,ie){B.onload=Y,B.onerror=ie}),B.addEventListener("load",function(){O.loading|=1}),B.addEventListener("error",function(){O.loading|=2}),O.loading|=4,zr(x,i,l)}x={type:"stylesheet",instance:x,count:1,state:O},d.set(h,x)}}}function Fv(t,i){wi.X(t,i);var o=As;if(o&&t){var l=Ya(o).hoistableScripts,d=Es(t),h=l.get(d);h||(h=o.querySelector(bo(d)),h||(t=b({src:t,async:!0},i),(i=Hn.get(d))&&Xu(t,i),h=o.createElement("script"),zt(h),Qt(h,"link",t),o.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},l.set(d,h))}}function Wv(t,i){wi.M(t,i);var o=As;if(o&&t){var l=Ya(o).hoistableScripts,d=Es(t),h=l.get(d);h||(h=o.querySelector(bo(d)),h||(t=b({src:t,async:!0,type:"module"},i),(i=Hn.get(d))&&Xu(t,i),h=o.createElement("script"),zt(h),Qt(h,"link",t),o.head.appendChild(h)),h={type:"script",instance:h,count:1,state:null},l.set(d,h))}}function jh(t,i,o,l){var d=(d=ce.current)?qr(d):null;if(!d)throw Error(s(446));switch(t){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(i=Ts(o.href),o=Ya(d).hoistableStyles,l=o.get(i),l||(l={type:"style",instance:null,count:0,state:null},o.set(i,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){t=Ts(o.href);var h=Ya(d).hoistableStyles,x=h.get(t);if(x||(d=d.ownerDocument||d,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},h.set(t,x),(h=d.querySelector(go(t)))&&!h._p&&(x.instance=h,x.state.loading=5),Hn.has(t)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},Hn.set(t,o),h||Gv(d,t,o,x.state))),i&&l===null)throw Error(s(528,""));return x}if(i&&l!==null)throw Error(s(529,""));return null;case"script":return i=o.async,o=o.src,typeof o=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=Es(o),o=Ya(d).hoistableScripts,l=o.get(i),l||(l={type:"script",instance:null,count:0,state:null},o.set(i,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,t))}}function Ts(t){return'href="'+On(t)+'"'}function go(t){return'link[rel="stylesheet"]['+t+"]"}function Dh(t){return b({},t,{"data-precedence":t.precedence,precedence:null})}function Gv(t,i,o,l){t.querySelector('link[rel="preload"][as="style"]['+i+"]")?l.loading=1:(i=t.createElement("link"),l.preload=i,i.addEventListener("load",function(){return l.loading|=1}),i.addEventListener("error",function(){return l.loading|=2}),Qt(i,"link",o),zt(i),t.head.appendChild(i))}function Es(t){return'[src="'+On(t)+'"]'}function bo(t){return"script[async]"+t}function Uh(t,i,o){if(i.count++,i.instance===null)switch(i.type){case"style":var l=t.querySelector('style[data-href~="'+On(o.href)+'"]');if(l)return i.instance=l,zt(l),l;var d=b({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return l=(t.ownerDocument||t).createElement("style"),zt(l),Qt(l,"style",d),zr(l,o.precedence,t),i.instance=l;case"stylesheet":d=Ts(o.href);var h=t.querySelector(go(d));if(h)return i.state.loading|=4,i.instance=h,zt(h),h;l=Dh(o),(d=Hn.get(d))&&Gu(l,d),h=(t.ownerDocument||t).createElement("link"),zt(h);var x=h;return x._p=new Promise(function(O,B){x.onload=O,x.onerror=B}),Qt(h,"link",l),i.state.loading|=4,zr(h,o.precedence,t),i.instance=h;case"script":return h=Es(o.src),(d=t.querySelector(bo(h)))?(i.instance=d,zt(d),d):(l=o,(d=Hn.get(h))&&(l=b({},o),Xu(l,d)),t=t.ownerDocument||t,d=t.createElement("script"),zt(d),Qt(d,"link",l),t.head.appendChild(d),i.instance=d);case"void":return null;default:throw Error(s(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(l=i.instance,i.state.loading|=4,zr(l,o.precedence,t));return i.instance}function zr(t,i,o){for(var l=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=l.length?l[l.length-1]:null,h=d,x=0;x<l.length;x++){var O=l[x];if(O.dataset.precedence===i)h=O;else if(h!==d)break}h?h.parentNode.insertBefore(t,h.nextSibling):(i=o.nodeType===9?o.head:o,i.insertBefore(t,i.firstChild))}function Gu(t,i){t.crossOrigin==null&&(t.crossOrigin=i.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=i.referrerPolicy),t.title==null&&(t.title=i.title)}function Xu(t,i){t.crossOrigin==null&&(t.crossOrigin=i.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=i.referrerPolicy),t.integrity==null&&(t.integrity=i.integrity)}var Vr=null;function $h(t,i,o){if(Vr===null){var l=new Map,d=Vr=new Map;d.set(o,l)}else d=Vr,l=d.get(o),l||(l=new Map,d.set(o,l));if(l.has(t))return l;for(l.set(t,null),o=o.getElementsByTagName(t),d=0;d<o.length;d++){var h=o[d];if(!(h[Is]||h[Wt]||t==="link"&&h.getAttribute("rel")==="stylesheet")&&h.namespaceURI!=="http://www.w3.org/2000/svg"){var x=h.getAttribute(i)||"";x=t+x;var O=l.get(x);O?O.push(h):l.set(x,[h])}}return l}function qh(t,i,o){t=t.ownerDocument||t,t.head.insertBefore(o,i==="title"?t.querySelector("head > title"):null)}function Xv(t,i,o){if(o===1||i.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;return i.rel==="stylesheet"?(t=i.disabled,typeof i.precedence=="string"&&t==null):!0;case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function zh(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function Jv(t,i,o,l){if(o.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var d=Ts(l.href),h=i.querySelector(go(d));if(h){i=h._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(t.count++,t=Yr.bind(t),i.then(t,t)),o.state.loading|=4,o.instance=h,zt(h);return}h=i.ownerDocument||i,l=Dh(l),(d=Hn.get(d))&&Gu(l,d),h=h.createElement("link"),zt(h);var x=h;x._p=new Promise(function(O,B){x.onload=O,x.onerror=B}),Qt(h,"link",l),o.instance=h}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(o,i),(i=o.state.preload)&&(o.state.loading&3)===0&&(t.count++,o=Yr.bind(t),i.addEventListener("load",o),i.addEventListener("error",o))}}var Ju=0;function Qv(t,i){return t.stylesheets&&t.count===0&&Fr(t,t.stylesheets),0<t.count||0<t.imgCount?function(o){var l=setTimeout(function(){if(t.stylesheets&&Fr(t,t.stylesheets),t.unsuspend){var h=t.unsuspend;t.unsuspend=null,h()}},6e4+i);0<t.imgBytes&&Ju===0&&(Ju=62500*Rv());var d=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Fr(t,t.stylesheets),t.unsuspend)){var h=t.unsuspend;t.unsuspend=null,h()}},(t.imgBytes>Ju?50:800)+i);return t.unsuspend=o,function(){t.unsuspend=null,clearTimeout(l),clearTimeout(d)}}:null}function Yr(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Fr(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Kr=null;function Fr(t,i){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Kr=new Map,i.forEach(Zv,t),Kr=null,Yr.call(t))}function Zv(t,i){if(!(i.state.loading&4)){var o=Kr.get(t);if(o)var l=o.get(null);else{o=new Map,Kr.set(t,o);for(var d=t.querySelectorAll("link[data-precedence],style[data-precedence]"),h=0;h<d.length;h++){var x=d[h];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(o.set(x.dataset.precedence,x),l=x)}l&&o.set(null,l)}d=i.instance,x=d.getAttribute("data-precedence"),h=o.get(x)||l,h===l&&o.set(null,d),o.set(x,d),this.count++,l=Yr.bind(this),d.addEventListener("load",l),d.addEventListener("error",l),h?h.parentNode.insertBefore(d,h.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(d,t.firstChild)),i.state.loading|=4}}var vo={$$typeof:M,Provider:null,Consumer:null,_currentValue:X,_currentValue2:X,_threadCount:0};function eS(t,i,o,l,d,h,x,O,B){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Qn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qn(0),this.hiddenUpdates=Qn(null),this.identifierPrefix=l,this.onUncaughtError=d,this.onCaughtError=h,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function Vh(t,i,o,l,d,h,x,O,B,Y,ie,oe){return t=new eS(t,i,o,x,B,Y,ie,oe,O),i=1,h===!0&&(i|=24),h=Sn(3,null,null,i),t.current=h,h.stateNode=t,i=Nc(),i.refCount++,t.pooledCache=i,i.refCount++,h.memoizedState={element:l,isDehydrated:o,cache:i},Lc(h),t}function Yh(t){return t?(t=ts,t):ts}function Kh(t,i,o,l,d,h){d=Yh(d),l.context===null?l.context=d:l.pendingContext=d,l=$i(i),l.payload={element:o},h=h===void 0?null:h,h!==null&&(l.callback=h),o=qi(t,l,i),o!==null&&(hn(o,t,i),Xs(o,t,i))}function Fh(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<i?o:i}}function Qu(t,i){Fh(t,i),(t=t.alternate)&&Fh(t,i)}function Wh(t){if(t.tag===13||t.tag===31){var i=ba(t,67108864);i!==null&&hn(i,t,67108864),Qu(t,67108864)}}function Gh(t){if(t.tag===13||t.tag===31){var i=_n();i=ks(i);var o=ba(t,i);o!==null&&hn(o,t,i),Qu(t,i)}}var Wr=!0;function tS(t,i,o,l){var d=P.T;P.T=null;var h=z.p;try{z.p=2,Zu(t,i,o,l)}finally{z.p=h,P.T=d}}function nS(t,i,o,l){var d=P.T;P.T=null;var h=z.p;try{z.p=8,Zu(t,i,o,l)}finally{z.p=h,P.T=d}}function Zu(t,i,o,l){if(Wr){var d=ed(l);if(d===null)Du(t,i,l,Gr,o),Jh(t,l);else if(aS(d,t,i,o,l))l.stopPropagation();else if(Jh(t,l),i&4&&-1<iS.indexOf(t)){for(;d!==null;){var h=Va(d);if(h!==null)switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var x=Dt(h.pendingLanes);if(x!==0){var O=h;for(O.pendingLanes|=2,O.entangledLanes|=2;x;){var B=1<<31-at(x);O.entanglements[1]|=B,x&=~B}ii(h),(Ke&6)===0&&(kr=qt()+500,mo(0))}}break;case 31:case 13:O=ba(h,2),O!==null&&hn(O,h,2),Ir(),Qu(h,2)}if(h=ed(l),h===null&&Du(t,i,l,Gr,o),h===d)break;d=h}d!==null&&l.stopPropagation()}else Du(t,i,l,null,o)}}function ed(t){return t=nc(t),td(t)}var Gr=null;function td(t){if(Gr=null,t=za(t),t!==null){var i=c(t);if(i===null)t=null;else{var o=i.tag;if(o===13){if(t=u(i),t!==null)return t;t=null}else if(o===31){if(t=p(i),t!==null)return t;t=null}else if(o===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null)}}return Gr=t,null}function Xh(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(fa()){case jt:return 2;case Ot:return 8;case Ft:case Jn:return 32;case yn:return 268435456;default:return 32}default:return 32}}var nd=!1,Zi=null,ea=null,ta=null,So=new Map,xo=new Map,na=[],iS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Jh(t,i){switch(t){case"focusin":case"focusout":Zi=null;break;case"dragenter":case"dragleave":ea=null;break;case"mouseover":case"mouseout":ta=null;break;case"pointerover":case"pointerout":So.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":xo.delete(i.pointerId)}}function Ao(t,i,o,l,d,h){return t===null||t.nativeEvent!==h?(t={blockedOn:i,domEventName:o,eventSystemFlags:l,nativeEvent:h,targetContainers:[d]},i!==null&&(i=Va(i),i!==null&&Wh(i)),t):(t.eventSystemFlags|=l,i=t.targetContainers,d!==null&&i.indexOf(d)===-1&&i.push(d),t)}function aS(t,i,o,l,d){switch(i){case"focusin":return Zi=Ao(Zi,t,i,o,l,d),!0;case"dragenter":return ea=Ao(ea,t,i,o,l,d),!0;case"mouseover":return ta=Ao(ta,t,i,o,l,d),!0;case"pointerover":var h=d.pointerId;return So.set(h,Ao(So.get(h)||null,t,i,o,l,d)),!0;case"gotpointercapture":return h=d.pointerId,xo.set(h,Ao(xo.get(h)||null,t,i,o,l,d)),!0}return!1}function Qh(t){var i=za(t.target);if(i!==null){var o=c(i);if(o!==null){if(i=o.tag,i===13){if(i=u(o),i!==null){t.blockedOn=i,ff(t.priority,function(){Gh(o)});return}}else if(i===31){if(i=p(o),i!==null){t.blockedOn=i,ff(t.priority,function(){Gh(o)});return}}else if(i===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Xr(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var o=ed(t.nativeEvent);if(o===null){o=t.nativeEvent;var l=new o.constructor(o.type,o);tc=l,o.target.dispatchEvent(l),tc=null}else return i=Va(o),i!==null&&Wh(i),t.blockedOn=o,!1;i.shift()}return!0}function Zh(t,i,o){Xr(t)&&o.delete(i)}function sS(){nd=!1,Zi!==null&&Xr(Zi)&&(Zi=null),ea!==null&&Xr(ea)&&(ea=null),ta!==null&&Xr(ta)&&(ta=null),So.forEach(Zh),xo.forEach(Zh)}function Jr(t,i){t.blockedOn===i&&(t.blockedOn=null,nd||(nd=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,sS)))}var Qr=null;function ey(t){Qr!==t&&(Qr=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Qr===t&&(Qr=null);for(var i=0;i<t.length;i+=3){var o=t[i],l=t[i+1],d=t[i+2];if(typeof l!="function"){if(td(l||o)===null)continue;break}var h=Va(o);h!==null&&(t.splice(i,3),i-=3,eu(h,{pending:!0,data:d,method:o.method,action:l},l,d))}}))}function _s(t){function i(B){return Jr(B,t)}Zi!==null&&Jr(Zi,t),ea!==null&&Jr(ea,t),ta!==null&&Jr(ta,t),So.forEach(i),xo.forEach(i);for(var o=0;o<na.length;o++){var l=na[o];l.blockedOn===t&&(l.blockedOn=null)}for(;0<na.length&&(o=na[0],o.blockedOn===null);)Qh(o),o.blockedOn===null&&na.shift();if(o=(t.ownerDocument||t).$$reactFormReplay,o!=null)for(l=0;l<o.length;l+=3){var d=o[l],h=o[l+1],x=d[cn]||null;if(typeof h=="function")x||ey(o);else if(x){var O=null;if(h&&h.hasAttribute("formAction")){if(d=h,x=h[cn]||null)O=x.formAction;else if(td(d)!==null)continue}else O=x.action;typeof O=="function"?o[l+1]=O:(o.splice(l,3),l-=3),ey(o)}}}function ty(){function t(h){h.canIntercept&&h.info==="react-transition"&&h.intercept({handler:function(){return new Promise(function(x){return d=x})},focusReset:"manual",scroll:"manual"})}function i(){d!==null&&(d(),d=null),l||setTimeout(o,20)}function o(){if(!l&&!navigation.transition){var h=navigation.currentEntry;h&&h.url!=null&&navigation.navigate(h.url,{state:h.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,d=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(o,100),function(){l=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),d!==null&&(d(),d=null)}}}function id(t){this._internalRoot=t}Zr.prototype.render=id.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(s(409));var o=i.current,l=_n();Kh(o,l,t,i,null,null)},Zr.prototype.unmount=id.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;Kh(t.current,2,null,t,null,null),Ir(),i[qa]=null}};function Zr(t){this._internalRoot=t}Zr.prototype.unstable_scheduleHydration=function(t){if(t){var i=Rs();t={blockedOn:null,target:t,priority:i};for(var o=0;o<na.length&&i!==0&&i<na[o].priority;o++);na.splice(o,0,t),o===0&&Qh(t)}};var ny=n.version;if(ny!=="19.2.3")throw Error(s(527,ny,"19.2.3"));z.findDOMNode=function(t){var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(s(188)):(t=Object.keys(t).join(","),Error(s(268,t)));return t=m(i),t=t!==null?f(t):null,t=t===null?null:t.stateNode,t};var oS={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var el=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!el.isDisabled&&el.supportsFiber)try{ln=el.inject(oS),De=el}catch{}}return Eo.createRoot=function(t,i){if(!r(t))throw Error(s(299));var o=!1,l="",d=cp,h=up,x=dp;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(l=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(h=i.onCaughtError),i.onRecoverableError!==void 0&&(x=i.onRecoverableError)),i=Vh(t,1,!1,null,null,o,l,null,d,h,x,ty),t[qa]=i.current,ju(t),new id(i)},Eo.hydrateRoot=function(t,i,o){if(!r(t))throw Error(s(299));var l=!1,d="",h=cp,x=up,O=dp,B=null;return o!=null&&(o.unstable_strictMode===!0&&(l=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onUncaughtError!==void 0&&(h=o.onUncaughtError),o.onCaughtError!==void 0&&(x=o.onCaughtError),o.onRecoverableError!==void 0&&(O=o.onRecoverableError),o.formState!==void 0&&(B=o.formState)),i=Vh(t,1,!0,i,o??null,l,d,B,h,x,O,ty),i.context=Yh(null),o=i.current,l=_n(),l=ks(l),d=$i(l),d.callback=null,qi(o,d,l),o=l,i.current.lanes=o,Dn(i,o),ii(i),t[qa]=i.current,ju(t),new Zr(i)},Eo.version="19.2.3",Eo}var fy;function gS(){if(fy)return od.exports;fy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),od.exports=yS(),od.exports}var bS=gS();const rn=(e,n)=>({q:e,r:n,s:-e-n}),vS=e=>`${e.q},${e.r}`,ue=vS,ee=(e,n)=>e.q===n.q&&e.r===n.r&&e.s===n.s,sn=(e,n)=>rn(e.q+n.q,e.r+n.r),Id=(e,n)=>rn(e.q-n.q,e.r-n.r),me=(e,n)=>(Math.abs(e.q-n.q)+Math.abs(e.r-n.r)+Math.abs(e.s-n.s))/2,Ee=(e,n)=>{const a=n*(1.5*e.q),s=n*Math.sqrt(3)*(e.r+e.q/2);return{x:a,y:s}},my=e=>({q:e.q,r:e.r,s:e.s??-e.q-e.r}),SS=e=>rn(e.q,e.r),xS=e=>{let n=Math.round(e.q),a=Math.round(e.r),s=Math.round(e.s);const r=Math.abs(n-e.q),c=Math.abs(a-e.r),u=Math.abs(s-e.s);return r>c&&r>u?n=-a-s:c>u?a=-n-s:s=-n-a,{q:n,r:a,s}},Po=[rn(1,0),rn(1,-1),rn(0,-1),rn(-1,0),rn(-1,1),rn(0,1)],We=e=>Po.map(n=>sn(e,n)),Pt=e=>Po[(e%6+6)%6],ud=(e,n,a)=>e+(n-e)*a,dt=(e,n)=>{const a=me(e,n),s=[],r=my(e),c=my(n);for(let u=0;u<=a;u++){const p=a===0?0:u/a,g={q:ud(r.q+1e-6,c.q+1e-6,p),r:ud(r.r+1e-6,c.r+1e-6,p),s:ud(r.s+1e-6,c.s+1e-6,p)};s.push(SS(xS(g)))}return s},Wn=(e,n)=>{const a=me(e,n);if(a===0)return-1;const s=Id(n,e),r=s.q/a,c=s.r/a,u=(0-s.q-s.r)/a;return Po.findIndex(p=>Math.abs(p.q-r)<.01&&Math.abs(p.r-c)<.01&&Math.abs(p.s-u)<.01)};function Jd(e,n){const a=Pt(e);return{q:a.q*n,r:a.r*n,s:-(a.q*n)-a.r*n}}const Vl=(e,n,a,s)=>{if(e<0||e>=a||n<0||n>=s)return!1;const r=e+n,c=Math.floor(a/2),u=a-1+(s-1)-c;return r>=c&&r<=u},AS=(e,n)=>{const a=[];for(let s=0;s<e;s++)for(let r=0;r<n;r++)Vl(s,r,e,n)&&a.push(rn(s,r));return a},ua=(e,n,a)=>Vl(e.q,e.r,n,a),Jg={footman:{packUnitId:"ENEMY_FOOTMAN_V1",bestiary:{subtype:"footman",name:"Footman",stats:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:4,mind:0,instinct:0},skills:{base:["BASIC_MOVE","BASIC_ATTACK"],passive:["AUTO_ATTACK"]}}},sprinter:{packUnitId:"ENEMY_SPRINTER_V1",bestiary:{subtype:"sprinter",name:"Sprinter",stats:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,actionCooldown:1,weightClass:"Standard",speed:2},trinity:{body:2,mind:0,instinct:0},skills:{base:["BASIC_MOVE","BASIC_ATTACK"],passive:[]}}},raider:{packUnitId:"ENEMY_RAIDER_V1",bestiary:{subtype:"raider",name:"Raider",stats:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,actionCooldown:1,weightClass:"Standard",speed:1},trinity:{body:2,mind:0,instinct:1},skills:{base:["BASIC_MOVE","BASIC_ATTACK","DASH"],passive:[]}}},pouncer:{packUnitId:"ENEMY_POUNCER_V1",bestiary:{subtype:"pouncer",name:"Pouncer",stats:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,actionCooldown:1,weightClass:"Standard",speed:1},trinity:{body:2,mind:0,instinct:1},skills:{base:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],passive:[]}}},shieldBearer:{packUnitId:"ENEMY_SHIELDBEARER_V1",bestiary:{subtype:"shieldBearer",name:"Shield Bearer",stats:{hp:2,maxHp:2,range:1,damage:1,type:"melee",cost:2,actionCooldown:2,weightClass:"Heavy",speed:1},trinity:{body:1,mind:0,instinct:.4},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],passive:[]}}},archer:{packUnitId:"ENEMY_ARCHER_V1",bestiary:{subtype:"archer",name:"Archer",stats:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:1,actionCooldown:3,weightClass:"Standard",speed:1},trinity:{body:.2,mind:0,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","ARCHER_SHOT"],passive:[]}}},bomber:{packUnitId:"ENEMY_BOMBER_V1",bestiary:{subtype:"bomber",name:"Bomber",stats:{hp:1,maxHp:1,range:3,damage:1,type:"ranged",cost:1,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:.4,mind:.2,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","BOMB_TOSS"],passive:[]}}},warlock:{packUnitId:"ENEMY_WARLOCK_V1",bestiary:{subtype:"warlock",name:"Warlock",stats:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:2,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:.4,mind:.6,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],passive:[]}}},sentinel:{packUnitId:"ENEMY_SENTINEL_V1",bestiary:{subtype:"sentinel",name:"Sentinel",stats:{hp:30,maxHp:30,range:4,damage:2,type:"boss",cost:25,actionCooldown:1,weightClass:"Heavy",speed:1},trinity:{body:4,mind:2,instinct:2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],passive:[]}}}},TS=e=>Jg[e],ES=()=>{const e=Object.entries(Jg).map(([n,a])=>[n,a.bestiary]);return Object.fromEntries(e)},Qg=ES(),_S=e=>Qg[e],wS=(e,n={})=>{const a=_S(e);return a?n.includePassive??!0?[...a.skills.base,...a.skills.passive]:[...a.skills.base]:[]},Cl=7,Nl=9,Q=36,py={speed:1},MS={stunned:{tickWindow:"START_OF_TURN"},poisoned:{tickWindow:"START_OF_TURN"},armored:{tickWindow:"END_OF_TURN"},hidden:{tickWindow:"END_OF_TURN"},time_bomb:{tickWindow:"END_OF_TURN"}},Mi=e=>{const n=Qg[e];return{hp:n.stats.hp,maxHp:n.stats.maxHp,range:n.stats.range,damage:n.stats.damage,type:n.stats.type,cost:n.stats.cost,skills:[...n.skills.base,...n.skills.passive],actionCooldown:n.stats.actionCooldown,weightClass:n.stats.weightClass,speed:n.stats.speed}},Ld={footman:Mi("footman"),sprinter:Mi("sprinter"),raider:Mi("raider"),pouncer:Mi("pouncer"),shieldBearer:Mi("shieldBearer"),archer:Mi("archer"),bomber:Mi("bomber"),warlock:Mi("warlock"),sentinel:Mi("sentinel")},OS=.17,hy=[0,2,3,5,7,10,12,15,18,22,0],tl={floor:"#6b7b3c",wall:"#374151",shrine:"#f97316",portal:"#ffffff"},CS={1:"inferno",2:"inferno",3:"inferno",4:"inferno",5:"inferno",6:"inferno",7:"inferno",8:"inferno",9:"inferno",10:"inferno"},dd={1:["footman"],2:["footman","sprinter"],3:["footman","archer"],4:["footman","archer","bomber","raider"],5:["footman","archer","bomber","shieldBearer","raider"],6:["footman","archer","bomber","shieldBearer","warlock","pouncer"],7:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],8:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],9:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],10:[]},Os={GRASS:{id:"GRASS",name:"Grass",description:"Soft grass",defaultTraits:new Set(["WALKABLE","FLAMMABLE"]),visual:{color:"#4a7c59",icon:""}},STONE:{id:"STONE",name:"Stone Floor",description:"Hard stone",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#808080",icon:""}},LAVA:{id:"LAVA",name:"Lava",description:"Molten lava",defaultTraits:new Set(["LIQUID","HAZARDOUS"]),visual:{color:"#ff4400",icon:""}},WALL:{id:"WALL",name:"Wall",description:"Solid wall",defaultTraits:new Set(["BLOCKS_LOS","BLOCKS_MOVEMENT","ANCHOR"]),visual:{color:"#333333",icon:""}},ICE:{id:"ICE",name:"Ice",description:"Slippery ice",defaultTraits:new Set(["WALKABLE","SLIPPERY"]),visual:{color:"#aaddff",icon:""}},VOID:{id:"VOID",name:"Void",description:"The endless void",defaultTraits:new Set(["HAZARDOUS"]),visual:{color:"#000000",icon:""}},STAIRS:{id:"STAIRS",name:"Stairs",description:"Lead to the next floor",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#ffffff",icon:""}},SHRINE:{id:"SHRINE",name:"Shrine",description:"A place of power",defaultTraits:new Set(["WALKABLE","ANCHOR"]),visual:{color:"#ffd700",icon:""}},GATE:{id:"GATE",name:"Gate",description:"A heavy gate",defaultTraits:new Set(["BLOCKS_MOVEMENT","BLOCKS_LOS"]),visual:{color:"#444444",icon:""}},BRIDGE:{id:"BRIDGE",name:"Bridge",description:"Crossing the gap",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#8b4513",icon:""}}},nl={FIRE:{id:"FIRE",name:"Fire",description:"Burning flames",onStay:e=>({effects:[{type:"Damage",target:e.actor.id,amount:1,reason:"fire_damage"}],messages:[`${e.actor.subtype||e.actor.type} burns!`]}),interactsWith:{WET:e=>({effects:[{type:"Juice",effect:"flash",target:e.tile.position,color:"#aaaaaa"}],messages:["Steam rises!"],modifyTile:{effects:e.tile.effects.filter(n=>n.id!=="FIRE"&&n.id!=="WET"&&n.id!=="STEAM").concat({id:"STEAM",duration:2,potency:1})}})}},WET:{id:"WET",name:"Wet",description:"Soaked with water",onApply:e=>e.tile.effects.some(a=>a.id==="FIRE")?{effects:[],messages:["Water extinguishes the flames!"],modifyTile:{effects:e.tile.effects.filter(a=>a.id!=="FIRE")}}:{effects:[],messages:[]}},OIL:{id:"OIL",name:"Oil",description:"Slippery oil",interactsWith:{FIRE:e=>({effects:[{type:"Damage",target:"area",amount:3,reason:"oil_explosion"},{type:"Juice",effect:"explosion_ring",target:e.tile.position}],messages:["Oil explodes!"],modifyTile:{effects:e.tile.effects.filter(n=>n.id!=="OIL")}})}},STEAM:{id:"STEAM",name:"Steam",description:"Obscuring steam cloud"},BLESSED:{id:"BLESSED",name:"Blessed",description:"Holy ground"},CURSED:{id:"CURSED",name:"Cursed",description:"Unholy ground"},ICE_WALL:{id:"ICE_WALL",name:"Ice Wall",description:"A wall of ice"},SMOKE:{id:"SMOKE",name:"Smoke",description:"Thick smoke"},BOMB_TICK:{id:"BOMB_TICK",name:"Bomb Tick",description:"About to explode"},TRI_TRAP:{id:"TRI_TRAP",name:"Kinetic Trap",description:"Hidden trap that flings non-flying units outward"},SNARE:{id:"SNARE",name:"Snare",description:"Entangling roots that halt movement and root the target.",onPass:e=>e.actor.isFlying?{effects:[],messages:[]}:{effects:[{type:"ApplyStatus",target:e.actor.id,status:"rooted",duration:2}],messages:["Snared! Movement halted."],interrupt:!0,newMomentum:0}}},NS=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619)>>>0;return n>>>0},kS=e=>function(){let n=(e+=1831565813)>>>0;return n=Math.imul(n^n>>>15,n|1)>>>0,n^=n+Math.imul(n^n>>>7,n|61)>>>0,((n^n>>>14)>>>0)/4294967296},Yl=e=>{const n=typeof e=="number"?e>>>0:NS(String(e)),a=kS(n||1);return{next:()=>a(),id:(s=9)=>{const r="abcdefghijklmnopqrstuvwxyz0123456789";let c="";for(let u=0;u<s;u++){const p=Math.floor(a()*r.length)%r.length;c+=r[p]}return c}}},Cs=(e,n,a=9,s="")=>{const r=`${e}:${n}:${s}`,c=Yl(r),u="abcdefghijklmnopqrstuvwxyz0123456789";let p="";for(let g=0;g<a;g++){const m=Math.floor(c.next()*u.length)%u.length;p+=u[m]}return p},Bl=(e,n)=>{const a=`${e}:${n}`;return Yl(a).next()},Kn=e=>{const n=e.rngSeed||"default",a=e.rngCounter||0;return{value:Bl(n,a),nextState:{...e,rngCounter:a+1}}},Oe={getTileAt(e,n){const a=ue(n);let s;return e.tiles&&(e.tiles instanceof Map?s=e.tiles.get(a):Array.isArray(e.tiles)?s=e.tiles.find(r=>Array.isArray(r)&&r[0]===a||r.position&&ee(r.position,n)):s=e.tiles[a]),s||{position:n,baseId:"STONE",traits:new Set(["WALKABLE"]),effects:[]}},getTraitsForTile(e,n){const a=new Set,s=n.position;return ua(s,e.gridWidth,e.gridHeight)?(n.baseId==="LAVA"&&(a.add("HAZARDOUS"),a.add("LIQUID"),a.add("LAVA")),n.baseId==="WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),n.traits.forEach(c=>a.add(c)),n.effects.forEach(c=>{c.id==="FIRE"&&(a.add("FIRE"),a.add("HAZARDOUS")),c.id==="ICE_WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),c.id==="SMOKE"&&a.add("BLOCKS_LOS")}),a):(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR"),a)},getTraitsAt(e,n){const a=this.getTileAt(e,n);return this.getTraitsForTile(e,a)},isPassable(e,n){const a=this.getTraitsAt(e,n);return!a.has("BLOCKS_MOVEMENT")&&!a.has("HAZARDOUS")},isWalkable(e,n){return!this.getTraitsAt(e,n).has("BLOCKS_MOVEMENT")},isLosBlocking(e,n){return this.getTraitsAt(e,n).has("BLOCKS_LOS")},isAnchorable(e,n){return this.getTraitsAt(e,n).has("ANCHOR")},hasTrait(e,n,a){return this.getTraitsAt(e,n).has(a)}},RS=(e,n)=>Array(n).fill(0n),fd=(e,n,a)=>{if(!Number.isInteger(n.q)||!Number.isInteger(n.r))return[...e];if(n.r<0||n.r>=e.length||n.q<0)return[...e];const s=[...e];return s[n.r]|=1n<<BigInt(n.q),s},Bd=(e,n)=>n.r<0||n.r>=e.length?!0:(e[n.r]&1n<<BigInt(n.q))!==0n,yy=(e,n)=>{if(n.playerStart&&ee(e,n.playerStart)||n.stairsPosition&&ee(e,n.stairsPosition)||n.shrinePosition&&ee(e,n.shrinePosition))return!0;if(n.tiles){const a=Oe.getTraitsAt(n,e);if(a.has("HAZARDOUS")||a.has("BLOCKS_MOVEMENT"))return!0}return!1},Fn=(e,n)=>{if(e)return e.find(a=>a&&a.position&&ee(a.position,n))},ge=(e,n)=>ee(e.player.position,n)?e.player:Fn(e.enemies,n),IS=(e,n)=>!!e.shrinePosition&&ee(n,e.shrinePosition),LS=(e,n)=>!(!ee(n,e.stairsPosition)||e.enemies.some(s=>s.subtype==="sentinel"&&s.hp>0)),BS=(e,n,a,s)=>{const r=me(a,s);if(r===0)return[];const c=(s.q-a.q)/r,u=(s.r-a.r)/r,p=(s.s-a.s)/r,g=[],m=new Set,f=2;for(let b=1;b<=f;b++){const S={q:s.q+Math.round(c*b),r:s.r+Math.round(u*b),s:s.s+Math.round(p*b)};if(ua(S,e.gridWidth,e.gridHeight)){const T=`${S.q},${S.r}`;m.has(T)||(m.add(T),g.push(S))}}return g},md=(e,n,a)=>Math.max(n,Math.min(a,e)),_o=e=>Math.round(e*1e3)/1e3,Qd=e=>{const n=Math.max(0,e.body),a=Math.max(0,e.mind),s=Math.max(0,e.instinct);return{bodyDamageMultiplier:_o(1+n/20),bodyMitigation:_o(md(n*.01,0,.5)),mindStatusDurationBonus:Math.floor(a/15),mindMagicMultiplier:_o(1+a/20),instinctInitiativeBonus:s*2,instinctCriticalMultiplier:_o(1+md(s,0,10)*.02),instinctSparkDiscountMultiplier:_o(1-md(s,0,100)/100)}},Kl=e=>{const n=Math.max(0,e.body),a=Math.max(0,e.mind),s=Math.max(0,e.instinct),r={base:0,body:5,mind:2,instinct:3},c=Math.floor(n*r.body+a*r.mind+s*r.instinct+r.base);return Math.max(1,c)},$t={body:0,mind:0,instinct:0},HS=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),ws=e=>{const n={};for(const[a,s]of Object.entries(e))n[a]=HS(s);return n},PS={neutral:{id:"neutral",default:$t,archetype:ws({VANGUARD:$t,SKIRMISHER:$t,FIREMAGE:$t,NECROMANCER:$t,HUNTER:$t,ASSASSIN:$t}),enemySubtype:ws({footman:$t,sprinter:$t,raider:$t,pouncer:$t,shieldBearer:$t,archer:$t,bomber:$t,warlock:$t,sentinel:$t}),companionSubtype:ws({falcon:$t,skeleton:$t})},live:{id:"live",default:$t,archetype:ws({VANGUARD:{body:9,mind:4,instinct:5},SKIRMISHER:{body:7,mind:6,instinct:10},FIREMAGE:{body:2,mind:9,instinct:4},NECROMANCER:{body:5,mind:9,instinct:5},HUNTER:{body:3,mind:4,instinct:8},ASSASSIN:{body:3,mind:3,instinct:9}}),enemySubtype:ws({footman:{body:0,mind:0,instinct:0},sprinter:{body:0,mind:0,instinct:0},raider:{body:.4,mind:0,instinct:.2},pouncer:{body:.4,mind:0,instinct:.2},shieldBearer:{body:1,mind:0,instinct:.4},archer:{body:.2,mind:0,instinct:.2},bomber:{body:.4,mind:.2,instinct:.2},warlock:{body:.4,mind:.6,instinct:.2},sentinel:{body:4,mind:2,instinct:2}}),companionSubtype:ws({falcon:{body:2,mind:2,instinct:9},skeleton:{body:15,mind:1,instinct:4}})}},jS=e=>e?.toLowerCase()==="neutral"?"neutral":"live",DS=()=>globalThis?.process?.env?.HOP_TRINITY_PROFILE,US=e=>PS[jS(DS())];function Hd(e,n){return e?.get(n)}const Yn={outgoingPhysical:1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},$S={VANGUARD:Yn,SKIRMISHER:Yn,FIREMAGE:Yn,NECROMANCER:Yn,HUNTER:Yn,ASSASSIN:Yn},qS={footman:{outgoingPhysical:3,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},sprinter:{outgoingPhysical:2.8,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},raider:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},pouncer:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},shieldBearer:{outgoingPhysical:3.5,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},archer:{outgoingPhysical:2.6,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},bomber:{outgoingPhysical:2.8,outgoingMagical:3,incomingPhysical:1,incomingMagical:1},warlock:{outgoingPhysical:1.5,outgoingMagical:3.5,incomingPhysical:1,incomingMagical:1},sentinel:{outgoingPhysical:4,outgoingMagical:4,incomingPhysical:1,incomingMagical:1}},zS={falcon:{outgoingPhysical:1.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},skeleton:{outgoingPhysical:1.1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1}},Io=e=>({outgoingPhysical:e.outgoingPhysical,outgoingMagical:e.outgoingMagical,incomingPhysical:e.incomingPhysical,incomingMagical:e.incomingMagical}),Zg=e=>e.type==="player"?Io($S[(e.archetype||"VANGUARD").toUpperCase()]||Yn):e.companionOf&&e.subtype?Io(zS[e.subtype]||Yn):e.subtype?Io(qS[e.subtype]||Yn):Io(Yn),e0=e=>{const n=Hd(e.components,"combat_profile");return n?{outgoingPhysical:Number.isFinite(n.outgoingPhysical)?n.outgoingPhysical:1,outgoingMagical:Number.isFinite(n.outgoingMagical)?n.outgoingMagical:1,incomingPhysical:Number.isFinite(n.incomingPhysical)?n.incomingPhysical:1,incomingMagical:Number.isFinite(n.incomingMagical)?n.incomingMagical:1}:Io(Yn)},VS=(e,n)=>{const a=e0(e);return n==="magical"?a.outgoingMagical:a.outgoingPhysical},YS=(e,n)=>{const a=e0(e);return n==="magical"?a.incomingMagical:a.incomingPhysical},wo=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),t0=e=>{if(e.trinity)return wo(e.trinity);const n=US(),a=n.default;if(e.type==="player"){const s=(e.archetype||"VANGUARD").toUpperCase();return wo(n.archetype[s]||a)}if(e.companionOf&&e.subtype){const s=e.subtype;if(n.companionSubtype[s])return wo(n.companionSubtype[s])}return e.subtype?wo(n.enemySubtype[e.subtype]||a):wo(a)},Lo=e=>{const n=new Map(e.components||[]),a=n.has("trinity"),s=n.has("combat_profile");if(a&&s)return e;const r=t0({id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:e.factionId,archetype:e.archetype,companionOf:e.companionOf}),c=Zg({type:e.type,archetype:e.archetype,subtype:e.subtype,companionOf:e.companionOf});return a||n.set("trinity",{type:"trinity",...r}),s||n.set("combat_profile",{type:"combat_profile",...c}),{...e,components:n}};function KS(e){return e.map(n=>({id:n,name:String(n),description:String(n),slot:"utility",cooldown:0,currentCooldown:0,range:0,upgrades:[],activeUpgrades:[]}))}function ca(e){const n=e.activeSkills?[...e.activeSkills]:KS(e.skills||[]),a=new Map(e.components||[]),s=t0(e),r=e.combatProfile||Zg(e);a.has("trinity")||a.set("trinity",{type:"trinity",...s}),a.has("combat_profile")||a.set("combat_profile",{type:"combat_profile",...r});const c=Kl(s),u=Math.max(1,e.maxHp??c),p=Math.min(u,Math.max(0,e.hp??u));return e.weightClass&&a.set("physics",{type:"physics",weightClass:e.weightClass}),e.archetype&&a.set("archetype",{type:"archetype",archetype:e.archetype}),{id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:p,maxHp:u,speed:e.speed,factionId:e.factionId,initiative:e.initiative,statusEffects:[],temporaryArmor:0,activeSkills:n,weightClass:e.weightClass,archetype:e.archetype,components:a,isFlying:e.isFlying,companionOf:e.companionOf,isVisible:!0}}function FS(e){const n=ca({id:e.id,type:"enemy",subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:"enemy",skills:e.skills,weightClass:e.weightClass||"Standard",trinity:e.trinity});return n.enemyType=e.enemyType,n}function n0(e){if(e.companionType==="falcon"){const n=ca({id:e.id||`falcon-${e.ownerId}`,type:"enemy",subtype:"falcon",position:e.position,speed:95,factionId:"player",skills:["BASIC_MOVE","FALCON_PECK","FALCON_APEX_STRIKE","FALCON_HEAL","FALCON_SCOUT","FALCON_AUTO_ROOST"],weightClass:"Light",isFlying:!0,companionOf:e.ownerId,trinity:e.trinity});return n.companionState={mode:"roost",orbitStep:0},n}return e.companionType==="skeleton"?ca({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:"skeleton",position:e.position,hp:2,maxHp:2,speed:50,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity}):ca({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:e.companionType,position:e.position,speed:80,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity})}function WS(e){return n0({companionType:"falcon",ownerId:e.ownerId,position:e.position})}function GS(e){const n=wS(e);return n.length>0?n:["BASIC_MOVE"]}class gy extends Error{issues;constructor(n,a){super(`${n} validation failed:
${a.map(s=>`${s.path}: ${s.message}`).join(`
`)}`),this.name="ContractValidationError",this.issues=a}}const Bt=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),Ci=e=>typeof e=="number"&&Number.isFinite(e),zn=e=>Number.isInteger(e),lt=e=>typeof e=="string",de=(e,n,a)=>e.push({path:n,message:a}),XS=e=>{if(!lt(e))return e;try{return JSON.parse(e)}catch(n){throw new Error(`Invalid JSON: ${n.message}`)}},Bo=(e,n,a,s={})=>{if(!Array.isArray(e))return de(n,a,"Expected array");const r=new Set;s.nonEmpty&&e.length===0&&de(n,a,"Must not be empty"),e.forEach((c,u)=>{if(!lt(c)||c.length===0)return de(n,`${a}[${u}]`,"Expected non-empty string");s.unique&&(r.has(c)&&de(n,`${a}[${u}]`,`Duplicate "${c}"`),r.add(c))})},by=(e,n,a)=>{if(!Bt(e))return de(n,a,"Expected object");Ci(e.base)||de(n,`${a}.base`,"Expected number"),e.min!==void 0&&!Ci(e.min)&&de(n,`${a}.min`,"Expected number"),e.max!==void 0&&!Ci(e.max)&&de(n,`${a}.max`,"Expected number"),Ci(e.min)&&Ci(e.max)&&e.min>e.max&&de(n,a,"min must be <= max")},JS=(e,n,a)=>Bt(e)?((!lt(e.id)||e.id.length===0)&&de(n,`${a}.id`,"Expected non-empty string"),Bo(e.tags,n,`${a}.tags`,{nonEmpty:!0,unique:!0}),lt(e.kind)?e.kind==="DEAL_DAMAGE"?(by(e.amount,n,`${a}.amount`),(!Bt(e.target)||!lt(e.target.selector))&&de(n,`${a}.target`,"Expected selector"),!0):e.kind==="APPLY_STATUS"?((!lt(e.statusId)||e.statusId.length===0)&&de(n,`${a}.statusId`,"Expected statusId"),(!zn(e.duration)||e.duration<0)&&de(n,`${a}.duration`,"Expected integer >= 0"),(!Bt(e.target)||!lt(e.target.selector))&&de(n,`${a}.target`,"Expected selector"),!0):e.kind==="APPLY_FORCE"?Bt(e.force)?((!lt(e.force.mode)||!new Set(["push","pull"]).has(e.force.mode))&&de(n,`${a}.force.mode`,"Expected push|pull"),(!lt(e.force.direction)||!new Set(["source_to_target","target_to_source"]).has(e.force.direction))&&de(n,`${a}.force.direction`,"Invalid direction"),(!zn(e.force.maxDistance)||e.force.maxDistance<0)&&de(n,`${a}.force.maxDistance`,"Expected integer >= 0"),by(e.force.magnitude,n,`${a}.force.magnitude`),Bt(e.force.collision)||de(n,`${a}.force.collision`,"Expected object"),!0):(de(n,`${a}.force`,"Expected object"),!0):e.kind==="MESSAGE"?((!lt(e.text)||e.text.length===0)&&de(n,`${a}.text`,"Expected non-empty string"),!0):(de(n,`${a}.kind`,"Unknown kind"),!1):(de(n,`${a}.kind`,"Expected kind"),!1)):(de(n,a,"Expected object"),!1),QS=(e,n,a)=>{if(!Bt(e))return de(n,a,"Expected object");if(!lt(e.method))return de(n,`${a}.method`,"Expected method");if(e.method==="fixed"){Ci(e.value)||de(n,`${a}.value`,"Expected number");return}if(e.method==="uniform_int"){zn(e.min)||de(n,`${a}.min`,"Expected integer"),zn(e.max)||de(n,`${a}.max`,"Expected integer"),zn(e.min)&&zn(e.max)&&e.min>e.max&&de(n,a,"min must be <= max");return}if(e.method==="triangular_int"){zn(e.min)||de(n,`${a}.min`,"Expected integer"),zn(e.mode)||de(n,`${a}.mode`,"Expected integer"),zn(e.max)||de(n,`${a}.max`,"Expected integer");return}if(e.method==="weighted_table"){if(!Array.isArray(e.table)||e.table.length===0)return de(n,`${a}.table`,"Expected non-empty array");e.table.forEach((s,r)=>{if(!Bt(s))return de(n,`${a}.table[${r}]`,"Expected object");Ci(s.value)||de(n,`${a}.table[${r}].value`,"Expected number"),(!Ci(s.weight)||s.weight<=0)&&de(n,`${a}.table[${r}].weight`,"Expected number > 0")});return}de(n,`${a}.method`,"Unknown propensity method")},ZS=e=>{const n=[];if(!Bt(e))return de(n,"$","Expected object"),n;if((!lt(e.version)||!/^1\./.test(e.version))&&de(n,"$.version","Expected v1.x"),(!lt(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&de(n,"$.id","Expected uppercase id"),(!lt(e.name)||e.name.length===0)&&de(n,"$.name","Expected non-empty string"),(!lt(e.actorType)||!new Set(["player","enemy"]).has(e.actorType))&&de(n,"$.actorType","Expected player|enemy"),(!lt(e.factionId)||e.factionId.length===0)&&de(n,"$.factionId","Expected non-empty string"),(!Bt(e.coordSpace)||e.coordSpace.system!=="cube-axial"||e.coordSpace.pointFormat!=="qrs")&&de(n,"$.coordSpace","Expected {system:cube-axial,pointFormat:qrs}"),Bt(e.instantiate)?((!lt(e.instantiate.rngStream)||e.instantiate.rngStream.length===0)&&de(n,"$.instantiate.rngStream","Expected non-empty string"),(!lt(e.instantiate.counterMode)||!new Set(["consume_global","stateless"]).has(e.instantiate.counterMode))&&de(n,"$.instantiate.counterMode","Expected consume_global|stateless"),Bo(e.instantiate.drawOrder,n,"$.instantiate.drawOrder",{nonEmpty:!0,unique:!0})):de(n,"$.instantiate","Expected object"),!Bt(e.propensities))de(n,"$.propensities","Expected object");else{const a=e.propensities;["body","mind","instinct","speed","mass"].forEach(s=>{s in a||de(n,`$.propensities.${s}`,"Missing required propensity")}),Object.entries(a).forEach(([s,r])=>QS(r,n,`$.propensities.${s}`))}return Bt(e.skillLoadout)?(Bo(e.skillLoadout.baseSkillIds,n,"$.skillLoadout.baseSkillIds",{nonEmpty:!0,unique:!0}),e.skillLoadout.passiveSkillIds!==void 0&&Bo(e.skillLoadout.passiveSkillIds,n,"$.skillLoadout.passiveSkillIds",{unique:!0})):de(n,"$.skillLoadout","Expected object"),n},ex=e=>{const n=[];return Bt(e)?((!lt(e.version)||!/^1\./.test(e.version))&&de(n,"$.version","Expected v1.x"),(!lt(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&de(n,"$.id","Expected uppercase id"),(!lt(e.name)||e.name.length===0)&&de(n,"$.name","Expected non-empty string"),(!lt(e.slot)||!new Set(["offensive","defensive","utility","passive"]).has(e.slot))&&de(n,"$.slot","Invalid slot"),Bo(e.keywords,n,"$.keywords",{unique:!0}),Bt(e.targeting)?((!lt(e.targeting.mode)||!new Set(["self","single","line","radius","global"]).has(e.targeting.mode))&&de(n,"$.targeting.mode","Invalid mode"),(!zn(e.targeting.range)||e.targeting.range<0)&&de(n,"$.targeting.range","Expected integer >= 0"),typeof e.targeting.requiresLos!="boolean"&&de(n,"$.targeting.requiresLos","Expected boolean"),typeof e.targeting.allowOccupied!="boolean"&&de(n,"$.targeting.allowOccupied","Expected boolean")):de(n,"$.targeting","Expected object"),(!Bt(e.stackPolicy)||e.stackPolicy.resolveOrder!=="LIFO")&&de(n,"$.stackPolicy.resolveOrder","MVP requires LIFO"),Bt(e.baseAction)?(Bt(e.baseAction.costs)?((!Ci(e.baseAction.costs.energy)||e.baseAction.costs.energy<0)&&de(n,"$.baseAction.costs.energy","Expected number >= 0"),(!zn(e.baseAction.costs.cooldown)||e.baseAction.costs.cooldown<0)&&de(n,"$.baseAction.costs.cooldown","Expected integer >= 0"),typeof e.baseAction.costs.consumesTurn!="boolean"&&de(n,"$.baseAction.costs.consumesTurn","Expected boolean")):de(n,"$.baseAction.costs","Expected object"),!Array.isArray(e.baseAction.effects)||e.baseAction.effects.length===0?de(n,"$.baseAction.effects","Expected non-empty array"):e.baseAction.effects.forEach((a,s)=>JS(a,n,`$.baseAction.effects[${s}]`))):de(n,"$.baseAction","Expected object"),Array.isArray(e.upgrades)?e.upgrades.forEach((a,s)=>{if(!Bt(a))return de(n,`$.upgrades[${s}]`,"Expected object");(!lt(a.id)||!/^[A-Z0-9_]+$/.test(a.id))&&de(n,`$.upgrades[${s}].id`,"Expected uppercase id"),(!lt(a.name)||a.name.length===0)&&de(n,`$.upgrades[${s}].name`,"Expected non-empty string"),Array.isArray(a.modifiers)||de(n,`$.upgrades[${s}].modifiers`,"Expected array")}):de(n,"$.upgrades","Expected array"),n):(de(n,"$","Expected object"),n)},tx=e=>{const n=XS(e),a=[];if(!Bt(n))throw new gy("TacticalDataPack",[{path:"$",message:"Expected pack object"}]);if((!lt(n.version)||!/^1\./.test(n.version))&&a.push({path:"$.version",message:"Expected v1.x string"}),Array.isArray(n.units)?n.units.forEach((s,r)=>{ZS(s).forEach(u=>a.push({path:`$.units[${r}]${u.path.slice(1)}`,message:u.message}))}):a.push({path:"$.units",message:"Expected array"}),Array.isArray(n.skills)?n.skills.forEach((s,r)=>{ex(s).forEach(u=>a.push({path:`$.skills[${r}]${u.path.slice(1)}`,message:u.message}))}):a.push({path:"$.skills",message:"Expected array"}),a.length>0)throw new gy("TacticalDataPack",a);return n},nx=e=>({definition:e,drawOrder:[...e.instantiate.drawOrder],skillIds:[...e.skillLoadout.baseSkillIds],passiveSkillIds:[...e.skillLoadout.passiveSkillIds||[]]}),ix={Light:3,Standard:5,Heavy:8,Anchored:12,OuterWall:20},ax=e=>({version:"1.0.0",id:e.id,name:e.name,actorType:"enemy",subtype:e.subtype,factionId:"enemy",weightClass:e.weightClass,coordSpace:{system:"cube-axial",pointFormat:"qrs"},instantiate:{rngStream:"enemy.instantiate",seedSalt:e.subtype,counterMode:"consume_global",drawOrder:["body","mind","instinct","speed","mass"],includeRollTrace:!1},propensities:{body:{method:"fixed",value:e.trinity.body},mind:{method:"fixed",value:e.trinity.mind},instinct:{method:"fixed",value:e.trinity.instinct},speed:{method:"fixed",value:e.speed},mass:{method:"fixed",value:ix[e.weightClass]}},derivedStats:{maxHp:{formula:"trinity_hp_v1"}},physics:{collisionPolicy:"crush_damage",crushModel:{baseDamage:0,impulseMultiplier:1,massDivider:1,minDamage:1}},skillLoadout:{baseSkillIds:e.baseSkills,passiveSkillIds:e.passiveSkills||[]},runtimeDefaults:{startingHp:"maxHp",temporaryArmor:0,isVisible:!0}}),Oi=(e,n={})=>{const a=TS(e);if(!a)throw new Error(`Missing MVP enemy content for ${e}`);const s=a.bestiary;return ax({id:a.packUnitId,name:s.name,subtype:s.subtype,weightClass:s.stats.weightClass,speed:s.stats.speed,trinity:s.trinity,baseSkills:n.baseSkills??s.skills.base,passiveSkills:n.passiveSkills??s.skills.passive})},sx={version:"1.0.0",id:"SHIELD_BASH_V1",name:"Shield Bash V1",description:"Data-driven migration variant of shield bash.",slot:"offensive",keywords:["Momentum"],intentTags:["damage","control","move"],targeting:{mode:"single",range:1,requiresLos:!0,allowOccupied:!0,deterministicSort:"distance_then_q_then_r"},stackPolicy:{resolveOrder:"LIFO",reactionWindow:"automated",playerPriority:!1,emitTickEvents:!0},baseAction:{costs:{energy:0,cooldown:2,consumesTurn:!0},effects:[{id:"shield_bash_v1_force",kind:"APPLY_FORCE",tags:["movement","momentum"],target:{selector:"targetActor"},force:{mode:"push",direction:"source_to_target",magnitude:{base:2,scaling:[{stat:"body",coefficient:.2}],min:1,round:"floor"},maxDistance:3,collision:{onBlocked:"crush_damage",crushDamage:{base:1,scaling:[{stat:"momentum",coefficient:1}],min:1,round:"floor"}}}},{id:"shield_bash_v1_damage",kind:"DEAL_DAMAGE",tags:["damage","physical"],target:{selector:"targetActor"},amount:{base:2,scaling:[{stat:"body",coefficient:.4}],min:1,round:"floor"},damageClass:"physical",reason:"shield_bash_v1"}]},reactivePassives:[],upgrades:[],inhibit:{filterMode:"exclude_matching_tags",removableTags:["movement","momentum"]},preview:{dryRunEnabled:!0,eventMap:{APPLY_FORCE:"UnitMoved",DEAL_DAMAGE:"DamageTaken"}}},ox={version:"1.0.0",units:[Oi("footman",{passiveSkills:[]}),Oi("sprinter"),Oi("raider",{baseSkills:["DASH"],passiveSkills:[]}),Oi("pouncer",{baseSkills:["BASIC_MOVE","GRAPPLE_HOOK"],passiveSkills:[]}),Oi("shieldBearer",{baseSkills:["BASIC_MOVE","SHIELD_BASH"],passiveSkills:[]}),Oi("archer",{baseSkills:["BASIC_MOVE","ARCHER_SHOT"],passiveSkills:[]}),Oi("bomber",{baseSkills:["BASIC_MOVE","BOMB_TOSS"],passiveSkills:[]}),Oi("warlock",{baseSkills:["BASIC_MOVE","SENTINEL_BLAST"],passiveSkills:[]}),Oi("sentinel",{baseSkills:["BASIC_MOVE","SENTINEL_TELEGRAPH","SENTINEL_BLAST"],passiveSkills:[]})],skills:[sx]},rx=new Map,i0=new Map,lx=e=>(rx.set(e.id,e),e.subtype&&i0.set(e.subtype,e),e),cx=e=>e.map(lx),ux=e=>i0.get(e);function Pn(e,n){const a=e.tiles.get(ue(n));return!!(a?.traits.has("BLOCKS_LOS")||a?.baseId==="WALL")}function Pa(e,n){const a=e.tiles.get(ue(n));return a?.baseId==="LAVA"||a?.traits.has("LIQUID")||!1}function da(e,n,a){const s=ge(e,n);return!!s&&s.id!==a}function Mt(e,n,a){const s=me(e,n);return s>=1&&s<=a}function jn(e,n){const a=Wn(e,n);return{isAxial:a!==-1,directionIndex:a}}function Zd(e,n,a={}){const{checkWalls:s=!0,checkActors:r=!0,checkLava:c=!1,excludeActorId:u}=a;for(const p of n){if(s&&Pn(e,p))return{obstacle:"wall",position:p};if(c&&Pa(e,p))return{obstacle:"lava",position:p};if(r){const g=ge(e,p);if(g&&g.id!==u)return{obstacle:"actor",position:p,actor:g}}}return{}}function ef(e,n,a,s={}){const c=dt(n,a).slice(1),{stopAtWalls:u=!0,stopAtActors:p=!0,stopAtLava:g=!1,excludeActorId:m}=s,f=Zd(e,c,{checkWalls:u,checkActors:p,checkLava:g,excludeActorId:m});return f.obstacle&&f.position&&!ee(f.position,a)?{isValid:!1,blockedBy:f.obstacle,blockedAt:f.position}:{isValid:!0}}function Hl(e,n,a,s,r){const u=dt(n,a).slice(1),p=Zd(e,u,{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:r});return p.obstacle==="actor"&&p.actor?.id===s&&!!p.position&&ee(p.position,a)}function dx(e,n){const a=Oe.getTraitsAt(e,n),s=a.has("HAZARDOUS")||a.has("LAVA")||a.has("FIRE")||a.has("VOID"),r=a.has("LAVA")||a.has("FIRE");return{isHazard:s,isFireHazard:r}}function ki(e,n,a){const{isHazard:s,isFireHazard:r}=dx(e,a);return!!(!s||n.isFlying||(n.activeSkills?.some(u=>u.id==="ABSORB_FIRE")||n.statusEffects?.some(u=>u.type==="fire_immunity"))&&r)}function a0(e,n,a,s){return ki(e,n,a)?!0:new Set(["JUMP","VAULT","GRAPPLE_HOOK","DASH"]).has(s)}const Zt=(e,n,a)=>Math.max(n,Math.min(a,e)),Lt=e=>Math.round(e*1e3)/1e3,fx=()=>globalThis?.process?.env?.HOP_COMBAT_INTERACTION_MODEL,mx=e=>e.length===0?1:e.reduce((n,a)=>n*a.multiplier,1),px=e=>{let n=1;if(e.inDangerPreviewHex&&(n+=.15),typeof e.proximityDistance=="number"){const a=Zt(e.proximityDistance,0,6);n+=(6-a)*.02}return n},hx=(e,n,a,s,r,c,u,p)=>{if(!n)return{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1};const g=a==="physical"?.85+e.instinct*.015+e.body*.005:.85+e.mind*.015+e.instinct*.005,m=a==="physical"?n.instinct*.012+n.body*.004:n.instinct*.008+n.mind*.008,f=Zt(g-m,.1,.99);if(typeof s!="number")return{multiplier:f,pressure:Lt(g-m),rangePressure:0,rangeMultiplier:1};const b={min:Zt(r??(a==="physical"?1:2),1,6),max:Zt(c??(a==="physical"?2:4),1,6)};if(b.max<b.min){const k=b.min;b.min=b.max,b.max=k}const S={min:Zt(u??(a==="physical"?1:2),1,6),max:Zt(p??(a==="physical"?3:5),1,6)};if(S.max<S.min){const k=S.min;S.min=S.max,S.max=k}const T=Zt(s,1,6),v=Math.max(0,b.min-T),A=Math.max(0,T-b.max),_=v*.06+A*.1,E=e.instinct*.015,w=(T>=S.min&&T<=S.max?.05:0)+n.instinct*.006,M=E-_-w,C=Zt(1+M,.55,1.25);return{multiplier:Zt(f*C,.05,.99),pressure:Lt(g-m),rangePressure:Lt(M),rangeMultiplier:Lt(C)}},yx=(e,n)=>{if(!e)return{multiplier:1,pressure:0};const a=Zt(n==="physical"?e.body*.01+e.instinct*.004:e.mind*.01+e.instinct*.004,0,.75);return{multiplier:1-a,pressure:Lt(a)}},gx=(e,n,a,s)=>{if(!n)return{multiplier:s,critPressure:0,resistancePressure:0};const r=Zt(a==="physical"?.05+e.instinct*.01:.05+e.mind*.01,0,.75),c=Zt(a==="physical"?n.body*.006+n.instinct*.004:n.mind*.006+n.instinct*.004,0,.7);return{multiplier:1+Zt(r-c,0,.75)*(s-1),critPressure:Lt(r),resistancePressure:Lt(c)}},bx=(e,n,a,s,r)=>{const c=e.scaling.filter(b=>b.attribute==="body").reduce((b,S)=>b+(e.trinity.body||0)*S.coefficient,0),u=e.scaling.filter(b=>b.attribute==="mind").reduce((b,S)=>b+(e.trinity.mind||0)*S.coefficient,0),p=e.scaling.filter(b=>b.attribute==="instinct").reduce((b,S)=>b+(e.trinity.instinct||0)*S.coefficient,0),g=e.damageClass==="physical"?Math.max(0,e.basePower*(n.bodyDamageMultiplier-1)):0,m=e.damageClass==="magical"?Math.max(0,e.basePower*(n.mindMagicMultiplier-1)):0,f=Math.max(0,(r-1)*(a+s));return{body:Math.max(0,g+c),mind:Math.max(0,m+u),instinct:Math.max(0,p+f)}},vx=(e,n)=>{if(e<=0)return e;const a=Qd(n).mindStatusDurationBonus;return e+a},Sx=e=>Qd(e).instinctInitiativeBonus,Ht=e=>{const n=Qd(e.trinity),a=e.damageClass||"physical",s=fx()==="triangle"?"triangle":"legacy",r=e.interactionModel||s,c=a==="magical"?n.mindMagicMultiplier:n.bodyDamageMultiplier,u=e.basePower*c,p=e.scaling.reduce((R,H)=>{const D=e.trinity[H.attribute]||0;return R+D*H.coefficient},0),g=mx(e.statusMultipliers),m=px(e),f=n.instinctCriticalMultiplier,b=r==="triangle"?hx(e.trinity,e.targetTrinity,a,e.engagementRange,e.optimalRangeMin,e.optimalRangeMax,e.targetOptimalRangeMin,e.targetOptimalRangeMax):{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1},S=r==="triangle"?yx(e.targetTrinity,a):{multiplier:1,pressure:0},T=r==="triangle"?gx(e.trinity,e.targetTrinity,a,f):{multiplier:f,critPressure:0,resistancePressure:0},v=(u+p)*g*m*b.multiplier*S.multiplier*T.multiplier*(e.attackPowerMultiplier??1)*(e.targetDamageTakenMultiplier??1),A=Math.max(0,Math.floor(v)),_=bx(e,n,u,p,f),E=Math.max(1e-6,_.body+_.mind+_.instinct),w=Lt(_.body/E),M=Lt(_.mind/E),C=Lt(_.instinct/E),L=Math.max(1,e.theoreticalMaxPower??v),k=Zt(A/L,0,1);return{basePower:e.basePower,bodyScaledPower:Lt(u),scalingPower:Lt(p),statusMultiplier:Lt(g),riskMultiplier:Lt(m),criticalMultiplier:Lt(f),hitMultiplier:Lt(b.multiplier),rangeMultiplier:Lt(b.rangeMultiplier),mitigationMultiplier:Lt(S.multiplier),critExpectedMultiplier:Lt(T.multiplier),finalPower:A,bodyContribution:w,mindContribution:M,instinctContribution:C,scoreEvent:{skillId:e.skillId,attackerId:e.attackerId,targetId:e.targetId,finalPower:A,efficiency:Lt(k),riskBonusApplied:!!e.inDangerPreviewHex,damageClass:a,hitPressure:b.pressure,rangePressure:b.rangePressure,mitigationPressure:S.pressure,critPressure:T.critPressure,resistancePressure:T.resistancePressure,bodyContribution:w,mindContribution:M,instinctContribution:C}}},Ie=e=>{const n=Hd(e.components,"trinity");if(n)return{body:n.body,mind:n.mind,instinct:n.instinct};const a=Hd(e.components,"stats"),s=a?.strength??0,r=a?.defense??0,c=a?.evasion??0;return{body:s,mind:r,instinct:c}},xx=(e,n)=>e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n),Ax=(e,n,a)=>!!(e.player.id!==a&&ee(e.player.position,n)||e.enemies.some(s=>s.id!==a&&s.hp>0&&ee(s.position,n))||e.companions?.some(s=>s.id!==a&&s.hp>0&&ee(s.position,n))),vy=(e,n)=>{const a={q:n.q-e.q,r:n.r-e.r,s:n.s-e.s};let s=Po[0],r=Number.NEGATIVE_INFINITY;for(const c of Po){const u=c.q*a.q+c.r*a.r+c.s*a.s;u>r&&(r=u,s=c)}return s},Tx=(e,n)=>{const a=xx(e,n.targetActorId);if(!a)return{effects:[],destination:null,collided:!1};const s=Math.max(0,Math.min(n.maxDistance,Math.floor(n.magnitude)));if(s<=0)return{effects:[],destination:a.position,collided:!1};const r=a.position,c=n.mode==="push"?vy(n.source,r):vy(r,n.source),u=[r];let p=r,g=!1;for(let f=0;f<s;f++){const b=sn(p,c);if(!Oe.isWalkable(e,b)||Ax(e,b,a.id)){g=!0;break}u.push(b),p=b}const m=[];return ee(p,r)||m.push({type:"Displacement",target:a.id,destination:p,path:u,simulatePath:!0}),g&&n.collision.onBlocked==="crush_damage"&&m.push({type:"Damage",target:a.id,amount:Math.max(0,Math.floor(n.collision.crushDamage??0)),reason:n.damageReason||"crush"}),{effects:m,destination:p,collided:g}},il=e=>JSON.parse(JSON.stringify(e)),Ex=(e,n)=>n==="floor"?Math.floor(e):n==="round"?Math.round(e):n==="ceil"?Math.ceil(e):e,pd=(e,n)=>{let a=e.base;for(const s of e.scaling||[])a+=(n[s.stat]??0)*s.coefficient;return a=Ex(a,e.round),e.min!==void 0&&(a=Math.max(e.min,a)),e.max!==void 0&&(a=Math.min(e.max,a)),a},_x=(e,n,a,s)=>{const r=n.split(".");let c=e;for(let g=0;g<r.length-1;g++){const m=r[g],f=c[m];if(!f||typeof f!="object")return;c=f}const u=r[r.length-1],p=Number(c[u]);Number.isFinite(p)&&(a==="set"&&(c[u]=s),a==="add"&&(c[u]=p+s),a==="multiply"&&(c[u]=p*s))},wx=(e,n,a)=>{let s=il(e.baseAction.effects);const r=il(e.reactivePassives||[]),c=new Set(e.keywords),u={};for(const p of e.upgrades)u[p.id]=p;for(const p of n){const g=u[p];if(g)for(const m of g.modifiers){if(m.op==="add_effect"&&s.push(il(m.effect)),m.op==="remove_effect_by_tag"&&(s=s.filter(f=>!f.tags.includes(m.tag))),m.op==="modify_number"){const f=s.find(b=>b.id===m.effectId);f&&_x(f,m.field,m.mode,m.value)}m.op==="add_keyword"&&c.add(m.keyword),m.op==="remove_keyword"&&c.delete(m.keyword),m.op==="add_reaction"&&r.push(il(m.reaction))}}return e.inhibit?.filterMode==="exclude_matching_tags"&&a.size>0&&(s=s.filter(p=>!p.tags.some(g=>a.has(g)))),{effects:s,reactions:r,keywords:c}},Mx=(e,n)=>{const a=Ie(e),s=Number(n?.momentum??0),r=Number(n?.mass??1);return{body:a.body,mind:a.mind,instinct:a.instinct,mass:Number.isFinite(r)?r:1,speed:e.speed||1,momentum:Number.isFinite(s)?s:0}},hd=(e,n)=>n?ge(e,n)?.id:void 0,Ox=(e,n,a,s,r)=>{if(s.kind==="MESSAGE")return[{type:"Message",text:s.text}];if(s.kind==="DEAL_DAMAGE"){const g=Math.max(0,Math.floor(pd(s.amount,r))),m=hd(e,a);return[{type:"Damage",target:s.target.selector==="targetActor"?m||"targetActor":s.target.selector==="self"?n.id:a||"targetActor",amount:g,reason:s.reason}]}if(s.kind==="APPLY_STATUS"){const g=hd(e,a);return[{type:"ApplyStatus",target:s.target.selector==="targetActor"?g||"targetActor":s.target.selector==="self"?n.id:a||"targetActor",status:s.statusId,duration:s.duration}]}const c=hd(e,a);if(!c)return[];const u=pd(s.force.magnitude,r),p=s.force.collision.crushDamage?pd(s.force.collision.crushDamage,r):0;return Tx(e,{source:n.position,targetActorId:c,mode:s.force.mode,magnitude:u,maxDistance:s.force.maxDistance,collision:{onBlocked:s.force.collision.onBlocked,crushDamage:p}}).effects},Cx=(e,n,a,s)=>{const r=[];for(let c=0;c<e.gridWidth;c++)for(let u=0;u<e.gridHeight;u++){const p=rn(c,u);ua(p,e.gridWidth,e.gridHeight)&&me(n,p)<=a&&r.push(p)}return r.sort((c,u)=>{if(s==="q_then_r")return c.q===u.q?c.r-u.r:c.q-u.q;if(s==="r_then_q")return c.r===u.r?c.q-u.q:c.r-u.r;const p=me(n,c),g=me(n,u);return p!==g?p-g:c.q===u.q?c.r-u.r:c.q-u.q}),r},Nx=e=>{const n=e.baseAction.effects.find(r=>r.kind==="DEAL_DAMAGE"),a=e.baseAction.effects.find(r=>r.kind==="APPLY_FORCE"),s={};return e.upgrades.forEach(r=>{s[r.id]={id:r.id,name:r.name,description:r.description||r.name}}),{id:e.id,name:e.name,description:e.description||e.name,slot:e.slot,icon:"data-driven",baseVariables:{range:e.targeting.range,cost:e.baseAction.costs.energy,cooldown:e.baseAction.costs.cooldown,damage:n?.amount?.base,momentum:a?.force?.magnitude?.base},execute:(r,c,u,p=[],g={})=>{const m=new Set(g.inhibitTags||[]),f=wx(e,p,m),b=Mx(c,g),T=[...(f.reactions||[]).filter(A=>A.trigger==="ON_DECLARE").flatMap(A=>A.effects),...f.effects],v=[];for(const A of T)v.push(...Ox(r,c,u,A,b));return{effects:v,messages:[],consumesTurn:e.baseAction.costs.consumesTurn}},getValidTargets:(r,c)=>{if(e.targeting.mode==="self")return[c];let u=Cx(r,c,e.targeting.range,e.targeting.deterministicSort);return(e.targeting.mode==="single"||e.targeting.mode==="radius"||e.targeting.mode==="line")&&(e.targeting.requiresLos&&(u=u.filter(p=>ef(r,c,p).isValid)),e.targeting.allowOccupied||(u=u.filter(p=>!ge(r,p)))),u},upgrades:s}},kx=new Map,s0=new Map,Rx=e=>{const n=Nx(e);return kx.set(e.id,e),s0.set(e.id,n),n},Ix=e=>e.map(Rx),Lx=()=>{const e={};for(const[n,a]of s0.entries())e[n]=a;return e},aa=(e,n)=>e.includes(n),Bx=e=>{const n=new Set,a=e.id;return((e.baseVariables.damage||0)>0||/(ATTACK|THROW|BLAST|FIREBALL|BASH|PECK|EXPLOSION|SPEAR|SHOOT)/.test(a))&&n.add("damage"),/(MOVE|DASH|JUMP|ROLL|VAULT|STEP|GRAPPLE|WITHDRAWAL|WALK)/.test(a)&&n.add("move"),/(HEAL|ABSORB)/.test(a)&&n.add("heal"),/(SHIELD|PROTECT|BULWARK)/.test(a)&&n.add("protect"),/(STUN|TRAP|SMOKE|TELEGRAPH|ROOT|SWAP|SCOUT)/.test(a)&&n.add("control"),/(RAISE|FALCON|SUMMON)/.test(a)&&n.add("summon"),/(FIRE|LAVA|HAZARD|TRAP)/.test(a)&&n.add("hazard"),e.slot==="offensive"&&n.add("damage"),e.slot==="defensive"&&n.add("protect"),e.slot==="utility"&&n.add("utility"),(e.baseVariables.cooldown>0||e.baseVariables.cost>0)&&n.add("economy"),n.size||n.add("utility"),[...n]},Hx={BASIC_MOVE:{intentTags:["move","objective","utility"],target:{pattern:"single"},estimates:{movement:1}},BASIC_ATTACK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:4}},AUTO_ATTACK:{intentTags:["damage","utility"],target:{pattern:"single"},estimates:{damage:2}},DASH:{intentTags:["move","damage","utility"],target:{pattern:"line"},estimates:{movement:2,damage:2},risk:{noProgressCastPenalty:5}},JUMP:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2},risk:{noProgressCastPenalty:6}},SHIELD_BASH:{intentTags:["damage","control","protect"],target:{pattern:"single"},estimates:{damage:3,control:2},risk:{requireEnemyContact:!0,noContactPenalty:5,noProgressCastPenalty:7}},BULWARK_CHARGE:{intentTags:["move","protect","damage"],target:{pattern:"line"},estimates:{movement:2,damage:4,shielding:2}},VAULT:{intentTags:["move","utility","control"],target:{pattern:"single"},estimates:{movement:3,control:2}},GRAPPLE_HOOK:{intentTags:["move","control"],target:{pattern:"line"},estimates:{movement:3,control:2}},SHIELD_THROW:{intentTags:["damage","control"],target:{pattern:"line"},estimates:{damage:6,control:2}},SPEAR_THROW:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:5}},ARCHER_SHOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:2},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:4}},FIREBALL:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:5,control:1}},FIREWALL:{intentTags:["hazard","control","damage"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:5,control:3}},FIREWALK:{intentTags:["move","hazard","utility"],target:{pattern:"single"},estimates:{movement:3},risk:{noProgressCastPenalty:8}},ABSORB_FIRE:{intentTags:["heal","hazard","utility"],target:{pattern:"self"},estimates:{healing:6},risk:{noProgressCastPenalty:2}},BOMB_TOSS:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:2}},TIME_BOMB:{intentTags:["damage","hazard","utility"],target:{pattern:"self"},estimates:{damage:6,control:1}},CORPSE_EXPLOSION:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:1}},RAISE_DEAD:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:5}},SOUL_SWAP:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:2}},MULTI_SHOOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5}},SET_TRAP:{intentTags:["control","hazard"],target:{pattern:"single"},estimates:{control:3}},SWIFT_ROLL:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2}},SNEAK_ATTACK:{intentTags:["damage","move"],target:{pattern:"single"},estimates:{damage:8,movement:2},risk:{requireEnemyContact:!0,noContactPenalty:3,noProgressCastPenalty:4}},SMOKE_SCREEN:{intentTags:["control","protect","utility"],target:{pattern:"radius",aoeRadius:1},estimates:{control:4,shielding:4}},SHADOW_STEP:{intentTags:["move","damage","utility"],target:{pattern:"single"},estimates:{movement:3,damage:3}},FALCON_COMMAND:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:4,control:2}},FALCON_PECK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:3}},FALCON_APEX_STRIKE:{intentTags:["damage","control"],target:{pattern:"single"},estimates:{damage:5,control:1}},FALCON_HEAL:{intentTags:["heal","utility"],target:{pattern:"single"},estimates:{healing:4}},FALCON_SCOUT:{intentTags:["control","utility"],target:{pattern:"self"},estimates:{control:3}},FALCON_AUTO_ROOST:{intentTags:["summon","utility"],target:{pattern:"self"},estimates:{summon:2}},KINETIC_TRI_TRAP:{intentTags:["control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{control:5,damage:4}},WITHDRAWAL:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:1}},SENTINEL_TELEGRAPH:{intentTags:["control","objective"],target:{pattern:"radius",aoeRadius:2},estimates:{control:3}},SENTINEL_BLAST:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:7}},THEME_HAZARDS:{intentTags:["hazard","control"],target:{pattern:"global"},estimates:{control:2}}},Px=(e,n)=>n?{...e,...n,target:{...e.target,...n.target||{}},estimates:{...e.estimates,...n.estimates||{}},economy:{...e.economy,...n.economy||{}},risk:{...e.risk,...n.risk||{}}}:e,jx=e=>{const n=Bx(e),a=(aa(n,"move"),"single"),s={id:e.id,intentTags:n,target:{range:Math.max(0,e.baseVariables.range||0),pattern:a},estimates:{damage:Math.max(0,e.baseVariables.damage||0),movement:aa(n,"move")?Math.max(1,Math.min(3,e.baseVariables.range||1)):0,healing:aa(n,"heal")?2:0,shielding:aa(n,"protect")?1:0,control:aa(n,"control")?1:0,summon:aa(n,"summon")?1:0},economy:{cost:Math.max(0,e.baseVariables.cost||0),cooldown:Math.max(0,e.baseVariables.cooldown||0),consumesTurn:!0},risk:{selfExposure:aa(n,"move")?.5:0,hazardAffinity:aa(n,"hazard")?.5:0},complexity:1};return Px(s,Hx[e.id])},Dx=e=>{const n=[];return(!e.intentTags||e.intentTags.length===0)&&n.push("intentTags must not be empty"),(!Number.isFinite(e.target.range)||e.target.range<0)&&n.push("target.range must be >= 0"),e.target.pattern||n.push("target.pattern is required"),(!Number.isFinite(e.economy.cooldown)||e.economy.cooldown<0)&&n.push("economy.cooldown must be >= 0"),(!Number.isFinite(e.economy.cost)||e.economy.cost<0)&&n.push("economy.cost must be >= 0"),(!Number.isFinite(e.complexity)||e.complexity<0)&&n.push("complexity must be >= 0"),n},Ux=e=>{const n=[],a=[];for(const[s,r]of Object.entries(e)){const c=r.intentProfile||jx(r);r.intentProfile=c;const u=Dx(c);u.length>0&&a.push({skillId:s,errors:u}),c||n.push(s)}return{missing:n,invalid:a}},$x={id:"ABSORB_FIRE",name:"Absorb Fire",description:"Fire heals you instead of harming you.",slot:"passive",icon:"",baseVariables:{cost:0,cooldown:0,range:0},execute:(e,n,a)=>({effects:[],messages:[]}),getValidTargets:()=>[],upgrades:{}},qx={id:"grapple_hook",name:"Grapple Hook",description:"Tests for grapple hook mechanics including LoS, lava sinking, and weight-based behavior",scenarios:[{id:"hook_lava_intercept",title:"Lava Interceptor & LoS",description:"Verify LoS blocking and Lava killing targets.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["lava","line-of-sight","displacement"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},["GRAPPLE_HOOK"]),e.spawnEnemy("footman",{q:4,r:4,s:-8},"target1"),e.spawnEnemy("footman",{q:7,r:3,s:-10},"hidden"),e.setTile({q:6,r:4,s:-10},"wall"),e.setTile({q:4,r:5,s:-9},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:3,s:-10}),e.useSkill("GRAPPLE_HOOK",{q:4,r:4,s:-8}),e.wait(),e.wait()},verify:(e,n)=>{const a=e.player,s=e.enemies.find(c=>c.id==="target1"),r={playerInOriginalPosition:a.position.q===4&&a.position.r===6&&a.position.s===-10,target1Dead:!s,losWarning:n.some(c=>c.includes("Line of sight"))};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Logs:",n)),Object.values(r).every(c=>c===!0)}},{id:"hook_wall_anchor_zip",title:"Heavy Zip to Wall",description:"Verify zipping to a wall and stunning nearby enemies.",relatedSkills:["GRAPPLE_HOOK"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["wall","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK"]),e.setTile({q:6,r:3,s:-9},"wall"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"blocker"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"stunMe"),e.spawnEnemy("footman",{q:7,r:5,s:-12},"noStun")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:6,r:3,s:-9}),e.useSkill("GRAPPLE_HOOK",{q:6,r:6,s:-12})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="stunMe"),s=e.enemies.find(c=>c.id==="noStun"),r={stunnedEnemy:!!(a&&a.statusEffects.some(c=>c.type==="stunned")),safeEnemy:!!(s&&!s.statusEffects.some(c=>c.type==="stunned")),zipLog:n.some(c=>c.includes("Zipped")),lavaSinkLog:n.some(c=>c.includes("Lava Sink"))};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Player Pos:",e.player.position),console.log("Victim Status:",a?.statusEffects)),Object.values(r).every(c=>c===!0)}}]},zx={id:"shield_throw",name:"Shield Throw",description:"Tests for shield throw mechanics including push, stun, and collision behavior",scenarios:[{id:"shield_stun_push",title:"Standard Push",description:"Verify 4-tile push in a straight line.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="victim"),s={victimAt1:a?.position.r===1,victimStunned:n?.some(r=>r.includes("stunned"))};return Object.values(s).some(r=>r===!1)&&(console.log(" Shield Throw Failed:",s),console.log("Enemy Pos:",a?.position),console.log("Logs:",n)),Object.values(s).every(r=>r===!0)}},{id:"shield_unit_collision",title:"Unit Collision",description:"Verify push stops when hitting another unit.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim"),e.spawnEnemy("shieldbearer",{q:3,r:3,s:-6},"obstacle"),e.setTile({q:3,r:1,s:-4},"lava")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="victim"),s=e.enemies.find(c=>c.id==="obstacle"),r={victimPushed:(a?.position.r??5)===3,obstacleDead:!s};return Object.values(r).some(c=>c===!1)&&(console.log(" Shield Throw Failed:",r),console.log("Victim Pushed:",r.victimPushed),console.log("Victim Pos:",a?.position),console.log("Obstacle Dead:",r.obstacleDead),console.log("Logs:",n)),Object.values(r).every(c=>c===!0)}}]},Vx={id:"auto_attack",name:"Auto Attack",description:"Tests for auto-attack passive skill including turn-start memory and friendly fire logic",scenarios:[{id:"auto_attack_persistence_stress_test",title:"Persistence: Three-Point Validation",description:"Verifies that Auto-Attack only hits units that were adjacent at BOTH start and end.",relatedSkills:["AUTO_ATTACK","BASIC_MOVE"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","spatial-memory","edge-case"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["AUTO_ATTACK","BASIC_MOVE"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"persistent_foe"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"new_neighbor"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"former_neighbor"),e.state.player.previousPosition={q:4,r:5,s:-9}},run:e=>{e.move({q:4,r:6,s:-10})},verify:(e,n)=>{const a=e.enemies.find(u=>u.id==="persistent_foe"),s=e.enemies.find(u=>u.id==="new_neighbor"),r=e.enemies.find(u=>u.id==="former_neighbor"),c={persistentDead:!a||a.hp<a.maxHp,ignoredNew:s&&s.hp===s.maxHp,ignoredFormer:r&&r.hp===r.maxHp,logFound:n.some(u=>u.includes("attacked footman"))};return Object.values(c).some(u=>u===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n)),Object.values(c).every(u=>u===!0)}},{id:"enemy_auto_attack_no_friendly_fire",title:"Enemy Auto-Attack: Team Alignment",description:"Ensures enemy passives only target the player and not their own allies.",relatedSkills:["AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","alignment","friendly-fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},[]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"enemy_attacker");const n=e.state.enemies.find(a=>a.id==="enemy_attacker");n&&(n.activeSkills=[{id:"AUTO_ATTACK",range:1}],n.previousPosition={q:3,r:5,s:-8}),e.spawnEnemy("shieldBearer",{q:2,r:6,s:-8},"enemy_ally"),n.previousPosition={q:3,r:5,s:-8},e.state.player.previousPosition={q:3,r:6,s:-9}},run:e=>{e.wait()},verify:(e,n)=>{const a=e.player,s=e.enemies.find(c=>c.id==="enemy_ally"),r={playerHit:a.hp<a.maxHp,allySafe:s&&s.hp===s.maxHp,hitPlayerLog:n.some(c=>c.includes("attacked you")),hitAllyLog:!n.some(c=>c.includes("attacked enemy_ally"))};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n)),Object.values(r).every(c=>c===!0)}}]},Yx={id:"integration",name:"Integration Tests",description:"Multi-skill integration scenarios testing complex interactions",scenarios:[{id:"environmental_chain_reaction",title:"Environmental Chain Reaction",description:"Test complex environmental interactions with multiple hazards",relatedSkills:["GRAPPLE_HOOK","SHIELD_THROW"],category:"hazards",difficulty:"advanced",isTutorial:!1,tags:["lava","wall","environmental-kill","chain-reaction"],setup:e=>{e.setPlayer({q:5,r:4,s:-9},["GRAPPLE_HOOK","SHIELD_THROW"]),e.spawnEnemy("shieldbearer",{q:5,r:2,s:-7},"victim1"),e.spawnEnemy("footman",{q:5,r:6,s:-11},"victim2"),e.spawnEnemy("footman",{q:5,r:7,s:-12},"victim3"),e.setTile({q:5,r:8,s:-13},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:5,r:2,s:-7}),e.useSkill("SHIELD_THROW",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.player.position.q===5&&e.player.position.r===3,s=!e.enemies.find(m=>m.id==="victim3")||!!e.dyingEntities?.find(m=>m.id==="victim3"),r=!e.enemies.find(m=>m.id==="victim2")||!!e.dyingEntities?.find(m=>m.id==="victim2"),c=e.enemies.find(m=>m.id==="victim1"),u=c&&n.some(m=>m.includes("stunned")),p=c&&c.position.q===5&&c.position.r===6,g=[a,s,r,u,p];return Object.values(g).some(m=>m===!1)&&(console.log(" Environmental Chain Reaction Failed:",g),console.log("Player at 5,3:",a),console.log("Player Pos:",e.player.position),console.log("Logs found:",n),console.log("Victim1 at 5,6:",p),console.log("Victim1 Pos:",c?.position),console.log("Victim1 Stunned:",u),console.log("Victim2 Dead:",r),console.log("Victim3 Dead:",s)),Object.values(g).every(m=>m===!0)}},{id:"auto_attack_after_grapple",title:"Auto-Attack After Grapple",description:"Verify auto-attack triggers correctly after grapple displacement",relatedSkills:["GRAPPLE_HOOK","AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","displacement","integration"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK","AUTO_ATTACK"]),e.state.player.previousPosition={q:4,r:6,s:-10},e.spawnEnemy("footman",{q:7,r:6,s:-13},"grappleHookTarget"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"safe"),e.spawnEnemy("footman",{q:4,r:5,s:-9},"auto-attacked"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"safe2")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:6,s:-13})},verify:(e,n)=>{const a=e.enemies.find(p=>p.id==="grappleHookTarget"),s=e.enemies.find(p=>p.id==="auto-attacked"),r=e.enemies.find(p=>p.id==="safe"),c=e.enemies.find(p=>p.id==="safe2"),u={targetPulled:!!(a&&a.position.q<7),targetNotHit:!!(a&&a.hp===a.maxHp),safeNotHit:!!(r&&r.hp===r.maxHp),safe2NotHit:!!(c&&c.hp===c.maxHp),autoattackedDead:!s||s.hp<=0};return Object.values(u).some(p=>p===!1)&&(console.log(" Scenario Failed Details:",u),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n),console.log("target Pos:",a?.position.q),console.log("target Pulled:",u.targetPulled),console.log("target Not Hit:",u.targetNotHit),console.log("safe Not Hit:",u.safeNotHit),console.log("safe2 Not Hit:",u.safe2NotHit),console.log("autoattacked Dead:",u.autoattackedDead)),Object.values(u).every(p=>p===!0)}}]},Kx="modulepreload",Fx=function(e){return"/Hop/"+e},Sy={},Wx=function(n,a,s){let r=Promise.resolve();if(a&&a.length>0){let m=function(f){return Promise.all(f.map(b=>Promise.resolve(b).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};var u=m;document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),g=p?.nonce||p?.getAttribute("nonce");r=m(a.map(f=>{if(f=Fx(f),f in Sy)return;Sy[f]=!0;const b=f.endsWith(".css"),S=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${S}`))return;const T=document.createElement("link");if(T.rel=b?"stylesheet":Kx,b||(T.as="script"),T.crossOrigin="",T.href=f,g&&T.setAttribute("nonce",g),document.head.appendChild(T),b)return new Promise((v,A)=>{T.addEventListener("load",v),T.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${f}`)))})}))}function c(p){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=p,window.dispatchEvent(g),!g.defaultPrevented)throw p}return r.then(p=>{for(const g of p||[])g.status==="rejected"&&c(g.reason);return n().catch(c)})},Gx=async(e,n)=>{if(typeof window>"u")try{(await Wx(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])).appendFileSync(e,n)}catch(a){console.warn(`Failed to persist log to ${e}:`,a)}},Xx={id:"basic_attack",name:"Basic Attack",description:"Tests for basic melee attack mechanics including range and move-to-attack logic",scenarios:[{id:"basic_attack_player_mechanics",title:"Player Basic Attack: Range & Bump",description:"Validates range enforcement, turn accounting, and bump-attack redirection.",relatedSkills:["BASIC_ATTACK"],category:"combat",tags:["melee","targeting","bump-attack"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"far_victim")},run:e=>{e.useSkill("BASIC_ATTACK",{q:3,r:4,s:-7}),e.move({q:3,r:5,s:-8})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="adj_victim"),s=e.enemies.find(c=>c.id==="far_victim"),r={farStaysAlive:s&&s.hp===s.maxHp,rangeError:n.some(c=>c.includes("out of range")),adjTookDamage:!a||a.hp<=a.maxHp,playerPositionHeld:ee(e.player.position,{q:3,r:6,s:-9}),oneTurnConsumed:e.turnsSpent===1};if(Object.values(r).some(c=>c===!1)){const c=` Basic Attack Failed: ${JSON.stringify(r)}
Current Player Pos: ${JSON.stringify(e.player.position)}
Logs: ${JSON.stringify(n)}
`;console.log(c),Gx("integration_debug.txt",c)}return Object.values(r).every(c=>c===!0)}}]},Jx={id:"spear_throw",name:"Spear Throw",description:"Tests for spear throw mechanics including range, LoS, and spear retrieval",scenarios:[{id:"spear_kill",title:"Spear Kill",description:"Throw spear to kill an enemy and verify item spawn.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["projectile","combat","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:3,r:4,s:-7},"target"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=!e.enemies.find(c=>c.id==="target"),s=!!e.spearPosition&&e.spearPosition.q===3&&e.spearPosition.r===4,r=n.some(c=>c.includes("Spear killed"));return a&&s&&r}},{id:"spear_miss_spawn",title:"Spear Rejects Empty Tile",description:"Enemy-only contract: empty tiles are invalid targets and do not spawn spear.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=n.some(r=>r.includes("No enemy at target.")),s=e.hasSpear===!0&&!e.spearPosition;return a&&s}},{id:"spear_wall_block",title:"Spear Wall Block",description:"Spear throw is blocked by walls.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["projectile","wall","boundary"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),e.setTile({q:4,r:4,s:-8},"wall"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:4,r:3,s:-7})},verify:(e,n)=>{const a=n.some(c=>c.includes("No clear line of sight to enemy.")),s=!!e.enemies.find(c=>c.id==="target"),r=e.hasSpear===!0&&!e.spearPosition;return a&&s&&r}}]},Qx={id:"dash",name:"Dash",description:"Tests for dash mechanics including path validation and shield-based enemy shunting",scenarios:[{id:"dash_shunt_lava",title:"Shunt into Lava",description:"Shunt an enemy into lava for an environmental kill.",relatedSkills:["DASH"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:5,s:-8},["DASH"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"victim"),e.setTile({q:7,r:5,s:-12},"lava"),e.state.hasShield=!0},run:e=>{e.useSkill("DASH",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="victim"),s={playerPosition:e.player.position.q===5&&e.player.position.r===5,victimDead:!a};return Object.values(s).some(r=>r===!1)&&(console.log(" Dash Shunt Lava Failed:",s),console.log("Final State:",e.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",n)),Object.values(s).every(r=>r===!0)}},{id:"dash_comprehensive_validation",title:"Dash: Constraints & Shunt Physics",description:"Validates range limits, wall blocking, and Shield Shunt displacement in one sequence.",relatedSkills:["DASH"],category:"movement",difficulty:"advanced",isTutorial:!1,tags:["stress-test","collision","range"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["DASH"]),e.state.hasShield=!0,e.setTile({q:4,r:4,s:-8},"wall"),e.setTile({q:6,r:5,s:-11},"wall"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"victim")},run:e=>{e.useSkill("DASH",{q:4,r:7,s:-11}),e.useSkill("DASH",{q:7,r:4,s:-11}),e.useSkill("DASH",{q:6,r:6,s:-12}),e.useSkill("DASH",{q:4,r:5,s:-9})},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="victim"),s={finalPositionCorrect:e.player.position.q===4&&e.player.position.r===6,victimPushed:!!(a&&a.position.q===4&&a.position.r===5),wallErrorFound:n.some(r=>r.includes("wall blocks")),axialRangeErrorFound:n.some(r=>r.includes("Axial only!")),shuntSuccess:n.some(r=>r.includes("Shield Shunt")),twoTurnSpent:e.turnsSpent===2};return Object.values(s).some(r=>r===!1)&&(console.log(" Dash Stress Test Failed:",s),console.log("Final State:",e.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",n)),Object.values(s).every(r=>r===!0)}}]},Zx={id:"jump",name:"Jump",description:"Tests for jump mechanics including range validation and stunning landing",scenarios:[{id:"jump_basic",title:"Basic Jump",description:"Jump to a tile.",relatedSkills:["JUMP"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","leap"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.setTile({q:3,r:5,s:-8},"lava")},run:e=>{e.useSkill("JUMP",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=ee(e.player.position,{q:3,r:4,s:-7}),s=Bd(e.occupancyMask,{q:3,r:4}),r=!Bd(e.occupancyMask,{q:3,r:6}),c={playerInPosition:a,spatialMaskRefreshed:s&&r,noLavaDamage:e.player.hp===e.player.maxHp,jumpedSuccessfully:n.some(u=>u.includes("Jumped"))};return Object.values(c).some(u=>u===!1)&&(console.error(" Jump Basic Failed:",c),console.error("Final State:",e.player.position),console.error("Logs:",n)),Object.values(c).every(u=>u===!0)}},{id:"jump_stunning_landing",title:"Stunning Landing",description:"Jump into a group of enemies and ensure neighbors are stunned.",relatedSkills:["JUMP"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["movement","stun","aoe"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.addUpgrade("JUMP","STUNNING_LANDING"),e.spawnEnemy("footman",{q:3,r:7,s:-10},"neighbor_1"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"neighbor_2"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"distant_enemy")},run:e=>{e.useSkill("JUMP",{q:3,r:8,s:-11})},verify:(e,n,a=[])=>{const s={n1StunnedMessage:n.some(r=>r.includes("stunned by landing impact")),hasShakeJuice:a.some(r=>r.type==="shake"),hasStunBurstVFX:a.some(r=>r.type==="vfx"&&r.payload.type==="stunBurst"),hasStunnedCombatText:a.some(r=>r.type==="combat_text"&&r.payload.text==="STUNNED"),playerAtTarget:ee(e.player.position,{q:3,r:8,s:-11}),oneTurnSpent:e.turnsSpent===1};return Object.values(s).some(r=>r===!1)&&(console.error(" Jump Stunning Landing Failed:",s),console.error("Final State:",e.player.position),console.error("turnsSpent:",e.turnsSpent),console.error("Logs:",n)),Object.values(s).every(r=>r===!0)}}]},eA={id:"shield_bash",name:"Shield Bash",description:"Tests for shield bash mechanics including push, stun, and collision behavior",scenarios:[{id:"bash_push",title:"Shield Push",description:"Push an enemy into lava.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","lava"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.setTile({q:3,r:4,s:-7},"lava"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,n)=>{const a={enemyGone:e.enemies.length===0,messageOk:n.some(s=>s.includes("Lava"))};return Object.values(a).some(s=>s===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",n)),Object.values(a).every(s=>s===!0)}},{id:"bash_wall_stun",title:"Wall Slam Stun",description:"Bash enemy into wall to cause a stun.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"victim"),e.setTile({q:3,r:4,s:-7},"wall")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="victim");if(!a)return!1;const s=ee(a.position,{q:3,r:5,s:-8}),r=n.some(c=>c.includes("into obstacle"));return s&&r}}]},tA={id:"bulwark_charge",name:"Bulwark Charge",description:"Tests for bulwark charge mechanics including chain pushing and wall slamming",scenarios:[{id:"chain_stun",title:"The Chain-Stun",description:"Wall prevents chain movement, causing all members to be stunned.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["chain","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,n)=>!0},{id:"bulwark_chain_push",title:"Bulwark Chain Push",description:"Push a chain of enemies successfully.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["chain","push","displacement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"A"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"B"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,n)=>!0}]},nA={id:"vault",name:"Vault",description:"Tests for vault mechanics including state-shifting behavior between odd and even turns",scenarios:[{id:"vault_shift_stun",title:"Vault Stun (Odd Turn)",description:"Verify vault stuns neighbors on Turn 1.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","stun","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>{const a={stunned:n.some(s=>s.includes("Stun Vault executed!"))};return Object.values(a).some(s=>s===!1)&&(console.log(" Vault Stun Failed:",a),console.log("Logs:",n)),Object.values(a).every(s=>s===!0)}},{id:"vault_shift_normal",title:"Vault Normal (Even Turn)",description:"Verify vault is normal on Turn 2.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:3,s:-7},"victim")},run:e=>{e.wait(),e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>{const a={vaulted:n.some(s=>s.includes("Vaulted!"))};return Object.values(a).some(s=>s===!1)&&(console.log(" Vault Normal Failed:",a),console.log("Logs:",n)),Object.values(a).every(s=>s===!0)}}]},iA={id:"basic_move",name:"Basic Move",description:"Fundamental movement mechanics",scenarios:[{id:"walk_to_tile",title:"Movement 101",description:"Move your character from the center to an adjacent tile.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","basics"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.setTile({q:4,r:6,s:-10},"wall")},run:e=>{e.move({q:4,r:6,s:-10}),e.move({q:4,r:4,s:-8})},verify:(e,n)=>{const a={positionCorrect:ee(e.player.position,{q:4,r:4,s:-8}),logFound:n.some(s=>s.includes("blocked")),oneTurnSpent:e.turnsSpent===1};return Object.values(a).some(s=>s===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Final Position:",e.player.position),console.log("Logs found:",n)),Object.values(a).every(s=>s===!0)}},{id:"free_move_out_of_combat",title:"Exploration Mode",description:"Verify that movement range expands only when no enemies are present.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["movement","exploration","free-move"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE","BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim")},run:e=>{e.move({q:7,r:1,s:-8}),e.useSkill("BASIC_ATTACK",{q:3,r:5,s:-8}),e.move({q:7,r:1,s:-8})},verify:(e,n)=>{const a=n.filter(c=>c.toLowerCase().includes("out of reach")).length,s=n.some(c=>c.toLowerCase().includes("you attacked")),r={wasBlockedInitially:a===1,attackLogs:s,reachedDistantHex:ee(e.player.position,{q:7,r:1,s:-8})};return Object.values(r).some(c=>c===!1)&&(console.log(" Free Move Scenario Failed:",r),console.log("Final Position:",e.player.position),console.log("Logs found:",n)),Object.values(r).every(c=>c===!0)}},{id:"invalid_enemy_move_intent_is_rejected_pre_execution",title:"Move Intent Rejected Before Execution",description:"Enemy AI may decide to move, but execution must not run a skill the actor does not own.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["movement","validation","intent"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"attacker_without_move");const n=e.getEnemy("attacker_without_move");n&&(n.activeSkills=(n.activeSkills||[]).filter(a=>a.id!=="BASIC_MOVE"))},run:e=>{e.wait()},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="attacker_without_move"),s={enemyDidNotMove:!!a&&ee(a.position,{q:7,r:5,s:-12}),noMissingSkillRuntimeError:!n.some(r=>r.includes("does not have skill BASIC_MOVE"))};return Object.values(s).some(r=>r===!1)&&(console.log("Invalid Enemy Move Intent Rejection Failed:",s),console.log("Enemy:",a),console.log("Logs:",n)),Object.values(s).every(r=>r===!0)}},{id:"single_enemy_single_action_per_turn",title:"Single Action Per Actor Turn",description:"Each actor resolves exactly one action per turn in normal flow.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["turn-loop","movement","integrity"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"single_actor")},run:e=>{e.wait()},verify:(e,n)=>{const a={q:7,r:5,s:-12},s=e.enemies.find(u=>u.id==="single_actor"),r=s?me(a,s.position):-1,c={enemyExists:!!s,movedExactlyOneTile:r===1,noZeroEffectMoveWarning:!n.some(u=>u.includes("produced ZERO effects"))};return Object.values(c).some(u=>u===!1)&&(console.log("Single Action Per Actor Turn Failed:",c),console.log("Enemy:",s),console.log("Logs:",n)),Object.values(c).every(u=>u===!0)}}]},sa=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},SENTINEL_TELEGRAPH:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Telegraph",description:"Marks blast zone."},SENTINEL_BLAST:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Blast",description:"Massive area blast."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},aA={id:"sentinel_blast",name:"Sentinel Blast",description:"Sentinel unique area-of-effect attack",scenarios:[{id:"blast_aoe",title:"Blast Away",description:"Use Sentinel Blast to hit multiple enemies.",relatedSkills:["SENTINEL_BLAST"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["aoe","damage","sentinel"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SENTINEL_BLAST"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"center"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"side")},run:e=>{e.useSkill("SENTINEL_BLAST",{q:3,r:5,s:-8})},verify:(e,n)=>n.some(a=>a.includes("massive blast"))},{id:"sentinel_playlist_two_turn_timing",title:"Playlist: Telegraph then Execute",description:"Boss uses a 2-turn skill playlist: telegraph first, blast on next turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["boss","playlist","telegraph"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const n=e.getEnemy("boss");n&&(n.activeSkills=[sa("BASIC_MOVE"),sa("BASIC_ATTACK"),sa("SENTINEL_TELEGRAPH"),sa("SENTINEL_BLAST")])},run:e=>{e.wait(),e.logs.push(`HP_AFTER_TELEGRAPH=${e.state.player.hp}`),e.wait()},verify:(e,n)=>{const a=n.find(c=>c.startsWith("HP_AFTER_TELEGRAPH=")),s=a?Number(a.split("=")[1]):-1,r={telegraphEmitted:n.some(c=>c.includes("marks the impact zone")),executeEmitted:n.some(c=>c.includes("massive blast")),noDamageOnTelegraphTurn:s===e.player.maxHp,damageOnExecuteTurn:e.player.hp<e.player.maxHp};return Object.values(r).some(c=>c===!1)&&(console.log("Sentinel Playlist Timing Failed:",r),console.log("Logs:",n),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(r).every(c=>c===!0)}},{id:"sentinel_playlist_interruption_by_stun",title:"Playlist: Interruption Cancels Execute",description:"Stunning the boss during telegraph cancels the follow-up execute turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["boss","playlist","interruption","stun"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const n=e.getEnemy("boss");n&&(n.activeSkills=[sa("BASIC_MOVE"),sa("BASIC_ATTACK"),sa("SENTINEL_TELEGRAPH"),sa("SENTINEL_BLAST")])},run:e=>{e.wait(),e.applyStatus("boss","stunned",1),e.wait()},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="boss"),s={telegraphEmitted:n.some(r=>r.includes("marks the impact zone")),executeCancelled:!n.some(r=>r.includes("massive blast")),playerUnharmed:e.player.hp===e.player.maxHp,bossStillExists:!!a};return Object.values(s).some(r=>r===!1)&&(console.log("Sentinel Playlist Interruption Failed:",s),console.log("Logs:",n),console.log("Player HP:",e.player.hp,"/",e.player.maxHp),console.log("Boss:",a)),Object.values(s).every(r=>r===!0)}}]},sA={id:"fireball",name:"Fireball",description:"Validates axial targeting, AoE damage, and environmental fire placement.",scenarios:[{id:"fireball_axial_aoe",title:"Axial Alignment & AoE Spread",description:"Verify the skill only fires axially and damages all neighbors at the impact site.",relatedSkills:["FIREBALL"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["aoe","axial","fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["FIREBALL"]),e.spawnEnemy("footman",{q:5,r:4,s:-9},"primary_target"),e.spawnEnemy("footman",{q:6,r:4,s:-10},"neighbor_target"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"diagonal_enemy"),e.setTile({q:6,r:3,s:-9},"wall"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava")},run:e=>{e.useSkill("FIREBALL",{q:7,r:5,s:-12}),e.useSkill("FIREBALL",{q:5,r:4,s:-9})},verify:()=>!0},{id:"fireball_max_range_edge",title:"Max Range & Fire Duration",description:"Verify fireball at exactly range 3 and check fire duration persistence.",relatedSkills:["FIREBALL"],category:"balancing",difficulty:"intermediate",isTutorial:!1,tags:["range","persistence"],setup:e=>{e.setPlayer({q:0,r:0,s:0},["FIREBALL"]),e.setTile({q:0,r:3,s:-3},"grass")},run:e=>{e.useSkill("FIREBALL",{q:0,r:3,s:-3}),e.wait(),e.wait()},verify:()=>!0}]},oA={id:"hazards_v1",name:"Hazard Consolidation",description:"Verifies centralized hazard logic and flight immunity",scenarios:[{id:"Jump Over Lava",title:"Jump Over Lava",description:"Jumping over lava should not result in damage.",relatedSkills:["JUMP"],category:"hazards",tags:["lava","jump"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["JUMP"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("JUMP",{q:4,r:7,s:-11})},verify:e=>{const n=e.player,a={playerPos:ee(n.position,{q:4,r:7,s:-11}),isAlive:n.hp===n.maxHp};return Object.values(a).every(s=>s===!0)}},{id:"Walk Into Lava",title:"Walk Into Lava",description:"Walking into lava should be invalid unless the mover is hazard-safe.",relatedSkills:["BASIC_MOVE"],category:"hazards",tags:["lava","walk"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["BASIC_MOVE"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:8,s:-12})},verify:e=>{const n=e.player,a={playerPos:ee(n.position,{q:4,r:9,s:-13}),hpUnchanged:n.hp===n.maxHp};return Object.values(a).every(s=>s===!0)}},{id:"Falcon Flying Over Lava",title:"Falcon Flying Over Lava",description:"Flying units (Falcon) should ignore lava during transit and stay.",relatedSkills:["FALCON_COMMAND"],category:"hazards",tags:["lava","falcon","flight"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.wait()},verify:e=>{const n=e.enemies.find(s=>s.id==="my-falcon"),a={falconExists:!!n,falconAlive:(n?.hp||0)>0,falconPos:ee(n?.position,{q:4,r:8,s:-12})};return Object.values(a).every(s=>s===!0)}}]},rA={id:"falcon_command_v2",name:"Falcon's Command",description:"Validates Predator/Scout mode transitions and spatial orbit logic.",scenarios:[{id:"falcon_predator_strike_path",title:"Predator Mode: Apex Strike Geometry",description:`
                Tests the Falcon's flight path from its current position to the Target.
                Layout:
                   (F)  <- Falcon Start (6, 5, -11)
                      .
                         (T) <- Target/Prey (8, 5, -13)
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:2,s:-6},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:2,s:-6}),e.wait()},verify:(e,n)=>{const a=e.companions?.find(c=>c.id==="my-falcon"),s=e.enemies.find(c=>c.id==="prey"),r={modeSet:a?.companionState?.mode==="predator",targetLocked:a?.companionState?.markTarget==="prey",movedCloser:a&&me(a.position,{q:4,r:2,s:-6})<7,preyHealthy:s?.hp===s?.maxHp,turnSpent:e.turnsSpent===2};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Falcon Predator Strike Failed:",r),console.log("Falcon:",a)),Object.values(r).every(c=>c===!0)}},{id:"falcon_scout_orbit",title:"Scout Mode: Hex Ring Orbit",description:`
                Ensures that in Scout mode, the Falcon rotates around the mark 
                on the flat-top hex ring.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:3,r:6,s:-9}),e.wait(),e.wait()},verify:(e,n)=>{const a=e.companions?.find(c=>c.id==="my-falcon"),s={q:3,r:6,s:-9},r={isScout:a?.companionState?.mode==="scout",onOrbitRing:a&&me(a.position,s)===1,hasRotated:a&&!!a.previousPosition&&!ee(a.position,a.previousPosition),turnSpent:e.turnsSpent===3};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Falcon Scout Orbit Failed:",r),console.log("Falcon:",a)),Object.values(r).every(c=>c===!0)}},{id:"falcon_roost_mode",title:"Roost Mode: Return and Heal",description:`
                Ensures that when targeting self, the Falcon returns to the Hunter
                and provides a heal on arrival.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","roost","heal"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=2,e.spawnFalcon({q:3,r:6,s:-9},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:9,s:-13}),e.wait(),e.wait()},verify:(e,n)=>{const a=e.companions?.find(c=>c.id==="my-falcon"),s=e.player,r={modeRoost:a?.companionState?.mode==="roost",healed:s.hp>2,closeToHunter:a&&me(a.position,s.position)<=1};return Object.values(r).some(c=>c===!1)&&console.log(" Scenario Falcon Roost Heal Failed:",r),Object.values(r).every(c=>c===!0)}},{id:"falcon_predator_auto_return",title:"Predator Mode: Auto-Roost on Kill",description:`
                Ensures that if a marked predator target dies, the Falcon
                automatically reverts to Roost mode.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!0,tags:["falcon","predator","cleanup"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=1,e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:7,s:-11}),e.wait(),e.wait(),e.wait()},verify:(e,n)=>{const a=e.companions?.find(u=>u.id==="my-falcon"),s=e.enemies.find(u=>u.id==="prey"),r=e.player,c={preyDead:!s,autoRoost:a?.companionState?.mode==="roost",healed:r.hp>1};return Object.values(c).some(u=>u===!1),Object.values(c).every(u=>u===!0)}},{id:"falcon_command_metadata_null_safety",title:"Command Metadata Null-Safety",description:`
                Ensures FALCON_COMMAND name/description resolution is safe
                when player context is remapped in harness-like states.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["falcon","null-safety","metadata"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.id="hunter_remapped"},run:e=>{e.wait()},verify:(e,n)=>{const a={playerIdRemapped:e.player.id==="hunter_remapped",noRuntimeReferenceError:!n.some(s=>s.toLowerCase().includes("cannot read properties"))};return Object.values(a).some(s=>s===!1)&&console.log("Falcon Command Metadata Null-Safety Failed:",a),Object.values(a).every(s=>s===!0)}}]},lA={id:"kinetic_tri_trap",name:"Kinetic Tri-Trap",description:"Tests for trap deployment and fling mechanics",scenarios:[{id:"tri_trap_basic_deployment",title:"Trap Deployment",description:"Deploy 3 traps on axial tiles at range 2.",relatedSkills:["KINETIC_TRI_TRAP"],category:"deployment",difficulty:"beginner",isTutorial:!0,tags:["trap","deployment"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.player.position,s=e.traps||[],r={countIsThree:s.length===3,isAtRangeTwo:s.every(c=>me(c.position,a)===2),isAxialToPlayer:s.every(c=>c.position.q===a.q||c.position.r===a.r||c.position.s===a.s),trapsHidden:s.every(c=>!c.isRevealed)};return Object.values(r).some(c=>c===!1)&&(console.log(" Scenario Tri-Trap Deployment Failed:",r),console.log("Traps:",e.traps),console.log("Logs:",n)),Object.values(r).every(c=>c===!0)}},{id:"tri_trap_state_tracking",title:"Trap State Tracking",description:"Traps are tracked with correct owner and hidden state.",relatedSkills:["KINETIC_TRI_TRAP"],category:"state",difficulty:"intermediate",isTutorial:!1,tags:["trap","state"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10}),e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,n)=>{const a=e.traps,s={trapsExist:a&&a.length>0,allHidden:a?.every(r=>!r.isRevealed)??!1,allZeroCooldown:a?.every(r=>r.cooldown===0)??!1,deployMessage:n.some(r=>r.includes("trap")||r.includes("Trap")),trapsCount:a?.length===3};return Object.values(s).some(r=>r===!1)&&(console.log(" Trap State Failed:",s),console.log("Traps:",e.traps)),Object.values(s).every(r=>r===!0)}}]},cA={id:"withdrawal",name:"Withdrawal",description:"Tests for shot + backroll mechanics and passive reaction",scenarios:[{id:"withdrawal_basic",title:"Shot and Backroll",description:"Shoot adjacent enemy and backroll to safety.",relatedSkills:["WITHDRAWAL"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["shot","backroll","displacement"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="target"),s={enemyDamagedOrDead:!a||a.hp<a.maxHp,playerMoved:e.player.position.q!==5||e.player.position.r!==5,playerBackrolled:e.player.position.q<5,shotFired:n.some(r=>r.includes("Withdrawal")||r.includes("shot"))};return Object.values(s).some(r=>r===!1)&&(console.log(" Withdrawal Failed:",s),console.log("Player:",e.player.position),console.log("Target HP:",a?.hp)),Object.values(s).every(r=>r===!0)}},{id:"withdrawal_wall_block",title:"Backroll Blocked by Wall",description:"Backroll finds alternate safe spot when wall blocks retreat.",relatedSkills:["WITHDRAWAL"],category:"collision",difficulty:"intermediate",isTutorial:!1,tags:["backroll","wall","pathfinding"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.setTile({q:4,r:5,s:-9},"wall"),e.setTile({q:3,r:5,s:-8},"wall"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,n)=>{const a={playerNotOnWall:!ee(e.player.position,{q:4,r:5,s:-9}),playerMoved:e.player.position.q!==5||e.player.position.r!==5};return Object.values(a).some(s=>s===!1)&&(console.log(" Wall Block Failed:",a),console.log("Player:",e.player.position)),Object.values(a).every(s=>s===!0)}}]},uA={id:"absorb_fire",name:"Absorb Fire Passive",description:"Verifies that fire damage is converted to healing.",scenarios:[{id:"Absorb Fire Damage",title:"Stand on Fire",description:"Player with Absorb Fire should be healed when standing on fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",tags:["fire","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE"]),e.state.player.hp=1,e.setTile({q:4,r:5,s:-9},"stone");const n={q:4,r:5,s:-9},a=e.getTileAt(n);a&&a.effects.push({id:"FIRE",duration:3,potency:1})},run:e=>{e.wait()},verify:e=>{const n=e.player;return n.hp<=1&&console.log("Stand on Fire Failed: HP did not increase",n.hp),n.hp>1}},{id:"Absorb Lava Damage",title:"Walk into Lava",description:"Player with Absorb Fire should be healed when walking into lava.",relatedSkills:["ABSORB_FIRE","BASIC_MOVE"],category:"passive",tags:["lava","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE","BASIC_MOVE"]),e.state.player.hp=1,e.setTile({q:4,r:6,s:-10},"lava")},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:6,s:-10})},verify:e=>{const n=e.player,a={alive:n.hp>0,healed:n.hp===n.maxHp,onLava:ee(n.position,{q:4,r:6,s:-10})};return(!a.alive||!a.healed||!a.onLava)&&(console.log("Walk into Lava Failed:",a,"HP:",n.hp,"MaxHP:",n.maxHp),console.log("Player Pos:",n.position)),Object.values(a).every(s=>s===!0)}}]},dA={id:"tile_interactions",name:"Tile Interactions",description:"Verifies interactions with special tiles like Shrines and Stairs.",scenarios:[{id:"shrine_interaction",title:"Shrine Interaction",description:"Moving onto a shrine should trigger an upgrade choice.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["shrine","upgrade"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.shrinePosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"SHRINE",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","SHRINE"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const n={playerOnShrine:ee(e.player.position,{q:4,r:6,s:-10}),isChoosingUpgrade:e.pendingStatus?.status==="choosing_upgrade",hasOptions:e.pendingStatus?.shrineOptions?.length>0};return Object.values(n).every(a=>a===!0)}},{id:"stairs_interaction",title:"Stairs Interaction",description:"Moving onto stairs should trigger level transition.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["stairs","portal"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.stairsPosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"STAIRS",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","STAIRS"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const n={playerOnStairs:ee(e.player.position,{q:4,r:6,s:-10}),isTransitioning:e.pendingStatus?.status==="playing"||e.pendingStatus?.status==="won",messageFound:e.message.some(a=>a.includes("Descending")||a.includes("Cleared"))};return Object.values(n).every(a=>a===!0)}}]},fA={id:"telegraph_projection",name:"Telegraph Projection",description:"Deterministic intent previews for next-turn danger tiles.",scenarios:[{id:"telegraph_projection_is_deterministic",title:"Projection Determinism",description:"Same state should always produce the same danger projection.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","determinism"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"threat")},run:e=>{e.wait()},verify:e=>{const n=e.intentPreview,a=n?.dangerTiles||[],s=n?.projections||[],r=a.map(f=>`${f.q},${f.r},${f.s}`),c=new Set(r),u=r.every((f,b)=>b===0||r[b-1].localeCompare(f)<=0),p=s.map(f=>`${f.actorId}|${f.skillId}|${f.targetHex?`${f.targetHex.q},${f.targetHex.r},${f.targetHex.s}`:"none"}`),g=p.every((f,b)=>b===0||p[b-1].localeCompare(f)<=0),m={hasEnginePreview:!!n,noDuplicateTiles:c.size===r.length,tilesAreSorted:u,projectionsAreSorted:g};return Object.values(m).some(f=>f===!1)&&(console.log("Telegraph Projection Determinism Failed:",m),console.log("Engine Preview:",n)),Object.values(m).every(f=>f===!0)}},{id:"telegraph_projection_matches_execute_footprint",title:"Projection Matches Execute Footprint",description:"Projected danger tiles should include the tile actually damaged on execution.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","parity","combat"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:4,r:2,s:-6},"threat")},run:e=>{e.wait();const s=e.state.intentPreview?.projections?.find(r=>r.actorId==="threat")?.dangerTiles?.[0];s?e.logs.push(`PREVIEW_TILE=${s.q},${s.r},${s.s}`):e.logs.push("PREVIEW_TILE=none"),e.wait()},verify:(e,n)=>{const a=e.enemies.find(p=>p.id==="threat"),r=n.find(p=>p.startsWith("PREVIEW_TILE="))?.split("=")[1]||"none",c=r==="none"?void 0:(()=>{const[p,g,m]=r.split(",").map(f=>Number(f));return{q:p,r:g,s:m}})(),u={previewProducedTile:!!c,projectedTileMatchesExecute:!!c&&!!a&&ee(a.position,c)};return Object.values(u).some(p=>p===!1)&&(console.log("Telegraph Projection Parity Failed:",u),console.log("Logs:",n),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(u).every(p=>p===!0)}}]},yd=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},DASH:{slot:"passive",range:4,cooldown:0,name:"Kinetic Dash",description:"Dash in a straight line."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},mA={id:"raider_dash",name:"Raider Dash",description:"Parity checks for enemy Raider reusing the player DASH contract.",scenarios:[{id:"player_dash_stops_before_adjacent_enemy",title:"Parity Baseline: Player Dash Stops Before Blocker",description:"Player DASH should stop on the tile before an occupied target.",relatedSkills:["DASH"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["parity","dash","reuse"],setup:e=>{e.setPlayer({q:4,r:2,s:-6},["DASH"]),e.spawnEnemy("footman",{q:4,r:6,s:-10},"blocker"),e.state.hasShield=!1},run:e=>{e.useSkill("DASH",{q:4,r:6,s:-10})},verify:(e,n)=>{const a={playerStoppedBeforeBlocker:e.player.position.q===4&&e.player.position.r===5,dashResolved:n.some(s=>s.includes("Stopped by an obstacle")||s.includes("Dashed!")||s.includes("Shield Shunt"))};return Object.values(a).every(s=>s===!0)}},{id:"raider_ai_uses_dash_with_player_contract",title:"Parity: Raider Uses Same Dash Stop Rule",description:"Raider AI selects DASH and lands on the same stop tile as player-owned DASH in mirrored geometry.",relatedSkills:["DASH"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","dash"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("raider",{q:4,r:2,s:-6},"raider"),e.state.hasShield=!1;const n=e.getEnemy("raider");n&&(n.activeSkills=[yd("BASIC_MOVE"),yd("BASIC_ATTACK"),yd("DASH")])},run:e=>{e.wait()},verify:(e,n)=>{const a=e.enemies.find(r=>r.id==="raider"),s={raiderStillAlive:!!a,raiderStoppedBeforePlayer:!!a&&a.position.q===4&&a.position.r===5,playerUnharmed:e.player.hp===e.player.maxHp,dashResolved:n.some(r=>r.includes("Stopped by an obstacle")||r.includes("Dashed!")||r.includes("Shield Shunt"))};return Object.values(s).every(r=>r===!0)}}]},gd=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},GRAPPLE_HOOK:{slot:"offensive",range:4,cooldown:0,name:"Grapple Hook",description:"Pull and swap with target."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},pA={id:"pouncer_hook",name:"Pouncer Hook",description:"Second archetype reuse: enemy uses player GRAPPLE_HOOK via normal skill execution.",scenarios:[{id:"pouncer_uses_grapple_hook_deterministically",title:"Pouncer Uses Grapple Hook Through Skill Pipeline",description:"Pouncer selects GRAPPLE_HOOK from AI and resolves via standard USE_SKILL execution.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","determinism"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("pouncer",{q:4,r:2,s:-6},"pouncer");const n=e.getEnemy("pouncer");n&&(n.activeSkills=[gd("BASIC_MOVE"),gd("BASIC_ATTACK"),gd("GRAPPLE_HOOK")])},run:e=>{e.wait()},verify:(e,n)=>{const s={pouncerStillAlive:!!e.enemies.find(r=>r.id==="pouncer"),grappleExecuted:n.filter(r=>r.includes("Vaulted and Flung!")).length>=1,deterministicStatus:n.filter(r=>r.includes("You are stunned!")).length===1,noZeroEffectWarning:!n.some(r=>r.includes("produced ZERO effects"))};return Object.values(s).every(r=>r===!0)}}]},hA={id:"ice",name:"Ice Terrain",description:"ICE/SLIPPERY terrain behavior for pass-through momentum and landing slide.",scenarios:[{id:"ice_pass_preserves_dash_momentum",title:"Ice Pass: Dash Carries Momentum",description:"Passing through ICE during DASH should preserve momentum and carry movement beyond nominal target.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","ice","momentum","pass"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:6,r:4,s:-10})},verify:e=>e.player.position.q>6},{id:"ice_land_slides_after_basic_move",title:"Ice Land: Basic Move Slides Forward",description:"Landing on ICE with BASIC_MOVE should slide one hex in the move direction when the next tile is walkable.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["terrain","ice","slide","land"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_MOVE"]),e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor")},run:e=>{e.move({q:5,r:4,s:-9})},verify:e=>e.player.position.q===6&&e.player.position.r===4}]},yA={id:"snare",name:"Snare Terrain",description:"Snare tile effect movement restriction and status interaction.",scenarios:[{id:"snare_interrupts_dash_and_roots_actor",title:"Snare Interrupts Dash",description:"DASH into a snare tile should halt movement at snare and apply rooted status.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","snare","movement-restriction"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.state.tiles.set("5,4",{baseId:"STONE",position:{q:5,r:4,s:-9},traits:new Set(["WALKABLE"]),effects:[{id:"SNARE",duration:-1,potency:1}]}),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:7,r:4,s:-11})},verify:(e,n)=>{const a=e.player.statusEffects.some(r=>r.type==="rooted"),s={stoppedAtSnare:e.player.position.q===5&&e.player.position.r===4,rootedApplied:a,snareMessageLogged:n.some(r=>r.includes("Snared! Movement halted."))};return Object.values(s).every(r=>r===!0)}}]},gA={id:"relics",name:"Relics",description:"Passive relic behaviors using existing engine hooks only.",scenarios:[{id:"relic_ember_ward_reduces_fire_damage",title:"Relic: Ember Ward",description:"Equipping Ember Ward reduces incoming fire damage by 1.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"beginner",isTutorial:!1,tags:["relic","fire","passive"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_EMBER_WARD"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,n)=>{const a={hpUnchanged:e.player.hp===e.player.maxHp,relicMessageSeen:n.some(s=>s.includes("Ember Ward dampens the flames."))};return Object.values(a).every(s=>s===!0)}},{id:"relic_cinder_orb_stacks_with_absorb_fire",title:"Relic: Cinder Orb Stacking",description:"Cinder Orb adds bonus healing when fire damage is converted by Absorb Fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",difficulty:"advanced",isTutorial:!1,tags:["relic","stacking","absorb-fire"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["ABSORB_FIRE"]),e.state.player={...e.state.player,hp:1,maxHp:3},e.state.upgrades=[...e.state.upgrades||[],"RELIC_CINDER_ORB"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,n)=>{const a={healedByStacking:e.player.hp===3,stackingMessageSeen:n.some(s=>s.includes("Cinder Orb amplifies the absorption."))};return Object.values(a).every(s=>s===!0)}},{id:"relic_steady_plates_end_to_end",title:"Relic: Steady Plates",description:"Steady Plates grants turn-start armor that resolves against incoming damage in the same round.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"intermediate",isTutorial:!1,tags:["relic","armor","turn-start"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_STEADY_PLATES"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,n)=>{const a={playerHpProtected:e.player.hp===e.player.maxHp,damageEventOccurred:n.some(s=>s.includes("player burns!")),armorPresentAfterCycle:e.player.temporaryArmor>=0&&e.player.temporaryArmor<=2,relicTriggerMessageSeen:n.some(s=>s.includes("Steady Plates harden your stance."))};return Object.values(a).every(s=>s===!0)}}]},bA=250,vA=700,SA=100,xA=8,AA=220,TA=260,EA=40,o0=(e,n)=>{const a=e.floor||0,s=e.player?.hp||0,r=e.turnsSpent??e.turnNumber??0,c=e.kills||0,u=e.environmentalKills||0,p=e.hazardBreaches||0,g=(n||[]).filter(m=>m.success).length*bA;return a*vA+s*SA+c*AA+u*TA-r*xA-p*EA+g},_A=e=>{if(typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const n=e instanceof Date?e:new Date,a=n.getFullYear(),s=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${a}-${s}-${r}`},wA=e=>`daily:${e}`,MA=e=>{const n=18+Math.floor(Bl(e,0)*8);return[{id:"TURN_LIMIT",label:`Finish within ${n} turns`,target:n},{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}]},kl=e=>(e.runObjectives||[]).map(a=>{if(a.id==="TURN_LIMIT"){const r=e.turnsSpent||0;return{...a,value:r,success:r<=a.target}}const s=e.hazardBreaches||0;return{...a,value:s,success:s<=a.target}}),jo=e=>{const n=e.initialSeed??e.rngSeed??"0",a=kl(e),s=e.combatScoreEvents||[],r=s.length?Number((s.reduce((u,p)=>u+p.efficiency,0)/s.length).toFixed(4)):0,c=s.filter(u=>u.riskBonusApplied).length;return{seed:n,actionLog:e.actionLog,score:o0(e,a),floor:e.floor,objectives:a,combatTelemetry:{events:s.length,avgEfficiency:r,riskBonusEvents:c}}},OA={id:"objectives",name:"Objectives",description:"Daily objective validation for turn-limit and hazard constraints.",scenarios:[{id:"objective_turn_limit_boundary",title:"Objective: Turn Limit Boundary",description:"Turn-limit objective passes at boundary and fails above boundary.",relatedSkills:["BASIC_MOVE"],category:"progression",difficulty:"intermediate",isTutorial:!1,tags:["objective","turn-limit"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"TURN_LIMIT",label:"Finish within 1 turns",target:1}]},run:e=>{e.wait()},verify:e=>{const a=kl(e)[0]?.success===!0,s=jo(e).score,r=kl({...e,turnsSpent:(e.turnsSpent||0)+1}),c={...e,turnsSpent:(e.turnsSpent||0)+1},u=jo(c).score,p=r[0]?.success===!1,g=u<s;return a&&p&&g}},{id:"objective_hazard_constraint_fail_on_hazard",title:"Objective: Hazard Constraint",description:"Hazard objective fails after prohibited hazard interaction.",relatedSkills:["BASIC_MOVE"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["objective","hazard"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:e=>{const n=kl(e)[0];return(e.hazardBreaches||0)>0&&!!n&&n.success===!1}}]},CA={id:"necromancer",name:"Necromancer",description:"Corpse persistence and summon migration contracts.",scenarios:[{id:"necromancer_corpse_persistence",title:"Corpse Persists Until Consumed",description:"Kill an enemy, wait 5 turns, then Raise Dead succeeds from corpse tile trait.",relatedSkills:["BASIC_ATTACK","RAISE_DEAD"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","corpse","persistence"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_ATTACK","RAISE_DEAD"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"dummy");const n=e.getEnemy("dummy");n&&(n.hp=1,n.maxHp=1)},run:e=>{const n={q:5,r:4,s:-9};e.useSkill("BASIC_ATTACK",n);for(let a=0;a<5;a++)e.wait();e.useSkill("RAISE_DEAD",n)},verify:e=>{const n=ue({q:5,r:4}),a=e.tiles.get(n),s=e.enemies.find(p=>p.subtype==="skeleton"&&p.factionId==="player"),r=e.companions?.find(p=>p.id===s?.id),c=new Set((s?.activeSkills||[]).map(p=>p.id)),u={corpseConsumed:!a?.traits?.has("CORPSE"),skeletonRaised:!!s,skeletonOnCorpseTile:!!s&&s.position.q===5&&s.position.r===4,companionRegistered:!!r,hasBasicLoadout:c.has("BASIC_MOVE")&&c.has("BASIC_ATTACK")};return Object.values(u).every(Boolean)}},{id:"summon_floor_transition",title:"Summon Persists Across Floor Transition",description:"Raised skeleton migrates with player to floor 2.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","summon","floor-transition"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["RAISE_DEAD"],"VANGUARD");const n={q:5,r:4,s:-9},a=ue(n),s=e.getTileAt(n);e.state.tiles.set(a,{...s,position:n,traits:new Set([...s?.traits||[],"CORPSE"])})},run:e=>{const n={q:5,r:4,s:-9};e.useSkill("RAISE_DEAD",n),e.state.player={...e.state.player,position:{...e.state.stairsPosition}},e.wait(),e.dispatchSync({type:"RESOLVE_PENDING"})},verify:e=>{const n=e.enemies.find(s=>s.subtype==="skeleton"&&s.factionId==="player"&&s.companionOf===e.player.id),a={floorAdvanced:e.floor===2,summonStillPresent:!!n,summonTracksOwner:!!n&&n.companionOf===e.player.id};return Object.values(a).every(Boolean)}},{id:"companion_does_not_block_free_move",title:"Companion Does Not Block Exploration Free Move",description:"Friendly skeleton companion should not count as hostile for BASIC_MOVE exploration range.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","companion","movement"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"friendly_skeleton");const n=e.getEnemy("friendly_skeleton");n&&(n.subtype="skeleton",n.factionId="player",n.companionOf=e.state.player.id,n.activeSkills=n.activeSkills||[],e.state.companions=[...e.state.companions||[],n])},run:e=>{e.move({q:7,r:1,s:-8})},verify:e=>{const n={movedFar:e.player.position.q===7&&e.player.position.r===1,turnsAdvanced:e.turnsSpent>=1};return Object.values(n).every(Boolean)}},{id:"raise_dead_pushes_ally_from_target_hex",title:"Raise Dead Pushes Ally Occupant",description:"If corpse tile is occupied by an ally, ally is displaced and summon succeeds without overlap.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","occupancy","push"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["RAISE_DEAD"],"VANGUARD");const n={q:5,r:5,s:-10},a=ue(n),s=e.getTileAt(n);e.state.tiles.set(a,{...s,position:n,traits:new Set([...s?.traits||[],"CORPSE"])}),e.spawnEnemy("footman",n,"ally_blocker");const r=e.getEnemy("ally_blocker");r&&(r.subtype="skeleton",r.factionId="player",r.companionOf=e.state.player.id,e.state.companions=[...e.state.companions||[],r])},run:e=>{e.useSkill("RAISE_DEAD",{q:5,r:5,s:-10})},verify:e=>{const n=e.enemies.filter(p=>p.subtype==="skeleton"&&p.factionId==="player"),a=new Set;let s=!1;n.forEach(p=>{const g=ue(p.position);a.has(g)&&(s=!0),a.add(g)});const r=n.some(p=>p.position.q===5&&p.position.r===5),c=n.some(p=>p.id==="ally_blocker"&&!(p.position.q===5&&p.position.r===5));return Object.values({raisedAtCorpse:r,pushedExists:c,noOverlap:!s}).every(Boolean)}}]},NA={id:"archer_shot",name:"Archer Shot",description:"Tests for dedicated archer ranged line-shot targeting, LoS, and axial validation.",scenarios:[{id:"archer_shot_clear_lane_hit",title:"Archer Shot: Clear Lane Hit",description:"A valid axial target in clear line of sight is damaged.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","line-of-sight","axial"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:3,r:4,s:-7},"target")},run:e=>{e.useSkill("ARCHER_SHOT",{q:3,r:4,s:-7})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="target"),s=!a||a.hp<a.maxHp,r=n.some(c=>c.includes("Archer shot!"));return s&&r}},{id:"archer_shot_wall_blocked",title:"Archer Shot: Wall Blocks Line of Sight",description:"Archer Shot fails when a wall blocks the line to the target actor.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","line-of-sight","wall"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),e.setTile({q:4,r:4,s:-8},"wall")},run:e=>{e.useSkill("ARCHER_SHOT",{q:4,r:3,s:-7})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="target"),s=!!a&&a.hp===a.maxHp,r=n.some(c=>c.includes("No clear line of sight"));return s&&r}},{id:"archer_shot_rejects_non_axial",title:"Archer Shot: Non-Axial Target Rejected",description:"Archer Shot enforces axial targeting and rejects diagonal targets.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","axial","targeting"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:4,r:4,s:-8},"target")},run:e=>{e.useSkill("ARCHER_SHOT",{q:4,r:4,s:-8})},verify:(e,n)=>{const a=e.enemies.find(c=>c.id==="target"),s=!!a&&a.hp===a.maxHp,r=n.some(c=>c.includes("Target must be axial"));return s&&r}}]};function kA(e){return{id:e.id,title:e.title,description:e.description,rationale:e.rationale,setup:e.setup,run:e.run,verify:e.verify}}const RA=[qx,zx,Vx,Yx,Xx,Jx,Qx,Zx,eA,tA,nA,oA,iA,aA,sA,rA,lA,cA,uA,dA,fA,mA,pA,hA,yA,gA,OA,CA,NA],IA=RA.flatMap(e=>e.scenarios);function LA(e){return IA.filter(n=>n.relatedSkills.includes(e))}function Qe(e){return LA(e).map(kA)}const BA={id:"ARCHER_SHOT",name:"Archer Shot",description:"Fire an arrow in a straight line at a hostile target.",slot:"offensive",icon:"",baseVariables:{range:4,cost:0,cooldown:0,damage:1},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};if(!Mt(n.position,a,4))return{effects:s,messages:["Out of range!"],consumesTurn:!1};const c=jn(n.position,a);if(!c.isAxial)return{effects:s,messages:["Target must be axial."],consumesTurn:!1};const u=ge(e,a);if(!u||u.id===n.id)return{effects:s,messages:["No target at location."],consumesTurn:!1};if(u.factionId===n.factionId)return{effects:s,messages:["Cannot target ally."],consumesTurn:!1};if(!Hl(e,n.position,a,u.id,n.id))return{effects:s,messages:["No clear line of sight."],consumesTurn:!1};const p=Ie(n),g=Ht({attackerId:n.id,targetId:u.id,skillId:"ARCHER_SHOT",basePower:1,trinity:p,targetTrinity:Ie(u),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]}),m=dt(n.position,a),f=g.finalPower>=4?"high":g.finalPower>=2?"medium":"low",b=c.directionIndex>=0?Pt(c.directionIndex):void 0;return s.push({type:"Juice",effect:"aimingLaser",target:a,intensity:"low",metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"anticipation",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},path:m,skillId:"ARCHER_SHOT",timing:{durationMs:70,ttlMs:90}}}),s.push({type:"Juice",effect:"spearTrail",path:m,target:a,intensity:f,metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"ARCHER_SHOT",timing:{delayMs:50,durationMs:80,ttlMs:110}}}),s.push({type:"Juice",effect:"lightImpact",target:u.id,intensity:f,direction:b,metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},contactRef:{kind:"contact_world"},contactHex:u.position,contactFromHex:n.position,contactToHex:u.position,skillId:"ARCHER_SHOT",timing:{delayMs:95,durationMs:60,ttlMs:110}}}),s.push({type:"Damage",target:u.id,amount:g.finalPower,reason:"archer_shot",scoreEvent:g.scoreEvent}),r.push("Archer shot!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ge(e,n);return a?[e.player,...e.enemies,...e.companions||[]].filter(r=>!!r&&r.hp>0).filter(r=>r.id!==a.id&&r.factionId!==a.factionId&&Mt(n,r.position,4)&&jn(n,r.position).isAxial&&Hl(e,n,r.position,r.id,a.id)).map(r=>r.position).filter((r,c,u)=>u.findIndex(p=>ee(p,r))===c):[]},upgrades:{},scenarios:Qe("ARCHER_SHOT")},ra=(e,n)=>{let a=n,s=e.temporaryArmor||0,r=e.hp;if(s>0){const c=Math.min(s,a);s-=c,a-=c}return r=Math.max(0,r-a),{...e,hp:r,temporaryArmor:s}},Pd=(e,n,a,s)=>{const c=MS[n]?.tickWindow||"END_OF_TURN",u=n.toUpperCase();if(e.statusEffects.find(m=>m.id===u))return{...e,statusEffects:e.statusEffects.map(m=>m.id===u?{...m,duration:Math.max(m.duration,a),tickWindow:c,stacks:s||m.stacks}:m)};const g={id:u,type:n,duration:a,tickWindow:c,stacks:s||1};return{...e,statusEffects:[...e.statusEffects,g]}},HA=(e,n)=>({...e,hp:Math.min(e.maxHp,e.hp+n)}),PA=(e,n,a=!0)=>{const s=e.maxHp+n,r=a?Math.min(s,e.hp+n):e.hp;return{...e,maxHp:s,hp:r}},jA=e=>{const n=[];return e.player.hp<=0&&e.gameStatus==="playing"&&n.push({type:"GameOver",reason:"PLAYER_DIED"}),n},xy=e=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(n=>({...n,currentCooldown:Math.max(0,n.currentCooldown-1)}))}:e,DA=(e,n,a)=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(s=>s.id===n&&!s.activeUpgrades.includes(a)?{...s,activeUpgrades:[...s.activeUpgrades,a]}:s)}:e,Ay=(e,n,a)=>{const s=a.preserveInputOrder===!1?[...n]:[...n].reverse(),r=a.describe||(()=>"UNKNOWN");let c=e;const u=[];let p=a.startTick||1;for(;s.length>0;){const g=s.length,m=s.pop();c=a.apply(c,m);const f=a.getReactions?.(c,m)||[];if(f.length>0)for(let b=f.length-1;b>=0;b--)s.push(f[b]);u.push({tick:p++,effectType:r(m),depthBefore:g,depthAfter:s.length,reactionsQueued:f.length})}return{state:c,trace:u,resolvedCount:u.length}},UA={ModifyCooldown:(e,n,a)=>{const s=c=>({...c,activeSkills:c.activeSkills?.map(u=>u.id!==n.skillId?u:{...u,currentCooldown:n.setExact?n.amount:Math.max(0,u.currentCooldown+n.amount)})}),r=a.sourceId||e.player.id;return r===e.player.id?{...e,player:s(e.player)}:{...e,enemies:e.enemies.map(c=>c.id===r?s(c):c),companions:e.companions?.map(c=>c.id===r?s(c):c)}},SetStealth:(e,n)=>{const a=s=>({...s,stealthCounter:(s.stealthCounter||0)+n.amount});return n.target==="self"?{...e,player:a(e.player)}:{...e,enemies:e.enemies.map(s=>s.id===n.target?a(s):s),companions:e.companions?.map(s=>s.id===n.target?a(s):s)}},UpdateCompanionState:(e,n,a)=>{const s=n.target==="self"?a.sourceId||e.player.id:n.target,r=c=>c.id!==s?c:{...c,companionState:{...c.companionState,mode:n.mode||c.companionState?.mode,markTarget:n.markTarget!==void 0?n.markTarget:c.companionState?.markTarget,orbitStep:n.mode==="scout"?0:c.companionState?.orbitStep,apexStrikeCooldown:n.apexStrikeCooldown!==void 0?n.apexStrikeCooldown:c.companionState?.apexStrikeCooldown,healCooldown:n.healCooldown!==void 0?n.healCooldown:c.companionState?.healCooldown}};return{...e,enemies:e.enemies.map(r),companions:e.companions?.map(r)}}},$A={SpawnCorpse:(e,n,a,s)=>s.addCorpseTraitAt(e,n.position),RemoveCorpse:(e,n,a,s)=>{const r=s.removeCorpseTraitAt(e,n.position);return{...r,dyingEntities:(r.dyingEntities||[]).filter(c=>!ee(c.position,n.position))}}},qA=/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*/i,zA=e=>qA.test(e),tf=(e,n="INFO",a="SYSTEM")=>e?zA(e)?e:`[${n}|${a}] ${e}`:"",VA=(e,n="INFO",a="SYSTEM")=>e.map(s=>tf(s,n,a)).filter(Boolean),ht=(e,n,a,s,r=50)=>{const c=tf(n,a,s),u=[...e||[]];return c&&u[u.length-1]===c?u.slice(-r):[...u,c].slice(-r)},ai=(e,n,a,s,r=50)=>{const c=[...e||[]];let u;for(const p of VA(n,a,s))p&&u===p||(c.push(p),u=p);return c.slice(-r)},YA=["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage"],KA=["fire_damage","lava_sink","burning","hazard_intercept","lava_tick","oil_explosion","void_sink"],Ty=(e,n)=>!!e&&n.includes(e),Mo=e=>e?.statusEffects?.some(n=>n.type==="marked_predator")?1:0,FA={Damage:(e,n,a,s)=>{let r={...e};Ty(n.reason,YA)&&(r=s.appendTimelineEvent(r,"HAZARD_CHECK","Damage",{reason:n.reason,amount:n.amount,target:n.target},a,!0,200)),r=s.appendTimelineEvent(r,"DAMAGE_APPLY","Damage",{reason:n.reason,amount:n.amount,target:n.target,scoreEvent:n.scoreEvent},a,!0,180);let u="",p=null,g,m,f=n.amount;typeof n.target=="string"?n.target==="targetActor"?u=a.targetId||"":n.target!=="area"&&(u=n.target):p=n.target;const b=Ty(n.reason,KA),S=r.upgrades?.includes("RELIC_EMBER_WARD"),T=r.upgrades?.includes("RELIC_CINDER_ORB");if(b&&u){const A=(u===r.player.id?r.player:r.enemies.find(E=>E.id===u))?.activeSkills?.some(E=>E.id==="ABSORB_FIRE");let _=n.amount;if(u===r.player.id&&S&&(_=Math.max(0,_-1),r.message=ht(r.message,"Ember Ward dampens the flames.","INFO","COMBAT")),A){const E=_+(u===r.player.id&&T?1:0);return u===r.player.id&&T&&(r.message=ht(r.message,"Cinder Orb amplifies the absorption.","INFO","COMBAT")),s.applyAtomicEffect(r,{type:"Heal",target:u,amount:E})}}if(u)if(u===r.player.id){const v=r.player,A=n.scoreEvent?.damageClass||"physical",_=s.scaleCombatProfileDamage(r,n.amount,a.sourceId,v,A,n.reason);let E=_.amount;E+=Mo(v),b&&S&&(E=Math.max(0,E-1)),n.scoreEvent&&(r.combatScoreEvents=[...r.combatScoreEvents||[],{...n.scoreEvent,finalPower:E,traitOutgoingMultiplier:_.outgoing,traitIncomingMultiplier:_.incoming,traitTotalMultiplier:_.total}].slice(-500)),r.player=ra(r.player,E),g=r.player.id,m=r.player.position,f=E,b&&(r.hazardBreaches=(r.hazardBreaches||0)+1),b&&T&&(r.player=HA(r.player,1),r.message=ht(r.message,"Cinder Orb restores 1 HP.","INFO","COMBAT"))}else{const v=r.enemies.find(L=>L.id===u),A=u===r.player.id?r.player.position:v?.position,_=[],E=n.scoreEvent?.damageClass||"physical",w=s.scaleCombatProfileDamage(r,n.amount,a.sourceId,v,E,n.reason),M=w.amount+Mo(v);g=u||v?.id,m=A||v?.position,f=M;const C=L=>{if(L.id===u){const k=ra(L,M);return k.hp<=0&&(r.dyingEntities=[...r.dyingEntities||[],L],_.push(L.position)),k}return L};if(n.scoreEvent&&(r.combatScoreEvents=[...r.combatScoreEvents||[],{...n.scoreEvent,finalPower:M,traitOutgoingMultiplier:w.outgoing,traitIncomingMultiplier:w.incoming,traitTotalMultiplier:w.total}].slice(-500)),r.enemies=r.enemies.map(C).filter(L=>L.hp>0),r.companions&&(r.companions=r.companions.map(C).filter(L=>L.hp>0)),_.length>0&&(r=s.appendTimelineEvent(r,"DEATH_RESOLVE","Damage",{targetActorId:u,reason:n.reason||"damage"},{...a,targetId:u},!0,260)),_.forEach(L=>{r=s.addCorpseTraitAt(r,L)}),A&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"impact",position:A}}]),u===r.player.id&&(r.player.stealthCounter||0)>0)r.player={...r.player,stealthCounter:Math.max(0,(r.player.stealthCounter||0)-1)};else if(u!==r.player.id){const L=k=>k.id===u?{...k,stealthCounter:Math.max(0,(k.stealthCounter||0)-1)}:k;r.enemies=r.enemies.map(L),r.companions&&(r.companions=r.companions.map(L))}u===r.player.id&&r.player.archetype==="HUNTER"&&n.source&&Wn(n.source,r.player.position)!==-1&&(r.message=ht(r.message,"You roll away!","INFO","COMBAT")),v&&v.archetype==="HUNTER"&&n.source&&Wn(n.source,v.position)!==-1&&(r.message=ht(r.message,`${v.subtype||v.id} rolls away!`,"INFO","COMBAT"))}else if(p){const v=s.resolveActorAt(r,p),A=n.scoreEvent?.damageClass||"physical",_=s.scaleCombatProfileDamage(r,n.amount,a.sourceId,v,A,n.reason),E=_.amount;g=v?.id,m=p,f=E+Mo(v||void 0),r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"impact",position:p}}],n.scoreEvent&&v&&(r.combatScoreEvents=[...r.combatScoreEvents||[],{...n.scoreEvent,targetId:v.id,finalPower:E,traitOutgoingMultiplier:_.outgoing,traitIncomingMultiplier:_.incoming,traitTotalMultiplier:_.total}].slice(-500)),ee(r.player.position,p)&&(r.player=ra(r.player,E+Mo(r.player)),b&&(r.hazardBreaches=(r.hazardBreaches||0)+1));const w=L=>{if(ee(L.position,p)){const k=ra(L,E+Mo(L));return k.hp<=0&&(r.dyingEntities=[...r.dyingEntities||[],L],C.push(L.id),M.push(L.position)),k}return L},M=[],C=[];r.enemies=r.enemies.map(w).filter(L=>L.hp>0),r.companions&&(r.companions=r.companions.map(w).filter(L=>L.hp>0)),C.forEach(L=>{r=s.appendTimelineEvent(r,"DEATH_RESOLVE","Damage",{targetActorId:L,reason:n.reason||"area_damage"},{...a,targetId:L},!0,260)}),M.forEach(L=>{r=s.addCorpseTraitAt(r,L)})}return f>0&&(r=s.appendSimulationEvent(r,{type:"DamageTaken",targetId:g||u||void 0,position:m,payload:{amount:f,reason:n.reason,sourceId:a.sourceId}})),r}},He={getNeighbors(e){return We(e)},isTileBlocked(e,n){return!e.occupancyMask||e.occupancyMask.length===0?!1:Bd(e.occupancyMask,n)},refreshOccupancyMask(e){let n=RS(e.gridWidth,e.gridHeight);return e.tiles?.forEach(a=>{(a.baseId==="WALL"||a.traits?.has("BLOCKS_MOVEMENT"))&&(n=fd(n,a.position))}),e.player&&(n=fd(n,e.player.position)),e.enemies?.forEach(a=>{n=fd(n,a.position)}),n},getMovementRange(e,n,a){const s=new Map,r=[],c=g=>`${g.q},${g.r}`,u=ge(e,n),p=[{p:n,cost:0}];for(s.set(c(n),0);p.length;){const g=p.shift();if(!(g.cost>=a))for(const m of this.getNeighbors(g.p)){if(!this.isWithinBounds(e,m)||!Oe.isWalkable(e,m))continue;const f=ge(e,m),b=f&&!ee(m,n),S=b&&u&&f.factionId===u.factionId;if(b&&!S)continue;const T=c(m),v=g.cost+1;(!s.has(T)||s.get(T)>v)&&(s.set(T,v),S||r.push(m),p.push({p:m,cost:v}))}}return r},getAxialTargets(e,n,a,s={}){const{includeWalls:r=!1,includeActors:c=!0,stopAtObstacles:u=!0}=s,p=[];for(let g=0;g<6;g++)for(let m=1;m<=a;m++){const f=sn(n,Jd(g,m));if(!this.isWithinBounds(e,f))break;const S=Oe.getTileAt(e,f)?.baseId==="WALL",T=ge(e,f);if(S){if(r&&p.push(f),u)break}else if(T){if(c&&p.push(f),u)break}else p.push(f)}return p},getAreaTargets(e,n,a){const s=[];for(let r=-a;r<=a;r++)for(let c=Math.max(-a,-r-a);c<=Math.min(a,-r+a);c++){const u=sn(n,rn(r,c));this.isWithinBounds(e,u)&&s.push(u)}return s},isWithinBounds(e,n){return ua(n,e.gridWidth,e.gridHeight)},getAxialTargetsWithOptions(e,n,a,s){return this.getAxialTargets(e,n,a,s)}};class La{static hasFireProtection(n){return n.statusEffects.some(a=>a.type==="fire_immunity")||n.activeSkills?.some(a=>a.id==="ABSORB_FIRE")||!1}static isFireHazard(n,a){return n.baseId==="LAVA"||a.has("LAVA")||a.has("FIRE")}static mergeResults(n,a){n.effects.push(...a.effects),n.messages.push(...a.messages),a.newMomentum!==void 0&&(n.newMomentum=a.newMomentum),a.interrupt&&(n.interrupt=!0),a.modifyTile&&(n.modifyTile={...n.modifyTile,...a.modifyTile})}static processEntry(n,a,s){const r={effects:[],messages:[],interrupt:!1},c={tile:a,actor:n,state:s,isFinalDestination:!0,source:n.previousPosition},u=Oe.getTraitsForTile(s,a);u.has("HAZARDOUS")&&!n.isFlying&&(this.isFireHazard(a,u)&&this.hasFireProtection(n)||(a.baseId==="LAVA"||u.has("LAVA")?this.mergeResults(r,{effects:[{type:"Damage",target:n.id,amount:99,reason:"lava_sink"},{type:"Juice",effect:"lavaSink",target:n.position}],messages:["Lava Sink! You were engulfed by lava!"],interrupt:!0}):(a.baseId==="VOID"||u.has("VOID"))&&this.mergeResults(r,{effects:[{type:"Damage",target:n.id,amount:99,reason:"void_sink"},{type:"Juice",effect:"lavaSink",target:n.position}],messages:["Void consumes your soul!"],interrupt:!0})));for(const p of a.effects){const g=nl[p.id];if(!g?.onEnter)continue;const m=g.onEnter(c);if(this.mergeResults(r,m),r.interrupt)break}return r.messages.length===0&&r.effects.some(p=>p.type==="LavaSink")&&r.messages.push("Lava Sink! You were engulfed by lava!"),r}static processTransition(n,a,s,r,c={}){const{ignoreActors:u=!1,ignoreGroundHazards:p=!1}=c,g={effects:[],messages:[],newMomentum:r!==void 0?Math.max(0,r-1):void 0,interrupt:!1},m=Oe.getTraitsForTile(s,a);if(m.has("BLOCKS_MOVEMENT")||!u&&(s.enemies.find(S=>S.id!==n.id&&S.hp>0&&ee(S.position,a.position))||(n.id!==s.player.id&&ee(s.player.position,a.position)?s.player:void 0)))return g.interrupt=!0,g.newMomentum=0,g;const f={tile:a,actor:n,state:s,momentum:r,isFinalDestination:!1,source:n.previousPosition};m.has("HAZARDOUS")&&!n.isFlying&&!p?this.isFireHazard(a,m)&&this.hasFireProtection(n)?this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:99,reason:"hazard_intercept"}],messages:["Flames surge through you."],interrupt:!1}):this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:99,reason:"hazard_intercept"},{type:"Juice",effect:"lavaSink",target:a.position}],messages:[a.baseId==="LAVA"||m.has("LAVA")?"Sunk in Lava!":"Consumed by Void!"],interrupt:!0}):m.has("SLIPPERY")?g.newMomentum=Math.max(1,r||0):m.has("LIQUID")&&r!==void 0&&r>0&&(g.newMomentum=Math.max(0,r-1));for(const b of a.effects){const S=nl[b.id];if(!S?.onPass)continue;const T=S.onPass(f);if(this.mergeResults(g,T),g.interrupt)break}if(!g.interrupt&&!n.isFlying&&!p&&s.traps){const b=s.traps.find(S=>ee(S.position,a.position)&&S.cooldown===0&&S.ownerId!==n.id);if(b){const S=a.position.q-b.position.q||1,T=a.position.r-b.position.r||0;let v=0;S>0&&T===0?v=0:S>0&&T<0?v=1:S===0&&T<0?v=2:S<0&&T===0?v=3:S<0&&T>0?v=4:v=5;const A=3;let _=a.position;const w=(M=>[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0},{q:0,r:1,s:-1}][M%6])(v);for(let M=0;M<A;M++){const C={q:_.q+w.q,r:_.r+w.r,s:_.s+w.s};if(!Oe.isWalkable(s,C))break;_=C}if(this.mergeResults(g,{effects:[{type:"SetTrapCooldown",position:b.position,ownerId:b.ownerId,cooldown:b.resetCooldown??2},{type:"Displacement",target:n.id,destination:_,source:a.position,isFling:!0},{type:"Juice",effect:"kineticWave",target:a.position,intensity:"high"},{type:"Juice",effect:"combat_text",target:a.position,text:"TRAP!"}],messages:[`${n.subtype||"Unit"} triggered a kinetic trap!`],interrupt:!0}),b.volatileCore&&this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:1,reason:"trap_volatile_core"}],messages:["Volatile core detonates!"]}),b.chainReaction&&s.traps){const M=s.traps.filter(C=>C.ownerId===b.ownerId&&C.cooldown===0&&!ee(C.position,b.position)&&We(b.position).some(L=>ee(L,C.position)));for(const C of M)this.mergeResults(g,{effects:[{type:"SetTrapCooldown",position:C.position,ownerId:C.ownerId,cooldown:C.resetCooldown??2}],messages:["Chain reaction sparks nearby traps!"]}),C.volatileCore&&this.mergeResults(g,{effects:[{type:"Damage",target:n.id,amount:1,reason:"trap_chain_volatile"}],messages:["Chain blast!"]})}}}return g}static processStay(n,a,s){const r={effects:[],messages:[]},c={tile:a,actor:n,state:s,isFinalDestination:!1},u=Oe.getTraitsForTile(s,a);if((a.baseId==="LAVA"||u.has("LAVA"))&&!n.isFlying&&!n.statusEffects.some(p=>p.type==="fire_immunity")){const p=n.id==="player";this.mergeResults(r,{effects:[{type:"Damage",target:n.id,amount:p?1:99,reason:"lava_tick"}],messages:["Lava Sink! You were engulfed by lava!"]})}for(const p of a.effects){const g=nl[p.id];if(!g?.onStay)continue;const m=g.onStay(c);this.mergeResults(r,m)}return r}static applyEffect(n,a,s,r,c,u){const p=nl[a];if(!p)return{effects:[],messages:[]};const g={effects:[],messages:[]};for(const m of n.effects){const f=p.interactsWith?.[m.id];if(f){const b=f({tile:n,state:c,potency:r,sourceId:u});return this.mergeResults(g,b),g}}if(p.onApply){const m=p.onApply({tile:n,state:c,potency:r,sourceId:u});this.mergeResults(g,m)}return g.modifyTile?.effects?g.modifyTile&&(n.effects=g.modifyTile.effects):n.effects.push({id:a,duration:s,potency:r,sourceId:u}),g}static processPath(n,a,s,r,c={}){let u=n.position,p=r,g={effects:[],messages:[],newMomentum:r,interrupt:!1};for(const m of a){const f=Oe.getTileAt(s,m),b=Oe.getTraitsForTile(s,f),S=this.processTransition(n,f,s,p,c);if(S.interrupt&&b.has("BLOCKS_MOVEMENT")){g.interrupt=!0;break}if(u=m,this.mergeResults(g,S),g.interrupt){g.interrupt=!0;break}if(p=g.newMomentum,p!==void 0&&p<=0)break}return{lastValidPos:u,result:g,interrupt:!!g.interrupt}}static getMovementCost(n,a){const s=Oe.getTraitsForTile(n,a);let r=1;return s.has("HAZARDOUS")&&(r+=5),s.has("LIQUID")&&(r+=1),s.has("FIRE")&&(r+=2),r}}const WA={Displacement:(e,n,a,s)=>{let r={...e},c="";if(n.target==="self"?c=a.sourceId||r.player.id:n.target==="targetActor"?c=a.targetId||"":c=n.target,!c)return r;const u=(k,R)=>R===k.player.id?k.player:k.enemies.find(H=>H.id===R),p=u(r,c);if(!p)return r;const g=n.source||p.position,m=Math.min(3200,Math.max(0,s.getBlockingTimelineDurationMs(r.timelineEvents)));let f=!1;const b=!(n.simulatePath||n.path||n.isFling);if(g&&(r=s.appendTimelineEvent(r,"MOVE_START","Displacement",{origin:g,destination:n.destination,targetActorId:c},{...a,targetId:c},!0,220)),!g)return r;const S=n.path||dt(g,n.destination),T=n.simulatePath||n.isFling||!!n.path;let v=n.destination;if(T&&S){const k=u(r,c);if(!k)return r;const R=La.processPath(k,S.slice(1),r,S.length-1,{ignoreActors:n.ignoreCollision,ignoreGroundHazards:n.ignoreGroundHazards});v=R.lastValidPos,c===r.player.id?r.player={...r.player,position:v}:r.enemies=r.enemies.map(D=>D.id===c?{...D,position:v}:D),f||(r=s.appendTimelineEvent(r,"MOVE_END","Displacement",{destination:v,targetActorId:c},{...a,targetId:c},!0,260),f=!0),R.result.effects.length>0&&(r=s.appendTimelineEvent(r,"ON_PASS","TilePath",{path:S.slice(1),targetActorId:c},{...a,targetId:c},!1,80),r=s.applyEffects(r,R.result.effects,{targetId:c})),R.result.messages.length>0&&(r.message=ai(r.message,R.result.messages,"INFO","HAZARD"));const H=c===r.player.id||r.enemies.some(D=>D.id===c);if(!R.interrupt&&H){const D=Oe.getTileAt(r,v);r=s.appendTimelineEvent(r,"ON_ENTER","TileEnter",{position:v,targetActorId:c,tileBaseId:D?.baseId},{...a,targetId:c},!1,80);const $=u(r,c);if(!$)return r;const J=La.processEntry($,D,r);J.effects.length>0&&(r=s.applyEffects(r,J.effects,{targetId:c})),J.messages.length>0&&(r.message=ai(r.message,J.messages,"INFO","HAZARD"))}if(R.result.newMomentum&&R.result.newMomentum>0){const D=R.lastValidPos,$=S.length>1?S[S.length-2]:g,J=Wn($,D);if(J!==-1){const te=Pt(J);let ae=D,W=5;for(;W>0;){const q=sn(ae,te);if(!Oe.isWalkable(r,q)||(c===r.player.id?r.enemies.find(X=>X.hp>0&&ee(X.position,q)):ee(r.player.position,q)?r.player:r.enemies.find(X=>X.id!==c&&X.hp>0&&ee(X.position,q))))break;const z=Oe.getTileAt(r,q);if(z){const X=La.processTransition(p,z,r,1);if(ae=q,X.effects.length>0&&(r=s.applyEffects(r,X.effects,{targetId:c})),X.messages.length>0&&(r.message=ai(r.message,X.messages,"INFO","HAZARD")),X.newMomentum===0||X.interrupt)break}else{ae=q;break}W--}v=ae}}}const A=[...r.visualEvents||[]],_=!!(n.ignoreCollision||n.isFling),E=_?A.reduce((k,R)=>{if(R.type!=="kinetic_trace")return k;const H=R.payload;return H&&(H.movementType??"slide")==="slide"?k+1:k},0):0,w=b?0:_?Math.min(640,E*90):0,M=Math.max(m,w),C={actorId:c,origin:g,path:n.path||(b?[g,v]:dt(g,v)),destination:v,movementType:b?"teleport":"slide",durationMs:n.animationDuration??(b?180:Math.max(120,(n.path?.length||dt(g,v).length)*110)),startDelayMs:M,wasLethal:r.tiles.get(ue(v))?.traits.has("HAZARDOUS")||!1},L=A;if(b)L.push({type:"kinetic_trace",payload:C});else{let k=!1;for(let R=L.length-1;R>=0;R--){const H=L[R];if(H.type!=="kinetic_trace")continue;const D=H.payload;if(!(!D||D.actorId!==c)){if((D.movementType??"slide")==="slide"&&ee(D.destination,C.origin)){const $=D.path&&D.path.length>0?D.path:[D.origin,D.destination],J=C.path&&C.path.length>0?C.path:[C.origin,C.destination],te=[...$,...J.slice(1)];L[R]={type:"kinetic_trace",payload:{...C,origin:D.origin,path:te,durationMs:(D.durationMs||0)+(C.durationMs||0),startDelayMs:Math.min(D.startDelayMs??M,M),movementType:"slide",wasLethal:!!(D.wasLethal||C.wasLethal)}},k=!0}break}}k||L.push({type:"kinetic_trace",payload:C})}if(r.visualEvents=L,c===r.player.id)r.player={...r.player,position:v,previousPosition:b?v:r.player.position};else{const k=R=>R.id===c?{...R,position:v,previousPosition:b?v:R.position}:R;r.enemies=r.enemies.map(k),r.companions&&(r.companions=r.companions.map(k))}return r.occupancyMask=He.refreshOccupancyMask(r),f||(r=s.appendTimelineEvent(r,"MOVE_END","Displacement",{destination:v,targetActorId:c},{...a,targetId:c},!0,260)),r=s.appendSimulationEvent(r,{type:"UnitMoved",actorId:c,position:v,payload:{origin:g,destination:v,movementType:C.movementType}}),r}},al=Math.sqrt(3),Ey=(e,n)=>{if(n)return e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n)},_y=e=>{if(e)return{actorId:e.id,hex:e.position}},r0=(e,n,a=Q)=>{if(!e||!n||me(e,n)!==1)return;const s=Wn(e,n);if(s<0)return;const r=Ee(e,a),u=[{x:a,y:0},{x:a/2,y:-(al*a)/2},{x:-a/2,y:-(al*a)/2},{x:-a,y:0},{x:-a/2,y:al*a/2},{x:a/2,y:al*a/2}][s];return u?{x:r.x+u.x,y:r.y+u.y}:void 0},bd=(e,n,a)=>{if(a)switch(a.kind){case"source_actor":return _y(Ey(e,n.sourceId));case"target_actor":return _y(Ey(e,n.targetId));case"source_hex":return n.sourceHex?{hex:n.sourceHex}:void 0;case"target_hex":return n.targetHex?{hex:n.targetHex}:void 0;case"contact_hex":return n.contactHex?{hex:n.contactHex}:void 0;case"contact_world":return!n.contactWorld&&!n.contactHex?void 0:{world:n.contactWorld,hex:n.contactHex};case"custom_hex":return{hex:a.hex};case"custom_world":return{world:a.world};default:return}},l0=(e,n)=>{const a=e.turnNumber||0,s=e.stackTrace?.length||0,r=n.sourceId||"env",c=n.skillId||"none",u=n.phase||"instant",p=n.salt?`.${n.salt}`:"";return`t${a}.k${s}.${r}.${c}.${u}${p}`},GA=e=>{const n=String(e).toLowerCase();return n.includes("fire")||n.includes("lava")||n.includes("explosion")?"fire":n.includes("kinetic")||n.includes("momentum")||n.includes("wallcrack")?"kinetic":n.includes("void")?"void":n.includes("arcane")?"arcane":n.includes("hidden")||n.includes("shadow")?"shadow":"neutral"},XA=(e,n={})=>{const a=GA(e),s={signature:`UI.SPAWN.${a.toUpperCase()}.${String(e).toUpperCase()}`,family:"ui",primitive:"spawn",phase:"instant",element:a,variant:e,intensity:"medium"};switch(e){case"impact":return{...s,signature:"ATK.STRIKE.PHYSICAL.IMPACT",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"impact",targetRef:{kind:"target_hex"},contactRef:{kind:"contact_world"}};case"flash":return{...s,signature:`ATK.BLAST.${n.color?"ARCANE":"NEUTRAL"}.FLASH`,family:"attack",primitive:"blast",phase:"impact",element:n.color?"arcane":"neutral",variant:"flash",targetRef:{kind:"target_hex"}};case"spearTrail":return{...s,signature:"ATK.SHOOT.PHYSICAL.SPEAR_TRAIL",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"spear",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"}};case"explosion_ring":return{...s,signature:"ATK.BLAST.FIRE.EXPLOSION_RING",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"explosion_ring",targetRef:{kind:"target_hex"},intensity:"high"};case"lavaRipple":return{...s,signature:"ENV.HAZARD.FIRE.LAVA_RIPPLE",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_ripple",targetRef:{kind:"target_hex"}};case"lavaSink":return{...s,signature:"ENV.HAZARD.FIRE.SINK",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_sink",targetRef:{kind:"target_hex"},intensity:"high"};case"wallCrack":return{...s,signature:"ENV.COLLISION.KINETIC.WALL_CRACK",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"wall_crack",contactRef:{kind:"contact_world"},targetRef:{kind:"target_hex"},intensity:"high"};case"kineticWave":return{...s,signature:"ATK.PULSE.KINETIC.WAVE",family:"attack",primitive:"pulse",phase:"impact",element:"kinetic",variant:"kinetic_wave",targetRef:{kind:"target_hex"}};case"dashBlur":return{...s,signature:"MOVE.DASH.NEUTRAL.BLUR",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"dash_blur",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"}};case"hiddenFade":return{...s,signature:"STATE.FADE.SHADOW.HIDDEN",family:"status",primitive:"state_fade",phase:"instant",element:"shadow",variant:"hidden_fade",targetRef:{kind:"target_hex"}};case"combat_text":return{...s,signature:"UI.TEXT.NEUTRAL.POPUP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"combat_text",targetRef:{kind:"target_hex"}};case"shake":return{...s,signature:"UI.SHAKE.NEUTRAL.CAMERA",family:"ui",primitive:"shake",phase:"instant",element:"neutral",variant:"camera_shake"};case"freeze":return{...s,signature:"UI.FREEZE.NEUTRAL.HITSTOP",family:"ui",primitive:"freeze",phase:"instant",element:"neutral",variant:"freeze"};case"stunBurst":return{...s,signature:"STATE.APPLY.NEUTRAL.STUN_BURST",family:"status",primitive:"status_apply",phase:"impact",element:"neutral",variant:"stun_burst",targetRef:{kind:"target_hex"}};default:return{...s,signature:`UI.SPAWN.${a.toUpperCase()}.${String(e).toUpperCase()}`,variant:String(e).toLowerCase()}}},JA=(e,n)=>{const a=n.template,s=n.phase||a.phase||"instant",r=n.sequenceId||l0(e,{sourceId:n.sourceId,skillId:n.skillId,phase:s}),c=bd(e,n,a.sourceRef),u=bd(e,n,a.targetRef),p=bd(e,n,a.contactRef),g={protocol:"juice-signature/v1",signature:n.signature||a.signature,family:a.family,primitive:a.primitive,phase:s,element:n.element||a.element,variant:n.variant||a.variant,intensity:n.intensity||a.intensity,source:c,target:u,contact:p,area:n.area||a.area,direction:n.direction||a.direction,path:n.path||a.path,text:n.text||a.text,camera:n.camera||a.camera,timing:n.timing||a.timing,flags:{...a.flags||{},...n.flags||{}},meta:{turnNumber:e.turnNumber||0,stackTick:e.stackTrace?.length||0,sequenceId:r,sourceId:n.sourceId,targetId:n.targetId,skillId:n.skillId,reason:n.reason,...n.meta||{}}};return g.flags&&Object.keys(g.flags).length===0&&delete g.flags,g.meta&&Object.keys(g.meta).length===0&&delete g.meta,{type:"juice_signature",payload:g}},c0=(e,n)=>{const a=JA(e,n);return{...e,visualEvents:[...e.visualEvents||[],a]}},QA={Impact:(e,n,a,s)=>{let r={...e};const c=n.target,u=c===r.player.id?r.player:r.enemies.find(f=>f.id===c);if(!u)return r;const p=n.direction,g=p?{q:u.position.q+p.q,r:u.position.r+p.r,s:u.position.s+p.s}:void 0,m=g?r0(u.position,g):void 0;if(r=c0(r,{template:{signature:p?"ENV.COLLISION.KINETIC.IMPACT":"ATK.STRIKE.PHYSICAL.IMPACT",family:p?"environment":"attack",primitive:p?"collision":"strike",phase:"impact",element:p?"kinetic":"physical",variant:"impact",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},contactRef:{kind:"contact_world"}},sourceId:a.sourceId,targetId:c,sourceHex:s.resolveActorById(r,a.sourceId)?.position,targetHex:u.position,contactHex:g,contactWorld:m,direction:n.direction,intensity:n.damage>1?"high":"medium",flags:{blocked:!!p},meta:{legacyJuiceId:"impact",legacyMirrored:!0,reason:"impact"}}),n.damage>0)if(c===r.player.id)r.player=ra(r.player,n.damage);else{const f=b=>b.id===c?ra(b,n.damage):b;r.enemies=r.enemies.map(f).filter(b=>b.hp>0),r.companions&&(r.companions=r.companions.map(f).filter(b=>b.hp>0))}return r}},ZA={PickupShield:(e,n)=>{let a={...e};const s=n.position||a.shieldPosition;if(s&&a.shieldPosition&&ee(a.shieldPosition,s)){a.hasShield=!0,a.shieldPosition=void 0;const r={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Shield Bash.",slot:"utility",cooldown:3,currentCooldown:0,range:1,upgrades:[],activeUpgrades:[]};a.player.activeSkills.some(c=>c.id==="BULWARK_CHARGE")||(a.player={...a.player,activeSkills:[...a.player.activeSkills,r]})}return a},PickupSpear:(e,n)=>{let a={...e};const s=n.position||a.spearPosition;return s&&a.spearPosition&&ee(a.spearPosition,s)&&(a.hasSpear=!0,a.spearPosition=void 0),a},SpawnItem:(e,n,a)=>{let s={...e};if(n.itemType==="spear")return s.spearPosition=n.position,a.sourceId===s.player.id&&(s.hasSpear=!1),s;if(n.itemType==="bomb"){const r=s.initialSeed??s.rngSeed??"0",c=(s.turnNumber<<16)+(s.actionLog?.length??0)+s.enemies.length,u=`bomb-${Cs(r,c,8,"bomb")}`,p=ca({id:u,type:"enemy",subtype:"bomb",factionId:"enemy",position:n.position,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return p.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],s.enemies=[...s.enemies,p],s}return n.itemType==="shield"&&(s.shieldPosition=n.position,s.hasShield=!1),s},LavaSink:(e,n,a,s)=>{let r={...e};r=s.appendTimelineEvent(r,"HAZARD_CHECK","LavaSink",{target:n.target},a,!0,240);const c=n.target,u=c===r.player.id?r.player:r.enemies.find(p=>p.id===c);return u&&(r=s.appendTimelineEvent(r,"DEATH_RESOLVE","LavaSink",{targetId:c},{...a,targetId:c},!0,280),c===r.player.id?r.player=ra(r.player,99):(r.enemies=r.enemies.filter(p=>p.id!==c),r.dyingEntities=[...r.dyingEntities||[],u],r=s.addCorpseTraitAt(r,u.position)),r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:u.position}}]),r}},eT={Juice:(e,n,a,s)=>{let r={...e};const c=n.metadata||{},u=typeof c.phase=="string"?c.phase:void 0,g={...XA(n.effect,{color:n.color,text:n.text}),...typeof c.signature=="string"?{signature:c.signature}:{},...typeof c.family=="string"?{family:c.family}:{},...typeof c.primitive=="string"?{primitive:c.primitive}:{},...typeof c.element=="string"?{element:c.element}:{},...typeof c.variant=="string"?{variant:c.variant}:{},...typeof c.sourceRef=="object"&&c.sourceRef?{sourceRef:c.sourceRef}:{},...typeof c.targetRef=="object"&&c.targetRef?{targetRef:c.targetRef}:{},...typeof c.contactRef=="object"&&c.contactRef?{contactRef:c.contactRef}:{}},m=s.resolveActorById(r,a.sourceId);let f,b;typeof n.target=="string"?(f=n.target==="targetActor"?a.targetId||void 0:n.target,b=s.resolveActorById(r,f)?.position):n.target?(b=n.target,f=s.resolveActorAt(r,n.target)?.id):a.targetId&&(f=a.targetId,b=s.resolveActorById(r,a.targetId)?.position);const S=c.contactHex&&typeof c.contactHex.q=="number"?c.contactHex:void 0;let T=c.contactWorld&&typeof c.contactWorld.x=="number"?c.contactWorld:void 0;if(!T){const v=c.contactFromHex&&typeof c.contactFromHex.q=="number"?c.contactFromHex:void 0,A=c.contactToHex&&typeof c.contactToHex.q=="number"?c.contactToHex:void 0;T=r0(v,A)}if(r=c0(r,{template:g,sourceId:a.sourceId,targetId:f,skillId:typeof c.skillId=="string"?c.skillId:void 0,reason:typeof c.reason=="string"?c.reason:void 0,sourceHex:m?.position,targetHex:b,contactHex:S,contactWorld:T,path:n.path,direction:n.direction,phase:u,sequenceId:typeof c.sequenceId=="string"?c.sequenceId:l0(r,{sourceId:a.sourceId,skillId:typeof c.skillId=="string"?c.skillId:void 0,phase:u||g.phase,salt:n.effect}),intensity:n.intensity,text:n.text?{value:n.text,tone:typeof c.textTone=="string"?c.textTone:"system",color:n.color}:void 0,timing:typeof c.timing=="object"&&c.timing?c.timing:n.duration?{durationMs:n.duration,ttlMs:n.duration}:void 0,camera:typeof c.camera=="object"&&c.camera?c.camera:n.effect==="shake"?{shake:n.intensity||"medium"}:n.effect==="freeze"?{freezeMs:Math.max(0,Number(n.duration||80))}:void 0,area:typeof c.area=="object"&&c.area?c.area:void 0,flags:typeof c.flags=="object"&&c.flags?c.flags:void 0,meta:{legacyJuiceId:n.effect,legacyMirrored:s.legacyMirroredJuiceIds.has(n.effect),...typeof c.statusId=="string"?{statusId:c.statusId}:{}}}),n.effect==="combat_text"&&n.text&&(r.message=ht(r.message,n.text,"VERBOSE","SYSTEM")),n.effect==="shake"&&(r.visualEvents=[...r.visualEvents||[],{type:"shake",payload:{intensity:n.intensity||"medium",direction:n.direction}}]),n.effect==="freeze"&&(r.visualEvents=[...r.visualEvents||[],{type:"freeze",payload:{durationMs:Math.max(0,Number(n.duration||80))}}]),n.effect==="impact"&&n.target){const v=typeof n.target=="string"?n.target===r.player.id?r.player.position:r.enemies.find(A=>A.id===n.target)?.position:n.target;v&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"impact",position:v}}])}if(n.effect==="flash"&&n.target){const v=typeof n.target=="string"?n.target===r.player.id?r.player.position:r.enemies.find(A=>A.id===n.target)?.position:n.target;v&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"flash",position:v}}])}if(n.effect==="spearTrail"&&n.path&&(r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"spear_trail",path:n.path}}]),n.effect==="lavaSink"&&n.target){const v=typeof n.target=="string"?n.target===r.player.id?r.player.position:r.enemies.find(A=>A.id===n.target)?.position:n.target;if(v){const A=r.enemies.find(_=>ee(_.position,v));A&&(r.dyingEntities=[...r.dyingEntities||[],A],r.enemies=r.enemies.filter(_=>!ee(_.position,v)),r.companions&&(r.companions=r.companions.filter(_=>!ee(_.position,v))),r=s.addCorpseTraitAt(r,v),r.visualEvents=[...r.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:v}}])}}return r}},tT={Message:(e,n,a,s)=>{let r=e;return r.message=[...r.message,tf(n.text,"INFO","SYSTEM")].slice(-50),r=s.appendSimulationEvent(r,{type:"MessageLogged",payload:{text:n.text}}),r},GameOver:e=>({...e,gameStatus:"lost"})},nT={Heal:(e,n,a,s)=>{let r={...e};const c=m=>({...m,hp:Math.min(m.maxHp,m.hp+n.amount)}),u=n.target==="targetActor"?a.targetId:n.target;let p,g;if(u){const m=u===r.player.id?r.player:r.enemies.find(f=>f.id===u)||r.companions?.find(f=>f.id===u);if(m){const f=u===r.player.id?"You":m.subtype||m.id;if(r.message=ht(r.message,`${f} recover ${n.amount} HP.`,"INFO","COMBAT"),u===r.player.id)r.player=c(r.player),p=r.player.id,g=r.player.position;else{const b=S=>S.id===u?c(S):S;r.enemies=r.enemies.map(b),r.companions&&(r.companions=r.companions.map(b)),p=m.id,g=m.position}}}return p&&(r=s.appendSimulationEvent(r,{type:"Healed",targetId:p,position:g,payload:{amount:n.amount,sourceId:a.sourceId}})),r},ApplyStatus:(e,n,a,s)=>{let r={...e};r=s.appendTimelineEvent(r,"STATUS_APPLY","ApplyStatus",{status:n.status,duration:n.duration,target:n.target},a,!0,160);let c="",u=null;typeof n.target=="string"?n.target==="targetActor"?c=a.targetId||"":c=n.target:u=n.target;let p=u;const g=a.sourceId?s.resolveActorById(r,a.sourceId):void 0,m=g?vx(n.duration,Ie(g)):n.duration;if(c){const b=c===r.player.id?r.player:r.enemies.find(S=>S.id===c)||r.companions?.find(S=>S.id===c);if(b){p=b.position;const S=c===r.player.id?"You":`${b.subtype||"enemy"}#${b.id}`,T=c===r.player.id?"are":"is";if(r.message=ht(r.message,`${S} ${T} ${n.status}!`,"INFO","COMBAT"),c===r.player.id)r.player=Pd(r.player,n.status,m);else{const v=A=>A.id===c?Pd(A,n.status,m):A;r.enemies=r.enemies.map(v),r.companions&&(r.companions=r.companions.map(v))}}}n.status==="stunned"&&p&&(r.visualEvents=[...r.visualEvents||[],{type:"shake",payload:{intensity:"low"}},{type:"vfx",payload:{type:"stunBurst",position:p}},{type:"combat_text",payload:{text:"STUNNED",position:p}}]);const f=c||(p?s.resolveActorAt(r,p)?.id:void 0);return r=s.appendSimulationEvent(r,{type:"StatusApplied",targetId:f,position:p||void 0,payload:{status:n.status,duration:m,sourceId:a.sourceId}}),r}},wy={player:100,footman:50,archer:60,shieldBearer:40,bomber:30,warlock:55,bomb:10},jd=e=>{let n=e.speed;if(n===void 0){const s=e.subtype;n=e.type==="player"?wy.player:wy[s]??50}return e.statusEffects?.some(s=>s.type==="stunned")&&(n-=100),n+=Sx(Ie(e)),n},ja=e=>{const n=[];n.push({actorId:e.player.id,initiative:jd(e.player),hasActed:!1,turnStartPosition:void 0});for(const a of e.enemies)n.push({actorId:a.id,initiative:jd(a),hasActed:!1,turnStartPosition:void 0});return n.sort((a,s)=>s.initiative!==a.initiative?s.initiative-a.initiative:a.actorId==="player"?-1:s.actorId==="player"?1:a.actorId.localeCompare(s.actorId)),{entries:n,currentIndex:-1,round:1}},iT=e=>e.currentIndex<0||e.currentIndex>=e.entries.length?null:e.entries[e.currentIndex],aT=e=>{let n=e.initiativeQueue;n||(n=ja(e));let a=n.currentIndex+1;for(;a<n.entries.length&&n.entries[a].hasActed;)a++;return a>=n.entries.length?(n=ja(e),n.round=(e.initiativeQueue?.round??0)+1,a=0,{queue:{...n,currentIndex:a},actorId:n.entries[a]?.actorId??null,newRound:!0}):{queue:{...n,currentIndex:a},actorId:n.entries[a]?.actorId??null,newRound:!1}},sT=(e,n)=>{const a=e.initiativeQueue;if(!a)return ja(e);const s=a.entries.map(r=>{if(r.actorId===n.id){if(r.turnStartPosition)return r;const u=We(n.position).map(p=>ge(e,p)?.id).filter(Boolean);return{...r,turnStartPosition:{...n.position},turnStartNeighborIds:u}}return r});return{...a,entries:s}},oT=(e,n)=>{const a=e.initiativeQueue;if(!a)return ja(e);const s=a.entries.map(r=>r.actorId===n?{...r,hasActed:!0}:r);return{...a,entries:s}},rT=(e,n)=>{const a=e.initiativeQueue;return a?a.entries.find(r=>r.actorId===n)?.turnStartPosition??null:null},lT=(e,n)=>{const a=e.initiativeQueue;return a?a.entries.find(r=>r.actorId===n)?.turnStartNeighborIds??null:null},Do=e=>{const n=e.initiativeQueue;if(!n)return!0;if(n.currentIndex<0||n.currentIndex>=n.entries.length)return!1;const a=n.entries[n.currentIndex];return a.actorId===e.player.id&&!a.hasActed},vd=(e,n)=>{const a=e.entries.filter(c=>c.actorId!==n);let s=e.currentIndex;const r=e.entries.findIndex(c=>c.actorId===n);return r>=0&&r<=e.currentIndex&&s--,{...e,entries:a,currentIndex:Math.min(s,a.length-1)}},cT=(e,n)=>{const a={actorId:n.id,initiative:jd(n),hasActed:!0,turnStartPosition:void 0};return{...e,entries:[...e.entries,a]}},uT={UpdateComponent:(e,n,a)=>{let s={...e};const r=(c,u,p)=>{const g=new Map(c.components||[]);return g.set(u,p),{...c,components:g}};if(n.target==="self")return s.player=r(s.player,n.key,n.value),s;if(n.target==="targetActor"&&a.targetId){if(a.targetId===s.player.id)return s.player=r(s.player,n.key,n.value),s;const c=u=>u.id===a.targetId?r(u,n.key,n.value):u;s.enemies=s.enemies.map(c),s.companions&&(s.companions=s.companions.map(c))}return s},SpawnActor:(e,n)=>{let a={...e};const s=Lo(n.actor);return a.enemies=[...a.enemies,s],s.companionOf&&(a.companions=[...a.companions||[],s]),a.initiativeQueue&&(a.initiativeQueue=cT(a.initiativeQueue,s)),a},PlaceFire:(e,n,a)=>{let s={...e,tiles:new Map(e.tiles)};const r=ue(n.position);let c=s.tiles.get(r);c?c={...c,traits:new Set(c.traits),effects:[...c.effects]}:c={baseId:"STONE",position:n.position,traits:new Set(Os.STONE.defaultTraits),effects:[]},s.tiles.set(r,c);const u=La.applyEffect(c,"FIRE",n.duration,1,s,a.sourceId);return u.messages.length>0&&(s.message=ai(s.message,u.messages,"INFO","HAZARD")),s}},dT={PlaceTrap:(e,n)=>{const a=e.traps||[];return{...e,traps:[...a,{position:n.position,ownerId:n.ownerId,isRevealed:!1,cooldown:0,volatileCore:n.volatileCore,chainReaction:n.chainReaction,resetCooldown:n.resetCooldown}]}},RemoveTrap:(e,n)=>e.traps?{...e,traps:n.ownerId?e.traps.filter(a=>a.ownerId!==n.ownerId):e.traps.filter(a=>!ee(a.position,n.position))}:e,SetTrapCooldown:(e,n)=>e.traps?{...e,traps:e.traps.map(a=>n.ownerId&&a.ownerId!==n.ownerId||!ee(a.position,n.position)?a:{...a,cooldown:Math.max(0,n.cooldown)})}:e},fT={...tT,...$A,...FA,...WA,...ZA,...dT,...UA,...nT,...QA,...eT,...uT},mT=(e,n,a,s)=>{const r=fT[n.type];return typeof r!="function"?null:r(e,n,a,s)};var My={};const pT=(e,n)=>{const a=ue(n);let s=e;s.tiles===e.tiles&&(s={...s,tiles:new Map(s.tiles)});let r=s.tiles.get(a);return r?r={...r,traits:new Set(r.traits),effects:[...r.effects]}:r={baseId:"STONE",position:n,traits:new Set(Os.STONE.defaultTraits),effects:[]},r.traits.add("CORPSE"),s.tiles.set(a,r),s},hT=(e,n)=>{const a=ue(n),s=e.tiles.get(a);if(!s||!s.traits.has("CORPSE"))return e;let r=e;r.tiles===e.tiles&&(r={...r,tiles:new Map(r.tiles)});const c={...s,traits:new Set(s.traits),effects:[...s.effects]};return c.traits.delete("CORPSE"),r.tiles.set(a,c),r},yT=typeof process<"u"&&(My?.HOP_ENGINE_WARN==="1"||My?.HOP_ENGINE_DEBUG==="1"),Oy={INTENT_START:1,MOVE_START:2,MOVE_END:3,ON_PASS:4,ON_ENTER:5,HAZARD_CHECK:6,STATUS_APPLY:7,DAMAGE_APPLY:8,DEATH_RESOLVE:9,INTENT_END:10},gT=e=>{const n=e||[];let a=0;for(const s of n)s.blocking&&(a+=Number(s.suggestedDurationMs||0));return a},bT=(e,n,a,s,r,c,u)=>{const p=e.timelineEvents||[],g=p.length,m=e.turnNumber||0,f=r.sourceId||r.targetId,b=r.stepId||`${m}:${f||"system"}`,S=r.stepId||b,T=S?[...p].reverse().find(A=>(A.stepId||A.groupId)===S):void 0;if(T){const A=Oy[T.phase]||0,_=Oy[n]||0;A>_&&yT&&console.warn("[TURN_STACK] Non-monotonic timeline phase order detected.",{stepId:S,previous:T.phase,next:n})}const v=`${S}:${g}:${n}`;return{...e,timelineEvents:[...p,{id:v,turn:m,actorId:f,stepId:S,phase:n,type:a,payload:s,blocking:c,groupId:b,suggestedDurationMs:u}]}},vT=(e,n)=>{const a=e.simulationEvents||[],s=`sim:${e.turnNumber||0}:${a.length}:${n.type}`;return{...e,simulationEvents:[...a,{...n,id:s,turn:e.turnNumber||0}]}},u0=(e,n)=>{if(n)return e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n)},ST=(e,n)=>{if(n)return ee(e.player.position,n)?e.player:e.enemies.find(a=>ee(a.position,n))||e.companions?.find(a=>ee(a.position,n))},xT=new Set(["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage","burning","oil_explosion"]),AT=new Set(["impact","flash","spearTrail","shake"]),TT=(e,n,a,s,r,c)=>{if(!s)return{amount:n,outgoing:1,incoming:1,total:1};if(c&&xT.has(c))return{amount:n,outgoing:1,incoming:1,total:1};const u=u0(e,a);if(!u)return{amount:n,outgoing:1,incoming:1,total:1};const p=VS(u,r),g=YS(s,r),m=p*g;return{amount:Math.max(0,Math.floor(n*m)),outgoing:p,incoming:g,total:m}},Dd=(e,n,a={})=>{const s={...e},r=mT(s,n,a,{applyAtomicEffect:Dd,applyEffects:Gn,addCorpseTraitAt:pT,removeCorpseTraitAt:hT,scaleCombatProfileDamage:TT,appendSimulationEvent:vT,appendTimelineEvent:bT,getBlockingTimelineDurationMs:gT,legacyMirroredJuiceIds:AT,resolveActorAt:ST,resolveActorById:u0});return r||s},Gn=(e,n,a={})=>{const s=e.stackTrace?.length||0,r=Ay(e,n,{apply:(g,m)=>Dd(g,m,a),describe:g=>g.type,preserveInputOrder:!0,startTick:s+1});let c=r.state,u=[...e.stackTrace||[],...r.trace];const p=jA(c);if(p.length>0){const g=Ay(c,p,{apply:(m,f)=>Dd(m,f,{}),describe:m=>m.type,preserveInputOrder:!0,startTick:u.length+1});c=g.state,u=[...u,...g.trace]}return{...c,stackTrace:u}};function si(e){return e.statusEffects?.some(n=>n.type==="stunned")??!1}function ET(e){return e.statusEffects?.some(n=>n.type==="rooted")??!1}function Cy(e,n=1){if(!e.statusEffects||e.statusEffects.length===0)return e;const a=e.statusEffects.map(s=>({...s,duration:s.duration-n})).filter(s=>s.duration>0);return{...e,statusEffects:a}}const d0={id:"AUTO_ATTACK",name:"Auto Attack",description:"Automatically strike adjacent enemies that started the turn adjacent to you.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,n,a,s=[],r)=>{const c=[],u=[];let p=0;const g=(e.timelineEvents||[]).some(A=>A.phase==="STATUS_APPLY"&&A.type==="ApplyStatus"&&A.payload?.status==="stunned"&&(A.payload?.target===n.id||typeof A.payload?.target=="object"&&A.payload?.target&&ee(A.payload.target,n.position)));if(si(n)||g)return{effects:c,messages:u,kills:0};const m=We(n.position);let f=1;s.includes("HEAVY_HANDS")&&(f+=1);let b=0;const S=(A,_,E)=>{const w=Wn(n.position,_),M=w>=0?Pt(w):void 0,C=Math.max(0,E-(A.temporaryArmor||0)),L=A.hp-C<=0,k=L?"extreme":E>=4?"high":E>=2?"medium":"low",R=b*80;b+=1,c.push({type:"Juice",effect:"lightImpact",target:A.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"anticipation",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:R,durationMs:70,ttlMs:90}}}),c.push({type:"Juice",effect:"dashBlur",target:A.id,path:[n.position,_],intensity:k==="extreme"?"high":"medium",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"travel",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:R+70,durationMs:50,ttlMs:80}}}),c.push({type:"Juice",effect:"heavyImpact",target:A.id,intensity:k,direction:M,metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},...M?{contactRef:{kind:"contact_world"},contactHex:_,contactToHex:_,contactFromHex:n.position}:{},skillId:"AUTO_ATTACK",camera:{kick:k==="extreme"?"medium":"light",freezeMs:k==="extreme"?50:35},timing:{delayMs:R+120,durationMs:60,ttlMs:120},flags:{lethal:L}}}),c.push({type:"Juice",effect:"lightImpact",target:A.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"aftermath",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:R+180,durationMs:80,ttlMs:110}}})},T=r?.persistentTargetIds||[],v=r?.previousNeighbors||[];if(T.length===0&&v.length===0)return{effects:c,messages:u,kills:0};for(const A of m){const _=ge(e,A);if(!_||_.hp<=0||_.id===n.id||n.factionId===_.factionId)continue;if(T.length>0?T.includes(_.id):v.some(w=>ee(w,A))){const w=Ht({attackerId:n.id,targetId:_.id,skillId:"AUTO_ATTACK",basePower:f,trinity:Ie(n),targetTrinity:Ie(_),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});S(_,A,w.finalPower),c.push({type:"Damage",target:A,amount:w.finalPower,reason:"auto_attack",scoreEvent:w.scoreEvent});const M=n.factionId==="player"?"You":`${n.subtype||"enemy"}#${n.id}`,C=_.factionId==="player"?"you":`${_.subtype||"enemy"}#${_.id}`;u.push(`${M} attacked ${C}!`),_.hp<=f&&p++}}if(s.includes("CLEAVE")&&c.length>0)for(const A of m){if(c.some(k=>k.type==="Damage"&&typeof k.target=="object"&&"q"in k.target&&ee(k.target,A)))continue;const E=ge(e,A);if(!E||E.id===n.id||!(n.factionId!==E.factionId))continue;const M=Ht({attackerId:n.id,targetId:E.id,skillId:"AUTO_ATTACK",basePower:f,trinity:Ie(n),targetTrinity:Ie(E),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});S(E,A,M.finalPower),c.push({type:"Damage",target:A,amount:M.finalPower,reason:"auto_attack",scoreEvent:M.scoreEvent});const C=n.factionId==="player"?"You":`${n.subtype||"enemy"}#${n.id}`,L=E.factionId==="player"?"you":`${E.subtype||"enemy"}#${E.id}`;u.push(`${C} cleaved ${L}!`),E.hp<=f&&p++}return{effects:c,messages:u,kills:p}},upgrades:{HEAVY_HANDS:{id:"HEAVY_HANDS",name:"Heavy Hands",description:"Auto-attack damage +1"},CLEAVE:{id:"CLEAVE",name:"Cleave",description:"When auto-attack triggers, hit ALL adjacent enemies"}},scenarios:Qe("AUTO_ATTACK")},_T=(e,n,a,s,r,c)=>{if(!n.activeSkills?.some(S=>S.id==="AUTO_ATTACK"))return{state:e,kills:0,messages:[]};const g=n.activeSkills?.find(S=>S.id==="AUTO_ATTACK")?.activeUpgrades||[],m=new Map;if(e.initiativeQueue)for(const S of e.initiativeQueue.entries)S.turnStartPosition&&m.set(S.actorId,S.turnStartPosition);const f=d0.execute(e,n,void 0,g,{previousNeighbors:a,attackerTurnStartPosition:s,allActorsTurnStartPositions:m,persistentTargetIds:r});return{state:Gn(e,f.effects,{sourceId:n.id,targetId:void 0,stepId:c}),kills:f.kills||0,messages:f.messages}},wT={id:"BASIC_ATTACK",name:"Basic Attack",description:"Strike an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,n,a,s=[])=>{const r=[],c=[],u=(e.timelineEvents||[]).some(C=>C.phase==="STATUS_APPLY"&&C.type==="ApplyStatus"&&C.payload?.status==="stunned"&&(C.payload?.target===n.id||typeof C.payload?.target=="object"&&C.payload?.target&&ee(C.payload.target,n.position)));if(si(n)||u)return c.push("Cannot attack while stunned!"),{effects:r,messages:c,consumesTurn:!0};if(!a)return c.push("Select a target!"),{effects:r,messages:c,consumesTurn:!1};if(!Mt(n.position,a,1))return c.push("Target out of range!"),{effects:r,messages:c,consumesTurn:!1};const g=ge(e,a);if(!g||g.id===n.id)return c.push("No enemy at target!"),{effects:r,messages:c,consumesTurn:!1};if(g.factionId===n.factionId)return c.push("Cannot attack friendlies!"),{effects:r,messages:c,consumesTurn:!1};if(g.subtype==="bomb")return c.push("Cannot attack a bomb!"),{effects:r,messages:c,consumesTurn:!1};let m=1;s.includes("POWER_STRIKE")&&(m+=2);const f=ee(n.previousPosition||n.position,n.position);s.includes("EXTENDED_REACH")&&f&&(m+=1);const b=Ht({attackerId:n.id,targetId:g.id,skillId:"BASIC_ATTACK",basePower:m,trinity:Ie(n),targetTrinity:Ie(g),damageClass:"physical",scaling:[{attribute:"body",coefficient:.5}],statusMultipliers:[],inDangerPreviewHex:!!e.intentPreview?.dangerTiles?.some(C=>ee(C,n.position)),theoreticalMaxPower:m}),S=b.finalPower,T=Math.max(0,S-(g.temporaryArmor||0)),v=g.hp-T<=0,A=Wn(n.position,g.position),_=A>=0?Pt(A):void 0,E=v?"extreme":S>=4?"high":S>=2?"medium":"low";r.push({type:"Juice",effect:"lightImpact",target:"targetActor",intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"anticipation",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:0,durationMs:110,ttlMs:140}}}),r.push({type:"Juice",effect:"dashBlur",target:g.id,path:[n.position,g.position],intensity:E==="extreme"?"high":"medium",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"travel",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:110,durationMs:70,ttlMs:100}}}),r.push({type:"Juice",effect:"heavyImpact",target:g.id,intensity:E,direction:_,metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},..._?{contactRef:{kind:"contact_world"},contactHex:g.position,contactToHex:g.position,contactFromHex:n.position}:{},skillId:"BASIC_ATTACK",camera:{kick:E==="extreme"?"heavy":E==="high"?"medium":"light",freezeMs:E==="extreme"?80:55},timing:{delayMs:180,durationMs:90,ttlMs:150},flags:{lethal:v,...E==="extreme"?{crit:!0}:{}}}}),r.push({type:"Damage",target:"targetActor",amount:S,reason:"basic_attack",scoreEvent:b.scoreEvent}),r.push({type:"Juice",effect:"lightImpact",target:g.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"aftermath",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:280,durationMs:130,ttlMs:170}}});const w=n.type==="player"?"You":`${n.subtype||"enemy"}#${n.id}`,M=g.type==="player"?"you":`${g.subtype||"enemy"}#${g.id}`;return c.push(`${w} attacked ${M}!`),s.includes("VAMPIRIC")&&g.hp-T<=0&&(r.push({type:"Heal",target:n.id,amount:1}),c.push("Vampiric heal!")),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ge(e,n);return a?We(n).filter(r=>{const c=ge(e,r);return!!c&&c.subtype!=="bomb"&&c.id!==a.id&&c.factionId!==a.factionId}):[]},upgrades:{EXTENDED_REACH:{id:"EXTENDED_REACH",name:"Disciplined Stance",description:"+1 damage when attacking without moving first."},POWER_STRIKE:{id:"POWER_STRIKE",name:"Power Strike",description:"Damage +2"},VAMPIRIC:{id:"VAMPIRIC",name:"Vampiric",description:"Heal 1 HP on kill"}},scenarios:Qe("BASIC_ATTACK")},MT=e=>{if(!e||e.length===0)return e;let n=!1;const a=e.map(s=>(s.currentCooldown||0)<=0?s:(n=!0,{...s,currentCooldown:0}));return n?a:e},Ny=e=>{const n=MT(e.activeSkills),a=(e.actionCooldown||0)>0?0:e.actionCooldown;return n===e.activeSkills&&a===e.actionCooldown?e:{...e,activeSkills:n||e.activeSkills,actionCooldown:a}},nf=e=>e.enemies.filter(a=>a.hp>0&&a.factionId==="enemy").length===0,OT=e=>{if(!nf(e))return e;const n=Ny(e.player),a=e.companions?.map(Ny),s=e.traps?.map(u=>u.cooldown>0?{...u,cooldown:0}:u),r=!!e.companions&&a?.some((u,p)=>u!==e.companions?.[p]),c=!!e.traps&&s?.some((u,p)=>u!==e.traps?.[p]);return n===e.player&&!r&&!c?e:{...e,player:n,...r?{companions:a}:{},...c?{traps:s}:{}}},ky=(e,n)=>nf(e)?20:Math.max(n.speed||1,1),f0=(e,n)=>He.isWithinBounds(e,n)?Oe.getTraitsAt(e,n).has("BLOCKS_MOVEMENT"):!0,Ry=(e,n,a,s)=>{const r=new Map,c=[],u=g=>`${g.q},${g.r}`,p=[{p:a,cost:0}];for(r.set(u(a),0);p.length>0;){const g=p.shift();if(!(g.cost>=s))for(const m of We(g.p)){if(!He.isWithinBounds(e,m)||!Oe.isWalkable(e,m)||!a0(e,n,m,"BASIC_MOVE"))continue;const f=ge(e,m),b=!!f&&f.id!==n.id,S=b&&f.factionId===n.factionId;if(b&&!S)continue;const T=u(m),v=g.cost+1;r.has(T)&&r.get(T)<=v||(r.set(T,v),!S&&ki(e,n,m)&&!f0(e,m)&&c.push(m),p.push({p:m,cost:v}))}}return c},CT=(e,n,a,s,r)=>{const c=T=>`${T.q},${T.r}`,u=T=>{const[v,A]=T.split(",").map(Number);return{q:v,r:A,s:-v-A}},p=[a],g=new Map([[c(a),0]]),m=new Map([[c(a),null]]);for(;p.length>0;){const T=p.shift(),v=c(T),A=g.get(v);if(!(A>=r))for(const _ of We(T)){if(!He.isWithinBounds(e,_)||!Oe.isWalkable(e,_)||!a0(e,n,_,"BASIC_MOVE"))continue;const E=ge(e,_),w=!!E&&E.id!==n.id,M=w&&E.factionId===n.factionId;if(w&&!M)continue;const C=c(_),L=A+1;g.has(C)&&g.get(C)<=L||(g.set(C,L),m.set(C,v),p.push(_))}}const f=c(s);if(!m.has(f)||f0(e,s)||!ki(e,n,s))return null;const b=[];let S=f;for(;S;)b.push(u(S)),S=m.get(S)||null;return b.reverse(),b},NT={id:"BASIC_MOVE",name:"Walk",description:"Move to an adjacent or nearby tile within your speed range.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};const c=ky(e,n),p=Ry(e,n,n.position,c).some(f=>ee(f,a)),g=CT(e,n,n.position,a,c);if(!p||!g||g.length<2)return r.push("Target out of reach or blocked!"),{effects:s,messages:r,consumesTurn:!1};s.push({type:"Displacement",target:"self",destination:a,source:n.position,path:g,simulatePath:!0,ignoreCollision:!0});const m=n.id===e.player.id?"You":`${n.subtype||"enemy"}#${n.id}`;return r.push(`${m} moved to (${a.q}, ${a.r}). [Range ${c}]`),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ge(e,n);if(!a)return[];const s=ky(e,a);return Ry(e,a,n,s).filter(c=>!da(e,c,a.id))},upgrades:{},scenarios:Qe("BASIC_MOVE")},kT={id:"BOMB_TOSS",name:"Bomb Toss",description:"Throw a bomb to a nearby tile.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:2},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};if(!Mt(n.position,a,3))return r.push("Out of range!"),{effects:s,messages:r,consumesTurn:!1};if(!Oe.isWalkable(e,a))return r.push("Target blocked!"),{effects:s,messages:r,consumesTurn:!1};if(ge(e,a))return r.push("Target occupied!"),{effects:s,messages:r,consumesTurn:!1};const u=`bomb-${n.id}-${e.turnNumber}-${e.actionLog?.length??0}-${a.q}_${a.r}_${a.s}`,p=ca({id:u,type:"enemy",subtype:"bomb",factionId:n.factionId,position:a,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return p.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],s.push({type:"SpawnActor",actor:p}),r.push("Bomb tossed!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const s=[];for(let r=-3;r<=3;r++)for(let c=Math.max(-3,-r-3);c<=Math.min(3,-r+3);c++){const u={q:n.q+r,r:n.r+c,s:n.s-r-c};Mt(n,u,3)&&Oe.isWalkable(e,u)&&(ge(e,u)||s.push(u))}return s},upgrades:{}},RT={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Charge into an adjacent enemy, pushing a chain. Wall hard-stop stuns the chain.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:3},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};if(me(n.position,a)!==1)return r.push("Target not adjacent!"),{effects:s,messages:r,consumesTurn:!1};const u=Fn(e.enemies,a);if(!u)return r.push("No target!"),{effects:s,messages:r,consumesTurn:!1};const{isAxial:p,directionIndex:g}=jn(n.position,a);if(!p)return{effects:s,messages:r,consumesTurn:!1};const m=Pt(g),f=[u];let b={q:u.position.q+m.q,r:u.position.r+m.r,s:u.position.s+m.s};for(;;){const v=Fn(e.enemies,b);if(v){if(f.push(v),b={q:b.q+m.q,r:b.r+m.r,s:b.s+m.s},f.length>6)break;continue}break}const S=[];for(let v=0;v<f.length;v++){const A=f[v],_=v===0?2:1,E={q:A.position.q+m.q*_,r:A.position.r+m.r*_,s:A.position.s+m.s*_};S.push({actor:A,dest:E})}let T=!1;for(const v of S){const A=e.tiles.get(ue(v.dest));if(A?.baseId==="WALL"||A?.traits.has("BLOCKS_MOVEMENT")){T=!0;break}if(e.enemies.find(E=>ee(E.position,v.dest)&&!f.some(w=>w.id===E.id))){T=!0;break}}if(T){for(const v of f)s.push({type:"ApplyStatus",target:v.position,status:"stunned",duration:1}),r.push("Chain blocked! Stunned.");return{effects:s,messages:r}}for(const v of S)s.push({type:"Displacement",target:v.actor.id,destination:v.dest});return s.push({type:"Displacement",target:"self",destination:u.position}),r.push("Bulwark Charge!"),{effects:s,messages:r}},getValidTargets:(e,n)=>[{q:n.q+1,r:n.r,s:n.s-1},{q:n.q+1,r:n.r-1,s:n.s},{q:n.q,r:n.r-1,s:n.s+1},{q:n.q-1,r:n.r,s:n.s+1},{q:n.q-1,r:n.r+1,s:n.s},{q:n.q,r:n.r+1,s:n.s-1}].filter(s=>!!Fn(e.enemies,s)),upgrades:{},scenarios:[{id:"chain_stun",title:"Chain-Stun",description:"Wall prevents chain, chain gets stunned",setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,n)=>!0}]},IT=(e,n)=>!!e.tiles.get(ue(n))?.traits?.has("CORPSE"),LT=(e,n,a)=>{const s=[];return e.tiles.forEach(r=>{r.traits.has("CORPSE")&&me(n,r.position)<=a&&s.push(r.position)}),s},BT={id:"CORPSE_EXPLOSION",name:"Corpse Explosion",description:"Detonate a target corpse, dealing damage in a 1-tile radius.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:2},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};if(!IT(e,a))return{effects:s,messages:["A corpse is required!"],consumesTurn:!1};if(!Mt(n.position,a,4))return{effects:s,messages:["Out of range!"],consumesTurn:!1};s.push({type:"RemoveCorpse",position:a});const u=[a,...We(a)],p=Ie(n),g=!!e.intentPreview?.dangerTiles?.some(m=>ee(m,n.position));for(const m of u){const f=ge(e,m),b=Ht({attackerId:n.id,targetId:f?.id||ue(m),skillId:"CORPSE_EXPLOSION",basePower:2,trinity:p,targetTrinity:f?Ie(f):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.25}],statusMultipliers:[],inDangerPreviewHex:g,theoreticalMaxPower:2});s.push({type:"Damage",target:m,amount:b.finalPower,reason:"corpse_explosion",scoreEvent:b.scoreEvent})}return s.push({type:"Juice",effect:"explosion_ring",target:a,metadata:{signature:"ATK.BLAST.VOID.CORPSE_EXPLOSION",family:"attack",primitive:"blast",phase:"impact",element:"void",variant:"corpse_explosion",targetRef:{kind:"target_hex"},skillId:"CORPSE_EXPLOSION"}}),s.push({type:"Juice",effect:"shake",intensity:"high",metadata:{signature:"UI.SHAKE.VOID.CORPSE_EXPLOSION",family:"ui",primitive:"shake",phase:"impact",element:"void",variant:"corpse_explosion_shake",skillId:"CORPSE_EXPLOSION",camera:{shake:"high"}}}),s.push({type:"Juice",effect:"combat_text",target:a,text:"BOOM!",metadata:{signature:"UI.TEXT.VOID.CORPSE_EXPLOSION",family:"ui",primitive:"text",phase:"impact",element:"void",variant:"corpse_explosion_text",targetRef:{kind:"target_hex"},skillId:"CORPSE_EXPLOSION",textTone:"damage"}}),r.push("Corpse exploded!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>LT(e,n,4),upgrades:{},scenarios:Qe("CORPSE_EXPLOSION")},Ri=(e,n)=>e.type!=="Juice"?e:{...e,metadata:{...e.metadata||{},...n}},m0=e=>!!e&&typeof e.q=="number"&&typeof e.r=="number"&&typeof e.s=="number",p0=e=>m0(e)?Math.abs(e.q)+Math.abs(e.r)+Math.abs(e.s)===2:!1,h0=(e,n)=>({q:e.q-n.q,r:e.r-n.r,s:e.s-n.s}),ye={shake:(e,n)=>({type:"Juice",effect:"shake",intensity:e,direction:n,metadata:{signature:"UI.SHAKE.NEUTRAL.CAMERA",family:"ui",primitive:"shake",phase:"instant",element:"neutral",variant:"camera_shake",camera:{shake:e,...n?{kick:e==="extreme"?"heavy":e==="high"?"medium":"light"}:{}}}}),flash:e=>({type:"Juice",effect:"flash",intensity:"high",color:e,metadata:{signature:"ATK.BLAST.NEUTRAL.FLASH",family:"attack",primitive:"blast",phase:"impact",element:"neutral",variant:"flash"}}),freeze:(e=80)=>({type:"Juice",effect:"freeze",duration:e,metadata:{signature:"UI.FREEZE.NEUTRAL.HITSTOP",family:"ui",primitive:"freeze",phase:"instant",element:"neutral",variant:"hitstop",camera:{freezeMs:e},timing:{durationMs:e,ttlMs:e}}}),combatText:(e,n,a)=>({type:"Juice",effect:"combat_text",text:e,target:n,color:a}),momentumTrail:(e,n)=>({type:"Juice",effect:"momentumTrail",path:e,intensity:n}),heavyImpact:(e,n)=>({type:"Juice",effect:"heavyImpact",target:e,direction:n,intensity:"extreme"}),lightImpact:e=>({type:"Juice",effect:"lightImpact",target:e,intensity:"low"}),kineticWave:(e,n,a)=>({type:"Juice",effect:"kineticWave",target:e,direction:n,intensity:a}),stunBurst:e=>({type:"Juice",effect:"stunBurst",target:e,intensity:"medium"}),lavaRipple:e=>({type:"Juice",effect:"lavaRipple",target:e,intensity:"medium"}),wallCrack:(e,n)=>({type:"Juice",effect:"wallCrack",target:e,direction:n,intensity:"high"}),explosionRing:e=>({type:"Juice",effect:"explosion_ring",target:e})};ye.combatText=(e=>(n,a,s)=>Ri(e(n,a,s),{signature:"UI.TEXT.NEUTRAL.POPUP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"combat_text",targetRef:typeof a=="string"?{kind:"target_actor"}:{kind:"target_hex"},textTone:/^[-]/.test(n)?"damage":/^\+/.test(n)?"heal":"system"}))(ye.combatText);ye.momentumTrail=(e=>(n,a)=>Ri(e(n,a),{signature:"MOVE.DASH.KINETIC.MOMENTUM_TRAIL",family:"movement",primitive:"dash",phase:"travel",element:"kinetic",variant:"momentum_trail"}))(ye.momentumTrail);ye.heavyImpact=(e=>(n,a)=>{const s={signature:"ATK.STRIKE.PHYSICAL.HEAVY",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"heavy_impact",sourceRef:{kind:"source_actor"}};return m0(n)?(s.targetRef={kind:"target_hex"},a&&p0(a)&&(s.contactHex=n,s.contactToHex=n,s.contactFromHex=h0(n,a),s.contactRef={kind:"contact_world"})):s.targetRef={kind:"target_actor"},Ri(e(n,a),s)})(ye.heavyImpact);ye.lightImpact=(e=>n=>Ri(e(n),{signature:"ATK.STRIKE.PHYSICAL.LIGHT",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"light_impact",sourceRef:{kind:"source_actor"},targetRef:typeof n=="string"?{kind:"target_actor"}:{kind:"target_hex"}}))(ye.lightImpact);ye.kineticWave=(e=>(n,a,s)=>Ri(e(n,a,s),{signature:"ATK.PULSE.KINETIC.WAVE",family:"attack",primitive:"pulse",phase:"impact",element:"kinetic",variant:"kinetic_wave",targetRef:{kind:"target_hex"},sourceRef:{kind:"source_hex"}}))(ye.kineticWave);ye.stunBurst=(e=>n=>Ri(e(n),{signature:"STATE.APPLY.NEUTRAL.STUN_BURST",family:"status",primitive:"status_apply",phase:"impact",element:"neutral",variant:"stun_burst",targetRef:typeof n=="string"?{kind:"target_actor"}:{kind:"target_hex"}}))(ye.stunBurst);ye.lavaRipple=(e=>n=>Ri(e(n),{signature:"ENV.HAZARD.FIRE.LAVA_RIPPLE",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_ripple",targetRef:{kind:"target_hex"}}))(ye.lavaRipple);ye.wallCrack=(e=>(n,a)=>{const s={signature:"ENV.COLLISION.KINETIC.WALL_CRACK",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"wall_crack",targetRef:{kind:"target_hex"}};return p0(a)&&(s.contactHex=n,s.contactToHex=n,s.contactFromHex=h0(n,a),s.contactRef={kind:"contact_world"}),Ri(e(n,a),s)})(ye.wallCrack);ye.explosionRing=(e=>n=>Ri(e(n),{signature:"ATK.BLAST.FIRE.EXPLOSION_RING",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"explosion_ring",targetRef:{kind:"target_hex"}}))(ye.explosionRing);const Et={GRAPPLE_HOOK:{anticipation:(e,n)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,n],intensity:"low",color:"#00ff88"}],execution:e=>[{type:"Juice",effect:"hookCable",path:e,intensity:"medium",duration:200,color:"#00ff88"},ye.shake("low")],impact:(e,n)=>[{type:"Juice",effect:"grappleHookWinch",target:e,direction:n,intensity:"high",duration:150},ye.shake("medium",n)],resolution:(e,n)=>[ye.momentumTrail(e,n>6?"high":"medium"),ye.kineticWave(e[0],e[e.length-1],"high")]},SHIELD_THROW:{anticipation:(e,n)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,n],intensity:"medium",color:"#4169e1"}],execution:e=>[{type:"Juice",effect:"shieldArc",path:e,intensity:"high",duration:300,metadata:{rotation:720}},{type:"Juice",effect:"shieldSpin",path:e,intensity:"medium"}],impact:(e,n)=>[ye.heavyImpact(e,n),ye.shake("high",n),ye.freeze(120),ye.combatText("IMPACT!",e,"#ff4444")],resolution:e=>[ye.kineticWave(e[0],e[e.length-1],"high"),ye.momentumTrail(e,"high")]},DASH:{anticipation:(e,n)=>[{type:"Juice",effect:"chargeUp",target:e,direction:n,intensity:"medium",duration:100}],execution:e=>[{type:"Juice",effect:"dashBlur",path:e,intensity:"high",duration:150},ye.momentumTrail(e,"medium")],impact:(e,n,a)=>a?[ye.heavyImpact(e,n),ye.shake("extreme",n),ye.freeze(100),ye.combatText("SHUNT!",e,"#ffaa00")]:[ye.lightImpact(e)],resolution:e=>e?[ye.kineticWave(e[0],e[e.length-1],"high"),ye.momentumTrail(e,"high")]:[]},SPEAR_THROW:{anticipation:(e,n)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,n],intensity:"low",color:"#ff6b6b"}],execution:e=>[{type:"Juice",effect:"spearTrail",path:e,intensity:"high",duration:150},{type:"Juice",effect:"spearWhistle",path:e,intensity:"medium",metadata:{pitch:"rising"}}],impact:(e,n)=>n?[ye.heavyImpact(e),ye.shake("medium"),ye.freeze(60),ye.combatText("LETHAL",e,"#ff0000")]:[ye.lightImpact(e),ye.combatText("MISS",e,"#888888")],resolution:()=>[]},VAULT:{anticipation:(e,n)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,n],intensity:"low",color:"#00ddff",metadata:{arc:"high"}}],execution:e=>[{type:"Juice",effect:"vaultLeap",path:e,intensity:"medium",duration:250,metadata:{arc:"parabolic"}}],impact:(e,n)=>n?[ye.heavyImpact(e),ye.shake("medium"),ye.stunBurst(e),ye.combatText("STUN!",e,"#ffff00")]:[ye.lightImpact(e)],resolution:()=>[]}},Sd={lavaSink:e=>[{type:"Juice",effect:"lavaSink",target:e,intensity:"extreme",duration:500,metadata:{particleCount:50}},ye.lavaRipple(e),ye.shake("high"),ye.combatText("CONSUMED",e,"#ff4400")],wallImpact:(e,n,a)=>{const s=[ye.wallCrack(e,n),ye.shake("high",n)];return a&&(s.push(ye.stunBurst(e)),s.push(ye.combatText("STUNNED",e,"#ffaa00"))),s},voidConsume:e=>[{type:"Juice",effect:"voidConsume",target:e,intensity:"extreme",duration:800,color:"#000000"},ye.freeze(150),ye.combatText("VOID",e,"#8800ff")]};function Fl(e,n){const{origin:a,direction:s,momentum:r}=n,c=[];c.push(ye.kineticWave(a,s,r>6?"high":"medium"));const u=sn(a,{q:s.q*(r+10),r:s.r*(r+10),s:s.s*(r+10)}),p=dt(a,u);let g=r,m=HT(e,p);for(;g>0&&m.length>0;){const f=PT(m);if(f.length===0)break;const b=f.length;if(g<b){const w=f[f.length-1],M=g;g=0;const C=[p[w.pos1D]];for(let L=0;L<M;L++){const k=w.pos1D+1,R=p[k];if(!R||!ua(R,e.gridWidth,e.gridHeight)||Iy(e,R)){c.push({type:"Impact",target:w.id,damage:M-L,direction:s});break}if(w.pos1D=k,C.push(R),Ly(e,R)){c.push({type:"LavaSink",target:w.id}),c.push(...Sd.lavaSink(R));break}}C.length>1&&(c.push({type:"Displacement",target:w.id,destination:C[C.length-1],path:C,animationDuration:C.length*80}),c.push(ye.momentumTrail(C,"medium")));break}const S=f[f.length-1],T=S.pos1D+1,v=p[T];if(!v||!ua(v,e.gridWidth,e.gridHeight)||Iy(e,v)){c.push({type:"ApplyStatus",target:S.id,status:"stunned",duration:1}),v&&c.push(...Sd.wallImpact(v,s,!0));break}const A=new Map;for(const w of f){const M=p[w.pos1D];w.pos1D+=1;const C=p[w.pos1D];A.set(w.id,[M,C])}const _=[...f].reverse();for(const w of _){const M=A.get(w.id);M&&c.push({type:"Displacement",target:w.id,destination:M[M.length-1],path:M,ignoreCollision:!0,animationDuration:150})}const E=Array.from(A.values()).flat();E.length>0&&c.push(ye.momentumTrail(E,b>2?"high":"medium")),g-=b;for(let w=m.length-1;w>=0;w--){const M=m[w],C=p[M.pos1D];Ly(e,C)&&(c.push({type:"LavaSink",target:M.id}),c.push(...Sd.lavaSink(C)),m.splice(w,1))}if(g>0){const w=f[f.length-1];m=m.filter(C=>C.pos1D>=w.pos1D);const M=m.filter(C=>C.pos1D>w.pos1D);m=[w,...M]}}return c}function HT(e,n){const a=[],s=[e.player,...e.enemies];for(const r of s){const c=n.findIndex(u=>ee(u,r.position));c!==-1&&a.push({id:r.id,pos1D:c})}return a.sort((r,c)=>r.pos1D-c.pos1D)}function PT(e){if(e.length===0)return[];const n=[];let a=e[0];n.push(a);for(let s=1;s<e.length;s++){const r=e[s];if(r.pos1D===a.pos1D||r.pos1D===a.pos1D+1)n.push(r),a=r;else break}return n}function Iy(e,n){const a=Oe.getTraitsAt(e,n);return a.has("BLOCKS_MOVEMENT")||a.has("BLOCKS_LOS")}function Ly(e,n){const a=Oe.getTraitsAt(e,n);return a.has("HAZARDOUS")||a.has("LIQUID")}const jT={id:"DASH",name:"Kinetic Dash",description:"Dash in a straight line. With a shield, slam into enemies and send them flying!",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:0},execute:(e,n,a,s=[])=>{const r=[],c=[],u=s.includes("MOMENTUM_SURGE"),p=s.includes("DASH_CHAIN_REACTION")||s.includes("CHAIN_REACTION");if(!a)return{effects:r,messages:c,consumesTurn:!1};const{isAxial:g,directionIndex:m}=jn(n.position,a),b=e.enemies.filter(E=>E.hp>0).length===0?20:4;if(!Mt(n.position,a,b))return{effects:r,messages:["Out of range!"],consumesTurn:!1};if(!g)return{effects:r,messages:["Axial only! Dash must be in a straight line."],consumesTurn:!1};r.push(...Et.DASH.anticipation(n.position,a));const S=Pt(m),T=dt(n.position,a),v=Zd(e,T.slice(1),{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:n.id});let A=a;if(v.obstacle){if(v.obstacle==="wall")return{effects:r,messages:["A wall blocks the way!"],consumesTurn:!1};if(v.obstacle==="lava")return{effects:r,messages:["Lava blocks the way!"],consumesTurn:!1};const E=T.findIndex(w=>ee(w,v.position));A=T[E-1]||n.position}if(v.obstacle==="actor"?v.actor:null){const E=dt(n.position,A);r.push(...Et.DASH.execution(E));const w=[{type:"Displacement",target:"self",destination:A,path:E,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:E.length*60}],M=Gn(e,w,{sourceId:n.id});if(e.hasShield){r.push(...Et.DASH.impact(A,S,!0));const C=5+(e.hasShield&&u?2:0)+(p?1:0),L=Fl(M,{origin:A,direction:S,momentum:C});return{effects:[...r,...w,...L],messages:[...c,"Shield Shunt!"],consumesTurn:!0}}else return r.push(...Et.DASH.impact(A,S,!1)),{effects:[...r,...w],messages:[...c,"Stopped by an obstacle (Need shield to shunt)."],consumesTurn:!ee(n.position,A)}}else{const E=dt(n.position,A);r.push(...Et.DASH.execution(E));const w={type:"Displacement",target:"self",destination:A,path:E,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:E.length*60};return{effects:[...r,w],messages:[...c,"Dashed!"],consumesTurn:!ee(n.position,A)}}},getValidTargets:(e,n)=>{const s=e.enemies.filter(c=>c.hp>0).length===0?20:4,r=ge(e,n);return r?He.getAxialTargets(e,n,s,{stopAtObstacles:!0,includeActors:!0,includeWalls:!1}).filter(c=>ki(e,r,c)):[]},upgrades:{MOMENTUM_SURGE:{id:"MOMENTUM_SURGE",name:"Momentum Surge",description:"+2 Momentum when dashing with shield"},DASH_CHAIN_REACTION:{id:"DASH_CHAIN_REACTION",name:"Chain Reaction",description:"Enemies pushed into other enemies transfer momentum"}},scenarios:Qe("DASH")},DT={id:"FALCON_APEX_STRIKE",name:"Apex Strike",description:"The falcon dives into a target for lethal damage.",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:2,damage:40},execute:(e,n,a,s=[])=>{const r=[],c=[],u=n.companionOf,g=(u?u===e.player.id?e.player:e.enemies.find(S=>S.id===u):void 0)?.activeSkills?.find(S=>S.id==="FALCON_COMMAND")?.activeUpgrades||[],m=s.includes("APEX_PREDATOR")||g.includes("APEX_PREDATOR");if(!a)return{effects:r,messages:c,consumesTurn:!1};const f=ge(e,a);if(!f)return{effects:r,messages:c,consumesTurn:!1};if(n.companionState?.apexStrikeCooldown&&n.companionState.apexStrikeCooldown>0)return{effects:r,messages:c,consumesTurn:!1};const b=Ht({attackerId:n.id,targetId:f.id,skillId:"FALCON_APEX_STRIKE",basePower:40,trinity:Ie(n),targetTrinity:Ie(f),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return r.push({type:"Damage",target:f.id,amount:b.finalPower,reason:"apex_strike",scoreEvent:b.scoreEvent}),r.push({type:"Juice",effect:"impact",target:a,intensity:"high",metadata:{signature:"ATK.STRIKE.PHYSICAL.FALCON_APEX_STRIKE",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"falcon_apex_strike",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"FALCON_APEX_STRIKE",camera:{kick:"medium"}}}),r.push({type:"UpdateCompanionState",target:n.id,apexStrikeCooldown:m?1:2}),c.push(`Falcon executes APEX STRIKE on ${f.subtype||"enemy"}!`),{effects:r,messages:c,consumesTurn:!0}},upgrades:{},getValidTargets:(e,n)=>{const a=[];return e.enemies.forEach(s=>{me(n,s.position)<=4&&a.push(s.position)}),a}},UT={id:"FALCON_AUTO_ROOST",name:"Auto Roost",description:"Automatically returns the falcon to roost mode when mark is lost.",slot:"passive",icon:"R",baseVariables:{range:0,cost:0,cooldown:0},execute:(e,n,a)=>({effects:[{type:"UpdateCompanionState",target:n.id,mode:"roost",markTarget:void 0}],messages:["Falcon loses prey and returns to roost mode."],consumesTurn:!0}),getValidTargets:(e,n)=>[n],upgrades:{}};function xd(e,n){return e.enemies.find(a=>a.companionOf===n&&a.subtype==="falcon")}const $T={id:"FALCON_COMMAND",name:e=>{const n=e?.player?.id;if(!n)return"Summon Falcon";const a=xd(e,n);if(!a)return"Summon Falcon";const s=a.companionState?.mode||"roost";return s==="scout"?"Falcon: Scout":s==="predator"?"Falcon: Hunt":"Falcon: Roost"},description:e=>{const n=e?.player?.id;if(!n)return"Call your Falcon companion.";const a=xd(e,n);if(!a)return"Call your Falcon companion.";const s=a.companionState?.mode||"roost";return s==="scout"?"Click tile to set patrol zone. Falcon orbits and attacks nearby enemies.":s==="predator"?"Click enemy to mark as prey. Falcon pursues and uses Apex Strike.":"Falcon returns to you. Heals and cleanses 1 debuff on arrival."},slot:"offensive",icon:"",baseVariables:{range:6,cost:0,cooldown:0},execute:(e,n,a)=>{const s=[],r=[];let c=xd(e,n.id);if(!c){const g=WS({ownerId:n.id,position:We(n.position)[0]});return s.push({type:"SpawnActor",actor:g}),s.push({type:"Message",text:"Your Falcon companion awakens!"}),r.push("Falcon summoned!"),{effects:s,messages:r,consumesTurn:!0}}const u=a?ge(e,a):void 0;return!a||ee(a,n.position)||!!(u&&u.id===n.id)?(r.push("Falcon returns to roost."),s.push({type:"Juice",effect:"combat_text",target:n.position,text:"Roost",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_ROOST",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_roost",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"system"}}),s.push({type:"UpdateCompanionState",target:c.id,mode:"roost"}),{effects:s,messages:r,consumesTurn:!0}):u&&u.factionId==="enemy"?(r.push(`Falcon marks ${u.subtype||"enemy"} as prey!`),s.push({type:"Juice",effect:"combat_text",target:a,text:" Marked",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_MARK",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_mark",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"status"}}),s.push({type:"ApplyStatus",target:u.id,status:"marked_predator",duration:-1}),s.push({type:"UpdateCompanionState",target:c.id,mode:"predator",markTarget:u.id}),{effects:s,messages:r,consumesTurn:!0}):(r.push("Falcon set to patrol zone."),s.push({type:"Juice",effect:"combat_text",target:a,text:" Patrol",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_PATROL",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_patrol",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"system"}}),s.push({type:"UpdateCompanionState",target:c.id,mode:"scout",markTarget:a}),{effects:s,messages:r,consumesTurn:!0})},getValidTargets:(e,n)=>He.getAreaTargets(e,n,6).filter(s=>(ee(s,n),!0)),upgrades:{KEEN_SIGHT:{id:"KEEN_SIGHT",name:"Keen Sight",description:"Falcon reveals hidden enemies within 3 tiles of its position."},FALCON_TWIN_TALONS:{id:"FALCON_TWIN_TALONS",name:"Twin Talons",description:"Basic Peck hits 2 targets instead of 1."},APEX_PREDATOR:{id:"APEX_PREDATOR",name:"Apex Predator",description:"Apex Strike cooldown reduced by 1. Marked enemies take +1 damage from all sources."}},scenarios:Qe("FALCON_COMMAND")},qT={id:"FALCON_HEAL",name:"Roost Heal",description:"The falcon roosts and restores health to its companion.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:1},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};const c=ge(e,a);return c?n.companionState?.healCooldown&&n.companionState.healCooldown>0?{effects:s,messages:r,consumesTurn:!1}:(s.push({type:"Heal",target:c.id,amount:1}),s.push({type:"Juice",effect:"flash",target:c.position,color:"#00ff88",metadata:{signature:"STATE.APPLY.HOLY.FALCON_HEAL",family:"status",primitive:"status_apply",phase:"impact",element:"holy",variant:"falcon_heal",targetRef:{kind:"target_hex"},skillId:"FALCON_HEAL"}}),s.push({type:"UpdateCompanionState",target:n.id,healCooldown:1}),r.push("Falcon roosts. You feel restored."),{effects:s,messages:r,consumesTurn:!0}):{effects:s,messages:r,consumesTurn:!1}},upgrades:{},getValidTargets:(e,n)=>{const a=[],s=e.player;return me(n,s.position)<=1&&a.push(s.position),a}},zT={id:"FALCON_PECK",name:"Peck",description:"The falcon pecks an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,n,a,s=[])=>{const r=[],c=[],u=n.companionOf,g=(u?u===e.player.id?e.player:e.enemies.find(S=>S.id===u):void 0)?.activeSkills?.find(S=>S.id==="FALCON_COMMAND")?.activeUpgrades||[],m=s.includes("TWIN_TALONS")||g.includes("TWIN_TALONS")||g.includes("FALCON_TWIN_TALONS");if(!a)return{effects:r,messages:c,consumesTurn:!1};const f=ge(e,a);if(!f||f.factionId==="player")return{effects:r,messages:c,consumesTurn:!1};if(me(n.position,a)>1)return{effects:r,messages:c,consumesTurn:!1};const b=[f];if(m){const S=We(n.position).map(T=>ge(e,T)).filter(T=>!!T&&T.id!==f.id&&T.factionId==="enemy")[0];S&&b.push(S)}for(const S of b){const T=Ht({attackerId:n.id,targetId:S.id,skillId:"FALCON_PECK",basePower:1,trinity:Ie(n),targetTrinity:Ie(S),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:S.id,amount:T.finalPower,reason:"falcon_peck",scoreEvent:T.scoreEvent})}return r.push({type:"Juice",effect:"combat_text",target:a,text:"Peck!",intensity:"low",metadata:{signature:"UI.TEXT.PHYSICAL.FALCON_PECK",family:"ui",primitive:"text",phase:"instant",element:"physical",variant:"falcon_peck",targetRef:{kind:"target_hex"},skillId:"FALCON_PECK",textTone:"damage"}}),c.push(m&&b.length>1?`Falcon pecked ${b.length} enemies!`:`Falcon pecked ${f.subtype||"enemy"}!`),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>We(n).filter(a=>{const s=ge(e,a);return s&&s.factionId==="enemy"}),upgrades:{TWIN_TALONS:{id:"TWIN_TALONS",name:"Twin Talons",description:"Peck hits 2 adjacent targets instead of 1."}},scenarios:Qe("FALCON_PECK")},VT={id:"FALCON_SCOUT",name:"Scout Orbit",description:"The actor orbits a target point in a hexagonal ring.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,n,a)=>{const s=[],r=[],c=n.companionState?.markTarget;if(!c||typeof c!="object")return{effects:s,messages:r,consumesTurn:!1};const u=c,p=We(u);let g;if(me(n.position,u)!==1)g=p.sort((m,f)=>me(n.position,m)-me(n.position,f))[0];else{const f=(p.findIndex(b=>ee(b,n.position))+1)%6;g=p[f]}return He.isWithinBounds(e,g)&&Oe.isWalkable(e,g)&&!ge(e,g)?(s.push({type:"Displacement",target:n.id,destination:g,source:n.position,simulatePath:!0}),{effects:s,messages:r,consumesTurn:!0}):{effects:s,messages:r,consumesTurn:!1}},upgrades:{},getValidTargets:(e,n)=>[]},YT=new Set(["FIREBALL","FIREWALL","FIREWALK","ABSORB_FIRE"]),y0=(e,n)=>{const a=Oe.getTileAt(e,n),s=Oe.getTraitsForTile(e,a),r=c=>a.effects.some(u=>u.id===c);return a.baseId==="VOID"||s.has("VOID")||s.has("PIT")?"VOID_TOUCHED":a.baseId==="ICE"||r("ICE_WALL")?"FROZEN":a.baseId==="LAVA"||s.has("LAVA")||s.has("FIRE")||r("FIRE")?"MELTED":r("WET")||r("STEAM")?"SOAKED":"STABLE"},g0=(e,n)=>YT.has(e)&&n==="MELTED"?1.15:1,KT={id:"FIREBALL",name:"Fireball",description:"Launch a sphere of flame. Range 3, Axial. Deals damage and leaves fire.",slot:"offensive",icon:"",baseVariables:{range:3,cost:1,cooldown:2},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};const{isAxial:c}=jn(n.position,a);if(!Mt(n.position,a,3)||!c)return{effects:s,messages:["Invalid target! Range 3, Axial only."],consumesTurn:!1};const u=[a,...We(a)],p=Ie(n),g=!!e.intentPreview?.dangerTiles?.some(m=>ee(m,n.position));for(const m of u){const f=ge(e,m),b=y0(e,m),S=g0("FIREBALL",b),T=Ht({attackerId:n.id,targetId:f?.id||ue(m),skillId:"FIREBALL",basePower:1,trinity:p,targetTrinity:f?Ie(f):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:S===1?[]:[{id:`surface_${b}`,multiplier:S}],inDangerPreviewHex:g,theoreticalMaxPower:1});s.push({type:"Damage",target:m,amount:T.finalPower,reason:"fireball",scoreEvent:T.scoreEvent}),s.push({type:"PlaceFire",position:m,duration:3})}return s.push({type:"Juice",effect:"flash",target:a,color:"#ff4400",metadata:{signature:"ATK.BLAST.FIRE.FIREBALL_IMPACT",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"fireball",targetRef:{kind:"target_hex"},skillId:"FIREBALL"}}),s.push({type:"Juice",effect:"shake",intensity:"medium",metadata:{signature:"UI.SHAKE.FIRE.FIREBALL",family:"ui",primitive:"shake",phase:"impact",element:"fire",variant:"fireball_shake",skillId:"FIREBALL",camera:{shake:"medium"}}}),r.push("Fireball!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>He.getAxialTargets(e,n,3),upgrades:{},scenarios:Qe("FIREBALL")},FT={id:"FIREWALK",name:"Firewalk",description:"Teleport to a fire or lava tile. Grants 2 turns of Fire Immunity.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};if(!Mt(n.position,a,4))return{effects:s,messages:["Out of range!"],consumesTurn:!1};const c=e.tiles.get(ue(a)),u=c?.effects.some(g=>g.id==="FIRE"),p=c?.baseId==="LAVA"||c?.traits.has("LIQUID");return!u&&!p?{effects:s,messages:["Can only teleport to Fire or Lava!"],consumesTurn:!1}:da(e,a,n.id)?{effects:s,messages:["Target position occupied!"],consumesTurn:!1}:(s.push({type:"Displacement",target:"self",destination:a,source:n.position,simulatePath:!1}),s.push({type:"ApplyStatus",target:"self",status:"fire_immunity",duration:2}),s.push({type:"Juice",effect:"flash",target:a,color:"#ff8800",metadata:{signature:"MOVE.BLINK.FIRE.FIREWALK",family:"movement",primitive:"blink",phase:"impact",element:"fire",variant:"firewalk",targetRef:{kind:"target_hex"},skillId:"FIREWALK"}}),r.push("Firewalk!"),{effects:s,messages:r,consumesTurn:!0})},getValidTargets:(e,n)=>{const a=[];return e.tiles.forEach(s=>{const r=me(n,s.position);if(r>0&&r<=4){const c=s.effects.some(p=>p.id==="FIRE"),u=s.baseId==="LAVA"||s.traits.has("LIQUID");(c||u)&&a.push(s.position)}}),a},upgrades:{},scenarios:Qe("FIREWALK")},WT={id:"FIREWALL",name:"Firewall",description:"Create a wall of flames 5 tiles wide. Area denial.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:4},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};const{isAxial:c,directionIndex:u}=jn(n.position,a);if(!c)return{effects:s,messages:["Axial targeting only!"],consumesTurn:!1};const p=(u+2)%6,g=(u+5)%6,m=[a];let f=a;for(let S=0;S<2;S++)f=sn(f,Pt(p)),He.isWithinBounds(e,f)&&m.push(f);let b=a;for(let S=0;S<2;S++)b=sn(b,Pt(g)),He.isWithinBounds(e,b)&&m.push(b);for(const S of m)if(!Pn(e,S)){s.push({type:"PlaceFire",position:S,duration:3});const T=ge(e,S);if(T){const v=y0(e,S),A=g0("FIREWALL",v),_=Ht({attackerId:n.id,targetId:T.id,skillId:"FIREWALL",basePower:1,trinity:Ie(n),targetTrinity:Ie(T),damageClass:"magical",scaling:[{attribute:"mind",coefficient:.15}],statusMultipliers:A===1?[]:[{id:`surface_${v}`,multiplier:A}]});s.push({type:"Damage",target:T.id,amount:_.finalPower,reason:"firewall_impact",scoreEvent:_.scoreEvent})}}return s.push({type:"Juice",effect:"flash",target:a,color:"#ffaa00",metadata:{signature:"ATK.BLAST.FIRE.FIREWALL",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"firewall",targetRef:{kind:"target_hex"},skillId:"FIREWALL"}}),r.push("Firewall raised!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>He.getAxialTargets(e,n,4),upgrades:{},scenarios:Qe("FIREWALL")};function GT(e,n,a,s){const r=me(n.position,a);if(r<=1)return[];const c=Wn(a,n.position),u=Pt(c);return Fl(e,{origin:a,direction:u,momentum:Math.min(s,r-1)})}function XT(e,n){return[{type:"Displacement",target:e.id,destination:n.position},{type:"Displacement",target:n.id,destination:e.position}]}function JT(e,n,a,s){return Fl(e,{origin:n,direction:a,momentum:s})}const QT={id:"GRAPPLE_HOOK",name:"Grapple Hook",description:"Pull/Zip mechanism with multi-phase kinetic resolution.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3,momentum:4},execute:(e,n,a,s=[])=>{let r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};const{directionIndex:p}=jn(n.position,a),g=Pt(p);r.push(...Et.GRAPPLE_HOOK.anticipation(n.position,a));const{isValid:m,blockedBy:f}=ef(e,n.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:n.id});if(!m)return c.push(`Line of sight blocked by ${f}!`),{effects:r,messages:c,consumesTurn:!1};const b=a,S=ge(e,b),T=Oe.getTraitsAt(e,b),A=T.has("BLOCKS_MOVEMENT")||T.has("ANCHOR")?"Heavy":S?.weightClass||"Standard";if(A==="Heavy"||A==="Anchored"){const _=Id(b,g);r.push(...Et.GRAPPLE_HOOK.execution(dt(n.position,_))),r.push({type:"Displacement",target:n.id,destination:_,ignoreGroundHazards:!0});const E=Oe.getTileAt(e,_);if(E){const M=La.processEntry(n,E,e);r.push(...M.effects),c.push(...M.messages)}const w=We(_);for(const M of w){const C=ge(e,M);C&&C.id!==n.id&&(r.push({type:"Impact",target:C.id,damage:0,direction:g}),r.push({type:"ApplyStatus",target:C.id,status:"stunned",duration:2}),r.push(ye.stunBurst(M)))}return r.push(ye.heavyImpact(_,g)),r.push(ye.shake("high",g)),c.push("Zipped to anchor!"),{effects:r,messages:c,consumesTurn:!0}}else if(S){const _=me(n.position,b),E=Pt((p+3)%6),w=n.position;r.push(...Et.GRAPPLE_HOOK.execution(dt(n.position,a)));const M=GT(e,n,b,_-1),C=Gn(e,M,{sourceId:n.id,targetId:S.id}),L=C.enemies.find(J=>J.id===S.id)||(C.player.id===S.id?C.player:null);if(!L)return c.push(`${S.subtype||"Enemy"} neutralized during pull.`),{effects:[...r,...M],messages:c,consumesTurn:!0};const k=XT(n,L),R=L.position;r.push(...Et.GRAPPLE_HOOK.impact(R,g));const H=Gn(C,k,{sourceId:n.id,targetId:S.id}),D=JT(H,w,E,4),$=dt(w,sn(w,Jd(p,6)));return r.push(...Et.GRAPPLE_HOOK.resolution($,4)),{effects:[...r,...M,...k,...D],messages:["Vaulted and Flung!"],consumesTurn:!0}}else return c.push("Hook missed."),{effects:r,messages:c,consumesTurn:!1}},getValidTargets:(e,n)=>{const a=ge(e,n);return a?He.getAxialTargets(e,n,4,{includeWalls:!0,includeActors:!0,stopAtObstacles:!0}).filter(s=>{const{directionIndex:r}=jn(n,s),c=Pt(r),u=ge(e,s),p=Oe.getTraitsAt(e,s),m=p.has("BLOCKS_MOVEMENT")||p.has("ANCHOR")?Id(s,c):u?s:void 0;return m?ki(e,a,m):!1}):[]},upgrades:{},scenarios:Qe("GRAPPLE_HOOK")},ZT={id:"JUMP",name:"Jump",description:"Leap to an empty tile within range. Can cross lava but not walls.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,n,a,s=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!n||!n.position)return{effects:r,messages:c,consumesTurn:!1};const u=s.includes("JUMP_RANGE"),p=s.includes("STUNNING_LANDING"),g=s.includes("METEOR_IMPACT"),m=s.includes("FREE_JUMP"),f=2+(u?1:0);if(!Mt(n.position,a,f))return c.push("Target out of range!"),{effects:r,messages:c,consumesTurn:!1};const b=ge(e,a),S=Pn(e,a),T=ki(e,n,a);if(S)return c.push("Cannot jump into a wall!"),{effects:r,messages:c,consumesTurn:!1};if(!T)return c.push("Cannot land on hazard!"),{effects:r,messages:c,consumesTurn:!1};if(b&&!g)return c.push("Target hex is blocked!"),{effects:r,messages:c,consumesTurn:!1};if(b&&g){const v=Ht({attackerId:n.id,targetId:b.id,skillId:"JUMP",basePower:99,trinity:Ie(n),targetTrinity:Ie(b),damageClass:"physical",scaling:[{attribute:"body",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:b.id,amount:v.finalPower,scoreEvent:v.scoreEvent}),c.push(`Meteor Impact killed ${b.subtype||"enemy"}!`)}if(r.push({type:"Message",text:"Jumped!"}),r.push({type:"Displacement",target:"self",destination:a,ignoreCollision:!0,ignoreGroundHazards:!0,simulatePath:!0}),p){const v=We(a);let A=!1;for(const _ of v){const E=ge(e,_);E&&E.id!==n.id&&(r.push({type:"ApplyStatus",target:E.id,status:"stunned",duration:1}),A=!0)}A&&c.push("Enemies stunned by landing impact!")}return r.push({type:"Juice",effect:"shake",target:a,intensity:"medium",metadata:{signature:"MOVE.LEAP.NEUTRAL.JUMP_LAND",family:"movement",primitive:"leap",phase:"impact",element:"neutral",variant:"jump_landing",targetRef:{kind:"target_hex"},skillId:"JUMP",camera:{shake:"medium",kick:"light"}}}),{effects:r,messages:c,consumesTurn:!m}},getValidTargets:(e,n)=>{const a=ge(e,n);if(!a)return[];const s=a.activeSkills?.find(p=>p.id==="JUMP"),r=new Set(s?.activeUpgrades||[]),c=2+(r.has("JUMP_RANGE")?1:0),u=r.has("METEOR_IMPACT");return He.getAreaTargets(e,n,c).filter(p=>{if(ee(p,n)||Pn(e,p)||!ki(e,a,p))return!1;const g=ge(e,p);return!(g&&g.id!==a.id&&!u)})},upgrades:{JUMP_RANGE:{id:"JUMP_RANGE",name:"Extended Jump",description:"Jump range +1"},JUMP_COOLDOWN:{id:"JUMP_COOLDOWN",name:"Nimble",description:"Jump cooldown -1",modifyCooldown:-1},STUNNING_LANDING:{id:"STUNNING_LANDING",name:"Stunning Landing",description:"All enemies within 1 hex of landing are stunned"},METEOR_IMPACT:{id:"METEOR_IMPACT",name:"Meteor Impact",description:"Can land on enemies to kill them"},FREE_JUMP:{id:"FREE_JUMP",name:"Free Jump",description:"Can move after jumping"}},scenarios:Qe("JUMP")},By=2,e1=3,t1=3,n1=2;function i1(e,n){const a=[];for(let s=0;s<6;s++){let r=e;for(let c=0;c<n;c++)r=sn(r,Pt(s));a.push(r)}return a}function a1(e,n,a){return i1(n,a).filter(r=>!(!He.isWithinBounds(e,r)||!Oe.isWalkable(e,r)||ge(e,r)))}const s1={id:"KINETIC_TRI_TRAP",name:"Kinetic Tri-Trap",description:"Deploy 3 hidden traps on axial tiles. Triggered enemies are flung away.",slot:"defensive",icon:"",baseVariables:{range:By,cost:0,cooldown:t1},execute:(e,n,a,s=[])=>{const r=[],c=[];let u=e;const p=s.includes("VOLATILE_CORE"),g=s.includes("TRAP_CHAIN_REACTION")||s.includes("CHAIN_REACTION"),m=s.includes("QUICK_RELOAD"),f=a1(e,n.position,By);if(f.length===0)return{effects:r,messages:["No valid trap positions!"],consumesTurn:!1};const b=Math.min(e1,f.length),S=[];r.push({type:"RemoveTrap",position:{q:0,r:0,s:0},ownerId:n.id});const T=[...f];for(let v=0;v<b&&T.length!==0;v++){const{value:A,nextState:_}=Kn(u);u=_;const E=Math.floor(A*T.length)%T.length;S.push(T[E]),T.splice(E,1)}for(const v of S)r.push({type:"PlaceTrap",position:v,ownerId:n.id,volatileCore:p,chainReaction:g,resetCooldown:m?1:n1}),r.push({type:"Juice",effect:"flash",target:v,intensity:"low",color:"#ffaa00",metadata:{signature:"ENV.TRAP.KINETIC.DEPLOY",family:"environment",primitive:"spawn",phase:"impact",element:"kinetic",variant:"kinetic_tri_trap_deploy",targetRef:{kind:"target_hex"},skillId:"KINETIC_TRI_TRAP"}});return c.push(`${S.length} traps deployed.`),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>[n],upgrades:{VOLATILE_CORE:{id:"VOLATILE_CORE",name:"Volatile Core",description:"Traps deal 1 damage when triggered."},TRAP_CHAIN_REACTION:{id:"TRAP_CHAIN_REACTION",name:"Chain Reaction",description:"When a trap triggers, adjacent traps also activate."},QUICK_RELOAD:{id:"QUICK_RELOAD",name:"Quick Reload",description:"Individual trap reset cooldown reduced to 1."}},scenarios:Qe("KINETIC_TRI_TRAP")},o1={id:"MULTI_SHOOT",name:"Multi-Shoot",description:"A spread of arrows. Axial range 4. Deals damage to target and neighbors.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:1},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};const{isAxial:c}=jn(n.position,a);if(!Mt(n.position,a,4)||!c)return{effects:s,messages:["Invalid target! Axial range 4 only."],consumesTurn:!1};const u=[a,...We(a)],p=Ie(n);for(const g of u){const m=ge(e,g),f=Ht({attackerId:n.id,targetId:m?.id||ue(g),skillId:"MULTI_SHOOT",basePower:1,trinity:p,targetTrinity:m?Ie(m):void 0,damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.1},{attribute:"mind",coefficient:.1}],statusMultipliers:[]});s.push({type:"Damage",target:g,amount:f.finalPower,reason:"multi_shoot",scoreEvent:f.scoreEvent})}return s.push({type:"Juice",effect:"flash",target:a,color:"#ffff00",metadata:{signature:"ATK.SHOOT.PHYSICAL.MULTI_SHOOT",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"multi_shoot",targetRef:{kind:"target_hex"},skillId:"MULTI_SHOOT"}}),r.push("Multi-Shoot!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>He.getAxialTargets(e,n,4),upgrades:{},scenarios:Qe("MULTI_SHOOT")},r1=(e,n)=>n.q>=0&&n.q<e.gridWidth&&n.r>=0&&n.r<e.gridHeight,l1=(e,n,a)=>We(a).filter(r=>r1(e,r)).filter(r=>Oe.isWalkable(e,r)).filter(r=>!ge(e,r)).sort((r,c)=>{const u=me(r,n.position),p=me(c,n.position);return u!==p?u-p:r.q!==c.q?r.q-c.q:r.r-c.r})[0]||null,c1=(e,n)=>n.id!==e.id&&n.factionId===e.factionId;function Hy(e,n,a,s="fail"){const r=ge(e,a);if(!r)return{ok:!0,spawnPosition:a,effects:[],messages:[]};if(s==="push_friendly"){if(!c1(n,r))return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."};const c=l1(e,n,a);return c?{ok:!0,spawnPosition:a,effects:[{type:"Displacement",target:r.id,destination:c,source:r.position,simulatePath:!0}],messages:["Ally repositions to make room."]}:{ok:!1,effects:[],messages:[],failureMessage:"No space to reposition ally."}}return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."}}const u1=(e,n)=>!!e.tiles.get(ue(n))?.traits?.has("CORPSE"),d1=(e,n,a)=>{const s=[];return e.tiles.forEach(r=>{r.traits.has("CORPSE")&&me(n,r.position)<=a&&s.push(r.position)}),s},f1=e=>{const n=e.initialSeed??e.rngSeed??"0",a=new Set([...e.enemies.map(c=>c.id),...(e.companions||[]).map(c=>c.id)]);let s=(e.floor<<20)+(e.turnNumber<<12)+(e.actionLog?.length??0)+(e.rngCounter??0),r=`skeleton_${Cs(n,s,8,"skeleton")}`;for(;a.has(r);)s+=1,r=`skeleton_${Cs(n,s,8,"skeleton")}`;return r},m1={id:"RAISE_DEAD",name:"Raise Dead",description:"Reanimate a target corpse into a Skeleton minion (Faction: Player).",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};if(!u1(e,a))return{effects:s,messages:["A corpse is required!"],consumesTurn:!1};if(!Mt(n.position,a,4))return{effects:s,messages:["Out of range!"],consumesTurn:!1};const u=Hy(e,n,a,"push_friendly");if(!u.ok)return{effects:s,messages:[u.failureMessage||"Target tile occupied."],consumesTurn:!1};s.push(...u.effects),r.push(...u.messages),s.push({type:"RemoveCorpse",position:a});const p=n0({companionType:"skeleton",ownerId:n.id,id:f1(e),position:a});return s.push({type:"SpawnActor",actor:p}),s.push({type:"Juice",effect:"flash",target:a,color:"#aaaaaa",metadata:{signature:"STATE.SPAWN.VOID.RAISE_DEAD",family:"status",primitive:"spawn",phase:"impact",element:"void",variant:"raise_dead",targetRef:{kind:"target_hex"},skillId:"RAISE_DEAD"}}),r.push("Skeleton raised!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>{const a=ge(e,n);return a?d1(e,n,4).filter(s=>Hy(e,a,s,"push_friendly").ok):[]},upgrades:{},scenarios:Qe("RAISE_DEAD")},p1={id:"SENTINEL_BLAST",name:"Sentinel Blast",description:"A massive energy surge from the Sentinel.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:2},execute:(e,n,a)=>{if(!a)return{effects:[],messages:[]};const s=Ie(n),r=ge(e,a),c=Ht({attackerId:n.id,targetId:r?.id||ue(a),skillId:"SENTINEL_BLAST",basePower:2,trinity:s,targetTrinity:r?Ie(r):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:[]}),u=[{type:"Damage",target:a,amount:c.finalPower,scoreEvent:c.scoreEvent},{type:"Juice",effect:"shake",intensity:"high",metadata:{signature:"ATK.BLAST.ARCANE.SENTINEL_BLAST",family:"attack",primitive:"blast",phase:"impact",element:"arcane",variant:"sentinel_blast",targetRef:{kind:"target_hex"},skillId:"SENTINEL_BLAST",camera:{shake:"high"}}}];return We(a).forEach(g=>{const m=ge(e,g),f=Ht({attackerId:n.id,targetId:m?.id||ue(g),skillId:"SENTINEL_BLAST",basePower:1,trinity:s,targetTrinity:m?Ie(m):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.1}],statusMultipliers:[]});u.push({type:"Damage",target:g,amount:f.finalPower,scoreEvent:f.scoreEvent})}),{effects:u,messages:["The Sentinel unleashed a massive blast!"],consumesTurn:!0}},getValidTargets:(e,n)=>He.getAreaTargets(e,n,3),upgrades:{},scenarios:Qe("SENTINEL_BLAST")},h1={id:"SENTINEL_TELEGRAPH",name:"Sentinel Telegraph",description:"The Sentinel marks an impact zone for a delayed blast.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0},execute:(e,n,a)=>a?{effects:[{type:"Juice",effect:"combat_text",target:a,text:"TELEGRAPH",metadata:{signature:"UI.TEXT.ARCANE.SENTINEL_TELEGRAPH",family:"ui",primitive:"text",phase:"telegraph",element:"arcane",variant:"sentinel_telegraph",targetRef:{kind:"target_hex"},skillId:"SENTINEL_TELEGRAPH",textTone:"system"}}],messages:["The Sentinel marks the impact zone."],consumesTurn:!0}:{effects:[],messages:[],consumesTurn:!0},getValidTargets:(e,n)=>He.getAreaTargets(e,n,3),upgrades:{},scenarios:Qe("SENTINEL_TELEGRAPH")},y1={id:"SET_TRAP",name:"Set Trap",description:"Place a hidden trap. Roots units for 3 turns.",slot:"utility",icon:"",baseVariables:{range:1,cost:1,cooldown:2},execute:(e,n,a)=>{const s=[],r=[];return a?Pn(e,a)||Pa(e,a)?{effects:s,messages:["Cannot place trap here!"],consumesTurn:!1}:(s.push({type:"PlaceTrap",position:a,ownerId:n.id}),s.push({type:"Juice",effect:"combat_text",target:a,text:"Trapped",metadata:{signature:"UI.TEXT.NEUTRAL.SET_TRAP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"set_trap",targetRef:{kind:"target_hex"},skillId:"SET_TRAP",textTone:"status"}}),r.push("Trap set."),{effects:s,messages:r,consumesTurn:!0}):{effects:s,messages:r,consumesTurn:!1}},getValidTargets:(e,n)=>We(n).filter(a=>!Pn(e,a)&&!Pa(e,a)),upgrades:{},scenarios:Qe("SET_TRAP")},g1={id:"SHADOW_STEP",name:"Shadow Step",description:"Teleport through the shadows. Only works while invisible. Extends stealth.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,n,a)=>{const s=[],r=[];return a?(n.stealthCounter||0)>0?Mt(n.position,a,2)?Pn(e,a)||Pa(e,a)||da(e,a,n.id)?{effects:s,messages:["Cannot step there!"],consumesTurn:!1}:(s.push({type:"Displacement",target:"self",destination:a}),s.push({type:"SetStealth",target:"self",amount:2}),s.push({type:"Juice",effect:"hiddenFade",target:a,metadata:{signature:"MOVE.BLINK.SHADOW.SHADOW_STEP",family:"movement",primitive:"blink",phase:"instant",element:"shadow",variant:"shadow_step_arrival",targetRef:{kind:"target_hex"},skillId:"SHADOW_STEP"}}),r.push("Shadow stepped!"),{effects:s,messages:r,consumesTurn:!0}):{effects:s,messages:["Too far!"],consumesTurn:!1}:{effects:s,messages:["Must be invisible to Shadow Step!"],consumesTurn:!1}:{effects:s,messages:r,consumesTurn:!1}},getValidTargets:(e,n)=>(e.player.stealthCounter||0)>0?He.getAreaTargets(e,n,2).filter(r=>ee(r,n)?!1:!Pn(e,r)&&!Pa(e,r)&&!da(e,r)):[],upgrades:{},scenarios:Qe("SHADOW_STEP")},b1={id:"SHIELD_BASH",name:"Shield Bash",description:"Push an enemy 1 tile. If they hit a wall or another enemy, they are stunned.",slot:"defensive",icon:"",baseVariables:{range:1,cost:0,cooldown:2},execute:(e,n,a,s=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!n||!n.position)return{effects:r,messages:c,consumesTurn:!1};const u=s.includes("SHIELD_RANGE"),p=s.includes("ARC_BASH"),g=s.includes("BASH_360"),m=s.includes("WALL_SLAM"),f=1+(u?1:0);if(!Mt(n.position,a,f))return c.push("Target out of range!"),{effects:r,messages:c,consumesTurn:!1};let b=[];if(g)b=We(n.position);else if(p){b=[a];const A=We(a);for(const _ of A)me(_,n.position)===1&&b.length<3&&b.push(_)}else b=[a];const S=new Map;e.enemies.forEach(A=>S.set(A.id,A.position)),e.player&&S.set(e.player.id,e.player.position);const T=A=>{for(const[_,E]of Array.from(S.entries()))if(ee(E,A))return _===e.player.id?e.player:e.enemies.find(w=>w.id===_)},v=(A,_)=>{const E=T(_);if(!E||E.id===n.id)return;const w=Wn(A,_),M=Pt(w),C=sn(_,M),L=e.tiles.get(ue(C)),k=L?.baseId==="WALL"||L?.traits.has("BLOCKS_MOVEMENT"),R=!He.isWithinBounds(e,C),H=T(C);k||R||H&&H.id!==E.id?(r.push({type:"ApplyStatus",target:E.id,status:"stunned",duration:1}),c.push(`Bashed ${E.subtype||"enemy"} into obstacle!`),r.push({type:"Juice",effect:"shake",target:_,direction:M,intensity:"medium",metadata:{signature:"ENV.COLLISION.KINETIC.SHIELD_BASH",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"shield_bash_collision",targetRef:{kind:"target_hex"},skillId:"SHIELD_BASH",camera:{shake:"medium",kick:"medium"}}}),H&&m&&v(_,C)):(r.push({type:"Displacement",target:E.id,destination:C,simulatePath:!0}),S.set(E.id,C),c.push(`Pushed ${E.subtype||"enemy"}!`))};for(const A of b)v(n.position,A);return{effects:r,messages:c}},getValidTargets:(e,n)=>{const a=ge(e,n);if(!a)return[];const r=1+(a.activeSkills?.find(c=>c.id==="SHIELD_BASH")?.activeUpgrades?.includes("SHIELD_RANGE")?1:0);return He.getAreaTargets(e,n,r).filter(c=>{const u=ge(e,c);return!!u&&u.id!==a.id&&u.factionId!==a.factionId})},upgrades:{SHIELD_RANGE:{id:"SHIELD_RANGE",name:"Extended Bash",description:"Range +1"},SHIELD_COOLDOWN:{id:"SHIELD_COOLDOWN",name:"Quick Recovery",description:"Cooldown -1",modifyCooldown:-1},ARC_BASH:{id:"ARC_BASH",name:"Arc Bash",description:"Bash hits 3-hex frontal arc (+1 cooldown)",modifyCooldown:1},BASH_360:{id:"BASH_360",name:"360 Bash",description:"Bash hits all neighbors (+1 cooldown)",modifyCooldown:1},PASSIVE_PROTECTION:{id:"PASSIVE_PROTECTION",name:"Passive Protection",description:"+1 temp armor when shield not on cooldown"},WALL_SLAM:{id:"WALL_SLAM",name:"Wall Slam",description:"Enemies bashed into obstacles trigger a cascade and stun"}},scenarios:Qe("SHIELD_BASH")},v1={id:"SHIELD_THROW",name:"Shield Throw",description:"Throw your shield to strike and push enemies. Triggers a kinetic pulse on impact.",slot:"defensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,n,a,s=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!e.hasShield)return c.push("Shield not in hand!"),{effects:r,messages:c,consumesTurn:!1};r.push(...Et.SHIELD_THROW.anticipation(n.position,a));const{isValid:u,blockedBy:p,blockedAt:g}=ef(e,n.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:n.id});if(!u&&p==="wall")return c.push("Shield hit a wall mid-flight!"),r.push({type:"SpawnItem",itemType:"shield",position:g}),{effects:r,messages:c,consumesTurn:!0};const m=ge(e,a);if(!m)return c.push("Shield missed: No target at location."),r.push({type:"SpawnItem",itemType:"shield",position:a}),{effects:r,messages:c,consumesTurn:!0};const f=dt(n.position,a);r.push(...Et.SHIELD_THROW.execution(f));const b=4,{directionIndex:S}=jn(n.position,a),T=Pt(S);r.push({type:"ApplyStatus",target:m.id,status:"stunned",duration:1}),r.push(...Et.SHIELD_THROW.impact(a,T));const v=Fl(e,{origin:a,direction:T,momentum:b}),A=v.filter(M=>M.type==="Displacement"&&M.target===m.id),_=A[A.length-1],E=_&&"destination"in _?_.destination:a,w=dt(a,E);return w.length>1&&r.push(...Et.SHIELD_THROW.resolution(w)),r.push({type:"SpawnItem",itemType:"shield",position:E}),c.push("Direct hit! Shield triggered kinetic pulse."),{effects:[...r,...v],messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>He.getAxialTargets(e,n,4),upgrades:{},scenarios:Qe("SHIELD_THROW")},S1={id:"SMOKE_SCREEN",name:"Smoke Screen",description:"Vanish into a cloud of smoke. Adds +2 to stealth counter.",slot:"utility",icon:"",baseVariables:{range:0,cost:0,cooldown:2},execute:(e,n,a)=>{const s=[],r=[];return s.push({type:"SetStealth",target:"self",amount:2}),s.push({type:"Juice",effect:"hiddenFade",target:n.position,metadata:{signature:"STATE.FADE.SHADOW.SMOKE_SCREEN",family:"status",primitive:"state_fade",phase:"instant",element:"shadow",variant:"smoke_screen",targetRef:{kind:"target_hex"},skillId:"SMOKE_SCREEN"}}),r.push("Smoke Screen!"),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>[n],upgrades:{},scenarios:Qe("SMOKE_SCREEN")},x1={id:"SNEAK_ATTACK",name:"Sneak Attack",description:"Attack an adjacent enemy. Deals massive damage if executed from stealth.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};const c=Fn(e.enemies,a);if(!c)return{effects:s,messages:["No target!"],consumesTurn:!1};if(!Mt(n.position,a,1))return{effects:s,messages:["Out of range!"],consumesTurn:!1};const u=(n.stealthCounter||0)>0,p=u?3:1,g=Ht({attackerId:n.id,targetId:c.id,skillId:"SNEAK_ATTACK",basePower:p,trinity:Ie(n),targetTrinity:Ie(c),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.25}],statusMultipliers:[]});return s.push({type:"Damage",target:c.id,amount:g.finalPower,reason:"sneak_attack",source:n.position,scoreEvent:g.scoreEvent}),u?(s.push({type:"Juice",effect:"flash",target:a,color:"#ff0000",metadata:{signature:"ATK.STRIKE.SHADOW.SNEAK_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"shadow",variant:"sneak_attack",targetRef:{kind:"target_hex"},skillId:"SNEAK_ATTACK",flags:{crit:!0}}}),r.push("SNEAK ATTACK!")):r.push("Sneak attack (No stealth bonus)."),{effects:s,messages:r,consumesTurn:!0}},getValidTargets:(e,n)=>We(n).filter(a=>!!Fn(e.enemies,a)),upgrades:{},scenarios:Qe("SNEAK_ATTACK")},A1={id:"SOUL_SWAP",name:"Soul Swap",description:"Instantly swap positions with a player-aligned minion.",slot:"utility",icon:"",baseVariables:{range:6,cost:0,cooldown:3},execute:(e,n,a)=>{const s=[],r=[];if(!a)return{effects:s,messages:r,consumesTurn:!1};if(!Mt(n.position,a,6))return{effects:s,messages:["Out of range!"],consumesTurn:!1};const c=ge(e,a);return!c||c.factionId!=="player"||c.id===n.id?{effects:s,messages:["Target must be a minion!"],consumesTurn:!1}:(s.push({type:"Displacement",target:n.id,destination:a}),s.push({type:"Displacement",target:c.id,destination:n.position}),s.push({type:"Juice",effect:"flash",target:a,color:"#330066",metadata:{signature:"MOVE.BLINK.ARCANE.SOUL_SWAP_ARRIVE",family:"movement",primitive:"blink",phase:"instant",element:"arcane",variant:"soul_swap_arrival",targetRef:{kind:"target_hex"},skillId:"SOUL_SWAP"}}),s.push({type:"Juice",effect:"flash",target:n.position,color:"#330066",metadata:{signature:"MOVE.BLINK.ARCANE.SOUL_SWAP_DEPART",family:"movement",primitive:"blink",phase:"instant",element:"arcane",variant:"soul_swap_departure",targetRef:{kind:"target_hex"},skillId:"SOUL_SWAP"}}),r.push("Soul Swapped!"),{effects:s,messages:r,consumesTurn:!0})},getValidTargets:(e,n)=>e.enemies.filter(a=>a.factionId==="player"&&Mt(n,a.position,6)).map(a=>a.position),upgrades:{},scenarios:Qe("SOUL_SWAP")},T1={id:"SPEAR_THROW",name:e=>e.hasSpear?"Spear Throw":"Recall Spear",description:e=>e.hasSpear?"Throw your spear to instantly kill an enemy.":"Recall your spear, damaging enemies in its path.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:1},execute:(e,n,a,s=[])=>{const r=[],c=[],u=Ie(n),p=s.includes("SPEAR_RANGE"),g=s.includes("RECALL"),m=s.includes("RECALL_DAMAGE"),f=s.includes("LUNGE"),b=s.includes("LUNGE_ARC"),S=s.includes("DEEP_BREATH"),T=s.includes("SPEAR_CLEAVE")||s.includes("CLEAVE"),v=3+(p?1:0);if(e.hasSpear){if(!a)return{effects:r,messages:c,consumesTurn:!1};if(f&&me(n.position,a)===2){const C=ge(e,a);if(C&&C.id!==n.id){const L=Ht({attackerId:n.id,targetId:C.id,skillId:"SPEAR_THROW",basePower:99,trinity:u,targetTrinity:Ie(C),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return r.push({type:"Displacement",target:"self",destination:a,simulatePath:!0}),r.push({type:"Damage",target:C.id,amount:L.finalPower,scoreEvent:L.scoreEvent}),c.push(`Lunged and killed ${C.subtype||"enemy"} !`),b&&We(a).forEach(k=>{const R=ge(e,k);if(R&&R.id!==n.id&&R.id!==C.id){const H=Ht({attackerId:n.id,targetId:R.id,skillId:"SPEAR_THROW",basePower:1,trinity:u,targetTrinity:Ie(R),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:R.id,amount:H.finalPower,scoreEvent:H.scoreEvent})}}),S&&r.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0}),{effects:r,messages:c}}}if(!Mt(n.position,a,v))return c.push("Out of range!"),{effects:r,messages:c,consumesTurn:!1};const A=Fn(e.enemies,a);if(!A)return c.push("No enemy at target."),{effects:r,messages:c,consumesTurn:!1};if(!jn(n.position,a).isAxial)return c.push("Target must be axial."),{effects:r,messages:c,consumesTurn:!1};if(!Hl(e,n.position,a,A.id,n.id))return c.push("No clear line of sight to enemy."),{effects:r,messages:c,consumesTurn:!1};r.push(...Et.SPEAR_THROW.anticipation(n.position,a));const w=a,M=A;if(r.push(...Et.SPEAR_THROW.execution(dt(n.position,w))),M){const C=Ht({attackerId:n.id,targetId:M.id,skillId:"SPEAR_THROW",basePower:99,trinity:u,targetTrinity:Ie(M),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});r.push(...Et.SPEAR_THROW.impact(w,!0)),r.push({type:"Damage",target:M.id,amount:C.finalPower,scoreEvent:C.scoreEvent}),c.push(`Spear killed ${M.subtype||"enemy"} !`),S&&r.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0})}else r.push(...Et.SPEAR_THROW.impact(w,!1)),c.push("Spear thrown.");r.push({type:"SpawnItem",itemType:"spear",position:w}),g&&(r.push({type:"PickupSpear",position:w}),c.push("Spear auto-retrieved."))}else{const A=e.spearPosition;if(!A)return c.push("Spear is lost!"),{effects:r,messages:c,consumesTurn:!1};const _=dt(A,n.position);if(m&&_.forEach(E=>{const w=Fn(e.enemies,E);if(w){const M=Ht({attackerId:n.id,targetId:w.id,skillId:"SPEAR_THROW",basePower:1,trinity:u,targetTrinity:Ie(w),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});r.push({type:"Damage",target:w.id,amount:M.finalPower,scoreEvent:M.scoreEvent}),c.push(`Spear recall hit ${w.subtype||"enemy"} !`)}}),r.push({type:"PickupSpear",position:A}),c.push("Spear recalled."),T){for(const E of We(A)){const w=Fn(e.enemies,E);if(!w)continue;const M=Ht({attackerId:n.id,targetId:w.id,skillId:"SPEAR_THROW",basePower:1,trinity:u,targetTrinity:Ie(w),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1}],statusMultipliers:[]});r.push({type:"Damage",target:w.id,amount:M.finalPower,scoreEvent:M.scoreEvent})}c.push("Cleave triggered on pickup.")}r.push({type:"Juice",effect:"spearTrail",path:_,intensity:"medium",metadata:{signature:"ATK.SHOOT.PHYSICAL.SPEAR_RETURN",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"spear_return",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"},skillId:"SPEAR_THROW"}})}return{effects:r,messages:c}},getValidTargets:(e,n)=>{if(!e.hasSpear)return[];const a=ge(e,n);if(!a)return[];const c=3+(a.activeSkills?.find(p=>p.id==="SPEAR_THROW")?.activeUpgrades?.includes("SPEAR_RANGE")?1:0);return e.enemies.filter(p=>p.hp>0).filter(p=>{const g=p.position;return!jn(n,g).isAxial||!Mt(n,g,c)?!1:Hl(e,n,g,p.id,a.id)}).map(p=>p.position)},upgrades:{SPEAR_RANGE:{id:"SPEAR_RANGE",name:"Extended Reach",description:"Range +1"},RECALL:{id:"RECALL",name:"Recall",description:"Spear automatically returns (handled internally if active, or via manual recall)"},RECALL_DAMAGE:{id:"RECALL_DAMAGE",name:"Returning Edge",description:"Damage enemies in path when recalling spear"},LUNGE:{id:"LUNGE",name:"Lunge",description:"If an enemy is exactly 2 hexes away, move to them and kill"},LUNGE_ARC:{id:"LUNGE_ARC",name:"Lunge Sweeping",description:"Lunge hits neighbors of the target"},DEEP_BREATH:{id:"DEEP_BREATH",name:"Deep Breath",description:"Reset Jump cooldown on spear kill"},SPEAR_CLEAVE:{id:"SPEAR_CLEAVE",name:"Cleave",description:"Damage all neighbors when picking up spear"}},scenarios:Qe("SPEAR_THROW")},E1={id:"SWIFT_ROLL",name:"Swift Roll",description:"Quickly dodge 2 tiles. Passive: Automatically roll away from attackers when hit.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,n,a)=>{const s=[],r=[];return a?Mt(n.position,a,2)?Pn(e,a)||Pa(e,a)||da(e,a,n.id)?{effects:s,messages:["Cannot roll there!"],consumesTurn:!1}:(s.push({type:"Displacement",target:"self",destination:a}),s.push({type:"Juice",effect:"dashBlur",target:a,path:[n.position,a],metadata:{signature:"MOVE.DASH.NEUTRAL.SWIFT_ROLL",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"swift_roll",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"},skillId:"SWIFT_ROLL"}}),r.push("Swift roll!"),{effects:s,messages:r,consumesTurn:!0}):{effects:s,messages:["Too far!"],consumesTurn:!1}:{effects:s,messages:r,consumesTurn:!1}},getValidTargets:(e,n)=>He.getAreaTargets(e,n,2).filter(s=>ee(s,n)?!1:!Pn(e,s)&&!Pa(e,s)&&!da(e,s)),upgrades:{},scenarios:Qe("SWIFT_ROLL")},_1={id:"THEME_HAZARDS",name:"Theme Hazards",description:"Internal skill for testing floor themes.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0},execute:e=>({effects:[],messages:[]}),upgrades:{},scenarios:Qe("THEME_HAZARDS")},w1={id:"TIME_BOMB",name:"Time Bomb",description:"Detonates when the fuse reaches zero.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0,damage:1},execute:(e,n,a)=>{const s=n.statusEffects.find(p=>p.type==="time_bomb");if(s&&s.duration>1)return{effects:[],messages:[],consumesTurn:!0};const r=n.position,u=[r,...We(r)].map(p=>({type:"Damage",target:p,amount:1,reason:"bomb_explosion"}));return u.push({type:"Damage",target:n.id,amount:999,reason:"bomb_explosion"}),u.push({type:"Juice",effect:"explosion_ring",target:r,intensity:"high",metadata:{signature:"ATK.BLAST.FIRE.TIME_BOMB",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"time_bomb",targetRef:{kind:"target_hex"},skillId:"TIME_BOMB"}}),{effects:u,messages:["A bomb exploded!"],consumesTurn:!0}},getValidTargets:(e,n)=>[n],upgrades:{}},M1={id:"VAULT",name:e=>e.turnNumber%2!==0?"Stun Vault":"Vault",description:e=>e.turnNumber%2!==0?"Leap to an empty tile and stun neighbors. (Odd Turn)":"Leap to an empty tile. (Even Turn)",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:0},execute:(e,n,a,s=[])=>{const r=[],c=[];if(!a)return{effects:r,messages:c,consumesTurn:!1};if(!Mt(n.position,a,2))return c.push("Out of range!"),{effects:r,messages:c,consumesTurn:!1};if(Pn(e,a)||da(e,a))return c.push("Blocked!"),{effects:r,messages:c,consumesTurn:!1};if(!ki(e,n,a))return c.push("Blocked!"),{effects:r,messages:c,consumesTurn:!1};const u=e.turnNumber%2!==0;r.push(...Et.VAULT.anticipation(n.position,a));const p=dt(n.position,a);if(r.push(...Et.VAULT.execution(p)),r.push({type:"Displacement",target:"self",destination:a,path:p,ignoreGroundHazards:!0,animationDuration:250}),u){c.push("Stun Vault executed!");const g=We(a);for(const m of g)Fn(e.enemies,m)&&r.push({type:"ApplyStatus",target:m,status:"stunned",duration:1});r.push(...Et.VAULT.impact(a,!0)),c.push("Slam landing! Neighbors stunned.")}else r.push(...Et.VAULT.impact(a,!1)),c.push("Vaulted!");return{effects:r,messages:c}},getValidTargets:(e,n)=>{const s=ge(e,n);return s?He.getAreaTargets(e,n,2).filter(r=>ee(r,n)?!1:!Pn(e,r)&&!da(e,r)&&ki(e,s,r)):[]},upgrades:{},scenarios:[{id:"vault_shift_stun",title:"Vault State-Shifting: Stun (Turn 1)",description:"Verify vault stuns on Turn 1 (Odd).",setup:e=>{e.setTurn(1),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>n.some(a=>a.includes("Stun Vault executed!"))},{id:"vault_shift_normal",title:"Vault State-Shifting: Normal (Turn 2)",description:"Verify vault is normal on Turn 2 (Even).",setup:e=>{e.setTurn(2),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,n)=>n.some(a=>a.includes("Vaulted!"))&&!n.some(a=>a.includes("Slam landing!"))}]},Py=1,jy=1,O1=1,b0=2,C1=2;function N1(e,n,a,s=b0){const r=Wn(a,n);if(r===-1)return null;const c=Pt(r);for(let p=s;p>=O1;p--){let g=n,m=!0;for(let f=0;f<p;f++){if(g=sn(g,c),!He.isWithinBounds(e,g)){m=!1;break}if(!Oe.isWalkable(e,g)){m=!1;break}}if(m&&!ge(e,g))return g}const u=[(r+1)%6,(r+5)%6];for(const p of u){const g=Pt(p);let m=sn(n,g);if(He.isWithinBounds(e,m)&&Oe.isWalkable(e,m)&&!ge(e,m))return m}return null}const k1={id:"WITHDRAWAL",name:"Withdrawal",description:"Quick shot + tactical backroll. Auto-triggers when enemies close in.",slot:"utility",icon:"",baseVariables:{range:Py,cost:0,cooldown:C1,damage:jy},execute:(e,n,a,s=[])=>{const r=[],c=[],u=s.includes("PARTING_SHOT"),p=s.includes("NIMBLE_FEET");if(!a)return{effects:r,messages:["No target!"],consumesTurn:!1};if(me(n.position,a)>Py)return{effects:r,messages:["Target out of range!"],consumesTurn:!1};const m=ge(e,a);if(!m)return{effects:r,messages:["No enemy at target!"],consumesTurn:!1};if(m.factionId===n.factionId)return{effects:r,messages:["Cannot target allies!"],consumesTurn:!1};const f=Ht({attackerId:n.id,targetId:m.id,skillId:"WITHDRAWAL",basePower:jy+(u?1:0),trinity:Ie(n),targetTrinity:Ie(m),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});r.push({type:"Damage",target:m.id,amount:f.finalPower,scoreEvent:f.scoreEvent}),r.push({type:"Juice",effect:"impact",target:a,metadata:{signature:"ATK.SHOOT.PHYSICAL.WITHDRAWAL",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"withdrawal_shot",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"WITHDRAWAL"}}),c.push(`Withdrawal shot hits ${m.subtype||"enemy"}!`);const b=p?3:b0,S=N1(e,n.position,a,b);return S?(r.push({type:"Displacement",target:"self",destination:S,source:n.position}),r.push({type:"Juice",effect:"dashBlur",target:S,path:[n.position,S],metadata:{signature:"MOVE.DASH.NEUTRAL.WITHDRAWAL_BACKROLL",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"withdrawal_backroll",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"WITHDRAWAL"}}),c.push("Backroll!")):c.push("No safe retreat available!"),{effects:r,messages:c,consumesTurn:!0}},getValidTargets:(e,n)=>We(n).filter(a=>{const s=ge(e,a);return s&&s.factionId==="enemy"}),upgrades:{PARTING_SHOT:{id:"PARTING_SHOT",name:"Parting Shot",description:"Withdrawal deals +1 damage."},NIMBLE_FEET:{id:"NIMBLE_FEET",name:"Nimble Feet",description:"Backroll distance increased to 3 hexes."},HAIR_TRIGGER:{id:"HAIR_TRIGGER",name:"Hair Trigger",description:"Passive reaction does not consume cooldown."}},scenarios:Qe("WITHDRAWAL")},R1={ABSORB_FIRE:$x,ARCHER_SHOT:BA,AUTO_ATTACK:d0,BASIC_ATTACK:wT,BASIC_MOVE:NT,BOMB_TOSS:kT,BULWARK_CHARGE:RT,CORPSE_EXPLOSION:BT,DASH:jT,FALCON_APEX_STRIKE:DT,FALCON_AUTO_ROOST:UT,FALCON_COMMAND:$T,FALCON_HEAL:qT,FALCON_PECK:zT,FALCON_SCOUT:VT,FIREBALL:KT,FIREWALK:FT,FIREWALL:WT,GRAPPLE_HOOK:QT,JUMP:ZT,KINETIC_TRI_TRAP:s1,MULTI_SHOOT:o1,RAISE_DEAD:m1,SENTINEL_BLAST:p1,SENTINEL_TELEGRAPH:h1,SET_TRAP:y1,SHADOW_STEP:g1,SHIELD_BASH:b1,SHIELD_THROW:v1,SMOKE_SCREEN:S1,SNEAK_ATTACK:x1,SOUL_SWAP:A1,SPEAR_THROW:T1,SWIFT_ROLL:E1,THEME_HAZARDS:_1,TIME_BOMB:w1,VAULT:M1,WITHDRAWAL:k1},Wl=R1,sl=Ux(Wl);if(sl.missing.length>0||sl.invalid.length>0){const e=sl.missing.join(", "),n=sl.invalid.map(a=>`${a.skillId}: ${a.errors.join("; ")}`).join(" | ");throw new Error(`Skill intent profile validation failed. missing=[${e}] invalid=[${n}]`)}const Ms=()=>({...Wl,...Lx()});function oa(e){const a=Ms()[e];return a?{id:e,name:a.name,description:typeof a.description=="function"?a.description({}):a.description,slot:a.slot,cooldown:a.baseVariables.cooldown||0,currentCooldown:0,range:a.baseVariables.range||0,upgrades:Object.keys(a.upgrades||{}),activeUpgrades:[]}:null}function I1(){return[oa("BASIC_MOVE"),oa("BASIC_ATTACK"),oa("AUTO_ATTACK"),oa("SPEAR_THROW"),oa("SHIELD_BASH"),oa("JUMP")].filter(Boolean)}const L1={...Wl,get:e=>Ms()[e],getAllUpgrades:()=>{const e=Ms();return Object.values(e).flatMap(n=>Object.values(n.upgrades||{}).map(a=>({...a,skillId:n.id})))},getUpgrade:e=>{const n=Ms();for(const a of Object.values(n))if(a.upgrades?.[e])return a.upgrades[e]},getSkillForUpgrade:e=>{const n=Ms();for(const[a,s]of Object.entries(n))if(s.upgrades?.[e])return a},getSkillRange:(e,n)=>{const a=(e.activeSkills||[]).find(c=>c.id===n),s=Ms()[n];if(!s)return a?.range||0;let r=s.baseVariables.range;return a?.activeUpgrades&&a.activeUpgrades.forEach(c=>{const u=s.upgrades[c];u?.modifyRange&&(r+=u.modifyRange)}),r}},yt=L1,B1=yt.getSkillRange,H1=e=>yt.get(e),P1={VANGUARD:{id:"VANGUARD",name:"Vanguard",description:"Direct damage, brawling, and area denial.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK","SPEAR_THROW","SHIELD_BASH","JUMP"]},SKIRMISHER:{id:"SKIRMISHER",name:"Skirmisher",description:"Zero direct damage. Kinetic momentum and environmental lethality.",startingUpgrades:[],startingSkills:["DASH","GRAPPLE_HOOK","SHIELD_THROW","VAULT"]},FIREMAGE:{id:"FIREMAGE",name:"Fire Mage",description:"Area control with fire and high-damage spells.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","ABSORB_FIRE","FIREBALL","FIREWALL","FIREWALK"]},NECROMANCER:{id:"NECROMANCER",name:"Necromancer",description:"Utilize death and reanimation.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","CORPSE_EXPLOSION","RAISE_DEAD","SOUL_SWAP"]},HUNTER:{id:"HUNTER",name:"Hunter",description:"Ranged precision and traps.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","FALCON_COMMAND","KINETIC_TRI_TRAP","WITHDRAWAL"]},ASSASSIN:{id:"ASSASSIN",name:"Assassin",description:"Stealth and high burst damage.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","SNEAK_ATTACK","SMOKE_SCREEN","SHADOW_STEP"]}};class j1 extends Error{issues;constructor(n){super(`Loadout validation failed:
${n.map(a=>`${a.path}: ${a.message}`).join(`
`)}`),this.name="LoadoutValidationError",this.issues=n}}const Ud=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),Ho=e=>typeof e=="string",Ni=(e,n,a)=>e.push({path:n,message:a}),Dy=(e,n,a,s={})=>{if(!Array.isArray(e)){Ni(n,a,"Expected array");return}const r=new Set;e.forEach((c,u)=>{if(!Ho(c)||c.length===0){Ni(n,`${a}[${u}]`,"Expected non-empty string");return}s.unique&&(r.has(c)&&Ni(n,`${a}[${u}]`,`Duplicate "${c}"`),r.add(c))})},D1=(e,n="$")=>{const a=[];return Ud(e)?((!Ho(e.id)||e.id.length===0)&&Ni(a,`${n}.id`,"Expected non-empty string"),(!Ho(e.name)||e.name.length===0)&&Ni(a,`${n}.name`,"Expected non-empty string"),Ho(e.description)||Ni(a,`${n}.description`,"Expected string"),Dy(e.startingUpgrades,a,`${n}.startingUpgrades`,{unique:!0}),Dy(e.startingSkills,a,`${n}.startingSkills`,{unique:!0}),a):(Ni(a,n,"Expected object"),a)},U1=e=>{const n=[];if(!Ud(e))return Ni(n,"$","Expected loadout catalog object"),n;for(const[a,s]of Object.entries(e)){const r=D1(s,`$.${a}`);n.push(...r),Ud(s)&&Ho(s.id)&&s.id!==a&&Ni(n,`$.${a}.id`,`Must match catalog key "${a}"`)}return n},$1=e=>{const n=U1(e);if(n.length>0)throw new j1(n);return e},q1=e=>Object.fromEntries(Object.entries(e).map(([n,a])=>[n,{...a,startingUpgrades:[...a.startingUpgrades],startingSkills:[...a.startingSkills]}])),z1=$1(P1),oi=q1(z1);let Uy=!1;const V1=(e=oi)=>{const n=[];for(const[a,s]of Object.entries(e)){for(const r of s.startingSkills)yt.get(r)||n.push({loadoutId:a,field:"startingSkills",value:r,message:`Unknown skill "${r}"`});for(const r of s.startingUpgrades)yt.getUpgrade(r)||n.push({loadoutId:a,field:"startingUpgrades",value:r,message:`Unknown upgrade "${r}"`})}return n},v0=()=>{if(Uy)return Object.keys(oi).length;const e=V1(oi);if(e.length>0){const n=e.map(a=>`${a.loadoutId}.${a.field}: ${a.message}`).join(" | ");throw new Error(`Default loadout validation failed: ${n}`)}return Uy=!0,Object.keys(oi).length};v0();const S0=e=>{const n=e.startingSkills.map(s=>oa(s)).filter(Boolean),a=e.id;return{upgrades:[...e.startingUpgrades],activeSkills:n,archetype:a}},Y1=e=>e.some(n=>n.id==="BASIC_MOVE"||n.id==="DASH"),x0=(e=[])=>{if(Y1(e))return e;const n=oa("BASIC_MOVE");return n?[n,...e]:e},af=e=>{const n=e.activeSkills||[],a=x0(n);return a===n?e:{...e,activeSkills:a}};let A0=!1;const K1=(e=ox)=>{const n=tx(e),a=v0();return cx(n.units),Ix(n.skills),A0=!0,{unitsRegistered:n.units.length,skillsRegistered:n.skills.length,loadoutsValidated:a}},T0=()=>A0?{unitsRegistered:0,skillsRegistered:0,loadoutsValidated:0}:K1(),E0=(e,n="none")=>n==="floor"?Math.floor(e):n==="round"?Math.round(e):n==="ceil"?Math.ceil(e):e,_0=(e,n)=>n?Math.max(n.min,Math.min(n.max,e)):e,ol=(e,n)=>_0(E0(e,n.round),n.clamp),F1=(e,n)=>{if(e.method==="fixed")return{value:ol(e.value,e),before:-1,after:-1,usedRng:!1};if(e.method==="uniform_int"){const u=n(),p=e.max-e.min+1,g=e.min+Math.floor(u.value*p)%Math.max(1,p);return{value:ol(g,e),before:u.before,after:u.after,usedRng:!0}}if(e.method==="triangular_int"){const u=n(),p=e.min,g=e.mode,m=e.max,f=(g-p)/Math.max(1e-9,m-p),b=u.value<f?p+Math.sqrt(u.value*(m-p)*(g-p)):m-Math.sqrt((1-u.value)*(m-p)*(m-g));return{value:ol(b,e),before:u.before,after:u.after,usedRng:!0}}const a=n(),s=e.table.reduce((u,p)=>u+p.weight,0);let r=a.value*Math.max(1e-9,s),c=e.table[e.table.length-1].value;for(const u of e.table)if(r-=u.weight,r<=0){c=u.value;break}return{value:ol(c,e),before:a.before,after:a.after,usedRng:!0}},$y=(e,n,a)=>{if(e.formula==="trinity_hp_v1")return Kl(a);const s=e.base??0,c=(e.terms||[]).reduce((p,g)=>p+(n[g.stat]??0)*g.coefficient,s),u=E0(c,e.round);return _0(u,e.clamp)},W1=(e,n)=>!n||Object.keys(n).length===0?e:{...e,activeSkills:(e.activeSkills||[]).map(a=>{const s=n[a.id];return s===void 0?a:{...a,currentCooldown:Math.max(0,s)}})},G1=e=>e.id.toLowerCase(),X1=(e,n,a)=>{const s=n.definition,r=[];let c={rngSeed:e.rngSeed||"default",rngCounter:Math.max(0,e.rngCounter||0)},u=0;const p=`${c.rngSeed}:${s.instantiate.rngStream}:${s.instantiate.seedSalt||s.id}`,g=()=>{if(s.instantiate.counterMode==="consume_global"){const C=c.rngCounter,L=Bl(c.rngSeed,C);return c={...c,rngCounter:C+1},{value:L,before:C,after:c.rngCounter}}const w=u;return{value:Bl(p,u++),before:w,after:u}},m={};for(const w of n.drawOrder){const M=s.propensities[w];if(!M)continue;const C=F1(M,g);m[w]=C.value,C.usedRng&&r.push({key:w,method:M.method,value:C.value,counterBefore:C.before,counterAfter:C.after})}const f={body:m.body??0,mind:m.mind??0,instinct:m.instinct??0},b=s.derivedStats||{},S=b.maxHp?$y(b.maxHp,m,f):Kl(f),T=m.speed??1,v=m.mass??1,A=s.runtimeDefaults?.startingHp==="explicit"?Math.max(0,s.runtimeDefaults.explicitHp??S):S,_=ca({id:a.actorId||G1(s),type:s.actorType,subtype:a.subtype||s.subtype,position:a.position,hp:A,maxHp:S,speed:T,factionId:a.factionId||s.factionId,weightClass:s.weightClass,skills:[...n.skillIds,...n.passiveSkillIds],trinity:f});let E=W1(_,s.skillLoadout.startCooldowns);s.runtimeDefaults?.temporaryArmor!==void 0&&(E={...E,temporaryArmor:Math.max(0,s.runtimeDefaults.temporaryArmor)}),s.runtimeDefaults?.isVisible!==void 0&&(E={...E,isVisible:s.runtimeDefaults.isVisible}),m.maxHp=S,m.speed=T,m.mass=v;for(const[w,M]of Object.entries(b))w!=="maxHp"&&(m[w]=$y(M,m,f));return{actor:E,stats:m,trinity:f,speed:T,mass:v,nextCursor:c,rollTrace:r}},J1=(e,n,a)=>X1(e,nx(n),a),Q1=(e,n)=>{const a=Yl(n),s=AS(Cl,Nl),r=[],c=s,u=Math.floor(Cl/2),p=rn(u,Nl-1),g=rn(u,0);let m;if(e%1===0){const M=c.filter(C=>!ee(C,p)&&!ee(C,g)&&me(C,p)>=3);M.length>0&&(m=M[Math.floor(a.next()*M.length)])}const b=Math.floor(c.length*OS),S=[],T={playerStart:p,stairsPosition:g,shrinePosition:m},A=[...c.filter(M=>!yy(M,T))].sort(()=>a.next()-.5);for(let M=0;M<b;M++)M<A.length&&S.push(A[M]);const _=c.filter(M=>!yy(M,{playerStart:p,stairsPosition:g,shrinePosition:m})&&!r.some(C=>ee(C,M))&&!S.some(C=>ee(C,M))&&me(M,p)>=3),E={id:"arena",type:"combat",center:rn(Math.floor(Cl/2),Math.floor(Nl/2)),hexes:s,connections:[]},w=new Map;for(const M of s)w.set(`${M.q},${M.r}`,{baseId:"STONE",position:M,traits:new Set(Os.STONE.defaultTraits),effects:[]});for(const M of r)w.set(`${M.q},${M.r}`,{baseId:"WALL",position:M,traits:new Set(Os.WALL.defaultTraits),effects:[]});for(const M of S)w.set(`${M.q},${M.r}`,{baseId:"LAVA",position:M,traits:new Set(Os.LAVA.defaultTraits),effects:[]});return{rooms:[E],allHexes:s,stairsPosition:g,shrinePosition:m,spawnPositions:_,playerSpawn:p,tiles:w}},Z1=(e,n,a)=>{T0();const s=Yl(a+":enemies"),r=hy[Math.min(e,hy.length-1)],c=dd[e]||dd[Math.max(...Object.keys(dd).map(Number))];let u={rngSeed:`${a}:enemy-propensity`,rngCounter:0};const p=[];let g=r;const m=[];for(;g>0&&m.length<n.length;){const f=c.filter(H=>{const D=Ld[H];return D&&D.cost<=g});if(f.length===0)break;const b=Math.floor(s.next()*f.length),S=f[b],T=Ld[S],v=n.filter(H=>!m.some(D=>ee(D,H)));if(v.length===0)break;const A=Math.floor(s.next()*v.length),_=v[A];m.push(_);const E=Math.floor(e/5),w=T.weightClass||"Standard",M=(u.rngCounter<<8)+p.length,C=`enemy_${p.length}_${Cs(a,M,6,S)}`,L=ux(S);let k;if(L){const H=J1(u,L,{actorId:C,position:_,subtype:S,factionId:"enemy"});u=H.nextCursor,k=H.actor}else k=FS({id:C,subtype:S,position:_,speed:T.speed||50,skills:GS(S),weightClass:w,enemyType:T.type});const R=E>0?{...k,hp:k.hp+E,maxHp:k.maxHp+E}:k;p.push({...R,subtype:S,enemyType:T.type,actionCooldown:T.actionCooldown??R.actionCooldown,isVisible:!0}),g-=T.cost}return p},eE=e=>CS[e]||"inferno",tE=(e,n)=>{const a=n.initialSeed??n.rngSeed??"0",s=n.commandLog?.length??0;return{id:Cs(a,s,9,"cmd"),timestamp:n.turnNumber,action:e}},nE=(e,n,a)=>{const s=a.initialSeed??a.rngSeed??"0",r=a.undoStack?.length??0;return{id:Cs(s,r,9,"delta"),undoData:{player:{...e.player},enemies:[...e.enemies],turnNumber:e.turnNumber,gameStatus:e.gameStatus}}},iE=(e,n,a,s)=>{const r=(e.pendingFrames?.length??0)+1;return{id:`${e.turnNumber}:${a}:${n}:${r}`,type:n,status:a,createdTurn:e.turnNumber,blocking:!0,payload:s}},aE=(e,n,a,s)=>{const r=iE(e,a,n.status,s);return{...e,pendingStatus:n,pendingFrames:[...e.pendingFrames||[],r]}};function sE(e){let n=e;const a=[],s=[],r=new Map(n.tiles);for(const[c,u]of r.entries()){const p=[];let g=!1;for(const b of u.effects){if(b.duration===-1){p.push(b);continue}const S=b.duration-1;S>0?(p.push({...b,duration:S}),g=!0):(a.push(`The ${b.id.toLowerCase()} died down.`),g=!0)}g&&r.set(c,{...u,effects:p});const m=[n.player,...n.enemies],f=b=>`${b.q},${b.r}`;for(const b of m)if(f(b.position)===c){const S=La.processStay(b,u,n);s.push(...S.effects),a.push(...S.messages)}}return n={...n,tiles:r},s.length>0&&(n=Gn(n,s)),{state:n,messages:a}}const oE=e=>(Array.isArray(e.tiles)&&(e.tiles=new Map(e.tiles.map(([n,a])=>[n,{...a,traits:new Set(a.traits)}]))),e.player=af(Lo(e.player)),e.enemies=(e.enemies||[]).map(Lo),e.companions&&(e.companions=e.companions.map(Lo)),e),rE=(e,n)=>{if(!(e.pendingStatus?.shrineOptions||e.shrineOptions||[]).includes(n))return{...e,message:ht(e.message,`Upgrade ${n} was not offered.`,"CRITICAL","SYSTEM")};let s=e.player,r=!1;const c=yt.getUpgrade(n);if(c){const u=yt.getSkillForUpgrade(n),p=!!u&&s.activeSkills.some(g=>g.id===u);if(u&&p){const g=JSON.stringify(s.activeSkills);s=DA(s,u,n),r=JSON.stringify(s.activeSkills)!==g}}else n==="EXTRA_HP"&&(s=PA(s,1,!0),r=!0);return!r&&n!=="EXTRA_HP"?{...e,message:ht(e.message,`Upgrade ${n} could not be applied.`,"CRITICAL","SYSTEM")}:{...e,player:s,upgrades:e.upgrades.includes(n)?e.upgrades:[...e.upgrades,n],gameStatus:"playing",shrinePosition:void 0,shrineOptions:void 0,pendingStatus:void 0,pendingFrames:void 0,message:ht(e.message,`Gained ${c?.name||n}!`,"INFO","OBJECTIVE")}},lE=(e,n)=>{const a=e.pendingFrames||[];if(a.length>1)return{...e,pendingFrames:a.slice(1)};if(!e.pendingStatus)return a.length===1?{...e,pendingFrames:[]}:e;const{status:s,shrineOptions:r,completedRun:c}=e.pendingStatus;if(s==="playing"&&e.gameStatus==="playing"){const u=e.initialSeed??e.rngSeed??"0",p=`${u}:${e.floor+1}`,g=e.enemies.filter(f=>f.hp>0&&f.factionId==="player"&&f.companionOf===e.player.id).sort((f,b)=>f.id.localeCompare(b.id)),m=n.generateInitialState(e.floor+1,p,u,{...e.player,hp:Math.min(e.player.maxHp,e.player.hp+1),upgrades:e.upgrades});if(g.length>0){const f=[m.player.position,...We(m.player.position)],b=[m.player,...m.enemies],S=[];for(let T=0;T<g.length;T++){const v=g[T],A=f[f.length-1]||m.player.position,_=f.find(w=>!b.some(C=>ee(C.position,w))&&Oe.isWalkable(m,w))||A,E={...v,position:_,previousPosition:_};b.push(E),S.push(E)}m.enemies=[...m.enemies,...S],m.companions=[...m.companions||[],...S.filter(T=>T.companionOf===e.player.id)],m.initiativeQueue=ja(m),m.occupancyMask=He.refreshOccupancyMask(m)}return{...m,actionLog:[...e.actionLog||[]],dailyRunDate:e.dailyRunDate,runObjectives:e.runObjectives,hazardBreaches:e.hazardBreaches||0,pendingFrames:void 0}}return{...e,gameStatus:s,shrineOptions:r||e.shrineOptions,completedRun:c||e.completedRun,pendingStatus:void 0,pendingFrames:void 0}},cE=(e,n,a)=>{let s=e;const r=[],c=s.player.position;if(s.spearPosition&&ee(c,s.spearPosition)){if(!!s.player.activeSkills?.find(m=>m.id==="SPEAR_THROW")?.activeUpgrades?.some(m=>m==="SPEAR_CLEAVE"||m==="CLEAVE")){const m=We(c).map(f=>s.enemies.find(b=>b.hp>0&&ee(b.position,f))).filter(f=>!!f&&f.factionId!==s.player.factionId);if(m.length>0){const f=m.map(b=>({type:"Damage",target:b.id,amount:1,reason:"spear_cleave_pickup"}));s=Gn(s,f,{sourceId:s.player.id,stepId:n}),r.push(`Spear cleave hit ${m.length} target(s).`)}}s={...s,hasSpear:!0,spearPosition:void 0,message:ht(s.message,"Picked up your spear.","INFO","OBJECTIVE")}}const u=sE(s);if(s=u.state,r.push(...u.messages),s={...s,turnNumber:s.turnNumber+1,turnsSpent:(s.turnsSpent||0)+1},s.traps&&s.traps.length>0&&(s={...s,traps:s.traps.map(p=>({...p,cooldown:Math.max(0,p.cooldown-1)}))}),s=OT(s),IS(s,s.player.position)){const p=s.player.activeSkills||[],g=new Set(p.map(v=>v.id)),m=new Map;for(const v of p)m.set(v.id,new Set(v.activeUpgrades||[]));const f=yt.getAllUpgrades().filter(v=>g.has(v.skillId)).filter(v=>{if(s.upgrades.includes(v.id))return!1;const A=m.get(v.skillId);return!A||!A.has(v.id)}).map(v=>v.id).filter((v,A,_)=>_.indexOf(v)===A),b=[];let S={...s};for(let v=0;v<3&&f.length>0;v++){const A=Kn(S);S=A.nextState;const _=Math.floor(A.value*f.length);b.push(f[_]),f.splice(_,1)}const T=b.length>0?b:["EXTRA_HP"];return{state:a.withPendingFrame({...s,rngCounter:S.rngCounter,message:ht(s.message,"A holy shrine! Choose an upgrade.","INFO","OBJECTIVE")},{status:"choosing_upgrade",shrineOptions:T},"SHRINE_CHOICE",{shrineOptions:T}),messages:r,haltTurnLoop:!0}}if(LS(s,s.player.position)){if(s.floor>=10){const g=jo(s);return{state:a.withPendingFrame({...s,message:ht(s.message,`Arcade Cleared! Final Score: ${g.score}`,"INFO","OBJECTIVE")},{status:"won",completedRun:g},"RUN_WON",{score:g.score??0}),messages:r,haltTurnLoop:!0}}return{state:a.withPendingFrame({...s,message:ht(s.message,"Descending to the next level...","INFO","OBJECTIVE")},{status:"playing"},"STAIRS_TRANSITION",{nextFloor:s.floor+1}),messages:r,haltTurnLoop:!0}}return{state:s,messages:r,haltTurnLoop:!1}},$d=(e,n)=>{const a={},s={},r={},c=Array.from(new Set([...Object.keys(e),...Object.keys(n)])).sort();let u=0;for(const p of c){const g=Number(e[p]||0),m=Number(n[p]||0),f=g*m;a[p]=g,s[p]=m,r[p]=f,u+=f}return{total:u,features:a,weights:s,contributions:r}};var w0={};const qy=4.5,uE="HOP_ENEMY_AI_DYNAMIC_INTENT_BIAS_STRENGTH",Ad={offense:0,positioning:0,control:0,defense:0},Rl=(e,n,a)=>Math.max(n,Math.min(a,e)),Oo=(e,n,a=1)=>{e.offense+=(n.offense||0)*a,e.positioning+=(n.positioning||0)*a,e.control+=(n.control||0)*a,e.defense+=(n.defense||0)*a},dE={damage:{offense:.22,control:.02},move:{positioning:.24,offense:.04},heal:{defense:.24,control:.04},protect:{defense:.2,control:.06},control:{control:.25,positioning:.06},summon:{control:.14,defense:.08},hazard:{control:.14,offense:.1},objective:{positioning:.08,control:.12},economy:{defense:.08,control:.08},utility:{positioning:.08,control:.1}},fE=e=>{const n=String(e||"").toUpperCase(),a=new Set;return/(ATTACK|THROW|BLAST|FIREBALL|BASH|PECK|EXPLOSION|SPEAR|SHOOT|DASH)/.test(n)&&a.add("damage"),/(MOVE|DASH|JUMP|ROLL|VAULT|STEP|GRAPPLE|WITHDRAWAL|WALK|TELEPORT)/.test(n)&&a.add("move"),/(HEAL|ABSORB)/.test(n)&&a.add("heal"),/(SHIELD|PROTECT|BULWARK)/.test(n)&&a.add("protect"),/(STUN|TRAP|SMOKE|TELEGRAPH|ROOT|SWAP|SCOUT)/.test(n)&&a.add("control"),/(RAISE|SUMMON|FALCON)/.test(n)&&a.add("summon"),/(FIRE|LAVA|HAZARD|BOMB|EXPLOSION)/.test(n)&&a.add("hazard"),a.size===0&&a.add("utility"),[...a]},mE=e=>{const a=yt.get(e)?.intentProfile;return a?.intentTags&&a.intentTags.length>0?a.intentTags:fE(e)},zy=(e,n)=>{const a={offense:Math.max(0,e.offense),positioning:Math.max(0,e.positioning),control:Math.max(0,e.control),defense:Math.max(0,e.defense)},s=a.offense+a.positioning+a.control+a.defense;if(s<=n||s<=0)return a;const r=n/s;return{offense:a.offense*r,positioning:a.positioning*r,control:a.control*r,defense:a.defense*r}},Pl=()=>{if(typeof process>"u")return!1;const e=w0?.HOP_ENEMY_AI_DYNAMIC_INTENT_BIAS;return e==="1"||e==="true"},sf=()=>{if(typeof process>"u")return 1;const e=w0?.[uE];if(!e)return 1;const n=Number(e);return Number.isFinite(n)?Rl(n,0,8):1},M0=(e,n)=>{if(!Pl())return{...Ad};const a=sf();if(a<=0)return{...Ad};const s={...Ad},r=Ie(e.enemy),c=Rl(Number(r.body||0),0,24),u=Rl(Number(r.mind||0),0,24),p=Rl(Number(r.instinct||0),0,24);Oo(s,{offense:c*.06+p*.015,defense:c*.018+u*.028,control:u*.06,positioning:p*.055+Math.max(0,Number(e.enemy.speed||1)-1)*.06});for(const f of e.enemy.activeSkills||[]){const b=String(f.id),S=mE(b);for(const _ of S)Oo(s,dE[_]||{});const T=yt.get(f.id),v=Number(T?.intentProfile?.target?.range??f.range??0);v>=3?Oo(s,{positioning:.08,control:.04}):v<=1&&Oo(s,{offense:.05});const A=Number(T?.intentProfile?.economy?.cooldown??f.cooldown??0);A>0&&Oo(s,{defense:.02,control:.015},Math.min(3,A))}const g=zy(s,qy);if(a===1)return g;const m={offense:g.offense*a,positioning:g.positioning*a,control:g.control*a,defense:g.defense*a};return zy(m,qy*Math.max(1,a))},Vy=["offense","control","positioning","defense"],pE=e=>{const n=me(e.enemy.position,e.playerPos);return{dist_to_player:n,adjacent_to_player:n===1?1:0,hostile_hidden:(e.state.player.stealthCounter||0)>0?1:0,enemy_hp:Number(e.enemy.hp||0),enemy_action_cooldown:Number(e.enemy.actionCooldown||0)}},O0=(e,n)=>{if(n===void 0)return 0;if(typeof n=="number")return e===n?1:0;const[a,s]=n;return e>=a&&e<=s?1:0},C0=(e,n)=>{if(n===void 0)return 0;if(typeof n=="number")return Math.abs(e-n);const[a,s]=n;return e<a?a-e:e>s?e-s:0},hE=(e,n)=>{const a=n.action.type,s=String(n.action.skillId||"").toUpperCase(),r=String(e.planned.entity.intent||"").toUpperCase();return r==="SEARCHING"||r==="PREPARING"||r==="SENTINEL_TELEGRAPH"||s==="SENTINEL_TELEGRAPH"?"control":a==="MOVE"||r==="MOVING"||r==="ADVANCING"||r==="REPOSITIONING"||r==="LUMBERING"?"positioning":a==="WAIT"||r==="WAITING"||r==="IDLE"?"defense":"offense"},yE=(e,n)=>{const a=me(e.enemy.position,e.playerPos),s=n.subtype||e.enemy.subtype||"default",r=s==="archer"||s==="warlock"||s==="bomber",c=O0(a,n.preferredRange)===1,u=C0(a,n.preferredRange),p=Number(e.enemy.actionCooldown||0),g=(e.state.player.stealthCounter||0)>0,m=e.enemy.position.q===e.playerPos.q||e.enemy.position.r===e.playerPos.r||e.enemy.position.s===e.playerPos.s;let f=0,b=0,S=0,T=0;r?(f+=c?1.25:.55,b+=c?.35:1.15):(f+=a<=1?1.5:.6,b+=a>1?1.2:.2),b+=Math.min(3,u)*.35,p>0&&(T+=.8,S+=.3,f-=.15),g&&(S+=1.4,T+=.3,f-=.4),s==="sentinel"&&(S+=1.3,a<=3&&(f+=.6)),(s==="warlock"||s==="bomber")&&(b+=.5),(s==="raider"||s==="pouncer")&&m&&a>=2&&a<=4&&(S+=.45,f+=.45);const v=M0(e);return f+=v.offense,b+=v.positioning,S+=v.control,T+=v.defense,{offense:Math.max(0,f),positioning:Math.max(0,b),control:Math.max(0,S),defense:Math.max(0,T)}},gE=e=>{let n=Vy[0];for(const a of Vy)e[a]>e[n]&&(n=a);return n},bE=(e,n,a,s)=>{const r=pE(e),c=me(e.enemy.position,e.playerPos),u=me(n.planned.entity.position,e.playerPos),p=ee(n.planned.entity.position,e.enemy.position)?0:1,g=a.action.type,m=a.action.skillId||"",f=Number(n.planned.entity.actionCooldown||0)-Number(e.enemy.actionCooldown||0),b=s.subtype==="sentinel",S=b&&c<=3,T=b&&e.state.turnNumber%2===0,v=b&&!T,A=m==="SENTINEL_TELEGRAPH",_=m==="SENTINEL_BLAST",E=e.enemy.position.q===e.playerPos.q||e.enemy.position.r===e.playerPos.r||e.enemy.position.s===e.playerPos.s,w=m==="DASH",M=m==="GRAPPLE_HOOK",C=m==="ARCHER_SHOT"||m==="SPEAR_THROW",L=m==="BOMB_TOSS",k=a.action.targetHex,R=k&&me(k,e.playerPos)===1?1:0,H=k&&ee(k,e.playerPos)?1:0,D=s.subtype;return{...r,candidate_pre_score:Number(n.preScore||0),is_wait_action:g==="WAIT"?1:0,is_move_action:g==="MOVE"?1:0,is_attack_action:g==="ATTACK"?1:0,is_skill_action:g==="USE_SKILL"?1:0,moved:p,dist_before:c,dist_after:u,dist_delta_toward_player:c-u,preferred_range_match:O0(u,s.preferredRange),has_target_hex:a.action.targetHex?1:0,target_adjacent_to_player:R,target_is_player_tile:H,uses_signature_skill:s.subtype==="sentinel"&&(m==="SENTINEL_BLAST"||m==="SENTINEL_TELEGRAPH")?1:0,raider_dash_window_match:D==="raider"&&E&&c>=2&&c<=4&&w?1:0,pouncer_hook_window_match:D==="pouncer"&&E&&c>=2&&c<=4&&M?1:0,archer_ranged_window_match:D==="archer"&&c>1&&C?1:0,archer_melee_window_match:D==="archer"&&c===1&&m==="BASIC_ATTACK"?1:0,bomber_bomb_window_match:D==="bomber"&&(e.enemy.actionCooldown??0)===0&&c>=2&&c<=3&&L?1:0,bomber_bomb_target_valid_shape:D==="bomber"&&L&&R===1&&H===0?1:0,bomber_reposition_candidate:D==="bomber"&&n.id==="bomber-reposition"?1:0,sentinel_phase_telegraph_match:S&&T&&A?1:0,sentinel_phase_execute_match:S&&v&&_?1:0,sentinel_phase_mismatch:S&&(T&&_||v&&A)?1:0,cooldown_delta_positive:f>0?1:0,rng_consumption:Number(a.rngConsumption||0),message_present:n.planned.message?1:0}},vE=(e,n,a,s)=>{const r=yE(e,s),c=hE(n,a),u=gE(r),p=me(e.enemy.position,e.playerPos),g=C0(p,s.preferredRange),m=(e.state.player.stealthCounter||0)>0;return{intent_is_offense:c==="offense"?1:0,intent_is_positioning:c==="positioning"?1:0,intent_is_control:c==="control"?1:0,intent_is_defense:c==="defense"?1:0,intent_desire_offense:r.offense,intent_desire_positioning:r.positioning,intent_desire_control:r.control,intent_desire_defense:r.defense,intent_selected_desire:r[c],intent_dominant_match:c===u?1:0,intent_preferred_range_gap:g,intent_player_hidden:m?1:0}},Yy={id:"enemy-default-policy-v1",tags:["policy-v1"]},SE={sprinter:{id:"enemy-sprinter-policy-v1",subtype:"sprinter",preferredRange:1,tags:["policy-v1","melee"]},shieldBearer:{id:"enemy-shieldBearer-policy-v1",subtype:"shieldBearer",preferredRange:1,tags:["policy-v1","melee"]},warlock:{id:"enemy-warlock-policy-v1",subtype:"warlock",preferredRange:[2,4],tags:["policy-v1","ranged","teleport"]},sentinel:{id:"enemy-sentinel-policy-v1",subtype:"sentinel",preferredRange:3,tags:["policy-v1","playlist"]},raider:{id:"enemy-raider-policy-v1",subtype:"raider",preferredRange:[1,4],tags:["policy-v1","dash"]},pouncer:{id:"enemy-pouncer-policy-v1",subtype:"pouncer",preferredRange:[1,4],tags:["policy-v1","grapple"]},archer:{id:"enemy-archer-policy-v1",subtype:"archer",preferredRange:[2,4],tags:["policy-v1","ranged"]},bomber:{id:"enemy-bomber-policy-v1",subtype:"bomber",preferredRange:[2,3],tags:["policy-v1","ranged","aoe"]},assassin:{id:"enemy-assassin-policy-v1",subtype:"assassin",preferredRange:1,tags:["policy-v1","stealth"]},golem:{id:"enemy-golem-policy-v1",subtype:"golem",preferredRange:[1,3],tags:["policy-v1","heavy"]}},xE=e=>e?SE[e]||{...Yy,id:`enemy-${e}-policy-v1`,subtype:e}:Yy,jl=(e,n)=>{const a=n.q-e.q,s=n.r-e.r;return a>0&&s===0?0:a>0&&s<0?1:a===0&&s<0?2:a<0&&s===0?3:a<0&&s>0?4:5},St=(e,n,a,s=[],r)=>{if(ET(e))return{position:e.position,state:a};const c=He.getNeighbors(e.position);let u=[],p=r!==void 0?Math.abs(me(e.position,n)-r):me(e.position,n);for(const b of c){if(!He.isWithinBounds(a,b))continue;const S=a.tiles.get(ue(b)),T=S?.traits.has("BLOCKS_LOS")||S?.baseId==="WALL",v=s.some(w=>ee(w,b))||a.enemies.some(w=>w.id!==e.id&&ee(w.position,b))||ee(b,n);if(T||v)continue;const A=S?La.getMovementCost(a,S):1,E=(r!==void 0?Math.abs(me(b,n)-r):me(b,n))+(A-1);E<p?(p=E,u=[b]):E===p&&u.push(b)}if(u.length===0)return{position:e.position,state:a};if(u.length===1)return{position:u[0],state:a};const{value:g,nextState:m}=Kn(a),f=Math.floor(g*u.length)%u.length;return{position:u[f],state:m}},AE=(e,n,a)=>{if(me(e.position,n)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};let r=e.position,c=a;for(let p=0;p<2&&!(me(r,n)<=1);p++){const g={...e,position:r},{position:m,state:f}=St(g,n,c,a.occupiedCurrentTurn);r=m,c=f}const u=!ee(r,e.position);return{entity:{...e,position:r,intent:u?"Moving":"BASIC_ATTACK",intentPosition:u?void 0:{...n}},nextState:c,message:u?`${e.subtype} moves to (${r.q}, ${r.r})`:void 0}},TE=(e,n,a)=>{const s=me(e.position,n),r=jl(e.position,n);if(s===1)return{entity:{...e,facing:r,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:c,state:u}=St(e,n,a,a.occupiedCurrentTurn),p=!ee(c,e.position);return{entity:{...e,position:c,facing:p?jl(e.position,c):r,intent:p?"Advancing":"BASIC_ATTACK",intentPosition:p?void 0:{...n}},nextState:u,message:p?`${e.subtype} advances to (${c.q}, ${c.r})`:void 0}},EE=(e,n,a)=>{const s=me(e.position,n);let r=a;const{value:c,nextState:u}=Kn(r);r=u;let p=e.position;if(s<=2||c<.3){const{value:b,nextState:S}=Kn(r);r=S;const{value:T,nextState:v}=Kn(r);r=v;const A=Math.floor(b*6),_=3+Math.floor(T*3);let E=e.position;for(let M=0;M<_;M++)E=sn(E,Pt(A));!He.isWithinBounds(a,E)||!Oe.isWalkable(a,E)||a.occupiedCurrentTurn?.some(M=>ee(M,E))||a.enemies.some(M=>M.id!==e.id&&ee(M.position,E))||ee(E,n)||(p=E)}const g=!ee(p,e.position),m=me(p,n),f=!g&&m>=2&&m<=4;return{entity:{...e,position:p,intent:g?"Repositioning":f?"Casting":"Preparing",intentPosition:f?{...n}:void 0},nextState:r,message:g?`${e.subtype} teleports to (${p.q}, ${p.r})`:void 0}},_E=(e,n,a)=>{const s=me(e.position,n);if(s===1)return{entity:{...e,isVisible:!0,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:r,state:c}=St(e,n,a,a.occupiedCurrentTurn),u=!ee(r,e.position);return{entity:{...e,position:r,isVisible:u?!1:s<=1,intent:u?"Moving":"BASIC_ATTACK",intentPosition:u?void 0:{...n}},nextState:c,message:u?"You hear footsteps nearby...":void 0}},wE={sentinel:{telegraphSkillId:"SENTINEL_TELEGRAPH",executeSkillId:"SENTINEL_BLAST",triggerRange:3,telegraphMessage:"The Sentinel marks the blast zone..."}},ME=(e,n,a,s)=>{const c=me(e.position,n)<=s.triggerRange,u=a.turnNumber%2===0,p=!u;if(c&&p&&si(e))return{entity:{...e,intent:"Preparing",intentPosition:void 0},nextState:a,message:`${e.subtype} loses focus!`};if(c&&u)return{entity:{...e,intent:s.telegraphSkillId,intentPosition:{...n}},nextState:a,message:s.telegraphMessage};if(c&&p)return{entity:{...e,intent:s.executeSkillId,intentPosition:{...n}},nextState:a};const{position:g,state:m}=St(e,n,a,a.occupiedCurrentTurn);return{entity:{...e,position:g,intent:"Moving",intentPosition:void 0},nextState:m}},OE=(e,n,a)=>{const s=e.actionCooldown??0;if(s>0)return{entity:{...e,actionCooldown:s-1,intent:"Charging Power"},nextState:a};const r=me(e.position,n);if(r>=1&&r<=3)return{entity:{...e,actionCooldown:2,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:c,state:u}=St(e,n,a,a.occupiedCurrentTurn),p=!ee(c,e.position);return{entity:{...e,position:c,intent:p?"Lumbering":"Waiting",actionCooldown:0},nextState:u,message:p?`${e.subtype} lumbers to (${c.q}, ${c.r})`:void 0}},CE=(e,n,a)=>{const s=me(e.position,n);if(s>4){const{position:f,state:b}=St(e,n,a,a.occupiedCurrentTurn),S=!ee(f,e.position);return{entity:{...e,position:f,intent:S?"Following":"Waiting"},nextState:b,message:S?`${e.subtype} follows you.`:void 0}}const r=a.enemies.filter(f=>f.factionId==="enemy").sort((f,b)=>me(e.position,f.position)-me(e.position,b.position))[0];if(!r){if(s>1){const{position:f,state:b}=St(e,n,a,a.occupiedCurrentTurn);return{entity:{...e,position:f,intent:"Idle"},nextState:b}}return{entity:{...e,intent:"Idle"},nextState:a}}if(me(e.position,r.position)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...r.position}},nextState:a};const{position:u,state:p}=St(e,r.position,a,a.occupiedCurrentTurn),g=!ee(u,e.position),m=me(u,r.position);return{entity:{...e,position:u,intent:g?"Advancing":m===1?"BASIC_ATTACK":"Waiting",intentPosition:g||m>1?void 0:{...r.position}},nextState:p,message:g?`${e.subtype} attacks ${r.subtype}!`:void 0}},NE=(e,n,a)=>{const s=me(e.position,n);if((e.position.q===n.q||e.position.r===n.r||e.position.s===n.s)&&s>=2&&s<=4)return{entity:{...e,intent:"DASH",intentPosition:{...n}},nextState:a};const{position:c,state:u}=St(e,n,a,a.occupiedCurrentTurn),p=!ee(c,e.position),g=me(c,n);return{entity:{...e,position:c,intent:p?"Moving":g===1?"BASIC_ATTACK":"Waiting",intentPosition:p||g>1?void 0:{...n}},nextState:u,message:p?`${e.subtype} moves to (${c.q}, ${c.r})`:void 0}},kE=(e,n,a)=>{const s=me(e.position,n);if((e.position.q===n.q||e.position.r===n.r||e.position.s===n.s)&&s>=2&&s<=4)return{entity:{...e,intent:"GRAPPLE_HOOK",intentPosition:{...n}},nextState:a};const{position:c,state:u}=St(e,n,a,a.occupiedCurrentTurn),p=!ee(c,e.position);return{entity:{...e,position:c,intent:p?"Moving":"Waiting",intentPosition:void 0},nextState:u,message:p?`${e.subtype} moves to (${c.q}, ${c.r})`:void 0}},RE=(e,n,a)=>{const s=me(e.position,n),r=e.activeSkills?.some(f=>f.id==="ARCHER_SHOT")?"ARCHER_SHOT":"SPEAR_THROW",c=yt.get(r);if(s>1&&!!c?.getValidTargets&&c.getValidTargets(a,e.position).some(f=>ee(f,n)))return{entity:{...e,intent:r,intentPosition:{...n}},nextState:a};if(s===1&&e.activeSkills?.some(f=>f.id==="BASIC_ATTACK"))return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:p,state:g}=St(e,n,a,a.occupiedCurrentTurn),m=!ee(p,e.position);return{entity:{...e,position:p,intent:m?"Moving":"Idle",intentPosition:void 0},nextState:g,message:m?`${e.subtype} moves to (${p.q}, ${p.r})`:void 0}},IE=(e,n,a)=>{const s=me(e.position,n),r=e.actionCooldown??0;if(r===0&&s>=2&&s<=3){const m=He.getNeighbors(n).filter(f=>{const b=!Oe.isWalkable(a,f),S=a.enemies.some(T=>ee(T.position,f));return He.isWithinBounds(a,f)&&!b&&!S&&!ee(f,n)});if(m.length>0){const{value:f,nextState:b}=Kn(a),S=Math.floor(f*m.length)%m.length,T=m[S];return{entity:{...e,intent:"Bombing",intentPosition:T,actionCooldown:2},nextState:b}}}const{position:u,state:p}=St(e,n,a,a.occupiedCurrentTurn,2.5),g=!ee(u,e.position);return{entity:{...e,position:u,intent:g?"Moving":"Waiting",intentPosition:void 0,actionCooldown:Math.max(0,r-1)},nextState:p,message:g?`${e.subtype} repositioning to (${u.q}, ${u.r})`:void 0}},LE=(e,n,a)=>{if(me(e.position,n)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...n}},nextState:a};const{position:r,state:c}=St(e,n,a,a.occupiedCurrentTurn),u=!ee(r,e.position),p=me(r,n);return{entity:{...e,position:r,intent:u?"Moving":p===1?"BASIC_ATTACK":"Waiting",intentPosition:u||p>1?void 0:{...n}},nextState:c,message:u?`${e.subtype} moves to (${r.q}, ${r.r})`:void 0}},BE={sprinter:AE,shieldBearer:TE,warlock:EE,assassin:_E,golem:OE,sentinel:(e,n,a)=>ME(e,n,a,wE.sentinel),raider:NE,pouncer:kE,archer:RE,bomber:IE},Ky=e=>{const{enemy:n,playerPos:a,state:s}=e;if(n.factionId==="player")return CE(n,a,s);if((s.player.stealthCounter||0)>0)return{entity:{...n,intent:"Searching",intentPosition:void 0},nextState:s};const c=n.subtype?BE[n.subtype]:void 0;return c?c(n,a,s):LE(n,a,s)},Fy=e=>{const n=e.planned.entity;return[e.source,String(n.intent||"Waiting"),ue(n.position),n.intentPosition?ue(n.intentPosition):"none",String(n.actionCooldown??"none"),String(n.facing??"none"),String(n.isVisible??"none"),String(e.planned.nextState.rngCounter||0),String(e.planned.message||"")].join("::")},Wy=(e,n)=>e.q===n.q||e.r===n.r||e.s===n.s,ka=(e,n)=>!!e.activeSkills?.some(a=>a.id===n),HE=new Set(["sprinter","shieldBearer","warlock","assassin","golem","sentinel","raider","pouncer","archer","bomber"]),PE=(e,n={})=>{const a=[],s=n.includePolicyExact===!0,r=v=>{const A=Fy(v);a.some(_=>Fy(_)===A)||a.push(v)};if(s){const v=Ky({enemy:e.enemy,playerPos:e.playerPos,state:e.state});r({id:"policy-exact",source:"policy_exact",reasoningCode:"POLICY_EXACT",preScore:0,planned:v})}if(e.enemy.factionId==="player"){const v=Ky({enemy:e.enemy,playerPos:e.playerPos,state:e.state});return r({id:"minion-policy-shape",source:"synthetic",reasoningCode:"SYN_MINION_POLICY_SHAPE",preScore:10,planned:v}),a}r({id:"wait",source:"synthetic",reasoningCode:"SYN_WAIT",preScore:-10,planned:{entity:{...e.enemy,intent:"Waiting",intentPosition:void 0},nextState:e.state}});const c=me(e.enemy.position,e.playerPos),u=e.enemy.subtype||"default",p=!HE.has(u),m=!!e.enemy.activeSkills?.some(v=>v.id==="BASIC_ATTACK")||p;if(c===1&&m&&r({id:"basic-attack",source:"synthetic",reasoningCode:"SYN_BASIC_ATTACK",preScore:5,planned:{entity:{...e.enemy,intent:"BASIC_ATTACK",intentPosition:{...e.playerPos}},nextState:e.state}}),p&&c>1){const{position:v,state:A}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn),_=!ee(v,e.enemy.position),E=me(v,e.playerPos);r({id:"default-move",source:"synthetic",reasoningCode:"SYN_DEFAULT_MOVE",preScore:0,planned:{entity:{...e.enemy,position:v,intent:_?"Moving":E===1?"BASIC_ATTACK":"Waiting",intentPosition:_||E>1?void 0:{...e.playerPos}},nextState:A,message:_?`${e.enemy.subtype} moves to (${v.q}, ${v.r})`:void 0}})}if(u==="sprinter"&&c>1){let v=e.enemy.position,A=e.state;for(let E=0;E<2&&!(me(v,e.playerPos)<=1);E++){const w={...e.enemy,position:v},{position:M,state:C}=St(w,e.playerPos,A,e.state.occupiedCurrentTurn);v=M,A=C}const _=!ee(v,e.enemy.position);r({id:"sprinter-move",source:"synthetic",reasoningCode:"SYN_SPRINTER_MOVE",preScore:0,planned:{entity:{...e.enemy,position:v,intent:_?"Moving":"BASIC_ATTACK",intentPosition:_?void 0:{...e.playerPos}},nextState:A,message:_?`${e.enemy.subtype} moves to (${v.q}, ${v.r})`:void 0}})}if(u==="shieldBearer"){const v=jl(e.enemy.position,e.playerPos);if(c===1)r({id:"shieldbearer-attack-facing",source:"synthetic",reasoningCode:"SYN_SHIELDBEARER_ATTACK",preScore:0,planned:{entity:{...e.enemy,facing:v,intent:"BASIC_ATTACK",intentPosition:{...e.playerPos}},nextState:e.state}});else{const{position:A,state:_}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn),E=!ee(A,e.enemy.position);r({id:"shieldbearer-advance",source:"synthetic",reasoningCode:"SYN_SHIELDBEARER_ADVANCE",preScore:0,planned:{entity:{...e.enemy,position:A,facing:E?jl(e.enemy.position,A):v,intent:E?"Advancing":"BASIC_ATTACK",intentPosition:E?void 0:{...e.playerPos}},nextState:_,message:E?`${e.enemy.subtype} advances to (${A.q}, ${A.r})`:void 0}})}}if(u==="assassin")if(c===1)r({id:"assassin-attack",source:"synthetic",reasoningCode:"SYN_ASSASSIN_ATTACK",preScore:0,planned:{entity:{...e.enemy,isVisible:!0,intent:"BASIC_ATTACK",intentPosition:{...e.playerPos}},nextState:e.state}});else{const{position:v,state:A}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn),_=!ee(v,e.enemy.position);r({id:"assassin-move",source:"synthetic",reasoningCode:"SYN_ASSASSIN_MOVE",preScore:0,planned:{entity:{...e.enemy,position:v,isVisible:_?!1:c<=1,intent:_?"Moving":"BASIC_ATTACK",intentPosition:_?void 0:{...e.playerPos}},nextState:A,message:_?"You hear footsteps nearby...":void 0}})}if(u==="golem"){const v=e.enemy.actionCooldown??0;if(v>0)r({id:"golem-charging",source:"synthetic",reasoningCode:"SYN_GOLEM_CHARGING",preScore:0,planned:{entity:{...e.enemy,actionCooldown:v-1,intent:"Charging Power"},nextState:e.state}});else if(c>=1&&c<=3)r({id:"golem-attack",source:"synthetic",reasoningCode:"SYN_GOLEM_ATTACK",preScore:0,planned:{entity:{...e.enemy,actionCooldown:2,intent:"BASIC_ATTACK",intentPosition:{...e.playerPos}},nextState:e.state}});else{const{position:A,state:_}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn),E=!ee(A,e.enemy.position);r({id:"golem-lumbering",source:"synthetic",reasoningCode:"SYN_GOLEM_LUMBERING",preScore:0,planned:{entity:{...e.enemy,position:A,intent:E?"Lumbering":"Waiting",actionCooldown:0},nextState:_,message:E?`${e.enemy.subtype} lumbers to (${A.q}, ${A.r})`:void 0}})}}if(u==="sentinel"){const v=c<=3,A=e.state.turnNumber%2===0,_=!A;if(v&&_&&si(e.enemy))r({id:"sentinel-preparing-stunned",source:"synthetic",reasoningCode:"SYN_SENTINEL_STUNNED_PREPARING",preScore:0,planned:{entity:{...e.enemy,intent:"Preparing",intentPosition:void 0},nextState:e.state,message:`${e.enemy.subtype} loses focus!`}});else if(v&&A)r({id:"sentinel-telegraph",source:"synthetic",reasoningCode:"SYN_SENTINEL_TELEGRAPH",preScore:0,planned:{entity:{...e.enemy,intent:"SENTINEL_TELEGRAPH",intentPosition:{...e.playerPos}},nextState:e.state,message:"The Sentinel marks the blast zone..."}});else if(v&&_)r({id:"sentinel-blast",source:"synthetic",reasoningCode:"SYN_SENTINEL_BLAST",preScore:0,planned:{entity:{...e.enemy,intent:"SENTINEL_BLAST",intentPosition:{...e.playerPos}},nextState:e.state}});else{const{position:E,state:w}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn);r({id:"sentinel-move",source:"synthetic",reasoningCode:"SYN_SENTINEL_MOVE",preScore:0,planned:{entity:{...e.enemy,position:E,intent:"Moving",intentPosition:void 0},nextState:w}})}}if(u==="warlock"){let v=e.state;const{value:A,nextState:_}=Kn(v);v=_;let E=e.enemy.position;if(c<=2||A<.3){const{value:L,nextState:k}=Kn(v);v=k;const{value:R,nextState:H}=Kn(v);v=H;const D=Math.floor(L*6),$=3+Math.floor(R*3);let J=e.enemy.position;for(let ae=0;ae<$;ae++)J=sn(J,Pt(D));!He.isWithinBounds(e.state,J)||!Oe.isWalkable(e.state,J)||e.state.occupiedCurrentTurn?.some(ae=>ee(ae,J))||e.state.enemies.some(ae=>ae.id!==e.enemy.id&&ee(ae.position,J))||ee(J,e.playerPos)||(E=J)}const w=!ee(E,e.enemy.position),M=me(E,e.playerPos),C=!w&&M>=2&&M<=4;r({id:"warlock-policy-like",source:"synthetic",reasoningCode:"SYN_WARLOCK_POLICY",preScore:0,planned:{entity:{...e.enemy,position:E,intent:w?"Repositioning":C?"Casting":"Preparing",intentPosition:C?{...e.playerPos}:void 0},nextState:v,message:w?`${e.enemy.subtype} teleports to (${E.q}, ${E.r})`:void 0}})}const f=u==="raider"&&ka(e.enemy,"DASH")&&Wy(e.enemy.position,e.playerPos)&&c>=2&&c<=4;if(f&&r({id:"raider-dash",source:"synthetic",reasoningCode:"SYN_RAIDER_DASH_WINDOW",preScore:0,planned:{entity:{...e.enemy,intent:"DASH",intentPosition:{...e.playerPos}},nextState:e.state}}),u==="raider"&&!f){const{position:v,state:A}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn),_=!ee(v,e.enemy.position),E=me(v,e.playerPos);r({id:"raider-move",source:"synthetic",reasoningCode:"SYN_RAIDER_MOVE",preScore:0,planned:{entity:{...e.enemy,position:v,intent:_?"Moving":E===1?"BASIC_ATTACK":"Waiting",intentPosition:_||E>1?void 0:{...e.playerPos}},nextState:A,message:_?`${e.enemy.subtype} moves to (${v.q}, ${v.r})`:void 0}})}const b=u==="pouncer"&&ka(e.enemy,"GRAPPLE_HOOK")&&Wy(e.enemy.position,e.playerPos)&&c>=2&&c<=4;if(b&&r({id:"pouncer-grapple",source:"synthetic",reasoningCode:"SYN_POUNCER_HOOK_WINDOW",preScore:0,planned:{entity:{...e.enemy,intent:"GRAPPLE_HOOK",intentPosition:{...e.playerPos}},nextState:e.state}}),u==="pouncer"&&!b){const{position:v,state:A}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn),_=!ee(v,e.enemy.position);r({id:"pouncer-move",source:"synthetic",reasoningCode:"SYN_POUNCER_MOVE",preScore:0,planned:{entity:{...e.enemy,position:v,intent:_?"Moving":"Waiting",intentPosition:void 0},nextState:A,message:_?`${e.enemy.subtype} moves to (${v.q}, ${v.r})`:void 0}})}if(u==="archer"){const v=ka(e.enemy,"ARCHER_SHOT")?"ARCHER_SHOT":ka(e.enemy,"SPEAR_THROW")?"SPEAR_THROW":void 0;let A=!1;if(v){const E=yt.get(v);A=c>1&&!!E?.getValidTargets&&E.getValidTargets(e.state,e.enemy.position).some(w=>ee(w,e.playerPos)),A&&r({id:`archer-ranged-${v}`,source:"synthetic",reasoningCode:"SYN_ARCHER_RANGED_WINDOW",preScore:0,planned:{entity:{...e.enemy,intent:v,intentPosition:{...e.playerPos}},nextState:e.state}})}const _=c===1&&ka(e.enemy,"BASIC_ATTACK");if(c===1&&ka(e.enemy,"BASIC_ATTACK")&&r({id:"archer-melee-fallback",source:"synthetic",reasoningCode:"SYN_ARCHER_MELEE_FALLBACK",preScore:0,planned:{entity:{...e.enemy,intent:"BASIC_ATTACK",intentPosition:{...e.playerPos}},nextState:e.state}}),!A&&!_){const{position:E,state:w}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn),M=!ee(E,e.enemy.position);r({id:"archer-move",source:"synthetic",reasoningCode:"SYN_ARCHER_MOVE",preScore:0,planned:{entity:{...e.enemy,position:E,intent:M?"Moving":"Idle",intentPosition:void 0},nextState:w,message:M?`${e.enemy.subtype} moves to (${E.q}, ${E.r})`:void 0}})}}if(u==="bomber"&&ka(e.enemy,"BOMB_TOSS")){const v=e.enemy.actionCooldown??0,A=c>=2&&c<=3;if(v===0&&A){const M=He.getNeighbors(e.playerPos).filter(C=>{const L=!Oe.isWalkable(e.state,C),k=e.state.enemies.some(R=>ee(R.position,C));return He.isWithinBounds(e.state,C)&&!L&&!k&&!ee(C,e.playerPos)});if(M.length>0){const{value:C,nextState:L}=Kn(e.state),k=Math.floor(C*M.length)%M.length,R=M[k];r({id:"bomber-bomb-window",source:"synthetic",reasoningCode:"SYN_BOMBER_BOMB_WINDOW",preScore:0,planned:{entity:{...e.enemy,intent:"Bombing",intentPosition:R,actionCooldown:2},nextState:L}})}}const{position:_,state:E}=St(e.enemy,e.playerPos,e.state,e.state.occupiedCurrentTurn,2.5),w=!ee(_,e.enemy.position);r({id:"bomber-reposition",source:"synthetic",reasoningCode:"SYN_BOMBER_REPOSITION",preScore:0,planned:{entity:{...e.enemy,position:_,intent:w?"Moving":"Waiting",intentPosition:void 0,actionCooldown:Math.max(0,v-1)},nextState:E,message:w?`${e.enemy.subtype} repositioning to (${_.q}, ${_.r})`:void 0}})}const S={},T=e.enemy.subtype?S[e.enemy.subtype]:void 0;for(const v of e.enemy.activeSkills||[]){if(v.id==="AUTO_ATTACK"||v.id==="BASIC_MOVE"||v.id==="BASIC_ATTACK"||!T?.has(String(v.id)))continue;const A=yt.get(v.id);A&&(A.getValidTargets&&!A.getValidTargets(e.state,e.enemy.position).some(_=>ee(_,e.playerPos))||r({id:`skill-${v.id}`,source:"synthetic",reasoningCode:`SYN_SKILL_${v.id}`,preScore:1,planned:{entity:{...e.enemy,intent:String(v.id),intentPosition:{...e.playerPos}},nextState:e.state}}))}return a},N0=(e,n,a)=>{if(!a)return;const s=e.player.position.q===a.q&&e.player.position.r===a.r?e.player:e.enemies.find(r=>r.position.q===a.q&&r.position.r===a.r);if(s&&s.factionId!==n.factionId)return s.id},jE=(e,n,a,s)=>{const r=n.intentPosition;return a==="Moving"||a==="Advancing"||a==="Repositioning"||a==="Lumbering"||a==="Following"?{type:"MOVE",skillId:"BASIC_MOVE",targetHex:n.position}:a==="BASIC_ATTACK"?{type:"ATTACK",skillId:"BASIC_ATTACK",targetHex:r,primaryTargetId:N0(s,e,r)}:a==="SPEAR_THROW"?{type:"USE_SKILL",skillId:"SPEAR_THROW",targetHex:r}:a==="ARCHER_SHOT"?{type:"USE_SKILL",skillId:"ARCHER_SHOT",targetHex:r}:a==="DASH"?{type:"USE_SKILL",skillId:"DASH",targetHex:r}:a==="GRAPPLE_HOOK"?{type:"USE_SKILL",skillId:"GRAPPLE_HOOK",targetHex:r}:a==="Bombing"?{type:"USE_SKILL",skillId:"BOMB_TOSS",targetHex:r}:a==="SENTINEL_BLAST"?{type:"USE_SKILL",skillId:"SENTINEL_BLAST",targetHex:r}:a==="SENTINEL_TELEGRAPH"?{type:"USE_SKILL",skillId:"SENTINEL_TELEGRAPH",targetHex:r}:{type:"WAIT",skillId:"WAIT_SKILL"}},DE=(e,n,a)=>{const s=String(a.entity.intent||"Waiting"),r=jE(e,a.entity,s,n),c=n.rngCounter||0,u=a.nextState.rngCounter||0,p={action:r,reasoningCode:s.toUpperCase().replace(/\s+/g,"_"),expectedValue:0,nextState:a.nextState,rngConsumption:Math.max(0,u-c)};return{plannedEntity:a.entity,nextState:a.nextState,message:a.message,decision:p}},UE=(e,n,a,s=10)=>{const r=e.action;let c=r.skillId||"WAIT_SKILL",u=r.type;u==="WAIT"&&(c="WAIT_SKILL"),u==="MOVE"&&(c="BASIC_MOVE"),u==="ATTACK"&&(c="BASIC_ATTACK");const p=r.targetHex;let g=r.primaryTargetId;return!g&&p&&(u==="ATTACK"||u==="USE_SKILL")&&(g=N0(a,n,p)),u==="MOVE"&&p&&ee(p,n.position)&&(u="WAIT",c="WAIT_SKILL"),{type:u,actorId:n.id,skillId:c,primaryTargetId:g,targetHex:p,priority:s,metadata:{expectedValue:e.expectedValue||0,reasoningCode:e.reasoningCode||"AI_DECISION_COMPAT",isGhost:!1,rngConsumption:e.rngConsumption||0}}},$E=(e,n,a)=>{const s=UE(e,n,a);if(s.skillId==="ARCHER_SHOT"&&!n.activeSkills?.some(c=>c.id==="ARCHER_SHOT")&&n.activeSkills?.some(c=>c.id==="SPEAR_THROW")&&(s.skillId="SPEAR_THROW"),!(s.skillId==="WAIT_SKILL"||n.activeSkills?.some(c=>c.id===s.skillId)))return s.type="WAIT",s.skillId="WAIT_SKILL",s.targetHex=void 0,s.primaryTargetId=void 0,s;if(s.skillId!=="WAIT_SKILL"&&s.targetHex){const c=yt.get(s.skillId);c?.getValidTargets&&(c.getValidTargets(a,n.position).some(g=>ee(g,s.targetHex))||(s.type="WAIT",s.skillId="WAIT_SKILL",s.targetHex=void 0,s.primaryTargetId=void 0))}return s};var qE={};const zE=(e,n)=>{const a=e.enemy.subtype||"default",s=a==="archer"||a==="warlock"||a==="bomber",r=!s,c=(M,C,L)=>{if(!Pl())return 0;const k=qE?.[M];if(!k)return 0;const R=Number(k);return Number.isFinite(R)?Math.max(C,Math.min(L,R)):0},u=a==="bomber"?c("HOP_ENEMY_AI_BOMBER_BOMB_WINDOW_BONUS",-50,50):0,p=a==="bomber"?c("HOP_ENEMY_AI_BOMBER_REPOSITION_BONUS",-50,50):0,g={candidate_pre_score:1,is_wait_action:-8,is_move_action:r?1:.6,is_attack_action:r?5:2,is_skill_action:s?3:1.5,moved:.5,dist_delta_toward_player:r?1:-.2,preferred_range_match:2,has_target_hex:.4,target_adjacent_to_player:a==="bomber"?2:.2,target_is_player_tile:a==="bomber"?-4:0,uses_signature_skill:1.5,raider_dash_window_match:a==="raider"?25:0,pouncer_hook_window_match:a==="pouncer"?25:0,archer_ranged_window_match:a==="archer"?16:0,archer_melee_window_match:a==="archer"?16:0,bomber_bomb_window_match:a==="bomber"?18+u:0,bomber_bomb_target_valid_shape:a==="bomber"?12:0,bomber_reposition_candidate:a==="bomber"?p:0,sentinel_phase_telegraph_match:a==="sentinel"?40:0,sentinel_phase_execute_match:a==="sentinel"?45:0,sentinel_phase_mismatch:a==="sentinel"?-60:0,cooldown_delta_positive:s?.4:.2,rng_consumption:0,message_present:.1,dist_to_player:0,adjacent_to_player:0,hostile_hidden:0,enemy_hp:0,enemy_action_cooldown:0,dist_before:0,dist_after:0};if(!Pl())return g;const m=sf();if(m<=0)return g;const f=M0(e),b=.45*m,S=Math.max(0,Number(e.enemy.hp||0))/Math.max(1,Number(e.enemy.maxHp||1)),T=Math.max(0,1-S),v=a==="bomber",A=v?0:.4,_=v?1.35:1.1,E=v?1.5:6,w=v?.15:1;return{...g,is_wait_action:g.is_wait_action+(f.defense*1.4*b+f.defense*T*E*b),is_move_action:g.is_move_action+(f.positioning*A*b+f.defense*T*w*b),is_attack_action:g.is_attack_action+f.offense*.85*b,is_skill_action:g.is_skill_action+(f.control*_*b+f.offense*.2*b),dist_delta_toward_player:g.dist_delta_toward_player+(f.offense-f.defense)*.2*b,preferred_range_match:g.preferred_range_match+f.positioning*.2*b}},k0=()=>{if(!Pl())return 1;const e=sf();return e<=1?1:1+(e-1)*3},VE=e=>{const n=e.enemy.subtype||"default",a=n==="sentinel"||n==="warlock"||n==="raider"||n==="pouncer",s=k0(),r=n==="bomber"?1+(s-1)*.15:s;return{intent_is_offense:0,intent_is_positioning:0,intent_is_control:0,intent_is_defense:0,intent_desire_offense:0,intent_desire_positioning:0,intent_desire_control:0,intent_desire_defense:0,intent_selected_desire:.25*r,intent_dominant_match:(a?.9:.7)*r,intent_preferred_range_gap:0,intent_player_hidden:0}},YE=(e,n,a)=>({total:a,features:{...e.features,...n.features},weights:{...e.weights,...n.weights},contributions:{...e.contributions,...n.contributions}}),KE=(e,n)=>n===1?e:{total:e.total*n,features:{...e.features},weights:Object.fromEntries(Object.entries(e.weights).map(([a,s])=>[a,Number(s)*n])),contributions:Object.fromEntries(Object.entries(e.contributions).map(([a,s])=>[a,Number(s)*n]))},Gy=(e,n)=>!e&&!n?!0:!e||!n?!1:ee(e,n),FE=(e,n)=>{if(JSON.stringify(e.plannedEntity)!==JSON.stringify(n.plannedEntity))return"plannedEntity";if(!Gy(e.plannedEntity.position,n.plannedEntity.position))return"position";if(String(e.plannedEntity.intent||"")!==String(n.plannedEntity.intent||""))return"intent";if(!Gy(e.plannedEntity.intentPosition,n.plannedEntity.intentPosition))return"intentPosition";if((e.plannedEntity.actionCooldown??void 0)!==(n.plannedEntity.actionCooldown??void 0))return"actionCooldown";if((e.plannedEntity.facing??void 0)!==(n.plannedEntity.facing??void 0))return"facing";if((e.plannedEntity.isVisible??void 0)!==(n.plannedEntity.isVisible??void 0))return"isVisible";if((e.nextState.rngCounter??void 0)!==(n.nextState.rngCounter??void 0))return"rngCounter";if(String(e.message||"")!==String(n.message||""))return"message"},WE=(e,n={})=>{const a=xE(e.enemy.subtype),s={includePolicyExact:n.includePolicyExact},r=PE(e,s),c=zE(e),u=VE(e),p=k0(),g=r.map((m,f)=>{const b=DE(e.enemy,e.state,m.planned),S=bE(e,m,b.decision,a),T=vE(e,m,b.decision,a),v=$d(S,c),A=$d(T,u),_=KE(A,p),E=v.total+_.total+Number(m.preScore||0);return{index:f,candidate:m,result:b,tacticalBreakdown:v,intentBreakdown:_,breakdown:YE(v,_,E),total:E}});return g.sort((m,f)=>f.total!==m.total?f.total-m.total:(f.candidate.preScore||0)!==(m.candidate.preScore||0)?Number(f.candidate.preScore||0)-Number(m.candidate.preScore||0):m.index-f.index),{scored:g,weights:c,intentWeights:u}},qd=e=>({...e.result,decision:{...e.result.decision,reasoningCode:e.candidate.reasoningCode,expectedValue:e.total,breakdown:e.breakdown}}),GE=(e,n)=>{if(e.candidate.source!=="policy_exact")return e;const a=qd(e);for(const s of n){if(s.candidate.source==="policy_exact")continue;const r=qd(s);if(FE(r,a)===void 0)return s}return e},XE=e=>{const n=$d({},{});return{plannedEntity:{...e.enemy,intent:"Waiting",intentPosition:void 0},nextState:e.state,message:void 0,decision:{action:{type:"WAIT",skillId:"WAIT_SKILL"},reasoningCode:"NO_CANDIDATES_WAIT",expectedValue:Number.NEGATIVE_INFINITY,breakdown:n,rngConsumption:0}}},Td=(e,n={})=>{const a=WE(e,n);if(a.scored.length===0)return{selected:XE(e),scoredResult:a,selectedCandidate:void 0};const s=a.scored[0],r=GE(s,a.scored);return{selected:qd(r),scoredResult:a,selectedCandidate:r}},Xy=e=>({selectedSource:e.selectedCandidate?.candidate.source,selectedCandidateId:e.selectedCandidate?.candidate.id,position:e.selected.plannedEntity.position,intent:e.selected.plannedEntity.intent,intentPosition:e.selected.plannedEntity.intentPosition,actionCooldown:e.selected.plannedEntity.actionCooldown,facing:e.selected.plannedEntity.facing,isVisible:e.selected.plannedEntity.isVisible,nextRngCounter:e.selected.nextState.rngCounter,message:e.selected.message}),JE=e=>{const n=Td(e),a=globalThis.__HOP_ENEMY_AI_TURN_TRACE_HOOK__,s=globalThis.__HOP_ENEMY_AI_RUNTIME_DECISION_CONTEXT__;if(a&&s&&s.actorId===e.enemy.id)try{const r=Td(e,{includePolicyExact:!0}),c=Td(e,{includePolicyExact:!1});a({runId:globalThis.__HOP_ENEMY_AI_TRACE_RUN_ID__,floor:s.floor??e.state.floor,turnNumber:s.turnNumber??e.state.turnNumber,rngCounter:s.rngCounter??e.state.rngCounter,enemyId:e.enemy.id,enemySubtype:e.enemy.subtype,enemyPosition:e.enemy.position,playerPosition:e.playerPos,withPolicyExact:Xy(r),syntheticOnly:Xy(c)})}catch{}return n.selected},QE=e=>{const n=JE(e);return $E(n.decision,e.enemy,e.state)},ZE=(e,n,a)=>QE({enemy:e,playerPos:n,state:a}),rl={weightsByIntent:{offense:{survival:2.1,lethality:6.5,position:2.4,objective:.5,status:2.5,tempo:1.6,resource:1},defense:{survival:4.8,lethality:3.6,position:3,objective:.8,status:2.2,tempo:1.6,resource:1},positioning:{survival:2.3,lethality:3.8,position:3.1,objective:6,status:1.4,tempo:1.6,resource:1},control:{survival:2.3,lethality:4.2,position:2.8,objective:.6,status:3.4,tempo:1.6,resource:1}},thresholds:{defenseHpRatio:.45,defensePressureHpRatio:.65,defensePressureAdjacentHostiles:2,controlMinHostiles:3}};({...rl.weightsByIntent,offense:{...rl.weightsByIntent.offense},control:{...rl.weightsByIntent.control}},{...rl.thresholds});class Jy{getFalconIntent(n,a){const s=a.companionState?.mode||"roost",r=a.companionOf===n.player.id?n.player:n.enemies.find(u=>u.id===a.companionOf),c={expectedValue:0,reasoningCode:`FALCON_${s.toUpperCase()}`,isGhost:!1,rngConsumption:0};if(s==="scout")return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_SCOUT",targetHex:a.position,priority:10,metadata:c};if(s==="predator"&&typeof a.companionState?.markTarget=="string"){const u=n.enemies.find(g=>g.id===a.companionState.markTarget&&g.hp>0);if(!u)return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_AUTO_ROOST",targetHex:a.position,priority:9,metadata:{...c,reasoningCode:"FALCON_AUTO_ROOST"}};const p=me(a.position,u.position);return p<=4?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_APEX_STRIKE",targetHex:u.position,primaryTargetId:u.id,priority:10,metadata:c}:p<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_PECK",targetHex:u.position,primaryTargetId:u.id,priority:9,metadata:c}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(n,a,u.position),primaryTargetId:u.id,priority:7,metadata:c}}return r?me(a.position,r.position)<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_HEAL",targetHex:r.position,primaryTargetId:r.id,priority:10,metadata:c}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(n,a,r.position),primaryTargetId:r.id,priority:7,metadata:c}:{type:"WAIT",actorId:a.id,skillId:"WAIT_SKILL",priority:1,metadata:{...c,reasoningCode:"FALCON_WAIT"}}}findStepToward(n,a,s){const r=We(a.position).filter(c=>He.isWithinBounds(n,c)).filter(c=>Oe.isWalkable(n,c)).filter(c=>{const u=ge(n,c);return!u||u.id===a.id});return r.length===0?a.position:r.sort((c,u)=>me(c,s)-me(u,s))[0]}getIntent(n,a){if(a.subtype==="falcon")return this.getFalconIntent(n,a);if(a.subtype==="bomb")return{type:"USE_SKILL",actorId:a.id,skillId:"TIME_BOMB",targetHex:a.position,priority:10,metadata:{expectedValue:0,reasoningCode:"BOMB_FUSE_TICK",isGhost:!1,rngConsumption:0}};const s=n.player.position;return ZE(a,s,{...n,occupiedCurrentTurn:n.occupiedCurrentTurn})}}class zd{inputQueue=[];resolveInput;pushIntent(n){this.inputQueue.push(n),this.resolveInput&&(this.resolveInput(n),this.resolveInput=void 0)}getIntent(n,a){return this.inputQueue.length>0?this.inputQueue.shift():new Promise(s=>{this.resolveInput=s})}}class of{static strategies=new Map;static defaultEnemyStrategy=new Jy;static defaultPlayerStrategy=new zd;static register(n,a){this.strategies.set(n,a)}static resolve(n){return this.strategies.has(n.id)?this.strategies.get(n.id):n.type==="player"?this.defaultPlayerStrategy:this.defaultEnemyStrategy}static reset(){this.strategies.clear(),this.defaultEnemyStrategy=new Jy,this.defaultPlayerStrategy=new zd}}const e_=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP"]),Ed=(e,n)=>{const a=of.resolve(e.player);a instanceof zd&&a.pushIntent(n)},_d={expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1},t_=(e,n,a)=>{if(e_.has(n.type)&&!Do(e))return e;switch(n.type){case"SELECT_UPGRADE":return"payload"in n?rE(e,n.payload):e;case"USE_SKILL":{const{skillId:s,target:r}=n.payload;return Ed(e,{type:"USE_SKILL",actorId:e.player.id,skillId:s,targetHex:r,priority:10,metadata:_d}),a.processNextTurn(e,!0)}case"MOVE":{if(!("payload"in n))return e;const s=n.payload,r=e.player.activeSkills||[],c=Fn(e.enemies,s),u=["BASIC_ATTACK","BASIC_MOVE","DASH"],p=r.filter(f=>f.slot==="passive"),g=[...p.filter(f=>u.includes(f.id)),...p.filter(f=>!u.includes(f.id))];let m;for(const f of g){const b=yt.get(f.id);if(!b?.getValidTargets)continue;if(b.getValidTargets(e,e.player.position).some(T=>ee(T,s))){m=f.id;break}}if(!m){const f=r.some(S=>S.id==="BASIC_ATTACK"),b=r.some(S=>S.id==="BASIC_MOVE");if(c&&f)m="BASIC_ATTACK";else if(!c&&b)m="BASIC_MOVE";else return{...e,message:ht(e.message,c?"No valid passive attack for target.":"No valid passive movement for target.","CRITICAL","SYSTEM")}}return Ed(e,{type:c?"ATTACK":"MOVE",actorId:e.player.id,skillId:m,targetHex:s,primaryTargetId:c?.id,priority:10,metadata:_d}),a.processNextTurn(e,!0)}case"WAIT":return Ed(e,{type:"WAIT",actorId:e.player.id,skillId:"WAIT",priority:10,metadata:_d}),a.processNextTurn(e,!0);case"APPLY_LOADOUT":{if(!("payload"in n))return e;const s=n.payload,r=S0(s);return{...e,player:{...e.player,activeSkills:r.activeSkills,archetype:r.archetype},upgrades:r.upgrades,hasSpear:s.startingSkills.includes("SPEAR_THROW"),hasShield:s.startingSkills.includes("SHIELD_THROW")||e.hasShield,selectedLoadoutId:s.id,message:ht(e.message,`${s.name} selected.`,"INFO","SYSTEM")}}case"START_RUN":{const{loadoutId:s,seed:r,mode:c,date:u}=n.payload,p=oi[s];if(!p)return e;if(c==="daily"){const g=_A(u),m=wA(g);return{...a.generateInitialState(1,r||m,void 0,void 0,p),dailyRunDate:g,runObjectives:MA(m),hazardBreaches:0}}return a.generateInitialState(1,r,void 0,void 0,p)}case"ADVANCE_TURN":return e.pendingStatus||(e.pendingFrames?.length??0)>0?(a.warnTurnStackInvariant("Ignored ADVANCE_TURN while pendingStatus is active.",{status:e.pendingStatus?.status,pendingFrames:e.pendingFrames?.length??0,turnNumber:e.turnNumber}),e):a.processNextTurn(e,!1);case"RESOLVE_PENDING":return lE(e,{generateInitialState:a.generateInitialState});case"EXIT_TO_HUB":return a.generateHubState();default:return e}},n_=(e,n,a,s)=>{let r=e;const c=[],u=a?e.enemies.filter(g=>g.id===a):e.enemies,p=[...r.enemies];return u.forEach(g=>{const m=r.enemies.find(f=>f.id===g.id);if(m){if(si(m)){const f=p.findIndex(b=>b.id===g.id);f!==-1&&(p[f]={...p[f],intent:void 0,intentPosition:void 0});return}if(m.intent&&m.intentPosition){let f=!1;const b=yt.get(m.intent);let S=m.activeSkills?.find(T=>T.id===m.intent);if(!S&&m.intent==="ARCHER_SHOT"&&(S=m.activeSkills?.find(T=>T.id==="SPEAR_THROW")),b&&S){const v=(b.getValidTargets?b.getValidTargets(r,m.position):[]).some(E=>ee(E,r.player.position));let A=m.intentPosition;if(v)A=r.player.position;else{const E=p.findIndex(w=>w.id===g.id);E!==-1&&(p[E]={...p[E],intent:void 0,intentPosition:void 0});return}const _=b.execute(r,m,A,S.activeUpgrades);r=Gn(r,_.effects,{sourceId:m.id,targetId:r.player.id,stepId:s}),c.push(..._.messages),f=!0}else if(m.subtype!=="bomber"){if(ee(m.intentPosition,n)){r={...r,player:ra(r.player,1)};const T=`${m.subtype||"enemy"}#${m.id}`;c.push(`${T} hit you! (HP: ${r.player.hp}/${r.player.maxHp})`),f=!0}}if(f){const T=p.findIndex(v=>v.id===g.id);T!==-1&&(p[T]={...p[T],intent:void 0,intentPosition:void 0})}}}}),r={...r,enemies:p},{state:r,messages:c}},R0=(e,n,a)=>si(a)?{...e,type:"WAIT",skillId:"WAIT_SKILL",priority:0,metadata:{...e.metadata,reasoningCode:"STATUS_STUNNED"}}:e;class I0{static execute(n,a,s){return this.resolveExecution(n,a,s)}static simulate(n,a,s){return this.resolveExecution(n,a,s)}static resolveExecution(n,a,s){const r=[],c=[],u=yt.get(n.skillId);if(!u&&n.type!=="WAIT")return{effects:[],messages:[`Failed to execute unknown skill: ${n.skillId}`],consumesTurn:!1};if(n.type==="WAIT")return{effects:[],messages:[],consumesTurn:!0};if(!(n.skillId==="WAIT_SKILL"||a.activeSkills.some(A=>A.id===n.skillId)))return{effects:[],messages:[`Actor ${a.id} does not have skill ${n.skillId} in loadout!`],consumesTurn:!1};const g=a.activeSkills.find(A=>A.id===n.skillId),m=a.factionId==="player"&&nf(s);if(!m&&g&&(g.currentCooldown||0)>0)return{effects:[],messages:[`${n.skillId} is on cooldown (${g.currentCooldown}).`],consumesTurn:a.type!=="player"};let f=n.targetHex,b=n.primaryTargetId;if(!f&&u&&(f=this.findOptimalTargetHex(n,a,s,u.baseVariables.range)),!f)return{effects:[],messages:[`No valid target found for ${n.skillId}`],consumesTurn:!1};if(f&&!b){const A=ge(s,f);A&&(b=A.id)}const S=g?.activeUpgrades||[],T=u.execute(s,a,f,S),v=[...r,...T.effects];if(T.consumesTurn!==!1&&!m){let _=u.baseVariables.cooldown||0;for(const E of S){const w=u.upgrades?.[E];typeof w?.modifyCooldown=="number"&&(_+=w.modifyCooldown)}_=Math.max(0,_),_>0&&v.push({type:"ModifyCooldown",skillId:n.skillId,amount:_+1,setExact:!0})}return{effects:v,messages:[...c,...T.messages],consumesTurn:T.consumesTurn??!0,targetId:b,kills:T.kills||0}}static findOptimalTargetHex(n,a,s,r){if(n.primaryTargetId){const c=s.enemies.find(u=>u.id===n.primaryTargetId)||(s.player.id===n.primaryTargetId?s.player:void 0);if(c&&(n.type==="ATTACK"||n.type==="USE_SKILL"))return c.position}}}const Vd=(e,n)=>e.q!==n.q?e.q-n.q:e.r!==n.r?e.r-n.r:e.s-n.s,Il=(e,n)=>e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n),i_=(e,n)=>{if(n.primaryTargetId)return Il(e,n.primaryTargetId);if(n.targetHex)return ge(e,n.targetHex)},a_=(e,n,a)=>{const s=new Map,r=i_(e,n),c=u=>{u&&s.set(ue(u),u)};return a.forEach(u=>{u.type==="Damage"?typeof u.target=="string"&&u.target!=="targetActor"&&u.target!=="area"?c(Il(e,u.target)?.position):u.target==="targetActor"?c(r?.position):u.target==="area"?c(u.source):typeof u.target=="object"&&"q"in u.target&&c(u.target):u.type==="Impact"||u.type==="LavaSink"?c(Il(e,u.target)?.position):u.type==="Displacement"&&c(u.destination)}),[...s.values()].sort(Vd)},Qy=e=>{const n=[];e.enemies.filter(r=>r.hp>0&&r.factionId!==e.player.factionId).forEach(r=>{const u=of.resolve(r).getIntent(e,r);if(u instanceof Promise)return;const p=R0(u,e,r);let g=p;p.skillId==="SENTINEL_TELEGRAPH"&&(g={...p,skillId:"SENTINEL_BLAST"});const m=I0.simulate(g,r,e),f=a_(e,g,m.effects);f.length!==0&&n.push({actorId:r.id,skillId:p.skillId,targetHex:p.targetHex,dangerTiles:f})}),n.sort((r,c)=>r.actorId!==c.actorId?r.actorId.localeCompare(c.actorId):r.skillId!==c.skillId?r.skillId.localeCompare(c.skillId):!r.targetHex&&!c.targetHex?0:r.targetHex?c.targetHex?Vd(r.targetHex,c.targetHex):1:-1);const s=new Map;return n.forEach(r=>r.dangerTiles.forEach(c=>s.set(ue(c),c))),{sourceTurn:e.turnNumber,dangerTiles:[...s.values()].sort(Vd),projections:n}},s_=e=>(a,s=!1)=>{if(a.pendingStatus||(a.pendingFrames?.length??0)>0)return e.warnTurnStackInvariant("Blocked processNextTurn while pendingStatus is active.",{status:a.pendingStatus?.status,pendingFrames:a.pendingFrames?.length??0,turnNumber:a.turnNumber}),a;let r=a;const c=[],u=[];let p=0;const g=100;let m=!1;for(;p<g;){if(p++,r.player.hp<=0&&r.pendingStatus?.status!=="lost"){const q=jo(r);return e.withPendingFrame({...r,message:ht(r.message,"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:q},"RUN_LOST",{reason:"GLOBAL_DEATH_CHECK"})}r.occupancyMask=He.refreshOccupancyMask(r);let b;if((s&&p===1||m)&&r.initiativeQueue){m=!1;const q=r.initiativeQueue;q.entries.length>0&&q.currentIndex>=0&&q.currentIndex<q.entries.length&&(b=q.entries[q.currentIndex].actorId)}else{const q=aT(r);r={...r,initiativeQueue:q.queue},b=q.actorId??void 0}if(!b)break;const S=b==="player"?r.player:r.enemies.find(q=>q.id===b),T=`${r.turnNumber}:${r.initiativeQueue?.round??0}:${b}:${p}`;if(!S||S.hp<=0){r={...r,initiativeQueue:vd(r.initiativeQueue,b)};continue}if(iT(r.initiativeQueue)?.turnStartPosition||(r={...r,initiativeQueue:sT(r,S)}),!s||p>1){const q=e.executeStatusWindow(r,b,"START_OF_TURN",T);if(r=q.state,c.push(...q.messages),b==="player"&&r.upgrades?.includes("RELIC_STEADY_PLATES")){const z=Math.min(2,(r.player.temporaryArmor||0)+1);z!==(r.player.temporaryArmor||0)&&(r={...r,player:{...r.player,temporaryArmor:z}},c.push(ht([],"Steady Plates harden your stance.","INFO","COMBAT")[0]))}if(b==="player"){const z=r.player.activeSkills?.find(le=>le.id==="SHIELD_BASH");if(!!z?.activeUpgrades?.includes("PASSIVE_PROTECTION")&&(z?.currentCooldown||0)===0){const le=Math.max(r.player.temporaryArmor||0,1);le!==(r.player.temporaryArmor||0)&&(r={...r,player:{...r.player,temporaryArmor:le}},c.push(ht([],"Passive Protection braces your guard.","INFO","COMBAT")[0]))}}const P=n_(r,r.player.position,b,T);r=P.state,c.push(...P.messages)}const A=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!A||A.hp<=0){r={...r,initiativeQueue:vd(r.initiativeQueue,b),message:ai(r.message,c,"INFO","SYSTEM")};continue}const _=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!_||_.hp<=0)continue;let E,w=!1;if(si(_))w=!0,E={type:"WAIT",actorId:_.id,skillId:"WAIT_SKILL",priority:0,metadata:{expectedValue:0,reasoningCode:"STATUS_STUNNED_AUTOSKIP",isGhost:!1}},b==="player"?c.push("You are stunned and skip your turn."):c.push(`${_.subtype||"Enemy"} is stunned and skips its turn.`);else{const q=of.resolve(_),P=b!=="player"?{actorId:_.id,floor:r.floor,turnNumber:r.turnNumber,rngCounter:r.rngCounter}:void 0;P&&(globalThis.__HOP_ENEMY_AI_RUNTIME_DECISION_CONTEXT__=P);let z;try{z=q.getIntent(r,_)}finally{P&&delete globalThis.__HOP_ENEMY_AI_RUNTIME_DECISION_CONTEXT__}if(z instanceof Promise){const X=Qy(r);return{...r,intentPreview:X,message:ai(r.message,c,"INFO","SYSTEM"),dyingEntities:[...r.dyingEntities||[],...u]}}E=z}const M=A.activeSkills.map(q=>q.id).join(", ");e.engineDebug&&(console.log(`[ENGINE] Actor: ${b} | Loadout: [${M}] | Pos: ${JSON.stringify(A.position)}`),console.log(`[ENGINE] Intent: ${E.type} | Skill: ${E.skillId} | TargetHex: ${E.targetHex?JSON.stringify(E.targetHex):"none"} | TargetId: ${E.primaryTargetId||"none"}`)),E.metadata.rngConsumption&&(r={...r,rngCounter:(r.rngCounter||0)+E.metadata.rngConsumption}),E=R0(E,r,_);const{effects:C,messages:L,consumesTurn:k,targetId:R,kills:H}=I0.execute(E,_,r);if(e.engineDebug&&console.log(`[ENGINE] ${b} intends ${E.type} (${E.skillId}) onto ${R||(E.targetHex?JSON.stringify(E.targetHex):"self")}`),e.engineWarn&&C.length===0&&E.type!=="WAIT"){const q=`[ENGINE] WARNING: Intent ${E.type} (${E.skillId}) for actor ${b} produced ZERO effects!`;console.warn(q)}const D=r,$=Gn(r,C,{sourceId:b,targetId:R,stepId:T});if(b==="player"&&($.kills=($.kills||0)+(H||0)),k===!1){r={...D,message:ai(r.message,L,"INFO","COMBAT")},m=!0;continue}if(r=$,c.push(...L),b!=="player"){const q=r.enemies.find(P=>P.id===b);if(q?.subtype==="bomber"){const P=E.skillId==="BOMB_TOSS"?2:Math.max(0,(q.actionCooldown??0)-1);q.actionCooldown!==P&&(r={...r,enemies:r.enemies.map(z=>z.id===b?{...z,actionCooldown:P}:z)})}}const J=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!J||J.hp<=0){if(b==="player"){const q=jo(r);return e.withPendingFrame({...r,message:ht(ai(r.message,c,"INFO","SYSTEM"),"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:q},"RUN_LOST",{reason:"SELF_ACTION_DEATH"})}r={...r,enemies:r.enemies.filter(q=>q.id!==b),initiativeQueue:vd(r.initiativeQueue,b),message:ai(r.message,c,"INFO","SYSTEM")};continue}const te=e.executeStatusWindow(r,b,"END_OF_TURN",T);r=te.state,c.push(...te.messages),r={...r,enemies:r.enemies.map(q=>q.id===b?xy(Cy(q)):q),player:b==="player"?xy(Cy(r.player)):r.player,initiativeQueue:oT(r,b)};const ae=b==="player"?r.player:r.enemies.find(q=>q.id===b);if(!(w||E.metadata?.reasoningCode==="STATUS_STUNNED"||E.metadata?.reasoningCode==="STATUS_STUNNED_AUTOSKIP")&&ae&&ae.hp>0){const q=rT(r,b)||ae.previousPosition||ae.position,P=lT(r,b)??void 0,z=_T(r,ae,We(q),q,P,T);r=z.state,c.push(...z.messages),b==="player"&&(r.kills=(r.kills||0)+z.kills)}if(b==="player"){const q=e.applyPlayerEndOfTurnRules(r,T,{withPendingFrame:e.withPendingFrame});if(r=q.state,q.haltTurnLoop)return r;c.push(...q.messages)}}const f=Qy(r);return{...r,intentPreview:f,message:ai(r.message,c,"INFO","SYSTEM"),dyingEntities:[...r.dyingEntities||[],...u]}};var L0={};const B0=typeof process<"u"&&L0?.HOP_ENGINE_DEBUG==="1",H0=typeof process<"u"&&L0?.HOP_ENGINE_WARN==="1",o_=B0||H0,P0=(e,n)=>{if(o_){if(n){console.warn(`[TURN_STACK] ${e}`,n);return}console.warn(`[TURN_STACK] ${e}`)}},Dl=()=>{const e=Da();return{...e,gameStatus:"hub",message:[ht([],"Welcome to the Strategic Hub. Select your loadout.","INFO","SYSTEM")[0]],player:{...e.player,activeSkills:[]},hasSpear:!1,hasShield:!1}},Da=(e=1,n,a,s,r)=>{T0();const c=n||String(Date.now()),u=eE(e),p=Q1(e,c),g=Z1(e,p.spawnPositions||[],c),m=s?{hp:s.hp,maxHp:s.maxHp,speed:s.speed||py.speed}:{speed:py.speed},f=s?.upgrades||(r?r.startingUpgrades:[]),b=r?S0(r):{activeSkills:I1(),archetype:"VANGUARD"},S=x0(s?.activeSkills||b.activeSkills),T=s?.archetype||b.archetype,v=p.tiles||new Map,_={turnNumber:1,player:{...ca({id:"player",type:"player",position:p.playerSpawn,hp:m.hp,maxHp:m.maxHp,speed:m.speed,factionId:"player",activeSkills:S,archetype:T,weightClass:"Standard",components:new Map}),previousPosition:p.playerSpawn},enemies:g.map(E=>({...E,previousPosition:E.position,statusEffects:E.statusEffects||[],temporaryArmor:E.temporaryArmor||0})),gridWidth:Cl,gridHeight:Nl,gameStatus:"playing",message:e===1?[ht([],"Welcome to the arena. Survive.","INFO","SYSTEM")[0]]:ht(s?.message||[],`Floor ${e} - ${u.charAt(0).toUpperCase()+u.slice(1)}. Be careful.`,"INFO","OBJECTIVE"),hasSpear:!0,stairsPosition:p.stairsPosition,occupancyMask:[0n],shrinePosition:p.shrinePosition,shrineOptions:void 0,hasShield:!0,floor:e,upgrades:f,rooms:p.rooms,theme:u,commandLog:[],undoStack:[],rngSeed:c,initialSeed:a??(e===1?c:void 0),rngCounter:0,actionLog:[],kills:s&&s.kills||0,environmentalKills:s&&s.environmentalKills||0,turnsSpent:s&&s.turnsSpent||0,dailyRunDate:s?.dailyRunDate,runObjectives:s?.runObjectives||[],hazardBreaches:s?.hazardBreaches||0,completedRun:void 0,combatScoreEvents:s?.combatScoreEvents||[],dyingEntities:[],visualEvents:[],timelineEvents:[],intentPreview:void 0,initiativeQueue:void 0,tiles:v};return _.initiativeQueue=ja(_),_.occupancyMask=He.refreshOccupancyMask(_),_},r_=(e,n,a,s)=>{const r=n==="player"?e.player:e.enemies.find(g=>g.id===n);if(!r)return{state:e,messages:[]};const c=[],u=[];return r.statusEffects.forEach(g=>{if(g.tickWindow===a&&g.onTick){const m=g.onTick(r,e);m&&c.push(...m)}}),{state:Gn(e,c,{sourceId:n,stepId:s}),messages:u}},l_=s_({executeStatusWindow:r_,withPendingFrame:aE,applyPlayerEndOfTurnRules:cE,warnTurnStackInvariant:P0,engineDebug:B0,engineWarn:H0}),c_=(e,n)=>{const a=af(e.player),s=a===e.player?e:{...e,player:a};if(s.gameStatus!=="playing"&&n.type!=="RESET"&&n.type!=="SELECT_UPGRADE"&&n.type!=="LOAD_STATE"&&n.type!=="APPLY_LOADOUT"&&n.type!=="START_RUN"&&n.type!=="EXIT_TO_HUB")return s;const r={...s,isShaking:!1,lastSpearPath:void 0,dyingEntities:[],occupiedCurrentTurn:void 0,visualEvents:[],timelineEvents:[]};switch(n.type){case"LOAD_STATE":return oE(n.payload);case"RESET":{const S=e.player.archetype==="SKIRMISHER"?"SKIRMISHER":"VANGUARD",T=oi[S];return Da(1,n.payload?.seed||String(Date.now()),void 0,void 0,T)}case"EXIT_TO_HUB":return Dl()}if(s.gameStatus!=="playing"&&n.type!=="SELECT_UPGRADE"&&n.type!=="APPLY_LOADOUT"&&n.type!=="START_RUN")return s;const c=tE(n,s),u=s;let p={...r,initiativeQueue:r.initiativeQueue};const m=((b,S)=>t_(b,S,{processNextTurn:l_,generateInitialState:Da,generateHubState:Dl,warnTurnStackInvariant:P0}))(p,n),f=nE(u,m,e);return c.delta=f,{...m,commandLog:[...m.commandLog||[],c],undoStack:[...m.undoStack||[],f],actionLog:[...m.actionLog||[],n]}},Zy={skill:{staticWeight:.5,powerCoeff:1,reachCoeff:1,safetyCoeff:1,tempoCoeff:1,complexityCoeff:1,perSkillScalar:{}},policy:{offenseWeight:1,defenseWeight:1,positioningWeight:1,statusWeight:1,riskPenaltyWeight:1}};({...Zy.policy},{...Zy.skill});const u_=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP","ADVANCE_TURN","SELECT_UPGRADE","RESOLVE_PENDING"]),d_=e=>typeof e=="object"&&e!==null,j0=e=>{if(!Array.isArray(e))return{valid:!1,actions:[],errors:["Replay actions must be an array."]};const n=[],a=[];return e.forEach((s,r)=>{if(!d_(s)||typeof s.type!="string"){a.push(`Action[${r}] is not a valid action object with a "type" field.`);return}if(!u_.has(s.type)){a.push(`Action[${r}] type "${s.type}" is not replayable.`);return}n.push(s)}),{valid:a.length===0,actions:n,errors:a}},Ra=e=>({q:e.q,r:e.r,s:e.s}),f_=e=>{if(e){if(e instanceof Map)return new Map(Array.from(e.entries()).map(([n,a])=>[n,typeof a=="object"&&a!==null?{...a}:a]));if(Array.isArray(e))return new Map(e);if(typeof e=="object")return new Map(Object.entries(e).map(([n,a])=>[n,typeof a=="object"&&a!==null?{...a}:a]))}},ll=e=>({...e,position:Ra(e.position),previousPosition:e.previousPosition?Ra(e.previousPosition):void 0,intentPosition:e.intentPosition?Ra(e.intentPosition):void 0,statusEffects:e.statusEffects.map(n=>({...n})),activeSkills:e.activeSkills.map(n=>({...n,upgrades:[...n.upgrades||[]],activeUpgrades:[...n.activeUpgrades||[]]})),components:f_(e.components),companionState:e.companionState?{...e.companionState,markTarget:typeof e.companionState.markTarget=="object"&&e.companionState.markTarget?Ra(e.companionState.markTarget):e.companionState.markTarget}:void 0}),m_=e=>({...e,player:ll(e.player),enemies:e.enemies.map(ll),companions:e.companions?.map(ll),dyingEntities:e.dyingEntities?.map(ll),message:[...e.message],visualEvents:[...e.visualEvents||[]],simulationEvents:[...e.simulationEvents||[]],stackTrace:e.stackTrace?e.stackTrace.map(n=>({...n})):void 0,timelineEvents:e.timelineEvents?e.timelineEvents.map(n=>({...n})):void 0,occupancyMask:[...e.occupancyMask],tiles:new Map(Array.from(e.tiles.entries()).map(([n,a])=>[n,{...a,position:Ra(a.position),traits:new Set(a.traits),effects:a.effects.map(s=>({...s}))}])),traps:e.traps?.map(n=>({...n,position:Ra(n.position)})),lastSpearPath:e.lastSpearPath?.map(Ra),actionLog:e.actionLog?[...e.actionLog]:void 0}),eg=(e,n)=>e.player.id===n?e.player:e.enemies.find(a=>a.id===n)||e.companions?.find(a=>a.id===n),p_=(e,n)=>{if(n)return ge(e,n)?.id},h_=(e,n)=>{const a=eg(e,n.actorId);if(!a)return{ok:!1,reason:`Actor ${n.actorId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const s=yt.get(n.skillId);if(!s)return{ok:!1,reason:`Skill ${n.skillId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};if(n.target&&s.getValidTargets&&!s.getValidTargets(e,a.position).some(S=>ue(S)===ue(n.target)))return{ok:!1,reason:`Target ${ue(n.target)} is invalid`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const r=m_(e),c=eg(r,n.actorId),u=s.execute(r,c,n.target,n.activeUpgrades||[],n.context||{}),p=r.simulationEvents?.length||0,g=r.stackTrace?.length||0,m=p_(r,n.target),f=Gn(r,u.effects,{sourceId:c.id,targetId:m});return{ok:!0,effects:u.effects,messages:u.messages,consumesTurn:u.consumesTurn,predictedState:f,simulationEvents:(f.simulationEvents||[]).slice(p),stackTrace:(f.stackTrace||[]).slice(g)}},y_=e=>({q:e.q,r:e.r,s:e.s}),g_=e=>{const n=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]];return{turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:n.map(a=>({id:a.id,position:y_(a.position)}))}},b_=(e,n)=>{const a=[],s=new Map(e.actors.map(c=>[c.id,c.position])),r=new Map(n.actors.map(c=>[c.id,c.position]));for(const[c,u]of s.entries()){const p=r.get(c);if(!p){a.push({actorId:c,expected:u,reason:"missing_in_ui"});continue}ue(u)!==ue(p)&&a.push({actorId:c,expected:u,actual:p,reason:"position_mismatch"})}for(const[c,u]of r.entries())s.has(c)||a.push({actorId:c,actual:u,reason:"missing_in_engine"});return{ok:a.length===0,mismatches:a}},Co={player:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},vanguard:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},skirmisher:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#fbbf24",isRanged:!1},firemage:{icon:"",shape:"square",color:"#ef4444",borderColor:"#fbbf24",isRanged:!0},necromancer:{icon:"",shape:"square",color:"#6b21a8",borderColor:"#9333ea",isRanged:!0},hunter:{icon:"",shape:"square",color:"#10b981",borderColor:"#ffffff",isRanged:!0},assassin_player:{icon:"",shape:"square",color:"#1f2937",borderColor:"#ffffff",isRanged:!1},footman:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1},sprinter:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1,size:.9},spear:{icon:"",shape:"circle",color:"#ffffff",borderColor:"#3b82f6",isRanged:!1,size:.8,opacity:.9},shieldBearer:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#fbbf24",isRanged:!1,showFacing:!0},golem:{icon:"",shape:"diamond",color:"#78716c",borderColor:"#ffffff",isRanged:!1,size:1.2},assassin:{icon:"",shape:"diamond",color:"#6b21a8",borderColor:"#ffffff",isRanged:!1},archer:{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},bomber:{icon:"",shape:"circle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},warlock:{icon:"",shape:"triangle",color:"#9333ea",borderColor:"#ffffff",isRanged:!0},bomb:{icon:"",shape:"circle",color:"#1f2937",borderColor:"#000000",isRanged:!1,showTimer:!0},falcon:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},skeleton:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},sentinel:{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!0,size:1.5}};function Uo(e,n,a,s){if(e&&Co[e])return Co[e];if(n==="player"&&s){const r=s==="ASSASSIN"?"assassin_player":s.toLowerCase();if(Co[r])return Co[r]}return n==="player"?Co.player:a==="ranged"?{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0}:a==="boss"?{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!1,size:1.5}:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1}}function v_(e){return e.isFlying===!0}const S_=["catacombs","inferno","throne","frozen","void"],cl=["off","repeat","cover"],tg=64,ng=192,ul=64,dl=512,x_=["normal","multiply","overlay","soft-light","screen","color-dodge"],ig=["off","multiply","overlay","soft-light","screen","color-dodge","normal"],A_=["#8b6f4a","#8f4a2e","#5b6d41","#536e8e","#5f5977","#b79a73","#d15a3a","#3e4f3a"],T_=["native","additive","custom"],an=(e,n,a)=>Math.min(a,Math.max(n,e)),it=(e,n)=>{const a=Number(e);return Number.isFinite(a)?a:n},ag=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,u,p]=a.slice(1).split("");return`#${c}${c}${u}${u}${p}${p}`.toLowerCase()}return n},D0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",sg=e=>e==="off"?"off":D0(e),E_=({settings:e,setSettings:n,pathSets:a,copyStatus:s,onBack:r,onReset:c,onCopySettings:u,tintPickerColor:p,mountainTintPickerColor:g})=>y.jsxs("aside",{className:"w-[420px] border-r border-white/10 bg-[#02040a] overflow-y-auto",children:[y.jsxs("div",{className:"sticky top-0 z-20 border-b border-white/10 bg-[#02040a]/95 backdrop-blur p-4",children:[y.jsxs("div",{className:"flex items-center justify-between gap-3",children:[y.jsx("button",{type:"button",onClick:r,className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-[11px] font-black uppercase tracking-[0.18em]",children:"Back"}),y.jsx("button",{type:"button",onClick:c,className:"px-3 py-2 rounded-lg border border-amber-300/40 bg-amber-500/10 hover:bg-amber-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Reset"}),y.jsx("button",{type:"button",onClick:u,className:"px-3 py-2 rounded-lg border border-cyan-300/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Copy JSON"})]}),y.jsxs("div",{className:"mt-3 text-[10px] uppercase tracking-[0.22em] text-white/50",children:["Hop / Biomes ",s?`* ${s}`:""]})]}),y.jsxs("div",{className:"p-4 space-y-6",children:[y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/75",children:"Preview"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Theme"}),y.jsx("select",{value:e.theme,onChange:m=>n(f=>f&&{...f,theme:m.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:S_.map(m=>y.jsx("option",{value:m,children:m},m))}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed"}),y.jsx("input",{value:e.seed,onChange:m=>n(f=>f&&{...f,seed:m.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),y.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[y.jsx("input",{type:"checkbox",checked:e.injectHazards,onChange:m=>n(f=>f&&{...f,injectHazards:m.target.checked})}),"Inject synthetic lava/fire patches for mask testing"]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-cyan-200",children:"Undercurrent"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),y.jsx("input",{list:"sandbox-undercurrent-paths",value:e.undercurrent.path,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,path:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsx("datalist",{id:"sandbox-undercurrent-paths",children:a.undercurrent.map(m=>y.jsx("option",{value:m},m))}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),y.jsx("select",{value:e.undercurrent.mode,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:cl.map(m=>y.jsx("option",{value:m,children:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),y.jsx("input",{type:"number",min:tg,max:ng,step:16,value:e.undercurrent.scalePx,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scalePx:an(it(m.target.value,f.undercurrent.scalePx),tg,ng)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.undercurrent.opacity,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,opacity:an(it(m.target.value,f.undercurrent.opacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll X"}),y.jsx("input",{type:"number",step:5,value:e.undercurrent.scrollX,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scrollX:it(m.target.value,f.undercurrent.scrollX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll Y"}),y.jsx("input",{type:"number",step:5,value:e.undercurrent.scrollY,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scrollY:it(m.target.value,f.undercurrent.scrollY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Duration"}),y.jsx("input",{type:"number",min:1e3,step:500,value:e.undercurrent.scrollDurationMs,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,scrollDurationMs:Math.max(1e3,it(m.target.value,f.undercurrent.scrollDurationMs))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),y.jsx("input",{type:"number",step:4,value:e.undercurrent.offsetX,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,offsetX:it(m.target.value,f.undercurrent.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),y.jsx("input",{type:"number",step:4,value:e.undercurrent.offsetY,onChange:m=>n(f=>f&&{...f,undercurrent:{...f.undercurrent,offsetY:it(m.target.value,f.undercurrent.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-amber-200",children:"Crust"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),y.jsx("input",{list:"sandbox-crust-paths",value:e.crust.path,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,path:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsx("datalist",{id:"sandbox-crust-paths",children:a.crust.map(m=>y.jsx("option",{value:m},m))}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),y.jsx("select",{value:e.crust.mode,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:cl.map(m=>y.jsx("option",{value:m,children:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),y.jsx("input",{type:"number",min:64,step:16,value:e.crust.scalePx,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,scalePx:Math.max(64,it(m.target.value,f.crust.scalePx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),y.jsx("input",{type:"number",min:1,max:1,step:.01,value:1,onChange:()=>n(m=>m&&{...m,crust:{...m.crust,opacity:1}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed Shift Budget"}),y.jsx("input",{type:"number",min:0,step:8,value:e.crust.seedShiftPx,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,seedShiftPx:Math.max(0,it(m.target.value,f.crust.seedShiftPx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),y.jsx("input",{type:"number",step:4,value:e.crust.offsetX,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,offsetX:it(m.target.value,f.crust.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),y.jsx("input",{type:"number",step:4,value:e.crust.offsetY,onChange:m=>n(f=>f&&{...f,crust:{...f.crust,offsetY:it(m.target.value,f.crust.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-rose-200",children:"Walls / Mountains"}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mountain Asset"}),y.jsx("input",{list:"sandbox-mountain-paths",value:e.walls.mountainPath,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainPath:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs",placeholder:"/assets/biomes/biome.volcano.mountain.01.webp"}),y.jsx("datalist",{id:"sandbox-mountain-paths",children:a.mountain.map(m=>y.jsx("option",{value:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale"}),y.jsx("input",{type:"number",min:.2,max:3,step:.01,value:e.walls.mountainScale,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainScale:an(it(m.target.value,f.walls.mountainScale),.2,3)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor X"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainAnchorX,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainAnchorX:an(it(m.target.value,f.walls.mountainAnchorX),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),y.jsx("input",{type:"number",step:2,value:e.walls.mountainOffsetX,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainOffsetX:it(m.target.value,f.walls.mountainOffsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),y.jsx("input",{type:"number",step:2,value:e.walls.mountainOffsetY,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainOffsetY:it(m.target.value,f.walls.mountainOffsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor Y"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainAnchorY,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainAnchorY:an(it(m.target.value,f.walls.mountainAnchorY),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Crust Blend"}),y.jsx("select",{value:e.walls.mountainCrustBlendMode,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainCrustBlendMode:sg(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:ig.map(m=>y.jsx("option",{value:m,children:m},`mountain-blend-${m}`))})]}),y.jsxs("div",{children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Blend Opacity ",e.walls.mountainCrustBlendOpacity.toFixed(2)]}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainCrustBlendOpacity,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainCrustBlendOpacity:an(it(m.target.value,f.walls.mountainCrustBlendOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Mountain Tint"}),y.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[y.jsx("input",{type:"color",value:g,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintColor:m.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Mountain Tint Color Picker"}),y.jsx("input",{value:e.walls.mountainTintColor,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintColor:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Tint Blend"}),y.jsx("select",{value:e.walls.mountainTintBlendMode,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintBlendMode:sg(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:ig.map(m=>y.jsx("option",{value:m,children:m},`mountain-tint-blend-${m}`))})]}),y.jsxs("div",{children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",e.walls.mountainTintOpacity.toFixed(2)]}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.walls.mountainTintOpacity,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mountainTintOpacity:an(it(m.target.value,f.walls.mountainTintOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Wall Layout Mode"}),y.jsx("select",{value:e.walls.mode,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:T_.map(m=>y.jsx("option",{value:m,children:m},`wall-mode-${m}`))}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Interior Density ",e.walls.interiorDensity.toFixed(2)]}),y.jsx("input",{type:"range",min:0,max:.45,step:.01,value:e.walls.interiorDensity,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,interiorDensity:an(it(m.target.value,f.walls.interiorDensity),0,.45)}}),className:"w-full"})]}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Cluster Bias ",e.walls.clusterBias.toFixed(2)]}),y.jsx("input",{type:"range",min:0,max:1,step:.01,value:e.walls.clusterBias,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,clusterBias:an(it(m.target.value,f.walls.clusterBias),0,1)}}),className:"w-full"})]}),y.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[y.jsx("input",{type:"checkbox",checked:e.walls.keepPerimeter,onChange:m=>n(f=>f&&{...f,walls:{...f.walls,keepPerimeter:m.target.checked}})}),"Keep perimeter walls (custom mode)"]})]}),y.jsxs("section",{className:"space-y-3",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-fuchsia-200",children:"Crust Materials"}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Detail A"}),y.jsx("input",{list:"sandbox-detail-paths",value:e.materials.detailA.path,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,path:m.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsx("datalist",{id:"sandbox-detail-paths",children:a.detail.map(m=>y.jsx("option",{value:m},m))}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsx("select",{value:e.materials.detailA.mode,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,mode:m.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:cl.map(m=>y.jsx("option",{value:m,children:m},`detail-a-${m}`))}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.materials.detailA.opacity,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,opacity:an(it(m.target.value,f.materials.detailA.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsx("input",{type:"number",min:ul,max:dl,step:16,value:e.materials.detailA.scalePx,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailA:{...f.materials.detailA,scalePx:an(it(m.target.value,f.materials.detailA.scalePx),ul,dl)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Detail B"}),y.jsx("input",{list:"sandbox-detail-paths",value:e.materials.detailB.path,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,path:m.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsx("select",{value:e.materials.detailB.mode,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,mode:m.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:cl.map(m=>y.jsx("option",{value:m,children:m},`detail-b-${m}`))}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.materials.detailB.opacity,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,opacity:an(it(m.target.value,f.materials.detailB.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsx("input",{type:"number",min:ul,max:dl,step:16,value:e.materials.detailB.scalePx,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,detailB:{...f.materials.detailB,scalePx:an(it(m.target.value,f.materials.detailB.scalePx),ul,dl)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),y.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Tint"}),y.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[y.jsx("input",{type:"color",value:p,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintColor:m.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Tint Color Picker"}),y.jsx("input",{value:e.materials.tintColor,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintColor:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),y.jsx("div",{className:"grid grid-cols-8 gap-2",children:A_.map(m=>y.jsx("button",{type:"button",onClick:()=>n(f=>f&&{...f,materials:{...f.materials,tintColor:m}}),className:`h-6 rounded border ${ag(e.materials.tintColor)===ag(m)?"border-white":"border-white/20"}`,style:{backgroundColor:m},title:m},`tint-swatch-${m}`))}),y.jsxs("div",{className:"space-y-2",children:[y.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",e.materials.tintOpacity.toFixed(2)]}),y.jsx("input",{type:"range",min:0,max:1,step:.01,value:e.materials.tintOpacity,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintOpacity:an(it(m.target.value,f.materials.tintOpacity),0,1)}}),className:"w-full"})]}),y.jsx("select",{value:e.materials.tintBlend,onChange:m=>n(f=>f&&{...f,materials:{...f.materials,tintBlend:D0(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:x_.map(m=>y.jsx("option",{value:m,children:m},`blend-${m}`))})]}),y.jsxs("section",{className:"space-y-3 pb-8",children:[y.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-emerald-200",children:"Clutter"}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Density"}),y.jsx("input",{type:"number",min:0,max:1,step:.01,value:e.clutter.density,onChange:m=>n(f=>f&&{...f,clutter:{...f.clutter,density:an(it(m.target.value,f.clutter.density),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Max / Hex"}),y.jsx("input",{type:"number",min:0,max:5,step:1,value:e.clutter.maxPerHex,onChange:m=>n(f=>f&&{...f,clutter:{...f.clutter,maxPerHex:Math.max(0,Math.floor(it(m.target.value,f.clutter.maxPerHex)))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),y.jsxs("div",{children:[y.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Bleed Max"}),y.jsx("input",{type:"number",min:1,max:2,step:.01,value:e.clutter.bleedScaleMax,onChange:m=>n(f=>f&&{...f,clutter:{...f.clutter,bleedScaleMax:an(it(m.target.value,f.clutter.bleedScaleMax),1,2)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]})]})]}),Yd="/Hop",U0=/^[a-z0-9]+(?:[._-][a-z0-9]+)*$/,$o=/^\/assets\/[a-z0-9/_\-.]+$/,rf=["ground","decal","prop","unit","fx","ui"],__=["svg","webp","avif","png","jpg","jpeg"],og=["svg","webp","avif","png"],rg=["svg","webp","avif","png","jpg","jpeg"],lg=["svg","webp","avif","png"],cg=["svg"],Kd=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,w_=Kd(Yd,"assets/manifest.json"),Ba=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?Kd(Yd,e.slice(1)):e:Kd(Yd,e),Ns=e=>{if(e)return{...e,default:Ba(e.default),themes:Object.fromEntries(Object.entries(e.themes||{}).map(([n,a])=>[n,Ba(a)]))}},ug=e=>{if(e)return{...e,scale:e.scale??e.mountainScale,offsetX:e.offsetX??e.mountainOffsetX,offsetY:e.offsetY??e.mountainOffsetY,anchorX:e.anchorX??e.mountainAnchorX,anchorY:e.anchorY??e.mountainAnchorY,crustBlendMode:e.crustBlendMode??e.mountainCrustBlendMode,crustBlendOpacity:e.crustBlendOpacity??e.mountainCrustBlendOpacity,tintColor:e.tintColor??e.mountainTintColor,tintBlendMode:e.tintBlendMode??e.mountainTintBlendMode,tintOpacity:e.tintOpacity??e.mountainTintOpacity}},M_=e=>{if(e)return{...e,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([n,a])=>[n,String(a)]))}},Ul=e=>{if(e)return{detailA:Ns(e.detailA),detailB:Ns(e.detailB),tint:M_(e.tint)}},Fd=e=>{if(e)return{...e}},$0=e=>{if(!e)return;const n=ug(e);return{...n,mountainPath:n?.mountainPath?Ba(n.mountainPath):n?.mountainPath,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([a,s])=>[a,{...ug(s),mountainPath:s?.mountainPath?Ba(s.mountainPath):s?.mountainPath}]))}},O_=e=>{if(e)return{...e,biomeLayers:e.biomeLayers?{undercurrent:Ns(e.biomeLayers.undercurrent),crust:Ns(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:Ul(e.biomeMaterials.undercurrent),crust:Ul(e.biomeMaterials.crust)}:void 0,walls:$0(e.walls),assetOverrides:Object.fromEntries(Object.entries(e.assetOverrides||{}).map(([n,a])=>[n,{...a,mountainSettings:Fd(a?.mountainSettings)}]))}},C_=e=>({...e,biomeUnderlay:e.biomeUnderlay?{...e.biomeUnderlay,default:Ba(e.biomeUnderlay.default),themes:Object.fromEntries(Object.entries(e.biomeUnderlay.themes||{}).map(([n,a])=>[n,Ba(a)]))}:void 0,biomeLayers:e.biomeLayers?{undercurrent:Ns(e.biomeLayers.undercurrent),crust:Ns(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:Ul(e.biomeMaterials.undercurrent),crust:Ul(e.biomeMaterials.crust)}:void 0,walls:$0(e.walls),biomePresets:Object.fromEntries(Object.entries(e.biomePresets||{}).map(([n,a])=>[n,O_(a)||{}])),assets:e.assets.map(n=>({...n,path:Ba(n.path),mountainSettings:Fd(n.mountainSettings),mountainSettingsByTheme:Object.fromEntries(Object.entries(n.mountainSettingsByTheme||{}).map(([a,s])=>[a,Fd(s)||{}]))}))}),dg={version:"1.0.0",gridTopology:"flat-top-hex",tileUnitPx:256,tileAspectRatio:1.154700538,layers:[...rf],assets:[]};let fl=null;const fg=e=>typeof e=="string"&&rf.includes(e),mg=e=>typeof e=="string"&&["tile","decal","prop","unit","fx","ui"].includes(e),pg=e=>typeof e=="string"&&__.includes(e),Ha=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if((typeof e.default!="string"||!$o.test(e.default))&&a.push(`"${n}.default" must be a /assets/... path.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${n}.themes" must be an object when provided.`);else for(const[s,r]of Object.entries(e.themes))(typeof s!="string"||s.trim().length===0)&&a.push(`"${n}.themes" contains an invalid theme key.`),(typeof r!="string"||!$o.test(r))&&a.push(`"${n}.themes.${s}" must be a /assets/... path.`);if(e.mode!==void 0&&e.mode!=="off"&&e.mode!=="cover"&&e.mode!=="repeat"&&a.push(`"${n}.mode" must be one of "off", "cover", or "repeat".`),e.scalePx!==void 0&&(!Number.isFinite(e.scalePx)||Number(e.scalePx)<=0)&&a.push(`"${n}.scalePx" must be > 0 when provided.`),e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&a.push(`"${n}.opacity" must be in [0, 1] when provided.`),e.seedShiftPx!==void 0&&(!Number.isFinite(e.seedShiftPx)||Number(e.seedShiftPx)<0)&&a.push(`"${n}.seedShiftPx" must be >= 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&a.push(`"${n}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&a.push(`"${n}.offsetY" must be a finite number when provided.`),e.scroll!==void 0){const s=e.scroll;!s||typeof s!="object"?a.push(`"${n}.scroll" must be an object when provided.`):(s.x!==void 0&&!Number.isFinite(s.x)&&a.push(`"${n}.scroll.x" must be a finite number.`),s.y!==void 0&&!Number.isFinite(s.y)&&a.push(`"${n}.scroll.y" must be a finite number.`),s.durationMs!==void 0&&(!Number.isFinite(s.durationMs)||Number(s.durationMs)<=0)&&a.push(`"${n}.scroll.durationMs" must be > 0 when provided.`))}},N_=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if((typeof e.default!="string"||e.default.trim().length===0)&&a.push(`"${n}.default" must be a non-empty color string.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${n}.themes" must be an object when provided.`);else for(const[s,r]of Object.entries(e.themes))(typeof s!="string"||s.trim().length===0)&&a.push(`"${n}.themes" contains an invalid theme key.`),(typeof r!="string"||r.trim().length===0)&&a.push(`"${n}.themes.${s}" must be a non-empty color string.`);e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&a.push(`"${n}.opacity" must be in [0, 1] when provided.`),e.blendMode!==void 0&&e.blendMode!=="normal"&&e.blendMode!=="multiply"&&e.blendMode!=="overlay"&&e.blendMode!=="soft-light"&&e.blendMode!=="screen"&&e.blendMode!=="color-dodge"&&a.push(`"${n}.blendMode" must be one of "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`)},qo=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}e.scale!==void 0&&(!Number.isFinite(e.scale)||Number(e.scale)<=0)&&a.push(`"${n}.scale" must be > 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&a.push(`"${n}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&a.push(`"${n}.offsetY" must be a finite number when provided.`),e.anchorX!==void 0&&(!Number.isFinite(e.anchorX)||Number(e.anchorX)<0||Number(e.anchorX)>1)&&a.push(`"${n}.anchorX" must be in [0, 1] when provided.`),e.anchorY!==void 0&&(!Number.isFinite(e.anchorY)||Number(e.anchorY)<0||Number(e.anchorY)>1)&&a.push(`"${n}.anchorY" must be in [0, 1] when provided.`),e.crustBlendMode!==void 0&&e.crustBlendMode!=="off"&&e.crustBlendMode!=="normal"&&e.crustBlendMode!=="multiply"&&e.crustBlendMode!=="overlay"&&e.crustBlendMode!=="soft-light"&&e.crustBlendMode!=="screen"&&e.crustBlendMode!=="color-dodge"&&a.push(`"${n}.crustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.tintBlendMode!==void 0&&e.tintBlendMode!=="off"&&e.tintBlendMode!=="normal"&&e.tintBlendMode!=="multiply"&&e.tintBlendMode!=="overlay"&&e.tintBlendMode!=="soft-light"&&e.tintBlendMode!=="screen"&&e.tintBlendMode!=="color-dodge"&&a.push(`"${n}.tintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.crustBlendOpacity!==void 0&&(!Number.isFinite(e.crustBlendOpacity)||Number(e.crustBlendOpacity)<0||Number(e.crustBlendOpacity)>1)&&a.push(`"${n}.crustBlendOpacity" must be in [0, 1] when provided.`),e.tintOpacity!==void 0&&(!Number.isFinite(e.tintOpacity)||Number(e.tintOpacity)<0||Number(e.tintOpacity)>1)&&a.push(`"${n}.tintOpacity" must be in [0, 1] when provided.`),e.tintColor!==void 0&&(typeof e.tintColor!="string"||e.tintColor.trim().length===0)&&a.push(`"${n}.tintColor" must be a non-empty color string when provided.`)},q0=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if(e.mode!==void 0&&e.mode!=="native"&&e.mode!=="additive"&&e.mode!=="custom"&&a.push(`"${n}.mode" must be one of "native", "additive", or "custom".`),e.interiorDensity!==void 0&&(!Number.isFinite(e.interiorDensity)||Number(e.interiorDensity)<0||Number(e.interiorDensity)>1)&&a.push(`"${n}.interiorDensity" must be in [0, 1] when provided.`),e.clusterBias!==void 0&&(!Number.isFinite(e.clusterBias)||Number(e.clusterBias)<0||Number(e.clusterBias)>1)&&a.push(`"${n}.clusterBias" must be in [0, 1] when provided.`),e.keepPerimeter!==void 0&&typeof e.keepPerimeter!="boolean"&&a.push(`"${n}.keepPerimeter" must be a boolean when provided.`),e.mountainPath!==void 0&&(typeof e.mountainPath!="string"||!$o.test(e.mountainPath))&&a.push(`"${n}.mountainPath" must be a /assets/... path when provided.`),e.mountainScale!==void 0&&(!Number.isFinite(e.mountainScale)||Number(e.mountainScale)<=0)&&a.push(`"${n}.mountainScale" must be > 0 when provided.`),e.mountainOffsetX!==void 0&&!Number.isFinite(e.mountainOffsetX)&&a.push(`"${n}.mountainOffsetX" must be a finite number when provided.`),e.mountainOffsetY!==void 0&&!Number.isFinite(e.mountainOffsetY)&&a.push(`"${n}.mountainOffsetY" must be a finite number when provided.`),e.mountainAnchorX!==void 0&&(!Number.isFinite(e.mountainAnchorX)||Number(e.mountainAnchorX)<0||Number(e.mountainAnchorX)>1)&&a.push(`"${n}.mountainAnchorX" must be in [0, 1] when provided.`),e.mountainAnchorY!==void 0&&(!Number.isFinite(e.mountainAnchorY)||Number(e.mountainAnchorY)<0||Number(e.mountainAnchorY)>1)&&a.push(`"${n}.mountainAnchorY" must be in [0, 1] when provided.`),e.mountainCrustBlendMode!==void 0&&e.mountainCrustBlendMode!=="off"&&e.mountainCrustBlendMode!=="normal"&&e.mountainCrustBlendMode!=="multiply"&&e.mountainCrustBlendMode!=="overlay"&&e.mountainCrustBlendMode!=="soft-light"&&e.mountainCrustBlendMode!=="screen"&&e.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${n}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(e.mountainCrustBlendOpacity)||Number(e.mountainCrustBlendOpacity)<0||Number(e.mountainCrustBlendOpacity)>1)&&a.push(`"${n}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),e.mountainTintColor!==void 0&&(typeof e.mountainTintColor!="string"||e.mountainTintColor.trim().length===0)&&a.push(`"${n}.mountainTintColor" must be a non-empty color string when provided.`),e.mountainTintBlendMode!==void 0&&e.mountainTintBlendMode!=="off"&&e.mountainTintBlendMode!=="normal"&&e.mountainTintBlendMode!=="multiply"&&e.mountainTintBlendMode!=="overlay"&&e.mountainTintBlendMode!=="soft-light"&&e.mountainTintBlendMode!=="screen"&&e.mountainTintBlendMode!=="color-dodge"&&a.push(`"${n}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainTintOpacity!==void 0&&(!Number.isFinite(e.mountainTintOpacity)||Number(e.mountainTintOpacity)<0||Number(e.mountainTintOpacity)>1)&&a.push(`"${n}.mountainTintOpacity" must be in [0, 1] when provided.`),qo(e,n,a),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${n}.themes" must be an object when provided.`);else for(const[s,r]of Object.entries(e.themes)){if(typeof s!="string"||s.trim().length===0){a.push(`"${n}.themes" contains an invalid theme key.`);continue}if(!r||typeof r!="object"){a.push(`"${n}.themes.${s}" must be an object.`);continue}r.mountainPath!==void 0&&(typeof r.mountainPath!="string"||!$o.test(r.mountainPath))&&a.push(`"${n}.themes.${s}.mountainPath" must be a /assets/... path when provided.`);const c=r;c.mountainScale!==void 0&&(!Number.isFinite(c.mountainScale)||Number(c.mountainScale)<=0)&&a.push(`"${n}.themes.${s}.mountainScale" must be > 0 when provided.`),c.mountainOffsetX!==void 0&&!Number.isFinite(c.mountainOffsetX)&&a.push(`"${n}.themes.${s}.mountainOffsetX" must be a finite number when provided.`),c.mountainOffsetY!==void 0&&!Number.isFinite(c.mountainOffsetY)&&a.push(`"${n}.themes.${s}.mountainOffsetY" must be a finite number when provided.`),c.mountainAnchorX!==void 0&&(!Number.isFinite(c.mountainAnchorX)||Number(c.mountainAnchorX)<0||Number(c.mountainAnchorX)>1)&&a.push(`"${n}.themes.${s}.mountainAnchorX" must be in [0, 1] when provided.`),c.mountainAnchorY!==void 0&&(!Number.isFinite(c.mountainAnchorY)||Number(c.mountainAnchorY)<0||Number(c.mountainAnchorY)>1)&&a.push(`"${n}.themes.${s}.mountainAnchorY" must be in [0, 1] when provided.`),c.mountainCrustBlendMode!==void 0&&c.mountainCrustBlendMode!=="off"&&c.mountainCrustBlendMode!=="normal"&&c.mountainCrustBlendMode!=="multiply"&&c.mountainCrustBlendMode!=="overlay"&&c.mountainCrustBlendMode!=="soft-light"&&c.mountainCrustBlendMode!=="screen"&&c.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${n}.themes.${s}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),c.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(c.mountainCrustBlendOpacity)||Number(c.mountainCrustBlendOpacity)<0||Number(c.mountainCrustBlendOpacity)>1)&&a.push(`"${n}.themes.${s}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),c.mountainTintBlendMode!==void 0&&c.mountainTintBlendMode!=="off"&&c.mountainTintBlendMode!=="normal"&&c.mountainTintBlendMode!=="multiply"&&c.mountainTintBlendMode!=="overlay"&&c.mountainTintBlendMode!=="soft-light"&&c.mountainTintBlendMode!=="screen"&&c.mountainTintBlendMode!=="color-dodge"&&a.push(`"${n}.themes.${s}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),c.mountainTintOpacity!==void 0&&(!Number.isFinite(c.mountainTintOpacity)||Number(c.mountainTintOpacity)<0||Number(c.mountainTintOpacity)>1)&&a.push(`"${n}.themes.${s}.mountainTintOpacity" must be in [0, 1] when provided.`),c.mountainTintColor!==void 0&&(typeof c.mountainTintColor!="string"||c.mountainTintColor.trim().length===0)&&a.push(`"${n}.themes.${s}.mountainTintColor" must be a non-empty color string when provided.`),qo(r,`${n}.themes.${s}`,a)}},$l=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}e.detailA!==void 0&&Ha(e.detailA,`${n}.detailA`,a),e.detailB!==void 0&&Ha(e.detailB,`${n}.detailB`,a),e.tint!==void 0&&N_(e.tint,`${n}.tint`,a),e.detailA===void 0&&e.detailB===void 0&&e.tint===void 0&&a.push(`"${n}" must define at least one of "detailA", "detailB", or "tint".`)},k_=(e,n,a)=>{if(!e||typeof e!="object"){a.push(`"${n}" must be an object when provided.`);return}if(e.seed!==void 0&&(typeof e.seed!="string"||e.seed.trim().length===0)&&a.push(`"${n}.seed" must be a non-empty string when provided.`),e.injectHazards!==void 0&&typeof e.injectHazards!="boolean"&&a.push(`"${n}.injectHazards" must be a boolean when provided.`),e.biomeLayers!==void 0){const s=e.biomeLayers;if(!s||typeof s!="object")a.push(`"${n}.biomeLayers" must be an object when provided.`);else if(s.undercurrent!==void 0&&Ha(s.undercurrent,`${n}.biomeLayers.undercurrent`,a),s.crust!==void 0&&Ha(s.crust,`${n}.biomeLayers.crust`,a),s.clutter!==void 0){const r=s.clutter;!r||typeof r!="object"?a.push(`"${n}.biomeLayers.clutter" must be an object when provided.`):(r.density!==void 0&&(!Number.isFinite(r.density)||Number(r.density)<0||Number(r.density)>1)&&a.push(`"${n}.biomeLayers.clutter.density" must be in [0, 1] when provided.`),r.maxPerHex!==void 0&&(!Number.isFinite(r.maxPerHex)||Number(r.maxPerHex)<0)&&a.push(`"${n}.biomeLayers.clutter.maxPerHex" must be >= 0 when provided.`),r.bleedScaleMax!==void 0&&(!Number.isFinite(r.bleedScaleMax)||Number(r.bleedScaleMax)<1||Number(r.bleedScaleMax)>2)&&a.push(`"${n}.biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.`),r.tags!==void 0&&(!Array.isArray(r.tags)||!r.tags.every(c=>typeof c=="string"&&c.length>0))&&a.push(`"${n}.biomeLayers.clutter.tags" must be a string array when provided.`))}}if(e.biomeMaterials!==void 0){const s=e.biomeMaterials;!s||typeof s!="object"?a.push(`"${n}.biomeMaterials" must be an object when provided.`):(s.undercurrent!==void 0&&$l(s.undercurrent,`${n}.biomeMaterials.undercurrent`,a),s.crust!==void 0&&$l(s.crust,`${n}.biomeMaterials.crust`,a))}if(e.walls!==void 0&&q0(e.walls,`${n}.walls`,a),e.assetOverrides!==void 0)if(!e.assetOverrides||typeof e.assetOverrides!="object")a.push(`"${n}.assetOverrides" must be an object when provided.`);else for(const[s,r]of Object.entries(e.assetOverrides)){if(!U0.test(s)){a.push(`"${n}.assetOverrides" contains invalid asset id "${s}".`);continue}if(!r||typeof r!="object"){a.push(`"${n}.assetOverrides.${s}" must be an object.`);continue}r.mountainSettings!==void 0&&qo(r.mountainSettings,`${n}.assetOverrides.${s}.mountainSettings`,a)}},R_=e=>{const n=[];if(!e||typeof e!="object")return{valid:!1,errors:["Manifest is not an object."]};const a=e;if((typeof a.version!="string"||a.version.length===0)&&n.push('Missing or invalid "version".'),a.gridTopology!=="flat-top-hex"&&n.push('Only "flat-top-hex" gridTopology is supported.'),(!Number.isFinite(a.tileUnitPx)||Number(a.tileUnitPx)<=0)&&n.push('Missing or invalid "tileUnitPx".'),(!Number.isFinite(a.tileAspectRatio)||Number(a.tileAspectRatio)<=0)&&n.push('Missing or invalid "tileAspectRatio".'),a.biomeUnderlay!==void 0&&Ha(a.biomeUnderlay,"biomeUnderlay",n),a.biomeLayers!==void 0){const r=a.biomeLayers;if(!r||typeof r!="object")n.push('"biomeLayers" must be an object when provided.');else if(r.undercurrent!==void 0&&Ha(r.undercurrent,"biomeLayers.undercurrent",n),r.crust!==void 0&&Ha(r.crust,"biomeLayers.crust",n),!r.undercurrent&&!r.crust&&n.push('"biomeLayers" must define at least one of "undercurrent" or "crust".'),r.clutter!==void 0){const c=r.clutter;!c||typeof c!="object"?n.push('"biomeLayers.clutter" must be an object when provided.'):(c.density!==void 0&&(!Number.isFinite(c.density)||Number(c.density)<0||Number(c.density)>1)&&n.push('"biomeLayers.clutter.density" must be in [0, 1] when provided.'),c.maxPerHex!==void 0&&(!Number.isFinite(c.maxPerHex)||Number(c.maxPerHex)<0)&&n.push('"biomeLayers.clutter.maxPerHex" must be >= 0 when provided.'),c.bleedScaleMax!==void 0&&(!Number.isFinite(c.bleedScaleMax)||Number(c.bleedScaleMax)<1||Number(c.bleedScaleMax)>2)&&n.push('"biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.'),c.tags!==void 0&&(!Array.isArray(c.tags)||!c.tags.every(u=>typeof u=="string"&&u.length>0))&&n.push('"biomeLayers.clutter.tags" must be a string array when provided.'))}}if(a.biomeMaterials!==void 0){const r=a.biomeMaterials;!r||typeof r!="object"?n.push('"biomeMaterials" must be an object when provided.'):(r.undercurrent!==void 0&&$l(r.undercurrent,"biomeMaterials.undercurrent",n),r.crust!==void 0&&$l(r.crust,"biomeMaterials.crust",n),r.undercurrent===void 0&&r.crust===void 0&&n.push('"biomeMaterials" must define at least one of "undercurrent" or "crust".'))}if(a.walls!==void 0&&q0(a.walls,"walls",n),a.biomePresets!==void 0)if(!a.biomePresets||typeof a.biomePresets!="object")n.push('"biomePresets" must be an object when provided.');else for(const[r,c]of Object.entries(a.biomePresets)){if(typeof r!="string"||r.trim().length===0){n.push('"biomePresets" contains an invalid theme key.');continue}k_(c,`biomePresets.${r}`,n)}if(!Array.isArray(a.layers)||a.layers.length===0||!a.layers.every(fg))n.push('Missing or invalid "layers".');else for(const r of rf)a.layers.includes(r)||n.push(`Missing required layer "${r}" in "layers".`);if(!Array.isArray(a.assets))return n.push('Missing or invalid "assets".'),{valid:n.length===0,errors:n};const s=new Set;for(const[r,c]of a.assets.entries()){const u=`assets[${r}]`;if(!c||typeof c!="object"){n.push(`${u} is not an object.`);continue}const p=c;if(typeof p.id!="string"||!U0.test(p.id)?n.push(`${u}.id is invalid; expected lowercase tokenized id.`):s.has(p.id)?n.push(`${u}.id is duplicated (${p.id}).`):s.add(p.id),mg(p.type)||n.push(`${u}.type is invalid.`),fg(p.layer)||n.push(`${u}.layer is invalid.`),pg(p.recommendedFormat)||n.push(`${u}.recommendedFormat is invalid.`),mg(p.type)&&pg(p.recommendedFormat)&&((p.type==="tile"||p.type==="decal"||p.type==="prop")&&!rg.includes(p.recommendedFormat)&&n.push(`${u}.recommendedFormat must be one of ${rg.join(", ")} for ${p.type}.`),p.type==="ui"&&!cg.includes(p.recommendedFormat)&&n.push(`${u}.recommendedFormat must be one of ${cg.join(", ")} for ui.`),p.type==="unit"&&!og.includes(p.recommendedFormat)&&n.push(`${u}.recommendedFormat must be one of ${og.join(", ")} for units.`),p.type==="fx"&&!lg.includes(p.recommendedFormat)&&n.push(`${u}.recommendedFormat must be one of ${lg.join(", ")} for fx.`)),(typeof p.path!="string"||!$o.test(p.path))&&n.push(`${u}.path is invalid; expected /assets/...`),(!Number.isFinite(p.width)||Number(p.width)<=0)&&n.push(`${u}.width must be > 0.`),(!Number.isFinite(p.height)||Number(p.height)<=0)&&n.push(`${u}.height must be > 0.`),p.mountainSettings!==void 0&&qo(p.mountainSettings,`${u}.mountainSettings`,n),p.mountainSettingsByTheme!==void 0)if(!p.mountainSettingsByTheme||typeof p.mountainSettingsByTheme!="object")n.push(`${u}.mountainSettingsByTheme must be an object when provided.`);else for(const[g,m]of Object.entries(p.mountainSettingsByTheme)){if(typeof g!="string"||g.trim().length===0){n.push(`${u}.mountainSettingsByTheme contains an invalid theme key.`);continue}qo(m,`${u}.mountainSettingsByTheme.${g}`,n)}}return{valid:n.length===0,errors:n}},I_=async()=>fl||(fl=fetch(w_).then(async e=>{if(!e.ok)throw new Error(`Asset manifest fetch failed: ${e.status}`);return e.json()}).then(e=>{const n=R_(e);return n.valid?C_(e):(console.warn("[HOP_ASSETS] Invalid manifest; using fallback.",n.errors),dg)}).catch(e=>(console.warn("[HOP_ASSETS] Failed to load manifest; using fallback.",e),dg)),fl),lf=(e,n)=>{if(!e)return;const a=String(n||"").toLowerCase();if(a)return e.biomePresets?.[a]},hg="/Hop",L_=64,B_=192,yg=64,gg=512,vt=(e,n,a)=>Math.min(a,Math.max(n,e)),bg=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,No=e=>{const n=e.trim();return!n||/^(?:[a-z]+:)?\/\//i.test(n)||n.startsWith("data:")?n:n.startsWith("/")?n.startsWith("/assets/")?bg(hg,n.slice(1)):n:bg(hg,n)},vg=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,u,p]=a.slice(1).split("");return`#${c}${c}${u}${u}${p}${p}`.toLowerCase()}return n},z0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",ml=e=>e==="off"?"off":z0(e),H_=(e,n,a)=>{if(!e||!n)return null;const s=No(n.undercurrent.path),r=No(n.crust.path),c=No(n.materials.detailA.path),u=No(n.materials.detailB.path),p=lf(e,a),g=p?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,m=p?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),f=p?.biomeMaterials?.crust??e.biomeMaterials?.crust,b=g||s?{...g||{default:s||r||""},default:s||g?.default||"",themes:{...g?.themes||{},[a]:s||g?.default||""},mode:n.undercurrent.mode,scalePx:vt(n.undercurrent.scalePx,L_,B_),opacity:vt(n.undercurrent.opacity,0,1),offsetX:n.undercurrent.offsetX,offsetY:n.undercurrent.offsetY,scroll:{x:n.undercurrent.scrollX,y:n.undercurrent.scrollY,durationMs:Math.max(1e3,n.undercurrent.scrollDurationMs)}}:void 0,S=m||r?{...m||{default:r||s||""},default:r||m?.default||"",themes:{...m?.themes||{},[a]:r||m?.default||""},mode:n.crust.mode,scalePx:Math.max(64,n.crust.scalePx),opacity:1,seedShiftPx:Math.max(0,n.crust.seedShiftPx),offsetX:n.crust.offsetX,offsetY:n.crust.offsetY}:void 0,T=c||f?.detailA?.default||"",v={...f?.detailA?.themes||{}};T&&(v[a]=T);const A=T?{...f?.detailA||{default:T},default:T,themes:v,mode:n.materials.detailA.mode,scalePx:vt(n.materials.detailA.scalePx,yg,gg),opacity:vt(n.materials.detailA.opacity,0,1)}:void 0,_=u||f?.detailB?.default||"",E={...f?.detailB?.themes||{}};_&&(E[a]=_);const w=_?{...f?.detailB||{default:_},default:_,themes:E,mode:n.materials.detailB.mode,scalePx:vt(n.materials.detailB.scalePx,yg,gg),opacity:vt(n.materials.detailB.opacity,0,1)}:void 0,M=String(n.materials.tintColor||"").trim()||f?.tint?.default||"#8b6f4a",C={...f?.tint?.themes||{}};C[a]=M;const L={...f?.tint||{default:M},default:M,themes:C,opacity:vt(n.materials.tintOpacity,0,1),blendMode:z0(n.materials.tintBlend)},k=A||w||L?{...f||{},detailA:A,detailB:w,tint:L}:void 0,R=No(n.walls.mountainPath),H=p?.walls,D={...H||e.walls?.themes?.[a]||{},mountainPath:R,scale:vt(n.walls.mountainScale,.2,3),offsetX:n.walls.mountainOffsetX,offsetY:n.walls.mountainOffsetY,anchorX:vt(n.walls.mountainAnchorX,0,1),anchorY:vt(n.walls.mountainAnchorY,0,1),crustBlendMode:ml(n.walls.mountainCrustBlendMode),crustBlendOpacity:vt(n.walls.mountainCrustBlendOpacity,0,1),tintColor:vg(n.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:ml(n.walls.mountainTintBlendMode),tintOpacity:vt(n.walls.mountainTintOpacity,0,1),mountainScale:vt(n.walls.mountainScale,.2,3),mountainOffsetX:n.walls.mountainOffsetX,mountainOffsetY:n.walls.mountainOffsetY,mountainAnchorX:vt(n.walls.mountainAnchorX,0,1),mountainAnchorY:vt(n.walls.mountainAnchorY,0,1),mountainCrustBlendMode:ml(n.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:vt(n.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:vg(n.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:ml(n.walls.mountainTintBlendMode),mountainTintOpacity:vt(n.walls.mountainTintOpacity,0,1)},$={...e.walls||{},...H||{},mode:n.walls.mode,interiorDensity:vt(n.walls.interiorDensity,0,.45),clusterBias:vt(n.walls.clusterBias,0,1),keepPerimeter:!!n.walls.keepPerimeter,mountainPath:R,scale:D.scale,offsetX:D.offsetX,offsetY:D.offsetY,anchorX:D.anchorX,anchorY:D.anchorY,crustBlendMode:D.crustBlendMode,crustBlendOpacity:D.crustBlendOpacity,tintColor:D.tintColor,tintBlendMode:D.tintBlendMode,tintOpacity:D.tintOpacity,mountainScale:D.mountainScale,mountainOffsetX:D.mountainOffsetX,mountainOffsetY:D.mountainOffsetY,mountainAnchorX:D.mountainAnchorX,mountainAnchorY:D.mountainAnchorY,mountainCrustBlendMode:D.mountainCrustBlendMode,mountainCrustBlendOpacity:D.mountainCrustBlendOpacity,mountainTintColor:D.mountainTintColor,mountainTintBlendMode:D.mountainTintBlendMode,mountainTintOpacity:D.mountainTintOpacity,themes:{...e.walls?.themes||{},[a]:D}},J={...p?.biomeLayers||{},undercurrent:b,crust:S,clutter:{...p?.biomeLayers?.clutter||e.biomeLayers?.clutter||{},density:vt(n.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(n.clutter.maxPerHex)),bleedScaleMax:vt(n.clutter.bleedScaleMax,1,2)}},te={...p?.biomeMaterials||{},crust:k},ae={...p||{},seed:n.seed.trim()||"biome-sandbox-seed",injectHazards:n.injectHazards,biomeLayers:J,biomeMaterials:te,walls:$};return{...e,biomeLayers:{...e.biomeLayers||{},undercurrent:b,crust:S,clutter:{...e.biomeLayers?.clutter||{},density:vt(n.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(n.clutter.maxPerHex)),bleedScaleMax:vt(n.clutter.bleedScaleMax,1,2)}},biomeMaterials:{...e.biomeMaterials||{},crust:k},walls:$,biomePresets:{...e.biomePresets||{},[a]:ae}}},P_=({presets:e,activePreset:n,onSelectPreset:a,onResetView:s})=>y.jsx("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 z-30 flex items-center gap-1.5 pointer-events-auto",children:y.jsxs("div",{className:"flex items-center gap-1 rounded-xl border border-white/15 bg-black/35 backdrop-blur-sm p-1",children:[e.map(r=>{const c=n===r;return y.jsx("button",{type:"button",onPointerDown:u=>u.stopPropagation(),onClick:()=>a(r),className:`px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest transition-colors ${c?"bg-white text-black":"bg-white/5 text-white/70 hover:bg-white/10"}`,"aria-label":`Set zoom to ${r} tiles wide`,children:r},`zoom-${r}`)}),y.jsx("button",{type:"button",onPointerDown:r=>r.stopPropagation(),onClick:s,className:"px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-white/5 text-white/70 hover:bg-white/10","aria-label":"Reset camera to player",children:"Fit"})]})}),j_=({boardProps:e})=>y.jsx("g",{"data-layer":"ui-objective-markers",pointerEvents:"none",children:e.map(n=>{const{x:a,y:s}=Ee(n.position,Q),r=n.kind==="shrine",c=r?"#c2410c":"#15803d",u=r?"S":"E",p=a+Q*.52,g=s-Q*.52;return y.jsxs("g",{transform:`translate(${p},${g})`,children:[y.jsx("circle",{r:14,fill:"none",stroke:"rgba(255,255,255,0.55)",strokeWidth:2,style:{animation:`shrineGlow ${r?1.6:1.9}s ease-in-out infinite`}}),y.jsx("circle",{r:10.5,fill:c,stroke:"#ffffff",strokeWidth:2}),y.jsx("text",{x:0,y:0,textAnchor:"middle",dy:".34em",fill:"#ffffff",fontSize:10,fontWeight:900,style:{textShadow:"0 1px 2px rgba(0,0,0,0.7)"},children:u})]},`marker-${n.id}`)})}),D_={catacombs:.2,inferno:.16,throne:.24,frozen:.45,void:.08},U_=(e,n)=>{const a=Math.max(e,n),s=Math.min(e,n);return(a+.05)/(s+.05)},$_=(e,n,a=24,s,r,c=1)=>{const u=Uo(e.subtype,e.type,e.enemyType,e.archetype),{icon:p,shape:g,color:m,borderColor:f,size:b=1}=u,S=a*b,T=e.statusEffects?.find(E=>E.type==="time_bomb"),v=T?Math.max(0,T.duration):e.actionCooldown??0,A=`contrast(${c.toFixed(2)}) brightness(${(c>1?1.12:1.04).toFixed(2)})`,_=n?`drop-shadow(0 3px 4px rgba(0,0,0,0.45)) drop-shadow(0 0 2px rgba(255,255,255,0.5)) saturate(1.08) ${A}`:`drop-shadow(0 3px 4px rgba(0,0,0,0.50)) drop-shadow(0 0 2px rgba(255,255,255,0.35)) saturate(1.0) ${A}`;return y.jsxs("g",{children:[y.jsx("title",{children:n?"Player":`${e.subtype||"Enemy"}`}),s&&y.jsx("image",{href:s,x:-S,y:-S,width:S*2,height:S*2,preserveAspectRatio:"xMidYMid meet",onError:r,style:{filter:_,opacity:n?1:.97}}),!s&&g==="square"&&y.jsx("rect",{x:-S*.8,y:-S*.8,width:S*1.6,height:S*1.6,fill:m,stroke:f,strokeWidth:2}),!s&&g==="diamond"&&y.jsx("path",{d:`M0 ${-S*.8} L${S*.6} 0 L0 ${S*.8} L${-S*.6} 0 Z`,fill:m,stroke:f,strokeWidth:1}),!s&&g==="triangle"&&y.jsx("path",{d:`M0 ${-S*.8} L${S*.7} ${S*.5} L${-S*.7} ${S*.5} Z`,fill:m,stroke:f,strokeWidth:1}),!s&&g==="circle"&&y.jsx("circle",{r:S*.7,fill:m,stroke:f,strokeWidth:1}),e.subtype==="bomb"&&y.jsx("text",{y:S*.2,textAnchor:"middle",fill:"#fff",fontSize:"10",fontWeight:"bold",children:v}),!s&&!n&&e.subtype!=="bomb"&&y.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:S*.8,opacity:.8,children:p}),!s&&n&&y.jsx("path",{d:`M0 ${-S*.4} L0 ${S*.4} M${-S*.15} ${-S*.2} L0 ${-S*.5} L${S*.15} ${-S*.2}`,stroke:f,strokeWidth:2,fill:"none"})]})},q_=({entity:e,isSpear:n,isDying:a,movementTrace:s,waapiControlled:r=!1,assetHref:c,fallbackAssetHref:u,floorTheme:p,visualPose:g})=>{const[m,f]=N.useState(e.position),[b,S]=N.useState(()=>Ee(e.position,Q)),[T,v]=N.useState(e.previousPosition),[A,_]=N.useState(220),[E,w]=N.useState("cubic-bezier(0.22, 1, 0.36, 1)"),[M,C]=N.useState("none"),L=N.useRef(!1),k=N.useRef(e.position),R=N.useRef([]),H=N.useRef(null),[D,$]=N.useState(!1),J=N.useRef(e.hp),te=e.type==="player",ae=typeof window<"u"&&!!window.__HOP_DEBUG_MOVEMENT,[W,q]=N.useState(c||u),[P,z]=N.useState(!1);N.useEffect(()=>{q(c||u),z(!1)},[c,u,e.id]);const X=()=>{if(!P&&u&&W!==u){q(u),z(!0);return}q(void 0)};N.useEffect(()=>{const jt=()=>{for(const Ot of R.current)clearTimeout(Ot);R.current=[],H.current!==null&&(cancelAnimationFrame(H.current),H.current=null)};if(r){jt(),L.current=!1;const Ot=!!(s&&s.actorId===e.id&&s.destination&&ee(s.destination,e.position)),Ft=!ee(e.position,k.current);k.current=e.position,Ft&&!Ot&&(f(e.position),v(e.previousPosition),S(Ee(e.position,Q))),M!=="none"&&C("none"),A!==0&&_(0),E!=="linear"&&w("linear");return}if(!ee(e.position,k.current)){k.current=e.position;const Ot=s&&s.actorId===e.id&&s.destination&&ee(s.destination,e.position)&&Array.isArray(s.path)&&s.path.length>0,Ft=Ot?s.path:void 0,Jn=Ot?s.movementType:void 0,yn=Ot?Math.max(0,s.startDelayMs??0):0;if(ae){const ln=e.previousPosition?dt(e.previousPosition,e.position).length:0;console.log("[HOP_MOVE]",{actorId:e.id,movementType:Jn||"fallback",usedEngineTrace:Ot,tracePathLength:Ft?.length||0,tracePath:Ft||[],startDelayMs:yn,fallbackPathLength:ln,origin:s?.origin||e.previousPosition,destination:e.position})}if(Jn==="teleport"&&Ot&&s.origin){jt(),L.current=!0;const ln=s.durationMs??180,De=Math.max(80,Math.floor(ln/2)),Ze=()=>{_(0),w("linear"),v(s.origin),f(s.origin),S(Ee(s.origin,Q)),C("out");const at=window.setTimeout(()=>{f(e.position),v(e.position),S(Ee(e.position,Q)),C("in")},De),wn=window.setTimeout(()=>{C("none"),L.current=!1},De*2);R.current.push(at,wn)};if(yn>0){const at=window.setTimeout(Ze,yn);R.current.push(at)}else Ze();return()=>{jt(),L.current=!1}}const ma=!!(e.previousPosition&&!ee(e.position,e.previousPosition));if(!!(Ft&&Ft.length>1)||ma){let De=Ft||(e.previousPosition?dt(e.previousPosition,e.position):[]);if(Ot&&s?.origin&&De.length>1&&ee(De[De.length-1],s.origin)&&!ee(De[0],s.origin)&&(De=[...De].reverse()),De.length>1){jt(),L.current=!0;const Ze=Math.max(1,De.length-1),at=s?.durationMs?s.durationMs/Ze:0,wn=Math.max(90,Math.min(130,at||112)),Te=wn*Ze,Re=De.map(xt=>Ee(xt,Q)),Ge=performance.now(),ot=xt=>xt<.5?4*xt*xt*xt:1-Math.pow(-2*xt+2,3)/2;C("none"),_(0),w("linear"),f(De[0]),v(De[0]),S(Re[0]);let rt=-1;const Dt=xt=>{const gn=Math.max(0,xt-Ge),bn=Math.min(Ze-1,Math.floor(gn/wn)),li=bn*wn,Qn=gn-li,Dn=Math.max(0,Math.min(1,Qn/wn)),Ct=ot(Dn);bn!==rt&&(v(De[bn]),f(De[Math.min(De.length-1,bn+1)]),rt=bn);const ft=Re[bn],tn=Re[Math.min(Re.length-1,bn+1)];if(S({x:ft.x+(tn.x-ft.x)*Ct,y:ft.y+(tn.y-ft.y)*Ct}),gn<Te){H.current=requestAnimationFrame(Dt);return}L.current=!1,f(e.position),v(e.previousPosition),S(Re[Re.length-1]),H.current=null};if(yn>0){const xt=window.setTimeout(()=>{H.current=requestAnimationFrame(Dt)},yn);R.current.push(xt)}else H.current=requestAnimationFrame(Dt);return()=>{jt(),L.current=!1}}}C("none"),_(220),w("cubic-bezier(0.22, 1, 0.36, 1)"),f(e.position),v(e.previousPosition),S(Ee(e.position,Q))}},[e.position,e.previousPosition,s,e.id,r]);const{x:le,y:fe}=b||Ee(m,Q);N.useEffect(()=>{if(e.hp<J.current){$(!0);const jt=setTimeout(()=>$(!1),150);return()=>clearTimeout(jt)}J.current=e.hp},[e.hp]);let I="";const K=T;if(K&&!ee(m,K)){const jt=Wn(K,m);if(jt!==-1){const Ot=jt*60;I=`rotate(${Ot}) scale(1.15, 0.85) rotate(${-Ot})`}}const G=e.isVisible===!1;if(n){const jt=Uo("spear","enemy");return y.jsx("g",{style:{pointerEvents:"none"},children:y.jsx("g",{transform:`translate(${le},${fe})`,children:y.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:"20",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5))"},children:jt.icon})})})}const ne=Uo(e.subtype,e.type,e.enemyType,e.archetype),re=v_(e),ce=te?1.34:.92,pe=te?-9:-2,ke=te?24:18,Se=String(p||"").toLowerCase(),_e=D_[Se]??.22,$e=U_(_e,te?.87:.82)<4.5?1.22:1.06,Ae=te?"#22e7ff":"rgba(255,120,120,0.7)",qe=te?"rgba(34,231,255,0.20)":"rgba(239,68,68,0.16)",gt=te?"rgba(34,231,255,0.36)":"rgba(255,90,90,0.28)",bt=te?Q*.48:Q*.42,Yt=te?Q*.17:Q*.145,en=te?Q*.32:Q*.3,Kt=g?.offsetX??0,Xn=g?.offsetY??0,Ii=g?.scaleX??1,ri=g?.scaleY??1,fa=Math.abs(Kt)>.01||Math.abs(Xn)>.01||Math.abs(Ii-1)>.01||Math.abs(ri-1)>.01?`translate(${Kt},${Xn}) scale(${Ii},${ri})`:void 0;return y.jsx("g",{style:{pointerEvents:"none"},children:y.jsx("g",{"data-actor-node":e.id,style:{transition:r?"none":`transform ${A}ms ${E}`,transform:`translate(${le}px, ${fe}px)`},className:a?"animate-lava-sink":"",children:y.jsx("g",{transform:fa,children:y.jsxs("g",{transform:I,className:`${D?"entity-damaged":""} ${!a&&!si(e)?"animate-idle":""} ${M==="out"?"entity-teleport-out":""} ${M==="in"?"entity-teleport-in":""}`,opacity:G?.3:ne.opacity||1,style:{filter:G?"blur(1px)":"none"},children:[y.jsxs("g",{transform:`translate(0,${en})`,children:[y.jsx("ellipse",{cx:0,cy:0,rx:bt,ry:Yt,fill:qe,stroke:Ae,strokeWidth:2,opacity:.95,style:{filter:`drop-shadow(0 0 5px ${gt})`}}),y.jsx("ellipse",{cx:0,cy:0,rx:bt*1.14,ry:Yt*1.14,fill:"none",stroke:Ae,strokeWidth:te?1.8:1.6,opacity:te?.62:.54})]}),re&&y.jsx("ellipse",{cx:0,cy:Q*.3,rx:Q*.4,ry:Q*.15,fill:"black",opacity:.2}),y.jsx("g",{transform:`translate(0,${pe}) scale(${ce})`,children:$_(e,te,ke,W,X,$e)}),si(e)&&y.jsxs("g",{transform:`translate(0, -${Q*.8})`,className:"stun-icon",children:[y.jsx("text",{fontSize:"14",textAnchor:"middle",children:"*"}),y.jsx("text",{fontSize:"8",textAnchor:"middle",dy:"-3",dx:"6",children:"+"})]}),ne.showFacing&&e.facing!==void 0&&!si(e)&&y.jsx("line",{x1:0,y1:0,x2:Math.cos((e.facing*60-90)*Math.PI/180)*Q*.5,y2:Math.sin((e.facing*60-90)*Math.PI/180)*Q*.5,stroke:ne.borderColor,strokeWidth:3,strokeLinecap:"round"}),y.jsx("title",{children:`${e.subtype||e.type} - HP ${e.hp}/${e.maxHp}${e.intent?` - ${e.intent}`:""}`})]})})})})},Sg=e=>{if(!e)return"";const n=(e.path||[]).map(a=>`${a.q},${a.r},${a.s}`).join(";");return`${e.actorId}|${e.movementType||""}|${e.destination?.q??""},${e.destination?.r??""},${e.destination?.s??""}|${n}|${e.durationMs??""}|${e.startDelayMs??0}|${e.wasLethal?1:0}`},xg=(e=[])=>e.map(n=>`${n.id}:${n.duration??""}:${n.stacks??""}`).join("|"),pl=Vn.memo(q_,(e,n)=>{const a=e.entity,s=n.entity;return e.isSpear===n.isSpear&&e.isDying===n.isDying&&e.waapiControlled===n.waapiControlled&&e.assetHref===n.assetHref&&e.fallbackAssetHref===n.fallbackAssetHref&&e.floorTheme===n.floorTheme&&(e.visualPose?.offsetX??0)===(n.visualPose?.offsetX??0)&&(e.visualPose?.offsetY??0)===(n.visualPose?.offsetY??0)&&(e.visualPose?.scaleX??1)===(n.visualPose?.scaleX??1)&&(e.visualPose?.scaleY??1)===(n.visualPose?.scaleY??1)&&Sg(e.movementTrace)===Sg(n.movementTrace)&&a.id===s.id&&a.hp===s.hp&&a.maxHp===s.maxHp&&a.facing===s.facing&&a.intent===s.intent&&a.isVisible===s.isVisible&&a.position.q===s.position.q&&a.position.r===s.position.r&&a.position.s===s.position.s&&(a.previousPosition?.q??0)===(s.previousPosition?.q??0)&&(a.previousPosition?.r??0)===(s.previousPosition?.r??0)&&(a.previousPosition?.s??0)===(s.previousPosition?.s??0)&&(a.intentPosition?.q??0)===(s.intentPosition?.q??0)&&(a.intentPosition?.r??0)===(s.intentPosition?.r??0)&&(a.intentPosition?.s??0)===(s.intentPosition?.s??0)&&xg(a.statusEffects)===xg(s.statusEffects)}),z_=["white","blue","black","red","green"],Ag={white:{label:"Plains / Mesa",floorAssetId:"tile.catacombs.floor.01",hazardAssetId:"tile.catacombs.lava.01"},blue:{label:"Islands / Coast",floorAssetId:"tile.frozen.floor.01",hazardAssetId:"tile.catacombs.lava.01"},black:{label:"Swamp / Wastes",floorAssetId:"tile.void.floor.01",hazardAssetId:"tile.catacombs.lava.01"},red:{label:"Mountains / Volcanic",floorAssetId:"tile.inferno.floor.01",hazardAssetId:"tile.inferno.lava.01"},green:{label:"Forest / Jungle",floorAssetId:"tile.throne.floor.01",hazardAssetId:"tile.catacombs.lava.01"}},V_={catacombs:"white",frozen:"blue",void:"black",inferno:"red",throne:"green"},Y_=e=>{if(typeof e!="string")return;const n=e.toLowerCase();return z_.includes(n)?n:void 0},K_=()=>{if(!(typeof window>"u"))return Y_(window.__HOP_FORCE_BIOME)},F_=e=>{const n=K_();if(n)return n;const a=String(e||"").toLowerCase();return V_[a]||"white"},W_=e=>{const n=F_(e.theme);return e.isWall?"tile.catacombs.wall.01":e.isLava?Ag[n].hazardAssetId:e.isFire?"tile.catacombs.fire.01":Ag[n].floorAssetId},Tg=e=>{if(e.isStairs)return"prop.core.stairs.01";if(e.isShrine)return"prop.core.shrine.01"},la=e=>{if(e.type==="player")switch(e.archetype){case"FIREMAGE":return"unit.player.firemage.04";case"SKIRMISHER":return"unit.player.skirmisher.01";case"HUNTER":return"unit.player.hunter.01";case"NECROMANCER":return"unit.player.necromancer.01";case"ASSASSIN":return"unit.player.assassin.01";default:return"unit.player.vanguard.01"}switch(e.subtype){case"footman":return"unit.enemy.footman.01";case"shield_bearer":return"unit.enemy.shield_bearer.01";case"archer":return"unit.enemy.archer.01";case"warlock":return"unit.enemy.warlock.01";case"bomber":return"unit.enemy.bomber.01";case"bomb":return"unit.enemy.bomb.01";default:return e.enemyType==="boss"?"unit.enemy.boss.01":"unit.enemy.footman.01"}},Eg="/Hop",_g=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,G_=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?_g(Eg,e.slice(1)):e:_g(Eg,e),X_={"unit.player.vanguard.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.firemage.04":"/assets/units/unit.player.firemage.02.svg","unit.player.skirmisher.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.hunter.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.necromancer.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.assassin.01":"/assets/units/unit.player.skirmisher.01.svg","unit.enemy.footman.01":"/assets/units/unit.enemy.footman.01.svg","unit.enemy.shield_bearer.01":"/assets/units/unit.enemy.shield_bearer.01.svg","unit.enemy.archer.01":"/assets/units/unit.enemy.archer.01.svg","unit.enemy.warlock.01":"/assets/units/unit.enemy.warlock.01.svg","unit.enemy.bomber.01":"/assets/units/unit.enemy.bomber.01.svg","unit.enemy.bomb.01":"/assets/units/unit.enemy.bomb.01.svg","unit.enemy.boss.01":"/assets/units/unit.enemy.boss.01.svg"},Ia=e=>{const n=la(e),a=X_[n];return a?G_(a):void 0},J_=e=>{if(e==="impact")return"fx.core.impact.01";if(e==="vaporize")return"fx.core.vaporize.01";if(e==="lava_ripple")return"fx.core.lava_ripple.01";if(e==="explosion_ring")return"fx.core.explosion_ring.01"},Q_=()=>"ui.core.hp_frame.01",Z_=()=>"decal.combat.blood.01",ew=new Set(["impact","flash","combat_text","spear_trail","vaporize","lava_ripple","explosion_ring"]),tw=({effects:e,assetById:n})=>{const a=n.get(Q_())?.path;return y.jsx("g",{style:{pointerEvents:"none"},children:e.map(s=>{if(Date.now()<s.startTime||!s.position&&!s.worldPosition)return null;const c=s.position?Ee(s.position,Q):{x:0,y:0},u=s.worldPosition?.x??c.x,p=s.worldPosition?.y??c.y,g=ew.has(s.type)?J_(s.type):void 0,m=g?n.get(g)?.path:void 0;if(s.type==="basic_attack_strike"){const f=s.payload||{},b=f.source,S=f.target,T=String(f.phase||"impact");if(!b||!S)return null;const v=Ee(b,Q),A=f.contactWorld&&typeof f.contactWorld.x=="number"&&typeof f.contactWorld.y=="number"?f.contactWorld:{x:u,y:p},_=A.x-v.x,E=A.y-v.y,w=Math.max(1,Math.hypot(_,E)),M=_/w,C=E/w,L=String(f.intensity||"medium"),k=Math.max(120,Math.min(360,Number(s.ttlMs||180))),R=`${Math.round(k*.85)}ms`,H=L==="extreme"?Q*.34:L==="high"?Q*.28:Q*.22;if(T!=="impact")return null;const D=L==="extreme"?"rgba(253,224,71,0.98)":L==="high"?"rgba(255,255,255,0.96)":"rgba(226,232,240,0.95)",$=L==="extreme"?"rgba(251,191,36,0.9)":"rgba(255,255,255,0.92)";return y.jsx("g",{children:y.jsxs("g",{className:"juice-basic-strike-spark",style:{animationDuration:R},children:[y.jsx("circle",{cx:A.x,cy:A.y,r:H*1.65,fill:"rgba(255,255,255,0.16)",stroke:"rgba(255,255,255,0.55)",strokeWidth:1.4}),y.jsx("circle",{cx:A.x,cy:A.y,r:H*.62,fill:$}),y.jsx("circle",{cx:A.x,cy:A.y,r:H*1.2,fill:"none",stroke:D,strokeWidth:2.4}),y.jsx("path",{d:`M ${A.x-M*H*1.6} ${A.y-C*H*1.6} L ${A.x+M*H*1.6} ${A.y+C*H*1.6}`,stroke:D,strokeWidth:2.1,strokeLinecap:"round"}),y.jsx("path",{d:`M ${A.x-C*H*1.35} ${A.y+M*H*1.35} L ${A.x+C*H*1.35} ${A.y-M*H*1.35}`,stroke:"rgba(255,255,255,0.9)",strokeWidth:1.8,strokeLinecap:"round"})]})},s.id)}if(s.type==="archer_shot_signature"){const f=s.payload||{},b=f.source,S=f.target,T=String(f.phase||"travel");if(!b||!S)return null;const v=Ee(b,Q),A=Ee(S,Q),_=f.contactWorld&&typeof f.contactWorld.x=="number"&&typeof f.contactWorld.y=="number"?f.contactWorld:{x:u,y:p},E=T==="impact"?_:A,w=E.x-v.x,M=E.y-v.y,C=Math.max(1,Math.hypot(w,M)),L=w/C,k=M/C,R=String(f.intensity||"medium");if(T==="anticipation")return y.jsxs("g",{className:"animate-arrow-shot",opacity:.95,children:[y.jsx("line",{x1:v.x,y1:v.y,x2:A.x,y2:A.y,stroke:"rgba(248,113,113,0.75)",strokeWidth:1.5,strokeDasharray:"4 5",strokeLinecap:"round"}),y.jsx("circle",{cx:A.x,cy:A.y,r:Q*.18,fill:"none",stroke:"rgba(254,202,202,0.9)",strokeWidth:1.5})]},s.id);if(T==="travel"){const D=Math.min(C*.22,Q*.75),$=E.x-L*D,J=E.y-k*D,te=7.5,ae=E.x-L*te-k*(te*.52),W=E.y-k*te+L*(te*.52),q=E.x-L*te+k*(te*.52),P=E.y-k*te-L*(te*.52);return y.jsxs("g",{className:"animate-arrow-shot",children:[y.jsx("line",{x1:v.x,y1:v.y,x2:E.x,y2:E.y,stroke:"rgba(180,83,9,0.38)",strokeWidth:3.2,strokeLinecap:"round",strokeDasharray:"8 9"}),y.jsx("line",{x1:$,y1:J,x2:E.x,y2:E.y,stroke:"rgba(254,240,138,0.98)",strokeWidth:2.2,strokeLinecap:"round"}),y.jsx("path",{d:`M ${E.x} ${E.y} L ${ae} ${W} M ${E.x} ${E.y} L ${q} ${P}`,stroke:"rgba(255,251,235,0.98)",strokeWidth:1.9,strokeLinecap:"round"}),y.jsx("circle",{cx:v.x,cy:v.y,r:Q*.08,fill:"rgba(251,191,36,0.55)"})]},s.id)}const H=R==="extreme"||R==="high"?Q*.24:Q*.19;return y.jsxs("g",{className:"animate-impact",children:[y.jsx("circle",{cx:_.x,cy:_.y,r:H*1.35,fill:"rgba(251,191,36,0.14)",stroke:"rgba(254,243,199,0.72)",strokeWidth:1.4}),y.jsx("line",{x1:_.x-L*H*1.6,y1:_.y-k*H*1.6,x2:_.x+L*H*1.25,y2:_.y+k*H*1.25,stroke:"rgba(255,251,235,0.95)",strokeWidth:2,strokeLinecap:"round"}),y.jsx("path",{d:`M ${_.x+L*H*1.2} ${_.y+k*H*1.2} L ${_.x+L*H*1.75-k*H*.45} ${_.y+k*H*1.75+L*H*.45} M ${_.x+L*H*1.2} ${_.y+k*H*1.2} L ${_.x+L*H*1.75+k*H*.45} ${_.y+k*H*1.75-L*H*.45}`,stroke:"rgba(254,240,138,0.9)",strokeWidth:1.5,strokeLinecap:"round"})]},s.id)}if(s.type==="melee_lunge"||s.type==="arrow_shot"||s.type==="arcane_bolt"||s.type==="generic_line"){const f=s.payload?.source;if(!f)return null;const b=Ee(f,Q),S=u-b.x,T=p-b.y,v=Math.max(1,Math.hypot(S,T)),A=S/v,_=T/v,E=u-A*Math.min(v*.18,14),w=p-_*Math.min(v*.18,14),M=s.type==="arrow_shot"?7:5,C=u-A*M-_*(M*.55),L=p-_*M+A*(M*.55),k=u-A*M+_*(M*.55),R=p-_*M-A*(M*.55);if(s.type==="melee_lunge")return y.jsxs("g",{className:"animate-melee-lunge",children:[y.jsx("line",{x1:b.x,y1:b.y,x2:E,y2:w,stroke:"rgba(255,255,255,0.35)",strokeWidth:5,strokeLinecap:"round"}),y.jsx("line",{x1:E,y1:w,x2:u,y2:p,stroke:"rgba(255,255,255,0.85)",strokeWidth:3,strokeLinecap:"round"})]},s.id);if(s.type==="arrow_shot"||s.type==="generic_line"){const H=s.type==="generic_line"?"rgba(255,255,255,0.85)":"rgba(253,230,138,0.9)",D=s.type==="generic_line"?"rgba(255,255,255,0.9)":"rgba(254,243,199,0.95)";return y.jsxs("g",{className:s.type==="generic_line"?"animate-melee-lunge":"animate-arrow-shot",children:[y.jsx("line",{x1:b.x,y1:b.y,x2:u,y2:p,stroke:H,strokeWidth:s.type==="generic_line"?2:2.5,strokeLinecap:"round",strokeDasharray:s.type==="generic_line"?"6 6":"10 8"}),y.jsx("path",{d:`M ${u} ${p} L ${C} ${L} M ${u} ${p} L ${k} ${R}`,stroke:D,strokeWidth:2,strokeLinecap:"round"})]},s.id)}return y.jsxs("g",{className:"animate-arcane-bolt",children:[y.jsx("line",{x1:b.x,y1:b.y,x2:u,y2:p,stroke:"rgba(34,211,238,0.92)",strokeWidth:4,strokeLinecap:"round",strokeDasharray:"12 10"}),y.jsx("line",{x1:b.x,y1:b.y,x2:u,y2:p,stroke:"rgba(207,250,254,0.85)",strokeWidth:1.8,strokeLinecap:"round"}),y.jsx("circle",{cx:u,cy:p,r:Q*.22,fill:"rgba(34,211,238,0.35)"})]},s.id)}if(s.type==="kinetic_wave"||s.type==="generic_ring"){const f=s.type==="kinetic_wave"?"rgba(125,211,252,0.9)":"rgba(255,255,255,0.7)",b=s.type==="kinetic_wave"?"rgba(56,189,248,0.14)":"rgba(255,255,255,0.08)";return y.jsx("g",{className:"animate-explosion-ring",children:y.jsx("circle",{cx:u,cy:p,r:Q*(s.type==="kinetic_wave"?1.5:1.1),fill:b,stroke:f,strokeWidth:s.type==="kinetic_wave"?3:2,strokeDasharray:s.type==="kinetic_wave"?"10 6":"6 4"})},s.id)}if(s.type==="wall_crack"){const f=s.payload||{},b=f.source,S=f.target,T=b&&S?Math.atan2(Ee(S,Q).y-Ee(b,Q).y,Ee(S,Q).x-Ee(b,Q).x):0,v=Q*.32,A=T+Math.PI/2,_=u-Math.cos(T)*v,E=p-Math.sin(T)*v,w=u+Math.cos(T)*v,M=p+Math.sin(T)*v;return y.jsxs("g",{className:"animate-impact",children:[y.jsx("line",{x1:_,y1:E,x2:w,y2:M,stroke:"rgba(255,255,255,0.95)",strokeWidth:2.2,strokeLinecap:"round"}),y.jsx("line",{x1:u-Math.cos(A)*v*.8,y1:p-Math.sin(A)*v*.8,x2:u+Math.cos(A)*v*.8,y2:p+Math.sin(A)*v*.8,stroke:"rgba(147,197,253,0.9)",strokeWidth:1.7,strokeLinecap:"round"}),y.jsx("circle",{cx:u,cy:p,r:3.5,fill:"rgba(255,255,255,0.9)"})]},s.id)}if(s.type==="dash_blur"){const f=s.payload?.path;if(!f||f.length<2)return null;const b=f.map(S=>{const T=Ee(S,Q);return`${T.x},${T.y}`}).join(" ");return y.jsx("polyline",{points:b,fill:"none",stroke:"rgba(255,255,255,0.4)",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-arrow-shot",opacity:.6},s.id)}if(s.type==="hidden_fade")return y.jsxs("g",{className:"animate-flash",children:[y.jsx("circle",{cx:u,cy:p,r:Q*.78,fill:"rgba(168,85,247,0.16)",stroke:"rgba(196,181,253,0.75)",strokeWidth:2}),y.jsx("circle",{cx:u,cy:p,r:Q*.34,fill:"rgba(30,27,75,0.35)"})]},s.id);if(s.type==="impact")return m?y.jsx("image",{href:m,x:u-Q*.75,y:p-Q*.75,width:Q*1.5,height:Q*1.5,preserveAspectRatio:"xMidYMid meet",className:"animate-impact",opacity:"0.9"},s.id):y.jsx("circle",{cx:u,cy:p,r:Q*.5,fill:"none",stroke:"#ffffff",strokeWidth:"2",className:"animate-impact"},s.id);if(s.type==="combat_text"){const f=String(s.payload.text||""),b=s.payload.color||(f.startsWith("-")?"#fb7185":"#86efac");return y.jsxs("g",{transform:`translate(${u}, ${p-10})`,children:[a&&y.jsx("image",{href:a,x:-46,y:-24,width:92,height:24,preserveAspectRatio:"xMidYMid meet",opacity:"0.78"}),y.jsx("text",{textAnchor:"middle",fill:b,fontSize:"16",fontWeight:"black",className:"animate-float-up",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.8))",paintOrder:"stroke",stroke:"#000",strokeWidth:"4px"},children:f})]},s.id)}if(s.type==="flash")return y.jsx("circle",{cx:u,cy:p,r:Q*2,fill:"#ffffff",className:"animate-flash"},s.id);if(s.type==="spear_trail"){const b=s.payload.path.map(S=>{const T=Ee(S,Q);return`${T.x},${T.y}`}).join(" ");return y.jsx("polyline",{points:b,fill:"none",stroke:"#ffffff",strokeWidth:"4",strokeLinecap:"round",className:"animate-spear-trail"},s.id)}return s.type==="vaporize"?m?y.jsx("image",{href:m,x:u-Q*.95,y:p-Q*.95,width:Q*1.9,height:Q*1.9,preserveAspectRatio:"xMidYMid meet",className:"animate-vaporize",opacity:"0.9"},s.id):y.jsxs("g",{children:[y.jsx("circle",{cx:u,cy:p,r:Q*.6,fill:"#f97316",className:"animate-vaporize",opacity:"0.8"}),y.jsx("circle",{cx:u,cy:p,r:Q*1.2,fill:"none",stroke:"#f97316",strokeWidth:"2",className:"animate-ping"})]},s.id):s.type==="lava_ripple"?m?y.jsx("image",{href:m,x:u-Q,y:p-Q,width:Q*2,height:Q*2,preserveAspectRatio:"xMidYMid meet",className:"animate-ping",opacity:"0.85"},s.id):y.jsx("circle",{cx:u,cy:p,r:Q*.8,fill:"none",stroke:"#ea580c",strokeWidth:"3",className:"animate-ping"},s.id):s.type==="explosion_ring"?m?y.jsx("image",{href:m,x:u-Q*1.35,y:p-Q*1.35,width:Q*2.7,height:Q*2.7,preserveAspectRatio:"xMidYMid meet",className:"animate-explosion-ring",opacity:"0.88"},s.id):y.jsx("circle",{cx:u,cy:p,r:Q*2.5,fill:"rgba(255, 120, 0, 0.2)",stroke:"#ffaa00",strokeWidth:"4",className:"animate-explosion-ring"},s.id):null})})},nw={"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|anticipation":{rendererId:"basic_attack_strike",ttlMs:130},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|travel":{rendererId:"basic_attack_strike",ttlMs:110},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|impact":{rendererId:"basic_attack_strike",ttlMs:180},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|aftermath":{rendererId:"basic_attack_strike",ttlMs:190},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|anticipation":{rendererId:"basic_attack_strike",ttlMs:100},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|travel":{rendererId:"basic_attack_strike",ttlMs:90},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|impact":{rendererId:"basic_attack_strike",ttlMs:140},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|aftermath":{rendererId:"basic_attack_strike",ttlMs:120},"ATK.SHOOT.PHYSICAL.ARROW|anticipation":{rendererId:"archer_shot_signature",ttlMs:110},"ATK.SHOOT.PHYSICAL.ARROW|travel":{rendererId:"archer_shot_signature",ttlMs:160,skipIfLegacyMirrored:!0},"ATK.SHOOT.PHYSICAL.ARROW|impact":{rendererId:"archer_shot_signature",ttlMs:150}},iw={"ATK.STRIKE.PHYSICAL.IMPACT":{rendererId:"impact",ttlMs:420,skipIfLegacyMirrored:!0},"ATK.STRIKE.PHYSICAL.HEAVY":{rendererId:"melee_lunge",ttlMs:280},"ATK.STRIKE.PHYSICAL.LIGHT":{rendererId:"impact",ttlMs:380},"ATK.SHOOT.PHYSICAL.SPEAR_TRAIL":{rendererId:"spear_trail",ttlMs:520,skipIfLegacyMirrored:!0},"ATK.SHOOT.PHYSICAL.SPEAR_RETURN":{rendererId:"spear_trail",ttlMs:520},"ATK.BLAST.FIRE.EXPLOSION_RING":{rendererId:"explosion_ring",ttlMs:980},"ATK.BLAST.FIRE.TIME_BOMB":{rendererId:"explosion_ring",ttlMs:980},"ATK.BLAST.FIRE.FIREBALL_IMPACT":{rendererId:"explosion_ring",ttlMs:740},"ATK.BLAST.VOID.CORPSE_EXPLOSION":{rendererId:"generic_ring",ttlMs:840},"ENV.HAZARD.FIRE.LAVA_RIPPLE":{rendererId:"lava_ripple",ttlMs:820},"ENV.COLLISION.KINETIC.WALL_CRACK":{rendererId:"wall_crack",ttlMs:700},"ENV.COLLISION.KINETIC.IMPACT":{rendererId:"wall_crack",ttlMs:520},"ATK.PULSE.KINETIC.WAVE":{rendererId:"kinetic_wave",ttlMs:540},"MOVE.DASH.NEUTRAL.BLUR":{rendererId:"dash_blur",ttlMs:320},"MOVE.DASH.NEUTRAL.SWIFT_ROLL":{rendererId:"dash_blur",ttlMs:320},"MOVE.DASH.KINETIC.MOMENTUM_TRAIL":{rendererId:"dash_blur",ttlMs:360},"STATE.FADE.SHADOW.HIDDEN":{rendererId:"hidden_fade",ttlMs:360},"STATE.FADE.SHADOW.SMOKE_SCREEN":{rendererId:"hidden_fade",ttlMs:420},"MOVE.BLINK.SHADOW.SHADOW_STEP":{rendererId:"hidden_fade",ttlMs:380},"MOVE.BLINK.ARCANE.SOUL_SWAP_ARRIVE":{rendererId:"flash",ttlMs:280},"MOVE.BLINK.ARCANE.SOUL_SWAP_DEPART":{rendererId:"flash",ttlMs:280},"STATE.APPLY.NEUTRAL.STUN_BURST":{rendererId:"generic_ring",ttlMs:560},"UI.TEXT.NEUTRAL.POPUP":{rendererId:"combat_text",ttlMs:1100},"UI.SHAKE.NEUTRAL.CAMERA":{rendererId:"none",ttlMs:1,skipIfLegacyMirrored:!0},"UI.FREEZE.NEUTRAL.HITSTOP":{rendererId:"none",ttlMs:1}},aw={"attack|shoot|physical|travel":{rendererId:"arrow_shot",ttlMs:320},"attack|shoot|arcane|travel":{rendererId:"arcane_bolt",ttlMs:340},"attack|shoot|fire|travel":{rendererId:"arcane_bolt",ttlMs:340},"attack|strike|physical|impact":{rendererId:"melee_lunge",ttlMs:260},"attack|blast|fire|impact":{rendererId:"explosion_ring",ttlMs:900},"attack|pulse|kinetic|impact":{rendererId:"kinetic_wave",ttlMs:520},"environment|collision|kinetic|impact":{rendererId:"wall_crack",ttlMs:700},"status|state_fade|shadow|instant":{rendererId:"hidden_fade",ttlMs:360},"ui|text|neutral|instant":{rendererId:"combat_text",ttlMs:1e3}},sw={"attack|blast|impact":{rendererId:"generic_ring",ttlMs:680},"attack|shoot|travel":{rendererId:"generic_line",ttlMs:300},"attack|strike|impact":{rendererId:"impact",ttlMs:400},"environment|hazard_burst|impact":{rendererId:"generic_ring",ttlMs:760},"status|status_apply|impact":{rendererId:"flash",ttlMs:320},"ui|text|instant":{rendererId:"combat_text",ttlMs:1e3}},ow={"movement|dash":{rendererId:"dash_blur",ttlMs:300},"movement|blink":{rendererId:"flash",ttlMs:260},"attack|pulse":{rendererId:"kinetic_wave",ttlMs:500},"attack|blast":{rendererId:"generic_ring",ttlMs:700},"attack|shoot":{rendererId:"generic_line",ttlMs:280},"attack|strike":{rendererId:"impact",ttlMs:380},"environment|collision":{rendererId:"wall_crack",ttlMs:650},"ui|text":{rendererId:"combat_text",ttlMs:1e3}},rw=new Set(["impact","flash","spearTrail","shake"]),lw=e=>{const n=`${e.signature}|${e.phase}`,a=nw[n];if(a)return{key:`sigp:${n}`,recipe:a};const s=iw[e.signature];if(s)return{key:`sig:${e.signature}`,recipe:s};const r=`${e.family}|${e.primitive}|${e.element||"neutral"}|${e.phase}`,c=aw[r];if(c)return{key:`fpel:${r}`,recipe:c};const u=`${e.family}|${e.primitive}|${e.phase}`,p=sw[u];if(p)return{key:`fpp:${u}`,recipe:p};const g=`${e.family}|${e.primitive}`,m=ow[g];return m?{key:`fp:${g}`,recipe:m}:{key:"fallback:none",recipe:{rendererId:"none",ttlMs:1}}},cw=({payload:e,reducedMotion:n})=>{const{key:a,recipe:s}=lw(e);if(s.skipIfLegacyMirrored&&e.meta?.legacyMirrored&&e.meta?.legacyJuiceId&&rw.has(String(e.meta.legacyJuiceId)))return null;let r=Math.max(1,Number(e.timing?.ttlMs??e.timing?.durationMs??s.ttlMs));return n&&(r=Math.max(1,Math.floor(r*.7))),{key:a,ttlMs:r,recipe:s,payload:e}},wd=e=>{const n=e?.hex;if(n&&typeof n.q=="number"&&typeof n.r=="number"&&typeof n.s=="number")return n},Md=e=>{const n=e?.world;if(n&&typeof n.x=="number"&&typeof n.y=="number")return n},uw=({incoming:e,now:n,reducedMotion:a,recentSignatureImpactByTile:s})=>{const r=[];return e.forEach((c,u)=>{if(c.type!=="juice_signature")return;const p=c.payload;if(!p||p.protocol!=="juice-signature/v1")return;const g=cw({payload:p,reducedMotion:a});if(!g||g.recipe.rendererId==="none")return;const m=wd(p.contact),f=wd(p.target),b=wd(p.source),S=Md(p.contact),T=Md(p.target),v=Md(p.source),A=m||f||b,_=S||T||v,E={id:`sig-${n}-${u}`,startTime:n+Math.max(0,Number(p.timing?.delayMs||0)),ttlMs:g.ttlMs};if((p.signature==="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"||p.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK")&&p.phase==="impact"&&f){const M=ue(f);s.set(M,{at:n,signature:p.signature})}const w=p.text?.value;switch(g.recipe.rendererId){case"basic_attack_strike":{if(!b||!f)return;r.push({...E,type:"basic_attack_strike",position:f,worldPosition:S||_,payload:{phase:p.phase,intensity:p.intensity||"medium",signature:p.signature,source:b,target:f,sourceActorId:p.source?.actorId,targetActorId:p.target?.actorId,contactWorld:S,contactHex:m,direction:p.direction,flags:p.flags||{}}});return}case"archer_shot_signature":{const M=f||m;if(!b||!M)return;r.push({...E,type:"archer_shot_signature",position:M,worldPosition:S||_,payload:{phase:p.phase,intensity:p.intensity||"medium",source:b,target:M,contactWorld:S,path:p.path||(p.area?.kind==="path"?p.area.points:void 0),signature:p.signature}});return}case"impact":case"flash":case"lava_ripple":case"explosion_ring":case"kinetic_wave":case"wall_crack":case"hidden_fade":case"generic_ring":{if(!A&&!_)return;r.push({...E,type:g.recipe.rendererId,position:A,worldPosition:_,payload:{signature:p.signature,color:p.text?.color,element:p.element,variant:p.variant,source:b,target:f}});return}case"combat_text":{if(!w||!A&&!_)return;r.push({...E,type:"combat_text",position:A,worldPosition:_,payload:{text:w,color:p.text?.color}});return}case"spear_trail":{if((!p.path||p.path.length===0)&&p.area?.kind!=="path")return;const M=p.path||(p.area?.kind==="path"?p.area.points:[]);if(!M||M.length===0)return;r.push({...E,type:"spear_trail",position:M[0],payload:{path:M}});return}case"melee_lunge":case"arrow_shot":case"arcane_bolt":case"generic_line":{const M=f||m;if(!M||!b)return;r.push({...E,type:g.recipe.rendererId,position:M,payload:{source:b,signature:p.signature,element:p.element}});return}case"dash_blur":{const M=p.path||(p.area?.kind==="path"?p.area.points:void 0);if(!M||M.length<2)return;r.push({...E,type:"dash_blur",position:M[M.length-1],payload:{path:M,source:M[0]}});return}default:return}}),r},dw=({incoming:e,now:n})=>{const a=[];return e.forEach((s,r)=>{const c=`juice-${n}-${r}`;s.type==="vfx"&&s.payload?.type==="impact"?s.payload.position&&a.push({id:c,type:"impact",position:s.payload.position,startTime:n}):s.type==="vfx"&&s.payload?.type==="flash"?s.payload.position&&a.push({id:c,type:"flash",position:s.payload.position,startTime:n}):s.type==="vfx"&&s.payload?.type==="spear_trail"?s.payload.path&&s.payload.path.length>0&&a.push({id:c,type:"spear_trail",position:s.payload.path[0],payload:s.payload,startTime:n}):s.type==="vfx"&&s.payload?.type==="vaporize"?s.payload.position&&a.push({id:c,type:"vaporize",position:s.payload.position,startTime:n}):s.type==="vfx"&&s.payload?.type==="lava_ripple"?s.payload.position&&a.push({id:c,type:"lava_ripple",position:s.payload.position,startTime:n}):s.type==="vfx"&&s.payload?.type==="explosion_ring"&&s.payload.position&&a.push({id:c,type:"explosion_ring",position:s.payload.position,startTime:n})}),a},fw=({incoming:e,now:n,startIndex:a,actorById:s,recentSignatureImpactByTile:r,classifyDamageCueType:c})=>{const u=[];return e.forEach((p,g)=>{if(p.type!=="DamageTaken"||!p.position)return;const m=p.position,f=String(p.payload?.sourceId||""),b=f?s.get(f):void 0,S=String(p.payload?.reason||""),T=r.get(ue(m)),v=T?.signature==="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"||T?.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK",A=!!(T&&v&&n-T.at<=260),_=S.includes("basic_attack")||S.includes("auto_attack");if(b?.position){const E=Ee(b.position,Q),w=Ee(m,Q),M=Math.hypot(w.x-E.x,w.y-E.y),C=A&&_?null:c(b.subtype,S,M);C&&u.push({id:`sim-cue-${n}-${a+g}`,type:C,position:m,payload:{source:b.position,sourceSubtype:b.subtype,reason:S},startTime:n})}A&&_||u.push({id:`sim-impact-${n}-${a+g}`,type:"impact",position:m,startTime:n})}),u},mw=e=>new Promise(n=>setTimeout(n,e)),pw=e=>{if(!e)return null;const n=e.position||e.destination||e.origin||e.target;return n&&typeof n.q=="number"&&typeof n.r=="number"&&typeof n.s=="number"?n:null},wg=e=>{if(e.ttlMs&&e.ttlMs>0)return e.ttlMs;const n=e.type;return n==="basic_attack_strike"?180:n==="archer_shot_signature"?170:n==="impact"?400:n==="combat_text"?1e3:n==="flash"?300:n==="melee_lunge"?240:n==="arrow_shot"?260:n==="arcane_bolt"?320:n==="kinetic_wave"?520:n==="wall_crack"?700:n==="dash_blur"?320:n==="hidden_fade"?360:n==="generic_ring"?700:n==="generic_line"?280:n==="spear_trail"?500:n==="vaporize"?600:n==="lava_ripple"?800:n==="explosion_ring"?1e3:2e3},Mg=.72,hw=(e,n,a)=>{const s=String(e||"").toLowerCase(),r=String(n||"").toLowerCase();return r.includes("lava")||r.includes("fire")||r.includes("hazard")||r.includes("burn")||r.includes("crush")||r.includes("collision")||s==="bomber"||r.includes("bomb")||r.includes("explosion")?null:s==="warlock"||r.includes("arcane")||r.includes("force")||r.includes("spell")?"arcane_bolt":s==="archer"||r.includes("arrow")||r.includes("spear_throw")?"arrow_shot":a<=Q*2.05||r.includes("basic_attack")||r.includes("melee")?"melee_lunge":null},Og=650,yw=3500,gw=({visualEvents:e,timelineEvents:n,simulationEvents:a,actorSnapshots:s,onBusyStateChange:r})=>{const[c,u]=N.useState([]),p=N.useRef(null),g=N.useRef(null),m=N.useRef(null),f=N.useRef(0),b=N.useRef([]),S=N.useRef(!1),[T,v]=N.useState(!1),A=N.useRef(!1),_=N.useRef(new Map),E=N.useRef(null),w=N.useRef(Date.now()),M=N.useRef(new Map),C=N.useMemo(()=>{const k=new Map;for(const R of s)k.set(R.id,R);return k},[s]);N.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const k=window.matchMedia("(prefers-reduced-motion: reduce)"),R=()=>{A.current=k.matches};return R(),k.addEventListener?.("change",R),()=>k.removeEventListener?.("change",R)},[]),N.useEffect(()=>{if(!e.length)return;const k=new Map(_.current),R=Date.now();for(const H of e){if(H.type!=="kinetic_trace")continue;const D=H.payload;if(!D?.actorId)continue;const $=Number(D.durationMs??0);$>0&&k.set(String(D.actorId),{durationMs:$,seenAt:R})}_.current=k},[e]),N.useEffect(()=>{r?.(T)},[T,r]);const L=k=>{const R=Date.now(),H=pw(k.payload);if(!H)return;const D=[],$=`${k.id}:${R}`;k.phase==="HAZARD_CHECK"?D.push({id:`${$}:haz`,type:"combat_text",position:H,payload:{text:"!"},startTime:R}):k.phase==="DEATH_RESOLVE"&&D.push({id:`${$}:vapor`,type:"vaporize",position:H,startTime:R}),D.length>0&&u(J=>[...J,...D])};return N.useEffect(()=>{if(!n.length||p.current===n)return;p.current=n;const k=n;k.length&&(b.current.push(...k),!S.current&&(S.current=!0,v(!0),(async()=>{try{const R=Date.now();for(;b.current.length>0;){if(Date.now()-R>yw){console.warn("[HOP_JUICE] Timeline queue exceeded runtime budget; flushing remaining events.",{queued:b.current.length});break}const H=b.current.shift();L(H);let D=H.blocking?Math.round((H.suggestedDurationMs??140)*Mg):0;if(H.phase==="MOVE_END"){const ae=H.payload?.targetActorId;if(ae){const W=_.current.get(ae),q=W?Date.now()-W.seenAt<=2500:!1;W&&q&&W.durationMs>0&&(D=Math.max(D,Math.min(Og,Math.round(W.durationMs*Mg))))}}let $=0;H.phase==="MOVE_END"?$=Math.min(460,Math.max(70,D)):H.phase==="DEATH_RESOLVE"?$=Math.min(120,Math.max(55,D)):H.phase==="DAMAGE_APPLY"?$=Math.min(80,Math.max(35,D)):H.phase==="HAZARD_CHECK"?$=Math.min(70,Math.max(30,D)):H.blocking&&($=Math.min(70,Math.max(0,D)));const J=H.phase==="MOVE_END"?D:A.current?Math.min(70,Math.floor($*.5)):$,te=Math.max(0,Math.min(Og,J));te>0&&await mw(te)}}catch(R){console.error("[HOP_JUICE] Timeline queue processing failed; releasing busy lock.",R)}finally{b.current=[],S.current=!1,v(!1)}})()))},[n]),N.useEffect(()=>{if(m.current===e)return;m.current=e;const k=e;if(!k.length)return;const R=Date.now(),H=uw({incoming:k,now:R,reducedMotion:A.current,recentSignatureImpactByTile:M.current});H.length>0&&u(D=>[...D,...H])},[e]),N.useEffect(()=>{if(n.length>0){g.current=e;return}if(g.current===e)return;g.current=e;const k=e;if(!k.length)return;const R=Date.now(),H=dw({incoming:k,now:R});H.length>0&&u(D=>[...D,...H])},[e,n.length]),N.useEffect(()=>{a.length<f.current&&(f.current=0);const k=f.current;if(k>=a.length)return;const R=a.slice(k);f.current=a.length;const H=Date.now(),D=fw({incoming:R,now:H,startIndex:k,actorById:C,recentSignatureImpactByTile:M.current,classifyDamageCueType:hw});D.length>0&&u($=>[...$,...D])},[a,C]),N.useEffect(()=>{if(E.current!==null&&(window.clearTimeout(E.current),E.current=null),c.length===0)return;const k=Date.now();let R=1/0;for(const D of c){if(D.startTime>k){const te=D.startTime-k;te>0&&te<R&&(R=te);continue}const $=k-D.startTime,J=wg(D)-$;J>0&&J<R&&(R=J)}if(!Number.isFinite(R)){u([]);return}const H=Math.max(16,Math.min(180,Math.floor(R)));return E.current=window.setTimeout(()=>{const D=Date.now();u($=>{const J=w.current;w.current=D;const te=$.filter(W=>D<W.startTime+wg(W));return te.length!==$.length?te:$.some(W=>J<W.startTime&&W.startTime<=D)?[...$]:$})},H),()=>{E.current!==null&&(window.clearTimeout(E.current),E.current=null)}},[c]),c},bw=({visualEvents:e,timelineEvents:n=[],simulationEvents:a=[],actorSnapshots:s=[],onBusyStateChange:r,assetManifest:c})=>{const u=N.useMemo(()=>{const g=new Map;for(const m of c?.assets||[])g.set(m.id,m);return g},[c]),p=gw({visualEvents:e,timelineEvents:n,simulationEvents:a,actorSnapshots:s,onBusyStateChange:r});return y.jsx(tw,{effects:p,assetById:u})},vw=({gameState:e,latestTraceByActor:n,entityVisualPoseById:a,assetById:s,biomeThemeKey:r,juiceActorSnapshots:c,assetManifest:u,onJuiceBusyStateChange:p})=>y.jsxs("g",{children:[e.lastSpearPath&&e.lastSpearPath.length>=2&&(()=>{const m=e.lastSpearPath.map(f=>Ee(f,Q)).map((f,b)=>`${b===0?"M":"L"} ${f.x} ${f.y}`).join(" ");return y.jsx("path",{d:m,stroke:"rgba(255, 255, 255, 0.15)",strokeWidth:"2",fill:"none",strokeDasharray:"4 2",strokeLinecap:"round"})})(),e.spearPosition&&y.jsx(pl,{entity:{id:"spear",type:"player",subtype:"footman",position:e.spearPosition,hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],speed:0,factionId:"player"},isSpear:!0}),y.jsx(pl,{entity:e.player,movementTrace:n[e.player.id],waapiControlled:!0,visualPose:a.get(e.player.id),assetHref:s.get(la(e.player))?.path,fallbackAssetHref:Ia(e.player),floorTheme:r},`player-${e.floor}`),e.enemies.map(g=>y.jsx(pl,{entity:g,movementTrace:n[g.id],waapiControlled:!0,visualPose:a.get(g.id),assetHref:s.get(la(g))?.path,fallbackAssetHref:Ia(g),floorTheme:r},`${g.id}-${e.floor}`)),e.dyingEntities?.map(g=>y.jsx(pl,{entity:g,isDying:!0,movementTrace:n[g.id],waapiControlled:!0,visualPose:a.get(g.id),assetHref:s.get(la(g))?.path,fallbackAssetHref:Ia(g),floorTheme:r},`dying-${g.id}-${e.floor}-${e.turnNumber}`)),y.jsx(bw,{visualEvents:e.visualEvents||[],timelineEvents:e.timelineEvents||[],simulationEvents:e.simulationEvents||[],actorSnapshots:c,onBusyStateChange:p,assetManifest:u},`juice-${e.floor}`)]}),Od=e=>{const n=[];for(let a=0;a<6;a++){const s=60*a,r=Math.PI/180*s,c=e*Math.cos(r),u=e*Math.sin(r);n.push(`${c},${u}`)}return n.join(" ")},Sw=()=>typeof window>"u"?!1:!!window.__HOP_DEBUG_HEX_COORDS,xw=[{cx:-8,cy:-6,r:3,delay:0},{cx:6,cy:2,r:2.5,delay:.3},{cx:-3,cy:8,r:2,delay:.6}],Aw=e=>{const n=[[-.6,.42],[-.5,.15],[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2],[.48,.1],[.6,.4],[.4,.48],[-.48,.48]],a=[[-.48,.48],[-.6,.42],[-.34,-.18],[-.18,-.24],[-.28,.28]],s=[[.6,.4],[.4,.48],[.2,.28],[.3,-.2],[.48,.1]],r=[[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2]],c=[[-.46,.1],[-.3,-.12],[-.1,-.24],[0,-.4]],u=p=>p.map(([g,m])=>`${(g*e).toFixed(2)},${(m*e).toFixed(2)}`).join(" ");return{body:u(n),leftFace:u(a),rightFace:u(s),ridgeA:u(r),ridgeB:u(c)}},Tw=({hex:e,onClick:n,isValidMove:a,isTargeted:s,isStairs:r,isLava:c,isShrine:u,isWall:p,isFire:g,onMouseEnter:m,assetHref:f,interactionOnly:b})=>{const[S,T]=N.useState(!1);N.useEffect(()=>{T(!1)},[f]);const{x:v,y:A}=Ee(e,Q),_=Sw(),E=Od(Q-2),w=Aw(Q-2),M=`hex-clip-${e.q}-${e.r}-${e.s}`;let C=tl.floor,L="rgba(0,0,0,0.2)",k="default";p?(C=tl.wall,L="#1f2937"):c?(C="#7f1d1d",L="#7f1d1d"):g?(C="#7c2d12",L="#ea580c"):r?(C=tl.portal,L="#000000"):u&&(C=tl.shrine,L="#c2410c"),b&&(C="transparent",L="rgba(255,255,255,0.10)"),a&&(L="rgba(255,255,255,0.78)",k="pointer"),s&&(L="#f97316");const R=!!f&&!b&&!S;return y.jsxs("g",{transform:`translate(${v},${A})`,onClick:()=>n(e),onMouseEnter:()=>m?.(e),style:{cursor:k},className:"hex-tile transition-colors duration-200",children:[p&&R&&y.jsx("polygon",{points:Od(Q-2),fill:"#111827",transform:"translate(0, 4)"}),!R&&(p?y.jsxs("g",{"data-wall-fallback":"relief",children:[y.jsx("ellipse",{cx:"0",cy:Q*.56,rx:Q*.56,ry:Q*.18,fill:"rgba(3,7,18,0.55)"}),y.jsx("polygon",{points:E,fill:"#0f172a",transform:"translate(0, 5)",opacity:"0.92"}),y.jsx("polygon",{points:E,fill:"#1f2937",transform:"translate(0, 2)",opacity:"0.98"}),y.jsx("polygon",{points:E,fill:"#273447"}),y.jsx("polygon",{points:w.body,fill:"#4b5563",opacity:"0.96"}),y.jsx("polygon",{points:w.leftFace,fill:"#6b7280",opacity:"0.9"}),y.jsx("polygon",{points:w.rightFace,fill:"#374151",opacity:"0.95"}),y.jsx("polyline",{points:w.ridgeA,fill:"none",stroke:"rgba(229,231,235,0.55)",strokeWidth:"1.1",strokeLinecap:"round",strokeLinejoin:"round"}),y.jsx("polyline",{points:w.ridgeB,fill:"none",stroke:"rgba(17,24,39,0.58)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"}),y.jsx("polygon",{points:E,fill:"none",stroke:L,strokeWidth:s||a?"2":"1"})]}):y.jsx("polygon",{points:E,fill:C,stroke:L,strokeWidth:s||a?"2":"1"})),R&&y.jsxs(y.Fragment,{children:[y.jsx("defs",{children:y.jsx("clipPath",{id:M,children:y.jsx("polygon",{points:E})})}),y.jsx("image",{href:f,x:-Q,y:-31.176,width:Q*2,height:Q*1.732,preserveAspectRatio:"xMidYMid slice",clipPath:`url(#${M})`,onError:()=>T(!0)}),y.jsx("polygon",{points:E,fill:"none",stroke:L,strokeWidth:s||a?"2":"1"})]}),c&&!b&&y.jsxs("g",{className:"lava-bubbles",children:[xw.map((H,D)=>y.jsx("circle",{cx:H.cx,cy:H.cy,r:H.r,fill:"#fbbf24",opacity:"0.7",style:{animation:`lavaBubble 2s ease-in-out ${H.delay}s infinite`}},D)),y.jsx("polygon",{points:Od(Q-4),fill:"none",stroke:"#f97316",strokeWidth:"1",opacity:"0.35"})]}),g&&!b&&y.jsxs("g",{className:"fire-embers",children:[y.jsx("circle",{cx:"-6",cy:"4",r:"2",fill:"#fbbf24",opacity:"0.75",style:{animation:"lavaBubble 1.6s ease-in-out 0s infinite"}}),y.jsx("circle",{cx:"4",cy:"-6",r:"1.5",fill:"#fcd34d",opacity:"0.75",style:{animation:"lavaBubble 1.4s ease-in-out 0.5s infinite"}})]}),_&&y.jsx("text",{x:"0",y:"0",textAnchor:"middle",fill:"rgba(0,0,0,0.15)",fontSize:"8",dy:".3em",pointerEvents:"none",children:`${e.q},${e.r}`})]})},Ew=Vn.memo(Tw,(e,n)=>e.hex.q===n.hex.q&&e.hex.r===n.hex.r&&e.hex.s===n.hex.s&&e.onClick===n.onClick&&e.onMouseEnter===n.onMouseEnter&&e.isCenter===n.isCenter&&e.isSelected===n.isSelected&&e.isValidMove===n.isValidMove&&e.isTargeted===n.isTargeted&&e.isStairs===n.isStairs&&e.isLava===n.isLava&&e.isShrine===n.isShrine&&e.isWall===n.isWall&&e.isFire===n.isFire&&e.assetHref===n.assetHref&&e.interactionOnly===n.interactionOnly),_w=({gameState:e,selectedSkillId:n,showMovementRange:a,hoveredTile:s,enginePreviewGhost:r})=>{const c=e.player.position,u=N.useMemo(()=>{const S=new Set;for(const T of e.enemies)T.hp>0&&S.add(ue(T.position));return S},[e.enemies]),p=N.useMemo(()=>{if(!a||n)return[];const S=new Set(e.player.activeSkills.map(_=>_.id)),T=["BASIC_MOVE","DASH"],v=new Set,A=[];return T.forEach(_=>{if(S.has(_)){const E=yt.get(_);E?.getValidTargets&&E.getValidTargets(e,c).forEach(M=>{const C=ue(M);v.has(C)||(v.add(C),A.push(M))})}}),A.length===0?[{q:c.q+1,r:c.r,s:c.s-1},{q:c.q+1,r:c.r-1,s:c.s},{q:c.q,r:c.r-1,s:c.s+1},{q:c.q-1,r:c.r,s:c.s+1},{q:c.q-1,r:c.r+1,s:c.s},{q:c.q,r:c.r+1,s:c.s-1}].filter(E=>ua(E,e.gridWidth,e.gridHeight)):A},[e,a,n,c]),g=N.useMemo(()=>{const S=new Set;for(const T of p)S.add(ue(T));return S},[p]),m=N.useMemo(()=>{if(!n)return[];const S=yt.get(n),T=B1(e.player,n)||S?.baseVariables?.range||0,v=S?.getValidTargets?S.getValidTargets(e,c):[],A=new Set(v.map(ue)),_=[];if(n==="DASH"||n==="SPEAR_THROW"||n==="SHIELD_THROW"||n==="GRAPPLE_HOOK")for(let w=0;w<6;w++)for(let M=1;M<=T;M++){const C=sn(c,Jd(w,M));if(!ua(C,e.gridWidth,e.gridHeight))break;const L=Oe.isLosBlocking(e,C),k=u.has(ue(C)),D=dt(c,C).slice(1,-1).some(J=>Oe.isLosBlocking(e,J)||u.has(ue(J))),$=A.has(ue(C));if(_.push({p:C,isValidTarget:$,isBlocked:D,isWall:L,isEnemy:k}),L||k)break}else v.forEach(w=>{const M=Oe.isLosBlocking(e,w),C=u.has(ue(w));_.push({p:w,isValidTarget:!0,isBlocked:!1,isWall:M,isEnemy:C})});return _},[e,n,c,u]),f=N.useMemo(()=>{const S=new Map;for(const T of m)S.set(ue(T.p),T);return S},[m]),b=N.useMemo(()=>{if(r)return r;if(a&&s&&!n&&g.has(ue(s)))return{path:dt(c,s),aoe:[],hasEnemy:!1,target:s};if(!n||!s)return null;const S=f.get(ue(s));if(!S||!S.isValidTarget||S.isBlocked)return null;const T=dt(c,s),v=BS(e,n,c,s),A=S.isEnemy;return{path:T,aoe:v,hasEnemy:A,target:s}},[r,e,n,s,f,g,a,c]);return y.jsx("g",{pointerEvents:"none",children:b&&y.jsxs("g",{children:[(()=>{const S=b.path.map(w=>Ee(w,Q)),T=S.map((w,M)=>`${M===0?"M":"L"} ${w.x} ${w.y}`).join(" "),v=S[S.length-1],A=S[S.length-2]||{x:v.x-1,y:v.y},_=Math.atan2(v.y-A.y,v.x-A.x),E=8;return y.jsxs("g",{children:[y.jsx("path",{d:T,stroke:"rgba(255,255,255,0.9)",strokeWidth:"2.25",fill:"none",opacity:"0.85",style:{filter:"drop-shadow(0 0 4px rgba(255,255,255,0.22))"}}),y.jsx("path",{d:`M ${v.x} ${v.y} L ${v.x-E*Math.cos(_-Math.PI/6)} ${v.y-E*Math.sin(_-Math.PI/6)} M ${v.x} ${v.y} L ${v.x-E*Math.cos(_+Math.PI/6)} ${v.y-E*Math.sin(_+Math.PI/6)}`,stroke:"rgba(255,255,255,0.95)",strokeWidth:"2",opacity:"0.9"})]})})(),b.hasEnemy&&(()=>{const{x:S,y:T}=Ee(b.target,Q),v=Q*.7;return y.jsxs("g",{children:[y.jsx("circle",{cx:S,cy:T,r:v,fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4 2"}),y.jsx("line",{x1:S-v,y1:T,x2:S+v,y2:T,stroke:"#ef4444",strokeWidth:"1"}),y.jsx("line",{x1:S,y1:T-v,x2:S,y2:T+v,stroke:"#ef4444",strokeWidth:"1"})]})})(),!b.hasEnemy&&(()=>{const{x:S,y:T}=Ee(b.target,Q);return y.jsx("circle",{cx:S,cy:T,r:Q*.36,fill:"rgba(255,255,255,0.14)",stroke:"rgba(255,255,255,0.65)",strokeWidth:1.5})})(),Array.from(new Map(b.aoe.map(S=>[ue(S),S])).values()).map(S=>{const{x:T,y:v}=Ee(S,Q);return y.jsx("circle",{cx:T,cy:v,r:Q*.6,fill:"rgba(239, 68, 68, 0.2)",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,strokeDasharray:"4 2"},`aoe-${S.q}-${S.r}`)})]})})},ww=({gameState:e,selectedSkillId:n,showMovementRange:a,hoveredTile:s,enginePreviewGhost:r,cells:c,tileVisualFlags:u,movementTargetSet:p,hasPrimaryMovementSkills:g,fallbackNeighborSet:m,selectedSkillTargetSet:f,stairsKey:b,shrineKey:S,mountainCoveredWallKeys:T,hybridInteractionLayerEnabled:v,assetById:A,onTileClick:_,onTileHover:E,decals:w})=>y.jsxs(y.Fragment,{children:[y.jsx("g",{"data-layer":"interaction-preview",children:y.jsx(_w,{gameState:e,selectedSkillId:n,showMovementRange:a,hoveredTile:s,enginePreviewGhost:r})}),y.jsxs("g",{"data-layer":"interaction-tiles",children:[c.map(M=>{const C=ue(M),L=u.get(C)||{isWall:!1,isLava:!1,isFire:!1},k=L.isWall,R=L.isLava,H=L.isFire,D=a&&!n&&p.has(C)||a&&!n&&!g&&m.has(C)&&!k,J=!!n&&f.has(C)||D,te=C===b,ae=S?C===S:!1,W=k&&!T.has(C),q=v&&!W,P=W_({isWall:W,isLava:R,isFire:H,theme:e.theme}),z=q?void 0:A.get(P)?.path;return y.jsx(Ew,{hex:M,onClick:_,isValidMove:J,isTargeted:!1,isStairs:te,isLava:R,isFire:H,isShrine:ae,isWall:W,onMouseEnter:E,assetHref:z,interactionOnly:q},C)}),y.jsx("g",{children:w.map(M=>{const{x:C,y:L}=Ee(M.position,Q),k=Date.now()-M.createdAt,R=Math.max(.18,.75-k/12e3*.57);return y.jsx("image",{href:M.href,x:C-Q*.7,y:L-Q*.7,width:Q*1.4,height:Q*1.4,preserveAspectRatio:"xMidYMid meet",opacity:R},M.id)})})]})]}),Mw=({cells:e,gridPoints:n})=>y.jsx("g",{"data-layer":"interaction-ui-grid",pointerEvents:"none",shapeRendering:"crispEdges",children:e.map(a=>{const{x:s,y:r}=Ee(a,Q);return y.jsx("g",{transform:`translate(${s},${r})`,children:y.jsx("polygon",{points:n,fill:"none",stroke:"rgba(201,224,255,0.12)",strokeWidth:.9})},`grid-${ue(a)}`)})}),Ow=e=>e.replace(/[^a-zA-Z0-9_-]/g,"-"),Cw=({sprites:e,floor:n,manifestUnitToBoardScale:a,mountainSettingsByAssetId:s,resolveMountainSettings:r})=>y.jsx("g",{"data-layer":"clutter-obstacles",pointerEvents:"none",children:e.map(c=>{const{x:u,y:p}=Ee(c.position,Q);if(c.asset?.path){const g=Math.min(1,Math.max(0,c.asset.anchor?.x??.5)),m=Math.min(1,Math.max(0,c.asset.anchor?.y??.5)),f=c.kind==="mountain",b=f?s.get(c.asset.id)||r(c.asset):null,S=b?b.anchorX:g,T=b?b.anchorY:m,v=u+(b?b.offsetX:0),A=p+(b?b.offsetY:0),_=Math.max(8,c.asset.width*a*c.renderScale),E=Math.max(8,c.asset.height*a*c.renderScale),w=c.kind==="shrine",M=c.kind==="stairs",C=w||M,L=w?"rgba(251,146,60,0.25)":"rgba(74,222,128,0.22)",k=w?"#fdba74":"#86efac",R=u,H=p-E*T+E*.84,D=Math.max(14,_*.32),$=Math.max(8,E*.14);return y.jsxs("g",{children:[C&&y.jsxs(y.Fragment,{children:[y.jsx("ellipse",{cx:R,cy:H,rx:D,ry:$,fill:L,opacity:.95}),y.jsx("ellipse",{cx:R,cy:H,rx:D*1.14,ry:$*1.14,fill:"none",stroke:k,strokeWidth:2,opacity:.72,style:{animation:`shrineGlow ${w?1.8:2.4}s ease-in-out infinite`}})]}),(()=>{const J=C?w?"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(251,146,60,0.45)) saturate(1.08) contrast(1.06)":"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(74,222,128,0.42)) saturate(1.08) contrast(1.06)":f?"drop-shadow(0 7px 10px rgba(0,0,0,0.56)) saturate(1.04) contrast(1.08)":"drop-shadow(0 5px 8px rgba(0,0,0,0.48)) saturate(0.98) contrast(1.04)",te=C?.99:f?.96:.9,ae=!!(b&&b.crustBlendMode!=="off"&&b.crustBlendOpacity>0),W=!!(b&&b.tintBlendMode!=="off"&&b.tintOpacity>0),q=b?.crustBlendMode!=="off"?b?.crustBlendMode:void 0,P=b?.tintBlendMode!=="off"?b?.tintBlendMode:void 0,z=v-_*S,X=A-E*T,le=Ow(c.id),fe=`mountain-ground-gradient-${n}-${le}`,I=`mountain-ground-mask-${n}-${le}`,K=`mountain-tint-filter-${n}-${le}`;return y.jsxs(y.Fragment,{children:[(ae||W)&&y.jsxs("defs",{children:[ae&&y.jsxs(y.Fragment,{children:[y.jsxs("linearGradient",{id:fe,x1:"0",y1:"0",x2:"0",y2:"1",children:[y.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0"}),y.jsx("stop",{offset:"42%",stopColor:"#ffffff",stopOpacity:"0.04"}),y.jsx("stop",{offset:"64%",stopColor:"#ffffff",stopOpacity:"0.42"}),y.jsx("stop",{offset:"82%",stopColor:"#ffffff",stopOpacity:"0.82"}),y.jsx("stop",{offset:"100%",stopColor:"#ffffff",stopOpacity:"1"})]}),y.jsx("mask",{id:I,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:y.jsx("rect",{x:z,y:X,width:_,height:E,fill:`url(#${fe})`})})]}),W&&y.jsx("filter",{id:K,x:"-10%",y:"-10%",width:"120%",height:"120%",children:y.jsx("feColorMatrix",{type:"matrix",values:b?.tintMatrixValues})})]}),y.jsx("image",{href:c.asset.path,x:z,y:X,width:_,height:E,preserveAspectRatio:"xMidYMid meet",opacity:te,style:{filter:J}}),ae&&y.jsx("image",{href:c.asset.path,x:z,y:X,width:_,height:E,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.9,b?.crustBlendOpacity||0),mask:`url(#${I})`,style:{mixBlendMode:q,filter:"brightness(0.92) saturate(0.76) contrast(1.03)"}}),W&&y.jsx("image",{href:c.asset.path,x:z,y:X,width:_,height:E,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.95,b?.tintOpacity||0),filter:`url(#${K})`,style:{mixBlendMode:P}})]})})()]},c.id)}return c.fallback==="shrine"?y.jsxs("g",{transform:`translate(${u},${p})`,children:[y.jsx("polygon",{points:"0,-18 8,-4 5,12 -5,12 -8,-4",fill:"#f97316",stroke:"#fff",strokeWidth:"1",opacity:"0.9"}),y.jsx("polygon",{points:"-2,-14 2,-14 1,-2 -1,-2",fill:"rgba(255,255,255,0.6)"}),y.jsx("circle",{cx:"0",cy:"0",r:"14",fill:"none",stroke:"#fdba74",strokeWidth:"2",opacity:"0.4",style:{animation:"shrineGlow 2s ease-in-out infinite"}})]},c.id):y.jsxs("g",{transform:`translate(${u},${p})`,children:[y.jsx("rect",{x:"-12",y:"6",width:"8",height:"4",fill:"#1f2937",rx:"1"}),y.jsx("rect",{x:"-6",y:"2",width:"8",height:"4",fill:"#374151",rx:"1"}),y.jsx("rect",{x:"0",y:"-2",width:"8",height:"4",fill:"#4b5563",rx:"1"}),y.jsx("rect",{x:"6",y:"-6",width:"8",height:"4",fill:"#6b7280",rx:"1"}),y.jsx("path",{d:"M 2 -14 L 2 -20 L -4 -20 L 2 -26 L 8 -20 L 2 -20",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1"})]},c.id)})}),Nw=({cells:e,biomeClipId:n,biomeClipPoints:a,maskHexPoints:s,biomeFrame:r,biomeCoverFrame:c,undercurrentHref:u,undercurrentMode:p,undercurrentPatternId:g,undercurrentScalePx:m,undercurrentOffset:f,undercurrentScroll:b,undercurrentOpacity:S,crustHref:T,crustMode:v,crustPatternId:A,crustScalePx:_,crustPatternShift:E,crustOpacity:w,crustDetailAHref:M,crustDetailAMode:C,crustDetailAPatternId:L,crustDetailAScalePx:k,crustDetailAShift:R,crustDetailAScroll:H,crustDetailAOpacity:D,crustDetailBHref:$,crustDetailBMode:J,crustDetailBPatternId:te,crustDetailBScalePx:ae,crustDetailBShift:W,crustDetailBScroll:q,crustDetailBOpacity:P,crustMaskEnabled:z,crustMaskId:X,crustMaskHoles:le,crustTintActive:fe,crustTintColor:I,crustTintOpacity:K,crustTintBlendMode:G})=>y.jsxs(y.Fragment,{children:[y.jsxs("defs",{children:[y.jsx("clipPath",{id:n,clipPathUnits:"userSpaceOnUse",children:e.map(ne=>{const{x:re,y:ce}=Ee(ne,Q);return y.jsx("polygon",{points:a,transform:`translate(${re},${ce})`},`biome-clip-${ue(ne)}`)})}),u&&p==="repeat"&&y.jsxs("pattern",{id:g,patternUnits:"userSpaceOnUse",width:m,height:m,patternTransform:`translate(${f.x} ${f.y})`,children:[y.jsx("image",{href:u,x:"0",y:"0",width:m,height:m,preserveAspectRatio:"xMidYMid slice"}),(b.x!==0||b.y!==0)&&y.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${f.x} ${f.y}`,to:`${f.x+b.x} ${f.y+b.y}`,dur:`${b.durationMs}ms`,repeatCount:"indefinite"})]}),T&&v==="repeat"&&y.jsx("pattern",{id:A,patternUnits:"userSpaceOnUse",width:_,height:_,patternTransform:`translate(${E.x} ${E.y})`,children:y.jsx("image",{href:T,x:"0",y:"0",width:_,height:_,preserveAspectRatio:"xMidYMid slice"})}),M&&C==="repeat"&&y.jsxs("pattern",{id:L,patternUnits:"userSpaceOnUse",width:k,height:k,patternTransform:`translate(${R.x} ${R.y})`,children:[y.jsx("image",{href:M,x:"0",y:"0",width:k,height:k,preserveAspectRatio:"xMidYMid slice"}),(H.x!==0||H.y!==0)&&y.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${R.x} ${R.y}`,to:`${R.x+H.x} ${R.y+H.y}`,dur:`${H.durationMs}ms`,repeatCount:"indefinite"})]}),$&&J==="repeat"&&y.jsxs("pattern",{id:te,patternUnits:"userSpaceOnUse",width:ae,height:ae,patternTransform:`translate(${W.x} ${W.y})`,children:[y.jsx("image",{href:$,x:"0",y:"0",width:ae,height:ae,preserveAspectRatio:"xMidYMid slice"}),(q.x!==0||q.y!==0)&&y.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${W.x} ${W.y}`,to:`${W.x+q.x} ${W.y+q.y}`,dur:`${q.durationMs}ms`,repeatCount:"indefinite"})]}),z&&y.jsxs("mask",{id:X,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",x:c.x,y:c.y,width:c.width,height:c.height,children:[y.jsx("rect",{x:c.x,y:c.y,width:c.width,height:c.height,fill:"white"}),le.map(ne=>y.jsx("polygon",{points:s,transform:`translate(${ne.x},${ne.y})`,fill:"black",opacity:1},`hole-${ne.key}`))]})]}),y.jsxs("g",{"data-layer":"biome-undercurrent",pointerEvents:"none",clipPath:`url(#${n})`,children:[u&&p==="repeat"&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${g})`,opacity:S}),u&&p==="cover"&&y.jsx("image",{href:u,x:c.x+f.x,y:c.y+f.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:S})]}),y.jsxs("g",{"data-layer":"biome-crust",pointerEvents:"none",clipPath:`url(#${n})`,children:[T&&v==="repeat"&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${A})`,opacity:w,mask:`url(#${X})`}),T&&v==="cover"&&y.jsx("image",{href:T,x:c.x+E.x,y:c.y+E.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:w,mask:`url(#${X})`}),M&&C==="repeat"&&D>0&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${L})`,opacity:D,mask:`url(#${X})`}),M&&C==="cover"&&D>0&&y.jsx("image",{href:M,x:c.x+R.x,y:c.y+R.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:D,mask:`url(#${X})`}),$&&J==="repeat"&&P>0&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:`url(#${te})`,opacity:P,mask:`url(#${X})`}),$&&J==="cover"&&P>0&&y.jsx("image",{href:$,x:c.x+W.x,y:c.y+W.y,width:c.width,height:c.height,preserveAspectRatio:"xMidYMid slice",opacity:P,mask:`url(#${X})`}),fe&&I&&y.jsx("rect",{x:r.x,y:r.y,width:r.width,height:r.height,fill:I,opacity:K,mask:`url(#${X})`,style:G!=="normal"?{mixBlendMode:G}:void 0})]})]}),kw=({svgRef:e,onMove:n,zoomPreset:a,setHoveredTile:s,setIsCameraPanning:r,cameraPanOffsetRef:c,isCameraPanningRef:u,isPinchingRef:p,suppressTileClickUntilRef:g,activePointersRef:m,dragStateRef:f,pinchStateRef:b,animateCameraToTarget:S,updatePanFromWorldDelta:T,setZoomPresetAnimated:v})=>{const A=N.useCallback(($,J)=>{const te=e.current;if(!te||!te.getScreenCTM)return null;const ae=te.getScreenCTM();if(!ae)return null;const W=te.createSVGPoint();W.x=$,W.y=J;const q=W.matrixTransform(ae.inverse());return{x:q.x,y:q.y}},[e]),_=N.useCallback(()=>{c.current={x:0,y:0},S({panOffset:{x:0,y:0},durationMs:220})},[S,c]),E=N.useCallback($=>{Date.now()<g.current||n($)},[n,g]),w=N.useCallback($=>{u.current||p.current||s($)},[u,p,s]),M=N.useCallback(()=>Array.from(m.current.entries()),[m]),C=N.useCallback($=>{if($.pointerType==="mouse"&&$.button!==0)return;if(m.current.set($.pointerId,{x:$.clientX,y:$.clientY}),$.pointerType!=="mouse")try{$.currentTarget.setPointerCapture($.pointerId)}catch{}const J=M();if(J.length>=2){p.current=!0,u.current=!1,r(!1),f.current.didPan=!0,g.current=Date.now()+250;const[te,ae]=J,W=te[1].x-ae[1].x,q=te[1].y-ae[1].y;b.current={startDistance:Math.hypot(W,q),startPreset:a,appliedPreset:a};return}f.current={activePointerId:$.pointerId,startClient:{x:$.clientX,y:$.clientY},lastWorld:A($.clientX,$.clientY),didPan:!1}},[m,A,f,M,u,p,b,r,g,a]),L=N.useCallback($=>{if(!m.current.has($.pointerId))return;m.current.set($.pointerId,{x:$.clientX,y:$.clientY});const J=M();if(p.current||J.length>=2){if(J.length>=2){p.current=!0;const[le,fe]=J,I=le[1].x-fe[1].x,K=le[1].y-fe[1].y,G=Math.max(1,Math.hypot(I,K));if(!b.current)b.current={startDistance:G,startPreset:a,appliedPreset:a};else{const ne=G/Math.max(1,b.current.startDistance);let re=b.current.startPreset;ne>1.08&&(re=7),ne<.92&&(re=11),re!==b.current.appliedPreset&&(b.current.appliedPreset=re,v(re))}g.current=Date.now()+250,$.preventDefault()}return}const te=f.current;if(!te.startClient||te.activePointerId!==$.pointerId)return;const ae=$.clientX-te.startClient.x,W=$.clientY-te.startClient.y,q=Math.hypot(ae,W);if(!te.didPan&&q>10&&(te.didPan=!0,u.current=!0,r(!0),g.current=Date.now()+250,s(null)),!te.didPan)return;const z=A($.clientX,$.clientY);if(!te.lastWorld||!z)return;const X={x:te.lastWorld.x-z.x,y:te.lastWorld.y-z.y};te.lastWorld=z,T(X),$.preventDefault()},[m,A,f,M,u,p,b,s,r,v,g,T,a]),k=N.useCallback($=>{m.current.delete($);const J=M();J.length<2&&(p.current=!1,b.current=null);const te=f.current;te.activePointerId===$&&(te.didPan&&(g.current=Date.now()+250),f.current={activePointerId:J[0]?.[0]??null,startClient:J[0]?{...J[0][1]}:null,lastWorld:J[0]?A(J[0][1].x,J[0][1].y):null,didPan:!1}),m.current.size===0&&(u.current=!1,r(!1))},[m,A,f,M,u,p,b,r,g]),R=N.useCallback($=>{k($.pointerId);try{$.currentTarget.releasePointerCapture($.pointerId)}catch{}},[k]),H=N.useCallback($=>{k($.pointerId)},[k]),D=N.useCallback($=>{if(($.ctrlKey||$.deltaY!==0)&&$.preventDefault(),Math.abs($.deltaY)<.1)return;const J=$.deltaY<0?7:11;v(J),g.current=Date.now()+120},[v,g]);return{handleResetView:_,handleTileClick:E,handleHoverTile:w,handleBoardPointerDown:C,handleBoardPointerMove:L,handleBoardPointerUp:R,handleBoardPointerCancel:H,handleBoardWheel:D}},Rw=[7,11],Cg=(e,n,a)=>e<n?n:e>a?a:e,Iw=e=>({top:Math.max(0,Number(e?.top??0)),right:Math.max(0,Number(e?.right??0)),bottom:Math.max(0,Number(e?.bottom??0)),left:Math.max(0,Number(e?.left??0))}),cf=e=>{const n=Iw(e.insets),a=Math.max(1,Number(e.width||0)-n.left-n.right),s=Math.max(1,Number(e.height||0)-n.top-n.bottom);return{width:a,height:s,insets:n}},Lw=(e,n,a=0)=>{const s=Math.max(1,n),r=1.5*s,c=2*s;return(Math.max(1,e)-1)*r+c+Math.max(0,a)*2},Bw=(e,n,a,s=0)=>{const r=cf(e),c=Lw(n,a,s);return r.width/Math.max(1,c)},Hw=(e,n)=>{const a=cf(e),s=Math.max(1,n.width),r=Math.max(1,n.height);return Math.min(a.width/s,a.height/r)},Pw=(e,n)=>({x:e.x-n,y:e.y-n,width:e.width+n*2,height:e.height+n*2}),jw=(e,n)=>{const a=Math.max(1e-6,e),s=Math.max(1e-6,n);return Math.max(a,s)},Ng=(e,n)=>{const a=cf(e),s=Math.max(1e-6,n);return{width:a.width/s,height:a.height/s}},Dw=(e,n,a)=>{const s=n.width/2,r=n.height/2,c=a.x+s,u=a.x+a.width-s,p=a.y+r,g=a.y+a.height-r;return{x:c>u?a.x+a.width/2:Cg(e.x,c,u),y:p>g?a.y+a.height/2:Cg(e.y,p,g)}},kg=(e,n)=>({x:e.x-n.width/2,y:e.y-n.height/2,width:n.width,height:n.height}),Uw=({baseViewBox:e,playerWorld:n,playerPosition:a,floor:s,cameraSafeInsetsPx:r})=>{const[c,u]=N.useState(11),[p,g]=N.useState({width:0,height:0}),[m,f]=N.useState(!1),b=N.useRef(null),S=N.useRef(null),T=N.useRef(null),v=N.useRef(null),A=N.useRef({x:0,y:0}),_=N.useRef(!1),E=N.useRef(!1),w=N.useRef(0),M=N.useRef(new Map),C=N.useRef({activePointerId:null,startClient:null,lastWorld:null,didPan:!1}),L=N.useRef(null),k=N.useRef(null),R=N.useRef(null),H=N.useRef(!1),D=N.useRef(""),$=N.useRef(""),J=N.useRef(11),te=N.useRef(!1),ae=N.useCallback(()=>{v.current!==null&&(window.cancelAnimationFrame(v.current),v.current=null),te.current=!1},[]),W=N.useCallback(G=>{const ne=b.current;ne&&ne.setAttribute("viewBox",`${G.x} ${G.y} ${G.width} ${G.height}`)},[]),q=N.useCallback(G=>{T.current=G,W(G.viewBox)},[W]),P=N.useCallback(G=>{const ne=Math.max(1,p.width),re=Math.max(1,p.height),ce=G?.zoomPreset??c,pe=G?.panOffset??A.current,Se={width:ne,height:re,insets:r||{}},_e=Q*.75,Ce=Pw(e,_e),ze=Bw(Se,ce,Q,Q*.2),$e=Hw(Se,Ce),Ae=jw($e,ze),qe=Ng(Se,Ae),gt={x:n.x+pe.x,y:n.y+pe.y},bt=Dw(gt,qe,Ce),Yt=kg(bt,qe);return{center:bt,scale:Ae,viewBox:Yt}},[p.width,p.height,c,r,e,n.x,n.y]),z=N.useCallback((G,ne=220)=>{const re=T.current;if(!re){q(G);return}ae();const ce=re.center,pe=re.scale,ke=G.center,Se=G.scale,_e=performance.now();te.current=!0;const Ce=$e=>1-Math.pow(1-$e,3),ze=$e=>{const Ae=Math.min(1,($e-_e)/Math.max(1,ne)),qe=Ce(Ae),gt=pe+(Se-pe)*qe,bt={x:ce.x+(ke.x-ce.x)*qe,y:ce.y+(ke.y-ce.y)*qe},Yt={width:Math.max(1,p.width),height:Math.max(1,p.height),insets:r||{}},en=Ng(Yt,gt),Kt=kg(bt,en);q({center:bt,scale:gt,viewBox:Kt}),Ae<1?v.current=window.requestAnimationFrame(ze):(v.current=null,te.current=!1,q(G))};v.current=window.requestAnimationFrame(ze)},[ae,q,p.width,p.height,r]),X=N.useCallback(G=>{ae(),q(P(G))},[ae,q,P]),le=N.useCallback(G=>{const ne=P(G);z(ne,G?.durationMs??220)},[z,P]);N.useEffect(()=>{const G=S.current;if(!G)return;const ne=()=>{const ce=G.getBoundingClientRect();g(pe=>{const ke=Math.round(ce.width),Se=Math.round(ce.height);return pe.width===ke&&pe.height===Se?pe:{width:ke,height:Se}})};if(ne(),typeof ResizeObserver>"u")return window.addEventListener("resize",ne),()=>window.removeEventListener("resize",ne);const re=new ResizeObserver(()=>ne());return re.observe(G),()=>re.disconnect()},[]),N.useEffect(()=>{if(p.width<=0||p.height<=0)return;const G=`${e.x}:${e.y}:${e.width}:${e.height}`,ne=`${p.width}:${p.height}:${r?.top??0}:${r?.right??0}:${r?.bottom??0}:${r?.left??0}`,re=ue(a);if(!H.current){H.current=!0,k.current=re,R.current=s??null,D.current=ne,$.current=G,J.current=c,X({panOffset:{x:0,y:0}});return}if((s??null)!==R.current){R.current=s??null,$.current=G,D.current=ne,k.current=re,J.current=c,A.current={x:0,y:0},X({panOffset:{x:0,y:0}});return}if(s!==void 0&&G!==$.current){$.current=G,D.current=ne,k.current=re,J.current=c,A.current={x:0,y:0},X({panOffset:{x:0,y:0}});return}if(ne!==D.current){D.current=ne,$.current=G,X();return}if(c!==J.current){J.current=c,le();return}if(re!==k.current){k.current=re;const ce={x:0,y:0};A.current=ce,le({panOffset:ce,durationMs:210});return}},[p.width,p.height,e.x,e.y,e.width,e.height,r,s,a,c,X,le]),N.useEffect(()=>()=>ae(),[ae]);const fe=N.useCallback(G=>{const ne={x:A.current.x+G.x,y:A.current.y+G.y};A.current=ne,ae(),q(P({panOffset:ne}))},[ae,q,P]),I=N.useCallback(G=>{u(ne=>ne===G?ne:G)},[]),K=T.current?.viewBox||e;return{svgRef:b,boardViewportRef:S,zoomPreset:c,isCameraPanning:m,setIsCameraPanning:f,cameraPanOffsetRef:A,isCameraPanningRef:_,isPinchingRef:E,suppressTileClickUntilRef:w,activePointersRef:M,dragStateRef:C,pinchStateRef:L,cancelCameraAnimation:ae,animateCameraToTarget:le,updatePanFromWorldDelta:fe,setZoomPresetAnimated:I,renderedViewBox:K}},$w=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619);return n>>>0},ko=e=>$w(e)/4294967295,qw=e=>{const n=(e.tags||[]).map(s=>s.toLowerCase()),a=[e.id.toLowerCase(),...n];for(const s of a){const r=s.match(/(?:cluster|hex)[-_]?([123])\b/);if(r)return Number(r[1]);if(s.includes("1-hex")||s.includes("single"))return 1;if(s.includes("2-hex")||s.includes("double"))return 2;if(s.includes("3-hex")||s.includes("triple"))return 3}return 1},zw=({assetManifest:e,biomeThemeKey:n,biomeSeed:a,mountainAssetPathOverride:s,wallsMountainPath:r,wallsThemeMountainPath:c,clutterLayer:u,cells:p,tileVisualFlags:g,boardProps:m,resolveMountainSettings:f})=>{const b=N.useMemo(()=>{const M=(e?.assets||[]).filter(R=>{if(R.type!=="prop")return!1;const H=R.id.toLowerCase(),D=new Set((R.tags||[]).map(te=>te.toLowerCase()));if(!(H.includes("mountain")||D.has("mountain")))return!1;if(!R.theme)return!0;const J=R.theme.toLowerCase();return J===n||J==="core"}).sort((R,H)=>R.id.localeCompare(H.id)),C=String(c||r||"").trim(),L=String(s||C).trim();if(!L)return M;const k=M.find(R=>R.path===L);return k?[k]:[]},[e?.assets,n,s,r,c]),S=N.useMemo(()=>{const w=new Map;for(const M of b)w.set(M.id,f(M));return w},[b,f]),T=N.useMemo(()=>{if(!b.length)return[];const w=b.filter(L=>qw(L)===1),M=w.length?w:b,C=p.filter(L=>g.get(ue(L))?.isWall).sort((L,k)=>ue(L).localeCompare(ue(k)));return C.length?C.map(L=>{const k=ue(L),R=Math.floor(ko(`${a}|mountain-tile|${k}|asset`)*M.length)%M.length,H=M[R],D=S.get(H.id)||f(H),{y:$}=Ee(L,Q);return{id:`mountain-${k}-${H.id}`,kind:"mountain",position:L,asset:H,renderScale:D.scale,zAnchorY:$+Q*.42+D.offsetY}}):[]},[b,p,g,a,S,f]),v=N.useMemo(()=>{const w=new Set((u?.tags?.length?u.tags:["clutter","obstacle"]).map(M=>M.toLowerCase()));return(e?.assets||[]).filter(M=>{if(M.type!=="prop"&&M.type!=="decal"||M.id.toLowerCase().includes("mountain"))return!1;const L=(M.tags||[]).map(k=>k.toLowerCase());return L.includes("mountain")||!L.some(k=>w.has(k))?!1:M.theme?M.theme.toLowerCase()===n||M.theme.toLowerCase()==="core":!0})},[e?.assets,u?.tags,n]),A=N.useMemo(()=>{if(!v.length)return[];const w=Math.min(.6,Math.max(0,Number(u?.density??.08))),M=Math.max(1,Math.floor(Number(u?.maxPerHex??1))),C=Math.min(2,Math.max(1,Number(u?.bleedScaleMax??2))),L=[];for(const k of p){const R=ue(k),H=g.get(R);if(H?.isWall||H?.isLava||H?.isFire)continue;const{y:D}=Ee(k,Q);for(let $=0;$<M;$++){if(ko(`${a}|clutter|${R}|slot:${$}|roll`)>w/($+1))continue;const te=Math.floor(ko(`${a}|clutter|${R}|slot:${$}|pick`)*v.length)%v.length,ae=v[te],W=1+ko(`${a}|clutter|${R}|slot:${$}|scale`)*(C-1),q=(ko(`${a}|clutter|${R}|slot:${$}|depth`)-.5)*Q*.28;L.push({id:`clutter-${R}-${$}-${ae.id}`,kind:"clutter",position:k,asset:ae,renderScale:W,zAnchorY:D+q})}}return L},[p,g,v,u?.density,u?.maxPerHex,u?.bleedScaleMax,a]),_=N.useMemo(()=>{const w=[...T,...A];for(const M of m){const{y:C}=Ee(M.position,Q),L=M.kind==="shrine";w.push({id:M.id,kind:M.kind,position:M.position,asset:M.asset,renderScale:Math.min(2,L?1.5:1.42),zAnchorY:C+(L?Q*.32:Q*.28),fallback:M.kind})}return w.sort((M,C)=>M.zAnchorY===C.zAnchorY?M.id.localeCompare(C.id):M.zAnchorY-C.zAnchorY),w},[T,A,m]),E=N.useMemo(()=>{const w=new Set;for(const M of T)w.add(ue(M.position));return w},[T]);return{mountainSettingsByAssetId:S,depthSortedSprites:_,mountainCoveredWallKeys:E}},Cd=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619);return n>>>0},hl=(e,n)=>{if(e)return n&&e.themes?.[n]?e.themes[n]:e.default},yl=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"cover":"off",Nd=e=>Math.min(1,Math.max(0,Number(e?.opacity??1))),gl=(e,n,a=64,s=Number.POSITIVE_INFINITY)=>{const r=Number(e?.scalePx||n);return Math.min(s,Math.max(a,r))},Rg=e=>({x:Number(e?.scroll?.x??0),y:Number(e?.scroll?.y??0),durationMs:Math.max(1e3,Number(e?.scroll?.durationMs??18e3))}),Vw=(e,n)=>{if(e)return n&&e.themes?.[n]?e.themes[n]:e.default},Yw=e=>Math.min(1,Math.max(0,Number(e?.opacity??0))),V0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",Y0=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,u,p]=a.slice(1).split("");return`#${c}${c}${u}${u}${p}${p}`.toLowerCase()}return n},Kw=e=>{const a=Y0(e).slice(1);return{r:parseInt(a.slice(0,2),16)/255,g:parseInt(a.slice(2,4),16)/255,b:parseInt(a.slice(4,6),16)/255}},Ig=(e,n)=>e==="off"?"off":e?V0(e):n,Lg=e=>{const n=[];for(let a=0;a<6;a++){const s=Math.PI/180*(60*a);n.push(`${e*Math.cos(s)},${e*Math.sin(s)}`)}return n.join(" ")},Fw=({cells:e,gameState:n,bounds:a,assetManifest:s,biomeDebug:r})=>{const c=N.useMemo(()=>{const Te=new Map;for(const Re of e){const Ge=ue(Re),ot=Oe.getTraitsAt(n,Re),rt=ot.has("BLOCKS_MOVEMENT")&&ot.has("BLOCKS_LOS"),Dt=ot.has("LAVA")||ot.has("HAZARDOUS")&&ot.has("LIQUID"),xt=ot.has("FIRE");Te.set(Ge,{isWall:rt,isLava:!rt&&Dt,isFire:!rt&&xt})}return Te},[e,n.tiles]),u=N.useMemo(()=>{const Te=new Map;for(const Re of s?.assets||[])Te.set(Re.id,Re);return Te},[s]),p=N.useMemo(()=>u.get(Z_())?.path,[u]),g=N.useMemo(()=>Math.max(1,s?.tileUnitPx||256),[s?.tileUnitPx]),m=N.useMemo(()=>Q*2/g,[g]),f=N.useMemo(()=>String(n.theme||"").toLowerCase(),[n.theme]),b=N.useMemo(()=>`${n.initialSeed||n.rngSeed||n.turnNumber}:${n.floor}:${f}`,[n.initialSeed,n.rngSeed,n.turnNumber,n.floor,f]),S=N.useMemo(()=>lf(s,f),[s,f]),T=N.useMemo(()=>{const Te=s?.biomeUnderlay;if(Te)return{default:Te.default,themes:Te.themes,mode:Te.mode,scalePx:Te.scalePx,opacity:Te.opacity}},[s?.biomeUnderlay]),v=N.useMemo(()=>S?.biomeLayers?.undercurrent||s?.biomeLayers?.undercurrent,[S?.biomeLayers?.undercurrent,s?.biomeLayers?.undercurrent]),A=N.useMemo(()=>S?.biomeLayers?.crust||s?.biomeLayers?.crust||T,[S?.biomeLayers?.crust,s?.biomeLayers?.crust,T]),_=N.useMemo(()=>S?.biomeLayers?.clutter||s?.biomeLayers?.clutter,[S?.biomeLayers?.clutter,s?.biomeLayers?.clutter]),E=N.useMemo(()=>hl(v,f),[v,f]),w=N.useMemo(()=>yl(v),[v]),M=N.useMemo(()=>gl(v,g,64,192),[v,g]),C=N.useMemo(()=>Nd(v),[v]),L=N.useMemo(()=>({x:Number(v?.scroll?.x??120),y:Number(v?.scroll?.y??90),durationMs:Math.max(1e3,Number(v?.scroll?.durationMs??92e3))}),[v?.scroll?.x,v?.scroll?.y,v?.scroll?.durationMs]),k=N.useMemo(()=>({x:Number(v?.offsetX??0)+Number(r?.undercurrentOffset?.x??0),y:Number(v?.offsetY??0)+Number(r?.undercurrentOffset?.y??0)}),[v?.offsetX,v?.offsetY,r?.undercurrentOffset?.x,r?.undercurrentOffset?.y]),R=N.useMemo(()=>hl(A,f),[A,f]),H=N.useMemo(()=>yl(A),[A]),D=N.useMemo(()=>gl(A,g,64),[A,g]),$=1,J=N.useMemo(()=>{const Te=Math.max(0,Number(A?.seedShiftPx??Q*5));if(Te===0)return{x:0,y:0};const Re=Cd(`${b}|crust-offset`),Ge=((Re&65535)/65535*2-1)*Te,ot=((Re>>>16&65535)/65535*2-1)*Te;return{x:Ge,y:ot}},[A?.seedShiftPx,b]),te=N.useMemo(()=>({x:Number(A?.offsetX??0)+Number(r?.crustOffset?.x??0),y:Number(A?.offsetY??0)+Number(r?.crustOffset?.y??0)}),[A?.offsetX,A?.offsetY,r?.crustOffset?.x,r?.crustOffset?.y]),ae=N.useMemo(()=>({x:J.x+te.x,y:J.y+te.y}),[J.x,J.y,te.x,te.y]),W=N.useMemo(()=>s?.walls,[s?.walls]),q=N.useMemo(()=>S?.walls||W?.themes?.[f],[S?.walls,W?.themes,f]),P=N.useMemo(()=>S?.biomeMaterials?.crust||s?.biomeMaterials?.crust,[S?.biomeMaterials?.crust,s?.biomeMaterials?.crust]),z=N.useMemo(()=>P?.detailA,[P?.detailA]),X=N.useMemo(()=>P?.detailB,[P?.detailB]),le=N.useMemo(()=>hl(z,f),[z,f]),fe=N.useMemo(()=>hl(X,f),[X,f]),I=N.useMemo(()=>yl(z),[z]),K=N.useMemo(()=>yl(X),[X]),G=N.useMemo(()=>gl(z,D,64),[z,D]),ne=N.useMemo(()=>gl(X,D,64),[X,D]),re=N.useMemo(()=>Nd(z),[z]),ce=N.useMemo(()=>Nd(X),[X]),pe=N.useMemo(()=>Rg(z),[z?.scroll?.x,z?.scroll?.y,z?.scroll?.durationMs]),ke=N.useMemo(()=>Rg(X),[X?.scroll?.x,X?.scroll?.y,X?.scroll?.durationMs]),Se=N.useMemo(()=>{const Te=Q*.75,Re=Cd(`${b}|crust-detail-a-offset`),Ge=((Re&65535)/65535*2-1)*Te,ot=((Re>>>16&65535)/65535*2-1)*Te;return{x:Ge,y:ot}},[b]),_e=N.useMemo(()=>{const Te=Q*.75,Re=Cd(`${b}|crust-detail-b-offset`),Ge=((Re&65535)/65535*2-1)*Te,ot=((Re>>>16&65535)/65535*2-1)*Te;return{x:Ge,y:ot}},[b]),Ce=N.useMemo(()=>({x:ae.x+Se.x,y:ae.y+Se.y}),[ae.x,ae.y,Se.x,Se.y]),ze=N.useMemo(()=>({x:ae.x+_e.x,y:ae.y+_e.y}),[ae.x,ae.y,_e.x,_e.y]),$e=N.useMemo(()=>P?.tint,[P?.tint]),Ae=N.useMemo(()=>Vw($e,f),[$e,f]),qe=N.useMemo(()=>Yw($e),[$e?.opacity]),gt=N.useMemo(()=>V0($e?.blendMode),[$e?.blendMode]),bt=!!(Ae&&qe>0),Yt=N.useMemo(()=>bt?Math.min(.55,Math.max(.15,qe*.9)):0,[bt,qe]),en=N.useCallback(Te=>{const Re=Te?.mountainSettings,Ge=Te?.mountainSettingsByTheme?.[f],rt=(Te?S?.assetOverrides?.[Te.id]:void 0)?.mountainSettings,Dt=Math.min(3,Math.max(.2,Number(r?.mountainScale??rt?.scale??Ge?.scale??q?.scale??W?.scale??Re?.scale??.95))),xt=Number(r?.mountainOffset?.x??rt?.offsetX??Ge?.offsetX??q?.offsetX??W?.offsetX??Re?.offsetX??0),gn=Number(r?.mountainOffset?.y??rt?.offsetY??Ge?.offsetY??q?.offsetY??W?.offsetY??Re?.offsetY??0),bn=Math.min(1,Math.max(0,Number(r?.mountainAnchor?.x??rt?.anchorX??Ge?.anchorX??q?.anchorX??W?.anchorX??Re?.anchorX??.5))),li=Math.min(1,Math.max(0,Number(r?.mountainAnchor?.y??rt?.anchorY??Ge?.anchorY??q?.anchorY??W?.anchorY??Re?.anchorY??.78))),Qn=Ig(r?.mountainCrustBlendMode??rt?.crustBlendMode??Ge?.crustBlendMode??q?.crustBlendMode??W?.crustBlendMode??Re?.crustBlendMode,gt),Dn=Math.min(1,Math.max(0,Number(r?.mountainCrustBlendOpacity??rt?.crustBlendOpacity??Ge?.crustBlendOpacity??q?.crustBlendOpacity??W?.crustBlendOpacity??Re?.crustBlendOpacity??Yt))),Ct=Y0(String(r?.mountainTintColor??rt?.tintColor??Ge?.tintColor??q?.tintColor??W?.tintColor??Re?.tintColor??Ae??"#8b6f4a")),ft=Ig(r?.mountainTintBlendMode??rt?.tintBlendMode??Ge?.tintBlendMode??q?.tintBlendMode??W?.tintBlendMode??Re?.tintBlendMode,"soft-light"),tn=Math.min(1,Math.max(0,Number(r?.mountainTintOpacity??rt?.tintOpacity??Ge?.tintOpacity??q?.tintOpacity??W?.tintOpacity??Re?.tintOpacity??0))),Zn=Kw(Ct);return{scale:Dt,offsetX:xt,offsetY:gn,anchorX:bn,anchorY:li,crustBlendMode:Qn,crustBlendOpacity:Dn,tintColor:Ct,tintBlendMode:ft,tintOpacity:tn,tintMatrixValues:`0 0 0 0 ${Zn.r.toFixed(4)} 0 0 0 0 ${Zn.g.toFixed(4)} 0 0 0 0 ${Zn.b.toFixed(4)} 0 0 0 1 0`}},[f,r?.mountainScale,r?.mountainOffset?.x,r?.mountainOffset?.y,r?.mountainAnchor?.x,r?.mountainAnchor?.y,r?.mountainCrustBlendMode,r?.mountainCrustBlendOpacity,r?.mountainTintColor,r?.mountainTintBlendMode,r?.mountainTintOpacity,S?.assetOverrides,W,q,gt,Ae,Yt]),Kt=!!(le&&I!=="off"&&re>0||fe&&K!=="off"&&ce>0||bt),Xn=!!(E&&w!=="off"||R&&H!=="off"||Kt),Ii=N.useMemo(()=>`biome-undercurrent-${n.floor}`,[n.floor]),ri=N.useMemo(()=>`biome-crust-${n.floor}`,[n.floor]),qt=N.useMemo(()=>`biome-crust-mask-${n.floor}`,[n.floor]),fa=N.useMemo(()=>`biome-crust-detail-a-${n.floor}`,[n.floor]),jt=N.useMemo(()=>`biome-crust-detail-b-${n.floor}`,[n.floor]),Ot=!!(R&&H!=="off"||le&&I!=="off"&&re>0||fe&&K!=="off"&&ce>0||bt),Ft=N.useMemo(()=>{const Te=[];for(const Re of e){const Ge=ue(Re),ot=c.get(Ge);if(!ot||!ot.isLava&&!ot.isFire)continue;const{x:rt,y:Dt}=Ee(Re,Q);Te.push({key:Ge,x:rt,y:Dt})}return Te},[e,c]),Jn=N.useMemo(()=>{const Te=Tg({isStairs:!0});return Te?u.get(Te):void 0},[u]),yn=N.useMemo(()=>{const Te=Tg({isShrine:!0});return Te?u.get(Te):void 0},[u]),ma=N.useMemo(()=>{const Te=[];return n.stairsPosition&&Te.push({id:`stairs-${ue(n.stairsPosition)}`,kind:"stairs",position:n.stairsPosition,asset:Jn}),n.shrinePosition&&Te.push({id:`shrine-${ue(n.shrinePosition)}`,kind:"shrine",position:n.shrinePosition,asset:yn}),Te},[n.stairsPosition,n.shrinePosition,Jn,yn]),Ua=N.useMemo(()=>Lg(Q+1),[]),ln=N.useMemo(()=>Lg(Q-2),[]),De=N.useMemo(()=>`biome-map-clip-${n.floor}`,[n.floor]),Ze=N.useMemo(()=>({x:a.minX-Q*2,y:a.minY-Q*2,width:a.width+Q*4,height:a.height+Q*4}),[a.minX,a.minY,a.width,a.height]),at=N.useMemo(()=>{const Te=Math.max(Math.abs(Number(k?.x??0)),Math.abs(Number(k?.y??0)),Math.abs(Number(ae?.x??0)),Math.abs(Number(ae?.y??0)),Math.abs(Number(Ce?.x??0)),Math.abs(Number(Ce?.y??0)),Math.abs(Number(ze?.x??0)),Math.abs(Number(ze?.y??0)));return Math.min(Q*32,Math.max(Q*8,Math.ceil(Te+Q*6)))},[k?.x,k?.y,ae?.x,ae?.y,Ce?.x,Ce?.y,ze?.x,ze?.y]),wn=N.useMemo(()=>({x:Ze.x-at,y:Ze.y-at,width:Ze.width+at*2,height:Ze.height+at*2}),[Ze.x,Ze.y,Ze.width,Ze.height,at]);return{tileVisualFlags:c,assetById:u,deathDecalHref:p,manifestUnitToBoardScale:m,biomeThemeKey:f,biomeSeed:b,clutterLayer:_,wallsProfile:W,wallsThemeOverride:q,boardProps:ma,resolveMountainSettings:en,hybridInteractionLayerEnabled:Xn,backdropLayerProps:{biomeClipId:De,biomeClipPoints:ln,maskHexPoints:Ua,biomeFrame:Ze,biomeCoverFrame:wn,undercurrentHref:E,undercurrentMode:w,undercurrentPatternId:Ii,undercurrentScalePx:M,undercurrentOffset:k,undercurrentScroll:L,undercurrentOpacity:C,crustHref:R,crustMode:H,crustPatternId:ri,crustScalePx:D,crustPatternShift:ae,crustOpacity:$,crustDetailAHref:le,crustDetailAMode:I,crustDetailAPatternId:fa,crustDetailAScalePx:G,crustDetailAShift:Ce,crustDetailAScroll:pe,crustDetailAOpacity:re,crustDetailBHref:fe,crustDetailBMode:K,crustDetailBPatternId:jt,crustDetailBScalePx:ne,crustDetailBShift:ze,crustDetailBScroll:ke,crustDetailBOpacity:ce,crustMaskEnabled:Ot,crustMaskId:qt,crustMaskHoles:Ft,crustTintActive:bt,crustTintColor:Ae,crustTintOpacity:qe,crustTintBlendMode:gt}}},Ww=({gameState:e,playerPos:n,selectedSkillId:a,showMovementRange:s,hoveredTile:r,enginePreviewGhost:c})=>{const u=N.useMemo(()=>{const A={};for(const _ of e.visualEvents||[]){if(_.type!=="kinetic_trace")continue;const E=_.payload;E?.actorId&&(A[E.actorId]=E)}return A},[e.visualEvents]),p=N.useMemo(()=>{if(!s||a)return[];const A=["BASIC_MOVE","DASH"],_=new Set(e.player.activeSkills.map(M=>M.id)),E=new Set,w=[];for(const M of A){if(!_.has(M))continue;const C=yt.get(M);if(!C?.getValidTargets)continue;const L=C.getValidTargets(e,n);for(const k of L){const R=ue(k);E.has(R)||(E.add(R),w.push(k))}}return w},[s,a,e,n]),g=N.useMemo(()=>{const A=new Set;for(const _ of p)A.add(ue(_));return A},[p]),m=N.useMemo(()=>e.player.activeSkills.some(A=>A.id==="BASIC_MOVE"||A.id==="DASH"),[e.player.activeSkills]),f=N.useMemo(()=>ue(e.stairsPosition),[e.stairsPosition]),b=N.useMemo(()=>e.shrinePosition?ue(e.shrinePosition):null,[e.shrinePosition]),S=N.useMemo(()=>{const A=[{q:n.q+1,r:n.r,s:n.s-1},{q:n.q+1,r:n.r-1,s:n.s},{q:n.q,r:n.r-1,s:n.s+1},{q:n.q-1,r:n.r,s:n.s+1},{q:n.q-1,r:n.r+1,s:n.s},{q:n.q,r:n.r+1,s:n.s-1}],_=new Set;for(const E of A)Vl(E.q,E.r,e.gridWidth,e.gridHeight)&&_.add(ue(E));return _},[n,e.gridWidth,e.gridHeight]),T=N.useMemo(()=>{const A=new Set;if(!a)return A;const _=yt.get(a);if(!_?.getValidTargets)return A;const E=_.getValidTargets(e,n);for(const w of E)A.add(ue(w));return A},[a,e,n]),v=N.useMemo(()=>{if(c)return c;if(!r)return null;const A=ue(r);if(s&&!a)return g.has(A)||!m&&S.has(A)?{path:dt(n,r),aoe:[],hasEnemy:!1,target:r}:null;if(!a)return null;const _=e.player.activeSkills.find(C=>C.id===a),E=h_(e,{actorId:e.player.id,skillId:a,target:r,activeUpgrades:_?.activeUpgrades||[]});if(!E.ok)return null;const w=new Map;for(const C of E.simulationEvents)C.position&&(C.type!=="DamageTaken"&&C.type!=="StatusApplied"&&C.type!=="UnitMoved"||w.set(ue(C.position),C.position));const M=E.simulationEvents.some(C=>(C.type==="DamageTaken"||C.type==="StatusApplied")&&!!C.targetId&&C.targetId!==e.player.id);return{path:dt(n,r),aoe:[...w.values()],hasEnemy:M,target:r}},[c,r,s,a,g,m,S,e,n]);return{latestTraceByActor:u,movementTargetSet:g,hasPrimaryMovementSkills:m,stairsKey:f,shrineKey:b,fallbackNeighborSet:S,selectedSkillTargetSet:T,resolvedEnginePreviewGhost:v}},Gw=({gameState:e,deathDecalHref:n,decals:a,setDecals:s,setEntityPoseEffects:r,setEntityPoseNowMs:c,onSimulationEvents:u})=>{const p=N.useRef(null),g=N.useRef(null),m=N.useRef(0),f=N.useRef(0),b=N.useCallback(T=>{if(!T)return null;const v=T.position||T.destination||T.origin||T.target;return v&&typeof v.q=="number"&&typeof v.r=="number"&&typeof v.s=="number"?v:null},[]);return N.useEffect(()=>{if(!n)return;const T=e.timelineEvents||[],v=e.visualEvents||[];if(p.current===T&&g.current===v)return;const A=p.current===T?[]:T;p.current=T;const _=g.current===v?[]:v;g.current=v;const E=[],w=Date.now();for(const M of A){if(M.phase!=="DEATH_RESOLVE")continue;const C=b(M.payload);C&&E.push({id:`decal-tl-${M.id}-${w}-${E.length}`,position:C,href:n,createdAt:w})}for(const M of _){if(M.type!=="vfx")continue;const C=M.payload?.type;if(C!=="vaporize"&&C!=="explosion_ring")continue;const L=b(M.payload);L&&E.push({id:`decal-vx-${C}-${w}-${E.length}`,position:L,href:n,createdAt:w})}E.length>0&&s(M=>[...M,...E].slice(-80))},[e.timelineEvents,e.visualEvents,n,b,s]),N.useEffect(()=>{const T=e.simulationEvents||[];T.length<m.current&&(m.current=0);const v=T.slice(m.current);m.current=T.length,v.length>0&&u?.(v)},[e.simulationEvents,u]),N.useEffect(()=>{const T=e.simulationEvents||[];T.length<f.current&&(f.current=0);const v=T.slice(f.current);if(f.current=T.length,v.length===0)return;const A=Date.now(),_=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]],E=new Map(_.map(C=>[C.id,C])),w=[],M=(C,L,k,R,H,D)=>{C&&w.push({id:`${L}:${C}:${H}`,actorId:C,startTime:H,endTime:H+Math.max(35,D),easing:"out",from:k,to:R})};for(const C of v){if(C.type!=="DamageTaken")continue;const L=String(C.targetId||""),k=L?E.get(L):void 0;if(!k)continue;const R=C.payload||{},H=String(R.reason||"").toLowerCase(),D=String(R.sourceId||"");if(!D||!H||H.includes("basic_attack"))continue;const $=E.get(D);if(!(H.includes("spear")||H.includes("multi_shoot")||H.includes("withdrawal")||$?.subtype==="archer"&&!H.includes("crush")))continue;const te=$?Ee($.position,Q):void 0,ae=Ee(k.position,Q);let W=0,q=1;if(te){const X=ae.x-te.x,le=ae.y-te.y,fe=Math.hypot(X,le);fe>.001&&(W=X/fe,q=le/fe)}const P=$?.subtype==="archer"?10:8,z=100;M(k.id,"projectile-hit",{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:W*P,offsetY:q*P,scaleX:1.02,scaleY:.95},A,z),M(k.id,"projectile-hit-return",{offsetX:W*(P*.35),offsetY:q*(P*.35),scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},A+Math.floor(z*.5),130)}w.length>0&&(c(A),r(C=>[...C,...w]))},[e.simulationEvents,e.player,e.enemies,e.companions,e.dyingEntities,r,c]),N.useEffect(()=>{if(a.length===0)return;const T=12e3,v=window.setTimeout(()=>{const A=Date.now();s(_=>_.filter(E=>A-E.createdAt<T))},1e3);return()=>window.clearTimeout(v)},[a,s]),{resetBoardEventEffects:N.useCallback(()=>{s([]),r([]),c(0),p.current=null,g.current=null,m.current=0,f.current=0},[s,r,c])}},bl=(e,n,a)=>e+(n-e)*a,Xw=e=>1-Math.pow(1-e,3),Jw=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,Qw=({gameState:e,assetById:n,entityPoseEffects:a,entityPoseNowMs:s,onMirrorSnapshot:r})=>{const c=N.useMemo(()=>{const g=new Map;g.set(e.player.id,e.player.position);for(const m of e.enemies)g.set(m.id,m.position);for(const m of e.companions||[])g.set(m.id,m.position);for(const m of e.dyingEntities||[])g.set(m.id,m.position);return g},[e.player.id,e.player.position,e.enemies,e.companions,e.dyingEntities]),u=N.useMemo(()=>[{id:e.player.id,position:e.player.position,subtype:e.player.subtype||"player",assetHref:n.get(la(e.player))?.path,fallbackAssetHref:Ia(e.player)},...e.enemies.map(g=>({id:g.id,position:g.position,subtype:g.subtype,assetHref:n.get(la(g))?.path,fallbackAssetHref:Ia(g)})),...(e.companions||[]).map(g=>({id:g.id,position:g.position,subtype:g.subtype,assetHref:n.get(la(g))?.path,fallbackAssetHref:Ia(g)})),...(e.dyingEntities||[]).map(g=>({id:g.id,position:g.position,subtype:g.subtype,assetHref:n.get(la(g))?.path,fallbackAssetHref:Ia(g)}))],[n,e.player,e.enemies,e.companions,e.dyingEntities]),p=N.useMemo(()=>{const g=new Map,m=s||Date.now();for(const f of a){if(m<f.startTime||m>f.endTime)continue;const b=Math.max(1,f.endTime-f.startTime),S=Math.max(0,Math.min(1,(m-f.startTime)/b)),T=f.easing==="inOut"?Jw(S):Xw(S),v={offsetX:bl(f.from.offsetX,f.to.offsetX,T),offsetY:bl(f.from.offsetY,f.to.offsetY,T),scaleX:bl(f.from.scaleX,f.to.scaleX,T),scaleY:bl(f.from.scaleY,f.to.scaleY,T)},A=g.get(f.actorId);if(!A){g.set(f.actorId,v);continue}g.set(f.actorId,{offsetX:(A.offsetX??0)+(v.offsetX??0),offsetY:(A.offsetY??0)+(v.offsetY??0),scaleX:(A.scaleX??1)*(v.scaleX??1),scaleY:(A.scaleY??1)*(v.scaleY??1)})}return g},[a,s]);return N.useEffect(()=>{if(!r)return;const g={turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:[...c.entries()].map(([m,f])=>({id:m,position:{q:f.q,r:f.r,s:f.s}}))};r(g)},[r,e.turnNumber,e.stackTrace,c]),{actorPositionById:c,juiceActorSnapshots:u,entityVisualPoseById:p}},vl=e=>{if(!e||typeof e.q!="number"||typeof e.r!="number"||typeof e.s!="number")return null;const{x:n,y:a}=Ee(e,Q),s=Math.hypot(n,a);return!Number.isFinite(s)||s<=1e-4?null:{x:n/s,y:a/s}},Sl=e=>{const n=e?.hex;if(n&&typeof n.q=="number"&&typeof n.r=="number"&&typeof n.s=="number")return n},xl=e=>{const n=e?.world;if(n&&typeof n.x=="number"&&typeof n.y=="number")return n},Zw=({gameState:e})=>{const[n,a]=N.useState(!1),[s,r]=N.useState(!1),[c,u]=N.useState({x:0,y:0}),[p,g]=N.useState(!1),[m,f]=N.useState([]),[b,S]=N.useState([]),[T,v]=N.useState(0),A=N.useRef(null),_=N.useRef(null),E=N.useRef(null),w=N.useRef(null);N.useRef(!1),N.useEffect(()=>{},[]),N.useEffect(()=>{const C=e.visualEvents||[];if(E.current===C)return;E.current=C;const L=C;if(L.length===0)return;const k=Date.now(),R=[],H=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]],D=new Map(H.map(te=>[te.id,te])),$=te=>{if(te){for(const ae of H)if(ee(ae.position,te))return ae.id}},J=(te,ae,W,q,P,z,X)=>{te&&R.push({id:`${ae}:${te}:${P}`,actorId:te,startTime:P,endTime:P+Math.max(30,z),easing:X,from:W,to:q})};for(let te=0;te<L.length;te++){const ae=L[te];if(ae.type!=="juice_signature")continue;const W=ae.payload;if(!W||W.protocol!=="juice-signature/v1"||W.signature!=="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"&&W.signature!=="ATK.STRIKE.PHYSICAL.AUTO_ATTACK")continue;const q=String(W.phase||"impact"),P=Sl(W.source),z=Sl(W.target),X=String(W.meta?.sourceId||W.source?.actorId||"")||$(P),le=W.target?.actorId||$(z);if(!P||!z||!X)continue;const fe=Ee(P,Q),I=Ee(z,Q),K=xl(W.contact)||I;let G=K.x-fe.x,ne=K.y-fe.y,re=Math.hypot(G,ne);if(!Number.isFinite(re)||re<.001){const en=vl(W.direction);if(en)G=en.x,ne=en.y,re=1;else{const Kt=Ee(z,Q);G=Kt.x-fe.x,ne=Kt.y-fe.y,re=Math.max(1,Math.hypot(G,ne))}}const ce=G/Math.max(1,re),pe=ne/Math.max(1,re),ke=Math.max(0,Number(W.timing?.delayMs||0)),Se=Math.max(40,Number(W.timing?.durationMs||W.timing?.ttlMs||110)),_e=k+ke,Ce=String(W.meta?.sequenceId||`strike-${k}-${te}`),ze=String(W.intensity||"medium"),$e=W.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK",Ae=ze==="extreme"?16:ze==="high"?13:ze==="low"?8:11,qe=Math.min(Q*($e?.3:.46),re*($e?.22:.32)),gt=Math.min(Q*($e?.55:.82),re*($e?.62:.9)),bt=Math.min(Q*($e?.62:.9),re*($e?.72:.98)),Yt=Math.min(Q*($e?.22:.34),re*($e?.24:.36));if(q==="anticipation"){J(X,`${Ce}:anticipation`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:-ce*qe,offsetY:-pe*qe,scaleX:.92,scaleY:1.08},_e,Se,"out");continue}if(q==="travel"){J(X,`${Ce}:travel`,{offsetX:-ce*qe,offsetY:-pe*qe,scaleX:.94,scaleY:1.06},{offsetX:ce*gt,offsetY:pe*gt,scaleX:1.09,scaleY:.93},_e,Se,"inOut");continue}if(q==="impact"){J(X,`${Ce}:impact-src`,{offsetX:ce*(bt*.92),offsetY:pe*(bt*.92),scaleX:1.06,scaleY:.95},{offsetX:ce*bt,offsetY:pe*bt,scaleX:1.02,scaleY:.98},_e,Se,"out"),J(le,`${Ce}:impact-tgt`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:ce*Ae,offsetY:pe*Ae,scaleX:1.03,scaleY:.94},_e,Se,"out");continue}q==="aftermath"&&(J(X,`${Ce}:after-src`,{offsetX:ce*Yt,offsetY:pe*Yt,scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},_e,Se,"out"),J(le,`${Ce}:after-tgt`,{offsetX:ce*(Ae*.35),offsetY:pe*(Ae*.35),scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},_e,Se,"out"))}for(let te=0;te<L.length;te++){const ae=L[te];if(ae.type!=="juice_signature")continue;const W=ae.payload;if(!W||W.protocol!=="juice-signature/v1")continue;const q=String(W.signature||"");if(String(W.phase||"impact")!=="impact")continue;const z=Math.max(0,Number(W.timing?.delayMs||0)),X=Math.max(45,Number(W.timing?.durationMs||W.timing?.ttlMs||110)),le=k+z,fe=Sl(W.source),I=Sl(W.target),K=xl(W.source),G=xl(W.target),ne=xl(W.contact),re=String(W.meta?.sourceId||W.source?.actorId||""),pe=(re?D.get(re):void 0)?.id||$(fe),ke=W.target?.actorId||$(I),_e=(()=>{const Ce=vl(W.direction);if(Ce)return Ce;const ze=fe?Ee(fe,Q):K,$e=ne||G||(I?Ee(I,Q):void 0);if(ze&&$e){const Ae=$e.x-ze.x,qe=$e.y-ze.y,gt=Math.hypot(Ae,qe);if(gt>.001)return{x:Ae/gt,y:qe/gt}}return null})();if(_e){if(q==="ATK.PULSE.KINETIC.WAVE"){J(pe,`${W.meta?.sequenceId||q}:pulse-caster`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:-_e.x*8,offsetY:-_e.y*8,scaleX:.96,scaleY:1.05},le,Math.max(40,Math.floor(X*.5)),"out"),J(pe,`${W.meta?.sequenceId||q}:pulse-caster-return`,{offsetX:-_e.x*(8*.6),offsetY:-_e.y*(8*.6),scaleX:.98,scaleY:1.02},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},le+Math.floor(X*.45),Math.max(50,Math.floor(X*.65)),"out"),J(ke,`${W.meta?.sequenceId||q}:pulse-target`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:_e.x*10,offsetY:_e.y*10,scaleX:1.03,scaleY:.95},le,X,"out");continue}if(q.startsWith("ENV.COLLISION.KINETIC.")){const Ce=q==="ENV.COLLISION.KINETIC.SHIELD_BASH"?14:10,ze=q==="ENV.COLLISION.KINETIC.SHIELD_BASH"?7:0;ze>0&&J(pe,`${W.meta?.sequenceId||q}:collision-source`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:_e.x*ze,offsetY:_e.y*ze,scaleX:1.03,scaleY:.97},le,Math.max(45,Math.floor(X*.55)),"out"),J(ke,`${W.meta?.sequenceId||q}:collision-target`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:_e.x*Ce,offsetY:_e.y*Ce,scaleX:1.02,scaleY:.92},le,X,"out");continue}}}R.length>0&&(v(k),S(te=>[...te,...R]))},[e.visualEvents,e.player,e.enemies,e.companions,e.dyingEntities]),N.useEffect(()=>{if(typeof window>"u"||b.length===0)return;let C=!1;const L=()=>{if(C)return;const k=Date.now();v(k),S(R=>{const H=R.filter(D=>k<D.endTime+16);return H.length===R.length?R:H}),w.current=window.requestAnimationFrame(L)};return w.current=window.requestAnimationFrame(L),()=>{C=!0,w.current!==null&&(window.cancelAnimationFrame(w.current),w.current=null)}},[b.length]),N.useEffect(()=>{const C=e.visualEvents||[];if(A.current===C)return;A.current=C;const L=C;if(L.length===0)return;let k=0,R=0,H=0,D={x:0,y:0},$=0;const J={low:110,medium:160,high:210,extreme:260},te={light:6,medium:10,heavy:14},ae={light:65,medium:85,heavy:110},W=[],q=I=>{I<=0||(a(!0),W.push(window.setTimeout(()=>a(!1),I)))},P=I=>{I<=0||(r(!0),W.push(window.setTimeout(()=>r(!1),I)))},z=(I,K)=>{K<=0||!I.x&&!I.y||(u(I),W.push(window.setTimeout(()=>u({x:0,y:0}),K)))};for(const I of L){if(I.type==="juice_signature"){const K=I.payload;if(K?.protocol==="juice-signature/v1"){const G=Math.max(0,Number(K.timing?.delayMs||0)),ne=K.camera?.shake,re=Number(K.camera?.freezeMs||0),ce=String(K.camera?.kick||"none"),pe=ce!=="none"?vl(K.direction):null,ke=te[ce]||0,Se=ae[ce]||80;if(G>0&&(ne||re>0||pe&&ke>0)){W.push(window.setTimeout(()=>{ne&&q(J[String(ne)]||160),re>0&&P(Math.min(220,re)),pe&&ke>0&&z({x:pe.x*ke,y:pe.y*ke},Se)},G));continue}if(ne&&(k=Math.max(k,J[String(ne)]||160)),re>0&&(R=Math.max(R,Math.min(220,re))),ce!=="none"){const _e=vl(K.direction),Ce=te[ce]||0;_e&&Ce>0&&Ce>=$&&($=Ce,D={x:_e.x*Ce,y:_e.y*Ce},H=Math.max(H,ae[ce]||80))}continue}}if(I.type==="shake"){const K=String(I.payload?.intensity||"medium");k=Math.max(k,J[K]||160)}else I.type==="freeze"&&(R=Math.max(R,Math.min(220,Math.max(50,Number(I.payload?.durationMs||80)))))}let X,le,fe;return k>0&&(a(!0),X=window.setTimeout(()=>a(!1),k)),R>0&&(r(!0),le=window.setTimeout(()=>r(!1),R)),H>0&&(D.x!==0||D.y!==0)&&(u(D),fe=window.setTimeout(()=>u({x:0,y:0}),H)),()=>{X&&window.clearTimeout(X),le&&window.clearTimeout(le),fe&&window.clearTimeout(fe);for(const I of W)window.clearTimeout(I)}},[e.visualEvents]),N.useEffect(()=>{},[e.visualEvents,p]);const M=N.useCallback(()=>{f([]),a(!1),r(!1),u({x:0,y:0}),S([]),v(0),A.current=null,_.current=null,E.current=null,w.current!==null&&(window.cancelAnimationFrame(w.current),w.current=null)},[]);return{isShaking:n,isFrozen:s,cameraKickOffsetPx:c,juiceDebugOverlayEnabled:p,juiceDebugEntries:m,entityPoseEffects:b,entityPoseNowMs:T,setEntityPoseEffects:S,setEntityPoseNowMs:v,resetBoardJuicePresentation:M}},eM=({visualEvents:e,turnNumber:n,actorPositionById:a,svgRef:s,cancelCameraAnimation:r})=>{const[c,u]=N.useState(!1),p=N.useRef([]),g=N.useRef(!1),m=N.useRef([]),f=N.useRef(0),b=N.useRef(""),S=N.useMemo(()=>(e||[]).filter(w=>w.type==="kinetic_trace").map(w=>w.payload).filter(w=>{if(!w?.actorId||!w.origin||!w.destination)return!1;const M=a.get(w.actorId);return!!M&&ue(M)===ue(w.destination)}),[e,a]),T=N.useMemo(()=>{if(!S.length)return"";const w=n??0,M=S.map(C=>{const L=(C.path||[]).map(k=>`${k.q},${k.r},${k.s}`).join(">");return[C.actorId,`${C.origin.q},${C.origin.r},${C.origin.s}`,`${C.destination.q},${C.destination.r},${C.destination.s}`,C.movementType||"slide",C.startDelayMs||0,C.durationMs||0,L].join("|")}).join("||");return`${w}::${M}`},[S,n]),v=N.useCallback(async(w,M,C,L)=>{if(L!==f.current)return;const k=w.animate(M,{...C,fill:C.fill??"forwards"});m.current.push(k);try{await k.finished}catch{}finally{m.current=m.current.filter(R=>R!==k)}},[]),A=N.useCallback(async(w,M,C)=>{if(M!==f.current)return;const L=.76,k=s.current?.querySelector(`[data-actor-node="${w.actorId}"]`),R=X=>{const le=Ee(X,Q);return`translate(${le.x}px, ${le.y}px)`},H=Math.max(0,w.startDelayMs||0),D=Math.max(0,performance.now()-C),$=Math.round(H*L),J=Math.max(0,$-D),te=w.path&&w.path.length>1?w.path:[w.origin,w.destination],ae=Math.max(1,te.length-1),W=Math.max(90,Math.round((w.durationMs||ae*110)*L));if(!k){const X=Math.max(0,J+W);X>0&&await new Promise(le=>window.setTimeout(le,X));return}if(J>0&&(await new Promise(X=>window.setTimeout(X,J)),M!==f.current))return;if((w.movementType||"slide")==="teleport"){const X=Math.max(100,Math.round((w.durationMs||180)*L));await v(k,[{transform:R(w.origin),opacity:1,offset:0},{transform:R(w.origin),opacity:0,offset:.45},{transform:R(w.destination),opacity:0,offset:.55},{transform:R(w.destination),opacity:1,offset:1}],{duration:X,easing:"linear"},M),M===f.current&&(k.style.transform=R(w.destination),k.style.opacity="1");return}const q=[...te],P=q[q.length-1];(!P||P.q!==w.destination.q||P.r!==w.destination.r||P.s!==w.destination.s)&&q.push(w.destination);const z=q.map((X,le)=>({transform:R(X),offset:q.length===1?1:le/(q.length-1)}));z[z.length-1]={...z[z.length-1],transform:R(w.destination),offset:1},await v(k,z,{duration:W,easing:"linear"},M),M===f.current&&(k.style.transform=R(w.destination),k.style.opacity="1")},[v,s]),_=N.useCallback(async()=>{if(g.current)return;g.current=!0,u(!0);const w=++f.current,M=performance.now();try{for(;p.current.length>0&&w===f.current;){const C=p.current.shift();C&&await A(C,w,M)}}finally{w===f.current&&(g.current=!1,u(!1))}},[A]);N.useEffect(()=>{if(!T){b.current="";return}T!==b.current&&(b.current=T,p.current.push(...S),_())},[T,S,_]);const E=N.useCallback((w=!0)=>{f.current++,p.current=[],g.current=!1,m.current.forEach(M=>{try{M.cancel()}catch{}}),m.current=[],u(!1),w&&(b.current="")},[]);return N.useEffect(()=>()=>{r(),E(!1)},[r,E]),{movementBusy:c,resetMovementPlayback:E}},tM=e=>{const n=[];for(let a=0;a<6;a++){const s=Math.PI/180*(60*a);n.push(`${e*Math.cos(s)},${e*Math.sin(s)}`)}return n.join(" ")},K0=({gameState:e,onMove:n,selectedSkillId:a,showMovementRange:s,onBusyStateChange:r,assetManifest:c,biomeDebug:u,onSimulationEvents:p,onMirrorSnapshot:g,enginePreviewGhost:m,cameraSafeInsetsPx:f})=>{const[b,S]=N.useState(null),[T,v]=N.useState(!1),[A,_]=N.useState([]),E=e.player.position,w=N.useMemo(()=>{let Ct=e.rooms?.[0]?.hexes;if(!Ct||Ct.length===0){Ct=[];for(let ft=0;ft<e.gridWidth;ft++)for(let tn=0;tn<e.gridHeight;tn++)Ct.push({q:ft,r:tn,s:-ft-tn})}return Ct.filter(ft=>Vl(ft.q,ft.r,e.gridWidth,e.gridHeight))},[e.rooms,e.gridWidth,e.gridHeight]),{isShaking:M,isFrozen:C,cameraKickOffsetPx:L,entityPoseEffects:k,entityPoseNowMs:R,setEntityPoseEffects:H,setEntityPoseNowMs:D,resetBoardJuicePresentation:$}=Zw({gameState:e}),J=N.useMemo(()=>{if(w.length===0)return{minX:0,minY:0,width:100,height:100};let Ct=1/0,ft=1/0,tn=-1/0,Zn=-1/0;return w.forEach(ks=>{const{x:$a,y:Rs}=Ee(ks,Q);Ct=Math.min(Ct,$a-Q),ft=Math.min(ft,Rs-Q),tn=Math.max(tn,$a+Q),Zn=Math.max(Zn,Rs+Q)}),{minX:Ct,minY:ft,width:tn-Ct,height:Zn-ft}},[w]),te=N.useMemo(()=>{const{x:Ct,y:ft}=Ee(E,Q);return{x:Ct,y:ft}},[E]),ae=N.useMemo(()=>({x:J.minX,y:J.minY,width:J.width,height:J.height}),[J.minX,J.minY,J.width,J.height]),{svgRef:W,boardViewportRef:q,zoomPreset:P,isCameraPanning:z,setIsCameraPanning:X,cameraPanOffsetRef:le,isCameraPanningRef:fe,isPinchingRef:I,suppressTileClickUntilRef:K,activePointersRef:G,dragStateRef:ne,pinchStateRef:re,cancelCameraAnimation:ce,animateCameraToTarget:pe,updatePanFromWorldDelta:ke,setZoomPresetAnimated:Se,renderedViewBox:_e}=Uw({baseViewBox:ae,playerWorld:te,playerPosition:E,floor:e.floor,cameraSafeInsetsPx:f}),{latestTraceByActor:Ce,movementTargetSet:ze,hasPrimaryMovementSkills:$e,stairsKey:Ae,shrineKey:qe,fallbackNeighborSet:gt,selectedSkillTargetSet:bt,resolvedEnginePreviewGhost:Yt}=Ww({gameState:e,playerPos:E,selectedSkillId:a,showMovementRange:s,hoveredTile:b,enginePreviewGhost:m}),{tileVisualFlags:en,assetById:Kt,deathDecalHref:Xn,manifestUnitToBoardScale:Ii,biomeThemeKey:ri,biomeSeed:qt,clutterLayer:fa,wallsProfile:jt,wallsThemeOverride:Ot,boardProps:Ft,resolveMountainSettings:Jn,hybridInteractionLayerEnabled:yn,backdropLayerProps:ma}=Fw({cells:w,gameState:e,bounds:J,assetManifest:c,biomeDebug:u}),{mountainSettingsByAssetId:Ua,depthSortedSprites:ln,mountainCoveredWallKeys:De}=zw({assetManifest:c,biomeThemeKey:ri,biomeSeed:qt,mountainAssetPathOverride:u?.mountainAssetPath,wallsMountainPath:jt?.mountainPath,wallsThemeMountainPath:Ot?.mountainPath,clutterLayer:fa,cells:w,tileVisualFlags:en,boardProps:Ft,resolveMountainSettings:Jn}),{resetBoardEventEffects:Ze}=Gw({gameState:e,deathDecalHref:Xn,decals:A,setDecals:_,setEntityPoseEffects:H,setEntityPoseNowMs:D,onSimulationEvents:p}),{handleResetView:at,handleTileClick:wn,handleHoverTile:Te,handleBoardPointerDown:Re,handleBoardPointerMove:Ge,handleBoardPointerUp:ot,handleBoardPointerCancel:rt,handleBoardWheel:Dt}=kw({svgRef:W,onMove:n,zoomPreset:P,setHoveredTile:S,setIsCameraPanning:X,cameraPanOffsetRef:le,isCameraPanningRef:fe,isPinchingRef:I,suppressTileClickUntilRef:K,activePointersRef:G,dragStateRef:ne,pinchStateRef:re,animateCameraToTarget:pe,updatePanFromWorldDelta:ke,setZoomPresetAnimated:Se}),{actorPositionById:xt,juiceActorSnapshots:gn,entityVisualPoseById:bn}=Qw({gameState:e,assetById:Kt,entityPoseEffects:k,entityPoseNowMs:R,onMirrorSnapshot:g}),{movementBusy:li,resetMovementPlayback:Qn}=eM({visualEvents:e.visualEvents,turnNumber:e.turnNumber,actorPositionById:xt,svgRef:W,cancelCameraAnimation:ce});N.useEffect(()=>{r?.(li||T)},[li,T,r]),N.useLayoutEffect(()=>{ce(),Qn(),Ze(),$()},[e.floor,ce,Qn,Ze,$]);const Dn=N.useMemo(()=>tM(Q-1),[]);return y.jsxs("div",{ref:q,className:`relative w-full h-full flex justify-center items-center overflow-hidden transition-transform duration-75 ${M?"animate-shake":""} ${z?"cursor-grabbing":""}`,children:[y.jsxs("div",{className:"relative w-full h-full",style:{transform:`translate3d(${L.x}px, ${L.y}px, 0)`,transition:"transform 85ms ease-out",willChange:L.x||L.y?"transform":void 0},children:[C&&y.jsx("div",{className:"absolute inset-0 z-20 pointer-events-none bg-white/10",style:{boxShadow:"inset 0 0 60px rgba(255,255,255,0.18)",animation:"flash 120ms ease-out"}}),y.jsxs("svg",{ref:W,width:"100%",height:"100%",viewBox:`${_e.x} ${_e.y} ${_e.width} ${_e.height}`,preserveAspectRatio:"xMidYMid meet",shapeRendering:"geometricPrecision",className:"max-h-full max-w-full",onMouseLeave:()=>S(null),onWheel:Dt,onPointerDown:Re,onPointerMove:Ge,onPointerUp:ot,onPointerCancel:rt,style:{touchAction:"none"},children:[y.jsx(Nw,{cells:w,...ma}),y.jsx(ww,{gameState:e,selectedSkillId:a,showMovementRange:s,hoveredTile:b,enginePreviewGhost:Yt,cells:w,tileVisualFlags:en,movementTargetSet:ze,hasPrimaryMovementSkills:$e,fallbackNeighborSet:gt,selectedSkillTargetSet:bt,stairsKey:Ae,shrineKey:qe,mountainCoveredWallKeys:De,hybridInteractionLayerEnabled:yn,assetById:Kt,onTileClick:wn,onTileHover:Te,decals:A}),y.jsx(Cw,{sprites:ln,floor:e.floor,manifestUnitToBoardScale:Ii,mountainSettingsByAssetId:Ua,resolveMountainSettings:Jn}),y.jsx(vw,{gameState:e,latestTraceByActor:Ce,entityVisualPoseById:bn,assetById:Kt,biomeThemeKey:ri,juiceActorSnapshots:gn,assetManifest:c,onJuiceBusyStateChange:v}),y.jsx(Mw,{cells:w,gridPoints:Dn}),y.jsx(j_,{boardProps:Ft})]})]}),!1,y.jsx(P_,{presets:Rw,activePreset:P,onSelectPreset:Se,onResetView:at})]})},nM=({theme:e,previewState:n,previewManifest:a})=>y.jsxs("main",{className:"flex-1 relative bg-[#050914] overflow-hidden",children:[y.jsxs("div",{className:"absolute top-4 right-5 z-20 px-3 py-2 rounded-lg border border-white/15 bg-black/35 text-[10px] font-black uppercase tracking-[0.2em]",children:["Theme: ",e]}),y.jsx("div",{className:"w-full h-full p-6",children:y.jsx("div",{className:"w-full h-full rounded-[28px] border border-white/10 bg-[#030712]/70 overflow-hidden",children:y.jsx(K0,{gameState:n,onMove:()=>{},selectedSkillId:null,showMovementRange:!1,assetManifest:a})})})]}),Al="/Hop",Bg=64,Hg=192,Tl=64,El=512,pt=(e,n,a)=>Math.min(a,Math.max(n,e)),iM=(e,n)=>`${e.endsWith("/")?e:`${e}/`}${n.replace(/^\/+/,"")}`,Ro=e=>{const n=e.trim();if(!n||/^\/assets\/[a-z0-9/_\-.]+$/i.test(n))return n;const s=`${Al.endsWith("/")?Al:`${Al}/`}assets/`;return n.startsWith(s)?`/assets/${n.slice(s.length)}`:n.startsWith("/")?n:iM(Al,n)},_l=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,u,p]=a.slice(1).split("");return`#${c}${c}${u}${u}${p}${p}`.toLowerCase()}return n},Wd=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",wl=e=>e==="off"?"off":Wd(e),aM=e=>{const n=e.theme.toLowerCase(),a=Ro(e.undercurrent.path),s=Ro(e.crust.path),r=Ro(e.materials.detailA.path),c=Ro(e.materials.detailB.path),p={mountainPath:Ro(e.walls.mountainPath),mountainScale:pt(e.walls.mountainScale,.2,3),mountainOffsetX:e.walls.mountainOffsetX,mountainOffsetY:e.walls.mountainOffsetY,mountainAnchorX:pt(e.walls.mountainAnchorX,0,1),mountainAnchorY:pt(e.walls.mountainAnchorY,0,1),mountainCrustBlendMode:wl(e.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:pt(e.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:_l(e.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:wl(e.walls.mountainTintBlendMode),mountainTintOpacity:pt(e.walls.mountainTintOpacity,0,1),scale:pt(e.walls.mountainScale,.2,3),offsetX:e.walls.mountainOffsetX,offsetY:e.walls.mountainOffsetY,anchorX:pt(e.walls.mountainAnchorX,0,1),anchorY:pt(e.walls.mountainAnchorY,0,1),crustBlendMode:wl(e.walls.mountainCrustBlendMode),crustBlendOpacity:pt(e.walls.mountainCrustBlendOpacity,0,1),tintColor:_l(e.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:wl(e.walls.mountainTintBlendMode),tintOpacity:pt(e.walls.mountainTintOpacity,0,1)},g={seed:e.seed.trim()||"biome-sandbox-seed",injectHazards:e.injectHazards,biomeLayers:{undercurrent:{default:a,mode:e.undercurrent.mode,scalePx:pt(e.undercurrent.scalePx,Bg,Hg),opacity:pt(e.undercurrent.opacity,0,1),offsetX:e.undercurrent.offsetX,offsetY:e.undercurrent.offsetY,scroll:{x:e.undercurrent.scrollX,y:e.undercurrent.scrollY,durationMs:Math.max(1e3,e.undercurrent.scrollDurationMs)}},crust:{default:s,mode:e.crust.mode,scalePx:Math.max(64,e.crust.scalePx),opacity:1,seedShiftPx:e.crust.seedShiftPx,offsetX:e.crust.offsetX,offsetY:e.crust.offsetY},clutter:{density:e.clutter.density,maxPerHex:e.clutter.maxPerHex,bleedScaleMax:e.clutter.bleedScaleMax}},walls:{mode:e.walls.mode,interiorDensity:e.walls.interiorDensity,clusterBias:e.walls.clusterBias,keepPerimeter:e.walls.keepPerimeter,...p},biomeMaterials:{crust:{detailA:{default:r,mode:e.materials.detailA.mode,scalePx:pt(e.materials.detailA.scalePx,Tl,El),opacity:pt(e.materials.detailA.opacity,0,1)},detailB:{default:c,mode:e.materials.detailB.mode,scalePx:pt(e.materials.detailB.scalePx,Tl,El),opacity:pt(e.materials.detailB.opacity,0,1)},tint:{default:_l(e.materials.tintColor,"#8b6f4a"),opacity:pt(e.materials.tintOpacity,0,1),blendMode:Wd(e.materials.tintBlend)}}}};return{theme:e.theme,seed:e.seed.trim()||"biome-sandbox-seed",injectHazards:e.injectHazards,biomeLayers:{undercurrent:{default:a,mode:e.undercurrent.mode,scalePx:pt(e.undercurrent.scalePx,Bg,Hg),opacity:pt(e.undercurrent.opacity,0,1),offsetX:e.undercurrent.offsetX,offsetY:e.undercurrent.offsetY,scroll:{x:e.undercurrent.scrollX,y:e.undercurrent.scrollY,durationMs:Math.max(1e3,e.undercurrent.scrollDurationMs)}},crust:{default:s,mode:e.crust.mode,scalePx:Math.max(64,e.crust.scalePx),opacity:1,seedShiftPx:e.crust.seedShiftPx,offsetX:e.crust.offsetX,offsetY:e.crust.offsetY},clutter:{density:e.clutter.density,maxPerHex:e.clutter.maxPerHex,bleedScaleMax:e.clutter.bleedScaleMax}},walls:{mode:e.walls.mode,interiorDensity:e.walls.interiorDensity,clusterBias:e.walls.clusterBias,keepPerimeter:e.walls.keepPerimeter,...p,themes:{[n]:p}},biomeMaterials:{crust:{detailA:{default:r,mode:e.materials.detailA.mode,scalePx:pt(e.materials.detailA.scalePx,Tl,El),opacity:pt(e.materials.detailA.opacity,0,1)},detailB:{default:c,mode:e.materials.detailB.mode,scalePx:pt(e.materials.detailB.scalePx,Tl,El),opacity:pt(e.materials.detailB.opacity,0,1)},tint:{default:_l(e.materials.tintColor,"#8b6f4a"),opacity:pt(e.materials.tintOpacity,0,1),blendMode:Wd(e.materials.tintBlend)}}},biomePresets:{[n]:g}}},sM=e=>N.useMemo(()=>{const n=new Set,a=new Set,s=new Set,r=new Set;if(!e)return{undercurrent:[],crust:[],detail:[],mountain:[]};const c=u=>{if(u){u.default&&(n.add(u.default),a.add(u.default),s.add(u.default));for(const p of Object.values(u.themes||{}))n.add(p),a.add(p),s.add(p)}};c(e.biomeLayers?.undercurrent),c(e.biomeLayers?.crust);for(const u of Object.values(e.biomePresets||{}))c(u?.biomeLayers?.undercurrent),c(u?.biomeLayers?.crust),u?.biomeMaterials?.crust?.detailA&&c(u.biomeMaterials.crust.detailA),u?.biomeMaterials?.crust?.detailB&&c(u.biomeMaterials.crust.detailB);if(e.biomeUnderlay){e.biomeUnderlay.default&&a.add(e.biomeUnderlay.default);for(const u of Object.values(e.biomeUnderlay.themes||{}))a.add(u)}e.biomeMaterials?.crust?.detailA&&c(e.biomeMaterials.crust.detailA),e.biomeMaterials?.crust?.detailB&&c(e.biomeMaterials.crust.detailB);for(const u of e.assets||[]){const p=new Set((u.tags||[]).map(m=>m.toLowerCase())),g=u.type==="prop"&&(u.id.toLowerCase().includes("mountain")||p.has("mountain"));(p.has("floor")||p.has("stone")||p.has("void")||p.has("frozen")||p.has("inferno"))&&(a.add(u.path),s.add(u.path)),(p.has("lava")||p.has("hazard")||p.has("fire")||p.has("quicksand"))&&n.add(u.path),(u.type==="decal"||u.type==="prop"||u.type==="tile")&&s.add(u.path),g&&r.add(u.path)}e.walls?.mountainPath&&r.add(e.walls.mountainPath);for(const u of Object.values(e.walls?.themes||{}))u?.mountainPath&&r.add(u.mountainPath);for(const u of Object.values(e.biomePresets||{})){u?.walls?.mountainPath&&r.add(u.walls.mountainPath);for(const p of Object.values(u?.walls?.themes||{}))p?.mountainPath&&r.add(p.mountainPath)}return{undercurrent:Array.from(n).sort((u,p)=>u.localeCompare(p)),crust:Array.from(a).sort((u,p)=>u.localeCompare(p)),detail:Array.from(s).sort((u,p)=>u.localeCompare(p)),mountain:Array.from(r).sort((u,p)=>u.localeCompare(p))}},[e]),Pg="hop_biome_sandbox_settings_v1",F0=64,W0=192,ql=64,zl=512,oM=[{q:1,r:0,s:-1},{q:0,r:1,s:-1},{q:-1,r:1,s:0},{q:-1,r:0,s:1},{q:0,r:-1,s:1},{q:1,r:-1,s:0}],Ll=(e,n="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[c,u,p]=a.slice(1).split("");return`#${c}${c}${u}${u}${p}${p}`.toLowerCase()}return n},rM=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n=Math.imul(n,16777619);return n>>>0},jg=e=>rM(e)/4294967295,G0=e=>e.has("BLOCKS_MOVEMENT")&&e.has("BLOCKS_LOS"),lM=e=>e.has("LAVA")||e.has("FIRE")||e.has("HAZARDOUS")&&e.has("LIQUID"),uf=e=>oM.map(n=>ue({q:e.q+n.q,r:e.r+n.r,s:e.s+n.s})),cM=e=>{const n=new Set;for(const[a,s]of e.entries())uf(s.position).some(c=>!e.has(c))&&n.add(a);return n},uM=(e,n,a)=>{const s=new Set,r=[{point:n,depth:0}];for(;r.length>0;){const c=r.shift(),u=ue(c.point);if(!s.has(u)&&e.has(u)&&(s.add(u),!(c.depth>=a)))for(const p of uf(c.point)){const g=e.get(p);g&&r.push({point:g.position,depth:c.depth+1})}}return s},kd=(e,n,a)=>{const s=e.get(n);if(!s)return;const r=new Set(Array.from(s.traits));a?(r.add("BLOCKS_MOVEMENT"),r.add("BLOCKS_LOS"),r.delete("LAVA"),r.delete("FIRE"),r.delete("LIQUID"),r.delete("HAZARDOUS")):(r.delete("BLOCKS_MOVEMENT"),r.delete("BLOCKS_LOS")),e.set(n,{...s,traits:r})},Fe=(e,n,a)=>Math.min(a,Math.max(n,e)),Ml=(e,n)=>e?n&&e.themes?.[n]?e.themes[n]:e.default||"":"",Ol=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"repeat":"off",dM=(e,n)=>e?n&&e.themes?.[n]?e.themes[n]:e.default||"#8b6f4a":"#8b6f4a",df=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",Gd=e=>e==="off"?"off":df(e),Rd=(e,n,a,s)=>{const r=e?.[a]??e?.[s];return r!==void 0?r:n?.[a]??n?.[s]},fM=e=>{switch(e){case"inferno":return 4;case"throne":return 6;case"frozen":return 8;case"void":return 10;default:return 1}},mM=e=>{const n=new Map;for(const[a,s]of e.tiles.entries())n.set(a,{...s,traits:new Set(s.traits),effects:Array.isArray(s.effects)?[...s.effects]:[]});return n},pM=(e,n)=>{const a=(c,u,p)=>{const m=ue({q:c,r:u}),f=e.get(m);if(!f)return;const b=new Set(Array.from(f.traits));if(!G0(b)){for(const S of p)b.add(S);e.set(m,{...f,traits:b})}},s=[[0,0],[1,0],[0,1],[-1,1],[-1,0],[0,-1],[1,-1],[2,-1],[2,0],[1,1],[-2,1],[-2,0],[-1,-1]];for(const[c,u]of s)a(n.q+c,n.r+u,["HAZARDOUS","LIQUID","LAVA"]);const r=[[3,-1],[3,0],[2,1],[-3,1],[-3,0],[-2,-1]];for(const[c,u]of r)a(n.q+c,n.r+u,["HAZARDOUS","FIRE"])},hM=(e,n,a,s)=>{const r=s.mode,c=cM(e),u=uM(e,a,2),p=Array.from(e.keys()).sort((T,v)=>T.localeCompare(v));if(r==="custom")for(const T of p){if(u.has(T)){kd(e,T,!1);continue}const v=s.keepPerimeter&&c.has(T);kd(e,T,v)}if(r==="native")return;const g=Fe(Number(s.interiorDensity||0),0,.45),m=Fe(Number(s.clusterBias||0),0,1);if(g<=0&&m<=0)return;const f=p.filter(T=>{if(c.has(T)||u.has(T))return!1;const v=e.get(T);if(!v)return!1;const A=v.traits;return!lM(A)}),b=T=>{const v=e.get(T);return v?G0(v.traits):!1},S=new Set;for(const T of f){if(b(T))continue;jg(`${n}|sandbox-wall-seed|${T}`)<g&&S.add(T)}for(let T=0;T<2;T++)for(const v of f){if(b(v)||S.has(v))continue;const A=e.get(v);if(!A)continue;const _=uf(A.position).filter(C=>e.has(C));let E=0;for(const C of _)(b(C)||S.has(C))&&E++;if(E===0)continue;const w=m*(E/6);jg(`${n}|sandbox-wall-grow|pass:${T}|${v}`)<w&&S.add(v)}for(const T of S)kd(e,T,!0)},yM=(e,n,a,s)=>{const r=fM(e),c=n.trim()||"biome-sandbox-seed",u=Da(r,c,c,void 0,oi.VANGUARD),p=mM(u);return hM(p,c,u.player.position,s),a&&pM(p,u.player.position),{...u,floor:r,theme:e,rngSeed:c,initialSeed:c,turnNumber:1,tiles:p,visualEvents:[],timelineEvents:[],intentPreview:void 0}},Dg=(e,n)=>{const a=n.toLowerCase(),s=lf(e,a),r=s?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,c=s?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),u=s?.biomeMaterials?.crust??e.biomeMaterials?.crust,p=u?.detailA,g=u?.detailB,m=u?.tint,f=s?.walls||e.walls,b=s?.walls?s.walls:e.walls?.themes?.[a],S=(e.assets||[]).filter(k=>{if(k.type!=="prop")return!1;const R=k.id.toLowerCase(),H=new Set((k.tags||[]).map($=>$.toLowerCase()));if(!R.includes("mountain")&&!H.has("mountain"))return!1;if(!k.theme)return!0;const D=k.theme.toLowerCase();return D===a||D==="core"}).sort((k,R)=>k.id.localeCompare(R.id)),v=String(b?.mountainPath??f?.mountainPath??"").trim()||S.find(k=>k.path.toLowerCase().includes("biome.volcano.mountain.03.webp"))?.path||S[0]?.path||"",A=S.find(k=>k.path===v)||S[0],_=A?.mountainSettings,E=A?.mountainSettingsByTheme?.[a],w=A?s?.assetOverrides?.[A.id]?.mountainSettings:void 0,M=(k,R,H)=>{const $=Rd(b,f,k,R)??w?.[k]??E?.[k]??_?.[k]??H,J=Number($);return Number.isFinite(J)?J:H},C=(k,R,H)=>{const $=Rd(b,f,k,R)??w?.[k]??E?.[k]??_?.[k]??H;return Gd($)},L=(k,R,H)=>{const $=Rd(b,f,k,R)??w?.[k]??E?.[k]??_?.[k]??H;return Ll(String($||""),H)};return{theme:n,seed:String(s?.seed||"biome-sandbox-seed"),injectHazards:s?.injectHazards!==void 0?!!s.injectHazards:!0,undercurrent:{path:Ml(r,a),mode:Ol(r),scalePx:Fe(Number(r?.scalePx??e.tileUnitPx??256),F0,W0),opacity:Fe(Number(r?.opacity??.6),0,1),scrollX:Number(r?.scroll?.x??120),scrollY:Number(r?.scroll?.y??90),scrollDurationMs:Math.max(1e3,Number(r?.scroll?.durationMs??92e3)),offsetX:Number(r?.offsetX??0),offsetY:Number(r?.offsetY??0)},crust:{path:Ml(c,a),mode:Ol(c),scalePx:Math.max(64,Number(c?.scalePx??e.tileUnitPx??256)),opacity:1,seedShiftPx:Math.max(0,Number(c?.seedShiftPx??96)),offsetX:Number(c?.offsetX??0),offsetY:Number(c?.offsetY??0)},clutter:{density:Fe(Number((s?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.density??.14),0,1),maxPerHex:Math.max(0,Number((s?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.maxPerHex??1)),bleedScaleMax:Fe(Number((s?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.bleedScaleMax??2),1,2)},walls:{mode:f?.mode==="native"||f?.mode==="additive"||f?.mode==="custom"?f.mode:"custom",interiorDensity:Fe(Number(f?.interiorDensity??.05),0,.45),clusterBias:Fe(Number(f?.clusterBias??0),0,1),keepPerimeter:f?.keepPerimeter!==void 0?!!f.keepPerimeter:!0,mountainPath:v,mountainScale:Fe(M("scale","mountainScale",.53),.2,3),mountainOffsetX:M("offsetX","mountainOffsetX",0),mountainOffsetY:M("offsetY","mountainOffsetY",0),mountainAnchorX:Fe(M("anchorX","mountainAnchorX",.5),0,1),mountainAnchorY:Fe(M("anchorY","mountainAnchorY",.55),0,1),mountainCrustBlendMode:C("crustBlendMode","mountainCrustBlendMode","multiply"),mountainCrustBlendOpacity:Fe(M("crustBlendOpacity","mountainCrustBlendOpacity",1),0,1),mountainTintColor:L("tintColor","mountainTintColor","#7d7d7d"),mountainTintBlendMode:C("tintBlendMode","mountainTintBlendMode","overlay"),mountainTintOpacity:Fe(M("tintOpacity","mountainTintOpacity",1),0,1)},materials:{detailA:{path:Ml(p,a),mode:Ol(p),scalePx:Fe(Number(p?.scalePx??192),ql,zl),opacity:Fe(Number(p?.opacity??0),0,1)},detailB:{path:Ml(g,a),mode:Ol(g),scalePx:Fe(Number(g?.scalePx??256),ql,zl),opacity:Fe(Number(g?.opacity??0),0,1)},tintColor:dM(m,a),tintOpacity:Fe(Number(m?.opacity??0),0,1),tintBlend:df(m?.blendMode)}}},gM=e=>{if(!e)return null;try{const n=JSON.parse(e);return!n||typeof n!="object"?null:n}catch{return null}},Ug=(e,n)=>{const a=Number(e);return Number.isFinite(a)?a:n},bM=({assetManifest:e,onBack:n})=>{const a=N.useRef(!1),[s,r]=N.useState(""),[c,u]=N.useState(null);N.useEffect(()=>{if(!e||a.current)return;const v=Dg(e,"inferno"),A=gM(localStorage.getItem(Pg));if(!A){u(v),a.current=!0;return}u({...v,...A,undercurrent:{...v.undercurrent,...A.undercurrent||{},scalePx:Fe(Number((A.undercurrent||{}).scalePx??v.undercurrent.scalePx),F0,W0)},crust:{...v.crust,...A.crust||{},opacity:1},clutter:{...v.clutter,...A.clutter||{}},walls:{...v.walls,...A.walls||{},mode:(A.walls||{}).mode==="native"||(A.walls||{}).mode==="additive"||(A.walls||{}).mode==="custom"?(A.walls||{}).mode:v.walls.mode,interiorDensity:Fe(Number((A.walls||{}).interiorDensity??v.walls.interiorDensity),0,.45),clusterBias:Fe(Number((A.walls||{}).clusterBias??v.walls.clusterBias),0,1),keepPerimeter:(A.walls||{}).keepPerimeter!==void 0?!!(A.walls||{}).keepPerimeter:v.walls.keepPerimeter,mountainPath:String((A.walls||{}).mountainPath||v.walls.mountainPath||""),mountainScale:Fe(Number((A.walls||{}).mountainScale??v.walls.mountainScale),.2,3),mountainOffsetX:Ug(String((A.walls||{}).mountainOffsetX??v.walls.mountainOffsetX),v.walls.mountainOffsetX),mountainOffsetY:Ug(String((A.walls||{}).mountainOffsetY??v.walls.mountainOffsetY),v.walls.mountainOffsetY),mountainAnchorX:Fe(Number((A.walls||{}).mountainAnchorX??v.walls.mountainAnchorX),0,1),mountainAnchorY:Fe(Number((A.walls||{}).mountainAnchorY??v.walls.mountainAnchorY),0,1),mountainCrustBlendMode:Gd((A.walls||{}).mountainCrustBlendMode??v.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:Fe(Number((A.walls||{}).mountainCrustBlendOpacity??v.walls.mountainCrustBlendOpacity),0,1),mountainTintColor:Ll(String((A.walls||{}).mountainTintColor??v.walls.mountainTintColor),v.walls.mountainTintColor),mountainTintBlendMode:Gd((A.walls||{}).mountainTintBlendMode??v.walls.mountainTintBlendMode),mountainTintOpacity:Fe(Number((A.walls||{}).mountainTintOpacity??v.walls.mountainTintOpacity),0,1)},materials:{...v.materials,...A.materials||{},detailA:{...v.materials.detailA,...(A.materials||{}).detailA||{},scalePx:Fe(Number(((A.materials||{}).detailA||{}).scalePx??v.materials.detailA.scalePx),ql,zl),opacity:Fe(Number(((A.materials||{}).detailA||{}).opacity??v.materials.detailA.opacity),0,1)},detailB:{...v.materials.detailB,...(A.materials||{}).detailB||{},scalePx:Fe(Number(((A.materials||{}).detailB||{}).scalePx??v.materials.detailB.scalePx),ql,zl),opacity:Fe(Number(((A.materials||{}).detailB||{}).opacity??v.materials.detailB.opacity),0,1)},tintOpacity:Fe(Number((A.materials||{}).tintOpacity??v.materials.tintOpacity),0,1),tintBlend:df((A.materials||{}).tintBlend)}}),a.current=!0},[e]),N.useEffect(()=>{c&&localStorage.setItem(Pg,JSON.stringify(c))},[c]);const p=c?.theme?.toLowerCase()||"inferno",g=N.useMemo(()=>Ll(c?.materials.tintColor||"#8b6f4a"),[c?.materials.tintColor]),m=N.useMemo(()=>Ll(c?.walls.mountainTintColor||"#8b6f4a"),[c?.walls.mountainTintColor]),f=sM(e),b=N.useMemo(()=>H_(e,c,p),[e,c,p]),S=N.useMemo(()=>c?yM(c.theme,c.seed,c.injectHazards,c.walls):null,[c]),T=async()=>{if(!c)return;const v=aM(c);try{await navigator.clipboard.writeText(JSON.stringify(v,null,2)),r("Copied"),window.setTimeout(()=>r(""),1600)}catch{r("Copy failed"),window.setTimeout(()=>r(""),1600)}};return!e||!c||!b||!S?y.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex items-center justify-center",children:[y.jsx("button",{type:"button",onClick:n,className:"absolute top-5 left-5 px-4 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-[0.2em]",children:"Back"}),y.jsx("div",{className:"text-sm text-white/70 uppercase tracking-[0.25em] font-black",children:"Loading Biome Sandbox..."})]}):y.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex",children:[y.jsx(E_,{settings:c,setSettings:u,pathSets:f,copyStatus:s,onBack:n,onReset:()=>u(Dg(e,c.theme)),onCopySettings:T,tintPickerColor:g,mountainTintPickerColor:m}),y.jsx(nM,{theme:c.theme,previewState:S,previewManifest:b})]})},vM=()=>{const[e,n]=N.useState(null);return N.useEffect(()=>{let a=!0;return I_().then(s=>{a&&(n(s),window.__HOP_ASSET_MANIFEST=s)}),()=>{a=!1}},[]),e},SM=e=>{N.useEffect(()=>{if(!(typeof window<"u"&&!!window.__HOP_DEBUG_PERF))return;let a=0,s=performance.now(),r=0,c=0,u=s;const p=g=>{const m=g-s;if(s=g,r++,c+=m,g-u>=2e3){const f=c/Math.max(1,r),b=1e3/Math.max(1,f);console.log("[HOP_PERF]",{fps:Number(b.toFixed(1)),avgFrameMs:Number(f.toFixed(2)),frames:r}),u=g,r=0,c=0}a=requestAnimationFrame(p)};return a=requestAnimationFrame(p),()=>cancelAnimationFrame(a)},e)},xM=(e,n)=>{N.useEffect(()=>{n&&(window.state=e,window.QUERY={tile:(a,s)=>{const c=ue({q:a,r:s});return console.log(`Checking Map for Key: "${c}"`),e.tiles.get(c)},whereAmI:()=>{const a=e.player.position,s=ue(a),r=e.tiles.get(s);return{coords:a,key:s,tileExists:!!r,tileData:r}},dumpKeys:()=>Array.from(e.tiles.keys())})},[e,n])},AM=e=>{const[n,a]=N.useState(null),s=N.useRef(null);return N.useEffect(()=>{if(e.gameStatus!=="playing"||s.current===e.floor)return;a({floor:e.floor,theme:e.theme||"Inferno"}),s.current=e.floor;const r=setTimeout(()=>a(null),3e3);return()=>clearTimeout(r)},[e.floor,e.gameStatus,e.theme]),n},TM=e=>e instanceof Map?e:Array.isArray(e)?new Map(e):e&&typeof e=="object"?new Map(Object.entries(e)):new Map,$g=e=>{const n={...e,components:TM(e?.components)},a=Lo(n),r=(a.components??new Map).get("trinity");if(!r)return a;const c=Kl({body:Number(r.body||0),mind:Number(r.mind||0),instinct:Number(r.instinct||0)});return{...a,maxHp:c,hp:Math.min(c,Math.max(0,Number(a.hp??c)))}},EM=()=>{const e=localStorage.getItem("hop_save");if(!e)return Dl();try{const n=JSON.parse(e);if(n.tiles){const a=Array.isArray(n.tiles)?n.tiles:Object.entries(n.tiles);n.tiles=new Map(a.map(([s,r])=>[s,{...r,traits:new Set(r.traits)}]))}return Array.isArray(n.occupancyMask)&&(n.occupancyMask=n.occupancyMask.map(a=>typeof a=="string"?BigInt(a):a)),n.player=af($g(n.player)),n.enemies=Array.isArray(n.enemies)?n.enemies.map($g):[],n}catch(n){return console.error("Failed to hydrate Map state:",n),Dl()}},_M=()=>{const[e,n]=N.useReducer(c_,null,EM),a=N.useRef(null),s=N.useRef(""),r=e.gameStatus==="playing"||e.gameStatus==="choosing_upgrade",c=`${e.gameStatus}|${e.floor}|${e.turnNumber}|${e.player.hp}|${ue(e.player.position)}|${e.enemies.length}|${e.actionLog?.length??0}|${e.message?.length??0}`;return N.useEffect(()=>{if(a.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(a.current):window.clearTimeout(a.current),a.current=null),!r){s.current="",localStorage.removeItem("hop_save");return}if(c===s.current)return;const u=()=>{const p={...e,tiles:Array.from(e.tiles.entries()).map(([m,f])=>[m,{...f,traits:Array.from(f.traits)}])},g=m=>JSON.stringify(m,(f,b)=>typeof b=="bigint"?b.toString():b);localStorage.setItem("hop_save",g(p)),s.current=c,a.current=null};return typeof window.requestIdleCallback=="function"?a.current=window.requestIdleCallback(u,{timeout:500}):a.current=window.setTimeout(u,120),()=>{a.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(a.current):window.clearTimeout(a.current),a.current=null)}},[e,r,c]),[e,n]},wM=({dispatchWithTrace:e})=>{const[n,a]=N.useState(!1),[s,r]=N.useState([]),[c,u]=N.useState(!1),[p,g]=N.useState(null),m=N.useRef(0),f=N.useCallback(()=>{u(!1),a(!1),g(null),r([]),m.current=0},[]),b=N.useCallback(T=>{if(!T)return;const v=j0(T.actions||[]);if(!v.valid){const w=`Replay rejected: ${v.errors.slice(0,3).join(" | ")}`;g(w),console.error("[HOP_REPLAY] Invalid replay actions",{replayId:T.id,errors:v.errors});return}g(null),a(!0),r(v.actions),u(!1),m.current=0;const A=T.seed||T.id||String(Date.now()),_=T.loadoutId?oi[T.loadoutId]:void 0,E=Da(1,A,A,void 0,_);e({type:"LOAD_STATE",payload:E},"replay_start")},[e]),S=N.useCallback(()=>{const T=m.current;if(T>=s.length){u(!1);return}e(s[T],"replay_step"),m.current=T+1},[e,s]);return N.useEffect(()=>{if(!c||!n)return;const T=window.setInterval(S,500);return()=>window.clearInterval(T)},[c,n,S]),{isReplayMode:n,replayActions:s,replayActive:c,replayError:p,replayIndexRef:m,setReplayActive:u,resetReplayUi:f,startReplay:b,stepReplay:S}},MM=(e,n)=>{const a=new Set(e.map(p=>p.type)),s=a.has("ADVANCE_TURN"),r=a.has("RESOLVE_PENDING"),c=e.length,u=n>=5&&c<Math.max(25,n*4);return{actionCount:c,hasTurnAdvance:s,hasPendingResolve:r,suspiciouslyShort:u}},qg="hop_replays_v1",zg="hop_leaderboard_v1",OM=(e,n)=>{const a=N.useRef(null);N.useEffect(()=>{if(!n){if((e.gameStatus==="won"||e.gameStatus==="lost")&&a.current!==e.initialSeed){a.current=e.initialSeed||"default";const s=e.initialSeed??e.rngSeed??"0",r=e.completedRun?.score||(e.player.hp||0)+(e.floor||0)*100,c=j0(e.actionLog||[]);if(!c.valid){console.error("[HOP_REPLAY] Refusing to persist replay with invalid action log",{errors:c.errors});return}const u=MM(c.actions,e.floor||0),p={id:`run-${Date.now()}`,seed:s,loadoutId:e.player.archetype,actions:c.actions,score:r,floor:e.floor,date:new Date().toISOString(),replayVersion:2,diagnostics:u},g=localStorage.getItem(qg),m=g?JSON.parse(g):[],f=[p,...m].slice(0,100);localStorage.setItem(qg,JSON.stringify(f));const b=localStorage.getItem(zg);let S=b?JSON.parse(b):[];S.push({id:p.id,name:"Player",score:p.score,floor:p.floor,date:p.date,seed:p.seed,loadoutId:p.loadoutId,actions:p.actions,replayVersion:p.replayVersion,diagnostics:p.diagnostics}),S.sort((T,v)=>v.score-T.score),S=S.slice(0,5),localStorage.setItem(zg,JSON.stringify(S))}e.gameStatus==="hub"&&(a.current=null)}},[e.gameStatus,e.initialSeed,e.rngSeed,e.completedRun?.score,e.floor,e.player.hp,e.player.archetype,e.actionLog,n])},CM=({gameState:e,appendTurnTrace:n})=>{const a=N.useRef([]),s=N.useRef(null),r=N.useRef(""),[c,u]=N.useState([]),p=N.useCallback(f=>{const b=Date.now();u(S=>[...S,{...f,createdAt:b}].slice(-4))},[]),g=N.useCallback(f=>{if(!(!f||f.length===0)){a.current=[...a.current,...f].slice(-600),window.__HOP_SIM_EVENTS=a.current,window.dispatchEvent(new CustomEvent("hop:simulation-events",{detail:{turn:e.turnNumber,events:f}})),n("SIM_EVENTS",{count:f.length,lastType:f[f.length-1]?.type??"unknown"});for(const b of f)if(b.type==="DamageTaken"&&b.targetId===e.player.id){const S=Math.max(0,Number(b.payload?.amount||0));S>0&&p({id:`sim-toast-${b.id}`,text:`-${S} HP`,tone:"damage"})}else if(b.type==="Healed"&&b.targetId===e.player.id){const S=Math.max(0,Number(b.payload?.amount||0));S>0&&p({id:`sim-toast-${b.id}`,text:`+${S} HP`,tone:"heal"})}else if(b.type==="StatusApplied"&&b.targetId===e.player.id){const T=String(b.payload?.status||"Status").split("_").filter(Boolean).map(v=>v.charAt(0).toUpperCase()+v.slice(1)).join(" ");p({id:`sim-toast-${b.id}`,text:T,tone:"status"})}else if(b.type==="MessageLogged"){const S=String(b.payload?.text||"").trim();if(!S)continue;const T=S.toLowerCase();if(!(T.includes("stun")||T.includes("snare")||T.includes("lava")||T.includes("fire")||T.includes("burn")||T.includes("heal")||T.includes("shrine")||T.includes("stairs")||T.includes("roll away")||T.includes("ward")||T.includes("orb")))continue;const A=S.length>52?`${S.slice(0,49)}...`:S;p({id:`sim-toast-${b.id}`,text:A,tone:"system"})}}},[n,e.turnNumber,e.player.id,p]),m=N.useCallback(f=>{s.current=f,window.__HOP_UI_MIRROR=f},[]);return N.useEffect(()=>(window.__HOP_SIM_EVENTS=a.current,window.__HOP_DUMP_SIM_EVENTS=()=>[...a.current],window.__HOP_CLEAR_SIM_EVENTS=()=>{a.current=[],window.__HOP_SIM_EVENTS=[]},window.__HOP_DUMP_MIRROR=()=>window.__HOP_MIRROR_LAST,()=>{delete window.__HOP_DUMP_SIM_EVENTS,delete window.__HOP_CLEAR_SIM_EVENTS,delete window.__HOP_DUMP_MIRROR}),[]),N.useEffect(()=>{if(c.length===0)return;const f=window.setTimeout(()=>{const b=Date.now();u(S=>S.filter(T=>b-T.createdAt<2200))},180);return()=>window.clearTimeout(f)},[c]),N.useEffect(()=>{const f=g_(e);window.__HOP_ENGINE_MIRROR=f;const b=s.current;if(!b||b.turn!==f.turn||b.stackTick!==f.stackTick)return;const S=b_(f,b),T=`${f.turn}:${f.stackTick}:${S.ok?"ok":S.mismatches.length}`;T!==r.current&&(r.current=T,window.__HOP_MIRROR_LAST={engineSnapshot:f,uiSnapshot:b,result:S},S.ok||(n("MIRROR_MISMATCH",{count:S.mismatches.length}),console.warn("[HOP_MIRROR] snapshot mismatch detected",S.mismatches)))},[e,n]),{mobileToasts:c,handleSimulationEvents:g,handleUiMirrorSnapshot:m}},NM=e=>{const n=e||[],a=n.length>0?n[n.length-1]:void 0;return`${n.length}:${a?.type??"none"}`},kM=e=>{const n=e||[],a=n.length>0?n[n.length-1]:void 0;return`${n.length}:${a?.id??"none"}:${a?.phase??"none"}`},RM=({gameState:e,turnDriver:n,isBusy:a,isReplayMode:s,postCommitInputLock:r,setPostCommitInputLock:c,appendTurnTrace:u,dispatchWithTrace:p})=>{const[g,m]=N.useState(0),f=N.useRef(null),b=N.useRef(null),S=N.useRef(null),T=N.useRef(null),v=N.useRef(""),A=N.useRef(""),_=N.useRef(!1),E=N.useRef(""),w=N.useRef(""),M=N.useRef(!1),C=N.useRef(0),L=220,k=900,R=e.pendingFrames?.length??0,H=NM(e.visualEvents),D=kM(e.timelineEvents),$=`${e.pendingStatus?.status??"none"}:${R}`,J=N.useCallback((ae="unknown")=>{r&&u("LOCK_RELEASE",{reason:ae,lockTurn:f.current,expectedActionLogLength:b.current}),c(!1),f.current=null,b.current=null,S.current=null,_.current=!1,E.current="",w.current="",T.current!==null&&(window.clearTimeout(T.current),T.current=null)},[u,r,c]);return N.useEffect(()=>{if(!n.shouldAdvanceQueue)return;u("QUEUE_SCHEDULE",{delayMs:n.queueAdvanceDelayMs});const ae=window.setTimeout(()=>{p({type:"ADVANCE_TURN"},"queue_pump")},n.queueAdvanceDelayMs);return()=>window.clearTimeout(ae)},[n.shouldAdvanceQueue,n.queueAdvanceDelayMs,e.turnNumber,e.initiativeQueue,e.player.id,e.enemies,p,u]),N.useEffect(()=>{a||(v.current=H,A.current=D)},[a,H,D]),N.useEffect(()=>{M.current=!1,C.current=performance.now()},[$]),N.useEffect(()=>{(e.pendingStatus||R>0)&&a&&(M.current=!0)},[e.pendingStatus,R,a]),N.useEffect(()=>{r&&a&&(_.current=!0)},[r,a]),N.useEffect(()=>{if(!r)return;const ae=window.setTimeout(()=>{m(W=>W+1)},120);return()=>window.clearTimeout(ae)},[r,g]),N.useEffect(()=>{const ae=!a&&H===v.current&&D===A.current,W=(e.timelineEvents||[]).some(G=>G.blocking),q=(e.timelineEvents||[]).filter(G=>G.blocking).reduce((G,ne)=>G+(ne.suggestedDurationMs||0),0),P=(e.visualEvents||[]).reduce((G,ne)=>{if(ne.type!=="kinetic_trace")return G;const re=ne.payload;if(!re)return G;const ce=Math.max(0,Number(re.startDelayMs||0)),pe=Math.max(0,Number(re.durationMs||0));return Math.max(G,ce+pe)},0),z=Math.max(q,P),X=z>0?Math.max(160,Math.min(3200,z+40)):0,le=Math.max(0,performance.now()-C.current),fe=!W||M.current,I=!W||le>=X,K=ae&&(fe||I);if(n.shouldResolvePending){if(K){u("PENDING_RESOLVE_READY",{noPendingAnimations:ae,hasBlockingTimeline:W,movementTraceBudgetMs:P,elapsedPendingMs:le,requiredFallbackDelayMs:X}),p({type:"RESOLVE_PENDING"},"pending_ready");return}if(!a&&W&&!M.current){u("PENDING_RESOLVE_WAIT",{movementTraceBudgetMs:P,elapsedPendingMs:le,requiredFallbackDelayMs:X});const G=Math.max(0,X-le),ne=window.setTimeout(()=>{p({type:"RESOLVE_PENDING"},"pending_fallback_delay")},G);return()=>window.clearTimeout(ne)}}},[n.shouldResolvePending,e.timelineEvents,e.visualEvents,a,H,D,p,u]),N.useEffect(()=>{if(!r)return;if(s||e.gameStatus!=="playing"){J("mode_or_status_change");return}if(e.pendingStatus||(e.pendingFrames?.length??0)>0){J("pending_intercept");return}const ae=f.current,W=b.current,q=S.current!==null?Math.max(0,performance.now()-S.current):Number.POSITIVE_INFINITY,P=ae!==null?e.turnNumber>ae:!1,z=W!==null?(e.actionLog?.length??0)>=W:!1,X=q>=L,le=H!==E.current||D!==w.current,fe=!P&&!z,I=!_.current&&le&&q<k,K=e.gameStatus==="playing"&&!s&&!a&&!e.pendingStatus&&(e.pendingFrames?.length??0)===0&&Do(e);if(I){u("LOCK_WAIT_FOR_BUSY",{lockAgeMs:q,visualsChangedSinceArm:le});return}if(K&&fe&&q>450){J("no_progress_timeout");return}K&&X&&(P||z||q>1500)&&J(P?"turn_advanced":z?"action_committed":"age_fallback")},[r,s,e.gameStatus,e.turnNumber,e.pendingStatus,e.pendingFrames,e.initiativeQueue,e.actionLog,a,e.player.id,e.enemies,u,H,D,g,J]),N.useEffect(()=>{e.gameStatus!=="playing"&&r&&J("not_playing")},[e.gameStatus,r,J]),N.useEffect(()=>{if(r)return T.current!==null&&window.clearTimeout(T.current),T.current=window.setTimeout(()=>{if(r){const ae=Array.isArray(window.__HOP_TURN_TRACE)?window.__HOP_TURN_TRACE:[];console.error("[HOP_INPUT_LOCK] Watchdog released stuck post-commit lock",{turnNumber:e.turnNumber,pendingStatus:e.pendingStatus?.status,pendingFrames:e.pendingFrames?.length??0,playerTurn:Do(e),isBusy:a,actionLogLength:e.actionLog?.length??0,traceTail:ae.slice(-40)}),u("LOCK_WATCHDOG_RELEASE"),J("watchdog")}},8e3),()=>{T.current!==null&&(window.clearTimeout(T.current),T.current=null)}},[r,e.turnNumber,e.pendingStatus,e.actionLog,a,e.initiativeQueue,e.player.id,e.enemies,u,J]),N.useEffect(()=>{if(!r)return;const ae=window.setTimeout(()=>{u("LOCK_STALL_SNAPSHOT",{lockAgeMs:S.current!==null?Math.max(0,performance.now()-S.current):null})},2500);return()=>window.clearTimeout(ae)},[r,u]),{armPostCommitLock:N.useCallback(()=>{T.current!==null&&(window.clearTimeout(T.current),T.current=null),f.current=e.turnNumber,b.current=(e.actionLog?.length??0)+1,S.current=performance.now(),_.current=!1,E.current=H,w.current=D,c(!0),u("LOCK_ARM",{lockTurn:e.turnNumber,expectedActionLogLength:(e.actionLog?.length??0)+1,eventHashAtArm:H,timelineHashAtArm:D})},[e.turnNumber,e.actionLog,H,D,c,u])}},IM=e=>{const{gameStatus:n,isReplayMode:a,isBusy:s,postCommitInputLock:r,isPlayerTurn:c,hasPendingStatus:u,pendingFrameCount:p}=e,g=u||p>0;let m="IDLE";return a?m="REPLAY":n!=="playing"?m="IDLE":g?m=s?"INTERCEPT_ANIMATING":"INTERCEPT_READY":s?m="PLAYBACK":r&&c?m="POST_COMMIT_LOCK":r&&!c?m="POST_COMMIT_QUEUE":c?m="INPUT_OPEN":m="QUEUE_ADVANCE",{phase:m,canPlayerInput:m==="INPUT_OPEN",shouldAdvanceQueue:m==="QUEUE_ADVANCE"||m==="POST_COMMIT_QUEUE",shouldResolvePending:m==="INTERCEPT_READY",queueAdvanceDelayMs:380}},LM=({gameState:e,dispatch:n,isReplayMode:a,isBusy:s,postCommitInputLock:r,dispatchWithTraceProxyRef:c,summarizeActionPayload:u})=>{const p=e.pendingFrames?.length??0,g=N.useMemo(()=>IM({gameStatus:e.gameStatus,isReplayMode:a,isBusy:s,postCommitInputLock:r,isPlayerTurn:Do(e),hasPendingStatus:!!e.pendingStatus,pendingFrameCount:p}),[e.gameStatus,a,s,r,e.pendingStatus,p,e.initiativeQueue,e.player.id,e.enemies]),m=!g.canPlayerInput,f=N.useRef([]),b=N.useRef(0),S=N.useRef(""),T=e.initiativeQueue?.entries?.[Math.max(0,e.initiativeQueue.currentIndex??0)]?.actorId??e.initiativeQueue?.entries?.[0]?.actorId??"none",v=N.useCallback((_,E)=>{const w={id:++b.current,t:Date.now(),event:_,turnNumber:e.turnNumber,phase:g.phase,gameStatus:e.gameStatus,playerTurn:Do(e),isBusy:s,postCommitInputLock:r,pendingStatus:e.pendingStatus?.status??"none",pendingFrames:e.pendingFrames?.length??0,canPlayerInput:g.canPlayerInput,shouldAdvanceQueue:g.shouldAdvanceQueue,shouldResolvePending:g.shouldResolvePending,actionLogLength:e.actionLog?.length??0,queueHead:T,details:E};f.current.push(w),f.current.length>800&&f.current.splice(0,f.current.length-800)},[e.turnNumber,e.gameStatus,e.pendingStatus,e.pendingFrames,e.actionLog,e.initiativeQueue,e.player.id,e.enemies,g.phase,g.canPlayerInput,g.shouldAdvanceQueue,g.shouldResolvePending,s,r,T]),A=N.useCallback((_,E)=>{v("DISPATCH",{source:E,actionType:_.type,payload:u(_)}),n(_)},[v,n,u]);return c&&(c.current=A),N.useEffect(()=>{const _=[g.phase,e.turnNumber,e.gameStatus,e.pendingStatus?.status??"none",e.pendingFrames?.length??0,s?1:0,r?1:0,T].join("|");_!==S.current&&(v("TURN_STATE"),S.current=_)},[g.phase,e.turnNumber,e.gameStatus,e.pendingStatus,e.pendingFrames,s,r,T,v]),N.useEffect(()=>(window.__HOP_TURN_TRACE=f.current,window.__HOP_DUMP_TURN_TRACE=()=>[...f.current],window.__HOP_PRINT_TURN_TRACE=(_=80)=>{const E=f.current.slice(-Math.max(1,Math.floor(_)));return console.table(E.map(w=>({id:w.id,event:w.event,turn:w.turnNumber,phase:w.phase,status:w.gameStatus,playerTurn:w.playerTurn,busy:w.isBusy,lock:w.postCommitInputLock,pending:`${w.pendingStatus}/${w.pendingFrames}`,queueHead:w.queueHead,actionLog:w.actionLogLength,details:w.details?JSON.stringify(w.details):""}))),E},window.__HOP_CLEAR_TURN_TRACE=()=>{f.current.length=0,b.current=0},f.current.push({id:++b.current,t:Date.now(),event:"TRACE_READY",turnNumber:0,phase:"INIT",gameStatus:"init",playerTurn:!1,isBusy:!1,postCommitInputLock:!1,pendingStatus:"none",pendingFrames:0,canPlayerInput:!1,shouldAdvanceQueue:!1,shouldResolvePending:!1,actionLogLength:0,queueHead:"none"}),()=>{delete window.__HOP_DUMP_TURN_TRACE,delete window.__HOP_PRINT_TURN_TRACE,delete window.__HOP_CLEAR_TURN_TRACE}),[]),{turnDriver:g,isInputLocked:m,appendTurnTrace:v,dispatchWithTrace:A}},BM=()=>{const[e,n]=N.useState(()=>window.location.pathname);N.useEffect(()=>{const r=()=>n(window.location.pathname);return window.addEventListener("popstate",r),()=>window.removeEventListener("popstate",r)},[]);const a=r=>{window.location.pathname!==r&&window.history.pushState({},"",r),n(r)},s=N.useMemo(()=>{const r=e.toLowerCase().startsWith("/hop")?"/Hop":"",c=`${r||""}`||"/",u=`${r}/Arcade`||"/Arcade",p=`${r}/Biomes`||"/Biomes",m=e.toLowerCase().replace(/\/+$/,""),f=m.endsWith("/arcade")||m.endsWith("/arcarde"),b=m.endsWith("/biomes");return{hubPath:c,arcadePath:u,biomesPath:p,isArcadeRoute:f,isBiomesRoute:b}},[e]);return{pathname:e,navigateTo:a,...s}},HM=({onSelect:e})=>y.jsxs("div",{className:"relative z-50 flex flex-col items-center justify-center p-8 gap-8 animate-in fade-in zoom-in duration-500",children:[y.jsxs("div",{className:"text-center space-y-2",children:[y.jsx("h1",{className:"text-4xl font-black uppercase tracking-widest text-white mb-2",children:"Select Class"}),y.jsx("p",{className:"text-white/40 text-sm uppercase tracking-wider",children:"Choose your combat doctrine"})]}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl",children:Object.values(oi).map(n=>y.jsxs("button",{onClick:()=>{console.log("Archetype Selected:",n.id),e(n)},className:"group relative flex flex-col items-start p-8 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/30 rounded-3xl transition-all hover:scale-[1.02] text-left cursor-pointer",children:[y.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 rounded-3xl transition-opacity"}),y.jsxs("div",{className:"relative z-10 w-full",children:[y.jsxs("div",{className:"flex justify-between items-start mb-4",children:[y.jsx("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10 group-hover:border-white/30 transition-colors",children:y.jsx("span",{className:"text-3xl",children:Uo(n.id==="ASSASSIN"?"assassin_player":n.id.toLowerCase(),"player").icon})}),y.jsx("div",{className:"px-3 py-1 bg-white/5 rounded-full border border-white/10 text-[10px] font-bold uppercase tracking-widest text-white/50",children:n.id==="VANGUARD"?"Standard":"Advanced"})]}),y.jsx("h3",{className:"text-2xl font-black uppercase tracking-wide text-white mb-2",children:n.name}),y.jsx("p",{className:"text-white/60 text-sm leading-relaxed mb-6 h-12",children:n.description}),y.jsxs("div",{className:"space-y-3",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/30 font-bold border-b border-white/5 pb-1",children:"Starting Loadout"}),y.jsx("div",{className:"flex flex-wrap gap-2",children:n.startingSkills.map(a=>y.jsx("div",{className:"px-2 py-1 bg-black/40 rounded border border-white/10 text-[10px] text-blue-200",children:a.replace("_"," ")},a))})]})]})]},n.id))})]}),PM="hop_replays_v1",jM="hop_leaderboard_v1",Vg=()=>{try{const e=localStorage.getItem(PM);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load replays",e),[]}},Yg=()=>{try{const e=localStorage.getItem(jM);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load leaderboard",e),[]}},Kg=e=>{const n=Array.isArray(e.actions)?e.actions:[],a=new Set(n.map(m=>m?.type)),s=a.has("ADVANCE_TURN"),r=a.has("RESOLVE_PENDING"),c=(e.floor||0)>=5&&n.length<Math.max(25,(e.floor||0)*4),u=(e.replayVersion??1)<2,p=n.length===0,g=p?"invalid replay":c?"truncated replay":u?"legacy replay":null;return{isLegacy:u,invalid:p,suspicious:c||e.floor>1&&!r,label:g,hasTurnAdvance:s,hasPendingResolve:r,actionCount:n.length}},Fg=({onStartReplay:e})=>{const[n,a]=N.useState(()=>Vg()),[s,r]=N.useState(()=>Yg()),[c,u]=N.useState(""),[p,g]=N.useState(""),[m,f]=N.useState(""),[b,S]=N.useState(null);N.useEffect(()=>{const A=()=>{a(Vg()),r(Yg())};return window.addEventListener("storage",A),()=>window.removeEventListener("storage",A)},[]);const T=()=>{S(null);try{const A=m.trim();if(!A)return S("Paste actions JSON first."),null;const _=JSON.parse(A);let E=c.trim()||void 0,w=p.trim()||void 0,M=[];return Array.isArray(_)?M=_:_&&typeof _=="object"&&(M=Array.isArray(_.actions)?_.actions:[],E=E||(typeof _.seed=="string"?_.seed:void 0),w=w||(typeof _.loadoutId=="string"?_.loadoutId:void 0)),!Array.isArray(M)||M.length===0?(S('No actions found. Provide a JSON action array or object with "actions".'),null):M.filter(k=>k&&typeof k.type=="string").length===0?(S('Actions must be objects with a "type" field.'),null):{id:`manual-${Date.now()}`,seed:E,loadoutId:w,actions:M,score:0,floor:1,date:new Date().toISOString(),replayVersion:2,diagnostics:{actionCount:M.length,hasTurnAdvance:M.some(k=>k?.type==="ADVANCE_TURN"),hasPendingResolve:M.some(k=>k?.type==="RESOLVE_PENDING"),suspiciouslyShort:!1}}}catch(A){return S(`Invalid JSON: ${A?.message||"parse error"}`),null}},v=()=>{const A=T();A&&e(A)};return y.jsxs("div",{className:"flex flex-col gap-8",children:[y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-4",children:[y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-emerald-400",children:"Manual Replay"}),y.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Paste from UPA"})]}),y.jsxs("div",{className:"space-y-2 p-3 rounded-2xl border border-white/5 bg-white/[0.02]",children:[y.jsx("input",{value:c,onChange:A=>u(A.target.value),placeholder:"Seed (optional if included in JSON)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),y.jsx("input",{value:p,onChange:A=>g(A.target.value),placeholder:"Loadout ID (optional)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),y.jsx("textarea",{value:m,onChange:A=>f(A.target.value),placeholder:'Paste JSON actions array, or object: {"seed":"...","loadoutId":"...","actions":[...]}',rows:6,className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40 font-mono"}),b&&y.jsx("div",{className:"text-[10px] text-red-400 font-bold uppercase tracking-wider",children:b}),y.jsx("button",{onClick:v,className:"w-full py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 text-xs font-black uppercase tracking-widest transition-colors",children:"Start Manual Replay"})]})]}),y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-4",children:[y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400",children:"Hall of Fame"}),y.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Top 5 Only"})]}),y.jsxs("div",{className:"space-y-2",children:[s.length===0&&y.jsx("div",{className:"p-4 rounded-xl border border-white/5 bg-white/[0.02] text-center",children:y.jsx("span",{className:"text-[10px] text-white/30 uppercase font-black",children:"No Champions Yet"})}),s.slice(0,5).map((A,_)=>{const E={id:A.id,seed:A.seed,loadoutId:A.loadoutId,actions:A.actions||[],score:A.score,floor:A.floor,date:A.date,replayVersion:A.replayVersion,diagnostics:A.diagnostics},w=Kg(E);return y.jsxs("button",{onClick:()=>e(E),className:"w-full group relative flex items-center gap-4 p-4 bg-white/[0.03] hover:bg-white/[0.07] border border-white/5 hover:border-indigo-500/30 rounded-2xl transition-all text-left",children:[y.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-indigo-500/10 rounded-lg text-indigo-400 font-black text-sm border border-indigo-500/20",children:_+1}),y.jsxs("div",{className:"flex-1 min-w-0",children:[y.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[y.jsx("span",{className:"font-black text-white uppercase text-xs truncate tracking-wider",children:A.name}),y.jsx("span",{className:"text-[10px] font-black text-indigo-400 tabular-nums",children:A.score.toLocaleString()})]}),y.jsxs("div",{className:"text-[9px] text-white/30 font-bold uppercase tracking-widest",children:["Floor ",A.floor," * ",new Date(A.date).toLocaleDateString()," * ",w.actionCount," acts"]}),w.label&&y.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:w.label})]}),y.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-indigo-400 text-xs",children:"Play"})]},A.id)})]})]}),y.jsxs("section",{children:[y.jsx("div",{className:"flex items-center justify-between mb-4",children:y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Recent Simulations"})}),y.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar pr-2",children:[n.length===0&&y.jsx("div",{className:"text-center py-4",children:y.jsx("span",{className:"text-[10px] text-white/10 uppercase font-bold",children:"Log Empty"})}),n.slice(0,10).map(A=>{const _=Kg(A);return y.jsxs("button",{onClick:()=>e(A),className:"w-full flex items-center justify-between p-3 hover:bg-white/[0.04] rounded-xl transition-colors text-left group",children:[y.jsxs("div",{className:"min-w-0",children:[y.jsxs("div",{className:"text-[10px] font-bold text-white/60 mb-0.5 truncate uppercase",children:["Score: ",y.jsx("span",{className:"text-white",children:A.score})," * F",A.floor," * ",_.actionCount," acts"]}),y.jsx("div",{className:"text-[9px] text-white/20 font-medium",children:new Date(A.date).toLocaleTimeString()}),_.label&&y.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:_.label})]}),y.jsx("div",{className:"text-[10px] text-white/0 group-hover:text-white/40 font-black uppercase tracking-widest transition-all",children:"Replay"})]},A.id)})]})]})]})};class DM{state;constructor(){this.state=Da(1,"tutorial-seed"),this.state.enemies=[],this.state.tiles=new Map}setPlayer(n,a){this.state.player={...this.state.player,position:n,previousPosition:n,activeSkills:a.map(s=>{const r=yt.get(s);return{id:s,name:typeof r?.name=="function"?r.name(this.state):r?.name||s,description:r?.description||"",slot:r?.slot||"offensive",cooldown:r?.baseVariables.cooldown||0,currentCooldown:0,range:r?.baseVariables.range||0,upgrades:Object.keys(r?.upgrades||{}),activeUpgrades:[]}})}}spawnEnemy(n,a,s){const r=Ld[n]||{hp:1,maxHp:1};this.state.enemies.push({id:s,type:"enemy",subtype:n,position:a,previousPosition:a,hp:r.hp,maxHp:r.maxHp,enemyType:r.type||"melee",statusEffects:[],temporaryArmor:0,activeSkills:[],speed:r.speed||1,factionId:"enemy"})}spawnFalcon(n,a){const s={id:a,type:"enemy",subtype:"falcon",factionId:"player",speed:95,position:{...n},previousPosition:{...n},hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],isFlying:!0,companionOf:"player",companionState:{mode:"roost",orbitStep:0,apexStrikeCooldown:0}};this.state.enemies.push(s),this.state.companions||(this.state.companions=[]),this.state.companions.push(s)}spawnCompanion(n,a,s){n==="falcon"&&this.spawnFalcon(a,s)}setTile(n,a){const s=a.toUpperCase(),r=ue(n),c=Os[s];if(!c){console.warn(`Attempted to set unknown tile type: ${s}`);return}this.state.tiles.set(r,{baseId:s,position:n,traits:new Set(c.defaultTraits||[]),effects:[],occupantId:void 0})}addUpgrade(n,a){this.state.player.activeSkills=(this.state.player.activeSkills||[]).map(s=>s.id===n?{...s,activeUpgrades:[...s.activeUpgrades,a]}:s)}useSkill(n,a){}wait(){}move(n){}getEnemy(n){return this.state.enemies.find(a=>a.id===n)}setTurn(n){this.state.turnNumber=n}exitToHub(){}applyStatus(n,a){const s=this.state.enemies.findIndex(r=>r.id===n);s!==-1&&(this.state.enemies[s]=Pd(this.state.enemies[s],a,1))}}const Wg=({onLoadScenario:e})=>{const n=Object.values(Wl),a=s=>{const r=new DM;s.setup(r),r.state.initiativeQueue=ja(r.state),e(r.state,s.description)};return y.jsx("div",{className:"flex flex-col gap-4",children:n.map(s=>y.jsxs("div",{className:"flex flex-col gap-2",children:[y.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-white/50",children:typeof s.name=="function"?s.name(Da(1,"temp")):s.name}),y.jsx("div",{className:"flex flex-col gap-1",children:s.scenarios?.map(r=>y.jsx("button",{onClick:()=>a(r),className:"text-left px-3 py-2 bg-white/5 hover:bg-white/10 rounded text-xs text-white/80 transition-colors border border-transparent hover:border-white/20",children:r.title},r.id))})]},s.id))})},UM=({gameState:e,onSelectLoadout:n,onStartRun:a,onOpenArcade:s,onLoadScenario:r,onStartReplay:c})=>y.jsxs("div",{className:"w-full h-full flex flex-col bg-[#020617]",children:[y.jsx("header",{className:"border-b border-white/5 px-4 sm:px-6 lg:px-12 py-3 sm:py-4 bg-[#030712]/50 backdrop-blur-xl z-30",children:y.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[y.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[y.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-indigo-500 rounded-lg flex items-center justify-center font-black text-lg sm:text-xl shadow-[0_0_20px_rgba(99,102,241,0.5)]",children:"H"}),y.jsxs("div",{children:[y.jsxs("h1",{className:"text-base sm:text-lg font-black uppercase tracking-tighter leading-none italic",children:["Hop ",y.jsx("span",{className:"text-indigo-500",children:"Engine"})]}),y.jsx("div",{className:"text-[9px] sm:text-[10px] font-bold text-white/30 tracking-[0.22em] sm:tracking-[0.3em] uppercase mt-1",children:"Strategic Hub v5.0"})]})]}),y.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 lg:gap-8",children:[y.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 sm:bg-transparent sm:border-0 sm:p-0",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/40 mb-1",children:"Current Loadout"}),y.jsx("div",{className:"text-sm font-bold text-indigo-400 truncate",children:e.selectedLoadoutId||"No Archetype Selected"})]}),e.selectedLoadoutId&&y.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:items-center sm:gap-3",children:[y.jsxs("button",{onClick:()=>a("normal"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center leading-tight",children:[y.jsx("span",{children:"Start Run"}),y.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"10 Floors | Boss Defeat"})]}),y.jsxs("button",{onClick:()=>a("daily"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(16,185,129,0.3)] flex flex-col items-center justify-center leading-tight",children:[y.jsx("span",{children:"Daily"}),y.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"Seeded Challenge"})]})]})]})]})}),y.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-y-auto lg:overflow-hidden",children:[y.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-12 custom-scrollbar",children:y.jsxs("div",{className:"max-w-4xl mx-auto",children:[y.jsxs("div",{className:"mb-6 sm:mb-10 lg:mb-12",children:[y.jsx("button",{onClick:s,className:"mb-4 sm:mb-5 w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 font-black uppercase tracking-widest text-xs sm:text-sm transition-all",children:"Arcade Mode"}),y.jsxs("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-black uppercase tracking-tighter mb-2 italic",children:["Select Your ",y.jsx("span",{className:"text-indigo-500",children:"Archetype"})]}),y.jsx("p",{className:"text-sm sm:text-base text-white/40 max-w-xl",children:"Choose your tactical specialty. Each archetype provides unique skills and modifies your core interaction with the engine."})]}),y.jsx(HM,{onSelect:n})]})}),y.jsxs("section",{className:"lg:hidden border-t border-white/5 bg-[#030712]/50 backdrop-blur-sm p-4 sm:p-6 space-y-4",children:[y.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[y.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[y.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Historical Replay"}),y.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),y.jsx("div",{className:"mt-3",children:y.jsx(Fg,{gameState:e,onStartReplay:c})})]}),y.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[y.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[y.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Training Simulations"}),y.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),y.jsx("div",{className:"mt-3",children:y.jsx(Wg,{onLoadScenario:r})})]})]}),y.jsx("aside",{className:"hidden lg:flex w-[450px] border-l border-white/5 bg-[#030712]/80 backdrop-blur-md flex-col z-20",children:y.jsxs("div",{className:"p-8 flex flex-col gap-12 h-full overflow-y-auto custom-scrollbar",children:[y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-6",children:[y.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Historical Replay"}),y.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]}),y.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:y.jsx(Fg,{gameState:e,onStartReplay:c})})]}),y.jsxs("section",{children:[y.jsxs("div",{className:"flex items-center justify-between mb-6",children:[y.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Training Simulations"}),y.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]}),y.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:y.jsx(Wg,{onLoadScenario:r})})]}),y.jsx("div",{className:"mt-auto pt-8 border-t border-white/5 opacity-20 hover:opacity-100 transition-opacity",children:y.jsx("div",{className:"text-[10px] font-bold uppercase tracking-[0.4em] mb-2 text-center text-white/50",children:"Engine Status: Online"})})]})})]})]}),$M={VANGUARD:"V",HUNTER:"H",FIREMAGE:"F",NECROMANCER:"N",SKIRMISHER:"S"},Gg=e=>{let n=2166136261;for(let a=0;a<e.length;a++)n^=e.charCodeAt(a),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return n>>>0},qM=(e=new Date)=>e.toISOString().slice(0,10),zM=(e,n)=>{if(e.length<2)throw new Error("Arcade mode requires at least two loadouts.");const s=Gg(`arcade-a:${n}`)%e.length,r=e[s],c=e.filter(m=>m.id!==r.id),p=Gg(`arcade-b:${n}`)%c.length,g=c[p];return[r,g]},VM=({onBack:e,onLaunchArcade:n})=>{const a=Vn.useMemo(()=>Object.values(oi),[]),s=Vn.useMemo(()=>qM(),[]),[r,c]=Vn.useMemo(()=>zM(a,s),[a,s]);return y.jsxs("div",{className:"w-full h-full flex flex-col bg-[#040a18]",children:[y.jsxs("header",{className:"h-20 border-b border-white/10 flex items-center justify-between px-12 bg-[#050b1f]/80 backdrop-blur-xl z-30",children:[y.jsxs("div",{children:[y.jsxs("h1",{className:"text-xl font-black uppercase tracking-tight italic",children:["Hop ",y.jsx("span",{className:"text-emerald-400",children:"Arcade"})]}),y.jsxs("div",{className:"text-[10px] uppercase tracking-[0.3em] text-white/40 mt-1",children:["Daily Draft ",s]})]}),y.jsx("button",{onClick:e,className:"px-5 py-2.5 rounded-xl border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-widest",children:"Back to Strategic Hub"})]}),y.jsx("main",{className:"flex-1 overflow-y-auto p-12",children:y.jsxs("div",{className:"max-w-5xl mx-auto",children:[y.jsxs("div",{className:"mb-10",children:[y.jsx("h2",{className:"text-4xl font-black uppercase tracking-tight italic mb-3",children:"Arcade Mode"}),y.jsx("p",{className:"text-white/60 max-w-3xl",children:"Pick one of two daily archetypes and run the seeded challenge. Both options share the same seed for fair comparison."})]}),y.jsx("div",{className:"flex flex-col gap-6",children:[r,c].map((u,p)=>{const g=p===1,m=$M[u.id]||u.id.slice(0,1);return y.jsx("button",{onClick:()=>n(u.id),className:"w-full text-left group rounded-3xl border border-white/10 bg-gradient-to-r from-white/[0.06] to-white/[0.02] hover:from-emerald-500/20 hover:to-cyan-500/10 transition-all p-6",children:y.jsxs("div",{className:`flex items-center justify-between gap-6 ${g?"flex-row-reverse":""}`,children:[y.jsxs("div",{className:"flex items-center gap-4 min-w-[200px]",children:[y.jsx("div",{className:`w-20 h-20 rounded-2xl border border-white/15 bg-[#0b1733] flex items-center justify-center text-4xl font-black text-emerald-300 shadow-[0_0_35px_rgba(16,185,129,0.25)] ${g?"-scale-x-100":""}`,children:m}),y.jsxs("div",{children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Daily Archetype"}),y.jsx("div",{className:"text-2xl font-black uppercase tracking-tight",children:u.name})]})]}),y.jsxs("div",{className:"flex-1",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/40 mb-2",children:"Starting Skills"}),y.jsx("div",{className:"flex flex-wrap gap-2",children:u.startingSkills.slice(0,6).map(f=>y.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full border border-white/20 bg-white/5 font-bold tracking-wide",children:f},f))})]}),y.jsxs("div",{className:"text-right min-w-[150px]",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Launch"}),y.jsx("div",{className:"text-sm font-black uppercase tracking-widest text-emerald-300 group-hover:text-emerald-200",children:"Start Arcade Run"})]})]})},u.id)})})]})})]})},YM=({replayError:e})=>e?y.jsx("div",{className:"absolute top-4 right-4 z-40 max-w-xl px-4 py-3 rounded-xl border border-red-400/40 bg-red-900/70 text-red-100 text-xs font-bold tracking-wide",children:e}):null,X0=({tutorialInstructions:e,onDismiss:n})=>e?y.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[y.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),y.jsx("p",{className:"text-white text-sm",children:e}),y.jsx("button",{onClick:n,className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:"X"})]}):null,KM=({visible:e})=>e?y.jsx("div",{className:"absolute inset-0 z-40 pointer-events-auto",children:y.jsx("div",{className:"absolute top-3 sm:top-4 lg:top-6 left-1/2 -translate-x-1/2 h-10 w-10 rounded-full bg-black/55 border border-white/15 text-lg flex items-center justify-center text-white/80 animate-pulse","aria-label":"Resolving turn",title:"Resolving turn",children:"..."})}):null,FM=({mobileToasts:e})=>e.length===0?null:y.jsx("div",{className:"lg:hidden fixed left-1/2 -translate-x-1/2 top-16 z-50 pointer-events-none flex flex-col gap-2 w-[min(92vw,26rem)]",children:e.map(n=>{const a=n.tone==="damage"?"border-red-400/30 bg-red-950/75 text-red-100":n.tone==="heal"?"border-emerald-400/30 bg-emerald-950/70 text-emerald-100":n.tone==="status"?"border-cyan-300/30 bg-cyan-950/70 text-cyan-100":"border-white/15 bg-black/65 text-white/85";return y.jsx("div",{className:`rounded-xl border px-3 py-2 backdrop-blur-md shadow-[0_4px_20px_rgba(0,0,0,0.35)] text-xs font-bold tracking-wide ${a}`,children:n.text},n.id)})}),WM=({visible:e,onReset:n})=>e?y.jsxs("div",{className:"fixed inset-0 bg-red-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[y.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:"X"}),y.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Identity Deleted"}),y.jsx("p",{className:"text-red-200/60 mb-12 text-xl font-medium tracking-widest uppercase",children:"Simulation Terminated"}),y.jsx("button",{onClick:n,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Reinitialize Simulation"})]}):null,GM=({visible:e,score:n,onExitToHub:a})=>e?y.jsxs("div",{className:"fixed inset-0 bg-indigo-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[y.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:"OK"}),y.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Arcade Mode Cleared"}),y.jsx("p",{className:"text-indigo-200/60 mb-2 text-xl font-medium tracking-widest uppercase",children:"The Sentinel has fallen"}),y.jsxs("p",{className:"text-white/20 mb-12 text-sm font-bold uppercase tracking-[0.3em]",children:["Score: ",n]}),y.jsx("button",{onClick:a,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Return to Command Center"})]}):null,XM=({floorIntro:e})=>e?y.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[150] pointer-events-none animate-in fade-in duration-700",children:y.jsxs("div",{className:"text-center",children:[y.jsxs("div",{className:"text-indigo-500 font-black text-2xl uppercase tracking-[0.5em] mb-4 animate-in slide-in-from-bottom-8 duration-1000",children:["Floor ",e.floor]}),y.jsx("h2",{className:"text-8xl font-black text-white uppercase tracking-tighter italic animate-in slide-in-from-top-12 duration-1000",children:e.theme}),y.jsx("div",{className:"h-1 w-64 bg-white/20 mx-auto mt-8 rounded-full overflow-hidden",children:y.jsx("div",{className:"h-full bg-indigo-500 animate-[progress_3s_linear]"})})]})}):null,JM=({isReplayMode:e,replayIndex:n,replayLength:a,replayActive:s,onToggleReplay:r,onStepReplay:c,onCloseReplay:u})=>e?y.jsxs("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 bg-[#030712]/90 border border-indigo-500/30 p-6 rounded-3xl backdrop-blur-2xl shadow-[0_0_50px_rgba(79,70,229,0.2)] z-[250] flex items-center gap-8 animate-in slide-in-from-bottom-8 duration-500",children:[y.jsxs("div",{className:"flex flex-col",children:[y.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 mb-1",children:"Replay System"}),y.jsxs("span",{className:"text-white font-bold text-sm",children:["Step ",n," / ",a]})]}),y.jsx("div",{className:"h-8 w-px bg-white/10"}),y.jsxs("div",{className:"flex items-center gap-4",children:[y.jsx("button",{onClick:r,className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${s?"bg-indigo-500 text-white shadow-[0_0_20px_rgba(79,70,229,0.5)]":"bg-white/5 text-white/50 hover:bg-white/10"}`,children:s?"PAUSE":"PLAY"}),y.jsx("button",{onClick:c,disabled:s,className:"w-12 h-12 bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:hover:bg-white/5 text-white rounded-xl flex items-center justify-center transition-all",children:"NEXT"})]}),y.jsx("div",{className:"h-8 w-px bg-white/10"}),y.jsx("button",{onClick:u,className:"px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl font-bold uppercase text-xs tracking-widest transition-all",children:"Close"})]}):null,QM=({gameState:e,isArcadeRoute:n,hubPath:a,arcadePath:s,biomesPath:r,replayError:c,tutorialInstructions:u,navigateTo:p,onStartArcadeRun:g,onSelectLoadout:m,onStartRun:f,onLoadScenario:b,onStartReplay:S,onDismissTutorial:T})=>y.jsxs("div",{className:"w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[!n&&y.jsx("button",{type:"button",onClick:()=>p(r),className:"absolute top-4 right-4 z-40 px-4 py-2 rounded-xl border border-cyan-300/35 bg-cyan-500/10 hover:bg-cyan-500/20 text-[10px] font-black uppercase tracking-[0.2em]",children:"Biome Sandbox"}),n?y.jsx(VM,{onBack:()=>p(a),onLaunchArcade:g}):y.jsx(UM,{gameState:e,onSelectLoadout:m,onStartRun:f,onOpenArcade:()=>p(s),onLoadScenario:b,onStartReplay:S}),y.jsx(YM,{replayError:c}),y.jsx(X0,{tutorialInstructions:u,onDismiss:T})]}),ZM=({gameState:e})=>{const{initiativeQueue:n,player:a,enemies:s}=e;if(!n||!n.entries||n.entries.length===0)return null;const r=n.entries.map(c=>c.actorId===a.id?a:s.find(u=>u.id===c.actorId)).filter(c=>!!c);return y.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-white/5 border border-white/10 rounded-2xl backdrop-blur-md",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Turn Sequence"}),y.jsx("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-none",children:r.map((c,u)=>{const p=c.id===a.id,g=u===n.currentIndex,f=n.entries.find(b=>b.actorId===c.id)?.hasActed;return y.jsxs("div",{className:`flex flex-col items-center shrink-0 transition-all duration-300 ${g?"scale-110":"opacity-60 scale-90"}`,children:[y.jsxs("div",{className:`
                                w-10 h-10 rounded-xl flex items-center justify-center border-2 transition-all relative
                                ${p?"bg-blue-500/20 border-blue-500/50":"bg-red-500/20 border-red-500/50"}
                                ${g?"shadow-[0_0_15px_rgba(255,255,255,0.2)] border-white/80":""}
                                ${f?"grayscale":""}
                            `,children:[y.jsx("span",{className:"text-xl",children:Uo(c.subtype,c.type,c.enemyType,c.archetype).icon}),g&&y.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping"}),f&&!g&&y.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-[#030712] text-[8px]",children:""})]}),y.jsx("div",{className:"w-8 h-1 bg-white/10 rounded-full mt-2 overflow-hidden",children:y.jsx("div",{className:`h-full ${p?"bg-blue-400":"bg-red-400"}`,style:{width:`${c.hp/c.maxHp*100}%`}})}),y.jsx("span",{className:`text-[8px] font-bold uppercase mt-1 ${p?"text-blue-300":"text-red-300"} ${g?"text-white":""}`,children:p?"You":c.subtype||"Enemy"})]},`${c.id}-${u}`)})})]})},eO=({gameState:e,onReset:n,onWait:a,onExitToHub:s,inputLocked:r=!1,compact:c=!1,hideInitiativeQueue:u=!1,hideLog:p=!1})=>{const g=o0(e),m=Array.isArray(e.message)?e.message:[],f=Vn.useRef(null),[b,S]=Vn.useState("all"),[T,v]=Vn.useState("all"),A=(w,M)=>{const C=w||"",L=C.toLowerCase(),k=C.match(/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*(.*)$/i);if(k){const D=k[1].toLowerCase(),$=k[2].toLowerCase(),J=k[3]||"",te=$.includes("combat")?"combat":$.includes("hazard")?"hazard":$.includes("objective")||$.includes("score")?"objective":$.includes("ai")?"ai":"system";return{idx:M,raw:w,text:J,level:D,channel:te}}const R=/(attacked|killed|blast|stunned|damage|hit|healed|shield|bash|spear|fireball|jump|dash)/i.test(L)?"combat":/(lava|burn|hazard|void|sink|fire damage)/i.test(L)?"hazard":/(score|objective|floor|stairs|descending|arcade cleared)/i.test(L)?"objective":/(enemy|falcon|intent|telegraph|moves to|repositioning|attacks)/i.test(L)?"ai":"system",H=/(fallen|warning|error|failed|invalid|blocked|cannot)/i.test(L)?"critical":/(debug|trace|telemetry|seed|counter|rng)/i.test(L)?"debug":/(marks the impact zone|telegraph|planning|intent)/i.test(L)?"verbose":"info";return{idx:M,raw:w,text:C,level:H,channel:R}},_=Vn.useMemo(()=>m.map((w,M)=>A(w,M)),[m]),E=Vn.useMemo(()=>_.filter(w=>(b==="all"||w.level===b)&&(T==="all"||w.channel===T)),[_,b,T]);return Vn.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[E]),y.jsxs("div",{className:"flex flex-col h-full max-h-screen",children:[y.jsxs("div",{className:`flex flex-col overflow-y-auto flex-1 min-h-0 ${c?"gap-4 p-4":"gap-8 p-8"}`,children:[y.jsxs("div",{className:"flex justify-between items-start",children:[y.jsxs("div",{children:[y.jsx("h1",{className:`${c?"text-base":"text-xl"} font-black uppercase tracking-widest text-white/90 mb-1`,children:"Hoplite"}),y.jsx("p",{className:"text-[10px] font-bold text-white/30 uppercase tracking-[0.2em]",children:"Tactical Arena"})]}),y.jsx("div",{className:`px-2 py-1 bg-white/10 rounded border border-white/20 text-[10px] font-black text-white/60 ${c?"hidden sm:block":""}`,children:"V2.1.0"})]}),!u&&y.jsx(ZM,{gameState:e}),y.jsxs("div",{className:c?"space-y-4":"space-y-6",children:[y.jsxs("div",{className:"flex flex-col",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Vitality"}),y.jsxs("div",{className:"flex items-end gap-2",children:[y.jsx("span",{className:`${c?"text-3xl":"text-4xl"} font-black text-red-500 leading-none`,children:e.player.hp}),y.jsx("span",{className:"text-xl text-white/20 font-bold leading-none mb-1",children:"/"}),y.jsx("span",{className:"text-xl text-gray-500 font-bold leading-none mb-1",children:e.player.maxHp})]})]}),y.jsxs("div",{className:"flex flex-col",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Guardian Plating"}),y.jsxs("div",{className:"flex items-center gap-3",children:[y.jsx("div",{className:`w-3 h-3 rounded-sm ${e.player.temporaryArmor?"bg-blue-400 rotate-45":"bg-white/5 border border-white/10"}`}),y.jsx("span",{className:"text-2xl font-black text-blue-400 leading-none",children:e.player.temporaryArmor||0})]})]}),e.enemies.filter(w=>w.subtype==="sentinel").map(w=>y.jsxs("div",{className:"pt-4 animate-in slide-in-from-right-8 duration-500",children:[y.jsxs("div",{className:"flex justify-between items-end mb-2",children:[y.jsx("span",{className:"text-xs font-black text-red-500 uppercase tracking-tighter italic",children:"Sentinel Directive"}),y.jsxs("span",{className:"text-lg font-black",children:[w.hp," ",y.jsxs("span",{className:"text-white/20 text-xs",children:["/ ",w.maxHp]})]})]}),y.jsx("div",{className:"h-4 w-full bg-red-950/30 rounded-md border border-red-500/20 overflow-hidden",children:y.jsx("div",{className:"h-full bg-gradient-to-r from-red-600 to-red-400 shadow-[0_0_20px_rgba(239,68,68,0.4)] transition-all duration-300",style:{width:`${w.hp/w.maxHp*100}%`}})})]},w.id))]}),y.jsxs("div",{className:`${c?"py-4 space-y-4":"py-8 space-y-6"} border-y border-white/5`,children:[y.jsxs("div",{className:"flex flex-col gap-3",children:[y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Arcade Progress"}),y.jsxs("span",{className:"text-xl font-black",children:[e.floor," ",y.jsx("span",{className:"text-white/20 text-sm",children:"/ 10"})]})]}),y.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden border border-white/5",children:y.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.4)] transition-all duration-1000 ease-out",style:{width:`${e.floor/10*100}%`}})})]}),y.jsxs("div",{className:"flex justify-between items-center",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Current Score"}),y.jsx("span",{className:"text-xl font-black text-white",children:g.toLocaleString()})]})]}),y.jsxs("div",{className:`flex flex-col ${c?"gap-2":"gap-3"}`,children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Directives"}),y.jsxs("button",{disabled:r,onClick:a,className:`w-full flex justify-between items-center ${c?"px-3 py-2.5":"px-4 py-3"} border rounded-xl transition-all group ${r?"bg-white/[0.03] border-white/5 text-white/30 cursor-not-allowed opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}`,children:[y.jsx("span",{className:"text-sm font-bold text-white/70",children:"Secure & Wait"}),y.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),y.jsxs("button",{onClick:n,className:`w-full flex justify-between items-center ${c?"px-3 py-2.5":"px-4 py-3"} bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-xl transition-all group`,children:[y.jsx("span",{className:"text-sm font-bold text-red-400/80",children:"Reset Chronology"}),y.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),y.jsxs("button",{onClick:s,className:`w-full flex justify-between items-center ${c?"px-3 py-2.5":"px-4 py-3"} bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all group`,children:[y.jsx("span",{className:"text-sm font-bold text-white/70",children:"Return to Hub"}),y.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]})]})]}),!p&&m.length>0&&y.jsxs("div",{className:`${c?"p-4":"p-8"} border-t border-white/5 bg-[#030712]/80 backdrop-blur-sm`,children:[y.jsxs("div",{className:"flex items-center justify-between mb-3",children:[y.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold block",children:"Tactical Log"}),y.jsxs("div",{className:`items-center gap-2 ${c?"hidden sm:flex":"flex"}`,children:[y.jsxs("select",{value:T,onChange:w=>v(w.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[y.jsx("option",{value:"all",children:"All Channels"}),y.jsx("option",{value:"combat",children:"Combat"}),y.jsx("option",{value:"hazard",children:"Hazard"}),y.jsx("option",{value:"objective",children:"Objective"}),y.jsx("option",{value:"ai",children:"AI"}),y.jsx("option",{value:"system",children:"System"})]}),y.jsxs("select",{value:b,onChange:w=>S(w.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[y.jsx("option",{value:"all",children:"All Levels"}),y.jsx("option",{value:"info",children:"Info"}),y.jsx("option",{value:"verbose",children:"Verbose"}),y.jsx("option",{value:"debug",children:"Debug"}),y.jsx("option",{value:"critical",children:"Critical"})]})]})]}),y.jsxs("div",{ref:f,className:"flex flex-col gap-2 bg-white/[0.02] border border-white/5 p-4 rounded-2xl overflow-y-auto max-h-[140px]",children:[E.slice(-20).map(w=>y.jsxs("div",{className:"flex gap-2 items-start",children:[y.jsxs("span",{className:"text-[10px] text-white/20 font-bold mt-1 leading-none shrink-0",children:["[",w.idx,"]"]}),y.jsx("span",{className:`text-[9px] mt-1 px-1.5 py-0.5 rounded border shrink-0 ${w.level==="critical"?"text-red-300 border-red-400/40 bg-red-500/10":w.level==="debug"?"text-cyan-300 border-cyan-400/40 bg-cyan-500/10":w.level==="verbose"?"text-amber-300 border-amber-400/40 bg-amber-500/10":"text-white/60 border-white/20 bg-white/5"}`,children:w.level.toUpperCase()}),y.jsx("span",{className:"text-[9px] mt-1 px-1.5 py-0.5 rounded border border-white/20 bg-white/5 text-white/60 shrink-0",children:w.channel.toUpperCase()}),y.jsx("p",{className:"text-[11px] leading-tight text-white/70 font-medium whitespace-pre-wrap",children:w.text})]},w.idx)),E.length===0&&y.jsx("div",{className:"text-[11px] text-white/40 italic",children:"No messages match current filters."})]})]})]})},tO=({onSelect:e,gameState:n})=>{const a=n.player,r=(n.pendingStatus?.shrineOptions||n.shrineOptions||["EXTRA_HP"]).map(c=>{if(c==="EXTRA_HP")return{id:"EXTRA_HP",label:"Extra Heart",desc:"Increases your Max HP by 1 and heals you to full.",color:"bg-red-900/40 border-red-500"};const u=yt.getUpgrade(c),p=yt.getSkillForUpgrade(c),g=a.activeSkills?.find(f=>f.id===p),m=g?.slot==="offensive"?"bg-orange-900/40 border-orange-500":g?.slot==="defensive"?"bg-blue-900/40 border-blue-500":"bg-green-900/40 border-green-500";return{id:c,label:u?u.name:c,desc:u?.description||"Unknown upgrade.",color:m}});return y.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-[100] p-4",children:y.jsxs("div",{className:"bg-gray-900 p-8 rounded-3xl border-2 border-slate-700 max-w-2xl w-full shadow-2xl relative overflow-hidden",children:[y.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-blue-500 to-green-500"}),y.jsx("h2",{className:"text-4xl font-black text-white mb-2 text-center tracking-tight",children:"SHRINE BLESSING"}),y.jsx("p",{className:"text-slate-400 mb-8 text-center text-lg",children:"The gods offer you a choice. Choose wisely."}),y.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.map(c=>y.jsxs("button",{onClick:()=>e(c.id),className:`
                                relative p-6 border-2 rounded-2xl text-left transition-all group overflow-hidden
                                hover:scale-[1.02] active:scale-[0.98]
                                ${c.color} hover:bg-slate-800
                            `,children:[y.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-blue-200",children:c.label}),y.jsx("p",{className:"text-sm text-slate-400 group-hover:text-slate-300 leading-relaxed",children:c.desc}),y.jsx("div",{className:"absolute -right-2 -bottom-2 opacity-0 group-hover:opacity-10 scale-0 group-hover:scale-150 transition-all font-bold text-4xl",children:"*"})]},c.id))})]})})},Xg=({skills:e,selectedSkillId:n,onSelectSkill:a,hasSpear:s,gameState:r,inputLocked:c=!1,compact:u=!1})=>{const p=["offensive","defensive","utility"];return y.jsx("div",{className:u?"grid grid-cols-3 gap-2 sm:grid-cols-4":"flex flex-col gap-4",children:p.flatMap(g=>e.filter(f=>f.slot===g).map(f=>{const b=n===f.id,S=f.currentCooldown>0,T=f.id==="SPEAR_THROW",v=c||S&&!T||T&&!s,A=H1(f.id),_=A?.name||f.name,E=typeof _=="function"?_(r):_,w=A?.icon||"";return y.jsxs("button",{disabled:v,onClick:()=>a(b?null:f.id),className:`
                            relative w-full ${u?"h-20 rounded-xl gap-0.5":"h-24 rounded-2xl gap-1"} flex flex-col items-center justify-center
                            border transition-all transform hover:translate-x-1
                            ${b?"bg-blue-600 border-white shadow-[0_0_20px_rgba(59,130,246,0.5)]":"bg-white/5 border-white/10 hover:border-blue-500/50"}
                            ${v?"opacity-40 grayscale pointer-events-none":"cursor-pointer"}
                        `,children:[y.jsx("span",{className:u?"text-2xl":"text-3xl",children:w}),y.jsx("span",{className:`${u?"text-[9px] tracking-[0.12em]":"text-[10px] tracking-widest"} uppercase font-bold text-white/50 text-center px-2 leading-tight`,children:E}),S&&!T&&y.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-black/40 ${u?"rounded-xl":"rounded-2xl"} backdrop-blur-[2px]`,children:y.jsx("span",{className:`${u?"text-2xl":"text-3xl"} font-black text-white`,children:f.currentCooldown})}),y.jsx("div",{className:`absolute ${u?"-top-1 left-2 px-1.5":"-top-2 left-4 px-2"} py-0.5 bg-[#030712] rounded-full border border-white/10 text-[8px] uppercase font-black tracking-widest text-white/40`,children:g})]},f.id)}))})},nO=({gameState:e,selectedSkillId:n,showMovementRange:a,isInputLocked:s,isReplayMode:r,replayActionsLength:c,replayIndex:u,replayActive:p,mobileToasts:g,tutorialInstructions:m,floorIntro:f,assetManifest:b,onSetBoardBusy:S,onTileClick:T,onSimulationEvents:v,onMirrorSnapshot:A,onReset:_,onWait:E,onExitToHub:w,onSelectSkill:M,onSelectUpgrade:C,onDismissTutorial:L,onToggleReplay:k,onStepReplay:R,onCloseReplay:H})=>y.jsxs("div",{className:"flex flex-col lg:flex-row w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[y.jsx("div",{className:"lg:hidden shrink-0 border-b border-white/5 bg-[#030712]/95 backdrop-blur-sm z-20",children:y.jsxs("div",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[y.jsxs("div",{className:"min-w-0",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"Level"}),y.jsxs("div",{className:"text-lg font-black text-white leading-none",children:[e.floor,y.jsx("span",{className:"text-white/25 text-sm ml-1",children:"/ 10"})]})]}),y.jsxs("div",{className:"ml-auto min-w-0 text-right",children:[y.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"HP"}),y.jsxs("div",{className:"text-lg font-black text-red-400 leading-none",children:[e.player.hp,y.jsxs("span",{className:"text-white/25 text-sm ml-1",children:["/ ",e.player.maxHp]})]})]})]})}),y.jsx("aside",{className:"hidden lg:flex w-80 border-r border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:y.jsx(eO,{gameState:e,onReset:_,onWait:E,onExitToHub:w,inputLocked:s})}),y.jsx("main",{className:"flex-1 min-h-0 relative flex items-center justify-center bg-[#020617] overflow-hidden",children:y.jsx("div",{className:"w-full h-full p-0 sm:p-3 lg:p-8 flex items-center justify-center",children:y.jsxs("div",{className:`w-full h-full relative border border-white/5 bg-[#030712]/50 rounded-none sm:rounded-3xl lg:rounded-[40px] shadow-[inset_0_0_100px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden ${e.isShaking?"animate-shake":""}`,children:[y.jsx(K0,{gameState:e,onMove:T,selectedSkillId:n,showMovementRange:a,onBusyStateChange:S,assetManifest:b,onSimulationEvents:v,onMirrorSnapshot:A}),y.jsx(KM,{visible:s&&e.gameStatus==="playing"})]})})}),y.jsx(FM,{mobileToasts:e.gameStatus==="playing"?g:[]}),y.jsx("aside",{className:"lg:hidden shrink-0 h-[26svh] min-h-[160px] max-h-[250px] border-t border-white/5 bg-[#030712] z-20 overflow-y-auto",children:y.jsxs("div",{className:"p-3 flex flex-col gap-3 h-full",children:[y.jsxs("div",{className:"flex items-center justify-between gap-2",children:[y.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Skills"}),y.jsxs("div",{className:"flex items-center gap-1.5",children:[y.jsx("button",{disabled:s,onClick:E,className:`px-2.5 py-1.5 rounded-lg border text-[10px] font-black uppercase tracking-widest ${s?"bg-white/[0.03] border-white/5 text-white/30 opacity-50":"bg-white/5 border-white/10 text-white/70 active:bg-white/10"}`,children:"Wait"}),y.jsx("button",{onClick:w,className:"px-2.5 py-1.5 rounded-lg border border-white/10 bg-white/5 text-[10px] font-black uppercase tracking-widest text-white/70 active:bg-white/10",children:"Hub"}),y.jsx("button",{onClick:_,className:"px-2.5 py-1.5 rounded-lg border border-red-500/20 bg-red-500/10 text-[10px] font-black uppercase tracking-widest text-red-300/90 active:bg-red-500/20",children:"Reset"})]})]}),y.jsx(Xg,{skills:e.player.activeSkills||[],selectedSkillId:n,onSelectSkill:M,hasSpear:e.hasSpear,gameState:e,inputLocked:s,compact:!0})]})}),y.jsx("aside",{className:"hidden lg:flex w-80 border-l border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:y.jsxs("div",{className:"p-6 flex flex-col gap-8 h-full",children:[y.jsxs("div",{className:"flex-1",children:[y.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30 mb-6",children:"Tactical Skills"}),y.jsx(Xg,{skills:e.player.activeSkills||[],selectedSkillId:n,onSelectSkill:M,hasSpear:e.hasSpear,gameState:e,inputLocked:s})]}),y.jsx("div",{className:"pt-8 border-t border-white/5 text-center",children:y.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/20",children:"Hop Engine v5.0"})})]})}),y.jsx(X0,{tutorialInstructions:m,onDismiss:L}),e.gameStatus==="choosing_upgrade"&&y.jsx(tO,{onSelect:C,gameState:e}),y.jsx(WM,{visible:e.gameStatus==="lost",onReset:_}),y.jsx(GM,{visible:e.gameStatus==="won",score:e.completedRun?.score||0,onExitToHub:w}),y.jsx(XM,{floorIntro:f}),y.jsx(JM,{isReplayMode:r,replayIndex:u,replayLength:c,replayActive:p,onToggleReplay:k,onStepReplay:R,onCloseReplay:H})]}),iO=e=>{const n=e.payload;if(!(!n||typeof n!="object")){if("q"in n&&"r"in n)return{q:Number(n.q??0),r:Number(n.r??0),s:Number(n.s??0)};if(e.type==="USE_SKILL"){const a=n;return{skillId:a.skillId??"unknown",target:a.target?{q:a.target.q,r:a.target.r,s:a.target.s}:null}}if(e.type==="START_RUN")return{loadoutId:n.loadoutId??"unknown",mode:n.mode??"normal"};if(e.type==="LOAD_STATE"){const a=n;return{floor:a?.floor??0,gameStatus:a?.gameStatus??"unknown",turnNumber:a?.turnNumber??0,queueLength:Array.isArray(a?.initiativeQueue)?a.initiativeQueue.length:0}}return{}}};function aO(){const{hubPath:e,arcadePath:n,biomesPath:a,isArcadeRoute:s,isBiomesRoute:r,navigateTo:c}=BM(),[u,p]=_M(),g=typeof window<"u"&&!!window.__HOP_DEBUG_QUERY,m=vM();xM(u,g);const f=N.useRef(()=>{}),b=N.useCallback((Ae,qe)=>{f.current(Ae,qe)},[]),{isReplayMode:S,replayActions:T,replayActive:v,replayError:A,replayIndexRef:_,setReplayActive:E,resetReplayUi:w,startReplay:M,stepReplay:C}=wM({dispatchWithTrace:b});SM([u.gameStatus,S]);const[L,k]=N.useState(null),[R,H]=N.useState(!1),[D,$]=N.useState(!1),[J,te]=N.useState(!1),{turnDriver:ae,isInputLocked:W,appendTurnTrace:q,dispatchWithTrace:P}=LM({gameState:u,dispatch:p,isReplayMode:S,isBusy:D,postCommitInputLock:J,dispatchWithTraceProxyRef:f,summarizeActionPayload:iO}),{mobileToasts:z,handleSimulationEvents:X,handleUiMirrorSnapshot:le}=CM({gameState:u,appendTurnTrace:q}),{armPostCommitLock:fe}=RM({gameState:u,turnDriver:ae,isBusy:D,isReplayMode:S,postCommitInputLock:J,setPostCommitInputLock:te,appendTurnTrace:q,dispatchWithTrace:P}),[I,K]=N.useState(null),G=AM(u);OM(u,S);const ne=Ae=>{W||k(Ae)},re=Ae=>{if(!W){if(L){fe(),P({type:"USE_SKILL",payload:{skillId:L,target:Ae}},"player_use_skill"),k(null);return}if(ee(Ae,u.player.position)){H(!R);return}fe(),P({type:"MOVE",payload:Ae},"player_move"),H(!1)}},ce=Ae=>{S||D||P({type:"SELECT_UPGRADE",payload:Ae},"upgrade_select")},pe=()=>{P({type:"RESET"},"reset"),k(null),w()},ke=()=>{W||(fe(),P({type:"WAIT"},"player_wait"),k(null))},Se=()=>{Ce()},_e=(Ae,qe)=>{P({type:"LOAD_STATE",payload:Ae},"scenario_load"),K(qe),k(null)},Ce=()=>{P({type:"EXIT_TO_HUB"},"exit_to_hub"),k(null),w(),c(e)},ze=Ae=>{const qe=u.selectedLoadoutId;if(!qe){console.warn("Start Run called without a selected loadout.");return}P({type:"START_RUN",payload:{loadoutId:qe,mode:Ae}},"hub_start_run")},$e=Ae=>{P({type:"START_RUN",payload:{loadoutId:Ae,mode:"daily"}},"arcade_start_run"),c(e)};return r?y.jsx(bM,{assetManifest:m,onBack:()=>c(e)}):u.gameStatus==="hub"?y.jsx(QM,{gameState:u,isArcadeRoute:s,hubPath:e,arcadePath:n,biomesPath:a,replayError:A,tutorialInstructions:I,navigateTo:c,onStartArcadeRun:$e,onSelectLoadout:Ae=>{P({type:"APPLY_LOADOUT",payload:Ae},"hub_select_loadout")},onStartRun:ze,onLoadScenario:_e,onStartReplay:M,onDismissTutorial:()=>K(null)}):y.jsx(nO,{gameState:u,selectedSkillId:L,showMovementRange:R,isInputLocked:W,isReplayMode:S,replayActionsLength:T.length,replayIndex:_.current,replayActive:v,mobileToasts:z,tutorialInstructions:I,floorIntro:G,assetManifest:m,onSetBoardBusy:$,onTileClick:re,onSimulationEvents:X,onMirrorSnapshot:le,onReset:pe,onWait:ke,onExitToHub:Ce,onSelectSkill:ne,onSelectUpgrade:ce,onDismissTutorial:()=>K(null),onToggleReplay:()=>E(!v),onStepReplay:C,onCloseReplay:Se})}bS.createRoot(document.getElementById("root")).render(y.jsx(N.StrictMode,{children:y.jsx(aO,{})}));
