(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function s(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(c){if(c.ep)return;c.ep=!0;const l=s(c);fetch(c.href,l)}})();function rx(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var vf={exports:{}},ll={};var Rg;function lx(){if(Rg)return ll;Rg=1;var e=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function s(o,c,l){var f=null;if(l!==void 0&&(f=""+l),c.key!==void 0&&(f=""+c.key),"key"in c){l={};for(var h in c)h!=="key"&&(l[h]=c[h])}else l=c;return c=l.ref,{$$typeof:e,type:o,key:f,ref:c!==void 0?c:null,props:l}}return ll.Fragment=i,ll.jsx=s,ll.jsxs=s,ll}var Ng;function cx(){return Ng||(Ng=1,vf.exports=lx()),vf.exports}var m=cx(),Sf={exports:{}},Fe={};var Ig;function ux(){if(Ig)return Fe;Ig=1;var e=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),S=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),A=Symbol.iterator;function M(k){return k===null||typeof k!="object"?null:(k=A&&k[A]||k["@@iterator"],typeof k=="function"?k:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,C={};function N(k,U,K){this.props=k,this.context=U,this.refs=C,this.updater=K||p}N.prototype.isReactComponent={},N.prototype.setState=function(k,U){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,U,"setState")},N.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function O(){}O.prototype=N.prototype;function w(k,U,K){this.props=k,this.context=U,this.refs=C,this.updater=K||p}var R=w.prototype=new O;R.constructor=w,g(R,N.prototype),R.isPureReactComponent=!0;var Q=Array.isArray;function W(){}var j={H:null,A:null,T:null,S:null},re=Object.prototype.hasOwnProperty;function pe(k,U,K){var ne=K.ref;return{$$typeof:e,type:k,key:U,ref:ne!==void 0?ne:null,props:K}}function z(k,U){return pe(k.type,U,k.props)}function ue(k){return typeof k=="object"&&k!==null&&k.$$typeof===e}function ye(k){var U={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(K){return U[K]})}var q=/\/+/g;function le(k,U){return typeof k=="object"&&k!==null&&k.key!=null?ye(""+k.key):U.toString(36)}function Z(k){switch(k.status){case"fulfilled":return k.value;case"rejected":throw k.reason;default:switch(typeof k.status=="string"?k.then(W,W):(k.status="pending",k.then(function(U){k.status==="pending"&&(k.status="fulfilled",k.value=U)},function(U){k.status==="pending"&&(k.status="rejected",k.reason=U)})),k.status){case"fulfilled":return k.value;case"rejected":throw k.reason}}throw k}function P(k,U,K,ne,xe){var Ie=typeof k;(Ie==="undefined"||Ie==="boolean")&&(k=null);var Se=!1;if(k===null)Se=!0;else switch(Ie){case"bigint":case"string":case"number":Se=!0;break;case"object":switch(k.$$typeof){case e:case i:Se=!0;break;case S:return Se=k._init,P(Se(k._payload),U,K,ne,xe)}}if(Se)return xe=xe(k),Se=ne===""?"."+le(k,0):ne,Q(xe)?(K="",Se!=null&&(K=Se.replace(q,"$&/")+"/"),P(xe,U,K,"",function(ze){return ze})):xe!=null&&(ue(xe)&&(xe=z(xe,K+(xe.key==null||k&&k.key===xe.key?"":(""+xe.key).replace(q,"$&/")+"/")+Se)),U.push(xe)),1;Se=0;var nt=ne===""?".":ne+":";if(Q(k))for(var He=0;He<k.length;He++)ne=k[He],Ie=nt+le(ne,He),Se+=P(ne,U,K,Ie,xe);else if(He=M(k),typeof He=="function")for(k=He.call(k),He=0;!(ne=k.next()).done;)ne=ne.value,Ie=nt+le(ne,He++),Se+=P(ne,U,K,Ie,xe);else if(Ie==="object"){if(typeof k.then=="function")return P(Z(k),U,K,ne,xe);throw U=String(k),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.")}return Se}function ee(k,U,K){if(k==null)return k;var ne=[],xe=0;return P(k,ne,"","",function(Ie){return U.call(K,Ie,xe++)}),ne}function Y(k){if(k._status===-1){var U=k._result;U=U(),U.then(function(K){(k._status===0||k._status===-1)&&(k._status=1,k._result=K)},function(K){(k._status===0||k._status===-1)&&(k._status=2,k._result=K)}),k._status===-1&&(k._status=0,k._result=U)}if(k._status===1)return k._result.default;throw k._result}var he=typeof reportError=="function"?reportError:function(k){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var U=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof k=="object"&&k!==null&&typeof k.message=="string"?String(k.message):String(k),error:k});if(!window.dispatchEvent(U))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",k);return}console.error(k)},ge={map:ee,forEach:function(k,U,K){ee(k,function(){U.apply(this,arguments)},K)},count:function(k){var U=0;return ee(k,function(){U++}),U},toArray:function(k){return ee(k,function(U){return U})||[]},only:function(k){if(!ue(k))throw Error("React.Children.only expected to receive a single React element child.");return k}};return Fe.Activity=v,Fe.Children=ge,Fe.Component=N,Fe.Fragment=s,Fe.Profiler=c,Fe.PureComponent=w,Fe.StrictMode=o,Fe.Suspense=b,Fe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=j,Fe.__COMPILER_RUNTIME={__proto__:null,c:function(k){return j.H.useMemoCache(k)}},Fe.cache=function(k){return function(){return k.apply(null,arguments)}},Fe.cacheSignal=function(){return null},Fe.cloneElement=function(k,U,K){if(k==null)throw Error("The argument must be a React element, but you passed "+k+".");var ne=g({},k.props),xe=k.key;if(U!=null)for(Ie in U.key!==void 0&&(xe=""+U.key),U)!re.call(U,Ie)||Ie==="key"||Ie==="__self"||Ie==="__source"||Ie==="ref"&&U.ref===void 0||(ne[Ie]=U[Ie]);var Ie=arguments.length-2;if(Ie===1)ne.children=K;else if(1<Ie){for(var Se=Array(Ie),nt=0;nt<Ie;nt++)Se[nt]=arguments[nt+2];ne.children=Se}return pe(k.type,xe,ne)},Fe.createContext=function(k){return k={$$typeof:f,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null},k.Provider=k,k.Consumer={$$typeof:l,_context:k},k},Fe.createElement=function(k,U,K){var ne,xe={},Ie=null;if(U!=null)for(ne in U.key!==void 0&&(Ie=""+U.key),U)re.call(U,ne)&&ne!=="key"&&ne!=="__self"&&ne!=="__source"&&(xe[ne]=U[ne]);var Se=arguments.length-2;if(Se===1)xe.children=K;else if(1<Se){for(var nt=Array(Se),He=0;He<Se;He++)nt[He]=arguments[He+2];xe.children=nt}if(k&&k.defaultProps)for(ne in Se=k.defaultProps,Se)xe[ne]===void 0&&(xe[ne]=Se[ne]);return pe(k,Ie,xe)},Fe.createRef=function(){return{current:null}},Fe.forwardRef=function(k){return{$$typeof:h,render:k}},Fe.isValidElement=ue,Fe.lazy=function(k){return{$$typeof:S,_payload:{_status:-1,_result:k},_init:Y}},Fe.memo=function(k,U){return{$$typeof:y,type:k,compare:U===void 0?null:U}},Fe.startTransition=function(k){var U=j.T,K={};j.T=K;try{var ne=k(),xe=j.S;xe!==null&&xe(K,ne),typeof ne=="object"&&ne!==null&&typeof ne.then=="function"&&ne.then(W,he)}catch(Ie){he(Ie)}finally{U!==null&&K.types!==null&&(U.types=K.types),j.T=U}},Fe.unstable_useCacheRefresh=function(){return j.H.useCacheRefresh()},Fe.use=function(k){return j.H.use(k)},Fe.useActionState=function(k,U,K){return j.H.useActionState(k,U,K)},Fe.useCallback=function(k,U){return j.H.useCallback(k,U)},Fe.useContext=function(k){return j.H.useContext(k)},Fe.useDebugValue=function(){},Fe.useDeferredValue=function(k,U){return j.H.useDeferredValue(k,U)},Fe.useEffect=function(k,U){return j.H.useEffect(k,U)},Fe.useEffectEvent=function(k){return j.H.useEffectEvent(k)},Fe.useId=function(){return j.H.useId()},Fe.useImperativeHandle=function(k,U,K){return j.H.useImperativeHandle(k,U,K)},Fe.useInsertionEffect=function(k,U){return j.H.useInsertionEffect(k,U)},Fe.useLayoutEffect=function(k,U){return j.H.useLayoutEffect(k,U)},Fe.useMemo=function(k,U){return j.H.useMemo(k,U)},Fe.useOptimistic=function(k,U){return j.H.useOptimistic(k,U)},Fe.useReducer=function(k,U,K){return j.H.useReducer(k,U,K)},Fe.useRef=function(k){return j.H.useRef(k)},Fe.useState=function(k){return j.H.useState(k)},Fe.useSyncExternalStore=function(k,U,K){return j.H.useSyncExternalStore(k,U,K)},Fe.useTransition=function(){return j.H.useTransition()},Fe.version="19.2.3",Fe}var Lg;function rm(){return Lg||(Lg=1,Sf.exports=ux()),Sf.exports}var _=rm();const ma=rx(_);var Af={exports:{}},cl={},Tf={exports:{}},Ef={};var Bg;function dx(){return Bg||(Bg=1,(function(e){function i(P,ee){var Y=P.length;P.push(ee);e:for(;0<Y;){var he=Y-1>>>1,ge=P[he];if(0<c(ge,ee))P[he]=ee,P[Y]=ge,Y=he;else break e}}function s(P){return P.length===0?null:P[0]}function o(P){if(P.length===0)return null;var ee=P[0],Y=P.pop();if(Y!==ee){P[0]=Y;e:for(var he=0,ge=P.length,k=ge>>>1;he<k;){var U=2*(he+1)-1,K=P[U],ne=U+1,xe=P[ne];if(0>c(K,Y))ne<ge&&0>c(xe,K)?(P[he]=xe,P[ne]=Y,he=ne):(P[he]=K,P[U]=Y,he=U);else if(ne<ge&&0>c(xe,Y))P[he]=xe,P[ne]=Y,he=ne;else break e}}return ee}function c(P,ee){var Y=P.sortIndex-ee.sortIndex;return Y!==0?Y:P.id-ee.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var f=Date,h=f.now();e.unstable_now=function(){return f.now()-h}}var b=[],y=[],S=1,v=null,A=3,M=!1,p=!1,g=!1,C=!1,N=typeof setTimeout=="function"?setTimeout:null,O=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function R(P){for(var ee=s(y);ee!==null;){if(ee.callback===null)o(y);else if(ee.startTime<=P)o(y),ee.sortIndex=ee.expirationTime,i(b,ee);else break;ee=s(y)}}function Q(P){if(g=!1,R(P),!p)if(s(b)!==null)p=!0,W||(W=!0,ye());else{var ee=s(y);ee!==null&&Z(Q,ee.startTime-P)}}var W=!1,j=-1,re=5,pe=-1;function z(){return C?!0:!(e.unstable_now()-pe<re)}function ue(){if(C=!1,W){var P=e.unstable_now();pe=P;var ee=!0;try{e:{p=!1,g&&(g=!1,O(j),j=-1),M=!0;var Y=A;try{t:{for(R(P),v=s(b);v!==null&&!(v.expirationTime>P&&z());){var he=v.callback;if(typeof he=="function"){v.callback=null,A=v.priorityLevel;var ge=he(v.expirationTime<=P);if(P=e.unstable_now(),typeof ge=="function"){v.callback=ge,R(P),ee=!0;break t}v===s(b)&&o(b),R(P)}else o(b);v=s(b)}if(v!==null)ee=!0;else{var k=s(y);k!==null&&Z(Q,k.startTime-P),ee=!1}}break e}finally{v=null,A=Y,M=!1}ee=void 0}}finally{ee?ye():W=!1}}}var ye;if(typeof w=="function")ye=function(){w(ue)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,le=q.port2;q.port1.onmessage=ue,ye=function(){le.postMessage(null)}}else ye=function(){N(ue,0)};function Z(P,ee){j=N(function(){P(e.unstable_now())},ee)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_next=function(P){switch(A){case 1:case 2:case 3:var ee=3;break;default:ee=A}var Y=A;A=ee;try{return P()}finally{A=Y}},e.unstable_requestPaint=function(){C=!0},e.unstable_runWithPriority=function(P,ee){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var Y=A;A=P;try{return ee()}finally{A=Y}},e.unstable_scheduleCallback=function(P,ee,Y){var he=e.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?he+Y:he):Y=he,P){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=Y+ge,P={id:S++,callback:ee,priorityLevel:P,startTime:Y,expirationTime:ge,sortIndex:-1},Y>he?(P.sortIndex=Y,i(y,P),s(b)===null&&P===s(y)&&(g?(O(j),j=-1):g=!0,Z(Q,Y-he))):(P.sortIndex=ge,i(b,P),p||M||(p=!0,W||(W=!0,ye()))),P},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(P){var ee=A;return function(){var Y=A;A=ee;try{return P.apply(this,arguments)}finally{A=Y}}}})(Ef)),Ef}var Hg;function fx(){return Hg||(Hg=1,Tf.exports=dx()),Tf.exports}var _f={exports:{}},Jn={};var jg;function mx(){if(jg)return Jn;jg=1;var e=rm();function i(b){var y="https://react.dev/errors/"+b;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var S=2;S<arguments.length;S++)y+="&args[]="+encodeURIComponent(arguments[S])}return"Minified React error #"+b+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var o={d:{f:s,r:function(){throw Error(i(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},c=Symbol.for("react.portal");function l(b,y,S){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:v==null?null:""+v,children:b,containerInfo:y,implementation:S}}var f=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(b,y){if(b==="font")return"";if(typeof y=="string")return y==="use-credentials"?y:""}return Jn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,Jn.createPortal=function(b,y){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)throw Error(i(299));return l(b,y,null,S)},Jn.flushSync=function(b){var y=f.T,S=o.p;try{if(f.T=null,o.p=2,b)return b()}finally{f.T=y,o.p=S,o.d.f()}},Jn.preconnect=function(b,y){typeof b=="string"&&(y?(y=y.crossOrigin,y=typeof y=="string"?y==="use-credentials"?y:"":void 0):y=null,o.d.C(b,y))},Jn.prefetchDNS=function(b){typeof b=="string"&&o.d.D(b)},Jn.preinit=function(b,y){if(typeof b=="string"&&y&&typeof y.as=="string"){var S=y.as,v=h(S,y.crossOrigin),A=typeof y.integrity=="string"?y.integrity:void 0,M=typeof y.fetchPriority=="string"?y.fetchPriority:void 0;S==="style"?o.d.S(b,typeof y.precedence=="string"?y.precedence:void 0,{crossOrigin:v,integrity:A,fetchPriority:M}):S==="script"&&o.d.X(b,{crossOrigin:v,integrity:A,fetchPriority:M,nonce:typeof y.nonce=="string"?y.nonce:void 0})}},Jn.preinitModule=function(b,y){if(typeof b=="string")if(typeof y=="object"&&y!==null){if(y.as==null||y.as==="script"){var S=h(y.as,y.crossOrigin);o.d.M(b,{crossOrigin:S,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0})}}else y==null&&o.d.M(b)},Jn.preload=function(b,y){if(typeof b=="string"&&typeof y=="object"&&y!==null&&typeof y.as=="string"){var S=y.as,v=h(S,y.crossOrigin);o.d.L(b,S,{crossOrigin:v,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0,type:typeof y.type=="string"?y.type:void 0,fetchPriority:typeof y.fetchPriority=="string"?y.fetchPriority:void 0,referrerPolicy:typeof y.referrerPolicy=="string"?y.referrerPolicy:void 0,imageSrcSet:typeof y.imageSrcSet=="string"?y.imageSrcSet:void 0,imageSizes:typeof y.imageSizes=="string"?y.imageSizes:void 0,media:typeof y.media=="string"?y.media:void 0})}},Jn.preloadModule=function(b,y){if(typeof b=="string")if(y){var S=h(y.as,y.crossOrigin);o.d.m(b,{as:typeof y.as=="string"&&y.as!=="script"?y.as:void 0,crossOrigin:S,integrity:typeof y.integrity=="string"?y.integrity:void 0})}else o.d.m(b)},Jn.requestFormReset=function(b){o.d.r(b)},Jn.unstable_batchedUpdates=function(b,y){return b(y)},Jn.useFormState=function(b,y,S){return f.H.useFormState(b,y,S)},Jn.useFormStatus=function(){return f.H.useHostTransitionStatus()},Jn.version="19.2.3",Jn}var Dg;function px(){if(Dg)return _f.exports;Dg=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(i){console.error(i)}}return e(),_f.exports=mx(),_f.exports}var Pg;function hx(){if(Pg)return cl;Pg=1;var e=fx(),i=rm(),s=px();function o(t){var n="https://react.dev/errors/"+t;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var a=2;a<arguments.length;a++)n+="&args[]="+encodeURIComponent(arguments[a])}return"Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function l(t){var n=t,a=t;if(t.alternate)for(;n.return;)n=n.return;else{t=n;do n=t,(n.flags&4098)!==0&&(a=n.return),t=n.return;while(t)}return n.tag===3?a:null}function f(t){if(t.tag===13){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function h(t){if(t.tag===31){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function b(t){if(l(t)!==t)throw Error(o(188))}function y(t){var n=t.alternate;if(!n){if(n=l(t),n===null)throw Error(o(188));return n!==t?null:t}for(var a=t,r=n;;){var u=a.return;if(u===null)break;var d=u.alternate;if(d===null){if(r=u.return,r!==null){a=r;continue}break}if(u.child===d.child){for(d=u.child;d;){if(d===a)return b(u),t;if(d===r)return b(u),n;d=d.sibling}throw Error(o(188))}if(a.return!==r.return)a=u,r=d;else{for(var x=!1,E=u.child;E;){if(E===a){x=!0,a=u,r=d;break}if(E===r){x=!0,r=u,a=d;break}E=E.sibling}if(!x){for(E=d.child;E;){if(E===a){x=!0,a=d,r=u;break}if(E===r){x=!0,r=d,a=u;break}E=E.sibling}if(!x)throw Error(o(189))}}if(a.alternate!==r)throw Error(o(190))}if(a.tag!==3)throw Error(o(188));return a.stateNode.current===a?t:n}function S(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t;for(t=t.child;t!==null;){if(n=S(t),n!==null)return n;t=t.sibling}return null}var v=Object.assign,A=Symbol.for("react.element"),M=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),O=Symbol.for("react.consumer"),w=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),W=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),pe=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),ue=Symbol.iterator;function ye(t){return t===null||typeof t!="object"?null:(t=ue&&t[ue]||t["@@iterator"],typeof t=="function"?t:null)}var q=Symbol.for("react.client.reference");function le(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===q?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case g:return"Fragment";case N:return"Profiler";case C:return"StrictMode";case Q:return"Suspense";case W:return"SuspenseList";case pe:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case p:return"Portal";case w:return t.displayName||"Context";case O:return(t._context.displayName||"Context")+".Consumer";case R:var n=t.render;return t=t.displayName,t||(t=n.displayName||n.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case j:return n=t.displayName||null,n!==null?n:le(t.type)||"Memo";case re:n=t._payload,t=t._init;try{return le(t(n))}catch{}}return null}var Z=Array.isArray,P=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},he=[],ge=-1;function k(t){return{current:t}}function U(t){0>ge||(t.current=he[ge],he[ge]=null,ge--)}function K(t,n){ge++,he[ge]=t.current,t.current=n}var ne=k(null),xe=k(null),Ie=k(null),Se=k(null);function nt(t,n){switch(K(Ie,n),K(xe,t),K(ne,null),n.nodeType){case 9:case 11:t=(t=n.documentElement)&&(t=t.namespaceURI)?eg(t):0;break;default:if(t=n.tagName,n=n.namespaceURI)n=eg(n),t=tg(n,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}U(ne),K(ne,t)}function He(){U(ne),U(xe),U(Ie)}function ze(t){t.memoizedState!==null&&K(Se,t);var n=ne.current,a=tg(n,t.type);n!==a&&(K(xe,t),K(ne,a))}function Qt(t){xe.current===t&&(U(ne),U(xe)),Se.current===t&&(U(Se),al._currentValue=Y)}var Le,At;function ft(t){if(Le===void 0)try{throw Error()}catch(a){var n=a.stack.trim().match(/\n( *(at )?)/);Le=n&&n[1]||"",At=-1<a.stack.indexOf(`
    at`)?" (<anonymous>)":-1<a.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Le+t+At}var qn=!1;function Dt(t,n){if(!t||qn)return"";qn=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(n){var ce=function(){throw Error()};if(Object.defineProperty(ce.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ce,[])}catch(J){var F=J}Reflect.construct(t,[],ce)}else{try{ce.call()}catch(J){F=J}t.call(ce.prototype)}}else{try{throw Error()}catch(J){F=J}(ce=t())&&typeof ce.catch=="function"&&ce.catch(function(){})}}catch(J){if(J&&F&&typeof J.stack=="string")return[J.stack,F.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=r.DetermineComponentFrameRoot(),x=d[0],E=d[1];if(x&&E){var L=x.split(`
`),V=E.split(`
`);for(u=r=0;r<L.length&&!L[r].includes("DetermineComponentFrameRoot");)r++;for(;u<V.length&&!V[u].includes("DetermineComponentFrameRoot");)u++;if(r===L.length||u===V.length)for(r=L.length-1,u=V.length-1;1<=r&&0<=u&&L[r]!==V[u];)u--;for(;1<=r&&0<=u;r--,u--)if(L[r]!==V[u]){if(r!==1||u!==1)do if(r--,u--,0>u||L[r]!==V[u]){var te=`
`+L[r].replace(" at new "," at ");return t.displayName&&te.includes("<anonymous>")&&(te=te.replace("<anonymous>",t.displayName)),te}while(1<=r&&0<=u);break}}}finally{qn=!1,Error.prepareStackTrace=a}return(a=t?t.displayName||t.name:"")?ft(a):""}function zn(t,n){switch(t.tag){case 26:case 27:case 5:return ft(t.type);case 16:return ft("Lazy");case 13:return t.child!==n&&n!==null?ft("Suspense Fallback"):ft("Suspense");case 19:return ft("SuspenseList");case 0:case 15:return Dt(t.type,!1);case 11:return Dt(t.type.render,!1);case 1:return Dt(t.type,!0);case 31:return ft("Activity");default:return""}}function ct(t){try{var n="",a=null;do n+=zn(t,a),a=t,t=t.return;while(t);return n}catch(r){return`
Error generating stack: `+r.message+`
`+r.stack}}var Mt=Object.prototype.hasOwnProperty,an=e.unstable_scheduleCallback,Zn=e.unstable_cancelCallback,vi=e.unstable_shouldYield,Si=e.unstable_requestPaint,wn=e.unstable_now,ya=e.unstable_getCurrentPriorityLevel,Nn=e.unstable_ImmediatePriority,dn=e.unstable_UserBlockingPriority,Ft=e.unstable_NormalPriority,Hi=e.unstable_LowPriority,fn=e.unstable_IdlePriority,ea=e.log,ei=e.unstable_setDisableYieldValue,sn=null,ke=null;function ut(t){if(typeof ea=="function"&&ei(t),ke&&typeof ke.setStrictMode=="function")try{ke.setStrictMode(sn,t)}catch{}}var et=Math.clz32?Math.clz32:Jt,ti=Math.log,mn=Math.LN2;function Jt(t){return t>>>=0,t===0?32:31-(ti(t)/mn|0)|0}var ta=256,pn=262144,In=4194304;function Ln(t){var n=t&42;if(n!==0)return n;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Nt(t,n,a){var r=t.pendingLanes;if(r===0)return 0;var u=0,d=t.suspendedLanes,x=t.pingedLanes;t=t.warmLanes;var E=r&134217727;return E!==0?(r=E&~d,r!==0?u=Ln(r):(x&=E,x!==0?u=Ln(x):a||(a=E&~t,a!==0&&(u=Ln(a))))):(E=r&~d,E!==0?u=Ln(E):x!==0?u=Ln(x):a||(a=r&~t,a!==0&&(u=Ln(a)))),u===0?0:n!==0&&n!==u&&(n&d)===0&&(d=u&-u,a=n&-n,d>=a||d===32&&(a&4194048)!==0)?n:u}function hn(t,n){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&n)===0}function Bn(t,n){switch(t){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function na(){var t=In;return In<<=1,(In&62914560)===0&&(In=4194304),t}function ba(t){for(var n=[],a=0;31>a;a++)n.push(t);return n}function Ai(t,n){t.pendingLanes|=n,n!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function ji(t,n,a,r,u,d){var x=t.pendingLanes;t.pendingLanes=a,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=a,t.entangledLanes&=a,t.errorRecoveryDisabledLanes&=a,t.shellSuspendCounter=0;var E=t.entanglements,L=t.expirationTimes,V=t.hiddenUpdates;for(a=x&~a;0<a;){var te=31-et(a),ce=1<<te;E[te]=0,L[te]=-1;var F=V[te];if(F!==null)for(V[te]=null,te=0;te<F.length;te++){var J=F[te];J!==null&&(J.lane&=-536870913)}a&=~ce}r!==0&&Di(t,r,0),d!==0&&u===0&&t.tag!==0&&(t.suspendedLanes|=d&~(x&~n))}function Di(t,n,a){t.pendingLanes|=n,t.suspendedLanes&=~n;var r=31-et(n);t.entangledLanes|=n,t.entanglements[r]=t.entanglements[r]|1073741824|a&261930}function xa(t,n){var a=t.entangledLanes|=n;for(t=t.entanglements;a;){var r=31-et(a),u=1<<r;u&n|t[r]&n&&(t[r]|=n),a&=~u}}function ka(t,n){var a=n&-n;return a=(a&42)!==0?1:$s(a),(a&(t.suspendedLanes|n))!==0?0:a}function $s(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Vs(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function ni(){var t=ee.p;return t!==0?t:(t=window.event,t===void 0?32:Eg(t.type))}function gn(t,n){var a=ee.p;try{return ee.p=t,n()}finally{ee.p=a}}var ii=Math.random().toString(36).slice(2),X="__reactFiber$"+ii,se="__reactProps$"+ii,fe="__reactContainer$"+ii,we="__reactEvents$"+ii,Oe="__reactListeners$"+ii,mt="__reactHandles$"+ii,Ke="__reactResources$"+ii,pt="__reactMarker$"+ii;function It(t){delete t[X],delete t[se],delete t[we],delete t[Oe],delete t[mt]}function yt(t){var n=t[X];if(n)return n;for(var a=t.parentNode;a;){if(n=a[fe]||a[X]){if(a=n.alternate,n.child!==null||a!==null&&a.child!==null)for(t=lg(t);t!==null;){if(a=t[X])return a;t=lg(t)}return n}t=a,a=t.parentNode}return null}function Lt(t){if(t=t[X]||t[fe]){var n=t.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return t}return null}function Mn(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t.stateNode;throw Error(o(33))}function Ti(t){var n=t[Ke];return n||(n=t[Ke]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Pt(t){t[pt]=!0}var $n=new Set,va={};function Ei(t,n){ai(t,n),ai(t+"Capture",n)}function ai(t,n){for(va[t]=n,t=0;t<n.length;t++)$n.add(n[t])}var Nl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ys={},Ks={};function Hn(t){return Mt.call(Ks,t)?!0:Mt.call(Ys,t)?!1:Nl.test(t)?Ks[t]=!0:(Ys[t]=!0,!1)}function yn(t,n,a){if(Hn(n))if(a===null)t.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":t.removeAttribute(n);return;case"boolean":var r=n.toLowerCase().slice(0,5);if(r!=="data-"&&r!=="aria-"){t.removeAttribute(n);return}}t.setAttribute(n,""+a)}}function jn(t,n,a){if(a===null)t.removeAttribute(n);else{switch(typeof a){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttribute(n,""+a)}}function Gn(t,n,a,r){if(r===null)t.removeAttribute(a);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(a);return}t.setAttributeNS(n,a,""+r)}}function $t(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function si(t){var n=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Ra(t,n,a){var r=Object.getOwnPropertyDescriptor(t.constructor.prototype,n);if(!t.hasOwnProperty(n)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var u=r.get,d=r.set;return Object.defineProperty(t,n,{configurable:!0,get:function(){return u.call(this)},set:function(x){a=""+x,d.call(this,x)}}),Object.defineProperty(t,n,{enumerable:r.enumerable}),{getValue:function(){return a},setValue:function(x){a=""+x},stopTracking:function(){t._valueTracker=null,delete t[n]}}}}function ia(t){if(!t._valueTracker){var n=si(t)?"checked":"value";t._valueTracker=Ra(t,n,""+t[n])}}function os(t){if(!t)return!1;var n=t._valueTracker;if(!n)return!0;var a=n.getValue(),r="";return t&&(r=si(t)?t.checked?"true":"false":t.value),t=r,t!==a?(n.setValue(t),!0):!1}function Sa(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var Ro=/[\n"\\]/g;function Vn(t){return t.replace(Ro,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Aa(t,n,a,r,u,d,x,E){t.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?t.type=x:t.removeAttribute("type"),n!=null?x==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+$t(n)):t.value!==""+$t(n)&&(t.value=""+$t(n)):x!=="submit"&&x!=="reset"||t.removeAttribute("value"),n!=null?Ia(t,x,$t(n)):a!=null?Ia(t,x,$t(a)):r!=null&&t.removeAttribute("value"),u==null&&d!=null&&(t.defaultChecked=!!d),u!=null&&(t.checked=u&&typeof u!="function"&&typeof u!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?t.name=""+$t(E):t.removeAttribute("name")}function Na(t,n,a,r,u,d,x,E){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),n!=null||a!=null){if(!(d!=="submit"&&d!=="reset"||n!=null)){ia(t);return}a=a!=null?""+$t(a):"",n=n!=null?""+$t(n):a,E||n===t.value||(t.value=n),t.defaultValue=n}r=r??u,r=typeof r!="function"&&typeof r!="symbol"&&!!r,t.checked=E?t.checked:!!r,t.defaultChecked=!!r,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(t.name=x),ia(t)}function Ia(t,n,a){n==="number"&&Sa(t.ownerDocument)===t||t.defaultValue===""+a||(t.defaultValue=""+a)}function Pi(t,n,a,r){if(t=t.options,n){n={};for(var u=0;u<a.length;u++)n["$"+a[u]]=!0;for(a=0;a<t.length;a++)u=n.hasOwnProperty("$"+t[a].value),t[a].selected!==u&&(t[a].selected=u),u&&r&&(t[a].defaultSelected=!0)}else{for(a=""+$t(a),n=null,u=0;u<t.length;u++){if(t[u].value===a){t[u].selected=!0,r&&(t[u].defaultSelected=!0);return}n!==null||t[u].disabled||(n=t[u])}n!==null&&(n.selected=!0)}}function Fs(t,n,a){if(n!=null&&(n=""+$t(n),n!==t.value&&(t.value=n),a==null)){t.defaultValue!==n&&(t.defaultValue=n);return}t.defaultValue=a!=null?""+$t(a):""}function Ws(t,n,a,r){if(n==null){if(r!=null){if(a!=null)throw Error(o(92));if(Z(r)){if(1<r.length)throw Error(o(93));r=r[0]}a=r}a==null&&(a=""),n=a}a=$t(n),t.defaultValue=a,r=t.textContent,r===a&&r!==""&&r!==null&&(t.value=r),ia(t)}function On(t,n){if(n){var a=t.firstChild;if(a&&a===t.lastChild&&a.nodeType===3){a.nodeValue=n;return}}t.textContent=n}var di=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function La(t,n,a){var r=n.indexOf("--")===0;a==null||typeof a=="boolean"||a===""?r?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="":r?t.setProperty(n,a):typeof a!="number"||a===0||di.has(n)?n==="float"?t.cssFloat=a:t[n]=(""+a).trim():t[n]=a+"px"}function rs(t,n,a){if(n!=null&&typeof n!="object")throw Error(o(62));if(t=t.style,a!=null){for(var r in a)!a.hasOwnProperty(r)||n!=null&&n.hasOwnProperty(r)||(r.indexOf("--")===0?t.setProperty(r,""):r==="float"?t.cssFloat="":t[r]="");for(var u in n)r=n[u],n.hasOwnProperty(u)&&a[u]!==r&&La(t,u,r)}else for(var d in n)n.hasOwnProperty(d)&&La(t,d,n[d])}function ls(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var No=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Xs=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Gs(t){return Xs.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function oi(){}var yr=null;function br(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ba=null,Ha=null;function aa(t){var n=Lt(t);if(n&&(t=n.stateNode)){var a=t[se]||null;e:switch(t=n.stateNode,n.type){case"input":if(Aa(t,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name),n=a.name,a.type==="radio"&&n!=null){for(a=t;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll('input[name="'+Vn(""+n)+'"][type="radio"]'),n=0;n<a.length;n++){var r=a[n];if(r!==t&&r.form===t.form){var u=r[se]||null;if(!u)throw Error(o(90));Aa(r,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(n=0;n<a.length;n++)r=a[n],r.form===t.form&&os(r)}break e;case"textarea":Fs(t,a.value,a.defaultValue);break e;case"select":n=a.value,n!=null&&Pi(t,!!a.multiple,n,!1)}}}var Io=!1;function xr(t,n,a){if(Io)return t(n,a);Io=!0;try{var r=t(n);return r}finally{if(Io=!1,(Ba!==null||Ha!==null)&&(xc(),Ba&&(n=Ba,t=Ha,Ha=Ba=null,aa(n),t)))for(n=0;n<t.length;n++)aa(t[n])}}function Qs(t,n){var a=t.stateNode;if(a===null)return null;var r=a[se]||null;if(r===null)return null;a=r[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(a&&typeof a!="function")throw Error(o(231,n,typeof a));return a}var sa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lo=!1;if(sa)try{var cs={};Object.defineProperty(cs,"passive",{get:function(){Lo=!0}}),window.addEventListener("test",cs,cs),window.removeEventListener("test",cs,cs)}catch{Lo=!1}var Ui=null,Ta=null,us=null;function Js(){if(us)return us;var t,n=Ta,a=n.length,r,u="value"in Ui?Ui.value:Ui.textContent,d=u.length;for(t=0;t<a&&n[t]===u[t];t++);var x=a-t;for(r=1;r<=x&&n[a-r]===u[d-r];r++);return us=u.slice(t,1<r?1-r:void 0)}function Ea(t){var n=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&n===13&&(t=13)):t=n,t===10&&(t=13),32<=t||t===13?t:0}function Zs(){return!0}function Il(){return!1}function Qn(t){function n(a,r,u,d,x){this._reactName=a,this._targetInst=u,this.type=r,this.nativeEvent=d,this.target=x,this.currentTarget=null;for(var E in t)t.hasOwnProperty(E)&&(a=t[E],this[E]=a?a(d):d[E]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Zs:Il,this.isPropagationStopped=Il,this}return v(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=Zs)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=Zs)},persist:function(){},isPersistent:Zs}),n}var oa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ra=Qn(oa),ds=v({},oa,{view:0,detail:0}),eo=Qn(ds),vr,Sr,to,la=v({},ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_r,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==to&&(to&&t.type==="mousemove"?(vr=t.screenX-to.screenX,Sr=t.screenY-to.screenY):Sr=vr=0,to=t),vr)},movementY:function(t){return"movementY"in t?t.movementY:Sr}}),Ll=Qn(la),Au=v({},la,{dataTransfer:0}),Bo=Qn(Au),Tu=v({},ds,{relatedTarget:0}),Ar=Qn(Tu),Eu=v({},oa,{animationName:0,elapsedTime:0,pseudoElement:0}),Ho=Qn(Eu),_u=v({},oa,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Tr=Qn(_u),no=v({},oa,{data:0}),io=Qn(no),Er={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Bl={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wu(t){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(t):(t=Hl[t])?!!n[t]:!1}function _r(){return wu}var Mu=v({},ds,{key:function(t){if(t.key){var n=Er[t.key]||t.key;if(n!=="Unidentified")return n}return t.type==="keypress"?(t=Ea(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Bl[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_r,charCode:function(t){return t.type==="keypress"?Ea(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ea(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),wr=Qn(Mu),vt=v({},la,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fs=Qn(vt),Ut=v({},ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_r}),T=Qn(Ut),I=v({},oa,{propertyName:0,elapsedTime:0,pseudoElement:0}),H=Qn(I),oe=v({},la,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),de=Qn(oe),me=v({},oa,{newState:0,oldState:0}),ve=Qn(me),_e=[9,13,27,32],Me=sa&&"CompositionEvent"in window,qe=null;sa&&"documentMode"in document&&(qe=document.documentMode);var Ae=sa&&"TextEvent"in window&&!qe,je=sa&&(!Me||qe&&8<qe&&11>=qe),$e=" ",Ye=!1;function Xe(t,n){switch(t){case"keyup":return _e.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function We(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var it=!1;function Qe(t,n){switch(t){case"compositionend":return We(n);case"keypress":return n.which!==32?null:(Ye=!0,$e);case"textInput":return t=n.data,t===$e&&Ye?null:t;default:return null}}function qt(t,n){if(it)return t==="compositionend"||!Me&&Xe(t,n)?(t=Js(),us=Ta=Ui=null,it=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return je&&n.locale!=="ko"?null:n.data;default:return null}}var bn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zt(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n==="input"?!!bn[t.type]:n==="textarea"}function Ot(t,n,a,r){Ba?Ha?Ha.push(r):Ha=[r]:Ba=r,n=wc(n,"onChange"),0<n.length&&(a=new ra("onChange","change",null,a,r),t.push({event:a,listeners:n}))}var Bt=null,Tt=null;function ri(t){Wh(t,0)}function Dn(t){var n=Mn(t);if(os(n))return t}function Ht(t,n){if(t==="change")return n}var Wt=!1;if(sa){var on;if(sa){var rn="oninput"in document;if(!rn){var fi=document.createElement("div");fi.setAttribute("oninput","return;"),rn=typeof fi.oninput=="function"}on=rn}else on=!1;Wt=on&&(!document.documentMode||9<document.documentMode)}function _i(){Bt&&(Bt.detachEvent("onpropertychange",qi),Tt=Bt=null)}function qi(t){if(t.propertyName==="value"&&Dn(Tt)){var n=[];Ot(n,Tt,t,br(t)),xr(ri,n)}}function ja(t,n,a){t==="focusin"?(_i(),Bt=n,Tt=a,Bt.attachEvent("onpropertychange",qi)):t==="focusout"&&_i()}function jl(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Dn(Tt)}function Mr(t,n){if(t==="click")return Dn(n)}function Dl(t,n){if(t==="input"||t==="change")return Dn(n)}function P0(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var wi=typeof Object.is=="function"?Object.is:P0;function Or(t,n){if(wi(t,n))return!0;if(typeof t!="object"||t===null||typeof n!="object"||n===null)return!1;var a=Object.keys(t),r=Object.keys(n);if(a.length!==r.length)return!1;for(r=0;r<a.length;r++){var u=a[r];if(!Mt.call(n,u)||!wi(t[u],n[u]))return!1}return!0}function bm(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function xm(t,n){var a=bm(t);t=0;for(var r;a;){if(a.nodeType===3){if(r=t+a.textContent.length,t<=n&&r>=n)return{node:a,offset:n-t};t=r}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=bm(a)}}function vm(t,n){return t&&n?t===n?!0:t&&t.nodeType===3?!1:n&&n.nodeType===3?vm(t,n.parentNode):"contains"in t?t.contains(n):t.compareDocumentPosition?!!(t.compareDocumentPosition(n)&16):!1:!1}function Sm(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var n=Sa(t.document);n instanceof t.HTMLIFrameElement;){try{var a=typeof n.contentWindow.location.href=="string"}catch{a=!1}if(a)t=n.contentWindow;else break;n=Sa(t.document)}return n}function Ou(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n&&(n==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||n==="textarea"||t.contentEditable==="true")}var U0=sa&&"documentMode"in document&&11>=document.documentMode,jo=null,Cu=null,Cr=null,ku=!1;function Am(t,n,a){var r=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;ku||jo==null||jo!==Sa(r)||(r=jo,"selectionStart"in r&&Ou(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Cr&&Or(Cr,r)||(Cr=r,r=wc(Cu,"onSelect"),0<r.length&&(n=new ra("onSelect","select",null,n,a),t.push({event:n,listeners:r}),n.target=jo)))}function ao(t,n){var a={};return a[t.toLowerCase()]=n.toLowerCase(),a["Webkit"+t]="webkit"+n,a["Moz"+t]="moz"+n,a}var Do={animationend:ao("Animation","AnimationEnd"),animationiteration:ao("Animation","AnimationIteration"),animationstart:ao("Animation","AnimationStart"),transitionrun:ao("Transition","TransitionRun"),transitionstart:ao("Transition","TransitionStart"),transitioncancel:ao("Transition","TransitionCancel"),transitionend:ao("Transition","TransitionEnd")},Ru={},Tm={};sa&&(Tm=document.createElement("div").style,"AnimationEvent"in window||(delete Do.animationend.animation,delete Do.animationiteration.animation,delete Do.animationstart.animation),"TransitionEvent"in window||delete Do.transitionend.transition);function so(t){if(Ru[t])return Ru[t];if(!Do[t])return t;var n=Do[t],a;for(a in n)if(n.hasOwnProperty(a)&&a in Tm)return Ru[t]=n[a];return t}var Em=so("animationend"),_m=so("animationiteration"),wm=so("animationstart"),q0=so("transitionrun"),z0=so("transitionstart"),$0=so("transitioncancel"),Mm=so("transitionend"),Om=new Map,Nu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Nu.push("scrollEnd");function ca(t,n){Om.set(t,n),Ei(n,[t])}var Pl=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},zi=[],Po=0,Iu=0;function Ul(){for(var t=Po,n=Iu=Po=0;n<t;){var a=zi[n];zi[n++]=null;var r=zi[n];zi[n++]=null;var u=zi[n];zi[n++]=null;var d=zi[n];if(zi[n++]=null,r!==null&&u!==null){var x=r.pending;x===null?u.next=u:(u.next=x.next,x.next=u),r.pending=u}d!==0&&Cm(a,u,d)}}function ql(t,n,a,r){zi[Po++]=t,zi[Po++]=n,zi[Po++]=a,zi[Po++]=r,Iu|=r,t.lanes|=r,t=t.alternate,t!==null&&(t.lanes|=r)}function Lu(t,n,a,r){return ql(t,n,a,r),zl(t)}function oo(t,n){return ql(t,null,null,n),zl(t)}function Cm(t,n,a){t.lanes|=a;var r=t.alternate;r!==null&&(r.lanes|=a);for(var u=!1,d=t.return;d!==null;)d.childLanes|=a,r=d.alternate,r!==null&&(r.childLanes|=a),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(u=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,u&&n!==null&&(u=31-et(a),t=d.hiddenUpdates,r=t[u],r===null?t[u]=[n]:r.push(n),n.lane=a|536870912),d):null}function zl(t){if(50<Qr)throw Qr=0,$d=null,Error(o(185));for(var n=t.return;n!==null;)t=n,n=t.return;return t.tag===3?t.stateNode:null}var Uo={};function V0(t,n,a,r){this.tag=t,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mi(t,n,a,r){return new V0(t,n,a,r)}function Bu(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Da(t,n){var a=t.alternate;return a===null?(a=Mi(t.tag,n,t.key,t.mode),a.elementType=t.elementType,a.type=t.type,a.stateNode=t.stateNode,a.alternate=t,t.alternate=a):(a.pendingProps=n,a.type=t.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=t.flags&65011712,a.childLanes=t.childLanes,a.lanes=t.lanes,a.child=t.child,a.memoizedProps=t.memoizedProps,a.memoizedState=t.memoizedState,a.updateQueue=t.updateQueue,n=t.dependencies,a.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},a.sibling=t.sibling,a.index=t.index,a.ref=t.ref,a.refCleanup=t.refCleanup,a}function km(t,n){t.flags&=65011714;var a=t.alternate;return a===null?(t.childLanes=0,t.lanes=n,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=a.childLanes,t.lanes=a.lanes,t.child=a.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=a.memoizedProps,t.memoizedState=a.memoizedState,t.updateQueue=a.updateQueue,t.type=a.type,n=a.dependencies,t.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t}function $l(t,n,a,r,u,d){var x=0;if(r=t,typeof t=="function")Bu(t)&&(x=1);else if(typeof t=="string")x=Xb(t,a,ne.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case pe:return t=Mi(31,a,n,u),t.elementType=pe,t.lanes=d,t;case g:return ro(a.children,u,d,n);case C:x=8,u|=24;break;case N:return t=Mi(12,a,n,u|2),t.elementType=N,t.lanes=d,t;case Q:return t=Mi(13,a,n,u),t.elementType=Q,t.lanes=d,t;case W:return t=Mi(19,a,n,u),t.elementType=W,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case w:x=10;break e;case O:x=9;break e;case R:x=11;break e;case j:x=14;break e;case re:x=16,r=null;break e}x=29,a=Error(o(130,t===null?"null":typeof t,"")),r=null}return n=Mi(x,a,n,u),n.elementType=t,n.type=r,n.lanes=d,n}function ro(t,n,a,r){return t=Mi(7,t,r,n),t.lanes=a,t}function Hu(t,n,a){return t=Mi(6,t,null,n),t.lanes=a,t}function Rm(t){var n=Mi(18,null,null,0);return n.stateNode=t,n}function ju(t,n,a){return n=Mi(4,t.children!==null?t.children:[],t.key,n),n.lanes=a,n.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},n}var Nm=new WeakMap;function $i(t,n){if(typeof t=="object"&&t!==null){var a=Nm.get(t);return a!==void 0?a:(n={value:t,source:n,stack:ct(n)},Nm.set(t,n),n)}return{value:t,source:n,stack:ct(n)}}var qo=[],zo=0,Vl=null,kr=0,Vi=[],Yi=0,ms=null,_a=1,wa="";function Pa(t,n){qo[zo++]=kr,qo[zo++]=Vl,Vl=t,kr=n}function Im(t,n,a){Vi[Yi++]=_a,Vi[Yi++]=wa,Vi[Yi++]=ms,ms=t;var r=_a;t=wa;var u=32-et(r)-1;r&=~(1<<u),a+=1;var d=32-et(n)+u;if(30<d){var x=u-u%5;d=(r&(1<<x)-1).toString(32),r>>=x,u-=x,_a=1<<32-et(n)+u|a<<u|r,wa=d+t}else _a=1<<d|a<<u|r,wa=t}function Du(t){t.return!==null&&(Pa(t,1),Im(t,1,0))}function Pu(t){for(;t===Vl;)Vl=qo[--zo],qo[zo]=null,kr=qo[--zo],qo[zo]=null;for(;t===ms;)ms=Vi[--Yi],Vi[Yi]=null,wa=Vi[--Yi],Vi[Yi]=null,_a=Vi[--Yi],Vi[Yi]=null}function Lm(t,n){Vi[Yi++]=_a,Vi[Yi++]=wa,Vi[Yi++]=ms,_a=n.id,wa=n.overflow,ms=t}var Yn=null,Vt=null,lt=!1,ps=null,Ki=!1,Uu=Error(o(519));function hs(t){var n=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Rr($i(n,t)),Uu}function Bm(t){var n=t.stateNode,a=t.type,r=t.memoizedProps;switch(n[X]=t,n[se]=r,a){case"dialog":st("cancel",n),st("close",n);break;case"iframe":case"object":case"embed":st("load",n);break;case"video":case"audio":for(a=0;a<Zr.length;a++)st(Zr[a],n);break;case"source":st("error",n);break;case"img":case"image":case"link":st("error",n),st("load",n);break;case"details":st("toggle",n);break;case"input":st("invalid",n),Na(n,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0);break;case"select":st("invalid",n);break;case"textarea":st("invalid",n),Ws(n,r.value,r.defaultValue,r.children)}a=r.children,typeof a!="string"&&typeof a!="number"&&typeof a!="bigint"||n.textContent===""+a||r.suppressHydrationWarning===!0||Jh(n.textContent,a)?(r.popover!=null&&(st("beforetoggle",n),st("toggle",n)),r.onScroll!=null&&st("scroll",n),r.onScrollEnd!=null&&st("scrollend",n),r.onClick!=null&&(n.onclick=oi),n=!0):n=!1,n||hs(t,!0)}function Hm(t){for(Yn=t.return;Yn;)switch(Yn.tag){case 5:case 31:case 13:Ki=!1;return;case 27:case 3:Ki=!0;return;default:Yn=Yn.return}}function $o(t){if(t!==Yn)return!1;if(!lt)return Hm(t),lt=!0,!1;var n=t.tag,a;if((a=n!==3&&n!==27)&&((a=n===5)&&(a=t.type,a=!(a!=="form"&&a!=="button")||sf(t.type,t.memoizedProps)),a=!a),a&&Vt&&hs(t),Hm(t),n===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));Vt=rg(t)}else if(n===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));Vt=rg(t)}else n===27?(n=Vt,Cs(t.type)?(t=uf,uf=null,Vt=t):Vt=n):Vt=Yn?Wi(t.stateNode.nextSibling):null;return!0}function lo(){Vt=Yn=null,lt=!1}function qu(){var t=ps;return t!==null&&(gi===null?gi=t:gi.push.apply(gi,t),ps=null),t}function Rr(t){ps===null?ps=[t]:ps.push(t)}var zu=k(null),co=null,Ua=null;function gs(t,n,a){K(zu,n._currentValue),n._currentValue=a}function qa(t){t._currentValue=zu.current,U(zu)}function $u(t,n,a){for(;t!==null;){var r=t.alternate;if((t.childLanes&n)!==n?(t.childLanes|=n,r!==null&&(r.childLanes|=n)):r!==null&&(r.childLanes&n)!==n&&(r.childLanes|=n),t===a)break;t=t.return}}function Vu(t,n,a,r){var u=t.child;for(u!==null&&(u.return=t);u!==null;){var d=u.dependencies;if(d!==null){var x=u.child;d=d.firstContext;e:for(;d!==null;){var E=d;d=u;for(var L=0;L<n.length;L++)if(E.context===n[L]){d.lanes|=a,E=d.alternate,E!==null&&(E.lanes|=a),$u(d.return,a,t),r||(x=null);break e}d=E.next}}else if(u.tag===18){if(x=u.return,x===null)throw Error(o(341));x.lanes|=a,d=x.alternate,d!==null&&(d.lanes|=a),$u(x,a,t),x=null}else x=u.child;if(x!==null)x.return=u;else for(x=u;x!==null;){if(x===t){x=null;break}if(u=x.sibling,u!==null){u.return=x.return,x=u;break}x=x.return}u=x}}function Vo(t,n,a,r){t=null;for(var u=n,d=!1;u!==null;){if(!d){if((u.flags&524288)!==0)d=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var x=u.alternate;if(x===null)throw Error(o(387));if(x=x.memoizedProps,x!==null){var E=u.type;wi(u.pendingProps.value,x.value)||(t!==null?t.push(E):t=[E])}}else if(u===Se.current){if(x=u.alternate,x===null)throw Error(o(387));x.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(t!==null?t.push(al):t=[al])}u=u.return}t!==null&&Vu(n,t,a,r),n.flags|=262144}function Yl(t){for(t=t.firstContext;t!==null;){if(!wi(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function uo(t){co=t,Ua=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Kn(t){return jm(co,t)}function Kl(t,n){return co===null&&uo(t),jm(t,n)}function jm(t,n){var a=n._currentValue;if(n={context:n,memoizedValue:a,next:null},Ua===null){if(t===null)throw Error(o(308));Ua=n,t.dependencies={lanes:0,firstContext:n},t.flags|=524288}else Ua=Ua.next=n;return a}var Y0=typeof AbortController<"u"?AbortController:function(){var t=[],n=this.signal={aborted:!1,addEventListener:function(a,r){t.push(r)}};this.abort=function(){n.aborted=!0,t.forEach(function(a){return a()})}},K0=e.unstable_scheduleCallback,F0=e.unstable_NormalPriority,xn={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Yu(){return{controller:new Y0,data:new Map,refCount:0}}function Nr(t){t.refCount--,t.refCount===0&&K0(F0,function(){t.controller.abort()})}var Ir=null,Ku=0,Yo=0,Ko=null;function W0(t,n){if(Ir===null){var a=Ir=[];Ku=0,Yo=Xd(),Ko={status:"pending",value:void 0,then:function(r){a.push(r)}}}return Ku++,n.then(Dm,Dm),n}function Dm(){if(--Ku===0&&Ir!==null){Ko!==null&&(Ko.status="fulfilled");var t=Ir;Ir=null,Yo=0,Ko=null;for(var n=0;n<t.length;n++)(0,t[n])()}}function X0(t,n){var a=[],r={status:"pending",value:null,reason:null,then:function(u){a.push(u)}};return t.then(function(){r.status="fulfilled",r.value=n;for(var u=0;u<a.length;u++)(0,a[u])(n)},function(u){for(r.status="rejected",r.reason=u,u=0;u<a.length;u++)(0,a[u])(void 0)}),r}var Pm=P.S;P.S=function(t,n){Ah=wn(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&W0(t,n),Pm!==null&&Pm(t,n)};var fo=k(null);function Fu(){var t=fo.current;return t!==null?t:jt.pooledCache}function Fl(t,n){n===null?K(fo,fo.current):K(fo,n.pool)}function Um(){var t=Fu();return t===null?null:{parent:xn._currentValue,pool:t}}var Fo=Error(o(460)),Wu=Error(o(474)),Wl=Error(o(542)),Xl={then:function(){}};function qm(t){return t=t.status,t==="fulfilled"||t==="rejected"}function zm(t,n,a){switch(a=t[a],a===void 0?t.push(n):a!==n&&(n.then(oi,oi),n=a),n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,Vm(t),t;default:if(typeof n.status=="string")n.then(oi,oi);else{if(t=jt,t!==null&&100<t.shellSuspendCounter)throw Error(o(482));t=n,t.status="pending",t.then(function(r){if(n.status==="pending"){var u=n;u.status="fulfilled",u.value=r}},function(r){if(n.status==="pending"){var u=n;u.status="rejected",u.reason=r}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,Vm(t),t}throw po=n,Fo}}function mo(t){try{var n=t._init;return n(t._payload)}catch(a){throw a!==null&&typeof a=="object"&&typeof a.then=="function"?(po=a,Fo):a}}var po=null;function $m(){if(po===null)throw Error(o(459));var t=po;return po=null,t}function Vm(t){if(t===Fo||t===Wl)throw Error(o(483))}var Wo=null,Lr=0;function Gl(t){var n=Lr;return Lr+=1,Wo===null&&(Wo=[]),zm(Wo,t,n)}function Br(t,n){n=n.props.ref,t.ref=n!==void 0?n:null}function Ql(t,n){throw n.$$typeof===A?Error(o(525)):(t=Object.prototype.toString.call(n),Error(o(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t)))}function Ym(t){function n(D,B){if(t){var $=D.deletions;$===null?(D.deletions=[B],D.flags|=16):$.push(B)}}function a(D,B){if(!t)return null;for(;B!==null;)n(D,B),B=B.sibling;return null}function r(D){for(var B=new Map;D!==null;)D.key!==null?B.set(D.key,D):B.set(D.index,D),D=D.sibling;return B}function u(D,B){return D=Da(D,B),D.index=0,D.sibling=null,D}function d(D,B,$){return D.index=$,t?($=D.alternate,$!==null?($=$.index,$<B?(D.flags|=67108866,B):$):(D.flags|=67108866,B)):(D.flags|=1048576,B)}function x(D){return t&&D.alternate===null&&(D.flags|=67108866),D}function E(D,B,$,ie){return B===null||B.tag!==6?(B=Hu($,D.mode,ie),B.return=D,B):(B=u(B,$),B.return=D,B)}function L(D,B,$,ie){var Pe=$.type;return Pe===g?te(D,B,$.props.children,ie,$.key):B!==null&&(B.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===re&&mo(Pe)===B.type)?(B=u(B,$.props),Br(B,$),B.return=D,B):(B=$l($.type,$.key,$.props,null,D.mode,ie),Br(B,$),B.return=D,B)}function V(D,B,$,ie){return B===null||B.tag!==4||B.stateNode.containerInfo!==$.containerInfo||B.stateNode.implementation!==$.implementation?(B=ju($,D.mode,ie),B.return=D,B):(B=u(B,$.children||[]),B.return=D,B)}function te(D,B,$,ie,Pe){return B===null||B.tag!==7?(B=ro($,D.mode,ie,Pe),B.return=D,B):(B=u(B,$),B.return=D,B)}function ce(D,B,$){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=Hu(""+B,D.mode,$),B.return=D,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case M:return $=$l(B.type,B.key,B.props,null,D.mode,$),Br($,B),$.return=D,$;case p:return B=ju(B,D.mode,$),B.return=D,B;case re:return B=mo(B),ce(D,B,$)}if(Z(B)||ye(B))return B=ro(B,D.mode,$,null),B.return=D,B;if(typeof B.then=="function")return ce(D,Gl(B),$);if(B.$$typeof===w)return ce(D,Kl(D,B),$);Ql(D,B)}return null}function F(D,B,$,ie){var Pe=B!==null?B.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return Pe!==null?null:E(D,B,""+$,ie);if(typeof $=="object"&&$!==null){switch($.$$typeof){case M:return $.key===Pe?L(D,B,$,ie):null;case p:return $.key===Pe?V(D,B,$,ie):null;case re:return $=mo($),F(D,B,$,ie)}if(Z($)||ye($))return Pe!==null?null:te(D,B,$,ie,null);if(typeof $.then=="function")return F(D,B,Gl($),ie);if($.$$typeof===w)return F(D,B,Kl(D,$),ie);Ql(D,$)}return null}function J(D,B,$,ie,Pe){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return D=D.get($)||null,E(B,D,""+ie,Pe);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case M:return D=D.get(ie.key===null?$:ie.key)||null,L(B,D,ie,Pe);case p:return D=D.get(ie.key===null?$:ie.key)||null,V(B,D,ie,Pe);case re:return ie=mo(ie),J(D,B,$,ie,Pe)}if(Z(ie)||ye(ie))return D=D.get($)||null,te(B,D,ie,Pe,null);if(typeof ie.then=="function")return J(D,B,$,Gl(ie),Pe);if(ie.$$typeof===w)return J(D,B,$,Kl(B,ie),Pe);Ql(B,ie)}return null}function Ce(D,B,$,ie){for(var Pe=null,ht=null,Be=B,Je=B=0,rt=null;Be!==null&&Je<$.length;Je++){Be.index>Je?(rt=Be,Be=null):rt=Be.sibling;var gt=F(D,Be,$[Je],ie);if(gt===null){Be===null&&(Be=rt);break}t&&Be&&gt.alternate===null&&n(D,Be),B=d(gt,B,Je),ht===null?Pe=gt:ht.sibling=gt,ht=gt,Be=rt}if(Je===$.length)return a(D,Be),lt&&Pa(D,Je),Pe;if(Be===null){for(;Je<$.length;Je++)Be=ce(D,$[Je],ie),Be!==null&&(B=d(Be,B,Je),ht===null?Pe=Be:ht.sibling=Be,ht=Be);return lt&&Pa(D,Je),Pe}for(Be=r(Be);Je<$.length;Je++)rt=J(Be,D,Je,$[Je],ie),rt!==null&&(t&&rt.alternate!==null&&Be.delete(rt.key===null?Je:rt.key),B=d(rt,B,Je),ht===null?Pe=rt:ht.sibling=rt,ht=rt);return t&&Be.forEach(function(Ls){return n(D,Ls)}),lt&&Pa(D,Je),Pe}function Ue(D,B,$,ie){if($==null)throw Error(o(151));for(var Pe=null,ht=null,Be=B,Je=B=0,rt=null,gt=$.next();Be!==null&&!gt.done;Je++,gt=$.next()){Be.index>Je?(rt=Be,Be=null):rt=Be.sibling;var Ls=F(D,Be,gt.value,ie);if(Ls===null){Be===null&&(Be=rt);break}t&&Be&&Ls.alternate===null&&n(D,Be),B=d(Ls,B,Je),ht===null?Pe=Ls:ht.sibling=Ls,ht=Ls,Be=rt}if(gt.done)return a(D,Be),lt&&Pa(D,Je),Pe;if(Be===null){for(;!gt.done;Je++,gt=$.next())gt=ce(D,gt.value,ie),gt!==null&&(B=d(gt,B,Je),ht===null?Pe=gt:ht.sibling=gt,ht=gt);return lt&&Pa(D,Je),Pe}for(Be=r(Be);!gt.done;Je++,gt=$.next())gt=J(Be,D,Je,gt.value,ie),gt!==null&&(t&&gt.alternate!==null&&Be.delete(gt.key===null?Je:gt.key),B=d(gt,B,Je),ht===null?Pe=gt:ht.sibling=gt,ht=gt);return t&&Be.forEach(function(ox){return n(D,ox)}),lt&&Pa(D,Je),Pe}function Rt(D,B,$,ie){if(typeof $=="object"&&$!==null&&$.type===g&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case M:e:{for(var Pe=$.key;B!==null;){if(B.key===Pe){if(Pe=$.type,Pe===g){if(B.tag===7){a(D,B.sibling),ie=u(B,$.props.children),ie.return=D,D=ie;break e}}else if(B.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===re&&mo(Pe)===B.type){a(D,B.sibling),ie=u(B,$.props),Br(ie,$),ie.return=D,D=ie;break e}a(D,B);break}else n(D,B);B=B.sibling}$.type===g?(ie=ro($.props.children,D.mode,ie,$.key),ie.return=D,D=ie):(ie=$l($.type,$.key,$.props,null,D.mode,ie),Br(ie,$),ie.return=D,D=ie)}return x(D);case p:e:{for(Pe=$.key;B!==null;){if(B.key===Pe)if(B.tag===4&&B.stateNode.containerInfo===$.containerInfo&&B.stateNode.implementation===$.implementation){a(D,B.sibling),ie=u(B,$.children||[]),ie.return=D,D=ie;break e}else{a(D,B);break}else n(D,B);B=B.sibling}ie=ju($,D.mode,ie),ie.return=D,D=ie}return x(D);case re:return $=mo($),Rt(D,B,$,ie)}if(Z($))return Ce(D,B,$,ie);if(ye($)){if(Pe=ye($),typeof Pe!="function")throw Error(o(150));return $=Pe.call($),Ue(D,B,$,ie)}if(typeof $.then=="function")return Rt(D,B,Gl($),ie);if($.$$typeof===w)return Rt(D,B,Kl(D,$),ie);Ql(D,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,B!==null&&B.tag===6?(a(D,B.sibling),ie=u(B,$),ie.return=D,D=ie):(a(D,B),ie=Hu($,D.mode,ie),ie.return=D,D=ie),x(D)):a(D,B)}return function(D,B,$,ie){try{Lr=0;var Pe=Rt(D,B,$,ie);return Wo=null,Pe}catch(Be){if(Be===Fo||Be===Wl)throw Be;var ht=Mi(29,Be,null,D.mode);return ht.lanes=ie,ht.return=D,ht}}}var ho=Ym(!0),Km=Ym(!1),ys=!1;function Xu(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gu(t,n){t=t.updateQueue,n.updateQueue===t&&(n.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function bs(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function xs(t,n,a){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,(bt&2)!==0){var u=r.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),r.pending=n,n=zl(t),Cm(t,null,a),n}return ql(t,r,n,a),zl(t)}function Hr(t,n,a){if(n=n.updateQueue,n!==null&&(n=n.shared,(a&4194048)!==0)){var r=n.lanes;r&=t.pendingLanes,a|=r,n.lanes=a,xa(t,a)}}function Qu(t,n){var a=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,a===r)){var u=null,d=null;if(a=a.firstBaseUpdate,a!==null){do{var x={lane:a.lane,tag:a.tag,payload:a.payload,callback:null,next:null};d===null?u=d=x:d=d.next=x,a=a.next}while(a!==null);d===null?u=d=n:d=d.next=n}else u=d=n;a={baseState:r.baseState,firstBaseUpdate:u,lastBaseUpdate:d,shared:r.shared,callbacks:r.callbacks},t.updateQueue=a;return}t=a.lastBaseUpdate,t===null?a.firstBaseUpdate=n:t.next=n,a.lastBaseUpdate=n}var Ju=!1;function jr(){if(Ju){var t=Ko;if(t!==null)throw t}}function Dr(t,n,a,r){Ju=!1;var u=t.updateQueue;ys=!1;var d=u.firstBaseUpdate,x=u.lastBaseUpdate,E=u.shared.pending;if(E!==null){u.shared.pending=null;var L=E,V=L.next;L.next=null,x===null?d=V:x.next=V,x=L;var te=t.alternate;te!==null&&(te=te.updateQueue,E=te.lastBaseUpdate,E!==x&&(E===null?te.firstBaseUpdate=V:E.next=V,te.lastBaseUpdate=L))}if(d!==null){var ce=u.baseState;x=0,te=V=L=null,E=d;do{var F=E.lane&-536870913,J=F!==E.lane;if(J?(ot&F)===F:(r&F)===F){F!==0&&F===Yo&&(Ju=!0),te!==null&&(te=te.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});e:{var Ce=t,Ue=E;F=n;var Rt=a;switch(Ue.tag){case 1:if(Ce=Ue.payload,typeof Ce=="function"){ce=Ce.call(Rt,ce,F);break e}ce=Ce;break e;case 3:Ce.flags=Ce.flags&-65537|128;case 0:if(Ce=Ue.payload,F=typeof Ce=="function"?Ce.call(Rt,ce,F):Ce,F==null)break e;ce=v({},ce,F);break e;case 2:ys=!0}}F=E.callback,F!==null&&(t.flags|=64,J&&(t.flags|=8192),J=u.callbacks,J===null?u.callbacks=[F]:J.push(F))}else J={lane:F,tag:E.tag,payload:E.payload,callback:E.callback,next:null},te===null?(V=te=J,L=ce):te=te.next=J,x|=F;if(E=E.next,E===null){if(E=u.shared.pending,E===null)break;J=E,E=J.next,J.next=null,u.lastBaseUpdate=J,u.shared.pending=null}}while(!0);te===null&&(L=ce),u.baseState=L,u.firstBaseUpdate=V,u.lastBaseUpdate=te,d===null&&(u.shared.lanes=0),Es|=x,t.lanes=x,t.memoizedState=ce}}function Fm(t,n){if(typeof t!="function")throw Error(o(191,t));t.call(n)}function Wm(t,n){var a=t.callbacks;if(a!==null)for(t.callbacks=null,t=0;t<a.length;t++)Fm(a[t],n)}var Xo=k(null),Jl=k(0);function Xm(t,n){t=Ga,K(Jl,t),K(Xo,n),Ga=t|n.baseLanes}function Zu(){K(Jl,Ga),K(Xo,Xo.current)}function ed(){Ga=Jl.current,U(Xo),U(Jl)}var Oi=k(null),Fi=null;function vs(t){var n=t.alternate;K(ln,ln.current&1),K(Oi,t),Fi===null&&(n===null||Xo.current!==null||n.memoizedState!==null)&&(Fi=t)}function td(t){K(ln,ln.current),K(Oi,t),Fi===null&&(Fi=t)}function Gm(t){t.tag===22?(K(ln,ln.current),K(Oi,t),Fi===null&&(Fi=t)):Ss()}function Ss(){K(ln,ln.current),K(Oi,Oi.current)}function Ci(t){U(Oi),Fi===t&&(Fi=null),U(ln)}var ln=k(0);function Zl(t){for(var n=t;n!==null;){if(n.tag===13){var a=n.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||lf(a)||cf(a)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var za=0,Ge=null,Ct=null,vn=null,ec=!1,Go=!1,go=!1,tc=0,Pr=0,Qo=null,G0=0;function en(){throw Error(o(321))}function nd(t,n){if(n===null)return!1;for(var a=0;a<n.length&&a<t.length;a++)if(!wi(t[a],n[a]))return!1;return!0}function id(t,n,a,r,u,d){return za=d,Ge=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,P.H=t===null||t.memoizedState===null?Ip:bd,go=!1,d=a(r,u),go=!1,Go&&(d=Jm(n,a,r,u)),Qm(t),d}function Qm(t){P.H=zr;var n=Ct!==null&&Ct.next!==null;if(za=0,vn=Ct=Ge=null,ec=!1,Pr=0,Qo=null,n)throw Error(o(300));t===null||Sn||(t=t.dependencies,t!==null&&Yl(t)&&(Sn=!0))}function Jm(t,n,a,r){Ge=t;var u=0;do{if(Go&&(Qo=null),Pr=0,Go=!1,25<=u)throw Error(o(301));if(u+=1,vn=Ct=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}P.H=Lp,d=n(a,r)}while(Go);return d}function Q0(){var t=P.H,n=t.useState()[0];return n=typeof n.then=="function"?Ur(n):n,t=t.useState()[0],(Ct!==null?Ct.memoizedState:null)!==t&&(Ge.flags|=1024),n}function ad(){var t=tc!==0;return tc=0,t}function sd(t,n,a){n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~a}function od(t){if(ec){for(t=t.memoizedState;t!==null;){var n=t.queue;n!==null&&(n.pending=null),t=t.next}ec=!1}za=0,vn=Ct=Ge=null,Go=!1,Pr=tc=0,Qo=null}function li(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vn===null?Ge.memoizedState=vn=t:vn=vn.next=t,vn}function cn(){if(Ct===null){var t=Ge.alternate;t=t!==null?t.memoizedState:null}else t=Ct.next;var n=vn===null?Ge.memoizedState:vn.next;if(n!==null)vn=n,Ct=t;else{if(t===null)throw Ge.alternate===null?Error(o(467)):Error(o(310));Ct=t,t={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},vn===null?Ge.memoizedState=vn=t:vn=vn.next=t}return vn}function nc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ur(t){var n=Pr;return Pr+=1,Qo===null&&(Qo=[]),t=zm(Qo,t,n),n=Ge,(vn===null?n.memoizedState:vn.next)===null&&(n=n.alternate,P.H=n===null||n.memoizedState===null?Ip:bd),t}function ic(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return Ur(t);if(t.$$typeof===w)return Kn(t)}throw Error(o(438,String(t)))}function rd(t){var n=null,a=Ge.updateQueue;if(a!==null&&(n=a.memoCache),n==null){var r=Ge.alternate;r!==null&&(r=r.updateQueue,r!==null&&(r=r.memoCache,r!=null&&(n={data:r.data.map(function(u){return u.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),a===null&&(a=nc(),Ge.updateQueue=a),a.memoCache=n,a=n.data[n.index],a===void 0)for(a=n.data[n.index]=Array(t),r=0;r<t;r++)a[r]=z;return n.index++,a}function $a(t,n){return typeof n=="function"?n(t):n}function ac(t){var n=cn();return ld(n,Ct,t)}function ld(t,n,a){var r=t.queue;if(r===null)throw Error(o(311));r.lastRenderedReducer=a;var u=t.baseQueue,d=r.pending;if(d!==null){if(u!==null){var x=u.next;u.next=d.next,d.next=x}n.baseQueue=u=d,r.pending=null}if(d=t.baseState,u===null)t.memoizedState=d;else{n=u.next;var E=x=null,L=null,V=n,te=!1;do{var ce=V.lane&-536870913;if(ce!==V.lane?(ot&ce)===ce:(za&ce)===ce){var F=V.revertLane;if(F===0)L!==null&&(L=L.next={lane:0,revertLane:0,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null}),ce===Yo&&(te=!0);else if((za&F)===F){V=V.next,F===Yo&&(te=!0);continue}else ce={lane:0,revertLane:V.revertLane,gesture:null,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},L===null?(E=L=ce,x=d):L=L.next=ce,Ge.lanes|=F,Es|=F;ce=V.action,go&&a(d,ce),d=V.hasEagerState?V.eagerState:a(d,ce)}else F={lane:ce,revertLane:V.revertLane,gesture:V.gesture,action:V.action,hasEagerState:V.hasEagerState,eagerState:V.eagerState,next:null},L===null?(E=L=F,x=d):L=L.next=F,Ge.lanes|=ce,Es|=ce;V=V.next}while(V!==null&&V!==n);if(L===null?x=d:L.next=E,!wi(d,t.memoizedState)&&(Sn=!0,te&&(a=Ko,a!==null)))throw a;t.memoizedState=d,t.baseState=x,t.baseQueue=L,r.lastRenderedState=d}return u===null&&(r.lanes=0),[t.memoizedState,r.dispatch]}function cd(t){var n=cn(),a=n.queue;if(a===null)throw Error(o(311));a.lastRenderedReducer=t;var r=a.dispatch,u=a.pending,d=n.memoizedState;if(u!==null){a.pending=null;var x=u=u.next;do d=t(d,x.action),x=x.next;while(x!==u);wi(d,n.memoizedState)||(Sn=!0),n.memoizedState=d,n.baseQueue===null&&(n.baseState=d),a.lastRenderedState=d}return[d,r]}function Zm(t,n,a){var r=Ge,u=cn(),d=lt;if(d){if(a===void 0)throw Error(o(407));a=a()}else a=n();var x=!wi((Ct||u).memoizedState,a);if(x&&(u.memoizedState=a,Sn=!0),u=u.queue,fd(np.bind(null,r,u,t),[t]),u.getSnapshot!==n||x||vn!==null&&vn.memoizedState.tag&1){if(r.flags|=2048,Jo(9,{destroy:void 0},tp.bind(null,r,u,a,n),null),jt===null)throw Error(o(349));d||(za&127)!==0||ep(r,n,a)}return a}function ep(t,n,a){t.flags|=16384,t={getSnapshot:n,value:a},n=Ge.updateQueue,n===null?(n=nc(),Ge.updateQueue=n,n.stores=[t]):(a=n.stores,a===null?n.stores=[t]:a.push(t))}function tp(t,n,a,r){n.value=a,n.getSnapshot=r,ip(n)&&ap(t)}function np(t,n,a){return a(function(){ip(n)&&ap(t)})}function ip(t){var n=t.getSnapshot;t=t.value;try{var a=n();return!wi(t,a)}catch{return!0}}function ap(t){var n=oo(t,2);n!==null&&yi(n,t,2)}function ud(t){var n=li();if(typeof t=="function"){var a=t;if(t=a(),go){ut(!0);try{a()}finally{ut(!1)}}}return n.memoizedState=n.baseState=t,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$a,lastRenderedState:t},n}function sp(t,n,a,r){return t.baseState=a,ld(t,Ct,typeof r=="function"?r:$a)}function J0(t,n,a,r,u){if(rc(t))throw Error(o(485));if(t=n.action,t!==null){var d={payload:u,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){d.listeners.push(x)}};P.T!==null?a(!0):d.isTransition=!1,r(d),a=n.pending,a===null?(d.next=n.pending=d,op(n,d)):(d.next=a.next,n.pending=a.next=d)}}function op(t,n){var a=n.action,r=n.payload,u=t.state;if(n.isTransition){var d=P.T,x={};P.T=x;try{var E=a(u,r),L=P.S;L!==null&&L(x,E),rp(t,n,E)}catch(V){dd(t,n,V)}finally{d!==null&&x.types!==null&&(d.types=x.types),P.T=d}}else try{d=a(u,r),rp(t,n,d)}catch(V){dd(t,n,V)}}function rp(t,n,a){a!==null&&typeof a=="object"&&typeof a.then=="function"?a.then(function(r){lp(t,n,r)},function(r){return dd(t,n,r)}):lp(t,n,a)}function lp(t,n,a){n.status="fulfilled",n.value=a,cp(n),t.state=a,n=t.pending,n!==null&&(a=n.next,a===n?t.pending=null:(a=a.next,n.next=a,op(t,a)))}function dd(t,n,a){var r=t.pending;if(t.pending=null,r!==null){r=r.next;do n.status="rejected",n.reason=a,cp(n),n=n.next;while(n!==r)}t.action=null}function cp(t){t=t.listeners;for(var n=0;n<t.length;n++)(0,t[n])()}function up(t,n){return n}function dp(t,n){if(lt){var a=jt.formState;if(a!==null){e:{var r=Ge;if(lt){if(Vt){t:{for(var u=Vt,d=Ki;u.nodeType!==8;){if(!d){u=null;break t}if(u=Wi(u.nextSibling),u===null){u=null;break t}}d=u.data,u=d==="F!"||d==="F"?u:null}if(u){Vt=Wi(u.nextSibling),r=u.data==="F!";break e}}hs(r)}r=!1}r&&(n=a[0])}}return a=li(),a.memoizedState=a.baseState=n,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:up,lastRenderedState:n},a.queue=r,a=kp.bind(null,Ge,r),r.dispatch=a,r=ud(!1),d=yd.bind(null,Ge,!1,r.queue),r=li(),u={state:n,dispatch:null,action:t,pending:null},r.queue=u,a=J0.bind(null,Ge,u,d,a),u.dispatch=a,r.memoizedState=t,[n,a,!1]}function fp(t){var n=cn();return mp(n,Ct,t)}function mp(t,n,a){if(n=ld(t,n,up)[0],t=ac($a)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var r=Ur(n)}catch(x){throw x===Fo?Wl:x}else r=n;n=cn();var u=n.queue,d=u.dispatch;return a!==n.memoizedState&&(Ge.flags|=2048,Jo(9,{destroy:void 0},Z0.bind(null,u,a),null)),[r,d,t]}function Z0(t,n){t.action=n}function pp(t){var n=cn(),a=Ct;if(a!==null)return mp(n,a,t);cn(),n=n.memoizedState,a=cn();var r=a.queue.dispatch;return a.memoizedState=t,[n,r,!1]}function Jo(t,n,a,r){return t={tag:t,create:a,deps:r,inst:n,next:null},n=Ge.updateQueue,n===null&&(n=nc(),Ge.updateQueue=n),a=n.lastEffect,a===null?n.lastEffect=t.next=t:(r=a.next,a.next=t,t.next=r,n.lastEffect=t),t}function hp(){return cn().memoizedState}function sc(t,n,a,r){var u=li();Ge.flags|=t,u.memoizedState=Jo(1|n,{destroy:void 0},a,r===void 0?null:r)}function oc(t,n,a,r){var u=cn();r=r===void 0?null:r;var d=u.memoizedState.inst;Ct!==null&&r!==null&&nd(r,Ct.memoizedState.deps)?u.memoizedState=Jo(n,d,a,r):(Ge.flags|=t,u.memoizedState=Jo(1|n,d,a,r))}function gp(t,n){sc(8390656,8,t,n)}function fd(t,n){oc(2048,8,t,n)}function eb(t){Ge.flags|=4;var n=Ge.updateQueue;if(n===null)n=nc(),Ge.updateQueue=n,n.events=[t];else{var a=n.events;a===null?n.events=[t]:a.push(t)}}function yp(t){var n=cn().memoizedState;return eb({ref:n,nextImpl:t}),function(){if((bt&2)!==0)throw Error(o(440));return n.impl.apply(void 0,arguments)}}function bp(t,n){return oc(4,2,t,n)}function xp(t,n){return oc(4,4,t,n)}function vp(t,n){if(typeof n=="function"){t=t();var a=n(t);return function(){typeof a=="function"?a():n(null)}}if(n!=null)return t=t(),n.current=t,function(){n.current=null}}function Sp(t,n,a){a=a!=null?a.concat([t]):null,oc(4,4,vp.bind(null,n,t),a)}function md(){}function Ap(t,n){var a=cn();n=n===void 0?null:n;var r=a.memoizedState;return n!==null&&nd(n,r[1])?r[0]:(a.memoizedState=[t,n],t)}function Tp(t,n){var a=cn();n=n===void 0?null:n;var r=a.memoizedState;if(n!==null&&nd(n,r[1]))return r[0];if(r=t(),go){ut(!0);try{t()}finally{ut(!1)}}return a.memoizedState=[r,n],r}function pd(t,n,a){return a===void 0||(za&1073741824)!==0&&(ot&261930)===0?t.memoizedState=n:(t.memoizedState=a,t=Eh(),Ge.lanes|=t,Es|=t,a)}function Ep(t,n,a,r){return wi(a,n)?a:Xo.current!==null?(t=pd(t,a,r),wi(t,n)||(Sn=!0),t):(za&42)===0||(za&1073741824)!==0&&(ot&261930)===0?(Sn=!0,t.memoizedState=a):(t=Eh(),Ge.lanes|=t,Es|=t,n)}function _p(t,n,a,r,u){var d=ee.p;ee.p=d!==0&&8>d?d:8;var x=P.T,E={};P.T=E,yd(t,!1,n,a);try{var L=u(),V=P.S;if(V!==null&&V(E,L),L!==null&&typeof L=="object"&&typeof L.then=="function"){var te=X0(L,r);qr(t,n,te,Ni(t))}else qr(t,n,r,Ni(t))}catch(ce){qr(t,n,{then:function(){},status:"rejected",reason:ce},Ni())}finally{ee.p=d,x!==null&&E.types!==null&&(x.types=E.types),P.T=x}}function tb(){}function hd(t,n,a,r){if(t.tag!==5)throw Error(o(476));var u=wp(t).queue;_p(t,u,n,Y,a===null?tb:function(){return Mp(t),a(r)})}function wp(t){var n=t.memoizedState;if(n!==null)return n;n={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$a,lastRenderedState:Y},next:null};var a={};return n.next={memoizedState:a,baseState:a,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$a,lastRenderedState:a},next:null},t.memoizedState=n,t=t.alternate,t!==null&&(t.memoizedState=n),n}function Mp(t){var n=wp(t);n.next===null&&(n=t.alternate.memoizedState),qr(t,n.next.queue,{},Ni())}function gd(){return Kn(al)}function Op(){return cn().memoizedState}function Cp(){return cn().memoizedState}function nb(t){for(var n=t.return;n!==null;){switch(n.tag){case 24:case 3:var a=Ni();t=bs(a);var r=xs(n,t,a);r!==null&&(yi(r,n,a),Hr(r,n,a)),n={cache:Yu()},t.payload=n;return}n=n.return}}function ib(t,n,a){var r=Ni();a={lane:r,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null},rc(t)?Rp(n,a):(a=Lu(t,n,a,r),a!==null&&(yi(a,t,r),Np(a,n,r)))}function kp(t,n,a){var r=Ni();qr(t,n,a,r)}function qr(t,n,a,r){var u={lane:r,revertLane:0,gesture:null,action:a,hasEagerState:!1,eagerState:null,next:null};if(rc(t))Rp(n,u);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=n.lastRenderedReducer,d!==null))try{var x=n.lastRenderedState,E=d(x,a);if(u.hasEagerState=!0,u.eagerState=E,wi(E,x))return ql(t,n,u,0),jt===null&&Ul(),!1}catch{}if(a=Lu(t,n,u,r),a!==null)return yi(a,t,r),Np(a,n,r),!0}return!1}function yd(t,n,a,r){if(r={lane:2,revertLane:Xd(),gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},rc(t)){if(n)throw Error(o(479))}else n=Lu(t,a,r,2),n!==null&&yi(n,t,2)}function rc(t){var n=t.alternate;return t===Ge||n!==null&&n===Ge}function Rp(t,n){Go=ec=!0;var a=t.pending;a===null?n.next=n:(n.next=a.next,a.next=n),t.pending=n}function Np(t,n,a){if((a&4194048)!==0){var r=n.lanes;r&=t.pendingLanes,a|=r,n.lanes=a,xa(t,a)}}var zr={readContext:Kn,use:ic,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useLayoutEffect:en,useInsertionEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useSyncExternalStore:en,useId:en,useHostTransitionStatus:en,useFormState:en,useActionState:en,useOptimistic:en,useMemoCache:en,useCacheRefresh:en};zr.useEffectEvent=en;var Ip={readContext:Kn,use:ic,useCallback:function(t,n){return li().memoizedState=[t,n===void 0?null:n],t},useContext:Kn,useEffect:gp,useImperativeHandle:function(t,n,a){a=a!=null?a.concat([t]):null,sc(4194308,4,vp.bind(null,n,t),a)},useLayoutEffect:function(t,n){return sc(4194308,4,t,n)},useInsertionEffect:function(t,n){sc(4,2,t,n)},useMemo:function(t,n){var a=li();n=n===void 0?null:n;var r=t();if(go){ut(!0);try{t()}finally{ut(!1)}}return a.memoizedState=[r,n],r},useReducer:function(t,n,a){var r=li();if(a!==void 0){var u=a(n);if(go){ut(!0);try{a(n)}finally{ut(!1)}}}else u=n;return r.memoizedState=r.baseState=u,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:u},r.queue=t,t=t.dispatch=ib.bind(null,Ge,t),[r.memoizedState,t]},useRef:function(t){var n=li();return t={current:t},n.memoizedState=t},useState:function(t){t=ud(t);var n=t.queue,a=kp.bind(null,Ge,n);return n.dispatch=a,[t.memoizedState,a]},useDebugValue:md,useDeferredValue:function(t,n){var a=li();return pd(a,t,n)},useTransition:function(){var t=ud(!1);return t=_p.bind(null,Ge,t.queue,!0,!1),li().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,n,a){var r=Ge,u=li();if(lt){if(a===void 0)throw Error(o(407));a=a()}else{if(a=n(),jt===null)throw Error(o(349));(ot&127)!==0||ep(r,n,a)}u.memoizedState=a;var d={value:a,getSnapshot:n};return u.queue=d,gp(np.bind(null,r,d,t),[t]),r.flags|=2048,Jo(9,{destroy:void 0},tp.bind(null,r,d,a,n),null),a},useId:function(){var t=li(),n=jt.identifierPrefix;if(lt){var a=wa,r=_a;a=(r&~(1<<32-et(r)-1)).toString(32)+a,n="_"+n+"R_"+a,a=tc++,0<a&&(n+="H"+a.toString(32)),n+="_"}else a=G0++,n="_"+n+"r_"+a.toString(32)+"_";return t.memoizedState=n},useHostTransitionStatus:gd,useFormState:dp,useActionState:dp,useOptimistic:function(t){var n=li();n.memoizedState=n.baseState=t;var a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=a,n=yd.bind(null,Ge,!0,a),a.dispatch=n,[t,n]},useMemoCache:rd,useCacheRefresh:function(){return li().memoizedState=nb.bind(null,Ge)},useEffectEvent:function(t){var n=li(),a={impl:t};return n.memoizedState=a,function(){if((bt&2)!==0)throw Error(o(440));return a.impl.apply(void 0,arguments)}}},bd={readContext:Kn,use:ic,useCallback:Ap,useContext:Kn,useEffect:fd,useImperativeHandle:Sp,useInsertionEffect:bp,useLayoutEffect:xp,useMemo:Tp,useReducer:ac,useRef:hp,useState:function(){return ac($a)},useDebugValue:md,useDeferredValue:function(t,n){var a=cn();return Ep(a,Ct.memoizedState,t,n)},useTransition:function(){var t=ac($a)[0],n=cn().memoizedState;return[typeof t=="boolean"?t:Ur(t),n]},useSyncExternalStore:Zm,useId:Op,useHostTransitionStatus:gd,useFormState:fp,useActionState:fp,useOptimistic:function(t,n){var a=cn();return sp(a,Ct,t,n)},useMemoCache:rd,useCacheRefresh:Cp};bd.useEffectEvent=yp;var Lp={readContext:Kn,use:ic,useCallback:Ap,useContext:Kn,useEffect:fd,useImperativeHandle:Sp,useInsertionEffect:bp,useLayoutEffect:xp,useMemo:Tp,useReducer:cd,useRef:hp,useState:function(){return cd($a)},useDebugValue:md,useDeferredValue:function(t,n){var a=cn();return Ct===null?pd(a,t,n):Ep(a,Ct.memoizedState,t,n)},useTransition:function(){var t=cd($a)[0],n=cn().memoizedState;return[typeof t=="boolean"?t:Ur(t),n]},useSyncExternalStore:Zm,useId:Op,useHostTransitionStatus:gd,useFormState:pp,useActionState:pp,useOptimistic:function(t,n){var a=cn();return Ct!==null?sp(a,Ct,t,n):(a.baseState=t,[t,a.queue.dispatch])},useMemoCache:rd,useCacheRefresh:Cp};Lp.useEffectEvent=yp;function xd(t,n,a,r){n=t.memoizedState,a=a(r,n),a=a==null?n:v({},n,a),t.memoizedState=a,t.lanes===0&&(t.updateQueue.baseState=a)}var vd={enqueueSetState:function(t,n,a){t=t._reactInternals;var r=Ni(),u=bs(r);u.payload=n,a!=null&&(u.callback=a),n=xs(t,u,r),n!==null&&(yi(n,t,r),Hr(n,t,r))},enqueueReplaceState:function(t,n,a){t=t._reactInternals;var r=Ni(),u=bs(r);u.tag=1,u.payload=n,a!=null&&(u.callback=a),n=xs(t,u,r),n!==null&&(yi(n,t,r),Hr(n,t,r))},enqueueForceUpdate:function(t,n){t=t._reactInternals;var a=Ni(),r=bs(a);r.tag=2,n!=null&&(r.callback=n),n=xs(t,r,a),n!==null&&(yi(n,t,a),Hr(n,t,a))}};function Bp(t,n,a,r,u,d,x){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,d,x):n.prototype&&n.prototype.isPureReactComponent?!Or(a,r)||!Or(u,d):!0}function Hp(t,n,a,r){t=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(a,r),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(a,r),n.state!==t&&vd.enqueueReplaceState(n,n.state,null)}function yo(t,n){var a=n;if("ref"in n){a={};for(var r in n)r!=="ref"&&(a[r]=n[r])}if(t=t.defaultProps){a===n&&(a=v({},a));for(var u in t)a[u]===void 0&&(a[u]=t[u])}return a}function jp(t){Pl(t)}function Dp(t){console.error(t)}function Pp(t){Pl(t)}function lc(t,n){try{var a=t.onUncaughtError;a(n.value,{componentStack:n.stack})}catch(r){setTimeout(function(){throw r})}}function Up(t,n,a){try{var r=t.onCaughtError;r(a.value,{componentStack:a.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function Sd(t,n,a){return a=bs(a),a.tag=3,a.payload={element:null},a.callback=function(){lc(t,n)},a}function qp(t){return t=bs(t),t.tag=3,t}function zp(t,n,a,r){var u=a.type.getDerivedStateFromError;if(typeof u=="function"){var d=r.value;t.payload=function(){return u(d)},t.callback=function(){Up(n,a,r)}}var x=a.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(t.callback=function(){Up(n,a,r),typeof u!="function"&&(_s===null?_s=new Set([this]):_s.add(this));var E=r.stack;this.componentDidCatch(r.value,{componentStack:E!==null?E:""})})}function ab(t,n,a,r,u){if(a.flags|=32768,r!==null&&typeof r=="object"&&typeof r.then=="function"){if(n=a.alternate,n!==null&&Vo(n,a,u,!0),a=Oi.current,a!==null){switch(a.tag){case 31:case 13:return Fi===null?vc():a.alternate===null&&tn===0&&(tn=3),a.flags&=-257,a.flags|=65536,a.lanes=u,r===Xl?a.flags|=16384:(n=a.updateQueue,n===null?a.updateQueue=new Set([r]):n.add(r),Kd(t,r,u)),!1;case 22:return a.flags|=65536,r===Xl?a.flags|=16384:(n=a.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([r])},a.updateQueue=n):(a=n.retryQueue,a===null?n.retryQueue=new Set([r]):a.add(r)),Kd(t,r,u)),!1}throw Error(o(435,a.tag))}return Kd(t,r,u),vc(),!1}if(lt)return n=Oi.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=u,r!==Uu&&(t=Error(o(422),{cause:r}),Rr($i(t,a)))):(r!==Uu&&(n=Error(o(423),{cause:r}),Rr($i(n,a))),t=t.current.alternate,t.flags|=65536,u&=-u,t.lanes|=u,r=$i(r,a),u=Sd(t.stateNode,r,u),Qu(t,u),tn!==4&&(tn=2)),!1;var d=Error(o(520),{cause:r});if(d=$i(d,a),Gr===null?Gr=[d]:Gr.push(d),tn!==4&&(tn=2),n===null)return!0;r=$i(r,a),a=n;do{switch(a.tag){case 3:return a.flags|=65536,t=u&-u,a.lanes|=t,t=Sd(a.stateNode,r,t),Qu(a,t),!1;case 1:if(n=a.type,d=a.stateNode,(a.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(_s===null||!_s.has(d))))return a.flags|=65536,u&=-u,a.lanes|=u,u=qp(u),zp(u,t,a,r),Qu(a,u),!1}a=a.return}while(a!==null);return!1}var Ad=Error(o(461)),Sn=!1;function Fn(t,n,a,r){n.child=t===null?Km(n,null,a,r):ho(n,t.child,a,r)}function $p(t,n,a,r,u){a=a.render;var d=n.ref;if("ref"in r){var x={};for(var E in r)E!=="ref"&&(x[E]=r[E])}else x=r;return uo(n),r=id(t,n,a,x,d,u),E=ad(),t!==null&&!Sn?(sd(t,n,u),Va(t,n,u)):(lt&&E&&Du(n),n.flags|=1,Fn(t,n,r,u),n.child)}function Vp(t,n,a,r,u){if(t===null){var d=a.type;return typeof d=="function"&&!Bu(d)&&d.defaultProps===void 0&&a.compare===null?(n.tag=15,n.type=d,Yp(t,n,d,r,u)):(t=$l(a.type,null,r,n,n.mode,u),t.ref=n.ref,t.return=n,n.child=t)}if(d=t.child,!kd(t,u)){var x=d.memoizedProps;if(a=a.compare,a=a!==null?a:Or,a(x,r)&&t.ref===n.ref)return Va(t,n,u)}return n.flags|=1,t=Da(d,r),t.ref=n.ref,t.return=n,n.child=t}function Yp(t,n,a,r,u){if(t!==null){var d=t.memoizedProps;if(Or(d,r)&&t.ref===n.ref)if(Sn=!1,n.pendingProps=r=d,kd(t,u))(t.flags&131072)!==0&&(Sn=!0);else return n.lanes=t.lanes,Va(t,n,u)}return Td(t,n,a,r,u)}function Kp(t,n,a,r){var u=r.children,d=t!==null?t.memoizedState:null;if(t===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.mode==="hidden"){if((n.flags&128)!==0){if(d=d!==null?d.baseLanes|a:a,t!==null){for(r=n.child=t.child,u=0;r!==null;)u=u|r.lanes|r.childLanes,r=r.sibling;r=u&~d}else r=0,n.child=null;return Fp(t,n,d,a,r)}if((a&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},t!==null&&Fl(n,d!==null?d.cachePool:null),d!==null?Xm(n,d):Zu(),Gm(n);else return r=n.lanes=536870912,Fp(t,n,d!==null?d.baseLanes|a:a,a,r)}else d!==null?(Fl(n,d.cachePool),Xm(n,d),Ss(),n.memoizedState=null):(t!==null&&Fl(n,null),Zu(),Ss());return Fn(t,n,u,a),n.child}function $r(t,n){return t!==null&&t.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Fp(t,n,a,r,u){var d=Fu();return d=d===null?null:{parent:xn._currentValue,pool:d},n.memoizedState={baseLanes:a,cachePool:d},t!==null&&Fl(n,null),Zu(),Gm(n),t!==null&&Vo(t,n,r,!0),n.childLanes=u,null}function cc(t,n){return n=dc({mode:n.mode,children:n.children},t.mode),n.ref=t.ref,t.child=n,n.return=t,n}function Wp(t,n,a){return ho(n,t.child,null,a),t=cc(n,n.pendingProps),t.flags|=2,Ci(n),n.memoizedState=null,t}function sb(t,n,a){var r=n.pendingProps,u=(n.flags&128)!==0;if(n.flags&=-129,t===null){if(lt){if(r.mode==="hidden")return t=cc(n,r),n.lanes=536870912,$r(null,t);if(td(n),(t=Vt)?(t=og(t,Ki),t=t!==null&&t.data==="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:ms!==null?{id:_a,overflow:wa}:null,retryLane:536870912,hydrationErrors:null},a=Rm(t),a.return=n,n.child=a,Yn=n,Vt=null)):t=null,t===null)throw hs(n);return n.lanes=536870912,null}return cc(n,r)}var d=t.memoizedState;if(d!==null){var x=d.dehydrated;if(td(n),u)if(n.flags&256)n.flags&=-257,n=Wp(t,n,a);else if(n.memoizedState!==null)n.child=t.child,n.flags|=128,n=null;else throw Error(o(558));else if(Sn||Vo(t,n,a,!1),u=(a&t.childLanes)!==0,Sn||u){if(r=jt,r!==null&&(x=ka(r,a),x!==0&&x!==d.retryLane))throw d.retryLane=x,oo(t,x),yi(r,t,x),Ad;vc(),n=Wp(t,n,a)}else t=d.treeContext,Vt=Wi(x.nextSibling),Yn=n,lt=!0,ps=null,Ki=!1,t!==null&&Lm(n,t),n=cc(n,r),n.flags|=4096;return n}return t=Da(t.child,{mode:r.mode,children:r.children}),t.ref=n.ref,n.child=t,t.return=n,t}function uc(t,n){var a=n.ref;if(a===null)t!==null&&t.ref!==null&&(n.flags|=4194816);else{if(typeof a!="function"&&typeof a!="object")throw Error(o(284));(t===null||t.ref!==a)&&(n.flags|=4194816)}}function Td(t,n,a,r,u){return uo(n),a=id(t,n,a,r,void 0,u),r=ad(),t!==null&&!Sn?(sd(t,n,u),Va(t,n,u)):(lt&&r&&Du(n),n.flags|=1,Fn(t,n,a,u),n.child)}function Xp(t,n,a,r,u,d){return uo(n),n.updateQueue=null,a=Jm(n,r,a,u),Qm(t),r=ad(),t!==null&&!Sn?(sd(t,n,d),Va(t,n,d)):(lt&&r&&Du(n),n.flags|=1,Fn(t,n,a,d),n.child)}function Gp(t,n,a,r,u){if(uo(n),n.stateNode===null){var d=Uo,x=a.contextType;typeof x=="object"&&x!==null&&(d=Kn(x)),d=new a(r,d),n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=vd,n.stateNode=d,d._reactInternals=n,d=n.stateNode,d.props=r,d.state=n.memoizedState,d.refs={},Xu(n),x=a.contextType,d.context=typeof x=="object"&&x!==null?Kn(x):Uo,d.state=n.memoizedState,x=a.getDerivedStateFromProps,typeof x=="function"&&(xd(n,a,x,r),d.state=n.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(x=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),x!==d.state&&vd.enqueueReplaceState(d,d.state,null),Dr(n,r,d,u),jr(),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308),r=!0}else if(t===null){d=n.stateNode;var E=n.memoizedProps,L=yo(a,E);d.props=L;var V=d.context,te=a.contextType;x=Uo,typeof te=="object"&&te!==null&&(x=Kn(te));var ce=a.getDerivedStateFromProps;te=typeof ce=="function"||typeof d.getSnapshotBeforeUpdate=="function",E=n.pendingProps!==E,te||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(E||V!==x)&&Hp(n,d,r,x),ys=!1;var F=n.memoizedState;d.state=F,Dr(n,r,d,u),jr(),V=n.memoizedState,E||F!==V||ys?(typeof ce=="function"&&(xd(n,a,ce,r),V=n.memoizedState),(L=ys||Bp(n,a,L,r,F,V,x))?(te||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(n.flags|=4194308)):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=r,n.memoizedState=V),d.props=r,d.state=V,d.context=x,r=L):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),r=!1)}else{d=n.stateNode,Gu(t,n),x=n.memoizedProps,te=yo(a,x),d.props=te,ce=n.pendingProps,F=d.context,V=a.contextType,L=Uo,typeof V=="object"&&V!==null&&(L=Kn(V)),E=a.getDerivedStateFromProps,(V=typeof E=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(x!==ce||F!==L)&&Hp(n,d,r,L),ys=!1,F=n.memoizedState,d.state=F,Dr(n,r,d,u),jr();var J=n.memoizedState;x!==ce||F!==J||ys||t!==null&&t.dependencies!==null&&Yl(t.dependencies)?(typeof E=="function"&&(xd(n,a,E,r),J=n.memoizedState),(te=ys||Bp(n,a,te,r,F,J,L)||t!==null&&t.dependencies!==null&&Yl(t.dependencies))?(V||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(r,J,L),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(r,J,L)),typeof d.componentDidUpdate=="function"&&(n.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof d.componentDidUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(n.flags|=1024),n.memoizedProps=r,n.memoizedState=J),d.props=r,d.state=J,d.context=L,r=te):(typeof d.componentDidUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&F===t.memoizedState||(n.flags|=1024),r=!1)}return d=r,uc(t,n),r=(n.flags&128)!==0,d||r?(d=n.stateNode,a=r&&typeof a.getDerivedStateFromError!="function"?null:d.render(),n.flags|=1,t!==null&&r?(n.child=ho(n,t.child,null,u),n.child=ho(n,null,a,u)):Fn(t,n,a,u),n.memoizedState=d.state,t=n.child):t=Va(t,n,u),t}function Qp(t,n,a,r){return lo(),n.flags|=256,Fn(t,n,a,r),n.child}var Ed={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function _d(t){return{baseLanes:t,cachePool:Um()}}function wd(t,n,a){return t=t!==null?t.childLanes&~a:0,n&&(t|=Ri),t}function Jp(t,n,a){var r=n.pendingProps,u=!1,d=(n.flags&128)!==0,x;if((x=d)||(x=t!==null&&t.memoizedState===null?!1:(ln.current&2)!==0),x&&(u=!0,n.flags&=-129),x=(n.flags&32)!==0,n.flags&=-33,t===null){if(lt){if(u?vs(n):Ss(),(t=Vt)?(t=og(t,Ki),t=t!==null&&t.data!=="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:ms!==null?{id:_a,overflow:wa}:null,retryLane:536870912,hydrationErrors:null},a=Rm(t),a.return=n,n.child=a,Yn=n,Vt=null)):t=null,t===null)throw hs(n);return cf(t)?n.lanes=32:n.lanes=536870912,null}var E=r.children;return r=r.fallback,u?(Ss(),u=n.mode,E=dc({mode:"hidden",children:E},u),r=ro(r,u,a,null),E.return=n,r.return=n,E.sibling=r,n.child=E,r=n.child,r.memoizedState=_d(a),r.childLanes=wd(t,x,a),n.memoizedState=Ed,$r(null,r)):(vs(n),Md(n,E))}var L=t.memoizedState;if(L!==null&&(E=L.dehydrated,E!==null)){if(d)n.flags&256?(vs(n),n.flags&=-257,n=Od(t,n,a)):n.memoizedState!==null?(Ss(),n.child=t.child,n.flags|=128,n=null):(Ss(),E=r.fallback,u=n.mode,r=dc({mode:"visible",children:r.children},u),E=ro(E,u,a,null),E.flags|=2,r.return=n,E.return=n,r.sibling=E,n.child=r,ho(n,t.child,null,a),r=n.child,r.memoizedState=_d(a),r.childLanes=wd(t,x,a),n.memoizedState=Ed,n=$r(null,r));else if(vs(n),cf(E)){if(x=E.nextSibling&&E.nextSibling.dataset,x)var V=x.dgst;x=V,r=Error(o(419)),r.stack="",r.digest=x,Rr({value:r,source:null,stack:null}),n=Od(t,n,a)}else if(Sn||Vo(t,n,a,!1),x=(a&t.childLanes)!==0,Sn||x){if(x=jt,x!==null&&(r=ka(x,a),r!==0&&r!==L.retryLane))throw L.retryLane=r,oo(t,r),yi(x,t,r),Ad;lf(E)||vc(),n=Od(t,n,a)}else lf(E)?(n.flags|=192,n.child=t.child,n=null):(t=L.treeContext,Vt=Wi(E.nextSibling),Yn=n,lt=!0,ps=null,Ki=!1,t!==null&&Lm(n,t),n=Md(n,r.children),n.flags|=4096);return n}return u?(Ss(),E=r.fallback,u=n.mode,L=t.child,V=L.sibling,r=Da(L,{mode:"hidden",children:r.children}),r.subtreeFlags=L.subtreeFlags&65011712,V!==null?E=Da(V,E):(E=ro(E,u,a,null),E.flags|=2),E.return=n,r.return=n,r.sibling=E,n.child=r,$r(null,r),r=n.child,E=t.child.memoizedState,E===null?E=_d(a):(u=E.cachePool,u!==null?(L=xn._currentValue,u=u.parent!==L?{parent:L,pool:L}:u):u=Um(),E={baseLanes:E.baseLanes|a,cachePool:u}),r.memoizedState=E,r.childLanes=wd(t,x,a),n.memoizedState=Ed,$r(t.child,r)):(vs(n),a=t.child,t=a.sibling,a=Da(a,{mode:"visible",children:r.children}),a.return=n,a.sibling=null,t!==null&&(x=n.deletions,x===null?(n.deletions=[t],n.flags|=16):x.push(t)),n.child=a,n.memoizedState=null,a)}function Md(t,n){return n=dc({mode:"visible",children:n},t.mode),n.return=t,t.child=n}function dc(t,n){return t=Mi(22,t,null,n),t.lanes=0,t}function Od(t,n,a){return ho(n,t.child,null,a),t=Md(n,n.pendingProps.children),t.flags|=2,n.memoizedState=null,t}function Zp(t,n,a){t.lanes|=n;var r=t.alternate;r!==null&&(r.lanes|=n),$u(t.return,n,a)}function Cd(t,n,a,r,u,d){var x=t.memoizedState;x===null?t.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:r,tail:a,tailMode:u,treeForkCount:d}:(x.isBackwards=n,x.rendering=null,x.renderingStartTime=0,x.last=r,x.tail=a,x.tailMode=u,x.treeForkCount=d)}function eh(t,n,a){var r=n.pendingProps,u=r.revealOrder,d=r.tail;r=r.children;var x=ln.current,E=(x&2)!==0;if(E?(x=x&1|2,n.flags|=128):x&=1,K(ln,x),Fn(t,n,r,a),r=lt?kr:0,!E&&t!==null&&(t.flags&128)!==0)e:for(t=n.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Zp(t,a,n);else if(t.tag===19)Zp(t,a,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break e;for(;t.sibling===null;){if(t.return===null||t.return===n)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(u){case"forwards":for(a=n.child,u=null;a!==null;)t=a.alternate,t!==null&&Zl(t)===null&&(u=a),a=a.sibling;a=u,a===null?(u=n.child,n.child=null):(u=a.sibling,a.sibling=null),Cd(n,!1,u,a,d,r);break;case"backwards":case"unstable_legacy-backwards":for(a=null,u=n.child,n.child=null;u!==null;){if(t=u.alternate,t!==null&&Zl(t)===null){n.child=u;break}t=u.sibling,u.sibling=a,a=u,u=t}Cd(n,!0,a,null,d,r);break;case"together":Cd(n,!1,null,null,void 0,r);break;default:n.memoizedState=null}return n.child}function Va(t,n,a){if(t!==null&&(n.dependencies=t.dependencies),Es|=n.lanes,(a&n.childLanes)===0)if(t!==null){if(Vo(t,n,a,!1),(a&n.childLanes)===0)return null}else return null;if(t!==null&&n.child!==t.child)throw Error(o(153));if(n.child!==null){for(t=n.child,a=Da(t,t.pendingProps),n.child=a,a.return=n;t.sibling!==null;)t=t.sibling,a=a.sibling=Da(t,t.pendingProps),a.return=n;a.sibling=null}return n.child}function kd(t,n){return(t.lanes&n)!==0?!0:(t=t.dependencies,!!(t!==null&&Yl(t)))}function ob(t,n,a){switch(n.tag){case 3:nt(n,n.stateNode.containerInfo),gs(n,xn,t.memoizedState.cache),lo();break;case 27:case 5:ze(n);break;case 4:nt(n,n.stateNode.containerInfo);break;case 10:gs(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,td(n),null;break;case 13:var r=n.memoizedState;if(r!==null)return r.dehydrated!==null?(vs(n),n.flags|=128,null):(a&n.child.childLanes)!==0?Jp(t,n,a):(vs(n),t=Va(t,n,a),t!==null?t.sibling:null);vs(n);break;case 19:var u=(t.flags&128)!==0;if(r=(a&n.childLanes)!==0,r||(Vo(t,n,a,!1),r=(a&n.childLanes)!==0),u){if(r)return eh(t,n,a);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),K(ln,ln.current),r)break;return null;case 22:return n.lanes=0,Kp(t,n,a,n.pendingProps);case 24:gs(n,xn,t.memoizedState.cache)}return Va(t,n,a)}function th(t,n,a){if(t!==null)if(t.memoizedProps!==n.pendingProps)Sn=!0;else{if(!kd(t,a)&&(n.flags&128)===0)return Sn=!1,ob(t,n,a);Sn=(t.flags&131072)!==0}else Sn=!1,lt&&(n.flags&1048576)!==0&&Im(n,kr,n.index);switch(n.lanes=0,n.tag){case 16:e:{var r=n.pendingProps;if(t=mo(n.elementType),n.type=t,typeof t=="function")Bu(t)?(r=yo(t,r),n.tag=1,n=Gp(null,n,t,r,a)):(n.tag=0,n=Td(null,n,t,r,a));else{if(t!=null){var u=t.$$typeof;if(u===R){n.tag=11,n=$p(null,n,t,r,a);break e}else if(u===j){n.tag=14,n=Vp(null,n,t,r,a);break e}}throw n=le(t)||t,Error(o(306,n,""))}}return n;case 0:return Td(t,n,n.type,n.pendingProps,a);case 1:return r=n.type,u=yo(r,n.pendingProps),Gp(t,n,r,u,a);case 3:e:{if(nt(n,n.stateNode.containerInfo),t===null)throw Error(o(387));r=n.pendingProps;var d=n.memoizedState;u=d.element,Gu(t,n),Dr(n,r,null,a);var x=n.memoizedState;if(r=x.cache,gs(n,xn,r),r!==d.cache&&Vu(n,[xn],a,!0),jr(),r=x.element,d.isDehydrated)if(d={element:r,isDehydrated:!1,cache:x.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=Qp(t,n,r,a);break e}else if(r!==u){u=$i(Error(o(424)),n),Rr(u),n=Qp(t,n,r,a);break e}else for(t=n.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,Vt=Wi(t.firstChild),Yn=n,lt=!0,ps=null,Ki=!0,a=Km(n,null,r,a),n.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(lo(),r===u){n=Va(t,n,a);break e}Fn(t,n,r,a)}n=n.child}return n;case 26:return uc(t,n),t===null?(a=fg(n.type,null,n.pendingProps,null))?n.memoizedState=a:lt||(a=n.type,t=n.pendingProps,r=Mc(Ie.current).createElement(a),r[X]=n,r[se]=t,Wn(r,a,t),Pt(r),n.stateNode=r):n.memoizedState=fg(n.type,t.memoizedProps,n.pendingProps,t.memoizedState),null;case 27:return ze(n),t===null&&lt&&(r=n.stateNode=cg(n.type,n.pendingProps,Ie.current),Yn=n,Ki=!0,u=Vt,Cs(n.type)?(uf=u,Vt=Wi(r.firstChild)):Vt=u),Fn(t,n,n.pendingProps.children,a),uc(t,n),t===null&&(n.flags|=4194304),n.child;case 5:return t===null&&lt&&((u=r=Vt)&&(r=Hb(r,n.type,n.pendingProps,Ki),r!==null?(n.stateNode=r,Yn=n,Vt=Wi(r.firstChild),Ki=!1,u=!0):u=!1),u||hs(n)),ze(n),u=n.type,d=n.pendingProps,x=t!==null?t.memoizedProps:null,r=d.children,sf(u,d)?r=null:x!==null&&sf(u,x)&&(n.flags|=32),n.memoizedState!==null&&(u=id(t,n,Q0,null,null,a),al._currentValue=u),uc(t,n),Fn(t,n,r,a),n.child;case 6:return t===null&&lt&&((t=a=Vt)&&(a=jb(a,n.pendingProps,Ki),a!==null?(n.stateNode=a,Yn=n,Vt=null,t=!0):t=!1),t||hs(n)),null;case 13:return Jp(t,n,a);case 4:return nt(n,n.stateNode.containerInfo),r=n.pendingProps,t===null?n.child=ho(n,null,r,a):Fn(t,n,r,a),n.child;case 11:return $p(t,n,n.type,n.pendingProps,a);case 7:return Fn(t,n,n.pendingProps,a),n.child;case 8:return Fn(t,n,n.pendingProps.children,a),n.child;case 12:return Fn(t,n,n.pendingProps.children,a),n.child;case 10:return r=n.pendingProps,gs(n,n.type,r.value),Fn(t,n,r.children,a),n.child;case 9:return u=n.type._context,r=n.pendingProps.children,uo(n),u=Kn(u),r=r(u),n.flags|=1,Fn(t,n,r,a),n.child;case 14:return Vp(t,n,n.type,n.pendingProps,a);case 15:return Yp(t,n,n.type,n.pendingProps,a);case 19:return eh(t,n,a);case 31:return sb(t,n,a);case 22:return Kp(t,n,a,n.pendingProps);case 24:return uo(n),r=Kn(xn),t===null?(u=Fu(),u===null&&(u=jt,d=Yu(),u.pooledCache=d,d.refCount++,d!==null&&(u.pooledCacheLanes|=a),u=d),n.memoizedState={parent:r,cache:u},Xu(n),gs(n,xn,u)):((t.lanes&a)!==0&&(Gu(t,n),Dr(n,null,null,a),jr()),u=t.memoizedState,d=n.memoizedState,u.parent!==r?(u={parent:r,cache:r},n.memoizedState=u,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=u),gs(n,xn,r)):(r=d.cache,gs(n,xn,r),r!==u.cache&&Vu(n,[xn],a,!0))),Fn(t,n,n.pendingProps.children,a),n.child;case 29:throw n.pendingProps}throw Error(o(156,n.tag))}function Ya(t){t.flags|=4}function Rd(t,n,a,r,u){if((n=(t.mode&32)!==0)&&(n=!1),n){if(t.flags|=16777216,(u&335544128)===u)if(t.stateNode.complete)t.flags|=8192;else if(Oh())t.flags|=8192;else throw po=Xl,Wu}else t.flags&=-16777217}function nh(t,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!yg(n))if(Oh())t.flags|=8192;else throw po=Xl,Wu}function fc(t,n){n!==null&&(t.flags|=4),t.flags&16384&&(n=t.tag!==22?na():536870912,t.lanes|=n,nr|=n)}function Vr(t,n){if(!lt)switch(t.tailMode){case"hidden":n=t.tail;for(var a=null;n!==null;)n.alternate!==null&&(a=n),n=n.sibling;a===null?t.tail=null:a.sibling=null;break;case"collapsed":a=t.tail;for(var r=null;a!==null;)a.alternate!==null&&(r=a),a=a.sibling;r===null?n||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Yt(t){var n=t.alternate!==null&&t.alternate.child===t.child,a=0,r=0;if(n)for(var u=t.child;u!==null;)a|=u.lanes|u.childLanes,r|=u.subtreeFlags&65011712,r|=u.flags&65011712,u.return=t,u=u.sibling;else for(u=t.child;u!==null;)a|=u.lanes|u.childLanes,r|=u.subtreeFlags,r|=u.flags,u.return=t,u=u.sibling;return t.subtreeFlags|=r,t.childLanes=a,n}function rb(t,n,a){var r=n.pendingProps;switch(Pu(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yt(n),null;case 1:return Yt(n),null;case 3:return a=n.stateNode,r=null,t!==null&&(r=t.memoizedState.cache),n.memoizedState.cache!==r&&(n.flags|=2048),qa(xn),He(),a.pendingContext&&(a.context=a.pendingContext,a.pendingContext=null),(t===null||t.child===null)&&($o(n)?Ya(n):t===null||t.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,qu())),Yt(n),null;case 26:var u=n.type,d=n.memoizedState;return t===null?(Ya(n),d!==null?(Yt(n),nh(n,d)):(Yt(n),Rd(n,u,null,r,a))):d?d!==t.memoizedState?(Ya(n),Yt(n),nh(n,d)):(Yt(n),n.flags&=-16777217):(t=t.memoizedProps,t!==r&&Ya(n),Yt(n),Rd(n,u,t,r,a)),null;case 27:if(Qt(n),a=Ie.current,u=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==r&&Ya(n);else{if(!r){if(n.stateNode===null)throw Error(o(166));return Yt(n),null}t=ne.current,$o(n)?Bm(n):(t=cg(u,r,a),n.stateNode=t,Ya(n))}return Yt(n),null;case 5:if(Qt(n),u=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==r&&Ya(n);else{if(!r){if(n.stateNode===null)throw Error(o(166));return Yt(n),null}if(d=ne.current,$o(n))Bm(n);else{var x=Mc(Ie.current);switch(d){case 1:d=x.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:d=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":d=x.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":d=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":d=x.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof r.is=="string"?x.createElement("select",{is:r.is}):x.createElement("select"),r.multiple?d.multiple=!0:r.size&&(d.size=r.size);break;default:d=typeof r.is=="string"?x.createElement(u,{is:r.is}):x.createElement(u)}}d[X]=n,d[se]=r;e:for(x=n.child;x!==null;){if(x.tag===5||x.tag===6)d.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===n)break e;for(;x.sibling===null;){if(x.return===null||x.return===n)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}n.stateNode=d;e:switch(Wn(d,u,r),u){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&Ya(n)}}return Yt(n),Rd(n,n.type,t===null?null:t.memoizedProps,n.pendingProps,a),null;case 6:if(t&&n.stateNode!=null)t.memoizedProps!==r&&Ya(n);else{if(typeof r!="string"&&n.stateNode===null)throw Error(o(166));if(t=Ie.current,$o(n)){if(t=n.stateNode,a=n.memoizedProps,r=null,u=Yn,u!==null)switch(u.tag){case 27:case 5:r=u.memoizedProps}t[X]=n,t=!!(t.nodeValue===a||r!==null&&r.suppressHydrationWarning===!0||Jh(t.nodeValue,a)),t||hs(n,!0)}else t=Mc(t).createTextNode(r),t[X]=n,n.stateNode=t}return Yt(n),null;case 31:if(a=n.memoizedState,t===null||t.memoizedState!==null){if(r=$o(n),a!==null){if(t===null){if(!r)throw Error(o(318));if(t=n.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(557));t[X]=n}else lo(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Yt(n),t=!1}else a=qu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=a),t=!0;if(!t)return n.flags&256?(Ci(n),n):(Ci(n),null);if((n.flags&128)!==0)throw Error(o(558))}return Yt(n),null;case 13:if(r=n.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(u=$o(n),r!==null&&r.dehydrated!==null){if(t===null){if(!u)throw Error(o(318));if(u=n.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));u[X]=n}else lo(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Yt(n),u=!1}else u=qu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=u),u=!0;if(!u)return n.flags&256?(Ci(n),n):(Ci(n),null)}return Ci(n),(n.flags&128)!==0?(n.lanes=a,n):(a=r!==null,t=t!==null&&t.memoizedState!==null,a&&(r=n.child,u=null,r.alternate!==null&&r.alternate.memoizedState!==null&&r.alternate.memoizedState.cachePool!==null&&(u=r.alternate.memoizedState.cachePool.pool),d=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),d!==u&&(r.flags|=2048)),a!==t&&a&&(n.child.flags|=8192),fc(n,n.updateQueue),Yt(n),null);case 4:return He(),t===null&&Zd(n.stateNode.containerInfo),Yt(n),null;case 10:return qa(n.type),Yt(n),null;case 19:if(U(ln),r=n.memoizedState,r===null)return Yt(n),null;if(u=(n.flags&128)!==0,d=r.rendering,d===null)if(u)Vr(r,!1);else{if(tn!==0||t!==null&&(t.flags&128)!==0)for(t=n.child;t!==null;){if(d=Zl(t),d!==null){for(n.flags|=128,Vr(r,!1),t=d.updateQueue,n.updateQueue=t,fc(n,t),n.subtreeFlags=0,t=a,a=n.child;a!==null;)km(a,t),a=a.sibling;return K(ln,ln.current&1|2),lt&&Pa(n,r.treeForkCount),n.child}t=t.sibling}r.tail!==null&&wn()>yc&&(n.flags|=128,u=!0,Vr(r,!1),n.lanes=4194304)}else{if(!u)if(t=Zl(d),t!==null){if(n.flags|=128,u=!0,t=t.updateQueue,n.updateQueue=t,fc(n,t),Vr(r,!0),r.tail===null&&r.tailMode==="hidden"&&!d.alternate&&!lt)return Yt(n),null}else 2*wn()-r.renderingStartTime>yc&&a!==536870912&&(n.flags|=128,u=!0,Vr(r,!1),n.lanes=4194304);r.isBackwards?(d.sibling=n.child,n.child=d):(t=r.last,t!==null?t.sibling=d:n.child=d,r.last=d)}return r.tail!==null?(t=r.tail,r.rendering=t,r.tail=t.sibling,r.renderingStartTime=wn(),t.sibling=null,a=ln.current,K(ln,u?a&1|2:a&1),lt&&Pa(n,r.treeForkCount),t):(Yt(n),null);case 22:case 23:return Ci(n),ed(),r=n.memoizedState!==null,t!==null?t.memoizedState!==null!==r&&(n.flags|=8192):r&&(n.flags|=8192),r?(a&536870912)!==0&&(n.flags&128)===0&&(Yt(n),n.subtreeFlags&6&&(n.flags|=8192)):Yt(n),a=n.updateQueue,a!==null&&fc(n,a.retryQueue),a=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(a=t.memoizedState.cachePool.pool),r=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),r!==a&&(n.flags|=2048),t!==null&&U(fo),null;case 24:return a=null,t!==null&&(a=t.memoizedState.cache),n.memoizedState.cache!==a&&(n.flags|=2048),qa(xn),Yt(n),null;case 25:return null;case 30:return null}throw Error(o(156,n.tag))}function lb(t,n){switch(Pu(n),n.tag){case 1:return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 3:return qa(xn),He(),t=n.flags,(t&65536)!==0&&(t&128)===0?(n.flags=t&-65537|128,n):null;case 26:case 27:case 5:return Qt(n),null;case 31:if(n.memoizedState!==null){if(Ci(n),n.alternate===null)throw Error(o(340));lo()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 13:if(Ci(n),t=n.memoizedState,t!==null&&t.dehydrated!==null){if(n.alternate===null)throw Error(o(340));lo()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 19:return U(ln),null;case 4:return He(),null;case 10:return qa(n.type),null;case 22:case 23:return Ci(n),ed(),t!==null&&U(fo),t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 24:return qa(xn),null;case 25:return null;default:return null}}function ih(t,n){switch(Pu(n),n.tag){case 3:qa(xn),He();break;case 26:case 27:case 5:Qt(n);break;case 4:He();break;case 31:n.memoizedState!==null&&Ci(n);break;case 13:Ci(n);break;case 19:U(ln);break;case 10:qa(n.type);break;case 22:case 23:Ci(n),ed(),t!==null&&U(fo);break;case 24:qa(xn)}}function Yr(t,n){try{var a=n.updateQueue,r=a!==null?a.lastEffect:null;if(r!==null){var u=r.next;a=u;do{if((a.tag&t)===t){r=void 0;var d=a.create,x=a.inst;r=d(),x.destroy=r}a=a.next}while(a!==u)}}catch(E){_t(n,n.return,E)}}function As(t,n,a){try{var r=n.updateQueue,u=r!==null?r.lastEffect:null;if(u!==null){var d=u.next;r=d;do{if((r.tag&t)===t){var x=r.inst,E=x.destroy;if(E!==void 0){x.destroy=void 0,u=n;var L=a,V=E;try{V()}catch(te){_t(u,L,te)}}}r=r.next}while(r!==d)}}catch(te){_t(n,n.return,te)}}function ah(t){var n=t.updateQueue;if(n!==null){var a=t.stateNode;try{Wm(n,a)}catch(r){_t(t,t.return,r)}}}function sh(t,n,a){a.props=yo(t.type,t.memoizedProps),a.state=t.memoizedState;try{a.componentWillUnmount()}catch(r){_t(t,n,r)}}function Kr(t,n){try{var a=t.ref;if(a!==null){switch(t.tag){case 26:case 27:case 5:var r=t.stateNode;break;case 30:r=t.stateNode;break;default:r=t.stateNode}typeof a=="function"?t.refCleanup=a(r):a.current=r}}catch(u){_t(t,n,u)}}function Ma(t,n){var a=t.ref,r=t.refCleanup;if(a!==null)if(typeof r=="function")try{r()}catch(u){_t(t,n,u)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof a=="function")try{a(null)}catch(u){_t(t,n,u)}else a.current=null}function oh(t){var n=t.type,a=t.memoizedProps,r=t.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break e;case"img":a.src?r.src=a.src:a.srcSet&&(r.srcset=a.srcSet)}}catch(u){_t(t,t.return,u)}}function Nd(t,n,a){try{var r=t.stateNode;kb(r,t.type,a,n),r[se]=n}catch(u){_t(t,t.return,u)}}function rh(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&Cs(t.type)||t.tag===4}function Id(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||rh(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&Cs(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ld(t,n,a){var r=t.tag;if(r===5||r===6)t=t.stateNode,n?(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a).insertBefore(t,n):(n=a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,n.appendChild(t),a=a._reactRootContainer,a!=null||n.onclick!==null||(n.onclick=oi));else if(r!==4&&(r===27&&Cs(t.type)&&(a=t.stateNode,n=null),t=t.child,t!==null))for(Ld(t,n,a),t=t.sibling;t!==null;)Ld(t,n,a),t=t.sibling}function mc(t,n,a){var r=t.tag;if(r===5||r===6)t=t.stateNode,n?a.insertBefore(t,n):a.appendChild(t);else if(r!==4&&(r===27&&Cs(t.type)&&(a=t.stateNode),t=t.child,t!==null))for(mc(t,n,a),t=t.sibling;t!==null;)mc(t,n,a),t=t.sibling}function lh(t){var n=t.stateNode,a=t.memoizedProps;try{for(var r=t.type,u=n.attributes;u.length;)n.removeAttributeNode(u[0]);Wn(n,r,a),n[X]=t,n[se]=a}catch(d){_t(t,t.return,d)}}var Ka=!1,An=!1,Bd=!1,ch=typeof WeakSet=="function"?WeakSet:Set,Pn=null;function cb(t,n){if(t=t.containerInfo,nf=Lc,t=Sm(t),Ou(t)){if("selectionStart"in t)var a={start:t.selectionStart,end:t.selectionEnd};else e:{a=(a=t.ownerDocument)&&a.defaultView||window;var r=a.getSelection&&a.getSelection();if(r&&r.rangeCount!==0){a=r.anchorNode;var u=r.anchorOffset,d=r.focusNode;r=r.focusOffset;try{a.nodeType,d.nodeType}catch{a=null;break e}var x=0,E=-1,L=-1,V=0,te=0,ce=t,F=null;t:for(;;){for(var J;ce!==a||u!==0&&ce.nodeType!==3||(E=x+u),ce!==d||r!==0&&ce.nodeType!==3||(L=x+r),ce.nodeType===3&&(x+=ce.nodeValue.length),(J=ce.firstChild)!==null;)F=ce,ce=J;for(;;){if(ce===t)break t;if(F===a&&++V===u&&(E=x),F===d&&++te===r&&(L=x),(J=ce.nextSibling)!==null)break;ce=F,F=ce.parentNode}ce=J}a=E===-1||L===-1?null:{start:E,end:L}}else a=null}a=a||{start:0,end:0}}else a=null;for(af={focusedElem:t,selectionRange:a},Lc=!1,Pn=n;Pn!==null;)if(n=Pn,t=n.child,(n.subtreeFlags&1028)!==0&&t!==null)t.return=n,Pn=t;else for(;Pn!==null;){switch(n=Pn,d=n.alternate,t=n.flags,n.tag){case 0:if((t&4)!==0&&(t=n.updateQueue,t=t!==null?t.events:null,t!==null))for(a=0;a<t.length;a++)u=t[a],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,a=n,u=d.memoizedProps,d=d.memoizedState,r=a.stateNode;try{var Ce=yo(a.type,u);t=r.getSnapshotBeforeUpdate(Ce,d),r.__reactInternalSnapshotBeforeUpdate=t}catch(Ue){_t(a,a.return,Ue)}}break;case 3:if((t&1024)!==0){if(t=n.stateNode.containerInfo,a=t.nodeType,a===9)rf(t);else if(a===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":rf(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(o(163))}if(t=n.sibling,t!==null){t.return=n.return,Pn=t;break}Pn=n.return}}function uh(t,n,a){var r=a.flags;switch(a.tag){case 0:case 11:case 15:Wa(t,a),r&4&&Yr(5,a);break;case 1:if(Wa(t,a),r&4)if(t=a.stateNode,n===null)try{t.componentDidMount()}catch(x){_t(a,a.return,x)}else{var u=yo(a.type,n.memoizedProps);n=n.memoizedState;try{t.componentDidUpdate(u,n,t.__reactInternalSnapshotBeforeUpdate)}catch(x){_t(a,a.return,x)}}r&64&&ah(a),r&512&&Kr(a,a.return);break;case 3:if(Wa(t,a),r&64&&(t=a.updateQueue,t!==null)){if(n=null,a.child!==null)switch(a.child.tag){case 27:case 5:n=a.child.stateNode;break;case 1:n=a.child.stateNode}try{Wm(t,n)}catch(x){_t(a,a.return,x)}}break;case 27:n===null&&r&4&&lh(a);case 26:case 5:Wa(t,a),n===null&&r&4&&oh(a),r&512&&Kr(a,a.return);break;case 12:Wa(t,a);break;case 31:Wa(t,a),r&4&&mh(t,a);break;case 13:Wa(t,a),r&4&&ph(t,a),r&64&&(t=a.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(a=bb.bind(null,a),Db(t,a))));break;case 22:if(r=a.memoizedState!==null||Ka,!r){n=n!==null&&n.memoizedState!==null||An,u=Ka;var d=An;Ka=r,(An=n)&&!d?Xa(t,a,(a.subtreeFlags&8772)!==0):Wa(t,a),Ka=u,An=d}break;case 30:break;default:Wa(t,a)}}function dh(t){var n=t.alternate;n!==null&&(t.alternate=null,dh(n)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(n=t.stateNode,n!==null&&It(n)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Xt=null,mi=!1;function Fa(t,n,a){for(a=a.child;a!==null;)fh(t,n,a),a=a.sibling}function fh(t,n,a){if(ke&&typeof ke.onCommitFiberUnmount=="function")try{ke.onCommitFiberUnmount(sn,a)}catch{}switch(a.tag){case 26:An||Ma(a,n),Fa(t,n,a),a.memoizedState?a.memoizedState.count--:a.stateNode&&(a=a.stateNode,a.parentNode.removeChild(a));break;case 27:An||Ma(a,n);var r=Xt,u=mi;Cs(a.type)&&(Xt=a.stateNode,mi=!1),Fa(t,n,a),tl(a.stateNode),Xt=r,mi=u;break;case 5:An||Ma(a,n);case 6:if(r=Xt,u=mi,Xt=null,Fa(t,n,a),Xt=r,mi=u,Xt!==null)if(mi)try{(Xt.nodeType===9?Xt.body:Xt.nodeName==="HTML"?Xt.ownerDocument.body:Xt).removeChild(a.stateNode)}catch(d){_t(a,n,d)}else try{Xt.removeChild(a.stateNode)}catch(d){_t(a,n,d)}break;case 18:Xt!==null&&(mi?(t=Xt,ag(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,a.stateNode),ur(t)):ag(Xt,a.stateNode));break;case 4:r=Xt,u=mi,Xt=a.stateNode.containerInfo,mi=!0,Fa(t,n,a),Xt=r,mi=u;break;case 0:case 11:case 14:case 15:As(2,a,n),An||As(4,a,n),Fa(t,n,a);break;case 1:An||(Ma(a,n),r=a.stateNode,typeof r.componentWillUnmount=="function"&&sh(a,n,r)),Fa(t,n,a);break;case 21:Fa(t,n,a);break;case 22:An=(r=An)||a.memoizedState!==null,Fa(t,n,a),An=r;break;default:Fa(t,n,a)}}function mh(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{ur(t)}catch(a){_t(n,n.return,a)}}}function ph(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{ur(t)}catch(a){_t(n,n.return,a)}}function ub(t){switch(t.tag){case 31:case 13:case 19:var n=t.stateNode;return n===null&&(n=t.stateNode=new ch),n;case 22:return t=t.stateNode,n=t._retryCache,n===null&&(n=t._retryCache=new ch),n;default:throw Error(o(435,t.tag))}}function pc(t,n){var a=ub(t);n.forEach(function(r){if(!a.has(r)){a.add(r);var u=xb.bind(null,t,r);r.then(u,u)}})}function pi(t,n){var a=n.deletions;if(a!==null)for(var r=0;r<a.length;r++){var u=a[r],d=t,x=n,E=x;e:for(;E!==null;){switch(E.tag){case 27:if(Cs(E.type)){Xt=E.stateNode,mi=!1;break e}break;case 5:Xt=E.stateNode,mi=!1;break e;case 3:case 4:Xt=E.stateNode.containerInfo,mi=!0;break e}E=E.return}if(Xt===null)throw Error(o(160));fh(d,x,u),Xt=null,mi=!1,d=u.alternate,d!==null&&(d.return=null),u.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)hh(n,t),n=n.sibling}var ua=null;function hh(t,n){var a=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:pi(n,t),hi(t),r&4&&(As(3,t,t.return),Yr(3,t),As(5,t,t.return));break;case 1:pi(n,t),hi(t),r&512&&(An||a===null||Ma(a,a.return)),r&64&&Ka&&(t=t.updateQueue,t!==null&&(r=t.callbacks,r!==null&&(a=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=a===null?r:a.concat(r))));break;case 26:var u=ua;if(pi(n,t),hi(t),r&512&&(An||a===null||Ma(a,a.return)),r&4){var d=a!==null?a.memoizedState:null;if(r=t.memoizedState,a===null)if(r===null)if(t.stateNode===null){e:{r=t.type,a=t.memoizedProps,u=u.ownerDocument||u;t:switch(r){case"title":d=u.getElementsByTagName("title")[0],(!d||d[pt]||d[X]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=u.createElement(r),u.head.insertBefore(d,u.querySelector("head > title"))),Wn(d,r,a),d[X]=t,Pt(d),r=d;break e;case"link":var x=hg("link","href",u).get(r+(a.href||""));if(x){for(var E=0;E<x.length;E++)if(d=x[E],d.getAttribute("href")===(a.href==null||a.href===""?null:a.href)&&d.getAttribute("rel")===(a.rel==null?null:a.rel)&&d.getAttribute("title")===(a.title==null?null:a.title)&&d.getAttribute("crossorigin")===(a.crossOrigin==null?null:a.crossOrigin)){x.splice(E,1);break t}}d=u.createElement(r),Wn(d,r,a),u.head.appendChild(d);break;case"meta":if(x=hg("meta","content",u).get(r+(a.content||""))){for(E=0;E<x.length;E++)if(d=x[E],d.getAttribute("content")===(a.content==null?null:""+a.content)&&d.getAttribute("name")===(a.name==null?null:a.name)&&d.getAttribute("property")===(a.property==null?null:a.property)&&d.getAttribute("http-equiv")===(a.httpEquiv==null?null:a.httpEquiv)&&d.getAttribute("charset")===(a.charSet==null?null:a.charSet)){x.splice(E,1);break t}}d=u.createElement(r),Wn(d,r,a),u.head.appendChild(d);break;default:throw Error(o(468,r))}d[X]=t,Pt(d),r=d}t.stateNode=r}else gg(u,t.type,t.stateNode);else t.stateNode=pg(u,r,t.memoizedProps);else d!==r?(d===null?a.stateNode!==null&&(a=a.stateNode,a.parentNode.removeChild(a)):d.count--,r===null?gg(u,t.type,t.stateNode):pg(u,r,t.memoizedProps)):r===null&&t.stateNode!==null&&Nd(t,t.memoizedProps,a.memoizedProps)}break;case 27:pi(n,t),hi(t),r&512&&(An||a===null||Ma(a,a.return)),a!==null&&r&4&&Nd(t,t.memoizedProps,a.memoizedProps);break;case 5:if(pi(n,t),hi(t),r&512&&(An||a===null||Ma(a,a.return)),t.flags&32){u=t.stateNode;try{On(u,"")}catch(Ce){_t(t,t.return,Ce)}}r&4&&t.stateNode!=null&&(u=t.memoizedProps,Nd(t,u,a!==null?a.memoizedProps:u)),r&1024&&(Bd=!0);break;case 6:if(pi(n,t),hi(t),r&4){if(t.stateNode===null)throw Error(o(162));r=t.memoizedProps,a=t.stateNode;try{a.nodeValue=r}catch(Ce){_t(t,t.return,Ce)}}break;case 3:if(kc=null,u=ua,ua=Oc(n.containerInfo),pi(n,t),ua=u,hi(t),r&4&&a!==null&&a.memoizedState.isDehydrated)try{ur(n.containerInfo)}catch(Ce){_t(t,t.return,Ce)}Bd&&(Bd=!1,gh(t));break;case 4:r=ua,ua=Oc(t.stateNode.containerInfo),pi(n,t),hi(t),ua=r;break;case 12:pi(n,t),hi(t);break;case 31:pi(n,t),hi(t),r&4&&(r=t.updateQueue,r!==null&&(t.updateQueue=null,pc(t,r)));break;case 13:pi(n,t),hi(t),t.child.flags&8192&&t.memoizedState!==null!=(a!==null&&a.memoizedState!==null)&&(gc=wn()),r&4&&(r=t.updateQueue,r!==null&&(t.updateQueue=null,pc(t,r)));break;case 22:u=t.memoizedState!==null;var L=a!==null&&a.memoizedState!==null,V=Ka,te=An;if(Ka=V||u,An=te||L,pi(n,t),An=te,Ka=V,hi(t),r&8192)e:for(n=t.stateNode,n._visibility=u?n._visibility&-2:n._visibility|1,u&&(a===null||L||Ka||An||bo(t)),a=null,n=t;;){if(n.tag===5||n.tag===26){if(a===null){L=a=n;try{if(d=L.stateNode,u)x=d.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{E=L.stateNode;var ce=L.memoizedProps.style,F=ce!=null&&ce.hasOwnProperty("display")?ce.display:null;E.style.display=F==null||typeof F=="boolean"?"":(""+F).trim()}}catch(Ce){_t(L,L.return,Ce)}}}else if(n.tag===6){if(a===null){L=n;try{L.stateNode.nodeValue=u?"":L.memoizedProps}catch(Ce){_t(L,L.return,Ce)}}}else if(n.tag===18){if(a===null){L=n;try{var J=L.stateNode;u?sg(J,!0):sg(L.stateNode,!1)}catch(Ce){_t(L,L.return,Ce)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break e;for(;n.sibling===null;){if(n.return===null||n.return===t)break e;a===n&&(a=null),n=n.return}a===n&&(a=null),n.sibling.return=n.return,n=n.sibling}r&4&&(r=t.updateQueue,r!==null&&(a=r.retryQueue,a!==null&&(r.retryQueue=null,pc(t,a))));break;case 19:pi(n,t),hi(t),r&4&&(r=t.updateQueue,r!==null&&(t.updateQueue=null,pc(t,r)));break;case 30:break;case 21:break;default:pi(n,t),hi(t)}}function hi(t){var n=t.flags;if(n&2){try{for(var a,r=t.return;r!==null;){if(rh(r)){a=r;break}r=r.return}if(a==null)throw Error(o(160));switch(a.tag){case 27:var u=a.stateNode,d=Id(t);mc(t,d,u);break;case 5:var x=a.stateNode;a.flags&32&&(On(x,""),a.flags&=-33);var E=Id(t);mc(t,E,x);break;case 3:case 4:var L=a.stateNode.containerInfo,V=Id(t);Ld(t,V,L);break;default:throw Error(o(161))}}catch(te){_t(t,t.return,te)}t.flags&=-3}n&4096&&(t.flags&=-4097)}function gh(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var n=t;gh(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),t=t.sibling}}function Wa(t,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)uh(t,n.alternate,n),n=n.sibling}function bo(t){for(t=t.child;t!==null;){var n=t;switch(n.tag){case 0:case 11:case 14:case 15:As(4,n,n.return),bo(n);break;case 1:Ma(n,n.return);var a=n.stateNode;typeof a.componentWillUnmount=="function"&&sh(n,n.return,a),bo(n);break;case 27:tl(n.stateNode);case 26:case 5:Ma(n,n.return),bo(n);break;case 22:n.memoizedState===null&&bo(n);break;case 30:bo(n);break;default:bo(n)}t=t.sibling}}function Xa(t,n,a){for(a=a&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var r=n.alternate,u=t,d=n,x=d.flags;switch(d.tag){case 0:case 11:case 15:Xa(u,d,a),Yr(4,d);break;case 1:if(Xa(u,d,a),r=d,u=r.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(V){_t(r,r.return,V)}if(r=d,u=r.updateQueue,u!==null){var E=r.stateNode;try{var L=u.shared.hiddenCallbacks;if(L!==null)for(u.shared.hiddenCallbacks=null,u=0;u<L.length;u++)Fm(L[u],E)}catch(V){_t(r,r.return,V)}}a&&x&64&&ah(d),Kr(d,d.return);break;case 27:lh(d);case 26:case 5:Xa(u,d,a),a&&r===null&&x&4&&oh(d),Kr(d,d.return);break;case 12:Xa(u,d,a);break;case 31:Xa(u,d,a),a&&x&4&&mh(u,d);break;case 13:Xa(u,d,a),a&&x&4&&ph(u,d);break;case 22:d.memoizedState===null&&Xa(u,d,a),Kr(d,d.return);break;case 30:break;default:Xa(u,d,a)}n=n.sibling}}function Hd(t,n){var a=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(a=t.memoizedState.cachePool.pool),t=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),t!==a&&(t!=null&&t.refCount++,a!=null&&Nr(a))}function jd(t,n){t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&Nr(t))}function da(t,n,a,r){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)yh(t,n,a,r),n=n.sibling}function yh(t,n,a,r){var u=n.flags;switch(n.tag){case 0:case 11:case 15:da(t,n,a,r),u&2048&&Yr(9,n);break;case 1:da(t,n,a,r);break;case 3:da(t,n,a,r),u&2048&&(t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&Nr(t)));break;case 12:if(u&2048){da(t,n,a,r),t=n.stateNode;try{var d=n.memoizedProps,x=d.id,E=d.onPostCommit;typeof E=="function"&&E(x,n.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(L){_t(n,n.return,L)}}else da(t,n,a,r);break;case 31:da(t,n,a,r);break;case 13:da(t,n,a,r);break;case 23:break;case 22:d=n.stateNode,x=n.alternate,n.memoizedState!==null?d._visibility&2?da(t,n,a,r):Fr(t,n):d._visibility&2?da(t,n,a,r):(d._visibility|=2,Zo(t,n,a,r,(n.subtreeFlags&10256)!==0||!1)),u&2048&&Hd(x,n);break;case 24:da(t,n,a,r),u&2048&&jd(n.alternate,n);break;default:da(t,n,a,r)}}function Zo(t,n,a,r,u){for(u=u&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var d=t,x=n,E=a,L=r,V=x.flags;switch(x.tag){case 0:case 11:case 15:Zo(d,x,E,L,u),Yr(8,x);break;case 23:break;case 22:var te=x.stateNode;x.memoizedState!==null?te._visibility&2?Zo(d,x,E,L,u):Fr(d,x):(te._visibility|=2,Zo(d,x,E,L,u)),u&&V&2048&&Hd(x.alternate,x);break;case 24:Zo(d,x,E,L,u),u&&V&2048&&jd(x.alternate,x);break;default:Zo(d,x,E,L,u)}n=n.sibling}}function Fr(t,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var a=t,r=n,u=r.flags;switch(r.tag){case 22:Fr(a,r),u&2048&&Hd(r.alternate,r);break;case 24:Fr(a,r),u&2048&&jd(r.alternate,r);break;default:Fr(a,r)}n=n.sibling}}var Wr=8192;function er(t,n,a){if(t.subtreeFlags&Wr)for(t=t.child;t!==null;)bh(t,n,a),t=t.sibling}function bh(t,n,a){switch(t.tag){case 26:er(t,n,a),t.flags&Wr&&t.memoizedState!==null&&Gb(a,ua,t.memoizedState,t.memoizedProps);break;case 5:er(t,n,a);break;case 3:case 4:var r=ua;ua=Oc(t.stateNode.containerInfo),er(t,n,a),ua=r;break;case 22:t.memoizedState===null&&(r=t.alternate,r!==null&&r.memoizedState!==null?(r=Wr,Wr=16777216,er(t,n,a),Wr=r):er(t,n,a));break;default:er(t,n,a)}}function xh(t){var n=t.alternate;if(n!==null&&(t=n.child,t!==null)){n.child=null;do n=t.sibling,t.sibling=null,t=n;while(t!==null)}}function Xr(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var r=n[a];Pn=r,Sh(r,t)}xh(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)vh(t),t=t.sibling}function vh(t){switch(t.tag){case 0:case 11:case 15:Xr(t),t.flags&2048&&As(9,t,t.return);break;case 3:Xr(t);break;case 12:Xr(t);break;case 22:var n=t.stateNode;t.memoizedState!==null&&n._visibility&2&&(t.return===null||t.return.tag!==13)?(n._visibility&=-3,hc(t)):Xr(t);break;default:Xr(t)}}function hc(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var a=0;a<n.length;a++){var r=n[a];Pn=r,Sh(r,t)}xh(t)}for(t=t.child;t!==null;){switch(n=t,n.tag){case 0:case 11:case 15:As(8,n,n.return),hc(n);break;case 22:a=n.stateNode,a._visibility&2&&(a._visibility&=-3,hc(n));break;default:hc(n)}t=t.sibling}}function Sh(t,n){for(;Pn!==null;){var a=Pn;switch(a.tag){case 0:case 11:case 15:As(8,a,n);break;case 23:case 22:if(a.memoizedState!==null&&a.memoizedState.cachePool!==null){var r=a.memoizedState.cachePool.pool;r!=null&&r.refCount++}break;case 24:Nr(a.memoizedState.cache)}if(r=a.child,r!==null)r.return=a,Pn=r;else e:for(a=t;Pn!==null;){r=Pn;var u=r.sibling,d=r.return;if(dh(r),r===a){Pn=null;break e}if(u!==null){u.return=d,Pn=u;break e}Pn=d}}}var db={getCacheForType:function(t){var n=Kn(xn),a=n.data.get(t);return a===void 0&&(a=t(),n.data.set(t,a)),a},cacheSignal:function(){return Kn(xn).controller.signal}},fb=typeof WeakMap=="function"?WeakMap:Map,bt=0,jt=null,at=null,ot=0,Et=0,ki=null,Ts=!1,tr=!1,Dd=!1,Ga=0,tn=0,Es=0,xo=0,Pd=0,Ri=0,nr=0,Gr=null,gi=null,Ud=!1,gc=0,Ah=0,yc=1/0,bc=null,_s=null,Cn=0,ws=null,ir=null,Qa=0,qd=0,zd=null,Th=null,Qr=0,$d=null;function Ni(){return(bt&2)!==0&&ot!==0?ot&-ot:P.T!==null?Xd():ni()}function Eh(){if(Ri===0)if((ot&536870912)===0||lt){var t=pn;pn<<=1,(pn&3932160)===0&&(pn=262144),Ri=t}else Ri=536870912;return t=Oi.current,t!==null&&(t.flags|=32),Ri}function yi(t,n,a){(t===jt&&(Et===2||Et===9)||t.cancelPendingCommit!==null)&&(ar(t,0),Ms(t,ot,Ri,!1)),Ai(t,a),((bt&2)===0||t!==jt)&&(t===jt&&((bt&2)===0&&(xo|=a),tn===4&&Ms(t,ot,Ri,!1)),Oa(t))}function _h(t,n,a){if((bt&6)!==0)throw Error(o(327));var r=!a&&(n&127)===0&&(n&t.expiredLanes)===0||hn(t,n),u=r?hb(t,n):Yd(t,n,!0),d=r;do{if(u===0){tr&&!r&&Ms(t,n,0,!1);break}else{if(a=t.current.alternate,d&&!mb(a)){u=Yd(t,n,!1),d=!1;continue}if(u===2){if(d=n,t.errorRecoveryDisabledLanes&d)var x=0;else x=t.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){n=x;e:{var E=t;u=Gr;var L=E.current.memoizedState.isDehydrated;if(L&&(ar(E,x).flags|=256),x=Yd(E,x,!1),x!==2){if(Dd&&!L){E.errorRecoveryDisabledLanes|=d,xo|=d,u=4;break e}d=gi,gi=u,d!==null&&(gi===null?gi=d:gi.push.apply(gi,d))}u=x}if(d=!1,u!==2)continue}}if(u===1){ar(t,0),Ms(t,n,0,!0);break}e:{switch(r=t,d=u,d){case 0:case 1:throw Error(o(345));case 4:if((n&4194048)!==n)break;case 6:Ms(r,n,Ri,!Ts);break e;case 2:gi=null;break;case 3:case 5:break;default:throw Error(o(329))}if((n&62914560)===n&&(u=gc+300-wn(),10<u)){if(Ms(r,n,Ri,!Ts),Nt(r,0,!0)!==0)break e;Qa=n,r.timeoutHandle=ng(wh.bind(null,r,a,gi,bc,Ud,n,Ri,xo,nr,Ts,d,"Throttled",-0,0),u);break e}wh(r,a,gi,bc,Ud,n,Ri,xo,nr,Ts,d,null,-0,0)}}break}while(!0);Oa(t)}function wh(t,n,a,r,u,d,x,E,L,V,te,ce,F,J){if(t.timeoutHandle=-1,ce=n.subtreeFlags,ce&8192||(ce&16785408)===16785408){ce={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:oi},bh(n,d,ce);var Ce=(d&62914560)===d?gc-wn():(d&4194048)===d?Ah-wn():0;if(Ce=Qb(ce,Ce),Ce!==null){Qa=d,t.cancelPendingCommit=Ce(Lh.bind(null,t,n,d,a,r,u,x,E,L,te,ce,null,F,J)),Ms(t,d,x,!V);return}}Lh(t,n,d,a,r,u,x,E,L)}function mb(t){for(var n=t;;){var a=n.tag;if((a===0||a===11||a===15)&&n.flags&16384&&(a=n.updateQueue,a!==null&&(a=a.stores,a!==null)))for(var r=0;r<a.length;r++){var u=a[r],d=u.getSnapshot;u=u.value;try{if(!wi(d(),u))return!1}catch{return!1}}if(a=n.child,n.subtreeFlags&16384&&a!==null)a.return=n,n=a;else{if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Ms(t,n,a,r){n&=~Pd,n&=~xo,t.suspendedLanes|=n,t.pingedLanes&=~n,r&&(t.warmLanes|=n),r=t.expirationTimes;for(var u=n;0<u;){var d=31-et(u),x=1<<d;r[d]=-1,u&=~x}a!==0&&Di(t,a,n)}function xc(){return(bt&6)===0?(Jr(0),!1):!0}function Vd(){if(at!==null){if(Et===0)var t=at.return;else t=at,Ua=co=null,od(t),Wo=null,Lr=0,t=at;for(;t!==null;)ih(t.alternate,t),t=t.return;at=null}}function ar(t,n){var a=t.timeoutHandle;a!==-1&&(t.timeoutHandle=-1,Ib(a)),a=t.cancelPendingCommit,a!==null&&(t.cancelPendingCommit=null,a()),Qa=0,Vd(),jt=t,at=a=Da(t.current,null),ot=n,Et=0,ki=null,Ts=!1,tr=hn(t,n),Dd=!1,nr=Ri=Pd=xo=Es=tn=0,gi=Gr=null,Ud=!1,(n&8)!==0&&(n|=n&32);var r=t.entangledLanes;if(r!==0)for(t=t.entanglements,r&=n;0<r;){var u=31-et(r),d=1<<u;n|=t[u],r&=~d}return Ga=n,Ul(),a}function Mh(t,n){Ge=null,P.H=zr,n===Fo||n===Wl?(n=$m(),Et=3):n===Wu?(n=$m(),Et=4):Et=n===Ad?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,ki=n,at===null&&(tn=1,lc(t,$i(n,t.current)))}function Oh(){var t=Oi.current;return t===null?!0:(ot&4194048)===ot?Fi===null:(ot&62914560)===ot||(ot&536870912)!==0?t===Fi:!1}function Ch(){var t=P.H;return P.H=zr,t===null?zr:t}function kh(){var t=P.A;return P.A=db,t}function vc(){tn=4,Ts||(ot&4194048)!==ot&&Oi.current!==null||(tr=!0),(Es&134217727)===0&&(xo&134217727)===0||jt===null||Ms(jt,ot,Ri,!1)}function Yd(t,n,a){var r=bt;bt|=2;var u=Ch(),d=kh();(jt!==t||ot!==n)&&(bc=null,ar(t,n)),n=!1;var x=tn;e:do try{if(Et!==0&&at!==null){var E=at,L=ki;switch(Et){case 8:Vd(),x=6;break e;case 3:case 2:case 9:case 6:Oi.current===null&&(n=!0);var V=Et;if(Et=0,ki=null,sr(t,E,L,V),a&&tr){x=0;break e}break;default:V=Et,Et=0,ki=null,sr(t,E,L,V)}}pb(),x=tn;break}catch(te){Mh(t,te)}while(!0);return n&&t.shellSuspendCounter++,Ua=co=null,bt=r,P.H=u,P.A=d,at===null&&(jt=null,ot=0,Ul()),x}function pb(){for(;at!==null;)Rh(at)}function hb(t,n){var a=bt;bt|=2;var r=Ch(),u=kh();jt!==t||ot!==n?(bc=null,yc=wn()+500,ar(t,n)):tr=hn(t,n);e:do try{if(Et!==0&&at!==null){n=at;var d=ki;t:switch(Et){case 1:Et=0,ki=null,sr(t,n,d,1);break;case 2:case 9:if(qm(d)){Et=0,ki=null,Nh(n);break}n=function(){Et!==2&&Et!==9||jt!==t||(Et=7),Oa(t)},d.then(n,n);break e;case 3:Et=7;break e;case 4:Et=5;break e;case 7:qm(d)?(Et=0,ki=null,Nh(n)):(Et=0,ki=null,sr(t,n,d,7));break;case 5:var x=null;switch(at.tag){case 26:x=at.memoizedState;case 5:case 27:var E=at;if(x?yg(x):E.stateNode.complete){Et=0,ki=null;var L=E.sibling;if(L!==null)at=L;else{var V=E.return;V!==null?(at=V,Sc(V)):at=null}break t}}Et=0,ki=null,sr(t,n,d,5);break;case 6:Et=0,ki=null,sr(t,n,d,6);break;case 8:Vd(),tn=6;break e;default:throw Error(o(462))}}gb();break}catch(te){Mh(t,te)}while(!0);return Ua=co=null,P.H=r,P.A=u,bt=a,at!==null?0:(jt=null,ot=0,Ul(),tn)}function gb(){for(;at!==null&&!vi();)Rh(at)}function Rh(t){var n=th(t.alternate,t,Ga);t.memoizedProps=t.pendingProps,n===null?Sc(t):at=n}function Nh(t){var n=t,a=n.alternate;switch(n.tag){case 15:case 0:n=Xp(a,n,n.pendingProps,n.type,void 0,ot);break;case 11:n=Xp(a,n,n.pendingProps,n.type.render,n.ref,ot);break;case 5:od(n);default:ih(a,n),n=at=km(n,Ga),n=th(a,n,Ga)}t.memoizedProps=t.pendingProps,n===null?Sc(t):at=n}function sr(t,n,a,r){Ua=co=null,od(n),Wo=null,Lr=0;var u=n.return;try{if(ab(t,u,n,a,ot)){tn=1,lc(t,$i(a,t.current)),at=null;return}}catch(d){if(u!==null)throw at=u,d;tn=1,lc(t,$i(a,t.current)),at=null;return}n.flags&32768?(lt||r===1?t=!0:tr||(ot&536870912)!==0?t=!1:(Ts=t=!0,(r===2||r===9||r===3||r===6)&&(r=Oi.current,r!==null&&r.tag===13&&(r.flags|=16384))),Ih(n,t)):Sc(n)}function Sc(t){var n=t;do{if((n.flags&32768)!==0){Ih(n,Ts);return}t=n.return;var a=rb(n.alternate,n,Ga);if(a!==null){at=a;return}if(n=n.sibling,n!==null){at=n;return}at=n=t}while(n!==null);tn===0&&(tn=5)}function Ih(t,n){do{var a=lb(t.alternate,t);if(a!==null){a.flags&=32767,at=a;return}if(a=t.return,a!==null&&(a.flags|=32768,a.subtreeFlags=0,a.deletions=null),!n&&(t=t.sibling,t!==null)){at=t;return}at=t=a}while(t!==null);tn=6,at=null}function Lh(t,n,a,r,u,d,x,E,L){t.cancelPendingCommit=null;do Ac();while(Cn!==0);if((bt&6)!==0)throw Error(o(327));if(n!==null){if(n===t.current)throw Error(o(177));if(d=n.lanes|n.childLanes,d|=Iu,ji(t,a,d,x,E,L),t===jt&&(at=jt=null,ot=0),ir=n,ws=t,Qa=a,qd=d,zd=u,Th=r,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,vb(Ft,function(){return Ph(),null})):(t.callbackNode=null,t.callbackPriority=0),r=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||r){r=P.T,P.T=null,u=ee.p,ee.p=2,x=bt,bt|=4;try{cb(t,n,a)}finally{bt=x,ee.p=u,P.T=r}}Cn=1,Bh(),Hh(),jh()}}function Bh(){if(Cn===1){Cn=0;var t=ws,n=ir,a=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||a){a=P.T,P.T=null;var r=ee.p;ee.p=2;var u=bt;bt|=4;try{hh(n,t);var d=af,x=Sm(t.containerInfo),E=d.focusedElem,L=d.selectionRange;if(x!==E&&E&&E.ownerDocument&&vm(E.ownerDocument.documentElement,E)){if(L!==null&&Ou(E)){var V=L.start,te=L.end;if(te===void 0&&(te=V),"selectionStart"in E)E.selectionStart=V,E.selectionEnd=Math.min(te,E.value.length);else{var ce=E.ownerDocument||document,F=ce&&ce.defaultView||window;if(F.getSelection){var J=F.getSelection(),Ce=E.textContent.length,Ue=Math.min(L.start,Ce),Rt=L.end===void 0?Ue:Math.min(L.end,Ce);!J.extend&&Ue>Rt&&(x=Rt,Rt=Ue,Ue=x);var D=xm(E,Ue),B=xm(E,Rt);if(D&&B&&(J.rangeCount!==1||J.anchorNode!==D.node||J.anchorOffset!==D.offset||J.focusNode!==B.node||J.focusOffset!==B.offset)){var $=ce.createRange();$.setStart(D.node,D.offset),J.removeAllRanges(),Ue>Rt?(J.addRange($),J.extend(B.node,B.offset)):($.setEnd(B.node,B.offset),J.addRange($))}}}}for(ce=[],J=E;J=J.parentNode;)J.nodeType===1&&ce.push({element:J,left:J.scrollLeft,top:J.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<ce.length;E++){var ie=ce[E];ie.element.scrollLeft=ie.left,ie.element.scrollTop=ie.top}}Lc=!!nf,af=nf=null}finally{bt=u,ee.p=r,P.T=a}}t.current=n,Cn=2}}function Hh(){if(Cn===2){Cn=0;var t=ws,n=ir,a=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||a){a=P.T,P.T=null;var r=ee.p;ee.p=2;var u=bt;bt|=4;try{uh(t,n.alternate,n)}finally{bt=u,ee.p=r,P.T=a}}Cn=3}}function jh(){if(Cn===4||Cn===3){Cn=0,Si();var t=ws,n=ir,a=Qa,r=Th;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?Cn=5:(Cn=0,ir=ws=null,Dh(t,t.pendingLanes));var u=t.pendingLanes;if(u===0&&(_s=null),Vs(a),n=n.stateNode,ke&&typeof ke.onCommitFiberRoot=="function")try{ke.onCommitFiberRoot(sn,n,void 0,(n.current.flags&128)===128)}catch{}if(r!==null){n=P.T,u=ee.p,ee.p=2,P.T=null;try{for(var d=t.onRecoverableError,x=0;x<r.length;x++){var E=r[x];d(E.value,{componentStack:E.stack})}}finally{P.T=n,ee.p=u}}(Qa&3)!==0&&Ac(),Oa(t),u=t.pendingLanes,(a&261930)!==0&&(u&42)!==0?t===$d?Qr++:(Qr=0,$d=t):Qr=0,Jr(0)}}function Dh(t,n){(t.pooledCacheLanes&=n)===0&&(n=t.pooledCache,n!=null&&(t.pooledCache=null,Nr(n)))}function Ac(){return Bh(),Hh(),jh(),Ph()}function Ph(){if(Cn!==5)return!1;var t=ws,n=qd;qd=0;var a=Vs(Qa),r=P.T,u=ee.p;try{ee.p=32>a?32:a,P.T=null,a=zd,zd=null;var d=ws,x=Qa;if(Cn=0,ir=ws=null,Qa=0,(bt&6)!==0)throw Error(o(331));var E=bt;if(bt|=4,vh(d.current),yh(d,d.current,x,a),bt=E,Jr(0,!1),ke&&typeof ke.onPostCommitFiberRoot=="function")try{ke.onPostCommitFiberRoot(sn,d)}catch{}return!0}finally{ee.p=u,P.T=r,Dh(t,n)}}function Uh(t,n,a){n=$i(a,n),n=Sd(t.stateNode,n,2),t=xs(t,n,2),t!==null&&(Ai(t,2),Oa(t))}function _t(t,n,a){if(t.tag===3)Uh(t,t,a);else for(;n!==null;){if(n.tag===3){Uh(n,t,a);break}else if(n.tag===1){var r=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(_s===null||!_s.has(r))){t=$i(a,t),a=qp(2),r=xs(n,a,2),r!==null&&(zp(a,r,n,t),Ai(r,2),Oa(r));break}}n=n.return}}function Kd(t,n,a){var r=t.pingCache;if(r===null){r=t.pingCache=new fb;var u=new Set;r.set(n,u)}else u=r.get(n),u===void 0&&(u=new Set,r.set(n,u));u.has(a)||(Dd=!0,u.add(a),t=yb.bind(null,t,n,a),n.then(t,t))}function yb(t,n,a){var r=t.pingCache;r!==null&&r.delete(n),t.pingedLanes|=t.suspendedLanes&a,t.warmLanes&=~a,jt===t&&(ot&a)===a&&(tn===4||tn===3&&(ot&62914560)===ot&&300>wn()-gc?(bt&2)===0&&ar(t,0):Pd|=a,nr===ot&&(nr=0)),Oa(t)}function qh(t,n){n===0&&(n=na()),t=oo(t,n),t!==null&&(Ai(t,n),Oa(t))}function bb(t){var n=t.memoizedState,a=0;n!==null&&(a=n.retryLane),qh(t,a)}function xb(t,n){var a=0;switch(t.tag){case 31:case 13:var r=t.stateNode,u=t.memoizedState;u!==null&&(a=u.retryLane);break;case 19:r=t.stateNode;break;case 22:r=t.stateNode._retryCache;break;default:throw Error(o(314))}r!==null&&r.delete(n),qh(t,a)}function vb(t,n){return an(t,n)}var Tc=null,or=null,Fd=!1,Ec=!1,Wd=!1,Os=0;function Oa(t){t!==or&&t.next===null&&(or===null?Tc=or=t:or=or.next=t),Ec=!0,Fd||(Fd=!0,Ab())}function Jr(t,n){if(!Wd&&Ec){Wd=!0;do for(var a=!1,r=Tc;r!==null;){if(t!==0){var u=r.pendingLanes;if(u===0)var d=0;else{var x=r.suspendedLanes,E=r.pingedLanes;d=(1<<31-et(42|t)+1)-1,d&=u&~(x&~E),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(a=!0,Yh(r,d))}else d=ot,d=Nt(r,r===jt?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),(d&3)===0||hn(r,d)||(a=!0,Yh(r,d));r=r.next}while(a);Wd=!1}}function Sb(){zh()}function zh(){Ec=Fd=!1;var t=0;Os!==0&&Nb()&&(t=Os);for(var n=wn(),a=null,r=Tc;r!==null;){var u=r.next,d=$h(r,n);d===0?(r.next=null,a===null?Tc=u:a.next=u,u===null&&(or=a)):(a=r,(t!==0||(d&3)!==0)&&(Ec=!0)),r=u}Cn!==0&&Cn!==5||Jr(t),Os!==0&&(Os=0)}function $h(t,n){for(var a=t.suspendedLanes,r=t.pingedLanes,u=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var x=31-et(d),E=1<<x,L=u[x];L===-1?((E&a)===0||(E&r)!==0)&&(u[x]=Bn(E,n)):L<=n&&(t.expiredLanes|=E),d&=~E}if(n=jt,a=ot,a=Nt(t,t===n?a:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),r=t.callbackNode,a===0||t===n&&(Et===2||Et===9)||t.cancelPendingCommit!==null)return r!==null&&r!==null&&Zn(r),t.callbackNode=null,t.callbackPriority=0;if((a&3)===0||hn(t,a)){if(n=a&-a,n===t.callbackPriority)return n;switch(r!==null&&Zn(r),Vs(a)){case 2:case 8:a=dn;break;case 32:a=Ft;break;case 268435456:a=fn;break;default:a=Ft}return r=Vh.bind(null,t),a=an(a,r),t.callbackPriority=n,t.callbackNode=a,n}return r!==null&&r!==null&&Zn(r),t.callbackPriority=2,t.callbackNode=null,2}function Vh(t,n){if(Cn!==0&&Cn!==5)return t.callbackNode=null,t.callbackPriority=0,null;var a=t.callbackNode;if(Ac()&&t.callbackNode!==a)return null;var r=ot;return r=Nt(t,t===jt?r:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),r===0?null:(_h(t,r,n),$h(t,wn()),t.callbackNode!=null&&t.callbackNode===a?Vh.bind(null,t):null)}function Yh(t,n){if(Ac())return null;_h(t,n,!0)}function Ab(){Lb(function(){(bt&6)!==0?an(Nn,Sb):zh()})}function Xd(){if(Os===0){var t=Yo;t===0&&(t=ta,ta<<=1,(ta&261888)===0&&(ta=256)),Os=t}return Os}function Kh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Gs(""+t)}function Fh(t,n){var a=n.ownerDocument.createElement("input");return a.name=n.name,a.value=n.value,t.id&&a.setAttribute("form",t.id),n.parentNode.insertBefore(a,n),t=new FormData(t),a.parentNode.removeChild(a),t}function Tb(t,n,a,r,u){if(n==="submit"&&a&&a.stateNode===u){var d=Kh((u[se]||null).action),x=r.submitter;x&&(n=(n=x[se]||null)?Kh(n.formAction):x.getAttribute("formAction"),n!==null&&(d=n,x=null));var E=new ra("action","action",null,r,u);t.push({event:E,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(Os!==0){var L=x?Fh(u,x):new FormData(u);hd(a,{pending:!0,data:L,method:u.method,action:d},null,L)}}else typeof d=="function"&&(E.preventDefault(),L=x?Fh(u,x):new FormData(u),hd(a,{pending:!0,data:L,method:u.method,action:d},d,L))},currentTarget:u}]})}}for(var Gd=0;Gd<Nu.length;Gd++){var Qd=Nu[Gd],Eb=Qd.toLowerCase(),_b=Qd[0].toUpperCase()+Qd.slice(1);ca(Eb,"on"+_b)}ca(Em,"onAnimationEnd"),ca(_m,"onAnimationIteration"),ca(wm,"onAnimationStart"),ca("dblclick","onDoubleClick"),ca("focusin","onFocus"),ca("focusout","onBlur"),ca(q0,"onTransitionRun"),ca(z0,"onTransitionStart"),ca($0,"onTransitionCancel"),ca(Mm,"onTransitionEnd"),ai("onMouseEnter",["mouseout","mouseover"]),ai("onMouseLeave",["mouseout","mouseover"]),ai("onPointerEnter",["pointerout","pointerover"]),ai("onPointerLeave",["pointerout","pointerover"]),Ei("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ei("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ei("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ei("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ei("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ei("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),wb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zr));function Wh(t,n){n=(n&4)!==0;for(var a=0;a<t.length;a++){var r=t[a],u=r.event;r=r.listeners;e:{var d=void 0;if(n)for(var x=r.length-1;0<=x;x--){var E=r[x],L=E.instance,V=E.currentTarget;if(E=E.listener,L!==d&&u.isPropagationStopped())break e;d=E,u.currentTarget=V;try{d(u)}catch(te){Pl(te)}u.currentTarget=null,d=L}else for(x=0;x<r.length;x++){if(E=r[x],L=E.instance,V=E.currentTarget,E=E.listener,L!==d&&u.isPropagationStopped())break e;d=E,u.currentTarget=V;try{d(u)}catch(te){Pl(te)}u.currentTarget=null,d=L}}}}function st(t,n){var a=n[we];a===void 0&&(a=n[we]=new Set);var r=t+"__bubble";a.has(r)||(Xh(n,t,2,!1),a.add(r))}function Jd(t,n,a){var r=0;n&&(r|=4),Xh(a,t,r,n)}var _c="_reactListening"+Math.random().toString(36).slice(2);function Zd(t){if(!t[_c]){t[_c]=!0,$n.forEach(function(a){a!=="selectionchange"&&(wb.has(a)||Jd(a,!1,t),Jd(a,!0,t))});var n=t.nodeType===9?t:t.ownerDocument;n===null||n[_c]||(n[_c]=!0,Jd("selectionchange",!1,n))}}function Xh(t,n,a,r){switch(Eg(n)){case 2:var u=ex;break;case 8:u=tx;break;default:u=hf}a=u.bind(null,n,a,t),u=void 0,!Lo||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),r?u!==void 0?t.addEventListener(n,a,{capture:!0,passive:u}):t.addEventListener(n,a,!0):u!==void 0?t.addEventListener(n,a,{passive:u}):t.addEventListener(n,a,!1)}function ef(t,n,a,r,u){var d=r;if((n&1)===0&&(n&2)===0&&r!==null)e:for(;;){if(r===null)return;var x=r.tag;if(x===3||x===4){var E=r.stateNode.containerInfo;if(E===u)break;if(x===4)for(x=r.return;x!==null;){var L=x.tag;if((L===3||L===4)&&x.stateNode.containerInfo===u)return;x=x.return}for(;E!==null;){if(x=yt(E),x===null)return;if(L=x.tag,L===5||L===6||L===26||L===27){r=d=x;continue e}E=E.parentNode}}r=r.return}xr(function(){var V=d,te=br(a),ce=[];e:{var F=Om.get(t);if(F!==void 0){var J=ra,Ce=t;switch(t){case"keypress":if(Ea(a)===0)break e;case"keydown":case"keyup":J=wr;break;case"focusin":Ce="focus",J=Ar;break;case"focusout":Ce="blur",J=Ar;break;case"beforeblur":case"afterblur":J=Ar;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":J=Ll;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":J=Bo;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":J=T;break;case Em:case _m:case wm:J=Ho;break;case Mm:J=H;break;case"scroll":case"scrollend":J=eo;break;case"wheel":J=de;break;case"copy":case"cut":case"paste":J=Tr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":J=fs;break;case"toggle":case"beforetoggle":J=ve}var Ue=(n&4)!==0,Rt=!Ue&&(t==="scroll"||t==="scrollend"),D=Ue?F!==null?F+"Capture":null:F;Ue=[];for(var B=V,$;B!==null;){var ie=B;if($=ie.stateNode,ie=ie.tag,ie!==5&&ie!==26&&ie!==27||$===null||D===null||(ie=Qs(B,D),ie!=null&&Ue.push(el(B,ie,$))),Rt)break;B=B.return}0<Ue.length&&(F=new J(F,Ce,null,a,te),ce.push({event:F,listeners:Ue}))}}if((n&7)===0){e:{if(F=t==="mouseover"||t==="pointerover",J=t==="mouseout"||t==="pointerout",F&&a!==yr&&(Ce=a.relatedTarget||a.fromElement)&&(yt(Ce)||Ce[fe]))break e;if((J||F)&&(F=te.window===te?te:(F=te.ownerDocument)?F.defaultView||F.parentWindow:window,J?(Ce=a.relatedTarget||a.toElement,J=V,Ce=Ce?yt(Ce):null,Ce!==null&&(Rt=l(Ce),Ue=Ce.tag,Ce!==Rt||Ue!==5&&Ue!==27&&Ue!==6)&&(Ce=null)):(J=null,Ce=V),J!==Ce)){if(Ue=Ll,ie="onMouseLeave",D="onMouseEnter",B="mouse",(t==="pointerout"||t==="pointerover")&&(Ue=fs,ie="onPointerLeave",D="onPointerEnter",B="pointer"),Rt=J==null?F:Mn(J),$=Ce==null?F:Mn(Ce),F=new Ue(ie,B+"leave",J,a,te),F.target=Rt,F.relatedTarget=$,ie=null,yt(te)===V&&(Ue=new Ue(D,B+"enter",Ce,a,te),Ue.target=$,Ue.relatedTarget=Rt,ie=Ue),Rt=ie,J&&Ce)t:{for(Ue=Mb,D=J,B=Ce,$=0,ie=D;ie;ie=Ue(ie))$++;ie=0;for(var Pe=B;Pe;Pe=Ue(Pe))ie++;for(;0<$-ie;)D=Ue(D),$--;for(;0<ie-$;)B=Ue(B),ie--;for(;$--;){if(D===B||B!==null&&D===B.alternate){Ue=D;break t}D=Ue(D),B=Ue(B)}Ue=null}else Ue=null;J!==null&&Gh(ce,F,J,Ue,!1),Ce!==null&&Rt!==null&&Gh(ce,Rt,Ce,Ue,!0)}}e:{if(F=V?Mn(V):window,J=F.nodeName&&F.nodeName.toLowerCase(),J==="select"||J==="input"&&F.type==="file")var ht=Ht;else if(Zt(F))if(Wt)ht=Dl;else{ht=jl;var Be=ja}else J=F.nodeName,!J||J.toLowerCase()!=="input"||F.type!=="checkbox"&&F.type!=="radio"?V&&ls(V.elementType)&&(ht=Ht):ht=Mr;if(ht&&(ht=ht(t,V))){Ot(ce,ht,a,te);break e}Be&&Be(t,F,V),t==="focusout"&&V&&F.type==="number"&&V.memoizedProps.value!=null&&Ia(F,"number",F.value)}switch(Be=V?Mn(V):window,t){case"focusin":(Zt(Be)||Be.contentEditable==="true")&&(jo=Be,Cu=V,Cr=null);break;case"focusout":Cr=Cu=jo=null;break;case"mousedown":ku=!0;break;case"contextmenu":case"mouseup":case"dragend":ku=!1,Am(ce,a,te);break;case"selectionchange":if(U0)break;case"keydown":case"keyup":Am(ce,a,te)}var Je;if(Me)e:{switch(t){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else it?Xe(t,a)&&(rt="onCompositionEnd"):t==="keydown"&&a.keyCode===229&&(rt="onCompositionStart");rt&&(je&&a.locale!=="ko"&&(it||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&it&&(Je=Js()):(Ui=te,Ta="value"in Ui?Ui.value:Ui.textContent,it=!0)),Be=wc(V,rt),0<Be.length&&(rt=new io(rt,t,null,a,te),ce.push({event:rt,listeners:Be}),Je?rt.data=Je:(Je=We(a),Je!==null&&(rt.data=Je)))),(Je=Ae?Qe(t,a):qt(t,a))&&(rt=wc(V,"onBeforeInput"),0<rt.length&&(Be=new io("onBeforeInput","beforeinput",null,a,te),ce.push({event:Be,listeners:rt}),Be.data=Je)),Tb(ce,t,V,a,te)}Wh(ce,n)})}function el(t,n,a){return{instance:t,listener:n,currentTarget:a}}function wc(t,n){for(var a=n+"Capture",r=[];t!==null;){var u=t,d=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||d===null||(u=Qs(t,a),u!=null&&r.unshift(el(t,u,d)),u=Qs(t,n),u!=null&&r.push(el(t,u,d))),t.tag===3)return r;t=t.return}return[]}function Mb(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Gh(t,n,a,r,u){for(var d=n._reactName,x=[];a!==null&&a!==r;){var E=a,L=E.alternate,V=E.stateNode;if(E=E.tag,L!==null&&L===r)break;E!==5&&E!==26&&E!==27||V===null||(L=V,u?(V=Qs(a,d),V!=null&&x.unshift(el(a,V,L))):u||(V=Qs(a,d),V!=null&&x.push(el(a,V,L)))),a=a.return}x.length!==0&&t.push({event:n,listeners:x})}var Ob=/\r\n?/g,Cb=/\u0000|\uFFFD/g;function Qh(t){return(typeof t=="string"?t:""+t).replace(Ob,`
`).replace(Cb,"")}function Jh(t,n){return n=Qh(n),Qh(t)===n}function kt(t,n,a,r,u,d){switch(a){case"children":typeof r=="string"?n==="body"||n==="textarea"&&r===""||On(t,r):(typeof r=="number"||typeof r=="bigint")&&n!=="body"&&On(t,""+r);break;case"className":jn(t,"class",r);break;case"tabIndex":jn(t,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":jn(t,a,r);break;case"style":rs(t,r,d);break;case"data":if(n!=="object"){jn(t,"data",r);break}case"src":case"href":if(r===""&&(n!=="a"||a!=="href")){t.removeAttribute(a);break}if(r==null||typeof r=="function"||typeof r=="symbol"||typeof r=="boolean"){t.removeAttribute(a);break}r=Gs(""+r),t.setAttribute(a,r);break;case"action":case"formAction":if(typeof r=="function"){t.setAttribute(a,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(a==="formAction"?(n!=="input"&&kt(t,n,"name",u.name,u,null),kt(t,n,"formEncType",u.formEncType,u,null),kt(t,n,"formMethod",u.formMethod,u,null),kt(t,n,"formTarget",u.formTarget,u,null)):(kt(t,n,"encType",u.encType,u,null),kt(t,n,"method",u.method,u,null),kt(t,n,"target",u.target,u,null)));if(r==null||typeof r=="symbol"||typeof r=="boolean"){t.removeAttribute(a);break}r=Gs(""+r),t.setAttribute(a,r);break;case"onClick":r!=null&&(t.onclick=oi);break;case"onScroll":r!=null&&st("scroll",t);break;case"onScrollEnd":r!=null&&st("scrollend",t);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(o(61));if(a=r.__html,a!=null){if(u.children!=null)throw Error(o(60));t.innerHTML=a}}break;case"multiple":t.multiple=r&&typeof r!="function"&&typeof r!="symbol";break;case"muted":t.muted=r&&typeof r!="function"&&typeof r!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(r==null||typeof r=="function"||typeof r=="boolean"||typeof r=="symbol"){t.removeAttribute("xlink:href");break}a=Gs(""+r),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",a);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":r!=null&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(a,""+r):t.removeAttribute(a);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(a,""):t.removeAttribute(a);break;case"capture":case"download":r===!0?t.setAttribute(a,""):r!==!1&&r!=null&&typeof r!="function"&&typeof r!="symbol"?t.setAttribute(a,r):t.removeAttribute(a);break;case"cols":case"rows":case"size":case"span":r!=null&&typeof r!="function"&&typeof r!="symbol"&&!isNaN(r)&&1<=r?t.setAttribute(a,r):t.removeAttribute(a);break;case"rowSpan":case"start":r==null||typeof r=="function"||typeof r=="symbol"||isNaN(r)?t.removeAttribute(a):t.setAttribute(a,r);break;case"popover":st("beforetoggle",t),st("toggle",t),yn(t,"popover",r);break;case"xlinkActuate":Gn(t,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":Gn(t,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":Gn(t,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":Gn(t,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":Gn(t,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":Gn(t,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":Gn(t,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":Gn(t,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":Gn(t,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":yn(t,"is",r);break;case"innerText":case"textContent":break;default:(!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(a=No.get(a)||a,yn(t,a,r))}}function tf(t,n,a,r,u,d){switch(a){case"style":rs(t,r,d);break;case"dangerouslySetInnerHTML":if(r!=null){if(typeof r!="object"||!("__html"in r))throw Error(o(61));if(a=r.__html,a!=null){if(u.children!=null)throw Error(o(60));t.innerHTML=a}}break;case"children":typeof r=="string"?On(t,r):(typeof r=="number"||typeof r=="bigint")&&On(t,""+r);break;case"onScroll":r!=null&&st("scroll",t);break;case"onScrollEnd":r!=null&&st("scrollend",t);break;case"onClick":r!=null&&(t.onclick=oi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!va.hasOwnProperty(a))e:{if(a[0]==="o"&&a[1]==="n"&&(u=a.endsWith("Capture"),n=a.slice(2,u?a.length-7:void 0),d=t[se]||null,d=d!=null?d[a]:null,typeof d=="function"&&t.removeEventListener(n,d,u),typeof r=="function")){typeof d!="function"&&d!==null&&(a in t?t[a]=null:t.hasAttribute(a)&&t.removeAttribute(a)),t.addEventListener(n,r,u);break e}a in t?t[a]=r:r===!0?t.setAttribute(a,""):yn(t,a,r)}}}function Wn(t,n,a){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":st("error",t),st("load",t);var r=!1,u=!1,d;for(d in a)if(a.hasOwnProperty(d)){var x=a[d];if(x!=null)switch(d){case"src":r=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:kt(t,n,d,x,a,null)}}u&&kt(t,n,"srcSet",a.srcSet,a,null),r&&kt(t,n,"src",a.src,a,null);return;case"input":st("invalid",t);var E=d=x=u=null,L=null,V=null;for(r in a)if(a.hasOwnProperty(r)){var te=a[r];if(te!=null)switch(r){case"name":u=te;break;case"type":x=te;break;case"checked":L=te;break;case"defaultChecked":V=te;break;case"value":d=te;break;case"defaultValue":E=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(o(137,n));break;default:kt(t,n,r,te,a,null)}}Na(t,d,E,L,V,x,u,!1);return;case"select":st("invalid",t),r=x=d=null;for(u in a)if(a.hasOwnProperty(u)&&(E=a[u],E!=null))switch(u){case"value":d=E;break;case"defaultValue":x=E;break;case"multiple":r=E;default:kt(t,n,u,E,a,null)}n=d,a=x,t.multiple=!!r,n!=null?Pi(t,!!r,n,!1):a!=null&&Pi(t,!!r,a,!0);return;case"textarea":st("invalid",t),d=u=r=null;for(x in a)if(a.hasOwnProperty(x)&&(E=a[x],E!=null))switch(x){case"value":r=E;break;case"defaultValue":u=E;break;case"children":d=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(o(91));break;default:kt(t,n,x,E,a,null)}Ws(t,r,u,d);return;case"option":for(L in a)a.hasOwnProperty(L)&&(r=a[L],r!=null)&&(L==="selected"?t.selected=r&&typeof r!="function"&&typeof r!="symbol":kt(t,n,L,r,a,null));return;case"dialog":st("beforetoggle",t),st("toggle",t),st("cancel",t),st("close",t);break;case"iframe":case"object":st("load",t);break;case"video":case"audio":for(r=0;r<Zr.length;r++)st(Zr[r],t);break;case"image":st("error",t),st("load",t);break;case"details":st("toggle",t);break;case"embed":case"source":case"link":st("error",t),st("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(V in a)if(a.hasOwnProperty(V)&&(r=a[V],r!=null))switch(V){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:kt(t,n,V,r,a,null)}return;default:if(ls(n)){for(te in a)a.hasOwnProperty(te)&&(r=a[te],r!==void 0&&tf(t,n,te,r,a,void 0));return}}for(E in a)a.hasOwnProperty(E)&&(r=a[E],r!=null&&kt(t,n,E,r,a,null))}function kb(t,n,a,r){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,d=null,x=null,E=null,L=null,V=null,te=null;for(J in a){var ce=a[J];if(a.hasOwnProperty(J)&&ce!=null)switch(J){case"checked":break;case"value":break;case"defaultValue":L=ce;default:r.hasOwnProperty(J)||kt(t,n,J,null,r,ce)}}for(var F in r){var J=r[F];if(ce=a[F],r.hasOwnProperty(F)&&(J!=null||ce!=null))switch(F){case"type":d=J;break;case"name":u=J;break;case"checked":V=J;break;case"defaultChecked":te=J;break;case"value":x=J;break;case"defaultValue":E=J;break;case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(o(137,n));break;default:J!==ce&&kt(t,n,F,J,r,ce)}}Aa(t,x,E,L,V,te,d,u);return;case"select":J=x=E=F=null;for(d in a)if(L=a[d],a.hasOwnProperty(d)&&L!=null)switch(d){case"value":break;case"multiple":J=L;default:r.hasOwnProperty(d)||kt(t,n,d,null,r,L)}for(u in r)if(d=r[u],L=a[u],r.hasOwnProperty(u)&&(d!=null||L!=null))switch(u){case"value":F=d;break;case"defaultValue":E=d;break;case"multiple":x=d;default:d!==L&&kt(t,n,u,d,r,L)}n=E,a=x,r=J,F!=null?Pi(t,!!a,F,!1):!!r!=!!a&&(n!=null?Pi(t,!!a,n,!0):Pi(t,!!a,a?[]:"",!1));return;case"textarea":J=F=null;for(E in a)if(u=a[E],a.hasOwnProperty(E)&&u!=null&&!r.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:kt(t,n,E,null,r,u)}for(x in r)if(u=r[x],d=a[x],r.hasOwnProperty(x)&&(u!=null||d!=null))switch(x){case"value":F=u;break;case"defaultValue":J=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(o(91));break;default:u!==d&&kt(t,n,x,u,r,d)}Fs(t,F,J);return;case"option":for(var Ce in a)F=a[Ce],a.hasOwnProperty(Ce)&&F!=null&&!r.hasOwnProperty(Ce)&&(Ce==="selected"?t.selected=!1:kt(t,n,Ce,null,r,F));for(L in r)F=r[L],J=a[L],r.hasOwnProperty(L)&&F!==J&&(F!=null||J!=null)&&(L==="selected"?t.selected=F&&typeof F!="function"&&typeof F!="symbol":kt(t,n,L,F,r,J));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ue in a)F=a[Ue],a.hasOwnProperty(Ue)&&F!=null&&!r.hasOwnProperty(Ue)&&kt(t,n,Ue,null,r,F);for(V in r)if(F=r[V],J=a[V],r.hasOwnProperty(V)&&F!==J&&(F!=null||J!=null))switch(V){case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(o(137,n));break;default:kt(t,n,V,F,r,J)}return;default:if(ls(n)){for(var Rt in a)F=a[Rt],a.hasOwnProperty(Rt)&&F!==void 0&&!r.hasOwnProperty(Rt)&&tf(t,n,Rt,void 0,r,F);for(te in r)F=r[te],J=a[te],!r.hasOwnProperty(te)||F===J||F===void 0&&J===void 0||tf(t,n,te,F,r,J);return}}for(var D in a)F=a[D],a.hasOwnProperty(D)&&F!=null&&!r.hasOwnProperty(D)&&kt(t,n,D,null,r,F);for(ce in r)F=r[ce],J=a[ce],!r.hasOwnProperty(ce)||F===J||F==null&&J==null||kt(t,n,ce,F,r,J)}function Zh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Rb(){if(typeof performance.getEntriesByType=="function"){for(var t=0,n=0,a=performance.getEntriesByType("resource"),r=0;r<a.length;r++){var u=a[r],d=u.transferSize,x=u.initiatorType,E=u.duration;if(d&&E&&Zh(x)){for(x=0,E=u.responseEnd,r+=1;r<a.length;r++){var L=a[r],V=L.startTime;if(V>E)break;var te=L.transferSize,ce=L.initiatorType;te&&Zh(ce)&&(L=L.responseEnd,x+=te*(L<E?1:(E-V)/(L-V)))}if(--r,n+=8*(d+x)/(u.duration/1e3),t++,10<t)break}}if(0<t)return n/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var nf=null,af=null;function Mc(t){return t.nodeType===9?t:t.ownerDocument}function eg(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function tg(t,n){if(t===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&n==="foreignObject"?0:t}function sf(t,n){return t==="textarea"||t==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var of=null;function Nb(){var t=window.event;return t&&t.type==="popstate"?t===of?!1:(of=t,!0):(of=null,!1)}var ng=typeof setTimeout=="function"?setTimeout:void 0,Ib=typeof clearTimeout=="function"?clearTimeout:void 0,ig=typeof Promise=="function"?Promise:void 0,Lb=typeof queueMicrotask=="function"?queueMicrotask:typeof ig<"u"?function(t){return ig.resolve(null).then(t).catch(Bb)}:ng;function Bb(t){setTimeout(function(){throw t})}function Cs(t){return t==="head"}function ag(t,n){var a=n,r=0;do{var u=a.nextSibling;if(t.removeChild(a),u&&u.nodeType===8)if(a=u.data,a==="/$"||a==="/&"){if(r===0){t.removeChild(u),ur(n);return}r--}else if(a==="$"||a==="$?"||a==="$~"||a==="$!"||a==="&")r++;else if(a==="html")tl(t.ownerDocument.documentElement);else if(a==="head"){a=t.ownerDocument.head,tl(a);for(var d=a.firstChild;d;){var x=d.nextSibling,E=d.nodeName;d[pt]||E==="SCRIPT"||E==="STYLE"||E==="LINK"&&d.rel.toLowerCase()==="stylesheet"||a.removeChild(d),d=x}}else a==="body"&&tl(t.ownerDocument.body);a=u}while(a);ur(n)}function sg(t,n){var a=t;t=0;do{var r=a.nextSibling;if(a.nodeType===1?n?(a._stashedDisplay=a.style.display,a.style.display="none"):(a.style.display=a._stashedDisplay||"",a.getAttribute("style")===""&&a.removeAttribute("style")):a.nodeType===3&&(n?(a._stashedText=a.nodeValue,a.nodeValue=""):a.nodeValue=a._stashedText||""),r&&r.nodeType===8)if(a=r.data,a==="/$"){if(t===0)break;t--}else a!=="$"&&a!=="$?"&&a!=="$~"&&a!=="$!"||t++;a=r}while(a)}function rf(t){var n=t.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var a=n;switch(n=n.nextSibling,a.nodeName){case"HTML":case"HEAD":case"BODY":rf(a),It(a);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(a.rel.toLowerCase()==="stylesheet")continue}t.removeChild(a)}}function Hb(t,n,a,r){for(;t.nodeType===1;){var u=a;if(t.nodeName.toLowerCase()!==n.toLowerCase()){if(!r&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(r){if(!t[pt])switch(n){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==u.rel||t.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||t.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||t.getAttribute("title")!==(u.title==null?null:u.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(u.src==null?null:u.src)||t.getAttribute("type")!==(u.type==null?null:u.type)||t.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(n==="input"&&t.type==="hidden"){var d=u.name==null?null:""+u.name;if(u.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=Wi(t.nextSibling),t===null)break}return null}function jb(t,n,a){if(n==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!a||(t=Wi(t.nextSibling),t===null))return null;return t}function og(t,n){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=Wi(t.nextSibling),t===null))return null;return t}function lf(t){return t.data==="$?"||t.data==="$~"}function cf(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function Db(t,n){var a=t.ownerDocument;if(t.data==="$~")t._reactRetry=n;else if(t.data!=="$?"||a.readyState!=="loading")n();else{var r=function(){n(),a.removeEventListener("DOMContentLoaded",r)};a.addEventListener("DOMContentLoaded",r),t._reactRetry=r}}function Wi(t){for(;t!=null;t=t.nextSibling){var n=t.nodeType;if(n===1||n===3)break;if(n===8){if(n=t.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return t}var uf=null;function rg(t){t=t.nextSibling;for(var n=0;t;){if(t.nodeType===8){var a=t.data;if(a==="/$"||a==="/&"){if(n===0)return Wi(t.nextSibling);n--}else a!=="$"&&a!=="$!"&&a!=="$?"&&a!=="$~"&&a!=="&"||n++}t=t.nextSibling}return null}function lg(t){t=t.previousSibling;for(var n=0;t;){if(t.nodeType===8){var a=t.data;if(a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"){if(n===0)return t;n--}else a!=="/$"&&a!=="/&"||n++}t=t.previousSibling}return null}function cg(t,n,a){switch(n=Mc(a),t){case"html":if(t=n.documentElement,!t)throw Error(o(452));return t;case"head":if(t=n.head,!t)throw Error(o(453));return t;case"body":if(t=n.body,!t)throw Error(o(454));return t;default:throw Error(o(451))}}function tl(t){for(var n=t.attributes;n.length;)t.removeAttributeNode(n[0]);It(t)}var Xi=new Map,ug=new Set;function Oc(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var Ja=ee.d;ee.d={f:Pb,r:Ub,D:qb,C:zb,L:$b,m:Vb,X:Kb,S:Yb,M:Fb};function Pb(){var t=Ja.f(),n=xc();return t||n}function Ub(t){var n=Lt(t);n!==null&&n.tag===5&&n.type==="form"?Mp(n):Ja.r(t)}var rr=typeof document>"u"?null:document;function dg(t,n,a){var r=rr;if(r&&typeof n=="string"&&n){var u=Vn(n);u='link[rel="'+t+'"][href="'+u+'"]',typeof a=="string"&&(u+='[crossorigin="'+a+'"]'),ug.has(u)||(ug.add(u),t={rel:t,crossOrigin:a,href:n},r.querySelector(u)===null&&(n=r.createElement("link"),Wn(n,"link",t),Pt(n),r.head.appendChild(n)))}}function qb(t){Ja.D(t),dg("dns-prefetch",t,null)}function zb(t,n){Ja.C(t,n),dg("preconnect",t,n)}function $b(t,n,a){Ja.L(t,n,a);var r=rr;if(r&&t&&n){var u='link[rel="preload"][as="'+Vn(n)+'"]';n==="image"&&a&&a.imageSrcSet?(u+='[imagesrcset="'+Vn(a.imageSrcSet)+'"]',typeof a.imageSizes=="string"&&(u+='[imagesizes="'+Vn(a.imageSizes)+'"]')):u+='[href="'+Vn(t)+'"]';var d=u;switch(n){case"style":d=lr(t);break;case"script":d=cr(t)}Xi.has(d)||(t=v({rel:"preload",href:n==="image"&&a&&a.imageSrcSet?void 0:t,as:n},a),Xi.set(d,t),r.querySelector(u)!==null||n==="style"&&r.querySelector(nl(d))||n==="script"&&r.querySelector(il(d))||(n=r.createElement("link"),Wn(n,"link",t),Pt(n),r.head.appendChild(n)))}}function Vb(t,n){Ja.m(t,n);var a=rr;if(a&&t){var r=n&&typeof n.as=="string"?n.as:"script",u='link[rel="modulepreload"][as="'+Vn(r)+'"][href="'+Vn(t)+'"]',d=u;switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=cr(t)}if(!Xi.has(d)&&(t=v({rel:"modulepreload",href:t},n),Xi.set(d,t),a.querySelector(u)===null)){switch(r){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(a.querySelector(il(d)))return}r=a.createElement("link"),Wn(r,"link",t),Pt(r),a.head.appendChild(r)}}}function Yb(t,n,a){Ja.S(t,n,a);var r=rr;if(r&&t){var u=Ti(r).hoistableStyles,d=lr(t);n=n||"default";var x=u.get(d);if(!x){var E={loading:0,preload:null};if(x=r.querySelector(nl(d)))E.loading=5;else{t=v({rel:"stylesheet",href:t,"data-precedence":n},a),(a=Xi.get(d))&&df(t,a);var L=x=r.createElement("link");Pt(L),Wn(L,"link",t),L._p=new Promise(function(V,te){L.onload=V,L.onerror=te}),L.addEventListener("load",function(){E.loading|=1}),L.addEventListener("error",function(){E.loading|=2}),E.loading|=4,Cc(x,n,r)}x={type:"stylesheet",instance:x,count:1,state:E},u.set(d,x)}}}function Kb(t,n){Ja.X(t,n);var a=rr;if(a&&t){var r=Ti(a).hoistableScripts,u=cr(t),d=r.get(u);d||(d=a.querySelector(il(u)),d||(t=v({src:t,async:!0},n),(n=Xi.get(u))&&ff(t,n),d=a.createElement("script"),Pt(d),Wn(d,"link",t),a.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},r.set(u,d))}}function Fb(t,n){Ja.M(t,n);var a=rr;if(a&&t){var r=Ti(a).hoistableScripts,u=cr(t),d=r.get(u);d||(d=a.querySelector(il(u)),d||(t=v({src:t,async:!0,type:"module"},n),(n=Xi.get(u))&&ff(t,n),d=a.createElement("script"),Pt(d),Wn(d,"link",t),a.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},r.set(u,d))}}function fg(t,n,a,r){var u=(u=Ie.current)?Oc(u):null;if(!u)throw Error(o(446));switch(t){case"meta":case"title":return null;case"style":return typeof a.precedence=="string"&&typeof a.href=="string"?(n=lr(a.href),a=Ti(u).hoistableStyles,r=a.get(n),r||(r={type:"style",instance:null,count:0,state:null},a.set(n,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if(a.rel==="stylesheet"&&typeof a.href=="string"&&typeof a.precedence=="string"){t=lr(a.href);var d=Ti(u).hoistableStyles,x=d.get(t);if(x||(u=u.ownerDocument||u,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,x),(d=u.querySelector(nl(t)))&&!d._p&&(x.instance=d,x.state.loading=5),Xi.has(t)||(a={rel:"preload",as:"style",href:a.href,crossOrigin:a.crossOrigin,integrity:a.integrity,media:a.media,hrefLang:a.hrefLang,referrerPolicy:a.referrerPolicy},Xi.set(t,a),d||Wb(u,t,a,x.state))),n&&r===null)throw Error(o(528,""));return x}if(n&&r!==null)throw Error(o(529,""));return null;case"script":return n=a.async,a=a.src,typeof a=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=cr(a),a=Ti(u).hoistableScripts,r=a.get(n),r||(r={type:"script",instance:null,count:0,state:null},a.set(n,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,t))}}function lr(t){return'href="'+Vn(t)+'"'}function nl(t){return'link[rel="stylesheet"]['+t+"]"}function mg(t){return v({},t,{"data-precedence":t.precedence,precedence:null})}function Wb(t,n,a,r){t.querySelector('link[rel="preload"][as="style"]['+n+"]")?r.loading=1:(n=t.createElement("link"),r.preload=n,n.addEventListener("load",function(){return r.loading|=1}),n.addEventListener("error",function(){return r.loading|=2}),Wn(n,"link",a),Pt(n),t.head.appendChild(n))}function cr(t){return'[src="'+Vn(t)+'"]'}function il(t){return"script[async]"+t}function pg(t,n,a){if(n.count++,n.instance===null)switch(n.type){case"style":var r=t.querySelector('style[data-href~="'+Vn(a.href)+'"]');if(r)return n.instance=r,Pt(r),r;var u=v({},a,{"data-href":a.href,"data-precedence":a.precedence,href:null,precedence:null});return r=(t.ownerDocument||t).createElement("style"),Pt(r),Wn(r,"style",u),Cc(r,a.precedence,t),n.instance=r;case"stylesheet":u=lr(a.href);var d=t.querySelector(nl(u));if(d)return n.state.loading|=4,n.instance=d,Pt(d),d;r=mg(a),(u=Xi.get(u))&&df(r,u),d=(t.ownerDocument||t).createElement("link"),Pt(d);var x=d;return x._p=new Promise(function(E,L){x.onload=E,x.onerror=L}),Wn(d,"link",r),n.state.loading|=4,Cc(d,a.precedence,t),n.instance=d;case"script":return d=cr(a.src),(u=t.querySelector(il(d)))?(n.instance=u,Pt(u),u):(r=a,(u=Xi.get(d))&&(r=v({},a),ff(r,u)),t=t.ownerDocument||t,u=t.createElement("script"),Pt(u),Wn(u,"link",r),t.head.appendChild(u),n.instance=u);case"void":return null;default:throw Error(o(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(r=n.instance,n.state.loading|=4,Cc(r,a.precedence,t));return n.instance}function Cc(t,n,a){for(var r=a.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=r.length?r[r.length-1]:null,d=u,x=0;x<r.length;x++){var E=r[x];if(E.dataset.precedence===n)d=E;else if(d!==u)break}d?d.parentNode.insertBefore(t,d.nextSibling):(n=a.nodeType===9?a.head:a,n.insertBefore(t,n.firstChild))}function df(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.title==null&&(t.title=n.title)}function ff(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.integrity==null&&(t.integrity=n.integrity)}var kc=null;function hg(t,n,a){if(kc===null){var r=new Map,u=kc=new Map;u.set(a,r)}else u=kc,r=u.get(a),r||(r=new Map,u.set(a,r));if(r.has(t))return r;for(r.set(t,null),a=a.getElementsByTagName(t),u=0;u<a.length;u++){var d=a[u];if(!(d[pt]||d[X]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var x=d.getAttribute(n)||"";x=t+x;var E=r.get(x);E?E.push(d):r.set(x,[d])}}return r}function gg(t,n,a){t=t.ownerDocument||t,t.head.insertBefore(a,n==="title"?t.querySelector("head > title"):null)}function Xb(t,n,a){if(a===1||n.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;return n.rel==="stylesheet"?(t=n.disabled,typeof n.precedence=="string"&&t==null):!0;case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function yg(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function Gb(t,n,a,r){if(a.type==="stylesheet"&&(typeof r.media!="string"||matchMedia(r.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var u=lr(r.href),d=n.querySelector(nl(u));if(d){n=d._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(t.count++,t=Rc.bind(t),n.then(t,t)),a.state.loading|=4,a.instance=d,Pt(d);return}d=n.ownerDocument||n,r=mg(r),(u=Xi.get(u))&&df(r,u),d=d.createElement("link"),Pt(d);var x=d;x._p=new Promise(function(E,L){x.onload=E,x.onerror=L}),Wn(d,"link",r),a.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(a,n),(n=a.state.preload)&&(a.state.loading&3)===0&&(t.count++,a=Rc.bind(t),n.addEventListener("load",a),n.addEventListener("error",a))}}var mf=0;function Qb(t,n){return t.stylesheets&&t.count===0&&Ic(t,t.stylesheets),0<t.count||0<t.imgCount?function(a){var r=setTimeout(function(){if(t.stylesheets&&Ic(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+n);0<t.imgBytes&&mf===0&&(mf=62500*Rb());var u=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&Ic(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>mf?50:800)+n);return t.unsuspend=a,function(){t.unsuspend=null,clearTimeout(r),clearTimeout(u)}}:null}function Rc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Ic(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var Nc=null;function Ic(t,n){t.stylesheets=null,t.unsuspend!==null&&(t.count++,Nc=new Map,n.forEach(Jb,t),Nc=null,Rc.call(t))}function Jb(t,n){if(!(n.state.loading&4)){var a=Nc.get(t);if(a)var r=a.get(null);else{a=new Map,Nc.set(t,a);for(var u=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<u.length;d++){var x=u[d];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(a.set(x.dataset.precedence,x),r=x)}r&&a.set(null,r)}u=n.instance,x=u.getAttribute("data-precedence"),d=a.get(x)||r,d===r&&a.set(null,u),a.set(x,u),this.count++,r=Rc.bind(this),u.addEventListener("load",r),u.addEventListener("error",r),d?d.parentNode.insertBefore(u,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(u,t.firstChild)),n.state.loading|=4}}var al={$$typeof:w,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function Zb(t,n,a,r,u,d,x,E,L){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ba(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ba(0),this.hiddenUpdates=ba(null),this.identifierPrefix=r,this.onUncaughtError=u,this.onCaughtError=d,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function bg(t,n,a,r,u,d,x,E,L,V,te,ce){return t=new Zb(t,n,a,x,L,V,te,ce,E),n=1,d===!0&&(n|=24),d=Mi(3,null,null,n),t.current=d,d.stateNode=t,n=Yu(),n.refCount++,t.pooledCache=n,n.refCount++,d.memoizedState={element:r,isDehydrated:a,cache:n},Xu(d),t}function xg(t){return t?(t=Uo,t):Uo}function vg(t,n,a,r,u,d){u=xg(u),r.context===null?r.context=u:r.pendingContext=u,r=bs(n),r.payload={element:a},d=d===void 0?null:d,d!==null&&(r.callback=d),a=xs(t,r,n),a!==null&&(yi(a,t,n),Hr(a,t,n))}function Sg(t,n){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var a=t.retryLane;t.retryLane=a!==0&&a<n?a:n}}function pf(t,n){Sg(t,n),(t=t.alternate)&&Sg(t,n)}function Ag(t){if(t.tag===13||t.tag===31){var n=oo(t,67108864);n!==null&&yi(n,t,67108864),pf(t,67108864)}}function Tg(t){if(t.tag===13||t.tag===31){var n=Ni();n=$s(n);var a=oo(t,n);a!==null&&yi(a,t,n),pf(t,n)}}var Lc=!0;function ex(t,n,a,r){var u=P.T;P.T=null;var d=ee.p;try{ee.p=2,hf(t,n,a,r)}finally{ee.p=d,P.T=u}}function tx(t,n,a,r){var u=P.T;P.T=null;var d=ee.p;try{ee.p=8,hf(t,n,a,r)}finally{ee.p=d,P.T=u}}function hf(t,n,a,r){if(Lc){var u=gf(r);if(u===null)ef(t,n,r,Bc,a),_g(t,r);else if(ix(u,t,n,a,r))r.stopPropagation();else if(_g(t,r),n&4&&-1<nx.indexOf(t)){for(;u!==null;){var d=Lt(u);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var x=Ln(d.pendingLanes);if(x!==0){var E=d;for(E.pendingLanes|=2,E.entangledLanes|=2;x;){var L=1<<31-et(x);E.entanglements[1]|=L,x&=~L}Oa(d),(bt&6)===0&&(yc=wn()+500,Jr(0))}}break;case 31:case 13:E=oo(d,2),E!==null&&yi(E,d,2),xc(),pf(d,2)}if(d=gf(r),d===null&&ef(t,n,r,Bc,a),d===u)break;u=d}u!==null&&r.stopPropagation()}else ef(t,n,r,null,a)}}function gf(t){return t=br(t),yf(t)}var Bc=null;function yf(t){if(Bc=null,t=yt(t),t!==null){var n=l(t);if(n===null)t=null;else{var a=n.tag;if(a===13){if(t=f(n),t!==null)return t;t=null}else if(a===31){if(t=h(n),t!==null)return t;t=null}else if(a===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;t=null}else n!==t&&(t=null)}}return Bc=t,null}function Eg(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ya()){case Nn:return 2;case dn:return 8;case Ft:case Hi:return 32;case fn:return 268435456;default:return 32}default:return 32}}var bf=!1,ks=null,Rs=null,Ns=null,sl=new Map,ol=new Map,Is=[],nx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _g(t,n){switch(t){case"focusin":case"focusout":ks=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":Ns=null;break;case"pointerover":case"pointerout":sl.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":ol.delete(n.pointerId)}}function rl(t,n,a,r,u,d){return t===null||t.nativeEvent!==d?(t={blockedOn:n,domEventName:a,eventSystemFlags:r,nativeEvent:d,targetContainers:[u]},n!==null&&(n=Lt(n),n!==null&&Ag(n)),t):(t.eventSystemFlags|=r,n=t.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),t)}function ix(t,n,a,r,u){switch(n){case"focusin":return ks=rl(ks,t,n,a,r,u),!0;case"dragenter":return Rs=rl(Rs,t,n,a,r,u),!0;case"mouseover":return Ns=rl(Ns,t,n,a,r,u),!0;case"pointerover":var d=u.pointerId;return sl.set(d,rl(sl.get(d)||null,t,n,a,r,u)),!0;case"gotpointercapture":return d=u.pointerId,ol.set(d,rl(ol.get(d)||null,t,n,a,r,u)),!0}return!1}function wg(t){var n=yt(t.target);if(n!==null){var a=l(n);if(a!==null){if(n=a.tag,n===13){if(n=f(a),n!==null){t.blockedOn=n,gn(t.priority,function(){Tg(a)});return}}else if(n===31){if(n=h(a),n!==null){t.blockedOn=n,gn(t.priority,function(){Tg(a)});return}}else if(n===3&&a.stateNode.current.memoizedState.isDehydrated){t.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Hc(t){if(t.blockedOn!==null)return!1;for(var n=t.targetContainers;0<n.length;){var a=gf(t.nativeEvent);if(a===null){a=t.nativeEvent;var r=new a.constructor(a.type,a);yr=r,a.target.dispatchEvent(r),yr=null}else return n=Lt(a),n!==null&&Ag(n),t.blockedOn=a,!1;n.shift()}return!0}function Mg(t,n,a){Hc(t)&&a.delete(n)}function ax(){bf=!1,ks!==null&&Hc(ks)&&(ks=null),Rs!==null&&Hc(Rs)&&(Rs=null),Ns!==null&&Hc(Ns)&&(Ns=null),sl.forEach(Mg),ol.forEach(Mg)}function jc(t,n){t.blockedOn===n&&(t.blockedOn=null,bf||(bf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,ax)))}var Dc=null;function Og(t){Dc!==t&&(Dc=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Dc===t&&(Dc=null);for(var n=0;n<t.length;n+=3){var a=t[n],r=t[n+1],u=t[n+2];if(typeof r!="function"){if(yf(r||a)===null)continue;break}var d=Lt(a);d!==null&&(t.splice(n,3),n-=3,hd(d,{pending:!0,data:u,method:a.method,action:r},r,u))}}))}function ur(t){function n(L){return jc(L,t)}ks!==null&&jc(ks,t),Rs!==null&&jc(Rs,t),Ns!==null&&jc(Ns,t),sl.forEach(n),ol.forEach(n);for(var a=0;a<Is.length;a++){var r=Is[a];r.blockedOn===t&&(r.blockedOn=null)}for(;0<Is.length&&(a=Is[0],a.blockedOn===null);)wg(a),a.blockedOn===null&&Is.shift();if(a=(t.ownerDocument||t).$$reactFormReplay,a!=null)for(r=0;r<a.length;r+=3){var u=a[r],d=a[r+1],x=u[se]||null;if(typeof d=="function")x||Og(a);else if(x){var E=null;if(d&&d.hasAttribute("formAction")){if(u=d,x=d[se]||null)E=x.formAction;else if(yf(u)!==null)continue}else E=x.action;typeof E=="function"?a[r+1]=E:(a.splice(r,3),r-=3),Og(a)}}}function Cg(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(x){return u=x})},focusReset:"manual",scroll:"manual"})}function n(){u!==null&&(u(),u=null),r||setTimeout(a,20)}function a(){if(!r&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var r=!1,u=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(a,100),function(){r=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),u!==null&&(u(),u=null)}}}function xf(t){this._internalRoot=t}Pc.prototype.render=xf.prototype.render=function(t){var n=this._internalRoot;if(n===null)throw Error(o(409));var a=n.current,r=Ni();vg(a,r,t,n,null,null)},Pc.prototype.unmount=xf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var n=t.containerInfo;vg(t.current,2,null,t,null,null),xc(),n[fe]=null}};function Pc(t){this._internalRoot=t}Pc.prototype.unstable_scheduleHydration=function(t){if(t){var n=ni();t={blockedOn:null,target:t,priority:n};for(var a=0;a<Is.length&&n!==0&&n<Is[a].priority;a++);Is.splice(a,0,t),a===0&&wg(t)}};var kg=i.version;if(kg!=="19.2.3")throw Error(o(527,kg,"19.2.3"));ee.findDOMNode=function(t){var n=t._reactInternals;if(n===void 0)throw typeof t.render=="function"?Error(o(188)):(t=Object.keys(t).join(","),Error(o(268,t)));return t=y(n),t=t!==null?S(t):null,t=t===null?null:t.stateNode,t};var sx={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uc.isDisabled&&Uc.supportsFiber)try{sn=Uc.inject(sx),ke=Uc}catch{}}return cl.createRoot=function(t,n){if(!c(t))throw Error(o(299));var a=!1,r="",u=jp,d=Dp,x=Pp;return n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(r=n.identifierPrefix),n.onUncaughtError!==void 0&&(u=n.onUncaughtError),n.onCaughtError!==void 0&&(d=n.onCaughtError),n.onRecoverableError!==void 0&&(x=n.onRecoverableError)),n=bg(t,1,!1,null,null,a,r,null,u,d,x,Cg),t[fe]=n.current,Zd(t),new xf(n)},cl.hydrateRoot=function(t,n,a){if(!c(t))throw Error(o(299));var r=!1,u="",d=jp,x=Dp,E=Pp,L=null;return a!=null&&(a.unstable_strictMode===!0&&(r=!0),a.identifierPrefix!==void 0&&(u=a.identifierPrefix),a.onUncaughtError!==void 0&&(d=a.onUncaughtError),a.onCaughtError!==void 0&&(x=a.onCaughtError),a.onRecoverableError!==void 0&&(E=a.onRecoverableError),a.formState!==void 0&&(L=a.formState)),n=bg(t,1,!0,n,a??null,r,u,L,d,x,E,Cg),n.context=xg(null),a=n.current,r=Ni(),r=$s(r),u=bs(r),u.callback=null,xs(a,u,r),a=r,n.current.lanes=a,Ai(n,a),Oa(n),t[fe]=n.current,Zd(t),new Pc(n)},cl.version="19.2.3",cl}var Ug;function gx(){if(Ug)return Af.exports;Ug=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(i){console.error(i)}}return e(),Af.exports=hx(),Af.exports}var yx=gx();const ci=(e,i)=>({q:e,r:i,s:-e-i}),bx=e=>`${e.q},${e.r}`,Te=bx,ae=(e,i)=>e.q===i.q&&e.r===i.r&&e.s===i.s,ui=(e,i)=>ci(e.q+i.q,e.r+i.r),Ff=(e,i)=>ci(e.q-i.q,e.r-i.r),De=(e,i)=>(Math.abs(e.q-i.q)+Math.abs(e.r-i.r)+Math.abs(e.s-i.s))/2,Ve=(e,i)=>{const s=i*(1.5*e.q),o=i*Math.sqrt(3)*(e.r+e.q/2);return{x:s,y:o}},qg=e=>({q:e.q,r:e.r,s:e.s??-e.q-e.r}),xx=e=>ci(e.q,e.r),vx=e=>{let i=Math.round(e.q),s=Math.round(e.r),o=Math.round(e.s);const c=Math.abs(i-e.q),l=Math.abs(s-e.r),f=Math.abs(o-e.s);return c>l&&c>f?i=-s-o:l>f?s=-i-o:o=-i-s,{q:i,r:s,s:o}},Ol=[ci(1,0),ci(1,-1),ci(0,-1),ci(-1,0),ci(-1,1),ci(0,1)],xt=e=>Ol.map(i=>ui(e,i)),Rn=e=>Ol[(e%6+6)%6],wf=(e,i,s)=>e+(i-e)*s,Kt=(e,i)=>{const s=De(e,i),o=[],c=qg(e),l=qg(i);for(let f=0;f<=s;f++){const h=s===0?0:f/s,b={q:wf(c.q+1e-6,l.q+1e-6,h),r:wf(c.r+1e-6,l.r+1e-6,h),s:wf(c.s+1e-6,l.s+1e-6,h)};o.push(xx(vx(b)))}return o},ha=(e,i)=>{const s=De(e,i);if(s===0)return-1;const o=Ff(i,e),c=o.q/s,l=o.r/s,f=(0-o.q-o.r)/s;return Ol.findIndex(h=>Math.abs(h.q-c)<.01&&Math.abs(h.r-l)<.01&&Math.abs(h.s-f)<.01)};function lm(e,i){const s=Rn(e);return{q:s.q*i,r:s.r*i,s:-(s.q*i)-s.r*i}}const mu=(e,i,s,o)=>{if(e<0||e>=s||i<0||i>=o)return!1;const c=e+i,l=Math.floor(s/2),f=s-1+(o-1)-l;return c>=l&&c<=f},Sx=(e,i)=>{const s=[];for(let o=0;o<e;o++)for(let c=0;c<i;c++)mu(o,c,e,i)&&s.push(ci(o,c));return s},qs=(e,i,s)=>mu(e.q,e.r,i,s),Ax=e=>{let i=2166136261;for(let s=0;s<e.length;s++)i^=e.charCodeAt(s),i=Math.imul(i,16777619)>>>0;return i>>>0},Tx=e=>function(){let i=(e+=1831565813)>>>0;return i=Math.imul(i^i>>>15,i|1)>>>0,i^=i+Math.imul(i^i>>>7,i|61)>>>0,((i^i>>>14)>>>0)/4294967296},bu=e=>{const i=typeof e=="number"?e>>>0:Ax(String(e)),s=Tx(i||1);return{next:()=>s(),id:(o=9)=>{const c="abcdefghijklmnopqrstuvwxyz0123456789";let l="";for(let f=0;f<o;f++){const h=Math.floor(s()*c.length)%c.length;l+=c[h]}return l}}},pr=(e,i,s=9,o="")=>{const c=`${e}:${i}:${o}`,l=bu(c),f="abcdefghijklmnopqrstuvwxyz0123456789";let h="";for(let b=0;b<s;b++){const y=Math.floor(l.next()*f.length)%f.length;h+=f[y]}return h},pu=(e,i)=>{const s=`${e}:${i}`;return bu(s).next()},wo=e=>{const i=e.rngSeed||"default",s=e.rngCounter||0;return{value:pu(i,s),nextState:{...e,rngCounter:s+1}}};function is(e){return e.statusEffects?.some(i=>i.type==="stunned")??!1}function Ex(e){return e.statusEffects?.some(i=>i.type==="rooted")??!1}function zg(e,i=1){if(!e.statusEffects||e.statusEffects.length===0)return e;const s=e.statusEffects.map(o=>({...o,duration:o.duration-i})).filter(o=>o.duration>0);return{...e,statusEffects:s}}const mr={GRASS:{id:"GRASS",name:"Grass",description:"Soft grass",defaultTraits:new Set(["WALKABLE","FLAMMABLE"]),visual:{color:"#4a7c59",icon:""}},STONE:{id:"STONE",name:"Stone Floor",description:"Hard stone",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#808080",icon:""}},LAVA:{id:"LAVA",name:"Lava",description:"Molten lava",defaultTraits:new Set(["LIQUID","HAZARDOUS"]),visual:{color:"#ff4400",icon:""}},WALL:{id:"WALL",name:"Wall",description:"Solid wall",defaultTraits:new Set(["BLOCKS_LOS","BLOCKS_MOVEMENT","ANCHOR"]),visual:{color:"#333333",icon:""}},ICE:{id:"ICE",name:"Ice",description:"Slippery ice",defaultTraits:new Set(["WALKABLE","SLIPPERY"]),visual:{color:"#aaddff",icon:""}},VOID:{id:"VOID",name:"Void",description:"The endless void",defaultTraits:new Set(["HAZARDOUS"]),visual:{color:"#000000",icon:""}},STAIRS:{id:"STAIRS",name:"Stairs",description:"Lead to the next floor",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#ffffff",icon:""}},SHRINE:{id:"SHRINE",name:"Shrine",description:"A place of power",defaultTraits:new Set(["WALKABLE","ANCHOR"]),visual:{color:"#ffd700",icon:""}},GATE:{id:"GATE",name:"Gate",description:"A heavy gate",defaultTraits:new Set(["BLOCKS_MOVEMENT","BLOCKS_LOS"]),visual:{color:"#444444",icon:""}},BRIDGE:{id:"BRIDGE",name:"Bridge",description:"Crossing the gap",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#8b4513",icon:""}}},qc={FIRE:{id:"FIRE",name:"Fire",description:"Burning flames",onStay:e=>({effects:[{type:"Damage",target:e.actor.id,amount:1,reason:"fire_damage"}],messages:[`${e.actor.subtype||e.actor.type} burns!`]}),interactsWith:{WET:e=>({effects:[{type:"Juice",effect:"flash",target:e.tile.position,color:"#aaaaaa"}],messages:["Steam rises!"],modifyTile:{effects:e.tile.effects.filter(i=>i.id!=="FIRE"&&i.id!=="WET"&&i.id!=="STEAM").concat({id:"STEAM",duration:2,potency:1})}})}},WET:{id:"WET",name:"Wet",description:"Soaked with water",onApply:e=>e.tile.effects.some(s=>s.id==="FIRE")?{effects:[],messages:["Water extinguishes the flames!"],modifyTile:{effects:e.tile.effects.filter(s=>s.id!=="FIRE")}}:{effects:[],messages:[]}},OIL:{id:"OIL",name:"Oil",description:"Slippery oil",interactsWith:{FIRE:e=>({effects:[{type:"Damage",target:"area",amount:3,reason:"oil_explosion"},{type:"Juice",effect:"explosion_ring",target:e.tile.position}],messages:["Oil explodes!"],modifyTile:{effects:e.tile.effects.filter(i=>i.id!=="OIL")}})}},STEAM:{id:"STEAM",name:"Steam",description:"Obscuring steam cloud"},BLESSED:{id:"BLESSED",name:"Blessed",description:"Holy ground"},CURSED:{id:"CURSED",name:"Cursed",description:"Unholy ground"},ICE_WALL:{id:"ICE_WALL",name:"Ice Wall",description:"A wall of ice"},SMOKE:{id:"SMOKE",name:"Smoke",description:"Thick smoke"},BOMB_TICK:{id:"BOMB_TICK",name:"Bomb Tick",description:"About to explode"},TRI_TRAP:{id:"TRI_TRAP",name:"Kinetic Trap",description:"Hidden trap that flings non-flying units outward"},SNARE:{id:"SNARE",name:"Snare",description:"Entangling roots that halt movement and root the target.",onPass:e=>e.actor.isFlying?{effects:[],messages:[]}:{effects:[{type:"ApplyStatus",target:e.actor.id,status:"rooted",duration:2}],messages:["Snared! Movement halted."],interrupt:!0,newMomentum:0}}},Ze={getTileAt(e,i){const s=Te(i);let o;return e.tiles&&(e.tiles instanceof Map?o=e.tiles.get(s):Array.isArray(e.tiles)?o=e.tiles.find(c=>Array.isArray(c)&&c[0]===s||c.position&&ae(c.position,i)):o=e.tiles[s]),o||{position:i,baseId:"STONE",traits:new Set(["WALKABLE"]),effects:[]}},getTraitsForTile(e,i){const s=new Set,o=i.position;return qs(o,e.gridWidth,e.gridHeight)?(i.baseId==="LAVA"&&(s.add("HAZARDOUS"),s.add("LIQUID"),s.add("LAVA")),i.baseId==="WALL"&&(s.add("BLOCKS_MOVEMENT"),s.add("BLOCKS_LOS"),s.add("ANCHOR")),i.traits.forEach(l=>s.add(l)),i.effects.forEach(l=>{l.id==="FIRE"&&(s.add("FIRE"),s.add("HAZARDOUS")),l.id==="ICE_WALL"&&(s.add("BLOCKS_MOVEMENT"),s.add("BLOCKS_LOS"),s.add("ANCHOR")),l.id==="SMOKE"&&s.add("BLOCKS_LOS")}),s):(s.add("BLOCKS_MOVEMENT"),s.add("BLOCKS_LOS"),s.add("ANCHOR"),s)},getTraitsAt(e,i){const s=this.getTileAt(e,i);return this.getTraitsForTile(e,s)},isPassable(e,i){const s=this.getTraitsAt(e,i);return!s.has("BLOCKS_MOVEMENT")&&!s.has("HAZARDOUS")},isWalkable(e,i){return!this.getTraitsAt(e,i).has("BLOCKS_MOVEMENT")},isLosBlocking(e,i){return this.getTraitsAt(e,i).has("BLOCKS_LOS")},isAnchorable(e,i){return this.getTraitsAt(e,i).has("ANCHOR")},hasTrait(e,i,s){return this.getTraitsAt(e,i).has(s)}};class Eo{static hasFireProtection(i){return i.statusEffects.some(s=>s.type==="fire_immunity")||i.activeSkills?.some(s=>s.id==="ABSORB_FIRE")||!1}static isFireHazard(i,s){return i.baseId==="LAVA"||s.has("LAVA")||s.has("FIRE")}static mergeResults(i,s){i.effects.push(...s.effects),i.messages.push(...s.messages),s.newMomentum!==void 0&&(i.newMomentum=s.newMomentum),s.interrupt&&(i.interrupt=!0),s.modifyTile&&(i.modifyTile={...i.modifyTile,...s.modifyTile})}static processEntry(i,s,o){const c={effects:[],messages:[],interrupt:!1},l={tile:s,actor:i,state:o,isFinalDestination:!0,source:i.previousPosition},f=Ze.getTraitsForTile(o,s);f.has("HAZARDOUS")&&!i.isFlying&&(this.isFireHazard(s,f)&&this.hasFireProtection(i)||(s.baseId==="LAVA"||f.has("LAVA")?this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"lava_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Lava Sink! You were engulfed by lava!"],interrupt:!0}):(s.baseId==="VOID"||f.has("VOID"))&&this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"void_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Void consumes your soul!"],interrupt:!0})));for(const h of s.effects){const b=qc[h.id];if(!b?.onEnter)continue;const y=b.onEnter(l);if(this.mergeResults(c,y),c.interrupt)break}return c.messages.length===0&&c.effects.some(h=>h.type==="LavaSink")&&c.messages.push("Lava Sink! You were engulfed by lava!"),c}static processTransition(i,s,o,c,l={}){const{ignoreActors:f=!1,ignoreGroundHazards:h=!1}=l,b={effects:[],messages:[],newMomentum:c!==void 0?Math.max(0,c-1):void 0,interrupt:!1},y=Ze.getTraitsForTile(o,s);if(y.has("BLOCKS_MOVEMENT")||!f&&(o.enemies.find(A=>A.id!==i.id&&A.hp>0&&ae(A.position,s.position))||(i.id!==o.player.id&&ae(o.player.position,s.position)?o.player:void 0)))return b.interrupt=!0,b.newMomentum=0,b;const S={tile:s,actor:i,state:o,momentum:c,isFinalDestination:!1,source:i.previousPosition};y.has("HAZARDOUS")&&!i.isFlying&&!h?this.isFireHazard(s,y)&&this.hasFireProtection(i)?this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:99,reason:"hazard_intercept"}],messages:["Flames surge through you."],interrupt:!1}):this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:99,reason:"hazard_intercept"},{type:"Juice",effect:"lavaSink",target:s.position}],messages:[s.baseId==="LAVA"||y.has("LAVA")?"Sunk in Lava!":"Consumed by Void!"],interrupt:!0}):y.has("SLIPPERY")?b.newMomentum=Math.max(1,c||0):y.has("LIQUID")&&c!==void 0&&c>0&&(b.newMomentum=Math.max(0,c-1));for(const v of s.effects){const A=qc[v.id];if(!A?.onPass)continue;const M=A.onPass(S);if(this.mergeResults(b,M),b.interrupt)break}if(!b.interrupt&&!i.isFlying&&!h&&o.traps){const v=o.traps.find(A=>ae(A.position,s.position)&&A.cooldown===0&&A.ownerId!==i.id);if(v){const A=s.position.q-v.position.q||1,M=s.position.r-v.position.r||0;let p=0;A>0&&M===0?p=0:A>0&&M<0?p=1:A===0&&M<0?p=2:A<0&&M===0?p=3:A<0&&M>0?p=4:p=5;const g=3;let C=s.position;const O=(w=>[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0},{q:0,r:1,s:-1}][w%6])(p);for(let w=0;w<g;w++){const R={q:C.q+O.q,r:C.r+O.r,s:C.s+O.s};if(!Ze.isWalkable(o,R))break;C=R}if(this.mergeResults(b,{effects:[{type:"SetTrapCooldown",position:v.position,ownerId:v.ownerId,cooldown:v.resetCooldown??2},{type:"Displacement",target:i.id,destination:C,source:s.position,isFling:!0},{type:"Juice",effect:"kineticWave",target:s.position,intensity:"high"},{type:"Juice",effect:"combat_text",target:s.position,text:"TRAP!"}],messages:[`${i.subtype||"Unit"} triggered a kinetic trap!`],interrupt:!0}),v.volatileCore&&this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:1,reason:"trap_volatile_core"}],messages:["Volatile core detonates!"]}),v.chainReaction&&o.traps){const w=o.traps.filter(R=>R.ownerId===v.ownerId&&R.cooldown===0&&!ae(R.position,v.position)&&xt(v.position).some(Q=>ae(Q,R.position)));for(const R of w)this.mergeResults(b,{effects:[{type:"SetTrapCooldown",position:R.position,ownerId:R.ownerId,cooldown:R.resetCooldown??2}],messages:["Chain reaction sparks nearby traps!"]}),R.volatileCore&&this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:1,reason:"trap_chain_volatile"}],messages:["Chain blast!"]})}}}return b}static processStay(i,s,o){const c={effects:[],messages:[]},l={tile:s,actor:i,state:o,isFinalDestination:!1},f=Ze.getTraitsForTile(o,s);if((s.baseId==="LAVA"||f.has("LAVA"))&&!i.isFlying&&!i.statusEffects.some(h=>h.type==="fire_immunity")){const h=i.id==="player";this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:h?1:99,reason:"lava_tick"}],messages:["Lava Sink! You were engulfed by lava!"]})}for(const h of s.effects){const b=qc[h.id];if(!b?.onStay)continue;const y=b.onStay(l);this.mergeResults(c,y)}return c}static applyEffect(i,s,o,c,l,f){const h=qc[s];if(!h)return{effects:[],messages:[]};const b={effects:[],messages:[]};for(const y of i.effects){const S=h.interactsWith?.[y.id];if(S){const v=S({tile:i,state:l,potency:c,sourceId:f});return this.mergeResults(b,v),b}}if(h.onApply){const y=h.onApply({tile:i,state:l,potency:c,sourceId:f});this.mergeResults(b,y)}return b.modifyTile?.effects?b.modifyTile&&(i.effects=b.modifyTile.effects):i.effects.push({id:s,duration:o,potency:c,sourceId:f}),b}static processPath(i,s,o,c,l={}){let f=i.position,h=c,b={effects:[],messages:[],newMomentum:c,interrupt:!1};for(const y of s){const S=Ze.getTileAt(o,y),v=Ze.getTraitsForTile(o,S),A=this.processTransition(i,S,o,h,l);if(A.interrupt&&v.has("BLOCKS_MOVEMENT")){b.interrupt=!0;break}if(f=y,this.mergeResults(b,A),b.interrupt){b.interrupt=!0;break}if(h=b.newMomentum,h!==void 0&&h<=0)break}return{lastValidPos:f,result:b,interrupt:!!b.interrupt}}static getMovementCost(i,s){const o=Ze.getTraitsForTile(i,s);let c=1;return o.has("HAZARDOUS")&&(c+=5),o.has("LIQUID")&&(c+=1),o.has("FIRE")&&(c+=2),c}}const _x=(e,i)=>Array(i).fill(0n),Mf=(e,i,s)=>{if(!Number.isInteger(i.q)||!Number.isInteger(i.r))return[...e];if(i.r<0||i.r>=e.length||i.q<0)return[...e];const o=[...e];return o[i.r]|=1n<<BigInt(i.q),o},Wf=(e,i)=>i.r<0||i.r>=e.length?!0:(e[i.r]&1n<<BigInt(i.q))!==0n,$g=(e,i)=>{if(i.playerStart&&ae(e,i.playerStart)||i.stairsPosition&&ae(e,i.stairsPosition)||i.shrinePosition&&ae(e,i.shrinePosition))return!0;if(i.tiles){const s=Ze.getTraitsAt(i,e);if(s.has("HAZARDOUS")||s.has("BLOCKS_MOVEMENT"))return!0}return!1},ga=(e,i)=>{if(e)return e.find(s=>s&&s.position&&ae(s.position,i))},Ne=(e,i)=>ae(e.player.position,i)?e.player:ga(e.enemies,i),wx=(e,i)=>!!e.shrinePosition&&ae(i,e.shrinePosition),Mx=(e,i)=>!(!ae(i,e.stairsPosition)||e.enemies.some(o=>o.subtype==="sentinel"&&o.hp>0)),Ox=(e,i,s,o)=>{const c=De(s,o);if(c===0)return[];const l=(o.q-s.q)/c,f=(o.r-s.r)/c,h=(o.s-s.s)/c,b=[],y=new Set,S=2;for(let v=1;v<=S;v++){const A={q:o.q+Math.round(l*v),r:o.r+Math.round(f*v),s:o.s+Math.round(h*v)};if(qs(A,e.gridWidth,e.gridHeight)){const M=`${A.q},${A.r}`;y.has(M)||(y.add(M),b.push(A))}}return b},dt={getNeighbors(e){return xt(e)},isTileBlocked(e,i){return!e.occupancyMask||e.occupancyMask.length===0?!1:Wf(e.occupancyMask,i)},refreshOccupancyMask(e){let i=_x(e.gridWidth,e.gridHeight);return e.tiles?.forEach(s=>{(s.baseId==="WALL"||s.traits?.has("BLOCKS_MOVEMENT"))&&(i=Mf(i,s.position))}),e.player&&(i=Mf(i,e.player.position)),e.enemies?.forEach(s=>{i=Mf(i,s.position)}),i},getMovementRange(e,i,s){const o=new Map,c=[],l=b=>`${b.q},${b.r}`,f=Ne(e,i),h=[{p:i,cost:0}];for(o.set(l(i),0);h.length;){const b=h.shift();if(!(b.cost>=s))for(const y of this.getNeighbors(b.p)){if(!this.isWithinBounds(e,y)||!Ze.isWalkable(e,y))continue;const S=Ne(e,y),v=S&&!ae(y,i),A=v&&f&&S.factionId===f.factionId;if(v&&!A)continue;const M=l(y),p=b.cost+1;(!o.has(M)||o.get(M)>p)&&(o.set(M,p),A||c.push(y),h.push({p:y,cost:p}))}}return c},getAxialTargets(e,i,s,o={}){const{includeWalls:c=!1,includeActors:l=!0,stopAtObstacles:f=!0}=o,h=[];for(let b=0;b<6;b++)for(let y=1;y<=s;y++){const S=ui(i,lm(b,y));if(!this.isWithinBounds(e,S))break;const A=Ze.getTileAt(e,S)?.baseId==="WALL",M=Ne(e,S);if(A){if(c&&h.push(S),f)break}else if(M){if(l&&h.push(S),f)break}else h.push(S)}return h},getAreaTargets(e,i,s){const o=[];for(let c=-s;c<=s;c++)for(let l=Math.max(-s,-c-s);l<=Math.min(s,-c+s);l++){const f=ui(i,ci(c,l));this.isWithinBounds(e,f)&&o.push(f)}return o},isWithinBounds(e,i){return qs(i,e.gridWidth,e.gridHeight)},getAxialTargetsWithOptions(e,i,s,o){return this.getAxialTargets(e,i,s,o)}},n0={footman:{subtype:"footman",name:"Footman",stats:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:4,mind:0,instinct:0},skills:{base:["BASIC_MOVE","BASIC_ATTACK"],passive:["AUTO_ATTACK"]}},sprinter:{subtype:"sprinter",name:"Sprinter",stats:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,actionCooldown:1,weightClass:"Standard",speed:2},trinity:{body:2,mind:0,instinct:0},skills:{base:["BASIC_MOVE","BASIC_ATTACK"],passive:[]}},raider:{subtype:"raider",name:"Raider",stats:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,actionCooldown:1,weightClass:"Standard",speed:1},trinity:{body:2,mind:0,instinct:1},skills:{base:["BASIC_MOVE","BASIC_ATTACK","DASH"],passive:[]}},pouncer:{subtype:"pouncer",name:"Pouncer",stats:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,actionCooldown:1,weightClass:"Standard",speed:1},trinity:{body:2,mind:0,instinct:1},skills:{base:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],passive:[]}},shieldBearer:{subtype:"shieldBearer",name:"Shield Bearer",stats:{hp:2,maxHp:2,range:1,damage:1,type:"melee",cost:2,actionCooldown:2,weightClass:"Heavy",speed:1},trinity:{body:1,mind:0,instinct:.4},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],passive:[]}},archer:{subtype:"archer",name:"Archer",stats:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:1,actionCooldown:3,weightClass:"Standard",speed:1},trinity:{body:.2,mind:0,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","ARCHER_SHOT"],passive:[]}},bomber:{subtype:"bomber",name:"Bomber",stats:{hp:1,maxHp:1,range:3,damage:1,type:"ranged",cost:1,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:.4,mind:.2,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","BOMB_TOSS"],passive:[]}},warlock:{subtype:"warlock",name:"Warlock",stats:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:2,actionCooldown:2,weightClass:"Standard",speed:1},trinity:{body:.4,mind:.6,instinct:.2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],passive:[]}},sentinel:{subtype:"sentinel",name:"Sentinel",stats:{hp:30,maxHp:30,range:4,damage:2,type:"boss",cost:25,actionCooldown:1,weightClass:"Heavy",speed:1},trinity:{body:4,mind:2,instinct:2},skills:{base:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],passive:[]}}},i0=e=>n0[e],Cx=(e,i={})=>{const s=i0(e);return s?i.includePassive??!0?[...s.skills.base,...s.skills.passive]:[...s.skills.base]:[]},lu=7,cu=9,G=36,Vg={speed:1},kx={stunned:{tickWindow:"START_OF_TURN"},poisoned:{tickWindow:"START_OF_TURN"},armored:{tickWindow:"END_OF_TURN"},hidden:{tickWindow:"END_OF_TURN"},time_bomb:{tickWindow:"END_OF_TURN"}},Za=e=>{const i=n0[e];return{hp:i.stats.hp,maxHp:i.stats.maxHp,range:i.stats.range,damage:i.stats.damage,type:i.stats.type,cost:i.stats.cost,skills:[...i.skills.base,...i.skills.passive],actionCooldown:i.stats.actionCooldown,weightClass:i.stats.weightClass,speed:i.stats.speed}},Xf={footman:Za("footman"),sprinter:Za("sprinter"),raider:Za("raider"),pouncer:Za("pouncer"),shieldBearer:Za("shieldBearer"),archer:Za("archer"),bomber:Za("bomber"),warlock:Za("warlock"),sentinel:Za("sentinel")},Rx=.17,Yg=[0,2,3,5,7,10,12,15,18,22,0],zc={floor:"#6b7b3c",wall:"#374151",shrine:"#f97316",portal:"#ffffff"},Nx={1:"inferno",2:"inferno",3:"inferno",4:"inferno",5:"inferno",6:"inferno",7:"inferno",8:"inferno",9:"inferno",10:"inferno"},Of={1:["footman"],2:["footman","sprinter"],3:["footman","archer"],4:["footman","archer","bomber","raider"],5:["footman","archer","bomber","shieldBearer","raider"],6:["footman","archer","bomber","shieldBearer","warlock","pouncer"],7:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],8:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],9:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],10:[]},js=(e,i)=>{let s=i,o=e.temporaryArmor||0,c=e.hp;if(o>0){const l=Math.min(o,s);o-=l,s-=l}return c=Math.max(0,c-s),{...e,hp:c,temporaryArmor:o}},Gf=(e,i,s,o)=>{const l=kx[i]?.tickWindow||"END_OF_TURN",f=i.toUpperCase();if(e.statusEffects.find(y=>y.id===f))return{...e,statusEffects:e.statusEffects.map(y=>y.id===f?{...y,duration:Math.max(y.duration,s),tickWindow:l,stacks:o||y.stacks}:y)};const b={id:f,type:i,duration:s,tickWindow:l,stacks:o||1};return{...e,statusEffects:[...e.statusEffects,b]}},Ix=(e,i)=>({...e,hp:Math.min(e.maxHp,e.hp+i)}),Lx=(e,i,s=!0)=>{const o=e.maxHp+i,c=s?Math.min(o,e.hp+i):e.hp;return{...e,maxHp:o,hp:c}},Bx=e=>{const i=[];return e.player.hp<=0&&e.gameStatus==="playing"&&i.push({type:"GameOver",reason:"PLAYER_DIED"}),i},Kg=e=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(i=>({...i,currentCooldown:Math.max(0,i.currentCooldown-1)}))}:e,Hx=(e,i,s)=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(o=>o.id===i&&!o.activeUpgrades.includes(s)?{...o,activeUpgrades:[...o.activeUpgrades,s]}:o)}:e;function Qf(e,i){return e?.get(i)}const Cf=(e,i,s)=>Math.max(i,Math.min(s,e)),ul=e=>Math.round(e*1e3)/1e3,cm=e=>{const i=Math.max(0,e.body),s=Math.max(0,e.mind),o=Math.max(0,e.instinct);return{bodyDamageMultiplier:ul(1+i/20),bodyMitigation:ul(Cf(i*.01,0,.5)),mindStatusDurationBonus:Math.floor(s/15),mindMagicMultiplier:ul(1+s/20),instinctInitiativeBonus:o*2,instinctCriticalMultiplier:ul(1+Cf(o,0,10)*.02),instinctSparkDiscountMultiplier:ul(1-Cf(o,0,100)/100)}},xu=e=>{const i=Math.max(0,e.body),s=Math.max(0,e.mind),o=Math.max(0,e.instinct),c={base:0,body:5,mind:2,instinct:3},l=Math.floor(i*c.body+s*c.mind+o*c.instinct+c.base);return Math.max(1,l)},Xn=(e,i,s)=>Math.max(i,Math.min(s,e)),Tn=e=>Math.round(e*1e3)/1e3,jx=()=>globalThis?.process?.env?.HOP_COMBAT_INTERACTION_MODEL,Dx=e=>e.length===0?1:e.reduce((i,s)=>i*s.multiplier,1),Px=e=>{let i=1;if(e.inDangerPreviewHex&&(i+=.15),typeof e.proximityDistance=="number"){const s=Xn(e.proximityDistance,0,6);i+=(6-s)*.02}return i},Ux=(e,i,s,o,c,l,f,h)=>{if(!i)return{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1};const b=s==="physical"?.85+e.instinct*.015+e.body*.005:.85+e.mind*.015+e.instinct*.005,y=s==="physical"?i.instinct*.012+i.body*.004:i.instinct*.008+i.mind*.008,S=Xn(b-y,.1,.99);if(typeof o!="number")return{multiplier:S,pressure:Tn(b-y),rangePressure:0,rangeMultiplier:1};const v={min:Xn(c??(s==="physical"?1:2),1,6),max:Xn(l??(s==="physical"?2:4),1,6)};if(v.max<v.min){const W=v.min;v.min=v.max,v.max=W}const A={min:Xn(f??(s==="physical"?1:2),1,6),max:Xn(h??(s==="physical"?3:5),1,6)};if(A.max<A.min){const W=A.min;A.min=A.max,A.max=W}const M=Xn(o,1,6),p=Math.max(0,v.min-M),g=Math.max(0,M-v.max),C=p*.06+g*.1,N=e.instinct*.015,O=(M>=A.min&&M<=A.max?.05:0)+i.instinct*.006,w=N-C-O,R=Xn(1+w,.55,1.25);return{multiplier:Xn(S*R,.05,.99),pressure:Tn(b-y),rangePressure:Tn(w),rangeMultiplier:Tn(R)}},qx=(e,i)=>{if(!e)return{multiplier:1,pressure:0};const s=Xn(i==="physical"?e.body*.01+e.instinct*.004:e.mind*.01+e.instinct*.004,0,.75);return{multiplier:1-s,pressure:Tn(s)}},zx=(e,i,s,o)=>{if(!i)return{multiplier:o,critPressure:0,resistancePressure:0};const c=Xn(s==="physical"?.05+e.instinct*.01:.05+e.mind*.01,0,.75),l=Xn(s==="physical"?i.body*.006+i.instinct*.004:i.mind*.006+i.instinct*.004,0,.7);return{multiplier:1+Xn(c-l,0,.75)*(o-1),critPressure:Tn(c),resistancePressure:Tn(l)}},$x=(e,i,s,o,c)=>{const l=e.scaling.filter(v=>v.attribute==="body").reduce((v,A)=>v+(e.trinity.body||0)*A.coefficient,0),f=e.scaling.filter(v=>v.attribute==="mind").reduce((v,A)=>v+(e.trinity.mind||0)*A.coefficient,0),h=e.scaling.filter(v=>v.attribute==="instinct").reduce((v,A)=>v+(e.trinity.instinct||0)*A.coefficient,0),b=e.damageClass==="physical"?Math.max(0,e.basePower*(i.bodyDamageMultiplier-1)):0,y=e.damageClass==="magical"?Math.max(0,e.basePower*(i.mindMagicMultiplier-1)):0,S=Math.max(0,(c-1)*(s+o));return{body:Math.max(0,b+l),mind:Math.max(0,y+f),instinct:Math.max(0,h+S)}},Vx=(e,i)=>{if(e<=0)return e;const s=cm(i).mindStatusDurationBonus;return e+s},Yx=e=>cm(e).instinctInitiativeBonus,_n=e=>{const i=cm(e.trinity),s=e.damageClass||"physical",o=jx()==="triangle"?"triangle":"legacy",c=e.interactionModel||o,l=s==="magical"?i.mindMagicMultiplier:i.bodyDamageMultiplier,f=e.basePower*l,h=e.scaling.reduce((j,re)=>{const pe=e.trinity[re.attribute]||0;return j+pe*re.coefficient},0),b=Dx(e.statusMultipliers),y=Px(e),S=i.instinctCriticalMultiplier,v=c==="triangle"?Ux(e.trinity,e.targetTrinity,s,e.engagementRange,e.optimalRangeMin,e.optimalRangeMax,e.targetOptimalRangeMin,e.targetOptimalRangeMax):{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1},A=c==="triangle"?qx(e.targetTrinity,s):{multiplier:1,pressure:0},M=c==="triangle"?zx(e.trinity,e.targetTrinity,s,S):{multiplier:S,critPressure:0,resistancePressure:0},p=(f+h)*b*y*v.multiplier*A.multiplier*M.multiplier*(e.attackPowerMultiplier??1)*(e.targetDamageTakenMultiplier??1),g=Math.max(0,Math.floor(p)),C=$x(e,i,f,h,S),N=Math.max(1e-6,C.body+C.mind+C.instinct),O=Tn(C.body/N),w=Tn(C.mind/N),R=Tn(C.instinct/N),Q=Math.max(1,e.theoreticalMaxPower??p),W=Xn(g/Q,0,1);return{basePower:e.basePower,bodyScaledPower:Tn(f),scalingPower:Tn(h),statusMultiplier:Tn(b),riskMultiplier:Tn(y),criticalMultiplier:Tn(S),hitMultiplier:Tn(v.multiplier),rangeMultiplier:Tn(v.rangeMultiplier),mitigationMultiplier:Tn(A.multiplier),critExpectedMultiplier:Tn(M.multiplier),finalPower:g,bodyContribution:O,mindContribution:w,instinctContribution:R,scoreEvent:{skillId:e.skillId,attackerId:e.attackerId,targetId:e.targetId,finalPower:g,efficiency:Tn(W),riskBonusApplied:!!e.inDangerPreviewHex,damageClass:s,hitPressure:v.pressure,rangePressure:v.rangePressure,mitigationPressure:A.pressure,critPressure:M.critPressure,resistancePressure:M.resistancePressure,bodyContribution:O,mindContribution:w,instinctContribution:R}}},tt=e=>{const i=Qf(e.components,"trinity");if(i)return{body:i.body,mind:i.mind,instinct:i.instinct};const s=Qf(e.components,"stats"),o=s?.strength??0,c=s?.defense??0,l=s?.evasion??0;return{body:o,mind:c,instinct:l}},Fg={player:100,footman:50,archer:60,shieldBearer:40,bomber:30,warlock:55,bomb:10},Jf=e=>{let i=e.speed;if(i===void 0){const o=e.subtype;i=e.type==="player"?Fg.player:Fg[o]??50}return e.statusEffects?.some(o=>o.type==="stunned")&&(i-=100),i+=Yx(tt(e)),i},Co=e=>{const i=[];i.push({actorId:e.player.id,initiative:Jf(e.player),hasActed:!1,turnStartPosition:void 0});for(const s of e.enemies)i.push({actorId:s.id,initiative:Jf(s),hasActed:!1,turnStartPosition:void 0});return i.sort((s,o)=>o.initiative!==s.initiative?o.initiative-s.initiative:s.actorId==="player"?-1:o.actorId==="player"?1:s.actorId.localeCompare(o.actorId)),{entries:i,currentIndex:-1,round:1}},Kx=e=>e.currentIndex<0||e.currentIndex>=e.entries.length?null:e.entries[e.currentIndex],Fx=e=>{let i=e.initiativeQueue;i||(i=Co(e));let s=i.currentIndex+1;for(;s<i.entries.length&&i.entries[s].hasActed;)s++;return s>=i.entries.length?(i=Co(e),i.round=(e.initiativeQueue?.round??0)+1,s=0,{queue:{...i,currentIndex:s},actorId:i.entries[s]?.actorId??null,newRound:!0}):{queue:{...i,currentIndex:s},actorId:i.entries[s]?.actorId??null,newRound:!1}},Wx=(e,i)=>{const s=e.initiativeQueue;if(!s)return Co(e);const o=s.entries.map(c=>{if(c.actorId===i.id){if(c.turnStartPosition)return c;const f=xt(i.position).map(h=>Ne(e,h)?.id).filter(Boolean);return{...c,turnStartPosition:{...i.position},turnStartNeighborIds:f}}return c});return{...s,entries:o}},Xx=(e,i)=>{const s=e.initiativeQueue;if(!s)return Co(e);const o=s.entries.map(c=>c.actorId===i?{...c,hasActed:!0}:c);return{...s,entries:o}},Gx=(e,i)=>{const s=e.initiativeQueue;return s?s.entries.find(c=>c.actorId===i)?.turnStartPosition??null:null},Qx=(e,i)=>{const s=e.initiativeQueue;return s?s.entries.find(c=>c.actorId===i)?.turnStartNeighborIds??null:null},xl=e=>{const i=e.initiativeQueue;if(!i)return!0;if(i.currentIndex<0||i.currentIndex>=i.entries.length)return!1;const s=i.entries[i.currentIndex];return s.actorId===e.player.id&&!s.hasActed},kf=(e,i)=>{const s=e.entries.filter(l=>l.actorId!==i);let o=e.currentIndex;const c=e.entries.findIndex(l=>l.actorId===i);return c>=0&&c<=e.currentIndex&&o--,{...e,entries:s,currentIndex:Math.min(o,s.length-1)}},Jx=(e,i)=>{const s={actorId:i.id,initiative:Jf(i),hasActed:!0,turnStartPosition:void 0};return{...e,entries:[...e.entries,s]}},kn={body:0,mind:0,instinct:0},Zx=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),dr=e=>{const i={};for(const[s,o]of Object.entries(e))i[s]=Zx(o);return i},ev={neutral:{id:"neutral",default:kn,archetype:dr({VANGUARD:kn,SKIRMISHER:kn,FIREMAGE:kn,NECROMANCER:kn,HUNTER:kn,ASSASSIN:kn}),enemySubtype:dr({footman:kn,sprinter:kn,raider:kn,pouncer:kn,shieldBearer:kn,archer:kn,bomber:kn,warlock:kn,sentinel:kn}),companionSubtype:dr({falcon:kn,skeleton:kn})},live:{id:"live",default:kn,archetype:dr({VANGUARD:{body:9,mind:4,instinct:5},SKIRMISHER:{body:7,mind:6,instinct:10},FIREMAGE:{body:2,mind:9,instinct:4},NECROMANCER:{body:5,mind:9,instinct:5},HUNTER:{body:3,mind:4,instinct:8},ASSASSIN:{body:3,mind:3,instinct:9}}),enemySubtype:dr({footman:{body:0,mind:0,instinct:0},sprinter:{body:0,mind:0,instinct:0},raider:{body:.4,mind:0,instinct:.2},pouncer:{body:.4,mind:0,instinct:.2},shieldBearer:{body:1,mind:0,instinct:.4},archer:{body:.2,mind:0,instinct:.2},bomber:{body:.4,mind:.2,instinct:.2},warlock:{body:.4,mind:.6,instinct:.2},sentinel:{body:4,mind:2,instinct:2}}),companionSubtype:dr({falcon:{body:2,mind:2,instinct:9},skeleton:{body:15,mind:1,instinct:4}})}},tv=e=>e?.toLowerCase()==="neutral"?"neutral":"live",nv=()=>globalThis?.process?.env?.HOP_TRINITY_PROFILE,iv=e=>ev[tv(nv())],pa={outgoingPhysical:1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},av={VANGUARD:pa,SKIRMISHER:pa,FIREMAGE:pa,NECROMANCER:pa,HUNTER:pa,ASSASSIN:pa},sv={footman:{outgoingPhysical:3,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},sprinter:{outgoingPhysical:2.8,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},raider:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},pouncer:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},shieldBearer:{outgoingPhysical:3.5,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},archer:{outgoingPhysical:2.6,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},bomber:{outgoingPhysical:2.8,outgoingMagical:3,incomingPhysical:1,incomingMagical:1},warlock:{outgoingPhysical:1.5,outgoingMagical:3.5,incomingPhysical:1,incomingMagical:1},sentinel:{outgoingPhysical:4,outgoingMagical:4,incomingPhysical:1,incomingMagical:1}},ov={falcon:{outgoingPhysical:1.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},skeleton:{outgoingPhysical:1.1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1}},vl=e=>({outgoingPhysical:e.outgoingPhysical,outgoingMagical:e.outgoingMagical,incomingPhysical:e.incomingPhysical,incomingMagical:e.incomingMagical}),a0=e=>e.type==="player"?vl(av[(e.archetype||"VANGUARD").toUpperCase()]||pa):e.companionOf&&e.subtype?vl(ov[e.subtype]||pa):e.subtype?vl(sv[e.subtype]||pa):vl(pa),s0=e=>{const i=Qf(e.components,"combat_profile");return i?{outgoingPhysical:Number.isFinite(i.outgoingPhysical)?i.outgoingPhysical:1,outgoingMagical:Number.isFinite(i.outgoingMagical)?i.outgoingMagical:1,incomingPhysical:Number.isFinite(i.incomingPhysical)?i.incomingPhysical:1,incomingMagical:Number.isFinite(i.incomingMagical)?i.incomingMagical:1}:vl(pa)},rv=(e,i)=>{const s=s0(e);return i==="magical"?s.outgoingMagical:s.outgoingPhysical},lv=(e,i)=>{const s=s0(e);return i==="magical"?s.incomingMagical:s.incomingPhysical},dl=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),o0=e=>{if(e.trinity)return dl(e.trinity);const i=iv(),s=i.default;if(e.type==="player"){const o=(e.archetype||"VANGUARD").toUpperCase();return dl(i.archetype[o]||s)}if(e.companionOf&&e.subtype){const o=e.subtype;if(i.companionSubtype[o])return dl(i.companionSubtype[o])}return e.subtype?dl(i.enemySubtype[e.subtype]||s):dl(s)},Al=e=>{const i=new Map(e.components||[]),s=i.has("trinity"),o=i.has("combat_profile");if(s&&o)return e;const c=o0({id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:e.factionId,archetype:e.archetype,companionOf:e.companionOf}),l=a0({type:e.type,archetype:e.archetype,subtype:e.subtype,companionOf:e.companionOf});return s||i.set("trinity",{type:"trinity",...c}),o||i.set("combat_profile",{type:"combat_profile",...l}),{...e,components:i}};function cv(e){return e.map(i=>({id:i,name:String(i),description:String(i),slot:"utility",cooldown:0,currentCooldown:0,range:0,upgrades:[],activeUpgrades:[]}))}function Us(e){const i=e.activeSkills?[...e.activeSkills]:cv(e.skills||[]),s=new Map(e.components||[]),o=o0(e),c=e.combatProfile||a0(e);s.has("trinity")||s.set("trinity",{type:"trinity",...o}),s.has("combat_profile")||s.set("combat_profile",{type:"combat_profile",...c});const l=xu(o),f=Math.max(1,e.maxHp??l),h=Math.min(f,Math.max(0,e.hp??f));return e.weightClass&&s.set("physics",{type:"physics",weightClass:e.weightClass}),e.archetype&&s.set("archetype",{type:"archetype",archetype:e.archetype}),{id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:h,maxHp:f,speed:e.speed,factionId:e.factionId,initiative:e.initiative,statusEffects:[],temporaryArmor:0,activeSkills:i,weightClass:e.weightClass,archetype:e.archetype,components:s,isFlying:e.isFlying,companionOf:e.companionOf,isVisible:!0}}function uv(e){const i=Us({id:e.id,type:"enemy",subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:"enemy",skills:e.skills,weightClass:e.weightClass||"Standard",trinity:e.trinity});return i.enemyType=e.enemyType,i}function r0(e){if(e.companionType==="falcon"){const i=Us({id:e.id||`falcon-${e.ownerId}`,type:"enemy",subtype:"falcon",position:e.position,speed:95,factionId:"player",skills:["BASIC_MOVE","FALCON_PECK","FALCON_APEX_STRIKE","FALCON_HEAL","FALCON_SCOUT","FALCON_AUTO_ROOST"],weightClass:"Light",isFlying:!0,companionOf:e.ownerId,trinity:e.trinity});return i.companionState={mode:"roost",orbitStep:0},i}return e.companionType==="skeleton"?Us({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:"skeleton",position:e.position,hp:2,maxHp:2,speed:50,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity}):Us({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:e.companionType,position:e.position,speed:80,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity})}function dv(e){return r0({companionType:"falcon",ownerId:e.ownerId,position:e.position})}function fv(e){const i=Cx(e);return i.length>0?i:["BASIC_MOVE"]}const mv=/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*/i,pv=e=>mv.test(e),um=(e,i="INFO",s="SYSTEM")=>e?pv(e)?e:`[${i}|${s}] ${e}`:"",hv=(e,i="INFO",s="SYSTEM")=>e.map(o=>um(o,i,s)).filter(Boolean),Gt=(e,i,s,o,c=50)=>{const l=um(i,s,o),f=[...e||[]];return l&&f[f.length-1]===l?f.slice(-c):[...f,l].slice(-c)},Ca=(e,i,s,o,c=50)=>{const l=[...e||[]];let f;for(const h of hv(i,s,o))h&&f===h||(l.push(h),f=h);return l.slice(-c)},Wg=(e,i,s)=>{const o=s.preserveInputOrder===!1?[...i]:[...i].reverse(),c=s.describe||(()=>"UNKNOWN");let l=e;const f=[];let h=s.startTick||1;for(;o.length>0;){const b=o.length,y=o.pop();l=s.apply(l,y);const S=s.getReactions?.(l,y)||[];if(S.length>0)for(let v=S.length-1;v>=0;v--)o.push(S[v]);f.push({tick:h++,effectType:c(y),depthBefore:b,depthAfter:o.length,reactionsQueued:S.length})}return{state:l,trace:f,resolvedCount:f.length}},$c=Math.sqrt(3),Xg=(e,i)=>{if(i)return e.player.id===i?e.player:e.enemies.find(s=>s.id===i)||e.companions?.find(s=>s.id===i)},Gg=e=>{if(e)return{actorId:e.id,hex:e.position}},Qg=(e,i,s=G)=>{if(!e||!i||De(e,i)!==1)return;const o=ha(e,i);if(o<0)return;const c=Ve(e,s),f=[{x:s,y:0},{x:s/2,y:-($c*s)/2},{x:-s/2,y:-($c*s)/2},{x:-s,y:0},{x:-s/2,y:$c*s/2},{x:s/2,y:$c*s/2}][o];return f?{x:c.x+f.x,y:c.y+f.y}:void 0},Rf=(e,i,s)=>{if(s)switch(s.kind){case"source_actor":return Gg(Xg(e,i.sourceId));case"target_actor":return Gg(Xg(e,i.targetId));case"source_hex":return i.sourceHex?{hex:i.sourceHex}:void 0;case"target_hex":return i.targetHex?{hex:i.targetHex}:void 0;case"contact_hex":return i.contactHex?{hex:i.contactHex}:void 0;case"contact_world":return!i.contactWorld&&!i.contactHex?void 0:{world:i.contactWorld,hex:i.contactHex};case"custom_hex":return{hex:s.hex};case"custom_world":return{world:s.world};default:return}},l0=(e,i)=>{const s=e.turnNumber||0,o=e.stackTrace?.length||0,c=i.sourceId||"env",l=i.skillId||"none",f=i.phase||"instant",h=i.salt?`.${i.salt}`:"";return`t${s}.k${o}.${c}.${l}.${f}${h}`},gv=e=>{const i=String(e).toLowerCase();return i.includes("fire")||i.includes("lava")||i.includes("explosion")?"fire":i.includes("kinetic")||i.includes("momentum")||i.includes("wallcrack")?"kinetic":i.includes("void")?"void":i.includes("arcane")?"arcane":i.includes("hidden")||i.includes("shadow")?"shadow":"neutral"},yv=(e,i={})=>{const s=gv(e),o={signature:`UI.SPAWN.${s.toUpperCase()}.${String(e).toUpperCase()}`,family:"ui",primitive:"spawn",phase:"instant",element:s,variant:e,intensity:"medium"};switch(e){case"impact":return{...o,signature:"ATK.STRIKE.PHYSICAL.IMPACT",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"impact",targetRef:{kind:"target_hex"},contactRef:{kind:"contact_world"}};case"flash":return{...o,signature:`ATK.BLAST.${i.color?"ARCANE":"NEUTRAL"}.FLASH`,family:"attack",primitive:"blast",phase:"impact",element:i.color?"arcane":"neutral",variant:"flash",targetRef:{kind:"target_hex"}};case"spearTrail":return{...o,signature:"ATK.SHOOT.PHYSICAL.SPEAR_TRAIL",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"spear",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"}};case"explosion_ring":return{...o,signature:"ATK.BLAST.FIRE.EXPLOSION_RING",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"explosion_ring",targetRef:{kind:"target_hex"},intensity:"high"};case"lavaRipple":return{...o,signature:"ENV.HAZARD.FIRE.LAVA_RIPPLE",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_ripple",targetRef:{kind:"target_hex"}};case"lavaSink":return{...o,signature:"ENV.HAZARD.FIRE.SINK",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_sink",targetRef:{kind:"target_hex"},intensity:"high"};case"wallCrack":return{...o,signature:"ENV.COLLISION.KINETIC.WALL_CRACK",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"wall_crack",contactRef:{kind:"contact_world"},targetRef:{kind:"target_hex"},intensity:"high"};case"kineticWave":return{...o,signature:"ATK.PULSE.KINETIC.WAVE",family:"attack",primitive:"pulse",phase:"impact",element:"kinetic",variant:"kinetic_wave",targetRef:{kind:"target_hex"}};case"dashBlur":return{...o,signature:"MOVE.DASH.NEUTRAL.BLUR",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"dash_blur",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"}};case"hiddenFade":return{...o,signature:"STATE.FADE.SHADOW.HIDDEN",family:"status",primitive:"state_fade",phase:"instant",element:"shadow",variant:"hidden_fade",targetRef:{kind:"target_hex"}};case"combat_text":return{...o,signature:"UI.TEXT.NEUTRAL.POPUP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"combat_text",targetRef:{kind:"target_hex"}};case"shake":return{...o,signature:"UI.SHAKE.NEUTRAL.CAMERA",family:"ui",primitive:"shake",phase:"instant",element:"neutral",variant:"camera_shake"};case"freeze":return{...o,signature:"UI.FREEZE.NEUTRAL.HITSTOP",family:"ui",primitive:"freeze",phase:"instant",element:"neutral",variant:"freeze"};case"stunBurst":return{...o,signature:"STATE.APPLY.NEUTRAL.STUN_BURST",family:"status",primitive:"status_apply",phase:"impact",element:"neutral",variant:"stun_burst",targetRef:{kind:"target_hex"}};default:return{...o,signature:`UI.SPAWN.${s.toUpperCase()}.${String(e).toUpperCase()}`,variant:String(e).toLowerCase()}}},bv=(e,i)=>{const s=i.template,o=i.phase||s.phase||"instant",c=i.sequenceId||l0(e,{sourceId:i.sourceId,skillId:i.skillId,phase:o}),l=Rf(e,i,s.sourceRef),f=Rf(e,i,s.targetRef),h=Rf(e,i,s.contactRef),b={protocol:"juice-signature/v1",signature:i.signature||s.signature,family:s.family,primitive:s.primitive,phase:o,element:i.element||s.element,variant:i.variant||s.variant,intensity:i.intensity||s.intensity,source:l,target:f,contact:h,area:i.area||s.area,direction:i.direction||s.direction,path:i.path||s.path,text:i.text||s.text,camera:i.camera||s.camera,timing:i.timing||s.timing,flags:{...s.flags||{},...i.flags||{}},meta:{turnNumber:e.turnNumber||0,stackTick:e.stackTrace?.length||0,sequenceId:c,sourceId:i.sourceId,targetId:i.targetId,skillId:i.skillId,reason:i.reason,...i.meta||{}}};return b.flags&&Object.keys(b.flags).length===0&&delete b.flags,b.meta&&Object.keys(b.meta).length===0&&delete b.meta,{type:"juice_signature",payload:b}},Jg=(e,i)=>{const s=bv(e,i);return{...e,visualEvents:[...e.visualEvents||[],s]}};var Zg={};const fl=(e,i)=>{const s=Te(i);let o=e;o.tiles===e.tiles&&(o={...o,tiles:new Map(o.tiles)});let c=o.tiles.get(s);return c?c={...c,traits:new Set(c.traits),effects:[...c.effects]}:c={baseId:"STONE",position:i,traits:new Set(mr.STONE.defaultTraits),effects:[]},c.traits.add("CORPSE"),o.tiles.set(s,c),o},xv=(e,i)=>{const s=Te(i),o=e.tiles.get(s);if(!o||!o.traits.has("CORPSE"))return e;let c=e;c.tiles===e.tiles&&(c={...c,tiles:new Map(c.tiles)});const l={...o,traits:new Set(o.traits),effects:[...o.effects]};return l.traits.delete("CORPSE"),c.tiles.set(s,l),c},vv=typeof process<"u"&&(Zg?.HOP_ENGINE_WARN==="1"||Zg?.HOP_ENGINE_DEBUG==="1"),ey={INTENT_START:1,MOVE_START:2,MOVE_END:3,ON_PASS:4,ON_ENTER:5,HAZARD_CHECK:6,STATUS_APPLY:7,DAMAGE_APPLY:8,DEATH_RESOLVE:9,INTENT_END:10},Sv=e=>{const i=e||[];let s=0;for(const o of i)o.blocking&&(s+=Number(o.suggestedDurationMs||0));return s},Gi=(e,i,s,o,c,l,f)=>{const h=e.timelineEvents||[],b=h.length,y=e.turnNumber||0,S=c.sourceId||c.targetId,v=c.stepId||`${y}:${S||"system"}`,A=c.stepId||v,M=A?[...h].reverse().find(g=>(g.stepId||g.groupId)===A):void 0;if(M){const g=ey[M.phase]||0,C=ey[i]||0;g>C&&vv&&console.warn("[TURN_STACK] Non-monotonic timeline phase order detected.",{stepId:A,previous:M.phase,next:i})}const p=`${A}:${b}:${i}`;return{...e,timelineEvents:[...h,{id:p,turn:y,actorId:S,stepId:A,phase:i,type:s,payload:o,blocking:l,groupId:v,suggestedDurationMs:f}]}},ml=(e,i)=>{const s=e.simulationEvents||[],o=`sim:${e.turnNumber||0}:${s.length}:${i.type}`;return{...e,simulationEvents:[...s,{...i,id:o,turn:e.turnNumber||0}]}},Sl=(e,i)=>{if(i)return e.player.id===i?e.player:e.enemies.find(s=>s.id===i)||e.companions?.find(s=>s.id===i)},Nf=(e,i)=>{if(i)return ae(e.player.position,i)?e.player:e.enemies.find(s=>ae(s.position,i))||e.companions?.find(s=>ae(s.position,i))},Av=new Set(["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage","burning","oil_explosion"]),Tv=new Set(["impact","flash","spearTrail","shake"]),If=(e,i,s,o,c,l)=>{if(!o)return{amount:i,outgoing:1,incoming:1,total:1};if(l&&Av.has(l))return{amount:i,outgoing:1,incoming:1,total:1};const f=Sl(e,s);if(!f)return{amount:i,outgoing:1,incoming:1,total:1};const h=rv(f,c),b=lv(o,c),y=h*b;return{amount:Math.max(0,Math.floor(i*y)),outgoing:h,incoming:b,total:y}},Zf=(e,i,s={})=>{let o={...e};const c=()=>{o.tiles===e.tiles&&(o={...o,tiles:new Map(o.tiles)})};switch(i.type){case"Displacement":{let l="";if(i.target==="self"?l=s.sourceId||o.player.id:i.target==="targetActor"?l=s.targetId||"":l=i.target,!l)break;const f=(A,M)=>M===A.player.id?A.player:A.enemies.find(p=>p.id===M),h=f(o,l);if(!h)break;const b=i.source||h?.position,y=Math.min(3200,Math.max(0,Sv(o.timelineEvents)));let S=!1;const v=!(i.simulatePath||i.path||i.isFling);if(b&&(o=Gi(o,"MOVE_START","Displacement",{origin:b,destination:i.destination,targetActorId:l},{...s,targetId:l},!0,220)),b){const A=i.path||(b?Kt(b,i.destination):void 0),M=i.simulatePath||i.isFling||!!i.path;let p=i.destination;if(M&&A){const W=f(o,l);if(!W)break;const j=Eo.processPath(W,A.slice(1),o,A.length-1,{ignoreActors:i.ignoreCollision,ignoreGroundHazards:i.ignoreGroundHazards});p=j.lastValidPos,l===o.player.id?o.player={...o.player,position:p}:o.enemies=o.enemies.map(pe=>pe.id===l?{...pe,position:p}:pe),S||(o=Gi(o,"MOVE_END","Displacement",{destination:p,targetActorId:l},{...s,targetId:l},!0,260),S=!0),j.result.effects.length>0&&(o=Gi(o,"ON_PASS","TilePath",{path:A.slice(1),targetActorId:l},{...s,targetId:l},!1,80),o=Bi(o,j.result.effects,{targetId:l})),j.result.messages.length>0&&(o.message=Ca(o.message,j.result.messages,"INFO","HAZARD"));const re=l===o.player.id||o.enemies.some(pe=>pe.id===l);if(!j.interrupt&&re){const pe=Ze.getTileAt(o,p);o=Gi(o,"ON_ENTER","TileEnter",{position:p,targetActorId:l,tileBaseId:pe?.baseId},{...s,targetId:l},!1,80);const z=f(o,l);if(!z)break;const ue=Eo.processEntry(z,pe,o);ue.effects.length>0&&(o=Bi(o,ue.effects,{targetId:l})),ue.messages.length>0&&(o.message=Ca(o.message,ue.messages,"INFO","HAZARD"))}if(j.result.newMomentum&&j.result.newMomentum>0){const pe=j.lastValidPos,z=A.length>1?A[A.length-2]:b,ue=ha(z,pe);if(ue!==-1){const ye=Rn(ue);let q=pe,le=5;for(;le>0;){const Z=ui(q,ye);if(!Ze.isWalkable(o,Z)||(l===o.player.id?o.enemies.find(Y=>Y.hp>0&&ae(Y.position,Z)):ae(o.player.position,Z)?o.player:o.enemies.find(Y=>Y.id!==l&&Y.hp>0&&ae(Y.position,Z))))break;const ee=Ze.getTileAt(o,Z);if(ee){const Y=Eo.processTransition(h,ee,o,1);if(q=Z,Y.effects.length>0&&(o=Bi(o,Y.effects,{targetId:l})),Y.messages.length>0&&(o.message=Ca(o.message,Y.messages,"INFO","HAZARD")),Y.newMomentum===0||Y.interrupt)break}else{q=Z;break}le--}p=q}}}const g=[...o.visualEvents||[]],C=!!(i.ignoreCollision||i.isFling),N=C?g.reduce((W,j)=>{if(j.type!=="kinetic_trace")return W;const re=j.payload;return re&&(re.movementType??"slide")==="slide"?W+1:W},0):0,O=v?0:C?Math.min(640,N*90):0,w=Math.max(y,O),R={actorId:l,origin:b,path:i.path||(v?[b,p]:Kt(b,p)),destination:p,movementType:v?"teleport":"slide",durationMs:i.animationDuration??(v?180:Math.max(120,(i.path?.length||Kt(b,p).length)*110)),startDelayMs:w,wasLethal:o.tiles.get(Te(p))?.traits.has("HAZARDOUS")||!1},Q=g;if(v)Q.push({type:"kinetic_trace",payload:R});else{let W=!1;for(let j=Q.length-1;j>=0;j--){const re=Q[j];if(re.type!=="kinetic_trace")continue;const pe=re.payload;if(!(!pe||pe.actorId!==l)){if((pe.movementType??"slide")==="slide"&&ae(pe.destination,R.origin)){const z=pe.path&&pe.path.length>0?pe.path:[pe.origin,pe.destination],ue=R.path&&R.path.length>0?R.path:[R.origin,R.destination],ye=[...z,...ue.slice(1)];Q[j]={type:"kinetic_trace",payload:{...R,origin:pe.origin,path:ye,durationMs:(pe.durationMs||0)+(R.durationMs||0),startDelayMs:Math.min(pe.startDelayMs??w,w),movementType:"slide",wasLethal:!!(pe.wasLethal||R.wasLethal)}},W=!0}break}}W||Q.push({type:"kinetic_trace",payload:R})}if(o.visualEvents=Q,l===o.player.id)o.player={...o.player,position:p,previousPosition:v?p:o.player.position};else{const W=j=>j.id===l?{...j,position:p,previousPosition:v?p:j.position}:j;o.enemies=o.enemies.map(W),o.companions&&(o.companions=o.companions.map(W))}o.occupancyMask=dt.refreshOccupancyMask(o),S||(o=Gi(o,"MOVE_END","Displacement",{destination:p,targetActorId:l},{...s,targetId:l},!0,260)),o=ml(o,{type:"UnitMoved",actorId:l,position:p,payload:{origin:b,destination:p,movementType:R.movementType}})}break}case"Damage":{const l=!!i.reason&&["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage"].includes(i.reason),f=C=>C?.statusEffects?.some(N=>N.type==="marked_predator")?1:0;l&&(o=Gi(o,"HAZARD_CHECK","Damage",{reason:i.reason,amount:i.amount,target:i.target},s,!0,200)),o=Gi(o,"DAMAGE_APPLY","Damage",{reason:i.reason,amount:i.amount,target:i.target,scoreEvent:i.scoreEvent},s,!0,180);let h="",b=null,y,S,v=i.amount;typeof i.target=="string"?i.target==="targetActor"?h=s.targetId||"":i.target!=="area"&&(h=i.target):b=i.target;const A=["fire_damage","lava_sink","burning","hazard_intercept","lava_tick","oil_explosion","void_sink"],M=i.reason&&A.includes(i.reason),p=o.upgrades?.includes("RELIC_EMBER_WARD"),g=o.upgrades?.includes("RELIC_CINDER_ORB");if(M&&h){const N=(h===o.player.id?o.player:o.enemies.find(w=>w.id===h))?.activeSkills?.some(w=>w.id==="ABSORB_FIRE");let O=i.amount;if(h===o.player.id&&p&&(O=Math.max(0,O-1),o.message=Gt(o.message,"Ember Ward dampens the flames.","INFO","COMBAT")),N){const w=O+(h===o.player.id&&g?1:0);return h===o.player.id&&g&&(o.message=Gt(o.message,"Cinder Orb amplifies the absorption.","INFO","COMBAT")),Zf(o,{type:"Heal",target:h,amount:w})}}if(h)if(h===o.player.id){const C=o.player,N=i.scoreEvent?.damageClass||"physical",O=If(o,i.amount,s.sourceId,C,N,i.reason);let w=O.amount;w+=f(C),M&&p&&(w=Math.max(0,w-1)),i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:w,traitOutgoingMultiplier:O.outgoing,traitIncomingMultiplier:O.incoming,traitTotalMultiplier:O.total}].slice(-500)),o.player=js(o.player,w),y=o.player.id,S=o.player.position,v=w,M&&(o.hazardBreaches=(o.hazardBreaches||0)+1),M&&g&&(o.player=Ix(o.player,1),o.message=Gt(o.message,"Cinder Orb restores 1 HP.","INFO","COMBAT"))}else{const C=o.enemies.find(j=>j.id===h),N=h===o.player.id?o.player.position:C?.position,O=[],w=i.scoreEvent?.damageClass||"physical",R=If(o,i.amount,s.sourceId,C,w,i.reason),Q=R.amount+f(C);y=h||C?.id,S=N||C?.position,v=Q;const W=j=>{if(j.id===h){const re=js(j,Q);return re.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],j],O.push(j.position)),re}return j};if(i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:Q,traitOutgoingMultiplier:R.outgoing,traitIncomingMultiplier:R.incoming,traitTotalMultiplier:R.total}].slice(-500)),o.enemies=o.enemies.map(W).filter(j=>j.hp>0),o.companions&&(o.companions=o.companions.map(W).filter(j=>j.hp>0)),O.length>0&&(o=Gi(o,"DEATH_RESOLVE","Damage",{targetActorId:h,reason:i.reason||"damage"},{...s,targetId:h},!0,260)),O.forEach(j=>{o=fl(o,j)}),N&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:N}}]),h===o.player.id&&(o.player.stealthCounter||0)>0)o.player={...o.player,stealthCounter:Math.max(0,(o.player.stealthCounter||0)-1)};else if(h!==o.player.id){const j=re=>re.id===h?{...re,stealthCounter:Math.max(0,(re.stealthCounter||0)-1)}:re;o.enemies=o.enemies.map(j),o.companions&&(o.companions=o.companions.map(j))}h===o.player.id&&o.player.archetype==="HUNTER"&&i.source&&ha(i.source,o.player.position)!==-1&&(o.message=Gt(o.message,"You roll away!","INFO","COMBAT")),C&&C.archetype==="HUNTER"&&i.source&&ha(i.source,C.position)!==-1&&(o.message=Gt(o.message,`${C.subtype||C.id} rolls away!`,"INFO","COMBAT"))}else if(b){const C=Nf(o,b),N=i.scoreEvent?.damageClass||"physical",O=If(o,i.amount,s.sourceId,C,N,i.reason),w=O.amount;y=C?.id,S=b,v=w+f(C||void 0),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:b}}],i.scoreEvent&&C&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,targetId:C.id,finalPower:w,traitOutgoingMultiplier:O.outgoing,traitIncomingMultiplier:O.incoming,traitTotalMultiplier:O.total}].slice(-500)),ae(o.player.position,b)&&(o.player=js(o.player,w+f(o.player)),M&&(o.hazardBreaches=(o.hazardBreaches||0)+1),o.player.hp<=0);const R=j=>{if(ae(j.position,b)){const re=js(j,w+f(j));return re.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],j],W.push(j.id),Q.push(j.position)),re}return j},Q=[],W=[];o.enemies=o.enemies.map(R).filter(j=>j.hp>0),o.companions&&(o.companions=o.companions.map(R).filter(j=>j.hp>0)),W.forEach(j=>{o=Gi(o,"DEATH_RESOLVE","Damage",{targetActorId:j,reason:i.reason||"area_damage"},{...s,targetId:j},!0,260)}),Q.forEach(j=>{o=fl(o,j)})}v>0&&(o=ml(o,{type:"DamageTaken",targetId:y||h||void 0,position:S,payload:{amount:v,reason:i.reason,sourceId:s.sourceId}}));break}case"Heal":{const l=y=>({...y,hp:Math.min(y.maxHp,y.hp+i.amount)}),f=i.target==="targetActor"?s.targetId:i.target;let h,b;if(f){const y=f===o.player.id?o.player:o.enemies.find(S=>S.id===f)||o.companions?.find(S=>S.id===f);if(y){const S=f===o.player.id?"You":y.subtype||y.id;if(o.message=Gt(o.message,`${S} recover ${i.amount} HP.`,"INFO","COMBAT"),f===o.player.id)o.player=l(o.player),h=o.player.id,b=o.player.position;else{const v=A=>A.id===f?l(A):A;o.enemies=o.enemies.map(v),o.companions&&(o.companions=o.companions.map(v)),h=y.id,b=y.position}}}h&&(o=ml(o,{type:"Healed",targetId:h,position:b,payload:{amount:i.amount,sourceId:s.sourceId}}));break}case"ApplyStatus":{o=Gi(o,"STATUS_APPLY","ApplyStatus",{status:i.status,duration:i.duration,target:i.target},s,!0,160);let l="",f=null;typeof i.target=="string"?i.target==="targetActor"?l=s.targetId||"":l=i.target:f=i.target;let h=f;const b=s.sourceId?s.sourceId===o.player.id?o.player:o.enemies.find(v=>v.id===s.sourceId):void 0,y=b?Vx(i.duration,tt(b)):i.duration;if(l){const v=l===o.player.id?o.player:o.enemies.find(A=>A.id===l)||o.companions?.find(A=>A.id===l);if(v){h=v.position;const A=l===o.player.id?"You":`${v.subtype||"enemy"}#${v.id}`,M=l===o.player.id?"are":"is";if(o.message=Gt(o.message,`${A} ${M} ${i.status}!`,"INFO","COMBAT"),l===o.player.id)o.player=Gf(o.player,i.status,y);else{const p=g=>g.id===l?Gf(g,i.status,y):g;o.enemies=o.enemies.map(p),o.companions&&(o.companions=o.companions.map(p))}}}i.status==="stunned"&&h&&(o.visualEvents=[...o.visualEvents||[],{type:"shake",payload:{intensity:"low"}},{type:"vfx",payload:{type:"stunBurst",position:h}},{type:"combat_text",payload:{text:"STUNNED",position:h}}]);const S=l||(h?Nf(o,h)?.id:void 0);o=ml(o,{type:"StatusApplied",targetId:S,position:h||void 0,payload:{status:i.status,duration:y,sourceId:s.sourceId}});break}case"PickupShield":{const l=i.position||o.shieldPosition;if(l&&o.shieldPosition&&ae(o.shieldPosition,l)){o.hasShield=!0,o.shieldPosition=void 0;const f={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Shield Bash.",slot:"utility",cooldown:3,currentCooldown:0,range:1,upgrades:[],activeUpgrades:[]};o.player.activeSkills.some(h=>h.id==="BULWARK_CHARGE")||(o.player={...o.player,activeSkills:[...o.player.activeSkills,f]})}break}case"PickupSpear":{const l=i.position||o.spearPosition;l&&o.spearPosition&&ae(o.spearPosition,l)&&(o.hasSpear=!0,o.spearPosition=void 0);break}case"SpawnItem":{if(i.itemType==="spear")o.spearPosition=i.position,s.sourceId===o.player.id&&(o.hasSpear=!1);else if(i.itemType==="bomb"){const l=o.initialSeed??o.rngSeed??"0",f=(o.turnNumber<<16)+(o.actionLog?.length??0)+o.enemies.length,h=`bomb-${pr(l,f,8,"bomb")}`,b=Us({id:h,type:"enemy",subtype:"bomb",factionId:"enemy",position:i.position,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});b.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.enemies=[...o.enemies,b]}else i.itemType==="shield"&&(o.shieldPosition=i.position,o.hasShield=!1);break}case"LavaSink":{o=Gi(o,"HAZARD_CHECK","LavaSink",{target:i.target},s,!0,240);const l=i.target,f=l===o.player.id?o.player:o.enemies.find(h=>h.id===l);f&&(o=Gi(o,"DEATH_RESOLVE","LavaSink",{targetId:l},{...s,targetId:l},!0,280),l===o.player.id?o.player=js(o.player,99):(o.enemies=o.enemies.filter(h=>h.id!==l),o.dyingEntities=[...o.dyingEntities||[],f],o=fl(o,f.position)),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:f.position}}]);break}case"Impact":{const l=i.target,f=l===o.player.id?o.player:o.enemies.find(h=>h.id===l);if(f){const h=i.direction,b=h?{q:f.position.q+h.q,r:f.position.r+h.r,s:f.position.s+h.s}:void 0,y=b?Qg(f.position,b):void 0;if(o=Jg(o,{template:{signature:h?"ENV.COLLISION.KINETIC.IMPACT":"ATK.STRIKE.PHYSICAL.IMPACT",family:h?"environment":"attack",primitive:h?"collision":"strike",phase:"impact",element:h?"kinetic":"physical",variant:"impact",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},contactRef:{kind:"contact_world"}},sourceId:s.sourceId,targetId:l,sourceHex:Sl(o,s.sourceId)?.position,targetHex:f.position,contactHex:b,contactWorld:y,direction:i.direction,intensity:i.damage>1?"high":"medium",flags:{blocked:!!h},meta:{legacyJuiceId:"impact",legacyMirrored:!0,reason:"impact"}}),i.damage>0)if(l===o.player.id)o.player=js(o.player,i.damage);else{const S=v=>v.id===l?js(v,i.damage):v;o.enemies=o.enemies.map(S).filter(v=>v.hp>0),o.companions&&(o.companions=o.companions.map(S).filter(v=>v.hp>0))}}break}case"Message":{o.message=[...o.message,um(i.text,"INFO","SYSTEM")].slice(-50),o=ml(o,{type:"MessageLogged",payload:{text:i.text}});break}case"Juice":{const l=i.metadata||{},f=typeof l.phase=="string"?l.phase:void 0,b={...yv(i.effect,{color:i.color,text:i.text}),...typeof l.signature=="string"?{signature:l.signature}:{},...typeof l.family=="string"?{family:l.family}:{},...typeof l.primitive=="string"?{primitive:l.primitive}:{},...typeof l.element=="string"?{element:l.element}:{},...typeof l.variant=="string"?{variant:l.variant}:{},...typeof l.sourceRef=="object"&&l.sourceRef?{sourceRef:l.sourceRef}:{},...typeof l.targetRef=="object"&&l.targetRef?{targetRef:l.targetRef}:{},...typeof l.contactRef=="object"&&l.contactRef?{contactRef:l.contactRef}:{}},y=Sl(o,s.sourceId);let S,v;typeof i.target=="string"?(S=i.target==="targetActor"?s.targetId||void 0:i.target,v=Sl(o,S)?.position):i.target?(v=i.target,S=Nf(o,i.target)?.id):s.targetId&&(S=s.targetId,v=Sl(o,s.targetId)?.position);const A=l.contactHex&&typeof l.contactHex.q=="number"?l.contactHex:void 0;let M=l.contactWorld&&typeof l.contactWorld.x=="number"?l.contactWorld:void 0;if(!M){const p=l.contactFromHex&&typeof l.contactFromHex.q=="number"?l.contactFromHex:void 0,g=l.contactToHex&&typeof l.contactToHex.q=="number"?l.contactToHex:void 0;M=Qg(p,g)}if(o=Jg(o,{template:b,sourceId:s.sourceId,targetId:S,skillId:typeof l.skillId=="string"?l.skillId:void 0,reason:typeof l.reason=="string"?l.reason:void 0,sourceHex:y?.position,targetHex:v,contactHex:A,contactWorld:M,path:i.path,direction:i.direction,phase:f,sequenceId:typeof l.sequenceId=="string"?l.sequenceId:l0(o,{sourceId:s.sourceId,skillId:typeof l.skillId=="string"?l.skillId:void 0,phase:f||b.phase,salt:i.effect}),intensity:i.intensity,text:i.text?{value:i.text,tone:typeof l.textTone=="string"?l.textTone:"system",color:i.color}:void 0,timing:typeof l.timing=="object"&&l.timing?l.timing:i.duration?{durationMs:i.duration,ttlMs:i.duration}:void 0,camera:typeof l.camera=="object"&&l.camera?l.camera:i.effect==="shake"?{shake:i.intensity||"medium"}:i.effect==="freeze"?{freezeMs:Math.max(0,Number(i.duration||80))}:void 0,area:typeof l.area=="object"&&l.area?l.area:void 0,flags:typeof l.flags=="object"&&l.flags?l.flags:void 0,meta:{legacyJuiceId:i.effect,legacyMirrored:Tv.has(i.effect),...typeof l.statusId=="string"?{statusId:l.statusId}:{}}}),i.effect==="combat_text"&&i.text&&(o.message=Gt(o.message,i.text,"VERBOSE","SYSTEM")),i.effect==="shake"&&(o.visualEvents=[...o.visualEvents||[],{type:"shake",payload:{intensity:i.intensity||"medium",direction:i.direction}}]),i.effect==="freeze"&&(o.visualEvents=[...o.visualEvents||[],{type:"freeze",payload:{durationMs:Math.max(0,Number(i.duration||80))}}]),i.effect==="impact"&&i.target){const p=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(g=>g.id===i.target)?.position:i.target;p&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:p}}])}if(i.effect==="flash"&&i.target){const p=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(g=>g.id===i.target)?.position:i.target;p&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"flash",position:p}}])}if(i.effect==="spearTrail"&&i.path&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"spear_trail",path:i.path}}]),i.effect==="lavaSink"&&i.target){const p=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(g=>g.id===i.target)?.position:i.target;if(p){const g=o.enemies.find(C=>ae(C.position,p));g&&(o.dyingEntities=[...o.dyingEntities||[],g],o.enemies=o.enemies.filter(C=>!ae(C.position,p)),o.companions&&(o.companions=o.companions.filter(C=>!ae(C.position,p))),o=fl(o,p),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:p}}])}}break}case"UpdateComponent":{const l=(f,h,b)=>{const y=new Map(f.components||[]);return y.set(h,b),{...f,components:y}};if(i.target==="self")o.player=l(o.player,i.key,i.value);else if(i.target==="targetActor"&&s.targetId)if(s.targetId===o.player.id)o.player=l(o.player,i.key,i.value);else{const f=h=>h.id===s.targetId?l(h,i.key,i.value):h;o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f))}break}case"ModifyCooldown":{const l=h=>({...h,activeSkills:h.activeSkills?.map(b=>b.id!==i.skillId?b:{...b,currentCooldown:i.setExact?i.amount:Math.max(0,b.currentCooldown+i.amount)})}),f=s.sourceId||o.player.id;f===o.player.id?o.player=l(o.player):(o.enemies=o.enemies.map(h=>h.id===f?l(h):h),o.companions&&(o.companions=o.companions.map(h=>h.id===f?l(h):h)));break}case"SpawnCorpse":{o=fl(o,i.position);break}case"RemoveCorpse":{o=xv(o,i.position),o.dyingEntities=(o.dyingEntities||[]).filter(l=>!ae(l.position,i.position));break}case"SpawnActor":{const l=Al(i.actor);o.enemies=[...o.enemies,l],l.companionOf&&(o.companions=[...o.companions||[],l]),o.initiativeQueue&&(o.initiativeQueue=Jx(o.initiativeQueue,l));break}case"PlaceFire":{const l=Te(i.position);c();let f=o.tiles.get(l);f?f={...f,traits:new Set(f.traits),effects:[...f.effects]}:f={baseId:"STONE",position:i.position,traits:new Set(mr.STONE.defaultTraits),effects:[]},o.tiles.set(l,f);const h=Eo.applyEffect(f,"FIRE",i.duration,1,o,s.sourceId);h.messages.length>0&&(o.message=Ca(o.message,h.messages,"INFO","HAZARD"));break}case"PlaceTrap":{o.traps||(o.traps=[]),o.traps=[...o.traps,{position:i.position,ownerId:i.ownerId,isRevealed:!1,cooldown:0,volatileCore:i.volatileCore,chainReaction:i.chainReaction,resetCooldown:i.resetCooldown}];break}case"RemoveTrap":{o.traps&&(i.ownerId?o.traps=o.traps.filter(l=>l.ownerId!==i.ownerId):o.traps=o.traps.filter(l=>!ae(l.position,i.position)));break}case"SetTrapCooldown":{o.traps&&(o.traps=o.traps.map(l=>i.ownerId&&l.ownerId!==i.ownerId||!ae(l.position,i.position)?l:{...l,cooldown:Math.max(0,i.cooldown)}));break}case"SetStealth":{const l=f=>({...f,stealthCounter:(f.stealthCounter||0)+i.amount});i.target==="self"?o.player=l(o.player):(o.enemies=o.enemies.map(f=>f.id===i.target?l(f):f),o.companions&&(o.companions=o.companions.map(f=>f.id===i.target?l(f):f)));break}case"UpdateCompanionState":{const l=i.target==="self"?s.sourceId||o.player.id:i.target,f=h=>h.id!==l?h:{...h,companionState:{...h.companionState,mode:i.mode||h.companionState?.mode,markTarget:i.markTarget!==void 0?i.markTarget:h.companionState?.markTarget,orbitStep:i.mode==="scout"?0:h.companionState?.orbitStep,apexStrikeCooldown:i.apexStrikeCooldown!==void 0?i.apexStrikeCooldown:h.companionState?.apexStrikeCooldown,healCooldown:i.healCooldown!==void 0?i.healCooldown:h.companionState?.healCooldown}};o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f));break}case"GameOver":{o.gameStatus="lost";break}}return o},Bi=(e,i,s={})=>{const o=e.stackTrace?.length||0,c=Wg(e,i,{apply:(b,y)=>Zf(b,y,s),describe:b=>b.type,preserveInputOrder:!0,startTick:o+1});let l=c.state,f=[...e.stackTrace||[],...c.trace];const h=Bx(l);if(h.length>0){const b=Wg(l,h,{apply:(y,S)=>Zf(y,S,{}),describe:y=>y.type,preserveInputOrder:!0,startTick:f.length+1});l=b.state,f=[...f,...b.trace]}return{...l,stackTrace:f}},ss=(e,i)=>e.type!=="Juice"?e:{...e,metadata:{...e.metadata||{},...i}},c0=e=>!!e&&typeof e.q=="number"&&typeof e.r=="number"&&typeof e.s=="number",u0=e=>c0(e)?Math.abs(e.q)+Math.abs(e.r)+Math.abs(e.s)===2:!1,d0=(e,i)=>({q:e.q-i.q,r:e.r-i.r,s:e.s-i.s}),Re={shake:(e,i)=>({type:"Juice",effect:"shake",intensity:e,direction:i,metadata:{signature:"UI.SHAKE.NEUTRAL.CAMERA",family:"ui",primitive:"shake",phase:"instant",element:"neutral",variant:"camera_shake",camera:{shake:e,...i?{kick:e==="extreme"?"heavy":e==="high"?"medium":"light"}:{}}}}),flash:e=>({type:"Juice",effect:"flash",intensity:"high",color:e,metadata:{signature:"ATK.BLAST.NEUTRAL.FLASH",family:"attack",primitive:"blast",phase:"impact",element:"neutral",variant:"flash"}}),freeze:(e=80)=>({type:"Juice",effect:"freeze",duration:e,metadata:{signature:"UI.FREEZE.NEUTRAL.HITSTOP",family:"ui",primitive:"freeze",phase:"instant",element:"neutral",variant:"hitstop",camera:{freezeMs:e},timing:{durationMs:e,ttlMs:e}}}),combatText:(e,i,s)=>({type:"Juice",effect:"combat_text",text:e,target:i,color:s}),momentumTrail:(e,i)=>({type:"Juice",effect:"momentumTrail",path:e,intensity:i}),heavyImpact:(e,i)=>({type:"Juice",effect:"heavyImpact",target:e,direction:i,intensity:"extreme"}),lightImpact:e=>({type:"Juice",effect:"lightImpact",target:e,intensity:"low"}),kineticWave:(e,i,s)=>({type:"Juice",effect:"kineticWave",target:e,direction:i,intensity:s}),stunBurst:e=>({type:"Juice",effect:"stunBurst",target:e,intensity:"medium"}),lavaRipple:e=>({type:"Juice",effect:"lavaRipple",target:e,intensity:"medium"}),wallCrack:(e,i)=>({type:"Juice",effect:"wallCrack",target:e,direction:i,intensity:"high"}),explosionRing:e=>({type:"Juice",effect:"explosion_ring",target:e})};Re.combatText=(e=>(i,s,o)=>ss(e(i,s,o),{signature:"UI.TEXT.NEUTRAL.POPUP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"combat_text",targetRef:typeof s=="string"?{kind:"target_actor"}:{kind:"target_hex"},textTone:/^[-]/.test(i)?"damage":/^\+/.test(i)?"heal":"system"}))(Re.combatText);Re.momentumTrail=(e=>(i,s)=>ss(e(i,s),{signature:"MOVE.DASH.KINETIC.MOMENTUM_TRAIL",family:"movement",primitive:"dash",phase:"travel",element:"kinetic",variant:"momentum_trail"}))(Re.momentumTrail);Re.heavyImpact=(e=>(i,s)=>{const o={signature:"ATK.STRIKE.PHYSICAL.HEAVY",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"heavy_impact",sourceRef:{kind:"source_actor"}};return c0(i)?(o.targetRef={kind:"target_hex"},s&&u0(s)&&(o.contactHex=i,o.contactToHex=i,o.contactFromHex=d0(i,s),o.contactRef={kind:"contact_world"})):o.targetRef={kind:"target_actor"},ss(e(i,s),o)})(Re.heavyImpact);Re.lightImpact=(e=>i=>ss(e(i),{signature:"ATK.STRIKE.PHYSICAL.LIGHT",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"light_impact",sourceRef:{kind:"source_actor"},targetRef:typeof i=="string"?{kind:"target_actor"}:{kind:"target_hex"}}))(Re.lightImpact);Re.kineticWave=(e=>(i,s,o)=>ss(e(i,s,o),{signature:"ATK.PULSE.KINETIC.WAVE",family:"attack",primitive:"pulse",phase:"impact",element:"kinetic",variant:"kinetic_wave",targetRef:{kind:"target_hex"},sourceRef:{kind:"source_hex"}}))(Re.kineticWave);Re.stunBurst=(e=>i=>ss(e(i),{signature:"STATE.APPLY.NEUTRAL.STUN_BURST",family:"status",primitive:"status_apply",phase:"impact",element:"neutral",variant:"stun_burst",targetRef:typeof i=="string"?{kind:"target_actor"}:{kind:"target_hex"}}))(Re.stunBurst);Re.lavaRipple=(e=>i=>ss(e(i),{signature:"ENV.HAZARD.FIRE.LAVA_RIPPLE",family:"environment",primitive:"hazard_burst",phase:"impact",element:"fire",variant:"lava_ripple",targetRef:{kind:"target_hex"}}))(Re.lavaRipple);Re.wallCrack=(e=>(i,s)=>{const o={signature:"ENV.COLLISION.KINETIC.WALL_CRACK",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"wall_crack",targetRef:{kind:"target_hex"}};return u0(s)&&(o.contactHex=i,o.contactToHex=i,o.contactFromHex=d0(i,s),o.contactRef={kind:"contact_world"}),ss(e(i,s),o)})(Re.wallCrack);Re.explosionRing=(e=>i=>ss(e(i),{signature:"ATK.BLAST.FIRE.EXPLOSION_RING",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"explosion_ring",targetRef:{kind:"target_hex"}}))(Re.explosionRing);const nn={GRAPPLE_HOOK:{anticipation:(e,i)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,i],intensity:"low",color:"#00ff88"}],execution:e=>[{type:"Juice",effect:"hookCable",path:e,intensity:"medium",duration:200,color:"#00ff88"},Re.shake("low")],impact:(e,i)=>[{type:"Juice",effect:"grappleHookWinch",target:e,direction:i,intensity:"high",duration:150},Re.shake("medium",i)],resolution:(e,i)=>[Re.momentumTrail(e,i>6?"high":"medium"),Re.kineticWave(e[0],e[e.length-1],"high")]},SHIELD_THROW:{anticipation:(e,i)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,i],intensity:"medium",color:"#4169e1"}],execution:e=>[{type:"Juice",effect:"shieldArc",path:e,intensity:"high",duration:300,metadata:{rotation:720}},{type:"Juice",effect:"shieldSpin",path:e,intensity:"medium"}],impact:(e,i)=>[Re.heavyImpact(e,i),Re.shake("high",i),Re.freeze(120),Re.combatText("IMPACT!",e,"#ff4444")],resolution:e=>[Re.kineticWave(e[0],e[e.length-1],"high"),Re.momentumTrail(e,"high")]},DASH:{anticipation:(e,i)=>[{type:"Juice",effect:"chargeUp",target:e,direction:i,intensity:"medium",duration:100}],execution:e=>[{type:"Juice",effect:"dashBlur",path:e,intensity:"high",duration:150},Re.momentumTrail(e,"medium")],impact:(e,i,s)=>s?[Re.heavyImpact(e,i),Re.shake("extreme",i),Re.freeze(100),Re.combatText("SHUNT!",e,"#ffaa00")]:[Re.lightImpact(e)],resolution:e=>e?[Re.kineticWave(e[0],e[e.length-1],"high"),Re.momentumTrail(e,"high")]:[]},SPEAR_THROW:{anticipation:(e,i)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,i],intensity:"low",color:"#ff6b6b"}],execution:e=>[{type:"Juice",effect:"spearTrail",path:e,intensity:"high",duration:150},{type:"Juice",effect:"spearWhistle",path:e,intensity:"medium",metadata:{pitch:"rising"}}],impact:(e,i)=>i?[Re.heavyImpact(e),Re.shake("medium"),Re.freeze(60),Re.combatText("LETHAL",e,"#ff0000")]:[Re.lightImpact(e),Re.combatText("MISS",e,"#888888")],resolution:()=>[]},VAULT:{anticipation:(e,i)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,i],intensity:"low",color:"#00ddff",metadata:{arc:"high"}}],execution:e=>[{type:"Juice",effect:"vaultLeap",path:e,intensity:"medium",duration:250,metadata:{arc:"parabolic"}}],impact:(e,i)=>i?[Re.heavyImpact(e),Re.shake("medium"),Re.stunBurst(e),Re.combatText("STUN!",e,"#ffff00")]:[Re.lightImpact(e)],resolution:()=>[]}},Lf={lavaSink:e=>[{type:"Juice",effect:"lavaSink",target:e,intensity:"extreme",duration:500,metadata:{particleCount:50}},Re.lavaRipple(e),Re.shake("high"),Re.combatText("CONSUMED",e,"#ff4400")],wallImpact:(e,i,s)=>{const o=[Re.wallCrack(e,i),Re.shake("high",i)];return s&&(o.push(Re.stunBurst(e)),o.push(Re.combatText("STUNNED",e,"#ffaa00"))),o},voidConsume:e=>[{type:"Juice",effect:"voidConsume",target:e,intensity:"extreme",duration:800,color:"#000000"},Re.freeze(150),Re.combatText("VOID",e,"#8800ff")]};function vu(e,i){const{origin:s,direction:o,momentum:c}=i,l=[];l.push(Re.kineticWave(s,o,c>6?"high":"medium"));const f=ui(s,{q:o.q*(c+10),r:o.r*(c+10),s:o.s*(c+10)}),h=Kt(s,f);let b=c,y=Ev(e,h);for(;b>0&&y.length>0;){const S=_v(y);if(S.length===0)break;const v=S.length;if(b<v){const O=S[S.length-1],w=b;b=0;const R=[h[O.pos1D]];for(let Q=0;Q<w;Q++){const W=O.pos1D+1,j=h[W];if(!j||!qs(j,e.gridWidth,e.gridHeight)||ty(e,j)){l.push({type:"Impact",target:O.id,damage:w-Q,direction:o});break}if(O.pos1D=W,R.push(j),ny(e,j)){l.push({type:"LavaSink",target:O.id}),l.push(...Lf.lavaSink(j));break}}R.length>1&&(l.push({type:"Displacement",target:O.id,destination:R[R.length-1],path:R,animationDuration:R.length*80}),l.push(Re.momentumTrail(R,"medium")));break}const A=S[S.length-1],M=A.pos1D+1,p=h[M];if(!p||!qs(p,e.gridWidth,e.gridHeight)||ty(e,p)){l.push({type:"ApplyStatus",target:A.id,status:"stunned",duration:1}),p&&l.push(...Lf.wallImpact(p,o,!0));break}const g=new Map;for(const O of S){const w=h[O.pos1D];O.pos1D+=1;const R=h[O.pos1D];g.set(O.id,[w,R])}const C=[...S].reverse();for(const O of C){const w=g.get(O.id);w&&l.push({type:"Displacement",target:O.id,destination:w[w.length-1],path:w,ignoreCollision:!0,animationDuration:150})}const N=Array.from(g.values()).flat();N.length>0&&l.push(Re.momentumTrail(N,v>2?"high":"medium")),b-=v;for(let O=y.length-1;O>=0;O--){const w=y[O],R=h[w.pos1D];ny(e,R)&&(l.push({type:"LavaSink",target:w.id}),l.push(...Lf.lavaSink(R)),y.splice(O,1))}if(b>0){const O=S[S.length-1];y=y.filter(R=>R.pos1D>=O.pos1D);const w=y.filter(R=>R.pos1D>O.pos1D);y=[O,...w]}}return l}function Ev(e,i){const s=[],o=[e.player,...e.enemies];for(const c of o){const l=i.findIndex(f=>ae(f,c.position));l!==-1&&s.push({id:c.id,pos1D:l})}return s.sort((c,l)=>c.pos1D-l.pos1D)}function _v(e){if(e.length===0)return[];const i=[];let s=e[0];i.push(s);for(let o=1;o<e.length;o++){const c=e[o];if(c.pos1D===s.pos1D||c.pos1D===s.pos1D+1)i.push(c),s=c;else break}return i}function ty(e,i){const s=Ze.getTraitsAt(e,i);return s.has("BLOCKS_MOVEMENT")||s.has("BLOCKS_LOS")}function ny(e,i){const s=Ze.getTraitsAt(e,i);return s.has("HAZARDOUS")||s.has("LIQUID")}function wv(e,i,s,o){const c=De(i.position,s);if(c<=1)return[];const l=ha(s,i.position),f=Rn(l);return vu(e,{origin:s,direction:f,momentum:Math.min(o,c-1)})}function Mv(e,i){return[{type:"Displacement",target:e.id,destination:i.position},{type:"Displacement",target:i.id,destination:e.position}]}function Ov(e,i,s,o){return vu(e,{origin:i,direction:s,momentum:o})}const Cv={id:"grapple_hook",name:"Grapple Hook",description:"Tests for grapple hook mechanics including LoS, lava sinking, and weight-based behavior",scenarios:[{id:"hook_lava_intercept",title:"Lava Interceptor & LoS",description:"Verify LoS blocking and Lava killing targets.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["lava","line-of-sight","displacement"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},["GRAPPLE_HOOK"]),e.spawnEnemy("footman",{q:4,r:4,s:-8},"target1"),e.spawnEnemy("footman",{q:7,r:3,s:-10},"hidden"),e.setTile({q:6,r:4,s:-10},"wall"),e.setTile({q:4,r:5,s:-9},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:3,s:-10}),e.useSkill("GRAPPLE_HOOK",{q:4,r:4,s:-8}),e.wait(),e.wait()},verify:(e,i)=>{const s=e.player,o=e.enemies.find(l=>l.id==="target1"),c={playerInOriginalPosition:s.position.q===4&&s.position.r===6&&s.position.s===-10,target1Dead:!o,losWarning:i.some(l=>l.includes("Line of sight"))};return Object.values(c).some(l=>l===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Logs:",i)),Object.values(c).every(l=>l===!0)}},{id:"hook_wall_anchor_zip",title:"Heavy Zip to Wall",description:"Verify zipping to a wall and stunning nearby enemies.",relatedSkills:["GRAPPLE_HOOK"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["wall","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK"]),e.setTile({q:6,r:3,s:-9},"wall"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"blocker"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"stunMe"),e.spawnEnemy("footman",{q:7,r:5,s:-12},"noStun")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:6,r:3,s:-9}),e.useSkill("GRAPPLE_HOOK",{q:6,r:6,s:-12})},verify:(e,i)=>{const s=e.enemies.find(l=>l.id==="stunMe"),o=e.enemies.find(l=>l.id==="noStun"),c={stunnedEnemy:!!(s&&s.statusEffects.some(l=>l.type==="stunned")),safeEnemy:!!(o&&!o.statusEffects.some(l=>l.type==="stunned")),zipLog:i.some(l=>l.includes("Zipped")),lavaSinkLog:i.some(l=>l.includes("Lava Sink"))};return Object.values(c).some(l=>l===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Player Pos:",e.player.position),console.log("Victim Status:",s?.statusEffects)),Object.values(c).every(l=>l===!0)}}]},kv={id:"shield_throw",name:"Shield Throw",description:"Tests for shield throw mechanics including push, stun, and collision behavior",scenarios:[{id:"shield_stun_push",title:"Standard Push",description:"Verify 4-tile push in a straight line.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,i)=>{const s=e.enemies.find(c=>c.id==="victim"),o={victimAt1:s?.position.r===1,victimStunned:i?.some(c=>c.includes("stunned"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Shield Throw Failed:",o),console.log("Enemy Pos:",s?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"shield_unit_collision",title:"Unit Collision",description:"Verify push stops when hitting another unit.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim"),e.spawnEnemy("shieldbearer",{q:3,r:3,s:-6},"obstacle"),e.setTile({q:3,r:1,s:-4},"lava")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,i)=>{const s=e.enemies.find(l=>l.id==="victim"),o=e.enemies.find(l=>l.id==="obstacle"),c={victimPushed:(s?.position.r??5)===3,obstacleDead:!o};return Object.values(c).some(l=>l===!1)&&(console.log(" Shield Throw Failed:",c),console.log("Victim Pushed:",c.victimPushed),console.log("Victim Pos:",s?.position),console.log("Obstacle Dead:",c.obstacleDead),console.log("Logs:",i)),Object.values(c).every(l=>l===!0)}}]},Rv={id:"auto_attack",name:"Auto Attack",description:"Tests for auto-attack passive skill including turn-start memory and friendly fire logic",scenarios:[{id:"auto_attack_persistence_stress_test",title:"Persistence: Three-Point Validation",description:"Verifies that Auto-Attack only hits units that were adjacent at BOTH start and end.",relatedSkills:["AUTO_ATTACK","BASIC_MOVE"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","spatial-memory","edge-case"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["AUTO_ATTACK","BASIC_MOVE"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"persistent_foe"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"new_neighbor"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"former_neighbor"),e.state.player.previousPosition={q:4,r:5,s:-9}},run:e=>{e.move({q:4,r:6,s:-10})},verify:(e,i)=>{const s=e.enemies.find(f=>f.id==="persistent_foe"),o=e.enemies.find(f=>f.id==="new_neighbor"),c=e.enemies.find(f=>f.id==="former_neighbor"),l={persistentDead:!s||s.hp<s.maxHp,ignoredNew:o&&o.hp===o.maxHp,ignoredFormer:c&&c.hp===c.maxHp,logFound:i.some(f=>f.includes("attacked footman"))};return Object.values(l).some(f=>f===!1)&&(console.log(" Scenario Failed Details:",l),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i)),Object.values(l).every(f=>f===!0)}},{id:"enemy_auto_attack_no_friendly_fire",title:"Enemy Auto-Attack: Team Alignment",description:"Ensures enemy passives only target the player and not their own allies.",relatedSkills:["AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","alignment","friendly-fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},[]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"enemy_attacker");const i=e.state.enemies.find(s=>s.id==="enemy_attacker");i&&(i.activeSkills=[{id:"AUTO_ATTACK",range:1}],i.previousPosition={q:3,r:5,s:-8}),e.spawnEnemy("shieldBearer",{q:2,r:6,s:-8},"enemy_ally"),i.previousPosition={q:3,r:5,s:-8},e.state.player.previousPosition={q:3,r:6,s:-9}},run:e=>{e.wait()},verify:(e,i)=>{const s=e.player,o=e.enemies.find(l=>l.id==="enemy_ally"),c={playerHit:s.hp<s.maxHp,allySafe:o&&o.hp===o.maxHp,hitPlayerLog:i.some(l=>l.includes("attacked you")),hitAllyLog:!i.some(l=>l.includes("attacked enemy_ally"))};return Object.values(c).some(l=>l===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i)),Object.values(c).every(l=>l===!0)}}]},Nv={id:"integration",name:"Integration Tests",description:"Multi-skill integration scenarios testing complex interactions",scenarios:[{id:"environmental_chain_reaction",title:"Environmental Chain Reaction",description:"Test complex environmental interactions with multiple hazards",relatedSkills:["GRAPPLE_HOOK","SHIELD_THROW"],category:"hazards",difficulty:"advanced",isTutorial:!1,tags:["lava","wall","environmental-kill","chain-reaction"],setup:e=>{e.setPlayer({q:5,r:4,s:-9},["GRAPPLE_HOOK","SHIELD_THROW"]),e.spawnEnemy("shieldbearer",{q:5,r:2,s:-7},"victim1"),e.spawnEnemy("footman",{q:5,r:6,s:-11},"victim2"),e.spawnEnemy("footman",{q:5,r:7,s:-12},"victim3"),e.setTile({q:5,r:8,s:-13},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:5,r:2,s:-7}),e.useSkill("SHIELD_THROW",{q:5,r:5,s:-10})},verify:(e,i)=>{const s=e.player.position.q===5&&e.player.position.r===3,o=!e.enemies.find(y=>y.id==="victim3")||!!e.dyingEntities?.find(y=>y.id==="victim3"),c=!e.enemies.find(y=>y.id==="victim2")||!!e.dyingEntities?.find(y=>y.id==="victim2"),l=e.enemies.find(y=>y.id==="victim1"),f=l&&i.some(y=>y.includes("stunned")),h=l&&l.position.q===5&&l.position.r===6,b=[s,o,c,f,h];return Object.values(b).some(y=>y===!1)&&(console.log(" Environmental Chain Reaction Failed:",b),console.log("Player at 5,3:",s),console.log("Player Pos:",e.player.position),console.log("Logs found:",i),console.log("Victim1 at 5,6:",h),console.log("Victim1 Pos:",l?.position),console.log("Victim1 Stunned:",f),console.log("Victim2 Dead:",c),console.log("Victim3 Dead:",o)),Object.values(b).every(y=>y===!0)}},{id:"auto_attack_after_grapple",title:"Auto-Attack After Grapple",description:"Verify auto-attack triggers correctly after grapple displacement",relatedSkills:["GRAPPLE_HOOK","AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","displacement","integration"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK","AUTO_ATTACK"]),e.state.player.previousPosition={q:4,r:6,s:-10},e.spawnEnemy("footman",{q:7,r:6,s:-13},"grappleHookTarget"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"safe"),e.spawnEnemy("footman",{q:4,r:5,s:-9},"auto-attacked"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"safe2")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:6,s:-13})},verify:(e,i)=>{const s=e.enemies.find(h=>h.id==="grappleHookTarget"),o=e.enemies.find(h=>h.id==="auto-attacked"),c=e.enemies.find(h=>h.id==="safe"),l=e.enemies.find(h=>h.id==="safe2"),f={targetPulled:!!(s&&s.position.q<7),targetNotHit:!!(s&&s.hp===s.maxHp),safeNotHit:!!(c&&c.hp===c.maxHp),safe2NotHit:!!(l&&l.hp===l.maxHp),autoattackedDead:!o||o.hp<=0};return Object.values(f).some(h=>h===!1)&&(console.log(" Scenario Failed Details:",f),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i),console.log("target Pos:",s?.position.q),console.log("target Pulled:",f.targetPulled),console.log("target Not Hit:",f.targetNotHit),console.log("safe Not Hit:",f.safeNotHit),console.log("safe2 Not Hit:",f.safe2NotHit),console.log("autoattacked Dead:",f.autoattackedDead)),Object.values(f).every(h=>h===!0)}}]},Iv="modulepreload",Lv=function(e){return"/Hop/"+e},iy={},Bv=function(i,s,o){let c=Promise.resolve();if(s&&s.length>0){let y=function(S){return Promise.all(S.map(v=>Promise.resolve(v).then(A=>({status:"fulfilled",value:A}),A=>({status:"rejected",reason:A}))))};var f=y;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),b=h?.nonce||h?.getAttribute("nonce");c=y(s.map(S=>{if(S=Lv(S),S in iy)return;iy[S]=!0;const v=S.endsWith(".css"),A=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${S}"]${A}`))return;const M=document.createElement("link");if(M.rel=v?"stylesheet":Iv,v||(M.as="script"),M.crossOrigin="",M.href=S,b&&M.setAttribute("nonce",b),document.head.appendChild(M),v)return new Promise((p,g)=>{M.addEventListener("load",p),M.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${S}`)))})}))}function l(h){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=h,window.dispatchEvent(b),!b.defaultPrevented)throw h}return c.then(h=>{for(const b of h||[])b.status==="rejected"&&l(b.reason);return i().catch(l)})},Hv=async(e,i)=>{if(typeof window>"u")try{(await Bv(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])).appendFileSync(e,i)}catch(s){console.warn(`Failed to persist log to ${e}:`,s)}},jv={id:"basic_attack",name:"Basic Attack",description:"Tests for basic melee attack mechanics including range and move-to-attack logic",scenarios:[{id:"basic_attack_player_mechanics",title:"Player Basic Attack: Range & Bump",description:"Validates range enforcement, turn accounting, and bump-attack redirection.",relatedSkills:["BASIC_ATTACK"],category:"combat",tags:["melee","targeting","bump-attack"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"far_victim")},run:e=>{e.useSkill("BASIC_ATTACK",{q:3,r:4,s:-7}),e.move({q:3,r:5,s:-8})},verify:(e,i)=>{const s=e.enemies.find(l=>l.id==="adj_victim"),o=e.enemies.find(l=>l.id==="far_victim"),c={farStaysAlive:o&&o.hp===o.maxHp,rangeError:i.some(l=>l.includes("out of range")),adjTookDamage:!s||s.hp<=s.maxHp,playerPositionHeld:ae(e.player.position,{q:3,r:6,s:-9}),oneTurnConsumed:e.turnsSpent===1};if(Object.values(c).some(l=>l===!1)){const l=` Basic Attack Failed: ${JSON.stringify(c)}
Current Player Pos: ${JSON.stringify(e.player.position)}
Logs: ${JSON.stringify(i)}
`;console.log(l),Hv("integration_debug.txt",l)}return Object.values(c).every(l=>l===!0)}}]},Dv={id:"spear_throw",name:"Spear Throw",description:"Tests for spear throw mechanics including range, LoS, and spear retrieval",scenarios:[{id:"spear_kill",title:"Spear Kill",description:"Throw spear to kill an enemy and verify item spawn.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["projectile","combat","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:3,r:4,s:-7},"target"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,i)=>{const s=!e.enemies.find(l=>l.id==="target"),o=!!e.spearPosition&&e.spearPosition.q===3&&e.spearPosition.r===4,c=i.some(l=>l.includes("Spear killed"));return s&&o&&c}},{id:"spear_miss_spawn",title:"Spear Rejects Empty Tile",description:"Enemy-only contract: empty tiles are invalid targets and do not spawn spear.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,i)=>{const s=i.some(c=>c.includes("No enemy at target.")),o=e.hasSpear===!0&&!e.spearPosition;return s&&o}},{id:"spear_wall_block",title:"Spear Wall Block",description:"Spear throw is blocked by walls.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["projectile","wall","boundary"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),e.setTile({q:4,r:4,s:-8},"wall"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:4,r:3,s:-7})},verify:(e,i)=>{const s=i.some(l=>l.includes("No clear line of sight to enemy.")),o=!!e.enemies.find(l=>l.id==="target"),c=e.hasSpear===!0&&!e.spearPosition;return s&&o&&c}}]},Pv={id:"dash",name:"Dash",description:"Tests for dash mechanics including path validation and shield-based enemy shunting",scenarios:[{id:"dash_shunt_lava",title:"Shunt into Lava",description:"Shunt an enemy into lava for an environmental kill.",relatedSkills:["DASH"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:5,s:-8},["DASH"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"victim"),e.setTile({q:7,r:5,s:-12},"lava"),e.state.hasShield=!0},run:e=>{e.useSkill("DASH",{q:5,r:5,s:-10})},verify:(e,i)=>{const s=e.enemies.find(c=>c.id==="victim"),o={playerPosition:e.player.position.q===5&&e.player.position.r===5,victimDead:!s};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Shunt Lava Failed:",o),console.log("Final State:",e.player.position),console.log("Victim Pos:",s?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"dash_comprehensive_validation",title:"Dash: Constraints & Shunt Physics",description:"Validates range limits, wall blocking, and Shield Shunt displacement in one sequence.",relatedSkills:["DASH"],category:"movement",difficulty:"advanced",isTutorial:!1,tags:["stress-test","collision","range"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["DASH"]),e.state.hasShield=!0,e.setTile({q:4,r:4,s:-8},"wall"),e.setTile({q:6,r:5,s:-11},"wall"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"victim")},run:e=>{e.useSkill("DASH",{q:4,r:7,s:-11}),e.useSkill("DASH",{q:7,r:4,s:-11}),e.useSkill("DASH",{q:6,r:6,s:-12}),e.useSkill("DASH",{q:4,r:5,s:-9})},verify:(e,i)=>{const s=e.enemies.find(c=>c.id==="victim"),o={finalPositionCorrect:e.player.position.q===4&&e.player.position.r===6,victimPushed:!!(s&&s.position.q===4&&s.position.r===5),wallErrorFound:i.some(c=>c.includes("wall blocks")),axialRangeErrorFound:i.some(c=>c.includes("Axial only!")),shuntSuccess:i.some(c=>c.includes("Shield Shunt")),twoTurnSpent:e.turnsSpent===2};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Stress Test Failed:",o),console.log("Final State:",e.player.position),console.log("Victim Pos:",s?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},Uv={id:"jump",name:"Jump",description:"Tests for jump mechanics including range validation and stunning landing",scenarios:[{id:"jump_basic",title:"Basic Jump",description:"Jump to a tile.",relatedSkills:["JUMP"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","leap"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.setTile({q:3,r:5,s:-8},"lava")},run:e=>{e.useSkill("JUMP",{q:3,r:4,s:-7})},verify:(e,i)=>{const s=ae(e.player.position,{q:3,r:4,s:-7}),o=Wf(e.occupancyMask,{q:3,r:4}),c=!Wf(e.occupancyMask,{q:3,r:6}),l={playerInPosition:s,spatialMaskRefreshed:o&&c,noLavaDamage:e.player.hp===e.player.maxHp,jumpedSuccessfully:i.some(f=>f.includes("Jumped"))};return Object.values(l).some(f=>f===!1)&&(console.error(" Jump Basic Failed:",l),console.error("Final State:",e.player.position),console.error("Logs:",i)),Object.values(l).every(f=>f===!0)}},{id:"jump_stunning_landing",title:"Stunning Landing",description:"Jump into a group of enemies and ensure neighbors are stunned.",relatedSkills:["JUMP"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["movement","stun","aoe"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.addUpgrade("JUMP","STUNNING_LANDING"),e.spawnEnemy("footman",{q:3,r:7,s:-10},"neighbor_1"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"neighbor_2"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"distant_enemy")},run:e=>{e.useSkill("JUMP",{q:3,r:8,s:-11})},verify:(e,i,s=[])=>{const o={n1StunnedMessage:i.some(c=>c.includes("stunned by landing impact")),hasShakeJuice:s.some(c=>c.type==="shake"),hasStunBurstVFX:s.some(c=>c.type==="vfx"&&c.payload.type==="stunBurst"),hasStunnedCombatText:s.some(c=>c.type==="combat_text"&&c.payload.text==="STUNNED"),playerAtTarget:ae(e.player.position,{q:3,r:8,s:-11}),oneTurnSpent:e.turnsSpent===1};return Object.values(o).some(c=>c===!1)&&(console.error(" Jump Stunning Landing Failed:",o),console.error("Final State:",e.player.position),console.error("turnsSpent:",e.turnsSpent),console.error("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},qv={id:"shield_bash",name:"Shield Bash",description:"Tests for shield bash mechanics including push, stun, and collision behavior",scenarios:[{id:"bash_push",title:"Shield Push",description:"Push an enemy into lava.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","lava"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.setTile({q:3,r:4,s:-7},"lava"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,i)=>{const s={enemyGone:e.enemies.length===0,messageOk:i.some(o=>o.includes("Lava"))};return Object.values(s).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",s),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i)),Object.values(s).every(o=>o===!0)}},{id:"bash_wall_stun",title:"Wall Slam Stun",description:"Bash enemy into wall to cause a stun.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"victim"),e.setTile({q:3,r:4,s:-7},"wall")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,i)=>{const s=e.enemies.find(l=>l.id==="victim");if(!s)return!1;const o=ae(s.position,{q:3,r:5,s:-8}),c=i.some(l=>l.includes("into obstacle"));return o&&c}}]},zv={id:"bulwark_charge",name:"Bulwark Charge",description:"Tests for bulwark charge mechanics including chain pushing and wall slamming",scenarios:[{id:"chain_stun",title:"The Chain-Stun",description:"Wall prevents chain movement, causing all members to be stunned.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["chain","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,i)=>!0},{id:"bulwark_chain_push",title:"Bulwark Chain Push",description:"Push a chain of enemies successfully.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["chain","push","displacement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"A"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"B"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,i)=>!0}]},$v={id:"vault",name:"Vault",description:"Tests for vault mechanics including state-shifting behavior between odd and even turns",scenarios:[{id:"vault_shift_stun",title:"Vault Stun (Odd Turn)",description:"Verify vault stuns neighbors on Turn 1.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","stun","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>{const s={stunned:i.some(o=>o.includes("Stun Vault executed!"))};return Object.values(s).some(o=>o===!1)&&(console.log(" Vault Stun Failed:",s),console.log("Logs:",i)),Object.values(s).every(o=>o===!0)}},{id:"vault_shift_normal",title:"Vault Normal (Even Turn)",description:"Verify vault is normal on Turn 2.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:3,s:-7},"victim")},run:e=>{e.wait(),e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>{const s={vaulted:i.some(o=>o.includes("Vaulted!"))};return Object.values(s).some(o=>o===!1)&&(console.log(" Vault Normal Failed:",s),console.log("Logs:",i)),Object.values(s).every(o=>o===!0)}}]},Vv={id:"basic_move",name:"Basic Move",description:"Fundamental movement mechanics",scenarios:[{id:"walk_to_tile",title:"Movement 101",description:"Move your character from the center to an adjacent tile.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","basics"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.setTile({q:4,r:6,s:-10},"wall")},run:e=>{e.move({q:4,r:6,s:-10}),e.move({q:4,r:4,s:-8})},verify:(e,i)=>{const s={positionCorrect:ae(e.player.position,{q:4,r:4,s:-8}),logFound:i.some(o=>o.includes("blocked")),oneTurnSpent:e.turnsSpent===1};return Object.values(s).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",s),console.log("Final Position:",e.player.position),console.log("Logs found:",i)),Object.values(s).every(o=>o===!0)}},{id:"free_move_out_of_combat",title:"Exploration Mode",description:"Verify that movement range expands only when no enemies are present.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["movement","exploration","free-move"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE","BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim")},run:e=>{e.move({q:7,r:1,s:-8}),e.useSkill("BASIC_ATTACK",{q:3,r:5,s:-8}),e.move({q:7,r:1,s:-8})},verify:(e,i)=>{const s=i.filter(l=>l.toLowerCase().includes("out of reach")).length,o=i.some(l=>l.toLowerCase().includes("you attacked")),c={wasBlockedInitially:s===1,attackLogs:o,reachedDistantHex:ae(e.player.position,{q:7,r:1,s:-8})};return Object.values(c).some(l=>l===!1)&&(console.log(" Free Move Scenario Failed:",c),console.log("Final Position:",e.player.position),console.log("Logs found:",i)),Object.values(c).every(l=>l===!0)}},{id:"invalid_enemy_move_intent_is_rejected_pre_execution",title:"Move Intent Rejected Before Execution",description:"Enemy AI may decide to move, but execution must not run a skill the actor does not own.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["movement","validation","intent"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"attacker_without_move");const i=e.getEnemy("attacker_without_move");i&&(i.activeSkills=(i.activeSkills||[]).filter(s=>s.id!=="BASIC_MOVE"))},run:e=>{e.wait()},verify:(e,i)=>{const s=e.enemies.find(c=>c.id==="attacker_without_move"),o={enemyDidNotMove:!!s&&ae(s.position,{q:7,r:5,s:-12}),noMissingSkillRuntimeError:!i.some(c=>c.includes("does not have skill BASIC_MOVE"))};return Object.values(o).some(c=>c===!1)&&(console.log("Invalid Enemy Move Intent Rejection Failed:",o),console.log("Enemy:",s),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"single_enemy_single_action_per_turn",title:"Single Action Per Actor Turn",description:"Each actor resolves exactly one action per turn in normal flow.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["turn-loop","movement","integrity"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"single_actor")},run:e=>{e.wait()},verify:(e,i)=>{const s={q:7,r:5,s:-12},o=e.enemies.find(f=>f.id==="single_actor"),c=o?De(s,o.position):-1,l={enemyExists:!!o,movedExactlyOneTile:c===1,noZeroEffectMoveWarning:!i.some(f=>f.includes("produced ZERO effects"))};return Object.values(l).some(f=>f===!1)&&(console.log("Single Action Per Actor Turn Failed:",l),console.log("Enemy:",o),console.log("Logs:",i)),Object.values(l).every(f=>f===!0)}}]},Bs=e=>{const s={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},SENTINEL_TELEGRAPH:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Telegraph",description:"Marks blast zone."},SENTINEL_BLAST:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Blast",description:"Massive area blast."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:s.name,description:s.description,slot:s.slot,cooldown:s.cooldown,currentCooldown:0,range:s.range,upgrades:[],activeUpgrades:[]}},Yv={id:"sentinel_blast",name:"Sentinel Blast",description:"Sentinel unique area-of-effect attack",scenarios:[{id:"blast_aoe",title:"Blast Away",description:"Use Sentinel Blast to hit multiple enemies.",relatedSkills:["SENTINEL_BLAST"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["aoe","damage","sentinel"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SENTINEL_BLAST"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"center"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"side")},run:e=>{e.useSkill("SENTINEL_BLAST",{q:3,r:5,s:-8})},verify:(e,i)=>i.some(s=>s.includes("massive blast"))},{id:"sentinel_playlist_two_turn_timing",title:"Playlist: Telegraph then Execute",description:"Boss uses a 2-turn skill playlist: telegraph first, blast on next turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["boss","playlist","telegraph"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=e.getEnemy("boss");i&&(i.activeSkills=[Bs("BASIC_MOVE"),Bs("BASIC_ATTACK"),Bs("SENTINEL_TELEGRAPH"),Bs("SENTINEL_BLAST")])},run:e=>{e.wait(),e.logs.push(`HP_AFTER_TELEGRAPH=${e.state.player.hp}`),e.wait()},verify:(e,i)=>{const s=i.find(l=>l.startsWith("HP_AFTER_TELEGRAPH=")),o=s?Number(s.split("=")[1]):-1,c={telegraphEmitted:i.some(l=>l.includes("marks the impact zone")),executeEmitted:i.some(l=>l.includes("massive blast")),noDamageOnTelegraphTurn:o===e.player.maxHp,damageOnExecuteTurn:e.player.hp<e.player.maxHp};return Object.values(c).some(l=>l===!1)&&(console.log("Sentinel Playlist Timing Failed:",c),console.log("Logs:",i),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(c).every(l=>l===!0)}},{id:"sentinel_playlist_interruption_by_stun",title:"Playlist: Interruption Cancels Execute",description:"Stunning the boss during telegraph cancels the follow-up execute turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["boss","playlist","interruption","stun"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=e.getEnemy("boss");i&&(i.activeSkills=[Bs("BASIC_MOVE"),Bs("BASIC_ATTACK"),Bs("SENTINEL_TELEGRAPH"),Bs("SENTINEL_BLAST")])},run:e=>{e.wait(),e.applyStatus("boss","stunned",1),e.wait()},verify:(e,i)=>{const s=e.enemies.find(c=>c.id==="boss"),o={telegraphEmitted:i.some(c=>c.includes("marks the impact zone")),executeCancelled:!i.some(c=>c.includes("massive blast")),playerUnharmed:e.player.hp===e.player.maxHp,bossStillExists:!!s};return Object.values(o).some(c=>c===!1)&&(console.log("Sentinel Playlist Interruption Failed:",o),console.log("Logs:",i),console.log("Player HP:",e.player.hp,"/",e.player.maxHp),console.log("Boss:",s)),Object.values(o).every(c=>c===!0)}}]},Kv={id:"fireball",name:"Fireball",description:"Validates axial targeting, AoE damage, and environmental fire placement.",scenarios:[{id:"fireball_axial_aoe",title:"Axial Alignment & AoE Spread",description:"Verify the skill only fires axially and damages all neighbors at the impact site.",relatedSkills:["FIREBALL"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["aoe","axial","fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["FIREBALL"]),e.spawnEnemy("footman",{q:5,r:4,s:-9},"primary_target"),e.spawnEnemy("footman",{q:6,r:4,s:-10},"neighbor_target"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"diagonal_enemy"),e.setTile({q:6,r:3,s:-9},"wall"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava")},run:e=>{e.useSkill("FIREBALL",{q:7,r:5,s:-12}),e.useSkill("FIREBALL",{q:5,r:4,s:-9})},verify:()=>!0},{id:"fireball_max_range_edge",title:"Max Range & Fire Duration",description:"Verify fireball at exactly range 3 and check fire duration persistence.",relatedSkills:["FIREBALL"],category:"balancing",difficulty:"intermediate",isTutorial:!1,tags:["range","persistence"],setup:e=>{e.setPlayer({q:0,r:0,s:0},["FIREBALL"]),e.setTile({q:0,r:3,s:-3},"grass")},run:e=>{e.useSkill("FIREBALL",{q:0,r:3,s:-3}),e.wait(),e.wait()},verify:()=>!0}]},Fv={id:"hazards_v1",name:"Hazard Consolidation",description:"Verifies centralized hazard logic and flight immunity",scenarios:[{id:"Jump Over Lava",title:"Jump Over Lava",description:"Jumping over lava should not result in damage.",relatedSkills:["JUMP"],category:"hazards",tags:["lava","jump"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["JUMP"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("JUMP",{q:4,r:7,s:-11})},verify:e=>{const i=e.player,s={playerPos:ae(i.position,{q:4,r:7,s:-11}),isAlive:i.hp===i.maxHp};return Object.values(s).every(o=>o===!0)}},{id:"Walk Into Lava",title:"Walk Into Lava",description:"Walking into lava should be invalid unless the mover is hazard-safe.",relatedSkills:["BASIC_MOVE"],category:"hazards",tags:["lava","walk"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["BASIC_MOVE"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:8,s:-12})},verify:e=>{const i=e.player,s={playerPos:ae(i.position,{q:4,r:9,s:-13}),hpUnchanged:i.hp===i.maxHp};return Object.values(s).every(o=>o===!0)}},{id:"Falcon Flying Over Lava",title:"Falcon Flying Over Lava",description:"Flying units (Falcon) should ignore lava during transit and stay.",relatedSkills:["FALCON_COMMAND"],category:"hazards",tags:["lava","falcon","flight"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.wait()},verify:e=>{const i=e.enemies.find(o=>o.id==="my-falcon"),s={falconExists:!!i,falconAlive:(i?.hp||0)>0,falconPos:ae(i?.position,{q:4,r:8,s:-12})};return Object.values(s).every(o=>o===!0)}}]},Wv={id:"falcon_command_v2",name:"Falcon's Command",description:"Validates Predator/Scout mode transitions and spatial orbit logic.",scenarios:[{id:"falcon_predator_strike_path",title:"Predator Mode: Apex Strike Geometry",description:`
                Tests the Falcon's flight path from its current position to the Target.
                Layout:
                   (F)  <- Falcon Start (6, 5, -11)
                      .
                         (T) <- Target/Prey (8, 5, -13)
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:2,s:-6},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:2,s:-6}),e.wait()},verify:(e,i)=>{const s=e.companions?.find(l=>l.id==="my-falcon"),o=e.enemies.find(l=>l.id==="prey"),c={modeSet:s?.companionState?.mode==="predator",targetLocked:s?.companionState?.markTarget==="prey",movedCloser:s&&De(s.position,{q:4,r:2,s:-6})<7,preyHealthy:o?.hp===o?.maxHp,turnSpent:e.turnsSpent===2};return Object.values(c).some(l=>l===!1)&&(console.log(" Scenario Falcon Predator Strike Failed:",c),console.log("Falcon:",s)),Object.values(c).every(l=>l===!0)}},{id:"falcon_scout_orbit",title:"Scout Mode: Hex Ring Orbit",description:`
                Ensures that in Scout mode, the Falcon rotates around the mark 
                on the flat-top hex ring.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:3,r:6,s:-9}),e.wait(),e.wait()},verify:(e,i)=>{const s=e.companions?.find(l=>l.id==="my-falcon"),o={q:3,r:6,s:-9},c={isScout:s?.companionState?.mode==="scout",onOrbitRing:s&&De(s.position,o)===1,hasRotated:s&&!!s.previousPosition&&!ae(s.position,s.previousPosition),turnSpent:e.turnsSpent===3};return Object.values(c).some(l=>l===!1)&&(console.log(" Scenario Falcon Scout Orbit Failed:",c),console.log("Falcon:",s)),Object.values(c).every(l=>l===!0)}},{id:"falcon_roost_mode",title:"Roost Mode: Return and Heal",description:`
                Ensures that when targeting self, the Falcon returns to the Hunter
                and provides a heal on arrival.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","roost","heal"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=2,e.spawnFalcon({q:3,r:6,s:-9},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:9,s:-13}),e.wait(),e.wait()},verify:(e,i)=>{const s=e.companions?.find(l=>l.id==="my-falcon"),o=e.player,c={modeRoost:s?.companionState?.mode==="roost",healed:o.hp>2,closeToHunter:s&&De(s.position,o.position)<=1};return Object.values(c).some(l=>l===!1)&&console.log(" Scenario Falcon Roost Heal Failed:",c),Object.values(c).every(l=>l===!0)}},{id:"falcon_predator_auto_return",title:"Predator Mode: Auto-Roost on Kill",description:`
                Ensures that if a marked predator target dies, the Falcon
                automatically reverts to Roost mode.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!0,tags:["falcon","predator","cleanup"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=1,e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:7,s:-11}),e.wait(),e.wait(),e.wait()},verify:(e,i)=>{const s=e.companions?.find(f=>f.id==="my-falcon"),o=e.enemies.find(f=>f.id==="prey"),c=e.player,l={preyDead:!o,autoRoost:s?.companionState?.mode==="roost",healed:c.hp>1};return Object.values(l).some(f=>f===!1),Object.values(l).every(f=>f===!0)}},{id:"falcon_command_metadata_null_safety",title:"Command Metadata Null-Safety",description:`
                Ensures FALCON_COMMAND name/description resolution is safe
                when player context is remapped in harness-like states.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["falcon","null-safety","metadata"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.id="hunter_remapped"},run:e=>{e.wait()},verify:(e,i)=>{const s={playerIdRemapped:e.player.id==="hunter_remapped",noRuntimeReferenceError:!i.some(o=>o.toLowerCase().includes("cannot read properties"))};return Object.values(s).some(o=>o===!1)&&console.log("Falcon Command Metadata Null-Safety Failed:",s),Object.values(s).every(o=>o===!0)}}]},Xv={id:"kinetic_tri_trap",name:"Kinetic Tri-Trap",description:"Tests for trap deployment and fling mechanics",scenarios:[{id:"tri_trap_basic_deployment",title:"Trap Deployment",description:"Deploy 3 traps on axial tiles at range 2.",relatedSkills:["KINETIC_TRI_TRAP"],category:"deployment",difficulty:"beginner",isTutorial:!0,tags:["trap","deployment"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,i)=>{const s=e.player.position,o=e.traps||[],c={countIsThree:o.length===3,isAtRangeTwo:o.every(l=>De(l.position,s)===2),isAxialToPlayer:o.every(l=>l.position.q===s.q||l.position.r===s.r||l.position.s===s.s),trapsHidden:o.every(l=>!l.isRevealed)};return Object.values(c).some(l=>l===!1)&&(console.log(" Scenario Tri-Trap Deployment Failed:",c),console.log("Traps:",e.traps),console.log("Logs:",i)),Object.values(c).every(l=>l===!0)}},{id:"tri_trap_state_tracking",title:"Trap State Tracking",description:"Traps are tracked with correct owner and hidden state.",relatedSkills:["KINETIC_TRI_TRAP"],category:"state",difficulty:"intermediate",isTutorial:!1,tags:["trap","state"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10}),e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,i)=>{const s=e.traps,o={trapsExist:s&&s.length>0,allHidden:s?.every(c=>!c.isRevealed)??!1,allZeroCooldown:s?.every(c=>c.cooldown===0)??!1,deployMessage:i.some(c=>c.includes("trap")||c.includes("Trap")),trapsCount:s?.length===3};return Object.values(o).some(c=>c===!1)&&(console.log(" Trap State Failed:",o),console.log("Traps:",e.traps)),Object.values(o).every(c=>c===!0)}}]},Gv={id:"withdrawal",name:"Withdrawal",description:"Tests for shot + backroll mechanics and passive reaction",scenarios:[{id:"withdrawal_basic",title:"Shot and Backroll",description:"Shoot adjacent enemy and backroll to safety.",relatedSkills:["WITHDRAWAL"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["shot","backroll","displacement"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,i)=>{const s=e.enemies.find(c=>c.id==="target"),o={enemyDamagedOrDead:!s||s.hp<s.maxHp,playerMoved:e.player.position.q!==5||e.player.position.r!==5,playerBackrolled:e.player.position.q<5,shotFired:i.some(c=>c.includes("Withdrawal")||c.includes("shot"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Withdrawal Failed:",o),console.log("Player:",e.player.position),console.log("Target HP:",s?.hp)),Object.values(o).every(c=>c===!0)}},{id:"withdrawal_wall_block",title:"Backroll Blocked by Wall",description:"Backroll finds alternate safe spot when wall blocks retreat.",relatedSkills:["WITHDRAWAL"],category:"collision",difficulty:"intermediate",isTutorial:!1,tags:["backroll","wall","pathfinding"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.setTile({q:4,r:5,s:-9},"wall"),e.setTile({q:3,r:5,s:-8},"wall"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,i)=>{const s={playerNotOnWall:!ae(e.player.position,{q:4,r:5,s:-9}),playerMoved:e.player.position.q!==5||e.player.position.r!==5};return Object.values(s).some(o=>o===!1)&&(console.log(" Wall Block Failed:",s),console.log("Player:",e.player.position)),Object.values(s).every(o=>o===!0)}}]},Qv={id:"absorb_fire",name:"Absorb Fire Passive",description:"Verifies that fire damage is converted to healing.",scenarios:[{id:"Absorb Fire Damage",title:"Stand on Fire",description:"Player with Absorb Fire should be healed when standing on fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",tags:["fire","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE"]),e.state.player.hp=1,e.setTile({q:4,r:5,s:-9},"stone");const i={q:4,r:5,s:-9},s=e.getTileAt(i);s&&s.effects.push({id:"FIRE",duration:3,potency:1})},run:e=>{e.wait()},verify:e=>{const i=e.player;return i.hp<=1&&console.log("Stand on Fire Failed: HP did not increase",i.hp),i.hp>1}},{id:"Absorb Lava Damage",title:"Walk into Lava",description:"Player with Absorb Fire should be healed when walking into lava.",relatedSkills:["ABSORB_FIRE","BASIC_MOVE"],category:"passive",tags:["lava","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE","BASIC_MOVE"]),e.state.player.hp=1,e.setTile({q:4,r:6,s:-10},"lava")},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:6,s:-10})},verify:e=>{const i=e.player,s={alive:i.hp>0,healed:i.hp===i.maxHp,onLava:ae(i.position,{q:4,r:6,s:-10})};return(!s.alive||!s.healed||!s.onLava)&&(console.log("Walk into Lava Failed:",s,"HP:",i.hp,"MaxHP:",i.maxHp),console.log("Player Pos:",i.position)),Object.values(s).every(o=>o===!0)}}]},Jv={id:"tile_interactions",name:"Tile Interactions",description:"Verifies interactions with special tiles like Shrines and Stairs.",scenarios:[{id:"shrine_interaction",title:"Shrine Interaction",description:"Moving onto a shrine should trigger an upgrade choice.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["shrine","upgrade"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.shrinePosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"SHRINE",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","SHRINE"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const i={playerOnShrine:ae(e.player.position,{q:4,r:6,s:-10}),isChoosingUpgrade:e.pendingStatus?.status==="choosing_upgrade",hasOptions:e.pendingStatus?.shrineOptions?.length>0};return Object.values(i).every(s=>s===!0)}},{id:"stairs_interaction",title:"Stairs Interaction",description:"Moving onto stairs should trigger level transition.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["stairs","portal"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.stairsPosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"STAIRS",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","STAIRS"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const i={playerOnStairs:ae(e.player.position,{q:4,r:6,s:-10}),isTransitioning:e.pendingStatus?.status==="playing"||e.pendingStatus?.status==="won",messageFound:e.message.some(s=>s.includes("Descending")||s.includes("Cleared"))};return Object.values(i).every(s=>s===!0)}}]},Zv={id:"telegraph_projection",name:"Telegraph Projection",description:"Deterministic intent previews for next-turn danger tiles.",scenarios:[{id:"telegraph_projection_is_deterministic",title:"Projection Determinism",description:"Same state should always produce the same danger projection.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","determinism"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"threat")},run:e=>{e.wait()},verify:e=>{const i=e.intentPreview,s=i?.dangerTiles||[],o=i?.projections||[],c=s.map(S=>`${S.q},${S.r},${S.s}`),l=new Set(c),f=c.every((S,v)=>v===0||c[v-1].localeCompare(S)<=0),h=o.map(S=>`${S.actorId}|${S.skillId}|${S.targetHex?`${S.targetHex.q},${S.targetHex.r},${S.targetHex.s}`:"none"}`),b=h.every((S,v)=>v===0||h[v-1].localeCompare(S)<=0),y={hasEnginePreview:!!i,noDuplicateTiles:l.size===c.length,tilesAreSorted:f,projectionsAreSorted:b};return Object.values(y).some(S=>S===!1)&&(console.log("Telegraph Projection Determinism Failed:",y),console.log("Engine Preview:",i)),Object.values(y).every(S=>S===!0)}},{id:"telegraph_projection_matches_execute_footprint",title:"Projection Matches Execute Footprint",description:"Projected danger tiles should include the tile actually damaged on execution.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","parity","combat"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:4,r:2,s:-6},"threat")},run:e=>{e.wait();const o=e.state.intentPreview?.projections?.find(c=>c.actorId==="threat")?.dangerTiles?.[0];o?e.logs.push(`PREVIEW_TILE=${o.q},${o.r},${o.s}`):e.logs.push("PREVIEW_TILE=none"),e.wait()},verify:(e,i)=>{const s=e.enemies.find(h=>h.id==="threat"),c=i.find(h=>h.startsWith("PREVIEW_TILE="))?.split("=")[1]||"none",l=c==="none"?void 0:(()=>{const[h,b,y]=c.split(",").map(S=>Number(S));return{q:h,r:b,s:y}})(),f={previewProducedTile:!!l,projectedTileMatchesExecute:!!l&&!!s&&ae(s.position,l)};return Object.values(f).some(h=>h===!1)&&(console.log("Telegraph Projection Parity Failed:",f),console.log("Logs:",i),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(f).every(h=>h===!0)}}]},Bf=e=>{const s={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},DASH:{slot:"passive",range:4,cooldown:0,name:"Kinetic Dash",description:"Dash in a straight line."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:s.name,description:s.description,slot:s.slot,cooldown:s.cooldown,currentCooldown:0,range:s.range,upgrades:[],activeUpgrades:[]}},eS={id:"raider_dash",name:"Raider Dash",description:"Parity checks for enemy Raider reusing the player DASH contract.",scenarios:[{id:"player_dash_stops_before_adjacent_enemy",title:"Parity Baseline: Player Dash Stops Before Blocker",description:"Player DASH should stop on the tile before an occupied target.",relatedSkills:["DASH"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["parity","dash","reuse"],setup:e=>{e.setPlayer({q:4,r:2,s:-6},["DASH"]),e.spawnEnemy("footman",{q:4,r:6,s:-10},"blocker"),e.state.hasShield=!1},run:e=>{e.useSkill("DASH",{q:4,r:6,s:-10})},verify:(e,i)=>{const s={playerStoppedBeforeBlocker:e.player.position.q===4&&e.player.position.r===5,dashResolved:i.some(o=>o.includes("Stopped by an obstacle")||o.includes("Dashed!")||o.includes("Shield Shunt"))};return Object.values(s).every(o=>o===!0)}},{id:"raider_ai_uses_dash_with_player_contract",title:"Parity: Raider Uses Same Dash Stop Rule",description:"Raider AI selects DASH and lands on the same stop tile as player-owned DASH in mirrored geometry.",relatedSkills:["DASH"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","dash"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("raider",{q:4,r:2,s:-6},"raider"),e.state.hasShield=!1;const i=e.getEnemy("raider");i&&(i.activeSkills=[Bf("BASIC_MOVE"),Bf("BASIC_ATTACK"),Bf("DASH")])},run:e=>{e.wait()},verify:(e,i)=>{const s=e.enemies.find(c=>c.id==="raider"),o={raiderStillAlive:!!s,raiderStoppedBeforePlayer:!!s&&s.position.q===4&&s.position.r===5,playerUnharmed:e.player.hp===e.player.maxHp,dashResolved:i.some(c=>c.includes("Stopped by an obstacle")||c.includes("Dashed!")||c.includes("Shield Shunt"))};return Object.values(o).every(c=>c===!0)}}]},Hf=e=>{const s={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},GRAPPLE_HOOK:{slot:"offensive",range:4,cooldown:0,name:"Grapple Hook",description:"Pull and swap with target."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:s.name,description:s.description,slot:s.slot,cooldown:s.cooldown,currentCooldown:0,range:s.range,upgrades:[],activeUpgrades:[]}},tS={id:"pouncer_hook",name:"Pouncer Hook",description:"Second archetype reuse: enemy uses player GRAPPLE_HOOK via normal skill execution.",scenarios:[{id:"pouncer_uses_grapple_hook_deterministically",title:"Pouncer Uses Grapple Hook Through Skill Pipeline",description:"Pouncer selects GRAPPLE_HOOK from AI and resolves via standard USE_SKILL execution.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","determinism"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("pouncer",{q:4,r:2,s:-6},"pouncer");const i=e.getEnemy("pouncer");i&&(i.activeSkills=[Hf("BASIC_MOVE"),Hf("BASIC_ATTACK"),Hf("GRAPPLE_HOOK")])},run:e=>{e.wait()},verify:(e,i)=>{const o={pouncerStillAlive:!!e.enemies.find(c=>c.id==="pouncer"),grappleExecuted:i.filter(c=>c.includes("Vaulted and Flung!")).length>=1,deterministicStatus:i.filter(c=>c.includes("You are stunned!")).length===1,noZeroEffectWarning:!i.some(c=>c.includes("produced ZERO effects"))};return Object.values(o).every(c=>c===!0)}}]},nS={id:"ice",name:"Ice Terrain",description:"ICE/SLIPPERY terrain behavior for pass-through momentum and landing slide.",scenarios:[{id:"ice_pass_preserves_dash_momentum",title:"Ice Pass: Dash Carries Momentum",description:"Passing through ICE during DASH should preserve momentum and carry movement beyond nominal target.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","ice","momentum","pass"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:6,r:4,s:-10})},verify:e=>e.player.position.q>6},{id:"ice_land_slides_after_basic_move",title:"Ice Land: Basic Move Slides Forward",description:"Landing on ICE with BASIC_MOVE should slide one hex in the move direction when the next tile is walkable.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["terrain","ice","slide","land"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_MOVE"]),e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor")},run:e=>{e.move({q:5,r:4,s:-9})},verify:e=>e.player.position.q===6&&e.player.position.r===4}]},iS={id:"snare",name:"Snare Terrain",description:"Snare tile effect movement restriction and status interaction.",scenarios:[{id:"snare_interrupts_dash_and_roots_actor",title:"Snare Interrupts Dash",description:"DASH into a snare tile should halt movement at snare and apply rooted status.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","snare","movement-restriction"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.state.tiles.set("5,4",{baseId:"STONE",position:{q:5,r:4,s:-9},traits:new Set(["WALKABLE"]),effects:[{id:"SNARE",duration:-1,potency:1}]}),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:7,r:4,s:-11})},verify:(e,i)=>{const s=e.player.statusEffects.some(c=>c.type==="rooted"),o={stoppedAtSnare:e.player.position.q===5&&e.player.position.r===4,rootedApplied:s,snareMessageLogged:i.some(c=>c.includes("Snared! Movement halted."))};return Object.values(o).every(c=>c===!0)}}]},aS={id:"relics",name:"Relics",description:"Passive relic behaviors using existing engine hooks only.",scenarios:[{id:"relic_ember_ward_reduces_fire_damage",title:"Relic: Ember Ward",description:"Equipping Ember Ward reduces incoming fire damage by 1.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"beginner",isTutorial:!1,tags:["relic","fire","passive"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_EMBER_WARD"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,i)=>{const s={hpUnchanged:e.player.hp===e.player.maxHp,relicMessageSeen:i.some(o=>o.includes("Ember Ward dampens the flames."))};return Object.values(s).every(o=>o===!0)}},{id:"relic_cinder_orb_stacks_with_absorb_fire",title:"Relic: Cinder Orb Stacking",description:"Cinder Orb adds bonus healing when fire damage is converted by Absorb Fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",difficulty:"advanced",isTutorial:!1,tags:["relic","stacking","absorb-fire"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["ABSORB_FIRE"]),e.state.player={...e.state.player,hp:1,maxHp:3},e.state.upgrades=[...e.state.upgrades||[],"RELIC_CINDER_ORB"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,i)=>{const s={healedByStacking:e.player.hp===3,stackingMessageSeen:i.some(o=>o.includes("Cinder Orb amplifies the absorption."))};return Object.values(s).every(o=>o===!0)}},{id:"relic_steady_plates_end_to_end",title:"Relic: Steady Plates",description:"Steady Plates grants turn-start armor that resolves against incoming damage in the same round.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"intermediate",isTutorial:!1,tags:["relic","armor","turn-start"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_STEADY_PLATES"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,i)=>{const s={playerHpProtected:e.player.hp===e.player.maxHp,damageEventOccurred:i.some(o=>o.includes("player burns!")),armorPresentAfterCycle:e.player.temporaryArmor>=0&&e.player.temporaryArmor<=2,relicTriggerMessageSeen:i.some(o=>o.includes("Steady Plates harden your stance."))};return Object.values(s).every(o=>o===!0)}}]},sS=250,oS=700,rS=100,lS=8,cS=220,uS=260,dS=40,f0=(e,i)=>{const s=e.floor||0,o=e.player?.hp||0,c=e.turnsSpent??e.turnNumber??0,l=e.kills||0,f=e.environmentalKills||0,h=e.hazardBreaches||0,b=(i||[]).filter(y=>y.success).length*sS;return s*oS+o*rS+l*cS+f*uS-c*lS-h*dS+b},fS=e=>{if(typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const i=e instanceof Date?e:new Date,s=i.getFullYear(),o=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0");return`${s}-${o}-${c}`},mS=e=>`daily:${e}`,pS=e=>{const i=18+Math.floor(pu(e,0)*8);return[{id:"TURN_LIMIT",label:`Finish within ${i} turns`,target:i},{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}]},uu=e=>(e.runObjectives||[]).map(s=>{if(s.id==="TURN_LIMIT"){const c=e.turnsSpent||0;return{...s,value:c,success:c<=s.target}}const o=e.hazardBreaches||0;return{...s,value:o,success:o<=s.target}}),Tl=e=>{const i=e.initialSeed??e.rngSeed??"0",s=uu(e),o=e.combatScoreEvents||[],c=o.length?Number((o.reduce((f,h)=>f+h.efficiency,0)/o.length).toFixed(4)):0,l=o.filter(f=>f.riskBonusApplied).length;return{seed:i,actionLog:e.actionLog,score:f0(e,s),floor:e.floor,objectives:s,combatTelemetry:{events:o.length,avgEfficiency:c,riskBonusEvents:l}}},hS={id:"objectives",name:"Objectives",description:"Daily objective validation for turn-limit and hazard constraints.",scenarios:[{id:"objective_turn_limit_boundary",title:"Objective: Turn Limit Boundary",description:"Turn-limit objective passes at boundary and fails above boundary.",relatedSkills:["BASIC_MOVE"],category:"progression",difficulty:"intermediate",isTutorial:!1,tags:["objective","turn-limit"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"TURN_LIMIT",label:"Finish within 1 turns",target:1}]},run:e=>{e.wait()},verify:e=>{const s=uu(e)[0]?.success===!0,o=Tl(e).score,c=uu({...e,turnsSpent:(e.turnsSpent||0)+1}),l={...e,turnsSpent:(e.turnsSpent||0)+1},f=Tl(l).score,h=c[0]?.success===!1,b=f<o;return s&&h&&b}},{id:"objective_hazard_constraint_fail_on_hazard",title:"Objective: Hazard Constraint",description:"Hazard objective fails after prohibited hazard interaction.",relatedSkills:["BASIC_MOVE"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["objective","hazard"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:e=>{const i=uu(e)[0];return(e.hazardBreaches||0)>0&&!!i&&i.success===!1}}]},gS={id:"necromancer",name:"Necromancer",description:"Corpse persistence and summon migration contracts.",scenarios:[{id:"necromancer_corpse_persistence",title:"Corpse Persists Until Consumed",description:"Kill an enemy, wait 5 turns, then Raise Dead succeeds from corpse tile trait.",relatedSkills:["BASIC_ATTACK","RAISE_DEAD"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","corpse","persistence"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_ATTACK","RAISE_DEAD"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"dummy");const i=e.getEnemy("dummy");i&&(i.hp=1,i.maxHp=1)},run:e=>{const i={q:5,r:4,s:-9};e.useSkill("BASIC_ATTACK",i);for(let s=0;s<5;s++)e.wait();e.useSkill("RAISE_DEAD",i)},verify:e=>{const i=Te({q:5,r:4}),s=e.tiles.get(i),o=e.enemies.find(h=>h.subtype==="skeleton"&&h.factionId==="player"),c=e.companions?.find(h=>h.id===o?.id),l=new Set((o?.activeSkills||[]).map(h=>h.id)),f={corpseConsumed:!s?.traits?.has("CORPSE"),skeletonRaised:!!o,skeletonOnCorpseTile:!!o&&o.position.q===5&&o.position.r===4,companionRegistered:!!c,hasBasicLoadout:l.has("BASIC_MOVE")&&l.has("BASIC_ATTACK")};return Object.values(f).every(Boolean)}},{id:"summon_floor_transition",title:"Summon Persists Across Floor Transition",description:"Raised skeleton migrates with player to floor 2.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","summon","floor-transition"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:4,s:-9},s=Te(i),o=e.getTileAt(i);e.state.tiles.set(s,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])})},run:e=>{const i={q:5,r:4,s:-9};e.useSkill("RAISE_DEAD",i),e.state.player={...e.state.player,position:{...e.state.stairsPosition}},e.wait(),e.dispatchSync({type:"RESOLVE_PENDING"})},verify:e=>{const i=e.enemies.find(o=>o.subtype==="skeleton"&&o.factionId==="player"&&o.companionOf===e.player.id),s={floorAdvanced:e.floor===2,summonStillPresent:!!i,summonTracksOwner:!!i&&i.companionOf===e.player.id};return Object.values(s).every(Boolean)}},{id:"companion_does_not_block_free_move",title:"Companion Does Not Block Exploration Free Move",description:"Friendly skeleton companion should not count as hostile for BASIC_MOVE exploration range.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","companion","movement"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"friendly_skeleton");const i=e.getEnemy("friendly_skeleton");i&&(i.subtype="skeleton",i.factionId="player",i.companionOf=e.state.player.id,i.activeSkills=i.activeSkills||[],e.state.companions=[...e.state.companions||[],i])},run:e=>{e.move({q:7,r:1,s:-8})},verify:e=>{const i={movedFar:e.player.position.q===7&&e.player.position.r===1,turnsAdvanced:e.turnsSpent>=1};return Object.values(i).every(Boolean)}},{id:"raise_dead_pushes_ally_from_target_hex",title:"Raise Dead Pushes Ally Occupant",description:"If corpse tile is occupied by an ally, ally is displaced and summon succeeds without overlap.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","occupancy","push"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:5,s:-10},s=Te(i),o=e.getTileAt(i);e.state.tiles.set(s,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])}),e.spawnEnemy("footman",i,"ally_blocker");const c=e.getEnemy("ally_blocker");c&&(c.subtype="skeleton",c.factionId="player",c.companionOf=e.state.player.id,e.state.companions=[...e.state.companions||[],c])},run:e=>{e.useSkill("RAISE_DEAD",{q:5,r:5,s:-10})},verify:e=>{const i=e.enemies.filter(h=>h.subtype==="skeleton"&&h.factionId==="player"),s=new Set;let o=!1;i.forEach(h=>{const b=Te(h.position);s.has(b)&&(o=!0),s.add(b)});const c=i.some(h=>h.position.q===5&&h.position.r===5),l=i.some(h=>h.id==="ally_blocker"&&!(h.position.q===5&&h.position.r===5));return Object.values({raisedAtCorpse:c,pushedExists:l,noOverlap:!o}).every(Boolean)}}]},yS={id:"archer_shot",name:"Archer Shot",description:"Tests for dedicated archer ranged line-shot targeting, LoS, and axial validation.",scenarios:[{id:"archer_shot_clear_lane_hit",title:"Archer Shot: Clear Lane Hit",description:"A valid axial target in clear line of sight is damaged.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","line-of-sight","axial"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:3,r:4,s:-7},"target")},run:e=>{e.useSkill("ARCHER_SHOT",{q:3,r:4,s:-7})},verify:(e,i)=>{const s=e.enemies.find(l=>l.id==="target"),o=!s||s.hp<s.maxHp,c=i.some(l=>l.includes("Archer shot!"));return o&&c}},{id:"archer_shot_wall_blocked",title:"Archer Shot: Wall Blocks Line of Sight",description:"Archer Shot fails when a wall blocks the line to the target actor.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","line-of-sight","wall"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),e.setTile({q:4,r:4,s:-8},"wall")},run:e=>{e.useSkill("ARCHER_SHOT",{q:4,r:3,s:-7})},verify:(e,i)=>{const s=e.enemies.find(l=>l.id==="target"),o=!!s&&s.hp===s.maxHp,c=i.some(l=>l.includes("No clear line of sight"));return o&&c}},{id:"archer_shot_rejects_non_axial",title:"Archer Shot: Non-Axial Target Rejected",description:"Archer Shot enforces axial targeting and rejects diagonal targets.",relatedSkills:["ARCHER_SHOT"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","axial","targeting"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["ARCHER_SHOT"]),e.spawnEnemy("footman",{q:4,r:4,s:-8},"target")},run:e=>{e.useSkill("ARCHER_SHOT",{q:4,r:4,s:-8})},verify:(e,i)=>{const s=e.enemies.find(l=>l.id==="target"),o=!!s&&s.hp===s.maxHp,c=i.some(l=>l.includes("Target must be axial"));return o&&c}}]};function bS(e){return{id:e.id,title:e.title,description:e.description,rationale:e.rationale,setup:e.setup,run:e.run,verify:e.verify}}const xS=[Cv,kv,Rv,Nv,jv,Dv,Pv,Uv,qv,zv,$v,Fv,Vv,Yv,Kv,Wv,Xv,Gv,Qv,Jv,Zv,eS,tS,nS,iS,aS,hS,gS,yS],vS=xS.flatMap(e=>e.scenarios);function SS(e){return vS.filter(i=>i.relatedSkills.includes(e))}function wt(e){return SS(e).map(bS)}function Ji(e,i){const s=e.tiles.get(Te(i));return!!(s?.traits.has("BLOCKS_LOS")||s?.baseId==="WALL")}function ko(e,i){const s=e.tiles.get(Te(i));return s?.baseId==="LAVA"||s?.traits.has("LIQUID")||!1}function zs(e,i,s){const o=Ne(e,i);return!!o&&o.id!==s}function un(e,i,s){const o=De(e,i);return o>=1&&o<=s}function Zi(e,i){const s=ha(e,i);return{isAxial:s!==-1,directionIndex:s}}function dm(e,i,s={}){const{checkWalls:o=!0,checkActors:c=!0,checkLava:l=!1,excludeActorId:f}=s;for(const h of i){if(o&&Ji(e,h))return{obstacle:"wall",position:h};if(l&&ko(e,h))return{obstacle:"lava",position:h};if(c){const b=Ne(e,h);if(b&&b.id!==f)return{obstacle:"actor",position:h,actor:b}}}return{}}function fm(e,i,s,o={}){const l=Kt(i,s).slice(1),{stopAtWalls:f=!0,stopAtActors:h=!0,stopAtLava:b=!1,excludeActorId:y}=o,S=dm(e,l,{checkWalls:f,checkActors:h,checkLava:b,excludeActorId:y});return S.obstacle&&S.position&&!ae(S.position,s)?{isValid:!1,blockedBy:S.obstacle,blockedAt:S.position}:{isValid:!0}}function hu(e,i,s,o,c){const f=Kt(i,s).slice(1),h=dm(e,f,{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:c});return h.obstacle==="actor"&&h.actor?.id===o&&!!h.position&&ae(h.position,s)}function AS(e,i){const s=Ze.getTraitsAt(e,i),o=s.has("HAZARDOUS")||s.has("LAVA")||s.has("FIRE")||s.has("VOID"),c=s.has("LAVA")||s.has("FIRE");return{isHazard:o,isFireHazard:c}}function as(e,i,s){const{isHazard:o,isFireHazard:c}=AS(e,s);return!!(!o||i.isFlying||(i.activeSkills?.some(f=>f.id==="ABSORB_FIRE")||i.statusEffects?.some(f=>f.type==="fire_immunity"))&&c)}function m0(e,i,s,o){return as(e,i,s)?!0:new Set(["JUMP","VAULT","GRAPPLE_HOOK","DASH"]).has(o)}const TS={id:"GRAPPLE_HOOK",name:"Grapple Hook",description:"Pull/Zip mechanism with multi-phase kinetic resolution.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3,momentum:4},execute:(e,i,s,o=[])=>{let c=[],l=[];if(!s)return{effects:c,messages:l,consumesTurn:!1};const{directionIndex:h}=Zi(i.position,s),b=Rn(h);c.push(...nn.GRAPPLE_HOOK.anticipation(i.position,s));const{isValid:y,blockedBy:S}=fm(e,i.position,s,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!y)return l.push(`Line of sight blocked by ${S}!`),{effects:c,messages:l,consumesTurn:!1};const v=s,A=Ne(e,v),M=Ze.getTraitsAt(e,v),g=M.has("BLOCKS_MOVEMENT")||M.has("ANCHOR")?"Heavy":A?.weightClass||"Standard";if(g==="Heavy"||g==="Anchored"){const C=Ff(v,b);c.push(...nn.GRAPPLE_HOOK.execution(Kt(i.position,C))),c.push({type:"Displacement",target:i.id,destination:C,ignoreGroundHazards:!0});const N=Ze.getTileAt(e,C);if(N){const w=Eo.processEntry(i,N,e);c.push(...w.effects),l.push(...w.messages)}const O=xt(C);for(const w of O){const R=Ne(e,w);R&&R.id!==i.id&&(c.push({type:"Impact",target:R.id,damage:0,direction:b}),c.push({type:"ApplyStatus",target:R.id,status:"stunned",duration:2}),c.push(Re.stunBurst(w)))}return c.push(Re.heavyImpact(C,b)),c.push(Re.shake("high",b)),l.push("Zipped to anchor!"),{effects:c,messages:l,consumesTurn:!0}}else if(A){const C=De(i.position,v),N=Rn((h+3)%6),O=i.position;c.push(...nn.GRAPPLE_HOOK.execution(Kt(i.position,s)));const w=wv(e,i,v,C-1),R=Bi(e,w,{sourceId:i.id,targetId:A.id}),Q=R.enemies.find(ue=>ue.id===A.id)||(R.player.id===A.id?R.player:null);if(!Q)return l.push(`${A.subtype||"Enemy"} neutralized during pull.`),{effects:[...c,...w],messages:l,consumesTurn:!0};const W=Mv(i,Q),j=Q.position;c.push(...nn.GRAPPLE_HOOK.impact(j,b));const re=Bi(R,W,{sourceId:i.id,targetId:A.id}),pe=Ov(re,O,N,4),z=Kt(O,ui(O,lm(h,6)));return c.push(...nn.GRAPPLE_HOOK.resolution(z,4)),{effects:[...c,...w,...W,...pe],messages:["Vaulted and Flung!"],consumesTurn:!0}}else return l.push("Hook missed."),{effects:c,messages:l,consumesTurn:!1}},getValidTargets:(e,i)=>{const s=Ne(e,i);return s?dt.getAxialTargets(e,i,4,{includeWalls:!0,includeActors:!0,stopAtObstacles:!0}).filter(o=>{const{directionIndex:c}=Zi(i,o),l=Rn(c),f=Ne(e,o),h=Ze.getTraitsAt(e,o),y=h.has("BLOCKS_MOVEMENT")||h.has("ANCHOR")?Ff(o,l):f?o:void 0;return y?as(e,s,y):!1}):[]},upgrades:{},scenarios:wt("GRAPPLE_HOOK")},ES={id:"SPEAR_THROW",name:e=>e.hasSpear?"Spear Throw":"Recall Spear",description:e=>e.hasSpear?"Throw your spear to instantly kill an enemy.":"Recall your spear, damaging enemies in its path.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:1},execute:(e,i,s,o=[])=>{const c=[],l=[],f=tt(i),h=o.includes("SPEAR_RANGE"),b=o.includes("RECALL"),y=o.includes("RECALL_DAMAGE"),S=o.includes("LUNGE"),v=o.includes("LUNGE_ARC"),A=o.includes("DEEP_BREATH"),M=o.includes("SPEAR_CLEAVE")||o.includes("CLEAVE"),p=3+(h?1:0);if(e.hasSpear){if(!s)return{effects:c,messages:l,consumesTurn:!1};if(S&&De(i.position,s)===2){const R=Ne(e,s);if(R&&R.id!==i.id){const Q=_n({attackerId:i.id,targetId:R.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:tt(R),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return c.push({type:"Displacement",target:"self",destination:s,simulatePath:!0}),c.push({type:"Damage",target:R.id,amount:Q.finalPower,scoreEvent:Q.scoreEvent}),l.push(`Lunged and killed ${R.subtype||"enemy"} !`),v&&xt(s).forEach(W=>{const j=Ne(e,W);if(j&&j.id!==i.id&&j.id!==R.id){const re=_n({attackerId:i.id,targetId:j.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:tt(j),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:j.id,amount:re.finalPower,scoreEvent:re.scoreEvent})}}),A&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0}),{effects:c,messages:l}}}if(!un(i.position,s,p))return l.push("Out of range!"),{effects:c,messages:l,consumesTurn:!1};const g=ga(e.enemies,s);if(!g)return l.push("No enemy at target."),{effects:c,messages:l,consumesTurn:!1};if(!Zi(i.position,s).isAxial)return l.push("Target must be axial."),{effects:c,messages:l,consumesTurn:!1};if(!hu(e,i.position,s,g.id,i.id))return l.push("No clear line of sight to enemy."),{effects:c,messages:l,consumesTurn:!1};c.push(...nn.SPEAR_THROW.anticipation(i.position,s));const O=s,w=g;if(c.push(...nn.SPEAR_THROW.execution(Kt(i.position,O))),w){const R=_n({attackerId:i.id,targetId:w.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:tt(w),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});c.push(...nn.SPEAR_THROW.impact(O,!0)),c.push({type:"Damage",target:w.id,amount:R.finalPower,scoreEvent:R.scoreEvent}),l.push(`Spear killed ${w.subtype||"enemy"} !`),A&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0})}else c.push(...nn.SPEAR_THROW.impact(O,!1)),l.push("Spear thrown.");c.push({type:"SpawnItem",itemType:"spear",position:O}),b&&(c.push({type:"PickupSpear",position:O}),l.push("Spear auto-retrieved."))}else{const g=e.spearPosition;if(!g)return l.push("Spear is lost!"),{effects:c,messages:l,consumesTurn:!1};const C=Kt(g,i.position);if(y&&C.forEach(N=>{const O=ga(e.enemies,N);if(O){const w=_n({attackerId:i.id,targetId:O.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:tt(O),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:O.id,amount:w.finalPower,scoreEvent:w.scoreEvent}),l.push(`Spear recall hit ${O.subtype||"enemy"} !`)}}),c.push({type:"PickupSpear",position:g}),l.push("Spear recalled."),M){for(const N of xt(g)){const O=ga(e.enemies,N);if(!O)continue;const w=_n({attackerId:i.id,targetId:O.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:tt(O),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1}],statusMultipliers:[]});c.push({type:"Damage",target:O.id,amount:w.finalPower,scoreEvent:w.scoreEvent})}l.push("Cleave triggered on pickup.")}c.push({type:"Juice",effect:"spearTrail",path:C,intensity:"medium",metadata:{signature:"ATK.SHOOT.PHYSICAL.SPEAR_RETURN",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"spear_return",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"},skillId:"SPEAR_THROW"}})}return{effects:c,messages:l}},getValidTargets:(e,i)=>{if(!e.hasSpear)return[];const s=Ne(e,i);if(!s)return[];const l=3+(s.activeSkills?.find(h=>h.id==="SPEAR_THROW")?.activeUpgrades?.includes("SPEAR_RANGE")?1:0);return e.enemies.filter(h=>h.hp>0).filter(h=>{const b=h.position;return!Zi(i,b).isAxial||!un(i,b,l)?!1:hu(e,i,b,h.id,s.id)}).map(h=>h.position)},upgrades:{SPEAR_RANGE:{id:"SPEAR_RANGE",name:"Extended Reach",description:"Range +1"},RECALL:{id:"RECALL",name:"Recall",description:"Spear automatically returns (handled internally if active, or via manual recall)"},RECALL_DAMAGE:{id:"RECALL_DAMAGE",name:"Returning Edge",description:"Damage enemies in path when recalling spear"},LUNGE:{id:"LUNGE",name:"Lunge",description:"If an enemy is exactly 2 hexes away, move to them and kill"},LUNGE_ARC:{id:"LUNGE_ARC",name:"Lunge Sweeping",description:"Lunge hits neighbors of the target"},DEEP_BREATH:{id:"DEEP_BREATH",name:"Deep Breath",description:"Reset Jump cooldown on spear kill"},SPEAR_CLEAVE:{id:"SPEAR_CLEAVE",name:"Cleave",description:"Damage all neighbors when picking up spear"}},scenarios:wt("SPEAR_THROW")},_S={id:"ARCHER_SHOT",name:"Archer Shot",description:"Fire an arrow in a straight line at a hostile target.",slot:"offensive",icon:"",baseVariables:{range:4,cost:0,cooldown:0,damage:1},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};if(!un(i.position,s,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const l=Zi(i.position,s);if(!l.isAxial)return{effects:o,messages:["Target must be axial."],consumesTurn:!1};const f=Ne(e,s);if(!f||f.id===i.id)return{effects:o,messages:["No target at location."],consumesTurn:!1};if(f.factionId===i.factionId)return{effects:o,messages:["Cannot target ally."],consumesTurn:!1};if(!hu(e,i.position,s,f.id,i.id))return{effects:o,messages:["No clear line of sight."],consumesTurn:!1};const h=tt(i),b=_n({attackerId:i.id,targetId:f.id,skillId:"ARCHER_SHOT",basePower:1,trinity:h,targetTrinity:tt(f),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]}),y=Kt(i.position,s),S=b.finalPower>=4?"high":b.finalPower>=2?"medium":"low",v=l.directionIndex>=0?Rn(l.directionIndex):void 0;return o.push({type:"Juice",effect:"aimingLaser",target:s,intensity:"low",metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"anticipation",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},path:y,skillId:"ARCHER_SHOT",timing:{durationMs:70,ttlMs:90}}}),o.push({type:"Juice",effect:"spearTrail",path:y,target:s,intensity:S,metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"travel",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"ARCHER_SHOT",timing:{delayMs:50,durationMs:80,ttlMs:110}}}),o.push({type:"Juice",effect:"lightImpact",target:f.id,intensity:S,direction:v,metadata:{signature:"ATK.SHOOT.PHYSICAL.ARROW",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"arrow",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},contactRef:{kind:"contact_world"},contactHex:f.position,contactFromHex:i.position,contactToHex:f.position,skillId:"ARCHER_SHOT",timing:{delayMs:95,durationMs:60,ttlMs:110}}}),o.push({type:"Damage",target:f.id,amount:b.finalPower,reason:"archer_shot",scoreEvent:b.scoreEvent}),c.push("Archer shot!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>{const s=Ne(e,i);return s?[e.player,...e.enemies,...e.companions||[]].filter(c=>!!c&&c.hp>0).filter(c=>c.id!==s.id&&c.factionId!==s.factionId&&un(i,c.position,4)&&Zi(i,c.position).isAxial&&hu(e,i,c.position,c.id,s.id)).map(c=>c.position).filter((c,l,f)=>f.findIndex(h=>ae(h,c))===l):[]},upgrades:{},scenarios:wt("ARCHER_SHOT")},wS={id:"SHIELD_BASH",name:"Shield Bash",description:"Push an enemy 1 tile. If they hit a wall or another enemy, they are stunned.",slot:"defensive",icon:"",baseVariables:{range:1,cost:0,cooldown:2},execute:(e,i,s,o=[])=>{const c=[],l=[];if(!s)return{effects:c,messages:l,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:l,consumesTurn:!1};const f=o.includes("SHIELD_RANGE"),h=o.includes("ARC_BASH"),b=o.includes("BASH_360"),y=o.includes("WALL_SLAM"),S=1+(f?1:0);if(!un(i.position,s,S))return l.push("Target out of range!"),{effects:c,messages:l,consumesTurn:!1};let v=[];if(b)v=xt(i.position);else if(h){v=[s];const g=xt(s);for(const C of g)De(C,i.position)===1&&v.length<3&&v.push(C)}else v=[s];const A=new Map;e.enemies.forEach(g=>A.set(g.id,g.position)),e.player&&A.set(e.player.id,e.player.position);const M=g=>{for(const[C,N]of Array.from(A.entries()))if(ae(N,g))return C===e.player.id?e.player:e.enemies.find(O=>O.id===C)},p=(g,C)=>{const N=M(C);if(!N||N.id===i.id)return;const O=ha(g,C),w=Rn(O),R=ui(C,w),Q=e.tiles.get(Te(R)),W=Q?.baseId==="WALL"||Q?.traits.has("BLOCKS_MOVEMENT"),j=!dt.isWithinBounds(e,R),re=M(R);W||j||re&&re.id!==N.id?(c.push({type:"ApplyStatus",target:N.id,status:"stunned",duration:1}),l.push(`Bashed ${N.subtype||"enemy"} into obstacle!`),c.push({type:"Juice",effect:"shake",target:C,direction:w,intensity:"medium",metadata:{signature:"ENV.COLLISION.KINETIC.SHIELD_BASH",family:"environment",primitive:"collision",phase:"impact",element:"kinetic",variant:"shield_bash_collision",targetRef:{kind:"target_hex"},skillId:"SHIELD_BASH",camera:{shake:"medium",kick:"medium"}}}),re&&y&&p(C,R)):(c.push({type:"Displacement",target:N.id,destination:R,simulatePath:!0}),A.set(N.id,R),l.push(`Pushed ${N.subtype||"enemy"}!`))};for(const g of v)p(i.position,g);return{effects:c,messages:l}},getValidTargets:(e,i)=>{const s=Ne(e,i);if(!s)return[];const c=1+(s.activeSkills?.find(l=>l.id==="SHIELD_BASH")?.activeUpgrades?.includes("SHIELD_RANGE")?1:0);return dt.getAreaTargets(e,i,c).filter(l=>{const f=Ne(e,l);return!!f&&f.id!==s.id&&f.factionId!==s.factionId})},upgrades:{SHIELD_RANGE:{id:"SHIELD_RANGE",name:"Extended Bash",description:"Range +1"},SHIELD_COOLDOWN:{id:"SHIELD_COOLDOWN",name:"Quick Recovery",description:"Cooldown -1",modifyCooldown:-1},ARC_BASH:{id:"ARC_BASH",name:"Arc Bash",description:"Bash hits 3-hex frontal arc (+1 cooldown)",modifyCooldown:1},BASH_360:{id:"BASH_360",name:"360 Bash",description:"Bash hits all neighbors (+1 cooldown)",modifyCooldown:1},PASSIVE_PROTECTION:{id:"PASSIVE_PROTECTION",name:"Passive Protection",description:"+1 temp armor when shield not on cooldown"},WALL_SLAM:{id:"WALL_SLAM",name:"Wall Slam",description:"Enemies bashed into obstacles trigger a cascade and stun"}},scenarios:wt("SHIELD_BASH")},MS={id:"JUMP",name:"Jump",description:"Leap to an empty tile within range. Can cross lava but not walls.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,i,s,o=[])=>{const c=[],l=[];if(!s)return{effects:c,messages:l,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:l,consumesTurn:!1};const f=o.includes("JUMP_RANGE"),h=o.includes("STUNNING_LANDING"),b=o.includes("METEOR_IMPACT"),y=o.includes("FREE_JUMP"),S=2+(f?1:0);if(!un(i.position,s,S))return l.push("Target out of range!"),{effects:c,messages:l,consumesTurn:!1};const v=Ne(e,s),A=Ji(e,s),M=as(e,i,s);if(A)return l.push("Cannot jump into a wall!"),{effects:c,messages:l,consumesTurn:!1};if(!M)return l.push("Cannot land on hazard!"),{effects:c,messages:l,consumesTurn:!1};if(v&&!b)return l.push("Target hex is blocked!"),{effects:c,messages:l,consumesTurn:!1};if(v&&b){const p=_n({attackerId:i.id,targetId:v.id,skillId:"JUMP",basePower:99,trinity:tt(i),targetTrinity:tt(v),damageClass:"physical",scaling:[{attribute:"body",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:v.id,amount:p.finalPower,scoreEvent:p.scoreEvent}),l.push(`Meteor Impact killed ${v.subtype||"enemy"}!`)}if(c.push({type:"Message",text:"Jumped!"}),c.push({type:"Displacement",target:"self",destination:s,ignoreCollision:!0,ignoreGroundHazards:!0,simulatePath:!0}),h){const p=xt(s);let g=!1;for(const C of p){const N=Ne(e,C);N&&N.id!==i.id&&(c.push({type:"ApplyStatus",target:N.id,status:"stunned",duration:1}),g=!0)}g&&l.push("Enemies stunned by landing impact!")}return c.push({type:"Juice",effect:"shake",target:s,intensity:"medium",metadata:{signature:"MOVE.LEAP.NEUTRAL.JUMP_LAND",family:"movement",primitive:"leap",phase:"impact",element:"neutral",variant:"jump_landing",targetRef:{kind:"target_hex"},skillId:"JUMP",camera:{shake:"medium",kick:"light"}}}),{effects:c,messages:l,consumesTurn:!y}},getValidTargets:(e,i)=>{const s=Ne(e,i);if(!s)return[];const o=s.activeSkills?.find(h=>h.id==="JUMP"),c=new Set(o?.activeUpgrades||[]),l=2+(c.has("JUMP_RANGE")?1:0),f=c.has("METEOR_IMPACT");return dt.getAreaTargets(e,i,l).filter(h=>{if(ae(h,i)||Ji(e,h)||!as(e,s,h))return!1;const b=Ne(e,h);return!(b&&b.id!==s.id&&!f)})},upgrades:{JUMP_RANGE:{id:"JUMP_RANGE",name:"Extended Jump",description:"Jump range +1"},JUMP_COOLDOWN:{id:"JUMP_COOLDOWN",name:"Nimble",description:"Jump cooldown -1",modifyCooldown:-1},STUNNING_LANDING:{id:"STUNNING_LANDING",name:"Stunning Landing",description:"All enemies within 1 hex of landing are stunned"},METEOR_IMPACT:{id:"METEOR_IMPACT",name:"Meteor Impact",description:"Can land on enemies to kill them"},FREE_JUMP:{id:"FREE_JUMP",name:"Free Jump",description:"Can move after jumping"}},scenarios:wt("JUMP")},OS={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Charge into an adjacent enemy, pushing a chain. Wall hard-stop stuns the chain.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:3},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};if(De(i.position,s)!==1)return c.push("Target not adjacent!"),{effects:o,messages:c,consumesTurn:!1};const f=ga(e.enemies,s);if(!f)return c.push("No target!"),{effects:o,messages:c,consumesTurn:!1};const{isAxial:h,directionIndex:b}=Zi(i.position,s);if(!h)return{effects:o,messages:c,consumesTurn:!1};const y=Rn(b),S=[f];let v={q:f.position.q+y.q,r:f.position.r+y.r,s:f.position.s+y.s};for(;;){const p=ga(e.enemies,v);if(p){if(S.push(p),v={q:v.q+y.q,r:v.r+y.r,s:v.s+y.s},S.length>6)break;continue}break}const A=[];for(let p=0;p<S.length;p++){const g=S[p],C=p===0?2:1,N={q:g.position.q+y.q*C,r:g.position.r+y.r*C,s:g.position.s+y.s*C};A.push({actor:g,dest:N})}let M=!1;for(const p of A){const g=e.tiles.get(Te(p.dest));if(g?.baseId==="WALL"||g?.traits.has("BLOCKS_MOVEMENT")){M=!0;break}if(e.enemies.find(N=>ae(N.position,p.dest)&&!S.some(O=>O.id===N.id))){M=!0;break}}if(M){for(const p of S)o.push({type:"ApplyStatus",target:p.position,status:"stunned",duration:1}),c.push("Chain blocked! Stunned.");return{effects:o,messages:c}}for(const p of A)o.push({type:"Displacement",target:p.actor.id,destination:p.dest});return o.push({type:"Displacement",target:"self",destination:f.position}),c.push("Bulwark Charge!"),{effects:o,messages:c}},getValidTargets:(e,i)=>[{q:i.q+1,r:i.r,s:i.s-1},{q:i.q+1,r:i.r-1,s:i.s},{q:i.q,r:i.r-1,s:i.s+1},{q:i.q-1,r:i.r,s:i.s+1},{q:i.q-1,r:i.r+1,s:i.s},{q:i.q,r:i.r+1,s:i.s-1}].filter(o=>!!ga(e.enemies,o)),upgrades:{},scenarios:[{id:"chain_stun",title:"Chain-Stun",description:"Wall prevents chain, chain gets stunned",setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,i)=>!0}]},CS={id:"BASIC_ATTACK",name:"Basic Attack",description:"Strike an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,i,s,o=[])=>{const c=[],l=[],f=(e.timelineEvents||[]).some(R=>R.phase==="STATUS_APPLY"&&R.type==="ApplyStatus"&&R.payload?.status==="stunned"&&(R.payload?.target===i.id||typeof R.payload?.target=="object"&&R.payload?.target&&ae(R.payload.target,i.position)));if(is(i)||f)return l.push("Cannot attack while stunned!"),{effects:c,messages:l,consumesTurn:!0};if(!s)return l.push("Select a target!"),{effects:c,messages:l,consumesTurn:!1};if(!un(i.position,s,1))return l.push("Target out of range!"),{effects:c,messages:l,consumesTurn:!1};const b=Ne(e,s);if(!b||b.id===i.id)return l.push("No enemy at target!"),{effects:c,messages:l,consumesTurn:!1};if(b.factionId===i.factionId)return l.push("Cannot attack friendlies!"),{effects:c,messages:l,consumesTurn:!1};if(b.subtype==="bomb")return l.push("Cannot attack a bomb!"),{effects:c,messages:l,consumesTurn:!1};let y=1;o.includes("POWER_STRIKE")&&(y+=2);const S=ae(i.previousPosition||i.position,i.position);o.includes("EXTENDED_REACH")&&S&&(y+=1);const v=_n({attackerId:i.id,targetId:b.id,skillId:"BASIC_ATTACK",basePower:y,trinity:tt(i),targetTrinity:tt(b),damageClass:"physical",scaling:[{attribute:"body",coefficient:.5}],statusMultipliers:[],inDangerPreviewHex:!!e.intentPreview?.dangerTiles?.some(R=>ae(R,i.position)),theoreticalMaxPower:y}),A=v.finalPower,M=Math.max(0,A-(b.temporaryArmor||0)),p=b.hp-M<=0,g=ha(i.position,b.position),C=g>=0?Rn(g):void 0,N=p?"extreme":A>=4?"high":A>=2?"medium":"low";c.push({type:"Juice",effect:"lightImpact",target:"targetActor",intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"anticipation",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:0,durationMs:110,ttlMs:140}}}),c.push({type:"Juice",effect:"dashBlur",target:b.id,path:[i.position,b.position],intensity:N==="extreme"?"high":"medium",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"travel",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:110,durationMs:70,ttlMs:100}}}),c.push({type:"Juice",effect:"heavyImpact",target:b.id,intensity:N,direction:C,metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},...C?{contactRef:{kind:"contact_world"},contactHex:b.position,contactToHex:b.position,contactFromHex:i.position}:{},skillId:"BASIC_ATTACK",camera:{kick:N==="extreme"?"heavy":N==="high"?"medium":"light",freezeMs:N==="extreme"?80:55},timing:{delayMs:180,durationMs:90,ttlMs:150},flags:{lethal:p,...N==="extreme"?{crit:!0}:{}}}}),c.push({type:"Damage",target:"targetActor",amount:A,reason:"basic_attack",scoreEvent:v.scoreEvent}),c.push({type:"Juice",effect:"lightImpact",target:b.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.BASIC_ATTACK",family:"attack",primitive:"strike",phase:"aftermath",element:"physical",variant:"basic_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"BASIC_ATTACK",timing:{delayMs:280,durationMs:130,ttlMs:170}}});const O=i.type==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,w=b.type==="player"?"you":`${b.subtype||"enemy"}#${b.id}`;return l.push(`${O} attacked ${w}!`),o.includes("VAMPIRIC")&&b.hp-M<=0&&(c.push({type:"Heal",target:i.id,amount:1}),l.push("Vampiric heal!")),{effects:c,messages:l,consumesTurn:!0}},getValidTargets:(e,i)=>{const s=Ne(e,i);return s?xt(i).filter(c=>{const l=Ne(e,c);return!!l&&l.subtype!=="bomb"&&l.id!==s.id&&l.factionId!==s.factionId}):[]},upgrades:{EXTENDED_REACH:{id:"EXTENDED_REACH",name:"Disciplined Stance",description:"+1 damage when attacking without moving first."},POWER_STRIKE:{id:"POWER_STRIKE",name:"Power Strike",description:"Damage +2"},VAMPIRIC:{id:"VAMPIRIC",name:"Vampiric",description:"Heal 1 HP on kill"}},scenarios:wt("BASIC_ATTACK")},p0={id:"AUTO_ATTACK",name:"Auto Attack",description:"Automatically strike adjacent enemies that started the turn adjacent to you.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,i,s,o=[],c)=>{const l=[],f=[];let h=0;const b=(e.timelineEvents||[]).some(g=>g.phase==="STATUS_APPLY"&&g.type==="ApplyStatus"&&g.payload?.status==="stunned"&&(g.payload?.target===i.id||typeof g.payload?.target=="object"&&g.payload?.target&&ae(g.payload.target,i.position)));if(is(i)||b)return{effects:l,messages:f,kills:0};const y=xt(i.position);let S=1;o.includes("HEAVY_HANDS")&&(S+=1);let v=0;const A=(g,C,N)=>{const O=ha(i.position,C),w=O>=0?Rn(O):void 0,R=Math.max(0,N-(g.temporaryArmor||0)),Q=g.hp-R<=0,W=Q?"extreme":N>=4?"high":N>=2?"medium":"low",j=v*80;v+=1,l.push({type:"Juice",effect:"lightImpact",target:g.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"anticipation",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:j,durationMs:70,ttlMs:90}}}),l.push({type:"Juice",effect:"dashBlur",target:g.id,path:[i.position,C],intensity:W==="extreme"?"high":"medium",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"travel",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:j+70,durationMs:50,ttlMs:80}}}),l.push({type:"Juice",effect:"heavyImpact",target:g.id,intensity:W,direction:w,metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},...w?{contactRef:{kind:"contact_world"},contactHex:C,contactToHex:C,contactFromHex:i.position}:{},skillId:"AUTO_ATTACK",camera:{kick:W==="extreme"?"medium":"light",freezeMs:W==="extreme"?50:35},timing:{delayMs:j+120,durationMs:60,ttlMs:120},flags:{lethal:Q}}}),l.push({type:"Juice",effect:"lightImpact",target:g.id,intensity:"low",metadata:{signature:"ATK.STRIKE.PHYSICAL.AUTO_ATTACK",family:"attack",primitive:"strike",phase:"aftermath",element:"physical",variant:"auto_attack",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_actor"},skillId:"AUTO_ATTACK",timing:{delayMs:j+180,durationMs:80,ttlMs:110}}})},M=c?.persistentTargetIds||[],p=c?.previousNeighbors||[];if(M.length===0&&p.length===0)return{effects:l,messages:f,kills:0};for(const g of y){const C=Ne(e,g);if(!C||C.hp<=0||C.id===i.id||i.factionId===C.factionId)continue;if(M.length>0?M.includes(C.id):p.some(O=>ae(O,g))){const O=_n({attackerId:i.id,targetId:C.id,skillId:"AUTO_ATTACK",basePower:S,trinity:tt(i),targetTrinity:tt(C),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});A(C,g,O.finalPower),l.push({type:"Damage",target:g,amount:O.finalPower,reason:"auto_attack",scoreEvent:O.scoreEvent});const w=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,R=C.factionId==="player"?"you":`${C.subtype||"enemy"}#${C.id}`;f.push(`${w} attacked ${R}!`),C.hp<=S&&h++}}if(o.includes("CLEAVE")&&l.length>0)for(const g of y){if(l.some(W=>W.type==="Damage"&&typeof W.target=="object"&&"q"in W.target&&ae(W.target,g)))continue;const N=Ne(e,g);if(!N||N.id===i.id||!(i.factionId!==N.factionId))continue;const w=_n({attackerId:i.id,targetId:N.id,skillId:"AUTO_ATTACK",basePower:S,trinity:tt(i),targetTrinity:tt(N),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});A(N,g,w.finalPower),l.push({type:"Damage",target:g,amount:w.finalPower,reason:"auto_attack",scoreEvent:w.scoreEvent});const R=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,Q=N.factionId==="player"?"you":`${N.subtype||"enemy"}#${N.id}`;f.push(`${R} cleaved ${Q}!`),N.hp<=S&&h++}return{effects:l,messages:f,kills:h}},upgrades:{HEAVY_HANDS:{id:"HEAVY_HANDS",name:"Heavy Hands",description:"Auto-attack damage +1"},CLEAVE:{id:"CLEAVE",name:"Cleave",description:"When auto-attack triggers, hit ALL adjacent enemies"}},scenarios:wt("AUTO_ATTACK")},kS=(e,i,s,o,c,l)=>{if(!i.activeSkills?.some(A=>A.id==="AUTO_ATTACK"))return{state:e,kills:0,messages:[]};const b=i.activeSkills?.find(A=>A.id==="AUTO_ATTACK")?.activeUpgrades||[],y=new Map;if(e.initiativeQueue)for(const A of e.initiativeQueue.entries)A.turnStartPosition&&y.set(A.actorId,A.turnStartPosition);const S=p0.execute(e,i,void 0,b,{previousNeighbors:s,attackerTurnStartPosition:o,allActorsTurnStartPositions:y,persistentTargetIds:c});return{state:Bi(e,S.effects,{sourceId:i.id,targetId:void 0,stepId:l}),kills:S.kills||0,messages:S.messages}},RS={id:"SENTINEL_TELEGRAPH",name:"Sentinel Telegraph",description:"The Sentinel marks an impact zone for a delayed blast.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0},execute:(e,i,s)=>s?{effects:[{type:"Juice",effect:"combat_text",target:s,text:"TELEGRAPH",metadata:{signature:"UI.TEXT.ARCANE.SENTINEL_TELEGRAPH",family:"ui",primitive:"text",phase:"telegraph",element:"arcane",variant:"sentinel_telegraph",targetRef:{kind:"target_hex"},skillId:"SENTINEL_TELEGRAPH",textTone:"system"}}],messages:["The Sentinel marks the impact zone."],consumesTurn:!0}:{effects:[],messages:[],consumesTurn:!0},getValidTargets:(e,i)=>dt.getAreaTargets(e,i,3),upgrades:{},scenarios:wt("SENTINEL_TELEGRAPH")},NS={id:"SENTINEL_BLAST",name:"Sentinel Blast",description:"A massive energy surge from the Sentinel.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:2},execute:(e,i,s)=>{if(!s)return{effects:[],messages:[]};const o=tt(i),c=Ne(e,s),l=_n({attackerId:i.id,targetId:c?.id||Te(s),skillId:"SENTINEL_BLAST",basePower:2,trinity:o,targetTrinity:c?tt(c):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:[]}),f=[{type:"Damage",target:s,amount:l.finalPower,scoreEvent:l.scoreEvent},{type:"Juice",effect:"shake",intensity:"high",metadata:{signature:"ATK.BLAST.ARCANE.SENTINEL_BLAST",family:"attack",primitive:"blast",phase:"impact",element:"arcane",variant:"sentinel_blast",targetRef:{kind:"target_hex"},skillId:"SENTINEL_BLAST",camera:{shake:"high"}}}];return xt(s).forEach(b=>{const y=Ne(e,b),S=_n({attackerId:i.id,targetId:y?.id||Te(b),skillId:"SENTINEL_BLAST",basePower:1,trinity:o,targetTrinity:y?tt(y):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.1}],statusMultipliers:[]});f.push({type:"Damage",target:b,amount:S.finalPower,scoreEvent:S.scoreEvent})}),{effects:f,messages:["The Sentinel unleashed a massive blast!"],consumesTurn:!0}},getValidTargets:(e,i)=>dt.getAreaTargets(e,i,3),upgrades:{},scenarios:wt("SENTINEL_BLAST")},IS={id:"THEME_HAZARDS",name:"Theme Hazards",description:"Internal skill for testing floor themes.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0},execute:e=>({effects:[],messages:[]}),upgrades:{},scenarios:wt("THEME_HAZARDS")},LS={id:"SHIELD_THROW",name:"Shield Throw",description:"Throw your shield to strike and push enemies. Triggers a kinetic pulse on impact.",slot:"defensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,i,s,o=[])=>{const c=[],l=[];if(!s)return{effects:c,messages:l,consumesTurn:!1};if(!e.hasShield)return l.push("Shield not in hand!"),{effects:c,messages:l,consumesTurn:!1};c.push(...nn.SHIELD_THROW.anticipation(i.position,s));const{isValid:f,blockedBy:h,blockedAt:b}=fm(e,i.position,s,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!f&&h==="wall")return l.push("Shield hit a wall mid-flight!"),c.push({type:"SpawnItem",itemType:"shield",position:b}),{effects:c,messages:l,consumesTurn:!0};const y=Ne(e,s);if(!y)return l.push("Shield missed: No target at location."),c.push({type:"SpawnItem",itemType:"shield",position:s}),{effects:c,messages:l,consumesTurn:!0};const S=Kt(i.position,s);c.push(...nn.SHIELD_THROW.execution(S));const v=4,{directionIndex:A}=Zi(i.position,s),M=Rn(A);c.push({type:"ApplyStatus",target:y.id,status:"stunned",duration:1}),c.push(...nn.SHIELD_THROW.impact(s,M));const p=vu(e,{origin:s,direction:M,momentum:v}),g=p.filter(w=>w.type==="Displacement"&&w.target===y.id),C=g[g.length-1],N=C&&"destination"in C?C.destination:s,O=Kt(s,N);return O.length>1&&c.push(...nn.SHIELD_THROW.resolution(O)),c.push({type:"SpawnItem",itemType:"shield",position:N}),l.push("Direct hit! Shield triggered kinetic pulse."),{effects:[...c,...p],messages:l,consumesTurn:!0}},getValidTargets:(e,i)=>dt.getAxialTargets(e,i,4),upgrades:{},scenarios:wt("SHIELD_THROW")},BS={id:"VAULT",name:e=>e.turnNumber%2!==0?"Stun Vault":"Vault",description:e=>e.turnNumber%2!==0?"Leap to an empty tile and stun neighbors. (Odd Turn)":"Leap to an empty tile. (Even Turn)",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:0},execute:(e,i,s,o=[])=>{const c=[],l=[];if(!s)return{effects:c,messages:l,consumesTurn:!1};if(!un(i.position,s,2))return l.push("Out of range!"),{effects:c,messages:l,consumesTurn:!1};if(Ji(e,s)||zs(e,s))return l.push("Blocked!"),{effects:c,messages:l,consumesTurn:!1};if(!as(e,i,s))return l.push("Blocked!"),{effects:c,messages:l,consumesTurn:!1};const f=e.turnNumber%2!==0;c.push(...nn.VAULT.anticipation(i.position,s));const h=Kt(i.position,s);if(c.push(...nn.VAULT.execution(h)),c.push({type:"Displacement",target:"self",destination:s,path:h,ignoreGroundHazards:!0,animationDuration:250}),f){l.push("Stun Vault executed!");const b=xt(s);for(const y of b)ga(e.enemies,y)&&c.push({type:"ApplyStatus",target:y,status:"stunned",duration:1});c.push(...nn.VAULT.impact(s,!0)),l.push("Slam landing! Neighbors stunned.")}else c.push(...nn.VAULT.impact(s,!1)),l.push("Vaulted!");return{effects:c,messages:l}},getValidTargets:(e,i)=>{const o=Ne(e,i);return o?dt.getAreaTargets(e,i,2).filter(c=>ae(c,i)?!1:!Ji(e,c)&&!zs(e,c)&&as(e,o,c)):[]},upgrades:{},scenarios:[{id:"vault_shift_stun",title:"Vault State-Shifting: Stun (Turn 1)",description:"Verify vault stuns on Turn 1 (Odd).",setup:e=>{e.setTurn(1),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>i.some(s=>s.includes("Stun Vault executed!"))},{id:"vault_shift_normal",title:"Vault State-Shifting: Normal (Turn 2)",description:"Verify vault is normal on Turn 2 (Even).",setup:e=>{e.setTurn(2),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>i.some(s=>s.includes("Vaulted!"))&&!i.some(s=>s.includes("Slam landing!"))}]},HS=e=>{if(!e||e.length===0)return e;let i=!1;const s=e.map(o=>(o.currentCooldown||0)<=0?o:(i=!0,{...o,currentCooldown:0}));return i?s:e},ay=e=>{const i=HS(e.activeSkills),s=(e.actionCooldown||0)>0?0:e.actionCooldown;return i===e.activeSkills&&s===e.actionCooldown?e:{...e,activeSkills:i||e.activeSkills,actionCooldown:s}},mm=e=>e.enemies.filter(s=>s.hp>0&&s.factionId==="enemy").length===0,jS=e=>{if(!mm(e))return e;const i=ay(e.player),s=e.companions?.map(ay),o=e.traps?.map(f=>f.cooldown>0?{...f,cooldown:0}:f),c=!!e.companions&&s?.some((f,h)=>f!==e.companions?.[h]),l=!!e.traps&&o?.some((f,h)=>f!==e.traps?.[h]);return i===e.player&&!c&&!l?e:{...e,player:i,...c?{companions:s}:{},...l?{traps:o}:{}}},sy=(e,i)=>mm(e)?20:Math.max(i.speed||1,1),h0=(e,i)=>dt.isWithinBounds(e,i)?Ze.getTraitsAt(e,i).has("BLOCKS_MOVEMENT"):!0,oy=(e,i,s,o)=>{const c=new Map,l=[],f=b=>`${b.q},${b.r}`,h=[{p:s,cost:0}];for(c.set(f(s),0);h.length>0;){const b=h.shift();if(!(b.cost>=o))for(const y of xt(b.p)){if(!dt.isWithinBounds(e,y)||!Ze.isWalkable(e,y)||!m0(e,i,y,"BASIC_MOVE"))continue;const S=Ne(e,y),v=!!S&&S.id!==i.id,A=v&&S.factionId===i.factionId;if(v&&!A)continue;const M=f(y),p=b.cost+1;c.has(M)&&c.get(M)<=p||(c.set(M,p),!A&&as(e,i,y)&&!h0(e,y)&&l.push(y),h.push({p:y,cost:p}))}}return l},DS=(e,i,s,o,c)=>{const l=M=>`${M.q},${M.r}`,f=M=>{const[p,g]=M.split(",").map(Number);return{q:p,r:g,s:-p-g}},h=[s],b=new Map([[l(s),0]]),y=new Map([[l(s),null]]);for(;h.length>0;){const M=h.shift(),p=l(M),g=b.get(p);if(!(g>=c))for(const C of xt(M)){if(!dt.isWithinBounds(e,C)||!Ze.isWalkable(e,C)||!m0(e,i,C,"BASIC_MOVE"))continue;const N=Ne(e,C),O=!!N&&N.id!==i.id,w=O&&N.factionId===i.factionId;if(O&&!w)continue;const R=l(C),Q=g+1;b.has(R)&&b.get(R)<=Q||(b.set(R,Q),y.set(R,p),h.push(C))}}const S=l(o);if(!y.has(S)||h0(e,o)||!as(e,i,o))return null;const v=[];let A=S;for(;A;)v.push(f(A)),A=y.get(A)||null;return v.reverse(),v},PS={id:"BASIC_MOVE",name:"Walk",description:"Move to an adjacent or nearby tile within your speed range.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};const l=sy(e,i),h=oy(e,i,i.position,l).some(S=>ae(S,s)),b=DS(e,i,i.position,s,l);if(!h||!b||b.length<2)return c.push("Target out of reach or blocked!"),{effects:o,messages:c,consumesTurn:!1};o.push({type:"Displacement",target:"self",destination:s,source:i.position,path:b,simulatePath:!0,ignoreCollision:!0});const y=i.id===e.player.id?"You":`${i.subtype||"enemy"}#${i.id}`;return c.push(`${y} moved to (${s.q}, ${s.r}). [Range ${l}]`),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>{const s=Ne(e,i);if(!s)return[];const o=sy(e,s);return oy(e,s,i,o).filter(l=>!zs(e,l,s.id))},upgrades:{},scenarios:wt("BASIC_MOVE")},US={id:"DASH",name:"Kinetic Dash",description:"Dash in a straight line. With a shield, slam into enemies and send them flying!",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:0},execute:(e,i,s,o=[])=>{const c=[],l=[],f=o.includes("MOMENTUM_SURGE"),h=o.includes("DASH_CHAIN_REACTION")||o.includes("CHAIN_REACTION");if(!s)return{effects:c,messages:l,consumesTurn:!1};const{isAxial:b,directionIndex:y}=Zi(i.position,s),v=e.enemies.filter(N=>N.hp>0).length===0?20:4;if(!un(i.position,s,v))return{effects:c,messages:["Out of range!"],consumesTurn:!1};if(!b)return{effects:c,messages:["Axial only! Dash must be in a straight line."],consumesTurn:!1};c.push(...nn.DASH.anticipation(i.position,s));const A=Rn(y),M=Kt(i.position,s),p=dm(e,M.slice(1),{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:i.id});let g=s;if(p.obstacle){if(p.obstacle==="wall")return{effects:c,messages:["A wall blocks the way!"],consumesTurn:!1};if(p.obstacle==="lava")return{effects:c,messages:["Lava blocks the way!"],consumesTurn:!1};const N=M.findIndex(O=>ae(O,p.position));g=M[N-1]||i.position}if(p.obstacle==="actor"?p.actor:null){const N=Kt(i.position,g);c.push(...nn.DASH.execution(N));const O=[{type:"Displacement",target:"self",destination:g,path:N,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:N.length*60}],w=Bi(e,O,{sourceId:i.id});if(e.hasShield){c.push(...nn.DASH.impact(g,A,!0));const R=5+(e.hasShield&&f?2:0)+(h?1:0),Q=vu(w,{origin:g,direction:A,momentum:R});return{effects:[...c,...O,...Q],messages:[...l,"Shield Shunt!"],consumesTurn:!0}}else return c.push(...nn.DASH.impact(g,A,!1)),{effects:[...c,...O],messages:[...l,"Stopped by an obstacle (Need shield to shunt)."],consumesTurn:!ae(i.position,g)}}else{const N=Kt(i.position,g);c.push(...nn.DASH.execution(N));const O={type:"Displacement",target:"self",destination:g,path:N,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:N.length*60};return{effects:[...c,O],messages:[...l,"Dashed!"],consumesTurn:!ae(i.position,g)}}},getValidTargets:(e,i)=>{const o=e.enemies.filter(l=>l.hp>0).length===0?20:4,c=Ne(e,i);return c?dt.getAxialTargets(e,i,o,{stopAtObstacles:!0,includeActors:!0,includeWalls:!1}).filter(l=>as(e,c,l)):[]},upgrades:{MOMENTUM_SURGE:{id:"MOMENTUM_SURGE",name:"Momentum Surge",description:"+2 Momentum when dashing with shield"},DASH_CHAIN_REACTION:{id:"DASH_CHAIN_REACTION",name:"Chain Reaction",description:"Enemies pushed into other enemies transfer momentum"}},scenarios:wt("DASH")},qS=new Set(["FIREBALL","FIREWALL","FIREWALK","ABSORB_FIRE"]),g0=(e,i)=>{const s=Ze.getTileAt(e,i),o=Ze.getTraitsForTile(e,s),c=l=>s.effects.some(f=>f.id===l);return s.baseId==="VOID"||o.has("VOID")||o.has("PIT")?"VOID_TOUCHED":s.baseId==="ICE"||c("ICE_WALL")?"FROZEN":s.baseId==="LAVA"||o.has("LAVA")||o.has("FIRE")||c("FIRE")?"MELTED":c("WET")||c("STEAM")?"SOAKED":"STABLE"},y0=(e,i)=>qS.has(e)&&i==="MELTED"?1.15:1,zS={id:"FIREBALL",name:"Fireball",description:"Launch a sphere of flame. Range 3, Axial. Deals damage and leaves fire.",slot:"offensive",icon:"",baseVariables:{range:3,cost:1,cooldown:2},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:l}=Zi(i.position,s);if(!un(i.position,s,3)||!l)return{effects:o,messages:["Invalid target! Range 3, Axial only."],consumesTurn:!1};const f=[s,...xt(s)],h=tt(i),b=!!e.intentPreview?.dangerTiles?.some(y=>ae(y,i.position));for(const y of f){const S=Ne(e,y),v=g0(e,y),A=y0("FIREBALL",v),M=_n({attackerId:i.id,targetId:S?.id||Te(y),skillId:"FIREBALL",basePower:1,trinity:h,targetTrinity:S?tt(S):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:A===1?[]:[{id:`surface_${v}`,multiplier:A}],inDangerPreviewHex:b,theoreticalMaxPower:1});o.push({type:"Damage",target:y,amount:M.finalPower,reason:"fireball",scoreEvent:M.scoreEvent}),o.push({type:"PlaceFire",position:y,duration:3})}return o.push({type:"Juice",effect:"flash",target:s,color:"#ff4400",metadata:{signature:"ATK.BLAST.FIRE.FIREBALL_IMPACT",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"fireball",targetRef:{kind:"target_hex"},skillId:"FIREBALL"}}),o.push({type:"Juice",effect:"shake",intensity:"medium",metadata:{signature:"UI.SHAKE.FIRE.FIREBALL",family:"ui",primitive:"shake",phase:"impact",element:"fire",variant:"fireball_shake",skillId:"FIREBALL",camera:{shake:"medium"}}}),c.push("Fireball!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>dt.getAxialTargets(e,i,3),upgrades:{},scenarios:wt("FIREBALL")},$S={id:"FIREWALL",name:"Firewall",description:"Create a wall of flames 5 tiles wide. Area denial.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:4},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:l,directionIndex:f}=Zi(i.position,s);if(!l)return{effects:o,messages:["Axial targeting only!"],consumesTurn:!1};const h=(f+2)%6,b=(f+5)%6,y=[s];let S=s;for(let A=0;A<2;A++)S=ui(S,Rn(h)),dt.isWithinBounds(e,S)&&y.push(S);let v=s;for(let A=0;A<2;A++)v=ui(v,Rn(b)),dt.isWithinBounds(e,v)&&y.push(v);for(const A of y)if(!Ji(e,A)){o.push({type:"PlaceFire",position:A,duration:3});const M=Ne(e,A);if(M){const p=g0(e,A),g=y0("FIREWALL",p),C=_n({attackerId:i.id,targetId:M.id,skillId:"FIREWALL",basePower:1,trinity:tt(i),targetTrinity:tt(M),damageClass:"magical",scaling:[{attribute:"mind",coefficient:.15}],statusMultipliers:g===1?[]:[{id:`surface_${p}`,multiplier:g}]});o.push({type:"Damage",target:M.id,amount:C.finalPower,reason:"firewall_impact",scoreEvent:C.scoreEvent})}}return o.push({type:"Juice",effect:"flash",target:s,color:"#ffaa00",metadata:{signature:"ATK.BLAST.FIRE.FIREWALL",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"firewall",targetRef:{kind:"target_hex"},skillId:"FIREWALL"}}),c.push("Firewall raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>dt.getAxialTargets(e,i,4),upgrades:{},scenarios:wt("FIREWALL")},VS={id:"FIREWALK",name:"Firewalk",description:"Teleport to a fire or lava tile. Grants 2 turns of Fire Immunity.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};if(!un(i.position,s,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const l=e.tiles.get(Te(s)),f=l?.effects.some(b=>b.id==="FIRE"),h=l?.baseId==="LAVA"||l?.traits.has("LIQUID");return!f&&!h?{effects:o,messages:["Can only teleport to Fire or Lava!"],consumesTurn:!1}:zs(e,s,i.id)?{effects:o,messages:["Target position occupied!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:s,source:i.position,simulatePath:!1}),o.push({type:"ApplyStatus",target:"self",status:"fire_immunity",duration:2}),o.push({type:"Juice",effect:"flash",target:s,color:"#ff8800",metadata:{signature:"MOVE.BLINK.FIRE.FIREWALK",family:"movement",primitive:"blink",phase:"impact",element:"fire",variant:"firewalk",targetRef:{kind:"target_hex"},skillId:"FIREWALK"}}),c.push("Firewalk!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(e,i)=>{const s=[];return e.tiles.forEach(o=>{const c=De(i,o.position);if(c>0&&c<=4){const l=o.effects.some(h=>h.id==="FIRE"),f=o.baseId==="LAVA"||o.traits.has("LIQUID");(l||f)&&s.push(o.position)}}),s},upgrades:{},scenarios:wt("FIREWALK")},YS={id:"BOMB_TOSS",name:"Bomb Toss",description:"Throw a bomb to a nearby tile.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:2},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};if(!un(i.position,s,3))return c.push("Out of range!"),{effects:o,messages:c,consumesTurn:!1};if(!Ze.isWalkable(e,s))return c.push("Target blocked!"),{effects:o,messages:c,consumesTurn:!1};if(Ne(e,s))return c.push("Target occupied!"),{effects:o,messages:c,consumesTurn:!1};const f=`bomb-${i.id}-${e.turnNumber}-${e.actionLog?.length??0}-${s.q}_${s.r}_${s.s}`,h=Us({id:f,type:"enemy",subtype:"bomb",factionId:i.factionId,position:s,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return h.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.push({type:"SpawnActor",actor:h}),c.push("Bomb tossed!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>{const o=[];for(let c=-3;c<=3;c++)for(let l=Math.max(-3,-c-3);l<=Math.min(3,-c+3);l++){const f={q:i.q+c,r:i.r+l,s:i.s-c-l};un(i,f,3)&&Ze.isWalkable(e,f)&&(Ne(e,f)||o.push(f))}return o},upgrades:{}},KS={id:"TIME_BOMB",name:"Time Bomb",description:"Detonates when the fuse reaches zero.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0,damage:1},execute:(e,i,s)=>{const o=i.statusEffects.find(h=>h.type==="time_bomb");if(o&&o.duration>1)return{effects:[],messages:[],consumesTurn:!0};const c=i.position,f=[c,...xt(c)].map(h=>({type:"Damage",target:h,amount:1,reason:"bomb_explosion"}));return f.push({type:"Damage",target:i.id,amount:999,reason:"bomb_explosion"}),f.push({type:"Juice",effect:"explosion_ring",target:c,intensity:"high",metadata:{signature:"ATK.BLAST.FIRE.TIME_BOMB",family:"attack",primitive:"blast",phase:"impact",element:"fire",variant:"time_bomb",targetRef:{kind:"target_hex"},skillId:"TIME_BOMB"}}),{effects:f,messages:["A bomb exploded!"],consumesTurn:!0}},getValidTargets:(e,i)=>[i],upgrades:{}},FS=(e,i)=>!!e.tiles.get(Te(i))?.traits?.has("CORPSE"),WS=(e,i,s)=>{const o=[];return e.tiles.forEach(c=>{c.traits.has("CORPSE")&&De(i,c.position)<=s&&o.push(c.position)}),o},XS={id:"CORPSE_EXPLOSION",name:"Corpse Explosion",description:"Detonate a target corpse, dealing damage in a 1-tile radius.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:2},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};if(!FS(e,s))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!un(i.position,s,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};o.push({type:"RemoveCorpse",position:s});const f=[s,...xt(s)],h=tt(i),b=!!e.intentPreview?.dangerTiles?.some(y=>ae(y,i.position));for(const y of f){const S=Ne(e,y),v=_n({attackerId:i.id,targetId:S?.id||Te(y),skillId:"CORPSE_EXPLOSION",basePower:2,trinity:h,targetTrinity:S?tt(S):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.25}],statusMultipliers:[],inDangerPreviewHex:b,theoreticalMaxPower:2});o.push({type:"Damage",target:y,amount:v.finalPower,reason:"corpse_explosion",scoreEvent:v.scoreEvent})}return o.push({type:"Juice",effect:"explosion_ring",target:s,metadata:{signature:"ATK.BLAST.VOID.CORPSE_EXPLOSION",family:"attack",primitive:"blast",phase:"impact",element:"void",variant:"corpse_explosion",targetRef:{kind:"target_hex"},skillId:"CORPSE_EXPLOSION"}}),o.push({type:"Juice",effect:"shake",intensity:"high",metadata:{signature:"UI.SHAKE.VOID.CORPSE_EXPLOSION",family:"ui",primitive:"shake",phase:"impact",element:"void",variant:"corpse_explosion_shake",skillId:"CORPSE_EXPLOSION",camera:{shake:"high"}}}),o.push({type:"Juice",effect:"combat_text",target:s,text:"BOOM!",metadata:{signature:"UI.TEXT.VOID.CORPSE_EXPLOSION",family:"ui",primitive:"text",phase:"impact",element:"void",variant:"corpse_explosion_text",targetRef:{kind:"target_hex"},skillId:"CORPSE_EXPLOSION",textTone:"damage"}}),c.push("Corpse exploded!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>WS(e,i,4),upgrades:{},scenarios:wt("CORPSE_EXPLOSION")},GS=(e,i)=>i.q>=0&&i.q<e.gridWidth&&i.r>=0&&i.r<e.gridHeight,QS=(e,i,s)=>xt(s).filter(c=>GS(e,c)).filter(c=>Ze.isWalkable(e,c)).filter(c=>!Ne(e,c)).sort((c,l)=>{const f=De(c,i.position),h=De(l,i.position);return f!==h?f-h:c.q!==l.q?c.q-l.q:c.r-l.r})[0]||null,JS=(e,i)=>i.id!==e.id&&i.factionId===e.factionId;function ry(e,i,s,o="fail"){const c=Ne(e,s);if(!c)return{ok:!0,spawnPosition:s,effects:[],messages:[]};if(o==="push_friendly"){if(!JS(i,c))return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."};const l=QS(e,i,s);return l?{ok:!0,spawnPosition:s,effects:[{type:"Displacement",target:c.id,destination:l,source:c.position,simulatePath:!0}],messages:["Ally repositions to make room."]}:{ok:!1,effects:[],messages:[],failureMessage:"No space to reposition ally."}}return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."}}const ZS=(e,i)=>!!e.tiles.get(Te(i))?.traits?.has("CORPSE"),eA=(e,i,s)=>{const o=[];return e.tiles.forEach(c=>{c.traits.has("CORPSE")&&De(i,c.position)<=s&&o.push(c.position)}),o},tA=e=>{const i=e.initialSeed??e.rngSeed??"0",s=new Set([...e.enemies.map(l=>l.id),...(e.companions||[]).map(l=>l.id)]);let o=(e.floor<<20)+(e.turnNumber<<12)+(e.actionLog?.length??0)+(e.rngCounter??0),c=`skeleton_${pr(i,o,8,"skeleton")}`;for(;s.has(c);)o+=1,c=`skeleton_${pr(i,o,8,"skeleton")}`;return c},nA={id:"RAISE_DEAD",name:"Raise Dead",description:"Reanimate a target corpse into a Skeleton minion (Faction: Player).",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};if(!ZS(e,s))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!un(i.position,s,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=ry(e,i,s,"push_friendly");if(!f.ok)return{effects:o,messages:[f.failureMessage||"Target tile occupied."],consumesTurn:!1};o.push(...f.effects),c.push(...f.messages),o.push({type:"RemoveCorpse",position:s});const h=r0({companionType:"skeleton",ownerId:i.id,id:tA(e),position:s});return o.push({type:"SpawnActor",actor:h}),o.push({type:"Juice",effect:"flash",target:s,color:"#aaaaaa",metadata:{signature:"STATE.SPAWN.VOID.RAISE_DEAD",family:"status",primitive:"spawn",phase:"impact",element:"void",variant:"raise_dead",targetRef:{kind:"target_hex"},skillId:"RAISE_DEAD"}}),c.push("Skeleton raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>{const s=Ne(e,i);return s?eA(e,i,4).filter(o=>ry(e,s,o,"push_friendly").ok):[]},upgrades:{},scenarios:wt("RAISE_DEAD")},iA={id:"SOUL_SWAP",name:"Soul Swap",description:"Instantly swap positions with a player-aligned minion.",slot:"utility",icon:"",baseVariables:{range:6,cost:0,cooldown:3},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};if(!un(i.position,s,6))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const l=Ne(e,s);return!l||l.factionId!=="player"||l.id===i.id?{effects:o,messages:["Target must be a minion!"],consumesTurn:!1}:(o.push({type:"Displacement",target:i.id,destination:s}),o.push({type:"Displacement",target:l.id,destination:i.position}),o.push({type:"Juice",effect:"flash",target:s,color:"#330066",metadata:{signature:"MOVE.BLINK.ARCANE.SOUL_SWAP_ARRIVE",family:"movement",primitive:"blink",phase:"instant",element:"arcane",variant:"soul_swap_arrival",targetRef:{kind:"target_hex"},skillId:"SOUL_SWAP"}}),o.push({type:"Juice",effect:"flash",target:i.position,color:"#330066",metadata:{signature:"MOVE.BLINK.ARCANE.SOUL_SWAP_DEPART",family:"movement",primitive:"blink",phase:"instant",element:"arcane",variant:"soul_swap_departure",targetRef:{kind:"target_hex"},skillId:"SOUL_SWAP"}}),c.push("Soul Swapped!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(e,i)=>e.enemies.filter(s=>s.factionId==="player"&&un(i,s.position,6)).map(s=>s.position),upgrades:{},scenarios:wt("SOUL_SWAP")},aA={id:"MULTI_SHOOT",name:"Multi-Shoot",description:"A spread of arrows. Axial range 4. Deals damage to target and neighbors.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:1},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:l}=Zi(i.position,s);if(!un(i.position,s,4)||!l)return{effects:o,messages:["Invalid target! Axial range 4 only."],consumesTurn:!1};const f=[s,...xt(s)],h=tt(i);for(const b of f){const y=Ne(e,b),S=_n({attackerId:i.id,targetId:y?.id||Te(b),skillId:"MULTI_SHOOT",basePower:1,trinity:h,targetTrinity:y?tt(y):void 0,damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.1},{attribute:"mind",coefficient:.1}],statusMultipliers:[]});o.push({type:"Damage",target:b,amount:S.finalPower,reason:"multi_shoot",scoreEvent:S.scoreEvent})}return o.push({type:"Juice",effect:"flash",target:s,color:"#ffff00",metadata:{signature:"ATK.SHOOT.PHYSICAL.MULTI_SHOOT",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"multi_shoot",targetRef:{kind:"target_hex"},skillId:"MULTI_SHOOT"}}),c.push("Multi-Shoot!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>dt.getAxialTargets(e,i,4),upgrades:{},scenarios:wt("MULTI_SHOOT")},sA={id:"SET_TRAP",name:"Set Trap",description:"Place a hidden trap. Roots units for 3 turns.",slot:"utility",icon:"",baseVariables:{range:1,cost:1,cooldown:2},execute:(e,i,s)=>{const o=[],c=[];return s?Ji(e,s)||ko(e,s)?{effects:o,messages:["Cannot place trap here!"],consumesTurn:!1}:(o.push({type:"PlaceTrap",position:s,ownerId:i.id}),o.push({type:"Juice",effect:"combat_text",target:s,text:"Trapped",metadata:{signature:"UI.TEXT.NEUTRAL.SET_TRAP",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"set_trap",targetRef:{kind:"target_hex"},skillId:"SET_TRAP",textTone:"status"}}),c.push("Trap set."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(e,i)=>xt(i).filter(s=>!Ji(e,s)&&!ko(e,s)),upgrades:{},scenarios:wt("SET_TRAP")},oA={id:"SWIFT_ROLL",name:"Swift Roll",description:"Quickly dodge 2 tiles. Passive: Automatically roll away from attackers when hit.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,i,s)=>{const o=[],c=[];return s?un(i.position,s,2)?Ji(e,s)||ko(e,s)||zs(e,s,i.id)?{effects:o,messages:["Cannot roll there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:s}),o.push({type:"Juice",effect:"dashBlur",target:s,path:[i.position,s],metadata:{signature:"MOVE.DASH.NEUTRAL.SWIFT_ROLL",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"swift_roll",sourceRef:{kind:"source_hex"},targetRef:{kind:"target_hex"},skillId:"SWIFT_ROLL"}}),c.push("Swift roll!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(e,i)=>dt.getAreaTargets(e,i,2).filter(o=>ae(o,i)?!1:!Ji(e,o)&&!ko(e,o)&&!zs(e,o)),upgrades:{},scenarios:wt("SWIFT_ROLL")},rA={id:"SNEAK_ATTACK",name:"Sneak Attack",description:"Attack an adjacent enemy. Deals massive damage if executed from stealth.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};const l=ga(e.enemies,s);if(!l)return{effects:o,messages:["No target!"],consumesTurn:!1};if(!un(i.position,s,1))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=(i.stealthCounter||0)>0,h=f?3:1,b=_n({attackerId:i.id,targetId:l.id,skillId:"SNEAK_ATTACK",basePower:h,trinity:tt(i),targetTrinity:tt(l),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.25}],statusMultipliers:[]});return o.push({type:"Damage",target:l.id,amount:b.finalPower,reason:"sneak_attack",source:i.position,scoreEvent:b.scoreEvent}),f?(o.push({type:"Juice",effect:"flash",target:s,color:"#ff0000",metadata:{signature:"ATK.STRIKE.SHADOW.SNEAK_ATTACK",family:"attack",primitive:"strike",phase:"impact",element:"shadow",variant:"sneak_attack",targetRef:{kind:"target_hex"},skillId:"SNEAK_ATTACK",flags:{crit:!0}}}),c.push("SNEAK ATTACK!")):c.push("Sneak attack (No stealth bonus)."),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>xt(i).filter(s=>!!ga(e.enemies,s)),upgrades:{},scenarios:wt("SNEAK_ATTACK")},lA={id:"SMOKE_SCREEN",name:"Smoke Screen",description:"Vanish into a cloud of smoke. Adds +2 to stealth counter.",slot:"utility",icon:"",baseVariables:{range:0,cost:0,cooldown:2},execute:(e,i,s)=>{const o=[],c=[];return o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:i.position,metadata:{signature:"STATE.FADE.SHADOW.SMOKE_SCREEN",family:"status",primitive:"state_fade",phase:"instant",element:"shadow",variant:"smoke_screen",targetRef:{kind:"target_hex"},skillId:"SMOKE_SCREEN"}}),c.push("Smoke Screen!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>[i],upgrades:{},scenarios:wt("SMOKE_SCREEN")},cA={id:"SHADOW_STEP",name:"Shadow Step",description:"Teleport through the shadows. Only works while invisible. Extends stealth.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,i,s)=>{const o=[],c=[];return s?(i.stealthCounter||0)>0?un(i.position,s,2)?Ji(e,s)||ko(e,s)||zs(e,s,i.id)?{effects:o,messages:["Cannot step there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:s}),o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:s,metadata:{signature:"MOVE.BLINK.SHADOW.SHADOW_STEP",family:"movement",primitive:"blink",phase:"instant",element:"shadow",variant:"shadow_step_arrival",targetRef:{kind:"target_hex"},skillId:"SHADOW_STEP"}}),c.push("Shadow stepped!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:["Must be invisible to Shadow Step!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(e,i)=>(e.player.stealthCounter||0)>0?dt.getAreaTargets(e,i,2).filter(c=>ae(c,i)?!1:!Ji(e,c)&&!ko(e,c)&&!zs(e,c)):[],upgrades:{},scenarios:wt("SHADOW_STEP")};function jf(e,i){return e.enemies.find(s=>s.companionOf===i&&s.subtype==="falcon")}const uA={id:"FALCON_COMMAND",name:e=>{const i=e?.player?.id;if(!i)return"Summon Falcon";const s=jf(e,i);if(!s)return"Summon Falcon";const o=s.companionState?.mode||"roost";return o==="scout"?"Falcon: Scout":o==="predator"?"Falcon: Hunt":"Falcon: Roost"},description:e=>{const i=e?.player?.id;if(!i)return"Call your Falcon companion.";const s=jf(e,i);if(!s)return"Call your Falcon companion.";const o=s.companionState?.mode||"roost";return o==="scout"?"Click tile to set patrol zone. Falcon orbits and attacks nearby enemies.":o==="predator"?"Click enemy to mark as prey. Falcon pursues and uses Apex Strike.":"Falcon returns to you. Heals and cleanses 1 debuff on arrival."},slot:"offensive",icon:"",baseVariables:{range:6,cost:0,cooldown:0},execute:(e,i,s)=>{const o=[],c=[];let l=jf(e,i.id);if(!l){const b=dv({ownerId:i.id,position:xt(i.position)[0]});return o.push({type:"SpawnActor",actor:b}),o.push({type:"Message",text:"Your Falcon companion awakens!"}),c.push("Falcon summoned!"),{effects:o,messages:c,consumesTurn:!0}}const f=s?Ne(e,s):void 0;return!s||ae(s,i.position)||!!(f&&f.id===i.id)?(c.push("Falcon returns to roost."),o.push({type:"Juice",effect:"combat_text",target:i.position,text:"Roost",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_ROOST",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_roost",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"system"}}),o.push({type:"UpdateCompanionState",target:l.id,mode:"roost"}),{effects:o,messages:c,consumesTurn:!0}):f&&f.factionId==="enemy"?(c.push(`Falcon marks ${f.subtype||"enemy"} as prey!`),o.push({type:"Juice",effect:"combat_text",target:s,text:" Marked",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_MARK",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_mark",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"status"}}),o.push({type:"ApplyStatus",target:f.id,status:"marked_predator",duration:-1}),o.push({type:"UpdateCompanionState",target:l.id,mode:"predator",markTarget:f.id}),{effects:o,messages:c,consumesTurn:!0}):(c.push("Falcon set to patrol zone."),o.push({type:"Juice",effect:"combat_text",target:s,text:" Patrol",metadata:{signature:"UI.TEXT.NEUTRAL.FALCON_PATROL",family:"ui",primitive:"text",phase:"instant",element:"neutral",variant:"falcon_patrol",targetRef:{kind:"target_hex"},skillId:"FALCON_COMMAND",textTone:"system"}}),o.push({type:"UpdateCompanionState",target:l.id,mode:"scout",markTarget:s}),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(e,i)=>dt.getAreaTargets(e,i,6).filter(o=>(ae(o,i),!0)),upgrades:{KEEN_SIGHT:{id:"KEEN_SIGHT",name:"Keen Sight",description:"Falcon reveals hidden enemies within 3 tiles of its position."},FALCON_TWIN_TALONS:{id:"FALCON_TWIN_TALONS",name:"Twin Talons",description:"Basic Peck hits 2 targets instead of 1."},APEX_PREDATOR:{id:"APEX_PREDATOR",name:"Apex Predator",description:"Apex Strike cooldown reduced by 1. Marked enemies take +1 damage from all sources."}},scenarios:wt("FALCON_COMMAND")},dA={id:"FALCON_PECK",name:"Peck",description:"The falcon pecks an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,i,s,o=[])=>{const c=[],l=[],f=i.companionOf,b=(f?f===e.player.id?e.player:e.enemies.find(A=>A.id===f):void 0)?.activeSkills?.find(A=>A.id==="FALCON_COMMAND")?.activeUpgrades||[],y=o.includes("TWIN_TALONS")||b.includes("TWIN_TALONS")||b.includes("FALCON_TWIN_TALONS");if(!s)return{effects:c,messages:l,consumesTurn:!1};const S=Ne(e,s);if(!S||S.factionId==="player")return{effects:c,messages:l,consumesTurn:!1};if(De(i.position,s)>1)return{effects:c,messages:l,consumesTurn:!1};const v=[S];if(y){const A=xt(i.position).map(M=>Ne(e,M)).filter(M=>!!M&&M.id!==S.id&&M.factionId==="enemy")[0];A&&v.push(A)}for(const A of v){const M=_n({attackerId:i.id,targetId:A.id,skillId:"FALCON_PECK",basePower:1,trinity:tt(i),targetTrinity:tt(A),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:A.id,amount:M.finalPower,reason:"falcon_peck",scoreEvent:M.scoreEvent})}return c.push({type:"Juice",effect:"combat_text",target:s,text:"Peck!",intensity:"low",metadata:{signature:"UI.TEXT.PHYSICAL.FALCON_PECK",family:"ui",primitive:"text",phase:"instant",element:"physical",variant:"falcon_peck",targetRef:{kind:"target_hex"},skillId:"FALCON_PECK",textTone:"damage"}}),l.push(y&&v.length>1?`Falcon pecked ${v.length} enemies!`:`Falcon pecked ${S.subtype||"enemy"}!`),{effects:c,messages:l,consumesTurn:!0}},getValidTargets:(e,i)=>xt(i).filter(s=>{const o=Ne(e,s);return o&&o.factionId==="enemy"}),upgrades:{TWIN_TALONS:{id:"TWIN_TALONS",name:"Twin Talons",description:"Peck hits 2 adjacent targets instead of 1."}},scenarios:wt("FALCON_PECK")},fA={id:"FALCON_APEX_STRIKE",name:"Apex Strike",description:"The falcon dives into a target for lethal damage.",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:2,damage:40},execute:(e,i,s,o=[])=>{const c=[],l=[],f=i.companionOf,b=(f?f===e.player.id?e.player:e.enemies.find(A=>A.id===f):void 0)?.activeSkills?.find(A=>A.id==="FALCON_COMMAND")?.activeUpgrades||[],y=o.includes("APEX_PREDATOR")||b.includes("APEX_PREDATOR");if(!s)return{effects:c,messages:l,consumesTurn:!1};const S=Ne(e,s);if(!S)return{effects:c,messages:l,consumesTurn:!1};if(i.companionState?.apexStrikeCooldown&&i.companionState.apexStrikeCooldown>0)return{effects:c,messages:l,consumesTurn:!1};const v=_n({attackerId:i.id,targetId:S.id,skillId:"FALCON_APEX_STRIKE",basePower:40,trinity:tt(i),targetTrinity:tt(S),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return c.push({type:"Damage",target:S.id,amount:v.finalPower,reason:"apex_strike",scoreEvent:v.scoreEvent}),c.push({type:"Juice",effect:"impact",target:s,intensity:"high",metadata:{signature:"ATK.STRIKE.PHYSICAL.FALCON_APEX_STRIKE",family:"attack",primitive:"strike",phase:"impact",element:"physical",variant:"falcon_apex_strike",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"FALCON_APEX_STRIKE",camera:{kick:"medium"}}}),c.push({type:"UpdateCompanionState",target:i.id,apexStrikeCooldown:y?1:2}),l.push(`Falcon executes APEX STRIKE on ${S.subtype||"enemy"}!`),{effects:c,messages:l,consumesTurn:!0}},upgrades:{},getValidTargets:(e,i)=>{const s=[];return e.enemies.forEach(o=>{De(i,o.position)<=4&&s.push(o.position)}),s}},mA={id:"FALCON_HEAL",name:"Roost Heal",description:"The falcon roosts and restores health to its companion.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:1},execute:(e,i,s)=>{const o=[],c=[];if(!s)return{effects:o,messages:c,consumesTurn:!1};const l=Ne(e,s);return l?i.companionState?.healCooldown&&i.companionState.healCooldown>0?{effects:o,messages:c,consumesTurn:!1}:(o.push({type:"Heal",target:l.id,amount:1}),o.push({type:"Juice",effect:"flash",target:l.position,color:"#00ff88",metadata:{signature:"STATE.APPLY.HOLY.FALCON_HEAL",family:"status",primitive:"status_apply",phase:"impact",element:"holy",variant:"falcon_heal",targetRef:{kind:"target_hex"},skillId:"FALCON_HEAL"}}),o.push({type:"UpdateCompanionState",target:i.id,healCooldown:1}),c.push("Falcon roosts. You feel restored."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(e,i)=>{const s=[],o=e.player;return De(i,o.position)<=1&&s.push(o.position),s}},pA={id:"FALCON_SCOUT",name:"Scout Orbit",description:"The actor orbits a target point in a hexagonal ring.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,i,s)=>{const o=[],c=[],l=i.companionState?.markTarget;if(!l||typeof l!="object")return{effects:o,messages:c,consumesTurn:!1};const f=l,h=xt(f);let b;if(De(i.position,f)!==1)b=h.sort((y,S)=>De(i.position,y)-De(i.position,S))[0];else{const S=(h.findIndex(v=>ae(v,i.position))+1)%6;b=h[S]}return dt.isWithinBounds(e,b)&&Ze.isWalkable(e,b)&&!Ne(e,b)?(o.push({type:"Displacement",target:i.id,destination:b,source:i.position,simulatePath:!0}),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(e,i)=>[]},hA={id:"FALCON_AUTO_ROOST",name:"Auto Roost",description:"Automatically returns the falcon to roost mode when mark is lost.",slot:"passive",icon:"R",baseVariables:{range:0,cost:0,cooldown:0},execute:(e,i,s)=>({effects:[{type:"UpdateCompanionState",target:i.id,mode:"roost",markTarget:void 0}],messages:["Falcon loses prey and returns to roost mode."],consumesTurn:!0}),getValidTargets:(e,i)=>[i],upgrades:{}},ly=2,gA=3,yA=3,bA=2;function xA(e,i){const s=[];for(let o=0;o<6;o++){let c=e;for(let l=0;l<i;l++)c=ui(c,Rn(o));s.push(c)}return s}function vA(e,i,s){return xA(i,s).filter(c=>!(!dt.isWithinBounds(e,c)||!Ze.isWalkable(e,c)||Ne(e,c)))}const SA={id:"KINETIC_TRI_TRAP",name:"Kinetic Tri-Trap",description:"Deploy 3 hidden traps on axial tiles. Triggered enemies are flung away.",slot:"defensive",icon:"",baseVariables:{range:ly,cost:0,cooldown:yA},execute:(e,i,s,o=[])=>{const c=[],l=[];let f=e;const h=o.includes("VOLATILE_CORE"),b=o.includes("TRAP_CHAIN_REACTION")||o.includes("CHAIN_REACTION"),y=o.includes("QUICK_RELOAD"),S=vA(e,i.position,ly);if(S.length===0)return{effects:c,messages:["No valid trap positions!"],consumesTurn:!1};const v=Math.min(gA,S.length),A=[];c.push({type:"RemoveTrap",position:{q:0,r:0,s:0},ownerId:i.id});const M=[...S];for(let p=0;p<v&&M.length!==0;p++){const{value:g,nextState:C}=wo(f);f=C;const N=Math.floor(g*M.length)%M.length;A.push(M[N]),M.splice(N,1)}for(const p of A)c.push({type:"PlaceTrap",position:p,ownerId:i.id,volatileCore:h,chainReaction:b,resetCooldown:y?1:bA}),c.push({type:"Juice",effect:"flash",target:p,intensity:"low",color:"#ffaa00",metadata:{signature:"ENV.TRAP.KINETIC.DEPLOY",family:"environment",primitive:"spawn",phase:"impact",element:"kinetic",variant:"kinetic_tri_trap_deploy",targetRef:{kind:"target_hex"},skillId:"KINETIC_TRI_TRAP"}});return l.push(`${A.length} traps deployed.`),{effects:c,messages:l,consumesTurn:!0}},getValidTargets:(e,i)=>[i],upgrades:{VOLATILE_CORE:{id:"VOLATILE_CORE",name:"Volatile Core",description:"Traps deal 1 damage when triggered."},TRAP_CHAIN_REACTION:{id:"TRAP_CHAIN_REACTION",name:"Chain Reaction",description:"When a trap triggers, adjacent traps also activate."},QUICK_RELOAD:{id:"QUICK_RELOAD",name:"Quick Reload",description:"Individual trap reset cooldown reduced to 1."}},scenarios:wt("KINETIC_TRI_TRAP")},cy=1,uy=1,AA=1,b0=2,TA=2;function EA(e,i,s,o=b0){const c=ha(s,i);if(c===-1)return null;const l=Rn(c);for(let h=o;h>=AA;h--){let b=i,y=!0;for(let S=0;S<h;S++){if(b=ui(b,l),!dt.isWithinBounds(e,b)){y=!1;break}if(!Ze.isWalkable(e,b)){y=!1;break}}if(y&&!Ne(e,b))return b}const f=[(c+1)%6,(c+5)%6];for(const h of f){const b=Rn(h);let y=ui(i,b);if(dt.isWithinBounds(e,y)&&Ze.isWalkable(e,y)&&!Ne(e,y))return y}return null}const _A={id:"WITHDRAWAL",name:"Withdrawal",description:"Quick shot + tactical backroll. Auto-triggers when enemies close in.",slot:"utility",icon:"",baseVariables:{range:cy,cost:0,cooldown:TA,damage:uy},execute:(e,i,s,o=[])=>{const c=[],l=[],f=o.includes("PARTING_SHOT"),h=o.includes("NIMBLE_FEET");if(!s)return{effects:c,messages:["No target!"],consumesTurn:!1};if(De(i.position,s)>cy)return{effects:c,messages:["Target out of range!"],consumesTurn:!1};const y=Ne(e,s);if(!y)return{effects:c,messages:["No enemy at target!"],consumesTurn:!1};if(y.factionId===i.factionId)return{effects:c,messages:["Cannot target allies!"],consumesTurn:!1};const S=_n({attackerId:i.id,targetId:y.id,skillId:"WITHDRAWAL",basePower:uy+(f?1:0),trinity:tt(i),targetTrinity:tt(y),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});c.push({type:"Damage",target:y.id,amount:S.finalPower,scoreEvent:S.scoreEvent}),c.push({type:"Juice",effect:"impact",target:s,metadata:{signature:"ATK.SHOOT.PHYSICAL.WITHDRAWAL",family:"attack",primitive:"shoot",phase:"impact",element:"physical",variant:"withdrawal_shot",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"WITHDRAWAL"}}),l.push(`Withdrawal shot hits ${y.subtype||"enemy"}!`);const v=h?3:b0,A=EA(e,i.position,s,v);return A?(c.push({type:"Displacement",target:"self",destination:A,source:i.position}),c.push({type:"Juice",effect:"dashBlur",target:A,path:[i.position,A],metadata:{signature:"MOVE.DASH.NEUTRAL.WITHDRAWAL_BACKROLL",family:"movement",primitive:"dash",phase:"travel",element:"neutral",variant:"withdrawal_backroll",sourceRef:{kind:"source_actor"},targetRef:{kind:"target_hex"},skillId:"WITHDRAWAL"}}),l.push("Backroll!")):l.push("No safe retreat available!"),{effects:c,messages:l,consumesTurn:!0}},getValidTargets:(e,i)=>xt(i).filter(s=>{const o=Ne(e,s);return o&&o.factionId==="enemy"}),upgrades:{PARTING_SHOT:{id:"PARTING_SHOT",name:"Parting Shot",description:"Withdrawal deals +1 damage."},NIMBLE_FEET:{id:"NIMBLE_FEET",name:"Nimble Feet",description:"Backroll distance increased to 3 hexes."},HAIR_TRIGGER:{id:"HAIR_TRIGGER",name:"Hair Trigger",description:"Passive reaction does not consume cooldown."}},scenarios:wt("WITHDRAWAL")},wA={id:"ABSORB_FIRE",name:"Absorb Fire",description:"Fire heals you instead of harming you.",slot:"passive",icon:"",baseVariables:{cost:0,cooldown:0,range:0},execute:(e,i,s)=>({effects:[],messages:[]}),getValidTargets:()=>[],upgrades:{}},Hs=(e,i)=>e.includes(i),MA=e=>{const i=new Set,s=e.id;return((e.baseVariables.damage||0)>0||/(ATTACK|THROW|BLAST|FIREBALL|BASH|PECK|EXPLOSION|SPEAR|SHOOT)/.test(s))&&i.add("damage"),/(MOVE|DASH|JUMP|ROLL|VAULT|STEP|GRAPPLE|WITHDRAWAL|WALK)/.test(s)&&i.add("move"),/(HEAL|ABSORB)/.test(s)&&i.add("heal"),/(SHIELD|PROTECT|BULWARK)/.test(s)&&i.add("protect"),/(STUN|TRAP|SMOKE|TELEGRAPH|ROOT|SWAP|SCOUT)/.test(s)&&i.add("control"),/(RAISE|FALCON|SUMMON)/.test(s)&&i.add("summon"),/(FIRE|LAVA|HAZARD|TRAP)/.test(s)&&i.add("hazard"),e.slot==="offensive"&&i.add("damage"),e.slot==="defensive"&&i.add("protect"),e.slot==="utility"&&i.add("utility"),(e.baseVariables.cooldown>0||e.baseVariables.cost>0)&&i.add("economy"),i.size||i.add("utility"),[...i]},OA={BASIC_MOVE:{intentTags:["move","objective","utility"],target:{pattern:"single"},estimates:{movement:1}},BASIC_ATTACK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:4}},AUTO_ATTACK:{intentTags:["damage","utility"],target:{pattern:"single"},estimates:{damage:2}},DASH:{intentTags:["move","damage","utility"],target:{pattern:"line"},estimates:{movement:2,damage:2},risk:{noProgressCastPenalty:5}},JUMP:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2},risk:{noProgressCastPenalty:6}},SHIELD_BASH:{intentTags:["damage","control","protect"],target:{pattern:"single"},estimates:{damage:3,control:2},risk:{requireEnemyContact:!0,noContactPenalty:5,noProgressCastPenalty:7}},BULWARK_CHARGE:{intentTags:["move","protect","damage"],target:{pattern:"line"},estimates:{movement:2,damage:4,shielding:2}},VAULT:{intentTags:["move","utility","control"],target:{pattern:"single"},estimates:{movement:3,control:2}},GRAPPLE_HOOK:{intentTags:["move","control"],target:{pattern:"line"},estimates:{movement:3,control:2}},SHIELD_THROW:{intentTags:["damage","control"],target:{pattern:"line"},estimates:{damage:6,control:2}},SPEAR_THROW:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:5}},ARCHER_SHOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:2},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:4}},FIREBALL:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:5,control:1}},FIREWALL:{intentTags:["hazard","control","damage"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:5,control:3}},FIREWALK:{intentTags:["move","hazard","utility"],target:{pattern:"single"},estimates:{movement:3},risk:{noProgressCastPenalty:8}},ABSORB_FIRE:{intentTags:["heal","hazard","utility"],target:{pattern:"self"},estimates:{healing:6},risk:{noProgressCastPenalty:2}},BOMB_TOSS:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:2}},TIME_BOMB:{intentTags:["damage","hazard","utility"],target:{pattern:"self"},estimates:{damage:6,control:1}},CORPSE_EXPLOSION:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:1}},RAISE_DEAD:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:5}},SOUL_SWAP:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:2}},MULTI_SHOOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5}},SET_TRAP:{intentTags:["control","hazard"],target:{pattern:"single"},estimates:{control:3}},SWIFT_ROLL:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2}},SNEAK_ATTACK:{intentTags:["damage","move"],target:{pattern:"single"},estimates:{damage:8,movement:2},risk:{requireEnemyContact:!0,noContactPenalty:3,noProgressCastPenalty:4}},SMOKE_SCREEN:{intentTags:["control","protect","utility"],target:{pattern:"radius",aoeRadius:1},estimates:{control:4,shielding:4}},SHADOW_STEP:{intentTags:["move","damage","utility"],target:{pattern:"single"},estimates:{movement:3,damage:3}},FALCON_COMMAND:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:4,control:2}},FALCON_PECK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:3}},FALCON_APEX_STRIKE:{intentTags:["damage","control"],target:{pattern:"single"},estimates:{damage:5,control:1}},FALCON_HEAL:{intentTags:["heal","utility"],target:{pattern:"single"},estimates:{healing:4}},FALCON_SCOUT:{intentTags:["control","utility"],target:{pattern:"self"},estimates:{control:3}},FALCON_AUTO_ROOST:{intentTags:["summon","utility"],target:{pattern:"self"},estimates:{summon:2}},KINETIC_TRI_TRAP:{intentTags:["control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{control:5,damage:4}},WITHDRAWAL:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:1}},SENTINEL_TELEGRAPH:{intentTags:["control","objective"],target:{pattern:"radius",aoeRadius:2},estimates:{control:3}},SENTINEL_BLAST:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:7}},THEME_HAZARDS:{intentTags:["hazard","control"],target:{pattern:"global"},estimates:{control:2}}},CA=(e,i)=>i?{...e,...i,target:{...e.target,...i.target||{}},estimates:{...e.estimates,...i.estimates||{}},economy:{...e.economy,...i.economy||{}},risk:{...e.risk,...i.risk||{}}}:e,kA=e=>{const i=MA(e),s=(Hs(i,"move"),"single"),o={id:e.id,intentTags:i,target:{range:Math.max(0,e.baseVariables.range||0),pattern:s},estimates:{damage:Math.max(0,e.baseVariables.damage||0),movement:Hs(i,"move")?Math.max(1,Math.min(3,e.baseVariables.range||1)):0,healing:Hs(i,"heal")?2:0,shielding:Hs(i,"protect")?1:0,control:Hs(i,"control")?1:0,summon:Hs(i,"summon")?1:0},economy:{cost:Math.max(0,e.baseVariables.cost||0),cooldown:Math.max(0,e.baseVariables.cooldown||0),consumesTurn:!0},risk:{selfExposure:Hs(i,"move")?.5:0,hazardAffinity:Hs(i,"hazard")?.5:0},complexity:1};return CA(o,OA[e.id])},RA=e=>{const i=[];return(!e.intentTags||e.intentTags.length===0)&&i.push("intentTags must not be empty"),(!Number.isFinite(e.target.range)||e.target.range<0)&&i.push("target.range must be >= 0"),e.target.pattern||i.push("target.pattern is required"),(!Number.isFinite(e.economy.cooldown)||e.economy.cooldown<0)&&i.push("economy.cooldown must be >= 0"),(!Number.isFinite(e.economy.cost)||e.economy.cost<0)&&i.push("economy.cost must be >= 0"),(!Number.isFinite(e.complexity)||e.complexity<0)&&i.push("complexity must be >= 0"),i},NA=e=>{const i=[],s=[];for(const[o,c]of Object.entries(e)){const l=c.intentProfile||kA(c);c.intentProfile=l;const f=RA(l);f.length>0&&s.push({skillId:o,errors:f}),l||i.push(o)}return{missing:i,invalid:s}},IA=(e,i)=>e.player.id===i?e.player:e.enemies.find(s=>s.id===i)||e.companions?.find(s=>s.id===i),LA=(e,i,s)=>!!(e.player.id!==s&&ae(e.player.position,i)||e.enemies.some(o=>o.id!==s&&o.hp>0&&ae(o.position,i))||e.companions?.some(o=>o.id!==s&&o.hp>0&&ae(o.position,i))),dy=(e,i)=>{const s={q:i.q-e.q,r:i.r-e.r,s:i.s-e.s};let o=Ol[0],c=Number.NEGATIVE_INFINITY;for(const l of Ol){const f=l.q*s.q+l.r*s.r+l.s*s.s;f>c&&(c=f,o=l)}return o},BA=(e,i)=>{const s=IA(e,i.targetActorId);if(!s)return{effects:[],destination:null,collided:!1};const o=Math.max(0,Math.min(i.maxDistance,Math.floor(i.magnitude)));if(o<=0)return{effects:[],destination:s.position,collided:!1};const c=s.position,l=i.mode==="push"?dy(i.source,c):dy(c,i.source),f=[c];let h=c,b=!1;for(let S=0;S<o;S++){const v=ui(h,l);if(!Ze.isWalkable(e,v)||LA(e,v,s.id)){b=!0;break}f.push(v),h=v}const y=[];return ae(h,c)||y.push({type:"Displacement",target:s.id,destination:h,path:f,simulatePath:!0}),b&&i.collision.onBlocked==="crush_damage"&&y.push({type:"Damage",target:s.id,amount:Math.max(0,Math.floor(i.collision.crushDamage??0)),reason:i.damageReason||"crush"}),{effects:y,destination:h,collided:b}},Vc=e=>JSON.parse(JSON.stringify(e)),HA=(e,i)=>i==="floor"?Math.floor(e):i==="round"?Math.round(e):i==="ceil"?Math.ceil(e):e,Df=(e,i)=>{let s=e.base;for(const o of e.scaling||[])s+=(i[o.stat]??0)*o.coefficient;return s=HA(s,e.round),e.min!==void 0&&(s=Math.max(e.min,s)),e.max!==void 0&&(s=Math.min(e.max,s)),s},jA=(e,i,s,o)=>{const c=i.split(".");let l=e;for(let b=0;b<c.length-1;b++){const y=c[b],S=l[y];if(!S||typeof S!="object")return;l=S}const f=c[c.length-1],h=Number(l[f]);Number.isFinite(h)&&(s==="set"&&(l[f]=o),s==="add"&&(l[f]=h+o),s==="multiply"&&(l[f]=h*o))},DA=(e,i,s)=>{let o=Vc(e.baseAction.effects);const c=Vc(e.reactivePassives||[]),l=new Set(e.keywords),f={};for(const h of e.upgrades)f[h.id]=h;for(const h of i){const b=f[h];if(b)for(const y of b.modifiers){if(y.op==="add_effect"&&o.push(Vc(y.effect)),y.op==="remove_effect_by_tag"&&(o=o.filter(S=>!S.tags.includes(y.tag))),y.op==="modify_number"){const S=o.find(v=>v.id===y.effectId);S&&jA(S,y.field,y.mode,y.value)}y.op==="add_keyword"&&l.add(y.keyword),y.op==="remove_keyword"&&l.delete(y.keyword),y.op==="add_reaction"&&c.push(Vc(y.reaction))}}return e.inhibit?.filterMode==="exclude_matching_tags"&&s.size>0&&(o=o.filter(h=>!h.tags.some(b=>s.has(b)))),{effects:o,reactions:c,keywords:l}},PA=(e,i)=>{const s=tt(e),o=Number(i?.momentum??0),c=Number(i?.mass??1);return{body:s.body,mind:s.mind,instinct:s.instinct,mass:Number.isFinite(c)?c:1,speed:e.speed||1,momentum:Number.isFinite(o)?o:0}},Pf=(e,i)=>i?Ne(e,i)?.id:void 0,UA=(e,i,s,o,c)=>{if(o.kind==="MESSAGE")return[{type:"Message",text:o.text}];if(o.kind==="DEAL_DAMAGE"){const b=Math.max(0,Math.floor(Df(o.amount,c))),y=Pf(e,s);return[{type:"Damage",target:o.target.selector==="targetActor"?y||"targetActor":o.target.selector==="self"?i.id:s||"targetActor",amount:b,reason:o.reason}]}if(o.kind==="APPLY_STATUS"){const b=Pf(e,s);return[{type:"ApplyStatus",target:o.target.selector==="targetActor"?b||"targetActor":o.target.selector==="self"?i.id:s||"targetActor",status:o.statusId,duration:o.duration}]}const l=Pf(e,s);if(!l)return[];const f=Df(o.force.magnitude,c),h=o.force.collision.crushDamage?Df(o.force.collision.crushDamage,c):0;return BA(e,{source:i.position,targetActorId:l,mode:o.force.mode,magnitude:f,maxDistance:o.force.maxDistance,collision:{onBlocked:o.force.collision.onBlocked,crushDamage:h}}).effects},qA=(e,i,s,o)=>{const c=[];for(let l=0;l<e.gridWidth;l++)for(let f=0;f<e.gridHeight;f++){const h=ci(l,f);qs(h,e.gridWidth,e.gridHeight)&&De(i,h)<=s&&c.push(h)}return c.sort((l,f)=>{if(o==="q_then_r")return l.q===f.q?l.r-f.r:l.q-f.q;if(o==="r_then_q")return l.r===f.r?l.q-f.q:l.r-f.r;const h=De(i,l),b=De(i,f);return h!==b?h-b:l.q===f.q?l.r-f.r:l.q-f.q}),c},zA=e=>{const i=e.baseAction.effects.find(c=>c.kind==="DEAL_DAMAGE"),s=e.baseAction.effects.find(c=>c.kind==="APPLY_FORCE"),o={};return e.upgrades.forEach(c=>{o[c.id]={id:c.id,name:c.name,description:c.description||c.name}}),{id:e.id,name:e.name,description:e.description||e.name,slot:e.slot,icon:"data-driven",baseVariables:{range:e.targeting.range,cost:e.baseAction.costs.energy,cooldown:e.baseAction.costs.cooldown,damage:i?.amount?.base,momentum:s?.force?.magnitude?.base},execute:(c,l,f,h=[],b={})=>{const y=new Set(b.inhibitTags||[]),S=DA(e,h,y),v=PA(l,b),M=[...(S.reactions||[]).filter(g=>g.trigger==="ON_DECLARE").flatMap(g=>g.effects),...S.effects],p=[];for(const g of M)p.push(...UA(c,l,f,g,v));return{effects:p,messages:[],consumesTurn:e.baseAction.costs.consumesTurn}},getValidTargets:(c,l)=>{if(e.targeting.mode==="self")return[l];let f=qA(c,l,e.targeting.range,e.targeting.deterministicSort);return(e.targeting.mode==="single"||e.targeting.mode==="radius"||e.targeting.mode==="line")&&(e.targeting.requiresLos&&(f=f.filter(h=>fm(c,l,h).isValid)),e.targeting.allowOccupied||(f=f.filter(h=>!Ne(c,h)))),f},upgrades:o}},$A=new Map,x0=new Map,VA=e=>{const i=zA(e);return $A.set(e.id,e),x0.set(e.id,i),i},YA=e=>e.map(VA),KA=()=>{const e={};for(const[i,s]of x0.entries())e[i]=s;return e},Su={GRAPPLE_HOOK:TS,SPEAR_THROW:ES,ARCHER_SHOT:_S,SHIELD_BASH:wS,SHIELD_THROW:LS,VAULT:BS,JUMP:MS,BULWARK_CHARGE:OS,BASIC_ATTACK:CS,AUTO_ATTACK:p0,SENTINEL_TELEGRAPH:RS,SENTINEL_BLAST:NS,THEME_HAZARDS:IS,BASIC_MOVE:PS,DASH:US,FIREBALL:zS,FIREWALL:$S,FIREWALK:VS,BOMB_TOSS:YS,TIME_BOMB:KS,CORPSE_EXPLOSION:XS,RAISE_DEAD:nA,SOUL_SWAP:iA,MULTI_SHOOT:aA,SET_TRAP:sA,SWIFT_ROLL:oA,SNEAK_ATTACK:rA,SMOKE_SCREEN:lA,SHADOW_STEP:cA,FALCON_COMMAND:uA,FALCON_PECK:dA,FALCON_APEX_STRIKE:fA,FALCON_HEAL:mA,FALCON_SCOUT:pA,FALCON_AUTO_ROOST:hA,KINETIC_TRI_TRAP:SA,WITHDRAWAL:_A,ABSORB_FIRE:wA},Yc=NA(Su);if(Yc.missing.length>0||Yc.invalid.length>0){const e=Yc.missing.join(", "),i=Yc.invalid.map(s=>`${s.skillId}: ${s.errors.join("; ")}`).join(" | ");throw new Error(`Skill intent profile validation failed. missing=[${e}] invalid=[${i}]`)}const fr=()=>({...Su,...KA()});function Ps(e){const s=fr()[e];return s?{id:e,name:s.name,description:typeof s.description=="function"?s.description({}):s.description,slot:s.slot,cooldown:s.baseVariables.cooldown||0,currentCooldown:0,range:s.baseVariables.range||0,upgrades:Object.keys(s.upgrades||{}),activeUpgrades:[]}:null}function FA(){return[Ps("BASIC_MOVE"),Ps("BASIC_ATTACK"),Ps("AUTO_ATTACK"),Ps("SPEAR_THROW"),Ps("SHIELD_BASH"),Ps("JUMP")].filter(Boolean)}const WA={...Su,get:e=>fr()[e],getAllUpgrades:()=>{const e=fr();return Object.values(e).flatMap(i=>Object.values(i.upgrades||{}).map(s=>({...s,skillId:i.id})))},getUpgrade:e=>{const i=fr();for(const s of Object.values(i))if(s.upgrades?.[e])return s.upgrades[e]},getSkillForUpgrade:e=>{const i=fr();for(const[s,o]of Object.entries(i))if(o.upgrades?.[e])return s},getSkillRange:(e,i)=>{const s=(e.activeSkills||[]).find(l=>l.id===i),o=fr()[i];if(!o)return s?.range||0;let c=o.baseVariables.range;return s?.activeUpgrades&&s.activeUpgrades.forEach(l=>{const f=o.upgrades[l];f?.modifyRange&&(c+=f.modifyRange)}),c}},Un=WA,XA=Un.getSkillRange,GA=e=>Un.get(e),fy=(e,i)=>{const s=i.q-e.q,o=i.r-e.r;return s>0&&o===0?0:s>0&&o<0?1:s===0&&o<0?2:s<0&&o===0?3:s<0&&o>0?4:5},Li=(e,i,s,o=[],c)=>{if(Ex(e))return{position:e.position,state:s};const l=dt.getNeighbors(e.position);let f=[],h=c!==void 0?Math.abs(De(e.position,i)-c):De(e.position,i);for(const v of l){if(!dt.isWithinBounds(s,v))continue;const A=s.tiles.get(Te(v)),M=A?.traits.has("BLOCKS_LOS")||A?.baseId==="WALL",p=o.some(O=>ae(O,v))||s.enemies.some(O=>O.id!==e.id&&ae(O.position,v))||ae(v,i);if(M||p)continue;const g=A?Eo.getMovementCost(s,A):1,N=(c!==void 0?Math.abs(De(v,i)-c):De(v,i))+(g-1);N<h?(h=N,f=[v]):N===h&&f.push(v)}if(f.length===0)return{position:e.position,state:s};if(f.length===1)return{position:f[0],state:s};const{value:b,nextState:y}=wo(s),S=Math.floor(b*f.length)%f.length;return{position:f[S],state:y}},QA=(e,i,s)=>{if(De(e.position,i)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:s};let c=e.position,l=s;for(let h=0;h<2&&!(De(c,i)<=1);h++){const b={...e,position:c},{position:y,state:S}=Li(b,i,l,s.occupiedCurrentTurn);c=y,l=S}const f=!ae(c,e.position);return{entity:{...e,position:c,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:l,message:f?`${e.subtype} moves to (${c.q}, ${c.r})`:void 0}},JA=(e,i,s)=>{const o=De(e.position,i),c=fy(e.position,i);if(o===1)return{entity:{...e,facing:c,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:s};const{position:l,state:f}=Li(e,i,s,s.occupiedCurrentTurn),h=!ae(l,e.position);return{entity:{...e,position:l,facing:h?fy(e.position,l):c,intent:h?"Advancing":"BASIC_ATTACK",intentPosition:h?void 0:{...i}},nextState:f,message:h?`${e.subtype} advances to (${l.q}, ${l.r})`:void 0}},ZA=(e,i,s)=>{const o=De(e.position,i);let c=s;const{value:l,nextState:f}=wo(c);c=f;let h=e.position;if(o<=2||l<.3){const{value:v,nextState:A}=wo(c);c=A;const{value:M,nextState:p}=wo(c);c=p;const g=Math.floor(v*6),C=3+Math.floor(M*3);let N=e.position;for(let w=0;w<C;w++)N=ui(N,Rn(g));!dt.isWithinBounds(s,N)||!Ze.isWalkable(s,N)||s.occupiedCurrentTurn?.some(w=>ae(w,N))||s.enemies.some(w=>w.id!==e.id&&ae(w.position,N))||ae(N,i)||(h=N)}const b=!ae(h,e.position),y=De(h,i),S=!b&&y>=2&&y<=4;return{entity:{...e,position:h,intent:b?"Repositioning":S?"Casting":"Preparing",intentPosition:S?{...i}:void 0},nextState:c,message:b?`${e.subtype} teleports to (${h.q}, ${h.r})`:void 0}},eT=(e,i,s)=>{const o=De(e.position,i);if(o===1)return{entity:{...e,isVisible:!0,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:s};const{position:c,state:l}=Li(e,i,s,s.occupiedCurrentTurn),f=!ae(c,e.position);return{entity:{...e,position:c,isVisible:f?!1:o<=1,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:l,message:f?"You hear footsteps nearby...":void 0}},tT={sentinel:{telegraphSkillId:"SENTINEL_TELEGRAPH",executeSkillId:"SENTINEL_BLAST",triggerRange:3,telegraphMessage:"The Sentinel marks the blast zone..."}},nT=(e,i,s,o)=>{const l=De(e.position,i)<=o.triggerRange,f=s.turnNumber%2===0,h=!f;if(l&&h&&is(e))return{entity:{...e,intent:"Preparing",intentPosition:void 0},nextState:s,message:`${e.subtype} loses focus!`};if(l&&f)return{entity:{...e,intent:o.telegraphSkillId,intentPosition:{...i}},nextState:s,message:o.telegraphMessage};if(l&&h)return{entity:{...e,intent:o.executeSkillId,intentPosition:{...i}},nextState:s};const{position:b,state:y}=Li(e,i,s,s.occupiedCurrentTurn);return{entity:{...e,position:b,intent:"Moving",intentPosition:void 0},nextState:y}},iT=(e,i,s)=>{const o=e.actionCooldown??0;if(o>0)return{entity:{...e,actionCooldown:o-1,intent:"Charging Power"},nextState:s};const c=De(e.position,i);if(c>=1&&c<=3)return{entity:{...e,actionCooldown:2,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:s};const{position:l,state:f}=Li(e,i,s,s.occupiedCurrentTurn),h=!ae(l,e.position);return{entity:{...e,position:l,intent:h?"Lumbering":"Waiting",actionCooldown:0},nextState:f,message:h?`${e.subtype} lumbers to (${l.q}, ${l.r})`:void 0}},aT=(e,i,s)=>{const o=De(e.position,i);if(o>4){const{position:S,state:v}=Li(e,i,s,s.occupiedCurrentTurn),A=!ae(S,e.position);return{entity:{...e,position:S,intent:A?"Following":"Waiting"},nextState:v,message:A?`${e.subtype} follows you.`:void 0}}const c=s.enemies.filter(S=>S.factionId==="enemy").sort((S,v)=>De(e.position,S.position)-De(e.position,v.position))[0];if(!c){if(o>1){const{position:S,state:v}=Li(e,i,s,s.occupiedCurrentTurn);return{entity:{...e,position:S,intent:"Idle"},nextState:v}}return{entity:{...e,intent:"Idle"},nextState:s}}if(De(e.position,c.position)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...c.position}},nextState:s};const{position:f,state:h}=Li(e,c.position,s,s.occupiedCurrentTurn),b=!ae(f,e.position),y=De(f,c.position);return{entity:{...e,position:f,intent:b?"Advancing":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...c.position}},nextState:h,message:b?`${e.subtype} attacks ${c.subtype}!`:void 0}},sT=(e,i,s)=>{if(e.factionId==="player")return aT(e,i,s);if((s.player.stealthCounter||0)>0)return{entity:{...e,intent:"Searching",intentPosition:void 0},nextState:s};const c=De(e.position,i);switch(e.subtype){case"sprinter":return QA(e,i,s);case"shieldBearer":return JA(e,i,s);case"warlock":return ZA(e,i,s);case"assassin":return eT(e,i,s);case"golem":return iT(e,i,s);case"sentinel":return nT(e,i,s,tT.sentinel);case"raider":{if((e.position.q===i.q||e.position.r===i.r||e.position.s===i.s)&&c>=2&&c<=4)return{entity:{...e,intent:"DASH",intentPosition:{...i}},nextState:s};const{position:f,state:h}=Li(e,i,s,s.occupiedCurrentTurn),b=!ae(f,e.position),y=De(f,i);return{entity:{...e,position:f,intent:b?"Moving":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...i}},nextState:h,message:b?`${e.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"pouncer":{if((e.position.q===i.q||e.position.r===i.r||e.position.s===i.s)&&c>=2&&c<=4)return{entity:{...e,intent:"GRAPPLE_HOOK",intentPosition:{...i}},nextState:s};const{position:f,state:h}=Li(e,i,s,s.occupiedCurrentTurn),b=!ae(f,e.position);return{entity:{...e,position:f,intent:b?"Moving":"Waiting",intentPosition:void 0},nextState:h,message:b?`${e.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"archer":{const l=e.activeSkills?.some(v=>v.id==="ARCHER_SHOT")?"ARCHER_SHOT":"SPEAR_THROW",f=Un.get(l);if(c>1&&!!f?.getValidTargets&&f.getValidTargets(s,e.position).some(v=>ae(v,i)))return{entity:{...e,intent:l,intentPosition:{...i}},nextState:s};if(c===1&&e.activeSkills?.some(v=>v.id==="BASIC_ATTACK"))return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:s};const{position:b,state:y}=Li(e,i,s,s.occupiedCurrentTurn),S=!ae(b,e.position);return{entity:{...e,position:b,intent:S?"Moving":"Idle",intentPosition:void 0},nextState:y,message:S?`${e.subtype} moves to (${b.q}, ${b.r})`:void 0}}case"bomber":{const l=e.actionCooldown??0;if(l===0&&c>=2&&c<=3){const S=dt.getNeighbors(i).filter(v=>{const A=!Ze.isWalkable(s,v),M=s.enemies.some(p=>ae(p.position,v));return dt.isWithinBounds(s,v)&&!A&&!M&&!ae(v,i)});if(S.length>0){const{value:v,nextState:A}=wo(s),M=Math.floor(v*S.length)%S.length,p=S[M];return{entity:{...e,intent:"Bombing",intentPosition:p,actionCooldown:2},nextState:A}}}const{position:h,state:b}=Li(e,i,s,s.occupiedCurrentTurn,2.5),y=!ae(h,e.position);return{entity:{...e,position:h,intent:y?"Moving":"Waiting",intentPosition:void 0,actionCooldown:Math.max(0,l-1)},nextState:b,message:y?`${e.subtype} repositioning to (${h.q}, ${h.r})`:void 0}}default:{if(c===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:s};const{position:l,state:f}=Li(e,i,s,s.occupiedCurrentTurn),h=!ae(l,e.position),b=De(l,i);return{entity:{...e,position:l,intent:h?"Moving":b===1?"BASIC_ATTACK":"Waiting",intentPosition:h||b>1?void 0:{...i}},nextState:f,message:h?`${e.subtype} moves to (${l.q}, ${l.r})`:void 0}}}},oT=(e,i,s,o)=>{let c=e;const l=[],f=s?e.enemies.filter(b=>b.id===s):e.enemies,h=[...c.enemies];return f.forEach(b=>{const y=c.enemies.find(S=>S.id===b.id);if(y){if(is(y)){const S=h.findIndex(v=>v.id===b.id);S!==-1&&(h[S]={...h[S],intent:void 0,intentPosition:void 0});return}if(y.intent&&y.intentPosition){let S=!1;const v=Un.get(y.intent);let A=y.activeSkills?.find(M=>M.id===y.intent);if(!A&&y.intent==="ARCHER_SHOT"&&(A=y.activeSkills?.find(M=>M.id==="SPEAR_THROW")),v&&A){const p=(v.getValidTargets?v.getValidTargets(c,y.position):[]).some(N=>ae(N,c.player.position));let g=y.intentPosition;if(p)g=c.player.position;else{const N=h.findIndex(O=>O.id===b.id);N!==-1&&(h[N]={...h[N],intent:void 0,intentPosition:void 0});return}const C=v.execute(c,y,g,A.activeUpgrades);c=Bi(c,C.effects,{sourceId:y.id,targetId:c.player.id,stepId:o}),l.push(...C.messages),S=!0}else if(y.subtype!=="bomber"){if(ae(y.intentPosition,i)){c={...c,player:js(c.player,1)};const M=`${y.subtype||"enemy"}#${y.id}`;l.push(`${M} hit you! (HP: ${c.player.hp}/${c.player.maxHp})`),S=!0}}if(S){const M=h.findIndex(p=>p.id===b.id);M!==-1&&(h[M]={...h[M],intent:void 0,intentPosition:void 0})}}}}),c={...c,enemies:h},{state:c,messages:l}};class my extends Error{issues;constructor(i,s){super(`${i} validation failed:
${s.map(o=>`${o.path}: ${o.message}`).join(`
`)}`),this.name="ContractValidationError",this.issues=s}}const En=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),ts=e=>typeof e=="number"&&Number.isFinite(e),fa=e=>Number.isInteger(e),zt=e=>typeof e=="string",Ee=(e,i,s)=>e.push({path:i,message:s}),rT=e=>{if(!zt(e))return e;try{return JSON.parse(e)}catch(i){throw new Error(`Invalid JSON: ${i.message}`)}},El=(e,i,s,o={})=>{if(!Array.isArray(e))return Ee(i,s,"Expected array");const c=new Set;o.nonEmpty&&e.length===0&&Ee(i,s,"Must not be empty"),e.forEach((l,f)=>{if(!zt(l)||l.length===0)return Ee(i,`${s}[${f}]`,"Expected non-empty string");o.unique&&(c.has(l)&&Ee(i,`${s}[${f}]`,`Duplicate "${l}"`),c.add(l))})},py=(e,i,s)=>{if(!En(e))return Ee(i,s,"Expected object");ts(e.base)||Ee(i,`${s}.base`,"Expected number"),e.min!==void 0&&!ts(e.min)&&Ee(i,`${s}.min`,"Expected number"),e.max!==void 0&&!ts(e.max)&&Ee(i,`${s}.max`,"Expected number"),ts(e.min)&&ts(e.max)&&e.min>e.max&&Ee(i,s,"min must be <= max")},lT=(e,i,s)=>En(e)?((!zt(e.id)||e.id.length===0)&&Ee(i,`${s}.id`,"Expected non-empty string"),El(e.tags,i,`${s}.tags`,{nonEmpty:!0,unique:!0}),zt(e.kind)?e.kind==="DEAL_DAMAGE"?(py(e.amount,i,`${s}.amount`),(!En(e.target)||!zt(e.target.selector))&&Ee(i,`${s}.target`,"Expected selector"),!0):e.kind==="APPLY_STATUS"?((!zt(e.statusId)||e.statusId.length===0)&&Ee(i,`${s}.statusId`,"Expected statusId"),(!fa(e.duration)||e.duration<0)&&Ee(i,`${s}.duration`,"Expected integer >= 0"),(!En(e.target)||!zt(e.target.selector))&&Ee(i,`${s}.target`,"Expected selector"),!0):e.kind==="APPLY_FORCE"?En(e.force)?((!zt(e.force.mode)||!new Set(["push","pull"]).has(e.force.mode))&&Ee(i,`${s}.force.mode`,"Expected push|pull"),(!zt(e.force.direction)||!new Set(["source_to_target","target_to_source"]).has(e.force.direction))&&Ee(i,`${s}.force.direction`,"Invalid direction"),(!fa(e.force.maxDistance)||e.force.maxDistance<0)&&Ee(i,`${s}.force.maxDistance`,"Expected integer >= 0"),py(e.force.magnitude,i,`${s}.force.magnitude`),En(e.force.collision)||Ee(i,`${s}.force.collision`,"Expected object"),!0):(Ee(i,`${s}.force`,"Expected object"),!0):e.kind==="MESSAGE"?((!zt(e.text)||e.text.length===0)&&Ee(i,`${s}.text`,"Expected non-empty string"),!0):(Ee(i,`${s}.kind`,"Unknown kind"),!1):(Ee(i,`${s}.kind`,"Expected kind"),!1)):(Ee(i,s,"Expected object"),!1),cT=(e,i,s)=>{if(!En(e))return Ee(i,s,"Expected object");if(!zt(e.method))return Ee(i,`${s}.method`,"Expected method");if(e.method==="fixed"){ts(e.value)||Ee(i,`${s}.value`,"Expected number");return}if(e.method==="uniform_int"){fa(e.min)||Ee(i,`${s}.min`,"Expected integer"),fa(e.max)||Ee(i,`${s}.max`,"Expected integer"),fa(e.min)&&fa(e.max)&&e.min>e.max&&Ee(i,s,"min must be <= max");return}if(e.method==="triangular_int"){fa(e.min)||Ee(i,`${s}.min`,"Expected integer"),fa(e.mode)||Ee(i,`${s}.mode`,"Expected integer"),fa(e.max)||Ee(i,`${s}.max`,"Expected integer");return}if(e.method==="weighted_table"){if(!Array.isArray(e.table)||e.table.length===0)return Ee(i,`${s}.table`,"Expected non-empty array");e.table.forEach((o,c)=>{if(!En(o))return Ee(i,`${s}.table[${c}]`,"Expected object");ts(o.value)||Ee(i,`${s}.table[${c}].value`,"Expected number"),(!ts(o.weight)||o.weight<=0)&&Ee(i,`${s}.table[${c}].weight`,"Expected number > 0")});return}Ee(i,`${s}.method`,"Unknown propensity method")},uT=e=>{const i=[];if(!En(e))return Ee(i,"$","Expected object"),i;if((!zt(e.version)||!/^1\./.test(e.version))&&Ee(i,"$.version","Expected v1.x"),(!zt(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&Ee(i,"$.id","Expected uppercase id"),(!zt(e.name)||e.name.length===0)&&Ee(i,"$.name","Expected non-empty string"),(!zt(e.actorType)||!new Set(["player","enemy"]).has(e.actorType))&&Ee(i,"$.actorType","Expected player|enemy"),(!zt(e.factionId)||e.factionId.length===0)&&Ee(i,"$.factionId","Expected non-empty string"),(!En(e.coordSpace)||e.coordSpace.system!=="cube-axial"||e.coordSpace.pointFormat!=="qrs")&&Ee(i,"$.coordSpace","Expected {system:cube-axial,pointFormat:qrs}"),En(e.instantiate)?((!zt(e.instantiate.rngStream)||e.instantiate.rngStream.length===0)&&Ee(i,"$.instantiate.rngStream","Expected non-empty string"),(!zt(e.instantiate.counterMode)||!new Set(["consume_global","stateless"]).has(e.instantiate.counterMode))&&Ee(i,"$.instantiate.counterMode","Expected consume_global|stateless"),El(e.instantiate.drawOrder,i,"$.instantiate.drawOrder",{nonEmpty:!0,unique:!0})):Ee(i,"$.instantiate","Expected object"),!En(e.propensities))Ee(i,"$.propensities","Expected object");else{const s=e.propensities;["body","mind","instinct","speed","mass"].forEach(o=>{o in s||Ee(i,`$.propensities.${o}`,"Missing required propensity")}),Object.entries(s).forEach(([o,c])=>cT(c,i,`$.propensities.${o}`))}return En(e.skillLoadout)?(El(e.skillLoadout.baseSkillIds,i,"$.skillLoadout.baseSkillIds",{nonEmpty:!0,unique:!0}),e.skillLoadout.passiveSkillIds!==void 0&&El(e.skillLoadout.passiveSkillIds,i,"$.skillLoadout.passiveSkillIds",{unique:!0})):Ee(i,"$.skillLoadout","Expected object"),i},dT=e=>{const i=[];return En(e)?((!zt(e.version)||!/^1\./.test(e.version))&&Ee(i,"$.version","Expected v1.x"),(!zt(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&Ee(i,"$.id","Expected uppercase id"),(!zt(e.name)||e.name.length===0)&&Ee(i,"$.name","Expected non-empty string"),(!zt(e.slot)||!new Set(["offensive","defensive","utility","passive"]).has(e.slot))&&Ee(i,"$.slot","Invalid slot"),El(e.keywords,i,"$.keywords",{unique:!0}),En(e.targeting)?((!zt(e.targeting.mode)||!new Set(["self","single","line","radius","global"]).has(e.targeting.mode))&&Ee(i,"$.targeting.mode","Invalid mode"),(!fa(e.targeting.range)||e.targeting.range<0)&&Ee(i,"$.targeting.range","Expected integer >= 0"),typeof e.targeting.requiresLos!="boolean"&&Ee(i,"$.targeting.requiresLos","Expected boolean"),typeof e.targeting.allowOccupied!="boolean"&&Ee(i,"$.targeting.allowOccupied","Expected boolean")):Ee(i,"$.targeting","Expected object"),(!En(e.stackPolicy)||e.stackPolicy.resolveOrder!=="LIFO")&&Ee(i,"$.stackPolicy.resolveOrder","MVP requires LIFO"),En(e.baseAction)?(En(e.baseAction.costs)?((!ts(e.baseAction.costs.energy)||e.baseAction.costs.energy<0)&&Ee(i,"$.baseAction.costs.energy","Expected number >= 0"),(!fa(e.baseAction.costs.cooldown)||e.baseAction.costs.cooldown<0)&&Ee(i,"$.baseAction.costs.cooldown","Expected integer >= 0"),typeof e.baseAction.costs.consumesTurn!="boolean"&&Ee(i,"$.baseAction.costs.consumesTurn","Expected boolean")):Ee(i,"$.baseAction.costs","Expected object"),!Array.isArray(e.baseAction.effects)||e.baseAction.effects.length===0?Ee(i,"$.baseAction.effects","Expected non-empty array"):e.baseAction.effects.forEach((s,o)=>lT(s,i,`$.baseAction.effects[${o}]`))):Ee(i,"$.baseAction","Expected object"),Array.isArray(e.upgrades)?e.upgrades.forEach((s,o)=>{if(!En(s))return Ee(i,`$.upgrades[${o}]`,"Expected object");(!zt(s.id)||!/^[A-Z0-9_]+$/.test(s.id))&&Ee(i,`$.upgrades[${o}].id`,"Expected uppercase id"),(!zt(s.name)||s.name.length===0)&&Ee(i,`$.upgrades[${o}].name`,"Expected non-empty string"),Array.isArray(s.modifiers)||Ee(i,`$.upgrades[${o}].modifiers`,"Expected array")}):Ee(i,"$.upgrades","Expected array"),i):(Ee(i,"$","Expected object"),i)},fT=e=>{const i=rT(e),s=[];if(!En(i))throw new my("TacticalDataPack",[{path:"$",message:"Expected pack object"}]);if((!zt(i.version)||!/^1\./.test(i.version))&&s.push({path:"$.version",message:"Expected v1.x string"}),Array.isArray(i.units)?i.units.forEach((o,c)=>{uT(o).forEach(f=>s.push({path:`$.units[${c}]${f.path.slice(1)}`,message:f.message}))}):s.push({path:"$.units",message:"Expected array"}),Array.isArray(i.skills)?i.skills.forEach((o,c)=>{dT(o).forEach(f=>s.push({path:`$.skills[${c}]${f.path.slice(1)}`,message:f.message}))}):s.push({path:"$.skills",message:"Expected array"}),s.length>0)throw new my("TacticalDataPack",s);return i},mT=e=>({definition:e,drawOrder:[...e.instantiate.drawOrder],skillIds:[...e.skillLoadout.baseSkillIds],passiveSkillIds:[...e.skillLoadout.passiveSkillIds||[]]}),pT={Light:3,Standard:5,Heavy:8,Anchored:12,OuterWall:20},hT=e=>({version:"1.0.0",id:e.id,name:e.name,actorType:"enemy",subtype:e.subtype,factionId:"enemy",weightClass:e.weightClass,coordSpace:{system:"cube-axial",pointFormat:"qrs"},instantiate:{rngStream:"enemy.instantiate",seedSalt:e.subtype,counterMode:"consume_global",drawOrder:["body","mind","instinct","speed","mass"],includeRollTrace:!1},propensities:{body:{method:"fixed",value:e.trinity.body},mind:{method:"fixed",value:e.trinity.mind},instinct:{method:"fixed",value:e.trinity.instinct},speed:{method:"fixed",value:e.speed},mass:{method:"fixed",value:pT[e.weightClass]}},derivedStats:{maxHp:{formula:"trinity_hp_v1"}},physics:{collisionPolicy:"crush_damage",crushModel:{baseDamage:0,impulseMultiplier:1,massDivider:1,minDamage:1}},skillLoadout:{baseSkillIds:e.baseSkills,passiveSkillIds:e.passiveSkills||[]},runtimeDefaults:{startingHp:"maxHp",temporaryArmor:0,isVisible:!0}}),gT={footman:"ENEMY_FOOTMAN_V1",sprinter:"ENEMY_SPRINTER_V1",raider:"ENEMY_RAIDER_V1",pouncer:"ENEMY_POUNCER_V1",shieldBearer:"ENEMY_SHIELDBEARER_V1",archer:"ENEMY_ARCHER_V1",bomber:"ENEMY_BOMBER_V1",warlock:"ENEMY_WARLOCK_V1",sentinel:"ENEMY_SENTINEL_V1"},es=(e,i={})=>{const s=i0(e);if(!s)throw new Error(`Missing bestiary entry for ${e}`);return hT({id:gT[e],name:s.name,subtype:s.subtype,weightClass:s.stats.weightClass,speed:s.stats.speed,trinity:s.trinity,baseSkills:i.baseSkills??s.skills.base,passiveSkills:i.passiveSkills??s.skills.passive})},yT={version:"1.0.0",id:"SHIELD_BASH_V1",name:"Shield Bash V1",description:"Data-driven migration variant of shield bash.",slot:"offensive",keywords:["Momentum"],intentTags:["damage","control","move"],targeting:{mode:"single",range:1,requiresLos:!0,allowOccupied:!0,deterministicSort:"distance_then_q_then_r"},stackPolicy:{resolveOrder:"LIFO",reactionWindow:"automated",playerPriority:!1,emitTickEvents:!0},baseAction:{costs:{energy:0,cooldown:2,consumesTurn:!0},effects:[{id:"shield_bash_v1_force",kind:"APPLY_FORCE",tags:["movement","momentum"],target:{selector:"targetActor"},force:{mode:"push",direction:"source_to_target",magnitude:{base:2,scaling:[{stat:"body",coefficient:.2}],min:1,round:"floor"},maxDistance:3,collision:{onBlocked:"crush_damage",crushDamage:{base:1,scaling:[{stat:"momentum",coefficient:1}],min:1,round:"floor"}}}},{id:"shield_bash_v1_damage",kind:"DEAL_DAMAGE",tags:["damage","physical"],target:{selector:"targetActor"},amount:{base:2,scaling:[{stat:"body",coefficient:.4}],min:1,round:"floor"},damageClass:"physical",reason:"shield_bash_v1"}]},reactivePassives:[],upgrades:[],inhibit:{filterMode:"exclude_matching_tags",removableTags:["movement","momentum"]},preview:{dryRunEnabled:!0,eventMap:{APPLY_FORCE:"UnitMoved",DEAL_DAMAGE:"DamageTaken"}}},bT={version:"1.0.0",units:[es("footman",{passiveSkills:[]}),es("sprinter"),es("raider",{baseSkills:["DASH"],passiveSkills:[]}),es("pouncer",{baseSkills:["BASIC_MOVE","GRAPPLE_HOOK"],passiveSkills:[]}),es("shieldBearer",{baseSkills:["BASIC_MOVE","SHIELD_BASH"],passiveSkills:[]}),es("archer",{baseSkills:["BASIC_MOVE","ARCHER_SHOT"],passiveSkills:[]}),es("bomber",{baseSkills:["BASIC_MOVE","BOMB_TOSS"],passiveSkills:[]}),es("warlock",{baseSkills:["BASIC_MOVE","SENTINEL_BLAST"],passiveSkills:[]}),es("sentinel",{baseSkills:["BASIC_MOVE","SENTINEL_TELEGRAPH","SENTINEL_BLAST"],passiveSkills:[]})],skills:[yT]},xT=new Map,v0=new Map,vT=e=>(xT.set(e.id,e),e.subtype&&v0.set(e.subtype,e),e),ST=e=>e.map(vT),AT=e=>v0.get(e);let S0=!1;const TT=(e=bT)=>{const i=fT(e);return ST(i.units),YA(i.skills),S0=!0,{unitsRegistered:i.units.length,skillsRegistered:i.skills.length}},A0=()=>S0?{unitsRegistered:0,skillsRegistered:0}:TT(),T0=(e,i="none")=>i==="floor"?Math.floor(e):i==="round"?Math.round(e):i==="ceil"?Math.ceil(e):e,E0=(e,i)=>i?Math.max(i.min,Math.min(i.max,e)):e,Kc=(e,i)=>E0(T0(e,i.round),i.clamp),ET=(e,i)=>{if(e.method==="fixed")return{value:Kc(e.value,e),before:-1,after:-1,usedRng:!1};if(e.method==="uniform_int"){const f=i(),h=e.max-e.min+1,b=e.min+Math.floor(f.value*h)%Math.max(1,h);return{value:Kc(b,e),before:f.before,after:f.after,usedRng:!0}}if(e.method==="triangular_int"){const f=i(),h=e.min,b=e.mode,y=e.max,S=(b-h)/Math.max(1e-9,y-h),v=f.value<S?h+Math.sqrt(f.value*(y-h)*(b-h)):y-Math.sqrt((1-f.value)*(y-h)*(y-b));return{value:Kc(v,e),before:f.before,after:f.after,usedRng:!0}}const s=i(),o=e.table.reduce((f,h)=>f+h.weight,0);let c=s.value*Math.max(1e-9,o),l=e.table[e.table.length-1].value;for(const f of e.table)if(c-=f.weight,c<=0){l=f.value;break}return{value:Kc(l,e),before:s.before,after:s.after,usedRng:!0}},hy=(e,i,s)=>{if(e.formula==="trinity_hp_v1")return xu(s);const o=e.base??0,l=(e.terms||[]).reduce((h,b)=>h+(i[b.stat]??0)*b.coefficient,o),f=T0(l,e.round);return E0(f,e.clamp)},_T=(e,i)=>!i||Object.keys(i).length===0?e:{...e,activeSkills:(e.activeSkills||[]).map(s=>{const o=i[s.id];return o===void 0?s:{...s,currentCooldown:Math.max(0,o)}})},wT=e=>e.id.toLowerCase(),MT=(e,i,s)=>{const o=i.definition,c=[];let l={rngSeed:e.rngSeed||"default",rngCounter:Math.max(0,e.rngCounter||0)},f=0;const h=`${l.rngSeed}:${o.instantiate.rngStream}:${o.instantiate.seedSalt||o.id}`,b=()=>{if(o.instantiate.counterMode==="consume_global"){const R=l.rngCounter,Q=pu(l.rngSeed,R);return l={...l,rngCounter:R+1},{value:Q,before:R,after:l.rngCounter}}const O=f;return{value:pu(h,f++),before:O,after:f}},y={};for(const O of i.drawOrder){const w=o.propensities[O];if(!w)continue;const R=ET(w,b);y[O]=R.value,R.usedRng&&c.push({key:O,method:w.method,value:R.value,counterBefore:R.before,counterAfter:R.after})}const S={body:y.body??0,mind:y.mind??0,instinct:y.instinct??0},v=o.derivedStats||{},A=v.maxHp?hy(v.maxHp,y,S):xu(S),M=y.speed??1,p=y.mass??1,g=o.runtimeDefaults?.startingHp==="explicit"?Math.max(0,o.runtimeDefaults.explicitHp??A):A,C=Us({id:s.actorId||wT(o),type:o.actorType,subtype:s.subtype||o.subtype,position:s.position,hp:g,maxHp:A,speed:M,factionId:s.factionId||o.factionId,weightClass:o.weightClass,skills:[...i.skillIds,...i.passiveSkillIds],trinity:S});let N=_T(C,o.skillLoadout.startCooldowns);o.runtimeDefaults?.temporaryArmor!==void 0&&(N={...N,temporaryArmor:Math.max(0,o.runtimeDefaults.temporaryArmor)}),o.runtimeDefaults?.isVisible!==void 0&&(N={...N,isVisible:o.runtimeDefaults.isVisible}),y.maxHp=A,y.speed=M,y.mass=p;for(const[O,w]of Object.entries(v))O!=="maxHp"&&(y[O]=hy(w,y,S));return{actor:N,stats:y,trinity:S,speed:M,mass:p,nextCursor:l,rollTrace:c}},OT=(e,i,s)=>MT(e,mT(i),s),CT=(e,i)=>{const s=bu(i),o=Sx(lu,cu),c=[],l=o,f=Math.floor(lu/2),h=ci(f,cu-1),b=ci(f,0);let y;if(e%1===0){const w=l.filter(R=>!ae(R,h)&&!ae(R,b)&&De(R,h)>=3);w.length>0&&(y=w[Math.floor(s.next()*w.length)])}const v=Math.floor(l.length*Rx),A=[],M={playerStart:h,stairsPosition:b,shrinePosition:y},g=[...l.filter(w=>!$g(w,M))].sort(()=>s.next()-.5);for(let w=0;w<v;w++)w<g.length&&A.push(g[w]);const C=l.filter(w=>!$g(w,{playerStart:h,stairsPosition:b,shrinePosition:y})&&!c.some(R=>ae(R,w))&&!A.some(R=>ae(R,w))&&De(w,h)>=3),N={id:"arena",type:"combat",center:ci(Math.floor(lu/2),Math.floor(cu/2)),hexes:o,connections:[]},O=new Map;for(const w of o)O.set(`${w.q},${w.r}`,{baseId:"STONE",position:w,traits:new Set(mr.STONE.defaultTraits),effects:[]});for(const w of c)O.set(`${w.q},${w.r}`,{baseId:"WALL",position:w,traits:new Set(mr.WALL.defaultTraits),effects:[]});for(const w of A)O.set(`${w.q},${w.r}`,{baseId:"LAVA",position:w,traits:new Set(mr.LAVA.defaultTraits),effects:[]});return{rooms:[N],allHexes:o,stairsPosition:b,shrinePosition:y,spawnPositions:C,playerSpawn:h,tiles:O}},kT=(e,i,s)=>{A0();const o=bu(s+":enemies"),c=Yg[Math.min(e,Yg.length-1)],l=Of[e]||Of[Math.max(...Object.keys(Of).map(Number))];let f={rngSeed:`${s}:enemy-propensity`,rngCounter:0};const h=[];let b=c;const y=[];for(;b>0&&y.length<i.length;){const S=l.filter(re=>{const pe=Xf[re];return pe&&pe.cost<=b});if(S.length===0)break;const v=Math.floor(o.next()*S.length),A=S[v],M=Xf[A],p=i.filter(re=>!y.some(pe=>ae(pe,re)));if(p.length===0)break;const g=Math.floor(o.next()*p.length),C=p[g];y.push(C);const N=Math.floor(e/5),O=M.weightClass||"Standard",w=(f.rngCounter<<8)+h.length,R=`enemy_${h.length}_${pr(s,w,6,A)}`,Q=AT(A);let W;if(Q){const re=OT(f,Q,{actorId:R,position:C,subtype:A,factionId:"enemy"});f=re.nextCursor,W=re.actor}else W=uv({id:R,subtype:A,position:C,speed:M.speed||50,skills:fv(A),weightClass:O,enemyType:M.type});const j=N>0?{...W,hp:W.hp+N,maxHp:W.maxHp+N}:W;h.push({...j,subtype:A,enemyType:M.type,actionCooldown:M.actionCooldown??j.actionCooldown,isVisible:!0}),b-=M.cost}return h},RT=e=>Nx[e]||"inferno",NT=(e,i)=>{const s=i.initialSeed??i.rngSeed??"0",o=i.commandLog?.length??0;return{id:pr(s,o,9,"cmd"),timestamp:i.turnNumber,action:e}},IT=(e,i,s)=>{const o=s.initialSeed??s.rngSeed??"0",c=s.undoStack?.length??0;return{id:pr(o,c,9,"delta"),undoData:{player:{...e.player},enemies:[...e.enemies],turnNumber:e.turnNumber,gameStatus:e.gameStatus}}},hr={VANGUARD:{id:"VANGUARD",name:"Vanguard",description:"Direct damage, brawling, and area denial.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK","SPEAR_THROW","SHIELD_BASH","JUMP"]},SKIRMISHER:{id:"SKIRMISHER",name:"Skirmisher",description:"Zero direct damage. Kinetic momentum and environmental lethality.",startingUpgrades:[],startingSkills:["DASH","GRAPPLE_HOOK","SHIELD_THROW","VAULT"]},FIREMAGE:{id:"FIREMAGE",name:"Fire Mage",description:"Area control with fire and high-damage spells.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","ABSORB_FIRE","FIREBALL","FIREWALL","FIREWALK"]},NECROMANCER:{id:"NECROMANCER",name:"Necromancer",description:"Utilize death and reanimation.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","CORPSE_EXPLOSION","RAISE_DEAD","SOUL_SWAP"]},HUNTER:{id:"HUNTER",name:"Hunter",description:"Ranged precision and traps.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","FALCON_COMMAND","KINETIC_TRI_TRAP","WITHDRAWAL"]},ASSASSIN:{id:"ASSASSIN",name:"Assassin",description:"Stealth and high burst damage.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","SNEAK_ATTACK","SMOKE_SCREEN","SHADOW_STEP"]}},_0=e=>{const i=e.startingSkills.map(o=>Ps(o)).filter(Boolean),s=e.id;return{upgrades:[...e.startingUpgrades],activeSkills:i,archetype:s}},LT=e=>e.some(i=>i.id==="BASIC_MOVE"||i.id==="DASH"),w0=(e=[])=>{if(LT(e))return e;const i=Ps("BASIC_MOVE");return i?[i,...e]:e},em=e=>{const i=e.activeSkills||[],s=w0(i);return s===i?e:{...e,activeSkills:s}};function BT(e){let i=e;const s=[],o=[],c=new Map(i.tiles);for(const[l,f]of c.entries()){const h=[];let b=!1;for(const v of f.effects){if(v.duration===-1){h.push(v);continue}const A=v.duration-1;A>0?(h.push({...v,duration:A}),b=!0):(s.push(`The ${v.id.toLowerCase()} died down.`),b=!0)}b&&c.set(l,{...f,effects:h});const y=[i.player,...i.enemies],S=v=>`${v.q},${v.r}`;for(const v of y)if(S(v.position)===l){const A=Eo.processStay(v,f,i);o.push(...A.effects),s.push(...A.messages)}}return i={...i,tiles:c},o.length>0&&(i=Bi(i,o)),{state:i,messages:s}}class gy{getFalconIntent(i,s){const o=s.companionState?.mode||"roost",c=s.companionOf===i.player.id?i.player:i.enemies.find(f=>f.id===s.companionOf),l={expectedValue:0,reasoningCode:`FALCON_${o.toUpperCase()}`,isGhost:!1,rngConsumption:0};if(o==="scout")return{type:"USE_SKILL",actorId:s.id,skillId:"FALCON_SCOUT",targetHex:s.position,priority:10,metadata:l};if(o==="predator"&&typeof s.companionState?.markTarget=="string"){const f=i.enemies.find(b=>b.id===s.companionState.markTarget&&b.hp>0);if(!f)return{type:"USE_SKILL",actorId:s.id,skillId:"FALCON_AUTO_ROOST",targetHex:s.position,priority:9,metadata:{...l,reasoningCode:"FALCON_AUTO_ROOST"}};const h=De(s.position,f.position);return h<=4?{type:"USE_SKILL",actorId:s.id,skillId:"FALCON_APEX_STRIKE",targetHex:f.position,primaryTargetId:f.id,priority:10,metadata:l}:h<=1?{type:"USE_SKILL",actorId:s.id,skillId:"FALCON_PECK",targetHex:f.position,primaryTargetId:f.id,priority:9,metadata:l}:{type:"MOVE",actorId:s.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,s,f.position),primaryTargetId:f.id,priority:7,metadata:l}}return c?De(s.position,c.position)<=1?{type:"USE_SKILL",actorId:s.id,skillId:"FALCON_HEAL",targetHex:c.position,primaryTargetId:c.id,priority:10,metadata:l}:{type:"MOVE",actorId:s.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,s,c.position),primaryTargetId:c.id,priority:7,metadata:l}:{type:"WAIT",actorId:s.id,skillId:"WAIT_SKILL",priority:1,metadata:{...l,reasoningCode:"FALCON_WAIT"}}}findStepToward(i,s,o){const c=xt(s.position).filter(l=>dt.isWithinBounds(i,l)).filter(l=>Ze.isWalkable(i,l)).filter(l=>{const f=Ne(i,l);return!f||f.id===s.id});return c.length===0?s.position:c.sort((l,f)=>De(l,o)-De(f,o))[0]}getIntent(i,s){if(s.subtype==="falcon")return this.getFalconIntent(i,s);if(s.subtype==="bomb")return{type:"USE_SKILL",actorId:s.id,skillId:"TIME_BOMB",targetHex:s.position,priority:10,metadata:{expectedValue:0,reasoningCode:"BOMB_FUSE_TICK",isGhost:!1,rngConsumption:0}};const o=i.player.position,c=sT(s,o,{...i,occupiedCurrentTurn:i.occupiedCurrentTurn}),{entity:l,message:f}=c;let h="WAIT",b="WAIT_SKILL",y,S,v=10;const A=l.intent||"Waiting";if(A==="Moving"||A==="Advancing"||A==="Repositioning"||A==="Lumbering")h="MOVE",b="BASIC_MOVE",y=l.position;else if(A==="BASIC_ATTACK"){if(h="ATTACK",b="BASIC_ATTACK",y=l.intentPosition,y){const p=i.player.position.q===y.q&&i.player.position.r===y.r?i.player:i.enemies.find(g=>g.position.q===y?.q&&g.position.r===y?.r);p&&p.factionId!==s.factionId&&(S=p.id)}}else A==="SPEAR_THROW"?(h="USE_SKILL",b="SPEAR_THROW",y=l.intentPosition):A==="ARCHER_SHOT"?(h="USE_SKILL",b="ARCHER_SHOT",y=l.intentPosition):A==="DASH"?(h="USE_SKILL",b="DASH",y=l.intentPosition):A==="GRAPPLE_HOOK"?(h="USE_SKILL",b="GRAPPLE_HOOK",y=l.intentPosition):A==="Bombing"?(h="USE_SKILL",b="BOMB_TOSS",y=l.intentPosition):A==="SENTINEL_BLAST"?(h="USE_SKILL",b="SENTINEL_BLAST",y=l.intentPosition):A==="SENTINEL_TELEGRAPH"?(h="USE_SKILL",b="SENTINEL_TELEGRAPH",y=l.intentPosition):(A==="Charging Power"||A==="Preparing")&&(h="WAIT",b="WAIT_SKILL");if(b==="ARCHER_SHOT"&&!s.activeSkills?.some(p=>p.id==="ARCHER_SHOT")&&s.activeSkills?.some(p=>p.id==="SPEAR_THROW")&&(b="SPEAR_THROW"),!(b==="WAIT_SKILL"||s.activeSkills?.some(p=>p.id===b)))h="WAIT",b="WAIT_SKILL",y=void 0,S=void 0;else if(b!=="WAIT_SKILL"){const p=Un.get(b);p?.getValidTargets&&y&&(p.getValidTargets(i,s.position).some(N=>ae(N,y))||(h="WAIT",b="WAIT_SKILL",y=void 0,S=void 0))}return{type:h,actorId:s.id,skillId:b,primaryTargetId:S,targetHex:y,priority:v,metadata:{expectedValue:0,reasoningCode:A.toUpperCase().replace(" ","_"),isGhost:!1,rngConsumption:(f?.includes("teleports")||f?.includes("Bombing"),(c.nextState.rngCounter||0)-(i.rngCounter||0))}}}}class _l{inputQueue=[];resolveInput;pushIntent(i){this.inputQueue.push(i),this.resolveInput&&(this.resolveInput(i),this.resolveInput=void 0)}getIntent(i,s){return this.inputQueue.length>0?this.inputQueue.shift():new Promise(o=>{this.resolveInput=o})}}class wl{static strategies=new Map;static defaultEnemyStrategy=new gy;static defaultPlayerStrategy=new _l;static register(i,s){this.strategies.set(i,s)}static resolve(i){return this.strategies.has(i.id)?this.strategies.get(i.id):i.type==="player"?this.defaultPlayerStrategy:this.defaultEnemyStrategy}static reset(){this.strategies.clear(),this.defaultEnemyStrategy=new gy,this.defaultPlayerStrategy=new _l}}const M0=(e,i,s)=>is(s)?{...e,type:"WAIT",skillId:"WAIT_SKILL",priority:0,metadata:{...e.metadata,reasoningCode:"STATUS_STUNNED"}}:e;class O0{static execute(i,s,o){return this.resolveExecution(i,s,o)}static simulate(i,s,o){return this.resolveExecution(i,s,o)}static resolveExecution(i,s,o){const c=[],l=[],f=Un.get(i.skillId);if(!f&&i.type!=="WAIT")return{effects:[],messages:[`Failed to execute unknown skill: ${i.skillId}`],consumesTurn:!1};if(i.type==="WAIT")return{effects:[],messages:[],consumesTurn:!0};if(!(i.skillId==="WAIT_SKILL"||s.activeSkills.some(g=>g.id===i.skillId)))return{effects:[],messages:[`Actor ${s.id} does not have skill ${i.skillId} in loadout!`],consumesTurn:!1};const b=s.activeSkills.find(g=>g.id===i.skillId),y=s.factionId==="player"&&mm(o);if(!y&&b&&(b.currentCooldown||0)>0)return{effects:[],messages:[`${i.skillId} is on cooldown (${b.currentCooldown}).`],consumesTurn:s.type!=="player"};let S=i.targetHex,v=i.primaryTargetId;if(!S&&f&&(S=this.findOptimalTargetHex(i,s,o,f.baseVariables.range)),!S)return{effects:[],messages:[`No valid target found for ${i.skillId}`],consumesTurn:!1};if(S&&!v){const g=Ne(o,S);g&&(v=g.id)}const A=b?.activeUpgrades||[],M=f.execute(o,s,S,A),p=[...c,...M.effects];if(M.consumesTurn!==!1&&!y){let C=f.baseVariables.cooldown||0;for(const N of A){const O=f.upgrades?.[N];typeof O?.modifyCooldown=="number"&&(C+=O.modifyCooldown)}C=Math.max(0,C),C>0&&p.push({type:"ModifyCooldown",skillId:i.skillId,amount:C+1,setExact:!0})}return{effects:p,messages:[...l,...M.messages],consumesTurn:M.consumesTurn??!0,targetId:v,kills:M.kills||0}}static findOptimalTargetHex(i,s,o,c){if(i.primaryTargetId){const l=o.enemies.find(f=>f.id===i.primaryTargetId)||(o.player.id===i.primaryTargetId?o.player:void 0);if(l&&(i.type==="ATTACK"||i.type==="USE_SKILL"))return l.position}}}const tm=(e,i)=>e.q!==i.q?e.q-i.q:e.r!==i.r?e.r-i.r:e.s-i.s,du=(e,i)=>e.player.id===i?e.player:e.enemies.find(s=>s.id===i)||e.companions?.find(s=>s.id===i),HT=(e,i)=>{if(i.primaryTargetId)return du(e,i.primaryTargetId);if(i.targetHex)return Ne(e,i.targetHex)},jT=(e,i,s)=>{const o=new Map,c=HT(e,i),l=f=>{f&&o.set(Te(f),f)};return s.forEach(f=>{f.type==="Damage"?typeof f.target=="string"&&f.target!=="targetActor"&&f.target!=="area"?l(du(e,f.target)?.position):f.target==="targetActor"?l(c?.position):f.target==="area"?l(f.source):typeof f.target=="object"&&"q"in f.target&&l(f.target):f.type==="Impact"||f.type==="LavaSink"?l(du(e,f.target)?.position):f.type==="Displacement"&&l(f.destination)}),[...o.values()].sort(tm)},yy=e=>{const i=[];e.enemies.filter(c=>c.hp>0&&c.factionId!==e.player.factionId).forEach(c=>{const f=wl.resolve(c).getIntent(e,c);if(f instanceof Promise)return;const h=M0(f,e,c);let b=h;h.skillId==="SENTINEL_TELEGRAPH"&&(b={...h,skillId:"SENTINEL_BLAST"});const y=O0.simulate(b,c,e),S=jT(e,b,y.effects);S.length!==0&&i.push({actorId:c.id,skillId:h.skillId,targetHex:h.targetHex,dangerTiles:S})}),i.sort((c,l)=>c.actorId!==l.actorId?c.actorId.localeCompare(l.actorId):c.skillId!==l.skillId?c.skillId.localeCompare(l.skillId):!c.targetHex&&!l.targetHex?0:c.targetHex?l.targetHex?tm(c.targetHex,l.targetHex):1:-1);const o=new Map;return i.forEach(c=>c.dangerTiles.forEach(l=>o.set(Te(l),l))),{sourceTurn:e.turnNumber,dangerTiles:[...o.values()].sort(tm),projections:i}};var C0={};const nm=typeof process<"u"&&C0?.HOP_ENGINE_DEBUG==="1",k0=typeof process<"u"&&C0?.HOP_ENGINE_WARN==="1",DT=nm||k0,R0=(e,i)=>{if(DT){if(i){console.warn(`[TURN_STACK] ${e}`,i);return}console.warn(`[TURN_STACK] ${e}`)}},PT=(e,i,s,o)=>{const c=(e.pendingFrames?.length??0)+1;return{id:`${e.turnNumber}:${s}:${i}:${c}`,type:i,status:s,createdTurn:e.turnNumber,blocking:!0,payload:o}},pl=(e,i,s,o)=>{const c=PT(e,s,i.status,o);return{...e,pendingStatus:i,pendingFrames:[...e.pendingFrames||[],c]}},im=()=>{const e=ns();return{...e,gameStatus:"hub",message:[Gt([],"Welcome to the Strategic Hub. Select your loadout.","INFO","SYSTEM")[0]],player:{...e.player,activeSkills:[]},hasSpear:!1,hasShield:!1}},ns=(e=1,i,s,o,c)=>{A0();const l=i||String(Date.now()),f=RT(e),h=CT(e,l),b=kT(e,h.spawnPositions||[],l),y=o?{hp:o.hp,maxHp:o.maxHp,speed:o.speed||Vg.speed}:{speed:Vg.speed},S=o?.upgrades||(c?c.startingUpgrades:[]),v=c?_0(c):{activeSkills:FA(),archetype:"VANGUARD"},A=w0(o?.activeSkills||v.activeSkills),M=o?.archetype||v.archetype,p=h.tiles||new Map,C={turnNumber:1,player:{...Us({id:"player",type:"player",position:h.playerSpawn,hp:y.hp,maxHp:y.maxHp,speed:y.speed,factionId:"player",activeSkills:A,archetype:M,weightClass:"Standard",components:new Map}),previousPosition:h.playerSpawn},enemies:b.map(N=>({...N,previousPosition:N.position,statusEffects:N.statusEffects||[],temporaryArmor:N.temporaryArmor||0})),gridWidth:lu,gridHeight:cu,gameStatus:"playing",message:e===1?[Gt([],"Welcome to the arena. Survive.","INFO","SYSTEM")[0]]:Gt(o?.message||[],`Floor ${e} - ${f.charAt(0).toUpperCase()+f.slice(1)}. Be careful.`,"INFO","OBJECTIVE"),hasSpear:!0,stairsPosition:h.stairsPosition,occupancyMask:[0n],shrinePosition:h.shrinePosition,shrineOptions:void 0,hasShield:!0,floor:e,upgrades:S,rooms:h.rooms,theme:f,commandLog:[],undoStack:[],rngSeed:l,initialSeed:s??(e===1?l:void 0),rngCounter:0,actionLog:[],kills:o&&o.kills||0,environmentalKills:o&&o.environmentalKills||0,turnsSpent:o&&o.turnsSpent||0,dailyRunDate:o?.dailyRunDate,runObjectives:o?.runObjectives||[],hazardBreaches:o?.hazardBreaches||0,completedRun:void 0,combatScoreEvents:o?.combatScoreEvents||[],dyingEntities:[],visualEvents:[],timelineEvents:[],intentPreview:void 0,initiativeQueue:void 0,tiles:p};return C.initiativeQueue=Co(C),C.occupancyMask=dt.refreshOccupancyMask(C),C},by=(e,i,s,o)=>{const c=i==="player"?e.player:e.enemies.find(b=>b.id===i);if(!c)return{state:e,messages:[]};const l=[],f=[];return c.statusEffects.forEach(b=>{if(b.tickWindow===s&&b.onTick){const y=b.onTick(c,e);y&&l.push(...y)}}),{state:Bi(e,l,{sourceId:i,stepId:o}),messages:f}},Fc=(e,i=!1)=>{if(e.pendingStatus||(e.pendingFrames?.length??0)>0)return R0("Blocked processNextTurn while pendingStatus is active.",{status:e.pendingStatus?.status,pendingFrames:e.pendingFrames?.length??0,turnNumber:e.turnNumber}),e;let s=e;const o=[],c=[];let l=0;const f=100;let h=!1;for(;l<f;){if(l++,s.player.hp<=0&&s.pendingStatus?.status!=="lost"){const q=Tl(s);return pl({...s,message:Gt(s.message,"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:q},"RUN_LOST",{reason:"GLOBAL_DEATH_CHECK"})}s.occupancyMask=dt.refreshOccupancyMask(s);let y;if((i&&l===1||h)&&s.initiativeQueue){h=!1;const q=s.initiativeQueue;q.entries.length>0&&q.currentIndex>=0&&q.currentIndex<q.entries.length&&(y=q.entries[q.currentIndex].actorId)}else{const q=Fx(s);s={...s,initiativeQueue:q.queue},y=q.actorId??void 0}if(!y)break;const S=y==="player"?s.player:s.enemies.find(q=>q.id===y),v=`${s.turnNumber}:${s.initiativeQueue?.round??0}:${y}:${l}`;if(!S||S.hp<=0){s={...s,initiativeQueue:kf(s.initiativeQueue,y)};continue}if(Kx(s.initiativeQueue)?.turnStartPosition||(s={...s,initiativeQueue:Wx(s,S)}),!i||l>1){const q=by(s,y,"START_OF_TURN",v);if(s=q.state,o.push(...q.messages),y==="player"&&s.upgrades?.includes("RELIC_STEADY_PLATES")){const Z=Math.min(2,(s.player.temporaryArmor||0)+1);Z!==(s.player.temporaryArmor||0)&&(s={...s,player:{...s.player,temporaryArmor:Z}},o.push(Gt([],"Steady Plates harden your stance.","INFO","COMBAT")[0]))}if(y==="player"){const Z=s.player.activeSkills?.find(ee=>ee.id==="SHIELD_BASH");if(!!Z?.activeUpgrades?.includes("PASSIVE_PROTECTION")&&(Z?.currentCooldown||0)===0){const ee=Math.max(s.player.temporaryArmor||0,1);ee!==(s.player.temporaryArmor||0)&&(s={...s,player:{...s.player,temporaryArmor:ee}},o.push(Gt([],"Passive Protection braces your guard.","INFO","COMBAT")[0]))}}const le=oT(s,s.player.position,y,v);s=le.state,o.push(...le.messages)}const M=y==="player"?s.player:s.enemies.find(q=>q.id===y);if(!M||M.hp<=0){s={...s,initiativeQueue:kf(s.initiativeQueue,y),message:Ca(s.message,o,"INFO","SYSTEM")};continue}const p=y==="player"?s.player:s.enemies.find(q=>q.id===y);if(!p||p.hp<=0)continue;let g,C=!1;if(is(p))C=!0,g={type:"WAIT",actorId:p.id,skillId:"WAIT_SKILL",priority:0,metadata:{expectedValue:0,reasoningCode:"STATUS_STUNNED_AUTOSKIP",isGhost:!1}},y==="player"?o.push("You are stunned and skip your turn."):o.push(`${p.subtype||"Enemy"} is stunned and skips its turn.`);else{const le=wl.resolve(p).getIntent(s,p);if(le instanceof Promise){const Z=yy(s);return{...s,intentPreview:Z,message:Ca(s.message,o,"INFO","SYSTEM"),dyingEntities:[...s.dyingEntities||[],...c]}}g=le}const N=M.activeSkills.map(q=>q.id).join(", ");nm&&(console.log(`[ENGINE] Actor: ${y} | Loadout: [${N}] | Pos: ${JSON.stringify(M.position)}`),console.log(`[ENGINE] Intent: ${g.type} | Skill: ${g.skillId} | TargetHex: ${g.targetHex?JSON.stringify(g.targetHex):"none"} | TargetId: ${g.primaryTargetId||"none"}`)),g.metadata.rngConsumption&&(s={...s,rngCounter:(s.rngCounter||0)+g.metadata.rngConsumption}),g=M0(g,s,p);const{effects:O,messages:w,consumesTurn:R,targetId:Q,kills:W}=O0.execute(g,p,s);if(nm&&console.log(`[ENGINE] ${y} intends ${g.type} (${g.skillId}) onto ${Q||(g.targetHex?JSON.stringify(g.targetHex):"self")}`),k0&&O.length===0&&g.type!=="WAIT"){const q=`[ENGINE] WARNING: Intent ${g.type} (${g.skillId}) for actor ${y} produced ZERO effects!`;console.warn(q)}const j=s,re=Bi(s,O,{sourceId:y,targetId:Q,stepId:v});if(y==="player"&&(re.kills=(re.kills||0)+(W||0)),R===!1){s={...j,message:Ca(s.message,w,"INFO","COMBAT")},h=!0;continue}if(s=re,o.push(...w),y!=="player"){const q=s.enemies.find(le=>le.id===y);if(q?.subtype==="bomber"){const le=g.skillId==="BOMB_TOSS"?2:Math.max(0,(q.actionCooldown??0)-1);q.actionCooldown!==le&&(s={...s,enemies:s.enemies.map(Z=>Z.id===y?{...Z,actionCooldown:le}:Z)})}}const pe=y==="player"?s.player:s.enemies.find(q=>q.id===y);if(!pe||pe.hp<=0){if(y==="player"){const q=Tl(s);return pl({...s,message:Gt(Ca(s.message,o,"INFO","SYSTEM"),"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:q},"RUN_LOST",{reason:"SELF_ACTION_DEATH"})}s={...s,enemies:s.enemies.filter(q=>q.id!==y),initiativeQueue:kf(s.initiativeQueue,y),message:Ca(s.message,o,"INFO","SYSTEM")};continue}const z=by(s,y,"END_OF_TURN",v);s=z.state,o.push(...z.messages),s={...s,enemies:s.enemies.map(q=>q.id===y?Kg(zg(q)):q),player:y==="player"?Kg(zg(s.player)):s.player,initiativeQueue:Xx(s,y)};const ue=y==="player"?s.player:s.enemies.find(q=>q.id===y);if(!(C||g.metadata?.reasoningCode==="STATUS_STUNNED"||g.metadata?.reasoningCode==="STATUS_STUNNED_AUTOSKIP")&&ue&&ue.hp>0){const q=Gx(s,y)||ue.previousPosition||ue.position,le=Qx(s,y)??void 0,Z=kS(s,ue,xt(q),q,le,v);s=Z.state,o.push(...Z.messages),y==="player"&&(s.kills=(s.kills||0)+Z.kills)}if(y==="player"){const q=s.player.position;if(s.spearPosition&&ae(q,s.spearPosition)){if(!!s.player.activeSkills?.find(ee=>ee.id==="SPEAR_THROW")?.activeUpgrades?.some(ee=>ee==="SPEAR_CLEAVE"||ee==="CLEAVE")){const ee=xt(q).map(Y=>s.enemies.find(he=>he.hp>0&&ae(he.position,Y))).filter(Y=>!!Y&&Y.factionId!==s.player.factionId);if(ee.length>0){const Y=ee.map(he=>({type:"Damage",target:he.id,amount:1,reason:"spear_cleave_pickup"}));s=Bi(s,Y,{sourceId:s.player.id,stepId:v}),o.push(`Spear cleave hit ${ee.length} target(s).`)}}s={...s,hasSpear:!0,spearPosition:void 0,message:Gt(s.message,"Picked up your spear.","INFO","OBJECTIVE")}}const le=BT(s);if(s=le.state,o.push(...le.messages),s={...s,turnNumber:s.turnNumber+1,turnsSpent:(s.turnsSpent||0)+1},s.traps&&s.traps.length>0&&(s={...s,traps:s.traps.map(Z=>({...Z,cooldown:Math.max(0,Z.cooldown-1)}))}),s=jS(s),wx(s,s.player.position)){const Z=s.player.activeSkills||[],P=new Set(Z.map(U=>U.id)),ee=new Map;for(const U of Z)ee.set(U.id,new Set(U.activeUpgrades||[]));const Y=Un.getAllUpgrades().filter(U=>P.has(U.skillId)).filter(U=>{if(s.upgrades.includes(U.id))return!1;const K=ee.get(U.skillId);return!K||!K.has(U.id)}).map(U=>U.id).filter((U,K,ne)=>ne.indexOf(U)===K),he=[];let ge={...s};for(let U=0;U<3&&Y.length>0;U++){const K=wo(ge);ge=K.nextState;const ne=Math.floor(K.value*Y.length);he.push(Y[ne]),Y.splice(ne,1)}const k=he.length>0?he:["EXTRA_HP"];return pl({...s,rngCounter:ge.rngCounter,message:Gt(s.message,"A holy shrine! Choose an upgrade.","INFO","OBJECTIVE")},{status:"choosing_upgrade",shrineOptions:k},"SHRINE_CHOICE",{shrineOptions:k})}if(Mx(s,s.player.position)){if(s.floor>=10){const P=Tl(s);return pl({...s,message:Gt(s.message,`Arcade Cleared! Final Score: ${P.score}`,"INFO","OBJECTIVE")},{status:"won",completedRun:P},"RUN_WON",{score:P.score??0})}return pl({...s,message:Gt(s.message,"Descending to the next level...","INFO","OBJECTIVE")},{status:"playing"},"STAIRS_TRANSITION",{nextFloor:s.floor+1})}}}const b=yy(s);return{...s,intentPreview:b,message:Ca(s.message,o,"INFO","SYSTEM"),dyingEntities:[...s.dyingEntities||[],...c]}},UT=(e,i)=>{const s=em(e.player),o=s===e.player?e:{...e,player:s};if(o.gameStatus!=="playing"&&i.type!=="RESET"&&i.type!=="SELECT_UPGRADE"&&i.type!=="LOAD_STATE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN"&&i.type!=="EXIT_TO_HUB")return o;const c={...o,isShaking:!1,lastSpearPath:void 0,dyingEntities:[],occupiedCurrentTurn:void 0,visualEvents:[],timelineEvents:[]};switch(i.type){case"LOAD_STATE":{const v=i.payload;return Array.isArray(v.tiles)&&(v.tiles=new Map(v.tiles.map(([A,M])=>[A,{...M,traits:new Set(M.traits)}]))),v.player=em(Al(v.player)),v.enemies=(v.enemies||[]).map(Al),v.companions&&(v.companions=v.companions.map(Al)),v}case"RESET":{const A=e.player.archetype==="SKIRMISHER"?"SKIRMISHER":"VANGUARD",M=hr[A];return ns(1,i.payload?.seed||String(Date.now()),void 0,void 0,M)}case"EXIT_TO_HUB":return im()}if(o.gameStatus!=="playing"&&i.type!=="SELECT_UPGRADE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN")return o;const l=NT(i,o),f=o;let h={...c,initiativeQueue:c.initiativeQueue};const y=((v,A)=>{if(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP"].includes(A.type)&&!xl(v))return v;switch(A.type){case"SELECT_UPGRADE":{if(!("payload"in A))return v;const p=A.payload;if(!(v.pendingStatus?.shrineOptions||v.shrineOptions||[]).includes(p))return{...v,message:Gt(v.message,`Upgrade ${p} was not offered.`,"CRITICAL","SYSTEM")};let C=v.player,N=!1;const O=Un.getUpgrade(p);if(O){const w=Un.getSkillForUpgrade(p),R=!!w&&C.activeSkills.some(Q=>Q.id===w);if(w&&R){const Q=JSON.stringify(C.activeSkills);C=Hx(C,w,p),N=JSON.stringify(C.activeSkills)!==Q}}else p==="EXTRA_HP"&&(C=Lx(C,1,!0),N=!0);return!N&&p!=="EXTRA_HP"?{...v,message:Gt(v.message,`Upgrade ${p} could not be applied.`,"CRITICAL","SYSTEM")}:{...v,player:C,upgrades:v.upgrades.includes(p)?v.upgrades:[...v.upgrades,p],gameStatus:"playing",shrinePosition:void 0,shrineOptions:void 0,pendingStatus:void 0,pendingFrames:void 0,message:Gt(v.message,`Gained ${O?.name||p}!`,"INFO","OBJECTIVE")}}case"USE_SKILL":{const{skillId:p,target:g}=A.payload,C=wl.resolve(v.player);return C instanceof _l&&C.pushIntent({type:"USE_SKILL",actorId:v.player.id,skillId:p,targetHex:g,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),Fc(v,!0)}case"MOVE":{if(!("payload"in A))return v;const p=A.payload,g=v.player.activeSkills||[],C=ga(v.enemies,p),N=["BASIC_ATTACK","BASIC_MOVE","DASH"],O=g.filter(re=>re.slot==="passive"),w=[...O.filter(re=>N.includes(re.id)),...O.filter(re=>!N.includes(re.id))];let R;for(const re of w){const pe=Un.get(re.id);if(!pe?.getValidTargets)continue;if(pe.getValidTargets(v,v.player.position).some(ue=>ae(ue,p))){R=re.id;break}}if(!R){const re=g.some(z=>z.id==="BASIC_ATTACK"),pe=g.some(z=>z.id==="BASIC_MOVE");if(C&&re)R="BASIC_ATTACK";else if(!C&&pe)R="BASIC_MOVE";else return{...v,message:Gt(v.message,C?"No valid passive attack for target.":"No valid passive movement for target.","CRITICAL","SYSTEM")}}const Q=C?"ATTACK":"MOVE",W=R,j=wl.resolve(v.player);return j instanceof _l&&j.pushIntent({type:Q,actorId:v.player.id,skillId:W,targetHex:p,primaryTargetId:C?.id,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),Fc(v,!0)}case"WAIT":{const p=wl.resolve(v.player);return p instanceof _l&&p.pushIntent({type:"WAIT",actorId:v.player.id,skillId:"WAIT",priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),Fc(v,!0)}case"APPLY_LOADOUT":{if(!("payload"in A))return v;const p=A.payload,g=_0(p);return{...v,player:{...v.player,activeSkills:g.activeSkills,archetype:g.archetype},upgrades:g.upgrades,hasSpear:p.startingSkills.includes("SPEAR_THROW"),hasShield:p.startingSkills.includes("SHIELD_THROW")||v.hasShield,selectedLoadoutId:p.id,message:Gt(v.message,`${p.name} selected.`,"INFO","SYSTEM")}}case"START_RUN":{const{loadoutId:p,seed:g,mode:C,date:N}=A.payload,O=hr[p];if(!O)return v;if(C==="daily"){const w=fS(N),R=mS(w);return{...ns(1,g||R,void 0,void 0,O),dailyRunDate:w,runObjectives:pS(R),hazardBreaches:0}}return ns(1,g,void 0,void 0,O)}case"ADVANCE_TURN":return v.pendingStatus||(v.pendingFrames?.length??0)>0?(R0("Ignored ADVANCE_TURN while pendingStatus is active.",{status:v.pendingStatus?.status,pendingFrames:v.pendingFrames?.length??0,turnNumber:v.turnNumber}),v):Fc(v,!1);case"RESOLVE_PENDING":{const p=v.pendingFrames||[];if(p.length>1)return{...v,pendingFrames:p.slice(1)};if(!v.pendingStatus)return p.length===1?{...v,pendingFrames:[]}:v;const{status:g,shrineOptions:C,completedRun:N}=v.pendingStatus;if(g==="playing"&&v.gameStatus==="playing"){const O=v.initialSeed??v.rngSeed??"0",w=`${O}:${v.floor+1}`,R=v.enemies.filter(W=>W.hp>0&&W.factionId==="player"&&W.companionOf===v.player.id).sort((W,j)=>W.id.localeCompare(j.id)),Q=ns(v.floor+1,w,O,{...v.player,hp:Math.min(v.player.maxHp,v.player.hp+1),upgrades:v.upgrades});if(R.length>0){const W=[Q.player.position,...xt(Q.player.position)],j=[Q.player,...Q.enemies],re=[];for(let pe=0;pe<R.length;pe++){const z=R[pe],ue=W[W.length-1]||Q.player.position,ye=W.find(le=>!j.some(P=>ae(P.position,le))&&Ze.isWalkable(Q,le))||ue,q={...z,position:ye,previousPosition:ye};j.push(q),re.push(q)}Q.enemies=[...Q.enemies,...re],Q.companions=[...Q.companions||[],...re.filter(pe=>pe.companionOf===v.player.id)],Q.initiativeQueue=Co(Q),Q.occupancyMask=dt.refreshOccupancyMask(Q)}return{...Q,actionLog:[...v.actionLog||[]],dailyRunDate:v.dailyRunDate,runObjectives:v.runObjectives,hazardBreaches:v.hazardBreaches||0,pendingFrames:void 0}}return{...v,gameStatus:g,shrineOptions:C||v.shrineOptions,completedRun:N||v.completedRun,pendingStatus:void 0,pendingFrames:void 0}}case"EXIT_TO_HUB":return im();default:return v}})(h,i),S=IT(f,y,e);return l.delta=S,{...y,commandLog:[...y.commandLog||[],l],undoStack:[...y.undoStack||[],S],actionLog:[...y.actionLog||[],i]}},Wc={weightsByIntent:{offense:{survival:2.1,lethality:6.5,position:2.4,objective:.5,status:2.5,tempo:1.6,resource:1},defense:{survival:4.8,lethality:3.6,position:3,objective:.8,status:2.2,tempo:1.6,resource:1},positioning:{survival:2.3,lethality:3.8,position:3.1,objective:6,status:1.4,tempo:1.6,resource:1},control:{survival:2.3,lethality:4.2,position:2.8,objective:.6,status:3.4,tempo:1.6,resource:1}},thresholds:{defenseHpRatio:.45,defensePressureHpRatio:.65,defensePressureAdjacentHostiles:2,controlMinHostiles:3}};({...Wc.weightsByIntent,offense:{...Wc.weightsByIntent.offense},control:{...Wc.weightsByIntent.control}},{...Wc.thresholds});const xy={skill:{staticWeight:.5,powerCoeff:1,reachCoeff:1,safetyCoeff:1,tempoCoeff:1,complexityCoeff:1,perSkillScalar:{}},policy:{offenseWeight:1,defenseWeight:1,positioningWeight:1,statusWeight:1,riskPenaltyWeight:1}};({...xy.policy},{...xy.skill});const qT=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP","ADVANCE_TURN","SELECT_UPGRADE","RESOLVE_PENDING"]),zT=e=>typeof e=="object"&&e!==null,vy=e=>{if(!Array.isArray(e))return{valid:!1,actions:[],errors:["Replay actions must be an array."]};const i=[],s=[];return e.forEach((o,c)=>{if(!zT(o)||typeof o.type!="string"){s.push(`Action[${c}] is not a valid action object with a "type" field.`);return}if(!qT.has(o.type)){s.push(`Action[${c}] type "${o.type}" is not replayable.`);return}i.push(o)}),{valid:s.length===0,actions:i,errors:s}},_o=e=>({q:e.q,r:e.r,s:e.s}),$T=e=>{if(e){if(e instanceof Map)return new Map(Array.from(e.entries()).map(([i,s])=>[i,typeof s=="object"&&s!==null?{...s}:s]));if(Array.isArray(e))return new Map(e);if(typeof e=="object")return new Map(Object.entries(e).map(([i,s])=>[i,typeof s=="object"&&s!==null?{...s}:s]))}},Xc=e=>({...e,position:_o(e.position),previousPosition:e.previousPosition?_o(e.previousPosition):void 0,intentPosition:e.intentPosition?_o(e.intentPosition):void 0,statusEffects:e.statusEffects.map(i=>({...i})),activeSkills:e.activeSkills.map(i=>({...i,upgrades:[...i.upgrades||[]],activeUpgrades:[...i.activeUpgrades||[]]})),components:$T(e.components),companionState:e.companionState?{...e.companionState,markTarget:typeof e.companionState.markTarget=="object"&&e.companionState.markTarget?_o(e.companionState.markTarget):e.companionState.markTarget}:void 0}),VT=e=>({...e,player:Xc(e.player),enemies:e.enemies.map(Xc),companions:e.companions?.map(Xc),dyingEntities:e.dyingEntities?.map(Xc),message:[...e.message],visualEvents:[...e.visualEvents||[]],simulationEvents:[...e.simulationEvents||[]],stackTrace:e.stackTrace?e.stackTrace.map(i=>({...i})):void 0,timelineEvents:e.timelineEvents?e.timelineEvents.map(i=>({...i})):void 0,occupancyMask:[...e.occupancyMask],tiles:new Map(Array.from(e.tiles.entries()).map(([i,s])=>[i,{...s,position:_o(s.position),traits:new Set(s.traits),effects:s.effects.map(o=>({...o}))}])),traps:e.traps?.map(i=>({...i,position:_o(i.position)})),lastSpearPath:e.lastSpearPath?.map(_o),actionLog:e.actionLog?[...e.actionLog]:void 0}),Sy=(e,i)=>e.player.id===i?e.player:e.enemies.find(s=>s.id===i)||e.companions?.find(s=>s.id===i),YT=(e,i)=>{if(i)return Ne(e,i)?.id},KT=(e,i)=>{const s=Sy(e,i.actorId);if(!s)return{ok:!1,reason:`Actor ${i.actorId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const o=Un.get(i.skillId);if(!o)return{ok:!1,reason:`Skill ${i.skillId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};if(i.target&&o.getValidTargets&&!o.getValidTargets(e,s.position).some(A=>Te(A)===Te(i.target)))return{ok:!1,reason:`Target ${Te(i.target)} is invalid`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const c=VT(e),l=Sy(c,i.actorId),f=o.execute(c,l,i.target,i.activeUpgrades||[],i.context||{}),h=c.simulationEvents?.length||0,b=c.stackTrace?.length||0,y=YT(c,i.target),S=Bi(c,f.effects,{sourceId:l.id,targetId:y});return{ok:!0,effects:f.effects,messages:f.messages,consumesTurn:f.consumesTurn,predictedState:S,simulationEvents:(S.simulationEvents||[]).slice(h),stackTrace:(S.stackTrace||[]).slice(b)}},FT=e=>({q:e.q,r:e.r,s:e.s}),WT=e=>{const i=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]];return{turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:i.map(s=>({id:s.id,position:FT(s.position)}))}},XT=(e,i)=>{const s=[],o=new Map(e.actors.map(l=>[l.id,l.position])),c=new Map(i.actors.map(l=>[l.id,l.position]));for(const[l,f]of o.entries()){const h=c.get(l);if(!h){s.push({actorId:l,expected:f,reason:"missing_in_ui"});continue}Te(f)!==Te(h)&&s.push({actorId:l,expected:f,actual:h,reason:"position_mismatch"})}for(const[l,f]of c.entries())o.has(l)||s.push({actorId:l,actual:f,reason:"missing_in_engine"});return{ok:s.length===0,mismatches:s}},hl={player:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},vanguard:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},skirmisher:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#fbbf24",isRanged:!1},firemage:{icon:"",shape:"square",color:"#ef4444",borderColor:"#fbbf24",isRanged:!0},necromancer:{icon:"",shape:"square",color:"#6b21a8",borderColor:"#9333ea",isRanged:!0},hunter:{icon:"",shape:"square",color:"#10b981",borderColor:"#ffffff",isRanged:!0},assassin_player:{icon:"",shape:"square",color:"#1f2937",borderColor:"#ffffff",isRanged:!1},footman:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1},sprinter:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1,size:.9},spear:{icon:"",shape:"circle",color:"#ffffff",borderColor:"#3b82f6",isRanged:!1,size:.8,opacity:.9},shieldBearer:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#fbbf24",isRanged:!1,showFacing:!0},golem:{icon:"",shape:"diamond",color:"#78716c",borderColor:"#ffffff",isRanged:!1,size:1.2},assassin:{icon:"",shape:"diamond",color:"#6b21a8",borderColor:"#ffffff",isRanged:!1},archer:{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},bomber:{icon:"",shape:"circle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},warlock:{icon:"",shape:"triangle",color:"#9333ea",borderColor:"#ffffff",isRanged:!0},bomb:{icon:"",shape:"circle",color:"#1f2937",borderColor:"#000000",isRanged:!1,showTimer:!0},falcon:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},skeleton:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},sentinel:{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!0,size:1.5}};function Cl(e,i,s,o){if(e&&hl[e])return hl[e];if(i==="player"&&o){const c=o==="ASSASSIN"?"assassin_player":o.toLowerCase();if(hl[c])return hl[c]}return i==="player"?hl.player:s==="ranged"?{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0}:s==="boss"?{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!1,size:1.5}:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1}}function GT(e){return e.isFlying===!0}const Uf=e=>{const i=[];for(let s=0;s<6;s++){const o=60*s,c=Math.PI/180*o,l=e*Math.cos(c),f=e*Math.sin(c);i.push(`${l},${f}`)}return i.join(" ")},QT=()=>typeof window>"u"?!1:!!window.__HOP_DEBUG_HEX_COORDS,JT=[{cx:-8,cy:-6,r:3,delay:0},{cx:6,cy:2,r:2.5,delay:.3},{cx:-3,cy:8,r:2,delay:.6}],ZT=e=>{const i=[[-.6,.42],[-.5,.15],[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2],[.48,.1],[.6,.4],[.4,.48],[-.48,.48]],s=[[-.48,.48],[-.6,.42],[-.34,-.18],[-.18,-.24],[-.28,.28]],o=[[.6,.4],[.4,.48],[.2,.28],[.3,-.2],[.48,.1]],c=[[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2]],l=[[-.46,.1],[-.3,-.12],[-.1,-.24],[0,-.4]],f=h=>h.map(([b,y])=>`${(b*e).toFixed(2)},${(y*e).toFixed(2)}`).join(" ");return{body:f(i),leftFace:f(s),rightFace:f(o),ridgeA:f(c),ridgeB:f(l)}},e1=({hex:e,onClick:i,isValidMove:s,isTargeted:o,isStairs:c,isLava:l,isShrine:f,isWall:h,isFire:b,onMouseEnter:y,assetHref:S,interactionOnly:v})=>{const[A,M]=_.useState(!1);_.useEffect(()=>{M(!1)},[S]);const{x:p,y:g}=Ve(e,G),C=QT(),N=Uf(G-2),O=ZT(G-2),w=`hex-clip-${e.q}-${e.r}-${e.s}`;let R=zc.floor,Q="rgba(0,0,0,0.2)",W="default";h?(R=zc.wall,Q="#1f2937"):l?(R="#7f1d1d",Q="#7f1d1d"):b?(R="#7c2d12",Q="#ea580c"):c?(R=zc.portal,Q="#000000"):f&&(R=zc.shrine,Q="#c2410c"),v&&(R="transparent",Q="rgba(255,255,255,0.10)"),s&&(Q="rgba(255,255,255,0.78)",W="pointer"),o&&(Q="#f97316");const j=!!S&&!v&&!A;return m.jsxs("g",{transform:`translate(${p},${g})`,onClick:()=>i(e),onMouseEnter:()=>y?.(e),style:{cursor:W},className:"hex-tile transition-colors duration-200",children:[h&&j&&m.jsx("polygon",{points:Uf(G-2),fill:"#111827",transform:"translate(0, 4)"}),!j&&(h?m.jsxs("g",{"data-wall-fallback":"relief",children:[m.jsx("ellipse",{cx:"0",cy:G*.56,rx:G*.56,ry:G*.18,fill:"rgba(3,7,18,0.55)"}),m.jsx("polygon",{points:N,fill:"#0f172a",transform:"translate(0, 5)",opacity:"0.92"}),m.jsx("polygon",{points:N,fill:"#1f2937",transform:"translate(0, 2)",opacity:"0.98"}),m.jsx("polygon",{points:N,fill:"#273447"}),m.jsx("polygon",{points:O.body,fill:"#4b5563",opacity:"0.96"}),m.jsx("polygon",{points:O.leftFace,fill:"#6b7280",opacity:"0.9"}),m.jsx("polygon",{points:O.rightFace,fill:"#374151",opacity:"0.95"}),m.jsx("polyline",{points:O.ridgeA,fill:"none",stroke:"rgba(229,231,235,0.55)",strokeWidth:"1.1",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("polyline",{points:O.ridgeB,fill:"none",stroke:"rgba(17,24,39,0.58)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("polygon",{points:N,fill:"none",stroke:Q,strokeWidth:o||s?"2":"1"})]}):m.jsx("polygon",{points:N,fill:R,stroke:Q,strokeWidth:o||s?"2":"1"})),j&&m.jsxs(m.Fragment,{children:[m.jsx("defs",{children:m.jsx("clipPath",{id:w,children:m.jsx("polygon",{points:N})})}),m.jsx("image",{href:S,x:-G,y:-31.176,width:G*2,height:G*1.732,preserveAspectRatio:"xMidYMid slice",clipPath:`url(#${w})`,onError:()=>M(!0)}),m.jsx("polygon",{points:N,fill:"none",stroke:Q,strokeWidth:o||s?"2":"1"})]}),l&&!v&&m.jsxs("g",{className:"lava-bubbles",children:[JT.map((re,pe)=>m.jsx("circle",{cx:re.cx,cy:re.cy,r:re.r,fill:"#fbbf24",opacity:"0.7",style:{animation:`lavaBubble 2s ease-in-out ${re.delay}s infinite`}},pe)),m.jsx("polygon",{points:Uf(G-4),fill:"none",stroke:"#f97316",strokeWidth:"1",opacity:"0.35"})]}),b&&!v&&m.jsxs("g",{className:"fire-embers",children:[m.jsx("circle",{cx:"-6",cy:"4",r:"2",fill:"#fbbf24",opacity:"0.75",style:{animation:"lavaBubble 1.6s ease-in-out 0s infinite"}}),m.jsx("circle",{cx:"4",cy:"-6",r:"1.5",fill:"#fcd34d",opacity:"0.75",style:{animation:"lavaBubble 1.4s ease-in-out 0.5s infinite"}})]}),C&&m.jsx("text",{x:"0",y:"0",textAnchor:"middle",fill:"rgba(0,0,0,0.15)",fontSize:"8",dy:".3em",pointerEvents:"none",children:`${e.q},${e.r}`})]})},t1=ma.memo(e1,(e,i)=>e.hex.q===i.hex.q&&e.hex.r===i.hex.r&&e.hex.s===i.hex.s&&e.onClick===i.onClick&&e.onMouseEnter===i.onMouseEnter&&e.isCenter===i.isCenter&&e.isSelected===i.isSelected&&e.isValidMove===i.isValidMove&&e.isTargeted===i.isTargeted&&e.isStairs===i.isStairs&&e.isLava===i.isLava&&e.isShrine===i.isShrine&&e.isWall===i.isWall&&e.isFire===i.isFire&&e.assetHref===i.assetHref&&e.interactionOnly===i.interactionOnly),n1={catacombs:.2,inferno:.16,throne:.24,frozen:.45,void:.08},i1=(e,i)=>{const s=Math.max(e,i),o=Math.min(e,i);return(s+.05)/(o+.05)},a1=(e,i,s=24,o,c,l=1)=>{const f=Cl(e.subtype,e.type,e.enemyType,e.archetype),{icon:h,shape:b,color:y,borderColor:S,size:v=1}=f,A=s*v,M=e.statusEffects?.find(N=>N.type==="time_bomb"),p=M?Math.max(0,M.duration):e.actionCooldown??0,g=`contrast(${l.toFixed(2)}) brightness(${(l>1?1.12:1.04).toFixed(2)})`,C=i?`drop-shadow(0 3px 4px rgba(0,0,0,0.45)) drop-shadow(0 0 2px rgba(255,255,255,0.5)) saturate(1.08) ${g}`:`drop-shadow(0 3px 4px rgba(0,0,0,0.50)) drop-shadow(0 0 2px rgba(255,255,255,0.35)) saturate(1.0) ${g}`;return m.jsxs("g",{children:[m.jsx("title",{children:i?"Player":`${e.subtype||"Enemy"}`}),o&&m.jsx("image",{href:o,x:-A,y:-A,width:A*2,height:A*2,preserveAspectRatio:"xMidYMid meet",onError:c,style:{filter:C,opacity:i?1:.97}}),!o&&b==="square"&&m.jsx("rect",{x:-A*.8,y:-A*.8,width:A*1.6,height:A*1.6,fill:y,stroke:S,strokeWidth:2}),!o&&b==="diamond"&&m.jsx("path",{d:`M0 ${-A*.8} L${A*.6} 0 L0 ${A*.8} L${-A*.6} 0 Z`,fill:y,stroke:S,strokeWidth:1}),!o&&b==="triangle"&&m.jsx("path",{d:`M0 ${-A*.8} L${A*.7} ${A*.5} L${-A*.7} ${A*.5} Z`,fill:y,stroke:S,strokeWidth:1}),!o&&b==="circle"&&m.jsx("circle",{r:A*.7,fill:y,stroke:S,strokeWidth:1}),e.subtype==="bomb"&&m.jsx("text",{y:A*.2,textAnchor:"middle",fill:"#fff",fontSize:"10",fontWeight:"bold",children:p}),!o&&!i&&e.subtype!=="bomb"&&m.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:A*.8,opacity:.8,children:h}),!o&&i&&m.jsx("path",{d:`M0 ${-A*.4} L0 ${A*.4} M${-A*.15} ${-A*.2} L0 ${-A*.5} L${A*.15} ${-A*.2}`,stroke:S,strokeWidth:2,fill:"none"})]})},s1=({entity:e,isSpear:i,isDying:s,movementTrace:o,waapiControlled:c=!1,assetHref:l,fallbackAssetHref:f,floorTheme:h,visualPose:b})=>{const[y,S]=_.useState(e.position),[v,A]=_.useState(()=>Ve(e.position,G)),[M,p]=_.useState(e.previousPosition),[g,C]=_.useState(220),[N,O]=_.useState("cubic-bezier(0.22, 1, 0.36, 1)"),[w,R]=_.useState("none"),Q=_.useRef(!1),W=_.useRef(e.position),j=_.useRef([]),re=_.useRef(null),[pe,z]=_.useState(!1),ue=_.useRef(e.hp),ye=e.type==="player",q=typeof window<"u"&&!!window.__HOP_DEBUG_MOVEMENT,[le,Z]=_.useState(l||f),[P,ee]=_.useState(!1);_.useEffect(()=>{Z(l||f),ee(!1)},[l,f,e.id]);const Y=()=>{if(!P&&f&&le!==f){Z(f),ee(!0);return}Z(void 0)};_.useEffect(()=>{const Nn=()=>{for(const dn of j.current)clearTimeout(dn);j.current=[],re.current!==null&&(cancelAnimationFrame(re.current),re.current=null)};if(c){Nn(),Q.current=!1;const dn=!!(o&&o.actorId===e.id&&o.destination&&ae(o.destination,e.position)),Ft=!ae(e.position,W.current);W.current=e.position,Ft&&!dn&&(S(e.position),p(e.previousPosition),A(Ve(e.position,G))),w!=="none"&&R("none"),g!==0&&C(0),N!=="linear"&&O("linear");return}if(!ae(e.position,W.current)){W.current=e.position;const dn=o&&o.actorId===e.id&&o.destination&&ae(o.destination,e.position)&&Array.isArray(o.path)&&o.path.length>0,Ft=dn?o.path:void 0,Hi=dn?o.movementType:void 0,fn=dn?Math.max(0,o.startDelayMs??0):0;if(q){const sn=e.previousPosition?Kt(e.previousPosition,e.position).length:0;console.log("[HOP_MOVE]",{actorId:e.id,movementType:Hi||"fallback",usedEngineTrace:dn,tracePathLength:Ft?.length||0,tracePath:Ft||[],startDelayMs:fn,fallbackPathLength:sn,origin:o?.origin||e.previousPosition,destination:e.position})}if(Hi==="teleport"&&dn&&o.origin){Nn(),Q.current=!0;const sn=o.durationMs??180,ke=Math.max(80,Math.floor(sn/2)),ut=()=>{C(0),O("linear"),p(o.origin),S(o.origin),A(Ve(o.origin,G)),R("out");const et=window.setTimeout(()=>{S(e.position),p(e.position),A(Ve(e.position,G)),R("in")},ke),ti=window.setTimeout(()=>{R("none"),Q.current=!1},ke*2);j.current.push(et,ti)};if(fn>0){const et=window.setTimeout(ut,fn);j.current.push(et)}else ut();return()=>{Nn(),Q.current=!1}}const ea=!!(e.previousPosition&&!ae(e.position,e.previousPosition));if(!!(Ft&&Ft.length>1)||ea){let ke=Ft||(e.previousPosition?Kt(e.previousPosition,e.position):[]);if(dn&&o?.origin&&ke.length>1&&ae(ke[ke.length-1],o.origin)&&!ae(ke[0],o.origin)&&(ke=[...ke].reverse()),ke.length>1){Nn(),Q.current=!0;const ut=Math.max(1,ke.length-1),et=o?.durationMs?o.durationMs/ut:0,ti=Math.max(90,Math.min(130,et||112)),mn=ti*ut,Jt=ke.map(Nt=>Ve(Nt,G)),ta=performance.now(),pn=Nt=>Nt<.5?4*Nt*Nt*Nt:1-Math.pow(-2*Nt+2,3)/2;R("none"),C(0),O("linear"),S(ke[0]),p(ke[0]),A(Jt[0]);let In=-1;const Ln=Nt=>{const hn=Math.max(0,Nt-ta),Bn=Math.min(ut-1,Math.floor(hn/ti)),na=Bn*ti,ba=hn-na,Ai=Math.max(0,Math.min(1,ba/ti)),ji=pn(Ai);Bn!==In&&(p(ke[Bn]),S(ke[Math.min(ke.length-1,Bn+1)]),In=Bn);const Di=Jt[Bn],xa=Jt[Math.min(Jt.length-1,Bn+1)];if(A({x:Di.x+(xa.x-Di.x)*ji,y:Di.y+(xa.y-Di.y)*ji}),hn<mn){re.current=requestAnimationFrame(Ln);return}Q.current=!1,S(e.position),p(e.previousPosition),A(Jt[Jt.length-1]),re.current=null};if(fn>0){const Nt=window.setTimeout(()=>{re.current=requestAnimationFrame(Ln)},fn);j.current.push(Nt)}else re.current=requestAnimationFrame(Ln);return()=>{Nn(),Q.current=!1}}}R("none"),C(220),O("cubic-bezier(0.22, 1, 0.36, 1)"),S(e.position),p(e.previousPosition),A(Ve(e.position,G))}},[e.position,e.previousPosition,o,e.id,c]);const{x:he,y:ge}=v||Ve(y,G);_.useEffect(()=>{if(e.hp<ue.current){z(!0);const Nn=setTimeout(()=>z(!1),150);return()=>clearTimeout(Nn)}ue.current=e.hp},[e.hp]);let k="";const U=M;if(U&&!ae(y,U)){const Nn=ha(U,y);if(Nn!==-1){const dn=Nn*60;k=`rotate(${dn}) scale(1.15, 0.85) rotate(${-dn})`}}const K=e.isVisible===!1;if(i){const Nn=Cl("spear","enemy");return m.jsx("g",{style:{pointerEvents:"none"},children:m.jsx("g",{transform:`translate(${he},${ge})`,children:m.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:"20",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5))"},children:Nn.icon})})})}const ne=Cl(e.subtype,e.type,e.enemyType,e.archetype),xe=GT(e),Ie=ye?1.34:.92,Se=ye?-9:-2,nt=ye?24:18,He=String(h||"").toLowerCase(),ze=n1[He]??.22,At=i1(ze,ye?.87:.82)<4.5?1.22:1.06,ft=ye?"#22e7ff":"rgba(255,120,120,0.7)",qn=ye?"rgba(34,231,255,0.20)":"rgba(239,68,68,0.16)",Dt=ye?"rgba(34,231,255,0.36)":"rgba(255,90,90,0.28)",zn=ye?G*.48:G*.42,ct=ye?G*.17:G*.145,Mt=ye?G*.32:G*.3,an=b?.offsetX??0,Zn=b?.offsetY??0,vi=b?.scaleX??1,Si=b?.scaleY??1,ya=Math.abs(an)>.01||Math.abs(Zn)>.01||Math.abs(vi-1)>.01||Math.abs(Si-1)>.01?`translate(${an},${Zn}) scale(${vi},${Si})`:void 0;return m.jsx("g",{style:{pointerEvents:"none"},children:m.jsx("g",{"data-actor-node":e.id,style:{transition:c?"none":`transform ${g}ms ${N}`,transform:`translate(${he}px, ${ge}px)`},className:s?"animate-lava-sink":"",children:m.jsx("g",{transform:ya,children:m.jsxs("g",{transform:k,className:`${pe?"entity-damaged":""} ${!s&&!is(e)?"animate-idle":""} ${w==="out"?"entity-teleport-out":""} ${w==="in"?"entity-teleport-in":""}`,opacity:K?.3:ne.opacity||1,style:{filter:K?"blur(1px)":"none"},children:[m.jsxs("g",{transform:`translate(0,${Mt})`,children:[m.jsx("ellipse",{cx:0,cy:0,rx:zn,ry:ct,fill:qn,stroke:ft,strokeWidth:2,opacity:.95,style:{filter:`drop-shadow(0 0 5px ${Dt})`}}),m.jsx("ellipse",{cx:0,cy:0,rx:zn*1.14,ry:ct*1.14,fill:"none",stroke:ft,strokeWidth:ye?1.8:1.6,opacity:ye?.62:.54})]}),xe&&m.jsx("ellipse",{cx:0,cy:G*.3,rx:G*.4,ry:G*.15,fill:"black",opacity:.2}),m.jsx("g",{transform:`translate(0,${Se}) scale(${Ie})`,children:a1(e,ye,nt,le,Y,At)}),is(e)&&m.jsxs("g",{transform:`translate(0, -${G*.8})`,className:"stun-icon",children:[m.jsx("text",{fontSize:"14",textAnchor:"middle",children:"*"}),m.jsx("text",{fontSize:"8",textAnchor:"middle",dy:"-3",dx:"6",children:"+"})]}),ne.showFacing&&e.facing!==void 0&&!is(e)&&m.jsx("line",{x1:0,y1:0,x2:Math.cos((e.facing*60-90)*Math.PI/180)*G*.5,y2:Math.sin((e.facing*60-90)*Math.PI/180)*G*.5,stroke:ne.borderColor,strokeWidth:3,strokeLinecap:"round"}),m.jsx("title",{children:`${e.subtype||e.type} - HP ${e.hp}/${e.maxHp}${e.intent?` - ${e.intent}`:""}`})]})})})})},Ay=e=>{if(!e)return"";const i=(e.path||[]).map(s=>`${s.q},${s.r},${s.s}`).join(";");return`${e.actorId}|${e.movementType||""}|${e.destination?.q??""},${e.destination?.r??""},${e.destination?.s??""}|${i}|${e.durationMs??""}|${e.startDelayMs??0}|${e.wasLethal?1:0}`},Ty=(e=[])=>e.map(i=>`${i.id}:${i.duration??""}:${i.stacks??""}`).join("|"),Gc=ma.memo(s1,(e,i)=>{const s=e.entity,o=i.entity;return e.isSpear===i.isSpear&&e.isDying===i.isDying&&e.waapiControlled===i.waapiControlled&&e.assetHref===i.assetHref&&e.fallbackAssetHref===i.fallbackAssetHref&&e.floorTheme===i.floorTheme&&(e.visualPose?.offsetX??0)===(i.visualPose?.offsetX??0)&&(e.visualPose?.offsetY??0)===(i.visualPose?.offsetY??0)&&(e.visualPose?.scaleX??1)===(i.visualPose?.scaleX??1)&&(e.visualPose?.scaleY??1)===(i.visualPose?.scaleY??1)&&Ay(e.movementTrace)===Ay(i.movementTrace)&&s.id===o.id&&s.hp===o.hp&&s.maxHp===o.maxHp&&s.facing===o.facing&&s.intent===o.intent&&s.isVisible===o.isVisible&&s.position.q===o.position.q&&s.position.r===o.position.r&&s.position.s===o.position.s&&(s.previousPosition?.q??0)===(o.previousPosition?.q??0)&&(s.previousPosition?.r??0)===(o.previousPosition?.r??0)&&(s.previousPosition?.s??0)===(o.previousPosition?.s??0)&&(s.intentPosition?.q??0)===(o.intentPosition?.q??0)&&(s.intentPosition?.r??0)===(o.intentPosition?.r??0)&&(s.intentPosition?.s??0)===(o.intentPosition?.s??0)&&Ty(s.statusEffects)===Ty(o.statusEffects)}),o1=({gameState:e,selectedSkillId:i,showMovementRange:s,hoveredTile:o,enginePreviewGhost:c})=>{const l=e.player.position,f=_.useMemo(()=>{const A=new Set;for(const M of e.enemies)M.hp>0&&A.add(Te(M.position));return A},[e.enemies]),h=_.useMemo(()=>{if(!s||i)return[];const A=new Set(e.player.activeSkills.map(C=>C.id)),M=["BASIC_MOVE","DASH"],p=new Set,g=[];return M.forEach(C=>{if(A.has(C)){const N=Un.get(C);N?.getValidTargets&&N.getValidTargets(e,l).forEach(w=>{const R=Te(w);p.has(R)||(p.add(R),g.push(w))})}}),g.length===0?[{q:l.q+1,r:l.r,s:l.s-1},{q:l.q+1,r:l.r-1,s:l.s},{q:l.q,r:l.r-1,s:l.s+1},{q:l.q-1,r:l.r,s:l.s+1},{q:l.q-1,r:l.r+1,s:l.s},{q:l.q,r:l.r+1,s:l.s-1}].filter(N=>qs(N,e.gridWidth,e.gridHeight)):g},[e,s,i,l]),b=_.useMemo(()=>{const A=new Set;for(const M of h)A.add(Te(M));return A},[h]),y=_.useMemo(()=>{if(!i)return[];const A=Un.get(i),M=XA(e.player,i)||A?.baseVariables?.range||0,p=A?.getValidTargets?A.getValidTargets(e,l):[],g=new Set(p.map(Te)),C=[];if(i==="DASH"||i==="SPEAR_THROW"||i==="SHIELD_THROW"||i==="GRAPPLE_HOOK")for(let O=0;O<6;O++)for(let w=1;w<=M;w++){const R=ui(l,lm(O,w));if(!qs(R,e.gridWidth,e.gridHeight))break;const Q=Ze.isLosBlocking(e,R),W=f.has(Te(R)),pe=Kt(l,R).slice(1,-1).some(ue=>Ze.isLosBlocking(e,ue)||f.has(Te(ue))),z=g.has(Te(R));if(C.push({p:R,isValidTarget:z,isBlocked:pe,isWall:Q,isEnemy:W}),Q||W)break}else p.forEach(O=>{const w=Ze.isLosBlocking(e,O),R=f.has(Te(O));C.push({p:O,isValidTarget:!0,isBlocked:!1,isWall:w,isEnemy:R})});return C},[e,i,l,f]),S=_.useMemo(()=>{const A=new Map;for(const M of y)A.set(Te(M.p),M);return A},[y]),v=_.useMemo(()=>{if(c)return c;if(s&&o&&!i&&b.has(Te(o)))return{path:Kt(l,o),aoe:[],hasEnemy:!1,target:o};if(!i||!o)return null;const A=S.get(Te(o));if(!A||!A.isValidTarget||A.isBlocked)return null;const M=Kt(l,o),p=Ox(e,i,l,o),g=A.isEnemy;return{path:M,aoe:p,hasEnemy:g,target:o}},[c,e,i,o,S,b,s,l]);return m.jsx("g",{pointerEvents:"none",children:v&&m.jsxs("g",{children:[(()=>{const A=v.path.map(O=>Ve(O,G)),M=A.map((O,w)=>`${w===0?"M":"L"} ${O.x} ${O.y}`).join(" "),p=A[A.length-1],g=A[A.length-2]||{x:p.x-1,y:p.y},C=Math.atan2(p.y-g.y,p.x-g.x),N=8;return m.jsxs("g",{children:[m.jsx("path",{d:M,stroke:"rgba(255,255,255,0.9)",strokeWidth:"2.25",fill:"none",opacity:"0.85",style:{filter:"drop-shadow(0 0 4px rgba(255,255,255,0.22))"}}),m.jsx("path",{d:`M ${p.x} ${p.y} L ${p.x-N*Math.cos(C-Math.PI/6)} ${p.y-N*Math.sin(C-Math.PI/6)} M ${p.x} ${p.y} L ${p.x-N*Math.cos(C+Math.PI/6)} ${p.y-N*Math.sin(C+Math.PI/6)}`,stroke:"rgba(255,255,255,0.95)",strokeWidth:"2",opacity:"0.9"})]})})(),v.hasEnemy&&(()=>{const{x:A,y:M}=Ve(v.target,G),p=G*.7;return m.jsxs("g",{children:[m.jsx("circle",{cx:A,cy:M,r:p,fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4 2"}),m.jsx("line",{x1:A-p,y1:M,x2:A+p,y2:M,stroke:"#ef4444",strokeWidth:"1"}),m.jsx("line",{x1:A,y1:M-p,x2:A,y2:M+p,stroke:"#ef4444",strokeWidth:"1"})]})})(),!v.hasEnemy&&(()=>{const{x:A,y:M}=Ve(v.target,G);return m.jsx("circle",{cx:A,cy:M,r:G*.36,fill:"rgba(255,255,255,0.14)",stroke:"rgba(255,255,255,0.65)",strokeWidth:1.5})})(),Array.from(new Map(v.aoe.map(A=>[Te(A),A])).values()).map(A=>{const{x:M,y:p}=Ve(A,G);return m.jsx("circle",{cx:M,cy:p,r:G*.6,fill:"rgba(239, 68, 68, 0.2)",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,strokeDasharray:"4 2"},`aoe-${A.q}-${A.r}`)})]})})},r1=["white","blue","black","red","green"],Ey={white:{label:"Plains / Mesa",floorAssetId:"tile.catacombs.floor.01",hazardAssetId:"tile.catacombs.lava.01"},blue:{label:"Islands / Coast",floorAssetId:"tile.frozen.floor.01",hazardAssetId:"tile.catacombs.lava.01"},black:{label:"Swamp / Wastes",floorAssetId:"tile.void.floor.01",hazardAssetId:"tile.catacombs.lava.01"},red:{label:"Mountains / Volcanic",floorAssetId:"tile.inferno.floor.01",hazardAssetId:"tile.inferno.lava.01"},green:{label:"Forest / Jungle",floorAssetId:"tile.throne.floor.01",hazardAssetId:"tile.catacombs.lava.01"}},l1={catacombs:"white",frozen:"blue",void:"black",inferno:"red",throne:"green"},c1=e=>{if(typeof e!="string")return;const i=e.toLowerCase();return r1.includes(i)?i:void 0},u1=()=>{if(!(typeof window>"u"))return c1(window.__HOP_FORCE_BIOME)},d1=e=>{const i=u1();if(i)return i;const s=String(e||"").toLowerCase();return l1[s]||"white"},f1=e=>{const i=d1(e.theme);return e.isWall?"tile.catacombs.wall.01":e.isLava?Ey[i].hazardAssetId:e.isFire?"tile.catacombs.fire.01":Ey[i].floorAssetId},_y=e=>{if(e.isStairs)return"prop.core.stairs.01";if(e.isShrine)return"prop.core.shrine.01"},Ds=e=>{if(e.type==="player")switch(e.archetype){case"FIREMAGE":return"unit.player.firemage.04";case"SKIRMISHER":return"unit.player.skirmisher.01";case"HUNTER":return"unit.player.hunter.01";case"NECROMANCER":return"unit.player.necromancer.01";case"ASSASSIN":return"unit.player.assassin.01";default:return"unit.player.vanguard.01"}switch(e.subtype){case"footman":return"unit.enemy.footman.01";case"shield_bearer":return"unit.enemy.shield_bearer.01";case"archer":return"unit.enemy.archer.01";case"warlock":return"unit.enemy.warlock.01";case"bomber":return"unit.enemy.bomber.01";case"bomb":return"unit.enemy.bomb.01";default:return e.enemyType==="boss"?"unit.enemy.boss.01":"unit.enemy.footman.01"}},wy="/Hop",My=(e,i)=>`${e.endsWith("/")?e:`${e}/`}${i.replace(/^\/+/,"")}`,m1=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?My(wy,e.slice(1)):e:My(wy,e),p1={"unit.player.vanguard.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.firemage.04":"/assets/units/unit.player.firemage.02.svg","unit.player.skirmisher.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.hunter.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.necromancer.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.assassin.01":"/assets/units/unit.player.skirmisher.01.svg","unit.enemy.footman.01":"/assets/units/unit.enemy.footman.01.svg","unit.enemy.shield_bearer.01":"/assets/units/unit.enemy.shield_bearer.01.svg","unit.enemy.archer.01":"/assets/units/unit.enemy.archer.01.svg","unit.enemy.warlock.01":"/assets/units/unit.enemy.warlock.01.svg","unit.enemy.bomber.01":"/assets/units/unit.enemy.bomber.01.svg","unit.enemy.bomb.01":"/assets/units/unit.enemy.bomb.01.svg","unit.enemy.boss.01":"/assets/units/unit.enemy.boss.01.svg"},vo=e=>{const i=Ds(e),s=p1[i];return s?m1(s):void 0},h1=e=>{if(e==="impact")return"fx.core.impact.01";if(e==="vaporize")return"fx.core.vaporize.01";if(e==="lava_ripple")return"fx.core.lava_ripple.01";if(e==="explosion_ring")return"fx.core.explosion_ring.01"},g1=()=>"ui.core.hp_frame.01",y1=()=>"decal.combat.blood.01",b1={"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|anticipation":{rendererId:"basic_attack_strike",ttlMs:130},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|travel":{rendererId:"basic_attack_strike",ttlMs:110},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|impact":{rendererId:"basic_attack_strike",ttlMs:180},"ATK.STRIKE.PHYSICAL.BASIC_ATTACK|aftermath":{rendererId:"basic_attack_strike",ttlMs:190},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|anticipation":{rendererId:"basic_attack_strike",ttlMs:100},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|travel":{rendererId:"basic_attack_strike",ttlMs:90},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|impact":{rendererId:"basic_attack_strike",ttlMs:140},"ATK.STRIKE.PHYSICAL.AUTO_ATTACK|aftermath":{rendererId:"basic_attack_strike",ttlMs:120},"ATK.SHOOT.PHYSICAL.ARROW|anticipation":{rendererId:"archer_shot_signature",ttlMs:110},"ATK.SHOOT.PHYSICAL.ARROW|travel":{rendererId:"archer_shot_signature",ttlMs:160,skipIfLegacyMirrored:!0},"ATK.SHOOT.PHYSICAL.ARROW|impact":{rendererId:"archer_shot_signature",ttlMs:150}},x1={"ATK.STRIKE.PHYSICAL.IMPACT":{rendererId:"impact",ttlMs:420,skipIfLegacyMirrored:!0},"ATK.STRIKE.PHYSICAL.HEAVY":{rendererId:"melee_lunge",ttlMs:280},"ATK.STRIKE.PHYSICAL.LIGHT":{rendererId:"impact",ttlMs:380},"ATK.SHOOT.PHYSICAL.SPEAR_TRAIL":{rendererId:"spear_trail",ttlMs:520,skipIfLegacyMirrored:!0},"ATK.SHOOT.PHYSICAL.SPEAR_RETURN":{rendererId:"spear_trail",ttlMs:520},"ATK.BLAST.FIRE.EXPLOSION_RING":{rendererId:"explosion_ring",ttlMs:980},"ATK.BLAST.FIRE.TIME_BOMB":{rendererId:"explosion_ring",ttlMs:980},"ATK.BLAST.FIRE.FIREBALL_IMPACT":{rendererId:"explosion_ring",ttlMs:740},"ATK.BLAST.VOID.CORPSE_EXPLOSION":{rendererId:"generic_ring",ttlMs:840},"ENV.HAZARD.FIRE.LAVA_RIPPLE":{rendererId:"lava_ripple",ttlMs:820},"ENV.COLLISION.KINETIC.WALL_CRACK":{rendererId:"wall_crack",ttlMs:700},"ENV.COLLISION.KINETIC.IMPACT":{rendererId:"wall_crack",ttlMs:520},"ATK.PULSE.KINETIC.WAVE":{rendererId:"kinetic_wave",ttlMs:540},"MOVE.DASH.NEUTRAL.BLUR":{rendererId:"dash_blur",ttlMs:320},"MOVE.DASH.NEUTRAL.SWIFT_ROLL":{rendererId:"dash_blur",ttlMs:320},"MOVE.DASH.KINETIC.MOMENTUM_TRAIL":{rendererId:"dash_blur",ttlMs:360},"STATE.FADE.SHADOW.HIDDEN":{rendererId:"hidden_fade",ttlMs:360},"STATE.FADE.SHADOW.SMOKE_SCREEN":{rendererId:"hidden_fade",ttlMs:420},"MOVE.BLINK.SHADOW.SHADOW_STEP":{rendererId:"hidden_fade",ttlMs:380},"MOVE.BLINK.ARCANE.SOUL_SWAP_ARRIVE":{rendererId:"flash",ttlMs:280},"MOVE.BLINK.ARCANE.SOUL_SWAP_DEPART":{rendererId:"flash",ttlMs:280},"STATE.APPLY.NEUTRAL.STUN_BURST":{rendererId:"generic_ring",ttlMs:560},"UI.TEXT.NEUTRAL.POPUP":{rendererId:"combat_text",ttlMs:1100},"UI.SHAKE.NEUTRAL.CAMERA":{rendererId:"none",ttlMs:1,skipIfLegacyMirrored:!0},"UI.FREEZE.NEUTRAL.HITSTOP":{rendererId:"none",ttlMs:1}},v1={"attack|shoot|physical|travel":{rendererId:"arrow_shot",ttlMs:320},"attack|shoot|arcane|travel":{rendererId:"arcane_bolt",ttlMs:340},"attack|shoot|fire|travel":{rendererId:"arcane_bolt",ttlMs:340},"attack|strike|physical|impact":{rendererId:"melee_lunge",ttlMs:260},"attack|blast|fire|impact":{rendererId:"explosion_ring",ttlMs:900},"attack|pulse|kinetic|impact":{rendererId:"kinetic_wave",ttlMs:520},"environment|collision|kinetic|impact":{rendererId:"wall_crack",ttlMs:700},"status|state_fade|shadow|instant":{rendererId:"hidden_fade",ttlMs:360},"ui|text|neutral|instant":{rendererId:"combat_text",ttlMs:1e3}},S1={"attack|blast|impact":{rendererId:"generic_ring",ttlMs:680},"attack|shoot|travel":{rendererId:"generic_line",ttlMs:300},"attack|strike|impact":{rendererId:"impact",ttlMs:400},"environment|hazard_burst|impact":{rendererId:"generic_ring",ttlMs:760},"status|status_apply|impact":{rendererId:"flash",ttlMs:320},"ui|text|instant":{rendererId:"combat_text",ttlMs:1e3}},A1={"movement|dash":{rendererId:"dash_blur",ttlMs:300},"movement|blink":{rendererId:"flash",ttlMs:260},"attack|pulse":{rendererId:"kinetic_wave",ttlMs:500},"attack|blast":{rendererId:"generic_ring",ttlMs:700},"attack|shoot":{rendererId:"generic_line",ttlMs:280},"attack|strike":{rendererId:"impact",ttlMs:380},"environment|collision":{rendererId:"wall_crack",ttlMs:650},"ui|text":{rendererId:"combat_text",ttlMs:1e3}},T1=new Set(["impact","flash","spearTrail","shake"]),E1=e=>{const i=`${e.signature}|${e.phase}`,s=b1[i];if(s)return{key:`sigp:${i}`,recipe:s};const o=x1[e.signature];if(o)return{key:`sig:${e.signature}`,recipe:o};const c=`${e.family}|${e.primitive}|${e.element||"neutral"}|${e.phase}`,l=v1[c];if(l)return{key:`fpel:${c}`,recipe:l};const f=`${e.family}|${e.primitive}|${e.phase}`,h=S1[f];if(h)return{key:`fpp:${f}`,recipe:h};const b=`${e.family}|${e.primitive}`,y=A1[b];return y?{key:`fp:${b}`,recipe:y}:{key:"fallback:none",recipe:{rendererId:"none",ttlMs:1}}},_1=({payload:e,reducedMotion:i})=>{const{key:s,recipe:o}=E1(e);if(o.skipIfLegacyMirrored&&e.meta?.legacyMirrored&&e.meta?.legacyJuiceId&&T1.has(String(e.meta.legacyJuiceId)))return null;let c=Math.max(1,Number(e.timing?.ttlMs??e.timing?.durationMs??o.ttlMs));return i&&(c=Math.max(1,Math.floor(c*.7))),{key:s,ttlMs:c,recipe:o,payload:e}},w1=e=>new Promise(i=>setTimeout(i,e)),M1=e=>{if(!e)return null;const i=e.position||e.destination||e.origin||e.target;return i&&typeof i.q=="number"&&typeof i.r=="number"&&typeof i.s=="number"?i:null},Oy=e=>{if(e.ttlMs&&e.ttlMs>0)return e.ttlMs;const i=e.type;return i==="basic_attack_strike"?180:i==="archer_shot_signature"?170:i==="impact"?400:i==="combat_text"?1e3:i==="flash"?300:i==="melee_lunge"?240:i==="arrow_shot"?260:i==="arcane_bolt"?320:i==="kinetic_wave"?520:i==="wall_crack"?700:i==="dash_blur"?320:i==="hidden_fade"?360:i==="generic_ring"?700:i==="generic_line"?280:i==="spear_trail"?500:i==="vaporize"?600:i==="lava_ripple"?800:i==="explosion_ring"?1e3:2e3},O1=new Set(["impact","flash","combat_text","spear_trail","vaporize","lava_ripple","explosion_ring"]),Cy=.72,qf=e=>{const i=e?.hex;if(i&&typeof i.q=="number"&&typeof i.r=="number"&&typeof i.s=="number")return i},zf=e=>{const i=e?.world;if(i&&typeof i.x=="number"&&typeof i.y=="number")return i},C1=(e,i,s)=>{const o=String(e||"").toLowerCase(),c=String(i||"").toLowerCase();return c.includes("lava")||c.includes("fire")||c.includes("hazard")||c.includes("burn")||c.includes("crush")||c.includes("collision")||o==="bomber"||c.includes("bomb")||c.includes("explosion")?null:o==="warlock"||c.includes("arcane")||c.includes("force")||c.includes("spell")?"arcane_bolt":o==="archer"||c.includes("arrow")||c.includes("spear_throw")?"arrow_shot":s<=G*2.05||c.includes("basic_attack")||c.includes("melee")?"melee_lunge":null},k1=({visualEvents:e,timelineEvents:i=[],simulationEvents:s=[],actorSnapshots:o=[],onBusyStateChange:c,assetManifest:l})=>{const[f,h]=_.useState([]),b=_.useRef(null),y=_.useRef(null),S=_.useRef(null),v=_.useRef(0),A=_.useRef([]),M=_.useRef(!1),[p,g]=_.useState(!1),C=_.useRef(!1),N=_.useRef(new Map),O=_.useRef(null),w=_.useRef(Date.now()),R=_.useRef(new Map),Q=650,W=3500,j=_.useMemo(()=>{const z=new Map;for(const ue of l?.assets||[])z.set(ue.id,ue);return z},[l]),re=_.useMemo(()=>{const z=new Map;for(const ue of o)z.set(ue.id,ue);return z},[o]);_.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const z=window.matchMedia("(prefers-reduced-motion: reduce)"),ue=()=>{C.current=z.matches};return ue(),z.addEventListener?.("change",ue),()=>z.removeEventListener?.("change",ue)},[]),_.useEffect(()=>{if(!e.length)return;const z=new Map(N.current),ue=Date.now();for(const ye of e){if(ye.type!=="kinetic_trace")continue;const q=ye.payload;if(!q?.actorId)continue;const le=Number(q.durationMs??0);le>0&&z.set(String(q.actorId),{durationMs:le,seenAt:ue})}N.current=z},[e]),_.useEffect(()=>{c?.(p)},[p,c]);const pe=z=>{const ue=Date.now(),ye=M1(z.payload);if(!ye)return;const q=[],le=`${z.id}:${ue}`;z.phase==="HAZARD_CHECK"?q.push({id:`${le}:haz`,type:"combat_text",position:ye,payload:{text:"!"},startTime:ue}):z.phase==="DEATH_RESOLVE"&&q.push({id:`${le}:vapor`,type:"vaporize",position:ye,startTime:ue}),q.length>0&&h(Z=>[...Z,...q])};return _.useEffect(()=>{if(!i.length||b.current===i)return;b.current=i;const z=i;z.length&&(A.current.push(...z),!M.current&&(M.current=!0,g(!0),(async()=>{try{const ue=Date.now();for(;A.current.length>0;){if(Date.now()-ue>W){console.warn("[HOP_JUICE] Timeline queue exceeded runtime budget; flushing remaining events.",{queued:A.current.length});break}const ye=A.current.shift();pe(ye);let q=ye.blocking?Math.round((ye.suggestedDurationMs??140)*Cy):0;if(ye.phase==="MOVE_END"){const ee=ye.payload?.targetActorId;if(ee){const Y=N.current.get(ee),he=Y?Date.now()-Y.seenAt<=2500:!1;Y&&he&&Y.durationMs>0&&(q=Math.max(q,Math.min(Q,Math.round(Y.durationMs*Cy))))}}let le=0;ye.phase==="MOVE_END"?le=Math.min(460,Math.max(70,q)):ye.phase==="DEATH_RESOLVE"?le=Math.min(120,Math.max(55,q)):ye.phase==="DAMAGE_APPLY"?le=Math.min(80,Math.max(35,q)):ye.phase==="HAZARD_CHECK"?le=Math.min(70,Math.max(30,q)):ye.blocking&&(le=Math.min(70,Math.max(0,q)));const Z=ye.phase==="MOVE_END"?q:C.current?Math.min(70,Math.floor(le*.5)):le,P=Math.max(0,Math.min(Q,Z));P>0&&await w1(P)}}catch(ue){console.error("[HOP_JUICE] Timeline queue processing failed; releasing busy lock.",ue)}finally{A.current=[],M.current=!1,g(!1)}})()))},[i]),_.useEffect(()=>{if(S.current===e)return;S.current=e;const z=e;if(!z.length)return;const ue=Date.now(),ye=[];z.forEach((q,le)=>{if(q.type!=="juice_signature")return;const Z=q.payload;if(!Z||Z.protocol!=="juice-signature/v1")return;const P=_1({payload:Z,reducedMotion:C.current});if(!P||P.recipe.rendererId==="none")return;const ee=qf(Z.contact),Y=qf(Z.target),he=qf(Z.source),ge=zf(Z.contact),k=zf(Z.target),U=zf(Z.source),K=ee||Y||he,ne=ge||k||U,xe={id:`sig-${ue}-${le}`,startTime:ue+Math.max(0,Number(Z.timing?.delayMs||0)),ttlMs:P.ttlMs};if((Z.signature==="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"||Z.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK")&&Z.phase==="impact"&&Y){const Se=Te(Y);R.current.set(Se,{at:ue,signature:Z.signature})}const Ie=Z.text?.value;switch(P.recipe.rendererId){case"basic_attack_strike":{if(!he||!Y)return;ye.push({...xe,type:"basic_attack_strike",position:Y,worldPosition:ge||ne,payload:{phase:Z.phase,intensity:Z.intensity||"medium",signature:Z.signature,source:he,target:Y,sourceActorId:Z.source?.actorId,targetActorId:Z.target?.actorId,contactWorld:ge,contactHex:ee,direction:Z.direction,flags:Z.flags||{}}});return}case"archer_shot_signature":{const Se=Y||ee;if(!he||!Se)return;ye.push({...xe,type:"archer_shot_signature",position:Se,worldPosition:ge||ne,payload:{phase:Z.phase,intensity:Z.intensity||"medium",source:he,target:Se,contactWorld:ge,path:Z.path||(Z.area?.kind==="path"?Z.area.points:void 0),signature:Z.signature}});return}case"impact":case"flash":case"lava_ripple":case"explosion_ring":case"kinetic_wave":case"wall_crack":case"hidden_fade":case"generic_ring":{if(!K&&!ne)return;ye.push({...xe,type:P.recipe.rendererId,position:K,worldPosition:ne,payload:{signature:Z.signature,color:Z.text?.color,element:Z.element,variant:Z.variant,source:he,target:Y}});return}case"combat_text":{if(!Ie||!K&&!ne)return;ye.push({...xe,type:"combat_text",position:K,worldPosition:ne,payload:{text:Ie,color:Z.text?.color}});return}case"spear_trail":{if((!Z.path||Z.path.length===0)&&Z.area?.kind!=="path")return;const Se=Z.path||(Z.area?.kind==="path"?Z.area.points:[]);if(!Se||Se.length===0)return;ye.push({...xe,type:"spear_trail",position:Se[0],payload:{path:Se}});return}case"melee_lunge":case"arrow_shot":case"arcane_bolt":case"generic_line":{const Se=Y||ee;if(!Se||!he)return;ye.push({...xe,type:P.recipe.rendererId,position:Se,payload:{source:he,signature:Z.signature,element:Z.element}});return}case"dash_blur":{const Se=Z.path||(Z.area?.kind==="path"?Z.area.points:void 0);if(!Se||Se.length<2)return;ye.push({...xe,type:"dash_blur",position:Se[Se.length-1],payload:{path:Se,source:Se[0]}});return}default:return}}),ye.length>0&&h(q=>[...q,...ye])},[e]),_.useEffect(()=>{if(i.length>0){y.current=e;return}if(y.current===e)return;y.current=e;const z=e;if(!z.length)return;const ue=[],ye=Date.now();z.forEach((q,le)=>{const Z=`juice-${ye}-${le}`;q.type==="vfx"&&q.payload?.type==="impact"?q.payload.position&&ue.push({id:Z,type:"impact",position:q.payload.position,startTime:ye}):q.type==="vfx"&&q.payload?.type==="flash"?q.payload.position&&ue.push({id:Z,type:"flash",position:q.payload.position,startTime:ye}):q.type==="vfx"&&q.payload?.type==="spear_trail"?q.payload.path&&q.payload.path.length>0&&ue.push({id:Z,type:"spear_trail",position:q.payload.path[0],payload:q.payload,startTime:ye}):q.type==="vfx"&&q.payload?.type==="vaporize"?q.payload.position&&ue.push({id:Z,type:"vaporize",position:q.payload.position,startTime:ye}):q.type==="vfx"&&q.payload?.type==="lava_ripple"?q.payload.position&&ue.push({id:Z,type:"lava_ripple",position:q.payload.position,startTime:ye}):q.type==="vfx"&&q.payload?.type==="explosion_ring"&&q.payload.position&&ue.push({id:Z,type:"explosion_ring",position:q.payload.position,startTime:ye})}),ue.length>0&&h(q=>[...q,...ue])},[e,i.length]),_.useEffect(()=>{s.length<v.current&&(v.current=0);const z=v.current;if(z>=s.length)return;const ue=s.slice(z);v.current=s.length;const ye=Date.now(),q=[];ue.forEach((le,Z)=>{if(le.type!=="DamageTaken"||!le.position)return;const P=le.position,ee=String(le.payload?.sourceId||""),Y=ee?re.get(ee):void 0,he=String(le.payload?.reason||""),ge=R.current.get(Te(P)),k=ge?.signature==="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"||ge?.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK",U=!!(ge&&k&&ye-ge.at<=260),K=he.includes("basic_attack")||he.includes("auto_attack");if(Y?.position){const ne=Ve(Y.position,G),xe=Ve(P,G),Ie=Math.hypot(xe.x-ne.x,xe.y-ne.y),Se=U&&K?null:C1(Y.subtype,he,Ie);Se&&q.push({id:`sim-cue-${ye}-${z+Z}`,type:Se,position:P,payload:{source:Y.position,sourceSubtype:Y.subtype,reason:he},startTime:ye})}U&&K||q.push({id:`sim-impact-${ye}-${z+Z}`,type:"impact",position:P,startTime:ye})}),q.length>0&&h(le=>[...le,...q])},[s,re]),_.useEffect(()=>{if(O.current!==null&&(window.clearTimeout(O.current),O.current=null),f.length===0)return;const z=Date.now();let ue=1/0;for(const q of f){if(q.startTime>z){const P=q.startTime-z;P>0&&P<ue&&(ue=P);continue}const le=z-q.startTime,Z=Oy(q)-le;Z>0&&Z<ue&&(ue=Z)}if(!Number.isFinite(ue)){h([]);return}const ye=Math.max(16,Math.min(180,Math.floor(ue)));return O.current=window.setTimeout(()=>{const q=Date.now();h(le=>{const Z=w.current;w.current=q;const P=le.filter(Y=>q<Y.startTime+Oy(Y));return P.length!==le.length?P:le.some(Y=>Z<Y.startTime&&Y.startTime<=q)?[...le]:le})},ye),()=>{O.current!==null&&(window.clearTimeout(O.current),O.current=null)}},[f]),m.jsx("g",{style:{pointerEvents:"none"},children:f.map(z=>{if(Date.now()<z.startTime||!z.position&&!z.worldPosition)return null;const ye=z.position?Ve(z.position,G):{x:0,y:0},q=z.worldPosition?.x??ye.x,le=z.worldPosition?.y??ye.y,Z=O1.has(z.type)?h1(z.type):void 0,P=Z?j.get(Z)?.path:void 0,ee=j.get(g1())?.path;if(z.type==="basic_attack_strike"){const Y=z.payload||{},he=Y.source,ge=Y.target,k=String(Y.phase||"impact");if(!he||!ge)return null;const U=Ve(he,G),K=Y.contactWorld&&typeof Y.contactWorld.x=="number"&&typeof Y.contactWorld.y=="number"?Y.contactWorld:{x:q,y:le},ne=K.x-U.x,xe=K.y-U.y,Ie=Math.max(1,Math.hypot(ne,xe)),Se=ne/Ie,nt=xe/Ie,He=String(Y.intensity||"medium"),ze=Math.max(120,Math.min(360,Number(z.ttlMs||180))),Qt=`${Math.round(ze*.85)}ms`,Le=He==="extreme"?G*.34:He==="high"?G*.28:G*.22;if(k!=="impact")return null;const At=He==="extreme"?"rgba(253,224,71,0.98)":He==="high"?"rgba(255,255,255,0.96)":"rgba(226,232,240,0.95)",ft=He==="extreme"?"rgba(251,191,36,0.9)":"rgba(255,255,255,0.92)";return m.jsx("g",{children:m.jsxs("g",{className:"juice-basic-strike-spark",style:{animationDuration:Qt},children:[m.jsx("circle",{cx:K.x,cy:K.y,r:Le*1.65,fill:"rgba(255,255,255,0.16)",stroke:"rgba(255,255,255,0.55)",strokeWidth:1.4}),m.jsx("circle",{cx:K.x,cy:K.y,r:Le*.62,fill:ft}),m.jsx("circle",{cx:K.x,cy:K.y,r:Le*1.2,fill:"none",stroke:At,strokeWidth:2.4}),m.jsx("path",{d:`M ${K.x-Se*Le*1.6} ${K.y-nt*Le*1.6} L ${K.x+Se*Le*1.6} ${K.y+nt*Le*1.6}`,stroke:At,strokeWidth:2.1,strokeLinecap:"round"}),m.jsx("path",{d:`M ${K.x-nt*Le*1.35} ${K.y+Se*Le*1.35} L ${K.x+nt*Le*1.35} ${K.y-Se*Le*1.35}`,stroke:"rgba(255,255,255,0.9)",strokeWidth:1.8,strokeLinecap:"round"})]})},z.id)}if(z.type==="archer_shot_signature"){const Y=z.payload||{},he=Y.source,ge=Y.target,k=String(Y.phase||"travel");if(!he||!ge)return null;const U=Ve(he,G),K=Ve(ge,G),ne=Y.contactWorld&&typeof Y.contactWorld.x=="number"&&typeof Y.contactWorld.y=="number"?Y.contactWorld:{x:q,y:le},xe=k==="impact"?ne:K,Ie=xe.x-U.x,Se=xe.y-U.y,nt=Math.max(1,Math.hypot(Ie,Se)),He=Ie/nt,ze=Se/nt,Qt=String(Y.intensity||"medium");if(k==="anticipation")return m.jsxs("g",{className:"animate-arrow-shot",opacity:.95,children:[m.jsx("line",{x1:U.x,y1:U.y,x2:K.x,y2:K.y,stroke:"rgba(248,113,113,0.75)",strokeWidth:1.5,strokeDasharray:"4 5",strokeLinecap:"round"}),m.jsx("circle",{cx:K.x,cy:K.y,r:G*.18,fill:"none",stroke:"rgba(254,202,202,0.9)",strokeWidth:1.5})]},z.id);if(k==="travel"){const At=Math.min(nt*.22,G*.75),ft=xe.x-He*At,qn=xe.y-ze*At,Dt=7.5,zn=xe.x-He*Dt-ze*(Dt*.52),ct=xe.y-ze*Dt+He*(Dt*.52),Mt=xe.x-He*Dt+ze*(Dt*.52),an=xe.y-ze*Dt-He*(Dt*.52);return m.jsxs("g",{className:"animate-arrow-shot",children:[m.jsx("line",{x1:U.x,y1:U.y,x2:xe.x,y2:xe.y,stroke:"rgba(180,83,9,0.38)",strokeWidth:3.2,strokeLinecap:"round",strokeDasharray:"8 9"}),m.jsx("line",{x1:ft,y1:qn,x2:xe.x,y2:xe.y,stroke:"rgba(254,240,138,0.98)",strokeWidth:2.2,strokeLinecap:"round"}),m.jsx("path",{d:`M ${xe.x} ${xe.y} L ${zn} ${ct} M ${xe.x} ${xe.y} L ${Mt} ${an}`,stroke:"rgba(255,251,235,0.98)",strokeWidth:1.9,strokeLinecap:"round"}),m.jsx("circle",{cx:U.x,cy:U.y,r:G*.08,fill:"rgba(251,191,36,0.55)"})]},z.id)}const Le=Qt==="extreme"||Qt==="high"?G*.24:G*.19;return m.jsxs("g",{className:"animate-impact",children:[m.jsx("circle",{cx:ne.x,cy:ne.y,r:Le*1.35,fill:"rgba(251,191,36,0.14)",stroke:"rgba(254,243,199,0.72)",strokeWidth:1.4}),m.jsx("line",{x1:ne.x-He*Le*1.6,y1:ne.y-ze*Le*1.6,x2:ne.x+He*Le*1.25,y2:ne.y+ze*Le*1.25,stroke:"rgba(255,251,235,0.95)",strokeWidth:2,strokeLinecap:"round"}),m.jsx("path",{d:`M ${ne.x+He*Le*1.2} ${ne.y+ze*Le*1.2} L ${ne.x+He*Le*1.75-ze*Le*.45} ${ne.y+ze*Le*1.75+He*Le*.45} M ${ne.x+He*Le*1.2} ${ne.y+ze*Le*1.2} L ${ne.x+He*Le*1.75+ze*Le*.45} ${ne.y+ze*Le*1.75-He*Le*.45}`,stroke:"rgba(254,240,138,0.9)",strokeWidth:1.5,strokeLinecap:"round"})]},z.id)}if(z.type==="melee_lunge"||z.type==="arrow_shot"||z.type==="arcane_bolt"||z.type==="generic_line"){const Y=z.payload?.source;if(!Y)return null;const he=Ve(Y,G),ge=q-he.x,k=le-he.y,U=Math.max(1,Math.hypot(ge,k)),K=ge/U,ne=k/U,xe=q-K*Math.min(U*.18,14),Ie=le-ne*Math.min(U*.18,14),Se=z.type==="arrow_shot"?7:5,nt=q-K*Se-ne*(Se*.55),He=le-ne*Se+K*(Se*.55),ze=q-K*Se+ne*(Se*.55),Qt=le-ne*Se-K*(Se*.55);if(z.type==="melee_lunge")return m.jsxs("g",{className:"animate-melee-lunge",children:[m.jsx("line",{x1:he.x,y1:he.y,x2:xe,y2:Ie,stroke:"rgba(255,255,255,0.35)",strokeWidth:5,strokeLinecap:"round"}),m.jsx("line",{x1:xe,y1:Ie,x2:q,y2:le,stroke:"rgba(255,255,255,0.85)",strokeWidth:3,strokeLinecap:"round"})]},z.id);if(z.type==="arrow_shot"||z.type==="generic_line"){const Le=z.type==="generic_line"?"rgba(255,255,255,0.85)":"rgba(253,230,138,0.9)",At=z.type==="generic_line"?"rgba(255,255,255,0.9)":"rgba(254,243,199,0.95)";return m.jsxs("g",{className:z.type==="generic_line"?"animate-melee-lunge":"animate-arrow-shot",children:[m.jsx("line",{x1:he.x,y1:he.y,x2:q,y2:le,stroke:Le,strokeWidth:z.type==="generic_line"?2:2.5,strokeLinecap:"round",strokeDasharray:z.type==="generic_line"?"6 6":"10 8"}),m.jsx("path",{d:`M ${q} ${le} L ${nt} ${He} M ${q} ${le} L ${ze} ${Qt}`,stroke:At,strokeWidth:2,strokeLinecap:"round"})]},z.id)}return m.jsxs("g",{className:"animate-arcane-bolt",children:[m.jsx("line",{x1:he.x,y1:he.y,x2:q,y2:le,stroke:"rgba(34,211,238,0.92)",strokeWidth:4,strokeLinecap:"round",strokeDasharray:"12 10"}),m.jsx("line",{x1:he.x,y1:he.y,x2:q,y2:le,stroke:"rgba(207,250,254,0.85)",strokeWidth:1.8,strokeLinecap:"round"}),m.jsx("circle",{cx:q,cy:le,r:G*.22,fill:"rgba(34,211,238,0.35)"})]},z.id)}if(z.type==="kinetic_wave"||z.type==="generic_ring"){const Y=z.type==="kinetic_wave"?"rgba(125,211,252,0.9)":"rgba(255,255,255,0.7)",he=z.type==="kinetic_wave"?"rgba(56,189,248,0.14)":"rgba(255,255,255,0.08)";return m.jsx("g",{className:"animate-explosion-ring",children:m.jsx("circle",{cx:q,cy:le,r:G*(z.type==="kinetic_wave"?1.5:1.1),fill:he,stroke:Y,strokeWidth:z.type==="kinetic_wave"?3:2,strokeDasharray:z.type==="kinetic_wave"?"10 6":"6 4"})},z.id)}if(z.type==="wall_crack"){const Y=z.payload||{},he=Y.source,ge=Y.target,k=he&&ge?Math.atan2(Ve(ge,G).y-Ve(he,G).y,Ve(ge,G).x-Ve(he,G).x):0,U=G*.32,K=k+Math.PI/2,ne=q-Math.cos(k)*U,xe=le-Math.sin(k)*U,Ie=q+Math.cos(k)*U,Se=le+Math.sin(k)*U;return m.jsxs("g",{className:"animate-impact",children:[m.jsx("line",{x1:ne,y1:xe,x2:Ie,y2:Se,stroke:"rgba(255,255,255,0.95)",strokeWidth:2.2,strokeLinecap:"round"}),m.jsx("line",{x1:q-Math.cos(K)*U*.8,y1:le-Math.sin(K)*U*.8,x2:q+Math.cos(K)*U*.8,y2:le+Math.sin(K)*U*.8,stroke:"rgba(147,197,253,0.9)",strokeWidth:1.7,strokeLinecap:"round"}),m.jsx("circle",{cx:q,cy:le,r:3.5,fill:"rgba(255,255,255,0.9)"})]},z.id)}if(z.type==="dash_blur"){const Y=z.payload?.path;if(!Y||Y.length<2)return null;const he=Y.map(ge=>{const k=Ve(ge,G);return`${k.x},${k.y}`}).join(" ");return m.jsx("polyline",{points:he,fill:"none",stroke:"rgba(255,255,255,0.4)",strokeWidth:"8",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-arrow-shot",opacity:.6},z.id)}if(z.type==="hidden_fade")return m.jsxs("g",{className:"animate-flash",children:[m.jsx("circle",{cx:q,cy:le,r:G*.78,fill:"rgba(168,85,247,0.16)",stroke:"rgba(196,181,253,0.75)",strokeWidth:2}),m.jsx("circle",{cx:q,cy:le,r:G*.34,fill:"rgba(30,27,75,0.35)"})]},z.id);if(z.type==="impact")return P?m.jsx("image",{href:P,x:q-G*.75,y:le-G*.75,width:G*1.5,height:G*1.5,preserveAspectRatio:"xMidYMid meet",className:"animate-impact",opacity:"0.9"},z.id):m.jsx("circle",{cx:q,cy:le,r:G*.5,fill:"none",stroke:"#ffffff",strokeWidth:"2",className:"animate-impact"},z.id);if(z.type==="combat_text"){const Y=String(z.payload.text||""),he=z.payload.color||(Y.startsWith("-")?"#fb7185":"#86efac");return m.jsxs("g",{transform:`translate(${q}, ${le-10})`,children:[ee&&m.jsx("image",{href:ee,x:-46,y:-24,width:92,height:24,preserveAspectRatio:"xMidYMid meet",opacity:"0.78"}),m.jsx("text",{textAnchor:"middle",fill:he,fontSize:"16",fontWeight:"black",className:"animate-float-up",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.8))",paintOrder:"stroke",stroke:"#000",strokeWidth:"4px"},children:Y})]},z.id)}if(z.type==="flash")return m.jsx("circle",{cx:q,cy:le,r:G*2,fill:"#ffffff",className:"animate-flash"},z.id);if(z.type==="spear_trail"){const he=z.payload.path.map(ge=>{const k=Ve(ge,G);return`${k.x},${k.y}`}).join(" ");return m.jsx("polyline",{points:he,fill:"none",stroke:"#ffffff",strokeWidth:"4",strokeLinecap:"round",className:"animate-spear-trail"},z.id)}return z.type==="vaporize"?P?m.jsx("image",{href:P,x:q-G*.95,y:le-G*.95,width:G*1.9,height:G*1.9,preserveAspectRatio:"xMidYMid meet",className:"animate-vaporize",opacity:"0.9"},z.id):m.jsxs("g",{children:[m.jsx("circle",{cx:q,cy:le,r:G*.6,fill:"#f97316",className:"animate-vaporize",opacity:"0.8"}),m.jsx("circle",{cx:q,cy:le,r:G*1.2,fill:"none",stroke:"#f97316",strokeWidth:"2",className:"animate-ping"})]},z.id):z.type==="lava_ripple"?P?m.jsx("image",{href:P,x:q-G,y:le-G,width:G*2,height:G*2,preserveAspectRatio:"xMidYMid meet",className:"animate-ping",opacity:"0.85"},z.id):m.jsx("circle",{cx:q,cy:le,r:G*.8,fill:"none",stroke:"#ea580c",strokeWidth:"3",className:"animate-ping"},z.id):z.type==="explosion_ring"?P?m.jsx("image",{href:P,x:q-G*1.35,y:le-G*1.35,width:G*2.7,height:G*2.7,preserveAspectRatio:"xMidYMid meet",className:"animate-explosion-ring",opacity:"0.88"},z.id):m.jsx("circle",{cx:q,cy:le,r:G*2.5,fill:"rgba(255, 120, 0, 0.2)",stroke:"#ffaa00",strokeWidth:"4",className:"animate-explosion-ring"},z.id):null})})},am="/Hop",N0=/^[a-z0-9]+(?:[._-][a-z0-9]+)*$/,kl=/^\/assets\/[a-z0-9/_\-.]+$/,pm=["ground","decal","prop","unit","fx","ui"],R1=["svg","webp","avif","png","jpg","jpeg"],ky=["svg","webp","avif","png"],Ry=["svg","webp","avif","png","jpg","jpeg"],Ny=["svg","webp","avif","png"],Iy=["svg"],sm=(e,i)=>`${e.endsWith("/")?e:`${e}/`}${i.replace(/^\/+/,"")}`,N1=sm(am,"assets/manifest.json"),Mo=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?sm(am,e.slice(1)):e:sm(am,e),gr=e=>{if(e)return{...e,default:Mo(e.default),themes:Object.fromEntries(Object.entries(e.themes||{}).map(([i,s])=>[i,Mo(s)]))}},Ly=e=>{if(e)return{...e,scale:e.scale??e.mountainScale,offsetX:e.offsetX??e.mountainOffsetX,offsetY:e.offsetY??e.mountainOffsetY,anchorX:e.anchorX??e.mountainAnchorX,anchorY:e.anchorY??e.mountainAnchorY,crustBlendMode:e.crustBlendMode??e.mountainCrustBlendMode,crustBlendOpacity:e.crustBlendOpacity??e.mountainCrustBlendOpacity,tintColor:e.tintColor??e.mountainTintColor,tintBlendMode:e.tintBlendMode??e.mountainTintBlendMode,tintOpacity:e.tintOpacity??e.mountainTintOpacity}},I1=e=>{if(e)return{...e,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([i,s])=>[i,String(s)]))}},gu=e=>{if(e)return{detailA:gr(e.detailA),detailB:gr(e.detailB),tint:I1(e.tint)}},om=e=>{if(e)return{...e}},I0=e=>{if(!e)return;const i=Ly(e);return{...i,mountainPath:i?.mountainPath?Mo(i.mountainPath):i?.mountainPath,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([s,o])=>[s,{...Ly(o),mountainPath:o?.mountainPath?Mo(o.mountainPath):o?.mountainPath}]))}},L1=e=>{if(e)return{...e,biomeLayers:e.biomeLayers?{undercurrent:gr(e.biomeLayers.undercurrent),crust:gr(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:gu(e.biomeMaterials.undercurrent),crust:gu(e.biomeMaterials.crust)}:void 0,walls:I0(e.walls),assetOverrides:Object.fromEntries(Object.entries(e.assetOverrides||{}).map(([i,s])=>[i,{...s,mountainSettings:om(s?.mountainSettings)}]))}},B1=e=>({...e,biomeUnderlay:e.biomeUnderlay?{...e.biomeUnderlay,default:Mo(e.biomeUnderlay.default),themes:Object.fromEntries(Object.entries(e.biomeUnderlay.themes||{}).map(([i,s])=>[i,Mo(s)]))}:void 0,biomeLayers:e.biomeLayers?{undercurrent:gr(e.biomeLayers.undercurrent),crust:gr(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:gu(e.biomeMaterials.undercurrent),crust:gu(e.biomeMaterials.crust)}:void 0,walls:I0(e.walls),biomePresets:Object.fromEntries(Object.entries(e.biomePresets||{}).map(([i,s])=>[i,L1(s)||{}])),assets:e.assets.map(i=>({...i,path:Mo(i.path),mountainSettings:om(i.mountainSettings),mountainSettingsByTheme:Object.fromEntries(Object.entries(i.mountainSettingsByTheme||{}).map(([s,o])=>[s,om(o)||{}]))}))}),By={version:"1.0.0",gridTopology:"flat-top-hex",tileUnitPx:256,tileAspectRatio:1.154700538,layers:[...pm],assets:[]};let Qc=null;const Hy=e=>typeof e=="string"&&pm.includes(e),jy=e=>typeof e=="string"&&["tile","decal","prop","unit","fx","ui"].includes(e),Dy=e=>typeof e=="string"&&R1.includes(e),Oo=(e,i,s)=>{if(!e||typeof e!="object"){s.push(`"${i}" must be an object when provided.`);return}if((typeof e.default!="string"||!kl.test(e.default))&&s.push(`"${i}.default" must be a /assets/... path.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")s.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(e.themes))(typeof o!="string"||o.trim().length===0)&&s.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||!kl.test(c))&&s.push(`"${i}.themes.${o}" must be a /assets/... path.`);if(e.mode!==void 0&&e.mode!=="off"&&e.mode!=="cover"&&e.mode!=="repeat"&&s.push(`"${i}.mode" must be one of "off", "cover", or "repeat".`),e.scalePx!==void 0&&(!Number.isFinite(e.scalePx)||Number(e.scalePx)<=0)&&s.push(`"${i}.scalePx" must be > 0 when provided.`),e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&s.push(`"${i}.opacity" must be in [0, 1] when provided.`),e.seedShiftPx!==void 0&&(!Number.isFinite(e.seedShiftPx)||Number(e.seedShiftPx)<0)&&s.push(`"${i}.seedShiftPx" must be >= 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&s.push(`"${i}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&s.push(`"${i}.offsetY" must be a finite number when provided.`),e.scroll!==void 0){const o=e.scroll;!o||typeof o!="object"?s.push(`"${i}.scroll" must be an object when provided.`):(o.x!==void 0&&!Number.isFinite(o.x)&&s.push(`"${i}.scroll.x" must be a finite number.`),o.y!==void 0&&!Number.isFinite(o.y)&&s.push(`"${i}.scroll.y" must be a finite number.`),o.durationMs!==void 0&&(!Number.isFinite(o.durationMs)||Number(o.durationMs)<=0)&&s.push(`"${i}.scroll.durationMs" must be > 0 when provided.`))}},H1=(e,i,s)=>{if(!e||typeof e!="object"){s.push(`"${i}" must be an object when provided.`);return}if((typeof e.default!="string"||e.default.trim().length===0)&&s.push(`"${i}.default" must be a non-empty color string.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")s.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(e.themes))(typeof o!="string"||o.trim().length===0)&&s.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||c.trim().length===0)&&s.push(`"${i}.themes.${o}" must be a non-empty color string.`);e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&s.push(`"${i}.opacity" must be in [0, 1] when provided.`),e.blendMode!==void 0&&e.blendMode!=="normal"&&e.blendMode!=="multiply"&&e.blendMode!=="overlay"&&e.blendMode!=="soft-light"&&e.blendMode!=="screen"&&e.blendMode!=="color-dodge"&&s.push(`"${i}.blendMode" must be one of "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`)},Rl=(e,i,s)=>{if(!e||typeof e!="object"){s.push(`"${i}" must be an object when provided.`);return}e.scale!==void 0&&(!Number.isFinite(e.scale)||Number(e.scale)<=0)&&s.push(`"${i}.scale" must be > 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&s.push(`"${i}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&s.push(`"${i}.offsetY" must be a finite number when provided.`),e.anchorX!==void 0&&(!Number.isFinite(e.anchorX)||Number(e.anchorX)<0||Number(e.anchorX)>1)&&s.push(`"${i}.anchorX" must be in [0, 1] when provided.`),e.anchorY!==void 0&&(!Number.isFinite(e.anchorY)||Number(e.anchorY)<0||Number(e.anchorY)>1)&&s.push(`"${i}.anchorY" must be in [0, 1] when provided.`),e.crustBlendMode!==void 0&&e.crustBlendMode!=="off"&&e.crustBlendMode!=="normal"&&e.crustBlendMode!=="multiply"&&e.crustBlendMode!=="overlay"&&e.crustBlendMode!=="soft-light"&&e.crustBlendMode!=="screen"&&e.crustBlendMode!=="color-dodge"&&s.push(`"${i}.crustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.tintBlendMode!==void 0&&e.tintBlendMode!=="off"&&e.tintBlendMode!=="normal"&&e.tintBlendMode!=="multiply"&&e.tintBlendMode!=="overlay"&&e.tintBlendMode!=="soft-light"&&e.tintBlendMode!=="screen"&&e.tintBlendMode!=="color-dodge"&&s.push(`"${i}.tintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.crustBlendOpacity!==void 0&&(!Number.isFinite(e.crustBlendOpacity)||Number(e.crustBlendOpacity)<0||Number(e.crustBlendOpacity)>1)&&s.push(`"${i}.crustBlendOpacity" must be in [0, 1] when provided.`),e.tintOpacity!==void 0&&(!Number.isFinite(e.tintOpacity)||Number(e.tintOpacity)<0||Number(e.tintOpacity)>1)&&s.push(`"${i}.tintOpacity" must be in [0, 1] when provided.`),e.tintColor!==void 0&&(typeof e.tintColor!="string"||e.tintColor.trim().length===0)&&s.push(`"${i}.tintColor" must be a non-empty color string when provided.`)},L0=(e,i,s)=>{if(!e||typeof e!="object"){s.push(`"${i}" must be an object when provided.`);return}if(e.mode!==void 0&&e.mode!=="native"&&e.mode!=="additive"&&e.mode!=="custom"&&s.push(`"${i}.mode" must be one of "native", "additive", or "custom".`),e.interiorDensity!==void 0&&(!Number.isFinite(e.interiorDensity)||Number(e.interiorDensity)<0||Number(e.interiorDensity)>1)&&s.push(`"${i}.interiorDensity" must be in [0, 1] when provided.`),e.clusterBias!==void 0&&(!Number.isFinite(e.clusterBias)||Number(e.clusterBias)<0||Number(e.clusterBias)>1)&&s.push(`"${i}.clusterBias" must be in [0, 1] when provided.`),e.keepPerimeter!==void 0&&typeof e.keepPerimeter!="boolean"&&s.push(`"${i}.keepPerimeter" must be a boolean when provided.`),e.mountainPath!==void 0&&(typeof e.mountainPath!="string"||!kl.test(e.mountainPath))&&s.push(`"${i}.mountainPath" must be a /assets/... path when provided.`),e.mountainScale!==void 0&&(!Number.isFinite(e.mountainScale)||Number(e.mountainScale)<=0)&&s.push(`"${i}.mountainScale" must be > 0 when provided.`),e.mountainOffsetX!==void 0&&!Number.isFinite(e.mountainOffsetX)&&s.push(`"${i}.mountainOffsetX" must be a finite number when provided.`),e.mountainOffsetY!==void 0&&!Number.isFinite(e.mountainOffsetY)&&s.push(`"${i}.mountainOffsetY" must be a finite number when provided.`),e.mountainAnchorX!==void 0&&(!Number.isFinite(e.mountainAnchorX)||Number(e.mountainAnchorX)<0||Number(e.mountainAnchorX)>1)&&s.push(`"${i}.mountainAnchorX" must be in [0, 1] when provided.`),e.mountainAnchorY!==void 0&&(!Number.isFinite(e.mountainAnchorY)||Number(e.mountainAnchorY)<0||Number(e.mountainAnchorY)>1)&&s.push(`"${i}.mountainAnchorY" must be in [0, 1] when provided.`),e.mountainCrustBlendMode!==void 0&&e.mountainCrustBlendMode!=="off"&&e.mountainCrustBlendMode!=="normal"&&e.mountainCrustBlendMode!=="multiply"&&e.mountainCrustBlendMode!=="overlay"&&e.mountainCrustBlendMode!=="soft-light"&&e.mountainCrustBlendMode!=="screen"&&e.mountainCrustBlendMode!=="color-dodge"&&s.push(`"${i}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(e.mountainCrustBlendOpacity)||Number(e.mountainCrustBlendOpacity)<0||Number(e.mountainCrustBlendOpacity)>1)&&s.push(`"${i}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),e.mountainTintColor!==void 0&&(typeof e.mountainTintColor!="string"||e.mountainTintColor.trim().length===0)&&s.push(`"${i}.mountainTintColor" must be a non-empty color string when provided.`),e.mountainTintBlendMode!==void 0&&e.mountainTintBlendMode!=="off"&&e.mountainTintBlendMode!=="normal"&&e.mountainTintBlendMode!=="multiply"&&e.mountainTintBlendMode!=="overlay"&&e.mountainTintBlendMode!=="soft-light"&&e.mountainTintBlendMode!=="screen"&&e.mountainTintBlendMode!=="color-dodge"&&s.push(`"${i}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainTintOpacity!==void 0&&(!Number.isFinite(e.mountainTintOpacity)||Number(e.mountainTintOpacity)<0||Number(e.mountainTintOpacity)>1)&&s.push(`"${i}.mountainTintOpacity" must be in [0, 1] when provided.`),Rl(e,i,s),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")s.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(e.themes)){if(typeof o!="string"||o.trim().length===0){s.push(`"${i}.themes" contains an invalid theme key.`);continue}if(!c||typeof c!="object"){s.push(`"${i}.themes.${o}" must be an object.`);continue}c.mountainPath!==void 0&&(typeof c.mountainPath!="string"||!kl.test(c.mountainPath))&&s.push(`"${i}.themes.${o}.mountainPath" must be a /assets/... path when provided.`);const l=c;l.mountainScale!==void 0&&(!Number.isFinite(l.mountainScale)||Number(l.mountainScale)<=0)&&s.push(`"${i}.themes.${o}.mountainScale" must be > 0 when provided.`),l.mountainOffsetX!==void 0&&!Number.isFinite(l.mountainOffsetX)&&s.push(`"${i}.themes.${o}.mountainOffsetX" must be a finite number when provided.`),l.mountainOffsetY!==void 0&&!Number.isFinite(l.mountainOffsetY)&&s.push(`"${i}.themes.${o}.mountainOffsetY" must be a finite number when provided.`),l.mountainAnchorX!==void 0&&(!Number.isFinite(l.mountainAnchorX)||Number(l.mountainAnchorX)<0||Number(l.mountainAnchorX)>1)&&s.push(`"${i}.themes.${o}.mountainAnchorX" must be in [0, 1] when provided.`),l.mountainAnchorY!==void 0&&(!Number.isFinite(l.mountainAnchorY)||Number(l.mountainAnchorY)<0||Number(l.mountainAnchorY)>1)&&s.push(`"${i}.themes.${o}.mountainAnchorY" must be in [0, 1] when provided.`),l.mountainCrustBlendMode!==void 0&&l.mountainCrustBlendMode!=="off"&&l.mountainCrustBlendMode!=="normal"&&l.mountainCrustBlendMode!=="multiply"&&l.mountainCrustBlendMode!=="overlay"&&l.mountainCrustBlendMode!=="soft-light"&&l.mountainCrustBlendMode!=="screen"&&l.mountainCrustBlendMode!=="color-dodge"&&s.push(`"${i}.themes.${o}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),l.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(l.mountainCrustBlendOpacity)||Number(l.mountainCrustBlendOpacity)<0||Number(l.mountainCrustBlendOpacity)>1)&&s.push(`"${i}.themes.${o}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),l.mountainTintBlendMode!==void 0&&l.mountainTintBlendMode!=="off"&&l.mountainTintBlendMode!=="normal"&&l.mountainTintBlendMode!=="multiply"&&l.mountainTintBlendMode!=="overlay"&&l.mountainTintBlendMode!=="soft-light"&&l.mountainTintBlendMode!=="screen"&&l.mountainTintBlendMode!=="color-dodge"&&s.push(`"${i}.themes.${o}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),l.mountainTintOpacity!==void 0&&(!Number.isFinite(l.mountainTintOpacity)||Number(l.mountainTintOpacity)<0||Number(l.mountainTintOpacity)>1)&&s.push(`"${i}.themes.${o}.mountainTintOpacity" must be in [0, 1] when provided.`),l.mountainTintColor!==void 0&&(typeof l.mountainTintColor!="string"||l.mountainTintColor.trim().length===0)&&s.push(`"${i}.themes.${o}.mountainTintColor" must be a non-empty color string when provided.`),Rl(c,`${i}.themes.${o}`,s)}},yu=(e,i,s)=>{if(!e||typeof e!="object"){s.push(`"${i}" must be an object when provided.`);return}e.detailA!==void 0&&Oo(e.detailA,`${i}.detailA`,s),e.detailB!==void 0&&Oo(e.detailB,`${i}.detailB`,s),e.tint!==void 0&&H1(e.tint,`${i}.tint`,s),e.detailA===void 0&&e.detailB===void 0&&e.tint===void 0&&s.push(`"${i}" must define at least one of "detailA", "detailB", or "tint".`)},j1=(e,i,s)=>{if(!e||typeof e!="object"){s.push(`"${i}" must be an object when provided.`);return}if(e.seed!==void 0&&(typeof e.seed!="string"||e.seed.trim().length===0)&&s.push(`"${i}.seed" must be a non-empty string when provided.`),e.injectHazards!==void 0&&typeof e.injectHazards!="boolean"&&s.push(`"${i}.injectHazards" must be a boolean when provided.`),e.biomeLayers!==void 0){const o=e.biomeLayers;if(!o||typeof o!="object")s.push(`"${i}.biomeLayers" must be an object when provided.`);else if(o.undercurrent!==void 0&&Oo(o.undercurrent,`${i}.biomeLayers.undercurrent`,s),o.crust!==void 0&&Oo(o.crust,`${i}.biomeLayers.crust`,s),o.clutter!==void 0){const c=o.clutter;!c||typeof c!="object"?s.push(`"${i}.biomeLayers.clutter" must be an object when provided.`):(c.density!==void 0&&(!Number.isFinite(c.density)||Number(c.density)<0||Number(c.density)>1)&&s.push(`"${i}.biomeLayers.clutter.density" must be in [0, 1] when provided.`),c.maxPerHex!==void 0&&(!Number.isFinite(c.maxPerHex)||Number(c.maxPerHex)<0)&&s.push(`"${i}.biomeLayers.clutter.maxPerHex" must be >= 0 when provided.`),c.bleedScaleMax!==void 0&&(!Number.isFinite(c.bleedScaleMax)||Number(c.bleedScaleMax)<1||Number(c.bleedScaleMax)>2)&&s.push(`"${i}.biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.`),c.tags!==void 0&&(!Array.isArray(c.tags)||!c.tags.every(l=>typeof l=="string"&&l.length>0))&&s.push(`"${i}.biomeLayers.clutter.tags" must be a string array when provided.`))}}if(e.biomeMaterials!==void 0){const o=e.biomeMaterials;!o||typeof o!="object"?s.push(`"${i}.biomeMaterials" must be an object when provided.`):(o.undercurrent!==void 0&&yu(o.undercurrent,`${i}.biomeMaterials.undercurrent`,s),o.crust!==void 0&&yu(o.crust,`${i}.biomeMaterials.crust`,s))}if(e.walls!==void 0&&L0(e.walls,`${i}.walls`,s),e.assetOverrides!==void 0)if(!e.assetOverrides||typeof e.assetOverrides!="object")s.push(`"${i}.assetOverrides" must be an object when provided.`);else for(const[o,c]of Object.entries(e.assetOverrides)){if(!N0.test(o)){s.push(`"${i}.assetOverrides" contains invalid asset id "${o}".`);continue}if(!c||typeof c!="object"){s.push(`"${i}.assetOverrides.${o}" must be an object.`);continue}c.mountainSettings!==void 0&&Rl(c.mountainSettings,`${i}.assetOverrides.${o}.mountainSettings`,s)}},D1=e=>{const i=[];if(!e||typeof e!="object")return{valid:!1,errors:["Manifest is not an object."]};const s=e;if((typeof s.version!="string"||s.version.length===0)&&i.push('Missing or invalid "version".'),s.gridTopology!=="flat-top-hex"&&i.push('Only "flat-top-hex" gridTopology is supported.'),(!Number.isFinite(s.tileUnitPx)||Number(s.tileUnitPx)<=0)&&i.push('Missing or invalid "tileUnitPx".'),(!Number.isFinite(s.tileAspectRatio)||Number(s.tileAspectRatio)<=0)&&i.push('Missing or invalid "tileAspectRatio".'),s.biomeUnderlay!==void 0&&Oo(s.biomeUnderlay,"biomeUnderlay",i),s.biomeLayers!==void 0){const c=s.biomeLayers;if(!c||typeof c!="object")i.push('"biomeLayers" must be an object when provided.');else if(c.undercurrent!==void 0&&Oo(c.undercurrent,"biomeLayers.undercurrent",i),c.crust!==void 0&&Oo(c.crust,"biomeLayers.crust",i),!c.undercurrent&&!c.crust&&i.push('"biomeLayers" must define at least one of "undercurrent" or "crust".'),c.clutter!==void 0){const l=c.clutter;!l||typeof l!="object"?i.push('"biomeLayers.clutter" must be an object when provided.'):(l.density!==void 0&&(!Number.isFinite(l.density)||Number(l.density)<0||Number(l.density)>1)&&i.push('"biomeLayers.clutter.density" must be in [0, 1] when provided.'),l.maxPerHex!==void 0&&(!Number.isFinite(l.maxPerHex)||Number(l.maxPerHex)<0)&&i.push('"biomeLayers.clutter.maxPerHex" must be >= 0 when provided.'),l.bleedScaleMax!==void 0&&(!Number.isFinite(l.bleedScaleMax)||Number(l.bleedScaleMax)<1||Number(l.bleedScaleMax)>2)&&i.push('"biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.'),l.tags!==void 0&&(!Array.isArray(l.tags)||!l.tags.every(f=>typeof f=="string"&&f.length>0))&&i.push('"biomeLayers.clutter.tags" must be a string array when provided.'))}}if(s.biomeMaterials!==void 0){const c=s.biomeMaterials;!c||typeof c!="object"?i.push('"biomeMaterials" must be an object when provided.'):(c.undercurrent!==void 0&&yu(c.undercurrent,"biomeMaterials.undercurrent",i),c.crust!==void 0&&yu(c.crust,"biomeMaterials.crust",i),c.undercurrent===void 0&&c.crust===void 0&&i.push('"biomeMaterials" must define at least one of "undercurrent" or "crust".'))}if(s.walls!==void 0&&L0(s.walls,"walls",i),s.biomePresets!==void 0)if(!s.biomePresets||typeof s.biomePresets!="object")i.push('"biomePresets" must be an object when provided.');else for(const[c,l]of Object.entries(s.biomePresets)){if(typeof c!="string"||c.trim().length===0){i.push('"biomePresets" contains an invalid theme key.');continue}j1(l,`biomePresets.${c}`,i)}if(!Array.isArray(s.layers)||s.layers.length===0||!s.layers.every(Hy))i.push('Missing or invalid "layers".');else for(const c of pm)s.layers.includes(c)||i.push(`Missing required layer "${c}" in "layers".`);if(!Array.isArray(s.assets))return i.push('Missing or invalid "assets".'),{valid:i.length===0,errors:i};const o=new Set;for(const[c,l]of s.assets.entries()){const f=`assets[${c}]`;if(!l||typeof l!="object"){i.push(`${f} is not an object.`);continue}const h=l;if(typeof h.id!="string"||!N0.test(h.id)?i.push(`${f}.id is invalid; expected lowercase tokenized id.`):o.has(h.id)?i.push(`${f}.id is duplicated (${h.id}).`):o.add(h.id),jy(h.type)||i.push(`${f}.type is invalid.`),Hy(h.layer)||i.push(`${f}.layer is invalid.`),Dy(h.recommendedFormat)||i.push(`${f}.recommendedFormat is invalid.`),jy(h.type)&&Dy(h.recommendedFormat)&&((h.type==="tile"||h.type==="decal"||h.type==="prop")&&!Ry.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Ry.join(", ")} for ${h.type}.`),h.type==="ui"&&!Iy.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Iy.join(", ")} for ui.`),h.type==="unit"&&!ky.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${ky.join(", ")} for units.`),h.type==="fx"&&!Ny.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Ny.join(", ")} for fx.`)),(typeof h.path!="string"||!kl.test(h.path))&&i.push(`${f}.path is invalid; expected /assets/...`),(!Number.isFinite(h.width)||Number(h.width)<=0)&&i.push(`${f}.width must be > 0.`),(!Number.isFinite(h.height)||Number(h.height)<=0)&&i.push(`${f}.height must be > 0.`),h.mountainSettings!==void 0&&Rl(h.mountainSettings,`${f}.mountainSettings`,i),h.mountainSettingsByTheme!==void 0)if(!h.mountainSettingsByTheme||typeof h.mountainSettingsByTheme!="object")i.push(`${f}.mountainSettingsByTheme must be an object when provided.`);else for(const[b,y]of Object.entries(h.mountainSettingsByTheme)){if(typeof b!="string"||b.trim().length===0){i.push(`${f}.mountainSettingsByTheme contains an invalid theme key.`);continue}Rl(y,`${f}.mountainSettingsByTheme.${b}`,i)}}return{valid:i.length===0,errors:i}},P1=async()=>Qc||(Qc=fetch(N1).then(async e=>{if(!e.ok)throw new Error(`Asset manifest fetch failed: ${e.status}`);return e.json()}).then(e=>{const i=D1(e);return i.valid?B1(e):(console.warn("[HOP_ASSETS] Invalid manifest; using fallback.",i.errors),By)}).catch(e=>(console.warn("[HOP_ASSETS] Failed to load manifest; using fallback.",e),By)),Qc),hm=(e,i)=>{if(!e)return;const s=String(i||"").toLowerCase();if(s)return e.biomePresets?.[s]},U1=[7,11],Py=(e,i,s)=>e<i?i:e>s?s:e,q1=e=>({top:Math.max(0,Number(e?.top??0)),right:Math.max(0,Number(e?.right??0)),bottom:Math.max(0,Number(e?.bottom??0)),left:Math.max(0,Number(e?.left??0))}),gm=e=>{const i=q1(e.insets),s=Math.max(1,Number(e.width||0)-i.left-i.right),o=Math.max(1,Number(e.height||0)-i.top-i.bottom);return{width:s,height:o,insets:i}},z1=(e,i,s=0)=>{const o=Math.max(1,i),c=1.5*o,l=2*o;return(Math.max(1,e)-1)*c+l+Math.max(0,s)*2},$1=(e,i,s,o=0)=>{const c=gm(e),l=z1(i,s,o);return c.width/Math.max(1,l)},V1=(e,i)=>{const s=gm(e),o=Math.max(1,i.width),c=Math.max(1,i.height);return Math.min(s.width/o,s.height/c)},Y1=(e,i)=>({x:e.x-i,y:e.y-i,width:e.width+i*2,height:e.height+i*2}),K1=(e,i)=>{const s=Math.max(1e-6,e),o=Math.max(1e-6,i);return Math.max(s,o)},Uy=(e,i)=>{const s=gm(e),o=Math.max(1e-6,i);return{width:s.width/o,height:s.height/o}},F1=(e,i,s)=>{const o=i.width/2,c=i.height/2,l=s.x+o,f=s.x+s.width-o,h=s.y+c,b=s.y+s.height-c;return{x:l>f?s.x+s.width/2:Py(e.x,l,f),y:h>b?s.y+s.height/2:Py(e.y,h,b)}},qy=(e,i)=>({x:e.x-i.width/2,y:e.y-i.height/2,width:i.width,height:i.height}),fu=e=>{let i=2166136261;for(let s=0;s<e.length;s++)i^=e.charCodeAt(s),i=Math.imul(i,16777619);return i>>>0},gl=e=>fu(e)/4294967295,W1=e=>{const i=(e.tags||[]).map(o=>o.toLowerCase()),s=[e.id.toLowerCase(),...i];for(const o of s){const c=o.match(/(?:cluster|hex)[-_]?([123])\b/);if(c)return Number(c[1]);if(o.includes("1-hex")||o.includes("single"))return 1;if(o.includes("2-hex")||o.includes("double"))return 2;if(o.includes("3-hex")||o.includes("triple"))return 3}return 1},Jc=(e,i)=>{if(e)return i&&e.themes?.[i]?e.themes[i]:e.default},Zc=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"cover":"off",$f=e=>Math.min(1,Math.max(0,Number(e?.opacity??1))),eu=(e,i,s=64,o=Number.POSITIVE_INFINITY)=>{const c=Number(e?.scalePx||i);return Math.min(o,Math.max(s,c))},zy=e=>({x:Number(e?.scroll?.x??0),y:Number(e?.scroll?.y??0),durationMs:Math.max(1e3,Number(e?.scroll?.durationMs??18e3))}),X1=(e,i)=>{if(e)return i&&e.themes?.[i]?e.themes[i]:e.default},G1=e=>Math.min(1,Math.max(0,Number(e?.opacity??0))),B0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",H0=(e,i="#8b6f4a")=>{const s=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(s))return s.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(s)){const[l,f,h]=s.slice(1).split("");return`#${l}${l}${f}${f}${h}${h}`.toLowerCase()}return i},Q1=e=>{const s=H0(e).slice(1);return{r:parseInt(s.slice(0,2),16)/255,g:parseInt(s.slice(2,4),16)/255,b:parseInt(s.slice(4,6),16)/255}},J1=e=>e.replace(/[^a-zA-Z0-9_-]/g,"-"),$y=(e,i)=>e==="off"?"off":e?B0(e):i,Vf=e=>{const i=[];for(let s=0;s<6;s++){const o=Math.PI/180*(60*s);i.push(`${e*Math.cos(o)},${e*Math.sin(o)}`)}return i.join(" ")},tu=e=>{if(!e||typeof e.q!="number"||typeof e.r!="number"||typeof e.s!="number")return null;const{x:i,y:s}=Ve(e,G),o=Math.hypot(i,s);return!Number.isFinite(o)||o<=1e-4?null:{x:i/o,y:s/o}},nu=e=>{const i=e?.hex;if(i&&typeof i.q=="number"&&typeof i.r=="number"&&typeof i.s=="number")return i},iu=e=>{const i=e?.world;if(i&&typeof i.x=="number"&&typeof i.y=="number")return i},au=(e,i,s)=>e+(i-e)*s,Z1=e=>1-Math.pow(1-e,3),eE=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,j0=({gameState:e,onMove:i,selectedSkillId:s,showMovementRange:o,onBusyStateChange:c,assetManifest:l,biomeDebug:f,onSimulationEvents:h,onMirrorSnapshot:b,enginePreviewGhost:y,cameraSafeInsetsPx:S})=>{const[v,A]=_.useState(!1),[M,p]=_.useState(!1),[g,C]=_.useState({x:0,y:0}),[N,O]=_.useState(null),[w,R]=_.useState(!1),[Q,W]=_.useState(!1),[j,re]=_.useState([]),[pe,z]=_.useState(11),[ue,ye]=_.useState({width:0,height:0}),[q,le]=_.useState(!1),Z=_.useRef(null),P=_.useRef(null),ee=_.useRef([]),Y=_.useRef(!1),he=_.useRef([]),ge=_.useRef(0),k=_.useRef(""),U=_.useRef(null),K=_.useRef(null),ne=_.useRef(0),xe=_.useRef(0),Ie=_.useRef(null),Se=_.useRef(null),nt=_.useRef(null),He=_.useRef(null),ze=_.useRef({x:0,y:0}),Qt=_.useRef(!1),Le=_.useRef(!1),At=_.useRef(0),ft=_.useRef(new Map),qn=_.useRef({activePointerId:null,startClient:null,lastWorld:null,didPan:!1}),Dt=_.useRef(null),zn=_.useRef(null),ct=_.useRef(null),Mt=_.useRef(!1),an=_.useRef(""),Zn=_.useRef(""),vi=_.useRef(11),Si=_.useRef(!1),[wn,ya]=_.useState(!1),[Nn,dn]=_.useState([]),[Ft,Hi]=_.useState([]),[fn,ea]=_.useState(0);_.useRef(!1);const ei=_.useRef(null),sn=_.useRef(null),ke=e.player.position,ut=_.useMemo(()=>{let T=e.rooms?.[0]?.hexes;if(!T||T.length===0){T=[];for(let I=0;I<e.gridWidth;I++)for(let H=0;H<e.gridHeight;H++)T.push({q:I,r:H,s:-I-H})}return T.filter(I=>mu(I.q,I.r,e.gridWidth,e.gridHeight))},[e.rooms,e.gridWidth,e.gridHeight]);_.useEffect(()=>{},[]),_.useEffect(()=>{const T=e.visualEvents||[];if(ei.current===T)return;ei.current=T;const I=T;if(I.length===0)return;const H=Date.now(),oe=[],de=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]],me=new Map(de.map(Me=>[Me.id,Me])),ve=Me=>{if(Me){for(const qe of de)if(ae(qe.position,Me))return qe.id}},_e=(Me,qe,Ae,je,$e,Ye,Xe)=>{Me&&oe.push({id:`${qe}:${Me}:${$e}`,actorId:Me,startTime:$e,endTime:$e+Math.max(30,Ye),easing:Xe,from:Ae,to:je})};for(let Me=0;Me<I.length;Me++){const qe=I[Me];if(qe.type!=="juice_signature")continue;const Ae=qe.payload;if(!Ae||Ae.protocol!=="juice-signature/v1"||Ae.signature!=="ATK.STRIKE.PHYSICAL.BASIC_ATTACK"&&Ae.signature!=="ATK.STRIKE.PHYSICAL.AUTO_ATTACK")continue;const je=String(Ae.phase||"impact"),$e=nu(Ae.source),Ye=nu(Ae.target),Xe=String(Ae.meta?.sourceId||Ae.source?.actorId||"")||ve($e),We=Ae.target?.actorId||ve(Ye);if(!$e||!Ye||!Xe)continue;const it=Ve($e,G),Qe=Ve(Ye,G),qt=iu(Ae.contact)||Qe;let bn=qt.x-it.x,Zt=qt.y-it.y,Ot=Math.hypot(bn,Zt);if(!Number.isFinite(Ot)||Ot<.001){const Mr=tu(Ae.direction);if(Mr)bn=Mr.x,Zt=Mr.y,Ot=1;else{const Dl=Ve(Ye,G);bn=Dl.x-it.x,Zt=Dl.y-it.y,Ot=Math.max(1,Math.hypot(bn,Zt))}}const Bt=bn/Math.max(1,Ot),Tt=Zt/Math.max(1,Ot),ri=Math.max(0,Number(Ae.timing?.delayMs||0)),Dn=Math.max(40,Number(Ae.timing?.durationMs||Ae.timing?.ttlMs||110)),Ht=H+ri,Wt=String(Ae.meta?.sequenceId||`strike-${H}-${Me}`),on=String(Ae.intensity||"medium"),rn=Ae.signature==="ATK.STRIKE.PHYSICAL.AUTO_ATTACK",fi=on==="extreme"?16:on==="high"?13:on==="low"?8:11,_i=Math.min(G*(rn?.3:.46),Ot*(rn?.22:.32)),qi=Math.min(G*(rn?.55:.82),Ot*(rn?.62:.9)),ja=Math.min(G*(rn?.62:.9),Ot*(rn?.72:.98)),jl=Math.min(G*(rn?.22:.34),Ot*(rn?.24:.36));if(je==="anticipation"){_e(Xe,`${Wt}:anticipation`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:-Bt*_i,offsetY:-Tt*_i,scaleX:.92,scaleY:1.08},Ht,Dn,"out");continue}if(je==="travel"){_e(Xe,`${Wt}:travel`,{offsetX:-Bt*_i,offsetY:-Tt*_i,scaleX:.94,scaleY:1.06},{offsetX:Bt*qi,offsetY:Tt*qi,scaleX:1.09,scaleY:.93},Ht,Dn,"inOut");continue}if(je==="impact"){_e(Xe,`${Wt}:impact-src`,{offsetX:Bt*(ja*.92),offsetY:Tt*(ja*.92),scaleX:1.06,scaleY:.95},{offsetX:Bt*ja,offsetY:Tt*ja,scaleX:1.02,scaleY:.98},Ht,Dn,"out"),_e(We,`${Wt}:impact-tgt`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:Bt*fi,offsetY:Tt*fi,scaleX:1.03,scaleY:.94},Ht,Dn,"out");continue}je==="aftermath"&&(_e(Xe,`${Wt}:after-src`,{offsetX:Bt*jl,offsetY:Tt*jl,scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},Ht,Dn,"out"),_e(We,`${Wt}:after-tgt`,{offsetX:Bt*(fi*.35),offsetY:Tt*(fi*.35),scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},Ht,Dn,"out"))}for(let Me=0;Me<I.length;Me++){const qe=I[Me];if(qe.type!=="juice_signature")continue;const Ae=qe.payload;if(!Ae||Ae.protocol!=="juice-signature/v1")continue;const je=String(Ae.signature||"");if(String(Ae.phase||"impact")!=="impact")continue;const Ye=Math.max(0,Number(Ae.timing?.delayMs||0)),Xe=Math.max(45,Number(Ae.timing?.durationMs||Ae.timing?.ttlMs||110)),We=H+Ye,it=nu(Ae.source),Qe=nu(Ae.target),qt=iu(Ae.source),bn=iu(Ae.target),Zt=iu(Ae.contact),Ot=String(Ae.meta?.sourceId||Ae.source?.actorId||""),Tt=(Ot?me.get(Ot):void 0)?.id||ve(it),ri=Ae.target?.actorId||ve(Qe),Ht=(()=>{const Wt=tu(Ae.direction);if(Wt)return Wt;const on=it?Ve(it,G):qt,rn=Zt||bn||(Qe?Ve(Qe,G):void 0);if(on&&rn){const fi=rn.x-on.x,_i=rn.y-on.y,qi=Math.hypot(fi,_i);if(qi>.001)return{x:fi/qi,y:_i/qi}}return null})();if(Ht){if(je==="ATK.PULSE.KINETIC.WAVE"){_e(Tt,`${Ae.meta?.sequenceId||je}:pulse-caster`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:-Ht.x*8,offsetY:-Ht.y*8,scaleX:.96,scaleY:1.05},We,Math.max(40,Math.floor(Xe*.5)),"out"),_e(Tt,`${Ae.meta?.sequenceId||je}:pulse-caster-return`,{offsetX:-Ht.x*(8*.6),offsetY:-Ht.y*(8*.6),scaleX:.98,scaleY:1.02},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},We+Math.floor(Xe*.45),Math.max(50,Math.floor(Xe*.65)),"out"),_e(ri,`${Ae.meta?.sequenceId||je}:pulse-target`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:Ht.x*10,offsetY:Ht.y*10,scaleX:1.03,scaleY:.95},We,Xe,"out");continue}if(je.startsWith("ENV.COLLISION.KINETIC.")){const Wt=je==="ENV.COLLISION.KINETIC.SHIELD_BASH"?14:10,on=je==="ENV.COLLISION.KINETIC.SHIELD_BASH"?7:0;on>0&&_e(Tt,`${Ae.meta?.sequenceId||je}:collision-source`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:Ht.x*on,offsetY:Ht.y*on,scaleX:1.03,scaleY:.97},We,Math.max(45,Math.floor(Xe*.55)),"out"),_e(ri,`${Ae.meta?.sequenceId||je}:collision-target`,{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:Ht.x*Wt,offsetY:Ht.y*Wt,scaleX:1.02,scaleY:.92},We,Xe,"out");continue}}}oe.length>0&&(ea(H),Hi(Me=>[...Me,...oe]))},[e.visualEvents,e.player,e.enemies,e.companions,e.dyingEntities]),_.useEffect(()=>{if(typeof window>"u"||Ft.length===0)return;let T=!1;const I=()=>{if(T)return;const H=Date.now();ea(H),Hi(oe=>{const de=oe.filter(me=>H<me.endTime+16);return de.length===oe.length?oe:de}),sn.current=window.requestAnimationFrame(I)};return sn.current=window.requestAnimationFrame(I),()=>{T=!0,sn.current!==null&&(window.cancelAnimationFrame(sn.current),sn.current=null)}},[Ft.length]),_.useEffect(()=>{const T=e.visualEvents||[];if(Ie.current===T)return;Ie.current=T;const I=T;if(I.length===0)return;let H=0,oe=0,de=0,me={x:0,y:0},ve=0;const _e={low:110,medium:160,high:210,extreme:260},Me={light:6,medium:10,heavy:14},qe={light:65,medium:85,heavy:110},Ae=[],je=Qe=>{Qe<=0||(A(!0),Ae.push(window.setTimeout(()=>A(!1),Qe)))},$e=Qe=>{Qe<=0||(p(!0),Ae.push(window.setTimeout(()=>p(!1),Qe)))},Ye=(Qe,qt)=>{qt<=0||!Qe.x&&!Qe.y||(C(Qe),Ae.push(window.setTimeout(()=>C({x:0,y:0}),qt)))};for(const Qe of I){if(Qe.type==="juice_signature"){const qt=Qe.payload;if(qt?.protocol==="juice-signature/v1"){const bn=Math.max(0,Number(qt.timing?.delayMs||0)),Zt=qt.camera?.shake,Ot=Number(qt.camera?.freezeMs||0),Bt=String(qt.camera?.kick||"none"),Tt=Bt!=="none"?tu(qt.direction):null,ri=Me[Bt]||0,Dn=qe[Bt]||80;if(bn>0&&(Zt||Ot>0||Tt&&ri>0)){Ae.push(window.setTimeout(()=>{Zt&&je(_e[String(Zt)]||160),Ot>0&&$e(Math.min(220,Ot)),Tt&&ri>0&&Ye({x:Tt.x*ri,y:Tt.y*ri},Dn)},bn));continue}if(Zt&&(H=Math.max(H,_e[String(Zt)]||160)),Ot>0&&(oe=Math.max(oe,Math.min(220,Ot))),Bt!=="none"){const Ht=tu(qt.direction),Wt=Me[Bt]||0;Ht&&Wt>0&&Wt>=ve&&(ve=Wt,me={x:Ht.x*Wt,y:Ht.y*Wt},de=Math.max(de,qe[Bt]||80))}continue}}if(Qe.type==="shake"){const qt=String(Qe.payload?.intensity||"medium");H=Math.max(H,_e[qt]||160)}else Qe.type==="freeze"&&(oe=Math.max(oe,Math.min(220,Math.max(50,Number(Qe.payload?.durationMs||80)))))}let Xe,We,it;return H>0&&(A(!0),Xe=window.setTimeout(()=>A(!1),H)),oe>0&&(p(!0),We=window.setTimeout(()=>p(!1),oe)),de>0&&(me.x!==0||me.y!==0)&&(C(me),it=window.setTimeout(()=>C({x:0,y:0}),de)),()=>{Xe&&window.clearTimeout(Xe),We&&window.clearTimeout(We),it&&window.clearTimeout(it);for(const Qe of Ae)window.clearTimeout(Qe)}},[e.visualEvents]),_.useEffect(()=>{},[e.visualEvents,wn]);const et=_.useMemo(()=>{if(ut.length===0)return{minX:0,minY:0,width:100,height:100};let T=1/0,I=1/0,H=-1/0,oe=-1/0;return ut.forEach(de=>{const{x:me,y:ve}=Ve(de,G);T=Math.min(T,me-G),I=Math.min(I,ve-G),H=Math.max(H,me+G),oe=Math.max(oe,ve+G)}),{minX:T,minY:I,width:H-T,height:oe-I}},[ut]),ti=_.useMemo(()=>{const{x:T,y:I}=Ve(ke,G);return{x:T,y:I}},[ke]),mn=_.useMemo(()=>({x:et.minX,y:et.minY,width:et.width,height:et.height}),[et.minX,et.minY,et.width,et.height]),Jt=_.useCallback(()=>{He.current!==null&&(window.cancelAnimationFrame(He.current),He.current=null),Si.current=!1},[]),ta=_.useCallback(T=>{const I=Z.current;I&&I.setAttribute("viewBox",`${T.x} ${T.y} ${T.width} ${T.height}`)},[]),pn=_.useCallback(T=>{nt.current=T,ta(T.viewBox)},[ta]),In=_.useCallback(T=>{const I=Math.max(1,ue.width),H=Math.max(1,ue.height),oe=T?.zoomPreset??pe,de=T?.panOffset??ze.current,ve={width:I,height:H,insets:S||{}},_e=G*.75,Me=Y1(mn,_e),qe=$1(ve,oe,G,G*.2),Ae=V1(ve,Me),je=K1(Ae,qe),$e=Uy(ve,je),Ye={x:ti.x+de.x,y:ti.y+de.y},Xe=F1(Ye,$e,Me),We=qy(Xe,$e);return{center:Xe,scale:je,viewBox:We}},[ue.width,ue.height,pe,S,mn,ti.x,ti.y]),Ln=_.useCallback((T,I=220)=>{const H=nt.current;if(!H){pn(T);return}Jt();const oe=H.center,de=H.scale,me=T.center,ve=T.scale,_e=performance.now();Si.current=!0;const Me=Ae=>1-Math.pow(1-Ae,3),qe=Ae=>{const je=Math.min(1,(Ae-_e)/Math.max(1,I)),$e=Me(je),Ye=de+(ve-de)*$e,Xe={x:oe.x+(me.x-oe.x)*$e,y:oe.y+(me.y-oe.y)*$e},We={width:Math.max(1,ue.width),height:Math.max(1,ue.height),insets:S||{}},it=Uy(We,Ye),Qe=qy(Xe,it);pn({center:Xe,scale:Ye,viewBox:Qe}),je<1?He.current=window.requestAnimationFrame(qe):(He.current=null,Si.current=!1,pn(T))};He.current=window.requestAnimationFrame(qe)},[Jt,pn,ue.width,ue.height,S]),Nt=_.useCallback(T=>{Jt(),pn(In(T))},[Jt,pn,In]),hn=_.useCallback(T=>{const I=In(T);Ln(I,T?.durationMs??220)},[Ln,In]);_.useEffect(()=>{const T=P.current;if(!T)return;const I=()=>{const oe=T.getBoundingClientRect();ye(de=>{const me=Math.round(oe.width),ve=Math.round(oe.height);return de.width===me&&de.height===ve?de:{width:me,height:ve}})};if(I(),typeof ResizeObserver>"u")return window.addEventListener("resize",I),()=>window.removeEventListener("resize",I);const H=new ResizeObserver(()=>I());return H.observe(T),()=>H.disconnect()},[]),_.useEffect(()=>{if(ue.width<=0||ue.height<=0)return;const T=`${mn.x}:${mn.y}:${mn.width}:${mn.height}`,I=`${ue.width}:${ue.height}:${S?.top??0}:${S?.right??0}:${S?.bottom??0}:${S?.left??0}`,H=Te(e.player.position);if(!Mt.current){Mt.current=!0,zn.current=H,ct.current=e.floor??null,an.current=I,Zn.current=T,vi.current=pe,Nt({panOffset:{x:0,y:0}});return}if((e.floor??null)!==ct.current){ct.current=e.floor??null,Zn.current=T,an.current=I,zn.current=H,vi.current=pe,ze.current={x:0,y:0},Nt({panOffset:{x:0,y:0}});return}if(e.floor!==void 0&&T!==Zn.current){Zn.current=T,an.current=I,zn.current=H,vi.current=pe,ze.current={x:0,y:0},Nt({panOffset:{x:0,y:0}});return}if(I!==an.current){an.current=I,Zn.current=T,Nt();return}if(pe!==vi.current){vi.current=pe,hn();return}if(H!==zn.current){zn.current=H;const oe={x:0,y:0};ze.current=oe,hn({panOffset:oe,durationMs:210});return}},[ue.width,ue.height,mn.x,mn.y,mn.width,mn.height,S,e.floor,e.player.position,pe,Nt,hn]);const Bn=nt.current?.viewBox||mn,na=_.useMemo(()=>{const T={};for(const I of e.visualEvents||[]){if(I.type!=="kinetic_trace")continue;const H=I.payload;H?.actorId&&(T[H.actorId]=H)}return T},[e.visualEvents]),ba=_.useMemo(()=>{if(!o||s)return[];const T=["BASIC_MOVE","DASH"],I=new Set(e.player.activeSkills.map(de=>de.id)),H=new Set,oe=[];for(const de of T){if(!I.has(de))continue;const me=Un.get(de);if(!me?.getValidTargets)continue;const ve=me.getValidTargets(e,ke);for(const _e of ve){const Me=Te(_e);H.has(Me)||(H.add(Me),oe.push(_e))}}return oe},[o,s,e,ke]),Ai=_.useMemo(()=>{const T=new Set;for(const I of ba)T.add(Te(I));return T},[ba]),ji=_.useMemo(()=>e.player.activeSkills.some(T=>T.id==="BASIC_MOVE"||T.id==="DASH"),[e.player.activeSkills]),Di=_.useMemo(()=>Te(e.stairsPosition),[e.stairsPosition]),xa=_.useMemo(()=>e.shrinePosition?Te(e.shrinePosition):null,[e.shrinePosition]),ka=_.useMemo(()=>{const T=[{q:ke.q+1,r:ke.r,s:ke.s-1},{q:ke.q+1,r:ke.r-1,s:ke.s},{q:ke.q,r:ke.r-1,s:ke.s+1},{q:ke.q-1,r:ke.r,s:ke.s+1},{q:ke.q-1,r:ke.r+1,s:ke.s},{q:ke.q,r:ke.r+1,s:ke.s-1}],I=new Set;for(const H of T)mu(H.q,H.r,e.gridWidth,e.gridHeight)&&I.add(Te(H));return I},[ke,e.gridWidth,e.gridHeight]),$s=_.useMemo(()=>{const T=new Set;if(!s)return T;const I=Un.get(s);if(!I?.getValidTargets)return T;const H=I.getValidTargets(e,ke);for(const oe of H)T.add(Te(oe));return T},[s,e,ke]),Vs=_.useMemo(()=>{if(y)return y;if(!N)return null;const T=Te(N);if(o&&!s)return Ai.has(T)||!ji&&ka.has(T)?{path:Kt(ke,N),aoe:[],hasEnemy:!1,target:N}:null;if(!s)return null;const I=e.player.activeSkills.find(me=>me.id===s),H=KT(e,{actorId:e.player.id,skillId:s,target:N,activeUpgrades:I?.activeUpgrades||[]});if(!H.ok)return null;const oe=new Map;for(const me of H.simulationEvents)me.position&&(me.type!=="DamageTaken"&&me.type!=="StatusApplied"&&me.type!=="UnitMoved"||oe.set(Te(me.position),me.position));const de=H.simulationEvents.some(me=>(me.type==="DamageTaken"||me.type==="StatusApplied")&&!!me.targetId&&me.targetId!==e.player.id);return{path:Kt(ke,N),aoe:[...oe.values()],hasEnemy:de,target:N}},[y,N,o,s,Ai,ji,ka,e,ke]),ni=_.useMemo(()=>{const T=new Map;for(const I of ut){const H=Te(I),oe=Ze.getTraitsAt(e,I),de=oe.has("BLOCKS_MOVEMENT")&&oe.has("BLOCKS_LOS"),me=oe.has("LAVA")||oe.has("HAZARDOUS")&&oe.has("LIQUID"),ve=oe.has("FIRE");T.set(H,{isWall:de,isLava:!de&&me,isFire:!de&&ve})}return T},[ut,e.tiles]),gn=_.useMemo(()=>{const T=new Map;for(const I of l?.assets||[])T.set(I.id,I);return T},[l]),ii=_.useMemo(()=>gn.get(y1())?.path,[gn]),X=_.useMemo(()=>Math.max(1,l?.tileUnitPx||256),[l?.tileUnitPx]),se=_.useMemo(()=>G*2/X,[X]),fe=_.useMemo(()=>String(e.theme||"").toLowerCase(),[e.theme]),we=_.useMemo(()=>`${e.initialSeed||e.rngSeed||e.turnNumber}:${e.floor}:${fe}`,[e.initialSeed,e.rngSeed,e.turnNumber,e.floor,fe]),Oe=_.useMemo(()=>hm(l,fe),[l,fe]),mt=_.useMemo(()=>{const T=l?.biomeUnderlay;if(T)return{default:T.default,themes:T.themes,mode:T.mode,scalePx:T.scalePx,opacity:T.opacity}},[l?.biomeUnderlay]),Ke=_.useMemo(()=>Oe?.biomeLayers?.undercurrent||l?.biomeLayers?.undercurrent,[Oe?.biomeLayers?.undercurrent,l?.biomeLayers?.undercurrent]),pt=_.useMemo(()=>Oe?.biomeLayers?.crust||l?.biomeLayers?.crust||mt,[Oe?.biomeLayers?.crust,l?.biomeLayers?.crust,mt]),It=_.useMemo(()=>Oe?.biomeLayers?.clutter||l?.biomeLayers?.clutter,[Oe?.biomeLayers?.clutter,l?.biomeLayers?.clutter]),yt=_.useMemo(()=>Jc(Ke,fe),[Ke,fe]),Lt=_.useMemo(()=>Zc(Ke),[Ke]),Mn=_.useMemo(()=>eu(Ke,X,64,192),[Ke,X]),Ti=_.useMemo(()=>$f(Ke),[Ke]),Pt=_.useMemo(()=>({x:Number(Ke?.scroll?.x??120),y:Number(Ke?.scroll?.y??90),durationMs:Math.max(1e3,Number(Ke?.scroll?.durationMs??92e3))}),[Ke?.scroll?.x,Ke?.scroll?.y,Ke?.scroll?.durationMs]),$n=_.useMemo(()=>({x:Number(Ke?.offsetX??0)+Number(f?.undercurrentOffset?.x??0),y:Number(Ke?.offsetY??0)+Number(f?.undercurrentOffset?.y??0)}),[Ke?.offsetX,Ke?.offsetY,f?.undercurrentOffset?.x,f?.undercurrentOffset?.y]),va=_.useMemo(()=>Jc(pt,fe),[pt,fe]),Ei=_.useMemo(()=>Zc(pt),[pt]),ai=_.useMemo(()=>eu(pt,X,64),[pt,X]),Nl=1,Ys=_.useMemo(()=>{const T=Math.max(0,Number(pt?.seedShiftPx??G*5));if(T===0)return{x:0,y:0};const I=fu(`${we}|crust-offset`),H=((I&65535)/65535*2-1)*T,oe=((I>>>16&65535)/65535*2-1)*T;return{x:H,y:oe}},[pt?.seedShiftPx,we]),Ks=_.useMemo(()=>({x:Number(pt?.offsetX??0)+Number(f?.crustOffset?.x??0),y:Number(pt?.offsetY??0)+Number(f?.crustOffset?.y??0)}),[pt?.offsetX,pt?.offsetY,f?.crustOffset?.x,f?.crustOffset?.y]),Hn=_.useMemo(()=>({x:Ys.x+Ks.x,y:Ys.y+Ks.y}),[Ys.x,Ys.y,Ks.x,Ks.y]),yn=_.useMemo(()=>l?.walls,[l?.walls]),jn=_.useMemo(()=>Oe?.walls||yn?.themes?.[fe],[Oe?.walls,yn?.themes,fe]),Gn=_.useMemo(()=>Oe?.biomeMaterials?.crust||l?.biomeMaterials?.crust,[Oe?.biomeMaterials?.crust,l?.biomeMaterials?.crust]),$t=_.useMemo(()=>Gn?.detailA,[Gn?.detailA]),si=_.useMemo(()=>Gn?.detailB,[Gn?.detailB]),Ra=_.useMemo(()=>Jc($t,fe),[$t,fe]),ia=_.useMemo(()=>Jc(si,fe),[si,fe]),os=_.useMemo(()=>Zc($t),[$t]),Sa=_.useMemo(()=>Zc(si),[si]),Ro=_.useMemo(()=>eu($t,ai,64),[$t,ai]),Vn=_.useMemo(()=>eu(si,ai,64),[si,ai]),Aa=_.useMemo(()=>$f($t),[$t]),Na=_.useMemo(()=>$f(si),[si]),Ia=_.useMemo(()=>zy($t),[$t?.scroll?.x,$t?.scroll?.y,$t?.scroll?.durationMs]),Pi=_.useMemo(()=>zy(si),[si?.scroll?.x,si?.scroll?.y,si?.scroll?.durationMs]),Fs=_.useMemo(()=>{const T=G*.75,I=fu(`${we}|crust-detail-a-offset`),H=((I&65535)/65535*2-1)*T,oe=((I>>>16&65535)/65535*2-1)*T;return{x:H,y:oe}},[we]),Ws=_.useMemo(()=>{const T=G*.75,I=fu(`${we}|crust-detail-b-offset`),H=((I&65535)/65535*2-1)*T,oe=((I>>>16&65535)/65535*2-1)*T;return{x:H,y:oe}},[we]),On=_.useMemo(()=>({x:Hn.x+Fs.x,y:Hn.y+Fs.y}),[Hn.x,Hn.y,Fs.x,Fs.y]),di=_.useMemo(()=>({x:Hn.x+Ws.x,y:Hn.y+Ws.y}),[Hn.x,Hn.y,Ws.x,Ws.y]),La=_.useMemo(()=>Gn?.tint,[Gn?.tint]),rs=_.useMemo(()=>X1(La,fe),[La,fe]),ls=_.useMemo(()=>G1(La),[La?.opacity]),No=_.useMemo(()=>B0(La?.blendMode),[La?.blendMode]),Xs=!!(rs&&ls>0),Gs=_.useMemo(()=>Xs?Math.min(.55,Math.max(.15,ls*.9)):0,[Xs,ls]),oi=_.useCallback(T=>{const I=T?.mountainSettings,H=T?.mountainSettingsByTheme?.[fe],de=(T?Oe?.assetOverrides?.[T.id]:void 0)?.mountainSettings,me=Math.min(3,Math.max(.2,Number(f?.mountainScale??de?.scale??H?.scale??jn?.scale??yn?.scale??I?.scale??.95))),ve=Number(f?.mountainOffset?.x??de?.offsetX??H?.offsetX??jn?.offsetX??yn?.offsetX??I?.offsetX??0),_e=Number(f?.mountainOffset?.y??de?.offsetY??H?.offsetY??jn?.offsetY??yn?.offsetY??I?.offsetY??0),Me=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.x??de?.anchorX??H?.anchorX??jn?.anchorX??yn?.anchorX??I?.anchorX??.5))),qe=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.y??de?.anchorY??H?.anchorY??jn?.anchorY??yn?.anchorY??I?.anchorY??.78))),Ae=$y(f?.mountainCrustBlendMode??de?.crustBlendMode??H?.crustBlendMode??jn?.crustBlendMode??yn?.crustBlendMode??I?.crustBlendMode,No),je=Math.min(1,Math.max(0,Number(f?.mountainCrustBlendOpacity??de?.crustBlendOpacity??H?.crustBlendOpacity??jn?.crustBlendOpacity??yn?.crustBlendOpacity??I?.crustBlendOpacity??Gs))),$e=H0(String(f?.mountainTintColor??de?.tintColor??H?.tintColor??jn?.tintColor??yn?.tintColor??I?.tintColor??rs??"#8b6f4a")),Ye=$y(f?.mountainTintBlendMode??de?.tintBlendMode??H?.tintBlendMode??jn?.tintBlendMode??yn?.tintBlendMode??I?.tintBlendMode,"soft-light"),Xe=Math.min(1,Math.max(0,Number(f?.mountainTintOpacity??de?.tintOpacity??H?.tintOpacity??jn?.tintOpacity??yn?.tintOpacity??I?.tintOpacity??0))),We=Q1($e);return{scale:me,offsetX:ve,offsetY:_e,anchorX:Me,anchorY:qe,crustBlendMode:Ae,crustBlendOpacity:je,tintColor:$e,tintBlendMode:Ye,tintOpacity:Xe,tintMatrixValues:`0 0 0 0 ${We.r.toFixed(4)} 0 0 0 0 ${We.g.toFixed(4)} 0 0 0 0 ${We.b.toFixed(4)} 0 0 0 1 0`}},[fe,f?.mountainScale,f?.mountainOffset?.x,f?.mountainOffset?.y,f?.mountainAnchor?.x,f?.mountainAnchor?.y,f?.mountainCrustBlendMode,f?.mountainCrustBlendOpacity,f?.mountainTintColor,f?.mountainTintBlendMode,f?.mountainTintOpacity,Oe?.assetOverrides,yn,jn,No,rs,Gs]),yr=!!(Ra&&os!=="off"&&Aa>0||ia&&Sa!=="off"&&Na>0||Xs),br=!!(yt&&Lt!=="off"||va&&Ei!=="off"||yr),Ba=_.useMemo(()=>`biome-undercurrent-${e.floor}`,[e.floor]),Ha=_.useMemo(()=>`biome-crust-${e.floor}`,[e.floor]),aa=_.useMemo(()=>`biome-crust-mask-${e.floor}`,[e.floor]),Io=_.useMemo(()=>`biome-crust-detail-a-${e.floor}`,[e.floor]),xr=_.useMemo(()=>`biome-crust-detail-b-${e.floor}`,[e.floor]),Qs=!!(va&&Ei!=="off"||Ra&&os!=="off"&&Aa>0||ia&&Sa!=="off"&&Na>0||Xs),sa=_.useMemo(()=>{const T=[];for(const I of ut){const H=Te(I),oe=ni.get(H);if(!oe||!oe.isLava&&!oe.isFire)continue;const{x:de,y:me}=Ve(I,G);T.push({key:H,x:de,y:me})}return T},[ut,ni]),Lo=_.useMemo(()=>{const T=_y({isStairs:!0});return T?gn.get(T):void 0},[gn]),cs=_.useMemo(()=>{const T=_y({isShrine:!0});return T?gn.get(T):void 0},[gn]),Ui=_.useMemo(()=>{const T=[];return e.stairsPosition&&T.push({id:`stairs-${Te(e.stairsPosition)}`,kind:"stairs",position:e.stairsPosition,asset:Lo}),e.shrinePosition&&T.push({id:`shrine-${Te(e.shrinePosition)}`,kind:"shrine",position:e.shrinePosition,asset:cs}),T},[e.stairsPosition,e.shrinePosition,Lo,cs]),Ta=_.useMemo(()=>{const I=(l?.assets||[]).filter(me=>{if(me.type!=="prop")return!1;const ve=me.id.toLowerCase(),_e=new Set((me.tags||[]).map(Ae=>Ae.toLowerCase()));if(!(ve.includes("mountain")||_e.has("mountain")))return!1;if(!me.theme)return!0;const qe=me.theme.toLowerCase();return qe===fe||qe==="core"}).sort((me,ve)=>me.id.localeCompare(ve.id)),H=String(jn?.mountainPath||yn?.mountainPath||"").trim(),oe=String(f?.mountainAssetPath||H).trim();if(!oe)return I;const de=I.find(me=>me.path===oe);return de?[de]:[]},[l?.assets,fe,f?.mountainAssetPath,yn?.mountainPath,jn?.mountainPath]),us=_.useMemo(()=>{const T=new Map;for(const I of Ta)T.set(I.id,oi(I));return T},[Ta,oi]),Js=_.useMemo(()=>{if(!Ta.length)return[];const T=Ta.filter(oe=>W1(oe)===1),I=T.length?T:Ta,H=ut.filter(oe=>ni.get(Te(oe))?.isWall).sort((oe,de)=>Te(oe).localeCompare(Te(de)));return H.length?H.map(oe=>{const de=Te(oe),me=Math.floor(gl(`${we}|mountain-tile|${de}|asset`)*I.length)%I.length,ve=I[me],_e=us.get(ve.id)||oi(ve),{y:Me}=Ve(oe,G);return{id:`mountain-${de}-${ve.id}`,kind:"mountain",position:oe,asset:ve,renderScale:_e.scale,zAnchorY:Me+G*.42+_e.offsetY}}):[]},[Ta,ut,ni,we,us,oi]),Ea=_.useMemo(()=>{const T=new Set((It?.tags?.length?It.tags:["clutter","obstacle"]).map(I=>I.toLowerCase()));return(l?.assets||[]).filter(I=>{if(I.type!=="prop"&&I.type!=="decal"||I.id.toLowerCase().includes("mountain"))return!1;const oe=(I.tags||[]).map(de=>de.toLowerCase());return oe.includes("mountain")||!oe.some(de=>T.has(de))?!1:I.theme?I.theme.toLowerCase()===fe||I.theme.toLowerCase()==="core":!0})},[l?.assets,It?.tags,fe]),Zs=_.useMemo(()=>{if(!Ea.length)return[];const T=Math.min(.6,Math.max(0,Number(It?.density??.08))),I=Math.max(1,Math.floor(Number(It?.maxPerHex??1))),H=Math.min(2,Math.max(1,Number(It?.bleedScaleMax??2))),oe=[];for(const de of ut){const me=Te(de),ve=ni.get(me);if(ve?.isWall||ve?.isLava||ve?.isFire)continue;const{y:_e}=Ve(de,G);for(let Me=0;Me<I;Me++){if(gl(`${we}|clutter|${me}|slot:${Me}|roll`)>T/(Me+1))continue;const Ae=Math.floor(gl(`${we}|clutter|${me}|slot:${Me}|pick`)*Ea.length)%Ea.length,je=Ea[Ae],$e=1+gl(`${we}|clutter|${me}|slot:${Me}|scale`)*(H-1),Ye=(gl(`${we}|clutter|${me}|slot:${Me}|depth`)-.5)*G*.28;oe.push({id:`clutter-${me}-${Me}-${je.id}`,kind:"clutter",position:de,asset:je,renderScale:$e,zAnchorY:_e+Ye})}}return oe},[ut,ni,Ea,It?.density,It?.maxPerHex,It?.bleedScaleMax,we]),Il=_.useMemo(()=>{const T=[...Js,...Zs];for(const I of Ui){const{y:H}=Ve(I.position,G),oe=I.kind==="shrine";T.push({id:I.id,kind:I.kind,position:I.position,asset:I.asset,renderScale:Math.min(2,oe?1.5:1.42),zAnchorY:H+(oe?G*.32:G*.28),fallback:I.kind})}return T.sort((I,H)=>I.zAnchorY===H.zAnchorY?I.id.localeCompare(H.id):I.zAnchorY-H.zAnchorY),T},[Js,Zs,Ui]),Qn=_.useMemo(()=>{const T=new Set;for(const I of Js)T.add(Te(I.position));return T},[Js]),oa=_.useCallback(T=>{if(!T)return null;const I=T.position||T.destination||T.origin||T.target;return I&&typeof I.q=="number"&&typeof I.r=="number"&&typeof I.s=="number"?I:null},[]);_.useEffect(()=>{if(!ii)return;const T=e.timelineEvents||[],I=e.visualEvents||[];if(U.current===T&&K.current===I)return;const H=U.current===T?[]:T;U.current=T;const oe=K.current===I?[]:I;K.current=I;const de=[],me=Date.now();for(const ve of H){if(ve.phase!=="DEATH_RESOLVE")continue;const _e=oa(ve.payload);_e&&de.push({id:`decal-tl-${ve.id}-${me}-${de.length}`,position:_e,href:ii,createdAt:me})}for(const ve of oe){if(ve.type!=="vfx")continue;const _e=ve.payload?.type;if(_e!=="vaporize"&&_e!=="explosion_ring")continue;const Me=oa(ve.payload);Me&&de.push({id:`decal-vx-${_e}-${me}-${de.length}`,position:Me,href:ii,createdAt:me})}de.length>0&&re(ve=>[...ve,...de].slice(-80))},[e.timelineEvents,e.visualEvents,ii,oa]),_.useEffect(()=>{const T=e.simulationEvents||[];T.length<ne.current&&(ne.current=0);const I=T.slice(ne.current);ne.current=T.length,I.length>0&&h?.(I)},[e.simulationEvents,h]),_.useEffect(()=>{const T=e.simulationEvents||[];T.length<xe.current&&(xe.current=0);const I=T.slice(xe.current);if(xe.current=T.length,I.length===0)return;const H=Date.now(),oe=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]],de=new Map(oe.map(_e=>[_e.id,_e])),me=[],ve=(_e,Me,qe,Ae,je,$e)=>{_e&&me.push({id:`${Me}:${_e}:${je}`,actorId:_e,startTime:je,endTime:je+Math.max(35,$e),easing:"out",from:qe,to:Ae})};for(const _e of I){if(_e.type!=="DamageTaken")continue;const Me=String(_e.targetId||""),qe=Me?de.get(Me):void 0;if(!qe)continue;const Ae=_e.payload||{},je=String(Ae.reason||"").toLowerCase(),$e=String(Ae.sourceId||"");if(!$e||!je||je.includes("basic_attack"))continue;const Ye=de.get($e);if(!(je.includes("spear")||je.includes("multi_shoot")||je.includes("withdrawal")||Ye?.subtype==="archer"&&!je.includes("crush")))continue;const We=Ye?Ve(Ye.position,G):void 0,it=Ve(qe.position,G);let Qe=0,qt=1;if(We){const Ot=it.x-We.x,Bt=it.y-We.y,Tt=Math.hypot(Ot,Bt);Tt>.001&&(Qe=Ot/Tt,qt=Bt/Tt)}const bn=Ye?.subtype==="archer"?10:8,Zt=100;ve(qe.id,"projectile-hit",{offsetX:0,offsetY:0,scaleX:1,scaleY:1},{offsetX:Qe*bn,offsetY:qt*bn,scaleX:1.02,scaleY:.95},H,Zt),ve(qe.id,"projectile-hit-return",{offsetX:Qe*(bn*.35),offsetY:qt*(bn*.35),scaleX:1.01,scaleY:.99},{offsetX:0,offsetY:0,scaleX:1,scaleY:1},H+Math.floor(Zt*.5),130)}me.length>0&&(ea(H),Hi(_e=>[..._e,...me]))},[e.simulationEvents,e.player,e.enemies,e.companions,e.dyingEntities]),_.useEffect(()=>{if(j.length===0)return;const T=12e3,I=window.setTimeout(()=>{const H=Date.now();re(oe=>oe.filter(de=>H-de.createdAt<T))},1e3);return()=>window.clearTimeout(I)},[j]);const ra=_.useCallback((T,I)=>{const H=Z.current;if(!H||!H.getScreenCTM)return null;const oe=H.getScreenCTM();if(!oe)return null;const de=H.createSVGPoint();de.x=T,de.y=I;const me=de.matrixTransform(oe.inverse());return{x:me.x,y:me.y}},[]),ds=_.useCallback(T=>{const I={x:ze.current.x+T.x,y:ze.current.y+T.y};ze.current=I,Jt(),pn(In({panOffset:I}))},[Jt,pn,In]),eo=_.useCallback(T=>{z(I=>I===T?I:T)},[]),vr=_.useCallback(()=>{ze.current={x:0,y:0},hn({panOffset:{x:0,y:0},durationMs:220})},[hn]),Sr=_.useCallback(T=>{Date.now()<At.current||i(T)},[i]),to=_.useCallback(T=>{Qt.current||Le.current||O(T)},[]),la=_.useCallback(()=>Array.from(ft.current.entries()),[]),Ll=_.useCallback(T=>{if(T.pointerType==="mouse"&&T.button!==0)return;if(ft.current.set(T.pointerId,{x:T.clientX,y:T.clientY}),T.pointerType!=="mouse")try{T.currentTarget.setPointerCapture(T.pointerId)}catch{}const I=la();if(I.length>=2){Le.current=!0,Qt.current=!1,le(!1),qn.current.didPan=!0,At.current=Date.now()+250;const[H,oe]=I,de=H[1].x-oe[1].x,me=H[1].y-oe[1].y;Dt.current={startDistance:Math.hypot(de,me),startPreset:pe,appliedPreset:pe};return}qn.current={activePointerId:T.pointerId,startClient:{x:T.clientX,y:T.clientY},lastWorld:ra(T.clientX,T.clientY),didPan:!1}},[ra,la,pe]),Au=_.useCallback(T=>{if(!ft.current.has(T.pointerId))return;ft.current.set(T.pointerId,{x:T.clientX,y:T.clientY});const I=la();if(Le.current||I.length>=2){if(I.length>=2){Le.current=!0;const[qe,Ae]=I,je=qe[1].x-Ae[1].x,$e=qe[1].y-Ae[1].y,Ye=Math.max(1,Math.hypot(je,$e));if(!Dt.current)Dt.current={startDistance:Ye,startPreset:pe,appliedPreset:pe};else{const Xe=Ye/Math.max(1,Dt.current.startDistance);let We=Dt.current.startPreset;Xe>1.08&&(We=7),Xe<.92&&(We=11),We!==Dt.current.appliedPreset&&(Dt.current.appliedPreset=We,eo(We))}At.current=Date.now()+250,T.preventDefault()}return}const H=qn.current;if(!H.startClient||H.activePointerId!==T.pointerId)return;const oe=T.clientX-H.startClient.x,de=T.clientY-H.startClient.y,me=Math.hypot(oe,de);if(!H.didPan&&me>10&&(H.didPan=!0,Qt.current=!0,le(!0),At.current=Date.now()+250,O(null)),!H.didPan)return;const _e=ra(T.clientX,T.clientY);if(!H.lastWorld||!_e)return;const Me={x:H.lastWorld.x-_e.x,y:H.lastWorld.y-_e.y};H.lastWorld=_e,ds(Me),T.preventDefault()},[ra,la,eo,ds,pe]),Bo=_.useCallback(T=>{ft.current.delete(T);const I=la();I.length<2&&(Le.current=!1,Dt.current=null);const H=qn.current;H.activePointerId===T&&(H.didPan&&(At.current=Date.now()+250),qn.current={activePointerId:I[0]?.[0]??null,startClient:I[0]?{...I[0][1]}:null,lastWorld:I[0]?ra(I[0][1].x,I[0][1].y):null,didPan:!1}),ft.current.size===0&&(Qt.current=!1,le(!1))},[ra,la]),Tu=_.useCallback(T=>{Bo(T.pointerId);try{T.currentTarget.releasePointerCapture(T.pointerId)}catch{}},[Bo]),Ar=_.useCallback(T=>{Bo(T.pointerId)},[Bo]),Eu=_.useCallback(T=>{if((T.ctrlKey||T.deltaY!==0)&&T.preventDefault(),Math.abs(T.deltaY)<.1)return;const I=T.deltaY<0?7:11;eo(I),At.current=Date.now()+120},[eo]);_.useEffect(()=>{c?.(w||Q)},[w,Q,c]);const Ho=_.useMemo(()=>{const T=new Map;T.set(e.player.id,e.player.position);for(const I of e.enemies)T.set(I.id,I.position);for(const I of e.companions||[])T.set(I.id,I.position);for(const I of e.dyingEntities||[])T.set(I.id,I.position);return T},[e.player.id,e.player.position,e.enemies,e.companions,e.dyingEntities]),_u=_.useMemo(()=>[{id:e.player.id,position:e.player.position,subtype:e.player.subtype||"player",assetHref:gn.get(Ds(e.player))?.path,fallbackAssetHref:vo(e.player)},...e.enemies.map(T=>({id:T.id,position:T.position,subtype:T.subtype,assetHref:gn.get(Ds(T))?.path,fallbackAssetHref:vo(T)})),...(e.companions||[]).map(T=>({id:T.id,position:T.position,subtype:T.subtype,assetHref:gn.get(Ds(T))?.path,fallbackAssetHref:vo(T)})),...(e.dyingEntities||[]).map(T=>({id:T.id,position:T.position,subtype:T.subtype,assetHref:gn.get(Ds(T))?.path,fallbackAssetHref:vo(T)}))],[gn,e.player,e.enemies,e.companions,e.dyingEntities]),Tr=_.useMemo(()=>{const T=new Map,I=fn||Date.now();for(const H of Ft){if(I<H.startTime||I>H.endTime)continue;const oe=Math.max(1,H.endTime-H.startTime),de=Math.max(0,Math.min(1,(I-H.startTime)/oe)),me=H.easing==="inOut"?eE(de):Z1(de),ve={offsetX:au(H.from.offsetX,H.to.offsetX,me),offsetY:au(H.from.offsetY,H.to.offsetY,me),scaleX:au(H.from.scaleX,H.to.scaleX,me),scaleY:au(H.from.scaleY,H.to.scaleY,me)},_e=T.get(H.actorId);if(!_e){T.set(H.actorId,ve);continue}T.set(H.actorId,{offsetX:(_e.offsetX??0)+(ve.offsetX??0),offsetY:(_e.offsetY??0)+(ve.offsetY??0),scaleX:(_e.scaleX??1)*(ve.scaleX??1),scaleY:(_e.scaleY??1)*(ve.scaleY??1)})}return T},[Ft,fn]);_.useEffect(()=>{if(!b)return;const T={turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:[...Ho.entries()].map(([I,H])=>({id:I,position:{q:H.q,r:H.r,s:H.s}}))};b(T)},[b,e.turnNumber,e.stackTrace,Ho]);const no=_.useMemo(()=>(e.visualEvents||[]).filter(T=>T.type==="kinetic_trace").map(T=>T.payload).filter(T=>{if(!T?.actorId||!T.origin||!T.destination)return!1;const I=Ho.get(T.actorId);return!!I&&Te(I)===Te(T.destination)}),[e.visualEvents,Ho]),io=_.useMemo(()=>{if(!no.length)return"";const T=e.turnNumber??0,I=no.map(H=>{const oe=(H.path||[]).map(de=>`${de.q},${de.r},${de.s}`).join(">");return[H.actorId,`${H.origin.q},${H.origin.r},${H.origin.s}`,`${H.destination.q},${H.destination.r},${H.destination.s}`,H.movementType||"slide",H.startDelayMs||0,H.durationMs||0,oe].join("|")}).join("||");return`${T}::${I}`},[no,e.turnNumber]),Er=_.useCallback(async(T,I,H,oe)=>{if(oe!==ge.current)return;const de=T.animate(I,{...H,fill:H.fill??"forwards"});he.current.push(de);try{await de.finished}catch{}finally{he.current=he.current.filter(me=>me!==de)}},[]),Bl=_.useCallback(async(T,I,H)=>{if(I!==ge.current)return;const oe=.76,de=Z.current?.querySelector(`[data-actor-node="${T.actorId}"]`),me=it=>{const Qe=Ve(it,G);return`translate(${Qe.x}px, ${Qe.y}px)`},ve=Math.max(0,T.startDelayMs||0),_e=Math.max(0,performance.now()-H),Me=Math.round(ve*oe),qe=Math.max(0,Me-_e),Ae=T.path&&T.path.length>1?T.path:[T.origin,T.destination],je=Math.max(1,Ae.length-1),$e=Math.max(90,Math.round((T.durationMs||je*110)*oe));if(!de){const it=Math.max(0,qe+$e);it>0&&await new Promise(Qe=>window.setTimeout(Qe,it));return}if(qe>0&&(await new Promise(it=>window.setTimeout(it,qe)),I!==ge.current))return;if((T.movementType||"slide")==="teleport"){const it=Math.max(100,Math.round((T.durationMs||180)*oe));await Er(de,[{transform:me(T.origin),opacity:1,offset:0},{transform:me(T.origin),opacity:0,offset:.45},{transform:me(T.destination),opacity:0,offset:.55},{transform:me(T.destination),opacity:1,offset:1}],{duration:it,easing:"linear"},I),I===ge.current&&(de.style.transform=me(T.destination),de.style.opacity="1");return}const Ye=[...Ae],Xe=Ye[Ye.length-1];(!Xe||Xe.q!==T.destination.q||Xe.r!==T.destination.r||Xe.s!==T.destination.s)&&Ye.push(T.destination);const We=Ye.map((it,Qe)=>({transform:me(it),offset:Ye.length===1?1:Qe/(Ye.length-1)}));We[We.length-1]={...We[We.length-1],transform:me(T.destination),offset:1},await Er(de,We,{duration:$e,easing:"linear"},I),I===ge.current&&(de.style.transform=me(T.destination),de.style.opacity="1")},[Er]),Hl=_.useCallback(async()=>{if(Y.current)return;Y.current=!0,R(!0);const T=++ge.current,I=performance.now();try{for(;ee.current.length>0&&T===ge.current;){const H=ee.current.shift();H&&await Bl(H,T,I)}}finally{T===ge.current&&(Y.current=!1,R(!1))}},[Bl]);_.useEffect(()=>{if(!io){k.current="";return}io!==k.current&&(k.current=io,ee.current.push(...no),Hl())},[io,no,Hl]),_.useEffect(()=>()=>{Jt(),ge.current++,ee.current=[],Y.current=!1,he.current.forEach(T=>{try{T.cancel()}catch{}}),he.current=[],R(!1)},[Jt]),_.useLayoutEffect(()=>{Jt(),ge.current++,ee.current=[],Y.current=!1,he.current.forEach(T=>{try{T.cancel()}catch{}}),he.current=[],R(!1),k.current="",re([]),Hi([]),ea(0),dn([]),A(!1),p(!1),C({x:0,y:0}),U.current=null,K.current=null,ne.current=0,xe.current=0,Ie.current=null,Se.current=null,ei.current=null},[e.floor,Jt]);const wu=_.useMemo(()=>Vf(G-1),[]),_r=_.useMemo(()=>Vf(G+1),[]),Mu=_.useMemo(()=>Vf(G-2),[]),wr=_.useMemo(()=>`biome-map-clip-${e.floor}`,[e.floor]),vt=_.useMemo(()=>({x:et.minX-G*2,y:et.minY-G*2,width:et.width+G*4,height:et.height+G*4}),[et.minX,et.minY,et.width,et.height]),fs=_.useMemo(()=>{const T=Math.max(Math.abs(Number($n?.x??0)),Math.abs(Number($n?.y??0)),Math.abs(Number(Hn?.x??0)),Math.abs(Number(Hn?.y??0)),Math.abs(Number(On?.x??0)),Math.abs(Number(On?.y??0)),Math.abs(Number(di?.x??0)),Math.abs(Number(di?.y??0)));return Math.min(G*32,Math.max(G*8,Math.ceil(T+G*6)))},[$n?.x,$n?.y,Hn?.x,Hn?.y,On?.x,On?.y,di?.x,di?.y]),Ut=_.useMemo(()=>({x:vt.x-fs,y:vt.y-fs,width:vt.width+fs*2,height:vt.height+fs*2}),[vt.x,vt.y,vt.width,vt.height,fs]);return m.jsxs("div",{ref:P,className:`relative w-full h-full flex justify-center items-center overflow-hidden transition-transform duration-75 ${v?"animate-shake":""} ${q?"cursor-grabbing":""}`,children:[m.jsxs("div",{className:"relative w-full h-full",style:{transform:`translate3d(${g.x}px, ${g.y}px, 0)`,transition:"transform 85ms ease-out",willChange:g.x||g.y?"transform":void 0},children:[M&&m.jsx("div",{className:"absolute inset-0 z-20 pointer-events-none bg-white/10",style:{boxShadow:"inset 0 0 60px rgba(255,255,255,0.18)",animation:"flash 120ms ease-out"}}),m.jsxs("svg",{ref:Z,width:"100%",height:"100%",viewBox:`${Bn.x} ${Bn.y} ${Bn.width} ${Bn.height}`,preserveAspectRatio:"xMidYMid meet",shapeRendering:"geometricPrecision",className:"max-h-full max-w-full",onMouseLeave:()=>O(null),onWheel:Eu,onPointerDown:Ll,onPointerMove:Au,onPointerUp:Tu,onPointerCancel:Ar,style:{touchAction:"none"},children:[m.jsxs("defs",{children:[m.jsx("clipPath",{id:wr,clipPathUnits:"userSpaceOnUse",children:ut.map(T=>{const{x:I,y:H}=Ve(T,G);return m.jsx("polygon",{points:Mu,transform:`translate(${I},${H})`},`biome-clip-${Te(T)}`)})}),yt&&Lt==="repeat"&&m.jsxs("pattern",{id:Ba,patternUnits:"userSpaceOnUse",width:Mn,height:Mn,patternTransform:`translate(${$n.x} ${$n.y})`,children:[m.jsx("image",{href:yt,x:"0",y:"0",width:Mn,height:Mn,preserveAspectRatio:"xMidYMid slice"}),(Pt.x!==0||Pt.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${$n.x} ${$n.y}`,to:`${$n.x+Pt.x} ${$n.y+Pt.y}`,dur:`${Pt.durationMs}ms`,repeatCount:"indefinite"})]}),va&&Ei==="repeat"&&m.jsx("pattern",{id:Ha,patternUnits:"userSpaceOnUse",width:ai,height:ai,patternTransform:`translate(${Hn.x} ${Hn.y})`,children:m.jsx("image",{href:va,x:"0",y:"0",width:ai,height:ai,preserveAspectRatio:"xMidYMid slice"})}),Ra&&os==="repeat"&&m.jsxs("pattern",{id:Io,patternUnits:"userSpaceOnUse",width:Ro,height:Ro,patternTransform:`translate(${On.x} ${On.y})`,children:[m.jsx("image",{href:Ra,x:"0",y:"0",width:Ro,height:Ro,preserveAspectRatio:"xMidYMid slice"}),(Ia.x!==0||Ia.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${On.x} ${On.y}`,to:`${On.x+Ia.x} ${On.y+Ia.y}`,dur:`${Ia.durationMs}ms`,repeatCount:"indefinite"})]}),ia&&Sa==="repeat"&&m.jsxs("pattern",{id:xr,patternUnits:"userSpaceOnUse",width:Vn,height:Vn,patternTransform:`translate(${di.x} ${di.y})`,children:[m.jsx("image",{href:ia,x:"0",y:"0",width:Vn,height:Vn,preserveAspectRatio:"xMidYMid slice"}),(Pi.x!==0||Pi.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${di.x} ${di.y}`,to:`${di.x+Pi.x} ${di.y+Pi.y}`,dur:`${Pi.durationMs}ms`,repeatCount:"indefinite"})]}),Qs&&m.jsxs("mask",{id:aa,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",x:Ut.x,y:Ut.y,width:Ut.width,height:Ut.height,children:[m.jsx("rect",{x:Ut.x,y:Ut.y,width:Ut.width,height:Ut.height,fill:"white"}),sa.map(T=>m.jsx("polygon",{points:_r,transform:`translate(${T.x},${T.y})`,fill:"black",opacity:1},`hole-${T.key}`))]})]}),m.jsxs("g",{"data-layer":"biome-undercurrent",pointerEvents:"none",clipPath:`url(#${wr})`,children:[yt&&Lt==="repeat"&&m.jsx("rect",{x:vt.x,y:vt.y,width:vt.width,height:vt.height,fill:`url(#${Ba})`,opacity:Ti}),yt&&Lt==="cover"&&m.jsx("image",{href:yt,x:Ut.x+$n.x,y:Ut.y+$n.y,width:Ut.width,height:Ut.height,preserveAspectRatio:"xMidYMid slice",opacity:Ti})]}),m.jsxs("g",{"data-layer":"biome-crust",pointerEvents:"none",clipPath:`url(#${wr})`,children:[va&&Ei==="repeat"&&m.jsx("rect",{x:vt.x,y:vt.y,width:vt.width,height:vt.height,fill:`url(#${Ha})`,opacity:Nl,mask:`url(#${aa})`}),va&&Ei==="cover"&&m.jsx("image",{href:va,x:Ut.x+Hn.x,y:Ut.y+Hn.y,width:Ut.width,height:Ut.height,preserveAspectRatio:"xMidYMid slice",opacity:Nl,mask:`url(#${aa})`}),Ra&&os==="repeat"&&Aa>0&&m.jsx("rect",{x:vt.x,y:vt.y,width:vt.width,height:vt.height,fill:`url(#${Io})`,opacity:Aa,mask:`url(#${aa})`}),Ra&&os==="cover"&&Aa>0&&m.jsx("image",{href:Ra,x:Ut.x+On.x,y:Ut.y+On.y,width:Ut.width,height:Ut.height,preserveAspectRatio:"xMidYMid slice",opacity:Aa,mask:`url(#${aa})`}),ia&&Sa==="repeat"&&Na>0&&m.jsx("rect",{x:vt.x,y:vt.y,width:vt.width,height:vt.height,fill:`url(#${xr})`,opacity:Na,mask:`url(#${aa})`}),ia&&Sa==="cover"&&Na>0&&m.jsx("image",{href:ia,x:Ut.x+di.x,y:Ut.y+di.y,width:Ut.width,height:Ut.height,preserveAspectRatio:"xMidYMid slice",opacity:Na,mask:`url(#${aa})`}),Xs&&rs&&m.jsx("rect",{x:vt.x,y:vt.y,width:vt.width,height:vt.height,fill:rs,opacity:ls,mask:`url(#${aa})`,style:No!=="normal"?{mixBlendMode:No}:void 0})]}),m.jsx("g",{"data-layer":"interaction-preview",children:m.jsx(o1,{gameState:e,selectedSkillId:s,showMovementRange:o,hoveredTile:N,enginePreviewGhost:Vs})}),m.jsxs("g",{"data-layer":"interaction-tiles",children:[ut.map(T=>{const I=Te(T),H=ni.get(I)||{isWall:!1,isLava:!1,isFire:!1},oe=H.isWall,de=H.isLava,me=H.isFire,ve=o&&!s&&Ai.has(I)||o&&!s&&!ji&&ka.has(I)&&!oe,Me=!!s&&$s.has(I)||ve,qe=I===Di,Ae=xa?I===xa:!1,je=oe&&!Qn.has(I),$e=br&&!je,Ye=f1({isWall:je,isLava:de,isFire:me,theme:e.theme}),Xe=$e?void 0:gn.get(Ye)?.path;return m.jsx(t1,{hex:T,onClick:Sr,isValidMove:Me,isTargeted:!1,isStairs:qe,isLava:de,isFire:me,isShrine:Ae,isWall:je,onMouseEnter:to,assetHref:Xe,interactionOnly:$e},I)}),m.jsx("g",{children:j.map(T=>{const{x:I,y:H}=Ve(T.position,G),oe=Date.now()-T.createdAt,de=Math.max(.18,.75-oe/12e3*.57);return m.jsx("image",{href:T.href,x:I-G*.7,y:H-G*.7,width:G*1.4,height:G*1.4,preserveAspectRatio:"xMidYMid meet",opacity:de},T.id)})})]}),m.jsx("g",{"data-layer":"clutter-obstacles",pointerEvents:"none",children:Il.map(T=>{const{x:I,y:H}=Ve(T.position,G);if(T.asset?.path){const oe=Math.min(1,Math.max(0,T.asset.anchor?.x??.5)),de=Math.min(1,Math.max(0,T.asset.anchor?.y??.5)),me=T.kind==="mountain",ve=me?us.get(T.asset.id)||oi(T.asset):null,_e=ve?ve.anchorX:oe,Me=ve?ve.anchorY:de,qe=I+(ve?ve.offsetX:0),Ae=H+(ve?ve.offsetY:0),je=Math.max(8,T.asset.width*se*T.renderScale),$e=Math.max(8,T.asset.height*se*T.renderScale),Ye=T.kind==="shrine",Xe=T.kind==="stairs",We=Ye||Xe,it=Ye?"rgba(251,146,60,0.25)":"rgba(74,222,128,0.22)",Qe=Ye?"#fdba74":"#86efac",qt=I,bn=H-$e*Me+$e*.84,Zt=Math.max(14,je*.32),Ot=Math.max(8,$e*.14);return m.jsxs("g",{children:[We&&m.jsxs(m.Fragment,{children:[m.jsx("ellipse",{cx:qt,cy:bn,rx:Zt,ry:Ot,fill:it,opacity:.95}),m.jsx("ellipse",{cx:qt,cy:bn,rx:Zt*1.14,ry:Ot*1.14,fill:"none",stroke:Qe,strokeWidth:2,opacity:.72,style:{animation:`shrineGlow ${Ye?1.8:2.4}s ease-in-out infinite`}})]}),(()=>{const Bt=We?Ye?"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(251,146,60,0.45)) saturate(1.08) contrast(1.06)":"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(74,222,128,0.42)) saturate(1.08) contrast(1.06)":me?"drop-shadow(0 7px 10px rgba(0,0,0,0.56)) saturate(1.04) contrast(1.08)":"drop-shadow(0 5px 8px rgba(0,0,0,0.48)) saturate(0.98) contrast(1.04)",Tt=We?.99:me?.96:.9,ri=!!(ve&&ve.crustBlendMode!=="off"&&ve.crustBlendOpacity>0),Dn=!!(ve&&ve.tintBlendMode!=="off"&&ve.tintOpacity>0),Ht=ve?.crustBlendMode!=="off"?ve?.crustBlendMode:void 0,Wt=ve?.tintBlendMode!=="off"?ve?.tintBlendMode:void 0,on=qe-je*_e,rn=Ae-$e*Me,fi=J1(T.id),_i=`mountain-ground-gradient-${e.floor}-${fi}`,qi=`mountain-ground-mask-${e.floor}-${fi}`,ja=`mountain-tint-filter-${e.floor}-${fi}`;return m.jsxs(m.Fragment,{children:[(ri||Dn)&&m.jsxs("defs",{children:[ri&&m.jsxs(m.Fragment,{children:[m.jsxs("linearGradient",{id:_i,x1:"0",y1:"0",x2:"0",y2:"1",children:[m.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0"}),m.jsx("stop",{offset:"42%",stopColor:"#ffffff",stopOpacity:"0.04"}),m.jsx("stop",{offset:"64%",stopColor:"#ffffff",stopOpacity:"0.42"}),m.jsx("stop",{offset:"82%",stopColor:"#ffffff",stopOpacity:"0.82"}),m.jsx("stop",{offset:"100%",stopColor:"#ffffff",stopOpacity:"1"})]}),m.jsx("mask",{id:qi,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:m.jsx("rect",{x:on,y:rn,width:je,height:$e,fill:`url(#${_i})`})})]}),Dn&&m.jsx("filter",{id:ja,x:"-10%",y:"-10%",width:"120%",height:"120%",children:m.jsx("feColorMatrix",{type:"matrix",values:ve?.tintMatrixValues})})]}),m.jsx("image",{href:T.asset.path,x:on,y:rn,width:je,height:$e,preserveAspectRatio:"xMidYMid meet",opacity:Tt,style:{filter:Bt}}),ri&&m.jsx("image",{href:T.asset.path,x:on,y:rn,width:je,height:$e,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.9,ve?.crustBlendOpacity||0),mask:`url(#${qi})`,style:{mixBlendMode:Ht,filter:"brightness(0.92) saturate(0.76) contrast(1.03)"}}),Dn&&m.jsx("image",{href:T.asset.path,x:on,y:rn,width:je,height:$e,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.95,ve?.tintOpacity||0),filter:`url(#${ja})`,style:{mixBlendMode:Wt}})]})})()]},T.id)}return T.fallback==="shrine"?m.jsxs("g",{transform:`translate(${I},${H})`,children:[m.jsx("polygon",{points:"0,-18 8,-4 5,12 -5,12 -8,-4",fill:"#f97316",stroke:"#fff",strokeWidth:"1",opacity:"0.9"}),m.jsx("polygon",{points:"-2,-14 2,-14 1,-2 -1,-2",fill:"rgba(255,255,255,0.6)"}),m.jsx("circle",{cx:"0",cy:"0",r:"14",fill:"none",stroke:"#fdba74",strokeWidth:"2",opacity:"0.4",style:{animation:"shrineGlow 2s ease-in-out infinite"}})]},T.id):m.jsxs("g",{transform:`translate(${I},${H})`,children:[m.jsx("rect",{x:"-12",y:"6",width:"8",height:"4",fill:"#1f2937",rx:"1"}),m.jsx("rect",{x:"-6",y:"2",width:"8",height:"4",fill:"#374151",rx:"1"}),m.jsx("rect",{x:"0",y:"-2",width:"8",height:"4",fill:"#4b5563",rx:"1"}),m.jsx("rect",{x:"6",y:"-6",width:"8",height:"4",fill:"#6b7280",rx:"1"}),m.jsx("path",{d:"M 2 -14 L 2 -20 L -4 -20 L 2 -26 L 8 -20 L 2 -20",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1"})]},T.id)})}),m.jsxs("g",{children:[e.lastSpearPath&&e.lastSpearPath.length>=2&&(()=>{const I=e.lastSpearPath.map(H=>Ve(H,G)).map((H,oe)=>`${oe===0?"M":"L"} ${H.x} ${H.y}`).join(" ");return m.jsx("path",{d:I,stroke:"rgba(255, 255, 255, 0.15)",strokeWidth:"2",fill:"none",strokeDasharray:"4 2",strokeLinecap:"round"})})(),e.spearPosition&&m.jsx(Gc,{entity:{id:"spear",type:"player",subtype:"footman",position:e.spearPosition,hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],speed:0,factionId:"player"},isSpear:!0}),m.jsx(Gc,{entity:e.player,movementTrace:na[e.player.id],waapiControlled:!0,visualPose:Tr.get(e.player.id),assetHref:gn.get(Ds(e.player))?.path,fallbackAssetHref:vo(e.player),floorTheme:fe},`player-${e.floor}`),e.enemies.map(T=>m.jsx(Gc,{entity:T,movementTrace:na[T.id],waapiControlled:!0,visualPose:Tr.get(T.id),assetHref:gn.get(Ds(T))?.path,fallbackAssetHref:vo(T),floorTheme:fe},`${T.id}-${e.floor}`)),e.dyingEntities?.map(T=>m.jsx(Gc,{entity:T,isDying:!0,movementTrace:na[T.id],waapiControlled:!0,visualPose:Tr.get(T.id),assetHref:gn.get(Ds(T))?.path,fallbackAssetHref:vo(T),floorTheme:fe},`dying-${T.id}-${e.floor}-${e.turnNumber}`)),m.jsx(k1,{visualEvents:e.visualEvents||[],timelineEvents:e.timelineEvents||[],simulationEvents:e.simulationEvents||[],actorSnapshots:_u,onBusyStateChange:W,assetManifest:l},`juice-${e.floor}`)]}),m.jsx("g",{"data-layer":"interaction-ui-grid",pointerEvents:"none",shapeRendering:"crispEdges",children:ut.map(T=>{const{x:I,y:H}=Ve(T,G);return m.jsx("g",{transform:`translate(${I},${H})`,children:m.jsx("polygon",{points:wu,fill:"none",stroke:"rgba(201,224,255,0.12)",strokeWidth:.9})},`grid-${Te(T)}`)})}),m.jsx("g",{"data-layer":"ui-objective-markers",pointerEvents:"none",children:Ui.map(T=>{const{x:I,y:H}=Ve(T.position,G),oe=T.kind==="shrine",de=oe?"#c2410c":"#15803d",me=oe?"S":"E",ve=I+G*.52,_e=H-G*.52;return m.jsxs("g",{transform:`translate(${ve},${_e})`,children:[m.jsx("circle",{r:14,fill:"none",stroke:"rgba(255,255,255,0.55)",strokeWidth:2,style:{animation:`shrineGlow ${oe?1.6:1.9}s ease-in-out infinite`}}),m.jsx("circle",{r:10.5,fill:de,stroke:"#ffffff",strokeWidth:2}),m.jsx("text",{x:0,y:0,textAnchor:"middle",dy:".34em",fill:"#ffffff",fontSize:10,fontWeight:900,style:{textShadow:"0 1px 2px rgba(0,0,0,0.7)"},children:me})]},`marker-${T.id}`)})})]})]}),!1,m.jsx("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 z-30 flex items-center gap-1.5 pointer-events-auto",children:m.jsxs("div",{className:"flex items-center gap-1 rounded-xl border border-white/15 bg-black/35 backdrop-blur-sm p-1",children:[U1.map(T=>{const I=pe===T;return m.jsx("button",{type:"button",onPointerDown:H=>H.stopPropagation(),onClick:()=>eo(T),className:`px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest transition-colors ${I?"bg-white text-black":"bg-white/5 text-white/70 hover:bg-white/10"}`,"aria-label":`Set zoom to ${T} tiles wide`,children:T},`zoom-${T}`)}),m.jsx("button",{type:"button",onPointerDown:T=>T.stopPropagation(),onClick:vr,className:"px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-white/5 text-white/70 hover:bg-white/10","aria-label":"Reset camera to player",children:"Fit"})]})})]})},tE=({gameState:e})=>{const{initiativeQueue:i,player:s,enemies:o}=e;if(!i||!i.entries||i.entries.length===0)return null;const c=i.entries.map(l=>l.actorId===s.id?s:o.find(f=>f.id===l.actorId)).filter(l=>!!l);return m.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-white/5 border border-white/10 rounded-2xl backdrop-blur-md",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Turn Sequence"}),m.jsx("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-none",children:c.map((l,f)=>{const h=l.id===s.id,b=f===i.currentIndex,S=i.entries.find(v=>v.actorId===l.id)?.hasActed;return m.jsxs("div",{className:`flex flex-col items-center shrink-0 transition-all duration-300 ${b?"scale-110":"opacity-60 scale-90"}`,children:[m.jsxs("div",{className:`
                                w-10 h-10 rounded-xl flex items-center justify-center border-2 transition-all relative
                                ${h?"bg-blue-500/20 border-blue-500/50":"bg-red-500/20 border-red-500/50"}
                                ${b?"shadow-[0_0_15px_rgba(255,255,255,0.2)] border-white/80":""}
                                ${S?"grayscale":""}
                            `,children:[m.jsx("span",{className:"text-xl",children:Cl(l.subtype,l.type,l.enemyType,l.archetype).icon}),b&&m.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping"}),S&&!b&&m.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-[#030712] text-[8px]",children:""})]}),m.jsx("div",{className:"w-8 h-1 bg-white/10 rounded-full mt-2 overflow-hidden",children:m.jsx("div",{className:`h-full ${h?"bg-blue-400":"bg-red-400"}`,style:{width:`${l.hp/l.maxHp*100}%`}})}),m.jsx("span",{className:`text-[8px] font-bold uppercase mt-1 ${h?"text-blue-300":"text-red-300"} ${b?"text-white":""}`,children:h?"You":l.subtype||"Enemy"})]},`${l.id}-${f}`)})})]})},nE=({gameState:e,onReset:i,onWait:s,onExitToHub:o,inputLocked:c=!1,compact:l=!1,hideInitiativeQueue:f=!1,hideLog:h=!1})=>{const b=f0(e),y=Array.isArray(e.message)?e.message:[],S=ma.useRef(null),[v,A]=ma.useState("all"),[M,p]=ma.useState("all"),g=(O,w)=>{const R=O||"",Q=R.toLowerCase(),W=R.match(/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*(.*)$/i);if(W){const pe=W[1].toLowerCase(),z=W[2].toLowerCase(),ue=W[3]||"",ye=z.includes("combat")?"combat":z.includes("hazard")?"hazard":z.includes("objective")||z.includes("score")?"objective":z.includes("ai")?"ai":"system";return{idx:w,raw:O,text:ue,level:pe,channel:ye}}const j=/(attacked|killed|blast|stunned|damage|hit|healed|shield|bash|spear|fireball|jump|dash)/i.test(Q)?"combat":/(lava|burn|hazard|void|sink|fire damage)/i.test(Q)?"hazard":/(score|objective|floor|stairs|descending|arcade cleared)/i.test(Q)?"objective":/(enemy|falcon|intent|telegraph|moves to|repositioning|attacks)/i.test(Q)?"ai":"system",re=/(fallen|warning|error|failed|invalid|blocked|cannot)/i.test(Q)?"critical":/(debug|trace|telemetry|seed|counter|rng)/i.test(Q)?"debug":/(marks the impact zone|telegraph|planning|intent)/i.test(Q)?"verbose":"info";return{idx:w,raw:O,text:R,level:re,channel:j}},C=ma.useMemo(()=>y.map((O,w)=>g(O,w)),[y]),N=ma.useMemo(()=>C.filter(O=>(v==="all"||O.level===v)&&(M==="all"||O.channel===M)),[C,v,M]);return ma.useEffect(()=>{S.current&&(S.current.scrollTop=S.current.scrollHeight)},[N]),m.jsxs("div",{className:"flex flex-col h-full max-h-screen",children:[m.jsxs("div",{className:`flex flex-col overflow-y-auto flex-1 min-h-0 ${l?"gap-4 p-4":"gap-8 p-8"}`,children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h1",{className:`${l?"text-base":"text-xl"} font-black uppercase tracking-widest text-white/90 mb-1`,children:"Hoplite"}),m.jsx("p",{className:"text-[10px] font-bold text-white/30 uppercase tracking-[0.2em]",children:"Tactical Arena"})]}),m.jsx("div",{className:`px-2 py-1 bg-white/10 rounded border border-white/20 text-[10px] font-black text-white/60 ${l?"hidden sm:block":""}`,children:"V2.1.0"})]}),!f&&m.jsx(tE,{gameState:e}),m.jsxs("div",{className:l?"space-y-4":"space-y-6",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Vitality"}),m.jsxs("div",{className:"flex items-end gap-2",children:[m.jsx("span",{className:`${l?"text-3xl":"text-4xl"} font-black text-red-500 leading-none`,children:e.player.hp}),m.jsx("span",{className:"text-xl text-white/20 font-bold leading-none mb-1",children:"/"}),m.jsx("span",{className:"text-xl text-gray-500 font-bold leading-none mb-1",children:e.player.maxHp})]})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Guardian Plating"}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:`w-3 h-3 rounded-sm ${e.player.temporaryArmor?"bg-blue-400 rotate-45":"bg-white/5 border border-white/10"}`}),m.jsx("span",{className:"text-2xl font-black text-blue-400 leading-none",children:e.player.temporaryArmor||0})]})]}),e.enemies.filter(O=>O.subtype==="sentinel").map(O=>m.jsxs("div",{className:"pt-4 animate-in slide-in-from-right-8 duration-500",children:[m.jsxs("div",{className:"flex justify-between items-end mb-2",children:[m.jsx("span",{className:"text-xs font-black text-red-500 uppercase tracking-tighter italic",children:"Sentinel Directive"}),m.jsxs("span",{className:"text-lg font-black",children:[O.hp," ",m.jsxs("span",{className:"text-white/20 text-xs",children:["/ ",O.maxHp]})]})]}),m.jsx("div",{className:"h-4 w-full bg-red-950/30 rounded-md border border-red-500/20 overflow-hidden",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-red-600 to-red-400 shadow-[0_0_20px_rgba(239,68,68,0.4)] transition-all duration-300",style:{width:`${O.hp/O.maxHp*100}%`}})})]},O.id))]}),m.jsxs("div",{className:`${l?"py-4 space-y-4":"py-8 space-y-6"} border-y border-white/5`,children:[m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Arcade Progress"}),m.jsxs("span",{className:"text-xl font-black",children:[e.floor," ",m.jsx("span",{className:"text-white/20 text-sm",children:"/ 10"})]})]}),m.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden border border-white/5",children:m.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.4)] transition-all duration-1000 ease-out",style:{width:`${e.floor/10*100}%`}})})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Current Score"}),m.jsx("span",{className:"text-xl font-black text-white",children:b.toLocaleString()})]})]}),m.jsxs("div",{className:`flex flex-col ${l?"gap-2":"gap-3"}`,children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Directives"}),m.jsxs("button",{disabled:c,onClick:s,className:`w-full flex justify-between items-center ${l?"px-3 py-2.5":"px-4 py-3"} border rounded-xl transition-all group ${c?"bg-white/[0.03] border-white/5 text-white/30 cursor-not-allowed opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}`,children:[m.jsx("span",{className:"text-sm font-bold text-white/70",children:"Secure & Wait"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),m.jsxs("button",{onClick:i,className:`w-full flex justify-between items-center ${l?"px-3 py-2.5":"px-4 py-3"} bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-xl transition-all group`,children:[m.jsx("span",{className:"text-sm font-bold text-red-400/80",children:"Reset Chronology"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),m.jsxs("button",{onClick:o,className:`w-full flex justify-between items-center ${l?"px-3 py-2.5":"px-4 py-3"} bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all group`,children:[m.jsx("span",{className:"text-sm font-bold text-white/70",children:"Return to Hub"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]})]})]}),!h&&y.length>0&&m.jsxs("div",{className:`${l?"p-4":"p-8"} border-t border-white/5 bg-[#030712]/80 backdrop-blur-sm`,children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold block",children:"Tactical Log"}),m.jsxs("div",{className:`items-center gap-2 ${l?"hidden sm:flex":"flex"}`,children:[m.jsxs("select",{value:M,onChange:O=>p(O.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[m.jsx("option",{value:"all",children:"All Channels"}),m.jsx("option",{value:"combat",children:"Combat"}),m.jsx("option",{value:"hazard",children:"Hazard"}),m.jsx("option",{value:"objective",children:"Objective"}),m.jsx("option",{value:"ai",children:"AI"}),m.jsx("option",{value:"system",children:"System"})]}),m.jsxs("select",{value:v,onChange:O=>A(O.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[m.jsx("option",{value:"all",children:"All Levels"}),m.jsx("option",{value:"info",children:"Info"}),m.jsx("option",{value:"verbose",children:"Verbose"}),m.jsx("option",{value:"debug",children:"Debug"}),m.jsx("option",{value:"critical",children:"Critical"})]})]})]}),m.jsxs("div",{ref:S,className:"flex flex-col gap-2 bg-white/[0.02] border border-white/5 p-4 rounded-2xl overflow-y-auto max-h-[140px]",children:[N.slice(-20).map(O=>m.jsxs("div",{className:"flex gap-2 items-start",children:[m.jsxs("span",{className:"text-[10px] text-white/20 font-bold mt-1 leading-none shrink-0",children:["[",O.idx,"]"]}),m.jsx("span",{className:`text-[9px] mt-1 px-1.5 py-0.5 rounded border shrink-0 ${O.level==="critical"?"text-red-300 border-red-400/40 bg-red-500/10":O.level==="debug"?"text-cyan-300 border-cyan-400/40 bg-cyan-500/10":O.level==="verbose"?"text-amber-300 border-amber-400/40 bg-amber-500/10":"text-white/60 border-white/20 bg-white/5"}`,children:O.level.toUpperCase()}),m.jsx("span",{className:"text-[9px] mt-1 px-1.5 py-0.5 rounded border border-white/20 bg-white/5 text-white/60 shrink-0",children:O.channel.toUpperCase()}),m.jsx("p",{className:"text-[11px] leading-tight text-white/70 font-medium whitespace-pre-wrap",children:O.text})]},O.idx)),N.length===0&&m.jsx("div",{className:"text-[11px] text-white/40 italic",children:"No messages match current filters."})]})]})]})},iE=({onSelect:e,gameState:i})=>{const s=i.player,c=(i.pendingStatus?.shrineOptions||i.shrineOptions||["EXTRA_HP"]).map(l=>{if(l==="EXTRA_HP")return{id:"EXTRA_HP",label:"Extra Heart",desc:"Increases your Max HP by 1 and heals you to full.",color:"bg-red-900/40 border-red-500"};const f=Un.getUpgrade(l),h=Un.getSkillForUpgrade(l),b=s.activeSkills?.find(S=>S.id===h),y=b?.slot==="offensive"?"bg-orange-900/40 border-orange-500":b?.slot==="defensive"?"bg-blue-900/40 border-blue-500":"bg-green-900/40 border-green-500";return{id:l,label:f?f.name:l,desc:f?.description||"Unknown upgrade.",color:y}});return m.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-[100] p-4",children:m.jsxs("div",{className:"bg-gray-900 p-8 rounded-3xl border-2 border-slate-700 max-w-2xl w-full shadow-2xl relative overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-blue-500 to-green-500"}),m.jsx("h2",{className:"text-4xl font-black text-white mb-2 text-center tracking-tight",children:"SHRINE BLESSING"}),m.jsx("p",{className:"text-slate-400 mb-8 text-center text-lg",children:"The gods offer you a choice. Choose wisely."}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(l=>m.jsxs("button",{onClick:()=>e(l.id),className:`
                                relative p-6 border-2 rounded-2xl text-left transition-all group overflow-hidden
                                hover:scale-[1.02] active:scale-[0.98]
                                ${l.color} hover:bg-slate-800
                            `,children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-blue-200",children:l.label}),m.jsx("p",{className:"text-sm text-slate-400 group-hover:text-slate-300 leading-relaxed",children:l.desc}),m.jsx("div",{className:"absolute -right-2 -bottom-2 opacity-0 group-hover:opacity-10 scale-0 group-hover:scale-150 transition-all font-bold text-4xl",children:"*"})]},l.id))})]})})},Vy=({skills:e,selectedSkillId:i,onSelectSkill:s,hasSpear:o,gameState:c,inputLocked:l=!1,compact:f=!1})=>{const h=["offensive","defensive","utility"];return m.jsx("div",{className:f?"grid grid-cols-3 gap-2 sm:grid-cols-4":"flex flex-col gap-4",children:h.flatMap(b=>e.filter(S=>S.slot===b).map(S=>{const v=i===S.id,A=S.currentCooldown>0,M=S.id==="SPEAR_THROW",p=l||A&&!M||M&&!o,g=GA(S.id),C=g?.name||S.name,N=typeof C=="function"?C(c):C,O=g?.icon||"";return m.jsxs("button",{disabled:p,onClick:()=>s(v?null:S.id),className:`
                            relative w-full ${f?"h-20 rounded-xl gap-0.5":"h-24 rounded-2xl gap-1"} flex flex-col items-center justify-center
                            border transition-all transform hover:translate-x-1
                            ${v?"bg-blue-600 border-white shadow-[0_0_20px_rgba(59,130,246,0.5)]":"bg-white/5 border-white/10 hover:border-blue-500/50"}
                            ${p?"opacity-40 grayscale pointer-events-none":"cursor-pointer"}
                        `,children:[m.jsx("span",{className:f?"text-2xl":"text-3xl",children:O}),m.jsx("span",{className:`${f?"text-[9px] tracking-[0.12em]":"text-[10px] tracking-widest"} uppercase font-bold text-white/50 text-center px-2 leading-tight`,children:N}),A&&!M&&m.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-black/40 ${f?"rounded-xl":"rounded-2xl"} backdrop-blur-[2px]`,children:m.jsx("span",{className:`${f?"text-2xl":"text-3xl"} font-black text-white`,children:S.currentCooldown})}),m.jsx("div",{className:`absolute ${f?"-top-1 left-2 px-1.5":"-top-2 left-4 px-2"} py-0.5 bg-[#030712] rounded-full border border-white/10 text-[8px] uppercase font-black tracking-widest text-white/40`,children:b})]},S.id)}))})},aE=({onSelect:e})=>m.jsxs("div",{className:"relative z-50 flex flex-col items-center justify-center p-8 gap-8 animate-in fade-in zoom-in duration-500",children:[m.jsxs("div",{className:"text-center space-y-2",children:[m.jsx("h1",{className:"text-4xl font-black uppercase tracking-widest text-white mb-2",children:"Select Class"}),m.jsx("p",{className:"text-white/40 text-sm uppercase tracking-wider",children:"Choose your combat doctrine"})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl",children:Object.values(hr).map(i=>m.jsxs("button",{onClick:()=>{console.log("Archetype Selected:",i.id),e(i)},className:"group relative flex flex-col items-start p-8 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/30 rounded-3xl transition-all hover:scale-[1.02] text-left cursor-pointer",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 rounded-3xl transition-opacity"}),m.jsxs("div",{className:"relative z-10 w-full",children:[m.jsxs("div",{className:"flex justify-between items-start mb-4",children:[m.jsx("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10 group-hover:border-white/30 transition-colors",children:m.jsx("span",{className:"text-3xl",children:Cl(i.id==="ASSASSIN"?"assassin_player":i.id.toLowerCase(),"player").icon})}),m.jsx("div",{className:"px-3 py-1 bg-white/5 rounded-full border border-white/10 text-[10px] font-bold uppercase tracking-widest text-white/50",children:i.id==="VANGUARD"?"Standard":"Advanced"})]}),m.jsx("h3",{className:"text-2xl font-black uppercase tracking-wide text-white mb-2",children:i.name}),m.jsx("p",{className:"text-white/60 text-sm leading-relaxed mb-6 h-12",children:i.description}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/30 font-bold border-b border-white/5 pb-1",children:"Starting Loadout"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.startingSkills.map(s=>m.jsx("div",{className:"px-2 py-1 bg-black/40 rounded border border-white/10 text-[10px] text-blue-200",children:s.replace("_"," ")},s))})]})]})]},i.id))})]}),sE="hop_replays_v1",oE="hop_leaderboard_v1",Yy=()=>{try{const e=localStorage.getItem(sE);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load replays",e),[]}},Ky=()=>{try{const e=localStorage.getItem(oE);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load leaderboard",e),[]}},Fy=e=>{const i=Array.isArray(e.actions)?e.actions:[],s=new Set(i.map(y=>y?.type)),o=s.has("ADVANCE_TURN"),c=s.has("RESOLVE_PENDING"),l=(e.floor||0)>=5&&i.length<Math.max(25,(e.floor||0)*4),f=(e.replayVersion??1)<2,h=i.length===0,b=h?"invalid replay":l?"truncated replay":f?"legacy replay":null;return{isLegacy:f,invalid:h,suspicious:l||e.floor>1&&!c,label:b,hasTurnAdvance:o,hasPendingResolve:c,actionCount:i.length}},Wy=({onStartReplay:e})=>{const[i,s]=_.useState(()=>Yy()),[o,c]=_.useState(()=>Ky()),[l,f]=_.useState(""),[h,b]=_.useState(""),[y,S]=_.useState(""),[v,A]=_.useState(null);_.useEffect(()=>{const g=()=>{s(Yy()),c(Ky())};return window.addEventListener("storage",g),()=>window.removeEventListener("storage",g)},[]);const M=()=>{A(null);try{const g=y.trim();if(!g)return A("Paste actions JSON first."),null;const C=JSON.parse(g);let N=l.trim()||void 0,O=h.trim()||void 0,w=[];return Array.isArray(C)?w=C:C&&typeof C=="object"&&(w=Array.isArray(C.actions)?C.actions:[],N=N||(typeof C.seed=="string"?C.seed:void 0),O=O||(typeof C.loadoutId=="string"?C.loadoutId:void 0)),!Array.isArray(w)||w.length===0?(A('No actions found. Provide a JSON action array or object with "actions".'),null):w.filter(W=>W&&typeof W.type=="string").length===0?(A('Actions must be objects with a "type" field.'),null):{id:`manual-${Date.now()}`,seed:N,loadoutId:O,actions:w,score:0,floor:1,date:new Date().toISOString(),replayVersion:2,diagnostics:{actionCount:w.length,hasTurnAdvance:w.some(W=>W?.type==="ADVANCE_TURN"),hasPendingResolve:w.some(W=>W?.type==="RESOLVE_PENDING"),suspiciouslyShort:!1}}}catch(g){return A(`Invalid JSON: ${g?.message||"parse error"}`),null}},p=()=>{const g=M();g&&e(g)};return m.jsxs("div",{className:"flex flex-col gap-8",children:[m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-emerald-400",children:"Manual Replay"}),m.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Paste from UPA"})]}),m.jsxs("div",{className:"space-y-2 p-3 rounded-2xl border border-white/5 bg-white/[0.02]",children:[m.jsx("input",{value:l,onChange:g=>f(g.target.value),placeholder:"Seed (optional if included in JSON)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),m.jsx("input",{value:h,onChange:g=>b(g.target.value),placeholder:"Loadout ID (optional)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),m.jsx("textarea",{value:y,onChange:g=>S(g.target.value),placeholder:'Paste JSON actions array, or object: {"seed":"...","loadoutId":"...","actions":[...]}',rows:6,className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40 font-mono"}),v&&m.jsx("div",{className:"text-[10px] text-red-400 font-bold uppercase tracking-wider",children:v}),m.jsx("button",{onClick:p,className:"w-full py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 text-xs font-black uppercase tracking-widest transition-colors",children:"Start Manual Replay"})]})]}),m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400",children:"Hall of Fame"}),m.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Top 5 Only"})]}),m.jsxs("div",{className:"space-y-2",children:[o.length===0&&m.jsx("div",{className:"p-4 rounded-xl border border-white/5 bg-white/[0.02] text-center",children:m.jsx("span",{className:"text-[10px] text-white/30 uppercase font-black",children:"No Champions Yet"})}),o.slice(0,5).map((g,C)=>{const N={id:g.id,seed:g.seed,loadoutId:g.loadoutId,actions:g.actions||[],score:g.score,floor:g.floor,date:g.date,replayVersion:g.replayVersion,diagnostics:g.diagnostics},O=Fy(N);return m.jsxs("button",{onClick:()=>e(N),className:"w-full group relative flex items-center gap-4 p-4 bg-white/[0.03] hover:bg-white/[0.07] border border-white/5 hover:border-indigo-500/30 rounded-2xl transition-all text-left",children:[m.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-indigo-500/10 rounded-lg text-indigo-400 font-black text-sm border border-indigo-500/20",children:C+1}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[m.jsx("span",{className:"font-black text-white uppercase text-xs truncate tracking-wider",children:g.name}),m.jsx("span",{className:"text-[10px] font-black text-indigo-400 tabular-nums",children:g.score.toLocaleString()})]}),m.jsxs("div",{className:"text-[9px] text-white/30 font-bold uppercase tracking-widest",children:["Floor ",g.floor," * ",new Date(g.date).toLocaleDateString()," * ",O.actionCount," acts"]}),O.label&&m.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:O.label})]}),m.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-indigo-400 text-xs",children:"Play"})]},g.id)})]})]}),m.jsxs("section",{children:[m.jsx("div",{className:"flex items-center justify-between mb-4",children:m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Recent Simulations"})}),m.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar pr-2",children:[i.length===0&&m.jsx("div",{className:"text-center py-4",children:m.jsx("span",{className:"text-[10px] text-white/10 uppercase font-bold",children:"Log Empty"})}),i.slice(0,10).map(g=>{const C=Fy(g);return m.jsxs("button",{onClick:()=>e(g),className:"w-full flex items-center justify-between p-3 hover:bg-white/[0.04] rounded-xl transition-colors text-left group",children:[m.jsxs("div",{className:"min-w-0",children:[m.jsxs("div",{className:"text-[10px] font-bold text-white/60 mb-0.5 truncate uppercase",children:["Score: ",m.jsx("span",{className:"text-white",children:g.score})," * F",g.floor," * ",C.actionCount," acts"]}),m.jsx("div",{className:"text-[9px] text-white/20 font-medium",children:new Date(g.date).toLocaleTimeString()}),C.label&&m.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:C.label})]}),m.jsx("div",{className:"text-[10px] text-white/0 group-hover:text-white/40 font-black uppercase tracking-widest transition-all",children:"Replay"})]},g.id)})]})]})]})};class rE{state;constructor(){this.state=ns(1,"tutorial-seed"),this.state.enemies=[],this.state.tiles=new Map}setPlayer(i,s){this.state.player={...this.state.player,position:i,previousPosition:i,activeSkills:s.map(o=>{const c=Un.get(o);return{id:o,name:typeof c?.name=="function"?c.name(this.state):c?.name||o,description:c?.description||"",slot:c?.slot||"offensive",cooldown:c?.baseVariables.cooldown||0,currentCooldown:0,range:c?.baseVariables.range||0,upgrades:Object.keys(c?.upgrades||{}),activeUpgrades:[]}})}}spawnEnemy(i,s,o){const c=Xf[i]||{hp:1,maxHp:1};this.state.enemies.push({id:o,type:"enemy",subtype:i,position:s,previousPosition:s,hp:c.hp,maxHp:c.maxHp,enemyType:c.type||"melee",statusEffects:[],temporaryArmor:0,activeSkills:[],speed:c.speed||1,factionId:"enemy"})}spawnFalcon(i,s){const o={id:s,type:"enemy",subtype:"falcon",factionId:"player",speed:95,position:{...i},previousPosition:{...i},hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],isFlying:!0,companionOf:"player",companionState:{mode:"roost",orbitStep:0,apexStrikeCooldown:0}};this.state.enemies.push(o),this.state.companions||(this.state.companions=[]),this.state.companions.push(o)}spawnCompanion(i,s,o){i==="falcon"&&this.spawnFalcon(s,o)}setTile(i,s){const o=s.toUpperCase(),c=Te(i),l=mr[o];if(!l){console.warn(`Attempted to set unknown tile type: ${o}`);return}this.state.tiles.set(c,{baseId:o,position:i,traits:new Set(l.defaultTraits||[]),effects:[],occupantId:void 0})}addUpgrade(i,s){this.state.player.activeSkills=(this.state.player.activeSkills||[]).map(o=>o.id===i?{...o,activeUpgrades:[...o.activeUpgrades,s]}:o)}useSkill(i,s){}wait(){}move(i){}getEnemy(i){return this.state.enemies.find(s=>s.id===i)}setTurn(i){this.state.turnNumber=i}exitToHub(){}applyStatus(i,s){const o=this.state.enemies.findIndex(c=>c.id===i);o!==-1&&(this.state.enemies[o]=Gf(this.state.enemies[o],s,1))}}const Xy=({onLoadScenario:e})=>{const i=Object.values(Su),s=o=>{const c=new rE;o.setup(c),c.state.initiativeQueue=Co(c.state),e(c.state,o.description)};return m.jsx("div",{className:"flex flex-col gap-4",children:i.map(o=>m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-white/50",children:typeof o.name=="function"?o.name(ns(1,"temp")):o.name}),m.jsx("div",{className:"flex flex-col gap-1",children:o.scenarios?.map(c=>m.jsx("button",{onClick:()=>s(c),className:"text-left px-3 py-2 bg-white/5 hover:bg-white/10 rounded text-xs text-white/80 transition-colors border border-transparent hover:border-white/20",children:c.title},c.id))})]},o.id))})},lE=({gameState:e,onSelectLoadout:i,onStartRun:s,onOpenArcade:o,onLoadScenario:c,onStartReplay:l})=>m.jsxs("div",{className:"w-full h-full flex flex-col bg-[#020617]",children:[m.jsx("header",{className:"border-b border-white/5 px-4 sm:px-6 lg:px-12 py-3 sm:py-4 bg-[#030712]/50 backdrop-blur-xl z-30",children:m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[m.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-indigo-500 rounded-lg flex items-center justify-center font-black text-lg sm:text-xl shadow-[0_0_20px_rgba(99,102,241,0.5)]",children:"H"}),m.jsxs("div",{children:[m.jsxs("h1",{className:"text-base sm:text-lg font-black uppercase tracking-tighter leading-none italic",children:["Hop ",m.jsx("span",{className:"text-indigo-500",children:"Engine"})]}),m.jsx("div",{className:"text-[9px] sm:text-[10px] font-bold text-white/30 tracking-[0.22em] sm:tracking-[0.3em] uppercase mt-1",children:"Strategic Hub v5.0"})]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 lg:gap-8",children:[m.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 sm:bg-transparent sm:border-0 sm:p-0",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/40 mb-1",children:"Current Loadout"}),m.jsx("div",{className:"text-sm font-bold text-indigo-400 truncate",children:e.selectedLoadoutId||"No Archetype Selected"})]}),e.selectedLoadoutId&&m.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:items-center sm:gap-3",children:[m.jsxs("button",{onClick:()=>s("normal"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center leading-tight",children:[m.jsx("span",{children:"Start Run"}),m.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"10 Floors | Boss Defeat"})]}),m.jsxs("button",{onClick:()=>s("daily"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(16,185,129,0.3)] flex flex-col items-center justify-center leading-tight",children:[m.jsx("span",{children:"Daily"}),m.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"Seeded Challenge"})]})]})]})]})}),m.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-y-auto lg:overflow-hidden",children:[m.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs("div",{className:"mb-6 sm:mb-10 lg:mb-12",children:[m.jsx("button",{onClick:o,className:"mb-4 sm:mb-5 w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 font-black uppercase tracking-widest text-xs sm:text-sm transition-all",children:"Arcade Mode"}),m.jsxs("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-black uppercase tracking-tighter mb-2 italic",children:["Select Your ",m.jsx("span",{className:"text-indigo-500",children:"Archetype"})]}),m.jsx("p",{className:"text-sm sm:text-base text-white/40 max-w-xl",children:"Choose your tactical specialty. Each archetype provides unique skills and modifies your core interaction with the engine."})]}),m.jsx(aE,{onSelect:i})]})}),m.jsxs("section",{className:"lg:hidden border-t border-white/5 bg-[#030712]/50 backdrop-blur-sm p-4 sm:p-6 space-y-4",children:[m.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[m.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[m.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Historical Replay"}),m.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),m.jsx("div",{className:"mt-3",children:m.jsx(Wy,{gameState:e,onStartReplay:l})})]}),m.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[m.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[m.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Training Simulations"}),m.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),m.jsx("div",{className:"mt-3",children:m.jsx(Xy,{onLoadScenario:c})})]})]}),m.jsx("aside",{className:"hidden lg:flex w-[450px] border-l border-white/5 bg-[#030712]/80 backdrop-blur-md flex-col z-20",children:m.jsxs("div",{className:"p-8 flex flex-col gap-12 h-full overflow-y-auto custom-scrollbar",children:[m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Historical Replay"}),m.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]}),m.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:m.jsx(Wy,{gameState:e,onStartReplay:l})})]}),m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Training Simulations"}),m.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]}),m.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:m.jsx(Xy,{onLoadScenario:c})})]}),m.jsx("div",{className:"mt-auto pt-8 border-t border-white/5 opacity-20 hover:opacity-100 transition-opacity",children:m.jsx("div",{className:"text-[10px] font-bold uppercase tracking-[0.4em] mb-2 text-center text-white/50",children:"Engine Status: Online"})})]})})]})]}),cE={VANGUARD:"V",HUNTER:"H",FIREMAGE:"F",NECROMANCER:"N",SKIRMISHER:"S"},Gy=e=>{let i=2166136261;for(let s=0;s<e.length;s++)i^=e.charCodeAt(s),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return i>>>0},uE=(e=new Date)=>e.toISOString().slice(0,10),dE=(e,i)=>{if(e.length<2)throw new Error("Arcade mode requires at least two loadouts.");const o=Gy(`arcade-a:${i}`)%e.length,c=e[o],l=e.filter(y=>y.id!==c.id),h=Gy(`arcade-b:${i}`)%l.length,b=l[h];return[c,b]},fE=({onBack:e,onLaunchArcade:i})=>{const s=ma.useMemo(()=>Object.values(hr),[]),o=ma.useMemo(()=>uE(),[]),[c,l]=ma.useMemo(()=>dE(s,o),[s,o]);return m.jsxs("div",{className:"w-full h-full flex flex-col bg-[#040a18]",children:[m.jsxs("header",{className:"h-20 border-b border-white/10 flex items-center justify-between px-12 bg-[#050b1f]/80 backdrop-blur-xl z-30",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-xl font-black uppercase tracking-tight italic",children:["Hop ",m.jsx("span",{className:"text-emerald-400",children:"Arcade"})]}),m.jsxs("div",{className:"text-[10px] uppercase tracking-[0.3em] text-white/40 mt-1",children:["Daily Draft ",o]})]}),m.jsx("button",{onClick:e,className:"px-5 py-2.5 rounded-xl border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-widest",children:"Back to Strategic Hub"})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12",children:m.jsxs("div",{className:"max-w-5xl mx-auto",children:[m.jsxs("div",{className:"mb-10",children:[m.jsx("h2",{className:"text-4xl font-black uppercase tracking-tight italic mb-3",children:"Arcade Mode"}),m.jsx("p",{className:"text-white/60 max-w-3xl",children:"Pick one of two daily archetypes and run the seeded challenge. Both options share the same seed for fair comparison."})]}),m.jsx("div",{className:"flex flex-col gap-6",children:[c,l].map((f,h)=>{const b=h===1,y=cE[f.id]||f.id.slice(0,1);return m.jsx("button",{onClick:()=>i(f.id),className:"w-full text-left group rounded-3xl border border-white/10 bg-gradient-to-r from-white/[0.06] to-white/[0.02] hover:from-emerald-500/20 hover:to-cyan-500/10 transition-all p-6",children:m.jsxs("div",{className:`flex items-center justify-between gap-6 ${b?"flex-row-reverse":""}`,children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-[200px]",children:[m.jsx("div",{className:`w-20 h-20 rounded-2xl border border-white/15 bg-[#0b1733] flex items-center justify-center text-4xl font-black text-emerald-300 shadow-[0_0_35px_rgba(16,185,129,0.25)] ${b?"-scale-x-100":""}`,children:y}),m.jsxs("div",{children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Daily Archetype"}),m.jsx("div",{className:"text-2xl font-black uppercase tracking-tight",children:f.name})]})]}),m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/40 mb-2",children:"Starting Skills"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:f.startingSkills.slice(0,6).map(S=>m.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full border border-white/20 bg-white/5 font-bold tracking-wide",children:S},S))})]}),m.jsxs("div",{className:"text-right min-w-[150px]",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Launch"}),m.jsx("div",{className:"text-sm font-black uppercase tracking-widest text-emerald-300 group-hover:text-emerald-200",children:"Start Arcade Run"})]})]})},f.id)})})]})})]})},mE=["catacombs","inferno","throne","frozen","void"],su=["off","repeat","cover"],Qy="hop_biome_sandbox_settings_v1",Ml="/Hop",So=64,Ao=192,bi=64,xi=512,pE=["normal","multiply","overlay","soft-light","screen","color-dodge"],Jy=["off","multiply","overlay","soft-light","screen","color-dodge","normal"],hE=["#8b6f4a","#8f4a2e","#5b6d41","#536e8e","#5f5977","#b79a73","#d15a3a","#3e4f3a"],gE=["native","additive","custom"],yE=[{q:1,r:0,s:-1},{q:0,r:1,s:-1},{q:-1,r:1,s:0},{q:-1,r:0,s:1},{q:0,r:-1,s:1},{q:1,r:-1,s:0}],Zy=(e,i)=>`${e.endsWith("/")?e:`${e}/`}${i.replace(/^\/+/,"")}`,yl=e=>{const i=e.trim();return!i||/^(?:[a-z]+:)?\/\//i.test(i)||i.startsWith("data:")?i:i.startsWith("/")?i.startsWith("/assets/")?Zy(Ml,i.slice(1)):i:Zy(Ml,i)},bl=e=>{const i=e.trim();if(!i||/^\/assets\/[a-z0-9/_\-.]+$/i.test(i))return i;const o=`${Ml.endsWith("/")?Ml:`${Ml}/`}assets/`;return i.startsWith(o)?`/assets/${i.slice(o.length)}`:i},Qi=(e,i="#8b6f4a")=>{const s=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(s))return s.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(s)){const[l,f,h]=s.slice(1).split("");return`#${l}${l}${f}${f}${h}${h}`.toLowerCase()}return i},bE=e=>{let i=2166136261;for(let s=0;s<e.length;s++)i^=e.charCodeAt(s),i=Math.imul(i,16777619);return i>>>0},e0=e=>bE(e)/4294967295,D0=e=>e.has("BLOCKS_MOVEMENT")&&e.has("BLOCKS_LOS"),xE=e=>e.has("LAVA")||e.has("FIRE")||e.has("HAZARDOUS")&&e.has("LIQUID"),ym=e=>yE.map(i=>Te({q:e.q+i.q,r:e.r+i.r,s:e.s+i.s})),vE=e=>{const i=new Set;for(const[s,o]of e.entries())ym(o.position).some(l=>!e.has(l))&&i.add(s);return i},SE=(e,i,s)=>{const o=new Set,c=[{point:i,depth:0}];for(;c.length>0;){const l=c.shift(),f=Te(l.point);if(!o.has(f)&&e.has(f)&&(o.add(f),!(l.depth>=s)))for(const h of ym(l.point)){const b=e.get(h);b&&c.push({point:b.position,depth:l.depth+1})}}return o},Yf=(e,i,s)=>{const o=e.get(i);if(!o)return;const c=new Set(Array.from(o.traits));s?(c.add("BLOCKS_MOVEMENT"),c.add("BLOCKS_LOS"),c.delete("LAVA"),c.delete("FIRE"),c.delete("LIQUID"),c.delete("HAZARDOUS")):(c.delete("BLOCKS_MOVEMENT"),c.delete("BLOCKS_LOS")),e.set(i,{...o,traits:c})},be=(e,i,s)=>Math.min(s,Math.max(i,e)),ou=(e,i)=>e?i&&e.themes?.[i]?e.themes[i]:e.default||"":"",ru=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"repeat":"off",AE=(e,i)=>e?i&&e.themes?.[i]?e.themes[i]:e.default||"#8b6f4a":"#8b6f4a",To=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",Ii=e=>e==="off"?"off":To(e),Kf=(e,i,s,o)=>{const c=e?.[s]??e?.[o];return c!==void 0?c:i?.[s]??i?.[o]},TE=e=>{switch(e){case"inferno":return 4;case"throne":return 6;case"frozen":return 8;case"void":return 10;default:return 1}},EE=e=>{const i=new Map;for(const[s,o]of e.tiles.entries())i.set(s,{...o,traits:new Set(o.traits),effects:Array.isArray(o.effects)?[...o.effects]:[]});return i},_E=(e,i)=>{const s=(l,f,h)=>{const y=Te({q:l,r:f}),S=e.get(y);if(!S)return;const v=new Set(Array.from(S.traits));if(!D0(v)){for(const A of h)v.add(A);e.set(y,{...S,traits:v})}},o=[[0,0],[1,0],[0,1],[-1,1],[-1,0],[0,-1],[1,-1],[2,-1],[2,0],[1,1],[-2,1],[-2,0],[-1,-1]];for(const[l,f]of o)s(i.q+l,i.r+f,["HAZARDOUS","LIQUID","LAVA"]);const c=[[3,-1],[3,0],[2,1],[-3,1],[-3,0],[-2,-1]];for(const[l,f]of c)s(i.q+l,i.r+f,["HAZARDOUS","FIRE"])},wE=(e,i,s,o)=>{const c=o.mode,l=vE(e),f=SE(e,s,2),h=Array.from(e.keys()).sort((M,p)=>M.localeCompare(p));if(c==="custom")for(const M of h){if(f.has(M)){Yf(e,M,!1);continue}const p=o.keepPerimeter&&l.has(M);Yf(e,M,p)}if(c==="native")return;const b=be(Number(o.interiorDensity||0),0,.45),y=be(Number(o.clusterBias||0),0,1);if(b<=0&&y<=0)return;const S=h.filter(M=>{if(l.has(M)||f.has(M))return!1;const p=e.get(M);if(!p)return!1;const g=p.traits;return!xE(g)}),v=M=>{const p=e.get(M);return p?D0(p.traits):!1},A=new Set;for(const M of S){if(v(M))continue;e0(`${i}|sandbox-wall-seed|${M}`)<b&&A.add(M)}for(let M=0;M<2;M++)for(const p of S){if(v(p)||A.has(p))continue;const g=e.get(p);if(!g)continue;const C=ym(g.position).filter(R=>e.has(R));let N=0;for(const R of C)(v(R)||A.has(R))&&N++;if(N===0)continue;const O=y*(N/6);e0(`${i}|sandbox-wall-grow|pass:${M}|${p}`)<O&&A.add(p)}for(const M of A)Yf(e,M,!0)},ME=(e,i,s,o)=>{const c=TE(e),l=i.trim()||"biome-sandbox-seed",f=ns(c,l,l,void 0,hr.VANGUARD),h=EE(f);return wE(h,l,f.player.position,o),s&&_E(h,f.player.position),{...f,floor:c,theme:e,rngSeed:l,initialSeed:l,turnNumber:1,tiles:h,visualEvents:[],timelineEvents:[],intentPreview:void 0}},t0=(e,i)=>{const s=i.toLowerCase(),o=hm(e,s),c=o?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,l=o?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),f=o?.biomeMaterials?.crust??e.biomeMaterials?.crust,h=f?.detailA,b=f?.detailB,y=f?.tint,S=o?.walls||e.walls,v=o?.walls?o.walls:e.walls?.themes?.[s],A=(e.assets||[]).filter(W=>{if(W.type!=="prop")return!1;const j=W.id.toLowerCase(),re=new Set((W.tags||[]).map(z=>z.toLowerCase()));if(!j.includes("mountain")&&!re.has("mountain"))return!1;if(!W.theme)return!0;const pe=W.theme.toLowerCase();return pe===s||pe==="core"}).sort((W,j)=>W.id.localeCompare(j.id)),p=String(v?.mountainPath??S?.mountainPath??"").trim()||A.find(W=>W.path.toLowerCase().includes("biome.volcano.mountain.03.webp"))?.path||A[0]?.path||"",g=A.find(W=>W.path===p)||A[0],C=g?.mountainSettings,N=g?.mountainSettingsByTheme?.[s],O=g?o?.assetOverrides?.[g.id]?.mountainSettings:void 0,w=(W,j,re)=>{const z=Kf(v,S,W,j)??O?.[W]??N?.[W]??C?.[W]??re,ue=Number(z);return Number.isFinite(ue)?ue:re},R=(W,j,re)=>{const z=Kf(v,S,W,j)??O?.[W]??N?.[W]??C?.[W]??re;return Ii(z)},Q=(W,j,re)=>{const z=Kf(v,S,W,j)??O?.[W]??N?.[W]??C?.[W]??re;return Qi(String(z||""),re)};return{theme:i,seed:String(o?.seed||"biome-sandbox-seed"),injectHazards:o?.injectHazards!==void 0?!!o.injectHazards:!0,undercurrent:{path:ou(c,s),mode:ru(c),scalePx:be(Number(c?.scalePx??e.tileUnitPx??256),So,Ao),opacity:be(Number(c?.opacity??.6),0,1),scrollX:Number(c?.scroll?.x??120),scrollY:Number(c?.scroll?.y??90),scrollDurationMs:Math.max(1e3,Number(c?.scroll?.durationMs??92e3)),offsetX:Number(c?.offsetX??0),offsetY:Number(c?.offsetY??0)},crust:{path:ou(l,s),mode:ru(l),scalePx:Math.max(64,Number(l?.scalePx??e.tileUnitPx??256)),opacity:1,seedShiftPx:Math.max(0,Number(l?.seedShiftPx??96)),offsetX:Number(l?.offsetX??0),offsetY:Number(l?.offsetY??0)},clutter:{density:be(Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.density??.14),0,1),maxPerHex:Math.max(0,Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.maxPerHex??1)),bleedScaleMax:be(Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.bleedScaleMax??2),1,2)},walls:{mode:S?.mode==="native"||S?.mode==="additive"||S?.mode==="custom"?S.mode:"custom",interiorDensity:be(Number(S?.interiorDensity??.05),0,.45),clusterBias:be(Number(S?.clusterBias??0),0,1),keepPerimeter:S?.keepPerimeter!==void 0?!!S.keepPerimeter:!0,mountainPath:p,mountainScale:be(w("scale","mountainScale",.53),.2,3),mountainOffsetX:w("offsetX","mountainOffsetX",0),mountainOffsetY:w("offsetY","mountainOffsetY",0),mountainAnchorX:be(w("anchorX","mountainAnchorX",.5),0,1),mountainAnchorY:be(w("anchorY","mountainAnchorY",.55),0,1),mountainCrustBlendMode:R("crustBlendMode","mountainCrustBlendMode","multiply"),mountainCrustBlendOpacity:be(w("crustBlendOpacity","mountainCrustBlendOpacity",1),0,1),mountainTintColor:Q("tintColor","mountainTintColor","#7d7d7d"),mountainTintBlendMode:R("tintBlendMode","mountainTintBlendMode","overlay"),mountainTintOpacity:be(w("tintOpacity","mountainTintOpacity",1),0,1)},materials:{detailA:{path:ou(h,s),mode:ru(h),scalePx:be(Number(h?.scalePx??192),bi,xi),opacity:be(Number(h?.opacity??0),0,1)},detailB:{path:ou(b,s),mode:ru(b),scalePx:be(Number(b?.scalePx??256),bi,xi),opacity:be(Number(b?.opacity??0),0,1)},tintColor:AE(y,s),tintOpacity:be(Number(y?.opacity??0),0,1),tintBlend:To(y?.blendMode)}}},OE=e=>{if(!e)return null;try{const i=JSON.parse(e);return!i||typeof i!="object"?null:i}catch{return null}},St=(e,i)=>{const s=Number(e);return Number.isFinite(s)?s:i},CE=({assetManifest:e,onBack:i})=>{const s=_.useRef(!1),[o,c]=_.useState(""),[l,f]=_.useState(null);_.useEffect(()=>{if(!e||s.current)return;const p=t0(e,"inferno"),g=OE(localStorage.getItem(Qy));if(!g){f(p),s.current=!0;return}f({...p,...g,undercurrent:{...p.undercurrent,...g.undercurrent||{},scalePx:be(Number((g.undercurrent||{}).scalePx??p.undercurrent.scalePx),So,Ao)},crust:{...p.crust,...g.crust||{},opacity:1},clutter:{...p.clutter,...g.clutter||{}},walls:{...p.walls,...g.walls||{},mode:(g.walls||{}).mode==="native"||(g.walls||{}).mode==="additive"||(g.walls||{}).mode==="custom"?(g.walls||{}).mode:p.walls.mode,interiorDensity:be(Number((g.walls||{}).interiorDensity??p.walls.interiorDensity),0,.45),clusterBias:be(Number((g.walls||{}).clusterBias??p.walls.clusterBias),0,1),keepPerimeter:(g.walls||{}).keepPerimeter!==void 0?!!(g.walls||{}).keepPerimeter:p.walls.keepPerimeter,mountainPath:String((g.walls||{}).mountainPath||p.walls.mountainPath||""),mountainScale:be(Number((g.walls||{}).mountainScale??p.walls.mountainScale),.2,3),mountainOffsetX:St(String((g.walls||{}).mountainOffsetX??p.walls.mountainOffsetX),p.walls.mountainOffsetX),mountainOffsetY:St(String((g.walls||{}).mountainOffsetY??p.walls.mountainOffsetY),p.walls.mountainOffsetY),mountainAnchorX:be(Number((g.walls||{}).mountainAnchorX??p.walls.mountainAnchorX),0,1),mountainAnchorY:be(Number((g.walls||{}).mountainAnchorY??p.walls.mountainAnchorY),0,1),mountainCrustBlendMode:Ii((g.walls||{}).mountainCrustBlendMode??p.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:be(Number((g.walls||{}).mountainCrustBlendOpacity??p.walls.mountainCrustBlendOpacity),0,1),mountainTintColor:Qi(String((g.walls||{}).mountainTintColor??p.walls.mountainTintColor),p.walls.mountainTintColor),mountainTintBlendMode:Ii((g.walls||{}).mountainTintBlendMode??p.walls.mountainTintBlendMode),mountainTintOpacity:be(Number((g.walls||{}).mountainTintOpacity??p.walls.mountainTintOpacity),0,1)},materials:{...p.materials,...g.materials||{},detailA:{...p.materials.detailA,...(g.materials||{}).detailA||{},scalePx:be(Number(((g.materials||{}).detailA||{}).scalePx??p.materials.detailA.scalePx),bi,xi),opacity:be(Number(((g.materials||{}).detailA||{}).opacity??p.materials.detailA.opacity),0,1)},detailB:{...p.materials.detailB,...(g.materials||{}).detailB||{},scalePx:be(Number(((g.materials||{}).detailB||{}).scalePx??p.materials.detailB.scalePx),bi,xi),opacity:be(Number(((g.materials||{}).detailB||{}).opacity??p.materials.detailB.opacity),0,1)},tintOpacity:be(Number((g.materials||{}).tintOpacity??p.materials.tintOpacity),0,1),tintBlend:To((g.materials||{}).tintBlend)}}),s.current=!0},[e]),_.useEffect(()=>{l&&localStorage.setItem(Qy,JSON.stringify(l))},[l]);const h=l?.theme?.toLowerCase()||"inferno",b=_.useMemo(()=>Qi(l?.materials.tintColor||"#8b6f4a"),[l?.materials.tintColor]),y=_.useMemo(()=>Qi(l?.walls.mountainTintColor||"#8b6f4a"),[l?.walls.mountainTintColor]),S=_.useMemo(()=>{const p=new Set,g=new Set,C=new Set,N=new Set;if(!e)return{undercurrent:[],crust:[],detail:[],mountain:[]};const O=w=>{if(w){w.default&&(p.add(w.default),g.add(w.default),C.add(w.default));for(const R of Object.values(w.themes||{}))p.add(R),g.add(R),C.add(R)}};O(e.biomeLayers?.undercurrent),O(e.biomeLayers?.crust);for(const w of Object.values(e.biomePresets||{}))O(w?.biomeLayers?.undercurrent),O(w?.biomeLayers?.crust),w?.biomeMaterials?.crust?.detailA&&O(w.biomeMaterials.crust.detailA),w?.biomeMaterials?.crust?.detailB&&O(w.biomeMaterials.crust.detailB);if(e.biomeUnderlay){e.biomeUnderlay.default&&g.add(e.biomeUnderlay.default);for(const w of Object.values(e.biomeUnderlay.themes||{}))g.add(w)}e.biomeMaterials?.crust?.detailA&&O(e.biomeMaterials.crust.detailA),e.biomeMaterials?.crust?.detailB&&O(e.biomeMaterials.crust.detailB);for(const w of e.assets||[]){const R=new Set((w.tags||[]).map(W=>W.toLowerCase())),Q=w.type==="prop"&&(w.id.toLowerCase().includes("mountain")||R.has("mountain"));(R.has("floor")||R.has("stone")||R.has("void")||R.has("frozen")||R.has("inferno"))&&(g.add(w.path),C.add(w.path)),(R.has("lava")||R.has("hazard")||R.has("fire")||R.has("quicksand"))&&p.add(w.path),(w.type==="decal"||w.type==="prop"||w.type==="tile")&&C.add(w.path),Q&&N.add(w.path)}e.walls?.mountainPath&&N.add(e.walls.mountainPath);for(const w of Object.values(e.walls?.themes||{}))w?.mountainPath&&N.add(w.mountainPath);for(const w of Object.values(e.biomePresets||{})){w?.walls?.mountainPath&&N.add(w.walls.mountainPath);for(const R of Object.values(w?.walls?.themes||{}))R?.mountainPath&&N.add(R.mountainPath)}return{undercurrent:Array.from(p).sort((w,R)=>w.localeCompare(R)),crust:Array.from(g).sort((w,R)=>w.localeCompare(R)),detail:Array.from(C).sort((w,R)=>w.localeCompare(R)),mountain:Array.from(N).sort((w,R)=>w.localeCompare(R))}},[e]),v=_.useMemo(()=>{if(!e||!l)return null;const p=yl(l.undercurrent.path),g=yl(l.crust.path),C=yl(l.materials.detailA.path),N=yl(l.materials.detailB.path),O=hm(e,h),w=O?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,R=O?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),Q=O?.biomeMaterials?.crust??e.biomeMaterials?.crust,W=w||p?{...w||{default:p||g||""},default:p||w?.default||"",themes:{...w?.themes||{},[h]:p||w?.default||""},mode:l.undercurrent.mode,scalePx:be(l.undercurrent.scalePx,So,Ao),opacity:be(l.undercurrent.opacity,0,1),offsetX:l.undercurrent.offsetX,offsetY:l.undercurrent.offsetY,scroll:{x:l.undercurrent.scrollX,y:l.undercurrent.scrollY,durationMs:Math.max(1e3,l.undercurrent.scrollDurationMs)}}:void 0,j=R||g?{...R||{default:g||p||""},default:g||R?.default||"",themes:{...R?.themes||{},[h]:g||R?.default||""},mode:l.crust.mode,scalePx:Math.max(64,l.crust.scalePx),opacity:1,seedShiftPx:Math.max(0,l.crust.seedShiftPx),offsetX:l.crust.offsetX,offsetY:l.crust.offsetY}:void 0,re=C||Q?.detailA?.default||"",pe={...Q?.detailA?.themes||{}};re&&(pe[h]=re);const z=re?{...Q?.detailA||{default:re},default:re,themes:pe,mode:l.materials.detailA.mode,scalePx:be(l.materials.detailA.scalePx,bi,xi),opacity:be(l.materials.detailA.opacity,0,1)}:void 0,ue=N||Q?.detailB?.default||"",ye={...Q?.detailB?.themes||{}};ue&&(ye[h]=ue);const q=ue?{...Q?.detailB||{default:ue},default:ue,themes:ye,mode:l.materials.detailB.mode,scalePx:be(l.materials.detailB.scalePx,bi,xi),opacity:be(l.materials.detailB.opacity,0,1)}:void 0,le=String(l.materials.tintColor||"").trim()||Q?.tint?.default||"#8b6f4a",Z={...Q?.tint?.themes||{}};Z[h]=le;const P={...Q?.tint||{default:le},default:le,themes:Z,opacity:be(l.materials.tintOpacity,0,1),blendMode:To(l.materials.tintBlend)},ee=z||q||P?{...Q||{},detailA:z,detailB:q,tint:P}:void 0,Y=yl(l.walls.mountainPath),he=O?.walls,ge={...he||e.walls?.themes?.[h]||{},mountainPath:Y,scale:be(l.walls.mountainScale,.2,3),offsetX:l.walls.mountainOffsetX,offsetY:l.walls.mountainOffsetY,anchorX:be(l.walls.mountainAnchorX,0,1),anchorY:be(l.walls.mountainAnchorY,0,1),crustBlendMode:Ii(l.walls.mountainCrustBlendMode),crustBlendOpacity:be(l.walls.mountainCrustBlendOpacity,0,1),tintColor:Qi(l.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:Ii(l.walls.mountainTintBlendMode),tintOpacity:be(l.walls.mountainTintOpacity,0,1),mountainScale:be(l.walls.mountainScale,.2,3),mountainOffsetX:l.walls.mountainOffsetX,mountainOffsetY:l.walls.mountainOffsetY,mountainAnchorX:be(l.walls.mountainAnchorX,0,1),mountainAnchorY:be(l.walls.mountainAnchorY,0,1),mountainCrustBlendMode:Ii(l.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:be(l.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Qi(l.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:Ii(l.walls.mountainTintBlendMode),mountainTintOpacity:be(l.walls.mountainTintOpacity,0,1)},k={...e.walls||{},...he||{},mode:l.walls.mode,interiorDensity:be(l.walls.interiorDensity,0,.45),clusterBias:be(l.walls.clusterBias,0,1),keepPerimeter:!!l.walls.keepPerimeter,mountainPath:Y,scale:ge.scale,offsetX:ge.offsetX,offsetY:ge.offsetY,anchorX:ge.anchorX,anchorY:ge.anchorY,crustBlendMode:ge.crustBlendMode,crustBlendOpacity:ge.crustBlendOpacity,tintColor:ge.tintColor,tintBlendMode:ge.tintBlendMode,tintOpacity:ge.tintOpacity,mountainScale:ge.mountainScale,mountainOffsetX:ge.mountainOffsetX,mountainOffsetY:ge.mountainOffsetY,mountainAnchorX:ge.mountainAnchorX,mountainAnchorY:ge.mountainAnchorY,mountainCrustBlendMode:ge.mountainCrustBlendMode,mountainCrustBlendOpacity:ge.mountainCrustBlendOpacity,mountainTintColor:ge.mountainTintColor,mountainTintBlendMode:ge.mountainTintBlendMode,mountainTintOpacity:ge.mountainTintOpacity,themes:{...e.walls?.themes||{},[h]:ge}},U={...O?.biomeLayers||{},undercurrent:W,crust:j,clutter:{...O?.biomeLayers?.clutter||e.biomeLayers?.clutter||{},density:be(l.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(l.clutter.maxPerHex)),bleedScaleMax:be(l.clutter.bleedScaleMax,1,2)}},K={...O?.biomeMaterials||{},crust:ee},ne={...O||{},seed:l.seed.trim()||"biome-sandbox-seed",injectHazards:l.injectHazards,biomeLayers:U,biomeMaterials:K,walls:k};return{...e,biomeLayers:{...e.biomeLayers||{},undercurrent:W,crust:j,clutter:{...e.biomeLayers?.clutter||{},density:be(l.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(l.clutter.maxPerHex)),bleedScaleMax:be(l.clutter.bleedScaleMax,1,2)}},biomeMaterials:{...e.biomeMaterials||{},crust:ee},walls:k,biomePresets:{...e.biomePresets||{},[h]:ne}}},[e,l,h]),A=_.useMemo(()=>l?ME(l.theme,l.seed,l.injectHazards,l.walls):null,[l]),M=async()=>{if(!l)return;const p=bl(l.undercurrent.path),g=bl(l.crust.path),C=bl(l.materials.detailA.path),N=bl(l.materials.detailB.path),w={mountainPath:bl(l.walls.mountainPath),mountainScale:be(l.walls.mountainScale,.2,3),mountainOffsetX:l.walls.mountainOffsetX,mountainOffsetY:l.walls.mountainOffsetY,mountainAnchorX:be(l.walls.mountainAnchorX,0,1),mountainAnchorY:be(l.walls.mountainAnchorY,0,1),mountainCrustBlendMode:Ii(l.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:be(l.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Qi(l.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:Ii(l.walls.mountainTintBlendMode),mountainTintOpacity:be(l.walls.mountainTintOpacity,0,1),scale:be(l.walls.mountainScale,.2,3),offsetX:l.walls.mountainOffsetX,offsetY:l.walls.mountainOffsetY,anchorX:be(l.walls.mountainAnchorX,0,1),anchorY:be(l.walls.mountainAnchorY,0,1),crustBlendMode:Ii(l.walls.mountainCrustBlendMode),crustBlendOpacity:be(l.walls.mountainCrustBlendOpacity,0,1),tintColor:Qi(l.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:Ii(l.walls.mountainTintBlendMode),tintOpacity:be(l.walls.mountainTintOpacity,0,1)},R={seed:l.seed.trim()||"biome-sandbox-seed",injectHazards:l.injectHazards,biomeLayers:{undercurrent:{default:p,mode:l.undercurrent.mode,scalePx:be(l.undercurrent.scalePx,So,Ao),opacity:be(l.undercurrent.opacity,0,1),offsetX:l.undercurrent.offsetX,offsetY:l.undercurrent.offsetY,scroll:{x:l.undercurrent.scrollX,y:l.undercurrent.scrollY,durationMs:Math.max(1e3,l.undercurrent.scrollDurationMs)}},crust:{default:g,mode:l.crust.mode,scalePx:Math.max(64,l.crust.scalePx),opacity:1,seedShiftPx:l.crust.seedShiftPx,offsetX:l.crust.offsetX,offsetY:l.crust.offsetY},clutter:{density:l.clutter.density,maxPerHex:l.clutter.maxPerHex,bleedScaleMax:l.clutter.bleedScaleMax}},walls:{mode:l.walls.mode,interiorDensity:l.walls.interiorDensity,clusterBias:l.walls.clusterBias,keepPerimeter:l.walls.keepPerimeter,...w},biomeMaterials:{crust:{detailA:{default:C,mode:l.materials.detailA.mode,scalePx:be(l.materials.detailA.scalePx,bi,xi),opacity:be(l.materials.detailA.opacity,0,1)},detailB:{default:N,mode:l.materials.detailB.mode,scalePx:be(l.materials.detailB.scalePx,bi,xi),opacity:be(l.materials.detailB.opacity,0,1)},tint:{default:Qi(l.materials.tintColor,"#8b6f4a"),opacity:be(l.materials.tintOpacity,0,1),blendMode:To(l.materials.tintBlend)}}}},Q={theme:l.theme,seed:l.seed.trim()||"biome-sandbox-seed",injectHazards:l.injectHazards,biomeLayers:{undercurrent:{default:p,mode:l.undercurrent.mode,scalePx:be(l.undercurrent.scalePx,So,Ao),opacity:be(l.undercurrent.opacity,0,1),offsetX:l.undercurrent.offsetX,offsetY:l.undercurrent.offsetY,scroll:{x:l.undercurrent.scrollX,y:l.undercurrent.scrollY,durationMs:Math.max(1e3,l.undercurrent.scrollDurationMs)}},crust:{default:g,mode:l.crust.mode,scalePx:Math.max(64,l.crust.scalePx),opacity:1,seedShiftPx:l.crust.seedShiftPx,offsetX:l.crust.offsetX,offsetY:l.crust.offsetY},clutter:{density:l.clutter.density,maxPerHex:l.clutter.maxPerHex,bleedScaleMax:l.clutter.bleedScaleMax}},walls:{mode:l.walls.mode,interiorDensity:l.walls.interiorDensity,clusterBias:l.walls.clusterBias,keepPerimeter:l.walls.keepPerimeter,...w,themes:{[h]:w}},biomeMaterials:{crust:{detailA:{default:C,mode:l.materials.detailA.mode,scalePx:be(l.materials.detailA.scalePx,bi,xi),opacity:be(l.materials.detailA.opacity,0,1)},detailB:{default:N,mode:l.materials.detailB.mode,scalePx:be(l.materials.detailB.scalePx,bi,xi),opacity:be(l.materials.detailB.opacity,0,1)},tint:{default:Qi(l.materials.tintColor,"#8b6f4a"),opacity:be(l.materials.tintOpacity,0,1),blendMode:To(l.materials.tintBlend)}}},biomePresets:{[h]:R}};try{await navigator.clipboard.writeText(JSON.stringify(Q,null,2)),c("Copied"),window.setTimeout(()=>c(""),1600)}catch{c("Copy failed"),window.setTimeout(()=>c(""),1600)}};return!e||!l||!v||!A?m.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex items-center justify-center",children:[m.jsx("button",{type:"button",onClick:i,className:"absolute top-5 left-5 px-4 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-[0.2em]",children:"Back"}),m.jsx("div",{className:"text-sm text-white/70 uppercase tracking-[0.25em] font-black",children:"Loading Biome Sandbox..."})]}):m.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex",children:[m.jsxs("aside",{className:"w-[420px] border-r border-white/10 bg-[#02040a] overflow-y-auto",children:[m.jsxs("div",{className:"sticky top-0 z-20 border-b border-white/10 bg-[#02040a]/95 backdrop-blur p-4",children:[m.jsxs("div",{className:"flex items-center justify-between gap-3",children:[m.jsx("button",{type:"button",onClick:i,className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-[11px] font-black uppercase tracking-[0.18em]",children:"Back"}),m.jsx("button",{type:"button",onClick:()=>f(t0(e,l.theme)),className:"px-3 py-2 rounded-lg border border-amber-300/40 bg-amber-500/10 hover:bg-amber-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Reset"}),m.jsx("button",{type:"button",onClick:M,className:"px-3 py-2 rounded-lg border border-cyan-300/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Copy JSON"})]}),m.jsxs("div",{className:"mt-3 text-[10px] uppercase tracking-[0.22em] text-white/50",children:["Hop / Biomes ",o?`* ${o}`:""]})]}),m.jsxs("div",{className:"p-4 space-y-6",children:[m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/75",children:"Preview"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Theme"}),m.jsx("select",{value:l.theme,onChange:p=>f(g=>g&&{...g,theme:p.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:mE.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed"}),m.jsx("input",{value:l.seed,onChange:p=>f(g=>g&&{...g,seed:p.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[m.jsx("input",{type:"checkbox",checked:l.injectHazards,onChange:p=>f(g=>g&&{...g,injectHazards:p.target.checked})}),"Inject synthetic lava/fire patches for mask testing"]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-cyan-200",children:"Undercurrent"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),m.jsx("input",{list:"sandbox-undercurrent-paths",value:l.undercurrent.path,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,path:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-undercurrent-paths",children:S.undercurrent.map(p=>m.jsx("option",{value:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),m.jsx("select",{value:l.undercurrent.mode,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:su.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),m.jsx("input",{type:"number",min:So,max:Ao,step:16,value:l.undercurrent.scalePx,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scalePx:be(St(p.target.value,g.undercurrent.scalePx),So,Ao)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.undercurrent.opacity,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,opacity:be(St(p.target.value,g.undercurrent.opacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll X"}),m.jsx("input",{type:"number",step:5,value:l.undercurrent.scrollX,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollX:St(p.target.value,g.undercurrent.scrollX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll Y"}),m.jsx("input",{type:"number",step:5,value:l.undercurrent.scrollY,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollY:St(p.target.value,g.undercurrent.scrollY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Duration"}),m.jsx("input",{type:"number",min:1e3,step:500,value:l.undercurrent.scrollDurationMs,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollDurationMs:Math.max(1e3,St(p.target.value,g.undercurrent.scrollDurationMs))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:4,value:l.undercurrent.offsetX,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,offsetX:St(p.target.value,g.undercurrent.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:4,value:l.undercurrent.offsetY,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,offsetY:St(p.target.value,g.undercurrent.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-amber-200",children:"Crust"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),m.jsx("input",{list:"sandbox-crust-paths",value:l.crust.path,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,path:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-crust-paths",children:S.crust.map(p=>m.jsx("option",{value:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),m.jsx("select",{value:l.crust.mode,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:su.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),m.jsx("input",{type:"number",min:64,step:16,value:l.crust.scalePx,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,scalePx:Math.max(64,St(p.target.value,g.crust.scalePx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),m.jsx("input",{type:"number",min:1,max:1,step:.01,value:1,onChange:()=>f(p=>p&&{...p,crust:{...p.crust,opacity:1}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed Shift Budget"}),m.jsx("input",{type:"number",min:0,step:8,value:l.crust.seedShiftPx,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,seedShiftPx:Math.max(0,St(p.target.value,g.crust.seedShiftPx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:4,value:l.crust.offsetX,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,offsetX:St(p.target.value,g.crust.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:4,value:l.crust.offsetY,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,offsetY:St(p.target.value,g.crust.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-rose-200",children:"Walls / Mountains"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mountain Asset"}),m.jsx("input",{list:"sandbox-mountain-paths",value:l.walls.mountainPath,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainPath:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs",placeholder:"/assets/biomes/biome.volcano.mountain.01.webp"}),m.jsx("datalist",{id:"sandbox-mountain-paths",children:S.mountain.map(p=>m.jsx("option",{value:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale"}),m.jsx("input",{type:"number",min:.2,max:3,step:.01,value:l.walls.mountainScale,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainScale:be(St(p.target.value,g.walls.mountainScale),.2,3)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor X"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.walls.mountainAnchorX,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainAnchorX:be(St(p.target.value,g.walls.mountainAnchorX),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:2,value:l.walls.mountainOffsetX,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainOffsetX:St(p.target.value,g.walls.mountainOffsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:2,value:l.walls.mountainOffsetY,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainOffsetY:St(p.target.value,g.walls.mountainOffsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor Y"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.walls.mountainAnchorY,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainAnchorY:be(St(p.target.value,g.walls.mountainAnchorY),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Crust Blend"}),m.jsx("select",{value:l.walls.mountainCrustBlendMode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainCrustBlendMode:Ii(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Jy.map(p=>m.jsx("option",{value:p,children:p},`mountain-blend-${p}`))})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Blend Opacity ",l.walls.mountainCrustBlendOpacity.toFixed(2)]}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.walls.mountainCrustBlendOpacity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainCrustBlendOpacity:be(St(p.target.value,g.walls.mountainCrustBlendOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Mountain Tint"}),m.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[m.jsx("input",{type:"color",value:y,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintColor:p.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Mountain Tint Color Picker"}),m.jsx("input",{value:l.walls.mountainTintColor,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintColor:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Tint Blend"}),m.jsx("select",{value:l.walls.mountainTintBlendMode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintBlendMode:Ii(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Jy.map(p=>m.jsx("option",{value:p,children:p},`mountain-tint-blend-${p}`))})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",l.walls.mountainTintOpacity.toFixed(2)]}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.walls.mountainTintOpacity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintOpacity:be(St(p.target.value,g.walls.mountainTintOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Wall Layout Mode"}),m.jsx("select",{value:l.walls.mode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:gE.map(p=>m.jsx("option",{value:p,children:p},`wall-mode-${p}`))}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Interior Density ",l.walls.interiorDensity.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:.45,step:.01,value:l.walls.interiorDensity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,interiorDensity:be(St(p.target.value,g.walls.interiorDensity),0,.45)}}),className:"w-full"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Cluster Bias ",l.walls.clusterBias.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:1,step:.01,value:l.walls.clusterBias,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,clusterBias:be(St(p.target.value,g.walls.clusterBias),0,1)}}),className:"w-full"})]}),m.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[m.jsx("input",{type:"checkbox",checked:l.walls.keepPerimeter,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,keepPerimeter:p.target.checked}})}),"Keep perimeter walls (custom mode)"]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-fuchsia-200",children:"Crust Materials"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Detail A"}),m.jsx("input",{list:"sandbox-detail-paths",value:l.materials.detailA.path,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,path:p.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-detail-paths",children:S.detail.map(p=>m.jsx("option",{value:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsx("select",{value:l.materials.detailA.mode,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,mode:p.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:su.map(p=>m.jsx("option",{value:p,children:p},`detail-a-${p}`))}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.materials.detailA.opacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,opacity:be(St(p.target.value,g.materials.detailA.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsx("input",{type:"number",min:bi,max:xi,step:16,value:l.materials.detailA.scalePx,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,scalePx:be(St(p.target.value,g.materials.detailA.scalePx),bi,xi)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Detail B"}),m.jsx("input",{list:"sandbox-detail-paths",value:l.materials.detailB.path,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,path:p.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsx("select",{value:l.materials.detailB.mode,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,mode:p.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:su.map(p=>m.jsx("option",{value:p,children:p},`detail-b-${p}`))}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.materials.detailB.opacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,opacity:be(St(p.target.value,g.materials.detailB.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsx("input",{type:"number",min:bi,max:xi,step:16,value:l.materials.detailB.scalePx,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,scalePx:be(St(p.target.value,g.materials.detailB.scalePx),bi,xi)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Tint"}),m.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[m.jsx("input",{type:"color",value:b,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Tint Color Picker"}),m.jsx("input",{value:l.materials.tintColor,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),m.jsx("div",{className:"grid grid-cols-8 gap-2",children:hE.map(p=>m.jsx("button",{type:"button",onClick:()=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p}}),className:`h-6 rounded border ${Qi(l.materials.tintColor)===Qi(p)?"border-white":"border-white/20"}`,style:{backgroundColor:p},title:p},`tint-swatch-${p}`))}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",l.materials.tintOpacity.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:1,step:.01,value:l.materials.tintOpacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintOpacity:be(St(p.target.value,g.materials.tintOpacity),0,1)}}),className:"w-full"})]}),m.jsx("select",{value:l.materials.tintBlend,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintBlend:To(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:pE.map(p=>m.jsx("option",{value:p,children:p},`blend-${p}`))})]}),m.jsxs("section",{className:"space-y-3 pb-8",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-emerald-200",children:"Clutter"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Density"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:l.clutter.density,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,density:be(St(p.target.value,g.clutter.density),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Max / Hex"}),m.jsx("input",{type:"number",min:0,max:5,step:1,value:l.clutter.maxPerHex,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,maxPerHex:Math.max(0,Math.floor(St(p.target.value,g.clutter.maxPerHex)))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Bleed Max"}),m.jsx("input",{type:"number",min:1,max:2,step:.01,value:l.clutter.bleedScaleMax,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,bleedScaleMax:be(St(p.target.value,g.clutter.bleedScaleMax),1,2)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]})]})]}),m.jsxs("main",{className:"flex-1 relative bg-[#050914] overflow-hidden",children:[m.jsxs("div",{className:"absolute top-4 right-5 z-20 px-3 py-2 rounded-lg border border-white/15 bg-black/35 text-[10px] font-black uppercase tracking-[0.2em]",children:["Theme: ",l.theme]}),m.jsx("div",{className:"w-full h-full p-6",children:m.jsx("div",{className:"w-full h-full rounded-[28px] border border-white/10 bg-[#030712]/70 overflow-hidden",children:m.jsx(j0,{gameState:A,onMove:()=>{},selectedSkillId:null,showMovementRange:!1,assetManifest:v})})})]})]})},kE=e=>{const{gameStatus:i,isReplayMode:s,isBusy:o,postCommitInputLock:c,isPlayerTurn:l,hasPendingStatus:f,pendingFrameCount:h}=e,b=f||h>0;let y="IDLE";return s?y="REPLAY":i!=="playing"?y="IDLE":b?y=o?"INTERCEPT_ANIMATING":"INTERCEPT_READY":o?y="PLAYBACK":c&&l?y="POST_COMMIT_LOCK":c&&!l?y="POST_COMMIT_QUEUE":l?y="INPUT_OPEN":y="QUEUE_ADVANCE",{phase:y,canPlayerInput:y==="INPUT_OPEN",shouldAdvanceQueue:y==="QUEUE_ADVANCE"||y==="POST_COMMIT_QUEUE",shouldResolvePending:y==="INTERCEPT_READY",queueAdvanceDelayMs:380}},RE=e=>{const i=e.payload;if(!(!i||typeof i!="object")){if("q"in i&&"r"in i)return{q:Number(i.q??0),r:Number(i.r??0),s:Number(i.s??0)};if(e.type==="USE_SKILL"){const s=i;return{skillId:s.skillId??"unknown",target:s.target?{q:s.target.q,r:s.target.r,s:s.target.s}:null}}if(e.type==="START_RUN")return{loadoutId:i.loadoutId??"unknown",mode:i.mode??"normal"};if(e.type==="LOAD_STATE"){const s=i;return{floor:s?.floor??0,gameStatus:s?.gameStatus??"unknown",turnNumber:s?.turnNumber??0,queueLength:Array.isArray(s?.initiativeQueue)?s.initiativeQueue.length:0}}return{}}};function NE(){const e=(X,se)=>{const fe=new Set(X.map(pt=>pt.type)),we=fe.has("ADVANCE_TURN"),Oe=fe.has("RESOLVE_PENDING"),mt=X.length,Ke=se>=5&&mt<Math.max(25,se*4);return{actionCount:mt,hasTurnAdvance:we,hasPendingResolve:Oe,suspiciouslyShort:Ke}},i=X=>{const se=X||[],fe=se.length>0?se[se.length-1]:void 0;return`${se.length}:${fe?.type??"none"}`},s=X=>{const se=X||[],fe=se.length>0?se[se.length-1]:void 0;return`${se.length}:${fe?.id??"none"}:${fe?.phase??"none"}`},[o,c]=_.useState(()=>window.location.pathname);_.useEffect(()=>{const X=()=>c(window.location.pathname);return window.addEventListener("popstate",X),()=>window.removeEventListener("popstate",X)},[]);const l=X=>{window.location.pathname!==X&&window.history.pushState({},"",X),c(X)},f=o.toLowerCase().startsWith("/hop")?"/Hop":"",h=`${f||""}`||"/",b=`${f}/Arcade`||"/Arcade",y=`${f}/Biomes`||"/Biomes",v=o.toLowerCase().replace(/\/+$/,""),A=v.endsWith("/arcade")||v.endsWith("/arcarde"),M=v.endsWith("/biomes"),[p,g]=_.useReducer(UT,null,()=>{const X=localStorage.getItem("hop_save");if(X)try{const se=JSON.parse(X);if(se.tiles){const Oe=Array.isArray(se.tiles)?se.tiles:Object.entries(se.tiles);se.tiles=new Map(Oe.map(([mt,Ke])=>[mt,{...Ke,traits:new Set(Ke.traits)}]))}Array.isArray(se.occupancyMask)&&(se.occupancyMask=se.occupancyMask.map(Oe=>typeof Oe=="string"?BigInt(Oe):Oe));const fe=Oe=>Oe instanceof Map?Oe:Array.isArray(Oe)?new Map(Oe):Oe&&typeof Oe=="object"?new Map(Object.entries(Oe)):new Map,we=Oe=>{const mt={...Oe,components:fe(Oe?.components)},Ke=Al(mt),It=(Ke.components??new Map).get("trinity");if(!It)return Ke;const yt=xu({body:Number(It.body||0),mind:Number(It.mind||0),instinct:Number(It.instinct||0)});return{...Ke,maxHp:yt,hp:Math.min(yt,Math.max(0,Number(Ke.hp??yt)))}};return se.player=em(we(se.player)),se.enemies=Array.isArray(se.enemies)?se.enemies.map(we):[],se}catch(se){console.error("Failed to hydrate Map state:",se)}return im()}),C=typeof window<"u"&&!!window.__HOP_DEBUG_QUERY,[N,O]=_.useState(null);_.useEffect(()=>{let X=!0;return P1().then(se=>{X&&(O(se),window.__HOP_ASSET_MANIFEST=se)}),()=>{X=!1}},[]),_.useEffect(()=>{C&&(window.state=p,window.QUERY={tile:(X,se)=>{const we=Te({q:X,r:se});return console.log(`Checking Map for Key: "${we}"`),p.tiles.get(we)},whereAmI:()=>{const X=p.player.position,se=Te(X),fe=p.tiles.get(se);return{coords:X,key:se,tileExists:!!fe,tileData:fe}},dumpKeys:()=>Array.from(p.tiles.keys())})},[p,C]);const w=_.useRef(null),R=_.useRef(""),Q=p.gameStatus==="playing"||p.gameStatus==="choosing_upgrade",W=`${p.gameStatus}|${p.floor}|${p.turnNumber}|${p.player.hp}|${Te(p.player.position)}|${p.enemies.length}|${p.actionLog?.length??0}|${p.message?.length??0}`;_.useEffect(()=>{if(w.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(w.current):window.clearTimeout(w.current),w.current=null),!Q){R.current="",localStorage.removeItem("hop_save");return}if(W===R.current)return;const X=()=>{const se={...p,tiles:Array.from(p.tiles.entries()).map(([we,Oe])=>[we,{...Oe,traits:Array.from(Oe.traits)}])},fe=we=>JSON.stringify(we,(Oe,mt)=>typeof mt=="bigint"?mt.toString():mt);localStorage.setItem("hop_save",fe(se)),R.current=W,w.current=null};return typeof window.requestIdleCallback=="function"?w.current=window.requestIdleCallback(X,{timeout:500}):w.current=window.setTimeout(X,120),()=>{w.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(w.current):window.clearTimeout(w.current),w.current=null)}},[p,Q,W]);const[j,re]=_.useState(!1),[pe,z]=_.useState([]),[ue,ye]=_.useState(!1),[q,le]=_.useState(null),Z=_.useRef(0),P=_.useRef(null);_.useEffect(()=>{if(!(typeof window<"u"&&!!window.__HOP_DEBUG_PERF))return;let se=0,fe=performance.now(),we=0,Oe=0,mt=fe;const Ke=pt=>{const It=pt-fe;if(fe=pt,we++,Oe+=It,pt-mt>=2e3){const yt=Oe/Math.max(1,we),Lt=1e3/Math.max(1,yt);console.log("[HOP_PERF]",{fps:Number(Lt.toFixed(1)),avgFrameMs:Number(yt.toFixed(2)),frames:we}),mt=pt,we=0,Oe=0}se=requestAnimationFrame(Ke)};return se=requestAnimationFrame(Ke),()=>cancelAnimationFrame(se)},[p.gameStatus,j]);const[ee,Y]=_.useState(null),[he,ge]=_.useState(!1),[k,U]=_.useState(!1),[K,ne]=_.useState(!1),[xe,Ie]=_.useState(0),Se=_.useRef(null),nt=_.useRef(null),He=_.useRef(null),ze=_.useRef(null),Qt=p.pendingFrames?.length??0,Le=_.useMemo(()=>kE({gameStatus:p.gameStatus,isReplayMode:j,isBusy:k,postCommitInputLock:K,isPlayerTurn:xl(p),hasPendingStatus:!!p.pendingStatus,pendingFrameCount:Qt}),[p.gameStatus,j,k,K,p.pendingStatus,Qt,p.initiativeQueue,p.player.id,p.enemies]),At=!Le.canPlayerInput,ft=_.useRef([]),qn=_.useRef(0),Dt=_.useRef(""),zn=p.initiativeQueue?.entries?.[Math.max(0,p.initiativeQueue.currentIndex??0)]?.actorId??p.initiativeQueue?.entries?.[0]?.actorId??"none",ct=_.useCallback((X,se)=>{const fe={id:++qn.current,t:Date.now(),event:X,turnNumber:p.turnNumber,phase:Le.phase,gameStatus:p.gameStatus,playerTurn:xl(p),isBusy:k,postCommitInputLock:K,pendingStatus:p.pendingStatus?.status??"none",pendingFrames:p.pendingFrames?.length??0,canPlayerInput:Le.canPlayerInput,shouldAdvanceQueue:Le.shouldAdvanceQueue,shouldResolvePending:Le.shouldResolvePending,actionLogLength:p.actionLog?.length??0,queueHead:zn,details:se};ft.current.push(fe),ft.current.length>800&&ft.current.splice(0,ft.current.length-800)},[p.turnNumber,p.gameStatus,p.pendingStatus,p.pendingFrames,p.actionLog,p.initiativeQueue,p.player.id,p.enemies,Le.phase,Le.canPlayerInput,Le.shouldAdvanceQueue,Le.shouldResolvePending,k,K,zn]),Mt=_.useCallback((X,se)=>{ct("DISPATCH",{source:se,actionType:X.type,payload:RE(X)}),g(X)},[ct]);_.useEffect(()=>{const X=[Le.phase,p.turnNumber,p.gameStatus,p.pendingStatus?.status??"none",p.pendingFrames?.length??0,k?1:0,K?1:0,zn].join("|");X!==Dt.current&&(ct("TURN_STATE"),Dt.current=X)},[Le.phase,p.turnNumber,p.gameStatus,p.pendingStatus,p.pendingFrames,k,K,zn,ct]),_.useEffect(()=>(window.__HOP_TURN_TRACE=ft.current,window.__HOP_DUMP_TURN_TRACE=()=>[...ft.current],window.__HOP_PRINT_TURN_TRACE=(X=80)=>{const se=ft.current.slice(-Math.max(1,Math.floor(X)));return console.table(se.map(fe=>({id:fe.id,event:fe.event,turn:fe.turnNumber,phase:fe.phase,status:fe.gameStatus,playerTurn:fe.playerTurn,busy:fe.isBusy,lock:fe.postCommitInputLock,pending:`${fe.pendingStatus}/${fe.pendingFrames}`,queueHead:fe.queueHead,actionLog:fe.actionLogLength,details:fe.details?JSON.stringify(fe.details):""}))),se},window.__HOP_CLEAR_TURN_TRACE=()=>{ft.current.length=0,qn.current=0},ft.current.push({id:++qn.current,t:Date.now(),event:"TRACE_READY",turnNumber:0,phase:"INIT",gameStatus:"init",playerTurn:!1,isBusy:!1,postCommitInputLock:!1,pendingStatus:"none",pendingFrames:0,canPlayerInput:!1,shouldAdvanceQueue:!1,shouldResolvePending:!1,actionLogLength:0,queueHead:"none"}),()=>{delete window.__HOP_DUMP_TURN_TRACE,delete window.__HOP_PRINT_TURN_TRACE,delete window.__HOP_CLEAR_TURN_TRACE}),[]);const an=_.useRef([]),Zn=_.useRef(null),vi=_.useRef(""),[Si,wn]=_.useState([]),ya=_.useCallback(X=>{const se=Date.now();wn(fe=>[...fe,{...X,createdAt:se}].slice(-4))},[]),Nn=_.useCallback(X=>{if(!(!X||X.length===0)){an.current=[...an.current,...X].slice(-600),window.__HOP_SIM_EVENTS=an.current,window.dispatchEvent(new CustomEvent("hop:simulation-events",{detail:{turn:p.turnNumber,events:X}})),ct("SIM_EVENTS",{count:X.length,lastType:X[X.length-1]?.type??"unknown"});for(const se of X)if(se.type==="DamageTaken"&&se.targetId===p.player.id){const fe=Math.max(0,Number(se.payload?.amount||0));fe>0&&ya({id:`sim-toast-${se.id}`,text:`-${fe} HP`,tone:"damage"})}else if(se.type==="Healed"&&se.targetId===p.player.id){const fe=Math.max(0,Number(se.payload?.amount||0));fe>0&&ya({id:`sim-toast-${se.id}`,text:`+${fe} HP`,tone:"heal"})}else if(se.type==="StatusApplied"&&se.targetId===p.player.id){const we=String(se.payload?.status||"Status").split("_").filter(Boolean).map(Oe=>Oe.charAt(0).toUpperCase()+Oe.slice(1)).join(" ");ya({id:`sim-toast-${se.id}`,text:we,tone:"status"})}else if(se.type==="MessageLogged"){const fe=String(se.payload?.text||"").trim();if(!fe)continue;const we=fe.toLowerCase();if(!(we.includes("stun")||we.includes("snare")||we.includes("lava")||we.includes("fire")||we.includes("burn")||we.includes("heal")||we.includes("shrine")||we.includes("stairs")||we.includes("roll away")||we.includes("ward")||we.includes("orb")))continue;const mt=fe.length>52?`${fe.slice(0,49)}...`:fe;ya({id:`sim-toast-${se.id}`,text:mt,tone:"system"})}}},[ct,p.turnNumber,p.player.id,ya]),dn=_.useCallback(X=>{Zn.current=X,window.__HOP_UI_MIRROR=X},[]);_.useEffect(()=>(window.__HOP_SIM_EVENTS=an.current,window.__HOP_DUMP_SIM_EVENTS=()=>[...an.current],window.__HOP_CLEAR_SIM_EVENTS=()=>{an.current=[],window.__HOP_SIM_EVENTS=[]},window.__HOP_DUMP_MIRROR=()=>window.__HOP_MIRROR_LAST,()=>{delete window.__HOP_DUMP_SIM_EVENTS,delete window.__HOP_CLEAR_SIM_EVENTS,delete window.__HOP_DUMP_MIRROR}),[]),_.useEffect(()=>{if(Si.length===0)return;const X=window.setTimeout(()=>{const se=Date.now();wn(fe=>fe.filter(we=>se-we.createdAt<2200))},180);return()=>window.clearTimeout(X)},[Si]),_.useEffect(()=>{const X=WT(p);window.__HOP_ENGINE_MIRROR=X;const se=Zn.current;if(!se||se.turn!==X.turn||se.stackTick!==X.stackTick)return;const fe=XT(X,se),we=`${X.turn}:${X.stackTick}:${fe.ok?"ok":fe.mismatches.length}`;we!==vi.current&&(vi.current=we,window.__HOP_MIRROR_LAST={engineSnapshot:X,uiSnapshot:se,result:fe},fe.ok||(ct("MIRROR_MISMATCH",{count:fe.mismatches.length}),console.warn("[HOP_MIRROR] snapshot mismatch detected",fe.mismatches)))},[p,ct]),_.useEffect(()=>{if(!Le.shouldAdvanceQueue)return;ct("QUEUE_SCHEDULE",{delayMs:Le.queueAdvanceDelayMs});const X=window.setTimeout(()=>{Mt({type:"ADVANCE_TURN"},"queue_pump")},Le.queueAdvanceDelayMs);return()=>window.clearTimeout(X)},[Le.shouldAdvanceQueue,Le.queueAdvanceDelayMs,p.turnNumber,p.initiativeQueue,p.player.id,p.enemies,Mt,ct]);const Ft=(X="unknown")=>{K&&ct("LOCK_RELEASE",{reason:X,lockTurn:Se.current,expectedActionLogLength:nt.current}),ne(!1),Se.current=null,nt.current=null,He.current=null,sn.current=!1,ke.current="",ut.current="",ze.current!==null&&(window.clearTimeout(ze.current),ze.current=null)},Hi=_.useRef(""),fn=i(p.visualEvents),ea=_.useRef(""),ei=s(p.timelineEvents),sn=_.useRef(!1),ke=_.useRef(""),ut=_.useRef(""),et=220,ti=900,mn=_.useRef(!1),Jt=_.useRef(0),ta=`${p.pendingStatus?.status??"none"}:${Qt}`;_.useEffect(()=>{k||(Hi.current=fn,ea.current=ei)},[k,fn,ei]),_.useEffect(()=>{mn.current=!1,Jt.current=performance.now()},[ta]),_.useEffect(()=>{(p.pendingStatus||Qt>0)&&k&&(mn.current=!0)},[p.pendingStatus,Qt,k]),_.useEffect(()=>{K&&k&&(sn.current=!0)},[K,k]),_.useEffect(()=>{if(!K)return;const X=window.setTimeout(()=>{Ie(se=>se+1)},120);return()=>window.clearTimeout(X)},[K,xe]),_.useEffect(()=>{const X=!k&&fn===Hi.current&&ei===ea.current,se=(p.timelineEvents||[]).some(Lt=>Lt.blocking),fe=(p.timelineEvents||[]).filter(Lt=>Lt.blocking).reduce((Lt,Mn)=>Lt+(Mn.suggestedDurationMs||0),0),we=(p.visualEvents||[]).reduce((Lt,Mn)=>{if(Mn.type!=="kinetic_trace")return Lt;const Ti=Mn.payload;if(!Ti)return Lt;const Pt=Math.max(0,Number(Ti.startDelayMs||0)),$n=Math.max(0,Number(Ti.durationMs||0));return Math.max(Lt,Pt+$n)},0),Oe=Math.max(fe,we),mt=Oe>0?Math.max(160,Math.min(3200,Oe+40)):0,Ke=Math.max(0,performance.now()-Jt.current),pt=!se||mn.current,It=!se||Ke>=mt,yt=X&&(pt||It);if(Le.shouldResolvePending){if(yt){ct("PENDING_RESOLVE_READY",{noPendingAnimations:X,hasBlockingTimeline:se,movementTraceBudgetMs:we,elapsedPendingMs:Ke,requiredFallbackDelayMs:mt}),Mt({type:"RESOLVE_PENDING"},"pending_ready");return}if(!k&&se&&!mn.current){ct("PENDING_RESOLVE_WAIT",{movementTraceBudgetMs:we,elapsedPendingMs:Ke,requiredFallbackDelayMs:mt});const Lt=Math.max(0,mt-Ke),Mn=window.setTimeout(()=>{Mt({type:"RESOLVE_PENDING"},"pending_fallback_delay")},Lt);return()=>window.clearTimeout(Mn)}}},[Le.shouldResolvePending,p.timelineEvents,p.visualEvents,k,fn,ei,Mt,ct]),_.useEffect(()=>{if(!K)return;if(j||p.gameStatus!=="playing"){Ft("mode_or_status_change");return}if(p.pendingStatus||(p.pendingFrames?.length??0)>0){Ft("pending_intercept");return}const X=Se.current,se=nt.current,fe=He.current!==null?Math.max(0,performance.now()-He.current):Number.POSITIVE_INFINITY,we=X!==null?p.turnNumber>X:!1,Oe=se!==null?(p.actionLog?.length??0)>=se:!1,mt=fe>=et,Ke=fn!==ke.current||ei!==ut.current,pt=!we&&!Oe,It=!sn.current&&Ke&&fe<ti,yt=p.gameStatus==="playing"&&!j&&!k&&!p.pendingStatus&&(p.pendingFrames?.length??0)===0&&xl(p);if(It){ct("LOCK_WAIT_FOR_BUSY",{lockAgeMs:fe,visualsChangedSinceArm:Ke});return}if(yt&&pt&&fe>450){Ft("no_progress_timeout");return}yt&&mt&&(we||Oe||fe>1500)&&Ft(we?"turn_advanced":Oe?"action_committed":"age_fallback")},[K,j,p.gameStatus,p.turnNumber,p.pendingStatus,p.pendingFrames,p.initiativeQueue,p.actionLog,k,p.player.id,p.enemies,ct,fn,ei,xe]),_.useEffect(()=>{p.gameStatus!=="playing"&&K&&Ft("not_playing")},[p.gameStatus,K,ct]),_.useEffect(()=>{if(K)return ze.current!==null&&window.clearTimeout(ze.current),ze.current=window.setTimeout(()=>{K&&(console.error("[HOP_INPUT_LOCK] Watchdog released stuck post-commit lock",{turnNumber:p.turnNumber,pendingStatus:p.pendingStatus?.status,pendingFrames:p.pendingFrames?.length??0,playerTurn:xl(p),isBusy:k,actionLogLength:p.actionLog?.length??0,traceTail:ft.current.slice(-40)}),ct("LOCK_WATCHDOG_RELEASE"),Ft("watchdog"))},8e3),()=>{ze.current!==null&&(window.clearTimeout(ze.current),ze.current=null)}},[K,p.turnNumber,p.pendingStatus,p.actionLog,k,p.initiativeQueue,p.player.id,p.enemies,ct]),_.useEffect(()=>{if(!K)return;const X=window.setTimeout(()=>{ct("LOCK_STALL_SNAPSHOT",{lockAgeMs:He.current!==null?Math.max(0,performance.now()-He.current):null})},2500);return()=>window.clearTimeout(X)},[K,ct]);const[pn,In]=_.useState(null),[Ln,Nt]=_.useState(null),hn=_.useRef(p.floor);_.useEffect(()=>{if(p.gameStatus==="playing"&&p.floor!==hn.current){Nt({floor:p.floor,theme:p.theme||"Inferno"}),hn.current=p.floor;const X=setTimeout(()=>Nt(null),3e3);return()=>clearTimeout(X)}},[p.floor,p.gameStatus,p.theme]),_.useEffect(()=>{if(p.gameStatus==="playing"&&p.floor===1&&!hn.current){Nt({floor:1,theme:p.theme||"Inferno"}),hn.current=1;const X=setTimeout(()=>Nt(null),3e3);return()=>clearTimeout(X)}},[p.gameStatus]);const Bn=()=>{ze.current!==null&&(window.clearTimeout(ze.current),ze.current=null),Se.current=p.turnNumber,nt.current=(p.actionLog?.length??0)+1,He.current=performance.now(),sn.current=!1,ke.current=fn,ut.current=ei,ne(!0),ct("LOCK_ARM",{lockTurn:p.turnNumber,expectedActionLogLength:(p.actionLog?.length??0)+1,eventHashAtArm:fn,timelineHashAtArm:ei})},na=X=>{At||Y(X)},ba=X=>{if(!At){if(ee){Bn(),Mt({type:"USE_SKILL",payload:{skillId:ee,target:X}},"player_use_skill"),Y(null);return}if(ae(X,p.player.position)){ge(!he);return}Bn(),Mt({type:"MOVE",payload:X},"player_move"),ge(!1)}},Ai=X=>{j||k||Mt({type:"SELECT_UPGRADE",payload:X},"upgrade_select")},ji=()=>{Mt({type:"RESET"},"reset"),Y(null),re(!1),le(null)},Di=()=>{At||(Bn(),Mt({type:"WAIT"},"player_wait"),Y(null))},xa=X=>{if(!X)return;const se=vy(X.actions||[]);if(!se.valid){const mt=`Replay rejected: ${se.errors.slice(0,3).join(" | ")}`;le(mt),console.error("[HOP_REPLAY] Invalid replay actions",{replayId:X.id,errors:se.errors});return}le(null),re(!0),z(se.actions),ye(!1),Z.current=0;const fe=X.seed||X.id||String(Date.now()),we=X.loadoutId?hr[X.loadoutId]:void 0,Oe=ns(1,fe,fe,void 0,we);Mt({type:"LOAD_STATE",payload:Oe},"replay_start")},ka=()=>{const X=Z.current;if(X>=pe.length){ye(!1);return}Mt(pe[X],"replay_step"),Z.current=X+1};_.useEffect(()=>{if(!ue||!j)return;const X=window.setInterval(ka,500);return()=>window.clearInterval(X)},[ue,j,pe]);const $s=()=>{re(!1),le(null),ni()},Vs=(X,se)=>{Mt({type:"LOAD_STATE",payload:X},"scenario_load"),In(se),Y(null)},ni=()=>{Mt({type:"EXIT_TO_HUB"},"exit_to_hub"),Y(null),re(!1),le(null),l(h)};_.useEffect(()=>{if(!j){if((p.gameStatus==="won"||p.gameStatus==="lost")&&P.current!==p.initialSeed){P.current=p.initialSeed||"default";const X=p.initialSeed??p.rngSeed??"0",se=p.completedRun?.score||(p.player.hp||0)+(p.floor||0)*100,fe=vy(p.actionLog||[]);if(!fe.valid){console.error("[HOP_REPLAY] Refusing to persist replay with invalid action log",{errors:fe.errors});return}const we=e(fe.actions,p.floor||0),Oe={id:`run-${Date.now()}`,seed:X,loadoutId:p.player.archetype,actions:fe.actions,score:se,floor:p.floor,date:new Date().toISOString(),replayVersion:2,diagnostics:we},mt=localStorage.getItem("hop_replays_v1"),Ke=mt?JSON.parse(mt):[],pt=[Oe,...Ke].slice(0,100);localStorage.setItem("hop_replays_v1",JSON.stringify(pt));const It=localStorage.getItem("hop_leaderboard_v1");let yt=It?JSON.parse(It):[];yt.push({id:Oe.id,name:"Player",score:Oe.score,floor:Oe.floor,date:Oe.date,seed:Oe.seed,loadoutId:Oe.loadoutId,actions:Oe.actions,replayVersion:Oe.replayVersion,diagnostics:Oe.diagnostics}),yt.sort((Lt,Mn)=>Mn.score-Lt.score),yt=yt.slice(0,5),localStorage.setItem("hop_leaderboard_v1",JSON.stringify(yt))}p.gameStatus==="hub"&&(P.current=null)}},[p.gameStatus,j,p.initialSeed]);const gn=X=>{const se=p.selectedLoadoutId;if(!se){console.warn("Start Run called without a selected loadout.");return}Mt({type:"START_RUN",payload:{loadoutId:se,mode:X}},"hub_start_run")},ii=X=>{Mt({type:"START_RUN",payload:{loadoutId:X,mode:"daily"}},"arcade_start_run"),l(h)};return M?m.jsx(CE,{assetManifest:N,onBack:()=>l(h)}):p.gameStatus==="hub"?m.jsxs("div",{className:"w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[!A&&m.jsx("button",{type:"button",onClick:()=>l(y),className:"absolute top-4 right-4 z-40 px-4 py-2 rounded-xl border border-cyan-300/35 bg-cyan-500/10 hover:bg-cyan-500/20 text-[10px] font-black uppercase tracking-[0.2em]",children:"Biome Sandbox"}),A?m.jsx(fE,{onBack:()=>l(h),onLaunchArcade:ii}):m.jsx(lE,{gameState:p,onSelectLoadout:X=>{Mt({type:"APPLY_LOADOUT",payload:X},"hub_select_loadout")},onStartRun:gn,onOpenArcade:()=>l(b),onLoadScenario:Vs,onStartReplay:xa}),q&&m.jsx("div",{className:"absolute top-4 right-4 z-40 max-w-xl px-4 py-3 rounded-xl border border-red-400/40 bg-red-900/70 text-red-100 text-xs font-bold tracking-wide",children:q}),pn&&m.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[m.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),m.jsx("p",{className:"text-white text-sm",children:pn}),m.jsx("button",{onClick:()=>In(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]})]}):m.jsxs("div",{className:"flex flex-col lg:flex-row w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[m.jsx("div",{className:"lg:hidden shrink-0 border-b border-white/5 bg-[#030712]/95 backdrop-blur-sm z-20",children:m.jsxs("div",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"min-w-0",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"Level"}),m.jsxs("div",{className:"text-lg font-black text-white leading-none",children:[p.floor,m.jsx("span",{className:"text-white/25 text-sm ml-1",children:"/ 10"})]})]}),m.jsxs("div",{className:"ml-auto min-w-0 text-right",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"HP"}),m.jsxs("div",{className:"text-lg font-black text-red-400 leading-none",children:[p.player.hp,m.jsxs("span",{className:"text-white/25 text-sm ml-1",children:["/ ",p.player.maxHp]})]})]})]})}),m.jsx("aside",{className:"hidden lg:flex w-80 border-r border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:m.jsx(nE,{gameState:p,onReset:ji,onWait:Di,onExitToHub:ni,inputLocked:At})}),m.jsx("main",{className:"flex-1 min-h-0 relative flex items-center justify-center bg-[#020617] overflow-hidden",children:m.jsx("div",{className:"w-full h-full p-0 sm:p-3 lg:p-8 flex items-center justify-center",children:m.jsxs("div",{className:`w-full h-full relative border border-white/5 bg-[#030712]/50 rounded-none sm:rounded-3xl lg:rounded-[40px] shadow-[inset_0_0_100px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden ${p.isShaking?"animate-shake":""}`,children:[m.jsx(j0,{gameState:p,onMove:ba,selectedSkillId:ee,showMovementRange:he,onBusyStateChange:U,assetManifest:N,onSimulationEvents:Nn,onMirrorSnapshot:dn}),At&&p.gameStatus==="playing"&&m.jsx("div",{className:"absolute inset-0 z-40 pointer-events-auto",children:m.jsx("div",{className:"absolute top-3 sm:top-4 lg:top-6 left-1/2 -translate-x-1/2 h-10 w-10 rounded-full bg-black/55 border border-white/15 text-lg flex items-center justify-center text-white/80 animate-pulse","aria-label":"Resolving turn",title:"Resolving turn",children:""})})]})})}),p.gameStatus==="playing"&&Si.length>0&&m.jsx("div",{className:"lg:hidden fixed left-1/2 -translate-x-1/2 top-16 z-50 pointer-events-none flex flex-col gap-2 w-[min(92vw,26rem)]",children:Si.map(X=>{const se=X.tone==="damage"?"border-red-400/30 bg-red-950/75 text-red-100":X.tone==="heal"?"border-emerald-400/30 bg-emerald-950/70 text-emerald-100":X.tone==="status"?"border-cyan-300/30 bg-cyan-950/70 text-cyan-100":"border-white/15 bg-black/65 text-white/85";return m.jsx("div",{className:`rounded-xl border px-3 py-2 backdrop-blur-md shadow-[0_4px_20px_rgba(0,0,0,0.35)] text-xs font-bold tracking-wide ${se}`,children:X.text},X.id)})}),m.jsx("aside",{className:"lg:hidden shrink-0 h-[26svh] min-h-[160px] max-h-[250px] border-t border-white/5 bg-[#030712] z-20 overflow-y-auto",children:m.jsxs("div",{className:"p-3 flex flex-col gap-3 h-full",children:[m.jsxs("div",{className:"flex items-center justify-between gap-2",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Skills"}),m.jsxs("div",{className:"flex items-center gap-1.5",children:[m.jsx("button",{disabled:At,onClick:Di,className:`px-2.5 py-1.5 rounded-lg border text-[10px] font-black uppercase tracking-widest ${At?"bg-white/[0.03] border-white/5 text-white/30 opacity-50":"bg-white/5 border-white/10 text-white/70 active:bg-white/10"}`,children:"Wait"}),m.jsx("button",{onClick:ni,className:"px-2.5 py-1.5 rounded-lg border border-white/10 bg-white/5 text-[10px] font-black uppercase tracking-widest text-white/70 active:bg-white/10",children:"Hub"}),m.jsx("button",{onClick:ji,className:"px-2.5 py-1.5 rounded-lg border border-red-500/20 bg-red-500/10 text-[10px] font-black uppercase tracking-widest text-red-300/90 active:bg-red-500/20",children:"Reset"})]})]}),m.jsx(Vy,{skills:p.player.activeSkills||[],selectedSkillId:ee,onSelectSkill:na,hasSpear:p.hasSpear,gameState:p,inputLocked:At,compact:!0})]})}),m.jsx("aside",{className:"hidden lg:flex w-80 border-l border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:m.jsxs("div",{className:"p-6 flex flex-col gap-8 h-full",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30 mb-6",children:"Tactical Skills"}),m.jsx(Vy,{skills:p.player.activeSkills||[],selectedSkillId:ee,onSelectSkill:na,hasSpear:p.hasSpear,gameState:p,inputLocked:At})]}),m.jsx("div",{className:"pt-8 border-t border-white/5 text-center",children:m.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/20",children:"Hop Engine v5.0"})})]})}),pn&&m.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[m.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),m.jsx("p",{className:"text-white text-sm",children:pn}),m.jsx("button",{onClick:()=>In(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]}),p.gameStatus==="choosing_upgrade"&&m.jsx(iE,{onSelect:Ai,gameState:p}),p.gameStatus==="lost"&&m.jsxs("div",{className:"fixed inset-0 bg-red-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[m.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),m.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Identity Deleted"}),m.jsx("p",{className:"text-red-200/60 mb-12 text-xl font-medium tracking-widest uppercase",children:"Simulation Terminated"}),m.jsx("button",{onClick:ji,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Reinitialize Simulation"})]}),p.gameStatus==="won"&&m.jsxs("div",{className:"fixed inset-0 bg-indigo-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[m.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),m.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Arcade Mode Cleared"}),m.jsx("p",{className:"text-indigo-200/60 mb-2 text-xl font-medium tracking-widest uppercase",children:"The Sentinel has fallen"}),m.jsxs("p",{className:"text-white/20 mb-12 text-sm font-bold uppercase tracking-[0.3em]",children:["Score: ",p.completedRun?.score||0]}),m.jsx("button",{onClick:ni,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Return to Command Center"})]}),Ln&&m.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[150] pointer-events-none animate-in fade-in duration-700",children:m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{className:"text-indigo-500 font-black text-2xl uppercase tracking-[0.5em] mb-4 animate-in slide-in-from-bottom-8 duration-1000",children:["Floor ",Ln.floor]}),m.jsx("h2",{className:"text-8xl font-black text-white uppercase tracking-tighter italic animate-in slide-in-from-top-12 duration-1000",children:Ln.theme}),m.jsx("div",{className:"h-1 w-64 bg-white/20 mx-auto mt-8 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-indigo-500 animate-[progress_3s_linear]"})})]})}),j&&m.jsxs("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 bg-[#030712]/90 border border-indigo-500/30 p-6 rounded-3xl backdrop-blur-2xl shadow-[0_0_50px_rgba(79,70,229,0.2)] z-[250] flex items-center gap-8 animate-in slide-in-from-bottom-8 duration-500",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 mb-1",children:"Replay System"}),m.jsxs("span",{className:"text-white font-bold text-sm",children:["Step ",Z.current," / ",pe.length]})]}),m.jsx("div",{className:"h-8 w-px bg-white/10"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>ye(!ue),className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${ue?"bg-indigo-500 text-white shadow-[0_0_20px_rgba(79,70,229,0.5)]":"bg-white/5 text-white/50 hover:bg-white/10"}`,children:ue?"":""}),m.jsx("button",{onClick:ka,disabled:ue,className:"w-12 h-12 bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:hover:bg-white/5 text-white rounded-xl flex items-center justify-center transition-all",children:""})]}),m.jsx("div",{className:"h-8 w-px bg-white/10"}),m.jsx("button",{onClick:$s,className:"px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl font-bold uppercase text-xs tracking-widest transition-all",children:"Close"})]})]})}yx.createRoot(document.getElementById("root")).render(m.jsx(_.StrictMode,{children:m.jsx(NE,{})}));
