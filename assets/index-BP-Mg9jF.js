(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function a(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(c){if(c.ep)return;c.ep=!0;const r=a(c);fetch(c.href,r)}})();function Ib(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var md={exports:{}},al={};var jh;function Bb(){if(jh)return al;jh=1;var t=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function a(o,c,r){var f=null;if(r!==void 0&&(f=""+r),c.key!==void 0&&(f=""+c.key),"key"in c){r={};for(var h in c)h!=="key"&&(r[h]=c[h])}else r=c;return c=r.ref,{$$typeof:t,type:o,key:f,ref:c!==void 0?c:null,props:r}}return al.Fragment=i,al.jsx=a,al.jsxs=a,al}var Dh;function jb(){return Dh||(Dh=1,md.exports=Bb()),md.exports}var m=jb(),pd={exports:{}},Le={};var Hh;function Db(){if(Hh)return Le;Hh=1;var t=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function _(R){return R===null||typeof R!="object"?null:(R=x&&R[x]||R["@@iterator"],typeof R=="function"?R:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,N={};function I(R,V,ee){this.props=R,this.context=V,this.refs=N,this.updater=ee||p}I.prototype.isReactComponent={},I.prototype.setState=function(R,V){if(typeof R!="object"&&typeof R!="function"&&R!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,R,V,"setState")},I.prototype.forceUpdate=function(R){this.updater.enqueueForceUpdate(this,R,"forceUpdate")};function M(){}M.prototype=I.prototype;function E(R,V,ee){this.props=R,this.context=V,this.refs=N,this.updater=ee||p}var w=E.prototype=new M;w.constructor=E,g(w,I.prototype),w.isPureReactComponent=!0;var D=Array.isArray;function H(){}var C={H:null,A:null,T:null,S:null},K=Object.prototype.hasOwnProperty;function ne(R,V,ee){var ue=ee.ref;return{$$typeof:t,type:R,key:V,ref:ue!==void 0?ue:null,props:ee}}function xe(R,V){return ne(R.type,V,R.props)}function oe(R){return typeof R=="object"&&R!==null&&R.$$typeof===t}function ke(R){var V={"=":"=0",":":"=2"};return"$"+R.replace(/[=:]/g,function(ee){return V[ee]})}var ie=/\/+/g;function Te(R,V){return typeof R=="object"&&R!==null&&R.key!=null?ke(""+R.key):V.toString(36)}function pe(R){switch(R.status){case"fulfilled":return R.value;case"rejected":throw R.reason;default:switch(typeof R.status=="string"?R.then(H,H):(R.status="pending",R.then(function(V){R.status==="pending"&&(R.status="fulfilled",R.value=V)},function(V){R.status==="pending"&&(R.status="rejected",R.reason=V)})),R.status){case"fulfilled":return R.value;case"rejected":throw R.reason}}throw R}function $(R,V,ee,ue,Ce){var Ne=typeof R;(Ne==="undefined"||Ne==="boolean")&&(R=null);var Re=!1;if(R===null)Re=!0;else switch(Ne){case"bigint":case"string":case"number":Re=!0;break;case"object":switch(R.$$typeof){case t:case i:Re=!0;break;case A:return Re=R._init,$(Re(R._payload),V,ee,ue,Ce)}}if(Re)return Ce=Ce(R),Re=ue===""?"."+Te(R,0):ue,D(Ce)?(ee="",Re!=null&&(ee=Re.replace(ie,"$&/")+"/"),$(Ce,V,ee,"",function(It){return It})):Ce!=null&&(oe(Ce)&&(Ce=xe(Ce,ee+(Ce.key==null||R&&R.key===Ce.key?"":(""+Ce.key).replace(ie,"$&/")+"/")+Re)),V.push(Ce)),1;Re=0;var mt=ue===""?".":ue+":";if(D(R))for(var qe=0;qe<R.length;qe++)ue=R[qe],Ne=mt+Te(ue,qe),Re+=$(ue,V,ee,Ne,Ce);else if(qe=_(R),typeof qe=="function")for(R=qe.call(R),qe=0;!(ue=R.next()).done;)ue=ue.value,Ne=mt+Te(ue,qe++),Re+=$(ue,V,ee,Ne,Ce);else if(Ne==="object"){if(typeof R.then=="function")return $(pe(R),V,ee,ue,Ce);throw V=String(R),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(R).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Re}function Z(R,V,ee){if(R==null)return R;var ue=[],Ce=0;return $(R,ue,"","",function(Ne){return V.call(ee,Ne,Ce++)}),ue}function ae(R){if(R._status===-1){var V=R._result;V=V(),V.then(function(ee){(R._status===0||R._status===-1)&&(R._status=1,R._result=ee)},function(ee){(R._status===0||R._status===-1)&&(R._status=2,R._result=ee)}),R._status===-1&&(R._status=0,R._result=V)}if(R._status===1)return R._result.default;throw R._result}var Me=typeof reportError=="function"?reportError:function(R){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof R=="object"&&R!==null&&typeof R.message=="string"?String(R.message):String(R),error:R});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",R);return}console.error(R)},Se={map:Z,forEach:function(R,V,ee){Z(R,function(){V.apply(this,arguments)},ee)},count:function(R){var V=0;return Z(R,function(){V++}),V},toArray:function(R){return Z(R,function(V){return V})||[]},only:function(R){if(!oe(R))throw Error("React.Children.only expected to receive a single React element child.");return R}};return Le.Activity=v,Le.Children=Se,Le.Component=I,Le.Fragment=a,Le.Profiler=c,Le.PureComponent=E,Le.StrictMode=o,Le.Suspense=b,Le.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,Le.__COMPILER_RUNTIME={__proto__:null,c:function(R){return C.H.useMemoCache(R)}},Le.cache=function(R){return function(){return R.apply(null,arguments)}},Le.cacheSignal=function(){return null},Le.cloneElement=function(R,V,ee){if(R==null)throw Error("The argument must be a React element, but you passed "+R+".");var ue=g({},R.props),Ce=R.key;if(V!=null)for(Ne in V.key!==void 0&&(Ce=""+V.key),V)!K.call(V,Ne)||Ne==="key"||Ne==="__self"||Ne==="__source"||Ne==="ref"&&V.ref===void 0||(ue[Ne]=V[Ne]);var Ne=arguments.length-2;if(Ne===1)ue.children=ee;else if(1<Ne){for(var Re=Array(Ne),mt=0;mt<Ne;mt++)Re[mt]=arguments[mt+2];ue.children=Re}return ne(R.type,Ce,ue)},Le.createContext=function(R){return R={$$typeof:f,_currentValue:R,_currentValue2:R,_threadCount:0,Provider:null,Consumer:null},R.Provider=R,R.Consumer={$$typeof:r,_context:R},R},Le.createElement=function(R,V,ee){var ue,Ce={},Ne=null;if(V!=null)for(ue in V.key!==void 0&&(Ne=""+V.key),V)K.call(V,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(Ce[ue]=V[ue]);var Re=arguments.length-2;if(Re===1)Ce.children=ee;else if(1<Re){for(var mt=Array(Re),qe=0;qe<Re;qe++)mt[qe]=arguments[qe+2];Ce.children=mt}if(R&&R.defaultProps)for(ue in Re=R.defaultProps,Re)Ce[ue]===void 0&&(Ce[ue]=Re[ue]);return ne(R,Ne,Ce)},Le.createRef=function(){return{current:null}},Le.forwardRef=function(R){return{$$typeof:h,render:R}},Le.isValidElement=oe,Le.lazy=function(R){return{$$typeof:A,_payload:{_status:-1,_result:R},_init:ae}},Le.memo=function(R,V){return{$$typeof:y,type:R,compare:V===void 0?null:V}},Le.startTransition=function(R){var V=C.T,ee={};C.T=ee;try{var ue=R(),Ce=C.S;Ce!==null&&Ce(ee,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(H,Me)}catch(Ne){Me(Ne)}finally{V!==null&&ee.types!==null&&(V.types=ee.types),C.T=V}},Le.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},Le.use=function(R){return C.H.use(R)},Le.useActionState=function(R,V,ee){return C.H.useActionState(R,V,ee)},Le.useCallback=function(R,V){return C.H.useCallback(R,V)},Le.useContext=function(R){return C.H.useContext(R)},Le.useDebugValue=function(){},Le.useDeferredValue=function(R,V){return C.H.useDeferredValue(R,V)},Le.useEffect=function(R,V){return C.H.useEffect(R,V)},Le.useEffectEvent=function(R){return C.H.useEffectEvent(R)},Le.useId=function(){return C.H.useId()},Le.useImperativeHandle=function(R,V,ee){return C.H.useImperativeHandle(R,V,ee)},Le.useInsertionEffect=function(R,V){return C.H.useInsertionEffect(R,V)},Le.useLayoutEffect=function(R,V){return C.H.useLayoutEffect(R,V)},Le.useMemo=function(R,V){return C.H.useMemo(R,V)},Le.useOptimistic=function(R,V){return C.H.useOptimistic(R,V)},Le.useReducer=function(R,V,ee){return C.H.useReducer(R,V,ee)},Le.useRef=function(R){return C.H.useRef(R)},Le.useState=function(R){return C.H.useState(R)},Le.useSyncExternalStore=function(R,V,ee){return C.H.useSyncExternalStore(R,V,ee)},Le.useTransition=function(){return C.H.useTransition()},Le.version="19.2.3",Le}var Ph;function Qd(){return Ph||(Ph=1,pd.exports=Db()),pd.exports}var O=Qd();const Ii=Ib(O);var hd={exports:{}},ol={},gd={exports:{}},yd={};var Uh;function Hb(){return Uh||(Uh=1,(function(t){function i($,Z){var ae=$.length;$.push(Z);e:for(;0<ae;){var Me=ae-1>>>1,Se=$[Me];if(0<c(Se,Z))$[Me]=Z,$[ae]=Se,ae=Me;else break e}}function a($){return $.length===0?null:$[0]}function o($){if($.length===0)return null;var Z=$[0],ae=$.pop();if(ae!==Z){$[0]=ae;e:for(var Me=0,Se=$.length,R=Se>>>1;Me<R;){var V=2*(Me+1)-1,ee=$[V],ue=V+1,Ce=$[ue];if(0>c(ee,ae))ue<Se&&0>c(Ce,ee)?($[Me]=Ce,$[ue]=ae,Me=ue):($[Me]=ee,$[V]=ae,Me=V);else if(ue<Se&&0>c(Ce,ae))$[Me]=Ce,$[ue]=ae,Me=ue;else break e}}return Z}function c($,Z){var ae=$.sortIndex-Z.sortIndex;return ae!==0?ae:$.id-Z.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var f=Date,h=f.now();t.unstable_now=function(){return f.now()-h}}var b=[],y=[],A=1,v=null,x=3,_=!1,p=!1,g=!1,N=!1,I=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function w($){for(var Z=a(y);Z!==null;){if(Z.callback===null)o(y);else if(Z.startTime<=$)o(y),Z.sortIndex=Z.expirationTime,i(b,Z);else break;Z=a(y)}}function D($){if(g=!1,w($),!p)if(a(b)!==null)p=!0,H||(H=!0,ke());else{var Z=a(y);Z!==null&&pe(D,Z.startTime-$)}}var H=!1,C=-1,K=5,ne=-1;function xe(){return N?!0:!(t.unstable_now()-ne<K)}function oe(){if(N=!1,H){var $=t.unstable_now();ne=$;var Z=!0;try{e:{p=!1,g&&(g=!1,M(C),C=-1),_=!0;var ae=x;try{t:{for(w($),v=a(b);v!==null&&!(v.expirationTime>$&&xe());){var Me=v.callback;if(typeof Me=="function"){v.callback=null,x=v.priorityLevel;var Se=Me(v.expirationTime<=$);if($=t.unstable_now(),typeof Se=="function"){v.callback=Se,w($),Z=!0;break t}v===a(b)&&o(b),w($)}else o(b);v=a(b)}if(v!==null)Z=!0;else{var R=a(y);R!==null&&pe(D,R.startTime-$),Z=!1}}break e}finally{v=null,x=ae,_=!1}Z=void 0}}finally{Z?ke():H=!1}}}var ke;if(typeof E=="function")ke=function(){E(oe)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,Te=ie.port2;ie.port1.onmessage=oe,ke=function(){Te.postMessage(null)}}else ke=function(){I(oe,0)};function pe($,Z){C=I(function(){$(t.unstable_now())},Z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_next=function($){switch(x){case 1:case 2:case 3:var Z=3;break;default:Z=x}var ae=x;x=Z;try{return $()}finally{x=ae}},t.unstable_requestPaint=function(){N=!0},t.unstable_runWithPriority=function($,Z){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var ae=x;x=$;try{return Z()}finally{x=ae}},t.unstable_scheduleCallback=function($,Z,ae){var Me=t.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?Me+ae:Me):ae=Me,$){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=ae+Se,$={id:A++,callback:Z,priorityLevel:$,startTime:ae,expirationTime:Se,sortIndex:-1},ae>Me?($.sortIndex=ae,i(y,$),a(b)===null&&$===a(y)&&(g?(M(C),C=-1):g=!0,pe(D,ae-Me))):($.sortIndex=Se,i(b,$),p||_||(p=!0,H||(H=!0,ke()))),$},t.unstable_shouldYield=xe,t.unstable_wrapCallback=function($){var Z=x;return function(){var ae=x;x=Z;try{return $.apply(this,arguments)}finally{x=ae}}}})(yd)),yd}var qh;function Pb(){return qh||(qh=1,gd.exports=Hb()),gd.exports}var bd={exports:{}},Cn={};var zh;function Ub(){if(zh)return Cn;zh=1;var t=Qd();function i(b){var y="https://react.dev/errors/"+b;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var A=2;A<arguments.length;A++)y+="&args[]="+encodeURIComponent(arguments[A])}return"Minified React error #"+b+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var o={d:{f:a,r:function(){throw Error(i(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},c=Symbol.for("react.portal");function r(b,y,A){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:v==null?null:""+v,children:b,containerInfo:y,implementation:A}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(b,y){if(b==="font")return"";if(typeof y=="string")return y==="use-credentials"?y:""}return Cn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,Cn.createPortal=function(b,y){var A=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)throw Error(i(299));return r(b,y,null,A)},Cn.flushSync=function(b){var y=f.T,A=o.p;try{if(f.T=null,o.p=2,b)return b()}finally{f.T=y,o.p=A,o.d.f()}},Cn.preconnect=function(b,y){typeof b=="string"&&(y?(y=y.crossOrigin,y=typeof y=="string"?y==="use-credentials"?y:"":void 0):y=null,o.d.C(b,y))},Cn.prefetchDNS=function(b){typeof b=="string"&&o.d.D(b)},Cn.preinit=function(b,y){if(typeof b=="string"&&y&&typeof y.as=="string"){var A=y.as,v=h(A,y.crossOrigin),x=typeof y.integrity=="string"?y.integrity:void 0,_=typeof y.fetchPriority=="string"?y.fetchPriority:void 0;A==="style"?o.d.S(b,typeof y.precedence=="string"?y.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:_}):A==="script"&&o.d.X(b,{crossOrigin:v,integrity:x,fetchPriority:_,nonce:typeof y.nonce=="string"?y.nonce:void 0})}},Cn.preinitModule=function(b,y){if(typeof b=="string")if(typeof y=="object"&&y!==null){if(y.as==null||y.as==="script"){var A=h(y.as,y.crossOrigin);o.d.M(b,{crossOrigin:A,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0})}}else y==null&&o.d.M(b)},Cn.preload=function(b,y){if(typeof b=="string"&&typeof y=="object"&&y!==null&&typeof y.as=="string"){var A=y.as,v=h(A,y.crossOrigin);o.d.L(b,A,{crossOrigin:v,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0,type:typeof y.type=="string"?y.type:void 0,fetchPriority:typeof y.fetchPriority=="string"?y.fetchPriority:void 0,referrerPolicy:typeof y.referrerPolicy=="string"?y.referrerPolicy:void 0,imageSrcSet:typeof y.imageSrcSet=="string"?y.imageSrcSet:void 0,imageSizes:typeof y.imageSizes=="string"?y.imageSizes:void 0,media:typeof y.media=="string"?y.media:void 0})}},Cn.preloadModule=function(b,y){if(typeof b=="string")if(y){var A=h(y.as,y.crossOrigin);o.d.m(b,{as:typeof y.as=="string"&&y.as!=="script"?y.as:void 0,crossOrigin:A,integrity:typeof y.integrity=="string"?y.integrity:void 0})}else o.d.m(b)},Cn.requestFormReset=function(b){o.d.r(b)},Cn.unstable_batchedUpdates=function(b,y){return b(y)},Cn.useFormState=function(b,y,A){return f.H.useFormState(b,y,A)},Cn.useFormStatus=function(){return f.H.useHostTransitionStatus()},Cn.version="19.2.3",Cn}var $h;function qb(){if($h)return bd.exports;$h=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(i){console.error(i)}}return t(),bd.exports=Ub(),bd.exports}var Vh;function zb(){if(Vh)return ol;Vh=1;var t=Pb(),i=Qd(),a=qb();function o(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)n+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function r(e){var n=e,s=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(s=n.return),e=n.return;while(e)}return n.tag===3?s:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function h(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function b(e){if(r(e)!==e)throw Error(o(188))}function y(e){var n=e.alternate;if(!n){if(n=r(e),n===null)throw Error(o(188));return n!==e?null:e}for(var s=e,l=n;;){var u=s.return;if(u===null)break;var d=u.alternate;if(d===null){if(l=u.return,l!==null){s=l;continue}break}if(u.child===d.child){for(d=u.child;d;){if(d===s)return b(u),e;if(d===l)return b(u),n;d=d.sibling}throw Error(o(188))}if(s.return!==l.return)s=u,l=d;else{for(var S=!1,T=u.child;T;){if(T===s){S=!0,s=u,l=d;break}if(T===l){S=!0,l=u,s=d;break}T=T.sibling}if(!S){for(T=d.child;T;){if(T===s){S=!0,s=d,l=u;break}if(T===l){S=!0,l=d,s=u;break}T=T.sibling}if(!S)throw Error(o(189))}}if(s.alternate!==l)throw Error(o(190))}if(s.tag!==3)throw Error(o(188));return s.stateNode.current===s?e:n}function A(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=A(e),n!==null)return n;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),N=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),M=Symbol.for("react.consumer"),E=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),C=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),xe=Symbol.for("react.memo_cache_sentinel"),oe=Symbol.iterator;function ke(e){return e===null||typeof e!="object"?null:(e=oe&&e[oe]||e["@@iterator"],typeof e=="function"?e:null)}var ie=Symbol.for("react.client.reference");function Te(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ie?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case g:return"Fragment";case I:return"Profiler";case N:return"StrictMode";case D:return"Suspense";case H:return"SuspenseList";case ne:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case p:return"Portal";case E:return e.displayName||"Context";case M:return(e._context.displayName||"Context")+".Consumer";case w:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case C:return n=e.displayName||null,n!==null?n:Te(e.type)||"Memo";case K:n=e._payload,e=e._init;try{return Te(e(n))}catch{}}return null}var pe=Array.isArray,$=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae={pending:!1,data:null,method:null,action:null},Me=[],Se=-1;function R(e){return{current:e}}function V(e){0>Se||(e.current=Me[Se],Me[Se]=null,Se--)}function ee(e,n){Se++,Me[Se]=e.current,e.current=n}var ue=R(null),Ce=R(null),Ne=R(null),Re=R(null);function mt(e,n){switch(ee(Ne,n),ee(Ce,e),ee(ue,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?ah(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=ah(n),e=oh(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}V(ue),ee(ue,e)}function qe(){V(ue),V(Ce),V(Ne)}function It(e){e.memoizedState!==null&&ee(Re,e);var n=ue.current,s=oh(n,e.type);n!==s&&(ee(Ce,e),ee(ue,s))}function ze(e){Ce.current===e&&(V(ue),V(Ce)),Re.current===e&&(V(Re),tl._currentValue=ae)}var Ue,xt;function Bt(e){if(Ue===void 0)try{throw Error()}catch(s){var n=s.stack.trim().match(/\n( *(at )?)/);Ue=n&&n[1]||"",xt=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ue+e+xt}var ct=!1;function Vt(e,n){if(!e||ct)return"";ct=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(n){var J=function(){throw Error()};if(Object.defineProperty(J.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(J,[])}catch(Y){var z=Y}Reflect.construct(e,[],J)}else{try{J.call()}catch(Y){z=Y}e.call(J.prototype)}}else{try{throw Error()}catch(Y){z=Y}(J=e())&&typeof J.catch=="function"&&J.catch(function(){})}}catch(Y){if(Y&&z&&typeof Y.stack=="string")return[Y.stack,z.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=l.DetermineComponentFrameRoot(),S=d[0],T=d[1];if(S&&T){var L=S.split(`
`),q=T.split(`
`);for(u=l=0;l<L.length&&!L[l].includes("DetermineComponentFrameRoot");)l++;for(;u<q.length&&!q[u].includes("DetermineComponentFrameRoot");)u++;if(l===L.length||u===q.length)for(l=L.length-1,u=q.length-1;1<=l&&0<=u&&L[l]!==q[u];)u--;for(;1<=l&&0<=u;l--,u--)if(L[l]!==q[u]){if(l!==1||u!==1)do if(l--,u--,0>u||L[l]!==q[u]){var F=`
`+L[l].replace(" at new "," at ");return e.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",e.displayName)),F}while(1<=l&&0<=u);break}}}finally{ct=!1,Error.prepareStackTrace=s}return(s=e?e.displayName||e.name:"")?Bt(s):""}function rn(e,n){switch(e.tag){case 26:case 27:case 5:return Bt(e.type);case 16:return Bt("Lazy");case 13:return e.child!==n&&n!==null?Bt("Suspense Fallback"):Bt("Suspense");case 19:return Bt("SuspenseList");case 0:case 15:return Vt(e.type,!1);case 11:return Vt(e.type.render,!1);case 1:return Vt(e.type,!0);case 31:return Bt("Activity");default:return""}}function $e(e){try{var n="",s=null;do n+=rn(e,s),s=e,e=e.return;while(e);return n}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var it=Object.prototype.hasOwnProperty,bn=t.unstable_scheduleCallback,Ei=t.unstable_cancelCallback,Qn=t.unstable_shouldYield,Dn=t.unstable_requestPaint,Fe=t.unstable_now,pt=t.unstable_getCurrentPriorityLevel,Dt=t.unstable_ImmediatePriority,Sn=t.unstable_UserBlockingPriority,cn=t.unstable_NormalPriority,vn=t.unstable_LowPriority,Yt=t.unstable_IdlePriority,Tt=t.log,Ve=t.unstable_setDisableYieldValue,Kt=null,Je=null;function et(e){if(typeof Tt=="function"&&Ve(e),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(Kt,e)}catch{}}var Et=Math.clz32?Math.clz32:Jn,un=Math.log,Hn=Math.LN2;function Jn(e){return e>>>=0,e===0?32:31-(un(e)/Hn|0)|0}var On=256,dn=262144,ht=4194304;function Ht(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ft(e,n,s){var l=e.pendingLanes;if(l===0)return 0;var u=0,d=e.suspendedLanes,S=e.pingedLanes;e=e.warmLanes;var T=l&134217727;return T!==0?(l=T&~d,l!==0?u=Ht(l):(S&=T,S!==0?u=Ht(S):s||(s=T&~e,s!==0&&(u=Ht(s))))):(T=l&~d,T!==0?u=Ht(T):S!==0?u=Ht(S):s||(s=l&~e,s!==0&&(u=Ht(s)))),u===0?0:n!==0&&n!==u&&(n&d)===0&&(d=u&-u,s=n&-n,d>=s||d===32&&(s&4194048)!==0)?n:u}function Rn(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Hi(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zn(){var e=ht;return ht<<=1,(ht&62914560)===0&&(ht=4194304),e}function fn(e){for(var n=[],s=0;31>s;s++)n.push(e);return n}function Gt(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Pn(e,n,s,l,u,d){var S=e.pendingLanes;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=s,e.entangledLanes&=s,e.errorRecoveryDisabledLanes&=s,e.shellSuspendCounter=0;var T=e.entanglements,L=e.expirationTimes,q=e.hiddenUpdates;for(s=S&~s;0<s;){var F=31-Et(s),J=1<<F;T[F]=0,L[F]=-1;var z=q[F];if(z!==null)for(q[F]=null,F=0;F<z.length;F++){var Y=z[F];Y!==null&&(Y.lane&=-536870913)}s&=~J}l!==0&&Pi(e,l,0),d!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=d&~(S&~n))}function Pi(e,n,s){e.pendingLanes|=n,e.suspendedLanes&=~n;var l=31-Et(n);e.entangledLanes|=n,e.entanglements[l]=e.entanglements[l]|1073741824|s&261930}function Gi(e,n){var s=e.entangledLanes|=n;for(e=e.entanglements;s;){var l=31-Et(s),u=1<<l;u&n|e[l]&n&&(e[l]|=n),s&=~u}}function di(e,n){var s=n&-n;return s=(s&42)!==0?1:_i(s),(s&(e.suspendedLanes|n))!==0?0:s}function _i(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function bs(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function X(){var e=Z.p;return e!==0?e:(e=window.event,e===void 0?32:Ch(e.type))}function re(e,n){var s=Z.p;try{return Z.p=e,n()}finally{Z.p=s}}var me=Math.random().toString(36).slice(2),we="__reactFiber$"+me,be="__reactProps$"+me,De="__reactContainer$"+me,ut="__reactEvents$"+me,mn="__reactListeners$"+me,xn="__reactHandles$"+me,Pt="__reactResources$"+me,Ct="__reactMarker$"+me;function kn(e){delete e[we],delete e[be],delete e[ut],delete e[mn],delete e[xn]}function Un(e){var n=e[we];if(n)return n;for(var s=e.parentNode;s;){if(n=s[De]||s[we]){if(s=n.alternate,n.child!==null||s!==null&&s.child!==null)for(e=mh(e);e!==null;){if(s=e[we])return s;e=mh(e)}return n}e=s,s=e.parentNode}return null}function Ln(e){if(e=e[we]||e[De]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function wi(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(o(33))}function Mi(e){var n=e[Pt];return n||(n=e[Pt]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Nt(e){e[Ct]=!0}var go=new Set,Ol={};function Wi(e,n){Ui(e,n),Ui(e+"Capture",n)}function Ui(e,n){for(Ol[e]=n,e=0;e<n.length;e++)go.add(n[e])}var mc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qs={},Ss={};function Ca(e){return it.call(Ss,e)?!0:it.call(Qs,e)?!1:mc.test(e)?Ss[e]=!0:(Qs[e]=!0,!1)}function vs(e,n,s){if(Ca(n))if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var l=n.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+s)}}function Js(e,n,s){if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+s)}}function fi(e,n,s,l){if(l===null)e.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttributeNS(n,s,""+l)}}function qn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Cl(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function pc(e,n,s){var l=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var u=l.get,d=l.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return u.call(this)},set:function(S){s=""+S,d.call(this,S)}}),Object.defineProperty(e,n,{enumerable:l.enumerable}),{getValue:function(){return s},setValue:function(S){s=""+S},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Zs(e){if(!e._valueTracker){var n=Cl(e)?"checked":"value";e._valueTracker=pc(e,n,""+e[n])}}function Be(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var s=n.getValue(),l="";return e&&(l=Cl(e)?e.checked?"true":"false":e.value),e=l,e!==s?(n.setValue(e),!0):!1}function k(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var P=/[\n"\\]/g;function G(e){return e.replace(P,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function le(e,n,s,l,u,d,S,T){e.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.type=S:e.removeAttribute("type"),n!=null?S==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+qn(n)):e.value!==""+qn(n)&&(e.value=""+qn(n)):S!=="submit"&&S!=="reset"||e.removeAttribute("value"),n!=null?he(e,S,qn(n)):s!=null?he(e,S,qn(s)):l!=null&&e.removeAttribute("value"),u==null&&d!=null&&(e.defaultChecked=!!d),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?e.name=""+qn(T):e.removeAttribute("name")}function ce(e,n,s,l,u,d,S,T){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),n!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||n!=null)){Zs(e);return}s=s!=null?""+qn(s):"",n=n!=null?""+qn(n):s,T||n===e.value||(e.value=n),e.defaultValue=n}l=l??u,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=T?e.checked:!!l,e.defaultChecked=!!l,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(e.name=S),Zs(e)}function he(e,n,s){n==="number"&&k(e.ownerDocument)===e||e.defaultValue===""+s||(e.defaultValue=""+s)}function ge(e,n,s,l){if(e=e.options,n){n={};for(var u=0;u<s.length;u++)n["$"+s[u]]=!0;for(s=0;s<e.length;s++)u=n.hasOwnProperty("$"+e[s].value),e[s].selected!==u&&(e[s].selected=u),u&&l&&(e[s].defaultSelected=!0)}else{for(s=""+qn(s),n=null,u=0;u<e.length;u++){if(e[u].value===s){e[u].selected=!0,l&&(e[u].defaultSelected=!0);return}n!==null||e[u].disabled||(n=e[u])}n!==null&&(n.selected=!0)}}function ot(e,n,s){if(n!=null&&(n=""+qn(n),n!==e.value&&(e.value=n),s==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=s!=null?""+qn(s):""}function lt(e,n,s,l){if(n==null){if(l!=null){if(s!=null)throw Error(o(92));if(pe(l)){if(1<l.length)throw Error(o(93));l=l[0]}s=l}s==null&&(s=""),n=s}s=qn(n),e.defaultValue=s,l=e.textContent,l===s&&l!==""&&l!==null&&(e.value=l),Zs(e)}function pn(e,n){if(n){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=n;return}}e.textContent=n}var zn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jt(e,n,s){var l=n.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?l?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":l?e.setProperty(n,s):typeof s!="number"||s===0||zn.has(n)?n==="float"?e.cssFloat=s:e[n]=(""+s).trim():e[n]=s+"px"}function wt(e,n,s){if(n!=null&&typeof n!="object")throw Error(o(62));if(e=e.style,s!=null){for(var l in s)!s.hasOwnProperty(l)||n!=null&&n.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var u in n)l=n[u],n.hasOwnProperty(u)&&s[u]!==l&&jt(e,u,l)}else for(var d in n)n.hasOwnProperty(d)&&jt(e,d,n[d])}function Ut(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var hn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),gn=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Na(e){return gn.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Oi(){}var Ra=null;function ka(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Xi=null,Qi=null;function Nl(e){var n=Ln(e);if(n&&(e=n.stateNode)){var s=e[be]||null;e:switch(e=n.stateNode,n.type){case"input":if(le(e,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),n=s.name,s.type==="radio"&&n!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+G(""+n)+'"][type="radio"]'),n=0;n<s.length;n++){var l=s[n];if(l!==e&&l.form===e.form){var u=l[be]||null;if(!u)throw Error(o(90));le(l,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(n=0;n<s.length;n++)l=s[n],l.form===e.form&&Be(l)}break e;case"textarea":ot(e,s.value,s.defaultValue);break e;case"select":n=s.value,n!=null&&ge(e,!!s.multiple,n,!1)}}}var yo=!1;function La(e,n,s){if(yo)return e(n,s);yo=!0;try{var l=e(n);return l}finally{if(yo=!1,(Xi!==null||Qi!==null)&&(hr(),Xi&&(n=Xi,e=Qi,Qi=Xi=null,Nl(n),e)))for(n=0;n<e.length;n++)Nl(e[n])}}function Ji(e,n){var s=e.stateNode;if(s===null)return null;var l=s[be]||null;if(l===null)return null;s=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(o(231,n,typeof s));return s}var Ci=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bo=!1;if(Ci)try{var qi={};Object.defineProperty(qi,"passive",{get:function(){bo=!0}}),window.addEventListener("test",qi,qi),window.removeEventListener("test",qi,qi)}catch{bo=!1}var ei=null,ea=null,ta=null;function So(){if(ta)return ta;var e,n=ea,s=n.length,l,u="value"in ei?ei.value:ei.textContent,d=u.length;for(e=0;e<s&&n[e]===u[e];e++);var S=s-e;for(l=1;l<=S&&n[s-l]===u[d-l];l++);return ta=u.slice(e,1<l?1-l:void 0)}function na(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Rl(){return!0}function lf(){return!1}function $n(e){function n(s,l,u,d,S){this._reactName=s,this._targetInst=u,this.type=l,this.nativeEvent=d,this.target=S,this.currentTarget=null;for(var T in e)e.hasOwnProperty(T)&&(s=e[T],this[T]=s?s(d):d[T]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Rl:lf,this.isPropagationStopped=lf,this}return v(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Rl)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Rl)},persist:function(){},isPersistent:Rl}),n}var ia={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kl=$n(ia),vo=v({},ia,{view:0,detail:0}),ky=$n(vo),hc,gc,xo,Ll=v({},vo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==xo&&(xo&&e.type==="mousemove"?(hc=e.screenX-xo.screenX,gc=e.screenY-xo.screenY):gc=hc=0,xo=e),hc)},movementY:function(e){return"movementY"in e?e.movementY:gc}}),rf=$n(Ll),Ly=v({},Ll,{dataTransfer:0}),Iy=$n(Ly),By=v({},vo,{relatedTarget:0}),yc=$n(By),jy=v({},ia,{animationName:0,elapsedTime:0,pseudoElement:0}),Dy=$n(jy),Hy=v({},ia,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Py=$n(Hy),Uy=v({},ia,{data:0}),cf=$n(Uy),qy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$y={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vy(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=$y[e])?!!n[e]:!1}function bc(){return Vy}var Yy=v({},vo,{key:function(e){if(e.key){var n=qy[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=na(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?zy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bc,charCode:function(e){return e.type==="keypress"?na(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?na(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Ky=$n(Yy),Fy=v({},Ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uf=$n(Fy),Gy=v({},vo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bc}),Wy=$n(Gy),Xy=v({},ia,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qy=$n(Xy),Jy=v({},Ll,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zy=$n(Jy),e0=v({},ia,{newState:0,oldState:0}),t0=$n(e0),n0=[9,13,27,32],Sc=Ci&&"CompositionEvent"in window,Ao=null;Ci&&"documentMode"in document&&(Ao=document.documentMode);var i0=Ci&&"TextEvent"in window&&!Ao,df=Ci&&(!Sc||Ao&&8<Ao&&11>=Ao),ff=" ",mf=!1;function pf(e,n){switch(e){case"keyup":return n0.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ia=!1;function s0(e,n){switch(e){case"compositionend":return hf(n);case"keypress":return n.which!==32?null:(mf=!0,ff);case"textInput":return e=n.data,e===ff&&mf?null:e;default:return null}}function a0(e,n){if(Ia)return e==="compositionend"||!Sc&&pf(e,n)?(e=So(),ta=ea=ei=null,Ia=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return df&&n.locale!=="ko"?null:n.data;default:return null}}var o0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gf(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!o0[e.type]:n==="textarea"}function yf(e,n,s,l){Xi?Qi?Qi.push(l):Qi=[l]:Xi=l,n=Ar(n,"onChange"),0<n.length&&(s=new kl("onChange","change",null,s,l),e.push({event:s,listeners:n}))}var To=null,Eo=null;function l0(e){Zp(e,0)}function Il(e){var n=wi(e);if(Be(n))return e}function bf(e,n){if(e==="change")return n}var Sf=!1;if(Ci){var vc;if(Ci){var xc="oninput"in document;if(!xc){var vf=document.createElement("div");vf.setAttribute("oninput","return;"),xc=typeof vf.oninput=="function"}vc=xc}else vc=!1;Sf=vc&&(!document.documentMode||9<document.documentMode)}function xf(){To&&(To.detachEvent("onpropertychange",Af),Eo=To=null)}function Af(e){if(e.propertyName==="value"&&Il(Eo)){var n=[];yf(n,Eo,e,ka(e)),La(l0,n)}}function r0(e,n,s){e==="focusin"?(xf(),To=n,Eo=s,To.attachEvent("onpropertychange",Af)):e==="focusout"&&xf()}function c0(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Il(Eo)}function u0(e,n){if(e==="click")return Il(n)}function d0(e,n){if(e==="input"||e==="change")return Il(n)}function f0(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var ti=typeof Object.is=="function"?Object.is:f0;function _o(e,n){if(ti(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var s=Object.keys(e),l=Object.keys(n);if(s.length!==l.length)return!1;for(l=0;l<s.length;l++){var u=s[l];if(!it.call(n,u)||!ti(e[u],n[u]))return!1}return!0}function Tf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ef(e,n){var s=Tf(e);e=0;for(var l;s;){if(s.nodeType===3){if(l=e+s.textContent.length,e<=n&&l>=n)return{node:s,offset:n-e};e=l}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Tf(s)}}function _f(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?_f(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function wf(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=k(e.document);n instanceof e.HTMLIFrameElement;){try{var s=typeof n.contentWindow.location.href=="string"}catch{s=!1}if(s)e=n.contentWindow;else break;n=k(e.document)}return n}function Ac(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var m0=Ci&&"documentMode"in document&&11>=document.documentMode,Ba=null,Tc=null,wo=null,Ec=!1;function Mf(e,n,s){var l=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Ec||Ba==null||Ba!==k(l)||(l=Ba,"selectionStart"in l&&Ac(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),wo&&_o(wo,l)||(wo=l,l=Ar(Tc,"onSelect"),0<l.length&&(n=new kl("onSelect","select",null,n,s),e.push({event:n,listeners:l}),n.target=Ba)))}function sa(e,n){var s={};return s[e.toLowerCase()]=n.toLowerCase(),s["Webkit"+e]="webkit"+n,s["Moz"+e]="moz"+n,s}var ja={animationend:sa("Animation","AnimationEnd"),animationiteration:sa("Animation","AnimationIteration"),animationstart:sa("Animation","AnimationStart"),transitionrun:sa("Transition","TransitionRun"),transitionstart:sa("Transition","TransitionStart"),transitioncancel:sa("Transition","TransitionCancel"),transitionend:sa("Transition","TransitionEnd")},_c={},Of={};Ci&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ja.animationend.animation,delete ja.animationiteration.animation,delete ja.animationstart.animation),"TransitionEvent"in window||delete ja.transitionend.transition);function aa(e){if(_c[e])return _c[e];if(!ja[e])return e;var n=ja[e],s;for(s in n)if(n.hasOwnProperty(s)&&s in Of)return _c[e]=n[s];return e}var Cf=aa("animationend"),Nf=aa("animationiteration"),Rf=aa("animationstart"),p0=aa("transitionrun"),h0=aa("transitionstart"),g0=aa("transitioncancel"),kf=aa("transitionend"),Lf=new Map,wc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");wc.push("scrollEnd");function Ni(e,n){Lf.set(e,n),Wi(n,[e])}var Bl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},mi=[],Da=0,Mc=0;function jl(){for(var e=Da,n=Mc=Da=0;n<e;){var s=mi[n];mi[n++]=null;var l=mi[n];mi[n++]=null;var u=mi[n];mi[n++]=null;var d=mi[n];if(mi[n++]=null,l!==null&&u!==null){var S=l.pending;S===null?u.next=u:(u.next=S.next,S.next=u),l.pending=u}d!==0&&If(s,u,d)}}function Dl(e,n,s,l){mi[Da++]=e,mi[Da++]=n,mi[Da++]=s,mi[Da++]=l,Mc|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function Oc(e,n,s,l){return Dl(e,n,s,l),Hl(e)}function oa(e,n){return Dl(e,null,null,n),Hl(e)}function If(e,n,s){e.lanes|=s;var l=e.alternate;l!==null&&(l.lanes|=s);for(var u=!1,d=e.return;d!==null;)d.childLanes|=s,l=d.alternate,l!==null&&(l.childLanes|=s),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(u=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,u&&n!==null&&(u=31-Et(s),e=d.hiddenUpdates,l=e[u],l===null?e[u]=[n]:l.push(n),n.lane=s|536870912),d):null}function Hl(e){if(50<Go)throw Go=0,Du=null,Error(o(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ha={};function y0(e,n,s,l){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ni(e,n,s,l){return new y0(e,n,s,l)}function Cc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zi(e,n){var s=e.alternate;return s===null?(s=ni(e.tag,n,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=n,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&65011712,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,n=e.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s.refCleanup=e.refCleanup,s}function Bf(e,n){e.flags&=65011714;var s=e.alternate;return s===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=s.childLanes,e.lanes=s.lanes,e.child=s.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=s.memoizedProps,e.memoizedState=s.memoizedState,e.updateQueue=s.updateQueue,e.type=s.type,n=s.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function Pl(e,n,s,l,u,d){var S=0;if(l=e,typeof e=="function")Cc(e)&&(S=1);else if(typeof e=="string")S=Ab(e,s,ue.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case ne:return e=ni(31,s,n,u),e.elementType=ne,e.lanes=d,e;case g:return la(s.children,u,d,n);case N:S=8,u|=24;break;case I:return e=ni(12,s,n,u|2),e.elementType=I,e.lanes=d,e;case D:return e=ni(13,s,n,u),e.elementType=D,e.lanes=d,e;case H:return e=ni(19,s,n,u),e.elementType=H,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case E:S=10;break e;case M:S=9;break e;case w:S=11;break e;case C:S=14;break e;case K:S=16,l=null;break e}S=29,s=Error(o(130,e===null?"null":typeof e,"")),l=null}return n=ni(S,s,n,u),n.elementType=e,n.type=l,n.lanes=d,n}function la(e,n,s,l){return e=ni(7,e,l,n),e.lanes=s,e}function Nc(e,n,s){return e=ni(6,e,null,n),e.lanes=s,e}function jf(e){var n=ni(18,null,null,0);return n.stateNode=e,n}function Rc(e,n,s){return n=ni(4,e.children!==null?e.children:[],e.key,n),n.lanes=s,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Df=new WeakMap;function pi(e,n){if(typeof e=="object"&&e!==null){var s=Df.get(e);return s!==void 0?s:(n={value:e,source:n,stack:$e(n)},Df.set(e,n),n)}return{value:e,source:n,stack:$e(n)}}var Pa=[],Ua=0,Ul=null,Mo=0,hi=[],gi=0,xs=null,zi=1,$i="";function es(e,n){Pa[Ua++]=Mo,Pa[Ua++]=Ul,Ul=e,Mo=n}function Hf(e,n,s){hi[gi++]=zi,hi[gi++]=$i,hi[gi++]=xs,xs=e;var l=zi;e=$i;var u=32-Et(l)-1;l&=~(1<<u),s+=1;var d=32-Et(n)+u;if(30<d){var S=u-u%5;d=(l&(1<<S)-1).toString(32),l>>=S,u-=S,zi=1<<32-Et(n)+u|s<<u|l,$i=d+e}else zi=1<<d|s<<u|l,$i=e}function kc(e){e.return!==null&&(es(e,1),Hf(e,1,0))}function Lc(e){for(;e===Ul;)Ul=Pa[--Ua],Pa[Ua]=null,Mo=Pa[--Ua],Pa[Ua]=null;for(;e===xs;)xs=hi[--gi],hi[gi]=null,$i=hi[--gi],hi[gi]=null,zi=hi[--gi],hi[gi]=null}function Pf(e,n){hi[gi++]=zi,hi[gi++]=$i,hi[gi++]=xs,zi=n.id,$i=n.overflow,xs=e}var An=null,Mt=null,Qe=!1,As=null,yi=!1,Ic=Error(o(519));function Ts(e){var n=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Oo(pi(n,e)),Ic}function Uf(e){var n=e.stateNode,s=e.type,l=e.memoizedProps;switch(n[we]=e,n[be]=l,s){case"dialog":Ke("cancel",n),Ke("close",n);break;case"iframe":case"object":case"embed":Ke("load",n);break;case"video":case"audio":for(s=0;s<Xo.length;s++)Ke(Xo[s],n);break;case"source":Ke("error",n);break;case"img":case"image":case"link":Ke("error",n),Ke("load",n);break;case"details":Ke("toggle",n);break;case"input":Ke("invalid",n),ce(n,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":Ke("invalid",n);break;case"textarea":Ke("invalid",n),lt(n,l.value,l.defaultValue,l.children)}s=l.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||n.textContent===""+s||l.suppressHydrationWarning===!0||ih(n.textContent,s)?(l.popover!=null&&(Ke("beforetoggle",n),Ke("toggle",n)),l.onScroll!=null&&Ke("scroll",n),l.onScrollEnd!=null&&Ke("scrollend",n),l.onClick!=null&&(n.onclick=Oi),n=!0):n=!1,n||Ts(e,!0)}function qf(e){for(An=e.return;An;)switch(An.tag){case 5:case 31:case 13:yi=!1;return;case 27:case 3:yi=!0;return;default:An=An.return}}function qa(e){if(e!==An)return!1;if(!Qe)return qf(e),Qe=!0,!1;var n=e.tag,s;if((s=n!==3&&n!==27)&&((s=n===5)&&(s=e.type,s=!(s!=="form"&&s!=="button")||Ju(e.type,e.memoizedProps)),s=!s),s&&Mt&&Ts(e),qf(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));Mt=fh(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));Mt=fh(e)}else n===27?(n=Mt,Ds(e.type)?(e=id,id=null,Mt=e):Mt=n):Mt=An?Si(e.stateNode.nextSibling):null;return!0}function ra(){Mt=An=null,Qe=!1}function Bc(){var e=As;return e!==null&&(Fn===null?Fn=e:Fn.push.apply(Fn,e),As=null),e}function Oo(e){As===null?As=[e]:As.push(e)}var jc=R(null),ca=null,ts=null;function Es(e,n,s){ee(jc,n._currentValue),n._currentValue=s}function ns(e){e._currentValue=jc.current,V(jc)}function Dc(e,n,s){for(;e!==null;){var l=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),e===s)break;e=e.return}}function Hc(e,n,s,l){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var d=u.dependencies;if(d!==null){var S=u.child;d=d.firstContext;e:for(;d!==null;){var T=d;d=u;for(var L=0;L<n.length;L++)if(T.context===n[L]){d.lanes|=s,T=d.alternate,T!==null&&(T.lanes|=s),Dc(d.return,s,e),l||(S=null);break e}d=T.next}}else if(u.tag===18){if(S=u.return,S===null)throw Error(o(341));S.lanes|=s,d=S.alternate,d!==null&&(d.lanes|=s),Dc(S,s,e),S=null}else S=u.child;if(S!==null)S.return=u;else for(S=u;S!==null;){if(S===e){S=null;break}if(u=S.sibling,u!==null){u.return=S.return,S=u;break}S=S.return}u=S}}function za(e,n,s,l){e=null;for(var u=n,d=!1;u!==null;){if(!d){if((u.flags&524288)!==0)d=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var S=u.alternate;if(S===null)throw Error(o(387));if(S=S.memoizedProps,S!==null){var T=u.type;ti(u.pendingProps.value,S.value)||(e!==null?e.push(T):e=[T])}}else if(u===Re.current){if(S=u.alternate,S===null)throw Error(o(387));S.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(tl):e=[tl])}u=u.return}e!==null&&Hc(n,e,s,l),n.flags|=262144}function ql(e){for(e=e.firstContext;e!==null;){if(!ti(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ua(e){ca=e,ts=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Tn(e){return zf(ca,e)}function zl(e,n){return ca===null&&ua(e),zf(e,n)}function zf(e,n){var s=n._currentValue;if(n={context:n,memoizedValue:s,next:null},ts===null){if(e===null)throw Error(o(308));ts=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else ts=ts.next=n;return s}var b0=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(s,l){e.push(l)}};this.abort=function(){n.aborted=!0,e.forEach(function(s){return s()})}},S0=t.unstable_scheduleCallback,v0=t.unstable_NormalPriority,Qt={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pc(){return{controller:new b0,data:new Map,refCount:0}}function Co(e){e.refCount--,e.refCount===0&&S0(v0,function(){e.controller.abort()})}var No=null,Uc=0,$a=0,Va=null;function x0(e,n){if(No===null){var s=No=[];Uc=0,$a=$u(),Va={status:"pending",value:void 0,then:function(l){s.push(l)}}}return Uc++,n.then($f,$f),n}function $f(){if(--Uc===0&&No!==null){Va!==null&&(Va.status="fulfilled");var e=No;No=null,$a=0,Va=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function A0(e,n){var s=[],l={status:"pending",value:null,reason:null,then:function(u){s.push(u)}};return e.then(function(){l.status="fulfilled",l.value=n;for(var u=0;u<s.length;u++)(0,s[u])(n)},function(u){for(l.status="rejected",l.reason=u,u=0;u<s.length;u++)(0,s[u])(void 0)}),l}var Vf=$.S;$.S=function(e,n){Mp=Fe(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&x0(e,n),Vf!==null&&Vf(e,n)};var da=R(null);function qc(){var e=da.current;return e!==null?e:At.pooledCache}function $l(e,n){n===null?ee(da,da.current):ee(da,n.pool)}function Yf(){var e=qc();return e===null?null:{parent:Qt._currentValue,pool:e}}var Ya=Error(o(460)),zc=Error(o(474)),Vl=Error(o(542)),Yl={then:function(){}};function Kf(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ff(e,n,s){switch(s=e[s],s===void 0?e.push(n):s!==n&&(n.then(Oi,Oi),n=s),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Wf(e),e;default:if(typeof n.status=="string")n.then(Oi,Oi);else{if(e=At,e!==null&&100<e.shellSuspendCounter)throw Error(o(482));e=n,e.status="pending",e.then(function(l){if(n.status==="pending"){var u=n;u.status="fulfilled",u.value=l}},function(l){if(n.status==="pending"){var u=n;u.status="rejected",u.reason=l}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Wf(e),e}throw ma=n,Ya}}function fa(e){try{var n=e._init;return n(e._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(ma=s,Ya):s}}var ma=null;function Gf(){if(ma===null)throw Error(o(459));var e=ma;return ma=null,e}function Wf(e){if(e===Ya||e===Vl)throw Error(o(483))}var Ka=null,Ro=0;function Kl(e){var n=Ro;return Ro+=1,Ka===null&&(Ka=[]),Ff(Ka,e,n)}function ko(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Fl(e,n){throw n.$$typeof===x?Error(o(525)):(e=Object.prototype.toString.call(n),Error(o(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Xf(e){function n(j,B){if(e){var U=j.deletions;U===null?(j.deletions=[B],j.flags|=16):U.push(B)}}function s(j,B){if(!e)return null;for(;B!==null;)n(j,B),B=B.sibling;return null}function l(j){for(var B=new Map;j!==null;)j.key!==null?B.set(j.key,j):B.set(j.index,j),j=j.sibling;return B}function u(j,B){return j=Zi(j,B),j.index=0,j.sibling=null,j}function d(j,B,U){return j.index=U,e?(U=j.alternate,U!==null?(U=U.index,U<B?(j.flags|=67108866,B):U):(j.flags|=67108866,B)):(j.flags|=1048576,B)}function S(j){return e&&j.alternate===null&&(j.flags|=67108866),j}function T(j,B,U,W){return B===null||B.tag!==6?(B=Nc(U,j.mode,W),B.return=j,B):(B=u(B,U),B.return=j,B)}function L(j,B,U,W){var Ee=U.type;return Ee===g?F(j,B,U.props.children,W,U.key):B!==null&&(B.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===K&&fa(Ee)===B.type)?(B=u(B,U.props),ko(B,U),B.return=j,B):(B=Pl(U.type,U.key,U.props,null,j.mode,W),ko(B,U),B.return=j,B)}function q(j,B,U,W){return B===null||B.tag!==4||B.stateNode.containerInfo!==U.containerInfo||B.stateNode.implementation!==U.implementation?(B=Rc(U,j.mode,W),B.return=j,B):(B=u(B,U.children||[]),B.return=j,B)}function F(j,B,U,W,Ee){return B===null||B.tag!==7?(B=la(U,j.mode,W,Ee),B.return=j,B):(B=u(B,U),B.return=j,B)}function J(j,B,U){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return B=Nc(""+B,j.mode,U),B.return=j,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case _:return U=Pl(B.type,B.key,B.props,null,j.mode,U),ko(U,B),U.return=j,U;case p:return B=Rc(B,j.mode,U),B.return=j,B;case K:return B=fa(B),J(j,B,U)}if(pe(B)||ke(B))return B=la(B,j.mode,U,null),B.return=j,B;if(typeof B.then=="function")return J(j,Kl(B),U);if(B.$$typeof===E)return J(j,zl(j,B),U);Fl(j,B)}return null}function z(j,B,U,W){var Ee=B!==null?B.key:null;if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return Ee!==null?null:T(j,B,""+U,W);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case _:return U.key===Ee?L(j,B,U,W):null;case p:return U.key===Ee?q(j,B,U,W):null;case K:return U=fa(U),z(j,B,U,W)}if(pe(U)||ke(U))return Ee!==null?null:F(j,B,U,W,null);if(typeof U.then=="function")return z(j,B,Kl(U),W);if(U.$$typeof===E)return z(j,B,zl(j,U),W);Fl(j,U)}return null}function Y(j,B,U,W,Ee){if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return j=j.get(U)||null,T(B,j,""+W,Ee);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case _:return j=j.get(W.key===null?U:W.key)||null,L(B,j,W,Ee);case p:return j=j.get(W.key===null?U:W.key)||null,q(B,j,W,Ee);case K:return W=fa(W),Y(j,B,U,W,Ee)}if(pe(W)||ke(W))return j=j.get(U)||null,F(B,j,W,Ee,null);if(typeof W.then=="function")return Y(j,B,U,Kl(W),Ee);if(W.$$typeof===E)return Y(j,B,U,zl(B,W),Ee);Fl(B,W)}return null}function ye(j,B,U,W){for(var Ee=null,tt=null,ve=B,He=B=0,We=null;ve!==null&&He<U.length;He++){ve.index>He?(We=ve,ve=null):We=ve.sibling;var nt=z(j,ve,U[He],W);if(nt===null){ve===null&&(ve=We);break}e&&ve&&nt.alternate===null&&n(j,ve),B=d(nt,B,He),tt===null?Ee=nt:tt.sibling=nt,tt=nt,ve=We}if(He===U.length)return s(j,ve),Qe&&es(j,He),Ee;if(ve===null){for(;He<U.length;He++)ve=J(j,U[He],W),ve!==null&&(B=d(ve,B,He),tt===null?Ee=ve:tt.sibling=ve,tt=ve);return Qe&&es(j,He),Ee}for(ve=l(ve);He<U.length;He++)We=Y(ve,j,He,U[He],W),We!==null&&(e&&We.alternate!==null&&ve.delete(We.key===null?He:We.key),B=d(We,B,He),tt===null?Ee=We:tt.sibling=We,tt=We);return e&&ve.forEach(function(zs){return n(j,zs)}),Qe&&es(j,He),Ee}function Oe(j,B,U,W){if(U==null)throw Error(o(151));for(var Ee=null,tt=null,ve=B,He=B=0,We=null,nt=U.next();ve!==null&&!nt.done;He++,nt=U.next()){ve.index>He?(We=ve,ve=null):We=ve.sibling;var zs=z(j,ve,nt.value,W);if(zs===null){ve===null&&(ve=We);break}e&&ve&&zs.alternate===null&&n(j,ve),B=d(zs,B,He),tt===null?Ee=zs:tt.sibling=zs,tt=zs,ve=We}if(nt.done)return s(j,ve),Qe&&es(j,He),Ee;if(ve===null){for(;!nt.done;He++,nt=U.next())nt=J(j,nt.value,W),nt!==null&&(B=d(nt,B,He),tt===null?Ee=nt:tt.sibling=nt,tt=nt);return Qe&&es(j,He),Ee}for(ve=l(ve);!nt.done;He++,nt=U.next())nt=Y(ve,j,He,nt.value,W),nt!==null&&(e&&nt.alternate!==null&&ve.delete(nt.key===null?He:nt.key),B=d(nt,B,He),tt===null?Ee=nt:tt.sibling=nt,tt=nt);return e&&ve.forEach(function(Lb){return n(j,Lb)}),Qe&&es(j,He),Ee}function bt(j,B,U,W){if(typeof U=="object"&&U!==null&&U.type===g&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case _:e:{for(var Ee=U.key;B!==null;){if(B.key===Ee){if(Ee=U.type,Ee===g){if(B.tag===7){s(j,B.sibling),W=u(B,U.props.children),W.return=j,j=W;break e}}else if(B.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===K&&fa(Ee)===B.type){s(j,B.sibling),W=u(B,U.props),ko(W,U),W.return=j,j=W;break e}s(j,B);break}else n(j,B);B=B.sibling}U.type===g?(W=la(U.props.children,j.mode,W,U.key),W.return=j,j=W):(W=Pl(U.type,U.key,U.props,null,j.mode,W),ko(W,U),W.return=j,j=W)}return S(j);case p:e:{for(Ee=U.key;B!==null;){if(B.key===Ee)if(B.tag===4&&B.stateNode.containerInfo===U.containerInfo&&B.stateNode.implementation===U.implementation){s(j,B.sibling),W=u(B,U.children||[]),W.return=j,j=W;break e}else{s(j,B);break}else n(j,B);B=B.sibling}W=Rc(U,j.mode,W),W.return=j,j=W}return S(j);case K:return U=fa(U),bt(j,B,U,W)}if(pe(U))return ye(j,B,U,W);if(ke(U)){if(Ee=ke(U),typeof Ee!="function")throw Error(o(150));return U=Ee.call(U),Oe(j,B,U,W)}if(typeof U.then=="function")return bt(j,B,Kl(U),W);if(U.$$typeof===E)return bt(j,B,zl(j,U),W);Fl(j,U)}return typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint"?(U=""+U,B!==null&&B.tag===6?(s(j,B.sibling),W=u(B,U),W.return=j,j=W):(s(j,B),W=Nc(U,j.mode,W),W.return=j,j=W),S(j)):s(j,B)}return function(j,B,U,W){try{Ro=0;var Ee=bt(j,B,U,W);return Ka=null,Ee}catch(ve){if(ve===Ya||ve===Vl)throw ve;var tt=ni(29,ve,null,j.mode);return tt.lanes=W,tt.return=j,tt}}}var pa=Xf(!0),Qf=Xf(!1),_s=!1;function $c(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Vc(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ws(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ms(e,n,s){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(st&2)!==0){var u=l.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),l.pending=n,n=Hl(e),If(e,null,s),n}return Dl(e,l,n,s),Hl(e)}function Lo(e,n,s){if(n=n.updateQueue,n!==null&&(n=n.shared,(s&4194048)!==0)){var l=n.lanes;l&=e.pendingLanes,s|=l,n.lanes=s,Gi(e,s)}}function Yc(e,n){var s=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,s===l)){var u=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var S={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?u=d=S:d=d.next=S,s=s.next}while(s!==null);d===null?u=d=n:d=d.next=n}else u=d=n;s={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:d,shared:l.shared,callbacks:l.callbacks},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=n:e.next=n,s.lastBaseUpdate=n}var Kc=!1;function Io(){if(Kc){var e=Va;if(e!==null)throw e}}function Bo(e,n,s,l){Kc=!1;var u=e.updateQueue;_s=!1;var d=u.firstBaseUpdate,S=u.lastBaseUpdate,T=u.shared.pending;if(T!==null){u.shared.pending=null;var L=T,q=L.next;L.next=null,S===null?d=q:S.next=q,S=L;var F=e.alternate;F!==null&&(F=F.updateQueue,T=F.lastBaseUpdate,T!==S&&(T===null?F.firstBaseUpdate=q:T.next=q,F.lastBaseUpdate=L))}if(d!==null){var J=u.baseState;S=0,F=q=L=null,T=d;do{var z=T.lane&-536870913,Y=z!==T.lane;if(Y?(Ge&z)===z:(l&z)===z){z!==0&&z===$a&&(Kc=!0),F!==null&&(F=F.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var ye=e,Oe=T;z=n;var bt=s;switch(Oe.tag){case 1:if(ye=Oe.payload,typeof ye=="function"){J=ye.call(bt,J,z);break e}J=ye;break e;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=Oe.payload,z=typeof ye=="function"?ye.call(bt,J,z):ye,z==null)break e;J=v({},J,z);break e;case 2:_s=!0}}z=T.callback,z!==null&&(e.flags|=64,Y&&(e.flags|=8192),Y=u.callbacks,Y===null?u.callbacks=[z]:Y.push(z))}else Y={lane:z,tag:T.tag,payload:T.payload,callback:T.callback,next:null},F===null?(q=F=Y,L=J):F=F.next=Y,S|=z;if(T=T.next,T===null){if(T=u.shared.pending,T===null)break;Y=T,T=Y.next,Y.next=null,u.lastBaseUpdate=Y,u.shared.pending=null}}while(!0);F===null&&(L=J),u.baseState=L,u.firstBaseUpdate=q,u.lastBaseUpdate=F,d===null&&(u.shared.lanes=0),ks|=S,e.lanes=S,e.memoizedState=J}}function Jf(e,n){if(typeof e!="function")throw Error(o(191,e));e.call(n)}function Zf(e,n){var s=e.callbacks;if(s!==null)for(e.callbacks=null,e=0;e<s.length;e++)Jf(s[e],n)}var Fa=R(null),Gl=R(0);function em(e,n){e=ds,ee(Gl,e),ee(Fa,n),ds=e|n.baseLanes}function Fc(){ee(Gl,ds),ee(Fa,Fa.current)}function Gc(){ds=Gl.current,V(Fa),V(Gl)}var ii=R(null),bi=null;function Os(e){var n=e.alternate;ee(Wt,Wt.current&1),ee(ii,e),bi===null&&(n===null||Fa.current!==null||n.memoizedState!==null)&&(bi=e)}function Wc(e){ee(Wt,Wt.current),ee(ii,e),bi===null&&(bi=e)}function tm(e){e.tag===22?(ee(Wt,Wt.current),ee(ii,e),bi===null&&(bi=e)):Cs()}function Cs(){ee(Wt,Wt.current),ee(ii,ii.current)}function si(e){V(ii),bi===e&&(bi=null),V(Wt)}var Wt=R(0);function Wl(e){for(var n=e;n!==null;){if(n.tag===13){var s=n.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||td(s)||nd(s)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var is=0,je=null,gt=null,Jt=null,Xl=!1,Ga=!1,ha=!1,Ql=0,jo=0,Wa=null,T0=0;function qt(){throw Error(o(321))}function Xc(e,n){if(n===null)return!1;for(var s=0;s<n.length&&s<e.length;s++)if(!ti(e[s],n[s]))return!1;return!0}function Qc(e,n,s,l,u,d){return is=d,je=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,$.H=e===null||e.memoizedState===null?Hm:fu,ha=!1,d=s(l,u),ha=!1,Ga&&(d=im(n,s,l,u)),nm(e),d}function nm(e){$.H=Po;var n=gt!==null&&gt.next!==null;if(is=0,Jt=gt=je=null,Xl=!1,jo=0,Wa=null,n)throw Error(o(300));e===null||Zt||(e=e.dependencies,e!==null&&ql(e)&&(Zt=!0))}function im(e,n,s,l){je=e;var u=0;do{if(Ga&&(Wa=null),jo=0,Ga=!1,25<=u)throw Error(o(301));if(u+=1,Jt=gt=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}$.H=Pm,d=n(s,l)}while(Ga);return d}function E0(){var e=$.H,n=e.useState()[0];return n=typeof n.then=="function"?Do(n):n,e=e.useState()[0],(gt!==null?gt.memoizedState:null)!==e&&(je.flags|=1024),n}function Jc(){var e=Ql!==0;return Ql=0,e}function Zc(e,n,s){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~s}function eu(e){if(Xl){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}Xl=!1}is=0,Jt=gt=je=null,Ga=!1,jo=Ql=0,Wa=null}function In(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?je.memoizedState=Jt=e:Jt=Jt.next=e,Jt}function Xt(){if(gt===null){var e=je.alternate;e=e!==null?e.memoizedState:null}else e=gt.next;var n=Jt===null?je.memoizedState:Jt.next;if(n!==null)Jt=n,gt=e;else{if(e===null)throw je.alternate===null?Error(o(467)):Error(o(310));gt=e,e={memoizedState:gt.memoizedState,baseState:gt.baseState,baseQueue:gt.baseQueue,queue:gt.queue,next:null},Jt===null?je.memoizedState=Jt=e:Jt=Jt.next=e}return Jt}function Jl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Do(e){var n=jo;return jo+=1,Wa===null&&(Wa=[]),e=Ff(Wa,e,n),n=je,(Jt===null?n.memoizedState:Jt.next)===null&&(n=n.alternate,$.H=n===null||n.memoizedState===null?Hm:fu),e}function Zl(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Do(e);if(e.$$typeof===E)return Tn(e)}throw Error(o(438,String(e)))}function tu(e){var n=null,s=je.updateQueue;if(s!==null&&(n=s.memoCache),n==null){var l=je.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(n={data:l.data.map(function(u){return u.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),s===null&&(s=Jl(),je.updateQueue=s),s.memoCache=n,s=n.data[n.index],s===void 0)for(s=n.data[n.index]=Array(e),l=0;l<e;l++)s[l]=xe;return n.index++,s}function ss(e,n){return typeof n=="function"?n(e):n}function er(e){var n=Xt();return nu(n,gt,e)}function nu(e,n,s){var l=e.queue;if(l===null)throw Error(o(311));l.lastRenderedReducer=s;var u=e.baseQueue,d=l.pending;if(d!==null){if(u!==null){var S=u.next;u.next=d.next,d.next=S}n.baseQueue=u=d,l.pending=null}if(d=e.baseState,u===null)e.memoizedState=d;else{n=u.next;var T=S=null,L=null,q=n,F=!1;do{var J=q.lane&-536870913;if(J!==q.lane?(Ge&J)===J:(is&J)===J){var z=q.revertLane;if(z===0)L!==null&&(L=L.next={lane:0,revertLane:0,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),J===$a&&(F=!0);else if((is&z)===z){q=q.next,z===$a&&(F=!0);continue}else J={lane:0,revertLane:q.revertLane,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},L===null?(T=L=J,S=d):L=L.next=J,je.lanes|=z,ks|=z;J=q.action,ha&&s(d,J),d=q.hasEagerState?q.eagerState:s(d,J)}else z={lane:J,revertLane:q.revertLane,gesture:q.gesture,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},L===null?(T=L=z,S=d):L=L.next=z,je.lanes|=J,ks|=J;q=q.next}while(q!==null&&q!==n);if(L===null?S=d:L.next=T,!ti(d,e.memoizedState)&&(Zt=!0,F&&(s=Va,s!==null)))throw s;e.memoizedState=d,e.baseState=S,e.baseQueue=L,l.lastRenderedState=d}return u===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function iu(e){var n=Xt(),s=n.queue;if(s===null)throw Error(o(311));s.lastRenderedReducer=e;var l=s.dispatch,u=s.pending,d=n.memoizedState;if(u!==null){s.pending=null;var S=u=u.next;do d=e(d,S.action),S=S.next;while(S!==u);ti(d,n.memoizedState)||(Zt=!0),n.memoizedState=d,n.baseQueue===null&&(n.baseState=d),s.lastRenderedState=d}return[d,l]}function sm(e,n,s){var l=je,u=Xt(),d=Qe;if(d){if(s===void 0)throw Error(o(407));s=s()}else s=n();var S=!ti((gt||u).memoizedState,s);if(S&&(u.memoizedState=s,Zt=!0),u=u.queue,ou(lm.bind(null,l,u,e),[e]),u.getSnapshot!==n||S||Jt!==null&&Jt.memoizedState.tag&1){if(l.flags|=2048,Xa(9,{destroy:void 0},om.bind(null,l,u,s,n),null),At===null)throw Error(o(349));d||(is&127)!==0||am(l,n,s)}return s}function am(e,n,s){e.flags|=16384,e={getSnapshot:n,value:s},n=je.updateQueue,n===null?(n=Jl(),je.updateQueue=n,n.stores=[e]):(s=n.stores,s===null?n.stores=[e]:s.push(e))}function om(e,n,s,l){n.value=s,n.getSnapshot=l,rm(n)&&cm(e)}function lm(e,n,s){return s(function(){rm(n)&&cm(e)})}function rm(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!ti(e,s)}catch{return!0}}function cm(e){var n=oa(e,2);n!==null&&Gn(n,e,2)}function su(e){var n=In();if(typeof e=="function"){var s=e;if(e=s(),ha){et(!0);try{s()}finally{et(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ss,lastRenderedState:e},n}function um(e,n,s,l){return e.baseState=s,nu(e,gt,typeof l=="function"?l:ss)}function _0(e,n,s,l,u){if(ir(e))throw Error(o(485));if(e=n.action,e!==null){var d={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){d.listeners.push(S)}};$.T!==null?s(!0):d.isTransition=!1,l(d),s=n.pending,s===null?(d.next=n.pending=d,dm(n,d)):(d.next=s.next,n.pending=s.next=d)}}function dm(e,n){var s=n.action,l=n.payload,u=e.state;if(n.isTransition){var d=$.T,S={};$.T=S;try{var T=s(u,l),L=$.S;L!==null&&L(S,T),fm(e,n,T)}catch(q){au(e,n,q)}finally{d!==null&&S.types!==null&&(d.types=S.types),$.T=d}}else try{d=s(u,l),fm(e,n,d)}catch(q){au(e,n,q)}}function fm(e,n,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(l){mm(e,n,l)},function(l){return au(e,n,l)}):mm(e,n,s)}function mm(e,n,s){n.status="fulfilled",n.value=s,pm(n),e.state=s,n=e.pending,n!==null&&(s=n.next,s===n?e.pending=null:(s=s.next,n.next=s,dm(e,s)))}function au(e,n,s){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do n.status="rejected",n.reason=s,pm(n),n=n.next;while(n!==l)}e.action=null}function pm(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function hm(e,n){return n}function gm(e,n){if(Qe){var s=At.formState;if(s!==null){e:{var l=je;if(Qe){if(Mt){t:{for(var u=Mt,d=yi;u.nodeType!==8;){if(!d){u=null;break t}if(u=Si(u.nextSibling),u===null){u=null;break t}}d=u.data,u=d==="F!"||d==="F"?u:null}if(u){Mt=Si(u.nextSibling),l=u.data==="F!";break e}}Ts(l)}l=!1}l&&(n=s[0])}}return s=In(),s.memoizedState=s.baseState=n,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hm,lastRenderedState:n},s.queue=l,s=Bm.bind(null,je,l),l.dispatch=s,l=su(!1),d=du.bind(null,je,!1,l.queue),l=In(),u={state:n,dispatch:null,action:e,pending:null},l.queue=u,s=_0.bind(null,je,u,d,s),u.dispatch=s,l.memoizedState=e,[n,s,!1]}function ym(e){var n=Xt();return bm(n,gt,e)}function bm(e,n,s){if(n=nu(e,n,hm)[0],e=er(ss)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var l=Do(n)}catch(S){throw S===Ya?Vl:S}else l=n;n=Xt();var u=n.queue,d=u.dispatch;return s!==n.memoizedState&&(je.flags|=2048,Xa(9,{destroy:void 0},w0.bind(null,u,s),null)),[l,d,e]}function w0(e,n){e.action=n}function Sm(e){var n=Xt(),s=gt;if(s!==null)return bm(n,s,e);Xt(),n=n.memoizedState,s=Xt();var l=s.queue.dispatch;return s.memoizedState=e,[n,l,!1]}function Xa(e,n,s,l){return e={tag:e,create:s,deps:l,inst:n,next:null},n=je.updateQueue,n===null&&(n=Jl(),je.updateQueue=n),s=n.lastEffect,s===null?n.lastEffect=e.next=e:(l=s.next,s.next=e,e.next=l,n.lastEffect=e),e}function vm(){return Xt().memoizedState}function tr(e,n,s,l){var u=In();je.flags|=e,u.memoizedState=Xa(1|n,{destroy:void 0},s,l===void 0?null:l)}function nr(e,n,s,l){var u=Xt();l=l===void 0?null:l;var d=u.memoizedState.inst;gt!==null&&l!==null&&Xc(l,gt.memoizedState.deps)?u.memoizedState=Xa(n,d,s,l):(je.flags|=e,u.memoizedState=Xa(1|n,d,s,l))}function xm(e,n){tr(8390656,8,e,n)}function ou(e,n){nr(2048,8,e,n)}function M0(e){je.flags|=4;var n=je.updateQueue;if(n===null)n=Jl(),je.updateQueue=n,n.events=[e];else{var s=n.events;s===null?n.events=[e]:s.push(e)}}function Am(e){var n=Xt().memoizedState;return M0({ref:n,nextImpl:e}),function(){if((st&2)!==0)throw Error(o(440));return n.impl.apply(void 0,arguments)}}function Tm(e,n){return nr(4,2,e,n)}function Em(e,n){return nr(4,4,e,n)}function _m(e,n){if(typeof n=="function"){e=e();var s=n(e);return function(){typeof s=="function"?s():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function wm(e,n,s){s=s!=null?s.concat([e]):null,nr(4,4,_m.bind(null,n,e),s)}function lu(){}function Mm(e,n){var s=Xt();n=n===void 0?null:n;var l=s.memoizedState;return n!==null&&Xc(n,l[1])?l[0]:(s.memoizedState=[e,n],e)}function Om(e,n){var s=Xt();n=n===void 0?null:n;var l=s.memoizedState;if(n!==null&&Xc(n,l[1]))return l[0];if(l=e(),ha){et(!0);try{e()}finally{et(!1)}}return s.memoizedState=[l,n],l}function ru(e,n,s){return s===void 0||(is&1073741824)!==0&&(Ge&261930)===0?e.memoizedState=n:(e.memoizedState=s,e=Cp(),je.lanes|=e,ks|=e,s)}function Cm(e,n,s,l){return ti(s,n)?s:Fa.current!==null?(e=ru(e,s,l),ti(e,n)||(Zt=!0),e):(is&42)===0||(is&1073741824)!==0&&(Ge&261930)===0?(Zt=!0,e.memoizedState=s):(e=Cp(),je.lanes|=e,ks|=e,n)}function Nm(e,n,s,l,u){var d=Z.p;Z.p=d!==0&&8>d?d:8;var S=$.T,T={};$.T=T,du(e,!1,n,s);try{var L=u(),q=$.S;if(q!==null&&q(T,L),L!==null&&typeof L=="object"&&typeof L.then=="function"){var F=A0(L,l);Ho(e,n,F,li(e))}else Ho(e,n,l,li(e))}catch(J){Ho(e,n,{then:function(){},status:"rejected",reason:J},li())}finally{Z.p=d,S!==null&&T.types!==null&&(S.types=T.types),$.T=S}}function O0(){}function cu(e,n,s,l){if(e.tag!==5)throw Error(o(476));var u=Rm(e).queue;Nm(e,u,n,ae,s===null?O0:function(){return km(e),s(l)})}function Rm(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:ae,baseState:ae,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ss,lastRenderedState:ae},next:null};var s={};return n.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ss,lastRenderedState:s},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function km(e){var n=Rm(e);n.next===null&&(n=e.alternate.memoizedState),Ho(e,n.next.queue,{},li())}function uu(){return Tn(tl)}function Lm(){return Xt().memoizedState}function Im(){return Xt().memoizedState}function C0(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var s=li();e=ws(s);var l=Ms(n,e,s);l!==null&&(Gn(l,n,s),Lo(l,n,s)),n={cache:Pc()},e.payload=n;return}n=n.return}}function N0(e,n,s){var l=li();s={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},ir(e)?jm(n,s):(s=Oc(e,n,s,l),s!==null&&(Gn(s,e,l),Dm(s,n,l)))}function Bm(e,n,s){var l=li();Ho(e,n,s,l)}function Ho(e,n,s,l){var u={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(ir(e))jm(n,u);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=n.lastRenderedReducer,d!==null))try{var S=n.lastRenderedState,T=d(S,s);if(u.hasEagerState=!0,u.eagerState=T,ti(T,S))return Dl(e,n,u,0),At===null&&jl(),!1}catch{}if(s=Oc(e,n,u,l),s!==null)return Gn(s,e,l),Dm(s,n,l),!0}return!1}function du(e,n,s,l){if(l={lane:2,revertLane:$u(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},ir(e)){if(n)throw Error(o(479))}else n=Oc(e,s,l,2),n!==null&&Gn(n,e,2)}function ir(e){var n=e.alternate;return e===je||n!==null&&n===je}function jm(e,n){Ga=Xl=!0;var s=e.pending;s===null?n.next=n:(n.next=s.next,s.next=n),e.pending=n}function Dm(e,n,s){if((s&4194048)!==0){var l=n.lanes;l&=e.pendingLanes,s|=l,n.lanes=s,Gi(e,s)}}var Po={readContext:Tn,use:Zl,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useLayoutEffect:qt,useInsertionEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useSyncExternalStore:qt,useId:qt,useHostTransitionStatus:qt,useFormState:qt,useActionState:qt,useOptimistic:qt,useMemoCache:qt,useCacheRefresh:qt};Po.useEffectEvent=qt;var Hm={readContext:Tn,use:Zl,useCallback:function(e,n){return In().memoizedState=[e,n===void 0?null:n],e},useContext:Tn,useEffect:xm,useImperativeHandle:function(e,n,s){s=s!=null?s.concat([e]):null,tr(4194308,4,_m.bind(null,n,e),s)},useLayoutEffect:function(e,n){return tr(4194308,4,e,n)},useInsertionEffect:function(e,n){tr(4,2,e,n)},useMemo:function(e,n){var s=In();n=n===void 0?null:n;var l=e();if(ha){et(!0);try{e()}finally{et(!1)}}return s.memoizedState=[l,n],l},useReducer:function(e,n,s){var l=In();if(s!==void 0){var u=s(n);if(ha){et(!0);try{s(n)}finally{et(!1)}}}else u=n;return l.memoizedState=l.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},l.queue=e,e=e.dispatch=N0.bind(null,je,e),[l.memoizedState,e]},useRef:function(e){var n=In();return e={current:e},n.memoizedState=e},useState:function(e){e=su(e);var n=e.queue,s=Bm.bind(null,je,n);return n.dispatch=s,[e.memoizedState,s]},useDebugValue:lu,useDeferredValue:function(e,n){var s=In();return ru(s,e,n)},useTransition:function(){var e=su(!1);return e=Nm.bind(null,je,e.queue,!0,!1),In().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,s){var l=je,u=In();if(Qe){if(s===void 0)throw Error(o(407));s=s()}else{if(s=n(),At===null)throw Error(o(349));(Ge&127)!==0||am(l,n,s)}u.memoizedState=s;var d={value:s,getSnapshot:n};return u.queue=d,xm(lm.bind(null,l,d,e),[e]),l.flags|=2048,Xa(9,{destroy:void 0},om.bind(null,l,d,s,n),null),s},useId:function(){var e=In(),n=At.identifierPrefix;if(Qe){var s=$i,l=zi;s=(l&~(1<<32-Et(l)-1)).toString(32)+s,n="_"+n+"R_"+s,s=Ql++,0<s&&(n+="H"+s.toString(32)),n+="_"}else s=T0++,n="_"+n+"r_"+s.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:uu,useFormState:gm,useActionState:gm,useOptimistic:function(e){var n=In();n.memoizedState=n.baseState=e;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=s,n=du.bind(null,je,!0,s),s.dispatch=n,[e,n]},useMemoCache:tu,useCacheRefresh:function(){return In().memoizedState=C0.bind(null,je)},useEffectEvent:function(e){var n=In(),s={impl:e};return n.memoizedState=s,function(){if((st&2)!==0)throw Error(o(440));return s.impl.apply(void 0,arguments)}}},fu={readContext:Tn,use:Zl,useCallback:Mm,useContext:Tn,useEffect:ou,useImperativeHandle:wm,useInsertionEffect:Tm,useLayoutEffect:Em,useMemo:Om,useReducer:er,useRef:vm,useState:function(){return er(ss)},useDebugValue:lu,useDeferredValue:function(e,n){var s=Xt();return Cm(s,gt.memoizedState,e,n)},useTransition:function(){var e=er(ss)[0],n=Xt().memoizedState;return[typeof e=="boolean"?e:Do(e),n]},useSyncExternalStore:sm,useId:Lm,useHostTransitionStatus:uu,useFormState:ym,useActionState:ym,useOptimistic:function(e,n){var s=Xt();return um(s,gt,e,n)},useMemoCache:tu,useCacheRefresh:Im};fu.useEffectEvent=Am;var Pm={readContext:Tn,use:Zl,useCallback:Mm,useContext:Tn,useEffect:ou,useImperativeHandle:wm,useInsertionEffect:Tm,useLayoutEffect:Em,useMemo:Om,useReducer:iu,useRef:vm,useState:function(){return iu(ss)},useDebugValue:lu,useDeferredValue:function(e,n){var s=Xt();return gt===null?ru(s,e,n):Cm(s,gt.memoizedState,e,n)},useTransition:function(){var e=iu(ss)[0],n=Xt().memoizedState;return[typeof e=="boolean"?e:Do(e),n]},useSyncExternalStore:sm,useId:Lm,useHostTransitionStatus:uu,useFormState:Sm,useActionState:Sm,useOptimistic:function(e,n){var s=Xt();return gt!==null?um(s,gt,e,n):(s.baseState=e,[e,s.queue.dispatch])},useMemoCache:tu,useCacheRefresh:Im};Pm.useEffectEvent=Am;function mu(e,n,s,l){n=e.memoizedState,s=s(l,n),s=s==null?n:v({},n,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var pu={enqueueSetState:function(e,n,s){e=e._reactInternals;var l=li(),u=ws(l);u.payload=n,s!=null&&(u.callback=s),n=Ms(e,u,l),n!==null&&(Gn(n,e,l),Lo(n,e,l))},enqueueReplaceState:function(e,n,s){e=e._reactInternals;var l=li(),u=ws(l);u.tag=1,u.payload=n,s!=null&&(u.callback=s),n=Ms(e,u,l),n!==null&&(Gn(n,e,l),Lo(n,e,l))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var s=li(),l=ws(s);l.tag=2,n!=null&&(l.callback=n),n=Ms(e,l,s),n!==null&&(Gn(n,e,s),Lo(n,e,s))}};function Um(e,n,s,l,u,d,S){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,d,S):n.prototype&&n.prototype.isPureReactComponent?!_o(s,l)||!_o(u,d):!0}function qm(e,n,s,l){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(s,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(s,l),n.state!==e&&pu.enqueueReplaceState(n,n.state,null)}function ga(e,n){var s=n;if("ref"in n){s={};for(var l in n)l!=="ref"&&(s[l]=n[l])}if(e=e.defaultProps){s===n&&(s=v({},s));for(var u in e)s[u]===void 0&&(s[u]=e[u])}return s}function zm(e){Bl(e)}function $m(e){console.error(e)}function Vm(e){Bl(e)}function sr(e,n){try{var s=e.onUncaughtError;s(n.value,{componentStack:n.stack})}catch(l){setTimeout(function(){throw l})}}function Ym(e,n,s){try{var l=e.onCaughtError;l(s.value,{componentStack:s.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function hu(e,n,s){return s=ws(s),s.tag=3,s.payload={element:null},s.callback=function(){sr(e,n)},s}function Km(e){return e=ws(e),e.tag=3,e}function Fm(e,n,s,l){var u=s.type.getDerivedStateFromError;if(typeof u=="function"){var d=l.value;e.payload=function(){return u(d)},e.callback=function(){Ym(n,s,l)}}var S=s.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(e.callback=function(){Ym(n,s,l),typeof u!="function"&&(Ls===null?Ls=new Set([this]):Ls.add(this));var T=l.stack;this.componentDidCatch(l.value,{componentStack:T!==null?T:""})})}function R0(e,n,s,l,u){if(s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(n=s.alternate,n!==null&&za(n,s,u,!0),s=ii.current,s!==null){switch(s.tag){case 31:case 13:return bi===null?gr():s.alternate===null&&zt===0&&(zt=3),s.flags&=-257,s.flags|=65536,s.lanes=u,l===Yl?s.flags|=16384:(n=s.updateQueue,n===null?s.updateQueue=new Set([l]):n.add(l),Uu(e,l,u)),!1;case 22:return s.flags|=65536,l===Yl?s.flags|=16384:(n=s.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([l])},s.updateQueue=n):(s=n.retryQueue,s===null?n.retryQueue=new Set([l]):s.add(l)),Uu(e,l,u)),!1}throw Error(o(435,s.tag))}return Uu(e,l,u),gr(),!1}if(Qe)return n=ii.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=u,l!==Ic&&(e=Error(o(422),{cause:l}),Oo(pi(e,s)))):(l!==Ic&&(n=Error(o(423),{cause:l}),Oo(pi(n,s))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,l=pi(l,s),u=hu(e.stateNode,l,u),Yc(e,u),zt!==4&&(zt=2)),!1;var d=Error(o(520),{cause:l});if(d=pi(d,s),Fo===null?Fo=[d]:Fo.push(d),zt!==4&&(zt=2),n===null)return!0;l=pi(l,s),s=n;do{switch(s.tag){case 3:return s.flags|=65536,e=u&-u,s.lanes|=e,e=hu(s.stateNode,l,e),Yc(s,e),!1;case 1:if(n=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Ls===null||!Ls.has(d))))return s.flags|=65536,u&=-u,s.lanes|=u,u=Km(u),Fm(u,e,s,l),Yc(s,u),!1}s=s.return}while(s!==null);return!1}var gu=Error(o(461)),Zt=!1;function En(e,n,s,l){n.child=e===null?Qf(n,null,s,l):pa(n,e.child,s,l)}function Gm(e,n,s,l,u){s=s.render;var d=n.ref;if("ref"in l){var S={};for(var T in l)T!=="ref"&&(S[T]=l[T])}else S=l;return ua(n),l=Qc(e,n,s,S,d,u),T=Jc(),e!==null&&!Zt?(Zc(e,n,u),as(e,n,u)):(Qe&&T&&kc(n),n.flags|=1,En(e,n,l,u),n.child)}function Wm(e,n,s,l,u){if(e===null){var d=s.type;return typeof d=="function"&&!Cc(d)&&d.defaultProps===void 0&&s.compare===null?(n.tag=15,n.type=d,Xm(e,n,d,l,u)):(e=Pl(s.type,null,l,n,n.mode,u),e.ref=n.ref,e.return=n,n.child=e)}if(d=e.child,!Eu(e,u)){var S=d.memoizedProps;if(s=s.compare,s=s!==null?s:_o,s(S,l)&&e.ref===n.ref)return as(e,n,u)}return n.flags|=1,e=Zi(d,l),e.ref=n.ref,e.return=n,n.child=e}function Xm(e,n,s,l,u){if(e!==null){var d=e.memoizedProps;if(_o(d,l)&&e.ref===n.ref)if(Zt=!1,n.pendingProps=l=d,Eu(e,u))(e.flags&131072)!==0&&(Zt=!0);else return n.lanes=e.lanes,as(e,n,u)}return yu(e,n,s,l,u)}function Qm(e,n,s,l){var u=l.children,d=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((n.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,e!==null){for(l=n.child=e.child,u=0;l!==null;)u=u|l.lanes|l.childLanes,l=l.sibling;l=u&~d}else l=0,n.child=null;return Jm(e,n,d,s,l)}if((s&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&$l(n,d!==null?d.cachePool:null),d!==null?em(n,d):Fc(),tm(n);else return l=n.lanes=536870912,Jm(e,n,d!==null?d.baseLanes|s:s,s,l)}else d!==null?($l(n,d.cachePool),em(n,d),Cs(),n.memoizedState=null):(e!==null&&$l(n,null),Fc(),Cs());return En(e,n,u,s),n.child}function Uo(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Jm(e,n,s,l,u){var d=qc();return d=d===null?null:{parent:Qt._currentValue,pool:d},n.memoizedState={baseLanes:s,cachePool:d},e!==null&&$l(n,null),Fc(),tm(n),e!==null&&za(e,n,l,!0),n.childLanes=u,null}function ar(e,n){return n=lr({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function Zm(e,n,s){return pa(n,e.child,null,s),e=ar(n,n.pendingProps),e.flags|=2,si(n),n.memoizedState=null,e}function k0(e,n,s){var l=n.pendingProps,u=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(Qe){if(l.mode==="hidden")return e=ar(n,l),n.lanes=536870912,Uo(null,e);if(Wc(n),(e=Mt)?(e=dh(e,yi),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:xs!==null?{id:zi,overflow:$i}:null,retryLane:536870912,hydrationErrors:null},s=jf(e),s.return=n,n.child=s,An=n,Mt=null)):e=null,e===null)throw Ts(n);return n.lanes=536870912,null}return ar(n,l)}var d=e.memoizedState;if(d!==null){var S=d.dehydrated;if(Wc(n),u)if(n.flags&256)n.flags&=-257,n=Zm(e,n,s);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(o(558));else if(Zt||za(e,n,s,!1),u=(s&e.childLanes)!==0,Zt||u){if(l=At,l!==null&&(S=di(l,s),S!==0&&S!==d.retryLane))throw d.retryLane=S,oa(e,S),Gn(l,e,S),gu;gr(),n=Zm(e,n,s)}else e=d.treeContext,Mt=Si(S.nextSibling),An=n,Qe=!0,As=null,yi=!1,e!==null&&Pf(n,e),n=ar(n,l),n.flags|=4096;return n}return e=Zi(e.child,{mode:l.mode,children:l.children}),e.ref=n.ref,n.child=e,e.return=n,e}function or(e,n){var s=n.ref;if(s===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(o(284));(e===null||e.ref!==s)&&(n.flags|=4194816)}}function yu(e,n,s,l,u){return ua(n),s=Qc(e,n,s,l,void 0,u),l=Jc(),e!==null&&!Zt?(Zc(e,n,u),as(e,n,u)):(Qe&&l&&kc(n),n.flags|=1,En(e,n,s,u),n.child)}function ep(e,n,s,l,u,d){return ua(n),n.updateQueue=null,s=im(n,l,s,u),nm(e),l=Jc(),e!==null&&!Zt?(Zc(e,n,d),as(e,n,d)):(Qe&&l&&kc(n),n.flags|=1,En(e,n,s,d),n.child)}function tp(e,n,s,l,u){if(ua(n),n.stateNode===null){var d=Ha,S=s.contextType;typeof S=="object"&&S!==null&&(d=Tn(S)),d=new s(l,d),n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=pu,n.stateNode=d,d._reactInternals=n,d=n.stateNode,d.props=l,d.state=n.memoizedState,d.refs={},$c(n),S=s.contextType,d.context=typeof S=="object"&&S!==null?Tn(S):Ha,d.state=n.memoizedState,S=s.getDerivedStateFromProps,typeof S=="function"&&(mu(n,s,S,l),d.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(S=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),S!==d.state&&pu.enqueueReplaceState(d,d.state,null),Bo(n,l,d,u),Io(),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308),l=!0}else if(e===null){d=n.stateNode;var T=n.memoizedProps,L=ga(s,T);d.props=L;var q=d.context,F=s.contextType;S=Ha,typeof F=="object"&&F!==null&&(S=Tn(F));var J=s.getDerivedStateFromProps;F=typeof J=="function"||typeof d.getSnapshotBeforeUpdate=="function",T=n.pendingProps!==T,F||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(T||q!==S)&&qm(n,d,l,S),_s=!1;var z=n.memoizedState;d.state=z,Bo(n,l,d,u),Io(),q=n.memoizedState,T||z!==q||_s?(typeof J=="function"&&(mu(n,s,J,l),q=n.memoizedState),(L=_s||Um(n,s,L,l,z,q,S))?(F||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(n.flags|=4194308)):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=q),d.props=l,d.state=q,d.context=S,l=L):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{d=n.stateNode,Vc(e,n),S=n.memoizedProps,F=ga(s,S),d.props=F,J=n.pendingProps,z=d.context,q=s.contextType,L=Ha,typeof q=="object"&&q!==null&&(L=Tn(q)),T=s.getDerivedStateFromProps,(q=typeof T=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(S!==J||z!==L)&&qm(n,d,l,L),_s=!1,z=n.memoizedState,d.state=z,Bo(n,l,d,u),Io();var Y=n.memoizedState;S!==J||z!==Y||_s||e!==null&&e.dependencies!==null&&ql(e.dependencies)?(typeof T=="function"&&(mu(n,s,T,l),Y=n.memoizedState),(F=_s||Um(n,s,F,l,z,Y,L)||e!==null&&e.dependencies!==null&&ql(e.dependencies))?(q||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(l,Y,L),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(l,Y,L)),typeof d.componentDidUpdate=="function"&&(n.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof d.componentDidUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=Y),d.props=l,d.state=Y,d.context=L,l=F):(typeof d.componentDidUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=1024),l=!1)}return d=l,or(e,n),l=(n.flags&128)!==0,d||l?(d=n.stateNode,s=l&&typeof s.getDerivedStateFromError!="function"?null:d.render(),n.flags|=1,e!==null&&l?(n.child=pa(n,e.child,null,u),n.child=pa(n,null,s,u)):En(e,n,s,u),n.memoizedState=d.state,e=n.child):e=as(e,n,u),e}function np(e,n,s,l){return ra(),n.flags|=256,En(e,n,s,l),n.child}var bu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Su(e){return{baseLanes:e,cachePool:Yf()}}function vu(e,n,s){return e=e!==null?e.childLanes&~s:0,n&&(e|=oi),e}function ip(e,n,s){var l=n.pendingProps,u=!1,d=(n.flags&128)!==0,S;if((S=d)||(S=e!==null&&e.memoizedState===null?!1:(Wt.current&2)!==0),S&&(u=!0,n.flags&=-129),S=(n.flags&32)!==0,n.flags&=-33,e===null){if(Qe){if(u?Os(n):Cs(),(e=Mt)?(e=dh(e,yi),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:xs!==null?{id:zi,overflow:$i}:null,retryLane:536870912,hydrationErrors:null},s=jf(e),s.return=n,n.child=s,An=n,Mt=null)):e=null,e===null)throw Ts(n);return nd(e)?n.lanes=32:n.lanes=536870912,null}var T=l.children;return l=l.fallback,u?(Cs(),u=n.mode,T=lr({mode:"hidden",children:T},u),l=la(l,u,s,null),T.return=n,l.return=n,T.sibling=l,n.child=T,l=n.child,l.memoizedState=Su(s),l.childLanes=vu(e,S,s),n.memoizedState=bu,Uo(null,l)):(Os(n),xu(n,T))}var L=e.memoizedState;if(L!==null&&(T=L.dehydrated,T!==null)){if(d)n.flags&256?(Os(n),n.flags&=-257,n=Au(e,n,s)):n.memoizedState!==null?(Cs(),n.child=e.child,n.flags|=128,n=null):(Cs(),T=l.fallback,u=n.mode,l=lr({mode:"visible",children:l.children},u),T=la(T,u,s,null),T.flags|=2,l.return=n,T.return=n,l.sibling=T,n.child=l,pa(n,e.child,null,s),l=n.child,l.memoizedState=Su(s),l.childLanes=vu(e,S,s),n.memoizedState=bu,n=Uo(null,l));else if(Os(n),nd(T)){if(S=T.nextSibling&&T.nextSibling.dataset,S)var q=S.dgst;S=q,l=Error(o(419)),l.stack="",l.digest=S,Oo({value:l,source:null,stack:null}),n=Au(e,n,s)}else if(Zt||za(e,n,s,!1),S=(s&e.childLanes)!==0,Zt||S){if(S=At,S!==null&&(l=di(S,s),l!==0&&l!==L.retryLane))throw L.retryLane=l,oa(e,l),Gn(S,e,l),gu;td(T)||gr(),n=Au(e,n,s)}else td(T)?(n.flags|=192,n.child=e.child,n=null):(e=L.treeContext,Mt=Si(T.nextSibling),An=n,Qe=!0,As=null,yi=!1,e!==null&&Pf(n,e),n=xu(n,l.children),n.flags|=4096);return n}return u?(Cs(),T=l.fallback,u=n.mode,L=e.child,q=L.sibling,l=Zi(L,{mode:"hidden",children:l.children}),l.subtreeFlags=L.subtreeFlags&65011712,q!==null?T=Zi(q,T):(T=la(T,u,s,null),T.flags|=2),T.return=n,l.return=n,l.sibling=T,n.child=l,Uo(null,l),l=n.child,T=e.child.memoizedState,T===null?T=Su(s):(u=T.cachePool,u!==null?(L=Qt._currentValue,u=u.parent!==L?{parent:L,pool:L}:u):u=Yf(),T={baseLanes:T.baseLanes|s,cachePool:u}),l.memoizedState=T,l.childLanes=vu(e,S,s),n.memoizedState=bu,Uo(e.child,l)):(Os(n),s=e.child,e=s.sibling,s=Zi(s,{mode:"visible",children:l.children}),s.return=n,s.sibling=null,e!==null&&(S=n.deletions,S===null?(n.deletions=[e],n.flags|=16):S.push(e)),n.child=s,n.memoizedState=null,s)}function xu(e,n){return n=lr({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function lr(e,n){return e=ni(22,e,null,n),e.lanes=0,e}function Au(e,n,s){return pa(n,e.child,null,s),e=xu(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function sp(e,n,s){e.lanes|=n;var l=e.alternate;l!==null&&(l.lanes|=n),Dc(e.return,n,s)}function Tu(e,n,s,l,u,d){var S=e.memoizedState;S===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:s,tailMode:u,treeForkCount:d}:(S.isBackwards=n,S.rendering=null,S.renderingStartTime=0,S.last=l,S.tail=s,S.tailMode=u,S.treeForkCount=d)}function ap(e,n,s){var l=n.pendingProps,u=l.revealOrder,d=l.tail;l=l.children;var S=Wt.current,T=(S&2)!==0;if(T?(S=S&1|2,n.flags|=128):S&=1,ee(Wt,S),En(e,n,l,s),l=Qe?Mo:0,!T&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&sp(e,s,n);else if(e.tag===19)sp(e,s,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(u){case"forwards":for(s=n.child,u=null;s!==null;)e=s.alternate,e!==null&&Wl(e)===null&&(u=s),s=s.sibling;s=u,s===null?(u=n.child,n.child=null):(u=s.sibling,s.sibling=null),Tu(n,!1,u,s,d,l);break;case"backwards":case"unstable_legacy-backwards":for(s=null,u=n.child,n.child=null;u!==null;){if(e=u.alternate,e!==null&&Wl(e)===null){n.child=u;break}e=u.sibling,u.sibling=s,s=u,u=e}Tu(n,!0,s,null,d,l);break;case"together":Tu(n,!1,null,null,void 0,l);break;default:n.memoizedState=null}return n.child}function as(e,n,s){if(e!==null&&(n.dependencies=e.dependencies),ks|=n.lanes,(s&n.childLanes)===0)if(e!==null){if(za(e,n,s,!1),(s&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(o(153));if(n.child!==null){for(e=n.child,s=Zi(e,e.pendingProps),n.child=s,s.return=n;e.sibling!==null;)e=e.sibling,s=s.sibling=Zi(e,e.pendingProps),s.return=n;s.sibling=null}return n.child}function Eu(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&ql(e)))}function L0(e,n,s){switch(n.tag){case 3:mt(n,n.stateNode.containerInfo),Es(n,Qt,e.memoizedState.cache),ra();break;case 27:case 5:It(n);break;case 4:mt(n,n.stateNode.containerInfo);break;case 10:Es(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Wc(n),null;break;case 13:var l=n.memoizedState;if(l!==null)return l.dehydrated!==null?(Os(n),n.flags|=128,null):(s&n.child.childLanes)!==0?ip(e,n,s):(Os(n),e=as(e,n,s),e!==null?e.sibling:null);Os(n);break;case 19:var u=(e.flags&128)!==0;if(l=(s&n.childLanes)!==0,l||(za(e,n,s,!1),l=(s&n.childLanes)!==0),u){if(l)return ap(e,n,s);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),ee(Wt,Wt.current),l)break;return null;case 22:return n.lanes=0,Qm(e,n,s,n.pendingProps);case 24:Es(n,Qt,e.memoizedState.cache)}return as(e,n,s)}function op(e,n,s){if(e!==null)if(e.memoizedProps!==n.pendingProps)Zt=!0;else{if(!Eu(e,s)&&(n.flags&128)===0)return Zt=!1,L0(e,n,s);Zt=(e.flags&131072)!==0}else Zt=!1,Qe&&(n.flags&1048576)!==0&&Hf(n,Mo,n.index);switch(n.lanes=0,n.tag){case 16:e:{var l=n.pendingProps;if(e=fa(n.elementType),n.type=e,typeof e=="function")Cc(e)?(l=ga(e,l),n.tag=1,n=tp(null,n,e,l,s)):(n.tag=0,n=yu(null,n,e,l,s));else{if(e!=null){var u=e.$$typeof;if(u===w){n.tag=11,n=Gm(null,n,e,l,s);break e}else if(u===C){n.tag=14,n=Wm(null,n,e,l,s);break e}}throw n=Te(e)||e,Error(o(306,n,""))}}return n;case 0:return yu(e,n,n.type,n.pendingProps,s);case 1:return l=n.type,u=ga(l,n.pendingProps),tp(e,n,l,u,s);case 3:e:{if(mt(n,n.stateNode.containerInfo),e===null)throw Error(o(387));l=n.pendingProps;var d=n.memoizedState;u=d.element,Vc(e,n),Bo(n,l,null,s);var S=n.memoizedState;if(l=S.cache,Es(n,Qt,l),l!==d.cache&&Hc(n,[Qt],s,!0),Io(),l=S.element,d.isDehydrated)if(d={element:l,isDehydrated:!1,cache:S.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=np(e,n,l,s);break e}else if(l!==u){u=pi(Error(o(424)),n),Oo(u),n=np(e,n,l,s);break e}else for(e=n.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,Mt=Si(e.firstChild),An=n,Qe=!0,As=null,yi=!0,s=Qf(n,null,l,s),n.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ra(),l===u){n=as(e,n,s);break e}En(e,n,l,s)}n=n.child}return n;case 26:return or(e,n),e===null?(s=yh(n.type,null,n.pendingProps,null))?n.memoizedState=s:Qe||(s=n.type,e=n.pendingProps,l=Tr(Ne.current).createElement(s),l[we]=n,l[be]=e,_n(l,s,e),Nt(l),n.stateNode=l):n.memoizedState=yh(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return It(n),e===null&&Qe&&(l=n.stateNode=ph(n.type,n.pendingProps,Ne.current),An=n,yi=!0,u=Mt,Ds(n.type)?(id=u,Mt=Si(l.firstChild)):Mt=u),En(e,n,n.pendingProps.children,s),or(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Qe&&((u=l=Mt)&&(l=cb(l,n.type,n.pendingProps,yi),l!==null?(n.stateNode=l,An=n,Mt=Si(l.firstChild),yi=!1,u=!0):u=!1),u||Ts(n)),It(n),u=n.type,d=n.pendingProps,S=e!==null?e.memoizedProps:null,l=d.children,Ju(u,d)?l=null:S!==null&&Ju(u,S)&&(n.flags|=32),n.memoizedState!==null&&(u=Qc(e,n,E0,null,null,s),tl._currentValue=u),or(e,n),En(e,n,l,s),n.child;case 6:return e===null&&Qe&&((e=s=Mt)&&(s=ub(s,n.pendingProps,yi),s!==null?(n.stateNode=s,An=n,Mt=null,e=!0):e=!1),e||Ts(n)),null;case 13:return ip(e,n,s);case 4:return mt(n,n.stateNode.containerInfo),l=n.pendingProps,e===null?n.child=pa(n,null,l,s):En(e,n,l,s),n.child;case 11:return Gm(e,n,n.type,n.pendingProps,s);case 7:return En(e,n,n.pendingProps,s),n.child;case 8:return En(e,n,n.pendingProps.children,s),n.child;case 12:return En(e,n,n.pendingProps.children,s),n.child;case 10:return l=n.pendingProps,Es(n,n.type,l.value),En(e,n,l.children,s),n.child;case 9:return u=n.type._context,l=n.pendingProps.children,ua(n),u=Tn(u),l=l(u),n.flags|=1,En(e,n,l,s),n.child;case 14:return Wm(e,n,n.type,n.pendingProps,s);case 15:return Xm(e,n,n.type,n.pendingProps,s);case 19:return ap(e,n,s);case 31:return k0(e,n,s);case 22:return Qm(e,n,s,n.pendingProps);case 24:return ua(n),l=Tn(Qt),e===null?(u=qc(),u===null&&(u=At,d=Pc(),u.pooledCache=d,d.refCount++,d!==null&&(u.pooledCacheLanes|=s),u=d),n.memoizedState={parent:l,cache:u},$c(n),Es(n,Qt,u)):((e.lanes&s)!==0&&(Vc(e,n),Bo(n,null,null,s),Io()),u=e.memoizedState,d=n.memoizedState,u.parent!==l?(u={parent:l,cache:l},n.memoizedState=u,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=u),Es(n,Qt,l)):(l=d.cache,Es(n,Qt,l),l!==u.cache&&Hc(n,[Qt],s,!0))),En(e,n,n.pendingProps.children,s),n.child;case 29:throw n.pendingProps}throw Error(o(156,n.tag))}function os(e){e.flags|=4}function _u(e,n,s,l,u){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(u&335544128)===u)if(e.stateNode.complete)e.flags|=8192;else if(Lp())e.flags|=8192;else throw ma=Yl,zc}else e.flags&=-16777217}function lp(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Ah(n))if(Lp())e.flags|=8192;else throw ma=Yl,zc}function rr(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?Zn():536870912,e.lanes|=n,eo|=n)}function qo(e,n){if(!Qe)switch(e.tailMode){case"hidden":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Ot(e){var n=e.alternate!==null&&e.alternate.child===e.child,s=0,l=0;if(n)for(var u=e.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags&65011712,l|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=l,e.childLanes=s,n}function I0(e,n,s){var l=n.pendingProps;switch(Lc(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ot(n),null;case 1:return Ot(n),null;case 3:return s=n.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),n.memoizedState.cache!==l&&(n.flags|=2048),ns(Qt),qe(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(qa(n)?os(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Bc())),Ot(n),null;case 26:var u=n.type,d=n.memoizedState;return e===null?(os(n),d!==null?(Ot(n),lp(n,d)):(Ot(n),_u(n,u,null,l,s))):d?d!==e.memoizedState?(os(n),Ot(n),lp(n,d)):(Ot(n),n.flags&=-16777217):(e=e.memoizedProps,e!==l&&os(n),Ot(n),_u(n,u,e,l,s)),null;case 27:if(ze(n),s=Ne.current,u=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==l&&os(n);else{if(!l){if(n.stateNode===null)throw Error(o(166));return Ot(n),null}e=ue.current,qa(n)?Uf(n):(e=ph(u,l,s),n.stateNode=e,os(n))}return Ot(n),null;case 5:if(ze(n),u=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==l&&os(n);else{if(!l){if(n.stateNode===null)throw Error(o(166));return Ot(n),null}if(d=ue.current,qa(n))Uf(n);else{var S=Tr(Ne.current);switch(d){case 1:d=S.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:d=S.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":d=S.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":d=S.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":d=S.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof l.is=="string"?S.createElement("select",{is:l.is}):S.createElement("select"),l.multiple?d.multiple=!0:l.size&&(d.size=l.size);break;default:d=typeof l.is=="string"?S.createElement(u,{is:l.is}):S.createElement(u)}}d[we]=n,d[be]=l;e:for(S=n.child;S!==null;){if(S.tag===5||S.tag===6)d.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===n)break e;for(;S.sibling===null;){if(S.return===null||S.return===n)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}n.stateNode=d;e:switch(_n(d,u,l),u){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&os(n)}}return Ot(n),_u(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,s),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==l&&os(n);else{if(typeof l!="string"&&n.stateNode===null)throw Error(o(166));if(e=Ne.current,qa(n)){if(e=n.stateNode,s=n.memoizedProps,l=null,u=An,u!==null)switch(u.tag){case 27:case 5:l=u.memoizedProps}e[we]=n,e=!!(e.nodeValue===s||l!==null&&l.suppressHydrationWarning===!0||ih(e.nodeValue,s)),e||Ts(n,!0)}else e=Tr(e).createTextNode(l),e[we]=n,n.stateNode=e}return Ot(n),null;case 31:if(s=n.memoizedState,e===null||e.memoizedState!==null){if(l=qa(n),s!==null){if(e===null){if(!l)throw Error(o(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(557));e[we]=n}else ra(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ot(n),e=!1}else s=Bc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=s),e=!0;if(!e)return n.flags&256?(si(n),n):(si(n),null);if((n.flags&128)!==0)throw Error(o(558))}return Ot(n),null;case 13:if(l=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=qa(n),l!==null&&l.dehydrated!==null){if(e===null){if(!u)throw Error(o(318));if(u=n.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));u[we]=n}else ra(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Ot(n),u=!1}else u=Bc(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return n.flags&256?(si(n),n):(si(n),null)}return si(n),(n.flags&128)!==0?(n.lanes=s,n):(s=l!==null,e=e!==null&&e.memoizedState!==null,s&&(l=n.child,u=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(u=l.alternate.memoizedState.cachePool.pool),d=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(d=l.memoizedState.cachePool.pool),d!==u&&(l.flags|=2048)),s!==e&&s&&(n.child.flags|=8192),rr(n,n.updateQueue),Ot(n),null);case 4:return qe(),e===null&&Fu(n.stateNode.containerInfo),Ot(n),null;case 10:return ns(n.type),Ot(n),null;case 19:if(V(Wt),l=n.memoizedState,l===null)return Ot(n),null;if(u=(n.flags&128)!==0,d=l.rendering,d===null)if(u)qo(l,!1);else{if(zt!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(d=Wl(e),d!==null){for(n.flags|=128,qo(l,!1),e=d.updateQueue,n.updateQueue=e,rr(n,e),n.subtreeFlags=0,e=s,s=n.child;s!==null;)Bf(s,e),s=s.sibling;return ee(Wt,Wt.current&1|2),Qe&&es(n,l.treeForkCount),n.child}e=e.sibling}l.tail!==null&&Fe()>mr&&(n.flags|=128,u=!0,qo(l,!1),n.lanes=4194304)}else{if(!u)if(e=Wl(d),e!==null){if(n.flags|=128,u=!0,e=e.updateQueue,n.updateQueue=e,rr(n,e),qo(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!Qe)return Ot(n),null}else 2*Fe()-l.renderingStartTime>mr&&s!==536870912&&(n.flags|=128,u=!0,qo(l,!1),n.lanes=4194304);l.isBackwards?(d.sibling=n.child,n.child=d):(e=l.last,e!==null?e.sibling=d:n.child=d,l.last=d)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=Fe(),e.sibling=null,s=Wt.current,ee(Wt,u?s&1|2:s&1),Qe&&es(n,l.treeForkCount),e):(Ot(n),null);case 22:case 23:return si(n),Gc(),l=n.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(n.flags|=8192):l&&(n.flags|=8192),l?(s&536870912)!==0&&(n.flags&128)===0&&(Ot(n),n.subtreeFlags&6&&(n.flags|=8192)):Ot(n),s=n.updateQueue,s!==null&&rr(n,s.retryQueue),s=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),l=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),l!==s&&(n.flags|=2048),e!==null&&V(da),null;case 24:return s=null,e!==null&&(s=e.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),ns(Qt),Ot(n),null;case 25:return null;case 30:return null}throw Error(o(156,n.tag))}function B0(e,n){switch(Lc(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return ns(Qt),qe(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return ze(n),null;case 31:if(n.memoizedState!==null){if(si(n),n.alternate===null)throw Error(o(340));ra()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(si(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(o(340));ra()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return V(Wt),null;case 4:return qe(),null;case 10:return ns(n.type),null;case 22:case 23:return si(n),Gc(),e!==null&&V(da),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return ns(Qt),null;case 25:return null;default:return null}}function rp(e,n){switch(Lc(n),n.tag){case 3:ns(Qt),qe();break;case 26:case 27:case 5:ze(n);break;case 4:qe();break;case 31:n.memoizedState!==null&&si(n);break;case 13:si(n);break;case 19:V(Wt);break;case 10:ns(n.type);break;case 22:case 23:si(n),Gc(),e!==null&&V(da);break;case 24:ns(Qt)}}function zo(e,n){try{var s=n.updateQueue,l=s!==null?s.lastEffect:null;if(l!==null){var u=l.next;s=u;do{if((s.tag&e)===e){l=void 0;var d=s.create,S=s.inst;l=d(),S.destroy=l}s=s.next}while(s!==u)}}catch(T){ft(n,n.return,T)}}function Ns(e,n,s){try{var l=n.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var d=u.next;l=d;do{if((l.tag&e)===e){var S=l.inst,T=S.destroy;if(T!==void 0){S.destroy=void 0,u=n;var L=s,q=T;try{q()}catch(F){ft(u,L,F)}}}l=l.next}while(l!==d)}}catch(F){ft(n,n.return,F)}}function cp(e){var n=e.updateQueue;if(n!==null){var s=e.stateNode;try{Zf(n,s)}catch(l){ft(e,e.return,l)}}}function up(e,n,s){s.props=ga(e.type,e.memoizedProps),s.state=e.memoizedState;try{s.componentWillUnmount()}catch(l){ft(e,n,l)}}function $o(e,n){try{var s=e.ref;if(s!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof s=="function"?e.refCleanup=s(l):s.current=l}}catch(u){ft(e,n,u)}}function Vi(e,n){var s=e.ref,l=e.refCleanup;if(s!==null)if(typeof l=="function")try{l()}catch(u){ft(e,n,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(u){ft(e,n,u)}else s.current=null}function dp(e){var n=e.type,s=e.memoizedProps,l=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":s.autoFocus&&l.focus();break e;case"img":s.src?l.src=s.src:s.srcSet&&(l.srcset=s.srcSet)}}catch(u){ft(e,e.return,u)}}function wu(e,n,s){try{var l=e.stateNode;ib(l,e.type,s,n),l[be]=n}catch(u){ft(e,e.return,u)}}function fp(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ds(e.type)||e.tag===4}function Mu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||fp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ds(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ou(e,n,s){var l=e.tag;if(l===5||l===6)e=e.stateNode,n?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(e,n):(n=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,n.appendChild(e),s=s._reactRootContainer,s!=null||n.onclick!==null||(n.onclick=Oi));else if(l!==4&&(l===27&&Ds(e.type)&&(s=e.stateNode,n=null),e=e.child,e!==null))for(Ou(e,n,s),e=e.sibling;e!==null;)Ou(e,n,s),e=e.sibling}function cr(e,n,s){var l=e.tag;if(l===5||l===6)e=e.stateNode,n?s.insertBefore(e,n):s.appendChild(e);else if(l!==4&&(l===27&&Ds(e.type)&&(s=e.stateNode),e=e.child,e!==null))for(cr(e,n,s),e=e.sibling;e!==null;)cr(e,n,s),e=e.sibling}function mp(e){var n=e.stateNode,s=e.memoizedProps;try{for(var l=e.type,u=n.attributes;u.length;)n.removeAttributeNode(u[0]);_n(n,l,s),n[we]=e,n[be]=s}catch(d){ft(e,e.return,d)}}var ls=!1,en=!1,Cu=!1,pp=typeof WeakSet=="function"?WeakSet:Set,yn=null;function j0(e,n){if(e=e.containerInfo,Xu=Nr,e=wf(e),Ac(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var l=s.getSelection&&s.getSelection();if(l&&l.rangeCount!==0){s=l.anchorNode;var u=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var S=0,T=-1,L=-1,q=0,F=0,J=e,z=null;t:for(;;){for(var Y;J!==s||u!==0&&J.nodeType!==3||(T=S+u),J!==d||l!==0&&J.nodeType!==3||(L=S+l),J.nodeType===3&&(S+=J.nodeValue.length),(Y=J.firstChild)!==null;)z=J,J=Y;for(;;){if(J===e)break t;if(z===s&&++q===u&&(T=S),z===d&&++F===l&&(L=S),(Y=J.nextSibling)!==null)break;J=z,z=J.parentNode}J=Y}s=T===-1||L===-1?null:{start:T,end:L}}else s=null}s=s||{start:0,end:0}}else s=null;for(Qu={focusedElem:e,selectionRange:s},Nr=!1,yn=n;yn!==null;)if(n=yn,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,yn=e;else for(;yn!==null;){switch(n=yn,d=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(s=0;s<e.length;s++)u=e[s],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,s=n,u=d.memoizedProps,d=d.memoizedState,l=s.stateNode;try{var ye=ga(s.type,u);e=l.getSnapshotBeforeUpdate(ye,d),l.__reactInternalSnapshotBeforeUpdate=e}catch(Oe){ft(s,s.return,Oe)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,s=e.nodeType,s===9)ed(e);else if(s===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ed(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(o(163))}if(e=n.sibling,e!==null){e.return=n.return,yn=e;break}yn=n.return}}function hp(e,n,s){var l=s.flags;switch(s.tag){case 0:case 11:case 15:cs(e,s),l&4&&zo(5,s);break;case 1:if(cs(e,s),l&4)if(e=s.stateNode,n===null)try{e.componentDidMount()}catch(S){ft(s,s.return,S)}else{var u=ga(s.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(u,n,e.__reactInternalSnapshotBeforeUpdate)}catch(S){ft(s,s.return,S)}}l&64&&cp(s),l&512&&$o(s,s.return);break;case 3:if(cs(e,s),l&64&&(e=s.updateQueue,e!==null)){if(n=null,s.child!==null)switch(s.child.tag){case 27:case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}try{Zf(e,n)}catch(S){ft(s,s.return,S)}}break;case 27:n===null&&l&4&&mp(s);case 26:case 5:cs(e,s),n===null&&l&4&&dp(s),l&512&&$o(s,s.return);break;case 12:cs(e,s);break;case 31:cs(e,s),l&4&&bp(e,s);break;case 13:cs(e,s),l&4&&Sp(e,s),l&64&&(e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(s=Y0.bind(null,s),db(e,s))));break;case 22:if(l=s.memoizedState!==null||ls,!l){n=n!==null&&n.memoizedState!==null||en,u=ls;var d=en;ls=l,(en=n)&&!d?us(e,s,(s.subtreeFlags&8772)!==0):cs(e,s),ls=u,en=d}break;case 30:break;default:cs(e,s)}}function gp(e){var n=e.alternate;n!==null&&(e.alternate=null,gp(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&kn(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Rt=null,Vn=!1;function rs(e,n,s){for(s=s.child;s!==null;)yp(e,n,s),s=s.sibling}function yp(e,n,s){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(Kt,s)}catch{}switch(s.tag){case 26:en||Vi(s,n),rs(e,n,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:en||Vi(s,n);var l=Rt,u=Vn;Ds(s.type)&&(Rt=s.stateNode,Vn=!1),rs(e,n,s),Jo(s.stateNode),Rt=l,Vn=u;break;case 5:en||Vi(s,n);case 6:if(l=Rt,u=Vn,Rt=null,rs(e,n,s),Rt=l,Vn=u,Rt!==null)if(Vn)try{(Rt.nodeType===9?Rt.body:Rt.nodeName==="HTML"?Rt.ownerDocument.body:Rt).removeChild(s.stateNode)}catch(d){ft(s,n,d)}else try{Rt.removeChild(s.stateNode)}catch(d){ft(s,n,d)}break;case 18:Rt!==null&&(Vn?(e=Rt,ch(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,s.stateNode),ro(e)):ch(Rt,s.stateNode));break;case 4:l=Rt,u=Vn,Rt=s.stateNode.containerInfo,Vn=!0,rs(e,n,s),Rt=l,Vn=u;break;case 0:case 11:case 14:case 15:Ns(2,s,n),en||Ns(4,s,n),rs(e,n,s);break;case 1:en||(Vi(s,n),l=s.stateNode,typeof l.componentWillUnmount=="function"&&up(s,n,l)),rs(e,n,s);break;case 21:rs(e,n,s);break;case 22:en=(l=en)||s.memoizedState!==null,rs(e,n,s),en=l;break;default:rs(e,n,s)}}function bp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{ro(e)}catch(s){ft(n,n.return,s)}}}function Sp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ro(e)}catch(s){ft(n,n.return,s)}}function D0(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new pp),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new pp),n;default:throw Error(o(435,e.tag))}}function ur(e,n){var s=D0(e);n.forEach(function(l){if(!s.has(l)){s.add(l);var u=K0.bind(null,e,l);l.then(u,u)}})}function Yn(e,n){var s=n.deletions;if(s!==null)for(var l=0;l<s.length;l++){var u=s[l],d=e,S=n,T=S;e:for(;T!==null;){switch(T.tag){case 27:if(Ds(T.type)){Rt=T.stateNode,Vn=!1;break e}break;case 5:Rt=T.stateNode,Vn=!1;break e;case 3:case 4:Rt=T.stateNode.containerInfo,Vn=!0;break e}T=T.return}if(Rt===null)throw Error(o(160));yp(d,S,u),Rt=null,Vn=!1,d=u.alternate,d!==null&&(d.return=null),u.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)vp(n,e),n=n.sibling}var Ri=null;function vp(e,n){var s=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Yn(n,e),Kn(e),l&4&&(Ns(3,e,e.return),zo(3,e),Ns(5,e,e.return));break;case 1:Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),l&64&&ls&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(s=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=s===null?l:s.concat(l))));break;case 26:var u=Ri;if(Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),l&4){var d=s!==null?s.memoizedState:null;if(l=e.memoizedState,s===null)if(l===null)if(e.stateNode===null){e:{l=e.type,s=e.memoizedProps,u=u.ownerDocument||u;t:switch(l){case"title":d=u.getElementsByTagName("title")[0],(!d||d[Ct]||d[we]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=u.createElement(l),u.head.insertBefore(d,u.querySelector("head > title"))),_n(d,l,s),d[we]=e,Nt(d),l=d;break e;case"link":var S=vh("link","href",u).get(l+(s.href||""));if(S){for(var T=0;T<S.length;T++)if(d=S[T],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){S.splice(T,1);break t}}d=u.createElement(l),_n(d,l,s),u.head.appendChild(d);break;case"meta":if(S=vh("meta","content",u).get(l+(s.content||""))){for(T=0;T<S.length;T++)if(d=S[T],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){S.splice(T,1);break t}}d=u.createElement(l),_n(d,l,s),u.head.appendChild(d);break;default:throw Error(o(468,l))}d[we]=e,Nt(d),l=d}e.stateNode=l}else xh(u,e.type,e.stateNode);else e.stateNode=Sh(u,l,e.memoizedProps);else d!==l?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,l===null?xh(u,e.type,e.stateNode):Sh(u,l,e.memoizedProps)):l===null&&e.stateNode!==null&&wu(e,e.memoizedProps,s.memoizedProps)}break;case 27:Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),s!==null&&l&4&&wu(e,e.memoizedProps,s.memoizedProps);break;case 5:if(Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),e.flags&32){u=e.stateNode;try{pn(u,"")}catch(ye){ft(e,e.return,ye)}}l&4&&e.stateNode!=null&&(u=e.memoizedProps,wu(e,u,s!==null?s.memoizedProps:u)),l&1024&&(Cu=!0);break;case 6:if(Yn(n,e),Kn(e),l&4){if(e.stateNode===null)throw Error(o(162));l=e.memoizedProps,s=e.stateNode;try{s.nodeValue=l}catch(ye){ft(e,e.return,ye)}}break;case 3:if(wr=null,u=Ri,Ri=Er(n.containerInfo),Yn(n,e),Ri=u,Kn(e),l&4&&s!==null&&s.memoizedState.isDehydrated)try{ro(n.containerInfo)}catch(ye){ft(e,e.return,ye)}Cu&&(Cu=!1,xp(e));break;case 4:l=Ri,Ri=Er(e.stateNode.containerInfo),Yn(n,e),Kn(e),Ri=l;break;case 12:Yn(n,e),Kn(e);break;case 31:Yn(n,e),Kn(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,ur(e,l)));break;case 13:Yn(n,e),Kn(e),e.child.flags&8192&&e.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(fr=Fe()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,ur(e,l)));break;case 22:u=e.memoizedState!==null;var L=s!==null&&s.memoizedState!==null,q=ls,F=en;if(ls=q||u,en=F||L,Yn(n,e),en=F,ls=q,Kn(e),l&8192)e:for(n=e.stateNode,n._visibility=u?n._visibility&-2:n._visibility|1,u&&(s===null||L||ls||en||ya(e)),s=null,n=e;;){if(n.tag===5||n.tag===26){if(s===null){L=s=n;try{if(d=L.stateNode,u)S=d.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{T=L.stateNode;var J=L.memoizedProps.style,z=J!=null&&J.hasOwnProperty("display")?J.display:null;T.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(ye){ft(L,L.return,ye)}}}else if(n.tag===6){if(s===null){L=n;try{L.stateNode.nodeValue=u?"":L.memoizedProps}catch(ye){ft(L,L.return,ye)}}}else if(n.tag===18){if(s===null){L=n;try{var Y=L.stateNode;u?uh(Y,!0):uh(L.stateNode,!1)}catch(ye){ft(L,L.return,ye)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;s===n&&(s=null),n=n.return}s===n&&(s=null),n.sibling.return=n.return,n=n.sibling}l&4&&(l=e.updateQueue,l!==null&&(s=l.retryQueue,s!==null&&(l.retryQueue=null,ur(e,s))));break;case 19:Yn(n,e),Kn(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,ur(e,l)));break;case 30:break;case 21:break;default:Yn(n,e),Kn(e)}}function Kn(e){var n=e.flags;if(n&2){try{for(var s,l=e.return;l!==null;){if(fp(l)){s=l;break}l=l.return}if(s==null)throw Error(o(160));switch(s.tag){case 27:var u=s.stateNode,d=Mu(e);cr(e,d,u);break;case 5:var S=s.stateNode;s.flags&32&&(pn(S,""),s.flags&=-33);var T=Mu(e);cr(e,T,S);break;case 3:case 4:var L=s.stateNode.containerInfo,q=Mu(e);Ou(e,q,L);break;default:throw Error(o(161))}}catch(F){ft(e,e.return,F)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function xp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;xp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function cs(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)hp(e,n.alternate,n),n=n.sibling}function ya(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:Ns(4,n,n.return),ya(n);break;case 1:Vi(n,n.return);var s=n.stateNode;typeof s.componentWillUnmount=="function"&&up(n,n.return,s),ya(n);break;case 27:Jo(n.stateNode);case 26:case 5:Vi(n,n.return),ya(n);break;case 22:n.memoizedState===null&&ya(n);break;case 30:ya(n);break;default:ya(n)}e=e.sibling}}function us(e,n,s){for(s=s&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var l=n.alternate,u=e,d=n,S=d.flags;switch(d.tag){case 0:case 11:case 15:us(u,d,s),zo(4,d);break;case 1:if(us(u,d,s),l=d,u=l.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(q){ft(l,l.return,q)}if(l=d,u=l.updateQueue,u!==null){var T=l.stateNode;try{var L=u.shared.hiddenCallbacks;if(L!==null)for(u.shared.hiddenCallbacks=null,u=0;u<L.length;u++)Jf(L[u],T)}catch(q){ft(l,l.return,q)}}s&&S&64&&cp(d),$o(d,d.return);break;case 27:mp(d);case 26:case 5:us(u,d,s),s&&l===null&&S&4&&dp(d),$o(d,d.return);break;case 12:us(u,d,s);break;case 31:us(u,d,s),s&&S&4&&bp(u,d);break;case 13:us(u,d,s),s&&S&4&&Sp(u,d);break;case 22:d.memoizedState===null&&us(u,d,s),$o(d,d.return);break;case 30:break;default:us(u,d,s)}n=n.sibling}}function Nu(e,n){var s=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==s&&(e!=null&&e.refCount++,s!=null&&Co(s))}function Ru(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Co(e))}function ki(e,n,s,l){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Ap(e,n,s,l),n=n.sibling}function Ap(e,n,s,l){var u=n.flags;switch(n.tag){case 0:case 11:case 15:ki(e,n,s,l),u&2048&&zo(9,n);break;case 1:ki(e,n,s,l);break;case 3:ki(e,n,s,l),u&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&Co(e)));break;case 12:if(u&2048){ki(e,n,s,l),e=n.stateNode;try{var d=n.memoizedProps,S=d.id,T=d.onPostCommit;typeof T=="function"&&T(S,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(L){ft(n,n.return,L)}}else ki(e,n,s,l);break;case 31:ki(e,n,s,l);break;case 13:ki(e,n,s,l);break;case 23:break;case 22:d=n.stateNode,S=n.alternate,n.memoizedState!==null?d._visibility&2?ki(e,n,s,l):Vo(e,n):d._visibility&2?ki(e,n,s,l):(d._visibility|=2,Qa(e,n,s,l,(n.subtreeFlags&10256)!==0||!1)),u&2048&&Nu(S,n);break;case 24:ki(e,n,s,l),u&2048&&Ru(n.alternate,n);break;default:ki(e,n,s,l)}}function Qa(e,n,s,l,u){for(u=u&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var d=e,S=n,T=s,L=l,q=S.flags;switch(S.tag){case 0:case 11:case 15:Qa(d,S,T,L,u),zo(8,S);break;case 23:break;case 22:var F=S.stateNode;S.memoizedState!==null?F._visibility&2?Qa(d,S,T,L,u):Vo(d,S):(F._visibility|=2,Qa(d,S,T,L,u)),u&&q&2048&&Nu(S.alternate,S);break;case 24:Qa(d,S,T,L,u),u&&q&2048&&Ru(S.alternate,S);break;default:Qa(d,S,T,L,u)}n=n.sibling}}function Vo(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var s=e,l=n,u=l.flags;switch(l.tag){case 22:Vo(s,l),u&2048&&Nu(l.alternate,l);break;case 24:Vo(s,l),u&2048&&Ru(l.alternate,l);break;default:Vo(s,l)}n=n.sibling}}var Yo=8192;function Ja(e,n,s){if(e.subtreeFlags&Yo)for(e=e.child;e!==null;)Tp(e,n,s),e=e.sibling}function Tp(e,n,s){switch(e.tag){case 26:Ja(e,n,s),e.flags&Yo&&e.memoizedState!==null&&Tb(s,Ri,e.memoizedState,e.memoizedProps);break;case 5:Ja(e,n,s);break;case 3:case 4:var l=Ri;Ri=Er(e.stateNode.containerInfo),Ja(e,n,s),Ri=l;break;case 22:e.memoizedState===null&&(l=e.alternate,l!==null&&l.memoizedState!==null?(l=Yo,Yo=16777216,Ja(e,n,s),Yo=l):Ja(e,n,s));break;default:Ja(e,n,s)}}function Ep(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Ko(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var l=n[s];yn=l,wp(l,e)}Ep(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)_p(e),e=e.sibling}function _p(e){switch(e.tag){case 0:case 11:case 15:Ko(e),e.flags&2048&&Ns(9,e,e.return);break;case 3:Ko(e);break;case 12:Ko(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,dr(e)):Ko(e);break;default:Ko(e)}}function dr(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var l=n[s];yn=l,wp(l,e)}Ep(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:Ns(8,n,n.return),dr(n);break;case 22:s=n.stateNode,s._visibility&2&&(s._visibility&=-3,dr(n));break;default:dr(n)}e=e.sibling}}function wp(e,n){for(;yn!==null;){var s=yn;switch(s.tag){case 0:case 11:case 15:Ns(8,s,n);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var l=s.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:Co(s.memoizedState.cache)}if(l=s.child,l!==null)l.return=s,yn=l;else e:for(s=e;yn!==null;){l=yn;var u=l.sibling,d=l.return;if(gp(l),l===s){yn=null;break e}if(u!==null){u.return=d,yn=u;break e}yn=d}}}var H0={getCacheForType:function(e){var n=Tn(Qt),s=n.data.get(e);return s===void 0&&(s=e(),n.data.set(e,s)),s},cacheSignal:function(){return Tn(Qt).controller.signal}},P0=typeof WeakMap=="function"?WeakMap:Map,st=0,At=null,Ye=null,Ge=0,dt=0,ai=null,Rs=!1,Za=!1,ku=!1,ds=0,zt=0,ks=0,ba=0,Lu=0,oi=0,eo=0,Fo=null,Fn=null,Iu=!1,fr=0,Mp=0,mr=1/0,pr=null,Ls=null,sn=0,Is=null,to=null,fs=0,Bu=0,ju=null,Op=null,Go=0,Du=null;function li(){return(st&2)!==0&&Ge!==0?Ge&-Ge:$.T!==null?$u():X()}function Cp(){if(oi===0)if((Ge&536870912)===0||Qe){var e=dn;dn<<=1,(dn&3932160)===0&&(dn=262144),oi=e}else oi=536870912;return e=ii.current,e!==null&&(e.flags|=32),oi}function Gn(e,n,s){(e===At&&(dt===2||dt===9)||e.cancelPendingCommit!==null)&&(no(e,0),Bs(e,Ge,oi,!1)),Gt(e,s),((st&2)===0||e!==At)&&(e===At&&((st&2)===0&&(ba|=s),zt===4&&Bs(e,Ge,oi,!1)),Yi(e))}function Np(e,n,s){if((st&6)!==0)throw Error(o(327));var l=!s&&(n&127)===0&&(n&e.expiredLanes)===0||Rn(e,n),u=l?z0(e,n):Pu(e,n,!0),d=l;do{if(u===0){Za&&!l&&Bs(e,n,0,!1);break}else{if(s=e.current.alternate,d&&!U0(s)){u=Pu(e,n,!1),d=!1;continue}if(u===2){if(d=n,e.errorRecoveryDisabledLanes&d)var S=0;else S=e.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){n=S;e:{var T=e;u=Fo;var L=T.current.memoizedState.isDehydrated;if(L&&(no(T,S).flags|=256),S=Pu(T,S,!1),S!==2){if(ku&&!L){T.errorRecoveryDisabledLanes|=d,ba|=d,u=4;break e}d=Fn,Fn=u,d!==null&&(Fn===null?Fn=d:Fn.push.apply(Fn,d))}u=S}if(d=!1,u!==2)continue}}if(u===1){no(e,0),Bs(e,n,0,!0);break}e:{switch(l=e,d=u,d){case 0:case 1:throw Error(o(345));case 4:if((n&4194048)!==n)break;case 6:Bs(l,n,oi,!Rs);break e;case 2:Fn=null;break;case 3:case 5:break;default:throw Error(o(329))}if((n&62914560)===n&&(u=fr+300-Fe(),10<u)){if(Bs(l,n,oi,!Rs),Ft(l,0,!0)!==0)break e;fs=n,l.timeoutHandle=lh(Rp.bind(null,l,s,Fn,pr,Iu,n,oi,ba,eo,Rs,d,"Throttled",-0,0),u);break e}Rp(l,s,Fn,pr,Iu,n,oi,ba,eo,Rs,d,null,-0,0)}}break}while(!0);Yi(e)}function Rp(e,n,s,l,u,d,S,T,L,q,F,J,z,Y){if(e.timeoutHandle=-1,J=n.subtreeFlags,J&8192||(J&16785408)===16785408){J={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Oi},Tp(n,d,J);var ye=(d&62914560)===d?fr-Fe():(d&4194048)===d?Mp-Fe():0;if(ye=Eb(J,ye),ye!==null){fs=d,e.cancelPendingCommit=ye(Pp.bind(null,e,n,d,s,l,u,S,T,L,F,J,null,z,Y)),Bs(e,d,S,!q);return}}Pp(e,n,d,s,l,u,S,T,L)}function U0(e){for(var n=e;;){var s=n.tag;if((s===0||s===11||s===15)&&n.flags&16384&&(s=n.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var l=0;l<s.length;l++){var u=s[l],d=u.getSnapshot;u=u.value;try{if(!ti(d(),u))return!1}catch{return!1}}if(s=n.child,n.subtreeFlags&16384&&s!==null)s.return=n,n=s;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Bs(e,n,s,l){n&=~Lu,n&=~ba,e.suspendedLanes|=n,e.pingedLanes&=~n,l&&(e.warmLanes|=n),l=e.expirationTimes;for(var u=n;0<u;){var d=31-Et(u),S=1<<d;l[d]=-1,u&=~S}s!==0&&Pi(e,s,n)}function hr(){return(st&6)===0?(Wo(0),!1):!0}function Hu(){if(Ye!==null){if(dt===0)var e=Ye.return;else e=Ye,ts=ca=null,eu(e),Ka=null,Ro=0,e=Ye;for(;e!==null;)rp(e.alternate,e),e=e.return;Ye=null}}function no(e,n){var s=e.timeoutHandle;s!==-1&&(e.timeoutHandle=-1,ob(s)),s=e.cancelPendingCommit,s!==null&&(e.cancelPendingCommit=null,s()),fs=0,Hu(),At=e,Ye=s=Zi(e.current,null),Ge=n,dt=0,ai=null,Rs=!1,Za=Rn(e,n),ku=!1,eo=oi=Lu=ba=ks=zt=0,Fn=Fo=null,Iu=!1,(n&8)!==0&&(n|=n&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=n;0<l;){var u=31-Et(l),d=1<<u;n|=e[u],l&=~d}return ds=n,jl(),s}function kp(e,n){je=null,$.H=Po,n===Ya||n===Vl?(n=Gf(),dt=3):n===zc?(n=Gf(),dt=4):dt=n===gu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,ai=n,Ye===null&&(zt=1,sr(e,pi(n,e.current)))}function Lp(){var e=ii.current;return e===null?!0:(Ge&4194048)===Ge?bi===null:(Ge&62914560)===Ge||(Ge&536870912)!==0?e===bi:!1}function Ip(){var e=$.H;return $.H=Po,e===null?Po:e}function Bp(){var e=$.A;return $.A=H0,e}function gr(){zt=4,Rs||(Ge&4194048)!==Ge&&ii.current!==null||(Za=!0),(ks&134217727)===0&&(ba&134217727)===0||At===null||Bs(At,Ge,oi,!1)}function Pu(e,n,s){var l=st;st|=2;var u=Ip(),d=Bp();(At!==e||Ge!==n)&&(pr=null,no(e,n)),n=!1;var S=zt;e:do try{if(dt!==0&&Ye!==null){var T=Ye,L=ai;switch(dt){case 8:Hu(),S=6;break e;case 3:case 2:case 9:case 6:ii.current===null&&(n=!0);var q=dt;if(dt=0,ai=null,io(e,T,L,q),s&&Za){S=0;break e}break;default:q=dt,dt=0,ai=null,io(e,T,L,q)}}q0(),S=zt;break}catch(F){kp(e,F)}while(!0);return n&&e.shellSuspendCounter++,ts=ca=null,st=l,$.H=u,$.A=d,Ye===null&&(At=null,Ge=0,jl()),S}function q0(){for(;Ye!==null;)jp(Ye)}function z0(e,n){var s=st;st|=2;var l=Ip(),u=Bp();At!==e||Ge!==n?(pr=null,mr=Fe()+500,no(e,n)):Za=Rn(e,n);e:do try{if(dt!==0&&Ye!==null){n=Ye;var d=ai;t:switch(dt){case 1:dt=0,ai=null,io(e,n,d,1);break;case 2:case 9:if(Kf(d)){dt=0,ai=null,Dp(n);break}n=function(){dt!==2&&dt!==9||At!==e||(dt=7),Yi(e)},d.then(n,n);break e;case 3:dt=7;break e;case 4:dt=5;break e;case 7:Kf(d)?(dt=0,ai=null,Dp(n)):(dt=0,ai=null,io(e,n,d,7));break;case 5:var S=null;switch(Ye.tag){case 26:S=Ye.memoizedState;case 5:case 27:var T=Ye;if(S?Ah(S):T.stateNode.complete){dt=0,ai=null;var L=T.sibling;if(L!==null)Ye=L;else{var q=T.return;q!==null?(Ye=q,yr(q)):Ye=null}break t}}dt=0,ai=null,io(e,n,d,5);break;case 6:dt=0,ai=null,io(e,n,d,6);break;case 8:Hu(),zt=6;break e;default:throw Error(o(462))}}$0();break}catch(F){kp(e,F)}while(!0);return ts=ca=null,$.H=l,$.A=u,st=s,Ye!==null?0:(At=null,Ge=0,jl(),zt)}function $0(){for(;Ye!==null&&!Qn();)jp(Ye)}function jp(e){var n=op(e.alternate,e,ds);e.memoizedProps=e.pendingProps,n===null?yr(e):Ye=n}function Dp(e){var n=e,s=n.alternate;switch(n.tag){case 15:case 0:n=ep(s,n,n.pendingProps,n.type,void 0,Ge);break;case 11:n=ep(s,n,n.pendingProps,n.type.render,n.ref,Ge);break;case 5:eu(n);default:rp(s,n),n=Ye=Bf(n,ds),n=op(s,n,ds)}e.memoizedProps=e.pendingProps,n===null?yr(e):Ye=n}function io(e,n,s,l){ts=ca=null,eu(n),Ka=null,Ro=0;var u=n.return;try{if(R0(e,u,n,s,Ge)){zt=1,sr(e,pi(s,e.current)),Ye=null;return}}catch(d){if(u!==null)throw Ye=u,d;zt=1,sr(e,pi(s,e.current)),Ye=null;return}n.flags&32768?(Qe||l===1?e=!0:Za||(Ge&536870912)!==0?e=!1:(Rs=e=!0,(l===2||l===9||l===3||l===6)&&(l=ii.current,l!==null&&l.tag===13&&(l.flags|=16384))),Hp(n,e)):yr(n)}function yr(e){var n=e;do{if((n.flags&32768)!==0){Hp(n,Rs);return}e=n.return;var s=I0(n.alternate,n,ds);if(s!==null){Ye=s;return}if(n=n.sibling,n!==null){Ye=n;return}Ye=n=e}while(n!==null);zt===0&&(zt=5)}function Hp(e,n){do{var s=B0(e.alternate,e);if(s!==null){s.flags&=32767,Ye=s;return}if(s=e.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!n&&(e=e.sibling,e!==null)){Ye=e;return}Ye=e=s}while(e!==null);zt=6,Ye=null}function Pp(e,n,s,l,u,d,S,T,L){e.cancelPendingCommit=null;do br();while(sn!==0);if((st&6)!==0)throw Error(o(327));if(n!==null){if(n===e.current)throw Error(o(177));if(d=n.lanes|n.childLanes,d|=Mc,Pn(e,s,d,S,T,L),e===At&&(Ye=At=null,Ge=0),to=n,Is=e,fs=s,Bu=d,ju=u,Op=l,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,F0(cn,function(){return Vp(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||l){l=$.T,$.T=null,u=Z.p,Z.p=2,S=st,st|=4;try{j0(e,n,s)}finally{st=S,Z.p=u,$.T=l}}sn=1,Up(),qp(),zp()}}function Up(){if(sn===1){sn=0;var e=Is,n=to,s=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||s){s=$.T,$.T=null;var l=Z.p;Z.p=2;var u=st;st|=4;try{vp(n,e);var d=Qu,S=wf(e.containerInfo),T=d.focusedElem,L=d.selectionRange;if(S!==T&&T&&T.ownerDocument&&_f(T.ownerDocument.documentElement,T)){if(L!==null&&Ac(T)){var q=L.start,F=L.end;if(F===void 0&&(F=q),"selectionStart"in T)T.selectionStart=q,T.selectionEnd=Math.min(F,T.value.length);else{var J=T.ownerDocument||document,z=J&&J.defaultView||window;if(z.getSelection){var Y=z.getSelection(),ye=T.textContent.length,Oe=Math.min(L.start,ye),bt=L.end===void 0?Oe:Math.min(L.end,ye);!Y.extend&&Oe>bt&&(S=bt,bt=Oe,Oe=S);var j=Ef(T,Oe),B=Ef(T,bt);if(j&&B&&(Y.rangeCount!==1||Y.anchorNode!==j.node||Y.anchorOffset!==j.offset||Y.focusNode!==B.node||Y.focusOffset!==B.offset)){var U=J.createRange();U.setStart(j.node,j.offset),Y.removeAllRanges(),Oe>bt?(Y.addRange(U),Y.extend(B.node,B.offset)):(U.setEnd(B.node,B.offset),Y.addRange(U))}}}}for(J=[],Y=T;Y=Y.parentNode;)Y.nodeType===1&&J.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<J.length;T++){var W=J[T];W.element.scrollLeft=W.left,W.element.scrollTop=W.top}}Nr=!!Xu,Qu=Xu=null}finally{st=u,Z.p=l,$.T=s}}e.current=n,sn=2}}function qp(){if(sn===2){sn=0;var e=Is,n=to,s=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||s){s=$.T,$.T=null;var l=Z.p;Z.p=2;var u=st;st|=4;try{hp(e,n.alternate,n)}finally{st=u,Z.p=l,$.T=s}}sn=3}}function zp(){if(sn===4||sn===3){sn=0,Dn();var e=Is,n=to,s=fs,l=Op;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?sn=5:(sn=0,to=Is=null,$p(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(Ls=null),bs(s),n=n.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(Kt,n,void 0,(n.current.flags&128)===128)}catch{}if(l!==null){n=$.T,u=Z.p,Z.p=2,$.T=null;try{for(var d=e.onRecoverableError,S=0;S<l.length;S++){var T=l[S];d(T.value,{componentStack:T.stack})}}finally{$.T=n,Z.p=u}}(fs&3)!==0&&br(),Yi(e),u=e.pendingLanes,(s&261930)!==0&&(u&42)!==0?e===Du?Go++:(Go=0,Du=e):Go=0,Wo(0)}}function $p(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,Co(n)))}function br(){return Up(),qp(),zp(),Vp()}function Vp(){if(sn!==5)return!1;var e=Is,n=Bu;Bu=0;var s=bs(fs),l=$.T,u=Z.p;try{Z.p=32>s?32:s,$.T=null,s=ju,ju=null;var d=Is,S=fs;if(sn=0,to=Is=null,fs=0,(st&6)!==0)throw Error(o(331));var T=st;if(st|=4,_p(d.current),Ap(d,d.current,S,s),st=T,Wo(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(Kt,d)}catch{}return!0}finally{Z.p=u,$.T=l,$p(e,n)}}function Yp(e,n,s){n=pi(s,n),n=hu(e.stateNode,n,2),e=Ms(e,n,2),e!==null&&(Gt(e,2),Yi(e))}function ft(e,n,s){if(e.tag===3)Yp(e,e,s);else for(;n!==null;){if(n.tag===3){Yp(n,e,s);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Ls===null||!Ls.has(l))){e=pi(s,e),s=Km(2),l=Ms(n,s,2),l!==null&&(Fm(s,l,n,e),Gt(l,2),Yi(l));break}}n=n.return}}function Uu(e,n,s){var l=e.pingCache;if(l===null){l=e.pingCache=new P0;var u=new Set;l.set(n,u)}else u=l.get(n),u===void 0&&(u=new Set,l.set(n,u));u.has(s)||(ku=!0,u.add(s),e=V0.bind(null,e,n,s),n.then(e,e))}function V0(e,n,s){var l=e.pingCache;l!==null&&l.delete(n),e.pingedLanes|=e.suspendedLanes&s,e.warmLanes&=~s,At===e&&(Ge&s)===s&&(zt===4||zt===3&&(Ge&62914560)===Ge&&300>Fe()-fr?(st&2)===0&&no(e,0):Lu|=s,eo===Ge&&(eo=0)),Yi(e)}function Kp(e,n){n===0&&(n=Zn()),e=oa(e,n),e!==null&&(Gt(e,n),Yi(e))}function Y0(e){var n=e.memoizedState,s=0;n!==null&&(s=n.retryLane),Kp(e,s)}function K0(e,n){var s=0;switch(e.tag){case 31:case 13:var l=e.stateNode,u=e.memoizedState;u!==null&&(s=u.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(o(314))}l!==null&&l.delete(n),Kp(e,s)}function F0(e,n){return bn(e,n)}var Sr=null,so=null,qu=!1,vr=!1,zu=!1,js=0;function Yi(e){e!==so&&e.next===null&&(so===null?Sr=so=e:so=so.next=e),vr=!0,qu||(qu=!0,W0())}function Wo(e,n){if(!zu&&vr){zu=!0;do for(var s=!1,l=Sr;l!==null;){if(e!==0){var u=l.pendingLanes;if(u===0)var d=0;else{var S=l.suspendedLanes,T=l.pingedLanes;d=(1<<31-Et(42|e)+1)-1,d&=u&~(S&~T),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,Xp(l,d))}else d=Ge,d=Ft(l,l===At?d:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(d&3)===0||Rn(l,d)||(s=!0,Xp(l,d));l=l.next}while(s);zu=!1}}function G0(){Fp()}function Fp(){vr=qu=!1;var e=0;js!==0&&ab()&&(e=js);for(var n=Fe(),s=null,l=Sr;l!==null;){var u=l.next,d=Gp(l,n);d===0?(l.next=null,s===null?Sr=u:s.next=u,u===null&&(so=s)):(s=l,(e!==0||(d&3)!==0)&&(vr=!0)),l=u}sn!==0&&sn!==5||Wo(e),js!==0&&(js=0)}function Gp(e,n){for(var s=e.suspendedLanes,l=e.pingedLanes,u=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var S=31-Et(d),T=1<<S,L=u[S];L===-1?((T&s)===0||(T&l)!==0)&&(u[S]=Hi(T,n)):L<=n&&(e.expiredLanes|=T),d&=~T}if(n=At,s=Ge,s=Ft(e,e===n?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,s===0||e===n&&(dt===2||dt===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&Ei(l),e.callbackNode=null,e.callbackPriority=0;if((s&3)===0||Rn(e,s)){if(n=s&-s,n===e.callbackPriority)return n;switch(l!==null&&Ei(l),bs(s)){case 2:case 8:s=Sn;break;case 32:s=cn;break;case 268435456:s=Yt;break;default:s=cn}return l=Wp.bind(null,e),s=bn(s,l),e.callbackPriority=n,e.callbackNode=s,n}return l!==null&&l!==null&&Ei(l),e.callbackPriority=2,e.callbackNode=null,2}function Wp(e,n){if(sn!==0&&sn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var s=e.callbackNode;if(br()&&e.callbackNode!==s)return null;var l=Ge;return l=Ft(e,e===At?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(Np(e,l,n),Gp(e,Fe()),e.callbackNode!=null&&e.callbackNode===s?Wp.bind(null,e):null)}function Xp(e,n){if(br())return null;Np(e,n,!0)}function W0(){lb(function(){(st&6)!==0?bn(Dt,G0):Fp()})}function $u(){if(js===0){var e=$a;e===0&&(e=On,On<<=1,(On&261888)===0&&(On=256)),js=e}return js}function Qp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Na(""+e)}function Jp(e,n){var s=n.ownerDocument.createElement("input");return s.name=n.name,s.value=n.value,e.id&&s.setAttribute("form",e.id),n.parentNode.insertBefore(s,n),e=new FormData(e),s.parentNode.removeChild(s),e}function X0(e,n,s,l,u){if(n==="submit"&&s&&s.stateNode===u){var d=Qp((u[be]||null).action),S=l.submitter;S&&(n=(n=S[be]||null)?Qp(n.formAction):S.getAttribute("formAction"),n!==null&&(d=n,S=null));var T=new kl("action","action",null,l,u);e.push({event:T,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(js!==0){var L=S?Jp(u,S):new FormData(u);cu(s,{pending:!0,data:L,method:u.method,action:d},null,L)}}else typeof d=="function"&&(T.preventDefault(),L=S?Jp(u,S):new FormData(u),cu(s,{pending:!0,data:L,method:u.method,action:d},d,L))},currentTarget:u}]})}}for(var Vu=0;Vu<wc.length;Vu++){var Yu=wc[Vu],Q0=Yu.toLowerCase(),J0=Yu[0].toUpperCase()+Yu.slice(1);Ni(Q0,"on"+J0)}Ni(Cf,"onAnimationEnd"),Ni(Nf,"onAnimationIteration"),Ni(Rf,"onAnimationStart"),Ni("dblclick","onDoubleClick"),Ni("focusin","onFocus"),Ni("focusout","onBlur"),Ni(p0,"onTransitionRun"),Ni(h0,"onTransitionStart"),Ni(g0,"onTransitionCancel"),Ni(kf,"onTransitionEnd"),Ui("onMouseEnter",["mouseout","mouseover"]),Ui("onMouseLeave",["mouseout","mouseover"]),Ui("onPointerEnter",["pointerout","pointerover"]),Ui("onPointerLeave",["pointerout","pointerover"]),Wi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Z0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Xo));function Zp(e,n){n=(n&4)!==0;for(var s=0;s<e.length;s++){var l=e[s],u=l.event;l=l.listeners;e:{var d=void 0;if(n)for(var S=l.length-1;0<=S;S--){var T=l[S],L=T.instance,q=T.currentTarget;if(T=T.listener,L!==d&&u.isPropagationStopped())break e;d=T,u.currentTarget=q;try{d(u)}catch(F){Bl(F)}u.currentTarget=null,d=L}else for(S=0;S<l.length;S++){if(T=l[S],L=T.instance,q=T.currentTarget,T=T.listener,L!==d&&u.isPropagationStopped())break e;d=T,u.currentTarget=q;try{d(u)}catch(F){Bl(F)}u.currentTarget=null,d=L}}}}function Ke(e,n){var s=n[ut];s===void 0&&(s=n[ut]=new Set);var l=e+"__bubble";s.has(l)||(eh(n,e,2,!1),s.add(l))}function Ku(e,n,s){var l=0;n&&(l|=4),eh(s,e,l,n)}var xr="_reactListening"+Math.random().toString(36).slice(2);function Fu(e){if(!e[xr]){e[xr]=!0,go.forEach(function(s){s!=="selectionchange"&&(Z0.has(s)||Ku(s,!1,e),Ku(s,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[xr]||(n[xr]=!0,Ku("selectionchange",!1,n))}}function eh(e,n,s,l){switch(Ch(n)){case 2:var u=Mb;break;case 8:u=Ob;break;default:u=rd}s=u.bind(null,n,s,e),u=void 0,!bo||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),l?u!==void 0?e.addEventListener(n,s,{capture:!0,passive:u}):e.addEventListener(n,s,!0):u!==void 0?e.addEventListener(n,s,{passive:u}):e.addEventListener(n,s,!1)}function Gu(e,n,s,l,u){var d=l;if((n&1)===0&&(n&2)===0&&l!==null)e:for(;;){if(l===null)return;var S=l.tag;if(S===3||S===4){var T=l.stateNode.containerInfo;if(T===u)break;if(S===4)for(S=l.return;S!==null;){var L=S.tag;if((L===3||L===4)&&S.stateNode.containerInfo===u)return;S=S.return}for(;T!==null;){if(S=Un(T),S===null)return;if(L=S.tag,L===5||L===6||L===26||L===27){l=d=S;continue e}T=T.parentNode}}l=l.return}La(function(){var q=d,F=ka(s),J=[];e:{var z=Lf.get(e);if(z!==void 0){var Y=kl,ye=e;switch(e){case"keypress":if(na(s)===0)break e;case"keydown":case"keyup":Y=Ky;break;case"focusin":ye="focus",Y=yc;break;case"focusout":ye="blur",Y=yc;break;case"beforeblur":case"afterblur":Y=yc;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=rf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=Iy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=Wy;break;case Cf:case Nf:case Rf:Y=Dy;break;case kf:Y=Qy;break;case"scroll":case"scrollend":Y=ky;break;case"wheel":Y=Zy;break;case"copy":case"cut":case"paste":Y=Py;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=uf;break;case"toggle":case"beforetoggle":Y=t0}var Oe=(n&4)!==0,bt=!Oe&&(e==="scroll"||e==="scrollend"),j=Oe?z!==null?z+"Capture":null:z;Oe=[];for(var B=q,U;B!==null;){var W=B;if(U=W.stateNode,W=W.tag,W!==5&&W!==26&&W!==27||U===null||j===null||(W=Ji(B,j),W!=null&&Oe.push(Qo(B,W,U))),bt)break;B=B.return}0<Oe.length&&(z=new Y(z,ye,null,s,F),J.push({event:z,listeners:Oe}))}}if((n&7)===0){e:{if(z=e==="mouseover"||e==="pointerover",Y=e==="mouseout"||e==="pointerout",z&&s!==Ra&&(ye=s.relatedTarget||s.fromElement)&&(Un(ye)||ye[De]))break e;if((Y||z)&&(z=F.window===F?F:(z=F.ownerDocument)?z.defaultView||z.parentWindow:window,Y?(ye=s.relatedTarget||s.toElement,Y=q,ye=ye?Un(ye):null,ye!==null&&(bt=r(ye),Oe=ye.tag,ye!==bt||Oe!==5&&Oe!==27&&Oe!==6)&&(ye=null)):(Y=null,ye=q),Y!==ye)){if(Oe=rf,W="onMouseLeave",j="onMouseEnter",B="mouse",(e==="pointerout"||e==="pointerover")&&(Oe=uf,W="onPointerLeave",j="onPointerEnter",B="pointer"),bt=Y==null?z:wi(Y),U=ye==null?z:wi(ye),z=new Oe(W,B+"leave",Y,s,F),z.target=bt,z.relatedTarget=U,W=null,Un(F)===q&&(Oe=new Oe(j,B+"enter",ye,s,F),Oe.target=U,Oe.relatedTarget=bt,W=Oe),bt=W,Y&&ye)t:{for(Oe=eb,j=Y,B=ye,U=0,W=j;W;W=Oe(W))U++;W=0;for(var Ee=B;Ee;Ee=Oe(Ee))W++;for(;0<U-W;)j=Oe(j),U--;for(;0<W-U;)B=Oe(B),W--;for(;U--;){if(j===B||B!==null&&j===B.alternate){Oe=j;break t}j=Oe(j),B=Oe(B)}Oe=null}else Oe=null;Y!==null&&th(J,z,Y,Oe,!1),ye!==null&&bt!==null&&th(J,bt,ye,Oe,!0)}}e:{if(z=q?wi(q):window,Y=z.nodeName&&z.nodeName.toLowerCase(),Y==="select"||Y==="input"&&z.type==="file")var tt=bf;else if(gf(z))if(Sf)tt=d0;else{tt=c0;var ve=r0}else Y=z.nodeName,!Y||Y.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?q&&Ut(q.elementType)&&(tt=bf):tt=u0;if(tt&&(tt=tt(e,q))){yf(J,tt,s,F);break e}ve&&ve(e,z,q),e==="focusout"&&q&&z.type==="number"&&q.memoizedProps.value!=null&&he(z,"number",z.value)}switch(ve=q?wi(q):window,e){case"focusin":(gf(ve)||ve.contentEditable==="true")&&(Ba=ve,Tc=q,wo=null);break;case"focusout":wo=Tc=Ba=null;break;case"mousedown":Ec=!0;break;case"contextmenu":case"mouseup":case"dragend":Ec=!1,Mf(J,s,F);break;case"selectionchange":if(m0)break;case"keydown":case"keyup":Mf(J,s,F)}var He;if(Sc)e:{switch(e){case"compositionstart":var We="onCompositionStart";break e;case"compositionend":We="onCompositionEnd";break e;case"compositionupdate":We="onCompositionUpdate";break e}We=void 0}else Ia?pf(e,s)&&(We="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(We="onCompositionStart");We&&(df&&s.locale!=="ko"&&(Ia||We!=="onCompositionStart"?We==="onCompositionEnd"&&Ia&&(He=So()):(ei=F,ea="value"in ei?ei.value:ei.textContent,Ia=!0)),ve=Ar(q,We),0<ve.length&&(We=new cf(We,e,null,s,F),J.push({event:We,listeners:ve}),He?We.data=He:(He=hf(s),He!==null&&(We.data=He)))),(He=i0?s0(e,s):a0(e,s))&&(We=Ar(q,"onBeforeInput"),0<We.length&&(ve=new cf("onBeforeInput","beforeinput",null,s,F),J.push({event:ve,listeners:We}),ve.data=He)),X0(J,e,q,s,F)}Zp(J,n)})}function Qo(e,n,s){return{instance:e,listener:n,currentTarget:s}}function Ar(e,n){for(var s=n+"Capture",l=[];e!==null;){var u=e,d=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||d===null||(u=Ji(e,s),u!=null&&l.unshift(Qo(e,u,d)),u=Ji(e,n),u!=null&&l.push(Qo(e,u,d))),e.tag===3)return l;e=e.return}return[]}function eb(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function th(e,n,s,l,u){for(var d=n._reactName,S=[];s!==null&&s!==l;){var T=s,L=T.alternate,q=T.stateNode;if(T=T.tag,L!==null&&L===l)break;T!==5&&T!==26&&T!==27||q===null||(L=q,u?(q=Ji(s,d),q!=null&&S.unshift(Qo(s,q,L))):u||(q=Ji(s,d),q!=null&&S.push(Qo(s,q,L)))),s=s.return}S.length!==0&&e.push({event:n,listeners:S})}var tb=/\r\n?/g,nb=/\u0000|\uFFFD/g;function nh(e){return(typeof e=="string"?e:""+e).replace(tb,`
`).replace(nb,"")}function ih(e,n){return n=nh(n),nh(e)===n}function yt(e,n,s,l,u,d){switch(s){case"children":typeof l=="string"?n==="body"||n==="textarea"&&l===""||pn(e,l):(typeof l=="number"||typeof l=="bigint")&&n!=="body"&&pn(e,""+l);break;case"className":Js(e,"class",l);break;case"tabIndex":Js(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Js(e,s,l);break;case"style":wt(e,l,d);break;case"data":if(n!=="object"){Js(e,"data",l);break}case"src":case"href":if(l===""&&(n!=="a"||s!=="href")){e.removeAttribute(s);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(s);break}l=Na(""+l),e.setAttribute(s,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(n!=="input"&&yt(e,n,"name",u.name,u,null),yt(e,n,"formEncType",u.formEncType,u,null),yt(e,n,"formMethod",u.formMethod,u,null),yt(e,n,"formTarget",u.formTarget,u,null)):(yt(e,n,"encType",u.encType,u,null),yt(e,n,"method",u.method,u,null),yt(e,n,"target",u.target,u,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(s);break}l=Na(""+l),e.setAttribute(s,l);break;case"onClick":l!=null&&(e.onclick=Oi);break;case"onScroll":l!=null&&Ke("scroll",e);break;case"onScrollEnd":l!=null&&Ke("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));e.innerHTML=s}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}s=Na(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,""+l):e.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,""):e.removeAttribute(s);break;case"capture":case"download":l===!0?e.setAttribute(s,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,l):e.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(s,l):e.removeAttribute(s);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(s):e.setAttribute(s,l);break;case"popover":Ke("beforetoggle",e),Ke("toggle",e),vs(e,"popover",l);break;case"xlinkActuate":fi(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":fi(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":fi(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":fi(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":fi(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":fi(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":fi(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":fi(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":fi(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":vs(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=hn.get(s)||s,vs(e,s,l))}}function Wu(e,n,s,l,u,d){switch(s){case"style":wt(e,l,d);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));e.innerHTML=s}}break;case"children":typeof l=="string"?pn(e,l):(typeof l=="number"||typeof l=="bigint")&&pn(e,""+l);break;case"onScroll":l!=null&&Ke("scroll",e);break;case"onScrollEnd":l!=null&&Ke("scrollend",e);break;case"onClick":l!=null&&(e.onclick=Oi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ol.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(u=s.endsWith("Capture"),n=s.slice(2,u?s.length-7:void 0),d=e[be]||null,d=d!=null?d[s]:null,typeof d=="function"&&e.removeEventListener(n,d,u),typeof l=="function")){typeof d!="function"&&d!==null&&(s in e?e[s]=null:e.hasAttribute(s)&&e.removeAttribute(s)),e.addEventListener(n,l,u);break e}s in e?e[s]=l:l===!0?e.setAttribute(s,""):vs(e,s,l)}}}function _n(e,n,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ke("error",e),Ke("load",e);var l=!1,u=!1,d;for(d in s)if(s.hasOwnProperty(d)){var S=s[d];if(S!=null)switch(d){case"src":l=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:yt(e,n,d,S,s,null)}}u&&yt(e,n,"srcSet",s.srcSet,s,null),l&&yt(e,n,"src",s.src,s,null);return;case"input":Ke("invalid",e);var T=d=S=u=null,L=null,q=null;for(l in s)if(s.hasOwnProperty(l)){var F=s[l];if(F!=null)switch(l){case"name":u=F;break;case"type":S=F;break;case"checked":L=F;break;case"defaultChecked":q=F;break;case"value":d=F;break;case"defaultValue":T=F;break;case"children":case"dangerouslySetInnerHTML":if(F!=null)throw Error(o(137,n));break;default:yt(e,n,l,F,s,null)}}ce(e,d,T,L,q,S,u,!1);return;case"select":Ke("invalid",e),l=S=d=null;for(u in s)if(s.hasOwnProperty(u)&&(T=s[u],T!=null))switch(u){case"value":d=T;break;case"defaultValue":S=T;break;case"multiple":l=T;default:yt(e,n,u,T,s,null)}n=d,s=S,e.multiple=!!l,n!=null?ge(e,!!l,n,!1):s!=null&&ge(e,!!l,s,!0);return;case"textarea":Ke("invalid",e),d=u=l=null;for(S in s)if(s.hasOwnProperty(S)&&(T=s[S],T!=null))switch(S){case"value":l=T;break;case"defaultValue":u=T;break;case"children":d=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(o(91));break;default:yt(e,n,S,T,s,null)}lt(e,l,u,d);return;case"option":for(L in s)s.hasOwnProperty(L)&&(l=s[L],l!=null)&&(L==="selected"?e.selected=l&&typeof l!="function"&&typeof l!="symbol":yt(e,n,L,l,s,null));return;case"dialog":Ke("beforetoggle",e),Ke("toggle",e),Ke("cancel",e),Ke("close",e);break;case"iframe":case"object":Ke("load",e);break;case"video":case"audio":for(l=0;l<Xo.length;l++)Ke(Xo[l],e);break;case"image":Ke("error",e),Ke("load",e);break;case"details":Ke("toggle",e);break;case"embed":case"source":case"link":Ke("error",e),Ke("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in s)if(s.hasOwnProperty(q)&&(l=s[q],l!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:yt(e,n,q,l,s,null)}return;default:if(Ut(n)){for(F in s)s.hasOwnProperty(F)&&(l=s[F],l!==void 0&&Wu(e,n,F,l,s,void 0));return}}for(T in s)s.hasOwnProperty(T)&&(l=s[T],l!=null&&yt(e,n,T,l,s,null))}function ib(e,n,s,l){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,d=null,S=null,T=null,L=null,q=null,F=null;for(Y in s){var J=s[Y];if(s.hasOwnProperty(Y)&&J!=null)switch(Y){case"checked":break;case"value":break;case"defaultValue":L=J;default:l.hasOwnProperty(Y)||yt(e,n,Y,null,l,J)}}for(var z in l){var Y=l[z];if(J=s[z],l.hasOwnProperty(z)&&(Y!=null||J!=null))switch(z){case"type":d=Y;break;case"name":u=Y;break;case"checked":q=Y;break;case"defaultChecked":F=Y;break;case"value":S=Y;break;case"defaultValue":T=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(o(137,n));break;default:Y!==J&&yt(e,n,z,Y,l,J)}}le(e,S,T,L,q,F,d,u);return;case"select":Y=S=T=z=null;for(d in s)if(L=s[d],s.hasOwnProperty(d)&&L!=null)switch(d){case"value":break;case"multiple":Y=L;default:l.hasOwnProperty(d)||yt(e,n,d,null,l,L)}for(u in l)if(d=l[u],L=s[u],l.hasOwnProperty(u)&&(d!=null||L!=null))switch(u){case"value":z=d;break;case"defaultValue":T=d;break;case"multiple":S=d;default:d!==L&&yt(e,n,u,d,l,L)}n=T,s=S,l=Y,z!=null?ge(e,!!s,z,!1):!!l!=!!s&&(n!=null?ge(e,!!s,n,!0):ge(e,!!s,s?[]:"",!1));return;case"textarea":Y=z=null;for(T in s)if(u=s[T],s.hasOwnProperty(T)&&u!=null&&!l.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:yt(e,n,T,null,l,u)}for(S in l)if(u=l[S],d=s[S],l.hasOwnProperty(S)&&(u!=null||d!=null))switch(S){case"value":z=u;break;case"defaultValue":Y=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(o(91));break;default:u!==d&&yt(e,n,S,u,l,d)}ot(e,z,Y);return;case"option":for(var ye in s)z=s[ye],s.hasOwnProperty(ye)&&z!=null&&!l.hasOwnProperty(ye)&&(ye==="selected"?e.selected=!1:yt(e,n,ye,null,l,z));for(L in l)z=l[L],Y=s[L],l.hasOwnProperty(L)&&z!==Y&&(z!=null||Y!=null)&&(L==="selected"?e.selected=z&&typeof z!="function"&&typeof z!="symbol":yt(e,n,L,z,l,Y));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Oe in s)z=s[Oe],s.hasOwnProperty(Oe)&&z!=null&&!l.hasOwnProperty(Oe)&&yt(e,n,Oe,null,l,z);for(q in l)if(z=l[q],Y=s[q],l.hasOwnProperty(q)&&z!==Y&&(z!=null||Y!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(o(137,n));break;default:yt(e,n,q,z,l,Y)}return;default:if(Ut(n)){for(var bt in s)z=s[bt],s.hasOwnProperty(bt)&&z!==void 0&&!l.hasOwnProperty(bt)&&Wu(e,n,bt,void 0,l,z);for(F in l)z=l[F],Y=s[F],!l.hasOwnProperty(F)||z===Y||z===void 0&&Y===void 0||Wu(e,n,F,z,l,Y);return}}for(var j in s)z=s[j],s.hasOwnProperty(j)&&z!=null&&!l.hasOwnProperty(j)&&yt(e,n,j,null,l,z);for(J in l)z=l[J],Y=s[J],!l.hasOwnProperty(J)||z===Y||z==null&&Y==null||yt(e,n,J,z,l,Y)}function sh(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function sb(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,s=performance.getEntriesByType("resource"),l=0;l<s.length;l++){var u=s[l],d=u.transferSize,S=u.initiatorType,T=u.duration;if(d&&T&&sh(S)){for(S=0,T=u.responseEnd,l+=1;l<s.length;l++){var L=s[l],q=L.startTime;if(q>T)break;var F=L.transferSize,J=L.initiatorType;F&&sh(J)&&(L=L.responseEnd,S+=F*(L<T?1:(T-q)/(L-q)))}if(--l,n+=8*(d+S)/(u.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Xu=null,Qu=null;function Tr(e){return e.nodeType===9?e:e.ownerDocument}function ah(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oh(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function Ju(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Zu=null;function ab(){var e=window.event;return e&&e.type==="popstate"?e===Zu?!1:(Zu=e,!0):(Zu=null,!1)}var lh=typeof setTimeout=="function"?setTimeout:void 0,ob=typeof clearTimeout=="function"?clearTimeout:void 0,rh=typeof Promise=="function"?Promise:void 0,lb=typeof queueMicrotask=="function"?queueMicrotask:typeof rh<"u"?function(e){return rh.resolve(null).then(e).catch(rb)}:lh;function rb(e){setTimeout(function(){throw e})}function Ds(e){return e==="head"}function ch(e,n){var s=n,l=0;do{var u=s.nextSibling;if(e.removeChild(s),u&&u.nodeType===8)if(s=u.data,s==="/$"||s==="/&"){if(l===0){e.removeChild(u),ro(n);return}l--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")l++;else if(s==="html")Jo(e.ownerDocument.documentElement);else if(s==="head"){s=e.ownerDocument.head,Jo(s);for(var d=s.firstChild;d;){var S=d.nextSibling,T=d.nodeName;d[Ct]||T==="SCRIPT"||T==="STYLE"||T==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=S}}else s==="body"&&Jo(e.ownerDocument.body);s=u}while(s);ro(n)}function uh(e,n){var s=e;e=0;do{var l=s.nextSibling;if(s.nodeType===1?n?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(n?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),l&&l.nodeType===8)if(s=l.data,s==="/$"){if(e===0)break;e--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||e++;s=l}while(s)}function ed(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var s=n;switch(n=n.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":ed(s),kn(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}e.removeChild(s)}}function cb(e,n,s,l){for(;e.nodeType===1;){var u=s;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[Ct])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var d=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=Si(e.nextSibling),e===null)break}return null}function ub(e,n,s){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=Si(e.nextSibling),e===null))return null;return e}function dh(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=Si(e.nextSibling),e===null))return null;return e}function td(e){return e.data==="$?"||e.data==="$~"}function nd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function db(e,n){var s=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||s.readyState!=="loading")n();else{var l=function(){n(),s.removeEventListener("DOMContentLoaded",l)};s.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function Si(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var id=null;function fh(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"||s==="/&"){if(n===0)return Si(e.nextSibling);n--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||n++}e=e.nextSibling}return null}function mh(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(n===0)return e;n--}else s!=="/$"&&s!=="/&"||n++}e=e.previousSibling}return null}function ph(e,n,s){switch(n=Tr(s),e){case"html":if(e=n.documentElement,!e)throw Error(o(452));return e;case"head":if(e=n.head,!e)throw Error(o(453));return e;case"body":if(e=n.body,!e)throw Error(o(454));return e;default:throw Error(o(451))}}function Jo(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);kn(e)}var vi=new Map,hh=new Set;function Er(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var ms=Z.d;Z.d={f:fb,r:mb,D:pb,C:hb,L:gb,m:yb,X:Sb,S:bb,M:vb};function fb(){var e=ms.f(),n=hr();return e||n}function mb(e){var n=Ln(e);n!==null&&n.tag===5&&n.type==="form"?km(n):ms.r(e)}var ao=typeof document>"u"?null:document;function gh(e,n,s){var l=ao;if(l&&typeof n=="string"&&n){var u=G(n);u='link[rel="'+e+'"][href="'+u+'"]',typeof s=="string"&&(u+='[crossorigin="'+s+'"]'),hh.has(u)||(hh.add(u),e={rel:e,crossOrigin:s,href:n},l.querySelector(u)===null&&(n=l.createElement("link"),_n(n,"link",e),Nt(n),l.head.appendChild(n)))}}function pb(e){ms.D(e),gh("dns-prefetch",e,null)}function hb(e,n){ms.C(e,n),gh("preconnect",e,n)}function gb(e,n,s){ms.L(e,n,s);var l=ao;if(l&&e&&n){var u='link[rel="preload"][as="'+G(n)+'"]';n==="image"&&s&&s.imageSrcSet?(u+='[imagesrcset="'+G(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(u+='[imagesizes="'+G(s.imageSizes)+'"]')):u+='[href="'+G(e)+'"]';var d=u;switch(n){case"style":d=oo(e);break;case"script":d=lo(e)}vi.has(d)||(e=v({rel:"preload",href:n==="image"&&s&&s.imageSrcSet?void 0:e,as:n},s),vi.set(d,e),l.querySelector(u)!==null||n==="style"&&l.querySelector(Zo(d))||n==="script"&&l.querySelector(el(d))||(n=l.createElement("link"),_n(n,"link",e),Nt(n),l.head.appendChild(n)))}}function yb(e,n){ms.m(e,n);var s=ao;if(s&&e){var l=n&&typeof n.as=="string"?n.as:"script",u='link[rel="modulepreload"][as="'+G(l)+'"][href="'+G(e)+'"]',d=u;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=lo(e)}if(!vi.has(d)&&(e=v({rel:"modulepreload",href:e},n),vi.set(d,e),s.querySelector(u)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(el(d)))return}l=s.createElement("link"),_n(l,"link",e),Nt(l),s.head.appendChild(l)}}}function bb(e,n,s){ms.S(e,n,s);var l=ao;if(l&&e){var u=Mi(l).hoistableStyles,d=oo(e);n=n||"default";var S=u.get(d);if(!S){var T={loading:0,preload:null};if(S=l.querySelector(Zo(d)))T.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":n},s),(s=vi.get(d))&&sd(e,s);var L=S=l.createElement("link");Nt(L),_n(L,"link",e),L._p=new Promise(function(q,F){L.onload=q,L.onerror=F}),L.addEventListener("load",function(){T.loading|=1}),L.addEventListener("error",function(){T.loading|=2}),T.loading|=4,_r(S,n,l)}S={type:"stylesheet",instance:S,count:1,state:T},u.set(d,S)}}}function Sb(e,n){ms.X(e,n);var s=ao;if(s&&e){var l=Mi(s).hoistableScripts,u=lo(e),d=l.get(u);d||(d=s.querySelector(el(u)),d||(e=v({src:e,async:!0},n),(n=vi.get(u))&&ad(e,n),d=s.createElement("script"),Nt(d),_n(d,"link",e),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(u,d))}}function vb(e,n){ms.M(e,n);var s=ao;if(s&&e){var l=Mi(s).hoistableScripts,u=lo(e),d=l.get(u);d||(d=s.querySelector(el(u)),d||(e=v({src:e,async:!0,type:"module"},n),(n=vi.get(u))&&ad(e,n),d=s.createElement("script"),Nt(d),_n(d,"link",e),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(u,d))}}function yh(e,n,s,l){var u=(u=Ne.current)?Er(u):null;if(!u)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(n=oo(s.href),s=Mi(u).hoistableStyles,l=s.get(n),l||(l={type:"style",instance:null,count:0,state:null},s.set(n,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){e=oo(s.href);var d=Mi(u).hoistableStyles,S=d.get(e);if(S||(u=u.ownerDocument||u,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,S),(d=u.querySelector(Zo(e)))&&!d._p&&(S.instance=d,S.state.loading=5),vi.has(e)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},vi.set(e,s),d||xb(u,e,s,S.state))),n&&l===null)throw Error(o(528,""));return S}if(n&&l!==null)throw Error(o(529,""));return null;case"script":return n=s.async,s=s.src,typeof s=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=lo(s),s=Mi(u).hoistableScripts,l=s.get(n),l||(l={type:"script",instance:null,count:0,state:null},s.set(n,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function oo(e){return'href="'+G(e)+'"'}function Zo(e){return'link[rel="stylesheet"]['+e+"]"}function bh(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function xb(e,n,s,l){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?l.loading=1:(n=e.createElement("link"),l.preload=n,n.addEventListener("load",function(){return l.loading|=1}),n.addEventListener("error",function(){return l.loading|=2}),_n(n,"link",s),Nt(n),e.head.appendChild(n))}function lo(e){return'[src="'+G(e)+'"]'}function el(e){return"script[async]"+e}function Sh(e,n,s){if(n.count++,n.instance===null)switch(n.type){case"style":var l=e.querySelector('style[data-href~="'+G(s.href)+'"]');if(l)return n.instance=l,Nt(l),l;var u=v({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),Nt(l),_n(l,"style",u),_r(l,s.precedence,e),n.instance=l;case"stylesheet":u=oo(s.href);var d=e.querySelector(Zo(u));if(d)return n.state.loading|=4,n.instance=d,Nt(d),d;l=bh(s),(u=vi.get(u))&&sd(l,u),d=(e.ownerDocument||e).createElement("link"),Nt(d);var S=d;return S._p=new Promise(function(T,L){S.onload=T,S.onerror=L}),_n(d,"link",l),n.state.loading|=4,_r(d,s.precedence,e),n.instance=d;case"script":return d=lo(s.src),(u=e.querySelector(el(d)))?(n.instance=u,Nt(u),u):(l=s,(u=vi.get(d))&&(l=v({},s),ad(l,u)),e=e.ownerDocument||e,u=e.createElement("script"),Nt(u),_n(u,"link",l),e.head.appendChild(u),n.instance=u);case"void":return null;default:throw Error(o(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(l=n.instance,n.state.loading|=4,_r(l,s.precedence,e));return n.instance}function _r(e,n,s){for(var l=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=l.length?l[l.length-1]:null,d=u,S=0;S<l.length;S++){var T=l[S];if(T.dataset.precedence===n)d=T;else if(d!==u)break}d?d.parentNode.insertBefore(e,d.nextSibling):(n=s.nodeType===9?s.head:s,n.insertBefore(e,n.firstChild))}function sd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function ad(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var wr=null;function vh(e,n,s){if(wr===null){var l=new Map,u=wr=new Map;u.set(s,l)}else u=wr,l=u.get(s),l||(l=new Map,u.set(s,l));if(l.has(e))return l;for(l.set(e,null),s=s.getElementsByTagName(e),u=0;u<s.length;u++){var d=s[u];if(!(d[Ct]||d[we]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var S=d.getAttribute(n)||"";S=e+S;var T=l.get(S);T?T.push(d):l.set(S,[d])}}return l}function xh(e,n,s){e=e.ownerDocument||e,e.head.insertBefore(s,n==="title"?e.querySelector("head > title"):null)}function Ab(e,n,s){if(s===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;return n.rel==="stylesheet"?(e=n.disabled,typeof n.precedence=="string"&&e==null):!0;case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Ah(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function Tb(e,n,s,l){if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var u=oo(l.href),d=n.querySelector(Zo(u));if(d){n=d._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=Mr.bind(e),n.then(e,e)),s.state.loading|=4,s.instance=d,Nt(d);return}d=n.ownerDocument||n,l=bh(l),(u=vi.get(u))&&sd(l,u),d=d.createElement("link"),Nt(d);var S=d;S._p=new Promise(function(T,L){S.onload=T,S.onerror=L}),_n(d,"link",l),s.instance=d}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(e.count++,s=Mr.bind(e),n.addEventListener("load",s),n.addEventListener("error",s))}}var od=0;function Eb(e,n){return e.stylesheets&&e.count===0&&Cr(e,e.stylesheets),0<e.count||0<e.imgCount?function(s){var l=setTimeout(function(){if(e.stylesheets&&Cr(e,e.stylesheets),e.unsuspend){var d=e.unsuspend;e.unsuspend=null,d()}},6e4+n);0<e.imgBytes&&od===0&&(od=62500*sb());var u=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Cr(e,e.stylesheets),e.unsuspend)){var d=e.unsuspend;e.unsuspend=null,d()}},(e.imgBytes>od?50:800)+n);return e.unsuspend=s,function(){e.unsuspend=null,clearTimeout(l),clearTimeout(u)}}:null}function Mr(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Cr(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Or=null;function Cr(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Or=new Map,n.forEach(_b,e),Or=null,Mr.call(e))}function _b(e,n){if(!(n.state.loading&4)){var s=Or.get(e);if(s)var l=s.get(null);else{s=new Map,Or.set(e,s);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<u.length;d++){var S=u[d];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(s.set(S.dataset.precedence,S),l=S)}l&&s.set(null,l)}u=n.instance,S=u.getAttribute("data-precedence"),d=s.get(S)||l,d===l&&s.set(null,u),s.set(S,u),this.count++,l=Mr.bind(this),u.addEventListener("load",l),u.addEventListener("error",l),d?d.parentNode.insertBefore(u,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),n.state.loading|=4}}var tl={$$typeof:E,Provider:null,Consumer:null,_currentValue:ae,_currentValue2:ae,_threadCount:0};function wb(e,n,s,l,u,d,S,T,L){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fn(0),this.hiddenUpdates=fn(null),this.identifierPrefix=l,this.onUncaughtError=u,this.onCaughtError=d,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function Th(e,n,s,l,u,d,S,T,L,q,F,J){return e=new wb(e,n,s,S,L,q,F,J,T),n=1,d===!0&&(n|=24),d=ni(3,null,null,n),e.current=d,d.stateNode=e,n=Pc(),n.refCount++,e.pooledCache=n,n.refCount++,d.memoizedState={element:l,isDehydrated:s,cache:n},$c(d),e}function Eh(e){return e?(e=Ha,e):Ha}function _h(e,n,s,l,u,d){u=Eh(u),l.context===null?l.context=u:l.pendingContext=u,l=ws(n),l.payload={element:s},d=d===void 0?null:d,d!==null&&(l.callback=d),s=Ms(e,l,n),s!==null&&(Gn(s,e,n),Lo(s,e,n))}function wh(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<n?s:n}}function ld(e,n){wh(e,n),(e=e.alternate)&&wh(e,n)}function Mh(e){if(e.tag===13||e.tag===31){var n=oa(e,67108864);n!==null&&Gn(n,e,67108864),ld(e,67108864)}}function Oh(e){if(e.tag===13||e.tag===31){var n=li();n=_i(n);var s=oa(e,n);s!==null&&Gn(s,e,n),ld(e,n)}}var Nr=!0;function Mb(e,n,s,l){var u=$.T;$.T=null;var d=Z.p;try{Z.p=2,rd(e,n,s,l)}finally{Z.p=d,$.T=u}}function Ob(e,n,s,l){var u=$.T;$.T=null;var d=Z.p;try{Z.p=8,rd(e,n,s,l)}finally{Z.p=d,$.T=u}}function rd(e,n,s,l){if(Nr){var u=cd(l);if(u===null)Gu(e,n,l,Rr,s),Nh(e,l);else if(Nb(u,e,n,s,l))l.stopPropagation();else if(Nh(e,l),n&4&&-1<Cb.indexOf(e)){for(;u!==null;){var d=Ln(u);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var S=Ht(d.pendingLanes);if(S!==0){var T=d;for(T.pendingLanes|=2,T.entangledLanes|=2;S;){var L=1<<31-Et(S);T.entanglements[1]|=L,S&=~L}Yi(d),(st&6)===0&&(mr=Fe()+500,Wo(0))}}break;case 31:case 13:T=oa(d,2),T!==null&&Gn(T,d,2),hr(),ld(d,2)}if(d=cd(l),d===null&&Gu(e,n,l,Rr,s),d===u)break;u=d}u!==null&&l.stopPropagation()}else Gu(e,n,l,null,s)}}function cd(e){return e=ka(e),ud(e)}var Rr=null;function ud(e){if(Rr=null,e=Un(e),e!==null){var n=r(e);if(n===null)e=null;else{var s=n.tag;if(s===13){if(e=f(n),e!==null)return e;e=null}else if(s===31){if(e=h(n),e!==null)return e;e=null}else if(s===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return Rr=e,null}function Ch(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pt()){case Dt:return 2;case Sn:return 8;case cn:case vn:return 32;case Yt:return 268435456;default:return 32}default:return 32}}var dd=!1,Hs=null,Ps=null,Us=null,nl=new Map,il=new Map,qs=[],Cb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Nh(e,n){switch(e){case"focusin":case"focusout":Hs=null;break;case"dragenter":case"dragleave":Ps=null;break;case"mouseover":case"mouseout":Us=null;break;case"pointerover":case"pointerout":nl.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":il.delete(n.pointerId)}}function sl(e,n,s,l,u,d){return e===null||e.nativeEvent!==d?(e={blockedOn:n,domEventName:s,eventSystemFlags:l,nativeEvent:d,targetContainers:[u]},n!==null&&(n=Ln(n),n!==null&&Mh(n)),e):(e.eventSystemFlags|=l,n=e.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),e)}function Nb(e,n,s,l,u){switch(n){case"focusin":return Hs=sl(Hs,e,n,s,l,u),!0;case"dragenter":return Ps=sl(Ps,e,n,s,l,u),!0;case"mouseover":return Us=sl(Us,e,n,s,l,u),!0;case"pointerover":var d=u.pointerId;return nl.set(d,sl(nl.get(d)||null,e,n,s,l,u)),!0;case"gotpointercapture":return d=u.pointerId,il.set(d,sl(il.get(d)||null,e,n,s,l,u)),!0}return!1}function Rh(e){var n=Un(e.target);if(n!==null){var s=r(n);if(s!==null){if(n=s.tag,n===13){if(n=f(s),n!==null){e.blockedOn=n,re(e.priority,function(){Oh(s)});return}}else if(n===31){if(n=h(s),n!==null){e.blockedOn=n,re(e.priority,function(){Oh(s)});return}}else if(n===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function kr(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var s=cd(e.nativeEvent);if(s===null){s=e.nativeEvent;var l=new s.constructor(s.type,s);Ra=l,s.target.dispatchEvent(l),Ra=null}else return n=Ln(s),n!==null&&Mh(n),e.blockedOn=s,!1;n.shift()}return!0}function kh(e,n,s){kr(e)&&s.delete(n)}function Rb(){dd=!1,Hs!==null&&kr(Hs)&&(Hs=null),Ps!==null&&kr(Ps)&&(Ps=null),Us!==null&&kr(Us)&&(Us=null),nl.forEach(kh),il.forEach(kh)}function Lr(e,n){e.blockedOn===n&&(e.blockedOn=null,dd||(dd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Rb)))}var Ir=null;function Lh(e){Ir!==e&&(Ir=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ir===e&&(Ir=null);for(var n=0;n<e.length;n+=3){var s=e[n],l=e[n+1],u=e[n+2];if(typeof l!="function"){if(ud(l||s)===null)continue;break}var d=Ln(s);d!==null&&(e.splice(n,3),n-=3,cu(d,{pending:!0,data:u,method:s.method,action:l},l,u))}}))}function ro(e){function n(L){return Lr(L,e)}Hs!==null&&Lr(Hs,e),Ps!==null&&Lr(Ps,e),Us!==null&&Lr(Us,e),nl.forEach(n),il.forEach(n);for(var s=0;s<qs.length;s++){var l=qs[s];l.blockedOn===e&&(l.blockedOn=null)}for(;0<qs.length&&(s=qs[0],s.blockedOn===null);)Rh(s),s.blockedOn===null&&qs.shift();if(s=(e.ownerDocument||e).$$reactFormReplay,s!=null)for(l=0;l<s.length;l+=3){var u=s[l],d=s[l+1],S=u[be]||null;if(typeof d=="function")S||Lh(s);else if(S){var T=null;if(d&&d.hasAttribute("formAction")){if(u=d,S=d[be]||null)T=S.formAction;else if(ud(u)!==null)continue}else T=S.action;typeof T=="function"?s[l+1]=T:(s.splice(l,3),l-=3),Lh(s)}}}function Ih(){function e(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(S){return u=S})},focusReset:"manual",scroll:"manual"})}function n(){u!==null&&(u(),u=null),l||setTimeout(s,20)}function s(){if(!l&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,u=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(s,100),function(){l=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),u!==null&&(u(),u=null)}}}function fd(e){this._internalRoot=e}Br.prototype.render=fd.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(o(409));var s=n.current,l=li();_h(s,l,e,n,null,null)},Br.prototype.unmount=fd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;_h(e.current,2,null,e,null,null),hr(),n[De]=null}};function Br(e){this._internalRoot=e}Br.prototype.unstable_scheduleHydration=function(e){if(e){var n=X();e={blockedOn:null,target:e,priority:n};for(var s=0;s<qs.length&&n!==0&&n<qs[s].priority;s++);qs.splice(s,0,e),s===0&&Rh(e)}};var Bh=i.version;if(Bh!=="19.2.3")throw Error(o(527,Bh,"19.2.3"));Z.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(o(188)):(e=Object.keys(e).join(","),Error(o(268,e)));return e=y(n),e=e!==null?A(e):null,e=e===null?null:e.stateNode,e};var kb={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:$,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var jr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!jr.isDisabled&&jr.supportsFiber)try{Kt=jr.inject(kb),Je=jr}catch{}}return ol.createRoot=function(e,n){if(!c(e))throw Error(o(299));var s=!1,l="",u=zm,d=$m,S=Vm;return n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onUncaughtError!==void 0&&(u=n.onUncaughtError),n.onCaughtError!==void 0&&(d=n.onCaughtError),n.onRecoverableError!==void 0&&(S=n.onRecoverableError)),n=Th(e,1,!1,null,null,s,l,null,u,d,S,Ih),e[De]=n.current,Fu(e),new fd(n)},ol.hydrateRoot=function(e,n,s){if(!c(e))throw Error(o(299));var l=!1,u="",d=zm,S=$m,T=Vm,L=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(S=s.onCaughtError),s.onRecoverableError!==void 0&&(T=s.onRecoverableError),s.formState!==void 0&&(L=s.formState)),n=Th(e,1,!0,n,s??null,l,u,L,d,S,T,Ih),n.context=Eh(null),s=n.current,l=li(),l=_i(l),u=ws(l),u.callback=null,Ms(s,u,l),s=l,n.current.lanes=s,Gt(n,s),Yi(n),e[De]=n.current,Fu(e),new Br(n)},ol.version="19.2.3",ol}var Yh;function $b(){if(Yh)return hd.exports;Yh=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(i){console.error(i)}}return t(),hd.exports=zb(),hd.exports}var Vb=$b();const Bn=(t,i)=>({q:t,r:i,s:-t-i}),Yb=t=>`${t.q},${t.r}`,de=Yb,Q=(t,i)=>t.q===i.q&&t.r===i.r&&t.s===i.s,jn=(t,i)=>Bn(t.q+i.q,t.r+i.r),Dd=(t,i)=>Bn(t.q-i.q,t.r-i.r),_e=(t,i)=>(Math.abs(t.q-i.q)+Math.abs(t.r-i.r)+Math.abs(t.s-i.s))/2,St=(t,i)=>{const a=i*(1.5*t.q),o=i*Math.sqrt(3)*(t.r+t.q/2);return{x:a,y:o}},Kh=t=>({q:t.q,r:t.r,s:t.s??-t.q-t.r}),Kb=t=>Bn(t.q,t.r),Fb=t=>{let i=Math.round(t.q),a=Math.round(t.r),o=Math.round(t.s);const c=Math.abs(i-t.q),r=Math.abs(a-t.r),f=Math.abs(o-t.s);return c>r&&c>f?i=-a-o:r>f?a=-i-o:o=-i-a,{q:i,r:a,s:o}},El=[Bn(1,0),Bn(1,-1),Bn(0,-1),Bn(-1,0),Bn(-1,1),Bn(0,1)],at=t=>El.map(i=>jn(t,i)),Nn=t=>El[(t%6+6)%6],Sd=(t,i,a)=>t+(i-t)*a,Lt=(t,i)=>{const a=_e(t,i),o=[],c=Kh(t),r=Kh(i);for(let f=0;f<=a;f++){const h=a===0?0:f/a,b={q:Sd(c.q+1e-6,r.q+1e-6,h),r:Sd(c.r+1e-6,r.r+1e-6,h),s:Sd(c.s+1e-6,r.s+1e-6,h)};o.push(Kb(Fb(b)))}return o},Fs=(t,i)=>{const a=_e(t,i);if(a===0)return-1;const o=Dd(i,t),c=o.q/a,r=o.r/a,f=(0-o.q-o.r)/a;return El.findIndex(h=>Math.abs(h.q-c)<.01&&Math.abs(h.r-r)<.01&&Math.abs(h.s-f)<.01)};function Jd(t,i){const a=Nn(t);return{q:a.q*i,r:a.r*i,s:-(a.q*i)-a.r*i}}const ac=(t,i,a,o)=>{if(t<0||t>=a||i<0||i>=o)return!1;const c=t+i,r=Math.floor(a/2),f=a-1+(o-1)-r;return c>=r&&c<=f},Gb=(t,i)=>{const a=[];for(let o=0;o<t;o++)for(let c=0;c<i;c++)ac(o,c,t,i)&&a.push(Bn(o,c));return a},Ws=(t,i,a)=>ac(t.q,t.r,i,a),Wb=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i=Math.imul(i,16777619)>>>0;return i>>>0},Xb=t=>function(){let i=(t+=1831565813)>>>0;return i=Math.imul(i^i>>>15,i|1)>>>0,i^=i+Math.imul(i^i>>>7,i|61)>>>0,((i^i>>>14)>>>0)/4294967296},cc=t=>{const i=typeof t=="number"?t>>>0:Wb(String(t)),a=Xb(i||1);return{next:()=>a(),id:(o=9)=>{const c="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let f=0;f<o;f++){const h=Math.floor(a()*c.length)%c.length;r+=c[h]}return r}}},mo=(t,i,a=9,o="")=>{const c=`${t}:${i}:${o}`,r=cc(c),f="abcdefghijklmnopqrstuvwxyz0123456789";let h="";for(let b=0;b<a;b++){const y=Math.floor(r.next()*f.length)%f.length;h+=f[y]}return h},oc=(t,i)=>{const a=`${t}:${i}`;return cc(a).next()},Ea=t=>{const i=t.rngSeed||"default",a=t.rngCounter||0;return{value:oc(i,a),nextState:{...t,rngCounter:a+1}}};function ji(t){return t.statusEffects?.some(i=>i.type==="stunned")??!1}function Qb(t){return t.statusEffects?.some(i=>i.type==="rooted")??!1}function Fh(t,i=1){if(!t.statusEffects||t.statusEffects.length===0)return t;const a=t.statusEffects.map(o=>({...o,duration:o.duration-i})).filter(o=>o.duration>0);return{...t,statusEffects:a}}const fo={GRASS:{id:"GRASS",name:"Grass",description:"Soft grass",defaultTraits:new Set(["WALKABLE","FLAMMABLE"]),visual:{color:"#4a7c59",icon:""}},STONE:{id:"STONE",name:"Stone Floor",description:"Hard stone",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#808080",icon:""}},LAVA:{id:"LAVA",name:"Lava",description:"Molten lava",defaultTraits:new Set(["LIQUID","HAZARDOUS"]),visual:{color:"#ff4400",icon:""}},WALL:{id:"WALL",name:"Wall",description:"Solid wall",defaultTraits:new Set(["BLOCKS_LOS","BLOCKS_MOVEMENT","ANCHOR"]),visual:{color:"#333333",icon:""}},ICE:{id:"ICE",name:"Ice",description:"Slippery ice",defaultTraits:new Set(["WALKABLE","SLIPPERY"]),visual:{color:"#aaddff",icon:""}},VOID:{id:"VOID",name:"Void",description:"The endless void",defaultTraits:new Set(["HAZARDOUS"]),visual:{color:"#000000",icon:""}},STAIRS:{id:"STAIRS",name:"Stairs",description:"Lead to the next floor",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#ffffff",icon:""}},SHRINE:{id:"SHRINE",name:"Shrine",description:"A place of power",defaultTraits:new Set(["WALKABLE","ANCHOR"]),visual:{color:"#ffd700",icon:""}},GATE:{id:"GATE",name:"Gate",description:"A heavy gate",defaultTraits:new Set(["BLOCKS_MOVEMENT","BLOCKS_LOS"]),visual:{color:"#444444",icon:""}},BRIDGE:{id:"BRIDGE",name:"Bridge",description:"Crossing the gap",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#8b4513",icon:""}}},Dr={FIRE:{id:"FIRE",name:"Fire",description:"Burning flames",onStay:t=>({effects:[{type:"Damage",target:t.actor.id,amount:1,reason:"fire_damage"}],messages:[`${t.actor.subtype||t.actor.type} burns!`]}),interactsWith:{WET:t=>({effects:[{type:"Juice",effect:"flash",target:t.tile.position,color:"#aaaaaa"}],messages:["Steam rises!"],modifyTile:{effects:t.tile.effects.filter(i=>i.id!=="FIRE"&&i.id!=="WET"&&i.id!=="STEAM").concat({id:"STEAM",duration:2,potency:1})}})}},WET:{id:"WET",name:"Wet",description:"Soaked with water",onApply:t=>t.tile.effects.some(a=>a.id==="FIRE")?{effects:[],messages:["Water extinguishes the flames!"],modifyTile:{effects:t.tile.effects.filter(a=>a.id!=="FIRE")}}:{effects:[],messages:[]}},OIL:{id:"OIL",name:"Oil",description:"Slippery oil",interactsWith:{FIRE:t=>({effects:[{type:"Damage",target:"area",amount:3,reason:"oil_explosion"},{type:"Juice",effect:"explosion_ring",target:t.tile.position}],messages:["Oil explodes!"],modifyTile:{effects:t.tile.effects.filter(i=>i.id!=="OIL")}})}},STEAM:{id:"STEAM",name:"Steam",description:"Obscuring steam cloud"},BLESSED:{id:"BLESSED",name:"Blessed",description:"Holy ground"},CURSED:{id:"CURSED",name:"Cursed",description:"Unholy ground"},ICE_WALL:{id:"ICE_WALL",name:"Ice Wall",description:"A wall of ice"},SMOKE:{id:"SMOKE",name:"Smoke",description:"Thick smoke"},BOMB_TICK:{id:"BOMB_TICK",name:"Bomb Tick",description:"About to explode"},TRI_TRAP:{id:"TRI_TRAP",name:"Kinetic Trap",description:"Hidden trap that flings non-flying units outward"},SNARE:{id:"SNARE",name:"Snare",description:"Entangling roots that halt movement and root the target.",onPass:t=>t.actor.isFlying?{effects:[],messages:[]}:{effects:[{type:"ApplyStatus",target:t.actor.id,status:"rooted",duration:2}],messages:["Snared! Movement halted."],interrupt:!0,newMomentum:0}}},Pe={getTileAt(t,i){const a=de(i);let o;return t.tiles&&(t.tiles instanceof Map?o=t.tiles.get(a):Array.isArray(t.tiles)?o=t.tiles.find(c=>Array.isArray(c)&&c[0]===a||c.position&&Q(c.position,i)):o=t.tiles[a]),o||{position:i,baseId:"STONE",traits:new Set(["WALKABLE"]),effects:[]}},getTraitsForTile(t,i){const a=new Set,o=i.position;return Ws(o,t.gridWidth,t.gridHeight)?(i.baseId==="LAVA"&&(a.add("HAZARDOUS"),a.add("LIQUID"),a.add("LAVA")),i.baseId==="WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),i.traits.forEach(r=>a.add(r)),i.effects.forEach(r=>{r.id==="FIRE"&&(a.add("FIRE"),a.add("HAZARDOUS")),r.id==="ICE_WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),r.id==="SMOKE"&&a.add("BLOCKS_LOS")}),a):(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR"),a)},getTraitsAt(t,i){const a=this.getTileAt(t,i);return this.getTraitsForTile(t,a)},isPassable(t,i){const a=this.getTraitsAt(t,i);return!a.has("BLOCKS_MOVEMENT")&&!a.has("HAZARDOUS")},isWalkable(t,i){return!this.getTraitsAt(t,i).has("BLOCKS_MOVEMENT")},isLosBlocking(t,i){return this.getTraitsAt(t,i).has("BLOCKS_LOS")},isAnchorable(t,i){return this.getTraitsAt(t,i).has("ANCHOR")},hasTrait(t,i,a){return this.getTraitsAt(t,i).has(a)}};class Aa{static hasFireProtection(i){return i.statusEffects.some(a=>a.type==="fire_immunity")||i.activeSkills?.some(a=>a.id==="ABSORB_FIRE")||!1}static isFireHazard(i,a){return i.baseId==="LAVA"||a.has("LAVA")||a.has("FIRE")}static mergeResults(i,a){i.effects.push(...a.effects),i.messages.push(...a.messages),a.newMomentum!==void 0&&(i.newMomentum=a.newMomentum),a.interrupt&&(i.interrupt=!0),a.modifyTile&&(i.modifyTile={...i.modifyTile,...a.modifyTile})}static processEntry(i,a,o){const c={effects:[],messages:[],interrupt:!1},r={tile:a,actor:i,state:o,isFinalDestination:!0,source:i.previousPosition},f=Pe.getTraitsForTile(o,a);f.has("HAZARDOUS")&&!i.isFlying&&(this.isFireHazard(a,f)&&this.hasFireProtection(i)||(a.baseId==="LAVA"||f.has("LAVA")?this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"lava_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Lava Sink! You were engulfed by lava!"],interrupt:!0}):(a.baseId==="VOID"||f.has("VOID"))&&this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"void_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Void consumes your soul!"],interrupt:!0})));for(const h of a.effects){const b=Dr[h.id];if(!b?.onEnter)continue;const y=b.onEnter(r);if(this.mergeResults(c,y),c.interrupt)break}return c.messages.length===0&&c.effects.some(h=>h.type==="LavaSink")&&c.messages.push("Lava Sink! You were engulfed by lava!"),c}static processTransition(i,a,o,c,r={}){const{ignoreActors:f=!1,ignoreGroundHazards:h=!1}=r,b={effects:[],messages:[],newMomentum:c!==void 0?Math.max(0,c-1):void 0,interrupt:!1},y=Pe.getTraitsForTile(o,a);if(y.has("BLOCKS_MOVEMENT")||!f&&(o.enemies.find(x=>x.id!==i.id&&x.hp>0&&Q(x.position,a.position))||(i.id!==o.player.id&&Q(o.player.position,a.position)?o.player:void 0)))return b.interrupt=!0,b.newMomentum=0,b;const A={tile:a,actor:i,state:o,momentum:c,isFinalDestination:!1,source:i.previousPosition};y.has("HAZARDOUS")&&!i.isFlying&&!h?this.isFireHazard(a,y)&&this.hasFireProtection(i)?this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:99,reason:"hazard_intercept"}],messages:["Flames surge through you."],interrupt:!1}):this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:99,reason:"hazard_intercept"},{type:"Juice",effect:"lavaSink",target:a.position}],messages:[a.baseId==="LAVA"||y.has("LAVA")?"Sunk in Lava!":"Consumed by Void!"],interrupt:!0}):y.has("SLIPPERY")?b.newMomentum=Math.max(1,c||0):y.has("LIQUID")&&c!==void 0&&c>0&&(b.newMomentum=Math.max(0,c-1));for(const v of a.effects){const x=Dr[v.id];if(!x?.onPass)continue;const _=x.onPass(A);if(this.mergeResults(b,_),b.interrupt)break}if(!b.interrupt&&!i.isFlying&&!h&&o.traps){const v=o.traps.find(x=>Q(x.position,a.position)&&x.cooldown===0&&x.ownerId!==i.id);if(v){const x=a.position.q-v.position.q||1,_=a.position.r-v.position.r||0;let p=0;x>0&&_===0?p=0:x>0&&_<0?p=1:x===0&&_<0?p=2:x<0&&_===0?p=3:x<0&&_>0?p=4:p=5;const g=3;let N=a.position;const M=(E=>[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0},{q:0,r:1,s:-1}][E%6])(p);for(let E=0;E<g;E++){const w={q:N.q+M.q,r:N.r+M.r,s:N.s+M.s};if(!Pe.isWalkable(o,w))break;N=w}if(this.mergeResults(b,{effects:[{type:"SetTrapCooldown",position:v.position,ownerId:v.ownerId,cooldown:v.resetCooldown??2},{type:"Displacement",target:i.id,destination:N,source:a.position,isFling:!0},{type:"Juice",effect:"kineticWave",target:a.position,intensity:"high"},{type:"Juice",effect:"combat_text",target:a.position,text:"TRAP!"}],messages:[`${i.subtype||"Unit"} triggered a kinetic trap!`],interrupt:!0}),v.volatileCore&&this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:1,reason:"trap_volatile_core"}],messages:["Volatile core detonates!"]}),v.chainReaction&&o.traps){const E=o.traps.filter(w=>w.ownerId===v.ownerId&&w.cooldown===0&&!Q(w.position,v.position)&&at(v.position).some(D=>Q(D,w.position)));for(const w of E)this.mergeResults(b,{effects:[{type:"SetTrapCooldown",position:w.position,ownerId:w.ownerId,cooldown:w.resetCooldown??2}],messages:["Chain reaction sparks nearby traps!"]}),w.volatileCore&&this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:1,reason:"trap_chain_volatile"}],messages:["Chain blast!"]})}}}return b}static processStay(i,a,o){const c={effects:[],messages:[]},r={tile:a,actor:i,state:o,isFinalDestination:!1},f=Pe.getTraitsForTile(o,a);if((a.baseId==="LAVA"||f.has("LAVA"))&&!i.isFlying&&!i.statusEffects.some(h=>h.type==="fire_immunity")){const h=i.id==="player";this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:h?1:99,reason:"lava_tick"}],messages:["Lava Sink! You were engulfed by lava!"]})}for(const h of a.effects){const b=Dr[h.id];if(!b?.onStay)continue;const y=b.onStay(r);this.mergeResults(c,y)}return c}static applyEffect(i,a,o,c,r,f){const h=Dr[a];if(!h)return{effects:[],messages:[]};const b={effects:[],messages:[]};for(const y of i.effects){const A=h.interactsWith?.[y.id];if(A){const v=A({tile:i,state:r,potency:c,sourceId:f});return this.mergeResults(b,v),b}}if(h.onApply){const y=h.onApply({tile:i,state:r,potency:c,sourceId:f});this.mergeResults(b,y)}return b.modifyTile?.effects?b.modifyTile&&(i.effects=b.modifyTile.effects):i.effects.push({id:a,duration:o,potency:c,sourceId:f}),b}static processPath(i,a,o,c,r={}){let f=i.position,h=c,b={effects:[],messages:[],newMomentum:c,interrupt:!1};for(const y of a){const A=Pe.getTileAt(o,y),v=Pe.getTraitsForTile(o,A),x=this.processTransition(i,A,o,h,r);if(x.interrupt&&v.has("BLOCKS_MOVEMENT")){b.interrupt=!0;break}if(f=y,this.mergeResults(b,x),b.interrupt){b.interrupt=!0;break}if(h=b.newMomentum,h!==void 0&&h<=0)break}return{lastValidPos:f,result:b,interrupt:!!b.interrupt}}static getMovementCost(i,a){const o=Pe.getTraitsForTile(i,a);let c=1;return o.has("HAZARDOUS")&&(c+=5),o.has("LIQUID")&&(c+=1),o.has("FIRE")&&(c+=2),c}}const Jb=(t,i)=>Array(i).fill(0n),vd=(t,i,a)=>{if(!Number.isInteger(i.q)||!Number.isInteger(i.r))return[...t];if(i.r<0||i.r>=t.length||i.q<0)return[...t];const o=[...t];return o[i.r]|=1n<<BigInt(i.q),o},Hd=(t,i)=>i.r<0||i.r>=t.length?!0:(t[i.r]&1n<<BigInt(i.q))!==0n,Gh=(t,i)=>{if(i.playerStart&&Q(t,i.playerStart)||i.stairsPosition&&Q(t,i.stairsPosition)||i.shrinePosition&&Q(t,i.shrinePosition))return!0;if(i.tiles){const a=Pe.getTraitsAt(i,t);if(a.has("HAZARDOUS")||a.has("BLOCKS_MOVEMENT"))return!0}return!1},Di=(t,i)=>{if(t)return t.find(a=>a&&a.position&&Q(a.position,i))},Ae=(t,i)=>Q(t.player.position,i)?t.player:Di(t.enemies,i),Zb=(t,i)=>!!t.shrinePosition&&Q(i,t.shrinePosition),eS=(t,i)=>!(!Q(i,t.stairsPosition)||t.enemies.some(o=>o.subtype==="sentinel"&&o.hp>0)),tS=(t,i,a,o)=>{const c=_e(a,o);if(c===0)return[];const r=(o.q-a.q)/c,f=(o.r-a.r)/c,h=(o.s-a.s)/c,b=[],y=new Set,A=2;for(let v=1;v<=A;v++){const x={q:o.q+Math.round(r*v),r:o.r+Math.round(f*v),s:o.s+Math.round(h*v)};if(Ws(x,t.gridWidth,t.gridHeight)){const _=`${x.q},${x.r}`;y.has(_)||(y.add(_),b.push(x))}}return b},Ze={getNeighbors(t){return at(t)},isTileBlocked(t,i){return!t.occupancyMask||t.occupancyMask.length===0?!1:Hd(t.occupancyMask,i)},refreshOccupancyMask(t){let i=Jb(t.gridWidth,t.gridHeight);return t.tiles?.forEach(a=>{(a.baseId==="WALL"||a.traits?.has("BLOCKS_MOVEMENT"))&&(i=vd(i,a.position))}),t.player&&(i=vd(i,t.player.position)),t.enemies?.forEach(a=>{i=vd(i,a.position)}),i},getMovementRange(t,i,a){const o=new Map,c=[],r=b=>`${b.q},${b.r}`,f=Ae(t,i),h=[{p:i,cost:0}];for(o.set(r(i),0);h.length;){const b=h.shift();if(!(b.cost>=a))for(const y of this.getNeighbors(b.p)){if(!this.isWithinBounds(t,y)||!Pe.isWalkable(t,y))continue;const A=Ae(t,y),v=A&&!Q(y,i),x=v&&f&&A.factionId===f.factionId;if(v&&!x)continue;const _=r(y),p=b.cost+1;(!o.has(_)||o.get(_)>p)&&(o.set(_,p),x||c.push(y),h.push({p:y,cost:p}))}}return c},getAxialTargets(t,i,a,o={}){const{includeWalls:c=!1,includeActors:r=!0,stopAtObstacles:f=!0}=o,h=[];for(let b=0;b<6;b++)for(let y=1;y<=a;y++){const A=jn(i,Jd(b,y));if(!this.isWithinBounds(t,A))break;const x=Pe.getTileAt(t,A)?.baseId==="WALL",_=Ae(t,A);if(x){if(c&&h.push(A),f)break}else if(_){if(r&&h.push(A),f)break}else h.push(A)}return h},getAreaTargets(t,i,a){const o=[];for(let c=-a;c<=a;c++)for(let r=Math.max(-a,-c-a);r<=Math.min(a,-c+a);r++){const f=jn(i,Bn(c,r));this.isWithinBounds(t,f)&&o.push(f)}return o},isWithinBounds(t,i){return Ws(i,t.gridWidth,t.gridHeight)},getAxialTargetsWithOptions(t,i,a,o){return this.getAxialTargets(t,i,a,o)}},Wh=(t,i)=>{const a=i.q-t.q,o=i.r-t.r;return a>0&&o===0?0:a>0&&o<0?1:a===0&&o<0?2:a<0&&o===0?3:a<0&&o>0?4:5},ci=(t,i,a,o=[],c)=>{if(Qb(t))return{position:t.position,state:a};const r=Ze.getNeighbors(t.position);let f=[],h=c!==void 0?Math.abs(_e(t.position,i)-c):_e(t.position,i);for(const v of r){if(!Ze.isWithinBounds(a,v))continue;const x=a.tiles.get(de(v)),_=x?.traits.has("BLOCKS_LOS")||x?.baseId==="WALL",p=o.some(M=>Q(M,v))||a.enemies.some(M=>M.id!==t.id&&Q(M.position,v))||Q(v,i);if(_||p)continue;const g=x?Aa.getMovementCost(a,x):1,I=(c!==void 0?Math.abs(_e(v,i)-c):_e(v,i))+(g-1);I<h?(h=I,f=[v]):I===h&&f.push(v)}if(f.length===0)return{position:t.position,state:a};if(f.length===1)return{position:f[0],state:a};const{value:b,nextState:y}=Ea(a),A=Math.floor(b*f.length)%f.length;return{position:f[A],state:y}},nS=(t,i,a)=>{if(_e(t.position,i)===1)return{entity:{...t,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};let c=t.position,r=a;for(let h=0;h<2&&!(_e(c,i)<=1);h++){const b={...t,position:c},{position:y,state:A}=ci(b,i,r,a.occupiedCurrentTurn);c=y,r=A}const f=!Q(c,t.position);return{entity:{...t,position:c,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:r,message:f?`${t.subtype} moves to (${c.q}, ${c.r})`:void 0}},iS=(t,i,a)=>{const o=_e(t.position,i),c=Wh(t.position,i);if(o===1)return{entity:{...t,facing:c,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=ci(t,i,a,a.occupiedCurrentTurn),h=!Q(r,t.position);return{entity:{...t,position:r,facing:h?Wh(t.position,r):c,intent:h?"Advancing":"BASIC_ATTACK",intentPosition:h?void 0:{...i}},nextState:f,message:h?`${t.subtype} advances to (${r.q}, ${r.r})`:void 0}},sS=(t,i,a)=>{const o=_e(t.position,i);let c=a;const{value:r,nextState:f}=Ea(c);c=f;let h=t.position;if(o<=2||r<.3){const{value:v,nextState:x}=Ea(c);c=x;const{value:_,nextState:p}=Ea(c);c=p;const g=Math.floor(v*6),N=3+Math.floor(_*3);let I=t.position;for(let E=0;E<N;E++)I=jn(I,Nn(g));!Ze.isWithinBounds(a,I)||!Pe.isWalkable(a,I)||a.occupiedCurrentTurn?.some(E=>Q(E,I))||a.enemies.some(E=>E.id!==t.id&&Q(E.position,I))||Q(I,i)||(h=I)}const b=!Q(h,t.position),y=_e(h,i),A=!b&&y>=2&&y<=4;return{entity:{...t,position:h,intent:b?"Repositioning":A?"Casting":"Preparing",intentPosition:A?{...i}:void 0},nextState:c,message:b?`${t.subtype} teleports to (${h.q}, ${h.r})`:void 0}},aS=(t,i,a)=>{const o=_e(t.position,i);if(o===1)return{entity:{...t,isVisible:!0,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:c,state:r}=ci(t,i,a,a.occupiedCurrentTurn),f=!Q(c,t.position);return{entity:{...t,position:c,isVisible:f?!1:o<=1,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:r,message:f?"You hear footsteps nearby...":void 0}},oS={sentinel:{telegraphSkillId:"SENTINEL_TELEGRAPH",executeSkillId:"SENTINEL_BLAST",triggerRange:3,telegraphMessage:"The Sentinel marks the blast zone..."}},lS=(t,i,a,o)=>{const r=_e(t.position,i)<=o.triggerRange,f=a.turnNumber%2===0,h=!f;if(r&&h&&ji(t))return{entity:{...t,intent:"Preparing",intentPosition:void 0},nextState:a,message:`${t.subtype} loses focus!`};if(r&&f)return{entity:{...t,intent:o.telegraphSkillId,intentPosition:{...i}},nextState:a,message:o.telegraphMessage};if(r&&h)return{entity:{...t,intent:o.executeSkillId,intentPosition:{...i}},nextState:a};const{position:b,state:y}=ci(t,i,a,a.occupiedCurrentTurn);return{entity:{...t,position:b,intent:"Moving",intentPosition:void 0},nextState:y}},rS=(t,i,a)=>{const o=t.actionCooldown??0;if(o>0)return{entity:{...t,actionCooldown:o-1,intent:"Charging Power"},nextState:a};const c=_e(t.position,i);if(c>=1&&c<=3)return{entity:{...t,actionCooldown:2,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=ci(t,i,a,a.occupiedCurrentTurn),h=!Q(r,t.position);return{entity:{...t,position:r,intent:h?"Lumbering":"Waiting",actionCooldown:0},nextState:f,message:h?`${t.subtype} lumbers to (${r.q}, ${r.r})`:void 0}},cS=(t,i,a)=>{const o=_e(t.position,i);if(o>4){const{position:A,state:v}=ci(t,i,a,a.occupiedCurrentTurn),x=!Q(A,t.position);return{entity:{...t,position:A,intent:x?"Following":"Waiting"},nextState:v,message:x?`${t.subtype} follows you.`:void 0}}const c=a.enemies.filter(A=>A.factionId==="enemy").sort((A,v)=>_e(t.position,A.position)-_e(t.position,v.position))[0];if(!c){if(o>1){const{position:A,state:v}=ci(t,i,a,a.occupiedCurrentTurn);return{entity:{...t,position:A,intent:"Idle"},nextState:v}}return{entity:{...t,intent:"Idle"},nextState:a}}if(_e(t.position,c.position)===1)return{entity:{...t,intent:"BASIC_ATTACK",intentPosition:{...c.position}},nextState:a};const{position:f,state:h}=ci(t,c.position,a,a.occupiedCurrentTurn),b=!Q(f,t.position),y=_e(f,c.position);return{entity:{...t,position:f,intent:b?"Advancing":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...c.position}},nextState:h,message:b?`${t.subtype} attacks ${c.subtype}!`:void 0}},uS=(t,i,a)=>{if(t.factionId==="player")return cS(t,i,a);if((a.player.stealthCounter||0)>0)return{entity:{...t,intent:"Searching",intentPosition:void 0},nextState:a};const c=_e(t.position,i);switch(t.subtype){case"sprinter":return nS(t,i,a);case"shieldBearer":return iS(t,i,a);case"warlock":return sS(t,i,a);case"assassin":return aS(t,i,a);case"golem":return rS(t,i,a);case"sentinel":return lS(t,i,a,oS.sentinel);case"raider":{if((t.position.q===i.q||t.position.r===i.r||t.position.s===i.s)&&c>=2&&c<=4)return{entity:{...t,intent:"DASH",intentPosition:{...i}},nextState:a};const{position:f,state:h}=ci(t,i,a,a.occupiedCurrentTurn),b=!Q(f,t.position),y=_e(f,i);return{entity:{...t,position:f,intent:b?"Moving":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...i}},nextState:h,message:b?`${t.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"pouncer":{if((t.position.q===i.q||t.position.r===i.r||t.position.s===i.s)&&c>=2&&c<=4)return{entity:{...t,intent:"GRAPPLE_HOOK",intentPosition:{...i}},nextState:a};const{position:f,state:h}=ci(t,i,a,a.occupiedCurrentTurn),b=!Q(f,t.position);return{entity:{...t,position:f,intent:b?"Moving":"Waiting",intentPosition:void 0},nextState:h,message:b?`${t.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"archer":{if((t.position.q===i.q||t.position.r===i.r||t.position.s===i.s)&&c>1&&c<=4)return{entity:{...t,intent:"SPEAR_THROW",intentPosition:{...i}},nextState:a};const{position:f,state:h}=ci(t,i,a,a.occupiedCurrentTurn),b=!Q(f,t.position);return{entity:{...t,position:f,intent:b?"Moving":"Idle",intentPosition:void 0},nextState:h,message:b?`${t.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"bomber":{const r=t.actionCooldown??0;if(r===0&&c>=2&&c<=3){const A=Ze.getNeighbors(i).filter(v=>{const x=!Pe.isWalkable(a,v),_=a.enemies.some(p=>Q(p.position,v));return Ze.isWithinBounds(a,v)&&!x&&!_&&!Q(v,i)});if(A.length>0){const{value:v,nextState:x}=Ea(a),_=Math.floor(v*A.length)%A.length,p=A[_];return{entity:{...t,intent:"Bombing",intentPosition:p,actionCooldown:2},nextState:x}}}const{position:h,state:b}=ci(t,i,a,a.occupiedCurrentTurn,2.5),y=!Q(h,t.position);return{entity:{...t,position:h,intent:y?"Moving":"Waiting",intentPosition:void 0,actionCooldown:Math.max(0,r-1)},nextState:b,message:y?`${t.subtype} repositioning to (${h.q}, ${h.r})`:void 0}}default:{if(c===1)return{entity:{...t,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=ci(t,i,a,a.occupiedCurrentTurn),h=!Q(r,t.position),b=_e(r,i);return{entity:{...t,position:r,intent:h?"Moving":b===1?"BASIC_ATTACK":"Waiting",intentPosition:h||b>1?void 0:{...i}},nextState:f,message:h?`${t.subtype} moves to (${r.q}, ${r.r})`:void 0}}}},Zr=7,ec=9,te=36,Xh={speed:1},dS={stunned:{tickWindow:"START_OF_TURN"},poisoned:{tickWindow:"START_OF_TURN"},armored:{tickWindow:"END_OF_TURN"},hidden:{tickWindow:"END_OF_TURN"},time_bomb:{tickWindow:"END_OF_TURN"}},Pd={footman:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},sprinter:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:1,weightClass:"Standard",speed:2},raider:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","DASH"],actionCooldown:1,weightClass:"Standard",speed:1},pouncer:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],actionCooldown:1,weightClass:"Standard",speed:1},shieldBearer:{hp:2,maxHp:2,range:1,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],actionCooldown:2,weightClass:"Heavy",speed:1},archer:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK","SPEAR_THROW"],actionCooldown:3,weightClass:"Standard",speed:1},bomber:{hp:1,maxHp:1,range:3,damage:1,type:"ranged",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},warlock:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},sentinel:{hp:30,maxHp:30,range:4,damage:2,type:"boss",cost:25,skills:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],actionCooldown:1,weightClass:"Heavy",speed:1}},fS=.17,Qh=[0,2,3,5,7,10,12,15,18,22,25],Hr={floor:"#6b7b3c",wall:"#374151",shrine:"#f97316",portal:"#ffffff"},mS={1:"inferno",2:"inferno",3:"inferno",4:"inferno",5:"inferno",6:"inferno",7:"inferno",8:"inferno",9:"inferno",10:"inferno"},xd={1:["footman"],2:["footman","sprinter"],3:["footman","archer"],4:["footman","archer","bomber","raider"],5:["footman","archer","bomber","shieldBearer","raider"],6:["footman","archer","bomber","shieldBearer","warlock","pouncer"],7:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],8:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],9:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],10:["sentinel"]},Ys=(t,i)=>{let a=i,o=t.temporaryArmor||0,c=t.hp;if(o>0){const r=Math.min(o,a);o-=r,a-=r}return c=Math.max(0,c-a),{...t,hp:c,temporaryArmor:o}},Ud=(t,i,a,o)=>{const r=dS[i]?.tickWindow||"END_OF_TURN",f=i.toUpperCase();if(t.statusEffects.find(y=>y.id===f))return{...t,statusEffects:t.statusEffects.map(y=>y.id===f?{...y,duration:Math.max(y.duration,a),tickWindow:r,stacks:o||y.stacks}:y)};const b={id:f,type:i,duration:a,tickWindow:r,stacks:o||1};return{...t,statusEffects:[...t.statusEffects,b]}},pS=(t,i)=>({...t,hp:Math.min(t.maxHp,t.hp+i)}),hS=(t,i,a=!0)=>{const o=t.maxHp+i,c=a?Math.min(o,t.hp+i):t.hp;return{...t,maxHp:o,hp:c}},gS=t=>{const i=[];return t.player.hp<=0&&t.gameStatus==="playing"&&i.push({type:"GameOver",reason:"PLAYER_DIED"}),i},Jh=t=>t.activeSkills?{...t,activeSkills:t.activeSkills.map(i=>({...i,currentCooldown:Math.max(0,i.currentCooldown-1)}))}:t,yS=(t,i,a)=>t.activeSkills?{...t,activeSkills:t.activeSkills.map(o=>o.id===i&&!o.activeUpgrades.includes(a)?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}:t;function qd(t,i){return t?.get(i)}const Ad=(t,i,a)=>Math.max(i,Math.min(a,t)),ll=t=>Math.round(t*1e3)/1e3,Zd=t=>{const i=Math.max(0,t.body),a=Math.max(0,t.mind),o=Math.max(0,t.instinct);return{bodyDamageMultiplier:ll(1+i/20),bodyMitigation:ll(Ad(i*.01,0,.5)),mindStatusDurationBonus:Math.floor(a/15),mindMagicMultiplier:ll(1+a/20),instinctInitiativeBonus:o*2,instinctCriticalMultiplier:ll(1+Ad(o,0,10)*.02),instinctSparkDiscountMultiplier:ll(1-Ad(o,0,100)/100)}},uc=t=>{const i=Math.max(0,t.body),a=Math.max(0,t.mind),o=Math.max(0,t.instinct),c={base:0,body:5,mind:2,instinct:3},r=Math.floor(i*c.body+a*c.mind+o*c.instinct+c.base);return Math.max(1,r)},wn=(t,i,a)=>Math.max(i,Math.min(a,t)),tn=t=>Math.round(t*1e3)/1e3,bS=()=>globalThis?.process?.env?.HOP_COMBAT_INTERACTION_MODEL,SS=t=>t.length===0?1:t.reduce((i,a)=>i*a.multiplier,1),vS=t=>{let i=1;if(t.inDangerPreviewHex&&(i+=.15),typeof t.proximityDistance=="number"){const a=wn(t.proximityDistance,0,6);i+=(6-a)*.02}return i},xS=(t,i,a,o,c,r,f,h)=>{if(!i)return{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1};const b=a==="physical"?.85+t.instinct*.015+t.body*.005:.85+t.mind*.015+t.instinct*.005,y=a==="physical"?i.instinct*.012+i.body*.004:i.instinct*.008+i.mind*.008,A=wn(b-y,.1,.99);if(typeof o!="number")return{multiplier:A,pressure:tn(b-y),rangePressure:0,rangeMultiplier:1};const v={min:wn(c??(a==="physical"?1:2),1,6),max:wn(r??(a==="physical"?2:4),1,6)};if(v.max<v.min){const H=v.min;v.min=v.max,v.max=H}const x={min:wn(f??(a==="physical"?1:2),1,6),max:wn(h??(a==="physical"?3:5),1,6)};if(x.max<x.min){const H=x.min;x.min=x.max,x.max=H}const _=wn(o,1,6),p=Math.max(0,v.min-_),g=Math.max(0,_-v.max),N=p*.06+g*.1,I=t.instinct*.015,M=(_>=x.min&&_<=x.max?.05:0)+i.instinct*.006,E=I-N-M,w=wn(1+E,.55,1.25);return{multiplier:wn(A*w,.05,.99),pressure:tn(b-y),rangePressure:tn(E),rangeMultiplier:tn(w)}},AS=(t,i)=>{if(!t)return{multiplier:1,pressure:0};const a=wn(i==="physical"?t.body*.01+t.instinct*.004:t.mind*.01+t.instinct*.004,0,.75);return{multiplier:1-a,pressure:tn(a)}},TS=(t,i,a,o)=>{if(!i)return{multiplier:o,critPressure:0,resistancePressure:0};const c=wn(a==="physical"?.05+t.instinct*.01:.05+t.mind*.01,0,.75),r=wn(a==="physical"?i.body*.006+i.instinct*.004:i.mind*.006+i.instinct*.004,0,.7);return{multiplier:1+wn(c-r,0,.75)*(o-1),critPressure:tn(c),resistancePressure:tn(r)}},ES=(t,i,a,o,c)=>{const r=t.scaling.filter(v=>v.attribute==="body").reduce((v,x)=>v+(t.trinity.body||0)*x.coefficient,0),f=t.scaling.filter(v=>v.attribute==="mind").reduce((v,x)=>v+(t.trinity.mind||0)*x.coefficient,0),h=t.scaling.filter(v=>v.attribute==="instinct").reduce((v,x)=>v+(t.trinity.instinct||0)*x.coefficient,0),b=t.damageClass==="physical"?Math.max(0,t.basePower*(i.bodyDamageMultiplier-1)):0,y=t.damageClass==="magical"?Math.max(0,t.basePower*(i.mindMagicMultiplier-1)):0,A=Math.max(0,(c-1)*(a+o));return{body:Math.max(0,b+r),mind:Math.max(0,y+f),instinct:Math.max(0,h+A)}},_S=(t,i)=>{if(t<=0)return t;const a=Zd(i).mindStatusDurationBonus;return t+a},wS=t=>Zd(t).instinctInitiativeBonus,on=t=>{const i=Zd(t.trinity),a=t.damageClass||"physical",o=bS()==="triangle"?"triangle":"legacy",c=t.interactionModel||o,r=a==="magical"?i.mindMagicMultiplier:i.bodyDamageMultiplier,f=t.basePower*r,h=t.scaling.reduce((C,K)=>{const ne=t.trinity[K.attribute]||0;return C+ne*K.coefficient},0),b=SS(t.statusMultipliers),y=vS(t),A=i.instinctCriticalMultiplier,v=c==="triangle"?xS(t.trinity,t.targetTrinity,a,t.engagementRange,t.optimalRangeMin,t.optimalRangeMax,t.targetOptimalRangeMin,t.targetOptimalRangeMax):{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1},x=c==="triangle"?AS(t.targetTrinity,a):{multiplier:1,pressure:0},_=c==="triangle"?TS(t.trinity,t.targetTrinity,a,A):{multiplier:A,critPressure:0,resistancePressure:0},p=(f+h)*b*y*v.multiplier*x.multiplier*_.multiplier*(t.attackPowerMultiplier??1)*(t.targetDamageTakenMultiplier??1),g=Math.max(0,Math.floor(p)),N=ES(t,i,f,h,A),I=Math.max(1e-6,N.body+N.mind+N.instinct),M=tn(N.body/I),E=tn(N.mind/I),w=tn(N.instinct/I),D=Math.max(1,t.theoreticalMaxPower??p),H=wn(g/D,0,1);return{basePower:t.basePower,bodyScaledPower:tn(f),scalingPower:tn(h),statusMultiplier:tn(b),riskMultiplier:tn(y),criticalMultiplier:tn(A),hitMultiplier:tn(v.multiplier),rangeMultiplier:tn(v.rangeMultiplier),mitigationMultiplier:tn(x.multiplier),critExpectedMultiplier:tn(_.multiplier),finalPower:g,bodyContribution:M,mindContribution:E,instinctContribution:w,scoreEvent:{skillId:t.skillId,attackerId:t.attackerId,targetId:t.targetId,finalPower:g,efficiency:tn(H),riskBonusApplied:!!t.inDangerPreviewHex,damageClass:a,hitPressure:v.pressure,rangePressure:v.rangePressure,mitigationPressure:x.pressure,critPressure:_.critPressure,resistancePressure:_.resistancePressure,bodyContribution:M,mindContribution:E,instinctContribution:w}}},Xe=t=>{const i=qd(t.components,"trinity");if(i)return{body:i.body,mind:i.mind,instinct:i.instinct};const a=qd(t.components,"stats"),o=a?.strength??0,c=a?.defense??0,r=a?.evasion??0;return{body:o,mind:c,instinct:r}},Zh={player:100,footman:50,archer:60,shieldBearer:40,bomber:30,warlock:55,bomb:10},zd=t=>{let i=t.speed;if(i===void 0){const o=t.subtype;i=t.type==="player"?Zh.player:Zh[o]??50}return t.statusEffects?.some(o=>o.type==="stunned")&&(i-=100),i+=wS(Xe(t)),i},Ma=t=>{const i=[];i.push({actorId:t.player.id,initiative:zd(t.player),hasActed:!1,turnStartPosition:void 0});for(const a of t.enemies)i.push({actorId:a.id,initiative:zd(a),hasActed:!1,turnStartPosition:void 0});return i.sort((a,o)=>o.initiative!==a.initiative?o.initiative-a.initiative:a.actorId==="player"?-1:o.actorId==="player"?1:a.actorId.localeCompare(o.actorId)),{entries:i,currentIndex:-1,round:1}},MS=t=>t.currentIndex<0||t.currentIndex>=t.entries.length?null:t.entries[t.currentIndex],OS=t=>{let i=t.initiativeQueue;i||(i=Ma(t));let a=i.currentIndex+1;for(;a<i.entries.length&&i.entries[a].hasActed;)a++;return a>=i.entries.length?(i=Ma(t),i.round=(t.initiativeQueue?.round??0)+1,a=0,{queue:{...i,currentIndex:a},actorId:i.entries[a]?.actorId??null,newRound:!0}):{queue:{...i,currentIndex:a},actorId:i.entries[a]?.actorId??null,newRound:!1}},CS=(t,i)=>{const a=t.initiativeQueue;if(!a)return Ma(t);const o=a.entries.map(c=>{if(c.actorId===i.id){if(c.turnStartPosition)return c;const f=at(i.position).map(h=>Ae(t,h)?.id).filter(Boolean);return{...c,turnStartPosition:{...i.position},turnStartNeighborIds:f}}return c});return{...a,entries:o}},NS=(t,i)=>{const a=t.initiativeQueue;if(!a)return Ma(t);const o=a.entries.map(c=>c.actorId===i?{...c,hasActed:!0}:c);return{...a,entries:o}},RS=(t,i)=>{const a=t.initiativeQueue;return a?a.entries.find(c=>c.actorId===i)?.turnStartPosition??null:null},kS=(t,i)=>{const a=t.initiativeQueue;return a?a.entries.find(c=>c.actorId===i)?.turnStartNeighborIds??null:null},gl=t=>{const i=t.initiativeQueue;if(!i)return!0;if(i.currentIndex<0||i.currentIndex>=i.entries.length)return!1;const a=i.entries[i.currentIndex];return a.actorId===t.player.id&&!a.hasActed},Td=(t,i)=>{const a=t.entries.filter(r=>r.actorId!==i);let o=t.currentIndex;const c=t.entries.findIndex(r=>r.actorId===i);return c>=0&&c<=t.currentIndex&&o--,{...t,entries:a,currentIndex:Math.min(o,a.length-1)}},LS=(t,i)=>{const a={actorId:i.id,initiative:zd(i),hasActed:!0,turnStartPosition:void 0};return{...t,entries:[...t.entries,a]}},an={body:0,mind:0,instinct:0},IS=t=>({body:t.body,mind:t.mind,instinct:t.instinct}),co=t=>{const i={};for(const[a,o]of Object.entries(t))i[a]=IS(o);return i},BS={neutral:{id:"neutral",default:an,archetype:co({VANGUARD:an,SKIRMISHER:an,FIREMAGE:an,NECROMANCER:an,HUNTER:an,ASSASSIN:an}),enemySubtype:co({footman:an,sprinter:an,raider:an,pouncer:an,shieldBearer:an,archer:an,bomber:an,warlock:an,sentinel:an}),companionSubtype:co({falcon:an,skeleton:an})},live:{id:"live",default:an,archetype:co({VANGUARD:{body:9,mind:4,instinct:5},SKIRMISHER:{body:7,mind:6,instinct:10},FIREMAGE:{body:2,mind:9,instinct:4},NECROMANCER:{body:5,mind:9,instinct:5},HUNTER:{body:3,mind:4,instinct:8},ASSASSIN:{body:3,mind:3,instinct:9}}),enemySubtype:co({footman:{body:0,mind:0,instinct:0},sprinter:{body:0,mind:0,instinct:0},raider:{body:.4,mind:0,instinct:.2},pouncer:{body:.4,mind:0,instinct:.2},shieldBearer:{body:1,mind:0,instinct:.4},archer:{body:.2,mind:0,instinct:.2},bomber:{body:.4,mind:.2,instinct:.2},warlock:{body:.4,mind:.6,instinct:.2},sentinel:{body:4,mind:2,instinct:2}}),companionSubtype:co({falcon:{body:2,mind:2,instinct:9},skeleton:{body:15,mind:1,instinct:4}})}},jS=t=>t?.toLowerCase()==="neutral"?"neutral":"live",DS=()=>globalThis?.process?.env?.HOP_TRINITY_PROFILE,HS=t=>BS[jS(DS())],Bi={outgoingPhysical:1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},PS={VANGUARD:Bi,SKIRMISHER:Bi,FIREMAGE:Bi,NECROMANCER:Bi,HUNTER:Bi,ASSASSIN:Bi},US={footman:{outgoingPhysical:3,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},sprinter:{outgoingPhysical:2.8,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},raider:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},pouncer:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},shieldBearer:{outgoingPhysical:3.5,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},archer:{outgoingPhysical:2.6,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},bomber:{outgoingPhysical:2.8,outgoingMagical:3,incomingPhysical:1,incomingMagical:1},warlock:{outgoingPhysical:1.5,outgoingMagical:3.5,incomingPhysical:1,incomingMagical:1},sentinel:{outgoingPhysical:4,outgoingMagical:4,incomingPhysical:1,incomingMagical:1}},qS={falcon:{outgoingPhysical:1.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},skeleton:{outgoingPhysical:1.1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1}},yl=t=>({outgoingPhysical:t.outgoingPhysical,outgoingMagical:t.outgoingMagical,incomingPhysical:t.incomingPhysical,incomingMagical:t.incomingMagical}),ty=t=>t.type==="player"?yl(PS[(t.archetype||"VANGUARD").toUpperCase()]||Bi):t.companionOf&&t.subtype?yl(qS[t.subtype]||Bi):t.subtype?yl(US[t.subtype]||Bi):yl(Bi),ny=t=>{const i=qd(t.components,"combat_profile");return i?{outgoingPhysical:Number.isFinite(i.outgoingPhysical)?i.outgoingPhysical:1,outgoingMagical:Number.isFinite(i.outgoingMagical)?i.outgoingMagical:1,incomingPhysical:Number.isFinite(i.incomingPhysical)?i.incomingPhysical:1,incomingMagical:Number.isFinite(i.incomingMagical)?i.incomingMagical:1}:yl(Bi)},zS=(t,i)=>{const a=ny(t);return i==="magical"?a.outgoingMagical:a.outgoingPhysical},$S=(t,i)=>{const a=ny(t);return i==="magical"?a.incomingMagical:a.incomingPhysical},rl=t=>({body:t.body,mind:t.mind,instinct:t.instinct}),iy=t=>{if(t.trinity)return rl(t.trinity);const i=HS(),a=i.default;if(t.type==="player"){const o=(t.archetype||"VANGUARD").toUpperCase();return rl(i.archetype[o]||a)}if(t.companionOf&&t.subtype){const o=t.subtype;if(i.companionSubtype[o])return rl(i.companionSubtype[o])}return t.subtype?rl(i.enemySubtype[t.subtype]||a):rl(a)},bl=t=>{const i=new Map(t.components||[]),a=i.has("trinity"),o=i.has("combat_profile");if(a&&o)return t;const c=iy({id:t.id,type:t.type,subtype:t.subtype,position:t.position,hp:t.hp,maxHp:t.maxHp,speed:t.speed,factionId:t.factionId,archetype:t.archetype,companionOf:t.companionOf}),r=ty({type:t.type,archetype:t.archetype,subtype:t.subtype,companionOf:t.companionOf});return a||i.set("trinity",{type:"trinity",...c}),o||i.set("combat_profile",{type:"combat_profile",...r}),{...t,components:i}};function VS(t){return t.map(i=>({id:i,name:String(i),description:String(i),slot:"utility",cooldown:0,currentCooldown:0,range:0,upgrades:[],activeUpgrades:[]}))}function Gs(t){const i=t.activeSkills?[...t.activeSkills]:VS(t.skills||[]),a=new Map(t.components||[]),o=iy(t),c=t.combatProfile||ty(t);a.has("trinity")||a.set("trinity",{type:"trinity",...o}),a.has("combat_profile")||a.set("combat_profile",{type:"combat_profile",...c});const r=uc(o),f=Math.max(1,t.maxHp??r),h=Math.min(f,Math.max(0,t.hp??f));return t.weightClass&&a.set("physics",{type:"physics",weightClass:t.weightClass}),t.archetype&&a.set("archetype",{type:"archetype",archetype:t.archetype}),{id:t.id,type:t.type,subtype:t.subtype,position:t.position,hp:h,maxHp:f,speed:t.speed,factionId:t.factionId,initiative:t.initiative,statusEffects:[],temporaryArmor:0,activeSkills:i,weightClass:t.weightClass,archetype:t.archetype,components:a,isFlying:t.isFlying,companionOf:t.companionOf,isVisible:!0}}function YS(t){const i=Gs({id:t.id,type:"enemy",subtype:t.subtype,position:t.position,hp:t.hp,maxHp:t.maxHp,speed:t.speed,factionId:"enemy",skills:t.skills,weightClass:t.weightClass||"Standard",trinity:t.trinity});return i.enemyType=t.enemyType,i}function sy(t){if(t.companionType==="falcon"){const i=Gs({id:t.id||`falcon-${t.ownerId}`,type:"enemy",subtype:"falcon",position:t.position,speed:95,factionId:"player",skills:["BASIC_MOVE","FALCON_PECK","FALCON_APEX_STRIKE","FALCON_HEAL","FALCON_SCOUT","FALCON_AUTO_ROOST"],weightClass:"Light",isFlying:!0,companionOf:t.ownerId,trinity:t.trinity});return i.companionState={mode:"roost",orbitStep:0},i}return t.companionType==="skeleton"?Gs({id:t.id||`${t.companionType}-${t.ownerId}`,type:"enemy",subtype:"skeleton",position:t.position,hp:2,maxHp:2,speed:50,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],companionOf:t.ownerId,weightClass:"Standard",trinity:t.trinity}):Gs({id:t.id||`${t.companionType}-${t.ownerId}`,type:"enemy",subtype:t.companionType,position:t.position,speed:80,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK"],companionOf:t.ownerId,weightClass:"Standard",trinity:t.trinity})}function KS(t){return sy({companionType:"falcon",ownerId:t.ownerId,position:t.position})}function FS(t){const i=["BASIC_MOVE","BASIC_ATTACK"],a={footman:["AUTO_ATTACK"],sprinter:[],raider:["DASH"],pouncer:["GRAPPLE_HOOK"],shieldBearer:["SHIELD_BASH"],archer:["SPEAR_THROW"],bomber:["BOMB_TOSS"],warlock:[],sentinel:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"]};return[...i,...a[t]||[]]}const GS=/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*/i,WS=t=>GS.test(t),ef=(t,i="INFO",a="SYSTEM")=>t?WS(t)?t:`[${i}|${a}] ${t}`:"",XS=(t,i="INFO",a="SYSTEM")=>t.map(o=>ef(o,i,a)).filter(Boolean),kt=(t,i,a,o,c=50)=>{const r=ef(i,a,o),f=[...t||[]];return r&&f[f.length-1]===r?f.slice(-c):[...f,r].slice(-c)},Ki=(t,i,a,o,c=50)=>{const r=[...t||[]];let f;for(const h of XS(i,a,o))h&&f===h||(r.push(h),f=h);return r.slice(-c)},eg=(t,i,a)=>{const o=a.preserveInputOrder===!1?[...i]:[...i].reverse(),c=a.describe||(()=>"UNKNOWN");let r=t;const f=[];let h=a.startTick||1;for(;o.length>0;){const b=o.length,y=o.pop();r=a.apply(r,y);const A=a.getReactions?.(r,y)||[];if(A.length>0)for(let v=A.length-1;v>=0;v--)o.push(A[v]);f.push({tick:h++,effectType:c(y),depthBefore:b,depthAfter:o.length,reactionsQueued:A.length})}return{state:r,trace:f,resolvedCount:f.length}};var tg={};const cl=(t,i)=>{const a=de(i);let o=t;o.tiles===t.tiles&&(o={...o,tiles:new Map(o.tiles)});let c=o.tiles.get(a);return c?c={...c,traits:new Set(c.traits),effects:[...c.effects]}:c={baseId:"STONE",position:i,traits:new Set(fo.STONE.defaultTraits),effects:[]},c.traits.add("CORPSE"),o.tiles.set(a,c),o},QS=(t,i)=>{const a=de(i),o=t.tiles.get(a);if(!o||!o.traits.has("CORPSE"))return t;let c=t;c.tiles===t.tiles&&(c={...c,tiles:new Map(c.tiles)});const r={...o,traits:new Set(o.traits),effects:[...o.effects]};return r.traits.delete("CORPSE"),c.tiles.set(a,r),c},JS=typeof process<"u"&&(tg?.HOP_ENGINE_WARN==="1"||tg?.HOP_ENGINE_DEBUG==="1"),ng={INTENT_START:1,MOVE_START:2,MOVE_END:3,ON_PASS:4,ON_ENTER:5,HAZARD_CHECK:6,STATUS_APPLY:7,DAMAGE_APPLY:8,DEATH_RESOLVE:9,INTENT_END:10},ZS=t=>{const i=t||[];let a=0;for(const o of i)o.blocking&&(a+=Number(o.suggestedDurationMs||0));return a},xi=(t,i,a,o,c,r,f)=>{const h=t.timelineEvents||[],b=h.length,y=t.turnNumber||0,A=c.sourceId||c.targetId,v=c.stepId||`${y}:${A||"system"}`,x=c.stepId||v,_=x?[...h].reverse().find(g=>(g.stepId||g.groupId)===x):void 0;if(_){const g=ng[_.phase]||0,N=ng[i]||0;g>N&&JS&&console.warn("[TURN_STACK] Non-monotonic timeline phase order detected.",{stepId:x,previous:_.phase,next:i})}const p=`${x}:${b}:${i}`;return{...t,timelineEvents:[...h,{id:p,turn:y,actorId:A,stepId:x,phase:i,type:a,payload:o,blocking:r,groupId:v,suggestedDurationMs:f}]}},ul=(t,i)=>{const a=t.simulationEvents||[],o=`sim:${t.turnNumber||0}:${a.length}:${i.type}`;return{...t,simulationEvents:[...a,{...i,id:o,turn:t.turnNumber||0}]}},ev=(t,i)=>{if(i)return t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i)},ig=(t,i)=>{if(i)return Q(t.player.position,i)?t.player:t.enemies.find(a=>Q(a.position,i))||t.companions?.find(a=>Q(a.position,i))},tv=new Set(["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage","burning","oil_explosion"]),Ed=(t,i,a,o,c,r)=>{if(!o)return{amount:i,outgoing:1,incoming:1,total:1};if(r&&tv.has(r))return{amount:i,outgoing:1,incoming:1,total:1};const f=ev(t,a);if(!f)return{amount:i,outgoing:1,incoming:1,total:1};const h=zS(f,c),b=$S(o,c),y=h*b;return{amount:Math.max(0,Math.floor(i*y)),outgoing:h,incoming:b,total:y}},$d=(t,i,a={})=>{let o={...t};const c=()=>{o.tiles===t.tiles&&(o={...o,tiles:new Map(o.tiles)})};switch(i.type){case"Displacement":{let r="";if(i.target==="self"?r=a.sourceId||o.player.id:i.target==="targetActor"?r=a.targetId||"":r=i.target,!r)break;const f=(x,_)=>_===x.player.id?x.player:x.enemies.find(p=>p.id===_),h=f(o,r);if(!h)break;const b=i.source||h?.position,y=Math.min(3200,Math.max(0,ZS(o.timelineEvents)));let A=!1;const v=!(i.simulatePath||i.path||i.isFling);if(b&&(o=xi(o,"MOVE_START","Displacement",{origin:b,destination:i.destination,targetActorId:r},{...a,targetId:r},!0,220)),b){const x=i.path||(b?Lt(b,i.destination):void 0),_=i.simulatePath||i.isFling||!!i.path;let p=i.destination;if(_&&x){const H=f(o,r);if(!H)break;const C=Aa.processPath(H,x.slice(1),o,x.length-1,{ignoreActors:i.ignoreCollision,ignoreGroundHazards:i.ignoreGroundHazards});p=C.lastValidPos,r===o.player.id?o.player={...o.player,position:p}:o.enemies=o.enemies.map(ne=>ne.id===r?{...ne,position:p}:ne),A||(o=xi(o,"MOVE_END","Displacement",{destination:p,targetActorId:r},{...a,targetId:r},!0,260),A=!0),C.result.effects.length>0&&(o=xi(o,"ON_PASS","TilePath",{path:x.slice(1),targetActorId:r},{...a,targetId:r},!1,80),o=ui(o,C.result.effects,{targetId:r})),C.result.messages.length>0&&(o.message=Ki(o.message,C.result.messages,"INFO","HAZARD"));const K=r===o.player.id||o.enemies.some(ne=>ne.id===r);if(!C.interrupt&&K){const ne=Pe.getTileAt(o,p);o=xi(o,"ON_ENTER","TileEnter",{position:p,targetActorId:r,tileBaseId:ne?.baseId},{...a,targetId:r},!1,80);const xe=f(o,r);if(!xe)break;const oe=Aa.processEntry(xe,ne,o);oe.effects.length>0&&(o=ui(o,oe.effects,{targetId:r})),oe.messages.length>0&&(o.message=Ki(o.message,oe.messages,"INFO","HAZARD"))}if(C.result.newMomentum&&C.result.newMomentum>0){const ne=C.lastValidPos,xe=x.length>1?x[x.length-2]:b,oe=Fs(xe,ne);if(oe!==-1){const ke=Nn(oe);let ie=ne,Te=5;for(;Te>0;){const pe=jn(ie,ke);if(!Pe.isWalkable(o,pe)||(r===o.player.id?o.enemies.find(ae=>ae.hp>0&&Q(ae.position,pe)):Q(o.player.position,pe)?o.player:o.enemies.find(ae=>ae.id!==r&&ae.hp>0&&Q(ae.position,pe))))break;const Z=Pe.getTileAt(o,pe);if(Z){const ae=Aa.processTransition(h,Z,o,1);if(ie=pe,ae.effects.length>0&&(o=ui(o,ae.effects,{targetId:r})),ae.messages.length>0&&(o.message=Ki(o.message,ae.messages,"INFO","HAZARD")),ae.newMomentum===0||ae.interrupt)break}else{ie=pe;break}Te--}p=ie}}}const g=[...o.visualEvents||[]],N=!!(i.ignoreCollision||i.isFling),I=N?g.reduce((H,C)=>{if(C.type!=="kinetic_trace")return H;const K=C.payload;return K&&(K.movementType??"slide")==="slide"?H+1:H},0):0,M=v?0:N?Math.min(640,I*90):0,E=Math.max(y,M),w={actorId:r,origin:b,path:i.path||(v?[b,p]:Lt(b,p)),destination:p,movementType:v?"teleport":"slide",durationMs:i.animationDuration??(v?180:Math.max(120,(i.path?.length||Lt(b,p).length)*110)),startDelayMs:E,wasLethal:o.tiles.get(de(p))?.traits.has("HAZARDOUS")||!1},D=g;if(v)D.push({type:"kinetic_trace",payload:w});else{let H=!1;for(let C=D.length-1;C>=0;C--){const K=D[C];if(K.type!=="kinetic_trace")continue;const ne=K.payload;if(!(!ne||ne.actorId!==r)){if((ne.movementType??"slide")==="slide"&&Q(ne.destination,w.origin)){const xe=ne.path&&ne.path.length>0?ne.path:[ne.origin,ne.destination],oe=w.path&&w.path.length>0?w.path:[w.origin,w.destination],ke=[...xe,...oe.slice(1)];D[C]={type:"kinetic_trace",payload:{...w,origin:ne.origin,path:ke,durationMs:(ne.durationMs||0)+(w.durationMs||0),startDelayMs:Math.min(ne.startDelayMs??E,E),movementType:"slide",wasLethal:!!(ne.wasLethal||w.wasLethal)}},H=!0}break}}H||D.push({type:"kinetic_trace",payload:w})}if(o.visualEvents=D,r===o.player.id)o.player={...o.player,position:p,previousPosition:v?p:o.player.position};else{const H=C=>C.id===r?{...C,position:p,previousPosition:v?p:C.position}:C;o.enemies=o.enemies.map(H),o.companions&&(o.companions=o.companions.map(H))}o.occupancyMask=Ze.refreshOccupancyMask(o),A||(o=xi(o,"MOVE_END","Displacement",{destination:p,targetActorId:r},{...a,targetId:r},!0,260)),o=ul(o,{type:"UnitMoved",actorId:r,position:p,payload:{origin:b,destination:p,movementType:w.movementType}})}break}case"Damage":{const r=!!i.reason&&["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage"].includes(i.reason),f=N=>N?.statusEffects?.some(I=>I.type==="marked_predator")?1:0;r&&(o=xi(o,"HAZARD_CHECK","Damage",{reason:i.reason,amount:i.amount,target:i.target},a,!0,200)),o=xi(o,"DAMAGE_APPLY","Damage",{reason:i.reason,amount:i.amount,target:i.target,scoreEvent:i.scoreEvent},a,!0,180);let h="",b=null,y,A,v=i.amount;typeof i.target=="string"?i.target==="targetActor"?h=a.targetId||"":i.target!=="area"&&(h=i.target):b=i.target;const x=["fire_damage","lava_sink","burning","hazard_intercept","lava_tick","oil_explosion","void_sink"],_=i.reason&&x.includes(i.reason),p=o.upgrades?.includes("RELIC_EMBER_WARD"),g=o.upgrades?.includes("RELIC_CINDER_ORB");if(_&&h){const I=(h===o.player.id?o.player:o.enemies.find(E=>E.id===h))?.activeSkills?.some(E=>E.id==="ABSORB_FIRE");let M=i.amount;if(h===o.player.id&&p&&(M=Math.max(0,M-1),o.message=kt(o.message,"Ember Ward dampens the flames.","INFO","COMBAT")),I){const E=M+(h===o.player.id&&g?1:0);return h===o.player.id&&g&&(o.message=kt(o.message,"Cinder Orb amplifies the absorption.","INFO","COMBAT")),$d(o,{type:"Heal",target:h,amount:E})}}if(h)if(h===o.player.id){const N=o.player,I=i.scoreEvent?.damageClass||"physical",M=Ed(o,i.amount,a.sourceId,N,I,i.reason);let E=M.amount;E+=f(N),_&&p&&(E=Math.max(0,E-1)),i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:E,traitOutgoingMultiplier:M.outgoing,traitIncomingMultiplier:M.incoming,traitTotalMultiplier:M.total}].slice(-500)),o.player=Ys(o.player,E),y=o.player.id,A=o.player.position,v=E,_&&(o.hazardBreaches=(o.hazardBreaches||0)+1),_&&g&&(o.player=pS(o.player,1),o.message=kt(o.message,"Cinder Orb restores 1 HP.","INFO","COMBAT"))}else{const N=o.enemies.find(C=>C.id===h),I=h===o.player.id?o.player.position:N?.position,M=[],E=i.scoreEvent?.damageClass||"physical",w=Ed(o,i.amount,a.sourceId,N,E,i.reason),D=w.amount+f(N);y=h||N?.id,A=I||N?.position,v=D;const H=C=>{if(C.id===h){const K=Ys(C,D);return K.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],C],M.push(C.position)),K}return C};if(i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:D,traitOutgoingMultiplier:w.outgoing,traitIncomingMultiplier:w.incoming,traitTotalMultiplier:w.total}].slice(-500)),o.enemies=o.enemies.map(H).filter(C=>C.hp>0),o.companions&&(o.companions=o.companions.map(H).filter(C=>C.hp>0)),M.length>0&&(o=xi(o,"DEATH_RESOLVE","Damage",{targetActorId:h,reason:i.reason||"damage"},{...a,targetId:h},!0,260)),M.forEach(C=>{o=cl(o,C)}),I&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:I}}]),h===o.player.id&&(o.player.stealthCounter||0)>0)o.player={...o.player,stealthCounter:Math.max(0,(o.player.stealthCounter||0)-1)};else if(h!==o.player.id){const C=K=>K.id===h?{...K,stealthCounter:Math.max(0,(K.stealthCounter||0)-1)}:K;o.enemies=o.enemies.map(C),o.companions&&(o.companions=o.companions.map(C))}h===o.player.id&&o.player.archetype==="HUNTER"&&i.source&&Fs(i.source,o.player.position)!==-1&&(o.message=kt(o.message,"You roll away!","INFO","COMBAT")),N&&N.archetype==="HUNTER"&&i.source&&Fs(i.source,N.position)!==-1&&(o.message=kt(o.message,`${N.subtype||N.id} rolls away!`,"INFO","COMBAT"))}else if(b){const N=ig(o,b),I=i.scoreEvent?.damageClass||"physical",M=Ed(o,i.amount,a.sourceId,N,I,i.reason),E=M.amount;y=N?.id,A=b,v=E+f(N||void 0),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:b}}],i.scoreEvent&&N&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,targetId:N.id,finalPower:E,traitOutgoingMultiplier:M.outgoing,traitIncomingMultiplier:M.incoming,traitTotalMultiplier:M.total}].slice(-500)),Q(o.player.position,b)&&(o.player=Ys(o.player,E+f(o.player)),_&&(o.hazardBreaches=(o.hazardBreaches||0)+1),o.player.hp<=0);const w=C=>{if(Q(C.position,b)){const K=Ys(C,E+f(C));return K.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],C],H.push(C.id),D.push(C.position)),K}return C},D=[],H=[];o.enemies=o.enemies.map(w).filter(C=>C.hp>0),o.companions&&(o.companions=o.companions.map(w).filter(C=>C.hp>0)),H.forEach(C=>{o=xi(o,"DEATH_RESOLVE","Damage",{targetActorId:C,reason:i.reason||"area_damage"},{...a,targetId:C},!0,260)}),D.forEach(C=>{o=cl(o,C)})}v>0&&(o=ul(o,{type:"DamageTaken",targetId:y||h||void 0,position:A,payload:{amount:v,reason:i.reason,sourceId:a.sourceId}}));break}case"Heal":{const r=y=>({...y,hp:Math.min(y.maxHp,y.hp+i.amount)}),f=i.target==="targetActor"?a.targetId:i.target;let h,b;if(f){const y=f===o.player.id?o.player:o.enemies.find(A=>A.id===f)||o.companions?.find(A=>A.id===f);if(y){const A=f===o.player.id?"You":y.subtype||y.id;if(o.message=kt(o.message,`${A} recover ${i.amount} HP.`,"INFO","COMBAT"),f===o.player.id)o.player=r(o.player),h=o.player.id,b=o.player.position;else{const v=x=>x.id===f?r(x):x;o.enemies=o.enemies.map(v),o.companions&&(o.companions=o.companions.map(v)),h=y.id,b=y.position}}}h&&(o=ul(o,{type:"Healed",targetId:h,position:b,payload:{amount:i.amount,sourceId:a.sourceId}}));break}case"ApplyStatus":{o=xi(o,"STATUS_APPLY","ApplyStatus",{status:i.status,duration:i.duration,target:i.target},a,!0,160);let r="",f=null;typeof i.target=="string"?i.target==="targetActor"?r=a.targetId||"":r=i.target:f=i.target;let h=f;const b=a.sourceId?a.sourceId===o.player.id?o.player:o.enemies.find(v=>v.id===a.sourceId):void 0,y=b?_S(i.duration,Xe(b)):i.duration;if(r){const v=r===o.player.id?o.player:o.enemies.find(x=>x.id===r)||o.companions?.find(x=>x.id===r);if(v){h=v.position;const x=r===o.player.id?"You":`${v.subtype||"enemy"}#${v.id}`,_=r===o.player.id?"are":"is";if(o.message=kt(o.message,`${x} ${_} ${i.status}!`,"INFO","COMBAT"),r===o.player.id)o.player=Ud(o.player,i.status,y);else{const p=g=>g.id===r?Ud(g,i.status,y):g;o.enemies=o.enemies.map(p),o.companions&&(o.companions=o.companions.map(p))}}}i.status==="stunned"&&h&&(o.visualEvents=[...o.visualEvents||[],{type:"shake",payload:{intensity:"low"}},{type:"vfx",payload:{type:"stunBurst",position:h}},{type:"combat_text",payload:{text:"STUNNED",position:h}}]);const A=r||(h?ig(o,h)?.id:void 0);o=ul(o,{type:"StatusApplied",targetId:A,position:h||void 0,payload:{status:i.status,duration:y,sourceId:a.sourceId}});break}case"PickupShield":{const r=i.position||o.shieldPosition;if(r&&o.shieldPosition&&Q(o.shieldPosition,r)){o.hasShield=!0,o.shieldPosition=void 0;const f={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Shield Bash.",slot:"utility",cooldown:3,currentCooldown:0,range:1,upgrades:[],activeUpgrades:[]};o.player.activeSkills.some(h=>h.id==="BULWARK_CHARGE")||(o.player={...o.player,activeSkills:[...o.player.activeSkills,f]})}break}case"PickupSpear":{const r=i.position||o.spearPosition;r&&o.spearPosition&&Q(o.spearPosition,r)&&(o.hasSpear=!0,o.spearPosition=void 0);break}case"SpawnItem":{if(i.itemType==="spear")o.spearPosition=i.position,a.sourceId===o.player.id&&(o.hasSpear=!1);else if(i.itemType==="bomb"){const r=o.initialSeed??o.rngSeed??"0",f=(o.turnNumber<<16)+(o.actionLog?.length??0)+o.enemies.length,h=`bomb-${mo(r,f,8,"bomb")}`,b=Gs({id:h,type:"enemy",subtype:"bomb",factionId:"enemy",position:i.position,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});b.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.enemies=[...o.enemies,b]}else i.itemType==="shield"&&(o.shieldPosition=i.position,o.hasShield=!1);break}case"LavaSink":{o=xi(o,"HAZARD_CHECK","LavaSink",{target:i.target},a,!0,240);const r=i.target,f=r===o.player.id?o.player:o.enemies.find(h=>h.id===r);f&&(o=xi(o,"DEATH_RESOLVE","LavaSink",{targetId:r},{...a,targetId:r},!0,280),r===o.player.id?o.player=Ys(o.player,99):(o.enemies=o.enemies.filter(h=>h.id!==r),o.dyingEntities=[...o.dyingEntities||[],f],o=cl(o,f.position)),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:f.position}}]);break}case"Impact":{const r=i.target,f=r===o.player.id?o.player:o.enemies.find(h=>h.id===r);if(f&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:f.position}}],i.damage>0))if(r===o.player.id)o.player=Ys(o.player,i.damage);else{const h=b=>b.id===r?Ys(b,i.damage):b;o.enemies=o.enemies.map(h).filter(b=>b.hp>0),o.companions&&(o.companions=o.companions.map(h).filter(b=>b.hp>0))}break}case"Message":{o.message=[...o.message,ef(i.text,"INFO","SYSTEM")].slice(-50),o=ul(o,{type:"MessageLogged",payload:{text:i.text}});break}case"Juice":{if(i.effect==="combat_text"&&i.text&&(o.message=kt(o.message,i.text,"VERBOSE","SYSTEM")),i.effect==="impact"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;r&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:r}}])}if(i.effect==="flash"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;r&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"flash",position:r}}])}if(i.effect==="spearTrail"&&i.path&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"spear_trail",path:i.path}}]),i.effect==="lavaSink"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;if(r){const f=o.enemies.find(h=>Q(h.position,r));f&&(o.dyingEntities=[...o.dyingEntities||[],f],o.enemies=o.enemies.filter(h=>!Q(h.position,r)),o.companions&&(o.companions=o.companions.filter(h=>!Q(h.position,r))),o=cl(o,r),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:r}}])}}break}case"UpdateComponent":{const r=(f,h,b)=>{const y=new Map(f.components||[]);return y.set(h,b),{...f,components:y}};if(i.target==="self")o.player=r(o.player,i.key,i.value);else if(i.target==="targetActor"&&a.targetId)if(a.targetId===o.player.id)o.player=r(o.player,i.key,i.value);else{const f=h=>h.id===a.targetId?r(h,i.key,i.value):h;o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f))}break}case"ModifyCooldown":{const r=h=>({...h,activeSkills:h.activeSkills?.map(b=>b.id!==i.skillId?b:{...b,currentCooldown:i.setExact?i.amount:Math.max(0,b.currentCooldown+i.amount)})}),f=a.sourceId||o.player.id;f===o.player.id?o.player=r(o.player):(o.enemies=o.enemies.map(h=>h.id===f?r(h):h),o.companions&&(o.companions=o.companions.map(h=>h.id===f?r(h):h)));break}case"SpawnCorpse":{o=cl(o,i.position);break}case"RemoveCorpse":{o=QS(o,i.position),o.dyingEntities=(o.dyingEntities||[]).filter(r=>!Q(r.position,i.position));break}case"SpawnActor":{const r=bl(i.actor);o.enemies=[...o.enemies,r],r.companionOf&&(o.companions=[...o.companions||[],r]),o.initiativeQueue&&(o.initiativeQueue=LS(o.initiativeQueue,r));break}case"PlaceFire":{const r=de(i.position);c();let f=o.tiles.get(r);f?f={...f,traits:new Set(f.traits),effects:[...f.effects]}:f={baseId:"STONE",position:i.position,traits:new Set(fo.STONE.defaultTraits),effects:[]},o.tiles.set(r,f);const h=Aa.applyEffect(f,"FIRE",i.duration,1,o,a.sourceId);h.messages.length>0&&(o.message=Ki(o.message,h.messages,"INFO","HAZARD"));break}case"PlaceTrap":{o.traps||(o.traps=[]),o.traps=[...o.traps,{position:i.position,ownerId:i.ownerId,isRevealed:!1,cooldown:0,volatileCore:i.volatileCore,chainReaction:i.chainReaction,resetCooldown:i.resetCooldown}];break}case"RemoveTrap":{o.traps&&(i.ownerId?o.traps=o.traps.filter(r=>r.ownerId!==i.ownerId):o.traps=o.traps.filter(r=>!Q(r.position,i.position)));break}case"SetTrapCooldown":{o.traps&&(o.traps=o.traps.map(r=>i.ownerId&&r.ownerId!==i.ownerId||!Q(r.position,i.position)?r:{...r,cooldown:Math.max(0,i.cooldown)}));break}case"SetStealth":{const r=f=>({...f,stealthCounter:(f.stealthCounter||0)+i.amount});i.target==="self"?o.player=r(o.player):(o.enemies=o.enemies.map(f=>f.id===i.target?r(f):f),o.companions&&(o.companions=o.companions.map(f=>f.id===i.target?r(f):f)));break}case"UpdateCompanionState":{const r=i.target==="self"?a.sourceId||o.player.id:i.target,f=h=>h.id!==r?h:{...h,companionState:{...h.companionState,mode:i.mode||h.companionState?.mode,markTarget:i.markTarget!==void 0?i.markTarget:h.companionState?.markTarget,orbitStep:i.mode==="scout"?0:h.companionState?.orbitStep,apexStrikeCooldown:i.apexStrikeCooldown!==void 0?i.apexStrikeCooldown:h.companionState?.apexStrikeCooldown,healCooldown:i.healCooldown!==void 0?i.healCooldown:h.companionState?.healCooldown}};o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f));break}case"GameOver":{o.gameStatus="lost";break}}return o},ui=(t,i,a={})=>{const o=t.stackTrace?.length||0,c=eg(t,i,{apply:(b,y)=>$d(b,y,a),describe:b=>b.type,preserveInputOrder:!0,startTick:o+1});let r=c.state,f=[...t.stackTrace||[],...c.trace];const h=gS(r);if(h.length>0){const b=eg(r,h,{apply:(y,A)=>$d(y,A,{}),describe:y=>y.type,preserveInputOrder:!0,startTick:f.length+1});r=b.state,f=[...f,...b.trace]}return{...r,stackTrace:f}},nv={id:"grapple_hook",name:"Grapple Hook",description:"Tests for grapple hook mechanics including LoS, lava sinking, and weight-based behavior",scenarios:[{id:"hook_lava_intercept",title:"Lava Interceptor & LoS",description:"Verify LoS blocking and Lava killing targets.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["lava","line-of-sight","displacement"],setup:t=>{t.setPlayer({q:4,r:6,s:-10},["GRAPPLE_HOOK"]),t.spawnEnemy("footman",{q:4,r:4,s:-8},"target1"),t.spawnEnemy("footman",{q:7,r:3,s:-10},"hidden"),t.setTile({q:6,r:4,s:-10},"wall"),t.setTile({q:4,r:5,s:-9},"lava")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:7,r:3,s:-10}),t.useSkill("GRAPPLE_HOOK",{q:4,r:4,s:-8}),t.wait(),t.wait()},verify:(t,i)=>{const a=t.player,o=t.enemies.find(r=>r.id==="target1"),c={playerInOriginalPosition:a.position.q===4&&a.position.r===6&&a.position.s===-10,target1Dead:!o,losWarning:i.some(r=>r.includes("Line of sight"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}},{id:"hook_wall_anchor_zip",title:"Heavy Zip to Wall",description:"Verify zipping to a wall and stunning nearby enemies.",relatedSkills:["GRAPPLE_HOOK"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["wall","displacement","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK"]),t.setTile({q:6,r:3,s:-9},"wall"),t.spawnEnemy("footman",{q:5,r:4,s:-9},"blocker"),t.setTile({q:6,r:6,s:-12},"wall"),t.setTile({q:5,r:6,s:-11},"lava"),t.spawnEnemy("footman",{q:6,r:5,s:-11},"stunMe"),t.spawnEnemy("footman",{q:7,r:5,s:-12},"noStun")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:6,r:3,s:-9}),t.useSkill("GRAPPLE_HOOK",{q:6,r:6,s:-12})},verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="stunMe"),o=t.enemies.find(r=>r.id==="noStun"),c={stunnedEnemy:!!(a&&a.statusEffects.some(r=>r.type==="stunned")),safeEnemy:!!(o&&!o.statusEffects.some(r=>r.type==="stunned")),zipLog:i.some(r=>r.includes("Zipped")),lavaSinkLog:i.some(r=>r.includes("Lava Sink"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Player Pos:",t.player.position),console.log("Victim Status:",a?.statusEffects)),Object.values(c).every(r=>r===!0)}}]},iv={id:"shield_throw",name:"Shield Throw",description:"Tests for shield throw mechanics including push, stun, and collision behavior",scenarios:[{id:"shield_stun_push",title:"Standard Push",description:"Verify 4-tile push in a straight line.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>t.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="victim"),o={victimAt1:a?.position.r===1,victimStunned:i?.some(c=>c.includes("stunned"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Shield Throw Failed:",o),console.log("Enemy Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"shield_unit_collision",title:"Unit Collision",description:"Verify push stops when hitting another unit.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","lava","push","environmental-kill"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim"),t.spawnEnemy("shieldbearer",{q:3,r:3,s:-6},"obstacle"),t.setTile({q:3,r:1,s:-4},"lava")},run:t=>t.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="victim"),o=t.enemies.find(r=>r.id==="obstacle"),c={victimPushed:(a?.position.r??5)===3,obstacleDead:!o};return Object.values(c).some(r=>r===!1)&&(console.log(" Shield Throw Failed:",c),console.log("Victim Pushed:",c.victimPushed),console.log("Victim Pos:",a?.position),console.log("Obstacle Dead:",c.obstacleDead),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}}]},sv={id:"auto_attack",name:"Auto Attack",description:"Tests for auto-attack passive skill including turn-start memory and friendly fire logic",scenarios:[{id:"auto_attack_persistence_stress_test",title:"Persistence: Three-Point Validation",description:"Verifies that Auto-Attack only hits units that were adjacent at BOTH start and end.",relatedSkills:["AUTO_ATTACK","BASIC_MOVE"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","spatial-memory","edge-case"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["AUTO_ATTACK","BASIC_MOVE"]),t.spawnEnemy("footman",{q:5,r:5,s:-10},"persistent_foe"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"new_neighbor"),t.spawnEnemy("footman",{q:5,r:4,s:-9},"former_neighbor"),t.state.player.previousPosition={q:4,r:5,s:-9}},run:t=>{t.move({q:4,r:6,s:-10})},verify:(t,i)=>{const a=t.enemies.find(f=>f.id==="persistent_foe"),o=t.enemies.find(f=>f.id==="new_neighbor"),c=t.enemies.find(f=>f.id==="former_neighbor"),r={persistentDead:!a||a.hp<a.maxHp,ignoredNew:o&&o.hp===o.maxHp,ignoredFormer:c&&c.hp===c.maxHp,logFound:i.some(f=>f.includes("attacked footman"))};return Object.values(r).some(f=>f===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i)),Object.values(r).every(f=>f===!0)}},{id:"enemy_auto_attack_no_friendly_fire",title:"Enemy Auto-Attack: Team Alignment",description:"Ensures enemy passives only target the player and not their own allies.",relatedSkills:["AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","alignment","friendly-fire"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},[]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"enemy_attacker");const i=t.state.enemies.find(a=>a.id==="enemy_attacker");i&&(i.activeSkills=[{id:"AUTO_ATTACK",range:1}],i.previousPosition={q:3,r:5,s:-8}),t.spawnEnemy("shieldBearer",{q:2,r:6,s:-8},"enemy_ally"),i.previousPosition={q:3,r:5,s:-8},t.state.player.previousPosition={q:3,r:6,s:-9}},run:t=>{t.wait()},verify:(t,i)=>{const a=t.player,o=t.enemies.find(r=>r.id==="enemy_ally"),c={playerHit:a.hp<a.maxHp,allySafe:o&&o.hp===o.maxHp,hitPlayerLog:i.some(r=>r.includes("attacked you")),hitAllyLog:!i.some(r=>r.includes("attacked enemy_ally"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i)),Object.values(c).every(r=>r===!0)}}]},av={id:"integration",name:"Integration Tests",description:"Multi-skill integration scenarios testing complex interactions",scenarios:[{id:"environmental_chain_reaction",title:"Environmental Chain Reaction",description:"Test complex environmental interactions with multiple hazards",relatedSkills:["GRAPPLE_HOOK","SHIELD_THROW"],category:"hazards",difficulty:"advanced",isTutorial:!1,tags:["lava","wall","environmental-kill","chain-reaction"],setup:t=>{t.setPlayer({q:5,r:4,s:-9},["GRAPPLE_HOOK","SHIELD_THROW"]),t.spawnEnemy("shieldbearer",{q:5,r:2,s:-7},"victim1"),t.spawnEnemy("footman",{q:5,r:6,s:-11},"victim2"),t.spawnEnemy("footman",{q:5,r:7,s:-12},"victim3"),t.setTile({q:5,r:8,s:-13},"lava")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:5,r:2,s:-7}),t.useSkill("SHIELD_THROW",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.player.position.q===5&&t.player.position.r===3,o=!t.enemies.find(y=>y.id==="victim3")||!!t.dyingEntities?.find(y=>y.id==="victim3"),c=!t.enemies.find(y=>y.id==="victim2")||!!t.dyingEntities?.find(y=>y.id==="victim2"),r=t.enemies.find(y=>y.id==="victim1"),f=r&&i.some(y=>y.includes("stunned")),h=r&&r.position.q===5&&r.position.r===6,b=[a,o,c,f,h];return Object.values(b).some(y=>y===!1)&&(console.log(" Environmental Chain Reaction Failed:",b),console.log("Player at 5,3:",a),console.log("Player Pos:",t.player.position),console.log("Logs found:",i),console.log("Victim1 at 5,6:",h),console.log("Victim1 Pos:",r?.position),console.log("Victim1 Stunned:",f),console.log("Victim2 Dead:",c),console.log("Victim3 Dead:",o)),Object.values(b).every(y=>y===!0)}},{id:"auto_attack_after_grapple",title:"Auto-Attack After Grapple",description:"Verify auto-attack triggers correctly after grapple displacement",relatedSkills:["GRAPPLE_HOOK","AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","displacement","integration"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK","AUTO_ATTACK"]),t.state.player.previousPosition={q:4,r:6,s:-10},t.spawnEnemy("footman",{q:7,r:6,s:-13},"grappleHookTarget"),t.spawnEnemy("footman",{q:3,r:5,s:-8},"safe"),t.spawnEnemy("footman",{q:4,r:5,s:-9},"auto-attacked"),t.spawnEnemy("footman",{q:5,r:5,s:-10},"safe2")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:7,r:6,s:-13})},verify:(t,i)=>{const a=t.enemies.find(h=>h.id==="grappleHookTarget"),o=t.enemies.find(h=>h.id==="auto-attacked"),c=t.enemies.find(h=>h.id==="safe"),r=t.enemies.find(h=>h.id==="safe2"),f={targetPulled:!!(a&&a.position.q<7),targetNotHit:!!(a&&a.hp===a.maxHp),safeNotHit:!!(c&&c.hp===c.maxHp),safe2NotHit:!!(r&&r.hp===r.maxHp),autoattackedDead:!o||o.hp<=0};return Object.values(f).some(h=>h===!1)&&(console.log(" Scenario Failed Details:",f),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i),console.log("target Pos:",a?.position.q),console.log("target Pulled:",f.targetPulled),console.log("target Not Hit:",f.targetNotHit),console.log("safe Not Hit:",f.safeNotHit),console.log("safe2 Not Hit:",f.safe2NotHit),console.log("autoattacked Dead:",f.autoattackedDead)),Object.values(f).every(h=>h===!0)}}]},ov="modulepreload",lv=function(t){return"/Hop/"+t},sg={},rv=function(i,a,o){let c=Promise.resolve();if(a&&a.length>0){let y=function(A){return Promise.all(A.map(v=>Promise.resolve(v).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};var f=y;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),b=h?.nonce||h?.getAttribute("nonce");c=y(a.map(A=>{if(A=lv(A),A in sg)return;sg[A]=!0;const v=A.endsWith(".css"),x=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${A}"]${x}`))return;const _=document.createElement("link");if(_.rel=v?"stylesheet":ov,v||(_.as="script"),_.crossOrigin="",_.href=A,b&&_.setAttribute("nonce",b),document.head.appendChild(_),v)return new Promise((p,g)=>{_.addEventListener("load",p),_.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${A}`)))})}))}function r(h){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=h,window.dispatchEvent(b),!b.defaultPrevented)throw h}return c.then(h=>{for(const b of h||[])b.status==="rejected"&&r(b.reason);return i().catch(r)})},cv=async(t,i)=>{if(typeof window>"u")try{(await rv(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])).appendFileSync(t,i)}catch(a){console.warn(`Failed to persist log to ${t}:`,a)}},uv={id:"basic_attack",name:"Basic Attack",description:"Tests for basic melee attack mechanics including range and move-to-attack logic",scenarios:[{id:"basic_attack_player_mechanics",title:"Player Basic Attack: Range & Bump",description:"Validates range enforcement, turn accounting, and bump-attack redirection.",relatedSkills:["BASIC_ATTACK"],category:"combat",tags:["melee","targeting","bump-attack"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BASIC_ATTACK"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim"),t.spawnEnemy("footman",{q:3,r:4,s:-7},"far_victim")},run:t=>{t.useSkill("BASIC_ATTACK",{q:3,r:4,s:-7}),t.move({q:3,r:5,s:-8})},verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="adj_victim"),o=t.enemies.find(r=>r.id==="far_victim"),c={farStaysAlive:o&&o.hp===o.maxHp,rangeError:i.some(r=>r.includes("out of range")),adjTookDamage:!a||a.hp<=a.maxHp,playerPositionHeld:Q(t.player.position,{q:3,r:6,s:-9}),oneTurnConsumed:t.turnsSpent===1};if(Object.values(c).some(r=>r===!1)){const r=` Basic Attack Failed: ${JSON.stringify(c)}
Current Player Pos: ${JSON.stringify(t.player.position)}
Logs: ${JSON.stringify(i)}
`;console.log(r),cv("integration_debug.txt",r)}return Object.values(c).every(r=>r===!0)}}]},dv={id:"spear_throw",name:"Spear Throw",description:"Tests for spear throw mechanics including range, LoS, and spear retrieval",scenarios:[{id:"spear_kill",title:"Spear Kill",description:"Throw spear to kill an enemy and verify item spawn.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["projectile","combat","item-spawn"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),t.spawnEnemy("footman",{q:3,r:4,s:-7},"target"),t.state.hasSpear=!0},run:t=>{t.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(t,i)=>{const a=!t.enemies.find(r=>r.id==="target"),o=!!t.spearPosition&&t.spearPosition.q===3&&t.spearPosition.r===4,c=i.some(r=>r.includes("Spear killed"));return a&&o&&c}},{id:"spear_miss_spawn",title:"Spear Rejects Empty Tile",description:"Enemy-only contract: empty tiles are invalid targets and do not spawn spear.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","item-spawn"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),t.state.hasSpear=!0},run:t=>{t.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(t,i)=>{const a=i.some(c=>c.includes("No enemy at target.")),o=t.hasSpear===!0&&!t.spearPosition;return a&&o}},{id:"spear_wall_block",title:"Spear Wall Block",description:"Spear throw is blocked by walls.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["projectile","wall","boundary"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["SPEAR_THROW"]),t.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),t.setTile({q:4,r:4,s:-8},"wall"),t.state.hasSpear=!0},run:t=>{t.useSkill("SPEAR_THROW",{q:4,r:3,s:-7})},verify:(t,i)=>{const a=i.some(r=>r.includes("No clear line of sight to enemy.")),o=!!t.enemies.find(r=>r.id==="target"),c=t.hasSpear===!0&&!t.spearPosition;return a&&o&&c}}]},fv={id:"dash",name:"Dash",description:"Tests for dash mechanics including path validation and shield-based enemy shunting",scenarios:[{id:"dash_shunt_lava",title:"Shunt into Lava",description:"Shunt an enemy into lava for an environmental kill.",relatedSkills:["DASH"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["lava","push","environmental-kill"],setup:t=>{t.setPlayer({q:3,r:5,s:-8},["DASH"]),t.spawnEnemy("footman",{q:5,r:5,s:-10},"victim"),t.setTile({q:7,r:5,s:-12},"lava"),t.state.hasShield=!0},run:t=>{t.useSkill("DASH",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="victim"),o={playerPosition:t.player.position.q===5&&t.player.position.r===5,victimDead:!a};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Shunt Lava Failed:",o),console.log("Final State:",t.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"dash_comprehensive_validation",title:"Dash: Constraints & Shunt Physics",description:"Validates range limits, wall blocking, and Shield Shunt displacement in one sequence.",relatedSkills:["DASH"],category:"movement",difficulty:"advanced",isTutorial:!1,tags:["stress-test","collision","range"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["DASH"]),t.state.hasShield=!0,t.setTile({q:4,r:4,s:-8},"wall"),t.setTile({q:6,r:5,s:-11},"wall"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"victim")},run:t=>{t.useSkill("DASH",{q:4,r:7,s:-11}),t.useSkill("DASH",{q:7,r:4,s:-11}),t.useSkill("DASH",{q:6,r:6,s:-12}),t.useSkill("DASH",{q:4,r:5,s:-9})},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="victim"),o={finalPositionCorrect:t.player.position.q===4&&t.player.position.r===6,victimPushed:!!(a&&a.position.q===4&&a.position.r===5),wallErrorFound:i.some(c=>c.includes("wall blocks")),axialRangeErrorFound:i.some(c=>c.includes("Axial only!")),shuntSuccess:i.some(c=>c.includes("Shield Shunt")),twoTurnSpent:t.turnsSpent===2};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Stress Test Failed:",o),console.log("Final State:",t.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},mv={id:"jump",name:"Jump",description:"Tests for jump mechanics including range validation and stunning landing",scenarios:[{id:"jump_basic",title:"Basic Jump",description:"Jump to a tile.",relatedSkills:["JUMP"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","leap"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["JUMP"]),t.setTile({q:3,r:5,s:-8},"lava")},run:t=>{t.useSkill("JUMP",{q:3,r:4,s:-7})},verify:(t,i)=>{const a=Q(t.player.position,{q:3,r:4,s:-7}),o=Hd(t.occupancyMask,{q:3,r:4}),c=!Hd(t.occupancyMask,{q:3,r:6}),r={playerInPosition:a,spatialMaskRefreshed:o&&c,noLavaDamage:t.player.hp===t.player.maxHp,jumpedSuccessfully:i.some(f=>f.includes("Jumped"))};return Object.values(r).some(f=>f===!1)&&(console.error(" Jump Basic Failed:",r),console.error("Final State:",t.player.position),console.error("Logs:",i)),Object.values(r).every(f=>f===!0)}},{id:"jump_stunning_landing",title:"Stunning Landing",description:"Jump into a group of enemies and ensure neighbors are stunned.",relatedSkills:["JUMP"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["movement","stun","aoe"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["JUMP"]),t.addUpgrade("JUMP","STUNNING_LANDING"),t.spawnEnemy("footman",{q:3,r:7,s:-10},"neighbor_1"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"neighbor_2"),t.spawnEnemy("footman",{q:3,r:5,s:-8},"distant_enemy")},run:t=>{t.useSkill("JUMP",{q:3,r:8,s:-11})},verify:(t,i,a=[])=>{const o={n1StunnedMessage:i.some(c=>c.includes("stunned by landing impact")),hasShakeJuice:a.some(c=>c.type==="shake"),hasStunBurstVFX:a.some(c=>c.type==="vfx"&&c.payload.type==="stunBurst"),hasStunnedCombatText:a.some(c=>c.type==="combat_text"&&c.payload.text==="STUNNED"),playerAtTarget:Q(t.player.position,{q:3,r:8,s:-11}),oneTurnSpent:t.turnsSpent===1};return Object.values(o).some(c=>c===!1)&&(console.error(" Jump Stunning Landing Failed:",o),console.error("Final State:",t.player.position),console.error("turnsSpent:",t.turnsSpent),console.error("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},pv={id:"shield_bash",name:"Shield Bash",description:"Tests for shield bash mechanics including push, stun, and collision behavior",scenarios:[{id:"bash_push",title:"Shield Push",description:"Push an enemy into lava.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","lava"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),t.setTile({q:3,r:4,s:-7},"lava"),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>{t.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(t,i)=>{const a={enemyGone:t.enemies.length===0,messageOk:i.some(o=>o.includes("Lava"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i)),Object.values(a).every(o=>o===!0)}},{id:"bash_wall_stun",title:"Wall Slam Stun",description:"Bash enemy into wall to cause a stun.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","wall","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),t.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"victim"),t.setTile({q:3,r:4,s:-7},"wall")},run:t=>{t.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="victim");if(!a)return!1;const o=Q(a.position,{q:3,r:5,s:-8}),c=i.some(r=>r.includes("into obstacle"));return o&&c}}]},hv={id:"bulwark_charge",name:"Bulwark Charge",description:"Tests for bulwark charge mechanics including chain pushing and wall slamming",scenarios:[{id:"chain_stun",title:"The Chain-Stun",description:"Wall prevents chain movement, causing all members to be stunned.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["chain","wall","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),t.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),t.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),t.setTile({q:3,r:3,s:-6},"wall"),t.state.hasShield=!0},run:t=>{t.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(t,i)=>!0},{id:"bulwark_chain_push",title:"Bulwark Chain Push",description:"Push a chain of enemies successfully.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["chain","push","displacement"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"A"),t.spawnEnemy("footman",{q:3,r:4,s:-7},"B"),t.state.hasShield=!0},run:t=>{t.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(t,i)=>!0}]},gv={id:"vault",name:"Vault",description:"Tests for vault mechanics including state-shifting behavior between odd and even turns",scenarios:[{id:"vault_shift_stun",title:"Vault Stun (Odd Turn)",description:"Verify vault stuns neighbors on Turn 1.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","stun","movement"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.setTile({q:3,r:5,s:-8},"lava"),t.spawnEnemy("footman",{q:4,r:4,s:-8},"victim")},run:t=>{t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>{const a={stunned:i.some(o=>o.includes("Stun Vault executed!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Stun Failed:",a),console.log("Logs:",i)),Object.values(a).every(o=>o===!0)}},{id:"vault_shift_normal",title:"Vault Normal (Even Turn)",description:"Verify vault is normal on Turn 2.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","movement"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.setTile({q:3,r:5,s:-8},"lava"),t.spawnEnemy("footman",{q:4,r:3,s:-7},"victim")},run:t=>{t.wait(),t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>{const a={vaulted:i.some(o=>o.includes("Vaulted!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Normal Failed:",a),console.log("Logs:",i)),Object.values(a).every(o=>o===!0)}}]},yv={id:"basic_move",name:"Basic Move",description:"Fundamental movement mechanics",scenarios:[{id:"walk_to_tile",title:"Movement 101",description:"Move your character from the center to an adjacent tile.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","basics"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),t.setTile({q:4,r:6,s:-10},"wall")},run:t=>{t.move({q:4,r:6,s:-10}),t.move({q:4,r:4,s:-8})},verify:(t,i)=>{const a={positionCorrect:Q(t.player.position,{q:4,r:4,s:-8}),logFound:i.some(o=>o.includes("blocked")),oneTurnSpent:t.turnsSpent===1};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Final Position:",t.player.position),console.log("Logs found:",i)),Object.values(a).every(o=>o===!0)}},{id:"free_move_out_of_combat",title:"Exploration Mode",description:"Verify that movement range expands only when no enemies are present.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["movement","exploration","free-move"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE","BASIC_ATTACK"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim")},run:t=>{t.move({q:7,r:1,s:-8}),t.useSkill("BASIC_ATTACK",{q:3,r:5,s:-8}),t.move({q:7,r:1,s:-8})},verify:(t,i)=>{const a=i.filter(r=>r.toLowerCase().includes("out of reach")).length,o=i.some(r=>r.toLowerCase().includes("you attacked")),c={wasBlockedInitially:a===1,attackLogs:o,reachedDistantHex:Q(t.player.position,{q:7,r:1,s:-8})};return Object.values(c).some(r=>r===!1)&&(console.log(" Free Move Scenario Failed:",c),console.log("Final Position:",t.player.position),console.log("Logs found:",i)),Object.values(c).every(r=>r===!0)}},{id:"invalid_enemy_move_intent_is_rejected_pre_execution",title:"Move Intent Rejected Before Execution",description:"Enemy AI may decide to move, but execution must not run a skill the actor does not own.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["movement","validation","intent"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:7,r:5,s:-12},"attacker_without_move");const i=t.getEnemy("attacker_without_move");i&&(i.activeSkills=(i.activeSkills||[]).filter(a=>a.id!=="BASIC_MOVE"))},run:t=>{t.wait()},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="attacker_without_move"),o={enemyDidNotMove:!!a&&Q(a.position,{q:7,r:5,s:-12}),noMissingSkillRuntimeError:!i.some(c=>c.includes("does not have skill BASIC_MOVE"))};return Object.values(o).some(c=>c===!1)&&(console.log("Invalid Enemy Move Intent Rejection Failed:",o),console.log("Enemy:",a),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"single_enemy_single_action_per_turn",title:"Single Action Per Actor Turn",description:"Each actor resolves exactly one action per turn in normal flow.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["turn-loop","movement","integrity"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:7,r:5,s:-12},"single_actor")},run:t=>{t.wait()},verify:(t,i)=>{const a={q:7,r:5,s:-12},o=t.enemies.find(f=>f.id==="single_actor"),c=o?_e(a,o.position):-1,r={enemyExists:!!o,movedExactlyOneTile:c===1,noZeroEffectMoveWarning:!i.some(f=>f.includes("produced ZERO effects"))};return Object.values(r).some(f=>f===!1)&&(console.log("Single Action Per Actor Turn Failed:",r),console.log("Enemy:",o),console.log("Logs:",i)),Object.values(r).every(f=>f===!0)}}]},$s=t=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},SENTINEL_TELEGRAPH:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Telegraph",description:"Marks blast zone."},SENTINEL_BLAST:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Blast",description:"Massive area blast."}}[t]||{slot:"offensive",range:1,cooldown:0,name:t,description:t};return{id:t,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},bv={id:"sentinel_blast",name:"Sentinel Blast",description:"Sentinel unique area-of-effect attack",scenarios:[{id:"blast_aoe",title:"Blast Away",description:"Use Sentinel Blast to hit multiple enemies.",relatedSkills:["SENTINEL_BLAST"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["aoe","damage","sentinel"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SENTINEL_BLAST"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"center"),t.spawnEnemy("footman",{q:4,r:4,s:-8},"side")},run:t=>{t.useSkill("SENTINEL_BLAST",{q:3,r:5,s:-8})},verify:(t,i)=>i.some(a=>a.includes("massive blast"))},{id:"sentinel_playlist_two_turn_timing",title:"Playlist: Telegraph then Execute",description:"Boss uses a 2-turn skill playlist: telegraph first, blast on next turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["boss","playlist","telegraph"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=t.getEnemy("boss");i&&(i.activeSkills=[$s("BASIC_MOVE"),$s("BASIC_ATTACK"),$s("SENTINEL_TELEGRAPH"),$s("SENTINEL_BLAST")])},run:t=>{t.wait(),t.logs.push(`HP_AFTER_TELEGRAPH=${t.state.player.hp}`),t.wait()},verify:(t,i)=>{const a=i.find(r=>r.startsWith("HP_AFTER_TELEGRAPH=")),o=a?Number(a.split("=")[1]):-1,c={telegraphEmitted:i.some(r=>r.includes("marks the impact zone")),executeEmitted:i.some(r=>r.includes("massive blast")),noDamageOnTelegraphTurn:o===t.player.maxHp,damageOnExecuteTurn:t.player.hp<t.player.maxHp};return Object.values(c).some(r=>r===!1)&&(console.log("Sentinel Playlist Timing Failed:",c),console.log("Logs:",i),console.log("Player HP:",t.player.hp,"/",t.player.maxHp)),Object.values(c).every(r=>r===!0)}},{id:"sentinel_playlist_interruption_by_stun",title:"Playlist: Interruption Cancels Execute",description:"Stunning the boss during telegraph cancels the follow-up execute turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["boss","playlist","interruption","stun"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=t.getEnemy("boss");i&&(i.activeSkills=[$s("BASIC_MOVE"),$s("BASIC_ATTACK"),$s("SENTINEL_TELEGRAPH"),$s("SENTINEL_BLAST")])},run:t=>{t.wait(),t.applyStatus("boss","stunned",1),t.wait()},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="boss"),o={telegraphEmitted:i.some(c=>c.includes("marks the impact zone")),executeCancelled:!i.some(c=>c.includes("massive blast")),playerUnharmed:t.player.hp===t.player.maxHp,bossStillExists:!!a};return Object.values(o).some(c=>c===!1)&&(console.log("Sentinel Playlist Interruption Failed:",o),console.log("Logs:",i),console.log("Player HP:",t.player.hp,"/",t.player.maxHp),console.log("Boss:",a)),Object.values(o).every(c=>c===!0)}}]},Sv={id:"fireball",name:"Fireball",description:"Validates axial targeting, AoE damage, and environmental fire placement.",scenarios:[{id:"fireball_axial_aoe",title:"Axial Alignment & AoE Spread",description:"Verify the skill only fires axially and damages all neighbors at the impact site.",relatedSkills:["FIREBALL"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["aoe","axial","fire"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["FIREBALL"]),t.spawnEnemy("footman",{q:5,r:4,s:-9},"primary_target"),t.spawnEnemy("footman",{q:6,r:4,s:-10},"neighbor_target"),t.spawnEnemy("footman",{q:6,r:5,s:-11},"diagonal_enemy"),t.setTile({q:6,r:3,s:-9},"wall"),t.setTile({q:6,r:6,s:-12},"wall"),t.setTile({q:5,r:6,s:-11},"lava")},run:t=>{t.useSkill("FIREBALL",{q:7,r:5,s:-12}),t.useSkill("FIREBALL",{q:5,r:4,s:-9})},verify:()=>!0},{id:"fireball_max_range_edge",title:"Max Range & Fire Duration",description:"Verify fireball at exactly range 3 and check fire duration persistence.",relatedSkills:["FIREBALL"],category:"balancing",difficulty:"intermediate",isTutorial:!1,tags:["range","persistence"],setup:t=>{t.setPlayer({q:0,r:0,s:0},["FIREBALL"]),t.setTile({q:0,r:3,s:-3},"grass")},run:t=>{t.useSkill("FIREBALL",{q:0,r:3,s:-3}),t.wait(),t.wait()},verify:()=>!0}]},vv={id:"hazards_v1",name:"Hazard Consolidation",description:"Verifies centralized hazard logic and flight immunity",scenarios:[{id:"Jump Over Lava",title:"Jump Over Lava",description:"Jumping over lava should not result in damage.",relatedSkills:["JUMP"],category:"hazards",tags:["lava","jump"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["JUMP"]),t.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:t=>{t.useSkill("JUMP",{q:4,r:7,s:-11})},verify:t=>{const i=t.player,a={playerPos:Q(i.position,{q:4,r:7,s:-11}),isAlive:i.hp===i.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Walk Into Lava",title:"Walk Into Lava",description:"Walking into lava should be invalid unless the mover is hazard-safe.",relatedSkills:["BASIC_MOVE"],category:"hazards",tags:["lava","walk"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["BASIC_MOVE"]),t.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:t=>{t.useSkill("BASIC_MOVE",{q:4,r:8,s:-12})},verify:t=>{const i=t.player,a={playerPos:Q(i.position,{q:4,r:9,s:-13}),hpUnchanged:i.hp===i.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Falcon Flying Over Lava",title:"Falcon Flying Over Lava",description:"Flying units (Falcon) should ignore lava during transit and stay.",relatedSkills:["FALCON_COMMAND"],category:"hazards",tags:["lava","falcon","flight"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),t.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:t=>{t.wait()},verify:t=>{const i=t.enemies.find(o=>o.id==="my-falcon"),a={falconExists:!!i,falconAlive:(i?.hp||0)>0,falconPos:Q(i?.position,{q:4,r:8,s:-12})};return Object.values(a).every(o=>o===!0)}}]},xv={id:"falcon_command_v2",name:"Falcon's Command",description:"Validates Predator/Scout mode transitions and spatial orbit logic.",scenarios:[{id:"falcon_predator_strike_path",title:"Predator Mode: Apex Strike Geometry",description:`
                Tests the Falcon's flight path from its current position to the Target.
                Layout:
                   (F)  <- Falcon Start (6, 5, -11)
                      .
                         (T) <- Target/Prey (8, 5, -13)
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.spawnFalcon({q:3,r:9,s:-12},"my-falcon"),t.spawnEnemy("footman",{q:4,r:2,s:-6},"prey")},run:t=>{t.useSkill("FALCON_COMMAND",{q:4,r:2,s:-6}),t.wait()},verify:(t,i)=>{const a=t.companions?.find(r=>r.id==="my-falcon"),o=t.enemies.find(r=>r.id==="prey"),c={modeSet:a?.companionState?.mode==="predator",targetLocked:a?.companionState?.markTarget==="prey",movedCloser:a&&_e(a.position,{q:4,r:2,s:-6})<7,preyHealthy:o?.hp===o?.maxHp,turnSpent:t.turnsSpent===2};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Falcon Predator Strike Failed:",c),console.log("Falcon:",a)),Object.values(c).every(r=>r===!0)}},{id:"falcon_scout_orbit",title:"Scout Mode: Hex Ring Orbit",description:`
                Ensures that in Scout mode, the Falcon rotates around the mark 
                on the flat-top hex ring.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.spawnFalcon({q:3,r:9,s:-12},"my-falcon")},run:t=>{t.useSkill("FALCON_COMMAND",{q:3,r:6,s:-9}),t.wait(),t.wait()},verify:(t,i)=>{const a=t.companions?.find(r=>r.id==="my-falcon"),o={q:3,r:6,s:-9},c={isScout:a?.companionState?.mode==="scout",onOrbitRing:a&&_e(a.position,o)===1,hasRotated:a&&!!a.previousPosition&&!Q(a.position,a.previousPosition),turnSpent:t.turnsSpent===3};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Falcon Scout Orbit Failed:",c),console.log("Falcon:",a)),Object.values(c).every(r=>r===!0)}},{id:"falcon_roost_mode",title:"Roost Mode: Return and Heal",description:`
                Ensures that when targeting self, the Falcon returns to the Hunter
                and provides a heal on arrival.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","roost","heal"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.state.player.hp=2,t.spawnFalcon({q:3,r:6,s:-9},"my-falcon")},run:t=>{t.useSkill("FALCON_COMMAND",{q:4,r:9,s:-13}),t.wait(),t.wait()},verify:(t,i)=>{const a=t.companions?.find(r=>r.id==="my-falcon"),o=t.player,c={modeRoost:a?.companionState?.mode==="roost",healed:o.hp>2,closeToHunter:a&&_e(a.position,o.position)<=1};return Object.values(c).some(r=>r===!1)&&console.log(" Scenario Falcon Roost Heal Failed:",c),Object.values(c).every(r=>r===!0)}},{id:"falcon_predator_auto_return",title:"Predator Mode: Auto-Roost on Kill",description:`
                Ensures that if a marked predator target dies, the Falcon
                automatically reverts to Roost mode.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!0,tags:["falcon","predator","cleanup"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.state.player.hp=1,t.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"prey")},run:t=>{t.useSkill("FALCON_COMMAND",{q:4,r:7,s:-11}),t.wait(),t.wait(),t.wait()},verify:(t,i)=>{const a=t.companions?.find(f=>f.id==="my-falcon"),o=t.enemies.find(f=>f.id==="prey"),c=t.player,r={preyDead:!o,autoRoost:a?.companionState?.mode==="roost",healed:c.hp>1};return Object.values(r).some(f=>f===!1),Object.values(r).every(f=>f===!0)}},{id:"falcon_command_metadata_null_safety",title:"Command Metadata Null-Safety",description:`
                Ensures FALCON_COMMAND name/description resolution is safe
                when player context is remapped in harness-like states.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["falcon","null-safety","metadata"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.state.player.id="hunter_remapped"},run:t=>{t.wait()},verify:(t,i)=>{const a={playerIdRemapped:t.player.id==="hunter_remapped",noRuntimeReferenceError:!i.some(o=>o.toLowerCase().includes("cannot read properties"))};return Object.values(a).some(o=>o===!1)&&console.log("Falcon Command Metadata Null-Safety Failed:",a),Object.values(a).every(o=>o===!0)}}]},Av={id:"kinetic_tri_trap",name:"Kinetic Tri-Trap",description:"Tests for trap deployment and fling mechanics",scenarios:[{id:"tri_trap_basic_deployment",title:"Trap Deployment",description:"Deploy 3 traps on axial tiles at range 2.",relatedSkills:["KINETIC_TRI_TRAP"],category:"deployment",difficulty:"beginner",isTutorial:!0,tags:["trap","deployment"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),t.state.player.archetype="HUNTER"},run:t=>{t.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.player.position,o=t.traps||[],c={countIsThree:o.length===3,isAtRangeTwo:o.every(r=>_e(r.position,a)===2),isAxialToPlayer:o.every(r=>r.position.q===a.q||r.position.r===a.r||r.position.s===a.s),trapsHidden:o.every(r=>!r.isRevealed)};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Tri-Trap Deployment Failed:",c),console.log("Traps:",t.traps),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}},{id:"tri_trap_state_tracking",title:"Trap State Tracking",description:"Traps are tracked with correct owner and hidden state.",relatedSkills:["KINETIC_TRI_TRAP"],category:"state",difficulty:"intermediate",isTutorial:!1,tags:["trap","state"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),t.state.player.archetype="HUNTER"},run:t=>{t.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10}),t.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.traps,o={trapsExist:a&&a.length>0,allHidden:a?.every(c=>!c.isRevealed)??!1,allZeroCooldown:a?.every(c=>c.cooldown===0)??!1,deployMessage:i.some(c=>c.includes("trap")||c.includes("Trap")),trapsCount:a?.length===3};return Object.values(o).some(c=>c===!1)&&(console.log(" Trap State Failed:",o),console.log("Traps:",t.traps)),Object.values(o).every(c=>c===!0)}}]},Tv={id:"withdrawal",name:"Withdrawal",description:"Tests for shot + backroll mechanics and passive reaction",scenarios:[{id:"withdrawal_basic",title:"Shot and Backroll",description:"Shoot adjacent enemy and backroll to safety.",relatedSkills:["WITHDRAWAL"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["shot","backroll","displacement"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),t.state.player.archetype="HUNTER",t.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:t=>{t.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="target"),o={enemyDamagedOrDead:!a||a.hp<a.maxHp,playerMoved:t.player.position.q!==5||t.player.position.r!==5,playerBackrolled:t.player.position.q<5,shotFired:i.some(c=>c.includes("Withdrawal")||c.includes("shot"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Withdrawal Failed:",o),console.log("Player:",t.player.position),console.log("Target HP:",a?.hp)),Object.values(o).every(c=>c===!0)}},{id:"withdrawal_wall_block",title:"Backroll Blocked by Wall",description:"Backroll finds alternate safe spot when wall blocks retreat.",relatedSkills:["WITHDRAWAL"],category:"collision",difficulty:"intermediate",isTutorial:!1,tags:["backroll","wall","pathfinding"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),t.state.player.archetype="HUNTER",t.setTile({q:4,r:5,s:-9},"wall"),t.setTile({q:3,r:5,s:-8},"wall"),t.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:t=>{t.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(t,i)=>{const a={playerNotOnWall:!Q(t.player.position,{q:4,r:5,s:-9}),playerMoved:t.player.position.q!==5||t.player.position.r!==5};return Object.values(a).some(o=>o===!1)&&(console.log(" Wall Block Failed:",a),console.log("Player:",t.player.position)),Object.values(a).every(o=>o===!0)}}]},Ev={id:"absorb_fire",name:"Absorb Fire Passive",description:"Verifies that fire damage is converted to healing.",scenarios:[{id:"Absorb Fire Damage",title:"Stand on Fire",description:"Player with Absorb Fire should be healed when standing on fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",tags:["fire","healing"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE"]),t.state.player.hp=1,t.setTile({q:4,r:5,s:-9},"stone");const i={q:4,r:5,s:-9},a=t.getTileAt(i);a&&a.effects.push({id:"FIRE",duration:3,potency:1})},run:t=>{t.wait()},verify:t=>{const i=t.player;return i.hp<=1&&console.log("Stand on Fire Failed: HP did not increase",i.hp),i.hp>1}},{id:"Absorb Lava Damage",title:"Walk into Lava",description:"Player with Absorb Fire should be healed when walking into lava.",relatedSkills:["ABSORB_FIRE","BASIC_MOVE"],category:"passive",tags:["lava","healing"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE","BASIC_MOVE"]),t.state.player.hp=1,t.setTile({q:4,r:6,s:-10},"lava")},run:t=>{t.useSkill("BASIC_MOVE",{q:4,r:6,s:-10})},verify:t=>{const i=t.player,a={alive:i.hp>0,healed:i.hp===i.maxHp,onLava:Q(i.position,{q:4,r:6,s:-10})};return(!a.alive||!a.healed||!a.onLava)&&(console.log("Walk into Lava Failed:",a,"HP:",i.hp,"MaxHP:",i.maxHp),console.log("Player Pos:",i.position)),Object.values(a).every(o=>o===!0)}}]},_v={id:"tile_interactions",name:"Tile Interactions",description:"Verifies interactions with special tiles like Shrines and Stairs.",scenarios:[{id:"shrine_interaction",title:"Shrine Interaction",description:"Moving onto a shrine should trigger an upgrade choice.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["shrine","upgrade"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),t.state.shrinePosition={q:4,r:6,s:-10},t.state.tiles.set("4,6",{baseId:"SHRINE",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","SHRINE"]),effects:[]})},run:t=>{t.move({q:4,r:6,s:-10})},verify:t=>{const i={playerOnShrine:Q(t.player.position,{q:4,r:6,s:-10}),isChoosingUpgrade:t.pendingStatus?.status==="choosing_upgrade",hasOptions:t.pendingStatus?.shrineOptions?.length>0};return Object.values(i).every(a=>a===!0)}},{id:"stairs_interaction",title:"Stairs Interaction",description:"Moving onto stairs should trigger level transition.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["stairs","portal"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),t.state.stairsPosition={q:4,r:6,s:-10},t.state.tiles.set("4,6",{baseId:"STAIRS",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","STAIRS"]),effects:[]})},run:t=>{t.move({q:4,r:6,s:-10})},verify:t=>{const i={playerOnStairs:Q(t.player.position,{q:4,r:6,s:-10}),isTransitioning:t.pendingStatus?.status==="playing"||t.pendingStatus?.status==="won",messageFound:t.message.some(a=>a.includes("Descending")||a.includes("Cleared"))};return Object.values(i).every(a=>a===!0)}}]},wv={id:"telegraph_projection",name:"Telegraph Projection",description:"Deterministic intent previews for next-turn danger tiles.",scenarios:[{id:"telegraph_projection_is_deterministic",title:"Projection Determinism",description:"Same state should always produce the same danger projection.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","determinism"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:7,r:5,s:-12},"threat")},run:t=>{t.wait()},verify:t=>{const i=t.intentPreview,a=i?.dangerTiles||[],o=i?.projections||[],c=a.map(A=>`${A.q},${A.r},${A.s}`),r=new Set(c),f=c.every((A,v)=>v===0||c[v-1].localeCompare(A)<=0),h=o.map(A=>`${A.actorId}|${A.skillId}|${A.targetHex?`${A.targetHex.q},${A.targetHex.r},${A.targetHex.s}`:"none"}`),b=h.every((A,v)=>v===0||h[v-1].localeCompare(A)<=0),y={hasEnginePreview:!!i,noDuplicateTiles:r.size===c.length,tilesAreSorted:f,projectionsAreSorted:b};return Object.values(y).some(A=>A===!1)&&(console.log("Telegraph Projection Determinism Failed:",y),console.log("Engine Preview:",i)),Object.values(y).every(A=>A===!0)}},{id:"telegraph_projection_matches_execute_footprint",title:"Projection Matches Execute Footprint",description:"Projected danger tiles should include the tile actually damaged on execution.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","parity","combat"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:4,r:2,s:-6},"threat")},run:t=>{t.wait();const o=t.state.intentPreview?.projections?.find(c=>c.actorId==="threat")?.dangerTiles?.[0];o?t.logs.push(`PREVIEW_TILE=${o.q},${o.r},${o.s}`):t.logs.push("PREVIEW_TILE=none"),t.wait()},verify:(t,i)=>{const a=t.enemies.find(h=>h.id==="threat"),c=i.find(h=>h.startsWith("PREVIEW_TILE="))?.split("=")[1]||"none",r=c==="none"?void 0:(()=>{const[h,b,y]=c.split(",").map(A=>Number(A));return{q:h,r:b,s:y}})(),f={previewProducedTile:!!r,projectedTileMatchesExecute:!!r&&!!a&&Q(a.position,r)};return Object.values(f).some(h=>h===!1)&&(console.log("Telegraph Projection Parity Failed:",f),console.log("Logs:",i),console.log("Player HP:",t.player.hp,"/",t.player.maxHp)),Object.values(f).every(h=>h===!0)}}]},_d=t=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},DASH:{slot:"passive",range:4,cooldown:0,name:"Kinetic Dash",description:"Dash in a straight line."}}[t]||{slot:"offensive",range:1,cooldown:0,name:t,description:t};return{id:t,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},Mv={id:"raider_dash",name:"Raider Dash",description:"Parity checks for enemy Raider reusing the player DASH contract.",scenarios:[{id:"player_dash_stops_before_adjacent_enemy",title:"Parity Baseline: Player Dash Stops Before Blocker",description:"Player DASH should stop on the tile before an occupied target.",relatedSkills:["DASH"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["parity","dash","reuse"],setup:t=>{t.setPlayer({q:4,r:2,s:-6},["DASH"]),t.spawnEnemy("footman",{q:4,r:6,s:-10},"blocker"),t.state.hasShield=!1},run:t=>{t.useSkill("DASH",{q:4,r:6,s:-10})},verify:(t,i)=>{const a={playerStoppedBeforeBlocker:t.player.position.q===4&&t.player.position.r===5,dashResolved:i.some(o=>o.includes("Stopped by an obstacle")||o.includes("Dashed!")||o.includes("Shield Shunt"))};return Object.values(a).every(o=>o===!0)}},{id:"raider_ai_uses_dash_with_player_contract",title:"Parity: Raider Uses Same Dash Stop Rule",description:"Raider AI selects DASH and lands on the same stop tile as player-owned DASH in mirrored geometry.",relatedSkills:["DASH"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","dash"],setup:t=>{t.setPlayer({q:4,r:6,s:-10},[]),t.spawnEnemy("raider",{q:4,r:2,s:-6},"raider"),t.state.hasShield=!1;const i=t.getEnemy("raider");i&&(i.activeSkills=[_d("BASIC_MOVE"),_d("BASIC_ATTACK"),_d("DASH")])},run:t=>{t.wait()},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="raider"),o={raiderStillAlive:!!a,raiderStoppedBeforePlayer:!!a&&a.position.q===4&&a.position.r===5,playerUnharmed:t.player.hp===t.player.maxHp,dashResolved:i.some(c=>c.includes("Stopped by an obstacle")||c.includes("Dashed!")||c.includes("Shield Shunt"))};return Object.values(o).every(c=>c===!0)}}]},wd=t=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},GRAPPLE_HOOK:{slot:"offensive",range:4,cooldown:0,name:"Grapple Hook",description:"Pull and swap with target."}}[t]||{slot:"offensive",range:1,cooldown:0,name:t,description:t};return{id:t,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},Ov={id:"pouncer_hook",name:"Pouncer Hook",description:"Second archetype reuse: enemy uses player GRAPPLE_HOOK via normal skill execution.",scenarios:[{id:"pouncer_uses_grapple_hook_deterministically",title:"Pouncer Uses Grapple Hook Through Skill Pipeline",description:"Pouncer selects GRAPPLE_HOOK from AI and resolves via standard USE_SKILL execution.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","determinism"],setup:t=>{t.setPlayer({q:4,r:6,s:-10},[]),t.spawnEnemy("pouncer",{q:4,r:2,s:-6},"pouncer");const i=t.getEnemy("pouncer");i&&(i.activeSkills=[wd("BASIC_MOVE"),wd("BASIC_ATTACK"),wd("GRAPPLE_HOOK")])},run:t=>{t.wait()},verify:(t,i)=>{const o={pouncerStillAlive:!!t.enemies.find(c=>c.id==="pouncer"),grappleExecuted:i.filter(c=>c.includes("Vaulted and Flung!")).length>=1,deterministicStatus:i.filter(c=>c.includes("You are stunned!")).length===1,noZeroEffectWarning:!i.some(c=>c.includes("produced ZERO effects"))};return Object.values(o).every(c=>c===!0)}}]},Cv={id:"ice",name:"Ice Terrain",description:"ICE/SLIPPERY terrain behavior for pass-through momentum and landing slide.",scenarios:[{id:"ice_pass_preserves_dash_momentum",title:"Ice Pass: Dash Carries Momentum",description:"Passing through ICE during DASH should preserve momentum and carry movement beyond nominal target.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","ice","momentum","pass"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["DASH"]),t.state.hasShield=!1,t.setTile({q:5,r:4,s:-9},"slippery"),t.setTile({q:6,r:4,s:-10},"floor"),t.setTile({q:7,r:4,s:-11},"floor")},run:t=>{t.useSkill("DASH",{q:6,r:4,s:-10})},verify:t=>t.player.position.q>6},{id:"ice_land_slides_after_basic_move",title:"Ice Land: Basic Move Slides Forward",description:"Landing on ICE with BASIC_MOVE should slide one hex in the move direction when the next tile is walkable.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["terrain","ice","slide","land"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["BASIC_MOVE"]),t.setTile({q:5,r:4,s:-9},"slippery"),t.setTile({q:6,r:4,s:-10},"floor")},run:t=>{t.move({q:5,r:4,s:-9})},verify:t=>t.player.position.q===6&&t.player.position.r===4}]},Nv={id:"snare",name:"Snare Terrain",description:"Snare tile effect movement restriction and status interaction.",scenarios:[{id:"snare_interrupts_dash_and_roots_actor",title:"Snare Interrupts Dash",description:"DASH into a snare tile should halt movement at snare and apply rooted status.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","snare","movement-restriction"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["DASH"]),t.state.hasShield=!1,t.state.tiles.set("5,4",{baseId:"STONE",position:{q:5,r:4,s:-9},traits:new Set(["WALKABLE"]),effects:[{id:"SNARE",duration:-1,potency:1}]}),t.setTile({q:6,r:4,s:-10},"floor"),t.setTile({q:7,r:4,s:-11},"floor")},run:t=>{t.useSkill("DASH",{q:7,r:4,s:-11})},verify:(t,i)=>{const a=t.player.statusEffects.some(c=>c.type==="rooted"),o={stoppedAtSnare:t.player.position.q===5&&t.player.position.r===4,rootedApplied:a,snareMessageLogged:i.some(c=>c.includes("Snared! Movement halted."))};return Object.values(o).every(c=>c===!0)}}]},Rv={id:"relics",name:"Relics",description:"Passive relic behaviors using existing engine hooks only.",scenarios:[{id:"relic_ember_ward_reduces_fire_damage",title:"Relic: Ember Ward",description:"Equipping Ember Ward reduces incoming fire damage by 1.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"beginner",isTutorial:!1,tags:["relic","fire","passive"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.upgrades=[...t.state.upgrades||[],"RELIC_EMBER_WARD"],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:(t,i)=>{const a={hpUnchanged:t.player.hp===t.player.maxHp,relicMessageSeen:i.some(o=>o.includes("Ember Ward dampens the flames."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_cinder_orb_stacks_with_absorb_fire",title:"Relic: Cinder Orb Stacking",description:"Cinder Orb adds bonus healing when fire damage is converted by Absorb Fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",difficulty:"advanced",isTutorial:!1,tags:["relic","stacking","absorb-fire"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["ABSORB_FIRE"]),t.state.player={...t.state.player,hp:1,maxHp:3},t.state.upgrades=[...t.state.upgrades||[],"RELIC_CINDER_ORB"],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:(t,i)=>{const a={healedByStacking:t.player.hp===3,stackingMessageSeen:i.some(o=>o.includes("Cinder Orb amplifies the absorption."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_steady_plates_end_to_end",title:"Relic: Steady Plates",description:"Steady Plates grants turn-start armor that resolves against incoming damage in the same round.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"intermediate",isTutorial:!1,tags:["relic","armor","turn-start"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.upgrades=[...t.state.upgrades||[],"RELIC_STEADY_PLATES"],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:(t,i)=>{const a={playerHpProtected:t.player.hp===t.player.maxHp,damageEventOccurred:i.some(o=>o.includes("player burns!")),armorPresentAfterCycle:t.player.temporaryArmor>=0&&t.player.temporaryArmor<=2,relicTriggerMessageSeen:i.some(o=>o.includes("Steady Plates harden your stance."))};return Object.values(a).every(o=>o===!0)}}]},kv=250,Lv=700,Iv=100,Bv=8,jv=220,Dv=260,Hv=40,ay=(t,i)=>{const a=t.floor||0,o=t.player?.hp||0,c=t.turnsSpent??t.turnNumber??0,r=t.kills||0,f=t.environmentalKills||0,h=t.hazardBreaches||0,b=(i||[]).filter(y=>y.success).length*kv;return a*Lv+o*Iv+r*jv+f*Dv-c*Bv-h*Hv+b},Pv=t=>{if(typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const i=t instanceof Date?t:new Date,a=i.getFullYear(),o=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0");return`${a}-${o}-${c}`},Uv=t=>`daily:${t}`,qv=t=>{const i=18+Math.floor(oc(t,0)*8);return[{id:"TURN_LIMIT",label:`Finish within ${i} turns`,target:i},{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}]},tc=t=>(t.runObjectives||[]).map(a=>{if(a.id==="TURN_LIMIT"){const c=t.turnsSpent||0;return{...a,value:c,success:c<=a.target}}const o=t.hazardBreaches||0;return{...a,value:o,success:o<=a.target}}),Sl=t=>{const i=t.initialSeed??t.rngSeed??"0",a=tc(t),o=t.combatScoreEvents||[],c=o.length?Number((o.reduce((f,h)=>f+h.efficiency,0)/o.length).toFixed(4)):0,r=o.filter(f=>f.riskBonusApplied).length;return{seed:i,actionLog:t.actionLog,score:ay(t,a),floor:t.floor,objectives:a,combatTelemetry:{events:o.length,avgEfficiency:c,riskBonusEvents:r}}},zv={id:"objectives",name:"Objectives",description:"Daily objective validation for turn-limit and hazard constraints.",scenarios:[{id:"objective_turn_limit_boundary",title:"Objective: Turn Limit Boundary",description:"Turn-limit objective passes at boundary and fails above boundary.",relatedSkills:["BASIC_MOVE"],category:"progression",difficulty:"intermediate",isTutorial:!1,tags:["objective","turn-limit"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.runObjectives=[{id:"TURN_LIMIT",label:"Finish within 1 turns",target:1}]},run:t=>{t.wait()},verify:t=>{const a=tc(t)[0]?.success===!0,o=Sl(t).score,c=tc({...t,turnsSpent:(t.turnsSpent||0)+1}),r={...t,turnsSpent:(t.turnsSpent||0)+1},f=Sl(r).score,h=c[0]?.success===!1,b=f<o;return a&&h&&b}},{id:"objective_hazard_constraint_fail_on_hazard",title:"Objective: Hazard Constraint",description:"Hazard objective fails after prohibited hazard interaction.",relatedSkills:["BASIC_MOVE"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["objective","hazard"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.runObjectives=[{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:t=>{const i=tc(t)[0];return(t.hazardBreaches||0)>0&&!!i&&i.success===!1}}]},$v={id:"necromancer",name:"Necromancer",description:"Corpse persistence and summon migration contracts.",scenarios:[{id:"necromancer_corpse_persistence",title:"Corpse Persists Until Consumed",description:"Kill an enemy, wait 5 turns, then Raise Dead succeeds from corpse tile trait.",relatedSkills:["BASIC_ATTACK","RAISE_DEAD"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","corpse","persistence"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["BASIC_ATTACK","RAISE_DEAD"],"VANGUARD"),t.spawnEnemy("footman",{q:5,r:4,s:-9},"dummy");const i=t.getEnemy("dummy");i&&(i.hp=1,i.maxHp=1)},run:t=>{const i={q:5,r:4,s:-9};t.useSkill("BASIC_ATTACK",i);for(let a=0;a<5;a++)t.wait();t.useSkill("RAISE_DEAD",i)},verify:t=>{const i=de({q:5,r:4}),a=t.tiles.get(i),o=t.enemies.find(h=>h.subtype==="skeleton"&&h.factionId==="player"),c=t.companions?.find(h=>h.id===o?.id),r=new Set((o?.activeSkills||[]).map(h=>h.id)),f={corpseConsumed:!a?.traits?.has("CORPSE"),skeletonRaised:!!o,skeletonOnCorpseTile:!!o&&o.position.q===5&&o.position.r===4,companionRegistered:!!c,hasBasicLoadout:r.has("BASIC_MOVE")&&r.has("BASIC_ATTACK")};return Object.values(f).every(Boolean)}},{id:"summon_floor_transition",title:"Summon Persists Across Floor Transition",description:"Raised skeleton migrates with player to floor 2.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","summon","floor-transition"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:4,s:-9},a=de(i),o=t.getTileAt(i);t.state.tiles.set(a,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])})},run:t=>{const i={q:5,r:4,s:-9};t.useSkill("RAISE_DEAD",i),t.state.player={...t.state.player,position:{...t.state.stairsPosition}},t.wait(),t.dispatchSync({type:"RESOLVE_PENDING"})},verify:t=>{const i=t.enemies.find(o=>o.subtype==="skeleton"&&o.factionId==="player"&&o.companionOf===t.player.id),a={floorAdvanced:t.floor===2,summonStillPresent:!!i,summonTracksOwner:!!i&&i.companionOf===t.player.id};return Object.values(a).every(Boolean)}},{id:"companion_does_not_block_free_move",title:"Companion Does Not Block Exploration Free Move",description:"Friendly skeleton companion should not count as hostile for BASIC_MOVE exploration range.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","companion","movement"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"],"VANGUARD"),t.spawnEnemy("footman",{q:5,r:5,s:-10},"friendly_skeleton");const i=t.getEnemy("friendly_skeleton");i&&(i.subtype="skeleton",i.factionId="player",i.companionOf=t.state.player.id,i.activeSkills=i.activeSkills||[],t.state.companions=[...t.state.companions||[],i])},run:t=>{t.move({q:7,r:1,s:-8})},verify:t=>{const i={movedFar:t.player.position.q===7&&t.player.position.r===1,turnsAdvanced:t.turnsSpent>=1};return Object.values(i).every(Boolean)}},{id:"raise_dead_pushes_ally_from_target_hex",title:"Raise Dead Pushes Ally Occupant",description:"If corpse tile is occupied by an ally, ally is displaced and summon succeeds without overlap.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","occupancy","push"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:5,s:-10},a=de(i),o=t.getTileAt(i);t.state.tiles.set(a,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])}),t.spawnEnemy("footman",i,"ally_blocker");const c=t.getEnemy("ally_blocker");c&&(c.subtype="skeleton",c.factionId="player",c.companionOf=t.state.player.id,t.state.companions=[...t.state.companions||[],c])},run:t=>{t.useSkill("RAISE_DEAD",{q:5,r:5,s:-10})},verify:t=>{const i=t.enemies.filter(h=>h.subtype==="skeleton"&&h.factionId==="player"),a=new Set;let o=!1;i.forEach(h=>{const b=de(h.position);a.has(b)&&(o=!0),a.add(b)});const c=i.some(h=>h.position.q===5&&h.position.r===5),r=i.some(h=>h.id==="ally_blocker"&&!(h.position.q===5&&h.position.r===5));return Object.values({raisedAtCorpse:c,pushedExists:r,noOverlap:!o}).every(Boolean)}}]};function Vv(t){return{id:t.id,title:t.title,description:t.description,rationale:t.rationale,setup:t.setup,run:t.run,verify:t.verify}}const Yv=[nv,iv,sv,av,uv,dv,fv,mv,pv,hv,gv,vv,yv,bv,Sv,xv,Av,Tv,Ev,_v,wv,Mv,Ov,Cv,Nv,Rv,zv,$v],Kv=Yv.flatMap(t=>t.scenarios);function Fv(t){return Kv.filter(i=>i.relatedSkills.includes(t))}function vt(t){return Fv(t).map(Vv)}const oy={id:"AUTO_ATTACK",name:"Auto Attack",description:"Automatically strike adjacent enemies that started the turn adjacent to you.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(t,i,a,o=[],c)=>{const r=[],f=[];let h=0;const b=(t.timelineEvents||[]).some(_=>_.phase==="STATUS_APPLY"&&_.type==="ApplyStatus"&&_.payload?.status==="stunned"&&(_.payload?.target===i.id||typeof _.payload?.target=="object"&&_.payload?.target&&Q(_.payload.target,i.position)));if(ji(i)||b)return{effects:r,messages:f,kills:0};const y=at(i.position);let A=1;o.includes("HEAVY_HANDS")&&(A+=1);const v=c?.persistentTargetIds||[],x=c?.previousNeighbors||[];if(v.length===0&&x.length===0)return{effects:r,messages:f,kills:0};for(const _ of y){const p=Ae(t,_);if(!p||p.hp<=0||p.id===i.id||i.factionId===p.factionId)continue;if(v.length>0?v.includes(p.id):x.some(N=>Q(N,_))){const N=on({attackerId:i.id,targetId:p.id,skillId:"AUTO_ATTACK",basePower:A,trinity:Xe(i),targetTrinity:Xe(p),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});r.push({type:"Damage",target:_,amount:N.finalPower,scoreEvent:N.scoreEvent});const I=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,M=p.factionId==="player"?"you":`${p.subtype||"enemy"}#${p.id}`;f.push(`${I} attacked ${M}!`),p.hp<=A&&h++}}if(o.includes("CLEAVE")&&r.length>0)for(const _ of y){if(r.some(w=>w.type==="Damage"&&typeof w.target=="object"&&"q"in w.target&&Q(w.target,_)))continue;const g=Ae(t,_);if(!g||g.id===i.id||!(i.factionId!==g.factionId))continue;const I=on({attackerId:i.id,targetId:g.id,skillId:"AUTO_ATTACK",basePower:A,trinity:Xe(i),targetTrinity:Xe(g),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});r.push({type:"Damage",target:_,amount:I.finalPower,scoreEvent:I.scoreEvent});const M=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,E=g.factionId==="player"?"you":`${g.subtype||"enemy"}#${g.id}`;f.push(`${M} cleaved ${E}!`),g.hp<=A&&h++}return{effects:r,messages:f,kills:h}},upgrades:{HEAVY_HANDS:{id:"HEAVY_HANDS",name:"Heavy Hands",description:"Auto-attack damage +1"},CLEAVE:{id:"CLEAVE",name:"Cleave",description:"When auto-attack triggers, hit ALL adjacent enemies"}},scenarios:vt("AUTO_ATTACK")},Gv=(t,i,a,o,c,r)=>{if(!i.activeSkills?.some(x=>x.id==="AUTO_ATTACK"))return{state:t,kills:0,messages:[]};const b=i.activeSkills?.find(x=>x.id==="AUTO_ATTACK")?.activeUpgrades||[],y=new Map;if(t.initiativeQueue)for(const x of t.initiativeQueue.entries)x.turnStartPosition&&y.set(x.actorId,x.turnStartPosition);const A=oy.execute(t,i,void 0,b,{previousNeighbors:a,attackerTurnStartPosition:o,allActorsTurnStartPositions:y,persistentTargetIds:c});return{state:ui(t,A.effects,{sourceId:i.id,targetId:void 0,stepId:r}),kills:A.kills||0,messages:A.messages}},Ie={shake:(t,i)=>({type:"Juice",effect:"shake",intensity:t,direction:i}),flash:t=>({type:"Juice",effect:"flash",intensity:"high",color:t}),freeze:(t=80)=>({type:"Juice",effect:"freeze",duration:t}),combatText:(t,i,a)=>({type:"Juice",effect:"combat_text",text:t,target:i,color:a}),momentumTrail:(t,i)=>({type:"Juice",effect:"momentumTrail",path:t,intensity:i}),heavyImpact:(t,i)=>({type:"Juice",effect:"heavyImpact",target:t,direction:i,intensity:"extreme"}),lightImpact:t=>({type:"Juice",effect:"lightImpact",target:t,intensity:"low"}),kineticWave:(t,i,a)=>({type:"Juice",effect:"kineticWave",target:t,direction:i,intensity:a}),stunBurst:t=>({type:"Juice",effect:"stunBurst",target:t,intensity:"medium"}),lavaRipple:t=>({type:"Juice",effect:"lavaRipple",target:t,intensity:"medium"}),wallCrack:(t,i)=>({type:"Juice",effect:"wallCrack",target:t,direction:i,intensity:"high"}),explosionRing:t=>({type:"Juice",effect:"explosion_ring",target:t})},$t={GRAPPLE_HOOK:{anticipation:(t,i)=>[{type:"Juice",effect:"aimingLaser",target:t,path:[t,i],intensity:"low",color:"#00ff88"}],execution:t=>[{type:"Juice",effect:"hookCable",path:t,intensity:"medium",duration:200,color:"#00ff88"},Ie.shake("low")],impact:(t,i)=>[{type:"Juice",effect:"grappleHookWinch",target:t,direction:i,intensity:"high",duration:150},Ie.shake("medium",i)],resolution:(t,i)=>[Ie.momentumTrail(t,i>6?"high":"medium"),Ie.kineticWave(t[0],t[t.length-1],"high")]},SHIELD_THROW:{anticipation:(t,i)=>[{type:"Juice",effect:"trajectory",target:t,path:[t,i],intensity:"medium",color:"#4169e1"}],execution:t=>[{type:"Juice",effect:"shieldArc",path:t,intensity:"high",duration:300,metadata:{rotation:720}},{type:"Juice",effect:"shieldSpin",path:t,intensity:"medium"}],impact:(t,i)=>[Ie.heavyImpact(t,i),Ie.shake("high",i),Ie.freeze(120),Ie.combatText("IMPACT!",t,"#ff4444")],resolution:t=>[Ie.kineticWave(t[0],t[t.length-1],"high"),Ie.momentumTrail(t,"high")]},DASH:{anticipation:(t,i)=>[{type:"Juice",effect:"chargeUp",target:t,direction:i,intensity:"medium",duration:100}],execution:t=>[{type:"Juice",effect:"dashBlur",path:t,intensity:"high",duration:150},Ie.momentumTrail(t,"medium")],impact:(t,i,a)=>a?[Ie.heavyImpact(t,i),Ie.shake("extreme",i),Ie.freeze(100),Ie.combatText("SHUNT!",t,"#ffaa00")]:[Ie.lightImpact(t)],resolution:t=>t?[Ie.kineticWave(t[0],t[t.length-1],"high"),Ie.momentumTrail(t,"high")]:[]},SPEAR_THROW:{anticipation:(t,i)=>[{type:"Juice",effect:"aimingLaser",target:t,path:[t,i],intensity:"low",color:"#ff6b6b"}],execution:t=>[{type:"Juice",effect:"spearTrail",path:t,intensity:"high",duration:150},{type:"Juice",effect:"spearWhistle",path:t,intensity:"medium",metadata:{pitch:"rising"}}],impact:(t,i)=>i?[Ie.heavyImpact(t),Ie.shake("medium"),Ie.freeze(60),Ie.combatText("LETHAL",t,"#ff0000")]:[Ie.lightImpact(t),Ie.combatText("MISS",t,"#888888")],resolution:()=>[]},VAULT:{anticipation:(t,i)=>[{type:"Juice",effect:"trajectory",target:t,path:[t,i],intensity:"low",color:"#00ddff",metadata:{arc:"high"}}],execution:t=>[{type:"Juice",effect:"vaultLeap",path:t,intensity:"medium",duration:250,metadata:{arc:"parabolic"}}],impact:(t,i)=>i?[Ie.heavyImpact(t),Ie.shake("medium"),Ie.stunBurst(t),Ie.combatText("STUN!",t,"#ffff00")]:[Ie.lightImpact(t)],resolution:()=>[]}},Md={lavaSink:t=>[{type:"Juice",effect:"lavaSink",target:t,intensity:"extreme",duration:500,metadata:{particleCount:50}},Ie.lavaRipple(t),Ie.shake("high"),Ie.combatText("CONSUMED",t,"#ff4400")],wallImpact:(t,i,a)=>{const o=[Ie.wallCrack(t,i),Ie.shake("high",i)];return a&&(o.push(Ie.stunBurst(t)),o.push(Ie.combatText("STUNNED",t,"#ffaa00"))),o},voidConsume:t=>[{type:"Juice",effect:"voidConsume",target:t,intensity:"extreme",duration:800,color:"#000000"},Ie.freeze(150),Ie.combatText("VOID",t,"#8800ff")]};function dc(t,i){const{origin:a,direction:o,momentum:c}=i,r=[];r.push(Ie.kineticWave(a,o,c>6?"high":"medium"));const f=jn(a,{q:o.q*(c+10),r:o.r*(c+10),s:o.s*(c+10)}),h=Lt(a,f);let b=c,y=Wv(t,h);for(;b>0&&y.length>0;){const A=Xv(y);if(A.length===0)break;const v=A.length;if(b<v){const M=A[A.length-1],E=b;b=0;const w=[h[M.pos1D]];for(let D=0;D<E;D++){const H=M.pos1D+1,C=h[H];if(!C||!Ws(C,t.gridWidth,t.gridHeight)||ag(t,C)){r.push({type:"Impact",target:M.id,damage:E-D,direction:o});break}if(M.pos1D=H,w.push(C),og(t,C)){r.push({type:"LavaSink",target:M.id}),r.push(...Md.lavaSink(C));break}}w.length>1&&(r.push({type:"Displacement",target:M.id,destination:w[w.length-1],path:w,animationDuration:w.length*80}),r.push(Ie.momentumTrail(w,"medium")));break}const x=A[A.length-1],_=x.pos1D+1,p=h[_];if(!p||!Ws(p,t.gridWidth,t.gridHeight)||ag(t,p)){r.push({type:"ApplyStatus",target:x.id,status:"stunned",duration:1}),p&&r.push(...Md.wallImpact(p,o,!0));break}const g=new Map;for(const M of A){const E=h[M.pos1D];M.pos1D+=1;const w=h[M.pos1D];g.set(M.id,[E,w])}const N=[...A].reverse();for(const M of N){const E=g.get(M.id);E&&r.push({type:"Displacement",target:M.id,destination:E[E.length-1],path:E,ignoreCollision:!0,animationDuration:150})}const I=Array.from(g.values()).flat();I.length>0&&r.push(Ie.momentumTrail(I,v>2?"high":"medium")),b-=v;for(let M=y.length-1;M>=0;M--){const E=y[M],w=h[E.pos1D];og(t,w)&&(r.push({type:"LavaSink",target:E.id}),r.push(...Md.lavaSink(w)),y.splice(M,1))}if(b>0){const M=A[A.length-1];y=y.filter(w=>w.pos1D>=M.pos1D);const E=y.filter(w=>w.pos1D>M.pos1D);y=[M,...E]}}return r}function Wv(t,i){const a=[],o=[t.player,...t.enemies];for(const c of o){const r=i.findIndex(f=>Q(f,c.position));r!==-1&&a.push({id:c.id,pos1D:r})}return a.sort((c,r)=>c.pos1D-r.pos1D)}function Xv(t){if(t.length===0)return[];const i=[];let a=t[0];i.push(a);for(let o=1;o<t.length;o++){const c=t[o];if(c.pos1D===a.pos1D||c.pos1D===a.pos1D+1)i.push(c),a=c;else break}return i}function ag(t,i){const a=Pe.getTraitsAt(t,i);return a.has("BLOCKS_MOVEMENT")||a.has("BLOCKS_LOS")}function og(t,i){const a=Pe.getTraitsAt(t,i);return a.has("HAZARDOUS")||a.has("LIQUID")}function Qv(t,i,a,o){const c=_e(i.position,a);if(c<=1)return[];const r=Fs(a,i.position),f=Nn(r);return dc(t,{origin:a,direction:f,momentum:Math.min(o,c-1)})}function Jv(t,i){return[{type:"Displacement",target:t.id,destination:i.position},{type:"Displacement",target:i.id,destination:t.position}]}function Zv(t,i,a,o){return dc(t,{origin:i,direction:a,momentum:o})}function Ti(t,i){const a=t.tiles.get(de(i));return!!(a?.traits.has("BLOCKS_LOS")||a?.baseId==="WALL")}function Oa(t,i){const a=t.tiles.get(de(i));return a?.baseId==="LAVA"||a?.traits.has("LIQUID")||!1}function Xs(t,i,a){const o=Ae(t,i);return!!o&&o.id!==a}function ln(t,i,a){const o=_e(t,i);return o>=1&&o<=a}function Fi(t,i){const a=Fs(t,i);return{isAxial:a!==-1,directionIndex:a}}function tf(t,i,a={}){const{checkWalls:o=!0,checkActors:c=!0,checkLava:r=!1,excludeActorId:f}=a;for(const h of i){if(o&&Ti(t,h))return{obstacle:"wall",position:h};if(r&&Oa(t,h))return{obstacle:"lava",position:h};if(c){const b=Ae(t,h);if(b&&b.id!==f)return{obstacle:"actor",position:h,actor:b}}}return{}}function nf(t,i,a,o={}){const r=Lt(i,a).slice(1),{stopAtWalls:f=!0,stopAtActors:h=!0,stopAtLava:b=!1,excludeActorId:y}=o,A=tf(t,r,{checkWalls:f,checkActors:h,checkLava:b,excludeActorId:y});return A.obstacle&&A.position&&!Q(A.position,a)?{isValid:!1,blockedBy:A.obstacle,blockedAt:A.position}:{isValid:!0}}function lg(t,i,a,o,c){const f=Lt(i,a).slice(1),h=tf(t,f,{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:c});return h.obstacle==="actor"&&h.actor?.id===o&&!!h.position&&Q(h.position,a)}function ex(t,i){const a=Pe.getTraitsAt(t,i),o=a.has("HAZARDOUS")||a.has("LAVA")||a.has("FIRE")||a.has("VOID"),c=a.has("LAVA")||a.has("FIRE");return{isHazard:o,isFireHazard:c}}function ys(t,i,a){const{isHazard:o,isFireHazard:c}=ex(t,a);return!!(!o||i.isFlying||(i.activeSkills?.some(f=>f.id==="ABSORB_FIRE")||i.statusEffects?.some(f=>f.type==="fire_immunity"))&&c)}function ly(t,i,a,o){return ys(t,i,a)?!0:new Set(["JUMP","VAULT","GRAPPLE_HOOK","DASH"]).has(o)}const tx={id:"GRAPPLE_HOOK",name:"Grapple Hook",description:"Pull/Zip mechanism with multi-phase kinetic resolution.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3,momentum:4},execute:(t,i,a,o=[])=>{let c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};const{directionIndex:h}=Fi(i.position,a),b=Nn(h);c.push(...$t.GRAPPLE_HOOK.anticipation(i.position,a));const{isValid:y,blockedBy:A}=nf(t,i.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!y)return r.push(`Line of sight blocked by ${A}!`),{effects:c,messages:r,consumesTurn:!1};const v=a,x=Ae(t,v),_=Pe.getTraitsAt(t,v),g=_.has("BLOCKS_MOVEMENT")||_.has("ANCHOR")?"Heavy":x?.weightClass||"Standard";if(g==="Heavy"||g==="Anchored"){const N=Dd(v,b);c.push(...$t.GRAPPLE_HOOK.execution(Lt(i.position,N))),c.push({type:"Displacement",target:i.id,destination:N,ignoreGroundHazards:!0});const I=Pe.getTileAt(t,N);if(I){const E=Aa.processEntry(i,I,t);c.push(...E.effects),r.push(...E.messages)}const M=at(N);for(const E of M){const w=Ae(t,E);w&&w.id!==i.id&&(c.push({type:"Impact",target:w.id,damage:0,direction:b}),c.push({type:"ApplyStatus",target:w.id,status:"stunned",duration:2}),c.push(Ie.stunBurst(E)))}return c.push(Ie.heavyImpact(N,b)),c.push(Ie.shake("high",b)),r.push("Zipped to anchor!"),{effects:c,messages:r,consumesTurn:!0}}else if(x){const N=_e(i.position,v),I=Nn((h+3)%6),M=i.position;c.push(...$t.GRAPPLE_HOOK.execution(Lt(i.position,a)));const E=Qv(t,i,v,N-1),w=ui(t,E,{sourceId:i.id,targetId:x.id}),D=w.enemies.find(oe=>oe.id===x.id)||(w.player.id===x.id?w.player:null);if(!D)return r.push(`${x.subtype||"Enemy"} neutralized during pull.`),{effects:[...c,...E],messages:r,consumesTurn:!0};const H=Jv(i,D),C=D.position;c.push(...$t.GRAPPLE_HOOK.impact(C,b));const K=ui(w,H,{sourceId:i.id,targetId:x.id}),ne=Zv(K,M,I,4),xe=Lt(M,jn(M,Jd(h,6)));return c.push(...$t.GRAPPLE_HOOK.resolution(xe,4)),{effects:[...c,...E,...H,...ne],messages:["Vaulted and Flung!"],consumesTurn:!0}}else return r.push("Hook missed."),{effects:c,messages:r,consumesTurn:!1}},getValidTargets:(t,i)=>{const a=Ae(t,i);return a?Ze.getAxialTargets(t,i,4,{includeWalls:!0,includeActors:!0,stopAtObstacles:!0}).filter(o=>{const{directionIndex:c}=Fi(i,o),r=Nn(c),f=Ae(t,o),h=Pe.getTraitsAt(t,o),y=h.has("BLOCKS_MOVEMENT")||h.has("ANCHOR")?Dd(o,r):f?o:void 0;return y?ys(t,a,y):!1}):[]},upgrades:{},scenarios:vt("GRAPPLE_HOOK")},nx={id:"SPEAR_THROW",name:t=>t.hasSpear?"Spear Throw":"Recall Spear",description:t=>t.hasSpear?"Throw your spear to instantly kill an enemy.":"Recall your spear, damaging enemies in its path.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:1},execute:(t,i,a,o=[])=>{const c=[],r=[],f=Xe(i),h=o.includes("SPEAR_RANGE"),b=o.includes("RECALL"),y=o.includes("RECALL_DAMAGE"),A=o.includes("LUNGE"),v=o.includes("LUNGE_ARC"),x=o.includes("DEEP_BREATH"),_=o.includes("SPEAR_CLEAVE")||o.includes("CLEAVE"),p=3+(h?1:0);if(t.hasSpear){if(!a)return{effects:c,messages:r,consumesTurn:!1};if(A&&_e(i.position,a)===2){const w=Ae(t,a);if(w&&w.id!==i.id){const D=on({attackerId:i.id,targetId:w.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:Xe(w),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return c.push({type:"Displacement",target:"self",destination:a,simulatePath:!0}),c.push({type:"Damage",target:w.id,amount:D.finalPower,scoreEvent:D.scoreEvent}),r.push(`Lunged and killed ${w.subtype||"enemy"} !`),v&&at(a).forEach(H=>{const C=Ae(t,H);if(C&&C.id!==i.id&&C.id!==w.id){const K=on({attackerId:i.id,targetId:C.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Xe(C),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:C.id,amount:K.finalPower,scoreEvent:K.scoreEvent})}}),x&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0}),{effects:c,messages:r}}}if(!ln(i.position,a,p))return r.push("Out of range!"),{effects:c,messages:r,consumesTurn:!1};const g=Di(t.enemies,a);if(!g)return r.push("No enemy at target."),{effects:c,messages:r,consumesTurn:!1};if(!Fi(i.position,a).isAxial)return r.push("Target must be axial."),{effects:c,messages:r,consumesTurn:!1};if(!lg(t,i.position,a,g.id,i.id))return r.push("No clear line of sight to enemy."),{effects:c,messages:r,consumesTurn:!1};c.push(...$t.SPEAR_THROW.anticipation(i.position,a));const M=a,E=g;if(c.push(...$t.SPEAR_THROW.execution(Lt(i.position,M))),E){const w=on({attackerId:i.id,targetId:E.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:Xe(E),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});c.push(...$t.SPEAR_THROW.impact(M,!0)),c.push({type:"Damage",target:E.id,amount:w.finalPower,scoreEvent:w.scoreEvent}),r.push(`Spear killed ${E.subtype||"enemy"} !`),x&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0})}else c.push(...$t.SPEAR_THROW.impact(M,!1)),r.push("Spear thrown.");c.push({type:"SpawnItem",itemType:"spear",position:M}),b&&(c.push({type:"PickupSpear",position:M}),r.push("Spear auto-retrieved."))}else{const g=t.spearPosition;if(!g)return r.push("Spear is lost!"),{effects:c,messages:r,consumesTurn:!1};const N=Lt(g,i.position);if(y&&N.forEach(I=>{const M=Di(t.enemies,I);if(M){const E=on({attackerId:i.id,targetId:M.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Xe(M),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:M.id,amount:E.finalPower,scoreEvent:E.scoreEvent}),r.push(`Spear recall hit ${M.subtype||"enemy"} !`)}}),c.push({type:"PickupSpear",position:g}),r.push("Spear recalled."),_){for(const I of at(g)){const M=Di(t.enemies,I);if(!M)continue;const E=on({attackerId:i.id,targetId:M.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Xe(M),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1}],statusMultipliers:[]});c.push({type:"Damage",target:M.id,amount:E.finalPower,scoreEvent:E.scoreEvent})}r.push("Cleave triggered on pickup.")}c.push({type:"Juice",effect:"spearTrail",path:N,intensity:"medium"})}return{effects:c,messages:r}},getValidTargets:(t,i)=>{if(!t.hasSpear)return[];const a=Ae(t,i);if(!a)return[];const r=3+(a.activeSkills?.find(h=>h.id==="SPEAR_THROW")?.activeUpgrades?.includes("SPEAR_RANGE")?1:0);return t.enemies.filter(h=>h.hp>0).filter(h=>{const b=h.position;return!Fi(i,b).isAxial||!ln(i,b,r)?!1:lg(t,i,b,h.id,a.id)}).map(h=>h.position)},upgrades:{SPEAR_RANGE:{id:"SPEAR_RANGE",name:"Extended Reach",description:"Range +1"},RECALL:{id:"RECALL",name:"Recall",description:"Spear automatically returns (handled internally if active, or via manual recall)"},RECALL_DAMAGE:{id:"RECALL_DAMAGE",name:"Returning Edge",description:"Damage enemies in path when recalling spear"},LUNGE:{id:"LUNGE",name:"Lunge",description:"If an enemy is exactly 2 hexes away, move to them and kill"},LUNGE_ARC:{id:"LUNGE_ARC",name:"Lunge Sweeping",description:"Lunge hits neighbors of the target"},DEEP_BREATH:{id:"DEEP_BREATH",name:"Deep Breath",description:"Reset Jump cooldown on spear kill"},SPEAR_CLEAVE:{id:"SPEAR_CLEAVE",name:"Cleave",description:"Damage all neighbors when picking up spear"}},scenarios:vt("SPEAR_THROW")},ix={id:"SHIELD_BASH",name:"Shield Bash",description:"Push an enemy 1 tile. If they hit a wall or another enemy, they are stunned.",slot:"defensive",icon:"",baseVariables:{range:1,cost:0,cooldown:2},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:r,consumesTurn:!1};const f=o.includes("SHIELD_RANGE"),h=o.includes("ARC_BASH"),b=o.includes("BASH_360"),y=o.includes("WALL_SLAM"),A=1+(f?1:0);if(!ln(i.position,a,A))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};let v=[];if(b)v=at(i.position);else if(h){v=[a];const g=at(a);for(const N of g)_e(N,i.position)===1&&v.length<3&&v.push(N)}else v=[a];const x=new Map;t.enemies.forEach(g=>x.set(g.id,g.position)),t.player&&x.set(t.player.id,t.player.position);const _=g=>{for(const[N,I]of Array.from(x.entries()))if(Q(I,g))return N===t.player.id?t.player:t.enemies.find(M=>M.id===N)},p=(g,N)=>{const I=_(N);if(!I||I.id===i.id)return;const M=Fs(g,N),E=Nn(M),w=jn(N,E),D=t.tiles.get(de(w)),H=D?.baseId==="WALL"||D?.traits.has("BLOCKS_MOVEMENT"),C=!Ze.isWithinBounds(t,w),K=_(w);H||C||K&&K.id!==I.id?(c.push({type:"ApplyStatus",target:I.id,status:"stunned",duration:1}),r.push(`Bashed ${I.subtype||"enemy"} into obstacle!`),c.push({type:"Juice",effect:"shake"}),K&&y&&p(N,w)):(c.push({type:"Displacement",target:I.id,destination:w,simulatePath:!0}),x.set(I.id,w),r.push(`Pushed ${I.subtype||"enemy"}!`))};for(const g of v)p(i.position,g);return{effects:c,messages:r}},getValidTargets:(t,i)=>{const a=Ae(t,i);if(!a)return[];const c=1+(a.activeSkills?.find(r=>r.id==="SHIELD_BASH")?.activeUpgrades?.includes("SHIELD_RANGE")?1:0);return Ze.getAreaTargets(t,i,c).filter(r=>{const f=Ae(t,r);return!!f&&f.id!==a.id&&f.factionId!==a.factionId})},upgrades:{SHIELD_RANGE:{id:"SHIELD_RANGE",name:"Extended Bash",description:"Range +1"},SHIELD_COOLDOWN:{id:"SHIELD_COOLDOWN",name:"Quick Recovery",description:"Cooldown -1",modifyCooldown:-1},ARC_BASH:{id:"ARC_BASH",name:"Arc Bash",description:"Bash hits 3-hex frontal arc (+1 cooldown)",modifyCooldown:1},BASH_360:{id:"BASH_360",name:"360 Bash",description:"Bash hits all neighbors (+1 cooldown)",modifyCooldown:1},PASSIVE_PROTECTION:{id:"PASSIVE_PROTECTION",name:"Passive Protection",description:"+1 temp armor when shield not on cooldown"},WALL_SLAM:{id:"WALL_SLAM",name:"Wall Slam",description:"Enemies bashed into obstacles trigger a cascade and stun"}},scenarios:vt("SHIELD_BASH")},sx={id:"JUMP",name:"Jump",description:"Leap to an empty tile within range. Can cross lava but not walls.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:r,consumesTurn:!1};const f=o.includes("JUMP_RANGE"),h=o.includes("STUNNING_LANDING"),b=o.includes("METEOR_IMPACT"),y=o.includes("FREE_JUMP"),A=2+(f?1:0);if(!ln(i.position,a,A))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};const v=Ae(t,a),x=Ti(t,a),_=ys(t,i,a);if(x)return r.push("Cannot jump into a wall!"),{effects:c,messages:r,consumesTurn:!1};if(!_)return r.push("Cannot land on hazard!"),{effects:c,messages:r,consumesTurn:!1};if(v&&!b)return r.push("Target hex is blocked!"),{effects:c,messages:r,consumesTurn:!1};if(v&&b){const p=on({attackerId:i.id,targetId:v.id,skillId:"JUMP",basePower:99,trinity:Xe(i),targetTrinity:Xe(v),damageClass:"physical",scaling:[{attribute:"body",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:v.id,amount:p.finalPower,scoreEvent:p.scoreEvent}),r.push(`Meteor Impact killed ${v.subtype||"enemy"}!`)}if(c.push({type:"Message",text:"Jumped!"}),c.push({type:"Displacement",target:"self",destination:a,ignoreCollision:!0,ignoreGroundHazards:!0,simulatePath:!0}),h){const p=at(a);let g=!1;for(const N of p){const I=Ae(t,N);I&&I.id!==i.id&&(c.push({type:"ApplyStatus",target:I.id,status:"stunned",duration:1}),g=!0)}g&&r.push("Enemies stunned by landing impact!")}return c.push({type:"Juice",effect:"shake",target:a,intensity:"medium"}),{effects:c,messages:r,consumesTurn:!y}},getValidTargets:(t,i)=>{const a=Ae(t,i);if(!a)return[];const o=a.activeSkills?.find(h=>h.id==="JUMP"),c=new Set(o?.activeUpgrades||[]),r=2+(c.has("JUMP_RANGE")?1:0),f=c.has("METEOR_IMPACT");return Ze.getAreaTargets(t,i,r).filter(h=>{if(Q(h,i)||Ti(t,h)||!ys(t,a,h))return!1;const b=Ae(t,h);return!(b&&b.id!==a.id&&!f)})},upgrades:{JUMP_RANGE:{id:"JUMP_RANGE",name:"Extended Jump",description:"Jump range +1"},JUMP_COOLDOWN:{id:"JUMP_COOLDOWN",name:"Nimble",description:"Jump cooldown -1",modifyCooldown:-1},STUNNING_LANDING:{id:"STUNNING_LANDING",name:"Stunning Landing",description:"All enemies within 1 hex of landing are stunned"},METEOR_IMPACT:{id:"METEOR_IMPACT",name:"Meteor Impact",description:"Can land on enemies to kill them"},FREE_JUMP:{id:"FREE_JUMP",name:"Free Jump",description:"Can move after jumping"}},scenarios:vt("JUMP")},ax={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Charge into an adjacent enemy, pushing a chain. Wall hard-stop stuns the chain.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(_e(i.position,a)!==1)return c.push("Target not adjacent!"),{effects:o,messages:c,consumesTurn:!1};const f=Di(t.enemies,a);if(!f)return c.push("No target!"),{effects:o,messages:c,consumesTurn:!1};const{isAxial:h,directionIndex:b}=Fi(i.position,a);if(!h)return{effects:o,messages:c,consumesTurn:!1};const y=Nn(b),A=[f];let v={q:f.position.q+y.q,r:f.position.r+y.r,s:f.position.s+y.s};for(;;){const p=Di(t.enemies,v);if(p){if(A.push(p),v={q:v.q+y.q,r:v.r+y.r,s:v.s+y.s},A.length>6)break;continue}break}const x=[];for(let p=0;p<A.length;p++){const g=A[p],N=p===0?2:1,I={q:g.position.q+y.q*N,r:g.position.r+y.r*N,s:g.position.s+y.s*N};x.push({actor:g,dest:I})}let _=!1;for(const p of x){const g=t.tiles.get(de(p.dest));if(g?.baseId==="WALL"||g?.traits.has("BLOCKS_MOVEMENT")){_=!0;break}if(t.enemies.find(I=>Q(I.position,p.dest)&&!A.some(M=>M.id===I.id))){_=!0;break}}if(_){for(const p of A)o.push({type:"ApplyStatus",target:p.position,status:"stunned",duration:1}),c.push("Chain blocked! Stunned.");return{effects:o,messages:c}}for(const p of x)o.push({type:"Displacement",target:p.actor.id,destination:p.dest});return o.push({type:"Displacement",target:"self",destination:f.position}),c.push("Bulwark Charge!"),{effects:o,messages:c}},getValidTargets:(t,i)=>[{q:i.q+1,r:i.r,s:i.s-1},{q:i.q+1,r:i.r-1,s:i.s},{q:i.q,r:i.r-1,s:i.s+1},{q:i.q-1,r:i.r,s:i.s+1},{q:i.q-1,r:i.r+1,s:i.s},{q:i.q,r:i.r+1,s:i.s-1}].filter(o=>!!Di(t.enemies,o)),upgrades:{},scenarios:[{id:"chain_stun",title:"Chain-Stun",description:"Wall prevents chain, chain gets stunned",setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),t.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),t.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),t.setTile({q:3,r:3,s:-6},"wall"),t.state.hasShield=!0},run:t=>{t.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(t,i)=>!0}]},ox={id:"BASIC_ATTACK",name:"Basic Attack",description:"Strike an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(t,i,a,o=[])=>{const c=[],r=[],f=(t.timelineEvents||[]).some(g=>g.phase==="STATUS_APPLY"&&g.type==="ApplyStatus"&&g.payload?.status==="stunned"&&(g.payload?.target===i.id||typeof g.payload?.target=="object"&&g.payload?.target&&Q(g.payload.target,i.position)));if(ji(i)||f)return r.push("Cannot attack while stunned!"),{effects:c,messages:r,consumesTurn:!0};if(!a)return r.push("Select a target!"),{effects:c,messages:r,consumesTurn:!1};if(!ln(i.position,a,1))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};const b=Ae(t,a);if(!b||b.id===i.id)return r.push("No enemy at target!"),{effects:c,messages:r,consumesTurn:!1};if(b.factionId===i.factionId)return r.push("Cannot attack friendlies!"),{effects:c,messages:r,consumesTurn:!1};if(b.subtype==="bomb")return r.push("Cannot attack a bomb!"),{effects:c,messages:r,consumesTurn:!1};let y=1;o.includes("POWER_STRIKE")&&(y+=2);const A=Q(i.previousPosition||i.position,i.position);o.includes("EXTENDED_REACH")&&A&&(y+=1);const v=on({attackerId:i.id,targetId:b.id,skillId:"BASIC_ATTACK",basePower:y,trinity:Xe(i),targetTrinity:Xe(b),damageClass:"physical",scaling:[{attribute:"body",coefficient:.5}],statusMultipliers:[],inDangerPreviewHex:!!t.intentPreview?.dangerTiles?.some(g=>Q(g,i.position)),theoreticalMaxPower:y}),x=v.finalPower;c.push({type:"Damage",target:"targetActor",amount:x,scoreEvent:v.scoreEvent});const _=i.type==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,p=b.type==="player"?"you":`${b.subtype||"enemy"}#${b.id}`;if(r.push(`${_} attacked ${p}!`),o.includes("VAMPIRIC")){const g=Math.max(0,x-(b.temporaryArmor||0));b.hp-g<=0&&(c.push({type:"Heal",target:i.id,amount:1}),r.push("Vampiric heal!"))}return{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(t,i)=>{const a=Ae(t,i);return a?at(i).filter(c=>{const r=Ae(t,c);return!!r&&r.subtype!=="bomb"&&r.id!==a.id&&r.factionId!==a.factionId}):[]},upgrades:{EXTENDED_REACH:{id:"EXTENDED_REACH",name:"Disciplined Stance",description:"+1 damage when attacking without moving first."},POWER_STRIKE:{id:"POWER_STRIKE",name:"Power Strike",description:"Damage +2"},VAMPIRIC:{id:"VAMPIRIC",name:"Vampiric",description:"Heal 1 HP on kill"}},scenarios:vt("BASIC_ATTACK")},lx={id:"SENTINEL_TELEGRAPH",name:"Sentinel Telegraph",description:"The Sentinel marks an impact zone for a delayed blast.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0},execute:(t,i,a)=>a?{effects:[{type:"Juice",effect:"combat_text",target:a,text:"TELEGRAPH"}],messages:["The Sentinel marks the impact zone."],consumesTurn:!0}:{effects:[],messages:[],consumesTurn:!0},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,3),upgrades:{},scenarios:vt("SENTINEL_TELEGRAPH")},rx={id:"SENTINEL_BLAST",name:"Sentinel Blast",description:"A massive energy surge from the Sentinel.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:2},execute:(t,i,a)=>{if(!a)return{effects:[],messages:[]};const o=Xe(i),c=Ae(t,a),r=on({attackerId:i.id,targetId:c?.id||de(a),skillId:"SENTINEL_BLAST",basePower:2,trinity:o,targetTrinity:c?Xe(c):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:[]}),f=[{type:"Damage",target:a,amount:r.finalPower,scoreEvent:r.scoreEvent},{type:"Juice",effect:"shake",intensity:"high"}];return at(a).forEach(b=>{const y=Ae(t,b),A=on({attackerId:i.id,targetId:y?.id||de(b),skillId:"SENTINEL_BLAST",basePower:1,trinity:o,targetTrinity:y?Xe(y):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.1}],statusMultipliers:[]});f.push({type:"Damage",target:b,amount:A.finalPower,scoreEvent:A.scoreEvent})}),{effects:f,messages:["The Sentinel unleashed a massive blast!"],consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,3),upgrades:{},scenarios:vt("SENTINEL_BLAST")},cx={id:"THEME_HAZARDS",name:"Theme Hazards",description:"Internal skill for testing floor themes.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0},execute:t=>({effects:[],messages:[]}),upgrades:{},scenarios:vt("THEME_HAZARDS")},ux={id:"SHIELD_THROW",name:"Shield Throw",description:"Throw your shield to strike and push enemies. Triggers a kinetic pulse on impact.",slot:"defensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!t.hasShield)return r.push("Shield not in hand!"),{effects:c,messages:r,consumesTurn:!1};c.push(...$t.SHIELD_THROW.anticipation(i.position,a));const{isValid:f,blockedBy:h,blockedAt:b}=nf(t,i.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!f&&h==="wall")return r.push("Shield hit a wall mid-flight!"),c.push({type:"SpawnItem",itemType:"shield",position:b}),{effects:c,messages:r,consumesTurn:!0};const y=Ae(t,a);if(!y)return r.push("Shield missed: No target at location."),c.push({type:"SpawnItem",itemType:"shield",position:a}),{effects:c,messages:r,consumesTurn:!0};const A=Lt(i.position,a);c.push(...$t.SHIELD_THROW.execution(A));const v=4,{directionIndex:x}=Fi(i.position,a),_=Nn(x);c.push({type:"ApplyStatus",target:y.id,status:"stunned",duration:1}),c.push(...$t.SHIELD_THROW.impact(a,_));const p=dc(t,{origin:a,direction:_,momentum:v}),g=p.filter(E=>E.type==="Displacement"&&E.target===y.id),N=g[g.length-1],I=N&&"destination"in N?N.destination:a,M=Lt(a,I);return M.length>1&&c.push(...$t.SHIELD_THROW.resolution(M)),c.push({type:"SpawnItem",itemType:"shield",position:I}),r.push("Direct hit! Shield triggered kinetic pulse."),{effects:[...c,...p],messages:r,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,4),upgrades:{},scenarios:vt("SHIELD_THROW")},dx={id:"VAULT",name:t=>t.turnNumber%2!==0?"Stun Vault":"Vault",description:t=>t.turnNumber%2!==0?"Leap to an empty tile and stun neighbors. (Odd Turn)":"Leap to an empty tile. (Even Turn)",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:0},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!ln(i.position,a,2))return r.push("Out of range!"),{effects:c,messages:r,consumesTurn:!1};if(Ti(t,a)||Xs(t,a))return r.push("Blocked!"),{effects:c,messages:r,consumesTurn:!1};if(!ys(t,i,a))return r.push("Blocked!"),{effects:c,messages:r,consumesTurn:!1};const f=t.turnNumber%2!==0;c.push(...$t.VAULT.anticipation(i.position,a));const h=Lt(i.position,a);if(c.push(...$t.VAULT.execution(h)),c.push({type:"Displacement",target:"self",destination:a,path:h,ignoreGroundHazards:!0,animationDuration:250}),f){r.push("Stun Vault executed!");const b=at(a);for(const y of b)Di(t.enemies,y)&&c.push({type:"ApplyStatus",target:y,status:"stunned",duration:1});c.push(...$t.VAULT.impact(a,!0)),r.push("Slam landing! Neighbors stunned.")}else c.push(...$t.VAULT.impact(a,!1)),r.push("Vaulted!");return{effects:c,messages:r}},getValidTargets:(t,i)=>{const o=Ae(t,i);return o?Ze.getAreaTargets(t,i,2).filter(c=>Q(c,i)?!1:!Ti(t,c)&&!Xs(t,c)&&ys(t,o,c)):[]},upgrades:{},scenarios:[{id:"vault_shift_stun",title:"Vault State-Shifting: Stun (Turn 1)",description:"Verify vault stuns on Turn 1 (Odd).",setup:t=>{t.setTurn(1),t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>{t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>i.some(a=>a.includes("Stun Vault executed!"))},{id:"vault_shift_normal",title:"Vault State-Shifting: Normal (Turn 2)",description:"Verify vault is normal on Turn 2 (Even).",setup:t=>{t.setTurn(2),t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>{t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>i.some(a=>a.includes("Vaulted!"))&&!i.some(a=>a.includes("Slam landing!"))}]},rg=(t,i)=>t.enemies.filter(o=>o.hp>0&&o.factionId==="enemy").length===0?20:Math.max(i.speed||1,1),ry=(t,i)=>Ze.isWithinBounds(t,i)?Pe.getTraitsAt(t,i).has("BLOCKS_MOVEMENT"):!0,cg=(t,i,a,o)=>{const c=new Map,r=[],f=b=>`${b.q},${b.r}`,h=[{p:a,cost:0}];for(c.set(f(a),0);h.length>0;){const b=h.shift();if(!(b.cost>=o))for(const y of at(b.p)){if(!Ze.isWithinBounds(t,y)||!Pe.isWalkable(t,y)||!ly(t,i,y,"BASIC_MOVE"))continue;const A=Ae(t,y),v=!!A&&A.id!==i.id,x=v&&A.factionId===i.factionId;if(v&&!x)continue;const _=f(y),p=b.cost+1;c.has(_)&&c.get(_)<=p||(c.set(_,p),!x&&ys(t,i,y)&&!ry(t,y)&&r.push(y),h.push({p:y,cost:p}))}}return r},fx=(t,i,a,o,c)=>{const r=_=>`${_.q},${_.r}`,f=_=>{const[p,g]=_.split(",").map(Number);return{q:p,r:g,s:-p-g}},h=[a],b=new Map([[r(a),0]]),y=new Map([[r(a),null]]);for(;h.length>0;){const _=h.shift(),p=r(_),g=b.get(p);if(!(g>=c))for(const N of at(_)){if(!Ze.isWithinBounds(t,N)||!Pe.isWalkable(t,N)||!ly(t,i,N,"BASIC_MOVE"))continue;const I=Ae(t,N),M=!!I&&I.id!==i.id,E=M&&I.factionId===i.factionId;if(M&&!E)continue;const w=r(N),D=g+1;b.has(w)&&b.get(w)<=D||(b.set(w,D),y.set(w,p),h.push(N))}}const A=r(o);if(!y.has(A)||ry(t,o)||!ys(t,i,o))return null;const v=[];let x=A;for(;x;)v.push(f(x)),x=y.get(x)||null;return v.reverse(),v},mx={id:"BASIC_MOVE",name:"Walk",description:"Move to an adjacent or nearby tile within your speed range.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=rg(t,i),h=cg(t,i,i.position,r).some(A=>Q(A,a)),b=fx(t,i,i.position,a,r);if(!h||!b||b.length<2)return c.push("Target out of reach or blocked!"),{effects:o,messages:c,consumesTurn:!1};o.push({type:"Displacement",target:"self",destination:a,source:i.position,path:b,simulatePath:!0,ignoreCollision:!0});const y=i.id===t.player.id?"You":`${i.subtype||"enemy"}#${i.id}`;return c.push(`${y} moved to (${a.q}, ${a.r}). [Range ${r}]`),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>{const a=Ae(t,i);if(!a)return[];const o=rg(t,a);return cg(t,a,i,o).filter(r=>!Xs(t,r,a.id))},upgrades:{},scenarios:vt("BASIC_MOVE")},px={id:"DASH",name:"Kinetic Dash",description:"Dash in a straight line. With a shield, slam into enemies and send them flying!",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:0},execute:(t,i,a,o=[])=>{const c=[],r=[],f=o.includes("MOMENTUM_SURGE"),h=o.includes("DASH_CHAIN_REACTION")||o.includes("CHAIN_REACTION");if(!a)return{effects:c,messages:r,consumesTurn:!1};const{isAxial:b,directionIndex:y}=Fi(i.position,a),v=t.enemies.filter(I=>I.hp>0).length===0?20:4;if(!ln(i.position,a,v))return{effects:c,messages:["Out of range!"],consumesTurn:!1};if(!b)return{effects:c,messages:["Axial only! Dash must be in a straight line."],consumesTurn:!1};c.push(...$t.DASH.anticipation(i.position,a));const x=Nn(y),_=Lt(i.position,a),p=tf(t,_.slice(1),{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:i.id});let g=a;if(p.obstacle){if(p.obstacle==="wall")return{effects:c,messages:["A wall blocks the way!"],consumesTurn:!1};if(p.obstacle==="lava")return{effects:c,messages:["Lava blocks the way!"],consumesTurn:!1};const I=_.findIndex(M=>Q(M,p.position));g=_[I-1]||i.position}if(p.obstacle==="actor"?p.actor:null){const I=Lt(i.position,g);c.push(...$t.DASH.execution(I));const M=[{type:"Displacement",target:"self",destination:g,path:I,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:I.length*60}],E=ui(t,M,{sourceId:i.id});if(t.hasShield){c.push(...$t.DASH.impact(g,x,!0));const w=5+(t.hasShield&&f?2:0)+(h?1:0),D=dc(E,{origin:g,direction:x,momentum:w});return{effects:[...c,...M,...D],messages:[...r,"Shield Shunt!"],consumesTurn:!0}}else return c.push(...$t.DASH.impact(g,x,!1)),{effects:[...c,...M],messages:[...r,"Stopped by an obstacle (Need shield to shunt)."],consumesTurn:!Q(i.position,g)}}else{const I=Lt(i.position,g);c.push(...$t.DASH.execution(I));const M={type:"Displacement",target:"self",destination:g,path:I,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:I.length*60};return{effects:[...c,M],messages:[...r,"Dashed!"],consumesTurn:!Q(i.position,g)}}},getValidTargets:(t,i)=>{const o=t.enemies.filter(r=>r.hp>0).length===0?20:4,c=Ae(t,i);return c?Ze.getAxialTargets(t,i,o,{stopAtObstacles:!0,includeActors:!0,includeWalls:!1}).filter(r=>ys(t,c,r)):[]},upgrades:{MOMENTUM_SURGE:{id:"MOMENTUM_SURGE",name:"Momentum Surge",description:"+2 Momentum when dashing with shield"},DASH_CHAIN_REACTION:{id:"DASH_CHAIN_REACTION",name:"Chain Reaction",description:"Enemies pushed into other enemies transfer momentum"}},scenarios:vt("DASH")},hx=new Set(["FIREBALL","FIREWALL","FIREWALK","ABSORB_FIRE"]),cy=(t,i)=>{const a=Pe.getTileAt(t,i),o=Pe.getTraitsForTile(t,a),c=r=>a.effects.some(f=>f.id===r);return a.baseId==="VOID"||o.has("VOID")||o.has("PIT")?"VOID_TOUCHED":a.baseId==="ICE"||c("ICE_WALL")?"FROZEN":a.baseId==="LAVA"||o.has("LAVA")||o.has("FIRE")||c("FIRE")?"MELTED":c("WET")||c("STEAM")?"SOAKED":"STABLE"},uy=(t,i)=>hx.has(t)&&i==="MELTED"?1.15:1,gx={id:"FIREBALL",name:"Fireball",description:"Launch a sphere of flame. Range 3, Axial. Deals damage and leaves fire.",slot:"offensive",icon:"",baseVariables:{range:3,cost:1,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r}=Fi(i.position,a);if(!ln(i.position,a,3)||!r)return{effects:o,messages:["Invalid target! Range 3, Axial only."],consumesTurn:!1};const f=[a,...at(a)],h=Xe(i),b=!!t.intentPreview?.dangerTiles?.some(y=>Q(y,i.position));for(const y of f){const A=Ae(t,y),v=cy(t,y),x=uy("FIREBALL",v),_=on({attackerId:i.id,targetId:A?.id||de(y),skillId:"FIREBALL",basePower:1,trinity:h,targetTrinity:A?Xe(A):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:x===1?[]:[{id:`surface_${v}`,multiplier:x}],inDangerPreviewHex:b,theoreticalMaxPower:1});o.push({type:"Damage",target:y,amount:_.finalPower,reason:"fireball",scoreEvent:_.scoreEvent}),o.push({type:"PlaceFire",position:y,duration:3})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ff4400"}),o.push({type:"Juice",effect:"shake",intensity:"medium"}),c.push("Fireball!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,3),upgrades:{},scenarios:vt("FIREBALL")},yx={id:"FIREWALL",name:"Firewall",description:"Create a wall of flames 5 tiles wide. Area denial.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:4},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r,directionIndex:f}=Fi(i.position,a);if(!r)return{effects:o,messages:["Axial targeting only!"],consumesTurn:!1};const h=(f+2)%6,b=(f+5)%6,y=[a];let A=a;for(let x=0;x<2;x++)A=jn(A,Nn(h)),Ze.isWithinBounds(t,A)&&y.push(A);let v=a;for(let x=0;x<2;x++)v=jn(v,Nn(b)),Ze.isWithinBounds(t,v)&&y.push(v);for(const x of y)if(!Ti(t,x)){o.push({type:"PlaceFire",position:x,duration:3});const _=Ae(t,x);if(_){const p=cy(t,x),g=uy("FIREWALL",p),N=on({attackerId:i.id,targetId:_.id,skillId:"FIREWALL",basePower:1,trinity:Xe(i),targetTrinity:Xe(_),damageClass:"magical",scaling:[{attribute:"mind",coefficient:.15}],statusMultipliers:g===1?[]:[{id:`surface_${p}`,multiplier:g}]});o.push({type:"Damage",target:_.id,amount:N.finalPower,reason:"firewall_impact",scoreEvent:N.scoreEvent})}}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffaa00"}),c.push("Firewall raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,4),upgrades:{},scenarios:vt("FIREWALL")},bx={id:"FIREWALK",name:"Firewalk",description:"Teleport to a fire or lava tile. Grants 2 turns of Fire Immunity.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!ln(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const r=t.tiles.get(de(a)),f=r?.effects.some(b=>b.id==="FIRE"),h=r?.baseId==="LAVA"||r?.traits.has("LIQUID");return!f&&!h?{effects:o,messages:["Can only teleport to Fire or Lava!"],consumesTurn:!1}:Xs(t,a,i.id)?{effects:o,messages:["Target position occupied!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a,source:i.position,simulatePath:!1}),o.push({type:"ApplyStatus",target:"self",status:"fire_immunity",duration:2}),o.push({type:"Juice",effect:"flash",target:a,color:"#ff8800"}),c.push("Firewalk!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(t,i)=>{const a=[];return t.tiles.forEach(o=>{const c=_e(i,o.position);if(c>0&&c<=4){const r=o.effects.some(h=>h.id==="FIRE"),f=o.baseId==="LAVA"||o.traits.has("LIQUID");(r||f)&&a.push(o.position)}}),a},upgrades:{},scenarios:vt("FIREWALK")},Sx={id:"BOMB_TOSS",name:"Bomb Toss",description:"Throw a bomb to a nearby tile.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!ln(i.position,a,3))return c.push("Out of range!"),{effects:o,messages:c,consumesTurn:!1};if(!Pe.isWalkable(t,a))return c.push("Target blocked!"),{effects:o,messages:c,consumesTurn:!1};if(Ae(t,a))return c.push("Target occupied!"),{effects:o,messages:c,consumesTurn:!1};const f=`bomb-${i.id}-${t.turnNumber}-${t.actionLog?.length??0}-${a.q}_${a.r}_${a.s}`,h=Gs({id:f,type:"enemy",subtype:"bomb",factionId:i.factionId,position:a,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return h.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.push({type:"SpawnActor",actor:h}),c.push("Bomb tossed!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>{const o=[];for(let c=-3;c<=3;c++)for(let r=Math.max(-3,-c-3);r<=Math.min(3,-c+3);r++){const f={q:i.q+c,r:i.r+r,s:i.s-c-r};ln(i,f,3)&&Pe.isWalkable(t,f)&&(Ae(t,f)||o.push(f))}return o},upgrades:{}},vx={id:"TIME_BOMB",name:"Time Bomb",description:"Detonates when the fuse reaches zero.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0,damage:1},execute:(t,i,a)=>{const o=i.statusEffects.find(h=>h.type==="time_bomb");if(o&&o.duration>1)return{effects:[],messages:[],consumesTurn:!0};const c=i.position,f=[c,...at(c)].map(h=>({type:"Damage",target:h,amount:1,reason:"bomb_explosion"}));return f.push({type:"Damage",target:i.id,amount:999,reason:"bomb_explosion"}),f.push({type:"Juice",effect:"explosion_ring",target:c,intensity:"high"}),{effects:f,messages:["A bomb exploded!"],consumesTurn:!0}},getValidTargets:(t,i)=>[i],upgrades:{}},xx=(t,i)=>!!t.tiles.get(de(i))?.traits?.has("CORPSE"),Ax=(t,i,a)=>{const o=[];return t.tiles.forEach(c=>{c.traits.has("CORPSE")&&_e(i,c.position)<=a&&o.push(c.position)}),o},Tx={id:"CORPSE_EXPLOSION",name:"Corpse Explosion",description:"Detonate a target corpse, dealing damage in a 1-tile radius.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!xx(t,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!ln(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};o.push({type:"RemoveCorpse",position:a});const f=[a,...at(a)],h=Xe(i),b=!!t.intentPreview?.dangerTiles?.some(y=>Q(y,i.position));for(const y of f){const A=Ae(t,y),v=on({attackerId:i.id,targetId:A?.id||de(y),skillId:"CORPSE_EXPLOSION",basePower:2,trinity:h,targetTrinity:A?Xe(A):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.25}],statusMultipliers:[],inDangerPreviewHex:b,theoreticalMaxPower:2});o.push({type:"Damage",target:y,amount:v.finalPower,reason:"corpse_explosion",scoreEvent:v.scoreEvent})}return o.push({type:"Juice",effect:"explosion_ring",target:a}),o.push({type:"Juice",effect:"shake",intensity:"high"}),o.push({type:"Juice",effect:"combat_text",target:a,text:"BOOM!"}),c.push("Corpse exploded!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Ax(t,i,4),upgrades:{},scenarios:vt("CORPSE_EXPLOSION")},Ex=(t,i)=>i.q>=0&&i.q<t.gridWidth&&i.r>=0&&i.r<t.gridHeight,_x=(t,i,a)=>at(a).filter(c=>Ex(t,c)).filter(c=>Pe.isWalkable(t,c)).filter(c=>!Ae(t,c)).sort((c,r)=>{const f=_e(c,i.position),h=_e(r,i.position);return f!==h?f-h:c.q!==r.q?c.q-r.q:c.r-r.r})[0]||null,wx=(t,i)=>i.id!==t.id&&i.factionId===t.factionId;function ug(t,i,a,o="fail"){const c=Ae(t,a);if(!c)return{ok:!0,spawnPosition:a,effects:[],messages:[]};if(o==="push_friendly"){if(!wx(i,c))return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."};const r=_x(t,i,a);return r?{ok:!0,spawnPosition:a,effects:[{type:"Displacement",target:c.id,destination:r,source:c.position,simulatePath:!0}],messages:["Ally repositions to make room."]}:{ok:!1,effects:[],messages:[],failureMessage:"No space to reposition ally."}}return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."}}const Mx=(t,i)=>!!t.tiles.get(de(i))?.traits?.has("CORPSE"),Ox=(t,i,a)=>{const o=[];return t.tiles.forEach(c=>{c.traits.has("CORPSE")&&_e(i,c.position)<=a&&o.push(c.position)}),o},Cx=t=>{const i=t.initialSeed??t.rngSeed??"0",a=new Set([...t.enemies.map(r=>r.id),...(t.companions||[]).map(r=>r.id)]);let o=(t.floor<<20)+(t.turnNumber<<12)+(t.actionLog?.length??0)+(t.rngCounter??0),c=`skeleton_${mo(i,o,8,"skeleton")}`;for(;a.has(c);)o+=1,c=`skeleton_${mo(i,o,8,"skeleton")}`;return c},Nx={id:"RAISE_DEAD",name:"Raise Dead",description:"Reanimate a target corpse into a Skeleton minion (Faction: Player).",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!Mx(t,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!ln(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=ug(t,i,a,"push_friendly");if(!f.ok)return{effects:o,messages:[f.failureMessage||"Target tile occupied."],consumesTurn:!1};o.push(...f.effects),c.push(...f.messages),o.push({type:"RemoveCorpse",position:a});const h=sy({companionType:"skeleton",ownerId:i.id,id:Cx(t),position:a});return o.push({type:"SpawnActor",actor:h}),o.push({type:"Juice",effect:"flash",target:a,color:"#aaaaaa"}),c.push("Skeleton raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>{const a=Ae(t,i);return a?Ox(t,i,4).filter(o=>ug(t,a,o,"push_friendly").ok):[]},upgrades:{},scenarios:vt("RAISE_DEAD")},Rx={id:"SOUL_SWAP",name:"Soul Swap",description:"Instantly swap positions with a player-aligned minion.",slot:"utility",icon:"",baseVariables:{range:6,cost:0,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!ln(i.position,a,6))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const r=Ae(t,a);return!r||r.factionId!=="player"||r.id===i.id?{effects:o,messages:["Target must be a minion!"],consumesTurn:!1}:(o.push({type:"Displacement",target:i.id,destination:a}),o.push({type:"Displacement",target:r.id,destination:i.position}),o.push({type:"Juice",effect:"flash",target:a,color:"#330066"}),o.push({type:"Juice",effect:"flash",target:i.position,color:"#330066"}),c.push("Soul Swapped!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(t,i)=>t.enemies.filter(a=>a.factionId==="player"&&ln(i,a.position,6)).map(a=>a.position),upgrades:{},scenarios:vt("SOUL_SWAP")},kx={id:"MULTI_SHOOT",name:"Multi-Shoot",description:"A spread of arrows. Axial range 4. Deals damage to target and neighbors.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:1},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r}=Fi(i.position,a);if(!ln(i.position,a,4)||!r)return{effects:o,messages:["Invalid target! Axial range 4 only."],consumesTurn:!1};const f=[a,...at(a)],h=Xe(i);for(const b of f){const y=Ae(t,b),A=on({attackerId:i.id,targetId:y?.id||de(b),skillId:"MULTI_SHOOT",basePower:1,trinity:h,targetTrinity:y?Xe(y):void 0,damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.1},{attribute:"mind",coefficient:.1}],statusMultipliers:[]});o.push({type:"Damage",target:b,amount:A.finalPower,reason:"multi_shoot",scoreEvent:A.scoreEvent})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffff00"}),c.push("Multi-Shoot!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,4),upgrades:{},scenarios:vt("MULTI_SHOOT")},Lx={id:"SET_TRAP",name:"Set Trap",description:"Place a hidden trap. Roots units for 3 turns.",slot:"utility",icon:"",baseVariables:{range:1,cost:1,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return a?Ti(t,a)||Oa(t,a)?{effects:o,messages:["Cannot place trap here!"],consumesTurn:!1}:(o.push({type:"PlaceTrap",position:a,ownerId:i.id}),o.push({type:"Juice",effect:"combat_text",target:a,text:"Trapped"}),c.push("Trap set."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(t,i)=>at(i).filter(a=>!Ti(t,a)&&!Oa(t,a)),upgrades:{},scenarios:vt("SET_TRAP")},Ix={id:"SWIFT_ROLL",name:"Swift Roll",description:"Quickly dodge 2 tiles. Passive: Automatically roll away from attackers when hit.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return a?ln(i.position,a,2)?Ti(t,a)||Oa(t,a)||Xs(t,a,i.id)?{effects:o,messages:["Cannot roll there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"Juice",effect:"dashBlur",target:a,path:[i.position,a]}),c.push("Swift roll!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,2).filter(o=>Q(o,i)?!1:!Ti(t,o)&&!Oa(t,o)&&!Xs(t,o)),upgrades:{},scenarios:vt("SWIFT_ROLL")},Bx={id:"SNEAK_ATTACK",name:"Sneak Attack",description:"Attack an adjacent enemy. Deals massive damage if executed from stealth.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Di(t.enemies,a);if(!r)return{effects:o,messages:["No target!"],consumesTurn:!1};if(!ln(i.position,a,1))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=(i.stealthCounter||0)>0,h=f?3:1,b=on({attackerId:i.id,targetId:r.id,skillId:"SNEAK_ATTACK",basePower:h,trinity:Xe(i),targetTrinity:Xe(r),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.25}],statusMultipliers:[]});return o.push({type:"Damage",target:r.id,amount:b.finalPower,reason:"sneak_attack",source:i.position,scoreEvent:b.scoreEvent}),f?(o.push({type:"Juice",effect:"flash",target:a,color:"#ff0000"}),c.push("SNEAK ATTACK!")):c.push("Sneak attack (No stealth bonus)."),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>at(i).filter(a=>!!Di(t.enemies,a)),upgrades:{},scenarios:vt("SNEAK_ATTACK")},jx={id:"SMOKE_SCREEN",name:"Smoke Screen",description:"Vanish into a cloud of smoke. Adds +2 to stealth counter.",slot:"utility",icon:"",baseVariables:{range:0,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:i.position}),c.push("Smoke Screen!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>[i],upgrades:{},scenarios:vt("SMOKE_SCREEN")},Dx={id:"SHADOW_STEP",name:"Shadow Step",description:"Teleport through the shadows. Only works while invisible. Extends stealth.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return a?(i.stealthCounter||0)>0?ln(i.position,a,2)?Ti(t,a)||Oa(t,a)||Xs(t,a,i.id)?{effects:o,messages:["Cannot step there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:a}),c.push("Shadow stepped!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:["Must be invisible to Shadow Step!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(t,i)=>(t.player.stealthCounter||0)>0?Ze.getAreaTargets(t,i,2).filter(c=>Q(c,i)?!1:!Ti(t,c)&&!Oa(t,c)&&!Xs(t,c)):[],upgrades:{},scenarios:vt("SHADOW_STEP")};function Od(t,i){return t.enemies.find(a=>a.companionOf===i&&a.subtype==="falcon")}const Hx={id:"FALCON_COMMAND",name:t=>{const i=t?.player?.id;if(!i)return"Summon Falcon";const a=Od(t,i);if(!a)return"Summon Falcon";const o=a.companionState?.mode||"roost";return o==="scout"?"Falcon: Scout":o==="predator"?"Falcon: Hunt":"Falcon: Roost"},description:t=>{const i=t?.player?.id;if(!i)return"Call your Falcon companion.";const a=Od(t,i);if(!a)return"Call your Falcon companion.";const o=a.companionState?.mode||"roost";return o==="scout"?"Click tile to set patrol zone. Falcon orbits and attacks nearby enemies.":o==="predator"?"Click enemy to mark as prey. Falcon pursues and uses Apex Strike.":"Falcon returns to you. Heals and cleanses 1 debuff on arrival."},slot:"offensive",icon:"",baseVariables:{range:6,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[];let r=Od(t,i.id);if(!r){const b=KS({ownerId:i.id,position:at(i.position)[0]});return o.push({type:"SpawnActor",actor:b}),o.push({type:"Message",text:"Your Falcon companion awakens!"}),c.push("Falcon summoned!"),{effects:o,messages:c,consumesTurn:!0}}const f=a?Ae(t,a):void 0;return!a||Q(a,i.position)||!!(f&&f.id===i.id)?(c.push("Falcon returns to roost."),o.push({type:"Juice",effect:"combat_text",target:i.position,text:"Roost"}),o.push({type:"UpdateCompanionState",target:r.id,mode:"roost"}),{effects:o,messages:c,consumesTurn:!0}):f&&f.factionId==="enemy"?(c.push(`Falcon marks ${f.subtype||"enemy"} as prey!`),o.push({type:"Juice",effect:"combat_text",target:a,text:" Marked"}),o.push({type:"ApplyStatus",target:f.id,status:"marked_predator",duration:-1}),o.push({type:"UpdateCompanionState",target:r.id,mode:"predator",markTarget:f.id}),{effects:o,messages:c,consumesTurn:!0}):(c.push("Falcon set to patrol zone."),o.push({type:"Juice",effect:"combat_text",target:a,text:" Patrol"}),o.push({type:"UpdateCompanionState",target:r.id,mode:"scout",markTarget:a}),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,6).filter(o=>(Q(o,i),!0)),upgrades:{KEEN_SIGHT:{id:"KEEN_SIGHT",name:"Keen Sight",description:"Falcon reveals hidden enemies within 3 tiles of its position."},FALCON_TWIN_TALONS:{id:"FALCON_TWIN_TALONS",name:"Twin Talons",description:"Basic Peck hits 2 targets instead of 1."},APEX_PREDATOR:{id:"APEX_PREDATOR",name:"Apex Predator",description:"Apex Strike cooldown reduced by 1. Marked enemies take +1 damage from all sources."}},scenarios:vt("FALCON_COMMAND")},Px={id:"FALCON_PECK",name:"Peck",description:"The falcon pecks an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(t,i,a,o=[])=>{const c=[],r=[],f=i.companionOf,b=(f?f===t.player.id?t.player:t.enemies.find(x=>x.id===f):void 0)?.activeSkills?.find(x=>x.id==="FALCON_COMMAND")?.activeUpgrades||[],y=o.includes("TWIN_TALONS")||b.includes("TWIN_TALONS")||b.includes("FALCON_TWIN_TALONS");if(!a)return{effects:c,messages:r,consumesTurn:!1};const A=Ae(t,a);if(!A||A.factionId==="player")return{effects:c,messages:r,consumesTurn:!1};if(_e(i.position,a)>1)return{effects:c,messages:r,consumesTurn:!1};const v=[A];if(y){const x=at(i.position).map(_=>Ae(t,_)).filter(_=>!!_&&_.id!==A.id&&_.factionId==="enemy")[0];x&&v.push(x)}for(const x of v){const _=on({attackerId:i.id,targetId:x.id,skillId:"FALCON_PECK",basePower:1,trinity:Xe(i),targetTrinity:Xe(x),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:x.id,amount:_.finalPower,reason:"falcon_peck",scoreEvent:_.scoreEvent})}return c.push({type:"Juice",effect:"combat_text",target:a,text:"Peck!",intensity:"low"}),r.push(y&&v.length>1?`Falcon pecked ${v.length} enemies!`:`Falcon pecked ${A.subtype||"enemy"}!`),{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(t,i)=>at(i).filter(a=>{const o=Ae(t,a);return o&&o.factionId==="enemy"}),upgrades:{TWIN_TALONS:{id:"TWIN_TALONS",name:"Twin Talons",description:"Peck hits 2 adjacent targets instead of 1."}},scenarios:vt("FALCON_PECK")},Ux={id:"FALCON_APEX_STRIKE",name:"Apex Strike",description:"The falcon dives into a target for lethal damage.",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:2,damage:40},execute:(t,i,a,o=[])=>{const c=[],r=[],f=i.companionOf,b=(f?f===t.player.id?t.player:t.enemies.find(x=>x.id===f):void 0)?.activeSkills?.find(x=>x.id==="FALCON_COMMAND")?.activeUpgrades||[],y=o.includes("APEX_PREDATOR")||b.includes("APEX_PREDATOR");if(!a)return{effects:c,messages:r,consumesTurn:!1};const A=Ae(t,a);if(!A)return{effects:c,messages:r,consumesTurn:!1};if(i.companionState?.apexStrikeCooldown&&i.companionState.apexStrikeCooldown>0)return{effects:c,messages:r,consumesTurn:!1};const v=on({attackerId:i.id,targetId:A.id,skillId:"FALCON_APEX_STRIKE",basePower:40,trinity:Xe(i),targetTrinity:Xe(A),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return c.push({type:"Damage",target:A.id,amount:v.finalPower,reason:"apex_strike",scoreEvent:v.scoreEvent}),c.push({type:"Juice",effect:"impact",target:a,intensity:"high"}),c.push({type:"UpdateCompanionState",target:i.id,apexStrikeCooldown:y?1:2}),r.push(`Falcon executes APEX STRIKE on ${A.subtype||"enemy"}!`),{effects:c,messages:r,consumesTurn:!0}},upgrades:{},getValidTargets:(t,i)=>{const a=[];return t.enemies.forEach(o=>{_e(i,o.position)<=4&&a.push(o.position)}),a}},qx={id:"FALCON_HEAL",name:"Roost Heal",description:"The falcon roosts and restores health to its companion.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:1},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Ae(t,a);return r?i.companionState?.healCooldown&&i.companionState.healCooldown>0?{effects:o,messages:c,consumesTurn:!1}:(o.push({type:"Heal",target:r.id,amount:1}),o.push({type:"Juice",effect:"flash",target:r.position,color:"#00ff88"}),o.push({type:"UpdateCompanionState",target:i.id,healCooldown:1}),c.push("Falcon roosts. You feel restored."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(t,i)=>{const a=[],o=t.player;return _e(i,o.position)<=1&&a.push(o.position),a}},zx={id:"FALCON_SCOUT",name:"Scout Orbit",description:"The actor orbits a target point in a hexagonal ring.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[],r=i.companionState?.markTarget;if(!r||typeof r!="object")return{effects:o,messages:c,consumesTurn:!1};const f=r,h=at(f);let b;if(_e(i.position,f)!==1)b=h.sort((y,A)=>_e(i.position,y)-_e(i.position,A))[0];else{const A=(h.findIndex(v=>Q(v,i.position))+1)%6;b=h[A]}return Ze.isWithinBounds(t,b)&&Pe.isWalkable(t,b)&&!Ae(t,b)?(o.push({type:"Displacement",target:i.id,destination:b,source:i.position,simulatePath:!0}),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(t,i)=>[]},$x={id:"FALCON_AUTO_ROOST",name:"Auto Roost",description:"Automatically returns the falcon to roost mode when mark is lost.",slot:"passive",icon:"R",baseVariables:{range:0,cost:0,cooldown:0},execute:(t,i,a)=>({effects:[{type:"UpdateCompanionState",target:i.id,mode:"roost",markTarget:void 0}],messages:["Falcon loses prey and returns to roost mode."],consumesTurn:!0}),getValidTargets:(t,i)=>[i],upgrades:{}},dg=2,Vx=3,Yx=3,Kx=2;function Fx(t,i){const a=[];for(let o=0;o<6;o++){let c=t;for(let r=0;r<i;r++)c=jn(c,Nn(o));a.push(c)}return a}function Gx(t,i,a){return Fx(i,a).filter(c=>!(!Ze.isWithinBounds(t,c)||!Pe.isWalkable(t,c)||Ae(t,c)))}const Wx={id:"KINETIC_TRI_TRAP",name:"Kinetic Tri-Trap",description:"Deploy 3 hidden traps on axial tiles. Triggered enemies are flung away.",slot:"defensive",icon:"",baseVariables:{range:dg,cost:0,cooldown:Yx},execute:(t,i,a,o=[])=>{const c=[],r=[];let f=t;const h=o.includes("VOLATILE_CORE"),b=o.includes("TRAP_CHAIN_REACTION")||o.includes("CHAIN_REACTION"),y=o.includes("QUICK_RELOAD"),A=Gx(t,i.position,dg);if(A.length===0)return{effects:c,messages:["No valid trap positions!"],consumesTurn:!1};const v=Math.min(Vx,A.length),x=[];c.push({type:"RemoveTrap",position:{q:0,r:0,s:0},ownerId:i.id});const _=[...A];for(let p=0;p<v&&_.length!==0;p++){const{value:g,nextState:N}=Ea(f);f=N;const I=Math.floor(g*_.length)%_.length;x.push(_[I]),_.splice(I,1)}for(const p of x)c.push({type:"PlaceTrap",position:p,ownerId:i.id,volatileCore:h,chainReaction:b,resetCooldown:y?1:Kx}),c.push({type:"Juice",effect:"flash",target:p,intensity:"low",color:"#ffaa00"});return r.push(`${x.length} traps deployed.`),{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(t,i)=>[i],upgrades:{VOLATILE_CORE:{id:"VOLATILE_CORE",name:"Volatile Core",description:"Traps deal 1 damage when triggered."},TRAP_CHAIN_REACTION:{id:"TRAP_CHAIN_REACTION",name:"Chain Reaction",description:"When a trap triggers, adjacent traps also activate."},QUICK_RELOAD:{id:"QUICK_RELOAD",name:"Quick Reload",description:"Individual trap reset cooldown reduced to 1."}},scenarios:vt("KINETIC_TRI_TRAP")},fg=1,mg=1,Xx=1,dy=2,Qx=2;function Jx(t,i,a,o=dy){const c=Fs(a,i);if(c===-1)return null;const r=Nn(c);for(let h=o;h>=Xx;h--){let b=i,y=!0;for(let A=0;A<h;A++){if(b=jn(b,r),!Ze.isWithinBounds(t,b)){y=!1;break}if(!Pe.isWalkable(t,b)){y=!1;break}}if(y&&!Ae(t,b))return b}const f=[(c+1)%6,(c+5)%6];for(const h of f){const b=Nn(h);let y=jn(i,b);if(Ze.isWithinBounds(t,y)&&Pe.isWalkable(t,y)&&!Ae(t,y))return y}return null}const Zx={id:"WITHDRAWAL",name:"Withdrawal",description:"Quick shot + tactical backroll. Auto-triggers when enemies close in.",slot:"utility",icon:"",baseVariables:{range:fg,cost:0,cooldown:Qx,damage:mg},execute:(t,i,a,o=[])=>{const c=[],r=[],f=o.includes("PARTING_SHOT"),h=o.includes("NIMBLE_FEET");if(!a)return{effects:c,messages:["No target!"],consumesTurn:!1};if(_e(i.position,a)>fg)return{effects:c,messages:["Target out of range!"],consumesTurn:!1};const y=Ae(t,a);if(!y)return{effects:c,messages:["No enemy at target!"],consumesTurn:!1};if(y.factionId===i.factionId)return{effects:c,messages:["Cannot target allies!"],consumesTurn:!1};const A=on({attackerId:i.id,targetId:y.id,skillId:"WITHDRAWAL",basePower:mg+(f?1:0),trinity:Xe(i),targetTrinity:Xe(y),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});c.push({type:"Damage",target:y.id,amount:A.finalPower,scoreEvent:A.scoreEvent}),c.push({type:"Juice",effect:"impact",target:a}),r.push(`Withdrawal shot hits ${y.subtype||"enemy"}!`);const v=h?3:dy,x=Jx(t,i.position,a,v);return x?(c.push({type:"Displacement",target:"self",destination:x,source:i.position}),c.push({type:"Juice",effect:"dashBlur",target:x,path:[i.position,x]}),r.push("Backroll!")):r.push("No safe retreat available!"),{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(t,i)=>at(i).filter(a=>{const o=Ae(t,a);return o&&o.factionId==="enemy"}),upgrades:{PARTING_SHOT:{id:"PARTING_SHOT",name:"Parting Shot",description:"Withdrawal deals +1 damage."},NIMBLE_FEET:{id:"NIMBLE_FEET",name:"Nimble Feet",description:"Backroll distance increased to 3 hexes."},HAIR_TRIGGER:{id:"HAIR_TRIGGER",name:"Hair Trigger",description:"Passive reaction does not consume cooldown."}},scenarios:vt("WITHDRAWAL")},eA={id:"ABSORB_FIRE",name:"Absorb Fire",description:"Fire heals you instead of harming you.",slot:"passive",icon:"",baseVariables:{cost:0,cooldown:0,range:0},execute:(t,i,a)=>({effects:[],messages:[]}),getValidTargets:()=>[],upgrades:{}},Vs=(t,i)=>t.includes(i),tA=t=>{const i=new Set,a=t.id;return((t.baseVariables.damage||0)>0||/(ATTACK|THROW|BLAST|FIREBALL|BASH|PECK|EXPLOSION|SPEAR|SHOOT)/.test(a))&&i.add("damage"),/(MOVE|DASH|JUMP|ROLL|VAULT|STEP|GRAPPLE|WITHDRAWAL|WALK)/.test(a)&&i.add("move"),/(HEAL|ABSORB)/.test(a)&&i.add("heal"),/(SHIELD|PROTECT|BULWARK)/.test(a)&&i.add("protect"),/(STUN|TRAP|SMOKE|TELEGRAPH|ROOT|SWAP|SCOUT)/.test(a)&&i.add("control"),/(RAISE|FALCON|SUMMON)/.test(a)&&i.add("summon"),/(FIRE|LAVA|HAZARD|TRAP)/.test(a)&&i.add("hazard"),t.slot==="offensive"&&i.add("damage"),t.slot==="defensive"&&i.add("protect"),t.slot==="utility"&&i.add("utility"),(t.baseVariables.cooldown>0||t.baseVariables.cost>0)&&i.add("economy"),i.size||i.add("utility"),[...i]},nA={BASIC_MOVE:{intentTags:["move","objective","utility"],target:{pattern:"single"},estimates:{movement:1}},BASIC_ATTACK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:4}},AUTO_ATTACK:{intentTags:["damage","utility"],target:{pattern:"single"},estimates:{damage:2}},DASH:{intentTags:["move","damage","utility"],target:{pattern:"line"},estimates:{movement:2,damage:2},risk:{noProgressCastPenalty:5}},JUMP:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2},risk:{noProgressCastPenalty:6}},SHIELD_BASH:{intentTags:["damage","control","protect"],target:{pattern:"single"},estimates:{damage:3,control:2},risk:{requireEnemyContact:!0,noContactPenalty:5,noProgressCastPenalty:7}},BULWARK_CHARGE:{intentTags:["move","protect","damage"],target:{pattern:"line"},estimates:{movement:2,damage:4,shielding:2}},VAULT:{intentTags:["move","utility","control"],target:{pattern:"single"},estimates:{movement:3,control:2}},GRAPPLE_HOOK:{intentTags:["move","control"],target:{pattern:"line"},estimates:{movement:3,control:2}},SHIELD_THROW:{intentTags:["damage","control"],target:{pattern:"line"},estimates:{damage:6,control:2}},SPEAR_THROW:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:5}},FIREBALL:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:5,control:1}},FIREWALL:{intentTags:["hazard","control","damage"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:5,control:3}},FIREWALK:{intentTags:["move","hazard","utility"],target:{pattern:"single"},estimates:{movement:3},risk:{noProgressCastPenalty:8}},ABSORB_FIRE:{intentTags:["heal","hazard","utility"],target:{pattern:"self"},estimates:{healing:6},risk:{noProgressCastPenalty:2}},BOMB_TOSS:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:2}},TIME_BOMB:{intentTags:["damage","hazard","utility"],target:{pattern:"self"},estimates:{damage:6,control:1}},CORPSE_EXPLOSION:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:1}},RAISE_DEAD:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:5}},SOUL_SWAP:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:2}},MULTI_SHOOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5}},SET_TRAP:{intentTags:["control","hazard"],target:{pattern:"single"},estimates:{control:3}},SWIFT_ROLL:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2}},SNEAK_ATTACK:{intentTags:["damage","move"],target:{pattern:"single"},estimates:{damage:8,movement:2},risk:{requireEnemyContact:!0,noContactPenalty:3,noProgressCastPenalty:4}},SMOKE_SCREEN:{intentTags:["control","protect","utility"],target:{pattern:"radius",aoeRadius:1},estimates:{control:4,shielding:4}},SHADOW_STEP:{intentTags:["move","damage","utility"],target:{pattern:"single"},estimates:{movement:3,damage:3}},FALCON_COMMAND:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:4,control:2}},FALCON_PECK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:3}},FALCON_APEX_STRIKE:{intentTags:["damage","control"],target:{pattern:"single"},estimates:{damage:5,control:1}},FALCON_HEAL:{intentTags:["heal","utility"],target:{pattern:"single"},estimates:{healing:4}},FALCON_SCOUT:{intentTags:["control","utility"],target:{pattern:"self"},estimates:{control:3}},FALCON_AUTO_ROOST:{intentTags:["summon","utility"],target:{pattern:"self"},estimates:{summon:2}},KINETIC_TRI_TRAP:{intentTags:["control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{control:5,damage:4}},WITHDRAWAL:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:1}},SENTINEL_TELEGRAPH:{intentTags:["control","objective"],target:{pattern:"radius",aoeRadius:2},estimates:{control:3}},SENTINEL_BLAST:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:7}},THEME_HAZARDS:{intentTags:["hazard","control"],target:{pattern:"global"},estimates:{control:2}}},iA=(t,i)=>i?{...t,...i,target:{...t.target,...i.target||{}},estimates:{...t.estimates,...i.estimates||{}},economy:{...t.economy,...i.economy||{}},risk:{...t.risk,...i.risk||{}}}:t,sA=t=>{const i=tA(t),a=(Vs(i,"move"),"single"),o={id:t.id,intentTags:i,target:{range:Math.max(0,t.baseVariables.range||0),pattern:a},estimates:{damage:Math.max(0,t.baseVariables.damage||0),movement:Vs(i,"move")?Math.max(1,Math.min(3,t.baseVariables.range||1)):0,healing:Vs(i,"heal")?2:0,shielding:Vs(i,"protect")?1:0,control:Vs(i,"control")?1:0,summon:Vs(i,"summon")?1:0},economy:{cost:Math.max(0,t.baseVariables.cost||0),cooldown:Math.max(0,t.baseVariables.cooldown||0),consumesTurn:!0},risk:{selfExposure:Vs(i,"move")?.5:0,hazardAffinity:Vs(i,"hazard")?.5:0},complexity:1};return iA(o,nA[t.id])},aA=t=>{const i=[];return(!t.intentTags||t.intentTags.length===0)&&i.push("intentTags must not be empty"),(!Number.isFinite(t.target.range)||t.target.range<0)&&i.push("target.range must be >= 0"),t.target.pattern||i.push("target.pattern is required"),(!Number.isFinite(t.economy.cooldown)||t.economy.cooldown<0)&&i.push("economy.cooldown must be >= 0"),(!Number.isFinite(t.economy.cost)||t.economy.cost<0)&&i.push("economy.cost must be >= 0"),(!Number.isFinite(t.complexity)||t.complexity<0)&&i.push("complexity must be >= 0"),i},oA=t=>{const i=[],a=[];for(const[o,c]of Object.entries(t)){const r=c.intentProfile||sA(c);c.intentProfile=r;const f=aA(r);f.length>0&&a.push({skillId:o,errors:f}),r||i.push(o)}return{missing:i,invalid:a}},lA=(t,i)=>t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i),rA=(t,i,a)=>!!(t.player.id!==a&&Q(t.player.position,i)||t.enemies.some(o=>o.id!==a&&o.hp>0&&Q(o.position,i))||t.companions?.some(o=>o.id!==a&&o.hp>0&&Q(o.position,i))),pg=(t,i)=>{const a={q:i.q-t.q,r:i.r-t.r,s:i.s-t.s};let o=El[0],c=Number.NEGATIVE_INFINITY;for(const r of El){const f=r.q*a.q+r.r*a.r+r.s*a.s;f>c&&(c=f,o=r)}return o},cA=(t,i)=>{const a=lA(t,i.targetActorId);if(!a)return{effects:[],destination:null,collided:!1};const o=Math.max(0,Math.min(i.maxDistance,Math.floor(i.magnitude)));if(o<=0)return{effects:[],destination:a.position,collided:!1};const c=a.position,r=i.mode==="push"?pg(i.source,c):pg(c,i.source),f=[c];let h=c,b=!1;for(let A=0;A<o;A++){const v=jn(h,r);if(!Pe.isWalkable(t,v)||rA(t,v,a.id)){b=!0;break}f.push(v),h=v}const y=[];return Q(h,c)||y.push({type:"Displacement",target:a.id,destination:h,path:f,simulatePath:!0}),b&&i.collision.onBlocked==="crush_damage"&&y.push({type:"Damage",target:a.id,amount:Math.max(0,Math.floor(i.collision.crushDamage??0)),reason:i.damageReason||"crush"}),{effects:y,destination:h,collided:b}},Pr=t=>JSON.parse(JSON.stringify(t)),uA=(t,i)=>i==="floor"?Math.floor(t):i==="round"?Math.round(t):i==="ceil"?Math.ceil(t):t,Cd=(t,i)=>{let a=t.base;for(const o of t.scaling||[])a+=(i[o.stat]??0)*o.coefficient;return a=uA(a,t.round),t.min!==void 0&&(a=Math.max(t.min,a)),t.max!==void 0&&(a=Math.min(t.max,a)),a},dA=(t,i,a,o)=>{const c=i.split(".");let r=t;for(let b=0;b<c.length-1;b++){const y=c[b],A=r[y];if(!A||typeof A!="object")return;r=A}const f=c[c.length-1],h=Number(r[f]);Number.isFinite(h)&&(a==="set"&&(r[f]=o),a==="add"&&(r[f]=h+o),a==="multiply"&&(r[f]=h*o))},fA=(t,i,a)=>{let o=Pr(t.baseAction.effects);const c=Pr(t.reactivePassives||[]),r=new Set(t.keywords),f={};for(const h of t.upgrades)f[h.id]=h;for(const h of i){const b=f[h];if(b)for(const y of b.modifiers){if(y.op==="add_effect"&&o.push(Pr(y.effect)),y.op==="remove_effect_by_tag"&&(o=o.filter(A=>!A.tags.includes(y.tag))),y.op==="modify_number"){const A=o.find(v=>v.id===y.effectId);A&&dA(A,y.field,y.mode,y.value)}y.op==="add_keyword"&&r.add(y.keyword),y.op==="remove_keyword"&&r.delete(y.keyword),y.op==="add_reaction"&&c.push(Pr(y.reaction))}}return t.inhibit?.filterMode==="exclude_matching_tags"&&a.size>0&&(o=o.filter(h=>!h.tags.some(b=>a.has(b)))),{effects:o,reactions:c,keywords:r}},mA=(t,i)=>{const a=Xe(t),o=Number(i?.momentum??0),c=Number(i?.mass??1);return{body:a.body,mind:a.mind,instinct:a.instinct,mass:Number.isFinite(c)?c:1,speed:t.speed||1,momentum:Number.isFinite(o)?o:0}},Nd=(t,i)=>i?Ae(t,i)?.id:void 0,pA=(t,i,a,o,c)=>{if(o.kind==="MESSAGE")return[{type:"Message",text:o.text}];if(o.kind==="DEAL_DAMAGE"){const b=Math.max(0,Math.floor(Cd(o.amount,c))),y=Nd(t,a);return[{type:"Damage",target:o.target.selector==="targetActor"?y||"targetActor":o.target.selector==="self"?i.id:a||"targetActor",amount:b,reason:o.reason}]}if(o.kind==="APPLY_STATUS"){const b=Nd(t,a);return[{type:"ApplyStatus",target:o.target.selector==="targetActor"?b||"targetActor":o.target.selector==="self"?i.id:a||"targetActor",status:o.statusId,duration:o.duration}]}const r=Nd(t,a);if(!r)return[];const f=Cd(o.force.magnitude,c),h=o.force.collision.crushDamage?Cd(o.force.collision.crushDamage,c):0;return cA(t,{source:i.position,targetActorId:r,mode:o.force.mode,magnitude:f,maxDistance:o.force.maxDistance,collision:{onBlocked:o.force.collision.onBlocked,crushDamage:h}}).effects},hA=(t,i,a,o)=>{const c=[];for(let r=0;r<t.gridWidth;r++)for(let f=0;f<t.gridHeight;f++){const h=Bn(r,f);Ws(h,t.gridWidth,t.gridHeight)&&_e(i,h)<=a&&c.push(h)}return c.sort((r,f)=>{if(o==="q_then_r")return r.q===f.q?r.r-f.r:r.q-f.q;if(o==="r_then_q")return r.r===f.r?r.q-f.q:r.r-f.r;const h=_e(i,r),b=_e(i,f);return h!==b?h-b:r.q===f.q?r.r-f.r:r.q-f.q}),c},gA=t=>{const i=t.baseAction.effects.find(c=>c.kind==="DEAL_DAMAGE"),a=t.baseAction.effects.find(c=>c.kind==="APPLY_FORCE"),o={};return t.upgrades.forEach(c=>{o[c.id]={id:c.id,name:c.name,description:c.description||c.name}}),{id:t.id,name:t.name,description:t.description||t.name,slot:t.slot,icon:"data-driven",baseVariables:{range:t.targeting.range,cost:t.baseAction.costs.energy,cooldown:t.baseAction.costs.cooldown,damage:i?.amount?.base,momentum:a?.force?.magnitude?.base},execute:(c,r,f,h=[],b={})=>{const y=new Set(b.inhibitTags||[]),A=fA(t,h,y),v=mA(r,b),_=[...(A.reactions||[]).filter(g=>g.trigger==="ON_DECLARE").flatMap(g=>g.effects),...A.effects],p=[];for(const g of _)p.push(...pA(c,r,f,g,v));return{effects:p,messages:[],consumesTurn:t.baseAction.costs.consumesTurn}},getValidTargets:(c,r)=>{if(t.targeting.mode==="self")return[r];let f=hA(c,r,t.targeting.range,t.targeting.deterministicSort);return(t.targeting.mode==="single"||t.targeting.mode==="radius"||t.targeting.mode==="line")&&(t.targeting.requiresLos&&(f=f.filter(h=>nf(c,r,h).isValid)),t.targeting.allowOccupied||(f=f.filter(h=>!Ae(c,h)))),f},upgrades:o}},yA=new Map,fy=new Map,bA=t=>{const i=gA(t);return yA.set(t.id,t),fy.set(t.id,i),i},SA=t=>t.map(bA),vA=()=>{const t={};for(const[i,a]of fy.entries())t[i]=a;return t},fc={GRAPPLE_HOOK:tx,SPEAR_THROW:nx,SHIELD_BASH:ix,SHIELD_THROW:ux,VAULT:dx,JUMP:sx,BULWARK_CHARGE:ax,BASIC_ATTACK:ox,AUTO_ATTACK:oy,SENTINEL_TELEGRAPH:lx,SENTINEL_BLAST:rx,THEME_HAZARDS:cx,BASIC_MOVE:mx,DASH:px,FIREBALL:gx,FIREWALL:yx,FIREWALK:bx,BOMB_TOSS:Sx,TIME_BOMB:vx,CORPSE_EXPLOSION:Tx,RAISE_DEAD:Nx,SOUL_SWAP:Rx,MULTI_SHOOT:kx,SET_TRAP:Lx,SWIFT_ROLL:Ix,SNEAK_ATTACK:Bx,SMOKE_SCREEN:jx,SHADOW_STEP:Dx,FALCON_COMMAND:Hx,FALCON_PECK:Px,FALCON_APEX_STRIKE:Ux,FALCON_HEAL:qx,FALCON_SCOUT:zx,FALCON_AUTO_ROOST:$x,KINETIC_TRI_TRAP:Wx,WITHDRAWAL:Zx,ABSORB_FIRE:eA},Ur=oA(fc);if(Ur.missing.length>0||Ur.invalid.length>0){const t=Ur.missing.join(", "),i=Ur.invalid.map(a=>`${a.skillId}: ${a.errors.join("; ")}`).join(" | ");throw new Error(`Skill intent profile validation failed. missing=[${t}] invalid=[${i}]`)}const uo=()=>({...fc,...vA()});function Ks(t){const a=uo()[t];return a?{id:t,name:a.name,description:typeof a.description=="function"?a.description({}):a.description,slot:a.slot,cooldown:a.baseVariables.cooldown||0,currentCooldown:0,range:a.baseVariables.range||0,upgrades:Object.keys(a.upgrades||{}),activeUpgrades:[]}:null}function xA(){return[Ks("BASIC_MOVE"),Ks("BASIC_ATTACK"),Ks("AUTO_ATTACK"),Ks("SPEAR_THROW"),Ks("SHIELD_BASH"),Ks("JUMP")].filter(Boolean)}const AA={...fc,get:t=>uo()[t],getAllUpgrades:()=>{const t=uo();return Object.values(t).flatMap(i=>Object.values(i.upgrades||{}).map(a=>({...a,skillId:i.id})))},getUpgrade:t=>{const i=uo();for(const a of Object.values(i))if(a.upgrades?.[t])return a.upgrades[t]},getSkillForUpgrade:t=>{const i=uo();for(const[a,o]of Object.entries(i))if(o.upgrades?.[t])return a},getSkillRange:(t,i)=>{const a=(t.activeSkills||[]).find(r=>r.id===i),o=uo()[i];if(!o)return a?.range||0;let c=o.baseVariables.range;return a?.activeUpgrades&&a.activeUpgrades.forEach(r=>{const f=o.upgrades[r];f?.modifyRange&&(c+=f.modifyRange)}),c}},Mn=AA,TA=Mn.getSkillRange,EA=t=>Mn.get(t),_A=(t,i,a,o)=>{let c=t;const r=[],f=a?t.enemies.filter(b=>b.id===a):t.enemies,h=[...c.enemies];return f.forEach(b=>{const y=c.enemies.find(A=>A.id===b.id);if(y){if(ji(y)){const A=h.findIndex(v=>v.id===b.id);A!==-1&&(h[A]={...h[A],intent:void 0,intentPosition:void 0});return}if(y.intent&&y.intentPosition){let A=!1;const v=Mn.get(y.intent),x=y.activeSkills?.find(_=>_.id===y.intent);if(v&&x){const p=(v.getValidTargets?v.getValidTargets(c,y.position):[]).some(I=>Q(I,c.player.position));let g=y.intentPosition;if(p)g=c.player.position;else{const I=h.findIndex(M=>M.id===b.id);I!==-1&&(h[I]={...h[I],intent:void 0,intentPosition:void 0});return}const N=v.execute(c,y,g,x.activeUpgrades);c=ui(c,N.effects,{sourceId:y.id,targetId:c.player.id,stepId:o}),r.push(...N.messages),A=!0}else if(y.subtype!=="bomber"){if(Q(y.intentPosition,i)){c={...c,player:Ys(c.player,1)};const _=`${y.subtype||"enemy"}#${y.id}`;r.push(`${_} hit you! (HP: ${c.player.hp}/${c.player.maxHp})`),A=!0}}if(A){const _=h.findIndex(p=>p.id===b.id);_!==-1&&(h[_]={...h[_],intent:void 0,intentPosition:void 0})}}}}),c={...c,enemies:h},{state:c,messages:r}};class hg extends Error{issues;constructor(i,a){super(`${i} validation failed:
${a.map(o=>`${o.path}: ${o.message}`).join(`
`)}`),this.name="ContractValidationError",this.issues=a}}const nn=t=>typeof t=="object"&&t!==null&&!Array.isArray(t),hs=t=>typeof t=="number"&&Number.isFinite(t),Li=t=>Number.isInteger(t),_t=t=>typeof t=="string",fe=(t,i,a)=>t.push({path:i,message:a}),wA=t=>{if(!_t(t))return t;try{return JSON.parse(t)}catch(i){throw new Error(`Invalid JSON: ${i.message}`)}},vl=(t,i,a,o={})=>{if(!Array.isArray(t))return fe(i,a,"Expected array");const c=new Set;o.nonEmpty&&t.length===0&&fe(i,a,"Must not be empty"),t.forEach((r,f)=>{if(!_t(r)||r.length===0)return fe(i,`${a}[${f}]`,"Expected non-empty string");o.unique&&(c.has(r)&&fe(i,`${a}[${f}]`,`Duplicate "${r}"`),c.add(r))})},gg=(t,i,a)=>{if(!nn(t))return fe(i,a,"Expected object");hs(t.base)||fe(i,`${a}.base`,"Expected number"),t.min!==void 0&&!hs(t.min)&&fe(i,`${a}.min`,"Expected number"),t.max!==void 0&&!hs(t.max)&&fe(i,`${a}.max`,"Expected number"),hs(t.min)&&hs(t.max)&&t.min>t.max&&fe(i,a,"min must be <= max")},MA=(t,i,a)=>nn(t)?((!_t(t.id)||t.id.length===0)&&fe(i,`${a}.id`,"Expected non-empty string"),vl(t.tags,i,`${a}.tags`,{nonEmpty:!0,unique:!0}),_t(t.kind)?t.kind==="DEAL_DAMAGE"?(gg(t.amount,i,`${a}.amount`),(!nn(t.target)||!_t(t.target.selector))&&fe(i,`${a}.target`,"Expected selector"),!0):t.kind==="APPLY_STATUS"?((!_t(t.statusId)||t.statusId.length===0)&&fe(i,`${a}.statusId`,"Expected statusId"),(!Li(t.duration)||t.duration<0)&&fe(i,`${a}.duration`,"Expected integer >= 0"),(!nn(t.target)||!_t(t.target.selector))&&fe(i,`${a}.target`,"Expected selector"),!0):t.kind==="APPLY_FORCE"?nn(t.force)?((!_t(t.force.mode)||!new Set(["push","pull"]).has(t.force.mode))&&fe(i,`${a}.force.mode`,"Expected push|pull"),(!_t(t.force.direction)||!new Set(["source_to_target","target_to_source"]).has(t.force.direction))&&fe(i,`${a}.force.direction`,"Invalid direction"),(!Li(t.force.maxDistance)||t.force.maxDistance<0)&&fe(i,`${a}.force.maxDistance`,"Expected integer >= 0"),gg(t.force.magnitude,i,`${a}.force.magnitude`),nn(t.force.collision)||fe(i,`${a}.force.collision`,"Expected object"),!0):(fe(i,`${a}.force`,"Expected object"),!0):t.kind==="MESSAGE"?((!_t(t.text)||t.text.length===0)&&fe(i,`${a}.text`,"Expected non-empty string"),!0):(fe(i,`${a}.kind`,"Unknown kind"),!1):(fe(i,`${a}.kind`,"Expected kind"),!1)):(fe(i,a,"Expected object"),!1),OA=(t,i,a)=>{if(!nn(t))return fe(i,a,"Expected object");if(!_t(t.method))return fe(i,`${a}.method`,"Expected method");if(t.method==="fixed"){hs(t.value)||fe(i,`${a}.value`,"Expected number");return}if(t.method==="uniform_int"){Li(t.min)||fe(i,`${a}.min`,"Expected integer"),Li(t.max)||fe(i,`${a}.max`,"Expected integer"),Li(t.min)&&Li(t.max)&&t.min>t.max&&fe(i,a,"min must be <= max");return}if(t.method==="triangular_int"){Li(t.min)||fe(i,`${a}.min`,"Expected integer"),Li(t.mode)||fe(i,`${a}.mode`,"Expected integer"),Li(t.max)||fe(i,`${a}.max`,"Expected integer");return}if(t.method==="weighted_table"){if(!Array.isArray(t.table)||t.table.length===0)return fe(i,`${a}.table`,"Expected non-empty array");t.table.forEach((o,c)=>{if(!nn(o))return fe(i,`${a}.table[${c}]`,"Expected object");hs(o.value)||fe(i,`${a}.table[${c}].value`,"Expected number"),(!hs(o.weight)||o.weight<=0)&&fe(i,`${a}.table[${c}].weight`,"Expected number > 0")});return}fe(i,`${a}.method`,"Unknown propensity method")},CA=t=>{const i=[];if(!nn(t))return fe(i,"$","Expected object"),i;if((!_t(t.version)||!/^1\./.test(t.version))&&fe(i,"$.version","Expected v1.x"),(!_t(t.id)||!/^[A-Z0-9_]+$/.test(t.id))&&fe(i,"$.id","Expected uppercase id"),(!_t(t.name)||t.name.length===0)&&fe(i,"$.name","Expected non-empty string"),(!_t(t.actorType)||!new Set(["player","enemy"]).has(t.actorType))&&fe(i,"$.actorType","Expected player|enemy"),(!_t(t.factionId)||t.factionId.length===0)&&fe(i,"$.factionId","Expected non-empty string"),(!nn(t.coordSpace)||t.coordSpace.system!=="cube-axial"||t.coordSpace.pointFormat!=="qrs")&&fe(i,"$.coordSpace","Expected {system:cube-axial,pointFormat:qrs}"),nn(t.instantiate)?((!_t(t.instantiate.rngStream)||t.instantiate.rngStream.length===0)&&fe(i,"$.instantiate.rngStream","Expected non-empty string"),(!_t(t.instantiate.counterMode)||!new Set(["consume_global","stateless"]).has(t.instantiate.counterMode))&&fe(i,"$.instantiate.counterMode","Expected consume_global|stateless"),vl(t.instantiate.drawOrder,i,"$.instantiate.drawOrder",{nonEmpty:!0,unique:!0})):fe(i,"$.instantiate","Expected object"),!nn(t.propensities))fe(i,"$.propensities","Expected object");else{const a=t.propensities;["body","mind","instinct","speed","mass"].forEach(o=>{o in a||fe(i,`$.propensities.${o}`,"Missing required propensity")}),Object.entries(a).forEach(([o,c])=>OA(c,i,`$.propensities.${o}`))}return nn(t.skillLoadout)?(vl(t.skillLoadout.baseSkillIds,i,"$.skillLoadout.baseSkillIds",{nonEmpty:!0,unique:!0}),t.skillLoadout.passiveSkillIds!==void 0&&vl(t.skillLoadout.passiveSkillIds,i,"$.skillLoadout.passiveSkillIds",{unique:!0})):fe(i,"$.skillLoadout","Expected object"),i},NA=t=>{const i=[];return nn(t)?((!_t(t.version)||!/^1\./.test(t.version))&&fe(i,"$.version","Expected v1.x"),(!_t(t.id)||!/^[A-Z0-9_]+$/.test(t.id))&&fe(i,"$.id","Expected uppercase id"),(!_t(t.name)||t.name.length===0)&&fe(i,"$.name","Expected non-empty string"),(!_t(t.slot)||!new Set(["offensive","defensive","utility","passive"]).has(t.slot))&&fe(i,"$.slot","Invalid slot"),vl(t.keywords,i,"$.keywords",{unique:!0}),nn(t.targeting)?((!_t(t.targeting.mode)||!new Set(["self","single","line","radius","global"]).has(t.targeting.mode))&&fe(i,"$.targeting.mode","Invalid mode"),(!Li(t.targeting.range)||t.targeting.range<0)&&fe(i,"$.targeting.range","Expected integer >= 0"),typeof t.targeting.requiresLos!="boolean"&&fe(i,"$.targeting.requiresLos","Expected boolean"),typeof t.targeting.allowOccupied!="boolean"&&fe(i,"$.targeting.allowOccupied","Expected boolean")):fe(i,"$.targeting","Expected object"),(!nn(t.stackPolicy)||t.stackPolicy.resolveOrder!=="LIFO")&&fe(i,"$.stackPolicy.resolveOrder","MVP requires LIFO"),nn(t.baseAction)?(nn(t.baseAction.costs)?((!hs(t.baseAction.costs.energy)||t.baseAction.costs.energy<0)&&fe(i,"$.baseAction.costs.energy","Expected number >= 0"),(!Li(t.baseAction.costs.cooldown)||t.baseAction.costs.cooldown<0)&&fe(i,"$.baseAction.costs.cooldown","Expected integer >= 0"),typeof t.baseAction.costs.consumesTurn!="boolean"&&fe(i,"$.baseAction.costs.consumesTurn","Expected boolean")):fe(i,"$.baseAction.costs","Expected object"),!Array.isArray(t.baseAction.effects)||t.baseAction.effects.length===0?fe(i,"$.baseAction.effects","Expected non-empty array"):t.baseAction.effects.forEach((a,o)=>MA(a,i,`$.baseAction.effects[${o}]`))):fe(i,"$.baseAction","Expected object"),Array.isArray(t.upgrades)?t.upgrades.forEach((a,o)=>{if(!nn(a))return fe(i,`$.upgrades[${o}]`,"Expected object");(!_t(a.id)||!/^[A-Z0-9_]+$/.test(a.id))&&fe(i,`$.upgrades[${o}].id`,"Expected uppercase id"),(!_t(a.name)||a.name.length===0)&&fe(i,`$.upgrades[${o}].name`,"Expected non-empty string"),Array.isArray(a.modifiers)||fe(i,`$.upgrades[${o}].modifiers`,"Expected array")}):fe(i,"$.upgrades","Expected array"),i):(fe(i,"$","Expected object"),i)},RA=t=>{const i=wA(t),a=[];if(!nn(i))throw new hg("TacticalDataPack",[{path:"$",message:"Expected pack object"}]);if((!_t(i.version)||!/^1\./.test(i.version))&&a.push({path:"$.version",message:"Expected v1.x string"}),Array.isArray(i.units)?i.units.forEach((o,c)=>{CA(o).forEach(f=>a.push({path:`$.units[${c}]${f.path.slice(1)}`,message:f.message}))}):a.push({path:"$.units",message:"Expected array"}),Array.isArray(i.skills)?i.skills.forEach((o,c)=>{NA(o).forEach(f=>a.push({path:`$.skills[${c}]${f.path.slice(1)}`,message:f.message}))}):a.push({path:"$.skills",message:"Expected array"}),a.length>0)throw new hg("TacticalDataPack",a);return i},kA=t=>({definition:t,drawOrder:[...t.instantiate.drawOrder],skillIds:[...t.skillLoadout.baseSkillIds],passiveSkillIds:[...t.skillLoadout.passiveSkillIds||[]]}),LA={Light:3,Standard:5,Heavy:8,Anchored:12,OuterWall:20},ps=t=>({version:"1.0.0",id:t.id,name:t.name,actorType:"enemy",subtype:t.subtype,factionId:"enemy",weightClass:t.weightClass,coordSpace:{system:"cube-axial",pointFormat:"qrs"},instantiate:{rngStream:"enemy.instantiate",seedSalt:t.subtype,counterMode:"consume_global",drawOrder:["body","mind","instinct","speed","mass"],includeRollTrace:!1},propensities:{body:{method:"fixed",value:t.trinity.body},mind:{method:"fixed",value:t.trinity.mind},instinct:{method:"fixed",value:t.trinity.instinct},speed:{method:"fixed",value:t.speed},mass:{method:"fixed",value:LA[t.weightClass]}},derivedStats:{maxHp:{formula:"trinity_hp_v1"}},physics:{collisionPolicy:"crush_damage",crushModel:{baseDamage:0,impulseMultiplier:1,massDivider:1,minDamage:1}},skillLoadout:{baseSkillIds:t.baseSkills,passiveSkillIds:t.passiveSkills||[]},runtimeDefaults:{startingHp:"maxHp",temporaryArmor:0,isVisible:!0}}),IA={version:"1.0.0",id:"SHIELD_BASH_V1",name:"Shield Bash V1",description:"Data-driven migration variant of shield bash.",slot:"offensive",keywords:["Momentum"],intentTags:["damage","control","move"],targeting:{mode:"single",range:1,requiresLos:!0,allowOccupied:!0,deterministicSort:"distance_then_q_then_r"},stackPolicy:{resolveOrder:"LIFO",reactionWindow:"automated",playerPriority:!1,emitTickEvents:!0},baseAction:{costs:{energy:0,cooldown:2,consumesTurn:!0},effects:[{id:"shield_bash_v1_force",kind:"APPLY_FORCE",tags:["movement","momentum"],target:{selector:"targetActor"},force:{mode:"push",direction:"source_to_target",magnitude:{base:2,scaling:[{stat:"body",coefficient:.2}],min:1,round:"floor"},maxDistance:3,collision:{onBlocked:"crush_damage",crushDamage:{base:1,scaling:[{stat:"momentum",coefficient:1}],min:1,round:"floor"}}}},{id:"shield_bash_v1_damage",kind:"DEAL_DAMAGE",tags:["damage","physical"],target:{selector:"targetActor"},amount:{base:2,scaling:[{stat:"body",coefficient:.4}],min:1,round:"floor"},damageClass:"physical",reason:"shield_bash_v1"}]},reactivePassives:[],upgrades:[],inhibit:{filterMode:"exclude_matching_tags",removableTags:["movement","momentum"]},preview:{dryRunEnabled:!0,eventMap:{APPLY_FORCE:"UnitMoved",DEAL_DAMAGE:"DamageTaken"}}},BA={version:"1.0.0",units:[ps({id:"ENEMY_FOOTMAN_V1",name:"Footman",subtype:"footman",weightClass:"Standard",speed:1,trinity:{body:0,mind:0,instinct:0},baseSkills:["BASIC_MOVE","BASIC_ATTACK"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_SPRINTER_V1",name:"Sprinter",subtype:"sprinter",weightClass:"Standard",speed:2,trinity:{body:0,mind:0,instinct:0},baseSkills:["BASIC_MOVE","BASIC_ATTACK"]}),ps({id:"ENEMY_RAIDER_V1",name:"Raider",subtype:"raider",weightClass:"Standard",speed:1,trinity:{body:.4,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","DASH"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_POUNCER_V1",name:"Pouncer",subtype:"pouncer",weightClass:"Standard",speed:1,trinity:{body:.4,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_SHIELDBEARER_V1",name:"Shield Bearer",subtype:"shieldBearer",weightClass:"Heavy",speed:1,trinity:{body:1,mind:0,instinct:.4},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_ARCHER_V1",name:"Archer",subtype:"archer",weightClass:"Standard",speed:1,trinity:{body:.2,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SPEAR_THROW"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_BOMBER_V1",name:"Bomber",subtype:"bomber",weightClass:"Standard",speed:1,trinity:{body:.4,mind:.2,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","BOMB_TOSS"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_WARLOCK_V1",name:"Warlock",subtype:"warlock",weightClass:"Standard",speed:1,trinity:{body:.4,mind:.6,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_SENTINEL_V1",name:"Sentinel",subtype:"sentinel",weightClass:"Heavy",speed:1,trinity:{body:4,mind:2,instinct:2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_TELEGRAPH","SENTINEL_BLAST"],passiveSkills:["AUTO_ATTACK"]})],skills:[IA]},jA=new Map,my=new Map,DA=t=>(jA.set(t.id,t),t.subtype&&my.set(t.subtype,t),t),HA=t=>t.map(DA),PA=t=>my.get(t);let py=!1;const UA=(t=BA)=>{const i=RA(t);return HA(i.units),SA(i.skills),py=!0,{unitsRegistered:i.units.length,skillsRegistered:i.skills.length}},hy=()=>py?{unitsRegistered:0,skillsRegistered:0}:UA(),gy=(t,i="none")=>i==="floor"?Math.floor(t):i==="round"?Math.round(t):i==="ceil"?Math.ceil(t):t,yy=(t,i)=>i?Math.max(i.min,Math.min(i.max,t)):t,qr=(t,i)=>yy(gy(t,i.round),i.clamp),qA=(t,i)=>{if(t.method==="fixed")return{value:qr(t.value,t),before:-1,after:-1,usedRng:!1};if(t.method==="uniform_int"){const f=i(),h=t.max-t.min+1,b=t.min+Math.floor(f.value*h)%Math.max(1,h);return{value:qr(b,t),before:f.before,after:f.after,usedRng:!0}}if(t.method==="triangular_int"){const f=i(),h=t.min,b=t.mode,y=t.max,A=(b-h)/Math.max(1e-9,y-h),v=f.value<A?h+Math.sqrt(f.value*(y-h)*(b-h)):y-Math.sqrt((1-f.value)*(y-h)*(y-b));return{value:qr(v,t),before:f.before,after:f.after,usedRng:!0}}const a=i(),o=t.table.reduce((f,h)=>f+h.weight,0);let c=a.value*Math.max(1e-9,o),r=t.table[t.table.length-1].value;for(const f of t.table)if(c-=f.weight,c<=0){r=f.value;break}return{value:qr(r,t),before:a.before,after:a.after,usedRng:!0}},yg=(t,i,a)=>{if(t.formula==="trinity_hp_v1")return uc(a);const o=t.base??0,r=(t.terms||[]).reduce((h,b)=>h+(i[b.stat]??0)*b.coefficient,o),f=gy(r,t.round);return yy(f,t.clamp)},zA=(t,i)=>!i||Object.keys(i).length===0?t:{...t,activeSkills:(t.activeSkills||[]).map(a=>{const o=i[a.id];return o===void 0?a:{...a,currentCooldown:Math.max(0,o)}})},$A=t=>t.id.toLowerCase(),VA=(t,i,a)=>{const o=i.definition,c=[];let r={rngSeed:t.rngSeed||"default",rngCounter:Math.max(0,t.rngCounter||0)},f=0;const h=`${r.rngSeed}:${o.instantiate.rngStream}:${o.instantiate.seedSalt||o.id}`,b=()=>{if(o.instantiate.counterMode==="consume_global"){const w=r.rngCounter,D=oc(r.rngSeed,w);return r={...r,rngCounter:w+1},{value:D,before:w,after:r.rngCounter}}const M=f;return{value:oc(h,f++),before:M,after:f}},y={};for(const M of i.drawOrder){const E=o.propensities[M];if(!E)continue;const w=qA(E,b);y[M]=w.value,w.usedRng&&c.push({key:M,method:E.method,value:w.value,counterBefore:w.before,counterAfter:w.after})}const A={body:y.body??0,mind:y.mind??0,instinct:y.instinct??0},v=o.derivedStats||{},x=v.maxHp?yg(v.maxHp,y,A):uc(A),_=y.speed??1,p=y.mass??1,g=o.runtimeDefaults?.startingHp==="explicit"?Math.max(0,o.runtimeDefaults.explicitHp??x):x,N=Gs({id:a.actorId||$A(o),type:o.actorType,subtype:a.subtype||o.subtype,position:a.position,hp:g,maxHp:x,speed:_,factionId:a.factionId||o.factionId,weightClass:o.weightClass,skills:[...i.skillIds,...i.passiveSkillIds],trinity:A});let I=zA(N,o.skillLoadout.startCooldowns);o.runtimeDefaults?.temporaryArmor!==void 0&&(I={...I,temporaryArmor:Math.max(0,o.runtimeDefaults.temporaryArmor)}),o.runtimeDefaults?.isVisible!==void 0&&(I={...I,isVisible:o.runtimeDefaults.isVisible}),y.maxHp=x,y.speed=_,y.mass=p;for(const[M,E]of Object.entries(v))M!=="maxHp"&&(y[M]=yg(E,y,A));return{actor:I,stats:y,trinity:A,speed:_,mass:p,nextCursor:r,rollTrace:c}},YA=(t,i,a)=>VA(t,kA(i),a),KA=(t,i)=>{const a=cc(i),o=Gb(Zr,ec),c=[],r=o,f=Math.floor(Zr/2),h=Bn(f,ec-1),b=Bn(f,0);let y;if(t%1===0){const E=r.filter(w=>!Q(w,h)&&!Q(w,b)&&_e(w,h)>=3);E.length>0&&(y=E[Math.floor(a.next()*E.length)])}const v=Math.floor(r.length*fS),x=[],_={playerStart:h,stairsPosition:b,shrinePosition:y},g=[...r.filter(E=>!Gh(E,_))].sort(()=>a.next()-.5);for(let E=0;E<v;E++)E<g.length&&x.push(g[E]);const N=r.filter(E=>!Gh(E,{playerStart:h,stairsPosition:b,shrinePosition:y})&&!c.some(w=>Q(w,E))&&!x.some(w=>Q(w,E))&&_e(E,h)>=3),I={id:"arena",type:"combat",center:Bn(Math.floor(Zr/2),Math.floor(ec/2)),hexes:o,connections:[]},M=new Map;for(const E of o)M.set(`${E.q},${E.r}`,{baseId:"STONE",position:E,traits:new Set(fo.STONE.defaultTraits),effects:[]});for(const E of c)M.set(`${E.q},${E.r}`,{baseId:"WALL",position:E,traits:new Set(fo.WALL.defaultTraits),effects:[]});for(const E of x)M.set(`${E.q},${E.r}`,{baseId:"LAVA",position:E,traits:new Set(fo.LAVA.defaultTraits),effects:[]});return{rooms:[I],allHexes:o,stairsPosition:b,shrinePosition:y,spawnPositions:N,playerSpawn:h,tiles:M}},FA=(t,i,a)=>{hy();const o=cc(a+":enemies"),c=Qh[Math.min(t,Qh.length-1)],r=xd[t]||xd[Math.max(...Object.keys(xd).map(Number))];let f={rngSeed:`${a}:enemy-propensity`,rngCounter:0};const h=[];let b=c;const y=[];for(;b>0&&y.length<i.length;){const A=r.filter(K=>{const ne=Pd[K];return ne&&ne.cost<=b});if(A.length===0)break;const v=Math.floor(o.next()*A.length),x=A[v],_=Pd[x],p=i.filter(K=>!y.some(ne=>Q(ne,K)));if(p.length===0)break;const g=Math.floor(o.next()*p.length),N=p[g];y.push(N);const I=Math.floor(t/5),M=_.weightClass||"Standard",E=(f.rngCounter<<8)+h.length,w=`enemy_${h.length}_${mo(a,E,6,x)}`,D=PA(x);let H;if(D){const K=YA(f,D,{actorId:w,position:N,subtype:x,factionId:"enemy"});f=K.nextCursor,H=K.actor}else H=YS({id:w,subtype:x,position:N,speed:_.speed||50,skills:FS(x),weightClass:M,enemyType:_.type});const C=I>0?{...H,hp:H.hp+I,maxHp:H.maxHp+I}:H;h.push({...C,subtype:x,enemyType:_.type,actionCooldown:_.actionCooldown??C.actionCooldown,isVisible:!0}),b-=_.cost}return h},GA=t=>mS[t]||"inferno",WA=(t,i)=>{const a=i.initialSeed??i.rngSeed??"0",o=i.commandLog?.length??0;return{id:mo(a,o,9,"cmd"),timestamp:i.turnNumber,action:t}},XA=(t,i,a)=>{const o=a.initialSeed??a.rngSeed??"0",c=a.undoStack?.length??0;return{id:mo(o,c,9,"delta"),undoData:{player:{...t.player},enemies:[...t.enemies],turnNumber:t.turnNumber,gameStatus:t.gameStatus}}},po={VANGUARD:{id:"VANGUARD",name:"Vanguard",description:"Direct damage, brawling, and area denial.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK","SPEAR_THROW","SHIELD_BASH","JUMP"]},SKIRMISHER:{id:"SKIRMISHER",name:"Skirmisher",description:"Zero direct damage. Kinetic momentum and environmental lethality.",startingUpgrades:[],startingSkills:["DASH","GRAPPLE_HOOK","SHIELD_THROW","VAULT"]},FIREMAGE:{id:"FIREMAGE",name:"Fire Mage",description:"Area control with fire and high-damage spells.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","ABSORB_FIRE","FIREBALL","FIREWALL","FIREWALK"]},NECROMANCER:{id:"NECROMANCER",name:"Necromancer",description:"Utilize death and reanimation.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","CORPSE_EXPLOSION","RAISE_DEAD","SOUL_SWAP"]},HUNTER:{id:"HUNTER",name:"Hunter",description:"Ranged precision and traps.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","FALCON_COMMAND","KINETIC_TRI_TRAP","WITHDRAWAL"]},ASSASSIN:{id:"ASSASSIN",name:"Assassin",description:"Stealth and high burst damage.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","SNEAK_ATTACK","SMOKE_SCREEN","SHADOW_STEP"]}},by=t=>{const i=t.startingSkills.map(o=>Ks(o)).filter(Boolean),a=t.id;return{upgrades:[...t.startingUpgrades],activeSkills:i,archetype:a}},QA=t=>t.some(i=>i.id==="BASIC_MOVE"||i.id==="DASH"),Sy=(t=[])=>{if(QA(t))return t;const i=Ks("BASIC_MOVE");return i?[i,...t]:t},Vd=t=>{const i=t.activeSkills||[],a=Sy(i);return a===i?t:{...t,activeSkills:a}};function JA(t){let i=t;const a=[],o=[],c=new Map(i.tiles);for(const[r,f]of c.entries()){const h=[];let b=!1;for(const v of f.effects){if(v.duration===-1){h.push(v);continue}const x=v.duration-1;x>0?(h.push({...v,duration:x}),b=!0):(a.push(`The ${v.id.toLowerCase()} died down.`),b=!0)}b&&c.set(r,{...f,effects:h});const y=[i.player,...i.enemies],A=v=>`${v.q},${v.r}`;for(const v of y)if(A(v.position)===r){const x=Aa.processStay(v,f,i);o.push(...x.effects),a.push(...x.messages)}}return i={...i,tiles:c},o.length>0&&(i=ui(i,o)),{state:i,messages:a}}class bg{getFalconIntent(i,a){const o=a.companionState?.mode||"roost",c=a.companionOf===i.player.id?i.player:i.enemies.find(f=>f.id===a.companionOf),r={expectedValue:0,reasoningCode:`FALCON_${o.toUpperCase()}`,isGhost:!1,rngConsumption:0};if(o==="scout")return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_SCOUT",targetHex:a.position,priority:10,metadata:r};if(o==="predator"&&typeof a.companionState?.markTarget=="string"){const f=i.enemies.find(b=>b.id===a.companionState.markTarget&&b.hp>0);if(!f)return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_AUTO_ROOST",targetHex:a.position,priority:9,metadata:{...r,reasoningCode:"FALCON_AUTO_ROOST"}};const h=_e(a.position,f.position);return h<=4?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_APEX_STRIKE",targetHex:f.position,primaryTargetId:f.id,priority:10,metadata:r}:h<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_PECK",targetHex:f.position,primaryTargetId:f.id,priority:9,metadata:r}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,a,f.position),primaryTargetId:f.id,priority:7,metadata:r}}return c?_e(a.position,c.position)<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_HEAL",targetHex:c.position,primaryTargetId:c.id,priority:10,metadata:r}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,a,c.position),primaryTargetId:c.id,priority:7,metadata:r}:{type:"WAIT",actorId:a.id,skillId:"WAIT_SKILL",priority:1,metadata:{...r,reasoningCode:"FALCON_WAIT"}}}findStepToward(i,a,o){const c=at(a.position).filter(r=>Ze.isWithinBounds(i,r)).filter(r=>Pe.isWalkable(i,r)).filter(r=>{const f=Ae(i,r);return!f||f.id===a.id});return c.length===0?a.position:c.sort((r,f)=>_e(r,o)-_e(f,o))[0]}getIntent(i,a){if(a.subtype==="falcon")return this.getFalconIntent(i,a);if(a.subtype==="bomb")return{type:"USE_SKILL",actorId:a.id,skillId:"TIME_BOMB",targetHex:a.position,priority:10,metadata:{expectedValue:0,reasoningCode:"BOMB_FUSE_TICK",isGhost:!1,rngConsumption:0}};const o=i.player.position,c=uS(a,o,{...i,occupiedCurrentTurn:i.occupiedCurrentTurn}),{entity:r,message:f}=c;let h="WAIT",b="WAIT_SKILL",y,A,v=10;const x=r.intent||"Waiting";if(x==="Moving"||x==="Advancing"||x==="Repositioning"||x==="Lumbering")h="MOVE",b="BASIC_MOVE",y=r.position;else if(x==="BASIC_ATTACK"){if(h="ATTACK",b="BASIC_ATTACK",y=r.intentPosition,y){const p=i.player.position.q===y.q&&i.player.position.r===y.r?i.player:i.enemies.find(g=>g.position.q===y?.q&&g.position.r===y?.r);p&&p.factionId!==a.factionId&&(A=p.id)}}else x==="SPEAR_THROW"?(h="USE_SKILL",b="SPEAR_THROW",y=r.intentPosition):x==="DASH"?(h="USE_SKILL",b="DASH",y=r.intentPosition):x==="GRAPPLE_HOOK"?(h="USE_SKILL",b="GRAPPLE_HOOK",y=r.intentPosition):x==="Bombing"?(h="USE_SKILL",b="BOMB_TOSS",y=r.intentPosition):x==="SENTINEL_BLAST"?(h="USE_SKILL",b="SENTINEL_BLAST",y=r.intentPosition):x==="SENTINEL_TELEGRAPH"?(h="USE_SKILL",b="SENTINEL_TELEGRAPH",y=r.intentPosition):(x==="Charging Power"||x==="Preparing")&&(h="WAIT",b="WAIT_SKILL");if(!(b==="WAIT_SKILL"||a.activeSkills?.some(p=>p.id===b)))h="WAIT",b="WAIT_SKILL",y=void 0,A=void 0;else if(b!=="WAIT_SKILL"){const p=Mn.get(b);p?.getValidTargets&&y&&(p.getValidTargets(i,a.position).some(I=>Q(I,y))||(h="WAIT",b="WAIT_SKILL",y=void 0,A=void 0))}return{type:h,actorId:a.id,skillId:b,primaryTargetId:A,targetHex:y,priority:v,metadata:{expectedValue:0,reasoningCode:x.toUpperCase().replace(" ","_"),isGhost:!1,rngConsumption:(f?.includes("teleports")||f?.includes("Bombing"),(c.nextState.rngCounter||0)-(i.rngCounter||0))}}}}class xl{inputQueue=[];resolveInput;pushIntent(i){this.inputQueue.push(i),this.resolveInput&&(this.resolveInput(i),this.resolveInput=void 0)}getIntent(i,a){return this.inputQueue.length>0?this.inputQueue.shift():new Promise(o=>{this.resolveInput=o})}}class Al{static strategies=new Map;static defaultEnemyStrategy=new bg;static defaultPlayerStrategy=new xl;static register(i,a){this.strategies.set(i,a)}static resolve(i){return this.strategies.has(i.id)?this.strategies.get(i.id):i.type==="player"?this.defaultPlayerStrategy:this.defaultEnemyStrategy}static reset(){this.strategies.clear(),this.defaultEnemyStrategy=new bg,this.defaultPlayerStrategy=new xl}}const vy=(t,i,a)=>ji(a)?{...t,type:"WAIT",skillId:"WAIT_SKILL",priority:0,metadata:{...t.metadata,reasoningCode:"STATUS_STUNNED"}}:t;class xy{static execute(i,a,o){return this.resolveExecution(i,a,o)}static simulate(i,a,o){return this.resolveExecution(i,a,o)}static resolveExecution(i,a,o){const c=[],r=[],f=Mn.get(i.skillId);if(!f&&i.type!=="WAIT")return{effects:[],messages:[`Failed to execute unknown skill: ${i.skillId}`],consumesTurn:!1};if(i.type==="WAIT")return{effects:[],messages:[],consumesTurn:!0};if(!(i.skillId==="WAIT_SKILL"||a.activeSkills.some(p=>p.id===i.skillId)))return{effects:[],messages:[`Actor ${a.id} does not have skill ${i.skillId} in loadout!`],consumesTurn:!1};const b=a.activeSkills.find(p=>p.id===i.skillId);if(b&&(b.currentCooldown||0)>0)return{effects:[],messages:[`${i.skillId} is on cooldown (${b.currentCooldown}).`],consumesTurn:a.type!=="player"};let y=i.targetHex,A=i.primaryTargetId;if(!y&&f&&(y=this.findOptimalTargetHex(i,a,o,f.baseVariables.range)),!y)return{effects:[],messages:[`No valid target found for ${i.skillId}`],consumesTurn:!1};if(y&&!A){const p=Ae(o,y);p&&(A=p.id)}const v=b?.activeUpgrades||[],x=f.execute(o,a,y,v),_=[...c,...x.effects];if(x.consumesTurn!==!1){let g=f.baseVariables.cooldown||0;for(const N of v){const I=f.upgrades?.[N];typeof I?.modifyCooldown=="number"&&(g+=I.modifyCooldown)}g=Math.max(0,g),g>0&&_.push({type:"ModifyCooldown",skillId:i.skillId,amount:g+1,setExact:!0})}return{effects:_,messages:[...r,...x.messages],consumesTurn:x.consumesTurn??!0,targetId:A,kills:x.kills||0}}static findOptimalTargetHex(i,a,o,c){if(i.primaryTargetId){const r=o.enemies.find(f=>f.id===i.primaryTargetId)||(o.player.id===i.primaryTargetId?o.player:void 0);if(r&&(i.type==="ATTACK"||i.type==="USE_SKILL"))return r.position}}}const Yd=(t,i)=>t.q!==i.q?t.q-i.q:t.r!==i.r?t.r-i.r:t.s-i.s,nc=(t,i)=>t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i),ZA=(t,i)=>{if(i.primaryTargetId)return nc(t,i.primaryTargetId);if(i.targetHex)return Ae(t,i.targetHex)},e1=(t,i,a)=>{const o=new Map,c=ZA(t,i),r=f=>{f&&o.set(de(f),f)};return a.forEach(f=>{f.type==="Damage"?typeof f.target=="string"&&f.target!=="targetActor"&&f.target!=="area"?r(nc(t,f.target)?.position):f.target==="targetActor"?r(c?.position):f.target==="area"?r(f.source):typeof f.target=="object"&&"q"in f.target&&r(f.target):f.type==="Impact"||f.type==="LavaSink"?r(nc(t,f.target)?.position):f.type==="Displacement"&&r(f.destination)}),[...o.values()].sort(Yd)},Sg=t=>{const i=[];t.enemies.filter(c=>c.hp>0&&c.factionId!==t.player.factionId).forEach(c=>{const f=Al.resolve(c).getIntent(t,c);if(f instanceof Promise)return;const h=vy(f,t,c);let b=h;h.skillId==="SENTINEL_TELEGRAPH"&&(b={...h,skillId:"SENTINEL_BLAST"});const y=xy.simulate(b,c,t),A=e1(t,b,y.effects);A.length!==0&&i.push({actorId:c.id,skillId:h.skillId,targetHex:h.targetHex,dangerTiles:A})}),i.sort((c,r)=>c.actorId!==r.actorId?c.actorId.localeCompare(r.actorId):c.skillId!==r.skillId?c.skillId.localeCompare(r.skillId):!c.targetHex&&!r.targetHex?0:c.targetHex?r.targetHex?Yd(c.targetHex,r.targetHex):1:-1);const o=new Map;return i.forEach(c=>c.dangerTiles.forEach(r=>o.set(de(r),r))),{sourceTurn:t.turnNumber,dangerTiles:[...o.values()].sort(Yd),projections:i}};var Ay={};const Kd=typeof process<"u"&&Ay?.HOP_ENGINE_DEBUG==="1",Ty=typeof process<"u"&&Ay?.HOP_ENGINE_WARN==="1",t1=Kd||Ty,Ey=(t,i)=>{if(t1){if(i){console.warn(`[TURN_STACK] ${t}`,i);return}console.warn(`[TURN_STACK] ${t}`)}},n1=(t,i,a,o)=>{const c=(t.pendingFrames?.length??0)+1;return{id:`${t.turnNumber}:${a}:${i}:${c}`,type:i,status:a,createdTurn:t.turnNumber,blocking:!0,payload:o}},dl=(t,i,a,o)=>{const c=n1(t,a,i.status,o);return{...t,pendingStatus:i,pendingFrames:[...t.pendingFrames||[],c]}},Fd=()=>{const t=gs();return{...t,gameStatus:"hub",message:[kt([],"Welcome to the Strategic Hub. Select your loadout.","INFO","SYSTEM")[0]],player:{...t.player,activeSkills:[]},hasSpear:!1,hasShield:!1}},gs=(t=1,i,a,o,c)=>{hy();const r=i||String(Date.now()),f=GA(t),h=KA(t,r),b=FA(t,h.spawnPositions||[],r),y=o?{hp:o.hp,maxHp:o.maxHp,speed:o.speed||Xh.speed}:{speed:Xh.speed},A=o?.upgrades||(c?c.startingUpgrades:[]),v=c?by(c):{activeSkills:xA(),archetype:"VANGUARD"},x=Sy(o?.activeSkills||v.activeSkills),_=o?.archetype||v.archetype,p=h.tiles||new Map,N={turnNumber:1,player:{...Gs({id:"player",type:"player",position:h.playerSpawn,hp:y.hp,maxHp:y.maxHp,speed:y.speed,factionId:"player",activeSkills:x,archetype:_,weightClass:"Standard",components:new Map}),previousPosition:h.playerSpawn},enemies:b.map(I=>({...I,previousPosition:I.position,statusEffects:I.statusEffects||[],temporaryArmor:I.temporaryArmor||0})),gridWidth:Zr,gridHeight:ec,gameStatus:"playing",message:t===1?[kt([],"Welcome to the arena. Survive.","INFO","SYSTEM")[0]]:kt(o?.message||[],`Floor ${t} - ${f.charAt(0).toUpperCase()+f.slice(1)}. Be careful.`,"INFO","OBJECTIVE"),hasSpear:!0,stairsPosition:h.stairsPosition,occupancyMask:[0n],shrinePosition:h.shrinePosition,shrineOptions:void 0,hasShield:!0,floor:t,upgrades:A,rooms:h.rooms,theme:f,commandLog:[],undoStack:[],rngSeed:r,initialSeed:a??(t===1?r:void 0),rngCounter:0,actionLog:[],kills:o&&o.kills||0,environmentalKills:o&&o.environmentalKills||0,turnsSpent:o&&o.turnsSpent||0,dailyRunDate:o?.dailyRunDate,runObjectives:o?.runObjectives||[],hazardBreaches:o?.hazardBreaches||0,completedRun:void 0,combatScoreEvents:o?.combatScoreEvents||[],dyingEntities:[],visualEvents:[],timelineEvents:[],intentPreview:void 0,initiativeQueue:void 0,tiles:p};return N.initiativeQueue=Ma(N),N.occupancyMask=Ze.refreshOccupancyMask(N),N},vg=(t,i,a,o)=>{const c=i==="player"?t.player:t.enemies.find(b=>b.id===i);if(!c)return{state:t,messages:[]};const r=[],f=[];return c.statusEffects.forEach(b=>{if(b.tickWindow===a&&b.onTick){const y=b.onTick(c,t);y&&r.push(...y)}}),{state:ui(t,r,{sourceId:i,stepId:o}),messages:f}},zr=(t,i=!1)=>{if(t.pendingStatus||(t.pendingFrames?.length??0)>0)return Ey("Blocked processNextTurn while pendingStatus is active.",{status:t.pendingStatus?.status,pendingFrames:t.pendingFrames?.length??0,turnNumber:t.turnNumber}),t;let a=t;const o=[],c=[];let r=0;const f=100;let h=!1;for(;r<f;){if(r++,a.player.hp<=0&&a.pendingStatus?.status!=="lost"){const ie=Sl(a);return dl({...a,message:kt(a.message,"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:ie},"RUN_LOST",{reason:"GLOBAL_DEATH_CHECK"})}a.occupancyMask=Ze.refreshOccupancyMask(a);let y;if((i&&r===1||h)&&a.initiativeQueue){h=!1;const ie=a.initiativeQueue;ie.entries.length>0&&ie.currentIndex>=0&&ie.currentIndex<ie.entries.length&&(y=ie.entries[ie.currentIndex].actorId)}else{const ie=OS(a);a={...a,initiativeQueue:ie.queue},y=ie.actorId??void 0}if(!y)break;const A=y==="player"?a.player:a.enemies.find(ie=>ie.id===y),v=`${a.turnNumber}:${a.initiativeQueue?.round??0}:${y}:${r}`;if(!A||A.hp<=0){a={...a,initiativeQueue:Td(a.initiativeQueue,y)};continue}if(MS(a.initiativeQueue)?.turnStartPosition||(a={...a,initiativeQueue:CS(a,A)}),!i||r>1){const ie=vg(a,y,"START_OF_TURN",v);if(a=ie.state,o.push(...ie.messages),y==="player"&&a.upgrades?.includes("RELIC_STEADY_PLATES")){const pe=Math.min(2,(a.player.temporaryArmor||0)+1);pe!==(a.player.temporaryArmor||0)&&(a={...a,player:{...a.player,temporaryArmor:pe}},o.push(kt([],"Steady Plates harden your stance.","INFO","COMBAT")[0]))}if(y==="player"){const pe=a.player.activeSkills?.find(Z=>Z.id==="SHIELD_BASH");if(!!pe?.activeUpgrades?.includes("PASSIVE_PROTECTION")&&(pe?.currentCooldown||0)===0){const Z=Math.max(a.player.temporaryArmor||0,1);Z!==(a.player.temporaryArmor||0)&&(a={...a,player:{...a.player,temporaryArmor:Z}},o.push(kt([],"Passive Protection braces your guard.","INFO","COMBAT")[0]))}}const Te=_A(a,a.player.position,y,v);a=Te.state,o.push(...Te.messages)}const _=y==="player"?a.player:a.enemies.find(ie=>ie.id===y);if(!_||_.hp<=0){a={...a,initiativeQueue:Td(a.initiativeQueue,y),message:Ki(a.message,o,"INFO","SYSTEM")};continue}const p=y==="player"?a.player:a.enemies.find(ie=>ie.id===y);if(!p||p.hp<=0)continue;let g,N=!1;if(ji(p))N=!0,g={type:"WAIT",actorId:p.id,skillId:"WAIT_SKILL",priority:0,metadata:{expectedValue:0,reasoningCode:"STATUS_STUNNED_AUTOSKIP",isGhost:!1}},y==="player"?o.push("You are stunned and skip your turn."):o.push(`${p.subtype||"Enemy"} is stunned and skips its turn.`);else{const Te=Al.resolve(p).getIntent(a,p);if(Te instanceof Promise){const pe=Sg(a);return{...a,intentPreview:pe,message:Ki(a.message,o,"INFO","SYSTEM"),dyingEntities:[...a.dyingEntities||[],...c]}}g=Te}const I=_.activeSkills.map(ie=>ie.id).join(", ");Kd&&(console.log(`[ENGINE] Actor: ${y} | Loadout: [${I}] | Pos: ${JSON.stringify(_.position)}`),console.log(`[ENGINE] Intent: ${g.type} | Skill: ${g.skillId} | TargetHex: ${g.targetHex?JSON.stringify(g.targetHex):"none"} | TargetId: ${g.primaryTargetId||"none"}`)),g.metadata.rngConsumption&&(a={...a,rngCounter:(a.rngCounter||0)+g.metadata.rngConsumption}),g=vy(g,a,p);const{effects:M,messages:E,consumesTurn:w,targetId:D,kills:H}=xy.execute(g,p,a);if(Kd&&console.log(`[ENGINE] ${y} intends ${g.type} (${g.skillId}) onto ${D||(g.targetHex?JSON.stringify(g.targetHex):"self")}`),Ty&&M.length===0&&g.type!=="WAIT"){const ie=`[ENGINE] WARNING: Intent ${g.type} (${g.skillId}) for actor ${y} produced ZERO effects!`;console.warn(ie)}const C=a,K=ui(a,M,{sourceId:y,targetId:D,stepId:v});if(y==="player"&&(K.kills=(K.kills||0)+(H||0)),w===!1){a={...C,message:Ki(a.message,E,"INFO","COMBAT")},h=!0;continue}if(a=K,o.push(...E),y!=="player"){const ie=a.enemies.find(Te=>Te.id===y);if(ie?.subtype==="bomber"){const Te=g.skillId==="BOMB_TOSS"?2:Math.max(0,(ie.actionCooldown??0)-1);ie.actionCooldown!==Te&&(a={...a,enemies:a.enemies.map(pe=>pe.id===y?{...pe,actionCooldown:Te}:pe)})}}const ne=y==="player"?a.player:a.enemies.find(ie=>ie.id===y);if(!ne||ne.hp<=0){if(y==="player"){const ie=Sl(a);return dl({...a,message:kt(Ki(a.message,o,"INFO","SYSTEM"),"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:ie},"RUN_LOST",{reason:"SELF_ACTION_DEATH"})}a={...a,enemies:a.enemies.filter(ie=>ie.id!==y),initiativeQueue:Td(a.initiativeQueue,y),message:Ki(a.message,o,"INFO","SYSTEM")};continue}const xe=vg(a,y,"END_OF_TURN",v);a=xe.state,o.push(...xe.messages),a={...a,enemies:a.enemies.map(ie=>ie.id===y?Jh(Fh(ie)):ie),player:y==="player"?Jh(Fh(a.player)):a.player,initiativeQueue:NS(a,y)};const oe=y==="player"?a.player:a.enemies.find(ie=>ie.id===y);if(!(N||g.metadata?.reasoningCode==="STATUS_STUNNED"||g.metadata?.reasoningCode==="STATUS_STUNNED_AUTOSKIP")&&oe&&oe.hp>0){const ie=RS(a,y)||oe.previousPosition||oe.position,Te=kS(a,y)??void 0,pe=Gv(a,oe,at(ie),ie,Te,v);a=pe.state,o.push(...pe.messages),y==="player"&&(a.kills=(a.kills||0)+pe.kills)}if(y==="player"){const ie=a.player.position;if(a.spearPosition&&Q(ie,a.spearPosition)){if(!!a.player.activeSkills?.find(Z=>Z.id==="SPEAR_THROW")?.activeUpgrades?.some(Z=>Z==="SPEAR_CLEAVE"||Z==="CLEAVE")){const Z=at(ie).map(ae=>a.enemies.find(Me=>Me.hp>0&&Q(Me.position,ae))).filter(ae=>!!ae&&ae.factionId!==a.player.factionId);if(Z.length>0){const ae=Z.map(Me=>({type:"Damage",target:Me.id,amount:1,reason:"spear_cleave_pickup"}));a=ui(a,ae,{sourceId:a.player.id,stepId:v}),o.push(`Spear cleave hit ${Z.length} target(s).`)}}a={...a,hasSpear:!0,spearPosition:void 0,message:kt(a.message,"Picked up your spear.","INFO","OBJECTIVE")}}const Te=JA(a);if(a=Te.state,o.push(...Te.messages),a={...a,turnNumber:a.turnNumber+1,turnsSpent:(a.turnsSpent||0)+1},a.traps&&a.traps.length>0&&(a={...a,traps:a.traps.map(pe=>({...pe,cooldown:Math.max(0,pe.cooldown-1)}))}),Zb(a,a.player.position)){const pe=a.player.activeSkills||[],$=new Set(pe.map(V=>V.id)),Z=new Map;for(const V of pe)Z.set(V.id,new Set(V.activeUpgrades||[]));const ae=Mn.getAllUpgrades().filter(V=>$.has(V.skillId)).filter(V=>{if(a.upgrades.includes(V.id))return!1;const ee=Z.get(V.skillId);return!ee||!ee.has(V.id)}).map(V=>V.id).filter((V,ee,ue)=>ue.indexOf(V)===ee),Me=[];let Se={...a};for(let V=0;V<3&&ae.length>0;V++){const ee=Ea(Se);Se=ee.nextState;const ue=Math.floor(ee.value*ae.length);Me.push(ae[ue]),ae.splice(ue,1)}const R=Me.length>0?Me:["EXTRA_HP"];return dl({...a,rngCounter:Se.rngCounter,message:kt(a.message,"A holy shrine! Choose an upgrade.","INFO","OBJECTIVE")},{status:"choosing_upgrade",shrineOptions:R},"SHRINE_CHOICE",{shrineOptions:R})}if(eS(a,a.player.position)){if(a.floor>=10){const $=Sl(a);return dl({...a,message:kt(a.message,`Arcade Cleared! Final Score: ${$.score}`,"INFO","OBJECTIVE")},{status:"won",completedRun:$},"RUN_WON",{score:$.score??0})}return dl({...a,message:kt(a.message,"Descending to the next level...","INFO","OBJECTIVE")},{status:"playing"},"STAIRS_TRANSITION",{nextFloor:a.floor+1})}}}const b=Sg(a);return{...a,intentPreview:b,message:Ki(a.message,o,"INFO","SYSTEM"),dyingEntities:[...a.dyingEntities||[],...c]}},i1=(t,i)=>{const a=Vd(t.player),o=a===t.player?t:{...t,player:a};if(o.gameStatus!=="playing"&&i.type!=="RESET"&&i.type!=="SELECT_UPGRADE"&&i.type!=="LOAD_STATE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN"&&i.type!=="EXIT_TO_HUB")return o;const c={...o,isShaking:!1,lastSpearPath:void 0,dyingEntities:[],occupiedCurrentTurn:void 0,visualEvents:[],timelineEvents:[]};switch(i.type){case"LOAD_STATE":{const v=i.payload;return Array.isArray(v.tiles)&&(v.tiles=new Map(v.tiles.map(([x,_])=>[x,{..._,traits:new Set(_.traits)}]))),v.player=Vd(bl(v.player)),v.enemies=(v.enemies||[]).map(bl),v.companions&&(v.companions=v.companions.map(bl)),v}case"RESET":{const x=t.player.archetype==="SKIRMISHER"?"SKIRMISHER":"VANGUARD",_=po[x];return gs(1,i.payload?.seed||String(Date.now()),void 0,void 0,_)}case"EXIT_TO_HUB":return Fd()}if(o.gameStatus!=="playing"&&i.type!=="SELECT_UPGRADE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN")return o;const r=WA(i,o),f=o;let h={...c,initiativeQueue:c.initiativeQueue};const y=((v,x)=>{if(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP"].includes(x.type)&&!gl(v))return v;switch(x.type){case"SELECT_UPGRADE":{if(!("payload"in x))return v;const p=x.payload;if(!(v.pendingStatus?.shrineOptions||v.shrineOptions||[]).includes(p))return{...v,message:kt(v.message,`Upgrade ${p} was not offered.`,"CRITICAL","SYSTEM")};let N=v.player,I=!1;const M=Mn.getUpgrade(p);if(M){const E=Mn.getSkillForUpgrade(p),w=!!E&&N.activeSkills.some(D=>D.id===E);if(E&&w){const D=JSON.stringify(N.activeSkills);N=yS(N,E,p),I=JSON.stringify(N.activeSkills)!==D}}else p==="EXTRA_HP"&&(N=hS(N,1,!0),I=!0);return!I&&p!=="EXTRA_HP"?{...v,message:kt(v.message,`Upgrade ${p} could not be applied.`,"CRITICAL","SYSTEM")}:{...v,player:N,upgrades:v.upgrades.includes(p)?v.upgrades:[...v.upgrades,p],gameStatus:"playing",shrinePosition:void 0,shrineOptions:void 0,pendingStatus:void 0,pendingFrames:void 0,message:kt(v.message,`Gained ${M?.name||p}!`,"INFO","OBJECTIVE")}}case"USE_SKILL":{const{skillId:p,target:g}=x.payload,N=Al.resolve(v.player);return N instanceof xl&&N.pushIntent({type:"USE_SKILL",actorId:v.player.id,skillId:p,targetHex:g,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),zr(v,!0)}case"MOVE":{if(!("payload"in x))return v;const p=x.payload,g=v.player.activeSkills||[],N=Di(v.enemies,p),I=["BASIC_ATTACK","BASIC_MOVE","DASH"],M=g.filter(K=>K.slot==="passive"),E=[...M.filter(K=>I.includes(K.id)),...M.filter(K=>!I.includes(K.id))];let w;for(const K of E){const ne=Mn.get(K.id);if(!ne?.getValidTargets)continue;if(ne.getValidTargets(v,v.player.position).some(oe=>Q(oe,p))){w=K.id;break}}if(!w){const K=g.some(xe=>xe.id==="BASIC_ATTACK"),ne=g.some(xe=>xe.id==="BASIC_MOVE");if(N&&K)w="BASIC_ATTACK";else if(!N&&ne)w="BASIC_MOVE";else return{...v,message:kt(v.message,N?"No valid passive attack for target.":"No valid passive movement for target.","CRITICAL","SYSTEM")}}const D=N?"ATTACK":"MOVE",H=w,C=Al.resolve(v.player);return C instanceof xl&&C.pushIntent({type:D,actorId:v.player.id,skillId:H,targetHex:p,primaryTargetId:N?.id,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),zr(v,!0)}case"WAIT":{const p=Al.resolve(v.player);return p instanceof xl&&p.pushIntent({type:"WAIT",actorId:v.player.id,skillId:"WAIT",priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),zr(v,!0)}case"APPLY_LOADOUT":{if(!("payload"in x))return v;const p=x.payload,g=by(p);return{...v,player:{...v.player,activeSkills:g.activeSkills,archetype:g.archetype},upgrades:g.upgrades,hasSpear:p.startingSkills.includes("SPEAR_THROW"),hasShield:p.startingSkills.includes("SHIELD_THROW")||v.hasShield,selectedLoadoutId:p.id,message:kt(v.message,`${p.name} selected.`,"INFO","SYSTEM")}}case"START_RUN":{const{loadoutId:p,seed:g,mode:N,date:I}=x.payload,M=po[p];if(!M)return v;if(N==="daily"){const E=Pv(I),w=Uv(E);return{...gs(1,g||w,void 0,void 0,M),dailyRunDate:E,runObjectives:qv(w),hazardBreaches:0}}return gs(1,g,void 0,void 0,M)}case"ADVANCE_TURN":return v.pendingStatus||(v.pendingFrames?.length??0)>0?(Ey("Ignored ADVANCE_TURN while pendingStatus is active.",{status:v.pendingStatus?.status,pendingFrames:v.pendingFrames?.length??0,turnNumber:v.turnNumber}),v):zr(v,!1);case"RESOLVE_PENDING":{const p=v.pendingFrames||[];if(p.length>1)return{...v,pendingFrames:p.slice(1)};if(!v.pendingStatus)return p.length===1?{...v,pendingFrames:[]}:v;const{status:g,shrineOptions:N,completedRun:I}=v.pendingStatus;if(g==="playing"&&v.gameStatus==="playing"){const M=v.initialSeed??v.rngSeed??"0",E=`${M}:${v.floor+1}`,w=v.enemies.filter(H=>H.hp>0&&H.factionId==="player"&&H.companionOf===v.player.id).sort((H,C)=>H.id.localeCompare(C.id)),D=gs(v.floor+1,E,M,{...v.player,hp:Math.min(v.player.maxHp,v.player.hp+1),upgrades:v.upgrades});if(w.length>0){const H=[D.player.position,...at(D.player.position)],C=[D.player,...D.enemies],K=[];for(let ne=0;ne<w.length;ne++){const xe=w[ne],oe=H[H.length-1]||D.player.position,ke=H.find(Te=>!C.some($=>Q($.position,Te))&&Pe.isWalkable(D,Te))||oe,ie={...xe,position:ke,previousPosition:ke};C.push(ie),K.push(ie)}D.enemies=[...D.enemies,...K],D.companions=[...D.companions||[],...K.filter(ne=>ne.companionOf===v.player.id)],D.initiativeQueue=Ma(D),D.occupancyMask=Ze.refreshOccupancyMask(D)}return{...D,actionLog:[...v.actionLog||[]],dailyRunDate:v.dailyRunDate,runObjectives:v.runObjectives,hazardBreaches:v.hazardBreaches||0,pendingFrames:void 0}}return{...v,gameStatus:g,shrineOptions:N||v.shrineOptions,completedRun:I||v.completedRun,pendingStatus:void 0,pendingFrames:void 0}}case"EXIT_TO_HUB":return Fd();default:return v}})(h,i),A=XA(f,y,t);return r.delta=A,{...y,commandLog:[...y.commandLog||[],r],undoStack:[...y.undoStack||[],A],actionLog:[...y.actionLog||[],i]}},$r={weightsByIntent:{offense:{survival:2.1,lethality:6.5,position:2.4,objective:.5,status:2.5,tempo:1.6,resource:1},defense:{survival:4.8,lethality:3.6,position:3,objective:.8,status:2.2,tempo:1.6,resource:1},positioning:{survival:2.3,lethality:3.8,position:3.1,objective:6,status:1.4,tempo:1.6,resource:1},control:{survival:2.3,lethality:4.2,position:2.8,objective:.6,status:3.4,tempo:1.6,resource:1}},thresholds:{defenseHpRatio:.45,defensePressureHpRatio:.65,defensePressureAdjacentHostiles:2,controlMinHostiles:3}};({...$r.weightsByIntent,offense:{...$r.weightsByIntent.offense},control:{...$r.weightsByIntent.control}},{...$r.thresholds});const xg={skill:{staticWeight:.5,powerCoeff:1,reachCoeff:1,safetyCoeff:1,tempoCoeff:1,complexityCoeff:1,perSkillScalar:{}},policy:{offenseWeight:1,defenseWeight:1,positioningWeight:1,statusWeight:1,riskPenaltyWeight:1}};({...xg.policy},{...xg.skill});const s1=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP","ADVANCE_TURN","SELECT_UPGRADE","RESOLVE_PENDING"]),a1=t=>typeof t=="object"&&t!==null,Ag=t=>{if(!Array.isArray(t))return{valid:!1,actions:[],errors:["Replay actions must be an array."]};const i=[],a=[];return t.forEach((o,c)=>{if(!a1(o)||typeof o.type!="string"){a.push(`Action[${c}] is not a valid action object with a "type" field.`);return}if(!s1.has(o.type)){a.push(`Action[${c}] type "${o.type}" is not replayable.`);return}i.push(o)}),{valid:a.length===0,actions:i,errors:a}},Ta=t=>({q:t.q,r:t.r,s:t.s}),Vr=t=>({...t,position:Ta(t.position),previousPosition:t.previousPosition?Ta(t.previousPosition):void 0,intentPosition:t.intentPosition?Ta(t.intentPosition):void 0,statusEffects:t.statusEffects.map(i=>({...i})),activeSkills:t.activeSkills.map(i=>({...i,upgrades:[...i.upgrades||[]],activeUpgrades:[...i.activeUpgrades||[]]})),components:t.components?new Map(t.components):void 0,companionState:t.companionState?{...t.companionState,markTarget:typeof t.companionState.markTarget=="object"&&t.companionState.markTarget?Ta(t.companionState.markTarget):t.companionState.markTarget}:void 0}),o1=t=>({...t,player:Vr(t.player),enemies:t.enemies.map(Vr),companions:t.companions?.map(Vr),dyingEntities:t.dyingEntities?.map(Vr),message:[...t.message],visualEvents:[...t.visualEvents||[]],simulationEvents:[...t.simulationEvents||[]],stackTrace:t.stackTrace?t.stackTrace.map(i=>({...i})):void 0,timelineEvents:t.timelineEvents?t.timelineEvents.map(i=>({...i})):void 0,occupancyMask:[...t.occupancyMask],tiles:new Map(Array.from(t.tiles.entries()).map(([i,a])=>[i,{...a,position:Ta(a.position),traits:new Set(a.traits),effects:a.effects.map(o=>({...o}))}])),traps:t.traps?.map(i=>({...i,position:Ta(i.position)})),lastSpearPath:t.lastSpearPath?.map(Ta),actionLog:t.actionLog?[...t.actionLog]:void 0}),Tg=(t,i)=>t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i),l1=(t,i)=>{if(i)return Ae(t,i)?.id},r1=(t,i)=>{const a=Tg(t,i.actorId);if(!a)return{ok:!1,reason:`Actor ${i.actorId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const o=Mn.get(i.skillId);if(!o)return{ok:!1,reason:`Skill ${i.skillId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};if(i.target&&o.getValidTargets&&!o.getValidTargets(t,a.position).some(x=>de(x)===de(i.target)))return{ok:!1,reason:`Target ${de(i.target)} is invalid`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const c=o1(t),r=Tg(c,i.actorId),f=o.execute(c,r,i.target,i.activeUpgrades||[],i.context||{}),h=c.simulationEvents?.length||0,b=c.stackTrace?.length||0,y=l1(c,i.target),A=ui(c,f.effects,{sourceId:r.id,targetId:y});return{ok:!0,effects:f.effects,messages:f.messages,consumesTurn:f.consumesTurn,predictedState:A,simulationEvents:(A.simulationEvents||[]).slice(h),stackTrace:(A.stackTrace||[]).slice(b)}},c1=t=>({q:t.q,r:t.r,s:t.s}),u1=t=>{const i=[t.player,...t.enemies,...t.companions||[],...t.dyingEntities||[]];return{turn:t.turnNumber||0,stackTick:t.stackTrace?.length||0,actors:i.map(a=>({id:a.id,position:c1(a.position)}))}},d1=(t,i)=>{const a=[],o=new Map(t.actors.map(r=>[r.id,r.position])),c=new Map(i.actors.map(r=>[r.id,r.position]));for(const[r,f]of o.entries()){const h=c.get(r);if(!h){a.push({actorId:r,expected:f,reason:"missing_in_ui"});continue}de(f)!==de(h)&&a.push({actorId:r,expected:f,actual:h,reason:"position_mismatch"})}for(const[r,f]of c.entries())o.has(r)||a.push({actorId:r,actual:f,reason:"missing_in_engine"});return{ok:a.length===0,mismatches:a}},fl={player:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},vanguard:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},skirmisher:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#fbbf24",isRanged:!1},firemage:{icon:"",shape:"square",color:"#ef4444",borderColor:"#fbbf24",isRanged:!0},necromancer:{icon:"",shape:"square",color:"#6b21a8",borderColor:"#9333ea",isRanged:!0},hunter:{icon:"",shape:"square",color:"#10b981",borderColor:"#ffffff",isRanged:!0},assassin_player:{icon:"",shape:"square",color:"#1f2937",borderColor:"#ffffff",isRanged:!1},footman:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1},sprinter:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1,size:.9},spear:{icon:"",shape:"circle",color:"#ffffff",borderColor:"#3b82f6",isRanged:!1,size:.8,opacity:.9},shieldBearer:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#fbbf24",isRanged:!1,showFacing:!0},golem:{icon:"",shape:"diamond",color:"#78716c",borderColor:"#ffffff",isRanged:!1,size:1.2},assassin:{icon:"",shape:"diamond",color:"#6b21a8",borderColor:"#ffffff",isRanged:!1},archer:{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},bomber:{icon:"",shape:"circle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},warlock:{icon:"",shape:"triangle",color:"#9333ea",borderColor:"#ffffff",isRanged:!0},bomb:{icon:"",shape:"circle",color:"#1f2937",borderColor:"#000000",isRanged:!1,showTimer:!0},falcon:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},skeleton:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},sentinel:{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!0,size:1.5}};function _l(t,i,a,o){if(t&&fl[t])return fl[t];if(i==="player"&&o){const c=o==="ASSASSIN"?"assassin_player":o.toLowerCase();if(fl[c])return fl[c]}return i==="player"?fl.player:a==="ranged"?{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0}:a==="boss"?{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!1,size:1.5}:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1}}function f1(t){return t.isFlying===!0}const Rd=t=>{const i=[];for(let a=0;a<6;a++){const o=60*a,c=Math.PI/180*o,r=t*Math.cos(c),f=t*Math.sin(c);i.push(`${r},${f}`)}return i.join(" ")},m1=()=>typeof window>"u"?!1:!!window.__HOP_DEBUG_HEX_COORDS,p1=[{cx:-8,cy:-6,r:3,delay:0},{cx:6,cy:2,r:2.5,delay:.3},{cx:-3,cy:8,r:2,delay:.6}],h1=t=>{const i=[[-.6,.42],[-.5,.15],[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2],[.48,.1],[.6,.4],[.4,.48],[-.48,.48]],a=[[-.48,.48],[-.6,.42],[-.34,-.18],[-.18,-.24],[-.28,.28]],o=[[.6,.4],[.4,.48],[.2,.28],[.3,-.2],[.48,.1]],c=[[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2]],r=[[-.46,.1],[-.3,-.12],[-.1,-.24],[0,-.4]],f=h=>h.map(([b,y])=>`${(b*t).toFixed(2)},${(y*t).toFixed(2)}`).join(" ");return{body:f(i),leftFace:f(a),rightFace:f(o),ridgeA:f(c),ridgeB:f(r)}},g1=({hex:t,onClick:i,isValidMove:a,isTargeted:o,isStairs:c,isLava:r,isShrine:f,isWall:h,isFire:b,onMouseEnter:y,assetHref:A,interactionOnly:v})=>{const[x,_]=O.useState(!1);O.useEffect(()=>{_(!1)},[A]);const{x:p,y:g}=St(t,te),N=m1(),I=Rd(te-2),M=h1(te-2),E=`hex-clip-${t.q}-${t.r}-${t.s}`;let w=Hr.floor,D="rgba(0,0,0,0.2)",H="default";h?(w=Hr.wall,D="#1f2937"):r?(w="#7f1d1d",D="#7f1d1d"):b?(w="#7c2d12",D="#ea580c"):c?(w=Hr.portal,D="#000000"):f&&(w=Hr.shrine,D="#c2410c"),v&&(w="transparent",D="rgba(255,255,255,0.10)"),a&&(D="#ffffff",H="pointer"),o&&(D="#ff0000");const C=!!A&&!v&&!x;return m.jsxs("g",{transform:`translate(${p},${g})`,onClick:()=>i(t),onMouseEnter:()=>y?.(t),style:{cursor:H},className:"hex-tile transition-colors duration-200",children:[h&&C&&m.jsx("polygon",{points:Rd(te-2),fill:"#111827",transform:"translate(0, 4)"}),!C&&(h?m.jsxs("g",{"data-wall-fallback":"relief",children:[m.jsx("ellipse",{cx:"0",cy:te*.56,rx:te*.56,ry:te*.18,fill:"rgba(3,7,18,0.55)"}),m.jsx("polygon",{points:I,fill:"#0f172a",transform:"translate(0, 5)",opacity:"0.92"}),m.jsx("polygon",{points:I,fill:"#1f2937",transform:"translate(0, 2)",opacity:"0.98"}),m.jsx("polygon",{points:I,fill:"#273447"}),m.jsx("polygon",{points:M.body,fill:"#4b5563",opacity:"0.96"}),m.jsx("polygon",{points:M.leftFace,fill:"#6b7280",opacity:"0.9"}),m.jsx("polygon",{points:M.rightFace,fill:"#374151",opacity:"0.95"}),m.jsx("polyline",{points:M.ridgeA,fill:"none",stroke:"rgba(229,231,235,0.55)",strokeWidth:"1.1",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("polyline",{points:M.ridgeB,fill:"none",stroke:"rgba(17,24,39,0.58)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("polygon",{points:I,fill:"none",stroke:D,strokeWidth:o||a?"3":"1"})]}):m.jsx("polygon",{points:I,fill:w,stroke:D,strokeWidth:o||a?"3":"1"})),C&&m.jsxs(m.Fragment,{children:[m.jsx("defs",{children:m.jsx("clipPath",{id:E,children:m.jsx("polygon",{points:I})})}),m.jsx("image",{href:A,x:-te,y:-31.176,width:te*2,height:te*1.732,preserveAspectRatio:"xMidYMid slice",clipPath:`url(#${E})`,onError:()=>_(!0)}),m.jsx("polygon",{points:I,fill:"none",stroke:D,strokeWidth:o||a?"3":"1"})]}),r&&!v&&m.jsxs("g",{className:"lava-bubbles",children:[p1.map((K,ne)=>m.jsx("circle",{cx:K.cx,cy:K.cy,r:K.r,fill:"#fbbf24",opacity:"0.7",style:{animation:`lavaBubble 2s ease-in-out ${K.delay}s infinite`}},ne)),m.jsx("polygon",{points:Rd(te-4),fill:"none",stroke:"#f97316",strokeWidth:"1",opacity:"0.35"})]}),b&&!v&&m.jsxs("g",{className:"fire-embers",children:[m.jsx("circle",{cx:"-6",cy:"4",r:"2",fill:"#fbbf24",opacity:"0.75",style:{animation:"lavaBubble 1.6s ease-in-out 0s infinite"}}),m.jsx("circle",{cx:"4",cy:"-6",r:"1.5",fill:"#fcd34d",opacity:"0.75",style:{animation:"lavaBubble 1.4s ease-in-out 0.5s infinite"}})]}),N&&m.jsx("text",{x:"0",y:"0",textAnchor:"middle",fill:"rgba(0,0,0,0.15)",fontSize:"8",dy:".3em",pointerEvents:"none",children:`${t.q},${t.r}`})]})},y1=Ii.memo(g1,(t,i)=>t.hex.q===i.hex.q&&t.hex.r===i.hex.r&&t.hex.s===i.hex.s&&t.onClick===i.onClick&&t.onMouseEnter===i.onMouseEnter&&t.isCenter===i.isCenter&&t.isSelected===i.isSelected&&t.isValidMove===i.isValidMove&&t.isTargeted===i.isTargeted&&t.isStairs===i.isStairs&&t.isLava===i.isLava&&t.isShrine===i.isShrine&&t.isWall===i.isWall&&t.isFire===i.isFire&&t.assetHref===i.assetHref&&t.interactionOnly===i.interactionOnly),b1={catacombs:.2,inferno:.16,throne:.24,frozen:.45,void:.08},S1=(t,i)=>{const a=Math.max(t,i),o=Math.min(t,i);return(a+.05)/(o+.05)},Eg=(t,i)=>{const a=[];for(let o=0;o<6;o++){const c=Math.PI/3*o;a.push(`${Math.cos(c)*t},${Math.sin(c)*i}`)}return a.join(" ")},v1=(t,i,a=24,o,c,r=1)=>{const f=_l(t.subtype,t.type,t.enemyType,t.archetype),{icon:h,shape:b,color:y,borderColor:A,size:v=1}=f,x=a*v,_=t.statusEffects?.find(I=>I.type==="time_bomb"),p=_?Math.max(0,_.duration):t.actionCooldown??0,g=`contrast(${r.toFixed(2)}) brightness(${(r>1?1.12:1.04).toFixed(2)})`,N=i?`drop-shadow(0 3px 4px rgba(0,0,0,0.45)) drop-shadow(0 0 2px rgba(255,255,255,0.5)) saturate(1.08) ${g}`:`drop-shadow(0 3px 4px rgba(0,0,0,0.50)) drop-shadow(0 0 2px rgba(255,255,255,0.35)) saturate(1.0) ${g}`;return m.jsxs("g",{children:[m.jsx("title",{children:i?"Player":`${t.subtype||"Enemy"}`}),o&&m.jsx("image",{href:o,x:-x,y:-x,width:x*2,height:x*2,preserveAspectRatio:"xMidYMid meet",onError:c,style:{filter:N,opacity:i?1:.97}}),!o&&b==="square"&&m.jsx("rect",{x:-x*.8,y:-x*.8,width:x*1.6,height:x*1.6,fill:y,stroke:A,strokeWidth:2}),!o&&b==="diamond"&&m.jsx("path",{d:`M0 ${-x*.8} L${x*.6} 0 L0 ${x*.8} L${-x*.6} 0 Z`,fill:y,stroke:A,strokeWidth:1}),!o&&b==="triangle"&&m.jsx("path",{d:`M0 ${-x*.8} L${x*.7} ${x*.5} L${-x*.7} ${x*.5} Z`,fill:y,stroke:A,strokeWidth:1}),!o&&b==="circle"&&m.jsx("circle",{r:x*.7,fill:y,stroke:A,strokeWidth:1}),t.subtype==="bomb"&&m.jsx("text",{y:x*.2,textAnchor:"middle",fill:"#fff",fontSize:"10",fontWeight:"bold",children:p}),!o&&!i&&t.subtype!=="bomb"&&m.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:x*.8,opacity:.8,children:h}),!o&&i&&m.jsx("path",{d:`M0 ${-x*.4} L0 ${x*.4} M${-x*.15} ${-x*.2} L0 ${-x*.5} L${x*.15} ${-x*.2}`,stroke:A,strokeWidth:2,fill:"none"})]})},x1=({entity:t,isSpear:i,isDying:a,movementTrace:o,waapiControlled:c=!1,assetHref:r,fallbackAssetHref:f,floorTheme:h})=>{const[b,y]=O.useState(t.position),[A,v]=O.useState(()=>St(t.position,te)),[x,_]=O.useState(t.previousPosition),[p,g]=O.useState(220),[N,I]=O.useState("cubic-bezier(0.22, 1, 0.36, 1)"),[M,E]=O.useState("none"),w=O.useRef(!1),D=O.useRef(t.position),H=O.useRef([]),C=O.useRef(null),[K,ne]=O.useState(!1),xe=O.useRef(t.hp),oe=t.type==="player",ke=t.intentPosition?St(t.intentPosition,te):null,ie=typeof window<"u"&&!!window.__HOP_DEBUG_MOVEMENT,[Te,pe]=O.useState(r||f),[$,Z]=O.useState(!1);O.useEffect(()=>{pe(r||f),Z(!1)},[r,f,t.id]);const ae=()=>{if(!$&&f&&Te!==f){pe(f),Z(!0);return}pe(void 0)};O.useEffect(()=>{const Fe=()=>{for(const pt of H.current)clearTimeout(pt);H.current=[],C.current!==null&&(cancelAnimationFrame(C.current),C.current=null)};if(c){Fe(),w.current=!1;const pt=!!(o&&o.actorId===t.id&&o.destination&&Q(o.destination,t.position)),Dt=!Q(t.position,D.current);D.current=t.position,Dt&&!pt&&(y(t.position),_(t.previousPosition),v(St(t.position,te))),M!=="none"&&E("none"),p!==0&&g(0),N!=="linear"&&I("linear");return}if(!Q(t.position,D.current)){D.current=t.position;const pt=o&&o.actorId===t.id&&o.destination&&Q(o.destination,t.position)&&Array.isArray(o.path)&&o.path.length>0,Dt=pt?o.path:void 0,Sn=pt?o.movementType:void 0,cn=pt?Math.max(0,o.startDelayMs??0):0;if(ie){const Tt=t.previousPosition?Lt(t.previousPosition,t.position).length:0;console.log("[HOP_MOVE]",{actorId:t.id,movementType:Sn||"fallback",usedEngineTrace:pt,tracePathLength:Dt?.length||0,tracePath:Dt||[],startDelayMs:cn,fallbackPathLength:Tt,origin:o?.origin||t.previousPosition,destination:t.position})}if(Sn==="teleport"&&pt&&o.origin){Fe(),w.current=!0;const Tt=o.durationMs??180,Ve=Math.max(80,Math.floor(Tt/2)),Kt=()=>{g(0),I("linear"),_(o.origin),y(o.origin),v(St(o.origin,te)),E("out");const Je=window.setTimeout(()=>{y(t.position),_(t.position),v(St(t.position,te)),E("in")},Ve),et=window.setTimeout(()=>{E("none"),w.current=!1},Ve*2);H.current.push(Je,et)};if(cn>0){const Je=window.setTimeout(Kt,cn);H.current.push(Je)}else Kt();return()=>{Fe(),w.current=!1}}const vn=!!(t.previousPosition&&!Q(t.position,t.previousPosition));if(!!(Dt&&Dt.length>1)||vn){let Ve=Dt||(t.previousPosition?Lt(t.previousPosition,t.position):[]);if(pt&&o?.origin&&Ve.length>1&&Q(Ve[Ve.length-1],o.origin)&&!Q(Ve[0],o.origin)&&(Ve=[...Ve].reverse()),Ve.length>1){Fe(),w.current=!0;const Kt=Math.max(1,Ve.length-1),Je=o?.durationMs?o.durationMs/Kt:0,et=Math.max(90,Math.min(130,Je||112)),Et=et*Kt,un=Ve.map(ht=>St(ht,te)),Hn=performance.now(),Jn=ht=>ht<.5?4*ht*ht*ht:1-Math.pow(-2*ht+2,3)/2;E("none"),g(0),I("linear"),y(Ve[0]),_(Ve[0]),v(un[0]);let On=-1;const dn=ht=>{const Ht=Math.max(0,ht-Hn),Ft=Math.min(Kt-1,Math.floor(Ht/et)),Rn=Ft*et,Hi=Ht-Rn,Zn=Math.max(0,Math.min(1,Hi/et)),fn=Jn(Zn);Ft!==On&&(_(Ve[Ft]),y(Ve[Math.min(Ve.length-1,Ft+1)]),On=Ft);const Gt=un[Ft],Pn=un[Math.min(un.length-1,Ft+1)];if(v({x:Gt.x+(Pn.x-Gt.x)*fn,y:Gt.y+(Pn.y-Gt.y)*fn}),Ht<Et){C.current=requestAnimationFrame(dn);return}w.current=!1,y(t.position),_(t.previousPosition),v(un[un.length-1]),C.current=null};if(cn>0){const ht=window.setTimeout(()=>{C.current=requestAnimationFrame(dn)},cn);H.current.push(ht)}else C.current=requestAnimationFrame(dn);return()=>{Fe(),w.current=!1}}}E("none"),g(220),I("cubic-bezier(0.22, 1, 0.36, 1)"),y(t.position),_(t.previousPosition),v(St(t.position,te))}},[t.position,t.previousPosition,o,t.id,c]);const{x:Me,y:Se}=A||St(b,te);O.useEffect(()=>{if(t.hp<xe.current){ne(!0);const Fe=setTimeout(()=>ne(!1),150);return()=>clearTimeout(Fe)}xe.current=t.hp},[t.hp]);let R="";const V=x;if(V&&!Q(b,V)){const Fe=Fs(V,b);if(Fe!==-1){const pt=Fe*60;R=`rotate(${pt}) scale(1.15, 0.85) rotate(${-pt})`}}const ee=t.isVisible===!1;if(i){const Fe=_l("spear","enemy");return m.jsx("g",{style:{pointerEvents:"none"},children:m.jsx("g",{transform:`translate(${Me},${Se})`,children:m.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:"20",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5))"},children:Fe.icon})})})}const ue=_l(t.subtype,t.type,t.enemyType,t.archetype),Ce=f1(t),Ne=oe?1.34:.92,Re=oe?-9:-2,mt=oe?24:18,qe=String(h||"").toLowerCase(),It=b1[qe]??.22,Ue=S1(It,oe?.87:.82),xt=Ue<4.5?1.22:1.06,Bt=Ue<4.5?.62:.42,ct=oe?"#22e7ff":"#ff4fd0",Vt=oe?"rgba(34,231,255,0.22)":"rgba(255,79,208,0.22)",rn=oe?"rgba(34,231,255,0.48)":"rgba(255,79,208,0.46)",$e=oe?te*.5:te*.46,it=oe?te*.2:te*.18,bn=O.useMemo(()=>Eg($e,it),[$e,it]),Ei=O.useMemo(()=>Eg($e*.86,it*.84),[$e,it]),Qn=oe?te*.32:te*.3,Dn=oe?"rgba(190,250,255,0.86)":"rgba(255,201,241,0.86)";return m.jsxs("g",{style:{pointerEvents:"none"},children:[ke&&!oe&&!ji(t)&&m.jsx("line",{x1:Me,y1:Se,x2:ke.x,y2:ke.y,stroke:t.subtype==="warlock"?"#9333ea":"#ef4444",strokeWidth:"3",strokeDasharray:"4 2",opacity:"0.6"}),m.jsx("g",{"data-actor-node":t.id,style:{transition:c?"none":`transform ${p}ms ${N}`,transform:`translate(${Me}px, ${Se}px)`},className:a?"animate-lava-sink":"",children:m.jsxs("g",{transform:R,className:`${K?"entity-damaged":""} ${!a&&!ji(t)?"animate-idle":""} ${M==="out"?"entity-teleport-out":""} ${M==="in"?"entity-teleport-in":""}`,opacity:ee?.3:ue.opacity||1,style:{filter:ee?"blur(1px)":"none"},children:[m.jsx("circle",{r:oe?te*.92:te*.84,cy:Qn-2,fill:oe?"rgba(6,15,23,0.84)":"rgba(22,7,18,0.84)",opacity:Bt}),m.jsxs("g",{transform:`translate(0,${Qn})`,children:[m.jsx("polygon",{points:bn,fill:Vt,stroke:ct,strokeWidth:2,style:{filter:`drop-shadow(0 0 5px ${rn})`}}),m.jsx("polygon",{points:Ei,fill:"none",stroke:ct,strokeWidth:1.4,opacity:.82})]}),Ce&&m.jsx("ellipse",{cx:0,cy:te*.3,rx:te*.4,ry:te*.15,fill:"black",opacity:.2}),m.jsxs("g",{transform:`translate(0,${Re}) scale(${Ne})`,children:[m.jsx("circle",{r:Math.max(10,mt*.84),fill:"none",stroke:Dn,strokeWidth:2,opacity:.68,style:{filter:"drop-shadow(0 0 3px rgba(255,255,255,0.45))"}}),v1(t,oe,mt,Te,ae,xt)]}),ji(t)&&m.jsxs("g",{transform:`translate(0, -${te*.8})`,className:"stun-icon",children:[m.jsx("text",{fontSize:"14",textAnchor:"middle",children:"*"}),m.jsx("text",{fontSize:"8",textAnchor:"middle",dy:"-3",dx:"6",children:"+"})]}),ue.showFacing&&t.facing!==void 0&&!ji(t)&&m.jsx("line",{x1:0,y1:0,x2:Math.cos((t.facing*60-90)*Math.PI/180)*te*.5,y2:Math.sin((t.facing*60-90)*Math.PI/180)*te*.5,stroke:ue.borderColor,strokeWidth:3,strokeLinecap:"round"}),!oe&&t.intent&&!ji(t)&&m.jsx("text",{x:0,y:-te*.6,textAnchor:"middle",fontSize:8,fill:"#ef4444",fontWeight:"bold",children:t.intent}),m.jsx("title",{children:`${t.subtype||t.type} - HP ${t.hp}/${t.maxHp}${t.intent?` - ${t.intent}`:""}`})]})})]})},_g=t=>{if(!t)return"";const i=(t.path||[]).map(a=>`${a.q},${a.r},${a.s}`).join(";");return`${t.actorId}|${t.movementType||""}|${t.destination?.q??""},${t.destination?.r??""},${t.destination?.s??""}|${i}|${t.durationMs??""}|${t.startDelayMs??0}|${t.wasLethal?1:0}`},wg=(t=[])=>t.map(i=>`${i.id}:${i.duration??""}:${i.stacks??""}`).join("|"),Yr=Ii.memo(x1,(t,i)=>{const a=t.entity,o=i.entity;return t.isSpear===i.isSpear&&t.isDying===i.isDying&&t.waapiControlled===i.waapiControlled&&t.assetHref===i.assetHref&&t.fallbackAssetHref===i.fallbackAssetHref&&t.floorTheme===i.floorTheme&&_g(t.movementTrace)===_g(i.movementTrace)&&a.id===o.id&&a.hp===o.hp&&a.maxHp===o.maxHp&&a.facing===o.facing&&a.intent===o.intent&&a.isVisible===o.isVisible&&a.position.q===o.position.q&&a.position.r===o.position.r&&a.position.s===o.position.s&&(a.previousPosition?.q??0)===(o.previousPosition?.q??0)&&(a.previousPosition?.r??0)===(o.previousPosition?.r??0)&&(a.previousPosition?.s??0)===(o.previousPosition?.s??0)&&(a.intentPosition?.q??0)===(o.intentPosition?.q??0)&&(a.intentPosition?.r??0)===(o.intentPosition?.r??0)&&(a.intentPosition?.s??0)===(o.intentPosition?.s??0)&&wg(a.statusEffects)===wg(o.statusEffects)}),A1=({gameState:t,selectedSkillId:i,showMovementRange:a,hoveredTile:o,enginePreviewGhost:c})=>{const r=t.player.position,f=O.useMemo(()=>{const x=new Set;for(const _ of t.enemies)_.hp>0&&x.add(de(_.position));return x},[t.enemies]),h=O.useMemo(()=>{if(!a||i)return[];const x=new Set(t.player.activeSkills.map(N=>N.id)),_=["BASIC_MOVE","DASH"],p=new Set,g=[];return _.forEach(N=>{if(x.has(N)){const I=Mn.get(N);I?.getValidTargets&&I.getValidTargets(t,r).forEach(E=>{const w=de(E);p.has(w)||(p.add(w),g.push(E))})}}),g.length===0?[{q:r.q+1,r:r.r,s:r.s-1},{q:r.q+1,r:r.r-1,s:r.s},{q:r.q,r:r.r-1,s:r.s+1},{q:r.q-1,r:r.r,s:r.s+1},{q:r.q-1,r:r.r+1,s:r.s},{q:r.q,r:r.r+1,s:r.s-1}].filter(I=>Ws(I,t.gridWidth,t.gridHeight)):g},[t,a,i,r]),b=O.useMemo(()=>{const x=new Set;for(const _ of h)x.add(de(_));return x},[h]),y=O.useMemo(()=>{if(!i)return[];const x=Mn.get(i),_=TA(t.player,i)||x?.baseVariables?.range||0,p=x?.getValidTargets?x.getValidTargets(t,r):[],g=new Set(p.map(de)),N=[];if(i==="DASH"||i==="SPEAR_THROW"||i==="SHIELD_THROW"||i==="GRAPPLE_HOOK")for(let M=0;M<6;M++)for(let E=1;E<=_;E++){const w=jn(r,Jd(M,E));if(!Ws(w,t.gridWidth,t.gridHeight))break;const D=Pe.isLosBlocking(t,w),H=f.has(de(w)),ne=Lt(r,w).slice(1,-1).some(oe=>Pe.isLosBlocking(t,oe)||f.has(de(oe))),xe=g.has(de(w));if(N.push({p:w,isValidTarget:xe,isBlocked:ne,isWall:D,isEnemy:H}),D||H)break}else p.forEach(M=>{const E=Pe.isLosBlocking(t,M),w=f.has(de(M));N.push({p:M,isValidTarget:!0,isBlocked:!1,isWall:E,isEnemy:w})});return N},[t,i,r,f]),A=O.useMemo(()=>{const x=new Map;for(const _ of y)x.set(de(_.p),_);return x},[y]),v=O.useMemo(()=>{if(c)return c;if(a&&o&&!i&&b.has(de(o)))return{path:Lt(r,o),aoe:[],hasEnemy:!1,target:o};if(!i||!o)return null;const x=A.get(de(o));if(!x||!x.isValidTarget||x.isBlocked)return null;const _=Lt(r,o),p=tS(t,i,r,o),g=x.isEnemy;return{path:_,aoe:p,hasEnemy:g,target:o}},[c,t,i,o,A,b,a,r]);return m.jsxs("g",{pointerEvents:"none",children:[h.map(x=>{const{x:_,y:p}=St(x,te);return m.jsx("circle",{cx:_,cy:p,r:te*.55,fill:"rgba(99, 102, 241, 0.15)",className:"animate-soft-pulse"},`mv-${x.q}-${x.r}`)}),y.map(x=>{const{p:_,isValidTarget:p,isBlocked:g}=x,{x:N,y:I}=St(_,te);return m.jsxs("g",{children:[m.jsx("circle",{cx:N,cy:I,r:te*.45,fill:g?"rgba(255,255,255,0.01)":"rgba(255,255,255,0.04)"}),p&&!g&&m.jsx("circle",{cx:N,cy:I,r:te*.55,fill:"none",stroke:"rgba(239, 68, 68, 0.4)",strokeWidth:1.5}),p&&g&&m.jsx("circle",{cx:N,cy:I,r:te*.55,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeDasharray:"4 2",strokeWidth:1})]},`sk-${_.q}-${_.r}`)}),v&&m.jsxs("g",{children:[(()=>{const x=v.path.map(M=>St(M,te)),_=x.map((M,E)=>`${E===0?"M":"L"} ${M.x} ${M.y}`).join(" "),p=x[x.length-1],g=x[x.length-2]||{x:p.x-1,y:p.y},N=Math.atan2(p.y-g.y,p.x-g.x),I=8;return m.jsxs("g",{children:[m.jsx("path",{d:_,stroke:"white",strokeWidth:"2",fill:"none",strokeDasharray:"6 3",className:"animate-intent-dash",opacity:"0.6"}),m.jsx("path",{d:`M ${p.x} ${p.y} L ${p.x-I*Math.cos(N-Math.PI/6)} ${p.y-I*Math.sin(N-Math.PI/6)} M ${p.x} ${p.y} L ${p.x-I*Math.cos(N+Math.PI/6)} ${p.y-I*Math.sin(N+Math.PI/6)}`,stroke:"white",strokeWidth:"2",opacity:"0.8"})]})})(),v.hasEnemy&&(()=>{const{x,y:_}=St(v.target,te),p=te*.7;return m.jsxs("g",{children:[m.jsx("circle",{cx:x,cy:_,r:p,fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4 2"}),m.jsx("line",{x1:x-p,y1:_,x2:x+p,y2:_,stroke:"#ef4444",strokeWidth:"1"}),m.jsx("line",{x1:x,y1:_-p,x2:x,y2:_+p,stroke:"#ef4444",strokeWidth:"1"})]})})(),Array.from(new Map(v.aoe.map(x=>[de(x),x])).values()).map(x=>{const{x:_,y:p}=St(x,te);return m.jsx("circle",{cx:_,cy:p,r:te*.6,fill:"rgba(239, 68, 68, 0.2)",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,strokeDasharray:"4 2"},`aoe-${x.q}-${x.r}`)})]})]})},T1=["white","blue","black","red","green"],Mg={white:{label:"Plains / Mesa",floorAssetId:"tile.catacombs.floor.01",hazardAssetId:"tile.catacombs.lava.01"},blue:{label:"Islands / Coast",floorAssetId:"tile.frozen.floor.01",hazardAssetId:"tile.catacombs.lava.01"},black:{label:"Swamp / Wastes",floorAssetId:"tile.void.floor.01",hazardAssetId:"tile.catacombs.lava.01"},red:{label:"Mountains / Volcanic",floorAssetId:"tile.inferno.floor.01",hazardAssetId:"tile.inferno.lava.01"},green:{label:"Forest / Jungle",floorAssetId:"tile.throne.floor.01",hazardAssetId:"tile.catacombs.lava.01"}},E1={catacombs:"white",frozen:"blue",void:"black",inferno:"red",throne:"green"},_1=t=>{if(typeof t!="string")return;const i=t.toLowerCase();return T1.includes(i)?i:void 0},w1=()=>{if(!(typeof window>"u"))return _1(window.__HOP_FORCE_BIOME)},M1=t=>{const i=w1();if(i)return i;const a=String(t||"").toLowerCase();return E1[a]||"white"},O1=t=>{const i=M1(t.theme);return t.isWall?"tile.catacombs.wall.01":t.isLava?Mg[i].hazardAssetId:t.isFire?"tile.catacombs.fire.01":Mg[i].floorAssetId},Og=t=>{if(t.isStairs)return"prop.core.stairs.01";if(t.isShrine)return"prop.core.shrine.01"},ic=t=>{if(t.type==="player")switch(t.archetype){case"FIREMAGE":return"unit.player.firemage.04";case"SKIRMISHER":return"unit.player.skirmisher.01";case"HUNTER":return"unit.player.hunter.01";case"NECROMANCER":return"unit.player.necromancer.01";case"ASSASSIN":return"unit.player.assassin.01";default:return"unit.player.vanguard.01"}switch(t.subtype){case"footman":return"unit.enemy.footman.01";case"shield_bearer":return"unit.enemy.shield_bearer.01";case"archer":return"unit.enemy.archer.01";case"warlock":return"unit.enemy.warlock.01";case"bomber":return"unit.enemy.bomber.01";case"bomb":return"unit.enemy.bomb.01";default:return t.enemyType==="boss"?"unit.enemy.boss.01":"unit.enemy.footman.01"}},Cg="/Hop",Ng=(t,i)=>`${t.endsWith("/")?t:`${t}/`}${i.replace(/^\/+/,"")}`,C1=t=>/^(?:[a-z]+:)?\/\//i.test(t)||t.startsWith("data:")?t:t.startsWith("/")?t.startsWith("/assets/")?Ng(Cg,t.slice(1)):t:Ng(Cg,t),N1={"unit.player.vanguard.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.firemage.04":"/assets/units/unit.player.firemage.02.svg","unit.player.skirmisher.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.hunter.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.necromancer.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.assassin.01":"/assets/units/unit.player.skirmisher.01.svg","unit.enemy.footman.01":"/assets/units/unit.enemy.footman.01.svg","unit.enemy.shield_bearer.01":"/assets/units/unit.enemy.shield_bearer.01.svg","unit.enemy.archer.01":"/assets/units/unit.enemy.archer.01.svg","unit.enemy.warlock.01":"/assets/units/unit.enemy.warlock.01.svg","unit.enemy.bomber.01":"/assets/units/unit.enemy.bomber.01.svg","unit.enemy.bomb.01":"/assets/units/unit.enemy.bomb.01.svg","unit.enemy.boss.01":"/assets/units/unit.enemy.boss.01.svg"},kd=t=>{const i=ic(t),a=N1[i];return a?C1(a):void 0},R1=t=>{if(t==="impact")return"fx.core.impact.01";if(t==="vaporize")return"fx.core.vaporize.01";if(t==="lava_ripple")return"fx.core.lava_ripple.01";if(t==="explosion_ring")return"fx.core.explosion_ring.01"},k1=()=>"ui.core.hp_frame.01",L1=()=>"decal.combat.blood.01",I1=t=>new Promise(i=>setTimeout(i,t)),B1=t=>{if(!t)return null;const i=t.position||t.destination||t.origin||t.target;return i&&typeof i.q=="number"&&typeof i.r=="number"&&typeof i.s=="number"?i:null},Rg=t=>t==="impact"?400:t==="combat_text"?1e3:t==="flash"?300:t==="spear_trail"?500:t==="vaporize"?600:t==="lava_ripple"?800:t==="explosion_ring"?1e3:2e3,j1=({visualEvents:t,timelineEvents:i=[],onBusyStateChange:a,assetManifest:o})=>{const[c,r]=O.useState([]),f=O.useRef(0),h=O.useRef(0),b=O.useRef([]),y=O.useRef(!1),[A,v]=O.useState(!1),x=O.useRef(!1),_=O.useRef(new Map),p=O.useRef(null),g=900,N=5e3,I=O.useMemo(()=>{const E=new Map;for(const w of o?.assets||[])E.set(w.id,w);return E},[o]);O.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const E=window.matchMedia("(prefers-reduced-motion: reduce)"),w=()=>{x.current=E.matches};return w(),E.addEventListener?.("change",w),()=>E.removeEventListener?.("change",w)},[]),O.useEffect(()=>{if(!t.length)return;const E=new Map(_.current),w=Date.now();for(const D of t){if(D.type!=="kinetic_trace")continue;const H=D.payload;if(!H?.actorId)continue;const C=Number(H.durationMs??0);C>0&&E.set(String(H.actorId),{durationMs:C,seenAt:w})}_.current=E},[t]),O.useEffect(()=>{a?.(A)},[A,a]);const M=E=>{const w=Date.now(),D=B1(E.payload);if(!D)return;const H=[],C=`${E.id}:${w}`;E.phase==="HAZARD_CHECK"?H.push({id:`${C}:haz`,type:"combat_text",position:D,payload:{text:"!"},startTime:w}):E.phase==="DAMAGE_APPLY"?H.push({id:`${C}:impact`,type:"impact",position:D,startTime:w}):E.phase==="DEATH_RESOLVE"&&H.push({id:`${C}:vapor`,type:"vaporize",position:D,startTime:w}),H.length>0&&r(K=>[...K,...H])};return O.useEffect(()=>{if(!i.length)return;i.length<f.current&&(f.current=0);const E=i.slice(f.current);E.length&&(f.current=i.length,b.current.push(...E),!y.current&&(y.current=!0,v(!0),(async()=>{try{const w=Date.now();for(;b.current.length>0;){if(Date.now()-w>N){console.warn("[HOP_JUICE] Timeline queue exceeded runtime budget; flushing remaining events.",{queued:b.current.length});break}const D=b.current.shift();M(D);let H=D.blocking?D.suggestedDurationMs??140:0;if(D.phase==="MOVE_END"){const xe=D.payload?.targetActorId;if(xe){const oe=_.current.get(xe),ke=oe?Date.now()-oe.seenAt<=2500:!1;oe&&ke&&oe.durationMs>0&&(H=Math.max(H,Math.min(g,oe.durationMs)))}}let C=0;D.phase==="MOVE_END"?C=Math.min(700,Math.max(120,H)):D.phase==="DEATH_RESOLVE"?C=Math.min(160,Math.max(90,H)):D.phase==="DAMAGE_APPLY"?C=Math.min(110,Math.max(60,H)):D.phase==="HAZARD_CHECK"?C=Math.min(100,Math.max(50,H)):D.blocking&&(C=Math.min(90,Math.max(0,H)));const K=D.phase==="MOVE_END"?H:x.current?Math.min(70,Math.floor(C*.5)):C,ne=Math.max(0,Math.min(g,K));ne>0&&await I1(ne)}}catch(w){console.error("[HOP_JUICE] Timeline queue processing failed; releasing busy lock.",w)}finally{b.current=[],y.current=!1,v(!1)}})()))},[i]),O.useEffect(()=>{if(i.length>0){h.current=t.length;return}t.length<h.current&&(h.current=0);const E=h.current;if(E>=t.length)return;const w=t.slice(E);h.current=t.length;const D=[],H=Date.now();w.forEach((C,K)=>{const ne=`juice-${H}-${E+K}`;C.type==="vfx"&&C.payload?.type==="impact"?C.payload.position&&D.push({id:ne,type:"impact",position:C.payload.position,startTime:H}):C.type==="vfx"&&C.payload?.type==="flash"?C.payload.position&&D.push({id:ne,type:"flash",position:C.payload.position,startTime:H}):C.type==="vfx"&&C.payload?.type==="spear_trail"?C.payload.path&&C.payload.path.length>0&&D.push({id:ne,type:"spear_trail",position:C.payload.path[0],payload:C.payload,startTime:H}):C.type==="vfx"&&C.payload?.type==="vaporize"?C.payload.position&&D.push({id:ne,type:"vaporize",position:C.payload.position,startTime:H}):C.type==="vfx"&&C.payload?.type==="lava_ripple"?C.payload.position&&D.push({id:ne,type:"lava_ripple",position:C.payload.position,startTime:H}):C.type==="vfx"&&C.payload?.type==="explosion_ring"&&C.payload.position&&D.push({id:ne,type:"explosion_ring",position:C.payload.position,startTime:H})}),D.length>0&&r(C=>[...C,...D])},[t,i.length]),O.useEffect(()=>{if(p.current!==null&&(window.clearTimeout(p.current),p.current=null),c.length===0)return;const E=Date.now();let w=1/0;for(const H of c){const C=E-H.startTime,K=Rg(H.type)-C;K>0&&K<w&&(w=K)}if(!Number.isFinite(w)){r([]);return}const D=Math.max(16,Math.min(180,Math.floor(w)));return p.current=window.setTimeout(()=>{const H=Date.now();r(C=>{const K=C.filter(ne=>H-ne.startTime<Rg(ne.type));return K.length===C.length?C:K})},D),()=>{p.current!==null&&(window.clearTimeout(p.current),p.current=null)}},[c]),m.jsx("g",{style:{pointerEvents:"none"},children:c.map(E=>{if(!E.position)return null;const{x:w,y:D}=St(E.position,te),H=R1(E.type),C=H?I.get(H)?.path:void 0,K=I.get(k1())?.path;if(E.type==="impact")return C?m.jsx("image",{href:C,x:w-te*.75,y:D-te*.75,width:te*1.5,height:te*1.5,preserveAspectRatio:"xMidYMid meet",className:"animate-impact",opacity:"0.9"},E.id):m.jsx("circle",{cx:w,cy:D,r:te*.5,fill:"none",stroke:"#ffffff",strokeWidth:"2",className:"animate-impact"},E.id);if(E.type==="combat_text"){const ne=E.payload.text.startsWith("-")?"#fb7185":"#86efac";return m.jsxs("g",{transform:`translate(${w}, ${D-10})`,children:[K&&m.jsx("image",{href:K,x:-46,y:-24,width:92,height:24,preserveAspectRatio:"xMidYMid meet",opacity:"0.78"}),m.jsx("text",{textAnchor:"middle",fill:ne,fontSize:"16",fontWeight:"black",className:"animate-float-up",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.8))",paintOrder:"stroke",stroke:"#000",strokeWidth:"4px"},children:E.payload.text})]},E.id)}if(E.type==="flash")return m.jsx("circle",{cx:w,cy:D,r:te*2,fill:"#ffffff",className:"animate-flash"},E.id);if(E.type==="spear_trail"){const xe=E.payload.path.map(oe=>{const ke=St(oe,te);return`${ke.x},${ke.y}`}).join(" ");return m.jsx("polyline",{points:xe,fill:"none",stroke:"#ffffff",strokeWidth:"4",strokeLinecap:"round",className:"animate-spear-trail"},E.id)}return E.type==="vaporize"?C?m.jsx("image",{href:C,x:w-te*.95,y:D-te*.95,width:te*1.9,height:te*1.9,preserveAspectRatio:"xMidYMid meet",className:"animate-vaporize",opacity:"0.9"},E.id):m.jsxs("g",{children:[m.jsx("circle",{cx:w,cy:D,r:te*.6,fill:"#f97316",className:"animate-vaporize",opacity:"0.8"}),m.jsx("circle",{cx:w,cy:D,r:te*1.2,fill:"none",stroke:"#f97316",strokeWidth:"2",className:"animate-ping"})]},E.id):E.type==="lava_ripple"?C?m.jsx("image",{href:C,x:w-te,y:D-te,width:te*2,height:te*2,preserveAspectRatio:"xMidYMid meet",className:"animate-ping",opacity:"0.85"},E.id):m.jsx("circle",{cx:w,cy:D,r:te*.8,fill:"none",stroke:"#ea580c",strokeWidth:"3",className:"animate-ping"},E.id):E.type==="explosion_ring"?C?m.jsx("image",{href:C,x:w-te*1.35,y:D-te*1.35,width:te*2.7,height:te*2.7,preserveAspectRatio:"xMidYMid meet",className:"animate-explosion-ring",opacity:"0.88"},E.id):m.jsx("circle",{cx:w,cy:D,r:te*2.5,fill:"rgba(255, 120, 0, 0.2)",stroke:"#ffaa00",strokeWidth:"4",className:"animate-explosion-ring"},E.id):null})})},Gd="/Hop",_y=/^[a-z0-9]+(?:[._-][a-z0-9]+)*$/,wl=/^\/assets\/[a-z0-9/_\-.]+$/,sf=["ground","decal","prop","unit","fx","ui"],D1=["svg","webp","avif","png","jpg","jpeg"],kg=["svg","webp","avif","png"],Lg=["svg","webp","avif","png","jpg","jpeg"],Ig=["svg","webp","avif","png"],Bg=["svg"],Wd=(t,i)=>`${t.endsWith("/")?t:`${t}/`}${i.replace(/^\/+/,"")}`,H1=Wd(Gd,"assets/manifest.json"),_a=t=>/^(?:[a-z]+:)?\/\//i.test(t)||t.startsWith("data:")?t:t.startsWith("/")?t.startsWith("/assets/")?Wd(Gd,t.slice(1)):t:Wd(Gd,t),ho=t=>{if(t)return{...t,default:_a(t.default),themes:Object.fromEntries(Object.entries(t.themes||{}).map(([i,a])=>[i,_a(a)]))}},jg=t=>{if(t)return{...t,scale:t.scale??t.mountainScale,offsetX:t.offsetX??t.mountainOffsetX,offsetY:t.offsetY??t.mountainOffsetY,anchorX:t.anchorX??t.mountainAnchorX,anchorY:t.anchorY??t.mountainAnchorY,crustBlendMode:t.crustBlendMode??t.mountainCrustBlendMode,crustBlendOpacity:t.crustBlendOpacity??t.mountainCrustBlendOpacity,tintColor:t.tintColor??t.mountainTintColor,tintBlendMode:t.tintBlendMode??t.mountainTintBlendMode,tintOpacity:t.tintOpacity??t.mountainTintOpacity}},P1=t=>{if(t)return{...t,themes:Object.fromEntries(Object.entries(t.themes||{}).map(([i,a])=>[i,String(a)]))}},lc=t=>{if(t)return{detailA:ho(t.detailA),detailB:ho(t.detailB),tint:P1(t.tint)}},Xd=t=>{if(t)return{...t}},wy=t=>{if(!t)return;const i=jg(t);return{...i,mountainPath:i?.mountainPath?_a(i.mountainPath):i?.mountainPath,themes:Object.fromEntries(Object.entries(t.themes||{}).map(([a,o])=>[a,{...jg(o),mountainPath:o?.mountainPath?_a(o.mountainPath):o?.mountainPath}]))}},U1=t=>{if(t)return{...t,biomeLayers:t.biomeLayers?{undercurrent:ho(t.biomeLayers.undercurrent),crust:ho(t.biomeLayers.crust),clutter:t.biomeLayers.clutter?{...t.biomeLayers.clutter,tags:[...t.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:t.biomeMaterials?{undercurrent:lc(t.biomeMaterials.undercurrent),crust:lc(t.biomeMaterials.crust)}:void 0,walls:wy(t.walls),assetOverrides:Object.fromEntries(Object.entries(t.assetOverrides||{}).map(([i,a])=>[i,{...a,mountainSettings:Xd(a?.mountainSettings)}]))}},q1=t=>({...t,biomeUnderlay:t.biomeUnderlay?{...t.biomeUnderlay,default:_a(t.biomeUnderlay.default),themes:Object.fromEntries(Object.entries(t.biomeUnderlay.themes||{}).map(([i,a])=>[i,_a(a)]))}:void 0,biomeLayers:t.biomeLayers?{undercurrent:ho(t.biomeLayers.undercurrent),crust:ho(t.biomeLayers.crust),clutter:t.biomeLayers.clutter?{...t.biomeLayers.clutter,tags:[...t.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:t.biomeMaterials?{undercurrent:lc(t.biomeMaterials.undercurrent),crust:lc(t.biomeMaterials.crust)}:void 0,walls:wy(t.walls),biomePresets:Object.fromEntries(Object.entries(t.biomePresets||{}).map(([i,a])=>[i,U1(a)||{}])),assets:t.assets.map(i=>({...i,path:_a(i.path),mountainSettings:Xd(i.mountainSettings),mountainSettingsByTheme:Object.fromEntries(Object.entries(i.mountainSettingsByTheme||{}).map(([a,o])=>[a,Xd(o)||{}]))}))}),Dg={version:"1.0.0",gridTopology:"flat-top-hex",tileUnitPx:256,tileAspectRatio:1.154700538,layers:[...sf],assets:[]};let Kr=null;const Hg=t=>typeof t=="string"&&sf.includes(t),Pg=t=>typeof t=="string"&&["tile","decal","prop","unit","fx","ui"].includes(t),Ug=t=>typeof t=="string"&&D1.includes(t),wa=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if((typeof t.default!="string"||!wl.test(t.default))&&a.push(`"${i}.default" must be a /assets/... path.`),t.themes!==void 0)if(!t.themes||typeof t.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(t.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||!wl.test(c))&&a.push(`"${i}.themes.${o}" must be a /assets/... path.`);if(t.mode!==void 0&&t.mode!=="off"&&t.mode!=="cover"&&t.mode!=="repeat"&&a.push(`"${i}.mode" must be one of "off", "cover", or "repeat".`),t.scalePx!==void 0&&(!Number.isFinite(t.scalePx)||Number(t.scalePx)<=0)&&a.push(`"${i}.scalePx" must be > 0 when provided.`),t.opacity!==void 0&&(!Number.isFinite(t.opacity)||Number(t.opacity)<0||Number(t.opacity)>1)&&a.push(`"${i}.opacity" must be in [0, 1] when provided.`),t.seedShiftPx!==void 0&&(!Number.isFinite(t.seedShiftPx)||Number(t.seedShiftPx)<0)&&a.push(`"${i}.seedShiftPx" must be >= 0 when provided.`),t.offsetX!==void 0&&!Number.isFinite(t.offsetX)&&a.push(`"${i}.offsetX" must be a finite number when provided.`),t.offsetY!==void 0&&!Number.isFinite(t.offsetY)&&a.push(`"${i}.offsetY" must be a finite number when provided.`),t.scroll!==void 0){const o=t.scroll;!o||typeof o!="object"?a.push(`"${i}.scroll" must be an object when provided.`):(o.x!==void 0&&!Number.isFinite(o.x)&&a.push(`"${i}.scroll.x" must be a finite number.`),o.y!==void 0&&!Number.isFinite(o.y)&&a.push(`"${i}.scroll.y" must be a finite number.`),o.durationMs!==void 0&&(!Number.isFinite(o.durationMs)||Number(o.durationMs)<=0)&&a.push(`"${i}.scroll.durationMs" must be > 0 when provided.`))}},z1=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if((typeof t.default!="string"||t.default.trim().length===0)&&a.push(`"${i}.default" must be a non-empty color string.`),t.themes!==void 0)if(!t.themes||typeof t.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(t.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||c.trim().length===0)&&a.push(`"${i}.themes.${o}" must be a non-empty color string.`);t.opacity!==void 0&&(!Number.isFinite(t.opacity)||Number(t.opacity)<0||Number(t.opacity)>1)&&a.push(`"${i}.opacity" must be in [0, 1] when provided.`),t.blendMode!==void 0&&t.blendMode!=="normal"&&t.blendMode!=="multiply"&&t.blendMode!=="overlay"&&t.blendMode!=="soft-light"&&t.blendMode!=="screen"&&t.blendMode!=="color-dodge"&&a.push(`"${i}.blendMode" must be one of "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`)},Ml=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}t.scale!==void 0&&(!Number.isFinite(t.scale)||Number(t.scale)<=0)&&a.push(`"${i}.scale" must be > 0 when provided.`),t.offsetX!==void 0&&!Number.isFinite(t.offsetX)&&a.push(`"${i}.offsetX" must be a finite number when provided.`),t.offsetY!==void 0&&!Number.isFinite(t.offsetY)&&a.push(`"${i}.offsetY" must be a finite number when provided.`),t.anchorX!==void 0&&(!Number.isFinite(t.anchorX)||Number(t.anchorX)<0||Number(t.anchorX)>1)&&a.push(`"${i}.anchorX" must be in [0, 1] when provided.`),t.anchorY!==void 0&&(!Number.isFinite(t.anchorY)||Number(t.anchorY)<0||Number(t.anchorY)>1)&&a.push(`"${i}.anchorY" must be in [0, 1] when provided.`),t.crustBlendMode!==void 0&&t.crustBlendMode!=="off"&&t.crustBlendMode!=="normal"&&t.crustBlendMode!=="multiply"&&t.crustBlendMode!=="overlay"&&t.crustBlendMode!=="soft-light"&&t.crustBlendMode!=="screen"&&t.crustBlendMode!=="color-dodge"&&a.push(`"${i}.crustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.tintBlendMode!==void 0&&t.tintBlendMode!=="off"&&t.tintBlendMode!=="normal"&&t.tintBlendMode!=="multiply"&&t.tintBlendMode!=="overlay"&&t.tintBlendMode!=="soft-light"&&t.tintBlendMode!=="screen"&&t.tintBlendMode!=="color-dodge"&&a.push(`"${i}.tintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.crustBlendOpacity!==void 0&&(!Number.isFinite(t.crustBlendOpacity)||Number(t.crustBlendOpacity)<0||Number(t.crustBlendOpacity)>1)&&a.push(`"${i}.crustBlendOpacity" must be in [0, 1] when provided.`),t.tintOpacity!==void 0&&(!Number.isFinite(t.tintOpacity)||Number(t.tintOpacity)<0||Number(t.tintOpacity)>1)&&a.push(`"${i}.tintOpacity" must be in [0, 1] when provided.`),t.tintColor!==void 0&&(typeof t.tintColor!="string"||t.tintColor.trim().length===0)&&a.push(`"${i}.tintColor" must be a non-empty color string when provided.`)},My=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if(t.mode!==void 0&&t.mode!=="native"&&t.mode!=="additive"&&t.mode!=="custom"&&a.push(`"${i}.mode" must be one of "native", "additive", or "custom".`),t.interiorDensity!==void 0&&(!Number.isFinite(t.interiorDensity)||Number(t.interiorDensity)<0||Number(t.interiorDensity)>1)&&a.push(`"${i}.interiorDensity" must be in [0, 1] when provided.`),t.clusterBias!==void 0&&(!Number.isFinite(t.clusterBias)||Number(t.clusterBias)<0||Number(t.clusterBias)>1)&&a.push(`"${i}.clusterBias" must be in [0, 1] when provided.`),t.keepPerimeter!==void 0&&typeof t.keepPerimeter!="boolean"&&a.push(`"${i}.keepPerimeter" must be a boolean when provided.`),t.mountainPath!==void 0&&(typeof t.mountainPath!="string"||!wl.test(t.mountainPath))&&a.push(`"${i}.mountainPath" must be a /assets/... path when provided.`),t.mountainScale!==void 0&&(!Number.isFinite(t.mountainScale)||Number(t.mountainScale)<=0)&&a.push(`"${i}.mountainScale" must be > 0 when provided.`),t.mountainOffsetX!==void 0&&!Number.isFinite(t.mountainOffsetX)&&a.push(`"${i}.mountainOffsetX" must be a finite number when provided.`),t.mountainOffsetY!==void 0&&!Number.isFinite(t.mountainOffsetY)&&a.push(`"${i}.mountainOffsetY" must be a finite number when provided.`),t.mountainAnchorX!==void 0&&(!Number.isFinite(t.mountainAnchorX)||Number(t.mountainAnchorX)<0||Number(t.mountainAnchorX)>1)&&a.push(`"${i}.mountainAnchorX" must be in [0, 1] when provided.`),t.mountainAnchorY!==void 0&&(!Number.isFinite(t.mountainAnchorY)||Number(t.mountainAnchorY)<0||Number(t.mountainAnchorY)>1)&&a.push(`"${i}.mountainAnchorY" must be in [0, 1] when provided.`),t.mountainCrustBlendMode!==void 0&&t.mountainCrustBlendMode!=="off"&&t.mountainCrustBlendMode!=="normal"&&t.mountainCrustBlendMode!=="multiply"&&t.mountainCrustBlendMode!=="overlay"&&t.mountainCrustBlendMode!=="soft-light"&&t.mountainCrustBlendMode!=="screen"&&t.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${i}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(t.mountainCrustBlendOpacity)||Number(t.mountainCrustBlendOpacity)<0||Number(t.mountainCrustBlendOpacity)>1)&&a.push(`"${i}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),t.mountainTintColor!==void 0&&(typeof t.mountainTintColor!="string"||t.mountainTintColor.trim().length===0)&&a.push(`"${i}.mountainTintColor" must be a non-empty color string when provided.`),t.mountainTintBlendMode!==void 0&&t.mountainTintBlendMode!=="off"&&t.mountainTintBlendMode!=="normal"&&t.mountainTintBlendMode!=="multiply"&&t.mountainTintBlendMode!=="overlay"&&t.mountainTintBlendMode!=="soft-light"&&t.mountainTintBlendMode!=="screen"&&t.mountainTintBlendMode!=="color-dodge"&&a.push(`"${i}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.mountainTintOpacity!==void 0&&(!Number.isFinite(t.mountainTintOpacity)||Number(t.mountainTintOpacity)<0||Number(t.mountainTintOpacity)>1)&&a.push(`"${i}.mountainTintOpacity" must be in [0, 1] when provided.`),Ml(t,i,a),t.themes!==void 0)if(!t.themes||typeof t.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(t.themes)){if(typeof o!="string"||o.trim().length===0){a.push(`"${i}.themes" contains an invalid theme key.`);continue}if(!c||typeof c!="object"){a.push(`"${i}.themes.${o}" must be an object.`);continue}c.mountainPath!==void 0&&(typeof c.mountainPath!="string"||!wl.test(c.mountainPath))&&a.push(`"${i}.themes.${o}.mountainPath" must be a /assets/... path when provided.`);const r=c;r.mountainScale!==void 0&&(!Number.isFinite(r.mountainScale)||Number(r.mountainScale)<=0)&&a.push(`"${i}.themes.${o}.mountainScale" must be > 0 when provided.`),r.mountainOffsetX!==void 0&&!Number.isFinite(r.mountainOffsetX)&&a.push(`"${i}.themes.${o}.mountainOffsetX" must be a finite number when provided.`),r.mountainOffsetY!==void 0&&!Number.isFinite(r.mountainOffsetY)&&a.push(`"${i}.themes.${o}.mountainOffsetY" must be a finite number when provided.`),r.mountainAnchorX!==void 0&&(!Number.isFinite(r.mountainAnchorX)||Number(r.mountainAnchorX)<0||Number(r.mountainAnchorX)>1)&&a.push(`"${i}.themes.${o}.mountainAnchorX" must be in [0, 1] when provided.`),r.mountainAnchorY!==void 0&&(!Number.isFinite(r.mountainAnchorY)||Number(r.mountainAnchorY)<0||Number(r.mountainAnchorY)>1)&&a.push(`"${i}.themes.${o}.mountainAnchorY" must be in [0, 1] when provided.`),r.mountainCrustBlendMode!==void 0&&r.mountainCrustBlendMode!=="off"&&r.mountainCrustBlendMode!=="normal"&&r.mountainCrustBlendMode!=="multiply"&&r.mountainCrustBlendMode!=="overlay"&&r.mountainCrustBlendMode!=="soft-light"&&r.mountainCrustBlendMode!=="screen"&&r.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${i}.themes.${o}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),r.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(r.mountainCrustBlendOpacity)||Number(r.mountainCrustBlendOpacity)<0||Number(r.mountainCrustBlendOpacity)>1)&&a.push(`"${i}.themes.${o}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),r.mountainTintBlendMode!==void 0&&r.mountainTintBlendMode!=="off"&&r.mountainTintBlendMode!=="normal"&&r.mountainTintBlendMode!=="multiply"&&r.mountainTintBlendMode!=="overlay"&&r.mountainTintBlendMode!=="soft-light"&&r.mountainTintBlendMode!=="screen"&&r.mountainTintBlendMode!=="color-dodge"&&a.push(`"${i}.themes.${o}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),r.mountainTintOpacity!==void 0&&(!Number.isFinite(r.mountainTintOpacity)||Number(r.mountainTintOpacity)<0||Number(r.mountainTintOpacity)>1)&&a.push(`"${i}.themes.${o}.mountainTintOpacity" must be in [0, 1] when provided.`),r.mountainTintColor!==void 0&&(typeof r.mountainTintColor!="string"||r.mountainTintColor.trim().length===0)&&a.push(`"${i}.themes.${o}.mountainTintColor" must be a non-empty color string when provided.`),Ml(c,`${i}.themes.${o}`,a)}},rc=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}t.detailA!==void 0&&wa(t.detailA,`${i}.detailA`,a),t.detailB!==void 0&&wa(t.detailB,`${i}.detailB`,a),t.tint!==void 0&&z1(t.tint,`${i}.tint`,a),t.detailA===void 0&&t.detailB===void 0&&t.tint===void 0&&a.push(`"${i}" must define at least one of "detailA", "detailB", or "tint".`)},$1=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if(t.seed!==void 0&&(typeof t.seed!="string"||t.seed.trim().length===0)&&a.push(`"${i}.seed" must be a non-empty string when provided.`),t.injectHazards!==void 0&&typeof t.injectHazards!="boolean"&&a.push(`"${i}.injectHazards" must be a boolean when provided.`),t.biomeLayers!==void 0){const o=t.biomeLayers;if(!o||typeof o!="object")a.push(`"${i}.biomeLayers" must be an object when provided.`);else if(o.undercurrent!==void 0&&wa(o.undercurrent,`${i}.biomeLayers.undercurrent`,a),o.crust!==void 0&&wa(o.crust,`${i}.biomeLayers.crust`,a),o.clutter!==void 0){const c=o.clutter;!c||typeof c!="object"?a.push(`"${i}.biomeLayers.clutter" must be an object when provided.`):(c.density!==void 0&&(!Number.isFinite(c.density)||Number(c.density)<0||Number(c.density)>1)&&a.push(`"${i}.biomeLayers.clutter.density" must be in [0, 1] when provided.`),c.maxPerHex!==void 0&&(!Number.isFinite(c.maxPerHex)||Number(c.maxPerHex)<0)&&a.push(`"${i}.biomeLayers.clutter.maxPerHex" must be >= 0 when provided.`),c.bleedScaleMax!==void 0&&(!Number.isFinite(c.bleedScaleMax)||Number(c.bleedScaleMax)<1||Number(c.bleedScaleMax)>2)&&a.push(`"${i}.biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.`),c.tags!==void 0&&(!Array.isArray(c.tags)||!c.tags.every(r=>typeof r=="string"&&r.length>0))&&a.push(`"${i}.biomeLayers.clutter.tags" must be a string array when provided.`))}}if(t.biomeMaterials!==void 0){const o=t.biomeMaterials;!o||typeof o!="object"?a.push(`"${i}.biomeMaterials" must be an object when provided.`):(o.undercurrent!==void 0&&rc(o.undercurrent,`${i}.biomeMaterials.undercurrent`,a),o.crust!==void 0&&rc(o.crust,`${i}.biomeMaterials.crust`,a))}if(t.walls!==void 0&&My(t.walls,`${i}.walls`,a),t.assetOverrides!==void 0)if(!t.assetOverrides||typeof t.assetOverrides!="object")a.push(`"${i}.assetOverrides" must be an object when provided.`);else for(const[o,c]of Object.entries(t.assetOverrides)){if(!_y.test(o)){a.push(`"${i}.assetOverrides" contains invalid asset id "${o}".`);continue}if(!c||typeof c!="object"){a.push(`"${i}.assetOverrides.${o}" must be an object.`);continue}c.mountainSettings!==void 0&&Ml(c.mountainSettings,`${i}.assetOverrides.${o}.mountainSettings`,a)}},V1=t=>{const i=[];if(!t||typeof t!="object")return{valid:!1,errors:["Manifest is not an object."]};const a=t;if((typeof a.version!="string"||a.version.length===0)&&i.push('Missing or invalid "version".'),a.gridTopology!=="flat-top-hex"&&i.push('Only "flat-top-hex" gridTopology is supported.'),(!Number.isFinite(a.tileUnitPx)||Number(a.tileUnitPx)<=0)&&i.push('Missing or invalid "tileUnitPx".'),(!Number.isFinite(a.tileAspectRatio)||Number(a.tileAspectRatio)<=0)&&i.push('Missing or invalid "tileAspectRatio".'),a.biomeUnderlay!==void 0&&wa(a.biomeUnderlay,"biomeUnderlay",i),a.biomeLayers!==void 0){const c=a.biomeLayers;if(!c||typeof c!="object")i.push('"biomeLayers" must be an object when provided.');else if(c.undercurrent!==void 0&&wa(c.undercurrent,"biomeLayers.undercurrent",i),c.crust!==void 0&&wa(c.crust,"biomeLayers.crust",i),!c.undercurrent&&!c.crust&&i.push('"biomeLayers" must define at least one of "undercurrent" or "crust".'),c.clutter!==void 0){const r=c.clutter;!r||typeof r!="object"?i.push('"biomeLayers.clutter" must be an object when provided.'):(r.density!==void 0&&(!Number.isFinite(r.density)||Number(r.density)<0||Number(r.density)>1)&&i.push('"biomeLayers.clutter.density" must be in [0, 1] when provided.'),r.maxPerHex!==void 0&&(!Number.isFinite(r.maxPerHex)||Number(r.maxPerHex)<0)&&i.push('"biomeLayers.clutter.maxPerHex" must be >= 0 when provided.'),r.bleedScaleMax!==void 0&&(!Number.isFinite(r.bleedScaleMax)||Number(r.bleedScaleMax)<1||Number(r.bleedScaleMax)>2)&&i.push('"biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.'),r.tags!==void 0&&(!Array.isArray(r.tags)||!r.tags.every(f=>typeof f=="string"&&f.length>0))&&i.push('"biomeLayers.clutter.tags" must be a string array when provided.'))}}if(a.biomeMaterials!==void 0){const c=a.biomeMaterials;!c||typeof c!="object"?i.push('"biomeMaterials" must be an object when provided.'):(c.undercurrent!==void 0&&rc(c.undercurrent,"biomeMaterials.undercurrent",i),c.crust!==void 0&&rc(c.crust,"biomeMaterials.crust",i),c.undercurrent===void 0&&c.crust===void 0&&i.push('"biomeMaterials" must define at least one of "undercurrent" or "crust".'))}if(a.walls!==void 0&&My(a.walls,"walls",i),a.biomePresets!==void 0)if(!a.biomePresets||typeof a.biomePresets!="object")i.push('"biomePresets" must be an object when provided.');else for(const[c,r]of Object.entries(a.biomePresets)){if(typeof c!="string"||c.trim().length===0){i.push('"biomePresets" contains an invalid theme key.');continue}$1(r,`biomePresets.${c}`,i)}if(!Array.isArray(a.layers)||a.layers.length===0||!a.layers.every(Hg))i.push('Missing or invalid "layers".');else for(const c of sf)a.layers.includes(c)||i.push(`Missing required layer "${c}" in "layers".`);if(!Array.isArray(a.assets))return i.push('Missing or invalid "assets".'),{valid:i.length===0,errors:i};const o=new Set;for(const[c,r]of a.assets.entries()){const f=`assets[${c}]`;if(!r||typeof r!="object"){i.push(`${f} is not an object.`);continue}const h=r;if(typeof h.id!="string"||!_y.test(h.id)?i.push(`${f}.id is invalid; expected lowercase tokenized id.`):o.has(h.id)?i.push(`${f}.id is duplicated (${h.id}).`):o.add(h.id),Pg(h.type)||i.push(`${f}.type is invalid.`),Hg(h.layer)||i.push(`${f}.layer is invalid.`),Ug(h.recommendedFormat)||i.push(`${f}.recommendedFormat is invalid.`),Pg(h.type)&&Ug(h.recommendedFormat)&&((h.type==="tile"||h.type==="decal"||h.type==="prop")&&!Lg.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Lg.join(", ")} for ${h.type}.`),h.type==="ui"&&!Bg.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Bg.join(", ")} for ui.`),h.type==="unit"&&!kg.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${kg.join(", ")} for units.`),h.type==="fx"&&!Ig.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Ig.join(", ")} for fx.`)),(typeof h.path!="string"||!wl.test(h.path))&&i.push(`${f}.path is invalid; expected /assets/...`),(!Number.isFinite(h.width)||Number(h.width)<=0)&&i.push(`${f}.width must be > 0.`),(!Number.isFinite(h.height)||Number(h.height)<=0)&&i.push(`${f}.height must be > 0.`),h.mountainSettings!==void 0&&Ml(h.mountainSettings,`${f}.mountainSettings`,i),h.mountainSettingsByTheme!==void 0)if(!h.mountainSettingsByTheme||typeof h.mountainSettingsByTheme!="object")i.push(`${f}.mountainSettingsByTheme must be an object when provided.`);else for(const[b,y]of Object.entries(h.mountainSettingsByTheme)){if(typeof b!="string"||b.trim().length===0){i.push(`${f}.mountainSettingsByTheme contains an invalid theme key.`);continue}Ml(y,`${f}.mountainSettingsByTheme.${b}`,i)}}return{valid:i.length===0,errors:i}},Y1=async()=>Kr||(Kr=fetch(H1).then(async t=>{if(!t.ok)throw new Error(`Asset manifest fetch failed: ${t.status}`);return t.json()}).then(t=>{const i=V1(t);return i.valid?q1(t):(console.warn("[HOP_ASSETS] Invalid manifest; using fallback.",i.errors),Dg)}).catch(t=>(console.warn("[HOP_ASSETS] Failed to load manifest; using fallback.",t),Dg)),Kr),af=(t,i)=>{if(!t)return;const a=String(i||"").toLowerCase();if(a)return t.biomePresets?.[a]},sc=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i=Math.imul(i,16777619);return i>>>0},ml=t=>sc(t)/4294967295,K1=t=>{const i=(t.tags||[]).map(o=>o.toLowerCase()),a=[t.id.toLowerCase(),...i];for(const o of a){const c=o.match(/(?:cluster|hex)[-_]?([123])\b/);if(c)return Number(c[1]);if(o.includes("1-hex")||o.includes("single"))return 1;if(o.includes("2-hex")||o.includes("double"))return 2;if(o.includes("3-hex")||o.includes("triple"))return 3}return 1},Fr=(t,i)=>{if(t)return i&&t.themes?.[i]?t.themes[i]:t.default},Gr=t=>t?t.mode==="cover"||t.mode==="repeat"||t.mode==="off"?t.mode:"cover":"off",Ld=t=>Math.min(1,Math.max(0,Number(t?.opacity??1))),Wr=(t,i,a=64,o=Number.POSITIVE_INFINITY)=>{const c=Number(t?.scalePx||i);return Math.min(o,Math.max(a,c))},qg=t=>({x:Number(t?.scroll?.x??0),y:Number(t?.scroll?.y??0),durationMs:Math.max(1e3,Number(t?.scroll?.durationMs??18e3))}),F1=(t,i)=>{if(t)return i&&t.themes?.[i]?t.themes[i]:t.default},G1=t=>Math.min(1,Math.max(0,Number(t?.opacity??0))),Oy=t=>t==="normal"||t==="multiply"||t==="overlay"||t==="soft-light"||t==="screen"||t==="color-dodge"?t:"multiply",Cy=(t,i="#8b6f4a")=>{const a=String(t||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[r,f,h]=a.slice(1).split("");return`#${r}${r}${f}${f}${h}${h}`.toLowerCase()}return i},W1=t=>{const a=Cy(t).slice(1);return{r:parseInt(a.slice(0,2),16)/255,g:parseInt(a.slice(2,4),16)/255,b:parseInt(a.slice(4,6),16)/255}},X1=t=>t.replace(/[^a-zA-Z0-9_-]/g,"-"),zg=(t,i)=>t==="off"?"off":t?Oy(t):i,Id=t=>{const i=[];for(let a=0;a<6;a++){const o=Math.PI/180*(60*a);i.push(`${t*Math.cos(o)},${t*Math.sin(o)}`)}return i.join(" ")},Ny=({gameState:t,onMove:i,selectedSkillId:a,showMovementRange:o,onBusyStateChange:c,assetManifest:r,biomeDebug:f,onSimulationEvents:h,onMirrorSnapshot:b,enginePreviewGhost:y})=>{const[A,v]=O.useState(!1),[x,_]=O.useState(null),[p,g]=O.useState(!1),[N,I]=O.useState(!1),[M,E]=O.useState([]),w=O.useRef(null),D=O.useRef([]),H=O.useRef(!1),C=O.useRef([]),K=O.useRef(0),ne=O.useRef(""),xe=O.useRef(0),oe=O.useRef(0),ke=O.useRef(0),ie=t.player.position,Te=O.useMemo(()=>{let k=t.rooms?.[0]?.hexes;if(!k||k.length===0){k=[];for(let P=0;P<t.gridWidth;P++)for(let G=0;G<t.gridHeight;G++)k.push({q:P,r:G,s:-P-G})}return k.filter(P=>ac(P.q,P.r,t.gridWidth,t.gridHeight))},[t.rooms,t.gridWidth,t.gridHeight]);O.useEffect(()=>{if(t.visualEvents?.find(P=>P.type==="shake")){v(!0);const P=setTimeout(()=>v(!1),200);return()=>clearTimeout(P)}},[t.visualEvents]);const pe=O.useMemo(()=>{if(Te.length===0)return{minX:0,minY:0,width:100,height:100};let k=1/0,P=1/0,G=-1/0,le=-1/0;return Te.forEach(ce=>{const{x:he,y:ge}=St(ce,te);k=Math.min(k,he-te),P=Math.min(P,ge-te),G=Math.max(G,he+te),le=Math.max(le,ge+te)}),{minX:k,minY:P,width:G-k,height:le-P}},[Te]),$=O.useMemo(()=>{const k={};for(const P of t.visualEvents||[]){if(P.type!=="kinetic_trace")continue;const G=P.payload;G?.actorId&&(k[G.actorId]=G)}return k},[t.visualEvents]),Z=O.useMemo(()=>{if(!o||a)return[];const k=["BASIC_MOVE","DASH"],P=new Set(t.player.activeSkills.map(ce=>ce.id)),G=new Set,le=[];for(const ce of k){if(!P.has(ce))continue;const he=Mn.get(ce);if(!he?.getValidTargets)continue;const ge=he.getValidTargets(t,ie);for(const ot of ge){const lt=de(ot);G.has(lt)||(G.add(lt),le.push(ot))}}return le},[o,a,t,ie]),ae=O.useMemo(()=>{const k=new Set;for(const P of Z)k.add(de(P));return k},[Z]),Me=O.useMemo(()=>t.player.activeSkills.some(k=>k.id==="BASIC_MOVE"||k.id==="DASH"),[t.player.activeSkills]),Se=O.useMemo(()=>de(t.stairsPosition),[t.stairsPosition]),R=O.useMemo(()=>t.shrinePosition?de(t.shrinePosition):null,[t.shrinePosition]),V=O.useMemo(()=>{const k=[{q:ie.q+1,r:ie.r,s:ie.s-1},{q:ie.q+1,r:ie.r-1,s:ie.s},{q:ie.q,r:ie.r-1,s:ie.s+1},{q:ie.q-1,r:ie.r,s:ie.s+1},{q:ie.q-1,r:ie.r+1,s:ie.s},{q:ie.q,r:ie.r+1,s:ie.s-1}],P=new Set;for(const G of k)ac(G.q,G.r,t.gridWidth,t.gridHeight)&&P.add(de(G));return P},[ie,t.gridWidth,t.gridHeight]),ee=O.useMemo(()=>{const k=new Set;if(!a)return k;const P=Mn.get(a);if(!P?.getValidTargets)return k;const G=P.getValidTargets(t,ie);for(const le of G)k.add(de(le));return k},[a,t,ie]),ue=O.useMemo(()=>{const k=new Set;for(const P of t.enemies)P.intentPosition&&k.add(de(P.intentPosition));return k},[t.enemies]),Ce=O.useMemo(()=>{if(y)return y;if(!x)return null;const k=de(x);if(o&&!a)return ae.has(k)||!Me&&V.has(k)?{path:Lt(ie,x),aoe:[],hasEnemy:!1,target:x}:null;if(!a)return null;const P=t.player.activeSkills.find(he=>he.id===a),G=r1(t,{actorId:t.player.id,skillId:a,target:x,activeUpgrades:P?.activeUpgrades||[]});if(!G.ok)return null;const le=new Map;for(const he of G.simulationEvents)he.position&&(he.type!=="DamageTaken"&&he.type!=="StatusApplied"&&he.type!=="UnitMoved"||le.set(de(he.position),he.position));const ce=G.simulationEvents.some(he=>(he.type==="DamageTaken"||he.type==="StatusApplied")&&!!he.targetId&&he.targetId!==t.player.id);return{path:Lt(ie,x),aoe:[...le.values()],hasEnemy:ce,target:x}},[y,x,o,a,ae,Me,V,t,ie]),Ne=O.useMemo(()=>{const k=new Map;for(const P of Te){const G=de(P),le=Pe.getTraitsAt(t,P),ce=le.has("BLOCKS_MOVEMENT")&&le.has("BLOCKS_LOS"),he=le.has("LAVA")||le.has("HAZARDOUS")&&le.has("LIQUID"),ge=le.has("FIRE");k.set(G,{isWall:ce,isLava:!ce&&he,isFire:!ce&&ge})}return k},[Te,t.tiles]),Re=O.useMemo(()=>{const k=new Map;for(const P of r?.assets||[])k.set(P.id,P);return k},[r]),mt=O.useMemo(()=>Re.get(L1())?.path,[Re]),qe=O.useMemo(()=>Math.max(1,r?.tileUnitPx||256),[r?.tileUnitPx]),It=O.useMemo(()=>te*2/qe,[qe]),ze=O.useMemo(()=>String(t.theme||"").toLowerCase(),[t.theme]),Ue=O.useMemo(()=>`${t.initialSeed||t.rngSeed||t.turnNumber}:${t.floor}:${ze}`,[t.initialSeed,t.rngSeed,t.turnNumber,t.floor,ze]),xt=O.useMemo(()=>af(r,ze),[r,ze]),Bt=O.useMemo(()=>{const k=r?.biomeUnderlay;if(k)return{default:k.default,themes:k.themes,mode:k.mode,scalePx:k.scalePx,opacity:k.opacity}},[r?.biomeUnderlay]),ct=O.useMemo(()=>xt?.biomeLayers?.undercurrent||r?.biomeLayers?.undercurrent,[xt?.biomeLayers?.undercurrent,r?.biomeLayers?.undercurrent]),Vt=O.useMemo(()=>xt?.biomeLayers?.crust||r?.biomeLayers?.crust||Bt,[xt?.biomeLayers?.crust,r?.biomeLayers?.crust,Bt]),rn=O.useMemo(()=>xt?.biomeLayers?.clutter||r?.biomeLayers?.clutter,[xt?.biomeLayers?.clutter,r?.biomeLayers?.clutter]),$e=O.useMemo(()=>Fr(ct,ze),[ct,ze]),it=O.useMemo(()=>Gr(ct),[ct]),bn=O.useMemo(()=>Wr(ct,qe,64,192),[ct,qe]),Ei=O.useMemo(()=>Ld(ct),[ct]),Qn=O.useMemo(()=>({x:Number(ct?.scroll?.x??120),y:Number(ct?.scroll?.y??90),durationMs:Math.max(1e3,Number(ct?.scroll?.durationMs??92e3))}),[ct?.scroll?.x,ct?.scroll?.y,ct?.scroll?.durationMs]),Dn=O.useMemo(()=>({x:Number(ct?.offsetX??0)+Number(f?.undercurrentOffset?.x??0),y:Number(ct?.offsetY??0)+Number(f?.undercurrentOffset?.y??0)}),[ct?.offsetX,ct?.offsetY,f?.undercurrentOffset?.x,f?.undercurrentOffset?.y]),Fe=O.useMemo(()=>Fr(Vt,ze),[Vt,ze]),pt=O.useMemo(()=>Gr(Vt),[Vt]),Dt=O.useMemo(()=>Wr(Vt,qe,64),[Vt,qe]),Sn=1,cn=O.useMemo(()=>{const k=Math.max(0,Number(Vt?.seedShiftPx??te*5));if(k===0)return{x:0,y:0};const P=sc(`${Ue}|crust-offset`),G=((P&65535)/65535*2-1)*k,le=((P>>>16&65535)/65535*2-1)*k;return{x:G,y:le}},[Vt?.seedShiftPx,Ue]),vn=O.useMemo(()=>({x:Number(Vt?.offsetX??0)+Number(f?.crustOffset?.x??0),y:Number(Vt?.offsetY??0)+Number(f?.crustOffset?.y??0)}),[Vt?.offsetX,Vt?.offsetY,f?.crustOffset?.x,f?.crustOffset?.y]),Yt=O.useMemo(()=>({x:cn.x+vn.x,y:cn.y+vn.y}),[cn.x,cn.y,vn.x,vn.y]),Tt=O.useMemo(()=>r?.walls,[r?.walls]),Ve=O.useMemo(()=>xt?.walls||Tt?.themes?.[ze],[xt?.walls,Tt?.themes,ze]),Kt=O.useMemo(()=>xt?.biomeMaterials?.crust||r?.biomeMaterials?.crust,[xt?.biomeMaterials?.crust,r?.biomeMaterials?.crust]),Je=O.useMemo(()=>Kt?.detailA,[Kt?.detailA]),et=O.useMemo(()=>Kt?.detailB,[Kt?.detailB]),Et=O.useMemo(()=>Fr(Je,ze),[Je,ze]),un=O.useMemo(()=>Fr(et,ze),[et,ze]),Hn=O.useMemo(()=>Gr(Je),[Je]),Jn=O.useMemo(()=>Gr(et),[et]),On=O.useMemo(()=>Wr(Je,Dt,64),[Je,Dt]),dn=O.useMemo(()=>Wr(et,Dt,64),[et,Dt]),ht=O.useMemo(()=>Ld(Je),[Je]),Ht=O.useMemo(()=>Ld(et),[et]),Ft=O.useMemo(()=>qg(Je),[Je?.scroll?.x,Je?.scroll?.y,Je?.scroll?.durationMs]),Rn=O.useMemo(()=>qg(et),[et?.scroll?.x,et?.scroll?.y,et?.scroll?.durationMs]),Hi=O.useMemo(()=>{const k=te*.75,P=sc(`${Ue}|crust-detail-a-offset`),G=((P&65535)/65535*2-1)*k,le=((P>>>16&65535)/65535*2-1)*k;return{x:G,y:le}},[Ue]),Zn=O.useMemo(()=>{const k=te*.75,P=sc(`${Ue}|crust-detail-b-offset`),G=((P&65535)/65535*2-1)*k,le=((P>>>16&65535)/65535*2-1)*k;return{x:G,y:le}},[Ue]),fn=O.useMemo(()=>({x:Yt.x+Hi.x,y:Yt.y+Hi.y}),[Yt.x,Yt.y,Hi.x,Hi.y]),Gt=O.useMemo(()=>({x:Yt.x+Zn.x,y:Yt.y+Zn.y}),[Yt.x,Yt.y,Zn.x,Zn.y]),Pn=O.useMemo(()=>Kt?.tint,[Kt?.tint]),Pi=O.useMemo(()=>F1(Pn,ze),[Pn,ze]),Gi=O.useMemo(()=>G1(Pn),[Pn?.opacity]),di=O.useMemo(()=>Oy(Pn?.blendMode),[Pn?.blendMode]),_i=!!(Pi&&Gi>0),bs=O.useMemo(()=>_i?Math.min(.55,Math.max(.15,Gi*.9)):0,[_i,Gi]),X=O.useCallback(k=>{const P=k?.mountainSettings,G=k?.mountainSettingsByTheme?.[ze],ce=(k?xt?.assetOverrides?.[k.id]:void 0)?.mountainSettings,he=Math.min(3,Math.max(.2,Number(f?.mountainScale??ce?.scale??G?.scale??Ve?.scale??Tt?.scale??P?.scale??.95))),ge=Number(f?.mountainOffset?.x??ce?.offsetX??G?.offsetX??Ve?.offsetX??Tt?.offsetX??P?.offsetX??0),ot=Number(f?.mountainOffset?.y??ce?.offsetY??G?.offsetY??Ve?.offsetY??Tt?.offsetY??P?.offsetY??0),lt=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.x??ce?.anchorX??G?.anchorX??Ve?.anchorX??Tt?.anchorX??P?.anchorX??.5))),pn=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.y??ce?.anchorY??G?.anchorY??Ve?.anchorY??Tt?.anchorY??P?.anchorY??.78))),zn=zg(f?.mountainCrustBlendMode??ce?.crustBlendMode??G?.crustBlendMode??Ve?.crustBlendMode??Tt?.crustBlendMode??P?.crustBlendMode,di),jt=Math.min(1,Math.max(0,Number(f?.mountainCrustBlendOpacity??ce?.crustBlendOpacity??G?.crustBlendOpacity??Ve?.crustBlendOpacity??Tt?.crustBlendOpacity??P?.crustBlendOpacity??bs))),wt=Cy(String(f?.mountainTintColor??ce?.tintColor??G?.tintColor??Ve?.tintColor??Tt?.tintColor??P?.tintColor??Pi??"#8b6f4a")),Ut=zg(f?.mountainTintBlendMode??ce?.tintBlendMode??G?.tintBlendMode??Ve?.tintBlendMode??Tt?.tintBlendMode??P?.tintBlendMode,"soft-light"),hn=Math.min(1,Math.max(0,Number(f?.mountainTintOpacity??ce?.tintOpacity??G?.tintOpacity??Ve?.tintOpacity??Tt?.tintOpacity??P?.tintOpacity??0))),gn=W1(wt);return{scale:he,offsetX:ge,offsetY:ot,anchorX:lt,anchorY:pn,crustBlendMode:zn,crustBlendOpacity:jt,tintColor:wt,tintBlendMode:Ut,tintOpacity:hn,tintMatrixValues:`0 0 0 0 ${gn.r.toFixed(4)} 0 0 0 0 ${gn.g.toFixed(4)} 0 0 0 0 ${gn.b.toFixed(4)} 0 0 0 1 0`}},[ze,f?.mountainScale,f?.mountainOffset?.x,f?.mountainOffset?.y,f?.mountainAnchor?.x,f?.mountainAnchor?.y,f?.mountainCrustBlendMode,f?.mountainCrustBlendOpacity,f?.mountainTintColor,f?.mountainTintBlendMode,f?.mountainTintOpacity,xt?.assetOverrides,Tt,Ve,di,Pi,bs]),re=!!(Et&&Hn!=="off"&&ht>0||un&&Jn!=="off"&&Ht>0||_i),me=!!($e&&it!=="off"||Fe&&pt!=="off"||re),we=O.useMemo(()=>`biome-undercurrent-${t.floor}`,[t.floor]),be=O.useMemo(()=>`biome-crust-${t.floor}`,[t.floor]),De=O.useMemo(()=>`biome-crust-mask-${t.floor}`,[t.floor]),ut=O.useMemo(()=>`biome-crust-detail-a-${t.floor}`,[t.floor]),mn=O.useMemo(()=>`biome-crust-detail-b-${t.floor}`,[t.floor]),xn=!!(Fe&&pt!=="off"||Et&&Hn!=="off"&&ht>0||un&&Jn!=="off"&&Ht>0||_i),Pt=O.useMemo(()=>{const k=[];for(const P of Te){const G=de(P),le=Ne.get(G);if(!le||!le.isLava&&!le.isFire)continue;const{x:ce,y:he}=St(P,te);k.push({key:G,x:ce,y:he})}return k},[Te,Ne]),Ct=O.useMemo(()=>{const k=Og({isStairs:!0});return k?Re.get(k):void 0},[Re]),kn=O.useMemo(()=>{const k=Og({isShrine:!0});return k?Re.get(k):void 0},[Re]),Un=O.useMemo(()=>{const k=[];return t.stairsPosition&&k.push({id:`stairs-${de(t.stairsPosition)}`,kind:"stairs",position:t.stairsPosition,asset:Ct}),t.shrinePosition&&k.push({id:`shrine-${de(t.shrinePosition)}`,kind:"shrine",position:t.shrinePosition,asset:kn}),k},[t.stairsPosition,t.shrinePosition,Ct,kn]),Ln=O.useMemo(()=>{const P=(r?.assets||[]).filter(he=>{if(he.type!=="prop")return!1;const ge=he.id.toLowerCase(),ot=new Set((he.tags||[]).map(zn=>zn.toLowerCase()));if(!(ge.includes("mountain")||ot.has("mountain")))return!1;if(!he.theme)return!0;const pn=he.theme.toLowerCase();return pn===ze||pn==="core"}).sort((he,ge)=>he.id.localeCompare(ge.id)),G=String(Ve?.mountainPath||Tt?.mountainPath||"").trim(),le=String(f?.mountainAssetPath||G).trim();if(!le)return P;const ce=P.find(he=>he.path===le);return ce?[ce]:[]},[r?.assets,ze,f?.mountainAssetPath,Tt?.mountainPath,Ve?.mountainPath]),wi=O.useMemo(()=>{const k=new Map;for(const P of Ln)k.set(P.id,X(P));return k},[Ln,X]),Mi=O.useMemo(()=>{if(!Ln.length)return[];const k=Ln.filter(le=>K1(le)===1),P=k.length?k:Ln,G=Te.filter(le=>Ne.get(de(le))?.isWall).sort((le,ce)=>de(le).localeCompare(de(ce)));return G.length?G.map(le=>{const ce=de(le),he=Math.floor(ml(`${Ue}|mountain-tile|${ce}|asset`)*P.length)%P.length,ge=P[he],ot=wi.get(ge.id)||X(ge),{y:lt}=St(le,te);return{id:`mountain-${ce}-${ge.id}`,kind:"mountain",position:le,asset:ge,renderScale:ot.scale,zAnchorY:lt+te*.42+ot.offsetY}}):[]},[Ln,Te,Ne,Ue,wi,X]),Nt=O.useMemo(()=>{const k=new Set((rn?.tags?.length?rn.tags:["clutter","obstacle"]).map(P=>P.toLowerCase()));return(r?.assets||[]).filter(P=>{if(P.type!=="prop"&&P.type!=="decal"||P.id.toLowerCase().includes("mountain"))return!1;const le=(P.tags||[]).map(ce=>ce.toLowerCase());return le.includes("mountain")||!le.some(ce=>k.has(ce))?!1:P.theme?P.theme.toLowerCase()===ze||P.theme.toLowerCase()==="core":!0})},[r?.assets,rn?.tags,ze]),go=O.useMemo(()=>{if(!Nt.length)return[];const k=Math.min(.6,Math.max(0,Number(rn?.density??.08))),P=Math.max(1,Math.floor(Number(rn?.maxPerHex??1))),G=Math.min(2,Math.max(1,Number(rn?.bleedScaleMax??2))),le=[];for(const ce of Te){const he=de(ce),ge=Ne.get(he);if(ge?.isWall||ge?.isLava||ge?.isFire)continue;const{y:ot}=St(ce,te);for(let lt=0;lt<P;lt++){if(ml(`${Ue}|clutter|${he}|slot:${lt}|roll`)>k/(lt+1))continue;const zn=Math.floor(ml(`${Ue}|clutter|${he}|slot:${lt}|pick`)*Nt.length)%Nt.length,jt=Nt[zn],wt=1+ml(`${Ue}|clutter|${he}|slot:${lt}|scale`)*(G-1),Ut=(ml(`${Ue}|clutter|${he}|slot:${lt}|depth`)-.5)*te*.28;le.push({id:`clutter-${he}-${lt}-${jt.id}`,kind:"clutter",position:ce,asset:jt,renderScale:wt,zAnchorY:ot+Ut})}}return le},[Te,Ne,Nt,rn?.density,rn?.maxPerHex,rn?.bleedScaleMax,Ue]),Ol=O.useMemo(()=>{const k=[...Mi,...go];for(const P of Un){const{y:G}=St(P.position,te),le=P.kind==="shrine";k.push({id:P.id,kind:P.kind,position:P.position,asset:P.asset,renderScale:Math.min(2,le?1.5:1.42),zAnchorY:G+(le?te*.32:te*.28),fallback:P.kind})}return k.sort((P,G)=>P.zAnchorY===G.zAnchorY?P.id.localeCompare(G.id):P.zAnchorY-G.zAnchorY),k},[Mi,go,Un]),Wi=O.useMemo(()=>{const k=new Set;for(const P of Mi)k.add(de(P.position));return k},[Mi]),Ui=O.useCallback(k=>{if(!k)return null;const P=k.position||k.destination||k.origin||k.target;return P&&typeof P.q=="number"&&typeof P.r=="number"&&typeof P.s=="number"?P:null},[]);O.useEffect(()=>{if(!mt)return;const k=t.timelineEvents||[],P=t.visualEvents||[];k.length<xe.current&&(xe.current=0);const G=k.slice(xe.current);xe.current=k.length,P.length<oe.current&&(oe.current=0);const le=P.slice(oe.current);oe.current=P.length;const ce=[],he=Date.now();for(const ge of G){if(ge.phase!=="DEATH_RESOLVE")continue;const ot=Ui(ge.payload);ot&&ce.push({id:`decal-tl-${ge.id}-${he}-${ce.length}`,position:ot,href:mt,createdAt:he})}for(const ge of le){if(ge.type!=="vfx")continue;const ot=ge.payload?.type;if(ot!=="vaporize"&&ot!=="explosion_ring")continue;const lt=Ui(ge.payload);lt&&ce.push({id:`decal-vx-${ot}-${he}-${ce.length}`,position:lt,href:mt,createdAt:he})}ce.length>0&&E(ge=>[...ge,...ce].slice(-80))},[t.timelineEvents,t.visualEvents,mt,Ui]),O.useEffect(()=>{const k=t.simulationEvents||[];k.length<ke.current&&(ke.current=0);const P=k.slice(ke.current);ke.current=k.length,P.length>0&&h?.(P)},[t.simulationEvents,h]),O.useEffect(()=>{if(M.length===0)return;const k=12e3,P=window.setTimeout(()=>{const G=Date.now();E(le=>le.filter(ce=>G-ce.createdAt<k))},1e3);return()=>window.clearTimeout(P)},[M]);const mc=O.useCallback(k=>{_(k)},[]);O.useEffect(()=>{c?.(p||N)},[p,N,c]);const Qs=O.useMemo(()=>{const k=new Map;k.set(t.player.id,t.player.position);for(const P of t.enemies)k.set(P.id,P.position);for(const P of t.companions||[])k.set(P.id,P.position);for(const P of t.dyingEntities||[])k.set(P.id,P.position);return k},[t.player.id,t.player.position,t.enemies,t.companions,t.dyingEntities]);O.useEffect(()=>{if(!b)return;const k={turn:t.turnNumber||0,stackTick:t.stackTrace?.length||0,actors:[...Qs.entries()].map(([P,G])=>({id:P,position:{q:G.q,r:G.r,s:G.s}}))};b(k)},[b,t.turnNumber,t.stackTrace,Qs]);const Ss=O.useMemo(()=>(t.visualEvents||[]).filter(k=>k.type==="kinetic_trace").map(k=>k.payload).filter(k=>{if(!k?.actorId||!k.origin||!k.destination)return!1;const P=Qs.get(k.actorId);return!!P&&de(P)===de(k.destination)}),[t.visualEvents,Qs]),Ca=O.useMemo(()=>{if(!Ss.length)return"";const k=t.turnNumber??0,P=Ss.map(G=>{const le=(G.path||[]).map(ce=>`${ce.q},${ce.r},${ce.s}`).join(">");return[G.actorId,`${G.origin.q},${G.origin.r},${G.origin.s}`,`${G.destination.q},${G.destination.r},${G.destination.s}`,G.movementType||"slide",G.startDelayMs||0,G.durationMs||0,le].join("|")}).join("||");return`${k}::${P}`},[Ss,t.turnNumber]),vs=O.useCallback(async(k,P,G,le)=>{if(le!==K.current)return;const ce=k.animate(P,{...G,fill:G.fill??"forwards"});C.current.push(ce);try{await ce.finished}catch{}finally{C.current=C.current.filter(he=>he!==ce)}},[]),Js=O.useCallback(async(k,P,G)=>{if(P!==K.current)return;const le=w.current?.querySelector(`[data-actor-node="${k.actorId}"]`),ce=hn=>{const gn=St(hn,te);return`translate(${gn.x}px, ${gn.y}px)`},he=Math.max(0,k.startDelayMs||0),ge=Math.max(0,performance.now()-G),ot=Math.max(0,he-ge),lt=k.path&&k.path.length>1?k.path:[k.origin,k.destination],pn=Math.max(1,lt.length-1),zn=Math.max(120,k.durationMs||pn*110);if(!le){const hn=Math.max(0,ot+zn);hn>0&&await new Promise(gn=>window.setTimeout(gn,hn));return}if(ot>0&&(await new Promise(hn=>window.setTimeout(hn,ot)),P!==K.current))return;if((k.movementType||"slide")==="teleport"){const hn=Math.max(120,k.durationMs||180);await vs(le,[{transform:ce(k.origin),opacity:1,offset:0},{transform:ce(k.origin),opacity:0,offset:.45},{transform:ce(k.destination),opacity:0,offset:.55},{transform:ce(k.destination),opacity:1,offset:1}],{duration:hn,easing:"linear"},P),P===K.current&&(le.style.transform=ce(k.destination),le.style.opacity="1");return}const jt=[...lt],wt=jt[jt.length-1];(!wt||wt.q!==k.destination.q||wt.r!==k.destination.r||wt.s!==k.destination.s)&&jt.push(k.destination);const Ut=jt.map((hn,gn)=>({transform:ce(hn),offset:jt.length===1?1:gn/(jt.length-1)}));Ut[Ut.length-1]={...Ut[Ut.length-1],transform:ce(k.destination),offset:1},await vs(le,Ut,{duration:zn,easing:"linear"},P),P===K.current&&(le.style.transform=ce(k.destination),le.style.opacity="1")},[vs]),fi=O.useCallback(async()=>{if(H.current)return;H.current=!0,g(!0);const k=++K.current,P=performance.now();try{for(;D.current.length>0&&k===K.current;){const G=D.current.shift();G&&await Js(G,k,P)}}finally{k===K.current&&(H.current=!1,g(!1))}},[Js]);O.useEffect(()=>{if(!Ca){ne.current="";return}Ca!==ne.current&&(ne.current=Ca,D.current.push(...Ss),fi())},[Ca,Ss,fi]),O.useEffect(()=>()=>{K.current++,D.current=[],H.current=!1,C.current.forEach(k=>{try{k.cancel()}catch{}}),C.current=[],g(!1)},[]),O.useEffect(()=>{K.current++,D.current=[],H.current=!1,C.current.forEach(k=>{try{k.cancel()}catch{}}),C.current=[],g(!1),ne.current="",E([]),xe.current=0,oe.current=0},[t.floor]);const qn=O.useMemo(()=>Id(te-1),[]),Cl=O.useMemo(()=>Id(te+1),[]),pc=O.useMemo(()=>Id(te-2),[]),Zs=O.useMemo(()=>`biome-map-clip-${t.floor}`,[t.floor]),Be=O.useMemo(()=>({x:pe.minX-te*2,y:pe.minY-te*2,width:pe.width+te*4,height:pe.height+te*4}),[pe.minX,pe.minY,pe.width,pe.height]);return m.jsx("div",{className:`w-full h-full flex justify-center items-center overflow-hidden transition-transform duration-75 ${A?"animate-shake":""}`,children:m.jsxs("svg",{ref:w,width:"100%",height:"100%",viewBox:`${pe.minX} ${pe.minY} ${pe.width} ${pe.height}`,preserveAspectRatio:"xMidYMid meet",shapeRendering:"geometricPrecision",className:"max-h-full max-w-full",onMouseLeave:()=>_(null),children:[m.jsxs("defs",{children:[m.jsx("clipPath",{id:Zs,clipPathUnits:"userSpaceOnUse",children:Te.map(k=>{const{x:P,y:G}=St(k,te);return m.jsx("polygon",{points:pc,transform:`translate(${P},${G})`},`biome-clip-${de(k)}`)})}),$e&&it==="repeat"&&m.jsxs("pattern",{id:we,patternUnits:"userSpaceOnUse",width:bn,height:bn,patternTransform:`translate(${Dn.x} ${Dn.y})`,children:[m.jsx("image",{href:$e,x:"0",y:"0",width:bn,height:bn,preserveAspectRatio:"xMidYMid slice"}),(Qn.x!==0||Qn.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${Dn.x} ${Dn.y}`,to:`${Dn.x+Qn.x} ${Dn.y+Qn.y}`,dur:`${Qn.durationMs}ms`,repeatCount:"indefinite"})]}),Fe&&pt==="repeat"&&m.jsx("pattern",{id:be,patternUnits:"userSpaceOnUse",width:Dt,height:Dt,patternTransform:`translate(${Yt.x} ${Yt.y})`,children:m.jsx("image",{href:Fe,x:"0",y:"0",width:Dt,height:Dt,preserveAspectRatio:"xMidYMid slice"})}),Et&&Hn==="repeat"&&m.jsxs("pattern",{id:ut,patternUnits:"userSpaceOnUse",width:On,height:On,patternTransform:`translate(${fn.x} ${fn.y})`,children:[m.jsx("image",{href:Et,x:"0",y:"0",width:On,height:On,preserveAspectRatio:"xMidYMid slice"}),(Ft.x!==0||Ft.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${fn.x} ${fn.y}`,to:`${fn.x+Ft.x} ${fn.y+Ft.y}`,dur:`${Ft.durationMs}ms`,repeatCount:"indefinite"})]}),un&&Jn==="repeat"&&m.jsxs("pattern",{id:mn,patternUnits:"userSpaceOnUse",width:dn,height:dn,patternTransform:`translate(${Gt.x} ${Gt.y})`,children:[m.jsx("image",{href:un,x:"0",y:"0",width:dn,height:dn,preserveAspectRatio:"xMidYMid slice"}),(Rn.x!==0||Rn.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${Gt.x} ${Gt.y}`,to:`${Gt.x+Rn.x} ${Gt.y+Rn.y}`,dur:`${Rn.durationMs}ms`,repeatCount:"indefinite"})]}),xn&&m.jsxs("mask",{id:De,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:[m.jsx("rect",{x:Be.x,y:Be.y,width:Be.width,height:Be.height,fill:"white"}),Pt.map(k=>m.jsx("polygon",{points:Cl,transform:`translate(${k.x},${k.y})`,fill:"black",opacity:1},`hole-${k.key}`))]})]}),m.jsxs("g",{"data-layer":"biome-undercurrent",pointerEvents:"none",clipPath:`url(#${Zs})`,children:[$e&&it==="repeat"&&m.jsx("rect",{x:Be.x,y:Be.y,width:Be.width,height:Be.height,fill:`url(#${we})`,opacity:Ei}),$e&&it==="cover"&&m.jsx("image",{href:$e,x:Be.x+Dn.x,y:Be.y+Dn.y,width:Be.width,height:Be.height,preserveAspectRatio:"xMidYMid slice",opacity:Ei})]}),m.jsxs("g",{"data-layer":"biome-crust",pointerEvents:"none",clipPath:`url(#${Zs})`,children:[Fe&&pt==="repeat"&&m.jsx("rect",{x:Be.x,y:Be.y,width:Be.width,height:Be.height,fill:`url(#${be})`,opacity:Sn,mask:`url(#${De})`}),Fe&&pt==="cover"&&m.jsx("image",{href:Fe,x:Be.x+Yt.x,y:Be.y+Yt.y,width:Be.width,height:Be.height,preserveAspectRatio:"xMidYMid slice",opacity:Sn,mask:`url(#${De})`}),Et&&Hn==="repeat"&&ht>0&&m.jsx("rect",{x:Be.x,y:Be.y,width:Be.width,height:Be.height,fill:`url(#${ut})`,opacity:ht,mask:`url(#${De})`}),Et&&Hn==="cover"&&ht>0&&m.jsx("image",{href:Et,x:Be.x+fn.x,y:Be.y+fn.y,width:Be.width,height:Be.height,preserveAspectRatio:"xMidYMid slice",opacity:ht,mask:`url(#${De})`}),un&&Jn==="repeat"&&Ht>0&&m.jsx("rect",{x:Be.x,y:Be.y,width:Be.width,height:Be.height,fill:`url(#${mn})`,opacity:Ht,mask:`url(#${De})`}),un&&Jn==="cover"&&Ht>0&&m.jsx("image",{href:un,x:Be.x+Gt.x,y:Be.y+Gt.y,width:Be.width,height:Be.height,preserveAspectRatio:"xMidYMid slice",opacity:Ht,mask:`url(#${De})`}),_i&&Pi&&m.jsx("rect",{x:Be.x,y:Be.y,width:Be.width,height:Be.height,fill:Pi,opacity:Gi,mask:`url(#${De})`,style:di!=="normal"?{mixBlendMode:di}:void 0})]}),m.jsx("g",{"data-layer":"interaction-preview",children:m.jsx(A1,{gameState:t,selectedSkillId:a,showMovementRange:o,hoveredTile:x,enginePreviewGhost:Ce})}),m.jsxs("g",{"data-layer":"interaction-tiles",children:[Te.map(k=>{const P=de(k),G=Ne.get(P)||{isWall:!1,isLava:!1,isFire:!1},le=G.isWall,ce=G.isLava,he=G.isFire,ge=o&&!a&&ae.has(P)||o&&!a&&!Me&&V.has(P)&&!le,lt=!!a&&ee.has(P)||ge,pn=ue.has(P),zn=P===Se,jt=R?P===R:!1,wt=le&&!Wi.has(P),Ut=me&&!wt,hn=O1({isWall:wt,isLava:ce,isFire:he,theme:t.theme}),gn=Ut?void 0:Re.get(hn)?.path;return m.jsx(y1,{hex:k,onClick:()=>i(k),isValidMove:lt,isTargeted:pn,isStairs:zn,isLava:ce,isFire:he,isShrine:jt,isWall:wt,onMouseEnter:mc,assetHref:gn,interactionOnly:Ut},P)}),m.jsx("g",{children:M.map(k=>{const{x:P,y:G}=St(k.position,te),le=Date.now()-k.createdAt,ce=Math.max(.18,.75-le/12e3*.57);return m.jsx("image",{href:k.href,x:P-te*.7,y:G-te*.7,width:te*1.4,height:te*1.4,preserveAspectRatio:"xMidYMid meet",opacity:ce},k.id)})})]}),m.jsx("g",{"data-layer":"clutter-obstacles",pointerEvents:"none",children:Ol.map(k=>{const{x:P,y:G}=St(k.position,te);if(k.asset?.path){const le=Math.min(1,Math.max(0,k.asset.anchor?.x??.5)),ce=Math.min(1,Math.max(0,k.asset.anchor?.y??.5)),he=k.kind==="mountain",ge=he?wi.get(k.asset.id)||X(k.asset):null,ot=ge?ge.anchorX:le,lt=ge?ge.anchorY:ce,pn=P+(ge?ge.offsetX:0),zn=G+(ge?ge.offsetY:0),jt=Math.max(8,k.asset.width*It*k.renderScale),wt=Math.max(8,k.asset.height*It*k.renderScale),Ut=k.kind==="shrine",hn=k.kind==="stairs",gn=Ut||hn,Na=Ut?"rgba(251,146,60,0.25)":"rgba(74,222,128,0.22)",Oi=Ut?"#fdba74":"#86efac",Ra=P,ka=G-wt*lt+wt*.84,Xi=Math.max(14,jt*.32),Qi=Math.max(8,wt*.14);return m.jsxs("g",{children:[gn&&m.jsxs(m.Fragment,{children:[m.jsx("ellipse",{cx:Ra,cy:ka,rx:Xi,ry:Qi,fill:Na,opacity:.95}),m.jsx("ellipse",{cx:Ra,cy:ka,rx:Xi*1.14,ry:Qi*1.14,fill:"none",stroke:Oi,strokeWidth:2,opacity:.72,style:{animation:`shrineGlow ${Ut?1.8:2.4}s ease-in-out infinite`}})]}),(()=>{const Nl=gn?Ut?"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(251,146,60,0.45)) saturate(1.08) contrast(1.06)":"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(74,222,128,0.42)) saturate(1.08) contrast(1.06)":he?"drop-shadow(0 7px 10px rgba(0,0,0,0.56)) saturate(1.04) contrast(1.08)":"drop-shadow(0 5px 8px rgba(0,0,0,0.48)) saturate(0.98) contrast(1.04)",yo=gn?.99:he?.96:.9,La=!!(ge&&ge.crustBlendMode!=="off"&&ge.crustBlendOpacity>0),Ji=!!(ge&&ge.tintBlendMode!=="off"&&ge.tintOpacity>0),Ci=ge?.crustBlendMode!=="off"?ge?.crustBlendMode:void 0,bo=ge?.tintBlendMode!=="off"?ge?.tintBlendMode:void 0,qi=pn-jt*ot,ei=zn-wt*lt,ea=X1(k.id),ta=`mountain-ground-gradient-${t.floor}-${ea}`,So=`mountain-ground-mask-${t.floor}-${ea}`,na=`mountain-tint-filter-${t.floor}-${ea}`;return m.jsxs(m.Fragment,{children:[(La||Ji)&&m.jsxs("defs",{children:[La&&m.jsxs(m.Fragment,{children:[m.jsxs("linearGradient",{id:ta,x1:"0",y1:"0",x2:"0",y2:"1",children:[m.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0"}),m.jsx("stop",{offset:"42%",stopColor:"#ffffff",stopOpacity:"0.04"}),m.jsx("stop",{offset:"64%",stopColor:"#ffffff",stopOpacity:"0.42"}),m.jsx("stop",{offset:"82%",stopColor:"#ffffff",stopOpacity:"0.82"}),m.jsx("stop",{offset:"100%",stopColor:"#ffffff",stopOpacity:"1"})]}),m.jsx("mask",{id:So,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:m.jsx("rect",{x:qi,y:ei,width:jt,height:wt,fill:`url(#${ta})`})})]}),Ji&&m.jsx("filter",{id:na,x:"-10%",y:"-10%",width:"120%",height:"120%",children:m.jsx("feColorMatrix",{type:"matrix",values:ge?.tintMatrixValues})})]}),m.jsx("image",{href:k.asset.path,x:qi,y:ei,width:jt,height:wt,preserveAspectRatio:"xMidYMid meet",opacity:yo,style:{filter:Nl}}),La&&m.jsx("image",{href:k.asset.path,x:qi,y:ei,width:jt,height:wt,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.9,ge?.crustBlendOpacity||0),mask:`url(#${So})`,style:{mixBlendMode:Ci,filter:"brightness(0.92) saturate(0.76) contrast(1.03)"}}),Ji&&m.jsx("image",{href:k.asset.path,x:qi,y:ei,width:jt,height:wt,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.95,ge?.tintOpacity||0),filter:`url(#${na})`,style:{mixBlendMode:bo}})]})})()]},k.id)}return k.fallback==="shrine"?m.jsxs("g",{transform:`translate(${P},${G})`,children:[m.jsx("polygon",{points:"0,-18 8,-4 5,12 -5,12 -8,-4",fill:"#f97316",stroke:"#fff",strokeWidth:"1",opacity:"0.9"}),m.jsx("polygon",{points:"-2,-14 2,-14 1,-2 -1,-2",fill:"rgba(255,255,255,0.6)"}),m.jsx("circle",{cx:"0",cy:"0",r:"14",fill:"none",stroke:"#fdba74",strokeWidth:"2",opacity:"0.4",style:{animation:"shrineGlow 2s ease-in-out infinite"}})]},k.id):m.jsxs("g",{transform:`translate(${P},${G})`,children:[m.jsx("rect",{x:"-12",y:"6",width:"8",height:"4",fill:"#1f2937",rx:"1"}),m.jsx("rect",{x:"-6",y:"2",width:"8",height:"4",fill:"#374151",rx:"1"}),m.jsx("rect",{x:"0",y:"-2",width:"8",height:"4",fill:"#4b5563",rx:"1"}),m.jsx("rect",{x:"6",y:"-6",width:"8",height:"4",fill:"#6b7280",rx:"1"}),m.jsx("path",{d:"M 2 -14 L 2 -20 L -4 -20 L 2 -26 L 8 -20 L 2 -20",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1"})]},k.id)})}),m.jsxs("g",{children:[t.lastSpearPath&&t.lastSpearPath.length>=2&&(()=>{const P=t.lastSpearPath.map(G=>St(G,te)).map((G,le)=>`${le===0?"M":"L"} ${G.x} ${G.y}`).join(" ");return m.jsx("path",{d:P,stroke:"rgba(255, 255, 255, 0.15)",strokeWidth:"2",fill:"none",strokeDasharray:"4 2",strokeLinecap:"round"})})(),t.spearPosition&&m.jsx(Yr,{entity:{id:"spear",type:"player",subtype:"footman",position:t.spearPosition,hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],speed:0,factionId:"player"},isSpear:!0}),m.jsx(Yr,{entity:t.player,movementTrace:$[t.player.id],waapiControlled:!0,assetHref:Re.get(ic(t.player))?.path,fallbackAssetHref:kd(t.player),floorTheme:ze},`player-${t.floor}`),t.enemies.map(k=>m.jsx(Yr,{entity:k,movementTrace:$[k.id],waapiControlled:!0,assetHref:Re.get(ic(k))?.path,fallbackAssetHref:kd(k),floorTheme:ze},`${k.id}-${t.floor}`)),t.dyingEntities?.map(k=>m.jsx(Yr,{entity:k,isDying:!0,movementTrace:$[k.id],waapiControlled:!0,assetHref:Re.get(ic(k))?.path,fallbackAssetHref:kd(k),floorTheme:ze},`dying-${k.id}-${t.floor}-${t.turnNumber}`)),m.jsx(j1,{visualEvents:t.visualEvents||[],timelineEvents:t.timelineEvents||[],onBusyStateChange:I,assetManifest:r})]}),m.jsx("g",{"data-layer":"interaction-ui-grid",pointerEvents:"none",shapeRendering:"crispEdges",children:Te.map(k=>{const{x:P,y:G}=St(k,te);return m.jsx("g",{transform:`translate(${P},${G})`,children:m.jsx("polygon",{points:qn,fill:"none",stroke:"rgba(201,224,255,0.22)",strokeWidth:1.1})},`grid-${de(k)}`)})}),m.jsx("g",{"data-layer":"ui-objective-markers",pointerEvents:"none",children:Un.map(k=>{const{x:P,y:G}=St(k.position,te),le=k.kind==="shrine",ce=le?"#c2410c":"#15803d",he=le?"S":"E",ge=P+te*.52,ot=G-te*.52;return m.jsxs("g",{transform:`translate(${ge},${ot})`,children:[m.jsx("circle",{r:14,fill:"none",stroke:"rgba(255,255,255,0.55)",strokeWidth:2,style:{animation:`shrineGlow ${le?1.6:1.9}s ease-in-out infinite`}}),m.jsx("circle",{r:10.5,fill:ce,stroke:"#ffffff",strokeWidth:2}),m.jsx("text",{x:0,y:0,textAnchor:"middle",dy:".34em",fill:"#ffffff",fontSize:10,fontWeight:900,style:{textShadow:"0 1px 2px rgba(0,0,0,0.7)"},children:he})]},`marker-${k.id}`)})})]})})},Q1=({gameState:t})=>{const{initiativeQueue:i,player:a,enemies:o}=t;if(!i||!i.entries||i.entries.length===0)return null;const c=i.entries.map(r=>r.actorId===a.id?a:o.find(f=>f.id===r.actorId)).filter(r=>!!r);return m.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-white/5 border border-white/10 rounded-2xl backdrop-blur-md",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Turn Sequence"}),m.jsx("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-none",children:c.map((r,f)=>{const h=r.id===a.id,b=f===i.currentIndex,A=i.entries.find(v=>v.actorId===r.id)?.hasActed;return m.jsxs("div",{className:`flex flex-col items-center shrink-0 transition-all duration-300 ${b?"scale-110":"opacity-60 scale-90"}`,children:[m.jsxs("div",{className:`
                                w-10 h-10 rounded-xl flex items-center justify-center border-2 transition-all relative
                                ${h?"bg-blue-500/20 border-blue-500/50":"bg-red-500/20 border-red-500/50"}
                                ${b?"shadow-[0_0_15px_rgba(255,255,255,0.2)] border-white/80":""}
                                ${A?"grayscale":""}
                            `,children:[m.jsx("span",{className:"text-xl",children:_l(r.subtype,r.type,r.enemyType,r.archetype).icon}),b&&m.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping"}),A&&!b&&m.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-[#030712] text-[8px]",children:""})]}),m.jsx("div",{className:"w-8 h-1 bg-white/10 rounded-full mt-2 overflow-hidden",children:m.jsx("div",{className:`h-full ${h?"bg-blue-400":"bg-red-400"}`,style:{width:`${r.hp/r.maxHp*100}%`}})}),m.jsx("span",{className:`text-[8px] font-bold uppercase mt-1 ${h?"text-blue-300":"text-red-300"} ${b?"text-white":""}`,children:h?"You":r.subtype||"Enemy"})]},`${r.id}-${f}`)})})]})},J1=({gameState:t,onReset:i,onWait:a,onExitToHub:o,inputLocked:c=!1,compact:r=!1,hideInitiativeQueue:f=!1,hideLog:h=!1})=>{const b=ay(t),y=Array.isArray(t.message)?t.message:[],A=Ii.useRef(null),[v,x]=Ii.useState("all"),[_,p]=Ii.useState("all"),g=(M,E)=>{const w=M||"",D=w.toLowerCase(),H=w.match(/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*(.*)$/i);if(H){const ne=H[1].toLowerCase(),xe=H[2].toLowerCase(),oe=H[3]||"",ke=xe.includes("combat")?"combat":xe.includes("hazard")?"hazard":xe.includes("objective")||xe.includes("score")?"objective":xe.includes("ai")?"ai":"system";return{idx:E,raw:M,text:oe,level:ne,channel:ke}}const C=/(attacked|killed|blast|stunned|damage|hit|healed|shield|bash|spear|fireball|jump|dash)/i.test(D)?"combat":/(lava|burn|hazard|void|sink|fire damage)/i.test(D)?"hazard":/(score|objective|floor|stairs|descending|arcade cleared)/i.test(D)?"objective":/(enemy|falcon|intent|telegraph|moves to|repositioning|attacks)/i.test(D)?"ai":"system",K=/(fallen|warning|error|failed|invalid|blocked|cannot)/i.test(D)?"critical":/(debug|trace|telemetry|seed|counter|rng)/i.test(D)?"debug":/(marks the impact zone|telegraph|planning|intent)/i.test(D)?"verbose":"info";return{idx:E,raw:M,text:w,level:K,channel:C}},N=Ii.useMemo(()=>y.map((M,E)=>g(M,E)),[y]),I=Ii.useMemo(()=>N.filter(M=>(v==="all"||M.level===v)&&(_==="all"||M.channel===_)),[N,v,_]);return Ii.useEffect(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},[I]),m.jsxs("div",{className:"flex flex-col h-full max-h-screen",children:[m.jsxs("div",{className:`flex flex-col overflow-y-auto flex-1 min-h-0 ${r?"gap-4 p-4":"gap-8 p-8"}`,children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h1",{className:`${r?"text-base":"text-xl"} font-black uppercase tracking-widest text-white/90 mb-1`,children:"Hoplite"}),m.jsx("p",{className:"text-[10px] font-bold text-white/30 uppercase tracking-[0.2em]",children:"Tactical Arena"})]}),m.jsx("div",{className:`px-2 py-1 bg-white/10 rounded border border-white/20 text-[10px] font-black text-white/60 ${r?"hidden sm:block":""}`,children:"V2.1.0"})]}),!f&&m.jsx(Q1,{gameState:t}),m.jsxs("div",{className:r?"space-y-4":"space-y-6",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Vitality"}),m.jsxs("div",{className:"flex items-end gap-2",children:[m.jsx("span",{className:`${r?"text-3xl":"text-4xl"} font-black text-red-500 leading-none`,children:t.player.hp}),m.jsx("span",{className:"text-xl text-white/20 font-bold leading-none mb-1",children:"/"}),m.jsx("span",{className:"text-xl text-gray-500 font-bold leading-none mb-1",children:t.player.maxHp})]})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Guardian Plating"}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:`w-3 h-3 rounded-sm ${t.player.temporaryArmor?"bg-blue-400 rotate-45":"bg-white/5 border border-white/10"}`}),m.jsx("span",{className:"text-2xl font-black text-blue-400 leading-none",children:t.player.temporaryArmor||0})]})]}),t.enemies.filter(M=>M.subtype==="sentinel").map(M=>m.jsxs("div",{className:"pt-4 animate-in slide-in-from-right-8 duration-500",children:[m.jsxs("div",{className:"flex justify-between items-end mb-2",children:[m.jsx("span",{className:"text-xs font-black text-red-500 uppercase tracking-tighter italic",children:"Sentinel Directive"}),m.jsxs("span",{className:"text-lg font-black",children:[M.hp," ",m.jsxs("span",{className:"text-white/20 text-xs",children:["/ ",M.maxHp]})]})]}),m.jsx("div",{className:"h-4 w-full bg-red-950/30 rounded-md border border-red-500/20 overflow-hidden",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-red-600 to-red-400 shadow-[0_0_20px_rgba(239,68,68,0.4)] transition-all duration-300",style:{width:`${M.hp/M.maxHp*100}%`}})})]},M.id))]}),m.jsxs("div",{className:`${r?"py-4 space-y-4":"py-8 space-y-6"} border-y border-white/5`,children:[m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Arcade Progress"}),m.jsxs("span",{className:"text-xl font-black",children:[t.floor," ",m.jsx("span",{className:"text-white/20 text-sm",children:"/ 10"})]})]}),m.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden border border-white/5",children:m.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.4)] transition-all duration-1000 ease-out",style:{width:`${t.floor/10*100}%`}})})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Current Score"}),m.jsx("span",{className:"text-xl font-black text-white",children:b.toLocaleString()})]})]}),m.jsxs("div",{className:`flex flex-col ${r?"gap-2":"gap-3"}`,children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Directives"}),m.jsxs("button",{disabled:c,onClick:a,className:`w-full flex justify-between items-center ${r?"px-3 py-2.5":"px-4 py-3"} border rounded-xl transition-all group ${c?"bg-white/[0.03] border-white/5 text-white/30 cursor-not-allowed opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}`,children:[m.jsx("span",{className:"text-sm font-bold text-white/70",children:"Secure & Wait"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),m.jsxs("button",{onClick:i,className:`w-full flex justify-between items-center ${r?"px-3 py-2.5":"px-4 py-3"} bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-xl transition-all group`,children:[m.jsx("span",{className:"text-sm font-bold text-red-400/80",children:"Reset Chronology"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),m.jsxs("button",{onClick:o,className:`w-full flex justify-between items-center ${r?"px-3 py-2.5":"px-4 py-3"} bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all group`,children:[m.jsx("span",{className:"text-sm font-bold text-white/70",children:"Return to Hub"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]})]})]}),!h&&y.length>0&&m.jsxs("div",{className:`${r?"p-4":"p-8"} border-t border-white/5 bg-[#030712]/80 backdrop-blur-sm`,children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold block",children:"Tactical Log"}),m.jsxs("div",{className:`items-center gap-2 ${r?"hidden sm:flex":"flex"}`,children:[m.jsxs("select",{value:_,onChange:M=>p(M.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[m.jsx("option",{value:"all",children:"All Channels"}),m.jsx("option",{value:"combat",children:"Combat"}),m.jsx("option",{value:"hazard",children:"Hazard"}),m.jsx("option",{value:"objective",children:"Objective"}),m.jsx("option",{value:"ai",children:"AI"}),m.jsx("option",{value:"system",children:"System"})]}),m.jsxs("select",{value:v,onChange:M=>x(M.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[m.jsx("option",{value:"all",children:"All Levels"}),m.jsx("option",{value:"info",children:"Info"}),m.jsx("option",{value:"verbose",children:"Verbose"}),m.jsx("option",{value:"debug",children:"Debug"}),m.jsx("option",{value:"critical",children:"Critical"})]})]})]}),m.jsxs("div",{ref:A,className:"flex flex-col gap-2 bg-white/[0.02] border border-white/5 p-4 rounded-2xl overflow-y-auto max-h-[140px]",children:[I.slice(-20).map(M=>m.jsxs("div",{className:"flex gap-2 items-start",children:[m.jsxs("span",{className:"text-[10px] text-white/20 font-bold mt-1 leading-none shrink-0",children:["[",M.idx,"]"]}),m.jsx("span",{className:`text-[9px] mt-1 px-1.5 py-0.5 rounded border shrink-0 ${M.level==="critical"?"text-red-300 border-red-400/40 bg-red-500/10":M.level==="debug"?"text-cyan-300 border-cyan-400/40 bg-cyan-500/10":M.level==="verbose"?"text-amber-300 border-amber-400/40 bg-amber-500/10":"text-white/60 border-white/20 bg-white/5"}`,children:M.level.toUpperCase()}),m.jsx("span",{className:"text-[9px] mt-1 px-1.5 py-0.5 rounded border border-white/20 bg-white/5 text-white/60 shrink-0",children:M.channel.toUpperCase()}),m.jsx("p",{className:"text-[11px] leading-tight text-white/70 font-medium whitespace-pre-wrap",children:M.text})]},M.idx)),I.length===0&&m.jsx("div",{className:"text-[11px] text-white/40 italic",children:"No messages match current filters."})]})]})]})},Z1=({onSelect:t,gameState:i})=>{const a=i.player,c=(i.pendingStatus?.shrineOptions||i.shrineOptions||["EXTRA_HP"]).map(r=>{if(r==="EXTRA_HP")return{id:"EXTRA_HP",label:"Extra Heart",desc:"Increases your Max HP by 1 and heals you to full.",color:"bg-red-900/40 border-red-500"};const f=Mn.getUpgrade(r),h=Mn.getSkillForUpgrade(r),b=a.activeSkills?.find(A=>A.id===h),y=b?.slot==="offensive"?"bg-orange-900/40 border-orange-500":b?.slot==="defensive"?"bg-blue-900/40 border-blue-500":"bg-green-900/40 border-green-500";return{id:r,label:f?f.name:r,desc:f?.description||"Unknown upgrade.",color:y}});return m.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-[100] p-4",children:m.jsxs("div",{className:"bg-gray-900 p-8 rounded-3xl border-2 border-slate-700 max-w-2xl w-full shadow-2xl relative overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-blue-500 to-green-500"}),m.jsx("h2",{className:"text-4xl font-black text-white mb-2 text-center tracking-tight",children:"SHRINE BLESSING"}),m.jsx("p",{className:"text-slate-400 mb-8 text-center text-lg",children:"The gods offer you a choice. Choose wisely."}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(r=>m.jsxs("button",{onClick:()=>t(r.id),className:`
                                relative p-6 border-2 rounded-2xl text-left transition-all group overflow-hidden
                                hover:scale-[1.02] active:scale-[0.98]
                                ${r.color} hover:bg-slate-800
                            `,children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-blue-200",children:r.label}),m.jsx("p",{className:"text-sm text-slate-400 group-hover:text-slate-300 leading-relaxed",children:r.desc}),m.jsx("div",{className:"absolute -right-2 -bottom-2 opacity-0 group-hover:opacity-10 scale-0 group-hover:scale-150 transition-all font-bold text-4xl",children:"*"})]},r.id))})]})})},$g=({skills:t,selectedSkillId:i,onSelectSkill:a,hasSpear:o,gameState:c,inputLocked:r=!1,compact:f=!1})=>{const h=["offensive","defensive","utility"];return m.jsx("div",{className:f?"grid grid-cols-3 gap-2 sm:grid-cols-4":"flex flex-col gap-4",children:h.flatMap(b=>t.filter(A=>A.slot===b).map(A=>{const v=i===A.id,x=A.currentCooldown>0,_=A.id==="SPEAR_THROW",p=r||x&&!_||_&&!o,g=EA(A.id),N=g?.name||A.name,I=typeof N=="function"?N(c):N,M=g?.icon||"";return m.jsxs("button",{disabled:p,onClick:()=>a(v?null:A.id),className:`
                            relative w-full ${f?"h-20 rounded-xl gap-0.5":"h-24 rounded-2xl gap-1"} flex flex-col items-center justify-center
                            border transition-all transform hover:translate-x-1
                            ${v?"bg-blue-600 border-white shadow-[0_0_20px_rgba(59,130,246,0.5)]":"bg-white/5 border-white/10 hover:border-blue-500/50"}
                            ${p?"opacity-40 grayscale pointer-events-none":"cursor-pointer"}
                        `,children:[m.jsx("span",{className:f?"text-2xl":"text-3xl",children:M}),m.jsx("span",{className:`${f?"text-[9px] tracking-[0.12em]":"text-[10px] tracking-widest"} uppercase font-bold text-white/50 text-center px-2 leading-tight`,children:I}),x&&!_&&m.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-black/40 ${f?"rounded-xl":"rounded-2xl"} backdrop-blur-[2px]`,children:m.jsx("span",{className:`${f?"text-2xl":"text-3xl"} font-black text-white`,children:A.currentCooldown})}),m.jsx("div",{className:`absolute ${f?"-top-1 left-2 px-1.5":"-top-2 left-4 px-2"} py-0.5 bg-[#030712] rounded-full border border-white/10 text-[8px] uppercase font-black tracking-widest text-white/40`,children:b})]},A.id)}))})},eT=({onSelect:t})=>m.jsxs("div",{className:"relative z-50 flex flex-col items-center justify-center p-8 gap-8 animate-in fade-in zoom-in duration-500",children:[m.jsxs("div",{className:"text-center space-y-2",children:[m.jsx("h1",{className:"text-4xl font-black uppercase tracking-widest text-white mb-2",children:"Select Class"}),m.jsx("p",{className:"text-white/40 text-sm uppercase tracking-wider",children:"Choose your combat doctrine"})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl",children:Object.values(po).map(i=>m.jsxs("button",{onClick:()=>{console.log("Archetype Selected:",i.id),t(i)},className:"group relative flex flex-col items-start p-8 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/30 rounded-3xl transition-all hover:scale-[1.02] text-left cursor-pointer",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 rounded-3xl transition-opacity"}),m.jsxs("div",{className:"relative z-10 w-full",children:[m.jsxs("div",{className:"flex justify-between items-start mb-4",children:[m.jsx("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10 group-hover:border-white/30 transition-colors",children:m.jsx("span",{className:"text-3xl",children:_l(i.id==="ASSASSIN"?"assassin_player":i.id.toLowerCase(),"player").icon})}),m.jsx("div",{className:"px-3 py-1 bg-white/5 rounded-full border border-white/10 text-[10px] font-bold uppercase tracking-widest text-white/50",children:i.id==="VANGUARD"?"Standard":"Advanced"})]}),m.jsx("h3",{className:"text-2xl font-black uppercase tracking-wide text-white mb-2",children:i.name}),m.jsx("p",{className:"text-white/60 text-sm leading-relaxed mb-6 h-12",children:i.description}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/30 font-bold border-b border-white/5 pb-1",children:"Starting Loadout"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.startingSkills.map(a=>m.jsx("div",{className:"px-2 py-1 bg-black/40 rounded border border-white/10 text-[10px] text-blue-200",children:a.replace("_"," ")},a))})]})]})]},i.id))})]}),tT="hop_replays_v1",nT="hop_leaderboard_v1",Vg=()=>{try{const t=localStorage.getItem(tT);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load replays",t),[]}},Yg=()=>{try{const t=localStorage.getItem(nT);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load leaderboard",t),[]}},Kg=t=>{const i=Array.isArray(t.actions)?t.actions:[],a=new Set(i.map(y=>y?.type)),o=a.has("ADVANCE_TURN"),c=a.has("RESOLVE_PENDING"),r=(t.floor||0)>=5&&i.length<Math.max(25,(t.floor||0)*4),f=(t.replayVersion??1)<2,h=i.length===0,b=h?"invalid replay":r?"truncated replay":f?"legacy replay":null;return{isLegacy:f,invalid:h,suspicious:r||t.floor>1&&!c,label:b,hasTurnAdvance:o,hasPendingResolve:c,actionCount:i.length}},Fg=({onStartReplay:t})=>{const[i,a]=O.useState(()=>Vg()),[o,c]=O.useState(()=>Yg()),[r,f]=O.useState(""),[h,b]=O.useState(""),[y,A]=O.useState(""),[v,x]=O.useState(null);O.useEffect(()=>{const g=()=>{a(Vg()),c(Yg())};return window.addEventListener("storage",g),()=>window.removeEventListener("storage",g)},[]);const _=()=>{x(null);try{const g=y.trim();if(!g)return x("Paste actions JSON first."),null;const N=JSON.parse(g);let I=r.trim()||void 0,M=h.trim()||void 0,E=[];return Array.isArray(N)?E=N:N&&typeof N=="object"&&(E=Array.isArray(N.actions)?N.actions:[],I=I||(typeof N.seed=="string"?N.seed:void 0),M=M||(typeof N.loadoutId=="string"?N.loadoutId:void 0)),!Array.isArray(E)||E.length===0?(x('No actions found. Provide a JSON action array or object with "actions".'),null):E.filter(H=>H&&typeof H.type=="string").length===0?(x('Actions must be objects with a "type" field.'),null):{id:`manual-${Date.now()}`,seed:I,loadoutId:M,actions:E,score:0,floor:1,date:new Date().toISOString(),replayVersion:2,diagnostics:{actionCount:E.length,hasTurnAdvance:E.some(H=>H?.type==="ADVANCE_TURN"),hasPendingResolve:E.some(H=>H?.type==="RESOLVE_PENDING"),suspiciouslyShort:!1}}}catch(g){return x(`Invalid JSON: ${g?.message||"parse error"}`),null}},p=()=>{const g=_();g&&t(g)};return m.jsxs("div",{className:"flex flex-col gap-8",children:[m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-emerald-400",children:"Manual Replay"}),m.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Paste from UPA"})]}),m.jsxs("div",{className:"space-y-2 p-3 rounded-2xl border border-white/5 bg-white/[0.02]",children:[m.jsx("input",{value:r,onChange:g=>f(g.target.value),placeholder:"Seed (optional if included in JSON)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),m.jsx("input",{value:h,onChange:g=>b(g.target.value),placeholder:"Loadout ID (optional)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),m.jsx("textarea",{value:y,onChange:g=>A(g.target.value),placeholder:'Paste JSON actions array, or object: {"seed":"...","loadoutId":"...","actions":[...]}',rows:6,className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40 font-mono"}),v&&m.jsx("div",{className:"text-[10px] text-red-400 font-bold uppercase tracking-wider",children:v}),m.jsx("button",{onClick:p,className:"w-full py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 text-xs font-black uppercase tracking-widest transition-colors",children:"Start Manual Replay"})]})]}),m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400",children:"Hall of Fame"}),m.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Top 5 Only"})]}),m.jsxs("div",{className:"space-y-2",children:[o.length===0&&m.jsx("div",{className:"p-4 rounded-xl border border-white/5 bg-white/[0.02] text-center",children:m.jsx("span",{className:"text-[10px] text-white/30 uppercase font-black",children:"No Champions Yet"})}),o.slice(0,5).map((g,N)=>{const I={id:g.id,seed:g.seed,loadoutId:g.loadoutId,actions:g.actions||[],score:g.score,floor:g.floor,date:g.date,replayVersion:g.replayVersion,diagnostics:g.diagnostics},M=Kg(I);return m.jsxs("button",{onClick:()=>t(I),className:"w-full group relative flex items-center gap-4 p-4 bg-white/[0.03] hover:bg-white/[0.07] border border-white/5 hover:border-indigo-500/30 rounded-2xl transition-all text-left",children:[m.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-indigo-500/10 rounded-lg text-indigo-400 font-black text-sm border border-indigo-500/20",children:N+1}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[m.jsx("span",{className:"font-black text-white uppercase text-xs truncate tracking-wider",children:g.name}),m.jsx("span",{className:"text-[10px] font-black text-indigo-400 tabular-nums",children:g.score.toLocaleString()})]}),m.jsxs("div",{className:"text-[9px] text-white/30 font-bold uppercase tracking-widest",children:["Floor ",g.floor," * ",new Date(g.date).toLocaleDateString()," * ",M.actionCount," acts"]}),M.label&&m.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:M.label})]}),m.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-indigo-400 text-xs",children:"Play"})]},g.id)})]})]}),m.jsxs("section",{children:[m.jsx("div",{className:"flex items-center justify-between mb-4",children:m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Recent Simulations"})}),m.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar pr-2",children:[i.length===0&&m.jsx("div",{className:"text-center py-4",children:m.jsx("span",{className:"text-[10px] text-white/10 uppercase font-bold",children:"Log Empty"})}),i.slice(0,10).map(g=>{const N=Kg(g);return m.jsxs("button",{onClick:()=>t(g),className:"w-full flex items-center justify-between p-3 hover:bg-white/[0.04] rounded-xl transition-colors text-left group",children:[m.jsxs("div",{className:"min-w-0",children:[m.jsxs("div",{className:"text-[10px] font-bold text-white/60 mb-0.5 truncate uppercase",children:["Score: ",m.jsx("span",{className:"text-white",children:g.score})," * F",g.floor," * ",N.actionCount," acts"]}),m.jsx("div",{className:"text-[9px] text-white/20 font-medium",children:new Date(g.date).toLocaleTimeString()}),N.label&&m.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:N.label})]}),m.jsx("div",{className:"text-[10px] text-white/0 group-hover:text-white/40 font-black uppercase tracking-widest transition-all",children:"Replay"})]},g.id)})]})]})]})};class iT{state;constructor(){this.state=gs(1,"tutorial-seed"),this.state.enemies=[],this.state.tiles=new Map}setPlayer(i,a){this.state.player={...this.state.player,position:i,previousPosition:i,activeSkills:a.map(o=>{const c=Mn.get(o);return{id:o,name:typeof c?.name=="function"?c.name(this.state):c?.name||o,description:c?.description||"",slot:c?.slot||"offensive",cooldown:c?.baseVariables.cooldown||0,currentCooldown:0,range:c?.baseVariables.range||0,upgrades:Object.keys(c?.upgrades||{}),activeUpgrades:[]}})}}spawnEnemy(i,a,o){const c=Pd[i]||{hp:1,maxHp:1};this.state.enemies.push({id:o,type:"enemy",subtype:i,position:a,previousPosition:a,hp:c.hp,maxHp:c.maxHp,enemyType:c.type||"melee",statusEffects:[],temporaryArmor:0,activeSkills:[],speed:c.speed||1,factionId:"enemy"})}spawnFalcon(i,a){const o={id:a,type:"enemy",subtype:"falcon",factionId:"player",speed:95,position:{...i},previousPosition:{...i},hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],isFlying:!0,companionOf:"player",companionState:{mode:"roost",orbitStep:0,apexStrikeCooldown:0}};this.state.enemies.push(o),this.state.companions||(this.state.companions=[]),this.state.companions.push(o)}spawnCompanion(i,a,o){i==="falcon"&&this.spawnFalcon(a,o)}setTile(i,a){const o=a.toUpperCase(),c=de(i),r=fo[o];if(!r){console.warn(`Attempted to set unknown tile type: ${o}`);return}this.state.tiles.set(c,{baseId:o,position:i,traits:new Set(r.defaultTraits||[]),effects:[],occupantId:void 0})}addUpgrade(i,a){this.state.player.activeSkills=(this.state.player.activeSkills||[]).map(o=>o.id===i?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}useSkill(i,a){}wait(){}move(i){}getEnemy(i){return this.state.enemies.find(a=>a.id===i)}setTurn(i){this.state.turnNumber=i}exitToHub(){}applyStatus(i,a){const o=this.state.enemies.findIndex(c=>c.id===i);o!==-1&&(this.state.enemies[o]=Ud(this.state.enemies[o],a,1))}}const Gg=({onLoadScenario:t})=>{const i=Object.values(fc),a=o=>{const c=new iT;o.setup(c),c.state.initiativeQueue=Ma(c.state),t(c.state,o.description)};return m.jsx("div",{className:"flex flex-col gap-4",children:i.map(o=>m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-white/50",children:typeof o.name=="function"?o.name(gs(1,"temp")):o.name}),m.jsx("div",{className:"flex flex-col gap-1",children:o.scenarios?.map(c=>m.jsx("button",{onClick:()=>a(c),className:"text-left px-3 py-2 bg-white/5 hover:bg-white/10 rounded text-xs text-white/80 transition-colors border border-transparent hover:border-white/20",children:c.title},c.id))})]},o.id))})},sT=({gameState:t,onSelectLoadout:i,onStartRun:a,onOpenArcade:o,onLoadScenario:c,onStartReplay:r})=>m.jsxs("div",{className:"w-full h-full flex flex-col bg-[#020617]",children:[m.jsx("header",{className:"border-b border-white/5 px-4 sm:px-6 lg:px-12 py-3 sm:py-4 bg-[#030712]/50 backdrop-blur-xl z-30",children:m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[m.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-indigo-500 rounded-lg flex items-center justify-center font-black text-lg sm:text-xl shadow-[0_0_20px_rgba(99,102,241,0.5)]",children:"H"}),m.jsxs("div",{children:[m.jsxs("h1",{className:"text-base sm:text-lg font-black uppercase tracking-tighter leading-none italic",children:["Hop ",m.jsx("span",{className:"text-indigo-500",children:"Engine"})]}),m.jsx("div",{className:"text-[9px] sm:text-[10px] font-bold text-white/30 tracking-[0.22em] sm:tracking-[0.3em] uppercase mt-1",children:"Strategic Hub v5.0"})]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 lg:gap-8",children:[m.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 sm:bg-transparent sm:border-0 sm:p-0",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/40 mb-1",children:"Current Loadout"}),m.jsx("div",{className:"text-sm font-bold text-indigo-400 truncate",children:t.selectedLoadoutId||"No Archetype Selected"})]}),t.selectedLoadoutId&&m.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:items-center sm:gap-3",children:[m.jsxs("button",{onClick:()=>a("normal"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center leading-tight",children:[m.jsx("span",{children:"Start Run"}),m.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"10 Floors | Boss Defeat"})]}),m.jsxs("button",{onClick:()=>a("daily"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(16,185,129,0.3)] flex flex-col items-center justify-center leading-tight",children:[m.jsx("span",{children:"Daily"}),m.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"Seeded Challenge"})]})]})]})]})}),m.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-y-auto lg:overflow-hidden",children:[m.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs("div",{className:"mb-6 sm:mb-10 lg:mb-12",children:[m.jsx("button",{onClick:o,className:"mb-4 sm:mb-5 w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 font-black uppercase tracking-widest text-xs sm:text-sm transition-all",children:"Arcade Mode"}),m.jsxs("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-black uppercase tracking-tighter mb-2 italic",children:["Select Your ",m.jsx("span",{className:"text-indigo-500",children:"Archetype"})]}),m.jsx("p",{className:"text-sm sm:text-base text-white/40 max-w-xl",children:"Choose your tactical specialty. Each archetype provides unique skills and modifies your core interaction with the engine."})]}),m.jsx(eT,{onSelect:i})]})}),m.jsxs("section",{className:"lg:hidden border-t border-white/5 bg-[#030712]/50 backdrop-blur-sm p-4 sm:p-6 space-y-4",children:[m.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[m.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[m.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Historical Replay"}),m.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),m.jsx("div",{className:"mt-3",children:m.jsx(Fg,{gameState:t,onStartReplay:r})})]}),m.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[m.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[m.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Training Simulations"}),m.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),m.jsx("div",{className:"mt-3",children:m.jsx(Gg,{onLoadScenario:c})})]})]}),m.jsx("aside",{className:"hidden lg:flex w-[450px] border-l border-white/5 bg-[#030712]/80 backdrop-blur-md flex-col z-20",children:m.jsxs("div",{className:"p-8 flex flex-col gap-12 h-full overflow-y-auto custom-scrollbar",children:[m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Historical Replay"}),m.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]}),m.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:m.jsx(Fg,{gameState:t,onStartReplay:r})})]}),m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Training Simulations"}),m.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]}),m.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:m.jsx(Gg,{onLoadScenario:c})})]}),m.jsx("div",{className:"mt-auto pt-8 border-t border-white/5 opacity-20 hover:opacity-100 transition-opacity",children:m.jsx("div",{className:"text-[10px] font-bold uppercase tracking-[0.4em] mb-2 text-center text-white/50",children:"Engine Status: Online"})})]})})]})]}),aT={VANGUARD:"V",HUNTER:"H",FIREMAGE:"F",NECROMANCER:"N",SKIRMISHER:"S"},Wg=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return i>>>0},oT=(t=new Date)=>t.toISOString().slice(0,10),lT=(t,i)=>{if(t.length<2)throw new Error("Arcade mode requires at least two loadouts.");const o=Wg(`arcade-a:${i}`)%t.length,c=t[o],r=t.filter(y=>y.id!==c.id),h=Wg(`arcade-b:${i}`)%r.length,b=r[h];return[c,b]},rT=({onBack:t,onLaunchArcade:i})=>{const a=Ii.useMemo(()=>Object.values(po),[]),o=Ii.useMemo(()=>oT(),[]),[c,r]=Ii.useMemo(()=>lT(a,o),[a,o]);return m.jsxs("div",{className:"w-full h-full flex flex-col bg-[#040a18]",children:[m.jsxs("header",{className:"h-20 border-b border-white/10 flex items-center justify-between px-12 bg-[#050b1f]/80 backdrop-blur-xl z-30",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-xl font-black uppercase tracking-tight italic",children:["Hop ",m.jsx("span",{className:"text-emerald-400",children:"Arcade"})]}),m.jsxs("div",{className:"text-[10px] uppercase tracking-[0.3em] text-white/40 mt-1",children:["Daily Draft ",o]})]}),m.jsx("button",{onClick:t,className:"px-5 py-2.5 rounded-xl border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-widest",children:"Back to Strategic Hub"})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12",children:m.jsxs("div",{className:"max-w-5xl mx-auto",children:[m.jsxs("div",{className:"mb-10",children:[m.jsx("h2",{className:"text-4xl font-black uppercase tracking-tight italic mb-3",children:"Arcade Mode"}),m.jsx("p",{className:"text-white/60 max-w-3xl",children:"Pick one of two daily archetypes and run the seeded challenge. Both options share the same seed for fair comparison."})]}),m.jsx("div",{className:"flex flex-col gap-6",children:[c,r].map((f,h)=>{const b=h===1,y=aT[f.id]||f.id.slice(0,1);return m.jsx("button",{onClick:()=>i(f.id),className:"w-full text-left group rounded-3xl border border-white/10 bg-gradient-to-r from-white/[0.06] to-white/[0.02] hover:from-emerald-500/20 hover:to-cyan-500/10 transition-all p-6",children:m.jsxs("div",{className:`flex items-center justify-between gap-6 ${b?"flex-row-reverse":""}`,children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-[200px]",children:[m.jsx("div",{className:`w-20 h-20 rounded-2xl border border-white/15 bg-[#0b1733] flex items-center justify-center text-4xl font-black text-emerald-300 shadow-[0_0_35px_rgba(16,185,129,0.25)] ${b?"-scale-x-100":""}`,children:y}),m.jsxs("div",{children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Daily Archetype"}),m.jsx("div",{className:"text-2xl font-black uppercase tracking-tight",children:f.name})]})]}),m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/40 mb-2",children:"Starting Skills"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:f.startingSkills.slice(0,6).map(A=>m.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full border border-white/20 bg-white/5 font-bold tracking-wide",children:A},A))})]}),m.jsxs("div",{className:"text-right min-w-[150px]",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Launch"}),m.jsx("div",{className:"text-sm font-black uppercase tracking-widest text-emerald-300 group-hover:text-emerald-200",children:"Start Arcade Run"})]})]})},f.id)})})]})})]})},cT=["catacombs","inferno","throne","frozen","void"],Xr=["off","repeat","cover"],Xg="hop_biome_sandbox_settings_v1",Tl="/Hop",Sa=64,va=192,Wn=64,Xn=512,uT=["normal","multiply","overlay","soft-light","screen","color-dodge"],Qg=["off","multiply","overlay","soft-light","screen","color-dodge","normal"],dT=["#8b6f4a","#8f4a2e","#5b6d41","#536e8e","#5f5977","#b79a73","#d15a3a","#3e4f3a"],fT=["native","additive","custom"],mT=[{q:1,r:0,s:-1},{q:0,r:1,s:-1},{q:-1,r:1,s:0},{q:-1,r:0,s:1},{q:0,r:-1,s:1},{q:1,r:-1,s:0}],Jg=(t,i)=>`${t.endsWith("/")?t:`${t}/`}${i.replace(/^\/+/,"")}`,pl=t=>{const i=t.trim();return!i||/^(?:[a-z]+:)?\/\//i.test(i)||i.startsWith("data:")?i:i.startsWith("/")?i.startsWith("/assets/")?Jg(Tl,i.slice(1)):i:Jg(Tl,i)},hl=t=>{const i=t.trim();if(!i||/^\/assets\/[a-z0-9/_\-.]+$/i.test(i))return i;const o=`${Tl.endsWith("/")?Tl:`${Tl}/`}assets/`;return i.startsWith(o)?`/assets/${i.slice(o.length)}`:i},Ai=(t,i="#8b6f4a")=>{const a=String(t||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[r,f,h]=a.slice(1).split("");return`#${r}${r}${f}${f}${h}${h}`.toLowerCase()}return i},pT=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i=Math.imul(i,16777619);return i>>>0},Zg=t=>pT(t)/4294967295,Ry=t=>t.has("BLOCKS_MOVEMENT")&&t.has("BLOCKS_LOS"),hT=t=>t.has("LAVA")||t.has("FIRE")||t.has("HAZARDOUS")&&t.has("LIQUID"),of=t=>mT.map(i=>de({q:t.q+i.q,r:t.r+i.r,s:t.s+i.s})),gT=t=>{const i=new Set;for(const[a,o]of t.entries())of(o.position).some(r=>!t.has(r))&&i.add(a);return i},yT=(t,i,a)=>{const o=new Set,c=[{point:i,depth:0}];for(;c.length>0;){const r=c.shift(),f=de(r.point);if(!o.has(f)&&t.has(f)&&(o.add(f),!(r.depth>=a)))for(const h of of(r.point)){const b=t.get(h);b&&c.push({point:b.position,depth:r.depth+1})}}return o},Bd=(t,i,a)=>{const o=t.get(i);if(!o)return;const c=new Set(Array.from(o.traits));a?(c.add("BLOCKS_MOVEMENT"),c.add("BLOCKS_LOS"),c.delete("LAVA"),c.delete("FIRE"),c.delete("LIQUID"),c.delete("HAZARDOUS")):(c.delete("BLOCKS_MOVEMENT"),c.delete("BLOCKS_LOS")),t.set(i,{...o,traits:c})},se=(t,i,a)=>Math.min(a,Math.max(i,t)),Qr=(t,i)=>t?i&&t.themes?.[i]?t.themes[i]:t.default||"":"",Jr=t=>t?t.mode==="cover"||t.mode==="repeat"||t.mode==="off"?t.mode:"repeat":"off",bT=(t,i)=>t?i&&t.themes?.[i]?t.themes[i]:t.default||"#8b6f4a":"#8b6f4a",xa=t=>t==="normal"||t==="multiply"||t==="overlay"||t==="soft-light"||t==="screen"||t==="color-dodge"?t:"multiply",ri=t=>t==="off"?"off":xa(t),jd=(t,i,a,o)=>{const c=t?.[a]??t?.[o];return c!==void 0?c:i?.[a]??i?.[o]},ST=t=>{switch(t){case"inferno":return 4;case"throne":return 6;case"frozen":return 8;case"void":return 10;default:return 1}},vT=t=>{const i=new Map;for(const[a,o]of t.tiles.entries())i.set(a,{...o,traits:new Set(o.traits),effects:Array.isArray(o.effects)?[...o.effects]:[]});return i},xT=(t,i)=>{const a=(r,f,h)=>{const y=de({q:r,r:f}),A=t.get(y);if(!A)return;const v=new Set(Array.from(A.traits));if(!Ry(v)){for(const x of h)v.add(x);t.set(y,{...A,traits:v})}},o=[[0,0],[1,0],[0,1],[-1,1],[-1,0],[0,-1],[1,-1],[2,-1],[2,0],[1,1],[-2,1],[-2,0],[-1,-1]];for(const[r,f]of o)a(i.q+r,i.r+f,["HAZARDOUS","LIQUID","LAVA"]);const c=[[3,-1],[3,0],[2,1],[-3,1],[-3,0],[-2,-1]];for(const[r,f]of c)a(i.q+r,i.r+f,["HAZARDOUS","FIRE"])},AT=(t,i,a,o)=>{const c=o.mode,r=gT(t),f=yT(t,a,2),h=Array.from(t.keys()).sort((_,p)=>_.localeCompare(p));if(c==="custom")for(const _ of h){if(f.has(_)){Bd(t,_,!1);continue}const p=o.keepPerimeter&&r.has(_);Bd(t,_,p)}if(c==="native")return;const b=se(Number(o.interiorDensity||0),0,.45),y=se(Number(o.clusterBias||0),0,1);if(b<=0&&y<=0)return;const A=h.filter(_=>{if(r.has(_)||f.has(_))return!1;const p=t.get(_);if(!p)return!1;const g=p.traits;return!hT(g)}),v=_=>{const p=t.get(_);return p?Ry(p.traits):!1},x=new Set;for(const _ of A){if(v(_))continue;Zg(`${i}|sandbox-wall-seed|${_}`)<b&&x.add(_)}for(let _=0;_<2;_++)for(const p of A){if(v(p)||x.has(p))continue;const g=t.get(p);if(!g)continue;const N=of(g.position).filter(w=>t.has(w));let I=0;for(const w of N)(v(w)||x.has(w))&&I++;if(I===0)continue;const M=y*(I/6);Zg(`${i}|sandbox-wall-grow|pass:${_}|${p}`)<M&&x.add(p)}for(const _ of x)Bd(t,_,!0)},TT=(t,i,a,o)=>{const c=ST(t),r=i.trim()||"biome-sandbox-seed",f=gs(c,r,r,void 0,po.VANGUARD),h=vT(f);return AT(h,r,f.player.position,o),a&&xT(h,f.player.position),{...f,floor:c,theme:t,rngSeed:r,initialSeed:r,turnNumber:1,tiles:h,visualEvents:[],timelineEvents:[],intentPreview:void 0}},ey=(t,i)=>{const a=i.toLowerCase(),o=af(t,a),c=o?.biomeLayers?.undercurrent??t.biomeLayers?.undercurrent,r=o?.biomeLayers?.crust??t.biomeLayers?.crust??(t.biomeUnderlay?{default:t.biomeUnderlay.default,themes:t.biomeUnderlay.themes,mode:t.biomeUnderlay.mode,scalePx:t.biomeUnderlay.scalePx,opacity:t.biomeUnderlay.opacity}:void 0),f=o?.biomeMaterials?.crust??t.biomeMaterials?.crust,h=f?.detailA,b=f?.detailB,y=f?.tint,A=o?.walls||t.walls,v=o?.walls?o.walls:t.walls?.themes?.[a],x=(t.assets||[]).filter(H=>{if(H.type!=="prop")return!1;const C=H.id.toLowerCase(),K=new Set((H.tags||[]).map(xe=>xe.toLowerCase()));if(!C.includes("mountain")&&!K.has("mountain"))return!1;if(!H.theme)return!0;const ne=H.theme.toLowerCase();return ne===a||ne==="core"}).sort((H,C)=>H.id.localeCompare(C.id)),p=String(v?.mountainPath??A?.mountainPath??"").trim()||x.find(H=>H.path.toLowerCase().includes("biome.volcano.mountain.03.webp"))?.path||x[0]?.path||"",g=x.find(H=>H.path===p)||x[0],N=g?.mountainSettings,I=g?.mountainSettingsByTheme?.[a],M=g?o?.assetOverrides?.[g.id]?.mountainSettings:void 0,E=(H,C,K)=>{const xe=jd(v,A,H,C)??M?.[H]??I?.[H]??N?.[H]??K,oe=Number(xe);return Number.isFinite(oe)?oe:K},w=(H,C,K)=>{const xe=jd(v,A,H,C)??M?.[H]??I?.[H]??N?.[H]??K;return ri(xe)},D=(H,C,K)=>{const xe=jd(v,A,H,C)??M?.[H]??I?.[H]??N?.[H]??K;return Ai(String(xe||""),K)};return{theme:i,seed:String(o?.seed||"biome-sandbox-seed"),injectHazards:o?.injectHazards!==void 0?!!o.injectHazards:!0,undercurrent:{path:Qr(c,a),mode:Jr(c),scalePx:se(Number(c?.scalePx??t.tileUnitPx??256),Sa,va),opacity:se(Number(c?.opacity??.6),0,1),scrollX:Number(c?.scroll?.x??120),scrollY:Number(c?.scroll?.y??90),scrollDurationMs:Math.max(1e3,Number(c?.scroll?.durationMs??92e3)),offsetX:Number(c?.offsetX??0),offsetY:Number(c?.offsetY??0)},crust:{path:Qr(r,a),mode:Jr(r),scalePx:Math.max(64,Number(r?.scalePx??t.tileUnitPx??256)),opacity:1,seedShiftPx:Math.max(0,Number(r?.seedShiftPx??96)),offsetX:Number(r?.offsetX??0),offsetY:Number(r?.offsetY??0)},clutter:{density:se(Number((o?.biomeLayers?.clutter??t.biomeLayers?.clutter)?.density??.14),0,1),maxPerHex:Math.max(0,Number((o?.biomeLayers?.clutter??t.biomeLayers?.clutter)?.maxPerHex??1)),bleedScaleMax:se(Number((o?.biomeLayers?.clutter??t.biomeLayers?.clutter)?.bleedScaleMax??2),1,2)},walls:{mode:A?.mode==="native"||A?.mode==="additive"||A?.mode==="custom"?A.mode:"custom",interiorDensity:se(Number(A?.interiorDensity??.05),0,.45),clusterBias:se(Number(A?.clusterBias??0),0,1),keepPerimeter:A?.keepPerimeter!==void 0?!!A.keepPerimeter:!0,mountainPath:p,mountainScale:se(E("scale","mountainScale",.53),.2,3),mountainOffsetX:E("offsetX","mountainOffsetX",0),mountainOffsetY:E("offsetY","mountainOffsetY",0),mountainAnchorX:se(E("anchorX","mountainAnchorX",.5),0,1),mountainAnchorY:se(E("anchorY","mountainAnchorY",.55),0,1),mountainCrustBlendMode:w("crustBlendMode","mountainCrustBlendMode","multiply"),mountainCrustBlendOpacity:se(E("crustBlendOpacity","mountainCrustBlendOpacity",1),0,1),mountainTintColor:D("tintColor","mountainTintColor","#7d7d7d"),mountainTintBlendMode:w("tintBlendMode","mountainTintBlendMode","overlay"),mountainTintOpacity:se(E("tintOpacity","mountainTintOpacity",1),0,1)},materials:{detailA:{path:Qr(h,a),mode:Jr(h),scalePx:se(Number(h?.scalePx??192),Wn,Xn),opacity:se(Number(h?.opacity??0),0,1)},detailB:{path:Qr(b,a),mode:Jr(b),scalePx:se(Number(b?.scalePx??256),Wn,Xn),opacity:se(Number(b?.opacity??0),0,1)},tintColor:bT(y,a),tintOpacity:se(Number(y?.opacity??0),0,1),tintBlend:xa(y?.blendMode)}}},ET=t=>{if(!t)return null;try{const i=JSON.parse(t);return!i||typeof i!="object"?null:i}catch{return null}},rt=(t,i)=>{const a=Number(t);return Number.isFinite(a)?a:i},_T=({assetManifest:t,onBack:i})=>{const a=O.useRef(!1),[o,c]=O.useState(""),[r,f]=O.useState(null);O.useEffect(()=>{if(!t||a.current)return;const p=ey(t,"inferno"),g=ET(localStorage.getItem(Xg));if(!g){f(p),a.current=!0;return}f({...p,...g,undercurrent:{...p.undercurrent,...g.undercurrent||{},scalePx:se(Number((g.undercurrent||{}).scalePx??p.undercurrent.scalePx),Sa,va)},crust:{...p.crust,...g.crust||{},opacity:1},clutter:{...p.clutter,...g.clutter||{}},walls:{...p.walls,...g.walls||{},mode:(g.walls||{}).mode==="native"||(g.walls||{}).mode==="additive"||(g.walls||{}).mode==="custom"?(g.walls||{}).mode:p.walls.mode,interiorDensity:se(Number((g.walls||{}).interiorDensity??p.walls.interiorDensity),0,.45),clusterBias:se(Number((g.walls||{}).clusterBias??p.walls.clusterBias),0,1),keepPerimeter:(g.walls||{}).keepPerimeter!==void 0?!!(g.walls||{}).keepPerimeter:p.walls.keepPerimeter,mountainPath:String((g.walls||{}).mountainPath||p.walls.mountainPath||""),mountainScale:se(Number((g.walls||{}).mountainScale??p.walls.mountainScale),.2,3),mountainOffsetX:rt(String((g.walls||{}).mountainOffsetX??p.walls.mountainOffsetX),p.walls.mountainOffsetX),mountainOffsetY:rt(String((g.walls||{}).mountainOffsetY??p.walls.mountainOffsetY),p.walls.mountainOffsetY),mountainAnchorX:se(Number((g.walls||{}).mountainAnchorX??p.walls.mountainAnchorX),0,1),mountainAnchorY:se(Number((g.walls||{}).mountainAnchorY??p.walls.mountainAnchorY),0,1),mountainCrustBlendMode:ri((g.walls||{}).mountainCrustBlendMode??p.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:se(Number((g.walls||{}).mountainCrustBlendOpacity??p.walls.mountainCrustBlendOpacity),0,1),mountainTintColor:Ai(String((g.walls||{}).mountainTintColor??p.walls.mountainTintColor),p.walls.mountainTintColor),mountainTintBlendMode:ri((g.walls||{}).mountainTintBlendMode??p.walls.mountainTintBlendMode),mountainTintOpacity:se(Number((g.walls||{}).mountainTintOpacity??p.walls.mountainTintOpacity),0,1)},materials:{...p.materials,...g.materials||{},detailA:{...p.materials.detailA,...(g.materials||{}).detailA||{},scalePx:se(Number(((g.materials||{}).detailA||{}).scalePx??p.materials.detailA.scalePx),Wn,Xn),opacity:se(Number(((g.materials||{}).detailA||{}).opacity??p.materials.detailA.opacity),0,1)},detailB:{...p.materials.detailB,...(g.materials||{}).detailB||{},scalePx:se(Number(((g.materials||{}).detailB||{}).scalePx??p.materials.detailB.scalePx),Wn,Xn),opacity:se(Number(((g.materials||{}).detailB||{}).opacity??p.materials.detailB.opacity),0,1)},tintOpacity:se(Number((g.materials||{}).tintOpacity??p.materials.tintOpacity),0,1),tintBlend:xa((g.materials||{}).tintBlend)}}),a.current=!0},[t]),O.useEffect(()=>{r&&localStorage.setItem(Xg,JSON.stringify(r))},[r]);const h=r?.theme?.toLowerCase()||"inferno",b=O.useMemo(()=>Ai(r?.materials.tintColor||"#8b6f4a"),[r?.materials.tintColor]),y=O.useMemo(()=>Ai(r?.walls.mountainTintColor||"#8b6f4a"),[r?.walls.mountainTintColor]),A=O.useMemo(()=>{const p=new Set,g=new Set,N=new Set,I=new Set;if(!t)return{undercurrent:[],crust:[],detail:[],mountain:[]};const M=E=>{if(E){E.default&&(p.add(E.default),g.add(E.default),N.add(E.default));for(const w of Object.values(E.themes||{}))p.add(w),g.add(w),N.add(w)}};M(t.biomeLayers?.undercurrent),M(t.biomeLayers?.crust);for(const E of Object.values(t.biomePresets||{}))M(E?.biomeLayers?.undercurrent),M(E?.biomeLayers?.crust),E?.biomeMaterials?.crust?.detailA&&M(E.biomeMaterials.crust.detailA),E?.biomeMaterials?.crust?.detailB&&M(E.biomeMaterials.crust.detailB);if(t.biomeUnderlay){t.biomeUnderlay.default&&g.add(t.biomeUnderlay.default);for(const E of Object.values(t.biomeUnderlay.themes||{}))g.add(E)}t.biomeMaterials?.crust?.detailA&&M(t.biomeMaterials.crust.detailA),t.biomeMaterials?.crust?.detailB&&M(t.biomeMaterials.crust.detailB);for(const E of t.assets||[]){const w=new Set((E.tags||[]).map(H=>H.toLowerCase())),D=E.type==="prop"&&(E.id.toLowerCase().includes("mountain")||w.has("mountain"));(w.has("floor")||w.has("stone")||w.has("void")||w.has("frozen")||w.has("inferno"))&&(g.add(E.path),N.add(E.path)),(w.has("lava")||w.has("hazard")||w.has("fire")||w.has("quicksand"))&&p.add(E.path),(E.type==="decal"||E.type==="prop"||E.type==="tile")&&N.add(E.path),D&&I.add(E.path)}t.walls?.mountainPath&&I.add(t.walls.mountainPath);for(const E of Object.values(t.walls?.themes||{}))E?.mountainPath&&I.add(E.mountainPath);for(const E of Object.values(t.biomePresets||{})){E?.walls?.mountainPath&&I.add(E.walls.mountainPath);for(const w of Object.values(E?.walls?.themes||{}))w?.mountainPath&&I.add(w.mountainPath)}return{undercurrent:Array.from(p).sort((E,w)=>E.localeCompare(w)),crust:Array.from(g).sort((E,w)=>E.localeCompare(w)),detail:Array.from(N).sort((E,w)=>E.localeCompare(w)),mountain:Array.from(I).sort((E,w)=>E.localeCompare(w))}},[t]),v=O.useMemo(()=>{if(!t||!r)return null;const p=pl(r.undercurrent.path),g=pl(r.crust.path),N=pl(r.materials.detailA.path),I=pl(r.materials.detailB.path),M=af(t,h),E=M?.biomeLayers?.undercurrent??t.biomeLayers?.undercurrent,w=M?.biomeLayers?.crust??t.biomeLayers?.crust??(t.biomeUnderlay?{default:t.biomeUnderlay.default,themes:t.biomeUnderlay.themes,mode:t.biomeUnderlay.mode,scalePx:t.biomeUnderlay.scalePx,opacity:t.biomeUnderlay.opacity}:void 0),D=M?.biomeMaterials?.crust??t.biomeMaterials?.crust,H=E||p?{...E||{default:p||g||""},default:p||E?.default||"",themes:{...E?.themes||{},[h]:p||E?.default||""},mode:r.undercurrent.mode,scalePx:se(r.undercurrent.scalePx,Sa,va),opacity:se(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}}:void 0,C=w||g?{...w||{default:g||p||""},default:g||w?.default||"",themes:{...w?.themes||{},[h]:g||w?.default||""},mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:Math.max(0,r.crust.seedShiftPx),offsetX:r.crust.offsetX,offsetY:r.crust.offsetY}:void 0,K=N||D?.detailA?.default||"",ne={...D?.detailA?.themes||{}};K&&(ne[h]=K);const xe=K?{...D?.detailA||{default:K},default:K,themes:ne,mode:r.materials.detailA.mode,scalePx:se(r.materials.detailA.scalePx,Wn,Xn),opacity:se(r.materials.detailA.opacity,0,1)}:void 0,oe=I||D?.detailB?.default||"",ke={...D?.detailB?.themes||{}};oe&&(ke[h]=oe);const ie=oe?{...D?.detailB||{default:oe},default:oe,themes:ke,mode:r.materials.detailB.mode,scalePx:se(r.materials.detailB.scalePx,Wn,Xn),opacity:se(r.materials.detailB.opacity,0,1)}:void 0,Te=String(r.materials.tintColor||"").trim()||D?.tint?.default||"#8b6f4a",pe={...D?.tint?.themes||{}};pe[h]=Te;const $={...D?.tint||{default:Te},default:Te,themes:pe,opacity:se(r.materials.tintOpacity,0,1),blendMode:xa(r.materials.tintBlend)},Z=xe||ie||$?{...D||{},detailA:xe,detailB:ie,tint:$}:void 0,ae=pl(r.walls.mountainPath),Me=M?.walls,Se={...Me||t.walls?.themes?.[h]||{},mountainPath:ae,scale:se(r.walls.mountainScale,.2,3),offsetX:r.walls.mountainOffsetX,offsetY:r.walls.mountainOffsetY,anchorX:se(r.walls.mountainAnchorX,0,1),anchorY:se(r.walls.mountainAnchorY,0,1),crustBlendMode:ri(r.walls.mountainCrustBlendMode),crustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),tintColor:Ai(r.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:ri(r.walls.mountainTintBlendMode),tintOpacity:se(r.walls.mountainTintOpacity,0,1),mountainScale:se(r.walls.mountainScale,.2,3),mountainOffsetX:r.walls.mountainOffsetX,mountainOffsetY:r.walls.mountainOffsetY,mountainAnchorX:se(r.walls.mountainAnchorX,0,1),mountainAnchorY:se(r.walls.mountainAnchorY,0,1),mountainCrustBlendMode:ri(r.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Ai(r.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:ri(r.walls.mountainTintBlendMode),mountainTintOpacity:se(r.walls.mountainTintOpacity,0,1)},R={...t.walls||{},...Me||{},mode:r.walls.mode,interiorDensity:se(r.walls.interiorDensity,0,.45),clusterBias:se(r.walls.clusterBias,0,1),keepPerimeter:!!r.walls.keepPerimeter,mountainPath:ae,scale:Se.scale,offsetX:Se.offsetX,offsetY:Se.offsetY,anchorX:Se.anchorX,anchorY:Se.anchorY,crustBlendMode:Se.crustBlendMode,crustBlendOpacity:Se.crustBlendOpacity,tintColor:Se.tintColor,tintBlendMode:Se.tintBlendMode,tintOpacity:Se.tintOpacity,mountainScale:Se.mountainScale,mountainOffsetX:Se.mountainOffsetX,mountainOffsetY:Se.mountainOffsetY,mountainAnchorX:Se.mountainAnchorX,mountainAnchorY:Se.mountainAnchorY,mountainCrustBlendMode:Se.mountainCrustBlendMode,mountainCrustBlendOpacity:Se.mountainCrustBlendOpacity,mountainTintColor:Se.mountainTintColor,mountainTintBlendMode:Se.mountainTintBlendMode,mountainTintOpacity:Se.mountainTintOpacity,themes:{...t.walls?.themes||{},[h]:Se}},V={...M?.biomeLayers||{},undercurrent:H,crust:C,clutter:{...M?.biomeLayers?.clutter||t.biomeLayers?.clutter||{},density:se(r.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(r.clutter.maxPerHex)),bleedScaleMax:se(r.clutter.bleedScaleMax,1,2)}},ee={...M?.biomeMaterials||{},crust:Z},ue={...M||{},seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:V,biomeMaterials:ee,walls:R};return{...t,biomeLayers:{...t.biomeLayers||{},undercurrent:H,crust:C,clutter:{...t.biomeLayers?.clutter||{},density:se(r.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(r.clutter.maxPerHex)),bleedScaleMax:se(r.clutter.bleedScaleMax,1,2)}},biomeMaterials:{...t.biomeMaterials||{},crust:Z},walls:R,biomePresets:{...t.biomePresets||{},[h]:ue}}},[t,r,h]),x=O.useMemo(()=>r?TT(r.theme,r.seed,r.injectHazards,r.walls):null,[r]),_=async()=>{if(!r)return;const p=hl(r.undercurrent.path),g=hl(r.crust.path),N=hl(r.materials.detailA.path),I=hl(r.materials.detailB.path),E={mountainPath:hl(r.walls.mountainPath),mountainScale:se(r.walls.mountainScale,.2,3),mountainOffsetX:r.walls.mountainOffsetX,mountainOffsetY:r.walls.mountainOffsetY,mountainAnchorX:se(r.walls.mountainAnchorX,0,1),mountainAnchorY:se(r.walls.mountainAnchorY,0,1),mountainCrustBlendMode:ri(r.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Ai(r.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:ri(r.walls.mountainTintBlendMode),mountainTintOpacity:se(r.walls.mountainTintOpacity,0,1),scale:se(r.walls.mountainScale,.2,3),offsetX:r.walls.mountainOffsetX,offsetY:r.walls.mountainOffsetY,anchorX:se(r.walls.mountainAnchorX,0,1),anchorY:se(r.walls.mountainAnchorY,0,1),crustBlendMode:ri(r.walls.mountainCrustBlendMode),crustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),tintColor:Ai(r.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:ri(r.walls.mountainTintBlendMode),tintOpacity:se(r.walls.mountainTintOpacity,0,1)},w={seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:{undercurrent:{default:p,mode:r.undercurrent.mode,scalePx:se(r.undercurrent.scalePx,Sa,va),opacity:se(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}},crust:{default:g,mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:r.crust.seedShiftPx,offsetX:r.crust.offsetX,offsetY:r.crust.offsetY},clutter:{density:r.clutter.density,maxPerHex:r.clutter.maxPerHex,bleedScaleMax:r.clutter.bleedScaleMax}},walls:{mode:r.walls.mode,interiorDensity:r.walls.interiorDensity,clusterBias:r.walls.clusterBias,keepPerimeter:r.walls.keepPerimeter,...E},biomeMaterials:{crust:{detailA:{default:N,mode:r.materials.detailA.mode,scalePx:se(r.materials.detailA.scalePx,Wn,Xn),opacity:se(r.materials.detailA.opacity,0,1)},detailB:{default:I,mode:r.materials.detailB.mode,scalePx:se(r.materials.detailB.scalePx,Wn,Xn),opacity:se(r.materials.detailB.opacity,0,1)},tint:{default:Ai(r.materials.tintColor,"#8b6f4a"),opacity:se(r.materials.tintOpacity,0,1),blendMode:xa(r.materials.tintBlend)}}}},D={theme:r.theme,seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:{undercurrent:{default:p,mode:r.undercurrent.mode,scalePx:se(r.undercurrent.scalePx,Sa,va),opacity:se(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}},crust:{default:g,mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:r.crust.seedShiftPx,offsetX:r.crust.offsetX,offsetY:r.crust.offsetY},clutter:{density:r.clutter.density,maxPerHex:r.clutter.maxPerHex,bleedScaleMax:r.clutter.bleedScaleMax}},walls:{mode:r.walls.mode,interiorDensity:r.walls.interiorDensity,clusterBias:r.walls.clusterBias,keepPerimeter:r.walls.keepPerimeter,...E,themes:{[h]:E}},biomeMaterials:{crust:{detailA:{default:N,mode:r.materials.detailA.mode,scalePx:se(r.materials.detailA.scalePx,Wn,Xn),opacity:se(r.materials.detailA.opacity,0,1)},detailB:{default:I,mode:r.materials.detailB.mode,scalePx:se(r.materials.detailB.scalePx,Wn,Xn),opacity:se(r.materials.detailB.opacity,0,1)},tint:{default:Ai(r.materials.tintColor,"#8b6f4a"),opacity:se(r.materials.tintOpacity,0,1),blendMode:xa(r.materials.tintBlend)}}},biomePresets:{[h]:w}};try{await navigator.clipboard.writeText(JSON.stringify(D,null,2)),c("Copied"),window.setTimeout(()=>c(""),1600)}catch{c("Copy failed"),window.setTimeout(()=>c(""),1600)}};return!t||!r||!v||!x?m.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex items-center justify-center",children:[m.jsx("button",{type:"button",onClick:i,className:"absolute top-5 left-5 px-4 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-[0.2em]",children:"Back"}),m.jsx("div",{className:"text-sm text-white/70 uppercase tracking-[0.25em] font-black",children:"Loading Biome Sandbox..."})]}):m.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex",children:[m.jsxs("aside",{className:"w-[420px] border-r border-white/10 bg-[#02040a] overflow-y-auto",children:[m.jsxs("div",{className:"sticky top-0 z-20 border-b border-white/10 bg-[#02040a]/95 backdrop-blur p-4",children:[m.jsxs("div",{className:"flex items-center justify-between gap-3",children:[m.jsx("button",{type:"button",onClick:i,className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-[11px] font-black uppercase tracking-[0.18em]",children:"Back"}),m.jsx("button",{type:"button",onClick:()=>f(ey(t,r.theme)),className:"px-3 py-2 rounded-lg border border-amber-300/40 bg-amber-500/10 hover:bg-amber-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Reset"}),m.jsx("button",{type:"button",onClick:_,className:"px-3 py-2 rounded-lg border border-cyan-300/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Copy JSON"})]}),m.jsxs("div",{className:"mt-3 text-[10px] uppercase tracking-[0.22em] text-white/50",children:["Hop / Biomes ",o?`* ${o}`:""]})]}),m.jsxs("div",{className:"p-4 space-y-6",children:[m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/75",children:"Preview"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Theme"}),m.jsx("select",{value:r.theme,onChange:p=>f(g=>g&&{...g,theme:p.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:cT.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed"}),m.jsx("input",{value:r.seed,onChange:p=>f(g=>g&&{...g,seed:p.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[m.jsx("input",{type:"checkbox",checked:r.injectHazards,onChange:p=>f(g=>g&&{...g,injectHazards:p.target.checked})}),"Inject synthetic lava/fire patches for mask testing"]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-cyan-200",children:"Undercurrent"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),m.jsx("input",{list:"sandbox-undercurrent-paths",value:r.undercurrent.path,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,path:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-undercurrent-paths",children:A.undercurrent.map(p=>m.jsx("option",{value:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),m.jsx("select",{value:r.undercurrent.mode,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Xr.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),m.jsx("input",{type:"number",min:Sa,max:va,step:16,value:r.undercurrent.scalePx,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scalePx:se(rt(p.target.value,g.undercurrent.scalePx),Sa,va)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.undercurrent.opacity,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,opacity:se(rt(p.target.value,g.undercurrent.opacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll X"}),m.jsx("input",{type:"number",step:5,value:r.undercurrent.scrollX,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollX:rt(p.target.value,g.undercurrent.scrollX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll Y"}),m.jsx("input",{type:"number",step:5,value:r.undercurrent.scrollY,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollY:rt(p.target.value,g.undercurrent.scrollY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Duration"}),m.jsx("input",{type:"number",min:1e3,step:500,value:r.undercurrent.scrollDurationMs,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollDurationMs:Math.max(1e3,rt(p.target.value,g.undercurrent.scrollDurationMs))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:4,value:r.undercurrent.offsetX,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,offsetX:rt(p.target.value,g.undercurrent.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:4,value:r.undercurrent.offsetY,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,offsetY:rt(p.target.value,g.undercurrent.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-amber-200",children:"Crust"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),m.jsx("input",{list:"sandbox-crust-paths",value:r.crust.path,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,path:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-crust-paths",children:A.crust.map(p=>m.jsx("option",{value:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),m.jsx("select",{value:r.crust.mode,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Xr.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),m.jsx("input",{type:"number",min:64,step:16,value:r.crust.scalePx,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,scalePx:Math.max(64,rt(p.target.value,g.crust.scalePx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),m.jsx("input",{type:"number",min:1,max:1,step:.01,value:1,onChange:()=>f(p=>p&&{...p,crust:{...p.crust,opacity:1}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed Shift Budget"}),m.jsx("input",{type:"number",min:0,step:8,value:r.crust.seedShiftPx,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,seedShiftPx:Math.max(0,rt(p.target.value,g.crust.seedShiftPx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:4,value:r.crust.offsetX,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,offsetX:rt(p.target.value,g.crust.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:4,value:r.crust.offsetY,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,offsetY:rt(p.target.value,g.crust.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-rose-200",children:"Walls / Mountains"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mountain Asset"}),m.jsx("input",{list:"sandbox-mountain-paths",value:r.walls.mountainPath,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainPath:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs",placeholder:"/assets/biomes/biome.volcano.mountain.01.webp"}),m.jsx("datalist",{id:"sandbox-mountain-paths",children:A.mountain.map(p=>m.jsx("option",{value:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale"}),m.jsx("input",{type:"number",min:.2,max:3,step:.01,value:r.walls.mountainScale,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainScale:se(rt(p.target.value,g.walls.mountainScale),.2,3)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor X"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainAnchorX,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainAnchorX:se(rt(p.target.value,g.walls.mountainAnchorX),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:2,value:r.walls.mountainOffsetX,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainOffsetX:rt(p.target.value,g.walls.mountainOffsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:2,value:r.walls.mountainOffsetY,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainOffsetY:rt(p.target.value,g.walls.mountainOffsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor Y"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainAnchorY,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainAnchorY:se(rt(p.target.value,g.walls.mountainAnchorY),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Crust Blend"}),m.jsx("select",{value:r.walls.mountainCrustBlendMode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainCrustBlendMode:ri(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Qg.map(p=>m.jsx("option",{value:p,children:p},`mountain-blend-${p}`))})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Blend Opacity ",r.walls.mountainCrustBlendOpacity.toFixed(2)]}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainCrustBlendOpacity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainCrustBlendOpacity:se(rt(p.target.value,g.walls.mountainCrustBlendOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Mountain Tint"}),m.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[m.jsx("input",{type:"color",value:y,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintColor:p.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Mountain Tint Color Picker"}),m.jsx("input",{value:r.walls.mountainTintColor,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintColor:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Tint Blend"}),m.jsx("select",{value:r.walls.mountainTintBlendMode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintBlendMode:ri(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Qg.map(p=>m.jsx("option",{value:p,children:p},`mountain-tint-blend-${p}`))})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",r.walls.mountainTintOpacity.toFixed(2)]}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainTintOpacity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintOpacity:se(rt(p.target.value,g.walls.mountainTintOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Wall Layout Mode"}),m.jsx("select",{value:r.walls.mode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:fT.map(p=>m.jsx("option",{value:p,children:p},`wall-mode-${p}`))}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Interior Density ",r.walls.interiorDensity.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:.45,step:.01,value:r.walls.interiorDensity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,interiorDensity:se(rt(p.target.value,g.walls.interiorDensity),0,.45)}}),className:"w-full"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Cluster Bias ",r.walls.clusterBias.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:1,step:.01,value:r.walls.clusterBias,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,clusterBias:se(rt(p.target.value,g.walls.clusterBias),0,1)}}),className:"w-full"})]}),m.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[m.jsx("input",{type:"checkbox",checked:r.walls.keepPerimeter,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,keepPerimeter:p.target.checked}})}),"Keep perimeter walls (custom mode)"]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-fuchsia-200",children:"Crust Materials"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Detail A"}),m.jsx("input",{list:"sandbox-detail-paths",value:r.materials.detailA.path,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,path:p.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-detail-paths",children:A.detail.map(p=>m.jsx("option",{value:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsx("select",{value:r.materials.detailA.mode,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,mode:p.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Xr.map(p=>m.jsx("option",{value:p,children:p},`detail-a-${p}`))}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.materials.detailA.opacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,opacity:se(rt(p.target.value,g.materials.detailA.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsx("input",{type:"number",min:Wn,max:Xn,step:16,value:r.materials.detailA.scalePx,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,scalePx:se(rt(p.target.value,g.materials.detailA.scalePx),Wn,Xn)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Detail B"}),m.jsx("input",{list:"sandbox-detail-paths",value:r.materials.detailB.path,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,path:p.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsx("select",{value:r.materials.detailB.mode,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,mode:p.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Xr.map(p=>m.jsx("option",{value:p,children:p},`detail-b-${p}`))}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.materials.detailB.opacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,opacity:se(rt(p.target.value,g.materials.detailB.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsx("input",{type:"number",min:Wn,max:Xn,step:16,value:r.materials.detailB.scalePx,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,scalePx:se(rt(p.target.value,g.materials.detailB.scalePx),Wn,Xn)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Tint"}),m.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[m.jsx("input",{type:"color",value:b,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Tint Color Picker"}),m.jsx("input",{value:r.materials.tintColor,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),m.jsx("div",{className:"grid grid-cols-8 gap-2",children:dT.map(p=>m.jsx("button",{type:"button",onClick:()=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p}}),className:`h-6 rounded border ${Ai(r.materials.tintColor)===Ai(p)?"border-white":"border-white/20"}`,style:{backgroundColor:p},title:p},`tint-swatch-${p}`))}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",r.materials.tintOpacity.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:1,step:.01,value:r.materials.tintOpacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintOpacity:se(rt(p.target.value,g.materials.tintOpacity),0,1)}}),className:"w-full"})]}),m.jsx("select",{value:r.materials.tintBlend,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintBlend:xa(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:uT.map(p=>m.jsx("option",{value:p,children:p},`blend-${p}`))})]}),m.jsxs("section",{className:"space-y-3 pb-8",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-emerald-200",children:"Clutter"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Density"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.clutter.density,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,density:se(rt(p.target.value,g.clutter.density),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Max / Hex"}),m.jsx("input",{type:"number",min:0,max:5,step:1,value:r.clutter.maxPerHex,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,maxPerHex:Math.max(0,Math.floor(rt(p.target.value,g.clutter.maxPerHex)))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Bleed Max"}),m.jsx("input",{type:"number",min:1,max:2,step:.01,value:r.clutter.bleedScaleMax,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,bleedScaleMax:se(rt(p.target.value,g.clutter.bleedScaleMax),1,2)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]})]})]}),m.jsxs("main",{className:"flex-1 relative bg-[#050914] overflow-hidden",children:[m.jsxs("div",{className:"absolute top-4 right-5 z-20 px-3 py-2 rounded-lg border border-white/15 bg-black/35 text-[10px] font-black uppercase tracking-[0.2em]",children:["Theme: ",r.theme]}),m.jsx("div",{className:"w-full h-full p-6",children:m.jsx("div",{className:"w-full h-full rounded-[28px] border border-white/10 bg-[#030712]/70 overflow-hidden",children:m.jsx(Ny,{gameState:x,onMove:()=>{},selectedSkillId:null,showMovementRange:!1,assetManifest:v})})})]})]})},wT=t=>{const{gameStatus:i,isReplayMode:a,isBusy:o,postCommitInputLock:c,isPlayerTurn:r,hasPendingStatus:f,pendingFrameCount:h}=t,b=f||h>0;let y="IDLE";return a?y="REPLAY":i!=="playing"?y="IDLE":b?y=o?"INTERCEPT_ANIMATING":"INTERCEPT_READY":o?y="PLAYBACK":c&&r?y="POST_COMMIT_LOCK":c&&!r?y="POST_COMMIT_QUEUE":r?y="INPUT_OPEN":y="QUEUE_ADVANCE",{phase:y,canPlayerInput:y==="INPUT_OPEN",shouldAdvanceQueue:y==="QUEUE_ADVANCE"||y==="POST_COMMIT_QUEUE",shouldResolvePending:y==="INTERCEPT_READY",queueAdvanceDelayMs:380}},MT=t=>{const i=t.payload;if(!(!i||typeof i!="object")){if("q"in i&&"r"in i)return{q:Number(i.q??0),r:Number(i.r??0),s:Number(i.s??0)};if(t.type==="USE_SKILL"){const a=i;return{skillId:a.skillId??"unknown",target:a.target?{q:a.target.q,r:a.target.r,s:a.target.s}:null}}if(t.type==="START_RUN")return{loadoutId:i.loadoutId??"unknown",mode:i.mode??"normal"};if(t.type==="LOAD_STATE"){const a=i;return{floor:a?.floor??0,gameStatus:a?.gameStatus??"unknown",turnNumber:a?.turnNumber??0,queueLength:Array.isArray(a?.initiativeQueue)?a.initiativeQueue.length:0}}return{}}};function OT(){const t=(X,re)=>{const me=new Set(X.map(mn=>mn.type)),we=me.has("ADVANCE_TURN"),be=me.has("RESOLVE_PENDING"),De=X.length,ut=re>=5&&De<Math.max(25,re*4);return{actionCount:De,hasTurnAdvance:we,hasPendingResolve:be,suspiciouslyShort:ut}},i=X=>{const re=X||[],me=re.length>0?re[re.length-1]:void 0;return`${re.length}:${me?.type??"none"}`},a=X=>{const re=X||[],me=re.length>0?re[re.length-1]:void 0;return`${re.length}:${me?.id??"none"}:${me?.phase??"none"}`},[o,c]=O.useState(()=>window.location.pathname);O.useEffect(()=>{const X=()=>c(window.location.pathname);return window.addEventListener("popstate",X),()=>window.removeEventListener("popstate",X)},[]);const r=X=>{window.location.pathname!==X&&window.history.pushState({},"",X),c(X)},f=o.toLowerCase().startsWith("/hop")?"/Hop":"",h=`${f||""}`||"/",b=`${f}/Arcade`||"/Arcade",y=`${f}/Biomes`||"/Biomes",v=o.toLowerCase().replace(/\/+$/,""),x=v.endsWith("/arcade")||v.endsWith("/arcarde"),_=v.endsWith("/biomes"),[p,g]=O.useReducer(i1,null,()=>{const X=localStorage.getItem("hop_save");if(X)try{const re=JSON.parse(X);if(re.tiles){const be=Array.isArray(re.tiles)?re.tiles:Object.entries(re.tiles);re.tiles=new Map(be.map(([De,ut])=>[De,{...ut,traits:new Set(ut.traits)}]))}Array.isArray(re.occupancyMask)&&(re.occupancyMask=re.occupancyMask.map(be=>typeof be=="string"?BigInt(be):be));const me=be=>be instanceof Map?be:Array.isArray(be)?new Map(be):be&&typeof be=="object"?new Map(Object.entries(be)):new Map,we=be=>{const De={...be,components:me(be?.components)},ut=bl(De),xn=(ut.components??new Map).get("trinity");if(!xn)return ut;const Pt=uc({body:Number(xn.body||0),mind:Number(xn.mind||0),instinct:Number(xn.instinct||0)});return{...ut,maxHp:Pt,hp:Math.min(Pt,Math.max(0,Number(ut.hp??Pt)))}};return re.player=Vd(we(re.player)),re.enemies=Array.isArray(re.enemies)?re.enemies.map(we):[],re}catch(re){console.error("Failed to hydrate Map state:",re)}return Fd()}),N=typeof window<"u"&&!!window.__HOP_DEBUG_QUERY,[I,M]=O.useState(null);O.useEffect(()=>{let X=!0;return Y1().then(re=>{X&&(M(re),window.__HOP_ASSET_MANIFEST=re)}),()=>{X=!1}},[]),O.useEffect(()=>{N&&(window.state=p,window.QUERY={tile:(X,re)=>{const we=de({q:X,r:re});return console.log(`Checking Map for Key: "${we}"`),p.tiles.get(we)},whereAmI:()=>{const X=p.player.position,re=de(X),me=p.tiles.get(re);return{coords:X,key:re,tileExists:!!me,tileData:me}},dumpKeys:()=>Array.from(p.tiles.keys())})},[p,N]);const E=O.useRef(null),w=O.useRef(""),D=p.gameStatus==="playing"||p.gameStatus==="choosing_upgrade",H=`${p.gameStatus}|${p.floor}|${p.turnNumber}|${p.player.hp}|${de(p.player.position)}|${p.enemies.length}|${p.actionLog?.length??0}|${p.message?.length??0}`;O.useEffect(()=>{if(E.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(E.current):window.clearTimeout(E.current),E.current=null),!D){w.current="",localStorage.removeItem("hop_save");return}if(H===w.current)return;const X=()=>{const re={...p,tiles:Array.from(p.tiles.entries()).map(([we,be])=>[we,{...be,traits:Array.from(be.traits)}])},me=we=>JSON.stringify(we,(be,De)=>typeof De=="bigint"?De.toString():De);localStorage.setItem("hop_save",me(re)),w.current=H,E.current=null};return typeof window.requestIdleCallback=="function"?E.current=window.requestIdleCallback(X,{timeout:500}):E.current=window.setTimeout(X,120),()=>{E.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(E.current):window.clearTimeout(E.current),E.current=null)}},[p,D,H]);const[C,K]=O.useState(!1),[ne,xe]=O.useState([]),[oe,ke]=O.useState(!1),[ie,Te]=O.useState(null),pe=O.useRef(0),$=O.useRef(null);O.useEffect(()=>{if(!(typeof window<"u"&&!!window.__HOP_DEBUG_PERF))return;let re=0,me=performance.now(),we=0,be=0,De=me;const ut=mn=>{const xn=mn-me;if(me=mn,we++,be+=xn,mn-De>=2e3){const Pt=be/Math.max(1,we),Ct=1e3/Math.max(1,Pt);console.log("[HOP_PERF]",{fps:Number(Ct.toFixed(1)),avgFrameMs:Number(Pt.toFixed(2)),frames:we}),De=mn,we=0,be=0}re=requestAnimationFrame(ut)};return re=requestAnimationFrame(ut),()=>cancelAnimationFrame(re)},[p.gameStatus,C]);const[Z,ae]=O.useState(null),[Me,Se]=O.useState(!1),[R,V]=O.useState(!1),[ee,ue]=O.useState(!1),[Ce,Ne]=O.useState(0),Re=O.useRef(null),mt=O.useRef(null),qe=O.useRef(null),It=O.useRef(null),ze=p.pendingFrames?.length??0,Ue=O.useMemo(()=>wT({gameStatus:p.gameStatus,isReplayMode:C,isBusy:R,postCommitInputLock:ee,isPlayerTurn:gl(p),hasPendingStatus:!!p.pendingStatus,pendingFrameCount:ze}),[p.gameStatus,C,R,ee,p.pendingStatus,ze,p.initiativeQueue,p.player.id,p.enemies]),xt=!Ue.canPlayerInput,Bt=O.useRef([]),ct=O.useRef(0),Vt=O.useRef(""),rn=p.initiativeQueue?.entries?.[Math.max(0,p.initiativeQueue.currentIndex??0)]?.actorId??p.initiativeQueue?.entries?.[0]?.actorId??"none",$e=O.useCallback((X,re)=>{const me={id:++ct.current,t:Date.now(),event:X,turnNumber:p.turnNumber,phase:Ue.phase,gameStatus:p.gameStatus,playerTurn:gl(p),isBusy:R,postCommitInputLock:ee,pendingStatus:p.pendingStatus?.status??"none",pendingFrames:p.pendingFrames?.length??0,canPlayerInput:Ue.canPlayerInput,shouldAdvanceQueue:Ue.shouldAdvanceQueue,shouldResolvePending:Ue.shouldResolvePending,actionLogLength:p.actionLog?.length??0,queueHead:rn,details:re};Bt.current.push(me),Bt.current.length>800&&Bt.current.splice(0,Bt.current.length-800)},[p.turnNumber,p.gameStatus,p.pendingStatus,p.pendingFrames,p.actionLog,p.initiativeQueue,p.player.id,p.enemies,Ue.phase,Ue.canPlayerInput,Ue.shouldAdvanceQueue,Ue.shouldResolvePending,R,ee,rn]),it=O.useCallback((X,re)=>{$e("DISPATCH",{source:re,actionType:X.type,payload:MT(X)}),g(X)},[$e]);O.useEffect(()=>{const X=[Ue.phase,p.turnNumber,p.gameStatus,p.pendingStatus?.status??"none",p.pendingFrames?.length??0,R?1:0,ee?1:0,rn].join("|");X!==Vt.current&&($e("TURN_STATE"),Vt.current=X)},[Ue.phase,p.turnNumber,p.gameStatus,p.pendingStatus,p.pendingFrames,R,ee,rn,$e]),O.useEffect(()=>(window.__HOP_TURN_TRACE=Bt.current,window.__HOP_DUMP_TURN_TRACE=()=>[...Bt.current],window.__HOP_PRINT_TURN_TRACE=(X=80)=>{const re=Bt.current.slice(-Math.max(1,Math.floor(X)));return console.table(re.map(me=>({id:me.id,event:me.event,turn:me.turnNumber,phase:me.phase,status:me.gameStatus,playerTurn:me.playerTurn,busy:me.isBusy,lock:me.postCommitInputLock,pending:`${me.pendingStatus}/${me.pendingFrames}`,queueHead:me.queueHead,actionLog:me.actionLogLength,details:me.details?JSON.stringify(me.details):""}))),re},window.__HOP_CLEAR_TURN_TRACE=()=>{Bt.current.length=0,ct.current=0},Bt.current.push({id:++ct.current,t:Date.now(),event:"TRACE_READY",turnNumber:0,phase:"INIT",gameStatus:"init",playerTurn:!1,isBusy:!1,postCommitInputLock:!1,pendingStatus:"none",pendingFrames:0,canPlayerInput:!1,shouldAdvanceQueue:!1,shouldResolvePending:!1,actionLogLength:0,queueHead:"none"}),()=>{delete window.__HOP_DUMP_TURN_TRACE,delete window.__HOP_PRINT_TURN_TRACE,delete window.__HOP_CLEAR_TURN_TRACE}),[]);const bn=O.useRef([]),Ei=O.useRef(null),Qn=O.useRef(""),Dn=O.useCallback(X=>{!X||X.length===0||(bn.current=[...bn.current,...X].slice(-600),window.__HOP_SIM_EVENTS=bn.current,window.dispatchEvent(new CustomEvent("hop:simulation-events",{detail:{turn:p.turnNumber,events:X}})),$e("SIM_EVENTS",{count:X.length,lastType:X[X.length-1]?.type??"unknown"}))},[$e,p.turnNumber]),Fe=O.useCallback(X=>{Ei.current=X,window.__HOP_UI_MIRROR=X},[]);O.useEffect(()=>(window.__HOP_SIM_EVENTS=bn.current,window.__HOP_DUMP_SIM_EVENTS=()=>[...bn.current],window.__HOP_CLEAR_SIM_EVENTS=()=>{bn.current=[],window.__HOP_SIM_EVENTS=[]},window.__HOP_DUMP_MIRROR=()=>window.__HOP_MIRROR_LAST,()=>{delete window.__HOP_DUMP_SIM_EVENTS,delete window.__HOP_CLEAR_SIM_EVENTS,delete window.__HOP_DUMP_MIRROR}),[]),O.useEffect(()=>{const X=u1(p);window.__HOP_ENGINE_MIRROR=X;const re=Ei.current;if(!re||re.turn!==X.turn||re.stackTick!==X.stackTick)return;const me=d1(X,re),we=`${X.turn}:${X.stackTick}:${me.ok?"ok":me.mismatches.length}`;we!==Qn.current&&(Qn.current=we,window.__HOP_MIRROR_LAST={engineSnapshot:X,uiSnapshot:re,result:me},me.ok||($e("MIRROR_MISMATCH",{count:me.mismatches.length}),console.warn("[HOP_MIRROR] snapshot mismatch detected",me.mismatches)))},[p,$e]),O.useEffect(()=>{if(!Ue.shouldAdvanceQueue)return;$e("QUEUE_SCHEDULE",{delayMs:Ue.queueAdvanceDelayMs});const X=window.setTimeout(()=>{it({type:"ADVANCE_TURN"},"queue_pump")},Ue.queueAdvanceDelayMs);return()=>window.clearTimeout(X)},[Ue.shouldAdvanceQueue,Ue.queueAdvanceDelayMs,p.turnNumber,p.initiativeQueue,p.player.id,p.enemies,it,$e]);const pt=(X="unknown")=>{ee&&$e("LOCK_RELEASE",{reason:X,lockTurn:Re.current,expectedActionLogLength:mt.current}),ue(!1),Re.current=null,mt.current=null,qe.current=null,Yt.current=!1,Tt.current="",Ve.current="",It.current!==null&&(window.clearTimeout(It.current),It.current=null)},Dt=O.useRef(""),Sn=i(p.visualEvents),cn=O.useRef(""),vn=a(p.timelineEvents),Yt=O.useRef(!1),Tt=O.useRef(""),Ve=O.useRef(""),Kt=220,Je=900,et=O.useRef(!1),Et=O.useRef(0),un=`${p.pendingStatus?.status??"none"}:${ze}`;O.useEffect(()=>{R||(Dt.current=Sn,cn.current=vn)},[R,Sn,vn]),O.useEffect(()=>{et.current=!1,Et.current=performance.now()},[un]),O.useEffect(()=>{(p.pendingStatus||ze>0)&&R&&(et.current=!0)},[p.pendingStatus,ze,R]),O.useEffect(()=>{ee&&R&&(Yt.current=!0)},[ee,R]),O.useEffect(()=>{if(!ee)return;const X=window.setTimeout(()=>{Ne(re=>re+1)},120);return()=>window.clearTimeout(X)},[ee,Ce]),O.useEffect(()=>{const X=!R&&Sn===Dt.current&&vn===cn.current,re=(p.timelineEvents||[]).some(Ct=>Ct.blocking),me=(p.timelineEvents||[]).filter(Ct=>Ct.blocking).reduce((Ct,kn)=>Ct+(kn.suggestedDurationMs||0),0),we=(p.visualEvents||[]).reduce((Ct,kn)=>{if(kn.type!=="kinetic_trace")return Ct;const Un=kn.payload;if(!Un)return Ct;const Ln=Math.max(0,Number(Un.startDelayMs||0)),wi=Math.max(0,Number(Un.durationMs||0));return Math.max(Ct,Ln+wi)},0),be=Math.max(me,we),De=be>0?Math.max(160,Math.min(3200,be+40)):0,ut=Math.max(0,performance.now()-Et.current),mn=!re||et.current,xn=!re||ut>=De,Pt=X&&(mn||xn);if(Ue.shouldResolvePending){if(Pt){$e("PENDING_RESOLVE_READY",{noPendingAnimations:X,hasBlockingTimeline:re,movementTraceBudgetMs:we,elapsedPendingMs:ut,requiredFallbackDelayMs:De}),it({type:"RESOLVE_PENDING"},"pending_ready");return}if(!R&&re&&!et.current){$e("PENDING_RESOLVE_WAIT",{movementTraceBudgetMs:we,elapsedPendingMs:ut,requiredFallbackDelayMs:De});const Ct=Math.max(0,De-ut),kn=window.setTimeout(()=>{it({type:"RESOLVE_PENDING"},"pending_fallback_delay")},Ct);return()=>window.clearTimeout(kn)}}},[Ue.shouldResolvePending,p.timelineEvents,p.visualEvents,R,Sn,vn,it,$e]),O.useEffect(()=>{if(!ee)return;if(C||p.gameStatus!=="playing"){pt("mode_or_status_change");return}if(p.pendingStatus||(p.pendingFrames?.length??0)>0){pt("pending_intercept");return}const X=Re.current,re=mt.current,me=qe.current!==null?Math.max(0,performance.now()-qe.current):Number.POSITIVE_INFINITY,we=X!==null?p.turnNumber>X:!1,be=re!==null?(p.actionLog?.length??0)>=re:!1,De=me>=Kt,ut=Sn!==Tt.current||vn!==Ve.current,mn=!we&&!be,xn=!Yt.current&&ut&&me<Je,Pt=p.gameStatus==="playing"&&!C&&!R&&!p.pendingStatus&&(p.pendingFrames?.length??0)===0&&gl(p);if(xn){$e("LOCK_WAIT_FOR_BUSY",{lockAgeMs:me,visualsChangedSinceArm:ut});return}if(Pt&&mn&&me>450){pt("no_progress_timeout");return}Pt&&De&&(we||be||me>1500)&&pt(we?"turn_advanced":be?"action_committed":"age_fallback")},[ee,C,p.gameStatus,p.turnNumber,p.pendingStatus,p.pendingFrames,p.initiativeQueue,p.actionLog,R,p.player.id,p.enemies,$e,Sn,vn,Ce]),O.useEffect(()=>{p.gameStatus!=="playing"&&ee&&pt("not_playing")},[p.gameStatus,ee,$e]),O.useEffect(()=>{if(ee)return It.current!==null&&window.clearTimeout(It.current),It.current=window.setTimeout(()=>{ee&&(console.error("[HOP_INPUT_LOCK] Watchdog released stuck post-commit lock",{turnNumber:p.turnNumber,pendingStatus:p.pendingStatus?.status,pendingFrames:p.pendingFrames?.length??0,playerTurn:gl(p),isBusy:R,actionLogLength:p.actionLog?.length??0,traceTail:Bt.current.slice(-40)}),$e("LOCK_WATCHDOG_RELEASE"),pt("watchdog"))},8e3),()=>{It.current!==null&&(window.clearTimeout(It.current),It.current=null)}},[ee,p.turnNumber,p.pendingStatus,p.actionLog,R,p.initiativeQueue,p.player.id,p.enemies,$e]),O.useEffect(()=>{if(!ee)return;const X=window.setTimeout(()=>{$e("LOCK_STALL_SNAPSHOT",{lockAgeMs:qe.current!==null?Math.max(0,performance.now()-qe.current):null})},2500);return()=>window.clearTimeout(X)},[ee,$e]);const[Hn,Jn]=O.useState(null),[On,dn]=O.useState(null),ht=O.useRef(p.floor);O.useEffect(()=>{if(p.gameStatus==="playing"&&p.floor!==ht.current){dn({floor:p.floor,theme:p.theme||"Inferno"}),ht.current=p.floor;const X=setTimeout(()=>dn(null),3e3);return()=>clearTimeout(X)}},[p.floor,p.gameStatus,p.theme]),O.useEffect(()=>{if(p.gameStatus==="playing"&&p.floor===1&&!ht.current){dn({floor:1,theme:p.theme||"Inferno"}),ht.current=1;const X=setTimeout(()=>dn(null),3e3);return()=>clearTimeout(X)}},[p.gameStatus]);const Ht=()=>{It.current!==null&&(window.clearTimeout(It.current),It.current=null),Re.current=p.turnNumber,mt.current=(p.actionLog?.length??0)+1,qe.current=performance.now(),Yt.current=!1,Tt.current=Sn,Ve.current=vn,ue(!0),$e("LOCK_ARM",{lockTurn:p.turnNumber,expectedActionLogLength:(p.actionLog?.length??0)+1,eventHashAtArm:Sn,timelineHashAtArm:vn})},Ft=X=>{xt||ae(X)},Rn=X=>{if(!xt){if(Z){Ht(),it({type:"USE_SKILL",payload:{skillId:Z,target:X}},"player_use_skill"),ae(null);return}if(Q(X,p.player.position)){Se(!Me);return}Ht(),it({type:"MOVE",payload:X},"player_move"),Se(!1)}},Hi=X=>{C||R||it({type:"SELECT_UPGRADE",payload:X},"upgrade_select")},Zn=()=>{it({type:"RESET"},"reset"),ae(null),K(!1),Te(null)},fn=()=>{xt||(Ht(),it({type:"WAIT"},"player_wait"),ae(null))},Gt=X=>{if(!X)return;const re=Ag(X.actions||[]);if(!re.valid){const De=`Replay rejected: ${re.errors.slice(0,3).join(" | ")}`;Te(De),console.error("[HOP_REPLAY] Invalid replay actions",{replayId:X.id,errors:re.errors});return}Te(null),K(!0),xe(re.actions),ke(!1),pe.current=0;const me=X.seed||X.id||String(Date.now()),we=X.loadoutId?po[X.loadoutId]:void 0,be=gs(1,me,me,void 0,we);it({type:"LOAD_STATE",payload:be},"replay_start")},Pn=()=>{const X=pe.current;if(X>=ne.length){ke(!1);return}it(ne[X],"replay_step"),pe.current=X+1};O.useEffect(()=>{if(!oe||!C)return;const X=window.setInterval(Pn,500);return()=>window.clearInterval(X)},[oe,C,ne]);const Pi=()=>{K(!1),Te(null),di()},Gi=(X,re)=>{it({type:"LOAD_STATE",payload:X},"scenario_load"),Jn(re),ae(null)},di=()=>{it({type:"EXIT_TO_HUB"},"exit_to_hub"),ae(null),K(!1),Te(null),r(h)};O.useEffect(()=>{if(!C){if((p.gameStatus==="won"||p.gameStatus==="lost")&&$.current!==p.initialSeed){$.current=p.initialSeed||"default";const X=p.initialSeed??p.rngSeed??"0",re=p.completedRun?.score||(p.player.hp||0)+(p.floor||0)*100,me=Ag(p.actionLog||[]);if(!me.valid){console.error("[HOP_REPLAY] Refusing to persist replay with invalid action log",{errors:me.errors});return}const we=t(me.actions,p.floor||0),be={id:`run-${Date.now()}`,seed:X,loadoutId:p.player.archetype,actions:me.actions,score:re,floor:p.floor,date:new Date().toISOString(),replayVersion:2,diagnostics:we},De=localStorage.getItem("hop_replays_v1"),ut=De?JSON.parse(De):[],mn=[be,...ut].slice(0,100);localStorage.setItem("hop_replays_v1",JSON.stringify(mn));const xn=localStorage.getItem("hop_leaderboard_v1");let Pt=xn?JSON.parse(xn):[];Pt.push({id:be.id,name:"Player",score:be.score,floor:be.floor,date:be.date,seed:be.seed,loadoutId:be.loadoutId,actions:be.actions,replayVersion:be.replayVersion,diagnostics:be.diagnostics}),Pt.sort((Ct,kn)=>kn.score-Ct.score),Pt=Pt.slice(0,5),localStorage.setItem("hop_leaderboard_v1",JSON.stringify(Pt))}p.gameStatus==="hub"&&($.current=null)}},[p.gameStatus,C,p.initialSeed]);const _i=X=>{const re=p.selectedLoadoutId;if(!re){console.warn("Start Run called without a selected loadout.");return}it({type:"START_RUN",payload:{loadoutId:re,mode:X}},"hub_start_run")},bs=X=>{it({type:"START_RUN",payload:{loadoutId:X,mode:"daily"}},"arcade_start_run"),r(h)};return _?m.jsx(_T,{assetManifest:I,onBack:()=>r(h)}):p.gameStatus==="hub"?m.jsxs("div",{className:"w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[!x&&m.jsx("button",{type:"button",onClick:()=>r(y),className:"absolute top-4 right-4 z-40 px-4 py-2 rounded-xl border border-cyan-300/35 bg-cyan-500/10 hover:bg-cyan-500/20 text-[10px] font-black uppercase tracking-[0.2em]",children:"Biome Sandbox"}),x?m.jsx(rT,{onBack:()=>r(h),onLaunchArcade:bs}):m.jsx(sT,{gameState:p,onSelectLoadout:X=>{it({type:"APPLY_LOADOUT",payload:X},"hub_select_loadout")},onStartRun:_i,onOpenArcade:()=>r(b),onLoadScenario:Gi,onStartReplay:Gt}),ie&&m.jsx("div",{className:"absolute top-4 right-4 z-40 max-w-xl px-4 py-3 rounded-xl border border-red-400/40 bg-red-900/70 text-red-100 text-xs font-bold tracking-wide",children:ie}),Hn&&m.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[m.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),m.jsx("p",{className:"text-white text-sm",children:Hn}),m.jsx("button",{onClick:()=>Jn(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]})]}):m.jsxs("div",{className:"flex flex-col lg:flex-row w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[m.jsx("div",{className:"lg:hidden shrink-0 border-b border-white/5 bg-[#030712]/95 backdrop-blur-sm z-20",children:m.jsxs("div",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"min-w-0",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"Level"}),m.jsxs("div",{className:"text-lg font-black text-white leading-none",children:[p.floor,m.jsx("span",{className:"text-white/25 text-sm ml-1",children:"/ 10"})]})]}),m.jsxs("div",{className:"ml-auto min-w-0 text-right",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"HP"}),m.jsxs("div",{className:"text-lg font-black text-red-400 leading-none",children:[p.player.hp,m.jsxs("span",{className:"text-white/25 text-sm ml-1",children:["/ ",p.player.maxHp]})]})]})]})}),m.jsx("aside",{className:"hidden lg:flex w-80 border-r border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:m.jsx(J1,{gameState:p,onReset:Zn,onWait:fn,onExitToHub:di,inputLocked:xt})}),m.jsx("main",{className:"flex-1 min-h-0 relative flex items-center justify-center bg-[#020617] overflow-hidden",children:m.jsx("div",{className:"w-full h-full p-0 sm:p-3 lg:p-8 flex items-center justify-center",children:m.jsxs("div",{className:`w-full h-full relative border border-white/5 bg-[#030712]/50 rounded-none sm:rounded-3xl lg:rounded-[40px] shadow-[inset_0_0_100px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden ${p.isShaking?"animate-shake":""}`,children:[m.jsx(Ny,{gameState:p,onMove:Rn,selectedSkillId:Z,showMovementRange:Me,onBusyStateChange:V,assetManifest:I,onSimulationEvents:Dn,onMirrorSnapshot:Fe}),xt&&p.gameStatus==="playing"&&m.jsx("div",{className:"absolute inset-0 z-40 pointer-events-auto",children:m.jsx("div",{className:"absolute top-3 sm:top-4 lg:top-6 left-1/2 -translate-x-1/2 px-3 py-2 rounded-lg bg-black/55 border border-white/15 text-[10px] font-bold uppercase tracking-[0.2em] text-white/70",children:"Resolving Turn..."})})]})})}),m.jsx("aside",{className:"lg:hidden shrink-0 h-[26svh] min-h-[160px] max-h-[250px] border-t border-white/5 bg-[#030712] z-20 overflow-y-auto",children:m.jsxs("div",{className:"p-3 flex flex-col gap-3 h-full",children:[m.jsxs("div",{className:"flex items-center justify-between gap-2",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Skills"}),m.jsxs("div",{className:"flex items-center gap-1.5",children:[m.jsx("button",{disabled:xt,onClick:fn,className:`px-2.5 py-1.5 rounded-lg border text-[10px] font-black uppercase tracking-widest ${xt?"bg-white/[0.03] border-white/5 text-white/30 opacity-50":"bg-white/5 border-white/10 text-white/70 active:bg-white/10"}`,children:"Wait"}),m.jsx("button",{onClick:di,className:"px-2.5 py-1.5 rounded-lg border border-white/10 bg-white/5 text-[10px] font-black uppercase tracking-widest text-white/70 active:bg-white/10",children:"Hub"}),m.jsx("button",{onClick:Zn,className:"px-2.5 py-1.5 rounded-lg border border-red-500/20 bg-red-500/10 text-[10px] font-black uppercase tracking-widest text-red-300/90 active:bg-red-500/20",children:"Reset"})]})]}),m.jsx($g,{skills:p.player.activeSkills||[],selectedSkillId:Z,onSelectSkill:Ft,hasSpear:p.hasSpear,gameState:p,inputLocked:xt,compact:!0})]})}),m.jsx("aside",{className:"hidden lg:flex w-80 border-l border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:m.jsxs("div",{className:"p-6 flex flex-col gap-8 h-full",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30 mb-6",children:"Tactical Skills"}),m.jsx($g,{skills:p.player.activeSkills||[],selectedSkillId:Z,onSelectSkill:Ft,hasSpear:p.hasSpear,gameState:p,inputLocked:xt})]}),m.jsx("div",{className:"pt-8 border-t border-white/5 text-center",children:m.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/20",children:"Hop Engine v5.0"})})]})}),Hn&&m.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[m.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),m.jsx("p",{className:"text-white text-sm",children:Hn}),m.jsx("button",{onClick:()=>Jn(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]}),p.gameStatus==="choosing_upgrade"&&m.jsx(Z1,{onSelect:Hi,gameState:p}),p.gameStatus==="lost"&&m.jsxs("div",{className:"fixed inset-0 bg-red-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[m.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),m.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Identity Deleted"}),m.jsx("p",{className:"text-red-200/60 mb-12 text-xl font-medium tracking-widest uppercase",children:"Simulation Terminated"}),m.jsx("button",{onClick:Zn,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Reinitialize Simulation"})]}),p.gameStatus==="won"&&m.jsxs("div",{className:"fixed inset-0 bg-indigo-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[m.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),m.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Arcade Mode Cleared"}),m.jsx("p",{className:"text-indigo-200/60 mb-2 text-xl font-medium tracking-widest uppercase",children:"The Sentinel has fallen"}),m.jsxs("p",{className:"text-white/20 mb-12 text-sm font-bold uppercase tracking-[0.3em]",children:["Score: ",p.completedRun?.score||0]}),m.jsx("button",{onClick:di,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Return to Command Center"})]}),On&&m.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[150] pointer-events-none animate-in fade-in duration-700",children:m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{className:"text-indigo-500 font-black text-2xl uppercase tracking-[0.5em] mb-4 animate-in slide-in-from-bottom-8 duration-1000",children:["Floor ",On.floor]}),m.jsx("h2",{className:"text-8xl font-black text-white uppercase tracking-tighter italic animate-in slide-in-from-top-12 duration-1000",children:On.theme}),m.jsx("div",{className:"h-1 w-64 bg-white/20 mx-auto mt-8 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-indigo-500 animate-[progress_3s_linear]"})})]})}),C&&m.jsxs("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 bg-[#030712]/90 border border-indigo-500/30 p-6 rounded-3xl backdrop-blur-2xl shadow-[0_0_50px_rgba(79,70,229,0.2)] z-[250] flex items-center gap-8 animate-in slide-in-from-bottom-8 duration-500",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 mb-1",children:"Replay System"}),m.jsxs("span",{className:"text-white font-bold text-sm",children:["Step ",pe.current," / ",ne.length]})]}),m.jsx("div",{className:"h-8 w-px bg-white/10"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>ke(!oe),className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${oe?"bg-indigo-500 text-white shadow-[0_0_20px_rgba(79,70,229,0.5)]":"bg-white/5 text-white/50 hover:bg-white/10"}`,children:oe?"":""}),m.jsx("button",{onClick:Pn,disabled:oe,className:"w-12 h-12 bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:hover:bg-white/5 text-white rounded-xl flex items-center justify-center transition-all",children:""})]}),m.jsx("div",{className:"h-8 w-px bg-white/10"}),m.jsx("button",{onClick:Pi,className:"px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl font-bold uppercase text-xs tracking-widest transition-all",children:"Close"})]})]})}Vb.createRoot(document.getElementById("root")).render(m.jsx(O.StrictMode,{children:m.jsx(OT,{})}));
