(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function a(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(c){if(c.ep)return;c.ep=!0;const r=a(c);fetch(c.href,r)}})();function Pb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fd={exports:{}},Dl={};var cg;function Ub(){if(cg)return Dl;cg=1;var e=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function a(o,c,r){var f=null;if(r!==void 0&&(f=""+r),c.key!==void 0&&(f=""+c.key),"key"in c){r={};for(var h in c)h!=="key"&&(r[h]=c[h])}else r=c;return c=r.ref,{$$typeof:e,type:o,key:f,ref:c!==void 0?c:null,props:r}}return Dl.Fragment=i,Dl.jsx=a,Dl.jsxs=a,Dl}var ug;function qb(){return ug||(ug=1,Fd.exports=Ub()),Fd.exports}var m=qb(),Kd={exports:{}},Be={};var dg;function zb(){if(dg)return Be;dg=1;var e=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),f=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),S=Symbol.iterator;function _(k){return k===null||typeof k!="object"?null:(k=S&&k[S]||k["@@iterator"],typeof k=="function"?k:null)}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,R={};function I(k,$,J){this.props=k,this.context=$,this.refs=R,this.updater=J||p}I.prototype.isReactComponent={},I.prototype.setState=function(k,$){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,$,"setState")},I.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function C(){}C.prototype=I.prototype;function M(k,$,J){this.props=k,this.context=$,this.refs=R,this.updater=J||p}var N=M.prototype=new C;N.constructor=M,g(N,I.prototype),N.isPureReactComponent=!0;var Y=Array.isArray;function X(){}var O={H:null,A:null,T:null,S:null},q=Object.prototype.hasOwnProperty;function K(k,$,J){var me=J.ref;return{$$typeof:e,type:k,key:$,ref:me!==void 0?me:null,props:J}}function ue(k,$){return K(k.type,$,k.props)}function G(k){return typeof k=="object"&&k!==null&&k.$$typeof===e}function _e(k){var $={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(J){return $[J]})}var oe=/\/+/g;function be(k,$){return typeof k=="object"&&k!==null&&k.key!=null?_e(""+k.key):$.toString(36)}function pe(k){switch(k.status){case"fulfilled":return k.value;case"rejected":throw k.reason;default:switch(typeof k.status=="string"?k.then(X,X):(k.status="pending",k.then(function($){k.status==="pending"&&(k.status="fulfilled",k.value=$)},function($){k.status==="pending"&&(k.status="rejected",k.reason=$)})),k.status){case"fulfilled":return k.value;case"rejected":throw k.reason}}throw k}function H(k,$,J,me,Me){var Re=typeof k;(Re==="undefined"||Re==="boolean")&&(k=null);var ke=!1;if(k===null)ke=!0;else switch(Re){case"bigint":case"string":case"number":ke=!0;break;case"object":switch(k.$$typeof){case e:case i:ke=!0;break;case A:return ke=k._init,H(ke(k._payload),$,J,me,Me)}}if(ke)return Me=Me(k),ke=me===""?"."+be(k,0):me,Y(Me)?(J="",ke!=null&&(J=ke.replace(oe,"$&/")+"/"),H(Me,$,J,"",function(kt){return kt})):Me!=null&&(G(Me)&&(Me=ue(Me,J+(Me.key==null||k&&k.key===Me.key?"":(""+Me.key).replace(oe,"$&/")+"/")+ke)),$.push(Me)),1;ke=0;var ht=me===""?".":me+":";if(Y(k))for(var $e=0;$e<k.length;$e++)me=k[$e],Re=ht+be(me,$e),ke+=H(me,$,J,Re,Me);else if($e=_(k),typeof $e=="function")for(k=$e.call(k),$e=0;!(me=k.next()).done;)me=me.value,Re=ht+be(me,$e++),ke+=H(me,$,J,Re,Me);else if(Re==="object"){if(typeof k.then=="function")return H(pe(k),$,J,me,Me);throw $=String(k),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return ke}function ee(k,$,J){if(k==null)return k;var me=[],Me=0;return H(k,me,"","",function(Re){return $.call(J,Re,Me++)}),me}function ae(k){if(k._status===-1){var $=k._result;$=$(),$.then(function(J){(k._status===0||k._status===-1)&&(k._status=1,k._result=J)},function(J){(k._status===0||k._status===-1)&&(k._status=2,k._result=J)}),k._status===-1&&(k._status=0,k._result=$)}if(k._status===1)return k._result.default;throw k._result}var Te=typeof reportError=="function"?reportError:function(k){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof k=="object"&&k!==null&&typeof k.message=="string"?String(k.message):String(k),error:k});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",k);return}console.error(k)},xe={map:ee,forEach:function(k,$,J){ee(k,function(){$.apply(this,arguments)},J)},count:function(k){var $=0;return ee(k,function(){$++}),$},toArray:function(k){return ee(k,function($){return $})||[]},only:function(k){if(!G(k))throw Error("React.Children.only expected to receive a single React element child.");return k}};return Be.Activity=v,Be.Children=xe,Be.Component=I,Be.Fragment=a,Be.Profiler=c,Be.PureComponent=M,Be.StrictMode=o,Be.Suspense=b,Be.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,Be.__COMPILER_RUNTIME={__proto__:null,c:function(k){return O.H.useMemoCache(k)}},Be.cache=function(k){return function(){return k.apply(null,arguments)}},Be.cacheSignal=function(){return null},Be.cloneElement=function(k,$,J){if(k==null)throw Error("The argument must be a React element, but you passed "+k+".");var me=g({},k.props),Me=k.key;if($!=null)for(Re in $.key!==void 0&&(Me=""+$.key),$)!q.call($,Re)||Re==="key"||Re==="__self"||Re==="__source"||Re==="ref"&&$.ref===void 0||(me[Re]=$[Re]);var Re=arguments.length-2;if(Re===1)me.children=J;else if(1<Re){for(var ke=Array(Re),ht=0;ht<Re;ht++)ke[ht]=arguments[ht+2];me.children=ke}return K(k.type,Me,me)},Be.createContext=function(k){return k={$$typeof:f,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null},k.Provider=k,k.Consumer={$$typeof:r,_context:k},k},Be.createElement=function(k,$,J){var me,Me={},Re=null;if($!=null)for(me in $.key!==void 0&&(Re=""+$.key),$)q.call($,me)&&me!=="key"&&me!=="__self"&&me!=="__source"&&(Me[me]=$[me]);var ke=arguments.length-2;if(ke===1)Me.children=J;else if(1<ke){for(var ht=Array(ke),$e=0;$e<ke;$e++)ht[$e]=arguments[$e+2];Me.children=ht}if(k&&k.defaultProps)for(me in ke=k.defaultProps,ke)Me[me]===void 0&&(Me[me]=ke[me]);return K(k,Re,Me)},Be.createRef=function(){return{current:null}},Be.forwardRef=function(k){return{$$typeof:h,render:k}},Be.isValidElement=G,Be.lazy=function(k){return{$$typeof:A,_payload:{_status:-1,_result:k},_init:ae}},Be.memo=function(k,$){return{$$typeof:y,type:k,compare:$===void 0?null:$}},Be.startTransition=function(k){var $=O.T,J={};O.T=J;try{var me=k(),Me=O.S;Me!==null&&Me(J,me),typeof me=="object"&&me!==null&&typeof me.then=="function"&&me.then(X,Te)}catch(Re){Te(Re)}finally{$!==null&&J.types!==null&&($.types=J.types),O.T=$}},Be.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},Be.use=function(k){return O.H.use(k)},Be.useActionState=function(k,$,J){return O.H.useActionState(k,$,J)},Be.useCallback=function(k,$){return O.H.useCallback(k,$)},Be.useContext=function(k){return O.H.useContext(k)},Be.useDebugValue=function(){},Be.useDeferredValue=function(k,$){return O.H.useDeferredValue(k,$)},Be.useEffect=function(k,$){return O.H.useEffect(k,$)},Be.useEffectEvent=function(k){return O.H.useEffectEvent(k)},Be.useId=function(){return O.H.useId()},Be.useImperativeHandle=function(k,$,J){return O.H.useImperativeHandle(k,$,J)},Be.useInsertionEffect=function(k,$){return O.H.useInsertionEffect(k,$)},Be.useLayoutEffect=function(k,$){return O.H.useLayoutEffect(k,$)},Be.useMemo=function(k,$){return O.H.useMemo(k,$)},Be.useOptimistic=function(k,$){return O.H.useOptimistic(k,$)},Be.useReducer=function(k,$,J){return O.H.useReducer(k,$,J)},Be.useRef=function(k){return O.H.useRef(k)},Be.useState=function(k){return O.H.useState(k)},Be.useSyncExternalStore=function(k,$,J){return O.H.useSyncExternalStore(k,$,J)},Be.useTransition=function(){return O.H.useTransition()},Be.version="19.2.3",Be}var fg;function Rf(){return fg||(fg=1,Kd.exports=zb()),Kd.exports}var w=Rf();const Ui=Pb(w);var Gd={exports:{}},Hl={},Wd={exports:{}},Xd={};var mg;function $b(){return mg||(mg=1,(function(e){function i(H,ee){var ae=H.length;H.push(ee);e:for(;0<ae;){var Te=ae-1>>>1,xe=H[Te];if(0<c(xe,ee))H[Te]=ee,H[ae]=xe,ae=Te;else break e}}function a(H){return H.length===0?null:H[0]}function o(H){if(H.length===0)return null;var ee=H[0],ae=H.pop();if(ae!==ee){H[0]=ae;e:for(var Te=0,xe=H.length,k=xe>>>1;Te<k;){var $=2*(Te+1)-1,J=H[$],me=$+1,Me=H[me];if(0>c(J,ae))me<xe&&0>c(Me,J)?(H[Te]=Me,H[me]=ae,Te=me):(H[Te]=J,H[$]=ae,Te=$);else if(me<xe&&0>c(Me,ae))H[Te]=Me,H[me]=ae,Te=me;else break e}}return ee}function c(H,ee){var ae=H.sortIndex-ee.sortIndex;return ae!==0?ae:H.id-ee.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;e.unstable_now=function(){return r.now()}}else{var f=Date,h=f.now();e.unstable_now=function(){return f.now()-h}}var b=[],y=[],A=1,v=null,S=3,_=!1,p=!1,g=!1,R=!1,I=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function N(H){for(var ee=a(y);ee!==null;){if(ee.callback===null)o(y);else if(ee.startTime<=H)o(y),ee.sortIndex=ee.expirationTime,i(b,ee);else break;ee=a(y)}}function Y(H){if(g=!1,N(H),!p)if(a(b)!==null)p=!0,X||(X=!0,_e());else{var ee=a(y);ee!==null&&pe(Y,ee.startTime-H)}}var X=!1,O=-1,q=5,K=-1;function ue(){return R?!0:!(e.unstable_now()-K<q)}function G(){if(R=!1,X){var H=e.unstable_now();K=H;var ee=!0;try{e:{p=!1,g&&(g=!1,C(O),O=-1),_=!0;var ae=S;try{t:{for(N(H),v=a(b);v!==null&&!(v.expirationTime>H&&ue());){var Te=v.callback;if(typeof Te=="function"){v.callback=null,S=v.priorityLevel;var xe=Te(v.expirationTime<=H);if(H=e.unstable_now(),typeof xe=="function"){v.callback=xe,N(H),ee=!0;break t}v===a(b)&&o(b),N(H)}else o(b);v=a(b)}if(v!==null)ee=!0;else{var k=a(y);k!==null&&pe(Y,k.startTime-H),ee=!1}}break e}finally{v=null,S=ae,_=!1}ee=void 0}}finally{ee?_e():X=!1}}}var _e;if(typeof M=="function")_e=function(){M(G)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,be=oe.port2;oe.port1.onmessage=G,_e=function(){be.postMessage(null)}}else _e=function(){I(G,0)};function pe(H,ee){O=I(function(){H(e.unstable_now())},ee)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):q=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_next=function(H){switch(S){case 1:case 2:case 3:var ee=3;break;default:ee=S}var ae=S;S=ee;try{return H()}finally{S=ae}},e.unstable_requestPaint=function(){R=!0},e.unstable_runWithPriority=function(H,ee){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var ae=S;S=H;try{return ee()}finally{S=ae}},e.unstable_scheduleCallback=function(H,ee,ae){var Te=e.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?Te+ae:Te):ae=Te,H){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=ae+xe,H={id:A++,callback:ee,priorityLevel:H,startTime:ae,expirationTime:xe,sortIndex:-1},ae>Te?(H.sortIndex=ae,i(y,H),a(b)===null&&H===a(y)&&(g?(C(O),O=-1):g=!0,pe(Y,ae-Te))):(H.sortIndex=xe,i(b,H),p||_||(p=!0,X||(X=!0,_e()))),H},e.unstable_shouldYield=ue,e.unstable_wrapCallback=function(H){var ee=S;return function(){var ae=S;S=ee;try{return H.apply(this,arguments)}finally{S=ae}}}})(Xd)),Xd}var pg;function Vb(){return pg||(pg=1,Wd.exports=$b()),Wd.exports}var Qd={exports:{}},Hn={};var hg;function Yb(){if(hg)return Hn;hg=1;var e=Rf();function i(b){var y="https://react.dev/errors/"+b;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var A=2;A<arguments.length;A++)y+="&args[]="+encodeURIComponent(arguments[A])}return"Minified React error #"+b+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var o={d:{f:a,r:function(){throw Error(i(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},c=Symbol.for("react.portal");function r(b,y,A){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:v==null?null:""+v,children:b,containerInfo:y,implementation:A}}var f=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(b,y){if(b==="font")return"";if(typeof y=="string")return y==="use-credentials"?y:""}return Hn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,Hn.createPortal=function(b,y){var A=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)throw Error(i(299));return r(b,y,null,A)},Hn.flushSync=function(b){var y=f.T,A=o.p;try{if(f.T=null,o.p=2,b)return b()}finally{f.T=y,o.p=A,o.d.f()}},Hn.preconnect=function(b,y){typeof b=="string"&&(y?(y=y.crossOrigin,y=typeof y=="string"?y==="use-credentials"?y:"":void 0):y=null,o.d.C(b,y))},Hn.prefetchDNS=function(b){typeof b=="string"&&o.d.D(b)},Hn.preinit=function(b,y){if(typeof b=="string"&&y&&typeof y.as=="string"){var A=y.as,v=h(A,y.crossOrigin),S=typeof y.integrity=="string"?y.integrity:void 0,_=typeof y.fetchPriority=="string"?y.fetchPriority:void 0;A==="style"?o.d.S(b,typeof y.precedence=="string"?y.precedence:void 0,{crossOrigin:v,integrity:S,fetchPriority:_}):A==="script"&&o.d.X(b,{crossOrigin:v,integrity:S,fetchPriority:_,nonce:typeof y.nonce=="string"?y.nonce:void 0})}},Hn.preinitModule=function(b,y){if(typeof b=="string")if(typeof y=="object"&&y!==null){if(y.as==null||y.as==="script"){var A=h(y.as,y.crossOrigin);o.d.M(b,{crossOrigin:A,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0})}}else y==null&&o.d.M(b)},Hn.preload=function(b,y){if(typeof b=="string"&&typeof y=="object"&&y!==null&&typeof y.as=="string"){var A=y.as,v=h(A,y.crossOrigin);o.d.L(b,A,{crossOrigin:v,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0,type:typeof y.type=="string"?y.type:void 0,fetchPriority:typeof y.fetchPriority=="string"?y.fetchPriority:void 0,referrerPolicy:typeof y.referrerPolicy=="string"?y.referrerPolicy:void 0,imageSrcSet:typeof y.imageSrcSet=="string"?y.imageSrcSet:void 0,imageSizes:typeof y.imageSizes=="string"?y.imageSizes:void 0,media:typeof y.media=="string"?y.media:void 0})}},Hn.preloadModule=function(b,y){if(typeof b=="string")if(y){var A=h(y.as,y.crossOrigin);o.d.m(b,{as:typeof y.as=="string"&&y.as!=="script"?y.as:void 0,crossOrigin:A,integrity:typeof y.integrity=="string"?y.integrity:void 0})}else o.d.m(b)},Hn.requestFormReset=function(b){o.d.r(b)},Hn.unstable_batchedUpdates=function(b,y){return b(y)},Hn.useFormState=function(b,y,A){return f.H.useFormState(b,y,A)},Hn.useFormStatus=function(){return f.H.useHostTransitionStatus()},Hn.version="19.2.3",Hn}var gg;function Fb(){if(gg)return Qd.exports;gg=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(i){console.error(i)}}return e(),Qd.exports=Yb(),Qd.exports}var yg;function Kb(){if(yg)return Hl;yg=1;var e=Vb(),i=Rf(),a=Fb();function o(t){var n="https://react.dev/errors/"+t;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)n+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function r(t){var n=t,s=t;if(t.alternate)for(;n.return;)n=n.return;else{t=n;do n=t,(n.flags&4098)!==0&&(s=n.return),t=n.return;while(t)}return n.tag===3?s:null}function f(t){if(t.tag===13){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function h(t){if(t.tag===31){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function b(t){if(r(t)!==t)throw Error(o(188))}function y(t){var n=t.alternate;if(!n){if(n=r(t),n===null)throw Error(o(188));return n!==t?null:t}for(var s=t,l=n;;){var u=s.return;if(u===null)break;var d=u.alternate;if(d===null){if(l=u.return,l!==null){s=l;continue}break}if(u.child===d.child){for(d=u.child;d;){if(d===s)return b(u),t;if(d===l)return b(u),n;d=d.sibling}throw Error(o(188))}if(s.return!==l.return)s=u,l=d;else{for(var x=!1,T=u.child;T;){if(T===s){x=!0,s=u,l=d;break}if(T===l){x=!0,l=u,s=d;break}T=T.sibling}if(!x){for(T=d.child;T;){if(T===s){x=!0,s=d,l=u;break}if(T===l){x=!0,l=d,s=u;break}T=T.sibling}if(!x)throw Error(o(189))}}if(s.alternate!==l)throw Error(o(190))}if(s.tag!==3)throw Error(o(188));return s.stateNode.current===s?t:n}function A(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t;for(t=t.child;t!==null;){if(n=A(t),n!==null)return n;t=t.sibling}return null}var v=Object.assign,S=Symbol.for("react.element"),_=Symbol.for("react.transitional.element"),p=Symbol.for("react.portal"),g=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),I=Symbol.for("react.profiler"),C=Symbol.for("react.consumer"),M=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),X=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),ue=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function _e(t){return t===null||typeof t!="object"?null:(t=G&&t[G]||t["@@iterator"],typeof t=="function"?t:null)}var oe=Symbol.for("react.client.reference");function be(t){if(t==null)return null;if(typeof t=="function")return t.$$typeof===oe?null:t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case g:return"Fragment";case I:return"Profiler";case R:return"StrictMode";case Y:return"Suspense";case X:return"SuspenseList";case K:return"Activity"}if(typeof t=="object")switch(t.$$typeof){case p:return"Portal";case M:return t.displayName||"Context";case C:return(t._context.displayName||"Context")+".Consumer";case N:var n=t.render;return t=t.displayName,t||(t=n.displayName||n.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case O:return n=t.displayName||null,n!==null?n:be(t.type)||"Memo";case q:n=t._payload,t=t._init;try{return be(t(n))}catch{}}return null}var pe=Array.isArray,H=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ae={pending:!1,data:null,method:null,action:null},Te=[],xe=-1;function k(t){return{current:t}}function $(t){0>xe||(t.current=Te[xe],Te[xe]=null,xe--)}function J(t,n){xe++,Te[xe]=t.current,t.current=n}var me=k(null),Me=k(null),Re=k(null),ke=k(null);function ht(t,n){switch(J(Re,n),J(Me,t),J(me,null),n.nodeType){case 9:case 11:t=(t=n.documentElement)&&(t=t.namespaceURI)?kh(t):0;break;default:if(t=n.tagName,n=n.namespaceURI)n=kh(n),t=Lh(n,t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}$(me),J(me,t)}function $e(){$(me),$(Me),$(Re)}function kt(t){t.memoizedState!==null&&J(ke,t);var n=me.current,s=Lh(n,t.type);n!==s&&(J(Me,t),J(me,s))}function vn(t){Me.current===t&&($(me),$(Me)),ke.current===t&&($(ke),Ll._currentValue=ae)}var St,nn;function At(t){if(St===void 0)try{throw Error()}catch(s){var n=s.stack.trim().match(/\n( *(at )?)/);St=n&&n[1]||"",nn=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+St+t+nn}var Un=!1;function hi(t,n){if(!t||Un)return"";Un=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(n){var ie=function(){throw Error()};if(Object.defineProperty(ie.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ie,[])}catch(W){var V=W}Reflect.construct(t,[],ie)}else{try{ie.call()}catch(W){V=W}t.call(ie.prototype)}}else{try{throw Error()}catch(W){V=W}(ie=t())&&typeof ie.catch=="function"&&ie.catch(function(){})}}catch(W){if(W&&V&&typeof W.stack=="string")return[W.stack,V.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=l.DetermineComponentFrameRoot(),x=d[0],T=d[1];if(x&&T){var L=x.split(`
`),U=T.split(`
`);for(u=l=0;l<L.length&&!L[l].includes("DetermineComponentFrameRoot");)l++;for(;u<U.length&&!U[u].includes("DetermineComponentFrameRoot");)u++;if(l===L.length||u===U.length)for(l=L.length-1,u=U.length-1;1<=l&&0<=u&&L[l]!==U[u];)u--;for(;1<=l&&0<=u;l--,u--)if(L[l]!==U[u]){if(l!==1||u!==1)do if(l--,u--,0>u||L[l]!==U[u]){var Q=`
`+L[l].replace(" at new "," at ");return t.displayName&&Q.includes("<anonymous>")&&(Q=Q.replace("<anonymous>",t.displayName)),Q}while(1<=l&&0<=u);break}}}finally{Un=!1,Error.prepareStackTrace=s}return(s=t?t.displayName||t.name:"")?At(s):""}function Ue(t,n){switch(t.tag){case 26:case 27:case 5:return At(t.type);case 16:return At("Lazy");case 13:return t.child!==n&&n!==null?At("Suspense Fallback"):At("Suspense");case 19:return At("SuspenseList");case 0:case 15:return hi(t.type,!1);case 11:return hi(t.type.render,!1);case 1:return hi(t.type,!0);case 31:return At("Activity");default:return""}}function Le(t){try{var n="",s=null;do n+=Ue(t,s),s=t,t=t.return;while(t);return n}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var qe=Object.prototype.hasOwnProperty,Tn=e.unstable_scheduleCallback,Qt=e.unstable_cancelCallback,En=e.unstable_shouldYield,Vt=e.unstable_requestPaint,Ve=e.unstable_now,Yt=e.unstable_getCurrentPriorityLevel,$i=e.unstable_ImmediatePriority,kn=e.unstable_UserBlockingPriority,pn=e.unstable_NormalPriority,Vi=e.unstable_LowPriority,sn=e.unstable_IdlePriority,Lt=e.log,Jt=e.unstable_setDisableYieldValue,an=null,wt=null;function wn(t){if(typeof Lt=="function"&&Jt(t),wt&&typeof wt.setStrictMode=="function")try{wt.setStrictMode(an,t)}catch{}}var _t=Math.clz32?Math.clz32:qn,ga=Math.log,Yi=Math.LN2;function qn(t){return t>>>=0,t===0?32:31-(ga(t)/Yi|0)|0}var Zt=256,Mt=262144,hn=4194304;function Ft(t){var n=t&42;if(n!==0)return n;switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return t&261888;case 262144:case 524288:case 1048576:case 2097152:return t&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return t&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return t}}function Fe(t,n,s){var l=t.pendingLanes;if(l===0)return 0;var u=0,d=t.suspendedLanes,x=t.pingedLanes;t=t.warmLanes;var T=l&134217727;return T!==0?(l=T&~d,l!==0?u=Ft(l):(x&=T,x!==0?u=Ft(x):s||(s=T&~t,s!==0&&(u=Ft(s))))):(T=l&~d,T!==0?u=Ft(T):x!==0?u=Ft(x):s||(s=l&~t,s!==0&&(u=Ft(s)))),u===0?0:n!==0&&n!==u&&(n&d)===0&&(d=u&-u,s=n&-n,d>=s||d===32&&(s&4194048)!==0)?n:u}function Ot(t,n){return(t.pendingLanes&~(t.suspendedLanes&~t.pingedLanes)&n)===0}function on(t,n){switch(t){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Li(){var t=hn;return hn<<=1,(hn&62914560)===0&&(hn=4194304),t}function ft(t){for(var n=[],s=0;31>s;s++)n.push(t);return n}function qt(t,n){t.pendingLanes|=n,n!==268435456&&(t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0)}function zn(t,n,s,l,u,d){var x=t.pendingLanes;t.pendingLanes=s,t.suspendedLanes=0,t.pingedLanes=0,t.warmLanes=0,t.expiredLanes&=s,t.entangledLanes&=s,t.errorRecoveryDisabledLanes&=s,t.shellSuspendCounter=0;var T=t.entanglements,L=t.expirationTimes,U=t.hiddenUpdates;for(s=x&~s;0<s;){var Q=31-_t(s),ie=1<<Q;T[Q]=0,L[Q]=-1;var V=U[Q];if(V!==null)for(U[Q]=null,Q=0;Q<V.length;Q++){var W=V[Q];W!==null&&(W.lane&=-536870913)}s&=~ie}l!==0&&gi(t,l,0),d!==0&&u===0&&t.tag!==0&&(t.suspendedLanes|=d&~(x&~n))}function gi(t,n,s){t.pendingLanes|=n,t.suspendedLanes&=~n;var l=31-_t(n);t.entangledLanes|=n,t.entanglements[l]=t.entanglements[l]|1073741824|s&261930}function os(t,n){var s=t.entangledLanes|=n;for(t=t.entanglements;s;){var l=31-_t(s),u=1<<l;u&n|t[l]&n&&(t[l]|=n),s&=~u}}function Fi(t,n){var s=n&-n;return s=(s&42)!==0?1:ks(s),(s&(t.suspendedLanes|n))!==0?0:s}function ks(t){switch(t){case 2:t=1;break;case 8:t=4;break;case 32:t=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:t=128;break;case 268435456:t=134217728;break;default:t=0}return t}function Ii(t){return t&=-t,2<t?8<t?(t&134217727)!==0?32:268435456:8:2}function Ln(){var t=ee.p;return t!==0?t:(t=window.event,t===void 0?32:ng(t.type))}function yi(t,n){var s=ee.p;try{return ee.p=t,n()}finally{ee.p=s}}var In=Math.random().toString(36).slice(2),F="__reactFiber$"+In,te="__reactProps$"+In,de="__reactContainer$"+In,we="__reactEvents$"+In,ve="__reactListeners$"+In,Ie="__reactHandles$"+In,Ye="__reactResources$"+In,Ct="__reactMarker$"+In;function lt(t){delete t[F],delete t[te],delete t[we],delete t[ve],delete t[Ie]}function Ke(t){var n=t[F];if(n)return n;for(var s=t.parentNode;s;){if(n=s[de]||s[F]){if(s=n.alternate,n.child!==null||s!==null&&s.child!==null)for(t=Uh(t);t!==null;){if(s=t[F])return s;t=Uh(t)}return n}t=s,s=t.parentNode}return null}function rt(t){if(t=t[F]||t[de]){var n=t.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return t}return null}function Kt(t){var n=t.tag;if(n===5||n===26||n===27||n===6)return t.stateNode;throw Error(o(33))}function Bn(t){var n=t[Ye];return n||(n=t[Ye]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Nt(t){t[Ct]=!0}var ls=new Set,ya={};function Fn(t,n){ti(t,n),ti(t+"Capture",n)}function ti(t,n){for(ya[t]=n,t=0;t<n.length;t++)ls.add(n[t])}var ba=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ls={},xa={};function Wa(t){return qe.call(xa,t)?!0:qe.call(Ls,t)?!1:ba.test(t)?xa[t]=!0:(Ls[t]=!0,!1)}function ni(t,n,s){if(Wa(n))if(s===null)t.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":t.removeAttribute(n);return;case"boolean":var l=n.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){t.removeAttribute(n);return}}t.setAttribute(n,""+s)}}function ii(t,n,s){if(s===null)t.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(n);return}t.setAttribute(n,""+s)}}function jn(t,n,s,l){if(l===null)t.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":t.removeAttribute(s);return}t.setAttributeNS(n,s,""+l)}}function Sn(t){switch(typeof t){case"bigint":case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function va(t){var n=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function Xa(t,n,s){var l=Object.getOwnPropertyDescriptor(t.constructor.prototype,n);if(!t.hasOwnProperty(n)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var u=l.get,d=l.set;return Object.defineProperty(t,n,{configurable:!0,get:function(){return u.call(this)},set:function(x){s=""+x,d.call(this,x)}}),Object.defineProperty(t,n,{enumerable:l.enumerable}),{getValue:function(){return s},setValue:function(x){s=""+x},stopTracking:function(){t._valueTracker=null,delete t[n]}}}}function rs(t){if(!t._valueTracker){var n=va(t)?"checked":"value";t._valueTracker=Xa(t,n,""+t[n])}}function Ho(t){if(!t)return!1;var n=t._valueTracker;if(!n)return!0;var s=n.getValue(),l="";return t&&(l=va(t)?t.checked?"true":"false":t.value),t=l,t!==s?(n.setValue(t),!0):!1}function Ki(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}var Gc=/[\n"\\]/g;function Kn(t){return t.replace(Gc,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function Qa(t,n,s,l,u,d,x,T){t.name="",x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?t.type=x:t.removeAttribute("type"),n!=null?x==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+Sn(n)):t.value!==""+Sn(n)&&(t.value=""+Sn(n)):x!=="submit"&&x!=="reset"||t.removeAttribute("value"),n!=null?bi(t,x,Sn(n)):s!=null?bi(t,x,Sn(s)):l!=null&&t.removeAttribute("value"),u==null&&d!=null&&(t.defaultChecked=!!d),u!=null&&(t.checked=u&&typeof u!="function"&&typeof u!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?t.name=""+Sn(T):t.removeAttribute("name")}function Po(t,n,s,l,u,d,x,T){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(t.type=d),n!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||n!=null)){rs(t);return}s=s!=null?""+Sn(s):"",n=n!=null?""+Sn(n):s,T||n===t.value||(t.value=n),t.defaultValue=n}l=l??u,l=typeof l!="function"&&typeof l!="symbol"&&!!l,t.checked=T?t.checked:!!l,t.defaultChecked=!!l,x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(t.name=x),rs(t)}function bi(t,n,s){n==="number"&&Ki(t.ownerDocument)===t||t.defaultValue===""+s||(t.defaultValue=""+s)}function cs(t,n,s,l){if(t=t.options,n){n={};for(var u=0;u<s.length;u++)n["$"+s[u]]=!0;for(s=0;s<t.length;s++)u=n.hasOwnProperty("$"+t[s].value),t[s].selected!==u&&(t[s].selected=u),u&&l&&(t[s].defaultSelected=!0)}else{for(s=""+Sn(s),n=null,u=0;u<t.length;u++){if(t[u].value===s){t[u].selected=!0,l&&(t[u].defaultSelected=!0);return}n!==null||t[u].disabled||(n=t[u])}n!==null&&(n.selected=!0)}}function Uo(t,n,s){if(n!=null&&(n=""+Sn(n),n!==t.value&&(t.value=n),s==null)){t.defaultValue!==n&&(t.defaultValue=n);return}t.defaultValue=s!=null?""+Sn(s):""}function or(t,n,s,l){if(n==null){if(l!=null){if(s!=null)throw Error(o(92));if(pe(l)){if(1<l.length)throw Error(o(93));l=l[0]}s=l}s==null&&(s=""),n=s}s=Sn(n),t.defaultValue=s,l=t.textContent,l===s&&l!==""&&l!==null&&(t.value=l),rs(t)}function Is(t,n){if(n){var s=t.firstChild;if(s&&s===t.lastChild&&s.nodeType===3){s.nodeValue=n;return}}t.textContent=n}var lr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qo(t,n,s){var l=n.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?l?t.setProperty(n,""):n==="float"?t.cssFloat="":t[n]="":l?t.setProperty(n,s):typeof s!="number"||s===0||lr.has(n)?n==="float"?t.cssFloat=s:t[n]=(""+s).trim():t[n]=s+"px"}function Ja(t,n,s){if(n!=null&&typeof n!="object")throw Error(o(62));if(t=t.style,s!=null){for(var l in s)!s.hasOwnProperty(l)||n!=null&&n.hasOwnProperty(l)||(l.indexOf("--")===0?t.setProperty(l,""):l==="float"?t.cssFloat="":t[l]="");for(var u in n)l=n[u],n.hasOwnProperty(u)&&s[u]!==l&&qo(t,u,l)}else for(var d in n)n.hasOwnProperty(d)&&qo(t,d,n[d])}function Gi(t){if(t.indexOf("-")===-1)return!1;switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Za=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wi(t){return Za.test(""+t)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":t}function xi(){}var $o=null;function Vo(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Xi=null,si=null;function Yo(t){var n=rt(t);if(n&&(t=n.stateNode)){var s=t[te]||null;e:switch(t=n.stateNode,n.type){case"input":if(Qa(t,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),n=s.name,s.type==="radio"&&n!=null){for(s=t;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+Kn(""+n)+'"][type="radio"]'),n=0;n<s.length;n++){var l=s[n];if(l!==t&&l.form===t.form){var u=l[te]||null;if(!u)throw Error(o(90));Qa(l,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(n=0;n<s.length;n++)l=s[n],l.form===t.form&&Ho(l)}break e;case"textarea":Uo(t,s.value,s.defaultValue);break e;case"select":n=s.value,n!=null&&cs(t,!!s.multiple,n,!1)}}}var us=!1;function rr(t,n,s){if(us)return t(n,s);us=!0;try{var l=t(n);return l}finally{if(us=!1,(Xi!==null||si!==null)&&(Xr(),Xi&&(n=Xi,t=si,si=Xi=null,Yo(n),t)))for(n=0;n<t.length;n++)Yo(t[n])}}function Sa(t,n){var s=t.stateNode;if(s===null)return null;var l=s[te]||null;if(l===null)return null;s=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(s&&typeof s!="function")throw Error(o(231,n,typeof s));return s}var Bi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qi=!1;if(Bi)try{var Aa={};Object.defineProperty(Aa,"passive",{get:function(){Qi=!0}}),window.addEventListener("test",Aa,Aa),window.removeEventListener("test",Aa,Aa)}catch{Qi=!1}var Ji=null,Bs=null,eo=null;function cr(){if(eo)return eo;var t,n=Bs,s=n.length,l,u="value"in Ji?Ji.value:Ji.textContent,d=u.length;for(t=0;t<s&&n[t]===u[t];t++);var x=s-t;for(l=1;l<=x&&n[s-l]===u[d-l];l++);return eo=u.slice(t,1<l?1-l:void 0)}function to(t){var n=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&n===13&&(t=13)):t=n,t===10&&(t=13),32<=t||t===13?t:0}function ds(){return!0}function ur(){return!1}function ln(t){function n(s,l,u,d,x){this._reactName=s,this._targetInst=u,this.type=l,this.nativeEvent=d,this.target=x,this.currentTarget=null;for(var T in t)t.hasOwnProperty(T)&&(s=t[T],this[T]=s?s(d):d[T]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?ds:ur,this.isPropagationStopped=ur,this}return v(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=ds)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=ds)},persist:function(){},isPersistent:ds}),n}var vi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},js=ln(vi),Ds=v({},vi,{view:0,detail:0}),dr=ln(Ds),Fo,Ko,Ta,Hs=v({},Ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$t,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ta&&(Ta&&t.type==="mousemove"?(Fo=t.screenX-Ta.screenX,Ko=t.screenY-Ta.screenY):Ko=Fo=0,Ta=t),Fo)},movementY:function(t){return"movementY"in t?t.movementY:Ko}}),De=ln(Hs),E=v({},Hs,{dataTransfer:0}),B=ln(E),z=v({},Ds,{relatedTarget:0}),le=ln(z),re=v({},vi,{animationName:0,elapsedTime:0,pseudoElement:0}),fe=ln(re),ye=v({},vi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Xe=ln(ye),et=v({},vi,{data:0}),Dt=ln(et),zt={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ct={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gt(t){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(t):(t=ct[t])?!!n[t]:!1}function $t(){return gt}var It=v({},Ds,{key:function(t){if(t.key){var n=zt[t.key]||t.key;if(n!=="Unidentified")return n}return t.type==="keypress"?(t=to(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Tt[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$t,charCode:function(t){return t.type==="keypress"?to(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?to(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Dn=ln(It),Si=v({},Hs,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Go=ln(Si),fr=v({},Ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$t}),mr=ln(fr),pr=v({},vi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wc=ln(pr),Xc=v({},Hs,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Wo=ln(Xc),Xo=v({},vi,{newState:0,oldState:0}),Qc=ln(Xo),Jc=[9,13,27,32],Ps=Bi&&"CompositionEvent"in window,Zi=null;Bi&&"documentMode"in document&&(Zi=document.documentMode);var Qo=Bi&&"TextEvent"in window&&!Zi,Jo=Bi&&(!Ps||Zi&&8<Zi&&11>=Zi),Zo=" ",el=!1;function qf(t,n){switch(t){case"keyup":return Jc.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zf(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var no=!1;function c0(t,n){switch(t){case"compositionend":return zf(n);case"keypress":return n.which!==32?null:(el=!0,Zo);case"textInput":return t=n.data,t===Zo&&el?null:t;default:return null}}function u0(t,n){if(no)return t==="compositionend"||!Ps&&qf(t,n)?(t=cr(),eo=Bs=Ji=null,no=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return Jo&&n.locale!=="ko"?null:n.data;default:return null}}var d0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $f(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n==="input"?!!d0[t.type]:n==="textarea"}function Vf(t,n,s,l){Xi?si?si.push(l):si=[l]:Xi=l,n=ic(n,"onChange"),0<n.length&&(s=new js("onChange","change",null,s,l),t.push({event:s,listeners:n}))}var tl=null,nl=null;function f0(t){_h(t,0)}function hr(t){var n=Kt(t);if(Ho(n))return t}function Yf(t,n){if(t==="change")return n}var Ff=!1;if(Bi){var Zc;if(Bi){var eu="oninput"in document;if(!eu){var Kf=document.createElement("div");Kf.setAttribute("oninput","return;"),eu=typeof Kf.oninput=="function"}Zc=eu}else Zc=!1;Ff=Zc&&(!document.documentMode||9<document.documentMode)}function Gf(){tl&&(tl.detachEvent("onpropertychange",Wf),nl=tl=null)}function Wf(t){if(t.propertyName==="value"&&hr(nl)){var n=[];Vf(n,nl,t,Vo(t)),rr(f0,n)}}function m0(t,n,s){t==="focusin"?(Gf(),tl=n,nl=s,tl.attachEvent("onpropertychange",Wf)):t==="focusout"&&Gf()}function p0(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return hr(nl)}function h0(t,n){if(t==="click")return hr(n)}function g0(t,n){if(t==="input"||t==="change")return hr(n)}function y0(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var ai=typeof Object.is=="function"?Object.is:y0;function il(t,n){if(ai(t,n))return!0;if(typeof t!="object"||t===null||typeof n!="object"||n===null)return!1;var s=Object.keys(t),l=Object.keys(n);if(s.length!==l.length)return!1;for(l=0;l<s.length;l++){var u=s[l];if(!qe.call(n,u)||!ai(t[u],n[u]))return!1}return!0}function Xf(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Qf(t,n){var s=Xf(t);t=0;for(var l;s;){if(s.nodeType===3){if(l=t+s.textContent.length,t<=n&&l>=n)return{node:s,offset:n-t};t=l}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Xf(s)}}function Jf(t,n){return t&&n?t===n?!0:t&&t.nodeType===3?!1:n&&n.nodeType===3?Jf(t,n.parentNode):"contains"in t?t.contains(n):t.compareDocumentPosition?!!(t.compareDocumentPosition(n)&16):!1:!1}function Zf(t){t=t!=null&&t.ownerDocument!=null&&t.ownerDocument.defaultView!=null?t.ownerDocument.defaultView:window;for(var n=Ki(t.document);n instanceof t.HTMLIFrameElement;){try{var s=typeof n.contentWindow.location.href=="string"}catch{s=!1}if(s)t=n.contentWindow;else break;n=Ki(t.document)}return n}function tu(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n&&(n==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||n==="textarea"||t.contentEditable==="true")}var b0=Bi&&"documentMode"in document&&11>=document.documentMode,io=null,nu=null,sl=null,iu=!1;function em(t,n,s){var l=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;iu||io==null||io!==Ki(l)||(l=io,"selectionStart"in l&&tu(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),sl&&il(sl,l)||(sl=l,l=ic(nu,"onSelect"),0<l.length&&(n=new js("onSelect","select",null,n,s),t.push({event:n,listeners:l}),n.target=io)))}function Ea(t,n){var s={};return s[t.toLowerCase()]=n.toLowerCase(),s["Webkit"+t]="webkit"+n,s["Moz"+t]="moz"+n,s}var so={animationend:Ea("Animation","AnimationEnd"),animationiteration:Ea("Animation","AnimationIteration"),animationstart:Ea("Animation","AnimationStart"),transitionrun:Ea("Transition","TransitionRun"),transitionstart:Ea("Transition","TransitionStart"),transitioncancel:Ea("Transition","TransitionCancel"),transitionend:Ea("Transition","TransitionEnd")},su={},tm={};Bi&&(tm=document.createElement("div").style,"AnimationEvent"in window||(delete so.animationend.animation,delete so.animationiteration.animation,delete so.animationstart.animation),"TransitionEvent"in window||delete so.transitionend.transition);function wa(t){if(su[t])return su[t];if(!so[t])return t;var n=so[t],s;for(s in n)if(n.hasOwnProperty(s)&&s in tm)return su[t]=n[s];return t}var nm=wa("animationend"),im=wa("animationiteration"),sm=wa("animationstart"),x0=wa("transitionrun"),v0=wa("transitionstart"),S0=wa("transitioncancel"),am=wa("transitionend"),om=new Map,au="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");au.push("scrollEnd");function ji(t,n){om.set(t,n),Fn(n,[t])}var gr=typeof reportError=="function"?reportError:function(t){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof t=="object"&&t!==null&&typeof t.message=="string"?String(t.message):String(t),error:t});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",t);return}console.error(t)},Ai=[],ao=0,ou=0;function yr(){for(var t=ao,n=ou=ao=0;n<t;){var s=Ai[n];Ai[n++]=null;var l=Ai[n];Ai[n++]=null;var u=Ai[n];Ai[n++]=null;var d=Ai[n];if(Ai[n++]=null,l!==null&&u!==null){var x=l.pending;x===null?u.next=u:(u.next=x.next,x.next=u),l.pending=u}d!==0&&lm(s,u,d)}}function br(t,n,s,l){Ai[ao++]=t,Ai[ao++]=n,Ai[ao++]=s,Ai[ao++]=l,ou|=l,t.lanes|=l,t=t.alternate,t!==null&&(t.lanes|=l)}function lu(t,n,s,l){return br(t,n,s,l),xr(t)}function _a(t,n){return br(t,null,null,n),xr(t)}function lm(t,n,s){t.lanes|=s;var l=t.alternate;l!==null&&(l.lanes|=s);for(var u=!1,d=t.return;d!==null;)d.childLanes|=s,l=d.alternate,l!==null&&(l.childLanes|=s),d.tag===22&&(t=d.stateNode,t===null||t._visibility&1||(u=!0)),t=d,d=d.return;return t.tag===3?(d=t.stateNode,u&&n!==null&&(u=31-_t(s),t=d.hiddenUpdates,l=t[u],l===null?t[u]=[n]:l.push(n),n.lane=s|536870912),d):null}function xr(t){if(50<_l)throw _l=0,gd=null,Error(o(185));for(var n=t.return;n!==null;)t=n,n=t.return;return t.tag===3?t.stateNode:null}var oo={};function A0(t,n,s,l){this.tag=t,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oi(t,n,s,l){return new A0(t,n,s,l)}function ru(t){return t=t.prototype,!(!t||!t.isReactComponent)}function fs(t,n){var s=t.alternate;return s===null?(s=oi(t.tag,n,t.key,t.mode),s.elementType=t.elementType,s.type=t.type,s.stateNode=t.stateNode,s.alternate=t,t.alternate=s):(s.pendingProps=n,s.type=t.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=t.flags&65011712,s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,n=t.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},s.sibling=t.sibling,s.index=t.index,s.ref=t.ref,s.refCleanup=t.refCleanup,s}function rm(t,n){t.flags&=65011714;var s=t.alternate;return s===null?(t.childLanes=0,t.lanes=n,t.child=null,t.subtreeFlags=0,t.memoizedProps=null,t.memoizedState=null,t.updateQueue=null,t.dependencies=null,t.stateNode=null):(t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.subtreeFlags=0,t.deletions=null,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,t.type=s.type,n=s.dependencies,t.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t}function vr(t,n,s,l,u,d){var x=0;if(l=t,typeof t=="function")ru(t)&&(x=1);else if(typeof t=="string")x=Mb(t,s,me.current)?26:t==="html"||t==="head"||t==="body"?27:5;else e:switch(t){case K:return t=oi(31,s,n,u),t.elementType=K,t.lanes=d,t;case g:return Ma(s.children,u,d,n);case R:x=8,u|=24;break;case I:return t=oi(12,s,n,u|2),t.elementType=I,t.lanes=d,t;case Y:return t=oi(13,s,n,u),t.elementType=Y,t.lanes=d,t;case X:return t=oi(19,s,n,u),t.elementType=X,t.lanes=d,t;default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case M:x=10;break e;case C:x=9;break e;case N:x=11;break e;case O:x=14;break e;case q:x=16,l=null;break e}x=29,s=Error(o(130,t===null?"null":typeof t,"")),l=null}return n=oi(x,s,n,u),n.elementType=t,n.type=l,n.lanes=d,n}function Ma(t,n,s,l){return t=oi(7,t,l,n),t.lanes=s,t}function cu(t,n,s){return t=oi(6,t,null,n),t.lanes=s,t}function cm(t){var n=oi(18,null,null,0);return n.stateNode=t,n}function uu(t,n,s){return n=oi(4,t.children!==null?t.children:[],t.key,n),n.lanes=s,n.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},n}var um=new WeakMap;function Ti(t,n){if(typeof t=="object"&&t!==null){var s=um.get(t);return s!==void 0?s:(n={value:t,source:n,stack:Le(n)},um.set(t,n),n)}return{value:t,source:n,stack:Le(n)}}var lo=[],ro=0,Sr=null,al=0,Ei=[],wi=0,Us=null,es=1,ts="";function ms(t,n){lo[ro++]=al,lo[ro++]=Sr,Sr=t,al=n}function dm(t,n,s){Ei[wi++]=es,Ei[wi++]=ts,Ei[wi++]=Us,Us=t;var l=es;t=ts;var u=32-_t(l)-1;l&=~(1<<u),s+=1;var d=32-_t(n)+u;if(30<d){var x=u-u%5;d=(l&(1<<x)-1).toString(32),l>>=x,u-=x,es=1<<32-_t(n)+u|s<<u|l,ts=d+t}else es=1<<d|s<<u|l,ts=t}function du(t){t.return!==null&&(ms(t,1),dm(t,1,0))}function fu(t){for(;t===Sr;)Sr=lo[--ro],lo[ro]=null,al=lo[--ro],lo[ro]=null;for(;t===Us;)Us=Ei[--wi],Ei[wi]=null,ts=Ei[--wi],Ei[wi]=null,es=Ei[--wi],Ei[wi]=null}function fm(t,n){Ei[wi++]=es,Ei[wi++]=ts,Ei[wi++]=Us,es=n.id,ts=n.overflow,Us=t}var _n=null,Bt=null,tt=!1,qs=null,_i=!1,mu=Error(o(519));function zs(t){var n=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ol(Ti(n,t)),mu}function mm(t){var n=t.stateNode,s=t.type,l=t.memoizedProps;switch(n[F]=t,n[te]=l,s){case"dialog":We("cancel",n),We("close",n);break;case"iframe":case"object":case"embed":We("load",n);break;case"video":case"audio":for(s=0;s<Ol.length;s++)We(Ol[s],n);break;case"source":We("error",n);break;case"img":case"image":case"link":We("error",n),We("load",n);break;case"details":We("toggle",n);break;case"input":We("invalid",n),Po(n,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":We("invalid",n);break;case"textarea":We("invalid",n),or(n,l.value,l.defaultValue,l.children)}s=l.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||n.textContent===""+s||l.suppressHydrationWarning===!0||Nh(n.textContent,s)?(l.popover!=null&&(We("beforetoggle",n),We("toggle",n)),l.onScroll!=null&&We("scroll",n),l.onScrollEnd!=null&&We("scrollend",n),l.onClick!=null&&(n.onclick=xi),n=!0):n=!1,n||zs(t,!0)}function pm(t){for(_n=t.return;_n;)switch(_n.tag){case 5:case 31:case 13:_i=!1;return;case 27:case 3:_i=!0;return;default:_n=_n.return}}function co(t){if(t!==_n)return!1;if(!tt)return pm(t),tt=!0,!1;var n=t.tag,s;if((s=n!==3&&n!==27)&&((s=n===5)&&(s=t.type,s=!(s!=="form"&&s!=="button")||Rd(t.type,t.memoizedProps)),s=!s),s&&Bt&&zs(t),pm(t),n===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));Bt=Ph(t)}else if(n===31){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(317));Bt=Ph(t)}else n===27?(n=Bt,na(t.type)?(t=jd,jd=null,Bt=t):Bt=n):Bt=_n?Oi(t.stateNode.nextSibling):null;return!0}function Oa(){Bt=_n=null,tt=!1}function pu(){var t=qs;return t!==null&&(Qn===null?Qn=t:Qn.push.apply(Qn,t),qs=null),t}function ol(t){qs===null?qs=[t]:qs.push(t)}var hu=k(null),Ca=null,ps=null;function $s(t,n,s){J(hu,n._currentValue),n._currentValue=s}function hs(t){t._currentValue=hu.current,$(hu)}function gu(t,n,s){for(;t!==null;){var l=t.alternate;if((t.childLanes&n)!==n?(t.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),t===s)break;t=t.return}}function yu(t,n,s,l){var u=t.child;for(u!==null&&(u.return=t);u!==null;){var d=u.dependencies;if(d!==null){var x=u.child;d=d.firstContext;e:for(;d!==null;){var T=d;d=u;for(var L=0;L<n.length;L++)if(T.context===n[L]){d.lanes|=s,T=d.alternate,T!==null&&(T.lanes|=s),gu(d.return,s,t),l||(x=null);break e}d=T.next}}else if(u.tag===18){if(x=u.return,x===null)throw Error(o(341));x.lanes|=s,d=x.alternate,d!==null&&(d.lanes|=s),gu(x,s,t),x=null}else x=u.child;if(x!==null)x.return=u;else for(x=u;x!==null;){if(x===t){x=null;break}if(u=x.sibling,u!==null){u.return=x.return,x=u;break}x=x.return}u=x}}function uo(t,n,s,l){t=null;for(var u=n,d=!1;u!==null;){if(!d){if((u.flags&524288)!==0)d=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var x=u.alternate;if(x===null)throw Error(o(387));if(x=x.memoizedProps,x!==null){var T=u.type;ai(u.pendingProps.value,x.value)||(t!==null?t.push(T):t=[T])}}else if(u===ke.current){if(x=u.alternate,x===null)throw Error(o(387));x.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(t!==null?t.push(Ll):t=[Ll])}u=u.return}t!==null&&yu(n,t,s,l),n.flags|=262144}function Ar(t){for(t=t.firstContext;t!==null;){if(!ai(t.context._currentValue,t.memoizedValue))return!0;t=t.next}return!1}function Na(t){Ca=t,ps=null,t=t.dependencies,t!==null&&(t.firstContext=null)}function Mn(t){return hm(Ca,t)}function Tr(t,n){return Ca===null&&Na(t),hm(t,n)}function hm(t,n){var s=n._currentValue;if(n={context:n,memoizedValue:s,next:null},ps===null){if(t===null)throw Error(o(308));ps=n,t.dependencies={lanes:0,firstContext:n},t.flags|=524288}else ps=ps.next=n;return s}var T0=typeof AbortController<"u"?AbortController:function(){var t=[],n=this.signal={aborted:!1,addEventListener:function(s,l){t.push(l)}};this.abort=function(){n.aborted=!0,t.forEach(function(s){return s()})}},E0=e.unstable_scheduleCallback,w0=e.unstable_NormalPriority,rn={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function bu(){return{controller:new T0,data:new Map,refCount:0}}function ll(t){t.refCount--,t.refCount===0&&E0(w0,function(){t.controller.abort()})}var rl=null,xu=0,fo=0,mo=null;function _0(t,n){if(rl===null){var s=rl=[];xu=0,fo=Ad(),mo={status:"pending",value:void 0,then:function(l){s.push(l)}}}return xu++,n.then(gm,gm),n}function gm(){if(--xu===0&&rl!==null){mo!==null&&(mo.status="fulfilled");var t=rl;rl=null,fo=0,mo=null;for(var n=0;n<t.length;n++)(0,t[n])()}}function M0(t,n){var s=[],l={status:"pending",value:null,reason:null,then:function(u){s.push(u)}};return t.then(function(){l.status="fulfilled",l.value=n;for(var u=0;u<s.length;u++)(0,s[u])(n)},function(u){for(l.status="rejected",l.reason=u,u=0;u<s.length;u++)(0,s[u])(void 0)}),l}var ym=H.S;H.S=function(t,n){eh=Ve(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&_0(t,n),ym!==null&&ym(t,n)};var Ra=k(null);function vu(){var t=Ra.current;return t!==null?t:Et.pooledCache}function Er(t,n){n===null?J(Ra,Ra.current):J(Ra,n.pool)}function bm(){var t=vu();return t===null?null:{parent:rn._currentValue,pool:t}}var po=Error(o(460)),Su=Error(o(474)),wr=Error(o(542)),_r={then:function(){}};function xm(t){return t=t.status,t==="fulfilled"||t==="rejected"}function vm(t,n,s){switch(s=t[s],s===void 0?t.push(n):s!==n&&(n.then(xi,xi),n=s),n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,Am(t),t;default:if(typeof n.status=="string")n.then(xi,xi);else{if(t=Et,t!==null&&100<t.shellSuspendCounter)throw Error(o(482));t=n,t.status="pending",t.then(function(l){if(n.status==="pending"){var u=n;u.status="fulfilled",u.value=l}},function(l){if(n.status==="pending"){var u=n;u.status="rejected",u.reason=l}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw t=n.reason,Am(t),t}throw La=n,po}}function ka(t){try{var n=t._init;return n(t._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(La=s,po):s}}var La=null;function Sm(){if(La===null)throw Error(o(459));var t=La;return La=null,t}function Am(t){if(t===po||t===wr)throw Error(o(483))}var ho=null,cl=0;function Mr(t){var n=cl;return cl+=1,ho===null&&(ho=[]),vm(ho,t,n)}function ul(t,n){n=n.props.ref,t.ref=n!==void 0?n:null}function Or(t,n){throw n.$$typeof===S?Error(o(525)):(t=Object.prototype.toString.call(n),Error(o(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t)))}function Tm(t){function n(D,j){if(t){var P=D.deletions;P===null?(D.deletions=[j],D.flags|=16):P.push(j)}}function s(D,j){if(!t)return null;for(;j!==null;)n(D,j),j=j.sibling;return null}function l(D){for(var j=new Map;D!==null;)D.key!==null?j.set(D.key,D):j.set(D.index,D),D=D.sibling;return j}function u(D,j){return D=fs(D,j),D.index=0,D.sibling=null,D}function d(D,j,P){return D.index=P,t?(P=D.alternate,P!==null?(P=P.index,P<j?(D.flags|=67108866,j):P):(D.flags|=67108866,j)):(D.flags|=1048576,j)}function x(D){return t&&D.alternate===null&&(D.flags|=67108866),D}function T(D,j,P,Z){return j===null||j.tag!==6?(j=cu(P,D.mode,Z),j.return=D,j):(j=u(j,P),j.return=D,j)}function L(D,j,P,Z){var Oe=P.type;return Oe===g?Q(D,j,P.props.children,Z,P.key):j!==null&&(j.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===q&&ka(Oe)===j.type)?(j=u(j,P.props),ul(j,P),j.return=D,j):(j=vr(P.type,P.key,P.props,null,D.mode,Z),ul(j,P),j.return=D,j)}function U(D,j,P,Z){return j===null||j.tag!==4||j.stateNode.containerInfo!==P.containerInfo||j.stateNode.implementation!==P.implementation?(j=uu(P,D.mode,Z),j.return=D,j):(j=u(j,P.children||[]),j.return=D,j)}function Q(D,j,P,Z,Oe){return j===null||j.tag!==7?(j=Ma(P,D.mode,Z,Oe),j.return=D,j):(j=u(j,P),j.return=D,j)}function ie(D,j,P){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=cu(""+j,D.mode,P),j.return=D,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case _:return P=vr(j.type,j.key,j.props,null,D.mode,P),ul(P,j),P.return=D,P;case p:return j=uu(j,D.mode,P),j.return=D,j;case q:return j=ka(j),ie(D,j,P)}if(pe(j)||_e(j))return j=Ma(j,D.mode,P,null),j.return=D,j;if(typeof j.then=="function")return ie(D,Mr(j),P);if(j.$$typeof===M)return ie(D,Tr(D,j),P);Or(D,j)}return null}function V(D,j,P,Z){var Oe=j!==null?j.key:null;if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return Oe!==null?null:T(D,j,""+P,Z);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case _:return P.key===Oe?L(D,j,P,Z):null;case p:return P.key===Oe?U(D,j,P,Z):null;case q:return P=ka(P),V(D,j,P,Z)}if(pe(P)||_e(P))return Oe!==null?null:Q(D,j,P,Z,null);if(typeof P.then=="function")return V(D,j,Mr(P),Z);if(P.$$typeof===M)return V(D,j,Tr(D,P),Z);Or(D,P)}return null}function W(D,j,P,Z,Oe){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return D=D.get(P)||null,T(j,D,""+Z,Oe);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case _:return D=D.get(Z.key===null?P:Z.key)||null,L(j,D,Z,Oe);case p:return D=D.get(Z.key===null?P:Z.key)||null,U(j,D,Z,Oe);case q:return Z=ka(Z),W(D,j,P,Z,Oe)}if(pe(Z)||_e(Z))return D=D.get(P)||null,Q(j,D,Z,Oe,null);if(typeof Z.then=="function")return W(D,j,P,Mr(Z),Oe);if(Z.$$typeof===M)return W(D,j,P,Tr(j,Z),Oe);Or(j,Z)}return null}function Se(D,j,P,Z){for(var Oe=null,it=null,Ae=j,Pe=j=0,Je=null;Ae!==null&&Pe<P.length;Pe++){Ae.index>Pe?(Je=Ae,Ae=null):Je=Ae.sibling;var st=V(D,Ae,P[Pe],Z);if(st===null){Ae===null&&(Ae=Je);break}t&&Ae&&st.alternate===null&&n(D,Ae),j=d(st,j,Pe),it===null?Oe=st:it.sibling=st,it=st,Ae=Je}if(Pe===P.length)return s(D,Ae),tt&&ms(D,Pe),Oe;if(Ae===null){for(;Pe<P.length;Pe++)Ae=ie(D,P[Pe],Z),Ae!==null&&(j=d(Ae,j,Pe),it===null?Oe=Ae:it.sibling=Ae,it=Ae);return tt&&ms(D,Pe),Oe}for(Ae=l(Ae);Pe<P.length;Pe++)Je=W(Ae,D,Pe,P[Pe],Z),Je!==null&&(t&&Je.alternate!==null&&Ae.delete(Je.key===null?Pe:Je.key),j=d(Je,j,Pe),it===null?Oe=Je:it.sibling=Je,it=Je);return t&&Ae.forEach(function(la){return n(D,la)}),tt&&ms(D,Pe),Oe}function Ne(D,j,P,Z){if(P==null)throw Error(o(151));for(var Oe=null,it=null,Ae=j,Pe=j=0,Je=null,st=P.next();Ae!==null&&!st.done;Pe++,st=P.next()){Ae.index>Pe?(Je=Ae,Ae=null):Je=Ae.sibling;var la=V(D,Ae,st.value,Z);if(la===null){Ae===null&&(Ae=Je);break}t&&Ae&&la.alternate===null&&n(D,Ae),j=d(la,j,Pe),it===null?Oe=la:it.sibling=la,it=la,Ae=Je}if(st.done)return s(D,Ae),tt&&ms(D,Pe),Oe;if(Ae===null){for(;!st.done;Pe++,st=P.next())st=ie(D,st.value,Z),st!==null&&(j=d(st,j,Pe),it===null?Oe=st:it.sibling=st,it=st);return tt&&ms(D,Pe),Oe}for(Ae=l(Ae);!st.done;Pe++,st=P.next())st=W(Ae,D,Pe,st.value,Z),st!==null&&(t&&st.alternate!==null&&Ae.delete(st.key===null?Pe:st.key),j=d(st,j,Pe),it===null?Oe=st:it.sibling=st,it=st);return t&&Ae.forEach(function(Hb){return n(D,Hb)}),tt&&ms(D,Pe),Oe}function xt(D,j,P,Z){if(typeof P=="object"&&P!==null&&P.type===g&&P.key===null&&(P=P.props.children),typeof P=="object"&&P!==null){switch(P.$$typeof){case _:e:{for(var Oe=P.key;j!==null;){if(j.key===Oe){if(Oe=P.type,Oe===g){if(j.tag===7){s(D,j.sibling),Z=u(j,P.props.children),Z.return=D,D=Z;break e}}else if(j.elementType===Oe||typeof Oe=="object"&&Oe!==null&&Oe.$$typeof===q&&ka(Oe)===j.type){s(D,j.sibling),Z=u(j,P.props),ul(Z,P),Z.return=D,D=Z;break e}s(D,j);break}else n(D,j);j=j.sibling}P.type===g?(Z=Ma(P.props.children,D.mode,Z,P.key),Z.return=D,D=Z):(Z=vr(P.type,P.key,P.props,null,D.mode,Z),ul(Z,P),Z.return=D,D=Z)}return x(D);case p:e:{for(Oe=P.key;j!==null;){if(j.key===Oe)if(j.tag===4&&j.stateNode.containerInfo===P.containerInfo&&j.stateNode.implementation===P.implementation){s(D,j.sibling),Z=u(j,P.children||[]),Z.return=D,D=Z;break e}else{s(D,j);break}else n(D,j);j=j.sibling}Z=uu(P,D.mode,Z),Z.return=D,D=Z}return x(D);case q:return P=ka(P),xt(D,j,P,Z)}if(pe(P))return Se(D,j,P,Z);if(_e(P)){if(Oe=_e(P),typeof Oe!="function")throw Error(o(150));return P=Oe.call(P),Ne(D,j,P,Z)}if(typeof P.then=="function")return xt(D,j,Mr(P),Z);if(P.$$typeof===M)return xt(D,j,Tr(D,P),Z);Or(D,P)}return typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint"?(P=""+P,j!==null&&j.tag===6?(s(D,j.sibling),Z=u(j,P),Z.return=D,D=Z):(s(D,j),Z=cu(P,D.mode,Z),Z.return=D,D=Z),x(D)):s(D,j)}return function(D,j,P,Z){try{cl=0;var Oe=xt(D,j,P,Z);return ho=null,Oe}catch(Ae){if(Ae===po||Ae===wr)throw Ae;var it=oi(29,Ae,null,D.mode);return it.lanes=Z,it.return=D,it}}}var Ia=Tm(!0),Em=Tm(!1),Vs=!1;function Au(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Tu(t,n){t=t.updateQueue,n.updateQueue===t&&(n.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,callbacks:null})}function Ys(t){return{lane:t,tag:0,payload:null,callback:null,next:null}}function Fs(t,n,s){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,(at&2)!==0){var u=l.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),l.pending=n,n=xr(t),lm(t,null,s),n}return br(t,l,n,s),xr(t)}function dl(t,n,s){if(n=n.updateQueue,n!==null&&(n=n.shared,(s&4194048)!==0)){var l=n.lanes;l&=t.pendingLanes,s|=l,n.lanes=s,os(t,s)}}function Eu(t,n){var s=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,s===l)){var u=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var x={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?u=d=x:d=d.next=x,s=s.next}while(s!==null);d===null?u=d=n:d=d.next=n}else u=d=n;s={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:d,shared:l.shared,callbacks:l.callbacks},t.updateQueue=s;return}t=s.lastBaseUpdate,t===null?s.firstBaseUpdate=n:t.next=n,s.lastBaseUpdate=n}var wu=!1;function fl(){if(wu){var t=mo;if(t!==null)throw t}}function ml(t,n,s,l){wu=!1;var u=t.updateQueue;Vs=!1;var d=u.firstBaseUpdate,x=u.lastBaseUpdate,T=u.shared.pending;if(T!==null){u.shared.pending=null;var L=T,U=L.next;L.next=null,x===null?d=U:x.next=U,x=L;var Q=t.alternate;Q!==null&&(Q=Q.updateQueue,T=Q.lastBaseUpdate,T!==x&&(T===null?Q.firstBaseUpdate=U:T.next=U,Q.lastBaseUpdate=L))}if(d!==null){var ie=u.baseState;x=0,Q=U=L=null,T=d;do{var V=T.lane&-536870913,W=V!==T.lane;if(W?(Qe&V)===V:(l&V)===V){V!==0&&V===fo&&(wu=!0),Q!==null&&(Q=Q.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var Se=t,Ne=T;V=n;var xt=s;switch(Ne.tag){case 1:if(Se=Ne.payload,typeof Se=="function"){ie=Se.call(xt,ie,V);break e}ie=Se;break e;case 3:Se.flags=Se.flags&-65537|128;case 0:if(Se=Ne.payload,V=typeof Se=="function"?Se.call(xt,ie,V):Se,V==null)break e;ie=v({},ie,V);break e;case 2:Vs=!0}}V=T.callback,V!==null&&(t.flags|=64,W&&(t.flags|=8192),W=u.callbacks,W===null?u.callbacks=[V]:W.push(V))}else W={lane:V,tag:T.tag,payload:T.payload,callback:T.callback,next:null},Q===null?(U=Q=W,L=ie):Q=Q.next=W,x|=V;if(T=T.next,T===null){if(T=u.shared.pending,T===null)break;W=T,T=W.next,W.next=null,u.lastBaseUpdate=W,u.shared.pending=null}}while(!0);Q===null&&(L=ie),u.baseState=L,u.firstBaseUpdate=U,u.lastBaseUpdate=Q,d===null&&(u.shared.lanes=0),Qs|=x,t.lanes=x,t.memoizedState=ie}}function wm(t,n){if(typeof t!="function")throw Error(o(191,t));t.call(n)}function _m(t,n){var s=t.callbacks;if(s!==null)for(t.callbacks=null,t=0;t<s.length;t++)wm(s[t],n)}var go=k(null),Cr=k(0);function Mm(t,n){t=Es,J(Cr,t),J(go,n),Es=t|n.baseLanes}function _u(){J(Cr,Es),J(go,go.current)}function Mu(){Es=Cr.current,$(go),$(Cr)}var li=k(null),Mi=null;function Ks(t){var n=t.alternate;J(en,en.current&1),J(li,t),Mi===null&&(n===null||go.current!==null||n.memoizedState!==null)&&(Mi=t)}function Ou(t){J(en,en.current),J(li,t),Mi===null&&(Mi=t)}function Om(t){t.tag===22?(J(en,en.current),J(li,t),Mi===null&&(Mi=t)):Gs()}function Gs(){J(en,en.current),J(li,li.current)}function ri(t){$(li),Mi===t&&(Mi=null),$(en)}var en=k(0);function Nr(t){for(var n=t;n!==null;){if(n.tag===13){var s=n.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||Id(s)||Bd(s)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var gs=0,He=null,yt=null,cn=null,Rr=!1,yo=!1,Ba=!1,kr=0,pl=0,bo=null,O0=0;function Gt(){throw Error(o(321))}function Cu(t,n){if(n===null)return!1;for(var s=0;s<n.length&&s<t.length;s++)if(!ai(t[s],n[s]))return!1;return!0}function Nu(t,n,s,l,u,d){return gs=d,He=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,H.H=t===null||t.memoizedState===null?dp:Yu,Ba=!1,d=s(l,u),Ba=!1,yo&&(d=Nm(n,s,l,u)),Cm(t),d}function Cm(t){H.H=yl;var n=yt!==null&&yt.next!==null;if(gs=0,cn=yt=He=null,Rr=!1,pl=0,bo=null,n)throw Error(o(300));t===null||un||(t=t.dependencies,t!==null&&Ar(t)&&(un=!0))}function Nm(t,n,s,l){He=t;var u=0;do{if(yo&&(bo=null),pl=0,yo=!1,25<=u)throw Error(o(301));if(u+=1,cn=yt=null,t.updateQueue!=null){var d=t.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}H.H=fp,d=n(s,l)}while(yo);return d}function C0(){var t=H.H,n=t.useState()[0];return n=typeof n.then=="function"?hl(n):n,t=t.useState()[0],(yt!==null?yt.memoizedState:null)!==t&&(He.flags|=1024),n}function Ru(){var t=kr!==0;return kr=0,t}function ku(t,n,s){n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~s}function Lu(t){if(Rr){for(t=t.memoizedState;t!==null;){var n=t.queue;n!==null&&(n.pending=null),t=t.next}Rr=!1}gs=0,cn=yt=He=null,yo=!1,pl=kr=0,bo=null}function $n(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return cn===null?He.memoizedState=cn=t:cn=cn.next=t,cn}function tn(){if(yt===null){var t=He.alternate;t=t!==null?t.memoizedState:null}else t=yt.next;var n=cn===null?He.memoizedState:cn.next;if(n!==null)cn=n,yt=t;else{if(t===null)throw He.alternate===null?Error(o(467)):Error(o(310));yt=t,t={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},cn===null?He.memoizedState=cn=t:cn=cn.next=t}return cn}function Lr(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function hl(t){var n=pl;return pl+=1,bo===null&&(bo=[]),t=vm(bo,t,n),n=He,(cn===null?n.memoizedState:cn.next)===null&&(n=n.alternate,H.H=n===null||n.memoizedState===null?dp:Yu),t}function Ir(t){if(t!==null&&typeof t=="object"){if(typeof t.then=="function")return hl(t);if(t.$$typeof===M)return Mn(t)}throw Error(o(438,String(t)))}function Iu(t){var n=null,s=He.updateQueue;if(s!==null&&(n=s.memoCache),n==null){var l=He.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(n={data:l.data.map(function(u){return u.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),s===null&&(s=Lr(),He.updateQueue=s),s.memoCache=n,s=n.data[n.index],s===void 0)for(s=n.data[n.index]=Array(t),l=0;l<t;l++)s[l]=ue;return n.index++,s}function ys(t,n){return typeof n=="function"?n(t):n}function Br(t){var n=tn();return Bu(n,yt,t)}function Bu(t,n,s){var l=t.queue;if(l===null)throw Error(o(311));l.lastRenderedReducer=s;var u=t.baseQueue,d=l.pending;if(d!==null){if(u!==null){var x=u.next;u.next=d.next,d.next=x}n.baseQueue=u=d,l.pending=null}if(d=t.baseState,u===null)t.memoizedState=d;else{n=u.next;var T=x=null,L=null,U=n,Q=!1;do{var ie=U.lane&-536870913;if(ie!==U.lane?(Qe&ie)===ie:(gs&ie)===ie){var V=U.revertLane;if(V===0)L!==null&&(L=L.next={lane:0,revertLane:0,gesture:null,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),ie===fo&&(Q=!0);else if((gs&V)===V){U=U.next,V===fo&&(Q=!0);continue}else ie={lane:0,revertLane:U.revertLane,gesture:null,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null},L===null?(T=L=ie,x=d):L=L.next=ie,He.lanes|=V,Qs|=V;ie=U.action,Ba&&s(d,ie),d=U.hasEagerState?U.eagerState:s(d,ie)}else V={lane:ie,revertLane:U.revertLane,gesture:U.gesture,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null},L===null?(T=L=V,x=d):L=L.next=V,He.lanes|=ie,Qs|=ie;U=U.next}while(U!==null&&U!==n);if(L===null?x=d:L.next=T,!ai(d,t.memoizedState)&&(un=!0,Q&&(s=mo,s!==null)))throw s;t.memoizedState=d,t.baseState=x,t.baseQueue=L,l.lastRenderedState=d}return u===null&&(l.lanes=0),[t.memoizedState,l.dispatch]}function ju(t){var n=tn(),s=n.queue;if(s===null)throw Error(o(311));s.lastRenderedReducer=t;var l=s.dispatch,u=s.pending,d=n.memoizedState;if(u!==null){s.pending=null;var x=u=u.next;do d=t(d,x.action),x=x.next;while(x!==u);ai(d,n.memoizedState)||(un=!0),n.memoizedState=d,n.baseQueue===null&&(n.baseState=d),s.lastRenderedState=d}return[d,l]}function Rm(t,n,s){var l=He,u=tn(),d=tt;if(d){if(s===void 0)throw Error(o(407));s=s()}else s=n();var x=!ai((yt||u).memoizedState,s);if(x&&(u.memoizedState=s,un=!0),u=u.queue,Pu(Im.bind(null,l,u,t),[t]),u.getSnapshot!==n||x||cn!==null&&cn.memoizedState.tag&1){if(l.flags|=2048,xo(9,{destroy:void 0},Lm.bind(null,l,u,s,n),null),Et===null)throw Error(o(349));d||(gs&127)!==0||km(l,n,s)}return s}function km(t,n,s){t.flags|=16384,t={getSnapshot:n,value:s},n=He.updateQueue,n===null?(n=Lr(),He.updateQueue=n,n.stores=[t]):(s=n.stores,s===null?n.stores=[t]:s.push(t))}function Lm(t,n,s,l){n.value=s,n.getSnapshot=l,Bm(n)&&jm(t)}function Im(t,n,s){return s(function(){Bm(n)&&jm(t)})}function Bm(t){var n=t.getSnapshot;t=t.value;try{var s=n();return!ai(t,s)}catch{return!0}}function jm(t){var n=_a(t,2);n!==null&&Jn(n,t,2)}function Du(t){var n=$n();if(typeof t=="function"){var s=t;if(t=s(),Ba){wn(!0);try{s()}finally{wn(!1)}}}return n.memoizedState=n.baseState=t,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ys,lastRenderedState:t},n}function Dm(t,n,s,l){return t.baseState=s,Bu(t,yt,typeof l=="function"?l:ys)}function N0(t,n,s,l,u){if(Hr(t))throw Error(o(485));if(t=n.action,t!==null){var d={payload:u,action:t,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(x){d.listeners.push(x)}};H.T!==null?s(!0):d.isTransition=!1,l(d),s=n.pending,s===null?(d.next=n.pending=d,Hm(n,d)):(d.next=s.next,n.pending=s.next=d)}}function Hm(t,n){var s=n.action,l=n.payload,u=t.state;if(n.isTransition){var d=H.T,x={};H.T=x;try{var T=s(u,l),L=H.S;L!==null&&L(x,T),Pm(t,n,T)}catch(U){Hu(t,n,U)}finally{d!==null&&x.types!==null&&(d.types=x.types),H.T=d}}else try{d=s(u,l),Pm(t,n,d)}catch(U){Hu(t,n,U)}}function Pm(t,n,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(l){Um(t,n,l)},function(l){return Hu(t,n,l)}):Um(t,n,s)}function Um(t,n,s){n.status="fulfilled",n.value=s,qm(n),t.state=s,n=t.pending,n!==null&&(s=n.next,s===n?t.pending=null:(s=s.next,n.next=s,Hm(t,s)))}function Hu(t,n,s){var l=t.pending;if(t.pending=null,l!==null){l=l.next;do n.status="rejected",n.reason=s,qm(n),n=n.next;while(n!==l)}t.action=null}function qm(t){t=t.listeners;for(var n=0;n<t.length;n++)(0,t[n])()}function zm(t,n){return n}function $m(t,n){if(tt){var s=Et.formState;if(s!==null){e:{var l=He;if(tt){if(Bt){t:{for(var u=Bt,d=_i;u.nodeType!==8;){if(!d){u=null;break t}if(u=Oi(u.nextSibling),u===null){u=null;break t}}d=u.data,u=d==="F!"||d==="F"?u:null}if(u){Bt=Oi(u.nextSibling),l=u.data==="F!";break e}}zs(l)}l=!1}l&&(n=s[0])}}return s=$n(),s.memoizedState=s.baseState=n,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:zm,lastRenderedState:n},s.queue=l,s=rp.bind(null,He,l),l.dispatch=s,l=Du(!1),d=Vu.bind(null,He,!1,l.queue),l=$n(),u={state:n,dispatch:null,action:t,pending:null},l.queue=u,s=N0.bind(null,He,u,d,s),u.dispatch=s,l.memoizedState=t,[n,s,!1]}function Vm(t){var n=tn();return Ym(n,yt,t)}function Ym(t,n,s){if(n=Bu(t,n,zm)[0],t=Br(ys)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var l=hl(n)}catch(x){throw x===po?wr:x}else l=n;n=tn();var u=n.queue,d=u.dispatch;return s!==n.memoizedState&&(He.flags|=2048,xo(9,{destroy:void 0},R0.bind(null,u,s),null)),[l,d,t]}function R0(t,n){t.action=n}function Fm(t){var n=tn(),s=yt;if(s!==null)return Ym(n,s,t);tn(),n=n.memoizedState,s=tn();var l=s.queue.dispatch;return s.memoizedState=t,[n,l,!1]}function xo(t,n,s,l){return t={tag:t,create:s,deps:l,inst:n,next:null},n=He.updateQueue,n===null&&(n=Lr(),He.updateQueue=n),s=n.lastEffect,s===null?n.lastEffect=t.next=t:(l=s.next,s.next=t,t.next=l,n.lastEffect=t),t}function Km(){return tn().memoizedState}function jr(t,n,s,l){var u=$n();He.flags|=t,u.memoizedState=xo(1|n,{destroy:void 0},s,l===void 0?null:l)}function Dr(t,n,s,l){var u=tn();l=l===void 0?null:l;var d=u.memoizedState.inst;yt!==null&&l!==null&&Cu(l,yt.memoizedState.deps)?u.memoizedState=xo(n,d,s,l):(He.flags|=t,u.memoizedState=xo(1|n,d,s,l))}function Gm(t,n){jr(8390656,8,t,n)}function Pu(t,n){Dr(2048,8,t,n)}function k0(t){He.flags|=4;var n=He.updateQueue;if(n===null)n=Lr(),He.updateQueue=n,n.events=[t];else{var s=n.events;s===null?n.events=[t]:s.push(t)}}function Wm(t){var n=tn().memoizedState;return k0({ref:n,nextImpl:t}),function(){if((at&2)!==0)throw Error(o(440));return n.impl.apply(void 0,arguments)}}function Xm(t,n){return Dr(4,2,t,n)}function Qm(t,n){return Dr(4,4,t,n)}function Jm(t,n){if(typeof n=="function"){t=t();var s=n(t);return function(){typeof s=="function"?s():n(null)}}if(n!=null)return t=t(),n.current=t,function(){n.current=null}}function Zm(t,n,s){s=s!=null?s.concat([t]):null,Dr(4,4,Jm.bind(null,n,t),s)}function Uu(){}function ep(t,n){var s=tn();n=n===void 0?null:n;var l=s.memoizedState;return n!==null&&Cu(n,l[1])?l[0]:(s.memoizedState=[t,n],t)}function tp(t,n){var s=tn();n=n===void 0?null:n;var l=s.memoizedState;if(n!==null&&Cu(n,l[1]))return l[0];if(l=t(),Ba){wn(!0);try{t()}finally{wn(!1)}}return s.memoizedState=[l,n],l}function qu(t,n,s){return s===void 0||(gs&1073741824)!==0&&(Qe&261930)===0?t.memoizedState=n:(t.memoizedState=s,t=nh(),He.lanes|=t,Qs|=t,s)}function np(t,n,s,l){return ai(s,n)?s:go.current!==null?(t=qu(t,s,l),ai(t,n)||(un=!0),t):(gs&42)===0||(gs&1073741824)!==0&&(Qe&261930)===0?(un=!0,t.memoizedState=s):(t=nh(),He.lanes|=t,Qs|=t,n)}function ip(t,n,s,l,u){var d=ee.p;ee.p=d!==0&&8>d?d:8;var x=H.T,T={};H.T=T,Vu(t,!1,n,s);try{var L=u(),U=H.S;if(U!==null&&U(T,L),L!==null&&typeof L=="object"&&typeof L.then=="function"){var Q=M0(L,l);gl(t,n,Q,di(t))}else gl(t,n,l,di(t))}catch(ie){gl(t,n,{then:function(){},status:"rejected",reason:ie},di())}finally{ee.p=d,x!==null&&T.types!==null&&(x.types=T.types),H.T=x}}function L0(){}function zu(t,n,s,l){if(t.tag!==5)throw Error(o(476));var u=sp(t).queue;ip(t,u,n,ae,s===null?L0:function(){return ap(t),s(l)})}function sp(t){var n=t.memoizedState;if(n!==null)return n;n={memoizedState:ae,baseState:ae,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ys,lastRenderedState:ae},next:null};var s={};return n.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ys,lastRenderedState:s},next:null},t.memoizedState=n,t=t.alternate,t!==null&&(t.memoizedState=n),n}function ap(t){var n=sp(t);n.next===null&&(n=t.alternate.memoizedState),gl(t,n.next.queue,{},di())}function $u(){return Mn(Ll)}function op(){return tn().memoizedState}function lp(){return tn().memoizedState}function I0(t){for(var n=t.return;n!==null;){switch(n.tag){case 24:case 3:var s=di();t=Ys(s);var l=Fs(n,t,s);l!==null&&(Jn(l,n,s),dl(l,n,s)),n={cache:bu()},t.payload=n;return}n=n.return}}function B0(t,n,s){var l=di();s={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},Hr(t)?cp(n,s):(s=lu(t,n,s,l),s!==null&&(Jn(s,t,l),up(s,n,l)))}function rp(t,n,s){var l=di();gl(t,n,s,l)}function gl(t,n,s,l){var u={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(Hr(t))cp(n,u);else{var d=t.alternate;if(t.lanes===0&&(d===null||d.lanes===0)&&(d=n.lastRenderedReducer,d!==null))try{var x=n.lastRenderedState,T=d(x,s);if(u.hasEagerState=!0,u.eagerState=T,ai(T,x))return br(t,n,u,0),Et===null&&yr(),!1}catch{}if(s=lu(t,n,u,l),s!==null)return Jn(s,t,l),up(s,n,l),!0}return!1}function Vu(t,n,s,l){if(l={lane:2,revertLane:Ad(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},Hr(t)){if(n)throw Error(o(479))}else n=lu(t,s,l,2),n!==null&&Jn(n,t,2)}function Hr(t){var n=t.alternate;return t===He||n!==null&&n===He}function cp(t,n){yo=Rr=!0;var s=t.pending;s===null?n.next=n:(n.next=s.next,s.next=n),t.pending=n}function up(t,n,s){if((s&4194048)!==0){var l=n.lanes;l&=t.pendingLanes,s|=l,n.lanes=s,os(t,s)}}var yl={readContext:Mn,use:Ir,useCallback:Gt,useContext:Gt,useEffect:Gt,useImperativeHandle:Gt,useLayoutEffect:Gt,useInsertionEffect:Gt,useMemo:Gt,useReducer:Gt,useRef:Gt,useState:Gt,useDebugValue:Gt,useDeferredValue:Gt,useTransition:Gt,useSyncExternalStore:Gt,useId:Gt,useHostTransitionStatus:Gt,useFormState:Gt,useActionState:Gt,useOptimistic:Gt,useMemoCache:Gt,useCacheRefresh:Gt};yl.useEffectEvent=Gt;var dp={readContext:Mn,use:Ir,useCallback:function(t,n){return $n().memoizedState=[t,n===void 0?null:n],t},useContext:Mn,useEffect:Gm,useImperativeHandle:function(t,n,s){s=s!=null?s.concat([t]):null,jr(4194308,4,Jm.bind(null,n,t),s)},useLayoutEffect:function(t,n){return jr(4194308,4,t,n)},useInsertionEffect:function(t,n){jr(4,2,t,n)},useMemo:function(t,n){var s=$n();n=n===void 0?null:n;var l=t();if(Ba){wn(!0);try{t()}finally{wn(!1)}}return s.memoizedState=[l,n],l},useReducer:function(t,n,s){var l=$n();if(s!==void 0){var u=s(n);if(Ba){wn(!0);try{s(n)}finally{wn(!1)}}}else u=n;return l.memoizedState=l.baseState=u,t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:u},l.queue=t,t=t.dispatch=B0.bind(null,He,t),[l.memoizedState,t]},useRef:function(t){var n=$n();return t={current:t},n.memoizedState=t},useState:function(t){t=Du(t);var n=t.queue,s=rp.bind(null,He,n);return n.dispatch=s,[t.memoizedState,s]},useDebugValue:Uu,useDeferredValue:function(t,n){var s=$n();return qu(s,t,n)},useTransition:function(){var t=Du(!1);return t=ip.bind(null,He,t.queue,!0,!1),$n().memoizedState=t,[!1,t]},useSyncExternalStore:function(t,n,s){var l=He,u=$n();if(tt){if(s===void 0)throw Error(o(407));s=s()}else{if(s=n(),Et===null)throw Error(o(349));(Qe&127)!==0||km(l,n,s)}u.memoizedState=s;var d={value:s,getSnapshot:n};return u.queue=d,Gm(Im.bind(null,l,d,t),[t]),l.flags|=2048,xo(9,{destroy:void 0},Lm.bind(null,l,d,s,n),null),s},useId:function(){var t=$n(),n=Et.identifierPrefix;if(tt){var s=ts,l=es;s=(l&~(1<<32-_t(l)-1)).toString(32)+s,n="_"+n+"R_"+s,s=kr++,0<s&&(n+="H"+s.toString(32)),n+="_"}else s=O0++,n="_"+n+"r_"+s.toString(32)+"_";return t.memoizedState=n},useHostTransitionStatus:$u,useFormState:$m,useActionState:$m,useOptimistic:function(t){var n=$n();n.memoizedState=n.baseState=t;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=s,n=Vu.bind(null,He,!0,s),s.dispatch=n,[t,n]},useMemoCache:Iu,useCacheRefresh:function(){return $n().memoizedState=I0.bind(null,He)},useEffectEvent:function(t){var n=$n(),s={impl:t};return n.memoizedState=s,function(){if((at&2)!==0)throw Error(o(440));return s.impl.apply(void 0,arguments)}}},Yu={readContext:Mn,use:Ir,useCallback:ep,useContext:Mn,useEffect:Pu,useImperativeHandle:Zm,useInsertionEffect:Xm,useLayoutEffect:Qm,useMemo:tp,useReducer:Br,useRef:Km,useState:function(){return Br(ys)},useDebugValue:Uu,useDeferredValue:function(t,n){var s=tn();return np(s,yt.memoizedState,t,n)},useTransition:function(){var t=Br(ys)[0],n=tn().memoizedState;return[typeof t=="boolean"?t:hl(t),n]},useSyncExternalStore:Rm,useId:op,useHostTransitionStatus:$u,useFormState:Vm,useActionState:Vm,useOptimistic:function(t,n){var s=tn();return Dm(s,yt,t,n)},useMemoCache:Iu,useCacheRefresh:lp};Yu.useEffectEvent=Wm;var fp={readContext:Mn,use:Ir,useCallback:ep,useContext:Mn,useEffect:Pu,useImperativeHandle:Zm,useInsertionEffect:Xm,useLayoutEffect:Qm,useMemo:tp,useReducer:ju,useRef:Km,useState:function(){return ju(ys)},useDebugValue:Uu,useDeferredValue:function(t,n){var s=tn();return yt===null?qu(s,t,n):np(s,yt.memoizedState,t,n)},useTransition:function(){var t=ju(ys)[0],n=tn().memoizedState;return[typeof t=="boolean"?t:hl(t),n]},useSyncExternalStore:Rm,useId:op,useHostTransitionStatus:$u,useFormState:Fm,useActionState:Fm,useOptimistic:function(t,n){var s=tn();return yt!==null?Dm(s,yt,t,n):(s.baseState=t,[t,s.queue.dispatch])},useMemoCache:Iu,useCacheRefresh:lp};fp.useEffectEvent=Wm;function Fu(t,n,s,l){n=t.memoizedState,s=s(l,n),s=s==null?n:v({},n,s),t.memoizedState=s,t.lanes===0&&(t.updateQueue.baseState=s)}var Ku={enqueueSetState:function(t,n,s){t=t._reactInternals;var l=di(),u=Ys(l);u.payload=n,s!=null&&(u.callback=s),n=Fs(t,u,l),n!==null&&(Jn(n,t,l),dl(n,t,l))},enqueueReplaceState:function(t,n,s){t=t._reactInternals;var l=di(),u=Ys(l);u.tag=1,u.payload=n,s!=null&&(u.callback=s),n=Fs(t,u,l),n!==null&&(Jn(n,t,l),dl(n,t,l))},enqueueForceUpdate:function(t,n){t=t._reactInternals;var s=di(),l=Ys(s);l.tag=2,n!=null&&(l.callback=n),n=Fs(t,l,s),n!==null&&(Jn(n,t,s),dl(n,t,s))}};function mp(t,n,s,l,u,d,x){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,d,x):n.prototype&&n.prototype.isPureReactComponent?!il(s,l)||!il(u,d):!0}function pp(t,n,s,l){t=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(s,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(s,l),n.state!==t&&Ku.enqueueReplaceState(n,n.state,null)}function ja(t,n){var s=n;if("ref"in n){s={};for(var l in n)l!=="ref"&&(s[l]=n[l])}if(t=t.defaultProps){s===n&&(s=v({},s));for(var u in t)s[u]===void 0&&(s[u]=t[u])}return s}function hp(t){gr(t)}function gp(t){console.error(t)}function yp(t){gr(t)}function Pr(t,n){try{var s=t.onUncaughtError;s(n.value,{componentStack:n.stack})}catch(l){setTimeout(function(){throw l})}}function bp(t,n,s){try{var l=t.onCaughtError;l(s.value,{componentStack:s.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function Gu(t,n,s){return s=Ys(s),s.tag=3,s.payload={element:null},s.callback=function(){Pr(t,n)},s}function xp(t){return t=Ys(t),t.tag=3,t}function vp(t,n,s,l){var u=s.type.getDerivedStateFromError;if(typeof u=="function"){var d=l.value;t.payload=function(){return u(d)},t.callback=function(){bp(n,s,l)}}var x=s.stateNode;x!==null&&typeof x.componentDidCatch=="function"&&(t.callback=function(){bp(n,s,l),typeof u!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var T=l.stack;this.componentDidCatch(l.value,{componentStack:T!==null?T:""})})}function j0(t,n,s,l,u){if(s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(n=s.alternate,n!==null&&uo(n,s,u,!0),s=li.current,s!==null){switch(s.tag){case 31:case 13:return Mi===null?Qr():s.alternate===null&&Wt===0&&(Wt=3),s.flags&=-257,s.flags|=65536,s.lanes=u,l===_r?s.flags|=16384:(n=s.updateQueue,n===null?s.updateQueue=new Set([l]):n.add(l),xd(t,l,u)),!1;case 22:return s.flags|=65536,l===_r?s.flags|=16384:(n=s.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([l])},s.updateQueue=n):(s=n.retryQueue,s===null?n.retryQueue=new Set([l]):s.add(l)),xd(t,l,u)),!1}throw Error(o(435,s.tag))}return xd(t,l,u),Qr(),!1}if(tt)return n=li.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=u,l!==mu&&(t=Error(o(422),{cause:l}),ol(Ti(t,s)))):(l!==mu&&(n=Error(o(423),{cause:l}),ol(Ti(n,s))),t=t.current.alternate,t.flags|=65536,u&=-u,t.lanes|=u,l=Ti(l,s),u=Gu(t.stateNode,l,u),Eu(t,u),Wt!==4&&(Wt=2)),!1;var d=Error(o(520),{cause:l});if(d=Ti(d,s),wl===null?wl=[d]:wl.push(d),Wt!==4&&(Wt=2),n===null)return!0;l=Ti(l,s),s=n;do{switch(s.tag){case 3:return s.flags|=65536,t=u&-u,s.lanes|=t,t=Gu(s.stateNode,l,t),Eu(s,t),!1;case 1:if(n=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Js===null||!Js.has(d))))return s.flags|=65536,u&=-u,s.lanes|=u,u=xp(u),vp(u,t,s,l),Eu(s,u),!1}s=s.return}while(s!==null);return!1}var Wu=Error(o(461)),un=!1;function On(t,n,s,l){n.child=t===null?Em(n,null,s,l):Ia(n,t.child,s,l)}function Sp(t,n,s,l,u){s=s.render;var d=n.ref;if("ref"in l){var x={};for(var T in l)T!=="ref"&&(x[T]=l[T])}else x=l;return Na(n),l=Nu(t,n,s,x,d,u),T=Ru(),t!==null&&!un?(ku(t,n,u),bs(t,n,u)):(tt&&T&&du(n),n.flags|=1,On(t,n,l,u),n.child)}function Ap(t,n,s,l,u){if(t===null){var d=s.type;return typeof d=="function"&&!ru(d)&&d.defaultProps===void 0&&s.compare===null?(n.tag=15,n.type=d,Tp(t,n,d,l,u)):(t=vr(s.type,null,l,n,n.mode,u),t.ref=n.ref,t.return=n,n.child=t)}if(d=t.child,!id(t,u)){var x=d.memoizedProps;if(s=s.compare,s=s!==null?s:il,s(x,l)&&t.ref===n.ref)return bs(t,n,u)}return n.flags|=1,t=fs(d,l),t.ref=n.ref,t.return=n,n.child=t}function Tp(t,n,s,l,u){if(t!==null){var d=t.memoizedProps;if(il(d,l)&&t.ref===n.ref)if(un=!1,n.pendingProps=l=d,id(t,u))(t.flags&131072)!==0&&(un=!0);else return n.lanes=t.lanes,bs(t,n,u)}return Xu(t,n,s,l,u)}function Ep(t,n,s,l){var u=l.children,d=t!==null?t.memoizedState:null;if(t===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((n.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,t!==null){for(l=n.child=t.child,u=0;l!==null;)u=u|l.lanes|l.childLanes,l=l.sibling;l=u&~d}else l=0,n.child=null;return wp(t,n,d,s,l)}if((s&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},t!==null&&Er(n,d!==null?d.cachePool:null),d!==null?Mm(n,d):_u(),Om(n);else return l=n.lanes=536870912,wp(t,n,d!==null?d.baseLanes|s:s,s,l)}else d!==null?(Er(n,d.cachePool),Mm(n,d),Gs(),n.memoizedState=null):(t!==null&&Er(n,null),_u(),Gs());return On(t,n,u,s),n.child}function bl(t,n){return t!==null&&t.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function wp(t,n,s,l,u){var d=vu();return d=d===null?null:{parent:rn._currentValue,pool:d},n.memoizedState={baseLanes:s,cachePool:d},t!==null&&Er(n,null),_u(),Om(n),t!==null&&uo(t,n,l,!0),n.childLanes=u,null}function Ur(t,n){return n=zr({mode:n.mode,children:n.children},t.mode),n.ref=t.ref,t.child=n,n.return=t,n}function _p(t,n,s){return Ia(n,t.child,null,s),t=Ur(n,n.pendingProps),t.flags|=2,ri(n),n.memoizedState=null,t}function D0(t,n,s){var l=n.pendingProps,u=(n.flags&128)!==0;if(n.flags&=-129,t===null){if(tt){if(l.mode==="hidden")return t=Ur(n,l),n.lanes=536870912,bl(null,t);if(Ou(n),(t=Bt)?(t=Hh(t,_i),t=t!==null&&t.data==="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:Us!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},s=cm(t),s.return=n,n.child=s,_n=n,Bt=null)):t=null,t===null)throw zs(n);return n.lanes=536870912,null}return Ur(n,l)}var d=t.memoizedState;if(d!==null){var x=d.dehydrated;if(Ou(n),u)if(n.flags&256)n.flags&=-257,n=_p(t,n,s);else if(n.memoizedState!==null)n.child=t.child,n.flags|=128,n=null;else throw Error(o(558));else if(un||uo(t,n,s,!1),u=(s&t.childLanes)!==0,un||u){if(l=Et,l!==null&&(x=Fi(l,s),x!==0&&x!==d.retryLane))throw d.retryLane=x,_a(t,x),Jn(l,t,x),Wu;Qr(),n=_p(t,n,s)}else t=d.treeContext,Bt=Oi(x.nextSibling),_n=n,tt=!0,qs=null,_i=!1,t!==null&&fm(n,t),n=Ur(n,l),n.flags|=4096;return n}return t=fs(t.child,{mode:l.mode,children:l.children}),t.ref=n.ref,n.child=t,t.return=n,t}function qr(t,n){var s=n.ref;if(s===null)t!==null&&t.ref!==null&&(n.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(o(284));(t===null||t.ref!==s)&&(n.flags|=4194816)}}function Xu(t,n,s,l,u){return Na(n),s=Nu(t,n,s,l,void 0,u),l=Ru(),t!==null&&!un?(ku(t,n,u),bs(t,n,u)):(tt&&l&&du(n),n.flags|=1,On(t,n,s,u),n.child)}function Mp(t,n,s,l,u,d){return Na(n),n.updateQueue=null,s=Nm(n,l,s,u),Cm(t),l=Ru(),t!==null&&!un?(ku(t,n,d),bs(t,n,d)):(tt&&l&&du(n),n.flags|=1,On(t,n,s,d),n.child)}function Op(t,n,s,l,u){if(Na(n),n.stateNode===null){var d=oo,x=s.contextType;typeof x=="object"&&x!==null&&(d=Mn(x)),d=new s(l,d),n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Ku,n.stateNode=d,d._reactInternals=n,d=n.stateNode,d.props=l,d.state=n.memoizedState,d.refs={},Au(n),x=s.contextType,d.context=typeof x=="object"&&x!==null?Mn(x):oo,d.state=n.memoizedState,x=s.getDerivedStateFromProps,typeof x=="function"&&(Fu(n,s,x,l),d.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(x=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),x!==d.state&&Ku.enqueueReplaceState(d,d.state,null),ml(n,l,d,u),fl(),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308),l=!0}else if(t===null){d=n.stateNode;var T=n.memoizedProps,L=ja(s,T);d.props=L;var U=d.context,Q=s.contextType;x=oo,typeof Q=="object"&&Q!==null&&(x=Mn(Q));var ie=s.getDerivedStateFromProps;Q=typeof ie=="function"||typeof d.getSnapshotBeforeUpdate=="function",T=n.pendingProps!==T,Q||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(T||U!==x)&&pp(n,d,l,x),Vs=!1;var V=n.memoizedState;d.state=V,ml(n,l,d,u),fl(),U=n.memoizedState,T||V!==U||Vs?(typeof ie=="function"&&(Fu(n,s,ie,l),U=n.memoizedState),(L=Vs||mp(n,s,L,l,V,U,x))?(Q||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(n.flags|=4194308)):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=U),d.props=l,d.state=U,d.context=x,l=L):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{d=n.stateNode,Tu(t,n),x=n.memoizedProps,Q=ja(s,x),d.props=Q,ie=n.pendingProps,V=d.context,U=s.contextType,L=oo,typeof U=="object"&&U!==null&&(L=Mn(U)),T=s.getDerivedStateFromProps,(U=typeof T=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(x!==ie||V!==L)&&pp(n,d,l,L),Vs=!1,V=n.memoizedState,d.state=V,ml(n,l,d,u),fl();var W=n.memoizedState;x!==ie||V!==W||Vs||t!==null&&t.dependencies!==null&&Ar(t.dependencies)?(typeof T=="function"&&(Fu(n,s,T,l),W=n.memoizedState),(Q=Vs||mp(n,s,Q,l,V,W,L)||t!==null&&t.dependencies!==null&&Ar(t.dependencies))?(U||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(l,W,L),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(l,W,L)),typeof d.componentDidUpdate=="function"&&(n.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof d.componentDidUpdate!="function"||x===t.memoizedProps&&V===t.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&V===t.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=W),d.props=l,d.state=W,d.context=L,l=Q):(typeof d.componentDidUpdate!="function"||x===t.memoizedProps&&V===t.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||x===t.memoizedProps&&V===t.memoizedState||(n.flags|=1024),l=!1)}return d=l,qr(t,n),l=(n.flags&128)!==0,d||l?(d=n.stateNode,s=l&&typeof s.getDerivedStateFromError!="function"?null:d.render(),n.flags|=1,t!==null&&l?(n.child=Ia(n,t.child,null,u),n.child=Ia(n,null,s,u)):On(t,n,s,u),n.memoizedState=d.state,t=n.child):t=bs(t,n,u),t}function Cp(t,n,s,l){return Oa(),n.flags|=256,On(t,n,s,l),n.child}var Qu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ju(t){return{baseLanes:t,cachePool:bm()}}function Zu(t,n,s){return t=t!==null?t.childLanes&~s:0,n&&(t|=ui),t}function Np(t,n,s){var l=n.pendingProps,u=!1,d=(n.flags&128)!==0,x;if((x=d)||(x=t!==null&&t.memoizedState===null?!1:(en.current&2)!==0),x&&(u=!0,n.flags&=-129),x=(n.flags&32)!==0,n.flags&=-33,t===null){if(tt){if(u?Ks(n):Gs(),(t=Bt)?(t=Hh(t,_i),t=t!==null&&t.data!=="&"?t:null,t!==null&&(n.memoizedState={dehydrated:t,treeContext:Us!==null?{id:es,overflow:ts}:null,retryLane:536870912,hydrationErrors:null},s=cm(t),s.return=n,n.child=s,_n=n,Bt=null)):t=null,t===null)throw zs(n);return Bd(t)?n.lanes=32:n.lanes=536870912,null}var T=l.children;return l=l.fallback,u?(Gs(),u=n.mode,T=zr({mode:"hidden",children:T},u),l=Ma(l,u,s,null),T.return=n,l.return=n,T.sibling=l,n.child=T,l=n.child,l.memoizedState=Ju(s),l.childLanes=Zu(t,x,s),n.memoizedState=Qu,bl(null,l)):(Ks(n),ed(n,T))}var L=t.memoizedState;if(L!==null&&(T=L.dehydrated,T!==null)){if(d)n.flags&256?(Ks(n),n.flags&=-257,n=td(t,n,s)):n.memoizedState!==null?(Gs(),n.child=t.child,n.flags|=128,n=null):(Gs(),T=l.fallback,u=n.mode,l=zr({mode:"visible",children:l.children},u),T=Ma(T,u,s,null),T.flags|=2,l.return=n,T.return=n,l.sibling=T,n.child=l,Ia(n,t.child,null,s),l=n.child,l.memoizedState=Ju(s),l.childLanes=Zu(t,x,s),n.memoizedState=Qu,n=bl(null,l));else if(Ks(n),Bd(T)){if(x=T.nextSibling&&T.nextSibling.dataset,x)var U=x.dgst;x=U,l=Error(o(419)),l.stack="",l.digest=x,ol({value:l,source:null,stack:null}),n=td(t,n,s)}else if(un||uo(t,n,s,!1),x=(s&t.childLanes)!==0,un||x){if(x=Et,x!==null&&(l=Fi(x,s),l!==0&&l!==L.retryLane))throw L.retryLane=l,_a(t,l),Jn(x,t,l),Wu;Id(T)||Qr(),n=td(t,n,s)}else Id(T)?(n.flags|=192,n.child=t.child,n=null):(t=L.treeContext,Bt=Oi(T.nextSibling),_n=n,tt=!0,qs=null,_i=!1,t!==null&&fm(n,t),n=ed(n,l.children),n.flags|=4096);return n}return u?(Gs(),T=l.fallback,u=n.mode,L=t.child,U=L.sibling,l=fs(L,{mode:"hidden",children:l.children}),l.subtreeFlags=L.subtreeFlags&65011712,U!==null?T=fs(U,T):(T=Ma(T,u,s,null),T.flags|=2),T.return=n,l.return=n,l.sibling=T,n.child=l,bl(null,l),l=n.child,T=t.child.memoizedState,T===null?T=Ju(s):(u=T.cachePool,u!==null?(L=rn._currentValue,u=u.parent!==L?{parent:L,pool:L}:u):u=bm(),T={baseLanes:T.baseLanes|s,cachePool:u}),l.memoizedState=T,l.childLanes=Zu(t,x,s),n.memoizedState=Qu,bl(t.child,l)):(Ks(n),s=t.child,t=s.sibling,s=fs(s,{mode:"visible",children:l.children}),s.return=n,s.sibling=null,t!==null&&(x=n.deletions,x===null?(n.deletions=[t],n.flags|=16):x.push(t)),n.child=s,n.memoizedState=null,s)}function ed(t,n){return n=zr({mode:"visible",children:n},t.mode),n.return=t,t.child=n}function zr(t,n){return t=oi(22,t,null,n),t.lanes=0,t}function td(t,n,s){return Ia(n,t.child,null,s),t=ed(n,n.pendingProps.children),t.flags|=2,n.memoizedState=null,t}function Rp(t,n,s){t.lanes|=n;var l=t.alternate;l!==null&&(l.lanes|=n),gu(t.return,n,s)}function nd(t,n,s,l,u,d){var x=t.memoizedState;x===null?t.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:s,tailMode:u,treeForkCount:d}:(x.isBackwards=n,x.rendering=null,x.renderingStartTime=0,x.last=l,x.tail=s,x.tailMode=u,x.treeForkCount=d)}function kp(t,n,s){var l=n.pendingProps,u=l.revealOrder,d=l.tail;l=l.children;var x=en.current,T=(x&2)!==0;if(T?(x=x&1|2,n.flags|=128):x&=1,J(en,x),On(t,n,l,s),l=tt?al:0,!T&&t!==null&&(t.flags&128)!==0)e:for(t=n.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Rp(t,s,n);else if(t.tag===19)Rp(t,s,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break e;for(;t.sibling===null;){if(t.return===null||t.return===n)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}switch(u){case"forwards":for(s=n.child,u=null;s!==null;)t=s.alternate,t!==null&&Nr(t)===null&&(u=s),s=s.sibling;s=u,s===null?(u=n.child,n.child=null):(u=s.sibling,s.sibling=null),nd(n,!1,u,s,d,l);break;case"backwards":case"unstable_legacy-backwards":for(s=null,u=n.child,n.child=null;u!==null;){if(t=u.alternate,t!==null&&Nr(t)===null){n.child=u;break}t=u.sibling,u.sibling=s,s=u,u=t}nd(n,!0,s,null,d,l);break;case"together":nd(n,!1,null,null,void 0,l);break;default:n.memoizedState=null}return n.child}function bs(t,n,s){if(t!==null&&(n.dependencies=t.dependencies),Qs|=n.lanes,(s&n.childLanes)===0)if(t!==null){if(uo(t,n,s,!1),(s&n.childLanes)===0)return null}else return null;if(t!==null&&n.child!==t.child)throw Error(o(153));if(n.child!==null){for(t=n.child,s=fs(t,t.pendingProps),n.child=s,s.return=n;t.sibling!==null;)t=t.sibling,s=s.sibling=fs(t,t.pendingProps),s.return=n;s.sibling=null}return n.child}function id(t,n){return(t.lanes&n)!==0?!0:(t=t.dependencies,!!(t!==null&&Ar(t)))}function H0(t,n,s){switch(n.tag){case 3:ht(n,n.stateNode.containerInfo),$s(n,rn,t.memoizedState.cache),Oa();break;case 27:case 5:kt(n);break;case 4:ht(n,n.stateNode.containerInfo);break;case 10:$s(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Ou(n),null;break;case 13:var l=n.memoizedState;if(l!==null)return l.dehydrated!==null?(Ks(n),n.flags|=128,null):(s&n.child.childLanes)!==0?Np(t,n,s):(Ks(n),t=bs(t,n,s),t!==null?t.sibling:null);Ks(n);break;case 19:var u=(t.flags&128)!==0;if(l=(s&n.childLanes)!==0,l||(uo(t,n,s,!1),l=(s&n.childLanes)!==0),u){if(l)return kp(t,n,s);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),J(en,en.current),l)break;return null;case 22:return n.lanes=0,Ep(t,n,s,n.pendingProps);case 24:$s(n,rn,t.memoizedState.cache)}return bs(t,n,s)}function Lp(t,n,s){if(t!==null)if(t.memoizedProps!==n.pendingProps)un=!0;else{if(!id(t,s)&&(n.flags&128)===0)return un=!1,H0(t,n,s);un=(t.flags&131072)!==0}else un=!1,tt&&(n.flags&1048576)!==0&&dm(n,al,n.index);switch(n.lanes=0,n.tag){case 16:e:{var l=n.pendingProps;if(t=ka(n.elementType),n.type=t,typeof t=="function")ru(t)?(l=ja(t,l),n.tag=1,n=Op(null,n,t,l,s)):(n.tag=0,n=Xu(null,n,t,l,s));else{if(t!=null){var u=t.$$typeof;if(u===N){n.tag=11,n=Sp(null,n,t,l,s);break e}else if(u===O){n.tag=14,n=Ap(null,n,t,l,s);break e}}throw n=be(t)||t,Error(o(306,n,""))}}return n;case 0:return Xu(t,n,n.type,n.pendingProps,s);case 1:return l=n.type,u=ja(l,n.pendingProps),Op(t,n,l,u,s);case 3:e:{if(ht(n,n.stateNode.containerInfo),t===null)throw Error(o(387));l=n.pendingProps;var d=n.memoizedState;u=d.element,Tu(t,n),ml(n,l,null,s);var x=n.memoizedState;if(l=x.cache,$s(n,rn,l),l!==d.cache&&yu(n,[rn],s,!0),fl(),l=x.element,d.isDehydrated)if(d={element:l,isDehydrated:!1,cache:x.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=Cp(t,n,l,s);break e}else if(l!==u){u=Ti(Error(o(424)),n),ol(u),n=Cp(t,n,l,s);break e}else for(t=n.stateNode.containerInfo,t.nodeType===9?t=t.body:t=t.nodeName==="HTML"?t.ownerDocument.body:t,Bt=Oi(t.firstChild),_n=n,tt=!0,qs=null,_i=!0,s=Em(n,null,l,s),n.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(Oa(),l===u){n=bs(t,n,s);break e}On(t,n,l,s)}n=n.child}return n;case 26:return qr(t,n),t===null?(s=Vh(n.type,null,n.pendingProps,null))?n.memoizedState=s:tt||(s=n.type,t=n.pendingProps,l=sc(Re.current).createElement(s),l[F]=n,l[te]=t,Cn(l,s,t),Nt(l),n.stateNode=l):n.memoizedState=Vh(n.type,t.memoizedProps,n.pendingProps,t.memoizedState),null;case 27:return kt(n),t===null&&tt&&(l=n.stateNode=qh(n.type,n.pendingProps,Re.current),_n=n,_i=!0,u=Bt,na(n.type)?(jd=u,Bt=Oi(l.firstChild)):Bt=u),On(t,n,n.pendingProps.children,s),qr(t,n),t===null&&(n.flags|=4194304),n.child;case 5:return t===null&&tt&&((u=l=Bt)&&(l=pb(l,n.type,n.pendingProps,_i),l!==null?(n.stateNode=l,_n=n,Bt=Oi(l.firstChild),_i=!1,u=!0):u=!1),u||zs(n)),kt(n),u=n.type,d=n.pendingProps,x=t!==null?t.memoizedProps:null,l=d.children,Rd(u,d)?l=null:x!==null&&Rd(u,x)&&(n.flags|=32),n.memoizedState!==null&&(u=Nu(t,n,C0,null,null,s),Ll._currentValue=u),qr(t,n),On(t,n,l,s),n.child;case 6:return t===null&&tt&&((t=s=Bt)&&(s=hb(s,n.pendingProps,_i),s!==null?(n.stateNode=s,_n=n,Bt=null,t=!0):t=!1),t||zs(n)),null;case 13:return Np(t,n,s);case 4:return ht(n,n.stateNode.containerInfo),l=n.pendingProps,t===null?n.child=Ia(n,null,l,s):On(t,n,l,s),n.child;case 11:return Sp(t,n,n.type,n.pendingProps,s);case 7:return On(t,n,n.pendingProps,s),n.child;case 8:return On(t,n,n.pendingProps.children,s),n.child;case 12:return On(t,n,n.pendingProps.children,s),n.child;case 10:return l=n.pendingProps,$s(n,n.type,l.value),On(t,n,l.children,s),n.child;case 9:return u=n.type._context,l=n.pendingProps.children,Na(n),u=Mn(u),l=l(u),n.flags|=1,On(t,n,l,s),n.child;case 14:return Ap(t,n,n.type,n.pendingProps,s);case 15:return Tp(t,n,n.type,n.pendingProps,s);case 19:return kp(t,n,s);case 31:return D0(t,n,s);case 22:return Ep(t,n,s,n.pendingProps);case 24:return Na(n),l=Mn(rn),t===null?(u=vu(),u===null&&(u=Et,d=bu(),u.pooledCache=d,d.refCount++,d!==null&&(u.pooledCacheLanes|=s),u=d),n.memoizedState={parent:l,cache:u},Au(n),$s(n,rn,u)):((t.lanes&s)!==0&&(Tu(t,n),ml(n,null,null,s),fl()),u=t.memoizedState,d=n.memoizedState,u.parent!==l?(u={parent:l,cache:l},n.memoizedState=u,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=u),$s(n,rn,l)):(l=d.cache,$s(n,rn,l),l!==u.cache&&yu(n,[rn],s,!0))),On(t,n,n.pendingProps.children,s),n.child;case 29:throw n.pendingProps}throw Error(o(156,n.tag))}function xs(t){t.flags|=4}function sd(t,n,s,l,u){if((n=(t.mode&32)!==0)&&(n=!1),n){if(t.flags|=16777216,(u&335544128)===u)if(t.stateNode.complete)t.flags|=8192;else if(oh())t.flags|=8192;else throw La=_r,Su}else t.flags&=-16777217}function Ip(t,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)t.flags&=-16777217;else if(t.flags|=16777216,!Wh(n))if(oh())t.flags|=8192;else throw La=_r,Su}function $r(t,n){n!==null&&(t.flags|=4),t.flags&16384&&(n=t.tag!==22?Li():536870912,t.lanes|=n,To|=n)}function xl(t,n){if(!tt)switch(t.tailMode){case"hidden":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t.tail=null:s.sibling=null;break;case"collapsed":s=t.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?n||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function jt(t){var n=t.alternate!==null&&t.alternate.child===t.child,s=0,l=0;if(n)for(var u=t.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags&65011712,l|=u.flags&65011712,u.return=t,u=u.sibling;else for(u=t.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=t,u=u.sibling;return t.subtreeFlags|=l,t.childLanes=s,n}function P0(t,n,s){var l=n.pendingProps;switch(fu(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return jt(n),null;case 1:return jt(n),null;case 3:return s=n.stateNode,l=null,t!==null&&(l=t.memoizedState.cache),n.memoizedState.cache!==l&&(n.flags|=2048),hs(rn),$e(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(co(n)?xs(n):t===null||t.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,pu())),jt(n),null;case 26:var u=n.type,d=n.memoizedState;return t===null?(xs(n),d!==null?(jt(n),Ip(n,d)):(jt(n),sd(n,u,null,l,s))):d?d!==t.memoizedState?(xs(n),jt(n),Ip(n,d)):(jt(n),n.flags&=-16777217):(t=t.memoizedProps,t!==l&&xs(n),jt(n),sd(n,u,t,l,s)),null;case 27:if(vn(n),s=Re.current,u=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==l&&xs(n);else{if(!l){if(n.stateNode===null)throw Error(o(166));return jt(n),null}t=me.current,co(n)?mm(n):(t=qh(u,l,s),n.stateNode=t,xs(n))}return jt(n),null;case 5:if(vn(n),u=n.type,t!==null&&n.stateNode!=null)t.memoizedProps!==l&&xs(n);else{if(!l){if(n.stateNode===null)throw Error(o(166));return jt(n),null}if(d=me.current,co(n))mm(n);else{var x=sc(Re.current);switch(d){case 1:d=x.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:d=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":d=x.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":d=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":d=x.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof l.is=="string"?x.createElement("select",{is:l.is}):x.createElement("select"),l.multiple?d.multiple=!0:l.size&&(d.size=l.size);break;default:d=typeof l.is=="string"?x.createElement(u,{is:l.is}):x.createElement(u)}}d[F]=n,d[te]=l;e:for(x=n.child;x!==null;){if(x.tag===5||x.tag===6)d.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===n)break e;for(;x.sibling===null;){if(x.return===null||x.return===n)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}n.stateNode=d;e:switch(Cn(d,u,l),u){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&xs(n)}}return jt(n),sd(n,n.type,t===null?null:t.memoizedProps,n.pendingProps,s),null;case 6:if(t&&n.stateNode!=null)t.memoizedProps!==l&&xs(n);else{if(typeof l!="string"&&n.stateNode===null)throw Error(o(166));if(t=Re.current,co(n)){if(t=n.stateNode,s=n.memoizedProps,l=null,u=_n,u!==null)switch(u.tag){case 27:case 5:l=u.memoizedProps}t[F]=n,t=!!(t.nodeValue===s||l!==null&&l.suppressHydrationWarning===!0||Nh(t.nodeValue,s)),t||zs(n,!0)}else t=sc(t).createTextNode(l),t[F]=n,n.stateNode=t}return jt(n),null;case 31:if(s=n.memoizedState,t===null||t.memoizedState!==null){if(l=co(n),s!==null){if(t===null){if(!l)throw Error(o(318));if(t=n.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(o(557));t[F]=n}else Oa(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;jt(n),t=!1}else s=pu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=s),t=!0;if(!t)return n.flags&256?(ri(n),n):(ri(n),null);if((n.flags&128)!==0)throw Error(o(558))}return jt(n),null;case 13:if(l=n.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(u=co(n),l!==null&&l.dehydrated!==null){if(t===null){if(!u)throw Error(o(318));if(u=n.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));u[F]=n}else Oa(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;jt(n),u=!1}else u=pu(),t!==null&&t.memoizedState!==null&&(t.memoizedState.hydrationErrors=u),u=!0;if(!u)return n.flags&256?(ri(n),n):(ri(n),null)}return ri(n),(n.flags&128)!==0?(n.lanes=s,n):(s=l!==null,t=t!==null&&t.memoizedState!==null,s&&(l=n.child,u=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(u=l.alternate.memoizedState.cachePool.pool),d=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(d=l.memoizedState.cachePool.pool),d!==u&&(l.flags|=2048)),s!==t&&s&&(n.child.flags|=8192),$r(n,n.updateQueue),jt(n),null);case 4:return $e(),t===null&&_d(n.stateNode.containerInfo),jt(n),null;case 10:return hs(n.type),jt(n),null;case 19:if($(en),l=n.memoizedState,l===null)return jt(n),null;if(u=(n.flags&128)!==0,d=l.rendering,d===null)if(u)xl(l,!1);else{if(Wt!==0||t!==null&&(t.flags&128)!==0)for(t=n.child;t!==null;){if(d=Nr(t),d!==null){for(n.flags|=128,xl(l,!1),t=d.updateQueue,n.updateQueue=t,$r(n,t),n.subtreeFlags=0,t=s,s=n.child;s!==null;)rm(s,t),s=s.sibling;return J(en,en.current&1|2),tt&&ms(n,l.treeForkCount),n.child}t=t.sibling}l.tail!==null&&Ve()>Gr&&(n.flags|=128,u=!0,xl(l,!1),n.lanes=4194304)}else{if(!u)if(t=Nr(d),t!==null){if(n.flags|=128,u=!0,t=t.updateQueue,n.updateQueue=t,$r(n,t),xl(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!tt)return jt(n),null}else 2*Ve()-l.renderingStartTime>Gr&&s!==536870912&&(n.flags|=128,u=!0,xl(l,!1),n.lanes=4194304);l.isBackwards?(d.sibling=n.child,n.child=d):(t=l.last,t!==null?t.sibling=d:n.child=d,l.last=d)}return l.tail!==null?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=Ve(),t.sibling=null,s=en.current,J(en,u?s&1|2:s&1),tt&&ms(n,l.treeForkCount),t):(jt(n),null);case 22:case 23:return ri(n),Mu(),l=n.memoizedState!==null,t!==null?t.memoizedState!==null!==l&&(n.flags|=8192):l&&(n.flags|=8192),l?(s&536870912)!==0&&(n.flags&128)===0&&(jt(n),n.subtreeFlags&6&&(n.flags|=8192)):jt(n),s=n.updateQueue,s!==null&&$r(n,s.retryQueue),s=null,t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),l=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),l!==s&&(n.flags|=2048),t!==null&&$(Ra),null;case 24:return s=null,t!==null&&(s=t.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),hs(rn),jt(n),null;case 25:return null;case 30:return null}throw Error(o(156,n.tag))}function U0(t,n){switch(fu(n),n.tag){case 1:return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 3:return hs(rn),$e(),t=n.flags,(t&65536)!==0&&(t&128)===0?(n.flags=t&-65537|128,n):null;case 26:case 27:case 5:return vn(n),null;case 31:if(n.memoizedState!==null){if(ri(n),n.alternate===null)throw Error(o(340));Oa()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 13:if(ri(n),t=n.memoizedState,t!==null&&t.dehydrated!==null){if(n.alternate===null)throw Error(o(340));Oa()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 19:return $(en),null;case 4:return $e(),null;case 10:return hs(n.type),null;case 22:case 23:return ri(n),Mu(),t!==null&&$(Ra),t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 24:return hs(rn),null;case 25:return null;default:return null}}function Bp(t,n){switch(fu(n),n.tag){case 3:hs(rn),$e();break;case 26:case 27:case 5:vn(n);break;case 4:$e();break;case 31:n.memoizedState!==null&&ri(n);break;case 13:ri(n);break;case 19:$(en);break;case 10:hs(n.type);break;case 22:case 23:ri(n),Mu(),t!==null&&$(Ra);break;case 24:hs(rn)}}function vl(t,n){try{var s=n.updateQueue,l=s!==null?s.lastEffect:null;if(l!==null){var u=l.next;s=u;do{if((s.tag&t)===t){l=void 0;var d=s.create,x=s.inst;l=d(),x.destroy=l}s=s.next}while(s!==u)}}catch(T){pt(n,n.return,T)}}function Ws(t,n,s){try{var l=n.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var d=u.next;l=d;do{if((l.tag&t)===t){var x=l.inst,T=x.destroy;if(T!==void 0){x.destroy=void 0,u=n;var L=s,U=T;try{U()}catch(Q){pt(u,L,Q)}}}l=l.next}while(l!==d)}}catch(Q){pt(n,n.return,Q)}}function jp(t){var n=t.updateQueue;if(n!==null){var s=t.stateNode;try{_m(n,s)}catch(l){pt(t,t.return,l)}}}function Dp(t,n,s){s.props=ja(t.type,t.memoizedProps),s.state=t.memoizedState;try{s.componentWillUnmount()}catch(l){pt(t,n,l)}}function Sl(t,n){try{var s=t.ref;if(s!==null){switch(t.tag){case 26:case 27:case 5:var l=t.stateNode;break;case 30:l=t.stateNode;break;default:l=t.stateNode}typeof s=="function"?t.refCleanup=s(l):s.current=l}}catch(u){pt(t,n,u)}}function ns(t,n){var s=t.ref,l=t.refCleanup;if(s!==null)if(typeof l=="function")try{l()}catch(u){pt(t,n,u)}finally{t.refCleanup=null,t=t.alternate,t!=null&&(t.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(u){pt(t,n,u)}else s.current=null}function Hp(t){var n=t.type,s=t.memoizedProps,l=t.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":s.autoFocus&&l.focus();break e;case"img":s.src?l.src=s.src:s.srcSet&&(l.srcset=s.srcSet)}}catch(u){pt(t,t.return,u)}}function ad(t,n,s){try{var l=t.stateNode;rb(l,t.type,s,n),l[te]=n}catch(u){pt(t,t.return,u)}}function Pp(t){return t.tag===5||t.tag===3||t.tag===26||t.tag===27&&na(t.type)||t.tag===4}function od(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Pp(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.tag===27&&na(t.type)||t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ld(t,n,s){var l=t.tag;if(l===5||l===6)t=t.stateNode,n?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(t,n):(n=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,n.appendChild(t),s=s._reactRootContainer,s!=null||n.onclick!==null||(n.onclick=xi));else if(l!==4&&(l===27&&na(t.type)&&(s=t.stateNode,n=null),t=t.child,t!==null))for(ld(t,n,s),t=t.sibling;t!==null;)ld(t,n,s),t=t.sibling}function Vr(t,n,s){var l=t.tag;if(l===5||l===6)t=t.stateNode,n?s.insertBefore(t,n):s.appendChild(t);else if(l!==4&&(l===27&&na(t.type)&&(s=t.stateNode),t=t.child,t!==null))for(Vr(t,n,s),t=t.sibling;t!==null;)Vr(t,n,s),t=t.sibling}function Up(t){var n=t.stateNode,s=t.memoizedProps;try{for(var l=t.type,u=n.attributes;u.length;)n.removeAttributeNode(u[0]);Cn(n,l,s),n[F]=t,n[te]=s}catch(d){pt(t,t.return,d)}}var vs=!1,dn=!1,rd=!1,qp=typeof WeakSet=="function"?WeakSet:Set,An=null;function q0(t,n){if(t=t.containerInfo,Cd=dc,t=Zf(t),tu(t)){if("selectionStart"in t)var s={start:t.selectionStart,end:t.selectionEnd};else e:{s=(s=t.ownerDocument)&&s.defaultView||window;var l=s.getSelection&&s.getSelection();if(l&&l.rangeCount!==0){s=l.anchorNode;var u=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var x=0,T=-1,L=-1,U=0,Q=0,ie=t,V=null;t:for(;;){for(var W;ie!==s||u!==0&&ie.nodeType!==3||(T=x+u),ie!==d||l!==0&&ie.nodeType!==3||(L=x+l),ie.nodeType===3&&(x+=ie.nodeValue.length),(W=ie.firstChild)!==null;)V=ie,ie=W;for(;;){if(ie===t)break t;if(V===s&&++U===u&&(T=x),V===d&&++Q===l&&(L=x),(W=ie.nextSibling)!==null)break;ie=V,V=ie.parentNode}ie=W}s=T===-1||L===-1?null:{start:T,end:L}}else s=null}s=s||{start:0,end:0}}else s=null;for(Nd={focusedElem:t,selectionRange:s},dc=!1,An=n;An!==null;)if(n=An,t=n.child,(n.subtreeFlags&1028)!==0&&t!==null)t.return=n,An=t;else for(;An!==null;){switch(n=An,d=n.alternate,t=n.flags,n.tag){case 0:if((t&4)!==0&&(t=n.updateQueue,t=t!==null?t.events:null,t!==null))for(s=0;s<t.length;s++)u=t[s],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((t&1024)!==0&&d!==null){t=void 0,s=n,u=d.memoizedProps,d=d.memoizedState,l=s.stateNode;try{var Se=ja(s.type,u);t=l.getSnapshotBeforeUpdate(Se,d),l.__reactInternalSnapshotBeforeUpdate=t}catch(Ne){pt(s,s.return,Ne)}}break;case 3:if((t&1024)!==0){if(t=n.stateNode.containerInfo,s=t.nodeType,s===9)Ld(t);else if(s===1)switch(t.nodeName){case"HEAD":case"HTML":case"BODY":Ld(t);break;default:t.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((t&1024)!==0)throw Error(o(163))}if(t=n.sibling,t!==null){t.return=n.return,An=t;break}An=n.return}}function zp(t,n,s){var l=s.flags;switch(s.tag){case 0:case 11:case 15:As(t,s),l&4&&vl(5,s);break;case 1:if(As(t,s),l&4)if(t=s.stateNode,n===null)try{t.componentDidMount()}catch(x){pt(s,s.return,x)}else{var u=ja(s.type,n.memoizedProps);n=n.memoizedState;try{t.componentDidUpdate(u,n,t.__reactInternalSnapshotBeforeUpdate)}catch(x){pt(s,s.return,x)}}l&64&&jp(s),l&512&&Sl(s,s.return);break;case 3:if(As(t,s),l&64&&(t=s.updateQueue,t!==null)){if(n=null,s.child!==null)switch(s.child.tag){case 27:case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}try{_m(t,n)}catch(x){pt(s,s.return,x)}}break;case 27:n===null&&l&4&&Up(s);case 26:case 5:As(t,s),n===null&&l&4&&Hp(s),l&512&&Sl(s,s.return);break;case 12:As(t,s);break;case 31:As(t,s),l&4&&Yp(t,s);break;case 13:As(t,s),l&4&&Fp(t,s),l&64&&(t=s.memoizedState,t!==null&&(t=t.dehydrated,t!==null&&(s=X0.bind(null,s),gb(t,s))));break;case 22:if(l=s.memoizedState!==null||vs,!l){n=n!==null&&n.memoizedState!==null||dn,u=vs;var d=dn;vs=l,(dn=n)&&!d?Ts(t,s,(s.subtreeFlags&8772)!==0):As(t,s),vs=u,dn=d}break;case 30:break;default:As(t,s)}}function $p(t){var n=t.alternate;n!==null&&(t.alternate=null,$p(n)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(n=t.stateNode,n!==null&&lt(n)),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}var Ht=null,Gn=!1;function Ss(t,n,s){for(s=s.child;s!==null;)Vp(t,n,s),s=s.sibling}function Vp(t,n,s){if(wt&&typeof wt.onCommitFiberUnmount=="function")try{wt.onCommitFiberUnmount(an,s)}catch{}switch(s.tag){case 26:dn||ns(s,n),Ss(t,n,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:dn||ns(s,n);var l=Ht,u=Gn;na(s.type)&&(Ht=s.stateNode,Gn=!1),Ss(t,n,s),Nl(s.stateNode),Ht=l,Gn=u;break;case 5:dn||ns(s,n);case 6:if(l=Ht,u=Gn,Ht=null,Ss(t,n,s),Ht=l,Gn=u,Ht!==null)if(Gn)try{(Ht.nodeType===9?Ht.body:Ht.nodeName==="HTML"?Ht.ownerDocument.body:Ht).removeChild(s.stateNode)}catch(d){pt(s,n,d)}else try{Ht.removeChild(s.stateNode)}catch(d){pt(s,n,d)}break;case 18:Ht!==null&&(Gn?(t=Ht,jh(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,s.stateNode),Ro(t)):jh(Ht,s.stateNode));break;case 4:l=Ht,u=Gn,Ht=s.stateNode.containerInfo,Gn=!0,Ss(t,n,s),Ht=l,Gn=u;break;case 0:case 11:case 14:case 15:Ws(2,s,n),dn||Ws(4,s,n),Ss(t,n,s);break;case 1:dn||(ns(s,n),l=s.stateNode,typeof l.componentWillUnmount=="function"&&Dp(s,n,l)),Ss(t,n,s);break;case 21:Ss(t,n,s);break;case 22:dn=(l=dn)||s.memoizedState!==null,Ss(t,n,s),dn=l;break;default:Ss(t,n,s)}}function Yp(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null))){t=t.dehydrated;try{Ro(t)}catch(s){pt(n,n.return,s)}}}function Fp(t,n){if(n.memoizedState===null&&(t=n.alternate,t!==null&&(t=t.memoizedState,t!==null&&(t=t.dehydrated,t!==null))))try{Ro(t)}catch(s){pt(n,n.return,s)}}function z0(t){switch(t.tag){case 31:case 13:case 19:var n=t.stateNode;return n===null&&(n=t.stateNode=new qp),n;case 22:return t=t.stateNode,n=t._retryCache,n===null&&(n=t._retryCache=new qp),n;default:throw Error(o(435,t.tag))}}function Yr(t,n){var s=z0(t);n.forEach(function(l){if(!s.has(l)){s.add(l);var u=Q0.bind(null,t,l);l.then(u,u)}})}function Wn(t,n){var s=n.deletions;if(s!==null)for(var l=0;l<s.length;l++){var u=s[l],d=t,x=n,T=x;e:for(;T!==null;){switch(T.tag){case 27:if(na(T.type)){Ht=T.stateNode,Gn=!1;break e}break;case 5:Ht=T.stateNode,Gn=!1;break e;case 3:case 4:Ht=T.stateNode.containerInfo,Gn=!0;break e}T=T.return}if(Ht===null)throw Error(o(160));Vp(d,x,u),Ht=null,Gn=!1,d=u.alternate,d!==null&&(d.return=null),u.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)Kp(n,t),n=n.sibling}var Di=null;function Kp(t,n){var s=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:Wn(n,t),Xn(t),l&4&&(Ws(3,t,t.return),vl(3,t),Ws(5,t,t.return));break;case 1:Wn(n,t),Xn(t),l&512&&(dn||s===null||ns(s,s.return)),l&64&&vs&&(t=t.updateQueue,t!==null&&(l=t.callbacks,l!==null&&(s=t.shared.hiddenCallbacks,t.shared.hiddenCallbacks=s===null?l:s.concat(l))));break;case 26:var u=Di;if(Wn(n,t),Xn(t),l&512&&(dn||s===null||ns(s,s.return)),l&4){var d=s!==null?s.memoizedState:null;if(l=t.memoizedState,s===null)if(l===null)if(t.stateNode===null){e:{l=t.type,s=t.memoizedProps,u=u.ownerDocument||u;t:switch(l){case"title":d=u.getElementsByTagName("title")[0],(!d||d[Ct]||d[F]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=u.createElement(l),u.head.insertBefore(d,u.querySelector("head > title"))),Cn(d,l,s),d[F]=t,Nt(d),l=d;break e;case"link":var x=Kh("link","href",u).get(l+(s.href||""));if(x){for(var T=0;T<x.length;T++)if(d=x[T],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){x.splice(T,1);break t}}d=u.createElement(l),Cn(d,l,s),u.head.appendChild(d);break;case"meta":if(x=Kh("meta","content",u).get(l+(s.content||""))){for(T=0;T<x.length;T++)if(d=x[T],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){x.splice(T,1);break t}}d=u.createElement(l),Cn(d,l,s),u.head.appendChild(d);break;default:throw Error(o(468,l))}d[F]=t,Nt(d),l=d}t.stateNode=l}else Gh(u,t.type,t.stateNode);else t.stateNode=Fh(u,l,t.memoizedProps);else d!==l?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,l===null?Gh(u,t.type,t.stateNode):Fh(u,l,t.memoizedProps)):l===null&&t.stateNode!==null&&ad(t,t.memoizedProps,s.memoizedProps)}break;case 27:Wn(n,t),Xn(t),l&512&&(dn||s===null||ns(s,s.return)),s!==null&&l&4&&ad(t,t.memoizedProps,s.memoizedProps);break;case 5:if(Wn(n,t),Xn(t),l&512&&(dn||s===null||ns(s,s.return)),t.flags&32){u=t.stateNode;try{Is(u,"")}catch(Se){pt(t,t.return,Se)}}l&4&&t.stateNode!=null&&(u=t.memoizedProps,ad(t,u,s!==null?s.memoizedProps:u)),l&1024&&(rd=!0);break;case 6:if(Wn(n,t),Xn(t),l&4){if(t.stateNode===null)throw Error(o(162));l=t.memoizedProps,s=t.stateNode;try{s.nodeValue=l}catch(Se){pt(t,t.return,Se)}}break;case 3:if(lc=null,u=Di,Di=ac(n.containerInfo),Wn(n,t),Di=u,Xn(t),l&4&&s!==null&&s.memoizedState.isDehydrated)try{Ro(n.containerInfo)}catch(Se){pt(t,t.return,Se)}rd&&(rd=!1,Gp(t));break;case 4:l=Di,Di=ac(t.stateNode.containerInfo),Wn(n,t),Xn(t),Di=l;break;case 12:Wn(n,t),Xn(t);break;case 31:Wn(n,t),Xn(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Yr(t,l)));break;case 13:Wn(n,t),Xn(t),t.child.flags&8192&&t.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(Kr=Ve()),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Yr(t,l)));break;case 22:u=t.memoizedState!==null;var L=s!==null&&s.memoizedState!==null,U=vs,Q=dn;if(vs=U||u,dn=Q||L,Wn(n,t),dn=Q,vs=U,Xn(t),l&8192)e:for(n=t.stateNode,n._visibility=u?n._visibility&-2:n._visibility|1,u&&(s===null||L||vs||dn||Da(t)),s=null,n=t;;){if(n.tag===5||n.tag===26){if(s===null){L=s=n;try{if(d=L.stateNode,u)x=d.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{T=L.stateNode;var ie=L.memoizedProps.style,V=ie!=null&&ie.hasOwnProperty("display")?ie.display:null;T.style.display=V==null||typeof V=="boolean"?"":(""+V).trim()}}catch(Se){pt(L,L.return,Se)}}}else if(n.tag===6){if(s===null){L=n;try{L.stateNode.nodeValue=u?"":L.memoizedProps}catch(Se){pt(L,L.return,Se)}}}else if(n.tag===18){if(s===null){L=n;try{var W=L.stateNode;u?Dh(W,!0):Dh(L.stateNode,!1)}catch(Se){pt(L,L.return,Se)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===t)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break e;for(;n.sibling===null;){if(n.return===null||n.return===t)break e;s===n&&(s=null),n=n.return}s===n&&(s=null),n.sibling.return=n.return,n=n.sibling}l&4&&(l=t.updateQueue,l!==null&&(s=l.retryQueue,s!==null&&(l.retryQueue=null,Yr(t,s))));break;case 19:Wn(n,t),Xn(t),l&4&&(l=t.updateQueue,l!==null&&(t.updateQueue=null,Yr(t,l)));break;case 30:break;case 21:break;default:Wn(n,t),Xn(t)}}function Xn(t){var n=t.flags;if(n&2){try{for(var s,l=t.return;l!==null;){if(Pp(l)){s=l;break}l=l.return}if(s==null)throw Error(o(160));switch(s.tag){case 27:var u=s.stateNode,d=od(t);Vr(t,d,u);break;case 5:var x=s.stateNode;s.flags&32&&(Is(x,""),s.flags&=-33);var T=od(t);Vr(t,T,x);break;case 3:case 4:var L=s.stateNode.containerInfo,U=od(t);ld(t,U,L);break;default:throw Error(o(161))}}catch(Q){pt(t,t.return,Q)}t.flags&=-3}n&4096&&(t.flags&=-4097)}function Gp(t){if(t.subtreeFlags&1024)for(t=t.child;t!==null;){var n=t;Gp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),t=t.sibling}}function As(t,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)zp(t,n.alternate,n),n=n.sibling}function Da(t){for(t=t.child;t!==null;){var n=t;switch(n.tag){case 0:case 11:case 14:case 15:Ws(4,n,n.return),Da(n);break;case 1:ns(n,n.return);var s=n.stateNode;typeof s.componentWillUnmount=="function"&&Dp(n,n.return,s),Da(n);break;case 27:Nl(n.stateNode);case 26:case 5:ns(n,n.return),Da(n);break;case 22:n.memoizedState===null&&Da(n);break;case 30:Da(n);break;default:Da(n)}t=t.sibling}}function Ts(t,n,s){for(s=s&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var l=n.alternate,u=t,d=n,x=d.flags;switch(d.tag){case 0:case 11:case 15:Ts(u,d,s),vl(4,d);break;case 1:if(Ts(u,d,s),l=d,u=l.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(U){pt(l,l.return,U)}if(l=d,u=l.updateQueue,u!==null){var T=l.stateNode;try{var L=u.shared.hiddenCallbacks;if(L!==null)for(u.shared.hiddenCallbacks=null,u=0;u<L.length;u++)wm(L[u],T)}catch(U){pt(l,l.return,U)}}s&&x&64&&jp(d),Sl(d,d.return);break;case 27:Up(d);case 26:case 5:Ts(u,d,s),s&&l===null&&x&4&&Hp(d),Sl(d,d.return);break;case 12:Ts(u,d,s);break;case 31:Ts(u,d,s),s&&x&4&&Yp(u,d);break;case 13:Ts(u,d,s),s&&x&4&&Fp(u,d);break;case 22:d.memoizedState===null&&Ts(u,d,s),Sl(d,d.return);break;case 30:break;default:Ts(u,d,s)}n=n.sibling}}function cd(t,n){var s=null;t!==null&&t.memoizedState!==null&&t.memoizedState.cachePool!==null&&(s=t.memoizedState.cachePool.pool),t=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(t=n.memoizedState.cachePool.pool),t!==s&&(t!=null&&t.refCount++,s!=null&&ll(s))}function ud(t,n){t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&ll(t))}function Hi(t,n,s,l){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Wp(t,n,s,l),n=n.sibling}function Wp(t,n,s,l){var u=n.flags;switch(n.tag){case 0:case 11:case 15:Hi(t,n,s,l),u&2048&&vl(9,n);break;case 1:Hi(t,n,s,l);break;case 3:Hi(t,n,s,l),u&2048&&(t=null,n.alternate!==null&&(t=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==t&&(n.refCount++,t!=null&&ll(t)));break;case 12:if(u&2048){Hi(t,n,s,l),t=n.stateNode;try{var d=n.memoizedProps,x=d.id,T=d.onPostCommit;typeof T=="function"&&T(x,n.alternate===null?"mount":"update",t.passiveEffectDuration,-0)}catch(L){pt(n,n.return,L)}}else Hi(t,n,s,l);break;case 31:Hi(t,n,s,l);break;case 13:Hi(t,n,s,l);break;case 23:break;case 22:d=n.stateNode,x=n.alternate,n.memoizedState!==null?d._visibility&2?Hi(t,n,s,l):Al(t,n):d._visibility&2?Hi(t,n,s,l):(d._visibility|=2,vo(t,n,s,l,(n.subtreeFlags&10256)!==0||!1)),u&2048&&cd(x,n);break;case 24:Hi(t,n,s,l),u&2048&&ud(n.alternate,n);break;default:Hi(t,n,s,l)}}function vo(t,n,s,l,u){for(u=u&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var d=t,x=n,T=s,L=l,U=x.flags;switch(x.tag){case 0:case 11:case 15:vo(d,x,T,L,u),vl(8,x);break;case 23:break;case 22:var Q=x.stateNode;x.memoizedState!==null?Q._visibility&2?vo(d,x,T,L,u):Al(d,x):(Q._visibility|=2,vo(d,x,T,L,u)),u&&U&2048&&cd(x.alternate,x);break;case 24:vo(d,x,T,L,u),u&&U&2048&&ud(x.alternate,x);break;default:vo(d,x,T,L,u)}n=n.sibling}}function Al(t,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var s=t,l=n,u=l.flags;switch(l.tag){case 22:Al(s,l),u&2048&&cd(l.alternate,l);break;case 24:Al(s,l),u&2048&&ud(l.alternate,l);break;default:Al(s,l)}n=n.sibling}}var Tl=8192;function So(t,n,s){if(t.subtreeFlags&Tl)for(t=t.child;t!==null;)Xp(t,n,s),t=t.sibling}function Xp(t,n,s){switch(t.tag){case 26:So(t,n,s),t.flags&Tl&&t.memoizedState!==null&&Ob(s,Di,t.memoizedState,t.memoizedProps);break;case 5:So(t,n,s);break;case 3:case 4:var l=Di;Di=ac(t.stateNode.containerInfo),So(t,n,s),Di=l;break;case 22:t.memoizedState===null&&(l=t.alternate,l!==null&&l.memoizedState!==null?(l=Tl,Tl=16777216,So(t,n,s),Tl=l):So(t,n,s));break;default:So(t,n,s)}}function Qp(t){var n=t.alternate;if(n!==null&&(t=n.child,t!==null)){n.child=null;do n=t.sibling,t.sibling=null,t=n;while(t!==null)}}function El(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var l=n[s];An=l,Zp(l,t)}Qp(t)}if(t.subtreeFlags&10256)for(t=t.child;t!==null;)Jp(t),t=t.sibling}function Jp(t){switch(t.tag){case 0:case 11:case 15:El(t),t.flags&2048&&Ws(9,t,t.return);break;case 3:El(t);break;case 12:El(t);break;case 22:var n=t.stateNode;t.memoizedState!==null&&n._visibility&2&&(t.return===null||t.return.tag!==13)?(n._visibility&=-3,Fr(t)):El(t);break;default:El(t)}}function Fr(t){var n=t.deletions;if((t.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var l=n[s];An=l,Zp(l,t)}Qp(t)}for(t=t.child;t!==null;){switch(n=t,n.tag){case 0:case 11:case 15:Ws(8,n,n.return),Fr(n);break;case 22:s=n.stateNode,s._visibility&2&&(s._visibility&=-3,Fr(n));break;default:Fr(n)}t=t.sibling}}function Zp(t,n){for(;An!==null;){var s=An;switch(s.tag){case 0:case 11:case 15:Ws(8,s,n);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var l=s.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:ll(s.memoizedState.cache)}if(l=s.child,l!==null)l.return=s,An=l;else e:for(s=t;An!==null;){l=An;var u=l.sibling,d=l.return;if($p(l),l===s){An=null;break e}if(u!==null){u.return=d,An=u;break e}An=d}}}var $0={getCacheForType:function(t){var n=Mn(rn),s=n.data.get(t);return s===void 0&&(s=t(),n.data.set(t,s)),s},cacheSignal:function(){return Mn(rn).controller.signal}},V0=typeof WeakMap=="function"?WeakMap:Map,at=0,Et=null,Ge=null,Qe=0,mt=0,ci=null,Xs=!1,Ao=!1,dd=!1,Es=0,Wt=0,Qs=0,Ha=0,fd=0,ui=0,To=0,wl=null,Qn=null,md=!1,Kr=0,eh=0,Gr=1/0,Wr=null,Js=null,gn=0,Zs=null,Eo=null,ws=0,pd=0,hd=null,th=null,_l=0,gd=null;function di(){return(at&2)!==0&&Qe!==0?Qe&-Qe:H.T!==null?Ad():Ln()}function nh(){if(ui===0)if((Qe&536870912)===0||tt){var t=Mt;Mt<<=1,(Mt&3932160)===0&&(Mt=262144),ui=t}else ui=536870912;return t=li.current,t!==null&&(t.flags|=32),ui}function Jn(t,n,s){(t===Et&&(mt===2||mt===9)||t.cancelPendingCommit!==null)&&(wo(t,0),ea(t,Qe,ui,!1)),qt(t,s),((at&2)===0||t!==Et)&&(t===Et&&((at&2)===0&&(Ha|=s),Wt===4&&ea(t,Qe,ui,!1)),is(t))}function ih(t,n,s){if((at&6)!==0)throw Error(o(327));var l=!s&&(n&127)===0&&(n&t.expiredLanes)===0||Ot(t,n),u=l?K0(t,n):bd(t,n,!0),d=l;do{if(u===0){Ao&&!l&&ea(t,n,0,!1);break}else{if(s=t.current.alternate,d&&!Y0(s)){u=bd(t,n,!1),d=!1;continue}if(u===2){if(d=n,t.errorRecoveryDisabledLanes&d)var x=0;else x=t.pendingLanes&-536870913,x=x!==0?x:x&536870912?536870912:0;if(x!==0){n=x;e:{var T=t;u=wl;var L=T.current.memoizedState.isDehydrated;if(L&&(wo(T,x).flags|=256),x=bd(T,x,!1),x!==2){if(dd&&!L){T.errorRecoveryDisabledLanes|=d,Ha|=d,u=4;break e}d=Qn,Qn=u,d!==null&&(Qn===null?Qn=d:Qn.push.apply(Qn,d))}u=x}if(d=!1,u!==2)continue}}if(u===1){wo(t,0),ea(t,n,0,!0);break}e:{switch(l=t,d=u,d){case 0:case 1:throw Error(o(345));case 4:if((n&4194048)!==n)break;case 6:ea(l,n,ui,!Xs);break e;case 2:Qn=null;break;case 3:case 5:break;default:throw Error(o(329))}if((n&62914560)===n&&(u=Kr+300-Ve(),10<u)){if(ea(l,n,ui,!Xs),Fe(l,0,!0)!==0)break e;ws=n,l.timeoutHandle=Ih(sh.bind(null,l,s,Qn,Wr,md,n,ui,Ha,To,Xs,d,"Throttled",-0,0),u);break e}sh(l,s,Qn,Wr,md,n,ui,Ha,To,Xs,d,null,-0,0)}}break}while(!0);is(t)}function sh(t,n,s,l,u,d,x,T,L,U,Q,ie,V,W){if(t.timeoutHandle=-1,ie=n.subtreeFlags,ie&8192||(ie&16785408)===16785408){ie={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:xi},Xp(n,d,ie);var Se=(d&62914560)===d?Kr-Ve():(d&4194048)===d?eh-Ve():0;if(Se=Cb(ie,Se),Se!==null){ws=d,t.cancelPendingCommit=Se(fh.bind(null,t,n,d,s,l,u,x,T,L,Q,ie,null,V,W)),ea(t,d,x,!U);return}}fh(t,n,d,s,l,u,x,T,L)}function Y0(t){for(var n=t;;){var s=n.tag;if((s===0||s===11||s===15)&&n.flags&16384&&(s=n.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var l=0;l<s.length;l++){var u=s[l],d=u.getSnapshot;u=u.value;try{if(!ai(d(),u))return!1}catch{return!1}}if(s=n.child,n.subtreeFlags&16384&&s!==null)s.return=n,n=s;else{if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function ea(t,n,s,l){n&=~fd,n&=~Ha,t.suspendedLanes|=n,t.pingedLanes&=~n,l&&(t.warmLanes|=n),l=t.expirationTimes;for(var u=n;0<u;){var d=31-_t(u),x=1<<d;l[d]=-1,u&=~x}s!==0&&gi(t,s,n)}function Xr(){return(at&6)===0?(Ml(0),!1):!0}function yd(){if(Ge!==null){if(mt===0)var t=Ge.return;else t=Ge,ps=Ca=null,Lu(t),ho=null,cl=0,t=Ge;for(;t!==null;)Bp(t.alternate,t),t=t.return;Ge=null}}function wo(t,n){var s=t.timeoutHandle;s!==-1&&(t.timeoutHandle=-1,db(s)),s=t.cancelPendingCommit,s!==null&&(t.cancelPendingCommit=null,s()),ws=0,yd(),Et=t,Ge=s=fs(t.current,null),Qe=n,mt=0,ci=null,Xs=!1,Ao=Ot(t,n),dd=!1,To=ui=fd=Ha=Qs=Wt=0,Qn=wl=null,md=!1,(n&8)!==0&&(n|=n&32);var l=t.entangledLanes;if(l!==0)for(t=t.entanglements,l&=n;0<l;){var u=31-_t(l),d=1<<u;n|=t[u],l&=~d}return Es=n,yr(),s}function ah(t,n){He=null,H.H=yl,n===po||n===wr?(n=Sm(),mt=3):n===Su?(n=Sm(),mt=4):mt=n===Wu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,ci=n,Ge===null&&(Wt=1,Pr(t,Ti(n,t.current)))}function oh(){var t=li.current;return t===null?!0:(Qe&4194048)===Qe?Mi===null:(Qe&62914560)===Qe||(Qe&536870912)!==0?t===Mi:!1}function lh(){var t=H.H;return H.H=yl,t===null?yl:t}function rh(){var t=H.A;return H.A=$0,t}function Qr(){Wt=4,Xs||(Qe&4194048)!==Qe&&li.current!==null||(Ao=!0),(Qs&134217727)===0&&(Ha&134217727)===0||Et===null||ea(Et,Qe,ui,!1)}function bd(t,n,s){var l=at;at|=2;var u=lh(),d=rh();(Et!==t||Qe!==n)&&(Wr=null,wo(t,n)),n=!1;var x=Wt;e:do try{if(mt!==0&&Ge!==null){var T=Ge,L=ci;switch(mt){case 8:yd(),x=6;break e;case 3:case 2:case 9:case 6:li.current===null&&(n=!0);var U=mt;if(mt=0,ci=null,_o(t,T,L,U),s&&Ao){x=0;break e}break;default:U=mt,mt=0,ci=null,_o(t,T,L,U)}}F0(),x=Wt;break}catch(Q){ah(t,Q)}while(!0);return n&&t.shellSuspendCounter++,ps=Ca=null,at=l,H.H=u,H.A=d,Ge===null&&(Et=null,Qe=0,yr()),x}function F0(){for(;Ge!==null;)ch(Ge)}function K0(t,n){var s=at;at|=2;var l=lh(),u=rh();Et!==t||Qe!==n?(Wr=null,Gr=Ve()+500,wo(t,n)):Ao=Ot(t,n);e:do try{if(mt!==0&&Ge!==null){n=Ge;var d=ci;t:switch(mt){case 1:mt=0,ci=null,_o(t,n,d,1);break;case 2:case 9:if(xm(d)){mt=0,ci=null,uh(n);break}n=function(){mt!==2&&mt!==9||Et!==t||(mt=7),is(t)},d.then(n,n);break e;case 3:mt=7;break e;case 4:mt=5;break e;case 7:xm(d)?(mt=0,ci=null,uh(n)):(mt=0,ci=null,_o(t,n,d,7));break;case 5:var x=null;switch(Ge.tag){case 26:x=Ge.memoizedState;case 5:case 27:var T=Ge;if(x?Wh(x):T.stateNode.complete){mt=0,ci=null;var L=T.sibling;if(L!==null)Ge=L;else{var U=T.return;U!==null?(Ge=U,Jr(U)):Ge=null}break t}}mt=0,ci=null,_o(t,n,d,5);break;case 6:mt=0,ci=null,_o(t,n,d,6);break;case 8:yd(),Wt=6;break e;default:throw Error(o(462))}}G0();break}catch(Q){ah(t,Q)}while(!0);return ps=Ca=null,H.H=l,H.A=u,at=s,Ge!==null?0:(Et=null,Qe=0,yr(),Wt)}function G0(){for(;Ge!==null&&!En();)ch(Ge)}function ch(t){var n=Lp(t.alternate,t,Es);t.memoizedProps=t.pendingProps,n===null?Jr(t):Ge=n}function uh(t){var n=t,s=n.alternate;switch(n.tag){case 15:case 0:n=Mp(s,n,n.pendingProps,n.type,void 0,Qe);break;case 11:n=Mp(s,n,n.pendingProps,n.type.render,n.ref,Qe);break;case 5:Lu(n);default:Bp(s,n),n=Ge=rm(n,Es),n=Lp(s,n,Es)}t.memoizedProps=t.pendingProps,n===null?Jr(t):Ge=n}function _o(t,n,s,l){ps=Ca=null,Lu(n),ho=null,cl=0;var u=n.return;try{if(j0(t,u,n,s,Qe)){Wt=1,Pr(t,Ti(s,t.current)),Ge=null;return}}catch(d){if(u!==null)throw Ge=u,d;Wt=1,Pr(t,Ti(s,t.current)),Ge=null;return}n.flags&32768?(tt||l===1?t=!0:Ao||(Qe&536870912)!==0?t=!1:(Xs=t=!0,(l===2||l===9||l===3||l===6)&&(l=li.current,l!==null&&l.tag===13&&(l.flags|=16384))),dh(n,t)):Jr(n)}function Jr(t){var n=t;do{if((n.flags&32768)!==0){dh(n,Xs);return}t=n.return;var s=P0(n.alternate,n,Es);if(s!==null){Ge=s;return}if(n=n.sibling,n!==null){Ge=n;return}Ge=n=t}while(n!==null);Wt===0&&(Wt=5)}function dh(t,n){do{var s=U0(t.alternate,t);if(s!==null){s.flags&=32767,Ge=s;return}if(s=t.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!n&&(t=t.sibling,t!==null)){Ge=t;return}Ge=t=s}while(t!==null);Wt=6,Ge=null}function fh(t,n,s,l,u,d,x,T,L){t.cancelPendingCommit=null;do Zr();while(gn!==0);if((at&6)!==0)throw Error(o(327));if(n!==null){if(n===t.current)throw Error(o(177));if(d=n.lanes|n.childLanes,d|=ou,zn(t,s,d,x,T,L),t===Et&&(Ge=Et=null,Qe=0),Eo=n,Zs=t,ws=s,pd=d,hd=u,th=l,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(t.callbackNode=null,t.callbackPriority=0,J0(pn,function(){return yh(),null})):(t.callbackNode=null,t.callbackPriority=0),l=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||l){l=H.T,H.T=null,u=ee.p,ee.p=2,x=at,at|=4;try{q0(t,n,s)}finally{at=x,ee.p=u,H.T=l}}gn=1,mh(),ph(),hh()}}function mh(){if(gn===1){gn=0;var t=Zs,n=Eo,s=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||s){s=H.T,H.T=null;var l=ee.p;ee.p=2;var u=at;at|=4;try{Kp(n,t);var d=Nd,x=Zf(t.containerInfo),T=d.focusedElem,L=d.selectionRange;if(x!==T&&T&&T.ownerDocument&&Jf(T.ownerDocument.documentElement,T)){if(L!==null&&tu(T)){var U=L.start,Q=L.end;if(Q===void 0&&(Q=U),"selectionStart"in T)T.selectionStart=U,T.selectionEnd=Math.min(Q,T.value.length);else{var ie=T.ownerDocument||document,V=ie&&ie.defaultView||window;if(V.getSelection){var W=V.getSelection(),Se=T.textContent.length,Ne=Math.min(L.start,Se),xt=L.end===void 0?Ne:Math.min(L.end,Se);!W.extend&&Ne>xt&&(x=xt,xt=Ne,Ne=x);var D=Qf(T,Ne),j=Qf(T,xt);if(D&&j&&(W.rangeCount!==1||W.anchorNode!==D.node||W.anchorOffset!==D.offset||W.focusNode!==j.node||W.focusOffset!==j.offset)){var P=ie.createRange();P.setStart(D.node,D.offset),W.removeAllRanges(),Ne>xt?(W.addRange(P),W.extend(j.node,j.offset)):(P.setEnd(j.node,j.offset),W.addRange(P))}}}}for(ie=[],W=T;W=W.parentNode;)W.nodeType===1&&ie.push({element:W,left:W.scrollLeft,top:W.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<ie.length;T++){var Z=ie[T];Z.element.scrollLeft=Z.left,Z.element.scrollTop=Z.top}}dc=!!Cd,Nd=Cd=null}finally{at=u,ee.p=l,H.T=s}}t.current=n,gn=2}}function ph(){if(gn===2){gn=0;var t=Zs,n=Eo,s=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||s){s=H.T,H.T=null;var l=ee.p;ee.p=2;var u=at;at|=4;try{zp(t,n.alternate,n)}finally{at=u,ee.p=l,H.T=s}}gn=3}}function hh(){if(gn===4||gn===3){gn=0,Vt();var t=Zs,n=Eo,s=ws,l=th;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?gn=5:(gn=0,Eo=Zs=null,gh(t,t.pendingLanes));var u=t.pendingLanes;if(u===0&&(Js=null),Ii(s),n=n.stateNode,wt&&typeof wt.onCommitFiberRoot=="function")try{wt.onCommitFiberRoot(an,n,void 0,(n.current.flags&128)===128)}catch{}if(l!==null){n=H.T,u=ee.p,ee.p=2,H.T=null;try{for(var d=t.onRecoverableError,x=0;x<l.length;x++){var T=l[x];d(T.value,{componentStack:T.stack})}}finally{H.T=n,ee.p=u}}(ws&3)!==0&&Zr(),is(t),u=t.pendingLanes,(s&261930)!==0&&(u&42)!==0?t===gd?_l++:(_l=0,gd=t):_l=0,Ml(0)}}function gh(t,n){(t.pooledCacheLanes&=n)===0&&(n=t.pooledCache,n!=null&&(t.pooledCache=null,ll(n)))}function Zr(){return mh(),ph(),hh(),yh()}function yh(){if(gn!==5)return!1;var t=Zs,n=pd;pd=0;var s=Ii(ws),l=H.T,u=ee.p;try{ee.p=32>s?32:s,H.T=null,s=hd,hd=null;var d=Zs,x=ws;if(gn=0,Eo=Zs=null,ws=0,(at&6)!==0)throw Error(o(331));var T=at;if(at|=4,Jp(d.current),Wp(d,d.current,x,s),at=T,Ml(0,!1),wt&&typeof wt.onPostCommitFiberRoot=="function")try{wt.onPostCommitFiberRoot(an,d)}catch{}return!0}finally{ee.p=u,H.T=l,gh(t,n)}}function bh(t,n,s){n=Ti(s,n),n=Gu(t.stateNode,n,2),t=Fs(t,n,2),t!==null&&(qt(t,2),is(t))}function pt(t,n,s){if(t.tag===3)bh(t,t,s);else for(;n!==null;){if(n.tag===3){bh(n,t,s);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Js===null||!Js.has(l))){t=Ti(s,t),s=xp(2),l=Fs(n,s,2),l!==null&&(vp(s,l,n,t),qt(l,2),is(l));break}}n=n.return}}function xd(t,n,s){var l=t.pingCache;if(l===null){l=t.pingCache=new V0;var u=new Set;l.set(n,u)}else u=l.get(n),u===void 0&&(u=new Set,l.set(n,u));u.has(s)||(dd=!0,u.add(s),t=W0.bind(null,t,n,s),n.then(t,t))}function W0(t,n,s){var l=t.pingCache;l!==null&&l.delete(n),t.pingedLanes|=t.suspendedLanes&s,t.warmLanes&=~s,Et===t&&(Qe&s)===s&&(Wt===4||Wt===3&&(Qe&62914560)===Qe&&300>Ve()-Kr?(at&2)===0&&wo(t,0):fd|=s,To===Qe&&(To=0)),is(t)}function xh(t,n){n===0&&(n=Li()),t=_a(t,n),t!==null&&(qt(t,n),is(t))}function X0(t){var n=t.memoizedState,s=0;n!==null&&(s=n.retryLane),xh(t,s)}function Q0(t,n){var s=0;switch(t.tag){case 31:case 13:var l=t.stateNode,u=t.memoizedState;u!==null&&(s=u.retryLane);break;case 19:l=t.stateNode;break;case 22:l=t.stateNode._retryCache;break;default:throw Error(o(314))}l!==null&&l.delete(n),xh(t,s)}function J0(t,n){return Tn(t,n)}var ec=null,Mo=null,vd=!1,tc=!1,Sd=!1,ta=0;function is(t){t!==Mo&&t.next===null&&(Mo===null?ec=Mo=t:Mo=Mo.next=t),tc=!0,vd||(vd=!0,eb())}function Ml(t,n){if(!Sd&&tc){Sd=!0;do for(var s=!1,l=ec;l!==null;){if(t!==0){var u=l.pendingLanes;if(u===0)var d=0;else{var x=l.suspendedLanes,T=l.pingedLanes;d=(1<<31-_t(42|t)+1)-1,d&=u&~(x&~T),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,Th(l,d))}else d=Qe,d=Fe(l,l===Et?d:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(d&3)===0||Ot(l,d)||(s=!0,Th(l,d));l=l.next}while(s);Sd=!1}}function Z0(){vh()}function vh(){tc=vd=!1;var t=0;ta!==0&&ub()&&(t=ta);for(var n=Ve(),s=null,l=ec;l!==null;){var u=l.next,d=Sh(l,n);d===0?(l.next=null,s===null?ec=u:s.next=u,u===null&&(Mo=s)):(s=l,(t!==0||(d&3)!==0)&&(tc=!0)),l=u}gn!==0&&gn!==5||Ml(t),ta!==0&&(ta=0)}function Sh(t,n){for(var s=t.suspendedLanes,l=t.pingedLanes,u=t.expirationTimes,d=t.pendingLanes&-62914561;0<d;){var x=31-_t(d),T=1<<x,L=u[x];L===-1?((T&s)===0||(T&l)!==0)&&(u[x]=on(T,n)):L<=n&&(t.expiredLanes|=T),d&=~T}if(n=Et,s=Qe,s=Fe(t,t===n?s:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l=t.callbackNode,s===0||t===n&&(mt===2||mt===9)||t.cancelPendingCommit!==null)return l!==null&&l!==null&&Qt(l),t.callbackNode=null,t.callbackPriority=0;if((s&3)===0||Ot(t,s)){if(n=s&-s,n===t.callbackPriority)return n;switch(l!==null&&Qt(l),Ii(s)){case 2:case 8:s=kn;break;case 32:s=pn;break;case 268435456:s=sn;break;default:s=pn}return l=Ah.bind(null,t),s=Tn(s,l),t.callbackPriority=n,t.callbackNode=s,n}return l!==null&&l!==null&&Qt(l),t.callbackPriority=2,t.callbackNode=null,2}function Ah(t,n){if(gn!==0&&gn!==5)return t.callbackNode=null,t.callbackPriority=0,null;var s=t.callbackNode;if(Zr()&&t.callbackNode!==s)return null;var l=Qe;return l=Fe(t,t===Et?l:0,t.cancelPendingCommit!==null||t.timeoutHandle!==-1),l===0?null:(ih(t,l,n),Sh(t,Ve()),t.callbackNode!=null&&t.callbackNode===s?Ah.bind(null,t):null)}function Th(t,n){if(Zr())return null;ih(t,n,!0)}function eb(){fb(function(){(at&6)!==0?Tn($i,Z0):vh()})}function Ad(){if(ta===0){var t=fo;t===0&&(t=Zt,Zt<<=1,(Zt&261888)===0&&(Zt=256)),ta=t}return ta}function Eh(t){return t==null||typeof t=="symbol"||typeof t=="boolean"?null:typeof t=="function"?t:Wi(""+t)}function wh(t,n){var s=n.ownerDocument.createElement("input");return s.name=n.name,s.value=n.value,t.id&&s.setAttribute("form",t.id),n.parentNode.insertBefore(s,n),t=new FormData(t),s.parentNode.removeChild(s),t}function tb(t,n,s,l,u){if(n==="submit"&&s&&s.stateNode===u){var d=Eh((u[te]||null).action),x=l.submitter;x&&(n=(n=x[te]||null)?Eh(n.formAction):x.getAttribute("formAction"),n!==null&&(d=n,x=null));var T=new js("action","action",null,l,u);t.push({event:T,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(ta!==0){var L=x?wh(u,x):new FormData(u);zu(s,{pending:!0,data:L,method:u.method,action:d},null,L)}}else typeof d=="function"&&(T.preventDefault(),L=x?wh(u,x):new FormData(u),zu(s,{pending:!0,data:L,method:u.method,action:d},d,L))},currentTarget:u}]})}}for(var Td=0;Td<au.length;Td++){var Ed=au[Td],nb=Ed.toLowerCase(),ib=Ed[0].toUpperCase()+Ed.slice(1);ji(nb,"on"+ib)}ji(nm,"onAnimationEnd"),ji(im,"onAnimationIteration"),ji(sm,"onAnimationStart"),ji("dblclick","onDoubleClick"),ji("focusin","onFocus"),ji("focusout","onBlur"),ji(x0,"onTransitionRun"),ji(v0,"onTransitionStart"),ji(S0,"onTransitionCancel"),ji(am,"onTransitionEnd"),ti("onMouseEnter",["mouseout","mouseover"]),ti("onMouseLeave",["mouseout","mouseover"]),ti("onPointerEnter",["pointerout","pointerover"]),ti("onPointerLeave",["pointerout","pointerover"]),Fn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sb=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ol));function _h(t,n){n=(n&4)!==0;for(var s=0;s<t.length;s++){var l=t[s],u=l.event;l=l.listeners;e:{var d=void 0;if(n)for(var x=l.length-1;0<=x;x--){var T=l[x],L=T.instance,U=T.currentTarget;if(T=T.listener,L!==d&&u.isPropagationStopped())break e;d=T,u.currentTarget=U;try{d(u)}catch(Q){gr(Q)}u.currentTarget=null,d=L}else for(x=0;x<l.length;x++){if(T=l[x],L=T.instance,U=T.currentTarget,T=T.listener,L!==d&&u.isPropagationStopped())break e;d=T,u.currentTarget=U;try{d(u)}catch(Q){gr(Q)}u.currentTarget=null,d=L}}}}function We(t,n){var s=n[we];s===void 0&&(s=n[we]=new Set);var l=t+"__bubble";s.has(l)||(Mh(n,t,2,!1),s.add(l))}function wd(t,n,s){var l=0;n&&(l|=4),Mh(s,t,l,n)}var nc="_reactListening"+Math.random().toString(36).slice(2);function _d(t){if(!t[nc]){t[nc]=!0,ls.forEach(function(s){s!=="selectionchange"&&(sb.has(s)||wd(s,!1,t),wd(s,!0,t))});var n=t.nodeType===9?t:t.ownerDocument;n===null||n[nc]||(n[nc]=!0,wd("selectionchange",!1,n))}}function Mh(t,n,s,l){switch(ng(n)){case 2:var u=kb;break;case 8:u=Lb;break;default:u=qd}s=u.bind(null,n,s,t),u=void 0,!Qi||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),l?u!==void 0?t.addEventListener(n,s,{capture:!0,passive:u}):t.addEventListener(n,s,!0):u!==void 0?t.addEventListener(n,s,{passive:u}):t.addEventListener(n,s,!1)}function Md(t,n,s,l,u){var d=l;if((n&1)===0&&(n&2)===0&&l!==null)e:for(;;){if(l===null)return;var x=l.tag;if(x===3||x===4){var T=l.stateNode.containerInfo;if(T===u)break;if(x===4)for(x=l.return;x!==null;){var L=x.tag;if((L===3||L===4)&&x.stateNode.containerInfo===u)return;x=x.return}for(;T!==null;){if(x=Ke(T),x===null)return;if(L=x.tag,L===5||L===6||L===26||L===27){l=d=x;continue e}T=T.parentNode}}l=l.return}rr(function(){var U=d,Q=Vo(s),ie=[];e:{var V=om.get(t);if(V!==void 0){var W=js,Se=t;switch(t){case"keypress":if(to(s)===0)break e;case"keydown":case"keyup":W=Dn;break;case"focusin":Se="focus",W=le;break;case"focusout":Se="blur",W=le;break;case"beforeblur":case"afterblur":W=le;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=De;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=B;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=mr;break;case nm:case im:case sm:W=fe;break;case am:W=Wc;break;case"scroll":case"scrollend":W=dr;break;case"wheel":W=Wo;break;case"copy":case"cut":case"paste":W=Xe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=Go;break;case"toggle":case"beforetoggle":W=Qc}var Ne=(n&4)!==0,xt=!Ne&&(t==="scroll"||t==="scrollend"),D=Ne?V!==null?V+"Capture":null:V;Ne=[];for(var j=U,P;j!==null;){var Z=j;if(P=Z.stateNode,Z=Z.tag,Z!==5&&Z!==26&&Z!==27||P===null||D===null||(Z=Sa(j,D),Z!=null&&Ne.push(Cl(j,Z,P))),xt)break;j=j.return}0<Ne.length&&(V=new W(V,Se,null,s,Q),ie.push({event:V,listeners:Ne}))}}if((n&7)===0){e:{if(V=t==="mouseover"||t==="pointerover",W=t==="mouseout"||t==="pointerout",V&&s!==$o&&(Se=s.relatedTarget||s.fromElement)&&(Ke(Se)||Se[de]))break e;if((W||V)&&(V=Q.window===Q?Q:(V=Q.ownerDocument)?V.defaultView||V.parentWindow:window,W?(Se=s.relatedTarget||s.toElement,W=U,Se=Se?Ke(Se):null,Se!==null&&(xt=r(Se),Ne=Se.tag,Se!==xt||Ne!==5&&Ne!==27&&Ne!==6)&&(Se=null)):(W=null,Se=U),W!==Se)){if(Ne=De,Z="onMouseLeave",D="onMouseEnter",j="mouse",(t==="pointerout"||t==="pointerover")&&(Ne=Go,Z="onPointerLeave",D="onPointerEnter",j="pointer"),xt=W==null?V:Kt(W),P=Se==null?V:Kt(Se),V=new Ne(Z,j+"leave",W,s,Q),V.target=xt,V.relatedTarget=P,Z=null,Ke(Q)===U&&(Ne=new Ne(D,j+"enter",Se,s,Q),Ne.target=P,Ne.relatedTarget=xt,Z=Ne),xt=Z,W&&Se)t:{for(Ne=ab,D=W,j=Se,P=0,Z=D;Z;Z=Ne(Z))P++;Z=0;for(var Oe=j;Oe;Oe=Ne(Oe))Z++;for(;0<P-Z;)D=Ne(D),P--;for(;0<Z-P;)j=Ne(j),Z--;for(;P--;){if(D===j||j!==null&&D===j.alternate){Ne=D;break t}D=Ne(D),j=Ne(j)}Ne=null}else Ne=null;W!==null&&Oh(ie,V,W,Ne,!1),Se!==null&&xt!==null&&Oh(ie,xt,Se,Ne,!0)}}e:{if(V=U?Kt(U):window,W=V.nodeName&&V.nodeName.toLowerCase(),W==="select"||W==="input"&&V.type==="file")var it=Yf;else if($f(V))if(Ff)it=g0;else{it=p0;var Ae=m0}else W=V.nodeName,!W||W.toLowerCase()!=="input"||V.type!=="checkbox"&&V.type!=="radio"?U&&Gi(U.elementType)&&(it=Yf):it=h0;if(it&&(it=it(t,U))){Vf(ie,it,s,Q);break e}Ae&&Ae(t,V,U),t==="focusout"&&U&&V.type==="number"&&U.memoizedProps.value!=null&&bi(V,"number",V.value)}switch(Ae=U?Kt(U):window,t){case"focusin":($f(Ae)||Ae.contentEditable==="true")&&(io=Ae,nu=U,sl=null);break;case"focusout":sl=nu=io=null;break;case"mousedown":iu=!0;break;case"contextmenu":case"mouseup":case"dragend":iu=!1,em(ie,s,Q);break;case"selectionchange":if(b0)break;case"keydown":case"keyup":em(ie,s,Q)}var Pe;if(Ps)e:{switch(t){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else no?qf(t,s)&&(Je="onCompositionEnd"):t==="keydown"&&s.keyCode===229&&(Je="onCompositionStart");Je&&(Jo&&s.locale!=="ko"&&(no||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&no&&(Pe=cr()):(Ji=Q,Bs="value"in Ji?Ji.value:Ji.textContent,no=!0)),Ae=ic(U,Je),0<Ae.length&&(Je=new Dt(Je,t,null,s,Q),ie.push({event:Je,listeners:Ae}),Pe?Je.data=Pe:(Pe=zf(s),Pe!==null&&(Je.data=Pe)))),(Pe=Qo?c0(t,s):u0(t,s))&&(Je=ic(U,"onBeforeInput"),0<Je.length&&(Ae=new Dt("onBeforeInput","beforeinput",null,s,Q),ie.push({event:Ae,listeners:Je}),Ae.data=Pe)),tb(ie,t,U,s,Q)}_h(ie,n)})}function Cl(t,n,s){return{instance:t,listener:n,currentTarget:s}}function ic(t,n){for(var s=n+"Capture",l=[];t!==null;){var u=t,d=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||d===null||(u=Sa(t,s),u!=null&&l.unshift(Cl(t,u,d)),u=Sa(t,n),u!=null&&l.push(Cl(t,u,d))),t.tag===3)return l;t=t.return}return[]}function ab(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5&&t.tag!==27);return t||null}function Oh(t,n,s,l,u){for(var d=n._reactName,x=[];s!==null&&s!==l;){var T=s,L=T.alternate,U=T.stateNode;if(T=T.tag,L!==null&&L===l)break;T!==5&&T!==26&&T!==27||U===null||(L=U,u?(U=Sa(s,d),U!=null&&x.unshift(Cl(s,U,L))):u||(U=Sa(s,d),U!=null&&x.push(Cl(s,U,L)))),s=s.return}x.length!==0&&t.push({event:n,listeners:x})}var ob=/\r\n?/g,lb=/\u0000|\uFFFD/g;function Ch(t){return(typeof t=="string"?t:""+t).replace(ob,`
`).replace(lb,"")}function Nh(t,n){return n=Ch(n),Ch(t)===n}function bt(t,n,s,l,u,d){switch(s){case"children":typeof l=="string"?n==="body"||n==="textarea"&&l===""||Is(t,l):(typeof l=="number"||typeof l=="bigint")&&n!=="body"&&Is(t,""+l);break;case"className":ii(t,"class",l);break;case"tabIndex":ii(t,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":ii(t,s,l);break;case"style":Ja(t,l,d);break;case"data":if(n!=="object"){ii(t,"data",l);break}case"src":case"href":if(l===""&&(n!=="a"||s!=="href")){t.removeAttribute(s);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(s);break}l=Wi(""+l),t.setAttribute(s,l);break;case"action":case"formAction":if(typeof l=="function"){t.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(n!=="input"&&bt(t,n,"name",u.name,u,null),bt(t,n,"formEncType",u.formEncType,u,null),bt(t,n,"formMethod",u.formMethod,u,null),bt(t,n,"formTarget",u.formTarget,u,null)):(bt(t,n,"encType",u.encType,u,null),bt(t,n,"method",u.method,u,null),bt(t,n,"target",u.target,u,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){t.removeAttribute(s);break}l=Wi(""+l),t.setAttribute(s,l);break;case"onClick":l!=null&&(t.onclick=xi);break;case"onScroll":l!=null&&We("scroll",t);break;case"onScrollEnd":l!=null&&We("scrollend",t);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));t.innerHTML=s}}break;case"multiple":t.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":t.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){t.removeAttribute("xlink:href");break}s=Wi(""+l),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(s,""+l):t.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(s,""):t.removeAttribute(s);break;case"capture":case"download":l===!0?t.setAttribute(s,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?t.setAttribute(s,l):t.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?t.setAttribute(s,l):t.removeAttribute(s);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?t.removeAttribute(s):t.setAttribute(s,l);break;case"popover":We("beforetoggle",t),We("toggle",t),ni(t,"popover",l);break;case"xlinkActuate":jn(t,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":jn(t,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":jn(t,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":jn(t,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":jn(t,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":jn(t,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":jn(t,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":jn(t,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":jn(t,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":ni(t,"is",l);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=zo.get(s)||s,ni(t,s,l))}}function Od(t,n,s,l,u,d){switch(s){case"style":Ja(t,l,d);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));t.innerHTML=s}}break;case"children":typeof l=="string"?Is(t,l):(typeof l=="number"||typeof l=="bigint")&&Is(t,""+l);break;case"onScroll":l!=null&&We("scroll",t);break;case"onScrollEnd":l!=null&&We("scrollend",t);break;case"onClick":l!=null&&(t.onclick=xi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ya.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(u=s.endsWith("Capture"),n=s.slice(2,u?s.length-7:void 0),d=t[te]||null,d=d!=null?d[s]:null,typeof d=="function"&&t.removeEventListener(n,d,u),typeof l=="function")){typeof d!="function"&&d!==null&&(s in t?t[s]=null:t.hasAttribute(s)&&t.removeAttribute(s)),t.addEventListener(n,l,u);break e}s in t?t[s]=l:l===!0?t.setAttribute(s,""):ni(t,s,l)}}}function Cn(t,n,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":We("error",t),We("load",t);var l=!1,u=!1,d;for(d in s)if(s.hasOwnProperty(d)){var x=s[d];if(x!=null)switch(d){case"src":l=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:bt(t,n,d,x,s,null)}}u&&bt(t,n,"srcSet",s.srcSet,s,null),l&&bt(t,n,"src",s.src,s,null);return;case"input":We("invalid",t);var T=d=x=u=null,L=null,U=null;for(l in s)if(s.hasOwnProperty(l)){var Q=s[l];if(Q!=null)switch(l){case"name":u=Q;break;case"type":x=Q;break;case"checked":L=Q;break;case"defaultChecked":U=Q;break;case"value":d=Q;break;case"defaultValue":T=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(o(137,n));break;default:bt(t,n,l,Q,s,null)}}Po(t,d,T,L,U,x,u,!1);return;case"select":We("invalid",t),l=x=d=null;for(u in s)if(s.hasOwnProperty(u)&&(T=s[u],T!=null))switch(u){case"value":d=T;break;case"defaultValue":x=T;break;case"multiple":l=T;default:bt(t,n,u,T,s,null)}n=d,s=x,t.multiple=!!l,n!=null?cs(t,!!l,n,!1):s!=null&&cs(t,!!l,s,!0);return;case"textarea":We("invalid",t),d=u=l=null;for(x in s)if(s.hasOwnProperty(x)&&(T=s[x],T!=null))switch(x){case"value":l=T;break;case"defaultValue":u=T;break;case"children":d=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(o(91));break;default:bt(t,n,x,T,s,null)}or(t,l,u,d);return;case"option":for(L in s)s.hasOwnProperty(L)&&(l=s[L],l!=null)&&(L==="selected"?t.selected=l&&typeof l!="function"&&typeof l!="symbol":bt(t,n,L,l,s,null));return;case"dialog":We("beforetoggle",t),We("toggle",t),We("cancel",t),We("close",t);break;case"iframe":case"object":We("load",t);break;case"video":case"audio":for(l=0;l<Ol.length;l++)We(Ol[l],t);break;case"image":We("error",t),We("load",t);break;case"details":We("toggle",t);break;case"embed":case"source":case"link":We("error",t),We("load",t);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(U in s)if(s.hasOwnProperty(U)&&(l=s[U],l!=null))switch(U){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:bt(t,n,U,l,s,null)}return;default:if(Gi(n)){for(Q in s)s.hasOwnProperty(Q)&&(l=s[Q],l!==void 0&&Od(t,n,Q,l,s,void 0));return}}for(T in s)s.hasOwnProperty(T)&&(l=s[T],l!=null&&bt(t,n,T,l,s,null))}function rb(t,n,s,l){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,d=null,x=null,T=null,L=null,U=null,Q=null;for(W in s){var ie=s[W];if(s.hasOwnProperty(W)&&ie!=null)switch(W){case"checked":break;case"value":break;case"defaultValue":L=ie;default:l.hasOwnProperty(W)||bt(t,n,W,null,l,ie)}}for(var V in l){var W=l[V];if(ie=s[V],l.hasOwnProperty(V)&&(W!=null||ie!=null))switch(V){case"type":d=W;break;case"name":u=W;break;case"checked":U=W;break;case"defaultChecked":Q=W;break;case"value":x=W;break;case"defaultValue":T=W;break;case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(o(137,n));break;default:W!==ie&&bt(t,n,V,W,l,ie)}}Qa(t,x,T,L,U,Q,d,u);return;case"select":W=x=T=V=null;for(d in s)if(L=s[d],s.hasOwnProperty(d)&&L!=null)switch(d){case"value":break;case"multiple":W=L;default:l.hasOwnProperty(d)||bt(t,n,d,null,l,L)}for(u in l)if(d=l[u],L=s[u],l.hasOwnProperty(u)&&(d!=null||L!=null))switch(u){case"value":V=d;break;case"defaultValue":T=d;break;case"multiple":x=d;default:d!==L&&bt(t,n,u,d,l,L)}n=T,s=x,l=W,V!=null?cs(t,!!s,V,!1):!!l!=!!s&&(n!=null?cs(t,!!s,n,!0):cs(t,!!s,s?[]:"",!1));return;case"textarea":W=V=null;for(T in s)if(u=s[T],s.hasOwnProperty(T)&&u!=null&&!l.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:bt(t,n,T,null,l,u)}for(x in l)if(u=l[x],d=s[x],l.hasOwnProperty(x)&&(u!=null||d!=null))switch(x){case"value":V=u;break;case"defaultValue":W=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(o(91));break;default:u!==d&&bt(t,n,x,u,l,d)}Uo(t,V,W);return;case"option":for(var Se in s)V=s[Se],s.hasOwnProperty(Se)&&V!=null&&!l.hasOwnProperty(Se)&&(Se==="selected"?t.selected=!1:bt(t,n,Se,null,l,V));for(L in l)V=l[L],W=s[L],l.hasOwnProperty(L)&&V!==W&&(V!=null||W!=null)&&(L==="selected"?t.selected=V&&typeof V!="function"&&typeof V!="symbol":bt(t,n,L,V,l,W));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ne in s)V=s[Ne],s.hasOwnProperty(Ne)&&V!=null&&!l.hasOwnProperty(Ne)&&bt(t,n,Ne,null,l,V);for(U in l)if(V=l[U],W=s[U],l.hasOwnProperty(U)&&V!==W&&(V!=null||W!=null))switch(U){case"children":case"dangerouslySetInnerHTML":if(V!=null)throw Error(o(137,n));break;default:bt(t,n,U,V,l,W)}return;default:if(Gi(n)){for(var xt in s)V=s[xt],s.hasOwnProperty(xt)&&V!==void 0&&!l.hasOwnProperty(xt)&&Od(t,n,xt,void 0,l,V);for(Q in l)V=l[Q],W=s[Q],!l.hasOwnProperty(Q)||V===W||V===void 0&&W===void 0||Od(t,n,Q,V,l,W);return}}for(var D in s)V=s[D],s.hasOwnProperty(D)&&V!=null&&!l.hasOwnProperty(D)&&bt(t,n,D,null,l,V);for(ie in l)V=l[ie],W=s[ie],!l.hasOwnProperty(ie)||V===W||V==null&&W==null||bt(t,n,ie,V,l,W)}function Rh(t){switch(t){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function cb(){if(typeof performance.getEntriesByType=="function"){for(var t=0,n=0,s=performance.getEntriesByType("resource"),l=0;l<s.length;l++){var u=s[l],d=u.transferSize,x=u.initiatorType,T=u.duration;if(d&&T&&Rh(x)){for(x=0,T=u.responseEnd,l+=1;l<s.length;l++){var L=s[l],U=L.startTime;if(U>T)break;var Q=L.transferSize,ie=L.initiatorType;Q&&Rh(ie)&&(L=L.responseEnd,x+=Q*(L<T?1:(T-U)/(L-U)))}if(--l,n+=8*(d+x)/(u.duration/1e3),t++,10<t)break}}if(0<t)return n/t/1e6}return navigator.connection&&(t=navigator.connection.downlink,typeof t=="number")?t:5}var Cd=null,Nd=null;function sc(t){return t.nodeType===9?t:t.ownerDocument}function kh(t){switch(t){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Lh(t,n){if(t===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return t===1&&n==="foreignObject"?0:t}function Rd(t,n){return t==="textarea"||t==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var kd=null;function ub(){var t=window.event;return t&&t.type==="popstate"?t===kd?!1:(kd=t,!0):(kd=null,!1)}var Ih=typeof setTimeout=="function"?setTimeout:void 0,db=typeof clearTimeout=="function"?clearTimeout:void 0,Bh=typeof Promise=="function"?Promise:void 0,fb=typeof queueMicrotask=="function"?queueMicrotask:typeof Bh<"u"?function(t){return Bh.resolve(null).then(t).catch(mb)}:Ih;function mb(t){setTimeout(function(){throw t})}function na(t){return t==="head"}function jh(t,n){var s=n,l=0;do{var u=s.nextSibling;if(t.removeChild(s),u&&u.nodeType===8)if(s=u.data,s==="/$"||s==="/&"){if(l===0){t.removeChild(u),Ro(n);return}l--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")l++;else if(s==="html")Nl(t.ownerDocument.documentElement);else if(s==="head"){s=t.ownerDocument.head,Nl(s);for(var d=s.firstChild;d;){var x=d.nextSibling,T=d.nodeName;d[Ct]||T==="SCRIPT"||T==="STYLE"||T==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=x}}else s==="body"&&Nl(t.ownerDocument.body);s=u}while(s);Ro(n)}function Dh(t,n){var s=t;t=0;do{var l=s.nextSibling;if(s.nodeType===1?n?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(n?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),l&&l.nodeType===8)if(s=l.data,s==="/$"){if(t===0)break;t--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||t++;s=l}while(s)}function Ld(t){var n=t.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var s=n;switch(n=n.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":Ld(s),lt(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}t.removeChild(s)}}function pb(t,n,s,l){for(;t.nodeType===1;){var u=s;if(t.nodeName.toLowerCase()!==n.toLowerCase()){if(!l&&(t.nodeName!=="INPUT"||t.type!=="hidden"))break}else if(l){if(!t[Ct])switch(n){case"meta":if(!t.hasAttribute("itemprop"))break;return t;case"link":if(d=t.getAttribute("rel"),d==="stylesheet"&&t.hasAttribute("data-precedence"))break;if(d!==u.rel||t.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||t.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||t.getAttribute("title")!==(u.title==null?null:u.title))break;return t;case"style":if(t.hasAttribute("data-precedence"))break;return t;case"script":if(d=t.getAttribute("src"),(d!==(u.src==null?null:u.src)||t.getAttribute("type")!==(u.type==null?null:u.type)||t.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&d&&t.hasAttribute("async")&&!t.hasAttribute("itemprop"))break;return t;default:return t}}else if(n==="input"&&t.type==="hidden"){var d=u.name==null?null:""+u.name;if(u.type==="hidden"&&t.getAttribute("name")===d)return t}else return t;if(t=Oi(t.nextSibling),t===null)break}return null}function hb(t,n,s){if(n==="")return null;for(;t.nodeType!==3;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!s||(t=Oi(t.nextSibling),t===null))return null;return t}function Hh(t,n){for(;t.nodeType!==8;)if((t.nodeType!==1||t.nodeName!=="INPUT"||t.type!=="hidden")&&!n||(t=Oi(t.nextSibling),t===null))return null;return t}function Id(t){return t.data==="$?"||t.data==="$~"}function Bd(t){return t.data==="$!"||t.data==="$?"&&t.ownerDocument.readyState!=="loading"}function gb(t,n){var s=t.ownerDocument;if(t.data==="$~")t._reactRetry=n;else if(t.data!=="$?"||s.readyState!=="loading")n();else{var l=function(){n(),s.removeEventListener("DOMContentLoaded",l)};s.addEventListener("DOMContentLoaded",l),t._reactRetry=l}}function Oi(t){for(;t!=null;t=t.nextSibling){var n=t.nodeType;if(n===1||n===3)break;if(n===8){if(n=t.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return t}var jd=null;function Ph(t){t=t.nextSibling;for(var n=0;t;){if(t.nodeType===8){var s=t.data;if(s==="/$"||s==="/&"){if(n===0)return Oi(t.nextSibling);n--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||n++}t=t.nextSibling}return null}function Uh(t){t=t.previousSibling;for(var n=0;t;){if(t.nodeType===8){var s=t.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(n===0)return t;n--}else s!=="/$"&&s!=="/&"||n++}t=t.previousSibling}return null}function qh(t,n,s){switch(n=sc(s),t){case"html":if(t=n.documentElement,!t)throw Error(o(452));return t;case"head":if(t=n.head,!t)throw Error(o(453));return t;case"body":if(t=n.body,!t)throw Error(o(454));return t;default:throw Error(o(451))}}function Nl(t){for(var n=t.attributes;n.length;)t.removeAttributeNode(n[0]);lt(t)}var Ci=new Map,zh=new Set;function ac(t){return typeof t.getRootNode=="function"?t.getRootNode():t.nodeType===9?t:t.ownerDocument}var _s=ee.d;ee.d={f:yb,r:bb,D:xb,C:vb,L:Sb,m:Ab,X:Eb,S:Tb,M:wb};function yb(){var t=_s.f(),n=Xr();return t||n}function bb(t){var n=rt(t);n!==null&&n.tag===5&&n.type==="form"?ap(n):_s.r(t)}var Oo=typeof document>"u"?null:document;function $h(t,n,s){var l=Oo;if(l&&typeof n=="string"&&n){var u=Kn(n);u='link[rel="'+t+'"][href="'+u+'"]',typeof s=="string"&&(u+='[crossorigin="'+s+'"]'),zh.has(u)||(zh.add(u),t={rel:t,crossOrigin:s,href:n},l.querySelector(u)===null&&(n=l.createElement("link"),Cn(n,"link",t),Nt(n),l.head.appendChild(n)))}}function xb(t){_s.D(t),$h("dns-prefetch",t,null)}function vb(t,n){_s.C(t,n),$h("preconnect",t,n)}function Sb(t,n,s){_s.L(t,n,s);var l=Oo;if(l&&t&&n){var u='link[rel="preload"][as="'+Kn(n)+'"]';n==="image"&&s&&s.imageSrcSet?(u+='[imagesrcset="'+Kn(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(u+='[imagesizes="'+Kn(s.imageSizes)+'"]')):u+='[href="'+Kn(t)+'"]';var d=u;switch(n){case"style":d=Co(t);break;case"script":d=No(t)}Ci.has(d)||(t=v({rel:"preload",href:n==="image"&&s&&s.imageSrcSet?void 0:t,as:n},s),Ci.set(d,t),l.querySelector(u)!==null||n==="style"&&l.querySelector(Rl(d))||n==="script"&&l.querySelector(kl(d))||(n=l.createElement("link"),Cn(n,"link",t),Nt(n),l.head.appendChild(n)))}}function Ab(t,n){_s.m(t,n);var s=Oo;if(s&&t){var l=n&&typeof n.as=="string"?n.as:"script",u='link[rel="modulepreload"][as="'+Kn(l)+'"][href="'+Kn(t)+'"]',d=u;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=No(t)}if(!Ci.has(d)&&(t=v({rel:"modulepreload",href:t},n),Ci.set(d,t),s.querySelector(u)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(kl(d)))return}l=s.createElement("link"),Cn(l,"link",t),Nt(l),s.head.appendChild(l)}}}function Tb(t,n,s){_s.S(t,n,s);var l=Oo;if(l&&t){var u=Bn(l).hoistableStyles,d=Co(t);n=n||"default";var x=u.get(d);if(!x){var T={loading:0,preload:null};if(x=l.querySelector(Rl(d)))T.loading=5;else{t=v({rel:"stylesheet",href:t,"data-precedence":n},s),(s=Ci.get(d))&&Dd(t,s);var L=x=l.createElement("link");Nt(L),Cn(L,"link",t),L._p=new Promise(function(U,Q){L.onload=U,L.onerror=Q}),L.addEventListener("load",function(){T.loading|=1}),L.addEventListener("error",function(){T.loading|=2}),T.loading|=4,oc(x,n,l)}x={type:"stylesheet",instance:x,count:1,state:T},u.set(d,x)}}}function Eb(t,n){_s.X(t,n);var s=Oo;if(s&&t){var l=Bn(s).hoistableScripts,u=No(t),d=l.get(u);d||(d=s.querySelector(kl(u)),d||(t=v({src:t,async:!0},n),(n=Ci.get(u))&&Hd(t,n),d=s.createElement("script"),Nt(d),Cn(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(u,d))}}function wb(t,n){_s.M(t,n);var s=Oo;if(s&&t){var l=Bn(s).hoistableScripts,u=No(t),d=l.get(u);d||(d=s.querySelector(kl(u)),d||(t=v({src:t,async:!0,type:"module"},n),(n=Ci.get(u))&&Hd(t,n),d=s.createElement("script"),Nt(d),Cn(d,"link",t),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(u,d))}}function Vh(t,n,s,l){var u=(u=Re.current)?ac(u):null;if(!u)throw Error(o(446));switch(t){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(n=Co(s.href),s=Bn(u).hoistableStyles,l=s.get(n),l||(l={type:"style",instance:null,count:0,state:null},s.set(n,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){t=Co(s.href);var d=Bn(u).hoistableStyles,x=d.get(t);if(x||(u=u.ownerDocument||u,x={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(t,x),(d=u.querySelector(Rl(t)))&&!d._p&&(x.instance=d,x.state.loading=5),Ci.has(t)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},Ci.set(t,s),d||_b(u,t,s,x.state))),n&&l===null)throw Error(o(528,""));return x}if(n&&l!==null)throw Error(o(529,""));return null;case"script":return n=s.async,s=s.src,typeof s=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=No(s),s=Bn(u).hoistableScripts,l=s.get(n),l||(l={type:"script",instance:null,count:0,state:null},s.set(n,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,t))}}function Co(t){return'href="'+Kn(t)+'"'}function Rl(t){return'link[rel="stylesheet"]['+t+"]"}function Yh(t){return v({},t,{"data-precedence":t.precedence,precedence:null})}function _b(t,n,s,l){t.querySelector('link[rel="preload"][as="style"]['+n+"]")?l.loading=1:(n=t.createElement("link"),l.preload=n,n.addEventListener("load",function(){return l.loading|=1}),n.addEventListener("error",function(){return l.loading|=2}),Cn(n,"link",s),Nt(n),t.head.appendChild(n))}function No(t){return'[src="'+Kn(t)+'"]'}function kl(t){return"script[async]"+t}function Fh(t,n,s){if(n.count++,n.instance===null)switch(n.type){case"style":var l=t.querySelector('style[data-href~="'+Kn(s.href)+'"]');if(l)return n.instance=l,Nt(l),l;var u=v({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return l=(t.ownerDocument||t).createElement("style"),Nt(l),Cn(l,"style",u),oc(l,s.precedence,t),n.instance=l;case"stylesheet":u=Co(s.href);var d=t.querySelector(Rl(u));if(d)return n.state.loading|=4,n.instance=d,Nt(d),d;l=Yh(s),(u=Ci.get(u))&&Dd(l,u),d=(t.ownerDocument||t).createElement("link"),Nt(d);var x=d;return x._p=new Promise(function(T,L){x.onload=T,x.onerror=L}),Cn(d,"link",l),n.state.loading|=4,oc(d,s.precedence,t),n.instance=d;case"script":return d=No(s.src),(u=t.querySelector(kl(d)))?(n.instance=u,Nt(u),u):(l=s,(u=Ci.get(d))&&(l=v({},s),Hd(l,u)),t=t.ownerDocument||t,u=t.createElement("script"),Nt(u),Cn(u,"link",l),t.head.appendChild(u),n.instance=u);case"void":return null;default:throw Error(o(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(l=n.instance,n.state.loading|=4,oc(l,s.precedence,t));return n.instance}function oc(t,n,s){for(var l=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=l.length?l[l.length-1]:null,d=u,x=0;x<l.length;x++){var T=l[x];if(T.dataset.precedence===n)d=T;else if(d!==u)break}d?d.parentNode.insertBefore(t,d.nextSibling):(n=s.nodeType===9?s.head:s,n.insertBefore(t,n.firstChild))}function Dd(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.title==null&&(t.title=n.title)}function Hd(t,n){t.crossOrigin==null&&(t.crossOrigin=n.crossOrigin),t.referrerPolicy==null&&(t.referrerPolicy=n.referrerPolicy),t.integrity==null&&(t.integrity=n.integrity)}var lc=null;function Kh(t,n,s){if(lc===null){var l=new Map,u=lc=new Map;u.set(s,l)}else u=lc,l=u.get(s),l||(l=new Map,u.set(s,l));if(l.has(t))return l;for(l.set(t,null),s=s.getElementsByTagName(t),u=0;u<s.length;u++){var d=s[u];if(!(d[Ct]||d[F]||t==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var x=d.getAttribute(n)||"";x=t+x;var T=l.get(x);T?T.push(d):l.set(x,[d])}}return l}function Gh(t,n,s){t=t.ownerDocument||t,t.head.insertBefore(s,n==="title"?t.querySelector("head > title"):null)}function Mb(t,n,s){if(s===1||n.itemProp!=null)return!1;switch(t){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;return n.rel==="stylesheet"?(t=n.disabled,typeof n.precedence=="string"&&t==null):!0;case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Wh(t){return!(t.type==="stylesheet"&&(t.state.loading&3)===0)}function Ob(t,n,s,l){if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var u=Co(l.href),d=n.querySelector(Rl(u));if(d){n=d._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(t.count++,t=rc.bind(t),n.then(t,t)),s.state.loading|=4,s.instance=d,Nt(d);return}d=n.ownerDocument||n,l=Yh(l),(u=Ci.get(u))&&Dd(l,u),d=d.createElement("link"),Nt(d);var x=d;x._p=new Promise(function(T,L){x.onload=T,x.onerror=L}),Cn(d,"link",l),s.instance=d}t.stylesheets===null&&(t.stylesheets=new Map),t.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(t.count++,s=rc.bind(t),n.addEventListener("load",s),n.addEventListener("error",s))}}var Pd=0;function Cb(t,n){return t.stylesheets&&t.count===0&&uc(t,t.stylesheets),0<t.count||0<t.imgCount?function(s){var l=setTimeout(function(){if(t.stylesheets&&uc(t,t.stylesheets),t.unsuspend){var d=t.unsuspend;t.unsuspend=null,d()}},6e4+n);0<t.imgBytes&&Pd===0&&(Pd=62500*cb());var u=setTimeout(function(){if(t.waitingForImages=!1,t.count===0&&(t.stylesheets&&uc(t,t.stylesheets),t.unsuspend)){var d=t.unsuspend;t.unsuspend=null,d()}},(t.imgBytes>Pd?50:800)+n);return t.unsuspend=s,function(){t.unsuspend=null,clearTimeout(l),clearTimeout(u)}}:null}function rc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)uc(this,this.stylesheets);else if(this.unsuspend){var t=this.unsuspend;this.unsuspend=null,t()}}}var cc=null;function uc(t,n){t.stylesheets=null,t.unsuspend!==null&&(t.count++,cc=new Map,n.forEach(Nb,t),cc=null,rc.call(t))}function Nb(t,n){if(!(n.state.loading&4)){var s=cc.get(t);if(s)var l=s.get(null);else{s=new Map,cc.set(t,s);for(var u=t.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<u.length;d++){var x=u[d];(x.nodeName==="LINK"||x.getAttribute("media")!=="not all")&&(s.set(x.dataset.precedence,x),l=x)}l&&s.set(null,l)}u=n.instance,x=u.getAttribute("data-precedence"),d=s.get(x)||l,d===l&&s.set(null,u),s.set(x,u),this.count++,l=rc.bind(this),u.addEventListener("load",l),u.addEventListener("error",l),d?d.parentNode.insertBefore(u,d.nextSibling):(t=t.nodeType===9?t.head:t,t.insertBefore(u,t.firstChild)),n.state.loading|=4}}var Ll={$$typeof:M,Provider:null,Consumer:null,_currentValue:ae,_currentValue2:ae,_threadCount:0};function Rb(t,n,s,l,u,d,x,T,L){this.tag=1,this.containerInfo=t,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ft(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),this.hiddenUpdates=ft(null),this.identifierPrefix=l,this.onUncaughtError=u,this.onCaughtError=d,this.onRecoverableError=x,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=L,this.incompleteTransitions=new Map}function Xh(t,n,s,l,u,d,x,T,L,U,Q,ie){return t=new Rb(t,n,s,x,L,U,Q,ie,T),n=1,d===!0&&(n|=24),d=oi(3,null,null,n),t.current=d,d.stateNode=t,n=bu(),n.refCount++,t.pooledCache=n,n.refCount++,d.memoizedState={element:l,isDehydrated:s,cache:n},Au(d),t}function Qh(t){return t?(t=oo,t):oo}function Jh(t,n,s,l,u,d){u=Qh(u),l.context===null?l.context=u:l.pendingContext=u,l=Ys(n),l.payload={element:s},d=d===void 0?null:d,d!==null&&(l.callback=d),s=Fs(t,l,n),s!==null&&(Jn(s,t,n),dl(s,t,n))}function Zh(t,n){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var s=t.retryLane;t.retryLane=s!==0&&s<n?s:n}}function Ud(t,n){Zh(t,n),(t=t.alternate)&&Zh(t,n)}function eg(t){if(t.tag===13||t.tag===31){var n=_a(t,67108864);n!==null&&Jn(n,t,67108864),Ud(t,67108864)}}function tg(t){if(t.tag===13||t.tag===31){var n=di();n=ks(n);var s=_a(t,n);s!==null&&Jn(s,t,n),Ud(t,n)}}var dc=!0;function kb(t,n,s,l){var u=H.T;H.T=null;var d=ee.p;try{ee.p=2,qd(t,n,s,l)}finally{ee.p=d,H.T=u}}function Lb(t,n,s,l){var u=H.T;H.T=null;var d=ee.p;try{ee.p=8,qd(t,n,s,l)}finally{ee.p=d,H.T=u}}function qd(t,n,s,l){if(dc){var u=zd(l);if(u===null)Md(t,n,l,fc,s),ig(t,l);else if(Bb(u,t,n,s,l))l.stopPropagation();else if(ig(t,l),n&4&&-1<Ib.indexOf(t)){for(;u!==null;){var d=rt(u);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var x=Ft(d.pendingLanes);if(x!==0){var T=d;for(T.pendingLanes|=2,T.entangledLanes|=2;x;){var L=1<<31-_t(x);T.entanglements[1]|=L,x&=~L}is(d),(at&6)===0&&(Gr=Ve()+500,Ml(0))}}break;case 31:case 13:T=_a(d,2),T!==null&&Jn(T,d,2),Xr(),Ud(d,2)}if(d=zd(l),d===null&&Md(t,n,l,fc,s),d===u)break;u=d}u!==null&&l.stopPropagation()}else Md(t,n,l,null,s)}}function zd(t){return t=Vo(t),$d(t)}var fc=null;function $d(t){if(fc=null,t=Ke(t),t!==null){var n=r(t);if(n===null)t=null;else{var s=n.tag;if(s===13){if(t=f(n),t!==null)return t;t=null}else if(s===31){if(t=h(n),t!==null)return t;t=null}else if(s===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;t=null}else n!==t&&(t=null)}}return fc=t,null}function ng(t){switch(t){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Yt()){case $i:return 2;case kn:return 8;case pn:case Vi:return 32;case sn:return 268435456;default:return 32}default:return 32}}var Vd=!1,ia=null,sa=null,aa=null,Il=new Map,Bl=new Map,oa=[],Ib="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ig(t,n){switch(t){case"focusin":case"focusout":ia=null;break;case"dragenter":case"dragleave":sa=null;break;case"mouseover":case"mouseout":aa=null;break;case"pointerover":case"pointerout":Il.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bl.delete(n.pointerId)}}function jl(t,n,s,l,u,d){return t===null||t.nativeEvent!==d?(t={blockedOn:n,domEventName:s,eventSystemFlags:l,nativeEvent:d,targetContainers:[u]},n!==null&&(n=rt(n),n!==null&&eg(n)),t):(t.eventSystemFlags|=l,n=t.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),t)}function Bb(t,n,s,l,u){switch(n){case"focusin":return ia=jl(ia,t,n,s,l,u),!0;case"dragenter":return sa=jl(sa,t,n,s,l,u),!0;case"mouseover":return aa=jl(aa,t,n,s,l,u),!0;case"pointerover":var d=u.pointerId;return Il.set(d,jl(Il.get(d)||null,t,n,s,l,u)),!0;case"gotpointercapture":return d=u.pointerId,Bl.set(d,jl(Bl.get(d)||null,t,n,s,l,u)),!0}return!1}function sg(t){var n=Ke(t.target);if(n!==null){var s=r(n);if(s!==null){if(n=s.tag,n===13){if(n=f(s),n!==null){t.blockedOn=n,yi(t.priority,function(){tg(s)});return}}else if(n===31){if(n=h(s),n!==null){t.blockedOn=n,yi(t.priority,function(){tg(s)});return}}else if(n===3&&s.stateNode.current.memoizedState.isDehydrated){t.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}t.blockedOn=null}function mc(t){if(t.blockedOn!==null)return!1;for(var n=t.targetContainers;0<n.length;){var s=zd(t.nativeEvent);if(s===null){s=t.nativeEvent;var l=new s.constructor(s.type,s);$o=l,s.target.dispatchEvent(l),$o=null}else return n=rt(s),n!==null&&eg(n),t.blockedOn=s,!1;n.shift()}return!0}function ag(t,n,s){mc(t)&&s.delete(n)}function jb(){Vd=!1,ia!==null&&mc(ia)&&(ia=null),sa!==null&&mc(sa)&&(sa=null),aa!==null&&mc(aa)&&(aa=null),Il.forEach(ag),Bl.forEach(ag)}function pc(t,n){t.blockedOn===n&&(t.blockedOn=null,Vd||(Vd=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,jb)))}var hc=null;function og(t){hc!==t&&(hc=t,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){hc===t&&(hc=null);for(var n=0;n<t.length;n+=3){var s=t[n],l=t[n+1],u=t[n+2];if(typeof l!="function"){if($d(l||s)===null)continue;break}var d=rt(s);d!==null&&(t.splice(n,3),n-=3,zu(d,{pending:!0,data:u,method:s.method,action:l},l,u))}}))}function Ro(t){function n(L){return pc(L,t)}ia!==null&&pc(ia,t),sa!==null&&pc(sa,t),aa!==null&&pc(aa,t),Il.forEach(n),Bl.forEach(n);for(var s=0;s<oa.length;s++){var l=oa[s];l.blockedOn===t&&(l.blockedOn=null)}for(;0<oa.length&&(s=oa[0],s.blockedOn===null);)sg(s),s.blockedOn===null&&oa.shift();if(s=(t.ownerDocument||t).$$reactFormReplay,s!=null)for(l=0;l<s.length;l+=3){var u=s[l],d=s[l+1],x=u[te]||null;if(typeof d=="function")x||og(s);else if(x){var T=null;if(d&&d.hasAttribute("formAction")){if(u=d,x=d[te]||null)T=x.formAction;else if($d(u)!==null)continue}else T=x.action;typeof T=="function"?s[l+1]=T:(s.splice(l,3),l-=3),og(s)}}}function lg(){function t(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(x){return u=x})},focusReset:"manual",scroll:"manual"})}function n(){u!==null&&(u(),u=null),l||setTimeout(s,20)}function s(){if(!l&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,u=null;return navigation.addEventListener("navigate",t),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(s,100),function(){l=!0,navigation.removeEventListener("navigate",t),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),u!==null&&(u(),u=null)}}}function Yd(t){this._internalRoot=t}gc.prototype.render=Yd.prototype.render=function(t){var n=this._internalRoot;if(n===null)throw Error(o(409));var s=n.current,l=di();Jh(s,l,t,n,null,null)},gc.prototype.unmount=Yd.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var n=t.containerInfo;Jh(t.current,2,null,t,null,null),Xr(),n[de]=null}};function gc(t){this._internalRoot=t}gc.prototype.unstable_scheduleHydration=function(t){if(t){var n=Ln();t={blockedOn:null,target:t,priority:n};for(var s=0;s<oa.length&&n!==0&&n<oa[s].priority;s++);oa.splice(s,0,t),s===0&&sg(t)}};var rg=i.version;if(rg!=="19.2.3")throw Error(o(527,rg,"19.2.3"));ee.findDOMNode=function(t){var n=t._reactInternals;if(n===void 0)throw typeof t.render=="function"?Error(o(188)):(t=Object.keys(t).join(","),Error(o(268,t)));return t=y(n),t=t!==null?A(t):null,t=t===null?null:t.stateNode,t};var Db={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:H,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yc.isDisabled&&yc.supportsFiber)try{an=yc.inject(Db),wt=yc}catch{}}return Hl.createRoot=function(t,n){if(!c(t))throw Error(o(299));var s=!1,l="",u=hp,d=gp,x=yp;return n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onUncaughtError!==void 0&&(u=n.onUncaughtError),n.onCaughtError!==void 0&&(d=n.onCaughtError),n.onRecoverableError!==void 0&&(x=n.onRecoverableError)),n=Xh(t,1,!1,null,null,s,l,null,u,d,x,lg),t[de]=n.current,_d(t),new Yd(n)},Hl.hydrateRoot=function(t,n,s){if(!c(t))throw Error(o(299));var l=!1,u="",d=hp,x=gp,T=yp,L=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(x=s.onCaughtError),s.onRecoverableError!==void 0&&(T=s.onRecoverableError),s.formState!==void 0&&(L=s.formState)),n=Xh(t,1,!0,n,s??null,l,u,L,d,x,T,lg),n.context=Qh(null),s=n.current,l=di(),l=ks(l),u=Ys(l),u.callback=null,Fs(s,u,l),s=l,n.current.lanes=s,qt(n,s),is(n),t[de]=n.current,_d(t),new gc(n)},Hl.version="19.2.3",Hl}var bg;function Gb(){if(bg)return Gd.exports;bg=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(i){console.error(i)}}return e(),Gd.exports=Kb(),Gd.exports}var Wb=Gb();const Vn=(e,i)=>({q:e,r:i,s:-e-i}),Xb=e=>`${e.q},${e.r}`,he=Xb,ne=(e,i)=>e.q===i.q&&e.r===i.r&&e.s===i.s,Yn=(e,i)=>Vn(e.q+i.q,e.r+i.r),yf=(e,i)=>Vn(e.q-i.q,e.r-i.r),Ce=(e,i)=>(Math.abs(e.q-i.q)+Math.abs(e.r-i.r)+Math.abs(e.s-i.s))/2,dt=(e,i)=>{const a=i*(1.5*e.q),o=i*Math.sqrt(3)*(e.r+e.q/2);return{x:a,y:o}},xg=e=>({q:e.q,r:e.r,s:e.s??-e.q-e.r}),Qb=e=>Vn(e.q,e.r),Jb=e=>{let i=Math.round(e.q),a=Math.round(e.r),o=Math.round(e.s);const c=Math.abs(i-e.q),r=Math.abs(a-e.r),f=Math.abs(o-e.s);return c>r&&c>f?i=-a-o:r>f?a=-i-o:o=-i-a,{q:i,r:a,s:o}},nr=[Vn(1,0),Vn(1,-1),Vn(0,-1),Vn(-1,0),Vn(-1,1),Vn(0,1)],ot=e=>nr.map(i=>Yn(e,i)),Pn=e=>nr[(e%6+6)%6],Jd=(e,i,a)=>e+(i-e)*a,Ut=(e,i)=>{const a=Ce(e,i),o=[],c=xg(e),r=xg(i);for(let f=0;f<=a;f++){const h=a===0?0:f/a,b={q:Jd(c.q+1e-6,r.q+1e-6,h),r:Jd(c.r+1e-6,r.r+1e-6,h),s:Jd(c.s+1e-6,r.s+1e-6,h)};o.push(Qb(Jb(b)))}return o},fa=(e,i)=>{const a=Ce(e,i);if(a===0)return-1;const o=yf(i,e),c=o.q/a,r=o.r/a,f=(0-o.q-o.r)/a;return nr.findIndex(h=>Math.abs(h.q-c)<.01&&Math.abs(h.r-r)<.01&&Math.abs(h.s-f)<.01)};function kf(e,i){const a=Pn(e);return{q:a.q*i,r:a.r*i,s:-(a.q*i)-a.r*i}}const Uc=(e,i,a,o)=>{if(e<0||e>=a||i<0||i>=o)return!1;const c=e+i,r=Math.floor(a/2),f=a-1+(o-1)-r;return c>=r&&c<=f},Zb=(e,i)=>{const a=[];for(let o=0;o<e;o++)for(let c=0;c<i;c++)Uc(o,c,e,i)&&a.push(Vn(o,c));return a},pa=(e,i,a)=>Uc(e.q,e.r,i,a),ex=e=>{let i=2166136261;for(let a=0;a<e.length;a++)i^=e.charCodeAt(a),i=Math.imul(i,16777619)>>>0;return i>>>0},tx=e=>function(){let i=(e+=1831565813)>>>0;return i=Math.imul(i^i>>>15,i|1)>>>0,i^=i+Math.imul(i^i>>>7,i|61)>>>0,((i^i>>>14)>>>0)/4294967296},Vc=e=>{const i=typeof e=="number"?e>>>0:ex(String(e)),a=tx(i||1);return{next:()=>a(),id:(o=9)=>{const c="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let f=0;f<o;f++){const h=Math.floor(a()*c.length)%c.length;r+=c[h]}return r}}},Bo=(e,i,a=9,o="")=>{const c=`${e}:${i}:${o}`,r=Vc(c),f="abcdefghijklmnopqrstuvwxyz0123456789";let h="";for(let b=0;b<a;b++){const y=Math.floor(r.next()*f.length)%f.length;h+=f[y]}return h},qc=(e,i)=>{const a=`${e}:${i}`;return Vc(a).next()},Va=e=>{const i=e.rngSeed||"default",a=e.rngCounter||0;return{value:qc(i,a),nextState:{...e,rngCounter:a+1}}};function Ns(e){return e.statusEffects?.some(i=>i.type==="stunned")??!1}function nx(e){return e.statusEffects?.some(i=>i.type==="rooted")??!1}function vg(e,i=1){if(!e.statusEffects||e.statusEffects.length===0)return e;const a=e.statusEffects.map(o=>({...o,duration:o.duration-i})).filter(o=>o.duration>0);return{...e,statusEffects:a}}const Io={GRASS:{id:"GRASS",name:"Grass",description:"Soft grass",defaultTraits:new Set(["WALKABLE","FLAMMABLE"]),visual:{color:"#4a7c59",icon:""}},STONE:{id:"STONE",name:"Stone Floor",description:"Hard stone",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#808080",icon:""}},LAVA:{id:"LAVA",name:"Lava",description:"Molten lava",defaultTraits:new Set(["LIQUID","HAZARDOUS"]),visual:{color:"#ff4400",icon:""}},WALL:{id:"WALL",name:"Wall",description:"Solid wall",defaultTraits:new Set(["BLOCKS_LOS","BLOCKS_MOVEMENT","ANCHOR"]),visual:{color:"#333333",icon:""}},ICE:{id:"ICE",name:"Ice",description:"Slippery ice",defaultTraits:new Set(["WALKABLE","SLIPPERY"]),visual:{color:"#aaddff",icon:""}},VOID:{id:"VOID",name:"Void",description:"The endless void",defaultTraits:new Set(["HAZARDOUS"]),visual:{color:"#000000",icon:""}},STAIRS:{id:"STAIRS",name:"Stairs",description:"Lead to the next floor",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#ffffff",icon:""}},SHRINE:{id:"SHRINE",name:"Shrine",description:"A place of power",defaultTraits:new Set(["WALKABLE","ANCHOR"]),visual:{color:"#ffd700",icon:""}},GATE:{id:"GATE",name:"Gate",description:"A heavy gate",defaultTraits:new Set(["BLOCKS_MOVEMENT","BLOCKS_LOS"]),visual:{color:"#444444",icon:""}},BRIDGE:{id:"BRIDGE",name:"Bridge",description:"Crossing the gap",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#8b4513",icon:""}}},bc={FIRE:{id:"FIRE",name:"Fire",description:"Burning flames",onStay:e=>({effects:[{type:"Damage",target:e.actor.id,amount:1,reason:"fire_damage"}],messages:[`${e.actor.subtype||e.actor.type} burns!`]}),interactsWith:{WET:e=>({effects:[{type:"Juice",effect:"flash",target:e.tile.position,color:"#aaaaaa"}],messages:["Steam rises!"],modifyTile:{effects:e.tile.effects.filter(i=>i.id!=="FIRE"&&i.id!=="WET"&&i.id!=="STEAM").concat({id:"STEAM",duration:2,potency:1})}})}},WET:{id:"WET",name:"Wet",description:"Soaked with water",onApply:e=>e.tile.effects.some(a=>a.id==="FIRE")?{effects:[],messages:["Water extinguishes the flames!"],modifyTile:{effects:e.tile.effects.filter(a=>a.id!=="FIRE")}}:{effects:[],messages:[]}},OIL:{id:"OIL",name:"Oil",description:"Slippery oil",interactsWith:{FIRE:e=>({effects:[{type:"Damage",target:"area",amount:3,reason:"oil_explosion"},{type:"Juice",effect:"explosion_ring",target:e.tile.position}],messages:["Oil explodes!"],modifyTile:{effects:e.tile.effects.filter(i=>i.id!=="OIL")}})}},STEAM:{id:"STEAM",name:"Steam",description:"Obscuring steam cloud"},BLESSED:{id:"BLESSED",name:"Blessed",description:"Holy ground"},CURSED:{id:"CURSED",name:"Cursed",description:"Unholy ground"},ICE_WALL:{id:"ICE_WALL",name:"Ice Wall",description:"A wall of ice"},SMOKE:{id:"SMOKE",name:"Smoke",description:"Thick smoke"},BOMB_TICK:{id:"BOMB_TICK",name:"Bomb Tick",description:"About to explode"},TRI_TRAP:{id:"TRI_TRAP",name:"Kinetic Trap",description:"Hidden trap that flings non-flying units outward"},SNARE:{id:"SNARE",name:"Snare",description:"Entangling roots that halt movement and root the target.",onPass:e=>e.actor.isFlying?{effects:[],messages:[]}:{effects:[{type:"ApplyStatus",target:e.actor.id,status:"rooted",duration:2}],messages:["Snared! Movement halted."],interrupt:!0,newMomentum:0}}},ze={getTileAt(e,i){const a=he(i);let o;return e.tiles&&(e.tiles instanceof Map?o=e.tiles.get(a):Array.isArray(e.tiles)?o=e.tiles.find(c=>Array.isArray(c)&&c[0]===a||c.position&&ne(c.position,i)):o=e.tiles[a]),o||{position:i,baseId:"STONE",traits:new Set(["WALKABLE"]),effects:[]}},getTraitsForTile(e,i){const a=new Set,o=i.position;return pa(o,e.gridWidth,e.gridHeight)?(i.baseId==="LAVA"&&(a.add("HAZARDOUS"),a.add("LIQUID"),a.add("LAVA")),i.baseId==="WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),i.traits.forEach(r=>a.add(r)),i.effects.forEach(r=>{r.id==="FIRE"&&(a.add("FIRE"),a.add("HAZARDOUS")),r.id==="ICE_WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),r.id==="SMOKE"&&a.add("BLOCKS_LOS")}),a):(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR"),a)},getTraitsAt(e,i){const a=this.getTileAt(e,i);return this.getTraitsForTile(e,a)},isPassable(e,i){const a=this.getTraitsAt(e,i);return!a.has("BLOCKS_MOVEMENT")&&!a.has("HAZARDOUS")},isWalkable(e,i){return!this.getTraitsAt(e,i).has("BLOCKS_MOVEMENT")},isLosBlocking(e,i){return this.getTraitsAt(e,i).has("BLOCKS_LOS")},isAnchorable(e,i){return this.getTraitsAt(e,i).has("ANCHOR")},hasTrait(e,i,a){return this.getTraitsAt(e,i).has(a)}};class za{static hasFireProtection(i){return i.statusEffects.some(a=>a.type==="fire_immunity")||i.activeSkills?.some(a=>a.id==="ABSORB_FIRE")||!1}static isFireHazard(i,a){return i.baseId==="LAVA"||a.has("LAVA")||a.has("FIRE")}static mergeResults(i,a){i.effects.push(...a.effects),i.messages.push(...a.messages),a.newMomentum!==void 0&&(i.newMomentum=a.newMomentum),a.interrupt&&(i.interrupt=!0),a.modifyTile&&(i.modifyTile={...i.modifyTile,...a.modifyTile})}static processEntry(i,a,o){const c={effects:[],messages:[],interrupt:!1},r={tile:a,actor:i,state:o,isFinalDestination:!0,source:i.previousPosition},f=ze.getTraitsForTile(o,a);f.has("HAZARDOUS")&&!i.isFlying&&(this.isFireHazard(a,f)&&this.hasFireProtection(i)||(a.baseId==="LAVA"||f.has("LAVA")?this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"lava_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Lava Sink! You were engulfed by lava!"],interrupt:!0}):(a.baseId==="VOID"||f.has("VOID"))&&this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"void_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Void consumes your soul!"],interrupt:!0})));for(const h of a.effects){const b=bc[h.id];if(!b?.onEnter)continue;const y=b.onEnter(r);if(this.mergeResults(c,y),c.interrupt)break}return c.messages.length===0&&c.effects.some(h=>h.type==="LavaSink")&&c.messages.push("Lava Sink! You were engulfed by lava!"),c}static processTransition(i,a,o,c,r={}){const{ignoreActors:f=!1,ignoreGroundHazards:h=!1}=r,b={effects:[],messages:[],newMomentum:c!==void 0?Math.max(0,c-1):void 0,interrupt:!1},y=ze.getTraitsForTile(o,a);if(y.has("BLOCKS_MOVEMENT")||!f&&(o.enemies.find(S=>S.id!==i.id&&S.hp>0&&ne(S.position,a.position))||(i.id!==o.player.id&&ne(o.player.position,a.position)?o.player:void 0)))return b.interrupt=!0,b.newMomentum=0,b;const A={tile:a,actor:i,state:o,momentum:c,isFinalDestination:!1,source:i.previousPosition};y.has("HAZARDOUS")&&!i.isFlying&&!h?this.isFireHazard(a,y)&&this.hasFireProtection(i)?this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:99,reason:"hazard_intercept"}],messages:["Flames surge through you."],interrupt:!1}):this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:99,reason:"hazard_intercept"},{type:"Juice",effect:"lavaSink",target:a.position}],messages:[a.baseId==="LAVA"||y.has("LAVA")?"Sunk in Lava!":"Consumed by Void!"],interrupt:!0}):y.has("SLIPPERY")?b.newMomentum=Math.max(1,c||0):y.has("LIQUID")&&c!==void 0&&c>0&&(b.newMomentum=Math.max(0,c-1));for(const v of a.effects){const S=bc[v.id];if(!S?.onPass)continue;const _=S.onPass(A);if(this.mergeResults(b,_),b.interrupt)break}if(!b.interrupt&&!i.isFlying&&!h&&o.traps){const v=o.traps.find(S=>ne(S.position,a.position)&&S.cooldown===0&&S.ownerId!==i.id);if(v){const S=a.position.q-v.position.q||1,_=a.position.r-v.position.r||0;let p=0;S>0&&_===0?p=0:S>0&&_<0?p=1:S===0&&_<0?p=2:S<0&&_===0?p=3:S<0&&_>0?p=4:p=5;const g=3;let R=a.position;const C=(M=>[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0},{q:0,r:1,s:-1}][M%6])(p);for(let M=0;M<g;M++){const N={q:R.q+C.q,r:R.r+C.r,s:R.s+C.s};if(!ze.isWalkable(o,N))break;R=N}if(this.mergeResults(b,{effects:[{type:"SetTrapCooldown",position:v.position,ownerId:v.ownerId,cooldown:v.resetCooldown??2},{type:"Displacement",target:i.id,destination:R,source:a.position,isFling:!0},{type:"Juice",effect:"kineticWave",target:a.position,intensity:"high"},{type:"Juice",effect:"combat_text",target:a.position,text:"TRAP!"}],messages:[`${i.subtype||"Unit"} triggered a kinetic trap!`],interrupt:!0}),v.volatileCore&&this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:1,reason:"trap_volatile_core"}],messages:["Volatile core detonates!"]}),v.chainReaction&&o.traps){const M=o.traps.filter(N=>N.ownerId===v.ownerId&&N.cooldown===0&&!ne(N.position,v.position)&&ot(v.position).some(Y=>ne(Y,N.position)));for(const N of M)this.mergeResults(b,{effects:[{type:"SetTrapCooldown",position:N.position,ownerId:N.ownerId,cooldown:N.resetCooldown??2}],messages:["Chain reaction sparks nearby traps!"]}),N.volatileCore&&this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:1,reason:"trap_chain_volatile"}],messages:["Chain blast!"]})}}}return b}static processStay(i,a,o){const c={effects:[],messages:[]},r={tile:a,actor:i,state:o,isFinalDestination:!1},f=ze.getTraitsForTile(o,a);if((a.baseId==="LAVA"||f.has("LAVA"))&&!i.isFlying&&!i.statusEffects.some(h=>h.type==="fire_immunity")){const h=i.id==="player";this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:h?1:99,reason:"lava_tick"}],messages:["Lava Sink! You were engulfed by lava!"]})}for(const h of a.effects){const b=bc[h.id];if(!b?.onStay)continue;const y=b.onStay(r);this.mergeResults(c,y)}return c}static applyEffect(i,a,o,c,r,f){const h=bc[a];if(!h)return{effects:[],messages:[]};const b={effects:[],messages:[]};for(const y of i.effects){const A=h.interactsWith?.[y.id];if(A){const v=A({tile:i,state:r,potency:c,sourceId:f});return this.mergeResults(b,v),b}}if(h.onApply){const y=h.onApply({tile:i,state:r,potency:c,sourceId:f});this.mergeResults(b,y)}return b.modifyTile?.effects?b.modifyTile&&(i.effects=b.modifyTile.effects):i.effects.push({id:a,duration:o,potency:c,sourceId:f}),b}static processPath(i,a,o,c,r={}){let f=i.position,h=c,b={effects:[],messages:[],newMomentum:c,interrupt:!1};for(const y of a){const A=ze.getTileAt(o,y),v=ze.getTraitsForTile(o,A),S=this.processTransition(i,A,o,h,r);if(S.interrupt&&v.has("BLOCKS_MOVEMENT")){b.interrupt=!0;break}if(f=y,this.mergeResults(b,S),b.interrupt){b.interrupt=!0;break}if(h=b.newMomentum,h!==void 0&&h<=0)break}return{lastValidPos:f,result:b,interrupt:!!b.interrupt}}static getMovementCost(i,a){const o=ze.getTraitsForTile(i,a);let c=1;return o.has("HAZARDOUS")&&(c+=5),o.has("LIQUID")&&(c+=1),o.has("FIRE")&&(c+=2),c}}const ix=(e,i)=>Array(i).fill(0n),Zd=(e,i,a)=>{if(!Number.isInteger(i.q)||!Number.isInteger(i.r))return[...e];if(i.r<0||i.r>=e.length||i.q<0)return[...e];const o=[...e];return o[i.r]|=1n<<BigInt(i.q),o},bf=(e,i)=>i.r<0||i.r>=e.length?!0:(e[i.r]&1n<<BigInt(i.q))!==0n,Sg=(e,i)=>{if(i.playerStart&&ne(e,i.playerStart)||i.stairsPosition&&ne(e,i.stairsPosition)||i.shrinePosition&&ne(e,i.shrinePosition))return!0;if(i.tiles){const a=ze.getTraitsAt(i,e);if(a.has("HAZARDOUS")||a.has("BLOCKS_MOVEMENT"))return!0}return!1},zi=(e,i)=>{if(e)return e.find(a=>a&&a.position&&ne(a.position,i))},Ee=(e,i)=>ne(e.player.position,i)?e.player:zi(e.enemies,i),sx=(e,i)=>!!e.shrinePosition&&ne(i,e.shrinePosition),ax=(e,i)=>!(!ne(i,e.stairsPosition)||e.enemies.some(o=>o.subtype==="sentinel"&&o.hp>0)),ox=(e,i,a,o)=>{const c=Ce(a,o);if(c===0)return[];const r=(o.q-a.q)/c,f=(o.r-a.r)/c,h=(o.s-a.s)/c,b=[],y=new Set,A=2;for(let v=1;v<=A;v++){const S={q:o.q+Math.round(r*v),r:o.r+Math.round(f*v),s:o.s+Math.round(h*v)};if(pa(S,e.gridWidth,e.gridHeight)){const _=`${S.q},${S.r}`;y.has(_)||(y.add(_),b.push(S))}}return b},nt={getNeighbors(e){return ot(e)},isTileBlocked(e,i){return!e.occupancyMask||e.occupancyMask.length===0?!1:bf(e.occupancyMask,i)},refreshOccupancyMask(e){let i=ix(e.gridWidth,e.gridHeight);return e.tiles?.forEach(a=>{(a.baseId==="WALL"||a.traits?.has("BLOCKS_MOVEMENT"))&&(i=Zd(i,a.position))}),e.player&&(i=Zd(i,e.player.position)),e.enemies?.forEach(a=>{i=Zd(i,a.position)}),i},getMovementRange(e,i,a){const o=new Map,c=[],r=b=>`${b.q},${b.r}`,f=Ee(e,i),h=[{p:i,cost:0}];for(o.set(r(i),0);h.length;){const b=h.shift();if(!(b.cost>=a))for(const y of this.getNeighbors(b.p)){if(!this.isWithinBounds(e,y)||!ze.isWalkable(e,y))continue;const A=Ee(e,y),v=A&&!ne(y,i),S=v&&f&&A.factionId===f.factionId;if(v&&!S)continue;const _=r(y),p=b.cost+1;(!o.has(_)||o.get(_)>p)&&(o.set(_,p),S||c.push(y),h.push({p:y,cost:p}))}}return c},getAxialTargets(e,i,a,o={}){const{includeWalls:c=!1,includeActors:r=!0,stopAtObstacles:f=!0}=o,h=[];for(let b=0;b<6;b++)for(let y=1;y<=a;y++){const A=Yn(i,kf(b,y));if(!this.isWithinBounds(e,A))break;const S=ze.getTileAt(e,A)?.baseId==="WALL",_=Ee(e,A);if(S){if(c&&h.push(A),f)break}else if(_){if(r&&h.push(A),f)break}else h.push(A)}return h},getAreaTargets(e,i,a){const o=[];for(let c=-a;c<=a;c++)for(let r=Math.max(-a,-c-a);r<=Math.min(a,-c+a);r++){const f=Yn(i,Vn(c,r));this.isWithinBounds(e,f)&&o.push(f)}return o},isWithinBounds(e,i){return pa(i,e.gridWidth,e.gridHeight)},getAxialTargetsWithOptions(e,i,a,o){return this.getAxialTargets(e,i,a,o)}},Ag=(e,i)=>{const a=i.q-e.q,o=i.r-e.r;return a>0&&o===0?0:a>0&&o<0?1:a===0&&o<0?2:a<0&&o===0?3:a<0&&o>0?4:5},mi=(e,i,a,o=[],c)=>{if(nx(e))return{position:e.position,state:a};const r=nt.getNeighbors(e.position);let f=[],h=c!==void 0?Math.abs(Ce(e.position,i)-c):Ce(e.position,i);for(const v of r){if(!nt.isWithinBounds(a,v))continue;const S=a.tiles.get(he(v)),_=S?.traits.has("BLOCKS_LOS")||S?.baseId==="WALL",p=o.some(C=>ne(C,v))||a.enemies.some(C=>C.id!==e.id&&ne(C.position,v))||ne(v,i);if(_||p)continue;const g=S?za.getMovementCost(a,S):1,I=(c!==void 0?Math.abs(Ce(v,i)-c):Ce(v,i))+(g-1);I<h?(h=I,f=[v]):I===h&&f.push(v)}if(f.length===0)return{position:e.position,state:a};if(f.length===1)return{position:f[0],state:a};const{value:b,nextState:y}=Va(a),A=Math.floor(b*f.length)%f.length;return{position:f[A],state:y}},lx=(e,i,a)=>{if(Ce(e.position,i)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};let c=e.position,r=a;for(let h=0;h<2&&!(Ce(c,i)<=1);h++){const b={...e,position:c},{position:y,state:A}=mi(b,i,r,a.occupiedCurrentTurn);c=y,r=A}const f=!ne(c,e.position);return{entity:{...e,position:c,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:r,message:f?`${e.subtype} moves to (${c.q}, ${c.r})`:void 0}},rx=(e,i,a)=>{const o=Ce(e.position,i),c=Ag(e.position,i);if(o===1)return{entity:{...e,facing:c,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=mi(e,i,a,a.occupiedCurrentTurn),h=!ne(r,e.position);return{entity:{...e,position:r,facing:h?Ag(e.position,r):c,intent:h?"Advancing":"BASIC_ATTACK",intentPosition:h?void 0:{...i}},nextState:f,message:h?`${e.subtype} advances to (${r.q}, ${r.r})`:void 0}},cx=(e,i,a)=>{const o=Ce(e.position,i);let c=a;const{value:r,nextState:f}=Va(c);c=f;let h=e.position;if(o<=2||r<.3){const{value:v,nextState:S}=Va(c);c=S;const{value:_,nextState:p}=Va(c);c=p;const g=Math.floor(v*6),R=3+Math.floor(_*3);let I=e.position;for(let M=0;M<R;M++)I=Yn(I,Pn(g));!nt.isWithinBounds(a,I)||!ze.isWalkable(a,I)||a.occupiedCurrentTurn?.some(M=>ne(M,I))||a.enemies.some(M=>M.id!==e.id&&ne(M.position,I))||ne(I,i)||(h=I)}const b=!ne(h,e.position),y=Ce(h,i),A=!b&&y>=2&&y<=4;return{entity:{...e,position:h,intent:b?"Repositioning":A?"Casting":"Preparing",intentPosition:A?{...i}:void 0},nextState:c,message:b?`${e.subtype} teleports to (${h.q}, ${h.r})`:void 0}},ux=(e,i,a)=>{const o=Ce(e.position,i);if(o===1)return{entity:{...e,isVisible:!0,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:c,state:r}=mi(e,i,a,a.occupiedCurrentTurn),f=!ne(c,e.position);return{entity:{...e,position:c,isVisible:f?!1:o<=1,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:r,message:f?"You hear footsteps nearby...":void 0}},dx={sentinel:{telegraphSkillId:"SENTINEL_TELEGRAPH",executeSkillId:"SENTINEL_BLAST",triggerRange:3,telegraphMessage:"The Sentinel marks the blast zone..."}},fx=(e,i,a,o)=>{const r=Ce(e.position,i)<=o.triggerRange,f=a.turnNumber%2===0,h=!f;if(r&&h&&Ns(e))return{entity:{...e,intent:"Preparing",intentPosition:void 0},nextState:a,message:`${e.subtype} loses focus!`};if(r&&f)return{entity:{...e,intent:o.telegraphSkillId,intentPosition:{...i}},nextState:a,message:o.telegraphMessage};if(r&&h)return{entity:{...e,intent:o.executeSkillId,intentPosition:{...i}},nextState:a};const{position:b,state:y}=mi(e,i,a,a.occupiedCurrentTurn);return{entity:{...e,position:b,intent:"Moving",intentPosition:void 0},nextState:y}},mx=(e,i,a)=>{const o=e.actionCooldown??0;if(o>0)return{entity:{...e,actionCooldown:o-1,intent:"Charging Power"},nextState:a};const c=Ce(e.position,i);if(c>=1&&c<=3)return{entity:{...e,actionCooldown:2,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=mi(e,i,a,a.occupiedCurrentTurn),h=!ne(r,e.position);return{entity:{...e,position:r,intent:h?"Lumbering":"Waiting",actionCooldown:0},nextState:f,message:h?`${e.subtype} lumbers to (${r.q}, ${r.r})`:void 0}},px=(e,i,a)=>{const o=Ce(e.position,i);if(o>4){const{position:A,state:v}=mi(e,i,a,a.occupiedCurrentTurn),S=!ne(A,e.position);return{entity:{...e,position:A,intent:S?"Following":"Waiting"},nextState:v,message:S?`${e.subtype} follows you.`:void 0}}const c=a.enemies.filter(A=>A.factionId==="enemy").sort((A,v)=>Ce(e.position,A.position)-Ce(e.position,v.position))[0];if(!c){if(o>1){const{position:A,state:v}=mi(e,i,a,a.occupiedCurrentTurn);return{entity:{...e,position:A,intent:"Idle"},nextState:v}}return{entity:{...e,intent:"Idle"},nextState:a}}if(Ce(e.position,c.position)===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...c.position}},nextState:a};const{position:f,state:h}=mi(e,c.position,a,a.occupiedCurrentTurn),b=!ne(f,e.position),y=Ce(f,c.position);return{entity:{...e,position:f,intent:b?"Advancing":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...c.position}},nextState:h,message:b?`${e.subtype} attacks ${c.subtype}!`:void 0}},hx=(e,i,a)=>{if(e.factionId==="player")return px(e,i,a);if((a.player.stealthCounter||0)>0)return{entity:{...e,intent:"Searching",intentPosition:void 0},nextState:a};const c=Ce(e.position,i);switch(e.subtype){case"sprinter":return lx(e,i,a);case"shieldBearer":return rx(e,i,a);case"warlock":return cx(e,i,a);case"assassin":return ux(e,i,a);case"golem":return mx(e,i,a);case"sentinel":return fx(e,i,a,dx.sentinel);case"raider":{if((e.position.q===i.q||e.position.r===i.r||e.position.s===i.s)&&c>=2&&c<=4)return{entity:{...e,intent:"DASH",intentPosition:{...i}},nextState:a};const{position:f,state:h}=mi(e,i,a,a.occupiedCurrentTurn),b=!ne(f,e.position),y=Ce(f,i);return{entity:{...e,position:f,intent:b?"Moving":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...i}},nextState:h,message:b?`${e.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"pouncer":{if((e.position.q===i.q||e.position.r===i.r||e.position.s===i.s)&&c>=2&&c<=4)return{entity:{...e,intent:"GRAPPLE_HOOK",intentPosition:{...i}},nextState:a};const{position:f,state:h}=mi(e,i,a,a.occupiedCurrentTurn),b=!ne(f,e.position);return{entity:{...e,position:f,intent:b?"Moving":"Waiting",intentPosition:void 0},nextState:h,message:b?`${e.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"archer":{if((e.position.q===i.q||e.position.r===i.r||e.position.s===i.s)&&c>1&&c<=4)return{entity:{...e,intent:"SPEAR_THROW",intentPosition:{...i}},nextState:a};const{position:f,state:h}=mi(e,i,a,a.occupiedCurrentTurn),b=!ne(f,e.position);return{entity:{...e,position:f,intent:b?"Moving":"Idle",intentPosition:void 0},nextState:h,message:b?`${e.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"bomber":{const r=e.actionCooldown??0;if(r===0&&c>=2&&c<=3){const A=nt.getNeighbors(i).filter(v=>{const S=!ze.isWalkable(a,v),_=a.enemies.some(p=>ne(p.position,v));return nt.isWithinBounds(a,v)&&!S&&!_&&!ne(v,i)});if(A.length>0){const{value:v,nextState:S}=Va(a),_=Math.floor(v*A.length)%A.length,p=A[_];return{entity:{...e,intent:"Bombing",intentPosition:p,actionCooldown:2},nextState:S}}}const{position:h,state:b}=mi(e,i,a,a.occupiedCurrentTurn,2.5),y=!ne(h,e.position);return{entity:{...e,position:h,intent:y?"Moving":"Waiting",intentPosition:void 0,actionCooldown:Math.max(0,r-1)},nextState:b,message:y?`${e.subtype} repositioning to (${h.q}, ${h.r})`:void 0}}default:{if(c===1)return{entity:{...e,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=mi(e,i,a,a.occupiedCurrentTurn),h=!ne(r,e.position),b=Ce(r,i);return{entity:{...e,position:r,intent:h?"Moving":b===1?"BASIC_ATTACK":"Waiting",intentPosition:h||b>1?void 0:{...i}},nextState:f,message:h?`${e.subtype} moves to (${r.q}, ${r.r})`:void 0}}}},Ic=7,Bc=9,se=36,Tg={speed:1},gx={stunned:{tickWindow:"START_OF_TURN"},poisoned:{tickWindow:"START_OF_TURN"},armored:{tickWindow:"END_OF_TURN"},hidden:{tickWindow:"END_OF_TURN"},time_bomb:{tickWindow:"END_OF_TURN"}},xf={footman:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},sprinter:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:1,weightClass:"Standard",speed:2},raider:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","DASH"],actionCooldown:1,weightClass:"Standard",speed:1},pouncer:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],actionCooldown:1,weightClass:"Standard",speed:1},shieldBearer:{hp:2,maxHp:2,range:1,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],actionCooldown:2,weightClass:"Heavy",speed:1},archer:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK","SPEAR_THROW"],actionCooldown:3,weightClass:"Standard",speed:1},bomber:{hp:1,maxHp:1,range:3,damage:1,type:"ranged",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},warlock:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},sentinel:{hp:30,maxHp:30,range:4,damage:2,type:"boss",cost:25,skills:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],actionCooldown:1,weightClass:"Heavy",speed:1}},yx=.17,Eg=[0,2,3,5,7,10,12,15,18,22,0],xc={floor:"#6b7b3c",wall:"#374151",shrine:"#f97316",portal:"#ffffff"},bx={1:"inferno",2:"inferno",3:"inferno",4:"inferno",5:"inferno",6:"inferno",7:"inferno",8:"inferno",9:"inferno",10:"inferno"},ef={1:["footman"],2:["footman","sprinter"],3:["footman","archer"],4:["footman","archer","bomber","raider"],5:["footman","archer","bomber","shieldBearer","raider"],6:["footman","archer","bomber","shieldBearer","warlock","pouncer"],7:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],8:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],9:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],10:[]},ua=(e,i)=>{let a=i,o=e.temporaryArmor||0,c=e.hp;if(o>0){const r=Math.min(o,a);o-=r,a-=r}return c=Math.max(0,c-a),{...e,hp:c,temporaryArmor:o}},vf=(e,i,a,o)=>{const r=gx[i]?.tickWindow||"END_OF_TURN",f=i.toUpperCase();if(e.statusEffects.find(y=>y.id===f))return{...e,statusEffects:e.statusEffects.map(y=>y.id===f?{...y,duration:Math.max(y.duration,a),tickWindow:r,stacks:o||y.stacks}:y)};const b={id:f,type:i,duration:a,tickWindow:r,stacks:o||1};return{...e,statusEffects:[...e.statusEffects,b]}},xx=(e,i)=>({...e,hp:Math.min(e.maxHp,e.hp+i)}),vx=(e,i,a=!0)=>{const o=e.maxHp+i,c=a?Math.min(o,e.hp+i):e.hp;return{...e,maxHp:o,hp:c}},Sx=e=>{const i=[];return e.player.hp<=0&&e.gameStatus==="playing"&&i.push({type:"GameOver",reason:"PLAYER_DIED"}),i},wg=e=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(i=>({...i,currentCooldown:Math.max(0,i.currentCooldown-1)}))}:e,Ax=(e,i,a)=>e.activeSkills?{...e,activeSkills:e.activeSkills.map(o=>o.id===i&&!o.activeUpgrades.includes(a)?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}:e;function Sf(e,i){return e?.get(i)}const tf=(e,i,a)=>Math.max(i,Math.min(a,e)),Pl=e=>Math.round(e*1e3)/1e3,Lf=e=>{const i=Math.max(0,e.body),a=Math.max(0,e.mind),o=Math.max(0,e.instinct);return{bodyDamageMultiplier:Pl(1+i/20),bodyMitigation:Pl(tf(i*.01,0,.5)),mindStatusDurationBonus:Math.floor(a/15),mindMagicMultiplier:Pl(1+a/20),instinctInitiativeBonus:o*2,instinctCriticalMultiplier:Pl(1+tf(o,0,10)*.02),instinctSparkDiscountMultiplier:Pl(1-tf(o,0,100)/100)}},Yc=e=>{const i=Math.max(0,e.body),a=Math.max(0,e.mind),o=Math.max(0,e.instinct),c={base:0,body:5,mind:2,instinct:3},r=Math.floor(i*c.body+a*c.mind+o*c.instinct+c.base);return Math.max(1,r)},Nn=(e,i,a)=>Math.max(i,Math.min(a,e)),fn=e=>Math.round(e*1e3)/1e3,Tx=()=>globalThis?.process?.env?.HOP_COMBAT_INTERACTION_MODEL,Ex=e=>e.length===0?1:e.reduce((i,a)=>i*a.multiplier,1),wx=e=>{let i=1;if(e.inDangerPreviewHex&&(i+=.15),typeof e.proximityDistance=="number"){const a=Nn(e.proximityDistance,0,6);i+=(6-a)*.02}return i},_x=(e,i,a,o,c,r,f,h)=>{if(!i)return{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1};const b=a==="physical"?.85+e.instinct*.015+e.body*.005:.85+e.mind*.015+e.instinct*.005,y=a==="physical"?i.instinct*.012+i.body*.004:i.instinct*.008+i.mind*.008,A=Nn(b-y,.1,.99);if(typeof o!="number")return{multiplier:A,pressure:fn(b-y),rangePressure:0,rangeMultiplier:1};const v={min:Nn(c??(a==="physical"?1:2),1,6),max:Nn(r??(a==="physical"?2:4),1,6)};if(v.max<v.min){const X=v.min;v.min=v.max,v.max=X}const S={min:Nn(f??(a==="physical"?1:2),1,6),max:Nn(h??(a==="physical"?3:5),1,6)};if(S.max<S.min){const X=S.min;S.min=S.max,S.max=X}const _=Nn(o,1,6),p=Math.max(0,v.min-_),g=Math.max(0,_-v.max),R=p*.06+g*.1,I=e.instinct*.015,C=(_>=S.min&&_<=S.max?.05:0)+i.instinct*.006,M=I-R-C,N=Nn(1+M,.55,1.25);return{multiplier:Nn(A*N,.05,.99),pressure:fn(b-y),rangePressure:fn(M),rangeMultiplier:fn(N)}},Mx=(e,i)=>{if(!e)return{multiplier:1,pressure:0};const a=Nn(i==="physical"?e.body*.01+e.instinct*.004:e.mind*.01+e.instinct*.004,0,.75);return{multiplier:1-a,pressure:fn(a)}},Ox=(e,i,a,o)=>{if(!i)return{multiplier:o,critPressure:0,resistancePressure:0};const c=Nn(a==="physical"?.05+e.instinct*.01:.05+e.mind*.01,0,.75),r=Nn(a==="physical"?i.body*.006+i.instinct*.004:i.mind*.006+i.instinct*.004,0,.7);return{multiplier:1+Nn(c-r,0,.75)*(o-1),critPressure:fn(c),resistancePressure:fn(r)}},Cx=(e,i,a,o,c)=>{const r=e.scaling.filter(v=>v.attribute==="body").reduce((v,S)=>v+(e.trinity.body||0)*S.coefficient,0),f=e.scaling.filter(v=>v.attribute==="mind").reduce((v,S)=>v+(e.trinity.mind||0)*S.coefficient,0),h=e.scaling.filter(v=>v.attribute==="instinct").reduce((v,S)=>v+(e.trinity.instinct||0)*S.coefficient,0),b=e.damageClass==="physical"?Math.max(0,e.basePower*(i.bodyDamageMultiplier-1)):0,y=e.damageClass==="magical"?Math.max(0,e.basePower*(i.mindMagicMultiplier-1)):0,A=Math.max(0,(c-1)*(a+o));return{body:Math.max(0,b+r),mind:Math.max(0,y+f),instinct:Math.max(0,h+A)}},Nx=(e,i)=>{if(e<=0)return e;const a=Lf(i).mindStatusDurationBonus;return e+a},Rx=e=>Lf(e).instinctInitiativeBonus,bn=e=>{const i=Lf(e.trinity),a=e.damageClass||"physical",o=Tx()==="triangle"?"triangle":"legacy",c=e.interactionModel||o,r=a==="magical"?i.mindMagicMultiplier:i.bodyDamageMultiplier,f=e.basePower*r,h=e.scaling.reduce((O,q)=>{const K=e.trinity[q.attribute]||0;return O+K*q.coefficient},0),b=Ex(e.statusMultipliers),y=wx(e),A=i.instinctCriticalMultiplier,v=c==="triangle"?_x(e.trinity,e.targetTrinity,a,e.engagementRange,e.optimalRangeMin,e.optimalRangeMax,e.targetOptimalRangeMin,e.targetOptimalRangeMax):{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1},S=c==="triangle"?Mx(e.targetTrinity,a):{multiplier:1,pressure:0},_=c==="triangle"?Ox(e.trinity,e.targetTrinity,a,A):{multiplier:A,critPressure:0,resistancePressure:0},p=(f+h)*b*y*v.multiplier*S.multiplier*_.multiplier*(e.attackPowerMultiplier??1)*(e.targetDamageTakenMultiplier??1),g=Math.max(0,Math.floor(p)),R=Cx(e,i,f,h,A),I=Math.max(1e-6,R.body+R.mind+R.instinct),C=fn(R.body/I),M=fn(R.mind/I),N=fn(R.instinct/I),Y=Math.max(1,e.theoreticalMaxPower??p),X=Nn(g/Y,0,1);return{basePower:e.basePower,bodyScaledPower:fn(f),scalingPower:fn(h),statusMultiplier:fn(b),riskMultiplier:fn(y),criticalMultiplier:fn(A),hitMultiplier:fn(v.multiplier),rangeMultiplier:fn(v.rangeMultiplier),mitigationMultiplier:fn(S.multiplier),critExpectedMultiplier:fn(_.multiplier),finalPower:g,bodyContribution:C,mindContribution:M,instinctContribution:N,scoreEvent:{skillId:e.skillId,attackerId:e.attackerId,targetId:e.targetId,finalPower:g,efficiency:fn(X),riskBonusApplied:!!e.inDangerPreviewHex,damageClass:a,hitPressure:v.pressure,rangePressure:v.rangePressure,mitigationPressure:S.pressure,critPressure:_.critPressure,resistancePressure:_.resistancePressure,bodyContribution:C,mindContribution:M,instinctContribution:N}}},Ze=e=>{const i=Sf(e.components,"trinity");if(i)return{body:i.body,mind:i.mind,instinct:i.instinct};const a=Sf(e.components,"stats"),o=a?.strength??0,c=a?.defense??0,r=a?.evasion??0;return{body:o,mind:c,instinct:r}},_g={player:100,footman:50,archer:60,shieldBearer:40,bomber:30,warlock:55,bomb:10},Af=e=>{let i=e.speed;if(i===void 0){const o=e.subtype;i=e.type==="player"?_g.player:_g[o]??50}return e.statusEffects?.some(o=>o.type==="stunned")&&(i-=100),i+=Rx(Ze(e)),i},Ka=e=>{const i=[];i.push({actorId:e.player.id,initiative:Af(e.player),hasActed:!1,turnStartPosition:void 0});for(const a of e.enemies)i.push({actorId:a.id,initiative:Af(a),hasActed:!1,turnStartPosition:void 0});return i.sort((a,o)=>o.initiative!==a.initiative?o.initiative-a.initiative:a.actorId==="player"?-1:o.actorId==="player"?1:a.actorId.localeCompare(o.actorId)),{entries:i,currentIndex:-1,round:1}},kx=e=>e.currentIndex<0||e.currentIndex>=e.entries.length?null:e.entries[e.currentIndex],Lx=e=>{let i=e.initiativeQueue;i||(i=Ka(e));let a=i.currentIndex+1;for(;a<i.entries.length&&i.entries[a].hasActed;)a++;return a>=i.entries.length?(i=Ka(e),i.round=(e.initiativeQueue?.round??0)+1,a=0,{queue:{...i,currentIndex:a},actorId:i.entries[a]?.actorId??null,newRound:!0}):{queue:{...i,currentIndex:a},actorId:i.entries[a]?.actorId??null,newRound:!1}},Ix=(e,i)=>{const a=e.initiativeQueue;if(!a)return Ka(e);const o=a.entries.map(c=>{if(c.actorId===i.id){if(c.turnStartPosition)return c;const f=ot(i.position).map(h=>Ee(e,h)?.id).filter(Boolean);return{...c,turnStartPosition:{...i.position},turnStartNeighborIds:f}}return c});return{...a,entries:o}},Bx=(e,i)=>{const a=e.initiativeQueue;if(!a)return Ka(e);const o=a.entries.map(c=>c.actorId===i?{...c,hasActed:!0}:c);return{...a,entries:o}},jx=(e,i)=>{const a=e.initiativeQueue;return a?a.entries.find(c=>c.actorId===i)?.turnStartPosition??null:null},Dx=(e,i)=>{const a=e.initiativeQueue;return a?a.entries.find(c=>c.actorId===i)?.turnStartNeighborIds??null:null},Gl=e=>{const i=e.initiativeQueue;if(!i)return!0;if(i.currentIndex<0||i.currentIndex>=i.entries.length)return!1;const a=i.entries[i.currentIndex];return a.actorId===e.player.id&&!a.hasActed},nf=(e,i)=>{const a=e.entries.filter(r=>r.actorId!==i);let o=e.currentIndex;const c=e.entries.findIndex(r=>r.actorId===i);return c>=0&&c<=e.currentIndex&&o--,{...e,entries:a,currentIndex:Math.min(o,a.length-1)}},Hx=(e,i)=>{const a={actorId:i.id,initiative:Af(i),hasActed:!0,turnStartPosition:void 0};return{...e,entries:[...e.entries,a]}},yn={body:0,mind:0,instinct:0},Px=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),ko=e=>{const i={};for(const[a,o]of Object.entries(e))i[a]=Px(o);return i},Ux={neutral:{id:"neutral",default:yn,archetype:ko({VANGUARD:yn,SKIRMISHER:yn,FIREMAGE:yn,NECROMANCER:yn,HUNTER:yn,ASSASSIN:yn}),enemySubtype:ko({footman:yn,sprinter:yn,raider:yn,pouncer:yn,shieldBearer:yn,archer:yn,bomber:yn,warlock:yn,sentinel:yn}),companionSubtype:ko({falcon:yn,skeleton:yn})},live:{id:"live",default:yn,archetype:ko({VANGUARD:{body:9,mind:4,instinct:5},SKIRMISHER:{body:7,mind:6,instinct:10},FIREMAGE:{body:2,mind:9,instinct:4},NECROMANCER:{body:5,mind:9,instinct:5},HUNTER:{body:3,mind:4,instinct:8},ASSASSIN:{body:3,mind:3,instinct:9}}),enemySubtype:ko({footman:{body:0,mind:0,instinct:0},sprinter:{body:0,mind:0,instinct:0},raider:{body:.4,mind:0,instinct:.2},pouncer:{body:.4,mind:0,instinct:.2},shieldBearer:{body:1,mind:0,instinct:.4},archer:{body:.2,mind:0,instinct:.2},bomber:{body:.4,mind:.2,instinct:.2},warlock:{body:.4,mind:.6,instinct:.2},sentinel:{body:4,mind:2,instinct:2}}),companionSubtype:ko({falcon:{body:2,mind:2,instinct:9},skeleton:{body:15,mind:1,instinct:4}})}},qx=e=>e?.toLowerCase()==="neutral"?"neutral":"live",zx=()=>globalThis?.process?.env?.HOP_TRINITY_PROFILE,$x=e=>Ux[qx(zx())],qi={outgoingPhysical:1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},Vx={VANGUARD:qi,SKIRMISHER:qi,FIREMAGE:qi,NECROMANCER:qi,HUNTER:qi,ASSASSIN:qi},Yx={footman:{outgoingPhysical:3,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},sprinter:{outgoingPhysical:2.8,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},raider:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},pouncer:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},shieldBearer:{outgoingPhysical:3.5,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},archer:{outgoingPhysical:2.6,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},bomber:{outgoingPhysical:2.8,outgoingMagical:3,incomingPhysical:1,incomingMagical:1},warlock:{outgoingPhysical:1.5,outgoingMagical:3.5,incomingPhysical:1,incomingMagical:1},sentinel:{outgoingPhysical:4,outgoingMagical:4,incomingPhysical:1,incomingMagical:1}},Fx={falcon:{outgoingPhysical:1.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},skeleton:{outgoingPhysical:1.1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1}},Wl=e=>({outgoingPhysical:e.outgoingPhysical,outgoingMagical:e.outgoingMagical,incomingPhysical:e.incomingPhysical,incomingMagical:e.incomingMagical}),ky=e=>e.type==="player"?Wl(Vx[(e.archetype||"VANGUARD").toUpperCase()]||qi):e.companionOf&&e.subtype?Wl(Fx[e.subtype]||qi):e.subtype?Wl(Yx[e.subtype]||qi):Wl(qi),Ly=e=>{const i=Sf(e.components,"combat_profile");return i?{outgoingPhysical:Number.isFinite(i.outgoingPhysical)?i.outgoingPhysical:1,outgoingMagical:Number.isFinite(i.outgoingMagical)?i.outgoingMagical:1,incomingPhysical:Number.isFinite(i.incomingPhysical)?i.incomingPhysical:1,incomingMagical:Number.isFinite(i.incomingMagical)?i.incomingMagical:1}:Wl(qi)},Kx=(e,i)=>{const a=Ly(e);return i==="magical"?a.outgoingMagical:a.outgoingPhysical},Gx=(e,i)=>{const a=Ly(e);return i==="magical"?a.incomingMagical:a.incomingPhysical},Ul=e=>({body:e.body,mind:e.mind,instinct:e.instinct}),Iy=e=>{if(e.trinity)return Ul(e.trinity);const i=$x(),a=i.default;if(e.type==="player"){const o=(e.archetype||"VANGUARD").toUpperCase();return Ul(i.archetype[o]||a)}if(e.companionOf&&e.subtype){const o=e.subtype;if(i.companionSubtype[o])return Ul(i.companionSubtype[o])}return e.subtype?Ul(i.enemySubtype[e.subtype]||a):Ul(a)},Xl=e=>{const i=new Map(e.components||[]),a=i.has("trinity"),o=i.has("combat_profile");if(a&&o)return e;const c=Iy({id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:e.factionId,archetype:e.archetype,companionOf:e.companionOf}),r=ky({type:e.type,archetype:e.archetype,subtype:e.subtype,companionOf:e.companionOf});return a||i.set("trinity",{type:"trinity",...c}),o||i.set("combat_profile",{type:"combat_profile",...r}),{...e,components:i}};function Wx(e){return e.map(i=>({id:i,name:String(i),description:String(i),slot:"utility",cooldown:0,currentCooldown:0,range:0,upgrades:[],activeUpgrades:[]}))}function ma(e){const i=e.activeSkills?[...e.activeSkills]:Wx(e.skills||[]),a=new Map(e.components||[]),o=Iy(e),c=e.combatProfile||ky(e);a.has("trinity")||a.set("trinity",{type:"trinity",...o}),a.has("combat_profile")||a.set("combat_profile",{type:"combat_profile",...c});const r=Yc(o),f=Math.max(1,e.maxHp??r),h=Math.min(f,Math.max(0,e.hp??f));return e.weightClass&&a.set("physics",{type:"physics",weightClass:e.weightClass}),e.archetype&&a.set("archetype",{type:"archetype",archetype:e.archetype}),{id:e.id,type:e.type,subtype:e.subtype,position:e.position,hp:h,maxHp:f,speed:e.speed,factionId:e.factionId,initiative:e.initiative,statusEffects:[],temporaryArmor:0,activeSkills:i,weightClass:e.weightClass,archetype:e.archetype,components:a,isFlying:e.isFlying,companionOf:e.companionOf,isVisible:!0}}function Xx(e){const i=ma({id:e.id,type:"enemy",subtype:e.subtype,position:e.position,hp:e.hp,maxHp:e.maxHp,speed:e.speed,factionId:"enemy",skills:e.skills,weightClass:e.weightClass||"Standard",trinity:e.trinity});return i.enemyType=e.enemyType,i}function By(e){if(e.companionType==="falcon"){const i=ma({id:e.id||`falcon-${e.ownerId}`,type:"enemy",subtype:"falcon",position:e.position,speed:95,factionId:"player",skills:["BASIC_MOVE","FALCON_PECK","FALCON_APEX_STRIKE","FALCON_HEAL","FALCON_SCOUT","FALCON_AUTO_ROOST"],weightClass:"Light",isFlying:!0,companionOf:e.ownerId,trinity:e.trinity});return i.companionState={mode:"roost",orbitStep:0},i}return e.companionType==="skeleton"?ma({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:"skeleton",position:e.position,hp:2,maxHp:2,speed:50,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity}):ma({id:e.id||`${e.companionType}-${e.ownerId}`,type:"enemy",subtype:e.companionType,position:e.position,speed:80,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK"],companionOf:e.ownerId,weightClass:"Standard",trinity:e.trinity})}function Qx(e){return By({companionType:"falcon",ownerId:e.ownerId,position:e.position})}function Jx(e){const i=["BASIC_MOVE","BASIC_ATTACK"],a={footman:["AUTO_ATTACK"],sprinter:[],raider:["DASH"],pouncer:["GRAPPLE_HOOK"],shieldBearer:["SHIELD_BASH"],archer:["SPEAR_THROW"],bomber:["BOMB_TOSS"],warlock:[],sentinel:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"]};return[...i,...a[e]||[]]}const Zx=/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*/i,ev=e=>Zx.test(e),If=(e,i="INFO",a="SYSTEM")=>e?ev(e)?e:`[${i}|${a}] ${e}`:"",tv=(e,i="INFO",a="SYSTEM")=>e.map(o=>If(o,i,a)).filter(Boolean),Pt=(e,i,a,o,c=50)=>{const r=If(i,a,o),f=[...e||[]];return r&&f[f.length-1]===r?f.slice(-c):[...f,r].slice(-c)},ss=(e,i,a,o,c=50)=>{const r=[...e||[]];let f;for(const h of tv(i,a,o))h&&f===h||(r.push(h),f=h);return r.slice(-c)},Mg=(e,i,a)=>{const o=a.preserveInputOrder===!1?[...i]:[...i].reverse(),c=a.describe||(()=>"UNKNOWN");let r=e;const f=[];let h=a.startTick||1;for(;o.length>0;){const b=o.length,y=o.pop();r=a.apply(r,y);const A=a.getReactions?.(r,y)||[];if(A.length>0)for(let v=A.length-1;v>=0;v--)o.push(A[v]);f.push({tick:h++,effectType:c(y),depthBefore:b,depthAfter:o.length,reactionsQueued:A.length})}return{state:r,trace:f,resolvedCount:f.length}};var Og={};const ql=(e,i)=>{const a=he(i);let o=e;o.tiles===e.tiles&&(o={...o,tiles:new Map(o.tiles)});let c=o.tiles.get(a);return c?c={...c,traits:new Set(c.traits),effects:[...c.effects]}:c={baseId:"STONE",position:i,traits:new Set(Io.STONE.defaultTraits),effects:[]},c.traits.add("CORPSE"),o.tiles.set(a,c),o},nv=(e,i)=>{const a=he(i),o=e.tiles.get(a);if(!o||!o.traits.has("CORPSE"))return e;let c=e;c.tiles===e.tiles&&(c={...c,tiles:new Map(c.tiles)});const r={...o,traits:new Set(o.traits),effects:[...o.effects]};return r.traits.delete("CORPSE"),c.tiles.set(a,r),c},iv=typeof process<"u"&&(Og?.HOP_ENGINE_WARN==="1"||Og?.HOP_ENGINE_DEBUG==="1"),Cg={INTENT_START:1,MOVE_START:2,MOVE_END:3,ON_PASS:4,ON_ENTER:5,HAZARD_CHECK:6,STATUS_APPLY:7,DAMAGE_APPLY:8,DEATH_RESOLVE:9,INTENT_END:10},sv=e=>{const i=e||[];let a=0;for(const o of i)o.blocking&&(a+=Number(o.suggestedDurationMs||0));return a},Ni=(e,i,a,o,c,r,f)=>{const h=e.timelineEvents||[],b=h.length,y=e.turnNumber||0,A=c.sourceId||c.targetId,v=c.stepId||`${y}:${A||"system"}`,S=c.stepId||v,_=S?[...h].reverse().find(g=>(g.stepId||g.groupId)===S):void 0;if(_){const g=Cg[_.phase]||0,R=Cg[i]||0;g>R&&iv&&console.warn("[TURN_STACK] Non-monotonic timeline phase order detected.",{stepId:S,previous:_.phase,next:i})}const p=`${S}:${b}:${i}`;return{...e,timelineEvents:[...h,{id:p,turn:y,actorId:A,stepId:S,phase:i,type:a,payload:o,blocking:r,groupId:v,suggestedDurationMs:f}]}},zl=(e,i)=>{const a=e.simulationEvents||[],o=`sim:${e.turnNumber||0}:${a.length}:${i.type}`;return{...e,simulationEvents:[...a,{...i,id:o,turn:e.turnNumber||0}]}},av=(e,i)=>{if(i)return e.player.id===i?e.player:e.enemies.find(a=>a.id===i)||e.companions?.find(a=>a.id===i)},Ng=(e,i)=>{if(i)return ne(e.player.position,i)?e.player:e.enemies.find(a=>ne(a.position,i))||e.companions?.find(a=>ne(a.position,i))},ov=new Set(["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage","burning","oil_explosion"]),sf=(e,i,a,o,c,r)=>{if(!o)return{amount:i,outgoing:1,incoming:1,total:1};if(r&&ov.has(r))return{amount:i,outgoing:1,incoming:1,total:1};const f=av(e,a);if(!f)return{amount:i,outgoing:1,incoming:1,total:1};const h=Kx(f,c),b=Gx(o,c),y=h*b;return{amount:Math.max(0,Math.floor(i*y)),outgoing:h,incoming:b,total:y}},Tf=(e,i,a={})=>{let o={...e};const c=()=>{o.tiles===e.tiles&&(o={...o,tiles:new Map(o.tiles)})};switch(i.type){case"Displacement":{let r="";if(i.target==="self"?r=a.sourceId||o.player.id:i.target==="targetActor"?r=a.targetId||"":r=i.target,!r)break;const f=(S,_)=>_===S.player.id?S.player:S.enemies.find(p=>p.id===_),h=f(o,r);if(!h)break;const b=i.source||h?.position,y=Math.min(3200,Math.max(0,sv(o.timelineEvents)));let A=!1;const v=!(i.simulatePath||i.path||i.isFling);if(b&&(o=Ni(o,"MOVE_START","Displacement",{origin:b,destination:i.destination,targetActorId:r},{...a,targetId:r},!0,220)),b){const S=i.path||(b?Ut(b,i.destination):void 0),_=i.simulatePath||i.isFling||!!i.path;let p=i.destination;if(_&&S){const X=f(o,r);if(!X)break;const O=za.processPath(X,S.slice(1),o,S.length-1,{ignoreActors:i.ignoreCollision,ignoreGroundHazards:i.ignoreGroundHazards});p=O.lastValidPos,r===o.player.id?o.player={...o.player,position:p}:o.enemies=o.enemies.map(K=>K.id===r?{...K,position:p}:K),A||(o=Ni(o,"MOVE_END","Displacement",{destination:p,targetActorId:r},{...a,targetId:r},!0,260),A=!0),O.result.effects.length>0&&(o=Ni(o,"ON_PASS","TilePath",{path:S.slice(1),targetActorId:r},{...a,targetId:r},!1,80),o=pi(o,O.result.effects,{targetId:r})),O.result.messages.length>0&&(o.message=ss(o.message,O.result.messages,"INFO","HAZARD"));const q=r===o.player.id||o.enemies.some(K=>K.id===r);if(!O.interrupt&&q){const K=ze.getTileAt(o,p);o=Ni(o,"ON_ENTER","TileEnter",{position:p,targetActorId:r,tileBaseId:K?.baseId},{...a,targetId:r},!1,80);const ue=f(o,r);if(!ue)break;const G=za.processEntry(ue,K,o);G.effects.length>0&&(o=pi(o,G.effects,{targetId:r})),G.messages.length>0&&(o.message=ss(o.message,G.messages,"INFO","HAZARD"))}if(O.result.newMomentum&&O.result.newMomentum>0){const K=O.lastValidPos,ue=S.length>1?S[S.length-2]:b,G=fa(ue,K);if(G!==-1){const _e=Pn(G);let oe=K,be=5;for(;be>0;){const pe=Yn(oe,_e);if(!ze.isWalkable(o,pe)||(r===o.player.id?o.enemies.find(ae=>ae.hp>0&&ne(ae.position,pe)):ne(o.player.position,pe)?o.player:o.enemies.find(ae=>ae.id!==r&&ae.hp>0&&ne(ae.position,pe))))break;const ee=ze.getTileAt(o,pe);if(ee){const ae=za.processTransition(h,ee,o,1);if(oe=pe,ae.effects.length>0&&(o=pi(o,ae.effects,{targetId:r})),ae.messages.length>0&&(o.message=ss(o.message,ae.messages,"INFO","HAZARD")),ae.newMomentum===0||ae.interrupt)break}else{oe=pe;break}be--}p=oe}}}const g=[...o.visualEvents||[]],R=!!(i.ignoreCollision||i.isFling),I=R?g.reduce((X,O)=>{if(O.type!=="kinetic_trace")return X;const q=O.payload;return q&&(q.movementType??"slide")==="slide"?X+1:X},0):0,C=v?0:R?Math.min(640,I*90):0,M=Math.max(y,C),N={actorId:r,origin:b,path:i.path||(v?[b,p]:Ut(b,p)),destination:p,movementType:v?"teleport":"slide",durationMs:i.animationDuration??(v?180:Math.max(120,(i.path?.length||Ut(b,p).length)*110)),startDelayMs:M,wasLethal:o.tiles.get(he(p))?.traits.has("HAZARDOUS")||!1},Y=g;if(v)Y.push({type:"kinetic_trace",payload:N});else{let X=!1;for(let O=Y.length-1;O>=0;O--){const q=Y[O];if(q.type!=="kinetic_trace")continue;const K=q.payload;if(!(!K||K.actorId!==r)){if((K.movementType??"slide")==="slide"&&ne(K.destination,N.origin)){const ue=K.path&&K.path.length>0?K.path:[K.origin,K.destination],G=N.path&&N.path.length>0?N.path:[N.origin,N.destination],_e=[...ue,...G.slice(1)];Y[O]={type:"kinetic_trace",payload:{...N,origin:K.origin,path:_e,durationMs:(K.durationMs||0)+(N.durationMs||0),startDelayMs:Math.min(K.startDelayMs??M,M),movementType:"slide",wasLethal:!!(K.wasLethal||N.wasLethal)}},X=!0}break}}X||Y.push({type:"kinetic_trace",payload:N})}if(o.visualEvents=Y,r===o.player.id)o.player={...o.player,position:p,previousPosition:v?p:o.player.position};else{const X=O=>O.id===r?{...O,position:p,previousPosition:v?p:O.position}:O;o.enemies=o.enemies.map(X),o.companions&&(o.companions=o.companions.map(X))}o.occupancyMask=nt.refreshOccupancyMask(o),A||(o=Ni(o,"MOVE_END","Displacement",{destination:p,targetActorId:r},{...a,targetId:r},!0,260)),o=zl(o,{type:"UnitMoved",actorId:r,position:p,payload:{origin:b,destination:p,movementType:N.movementType}})}break}case"Damage":{const r=!!i.reason&&["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage"].includes(i.reason),f=R=>R?.statusEffects?.some(I=>I.type==="marked_predator")?1:0;r&&(o=Ni(o,"HAZARD_CHECK","Damage",{reason:i.reason,amount:i.amount,target:i.target},a,!0,200)),o=Ni(o,"DAMAGE_APPLY","Damage",{reason:i.reason,amount:i.amount,target:i.target,scoreEvent:i.scoreEvent},a,!0,180);let h="",b=null,y,A,v=i.amount;typeof i.target=="string"?i.target==="targetActor"?h=a.targetId||"":i.target!=="area"&&(h=i.target):b=i.target;const S=["fire_damage","lava_sink","burning","hazard_intercept","lava_tick","oil_explosion","void_sink"],_=i.reason&&S.includes(i.reason),p=o.upgrades?.includes("RELIC_EMBER_WARD"),g=o.upgrades?.includes("RELIC_CINDER_ORB");if(_&&h){const I=(h===o.player.id?o.player:o.enemies.find(M=>M.id===h))?.activeSkills?.some(M=>M.id==="ABSORB_FIRE");let C=i.amount;if(h===o.player.id&&p&&(C=Math.max(0,C-1),o.message=Pt(o.message,"Ember Ward dampens the flames.","INFO","COMBAT")),I){const M=C+(h===o.player.id&&g?1:0);return h===o.player.id&&g&&(o.message=Pt(o.message,"Cinder Orb amplifies the absorption.","INFO","COMBAT")),Tf(o,{type:"Heal",target:h,amount:M})}}if(h)if(h===o.player.id){const R=o.player,I=i.scoreEvent?.damageClass||"physical",C=sf(o,i.amount,a.sourceId,R,I,i.reason);let M=C.amount;M+=f(R),_&&p&&(M=Math.max(0,M-1)),i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:M,traitOutgoingMultiplier:C.outgoing,traitIncomingMultiplier:C.incoming,traitTotalMultiplier:C.total}].slice(-500)),o.player=ua(o.player,M),y=o.player.id,A=o.player.position,v=M,_&&(o.hazardBreaches=(o.hazardBreaches||0)+1),_&&g&&(o.player=xx(o.player,1),o.message=Pt(o.message,"Cinder Orb restores 1 HP.","INFO","COMBAT"))}else{const R=o.enemies.find(O=>O.id===h),I=h===o.player.id?o.player.position:R?.position,C=[],M=i.scoreEvent?.damageClass||"physical",N=sf(o,i.amount,a.sourceId,R,M,i.reason),Y=N.amount+f(R);y=h||R?.id,A=I||R?.position,v=Y;const X=O=>{if(O.id===h){const q=ua(O,Y);return q.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],O],C.push(O.position)),q}return O};if(i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:Y,traitOutgoingMultiplier:N.outgoing,traitIncomingMultiplier:N.incoming,traitTotalMultiplier:N.total}].slice(-500)),o.enemies=o.enemies.map(X).filter(O=>O.hp>0),o.companions&&(o.companions=o.companions.map(X).filter(O=>O.hp>0)),C.length>0&&(o=Ni(o,"DEATH_RESOLVE","Damage",{targetActorId:h,reason:i.reason||"damage"},{...a,targetId:h},!0,260)),C.forEach(O=>{o=ql(o,O)}),I&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:I}}]),h===o.player.id&&(o.player.stealthCounter||0)>0)o.player={...o.player,stealthCounter:Math.max(0,(o.player.stealthCounter||0)-1)};else if(h!==o.player.id){const O=q=>q.id===h?{...q,stealthCounter:Math.max(0,(q.stealthCounter||0)-1)}:q;o.enemies=o.enemies.map(O),o.companions&&(o.companions=o.companions.map(O))}h===o.player.id&&o.player.archetype==="HUNTER"&&i.source&&fa(i.source,o.player.position)!==-1&&(o.message=Pt(o.message,"You roll away!","INFO","COMBAT")),R&&R.archetype==="HUNTER"&&i.source&&fa(i.source,R.position)!==-1&&(o.message=Pt(o.message,`${R.subtype||R.id} rolls away!`,"INFO","COMBAT"))}else if(b){const R=Ng(o,b),I=i.scoreEvent?.damageClass||"physical",C=sf(o,i.amount,a.sourceId,R,I,i.reason),M=C.amount;y=R?.id,A=b,v=M+f(R||void 0),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:b}}],i.scoreEvent&&R&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,targetId:R.id,finalPower:M,traitOutgoingMultiplier:C.outgoing,traitIncomingMultiplier:C.incoming,traitTotalMultiplier:C.total}].slice(-500)),ne(o.player.position,b)&&(o.player=ua(o.player,M+f(o.player)),_&&(o.hazardBreaches=(o.hazardBreaches||0)+1),o.player.hp<=0);const N=O=>{if(ne(O.position,b)){const q=ua(O,M+f(O));return q.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],O],X.push(O.id),Y.push(O.position)),q}return O},Y=[],X=[];o.enemies=o.enemies.map(N).filter(O=>O.hp>0),o.companions&&(o.companions=o.companions.map(N).filter(O=>O.hp>0)),X.forEach(O=>{o=Ni(o,"DEATH_RESOLVE","Damage",{targetActorId:O,reason:i.reason||"area_damage"},{...a,targetId:O},!0,260)}),Y.forEach(O=>{o=ql(o,O)})}v>0&&(o=zl(o,{type:"DamageTaken",targetId:y||h||void 0,position:A,payload:{amount:v,reason:i.reason,sourceId:a.sourceId}}));break}case"Heal":{const r=y=>({...y,hp:Math.min(y.maxHp,y.hp+i.amount)}),f=i.target==="targetActor"?a.targetId:i.target;let h,b;if(f){const y=f===o.player.id?o.player:o.enemies.find(A=>A.id===f)||o.companions?.find(A=>A.id===f);if(y){const A=f===o.player.id?"You":y.subtype||y.id;if(o.message=Pt(o.message,`${A} recover ${i.amount} HP.`,"INFO","COMBAT"),f===o.player.id)o.player=r(o.player),h=o.player.id,b=o.player.position;else{const v=S=>S.id===f?r(S):S;o.enemies=o.enemies.map(v),o.companions&&(o.companions=o.companions.map(v)),h=y.id,b=y.position}}}h&&(o=zl(o,{type:"Healed",targetId:h,position:b,payload:{amount:i.amount,sourceId:a.sourceId}}));break}case"ApplyStatus":{o=Ni(o,"STATUS_APPLY","ApplyStatus",{status:i.status,duration:i.duration,target:i.target},a,!0,160);let r="",f=null;typeof i.target=="string"?i.target==="targetActor"?r=a.targetId||"":r=i.target:f=i.target;let h=f;const b=a.sourceId?a.sourceId===o.player.id?o.player:o.enemies.find(v=>v.id===a.sourceId):void 0,y=b?Nx(i.duration,Ze(b)):i.duration;if(r){const v=r===o.player.id?o.player:o.enemies.find(S=>S.id===r)||o.companions?.find(S=>S.id===r);if(v){h=v.position;const S=r===o.player.id?"You":`${v.subtype||"enemy"}#${v.id}`,_=r===o.player.id?"are":"is";if(o.message=Pt(o.message,`${S} ${_} ${i.status}!`,"INFO","COMBAT"),r===o.player.id)o.player=vf(o.player,i.status,y);else{const p=g=>g.id===r?vf(g,i.status,y):g;o.enemies=o.enemies.map(p),o.companions&&(o.companions=o.companions.map(p))}}}i.status==="stunned"&&h&&(o.visualEvents=[...o.visualEvents||[],{type:"shake",payload:{intensity:"low"}},{type:"vfx",payload:{type:"stunBurst",position:h}},{type:"combat_text",payload:{text:"STUNNED",position:h}}]);const A=r||(h?Ng(o,h)?.id:void 0);o=zl(o,{type:"StatusApplied",targetId:A,position:h||void 0,payload:{status:i.status,duration:y,sourceId:a.sourceId}});break}case"PickupShield":{const r=i.position||o.shieldPosition;if(r&&o.shieldPosition&&ne(o.shieldPosition,r)){o.hasShield=!0,o.shieldPosition=void 0;const f={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Shield Bash.",slot:"utility",cooldown:3,currentCooldown:0,range:1,upgrades:[],activeUpgrades:[]};o.player.activeSkills.some(h=>h.id==="BULWARK_CHARGE")||(o.player={...o.player,activeSkills:[...o.player.activeSkills,f]})}break}case"PickupSpear":{const r=i.position||o.spearPosition;r&&o.spearPosition&&ne(o.spearPosition,r)&&(o.hasSpear=!0,o.spearPosition=void 0);break}case"SpawnItem":{if(i.itemType==="spear")o.spearPosition=i.position,a.sourceId===o.player.id&&(o.hasSpear=!1);else if(i.itemType==="bomb"){const r=o.initialSeed??o.rngSeed??"0",f=(o.turnNumber<<16)+(o.actionLog?.length??0)+o.enemies.length,h=`bomb-${Bo(r,f,8,"bomb")}`,b=ma({id:h,type:"enemy",subtype:"bomb",factionId:"enemy",position:i.position,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});b.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.enemies=[...o.enemies,b]}else i.itemType==="shield"&&(o.shieldPosition=i.position,o.hasShield=!1);break}case"LavaSink":{o=Ni(o,"HAZARD_CHECK","LavaSink",{target:i.target},a,!0,240);const r=i.target,f=r===o.player.id?o.player:o.enemies.find(h=>h.id===r);f&&(o=Ni(o,"DEATH_RESOLVE","LavaSink",{targetId:r},{...a,targetId:r},!0,280),r===o.player.id?o.player=ua(o.player,99):(o.enemies=o.enemies.filter(h=>h.id!==r),o.dyingEntities=[...o.dyingEntities||[],f],o=ql(o,f.position)),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:f.position}}]);break}case"Impact":{const r=i.target,f=r===o.player.id?o.player:o.enemies.find(h=>h.id===r);if(f&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:f.position}}],i.damage>0))if(r===o.player.id)o.player=ua(o.player,i.damage);else{const h=b=>b.id===r?ua(b,i.damage):b;o.enemies=o.enemies.map(h).filter(b=>b.hp>0),o.companions&&(o.companions=o.companions.map(h).filter(b=>b.hp>0))}break}case"Message":{o.message=[...o.message,If(i.text,"INFO","SYSTEM")].slice(-50),o=zl(o,{type:"MessageLogged",payload:{text:i.text}});break}case"Juice":{if(i.effect==="combat_text"&&i.text&&(o.message=Pt(o.message,i.text,"VERBOSE","SYSTEM")),i.effect==="impact"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;r&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:r}}])}if(i.effect==="flash"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;r&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"flash",position:r}}])}if(i.effect==="spearTrail"&&i.path&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"spear_trail",path:i.path}}]),i.effect==="lavaSink"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;if(r){const f=o.enemies.find(h=>ne(h.position,r));f&&(o.dyingEntities=[...o.dyingEntities||[],f],o.enemies=o.enemies.filter(h=>!ne(h.position,r)),o.companions&&(o.companions=o.companions.filter(h=>!ne(h.position,r))),o=ql(o,r),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:r}}])}}break}case"UpdateComponent":{const r=(f,h,b)=>{const y=new Map(f.components||[]);return y.set(h,b),{...f,components:y}};if(i.target==="self")o.player=r(o.player,i.key,i.value);else if(i.target==="targetActor"&&a.targetId)if(a.targetId===o.player.id)o.player=r(o.player,i.key,i.value);else{const f=h=>h.id===a.targetId?r(h,i.key,i.value):h;o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f))}break}case"ModifyCooldown":{const r=h=>({...h,activeSkills:h.activeSkills?.map(b=>b.id!==i.skillId?b:{...b,currentCooldown:i.setExact?i.amount:Math.max(0,b.currentCooldown+i.amount)})}),f=a.sourceId||o.player.id;f===o.player.id?o.player=r(o.player):(o.enemies=o.enemies.map(h=>h.id===f?r(h):h),o.companions&&(o.companions=o.companions.map(h=>h.id===f?r(h):h)));break}case"SpawnCorpse":{o=ql(o,i.position);break}case"RemoveCorpse":{o=nv(o,i.position),o.dyingEntities=(o.dyingEntities||[]).filter(r=>!ne(r.position,i.position));break}case"SpawnActor":{const r=Xl(i.actor);o.enemies=[...o.enemies,r],r.companionOf&&(o.companions=[...o.companions||[],r]),o.initiativeQueue&&(o.initiativeQueue=Hx(o.initiativeQueue,r));break}case"PlaceFire":{const r=he(i.position);c();let f=o.tiles.get(r);f?f={...f,traits:new Set(f.traits),effects:[...f.effects]}:f={baseId:"STONE",position:i.position,traits:new Set(Io.STONE.defaultTraits),effects:[]},o.tiles.set(r,f);const h=za.applyEffect(f,"FIRE",i.duration,1,o,a.sourceId);h.messages.length>0&&(o.message=ss(o.message,h.messages,"INFO","HAZARD"));break}case"PlaceTrap":{o.traps||(o.traps=[]),o.traps=[...o.traps,{position:i.position,ownerId:i.ownerId,isRevealed:!1,cooldown:0,volatileCore:i.volatileCore,chainReaction:i.chainReaction,resetCooldown:i.resetCooldown}];break}case"RemoveTrap":{o.traps&&(i.ownerId?o.traps=o.traps.filter(r=>r.ownerId!==i.ownerId):o.traps=o.traps.filter(r=>!ne(r.position,i.position)));break}case"SetTrapCooldown":{o.traps&&(o.traps=o.traps.map(r=>i.ownerId&&r.ownerId!==i.ownerId||!ne(r.position,i.position)?r:{...r,cooldown:Math.max(0,i.cooldown)}));break}case"SetStealth":{const r=f=>({...f,stealthCounter:(f.stealthCounter||0)+i.amount});i.target==="self"?o.player=r(o.player):(o.enemies=o.enemies.map(f=>f.id===i.target?r(f):f),o.companions&&(o.companions=o.companions.map(f=>f.id===i.target?r(f):f)));break}case"UpdateCompanionState":{const r=i.target==="self"?a.sourceId||o.player.id:i.target,f=h=>h.id!==r?h:{...h,companionState:{...h.companionState,mode:i.mode||h.companionState?.mode,markTarget:i.markTarget!==void 0?i.markTarget:h.companionState?.markTarget,orbitStep:i.mode==="scout"?0:h.companionState?.orbitStep,apexStrikeCooldown:i.apexStrikeCooldown!==void 0?i.apexStrikeCooldown:h.companionState?.apexStrikeCooldown,healCooldown:i.healCooldown!==void 0?i.healCooldown:h.companionState?.healCooldown}};o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f));break}case"GameOver":{o.gameStatus="lost";break}}return o},pi=(e,i,a={})=>{const o=e.stackTrace?.length||0,c=Mg(e,i,{apply:(b,y)=>Tf(b,y,a),describe:b=>b.type,preserveInputOrder:!0,startTick:o+1});let r=c.state,f=[...e.stackTrace||[],...c.trace];const h=Sx(r);if(h.length>0){const b=Mg(r,h,{apply:(y,A)=>Tf(y,A,{}),describe:y=>y.type,preserveInputOrder:!0,startTick:f.length+1});r=b.state,f=[...f,...b.trace]}return{...r,stackTrace:f}},lv={id:"grapple_hook",name:"Grapple Hook",description:"Tests for grapple hook mechanics including LoS, lava sinking, and weight-based behavior",scenarios:[{id:"hook_lava_intercept",title:"Lava Interceptor & LoS",description:"Verify LoS blocking and Lava killing targets.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["lava","line-of-sight","displacement"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},["GRAPPLE_HOOK"]),e.spawnEnemy("footman",{q:4,r:4,s:-8},"target1"),e.spawnEnemy("footman",{q:7,r:3,s:-10},"hidden"),e.setTile({q:6,r:4,s:-10},"wall"),e.setTile({q:4,r:5,s:-9},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:3,s:-10}),e.useSkill("GRAPPLE_HOOK",{q:4,r:4,s:-8}),e.wait(),e.wait()},verify:(e,i)=>{const a=e.player,o=e.enemies.find(r=>r.id==="target1"),c={playerInOriginalPosition:a.position.q===4&&a.position.r===6&&a.position.s===-10,target1Dead:!o,losWarning:i.some(r=>r.includes("Line of sight"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}},{id:"hook_wall_anchor_zip",title:"Heavy Zip to Wall",description:"Verify zipping to a wall and stunning nearby enemies.",relatedSkills:["GRAPPLE_HOOK"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["wall","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK"]),e.setTile({q:6,r:3,s:-9},"wall"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"blocker"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"stunMe"),e.spawnEnemy("footman",{q:7,r:5,s:-12},"noStun")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:6,r:3,s:-9}),e.useSkill("GRAPPLE_HOOK",{q:6,r:6,s:-12})},verify:(e,i)=>{const a=e.enemies.find(r=>r.id==="stunMe"),o=e.enemies.find(r=>r.id==="noStun"),c={stunnedEnemy:!!(a&&a.statusEffects.some(r=>r.type==="stunned")),safeEnemy:!!(o&&!o.statusEffects.some(r=>r.type==="stunned")),zipLog:i.some(r=>r.includes("Zipped")),lavaSinkLog:i.some(r=>r.includes("Lava Sink"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Player Pos:",e.player.position),console.log("Victim Status:",a?.statusEffects)),Object.values(c).every(r=>r===!0)}}]},rv={id:"shield_throw",name:"Shield Throw",description:"Tests for shield throw mechanics including push, stun, and collision behavior",scenarios:[{id:"shield_stun_push",title:"Standard Push",description:"Verify 4-tile push in a straight line.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,i)=>{const a=e.enemies.find(c=>c.id==="victim"),o={victimAt1:a?.position.r===1,victimStunned:i?.some(c=>c.includes("stunned"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Shield Throw Failed:",o),console.log("Enemy Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"shield_unit_collision",title:"Unit Collision",description:"Verify push stops when hitting another unit.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim"),e.spawnEnemy("shieldbearer",{q:3,r:3,s:-6},"obstacle"),e.setTile({q:3,r:1,s:-4},"lava")},run:e=>e.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(e,i)=>{const a=e.enemies.find(r=>r.id==="victim"),o=e.enemies.find(r=>r.id==="obstacle"),c={victimPushed:(a?.position.r??5)===3,obstacleDead:!o};return Object.values(c).some(r=>r===!1)&&(console.log(" Shield Throw Failed:",c),console.log("Victim Pushed:",c.victimPushed),console.log("Victim Pos:",a?.position),console.log("Obstacle Dead:",c.obstacleDead),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}}]},cv={id:"auto_attack",name:"Auto Attack",description:"Tests for auto-attack passive skill including turn-start memory and friendly fire logic",scenarios:[{id:"auto_attack_persistence_stress_test",title:"Persistence: Three-Point Validation",description:"Verifies that Auto-Attack only hits units that were adjacent at BOTH start and end.",relatedSkills:["AUTO_ATTACK","BASIC_MOVE"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","spatial-memory","edge-case"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["AUTO_ATTACK","BASIC_MOVE"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"persistent_foe"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"new_neighbor"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"former_neighbor"),e.state.player.previousPosition={q:4,r:5,s:-9}},run:e=>{e.move({q:4,r:6,s:-10})},verify:(e,i)=>{const a=e.enemies.find(f=>f.id==="persistent_foe"),o=e.enemies.find(f=>f.id==="new_neighbor"),c=e.enemies.find(f=>f.id==="former_neighbor"),r={persistentDead:!a||a.hp<a.maxHp,ignoredNew:o&&o.hp===o.maxHp,ignoredFormer:c&&c.hp===c.maxHp,logFound:i.some(f=>f.includes("attacked footman"))};return Object.values(r).some(f=>f===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i)),Object.values(r).every(f=>f===!0)}},{id:"enemy_auto_attack_no_friendly_fire",title:"Enemy Auto-Attack: Team Alignment",description:"Ensures enemy passives only target the player and not their own allies.",relatedSkills:["AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","alignment","friendly-fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},[]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"enemy_attacker");const i=e.state.enemies.find(a=>a.id==="enemy_attacker");i&&(i.activeSkills=[{id:"AUTO_ATTACK",range:1}],i.previousPosition={q:3,r:5,s:-8}),e.spawnEnemy("shieldBearer",{q:2,r:6,s:-8},"enemy_ally"),i.previousPosition={q:3,r:5,s:-8},e.state.player.previousPosition={q:3,r:6,s:-9}},run:e=>{e.wait()},verify:(e,i)=>{const a=e.player,o=e.enemies.find(r=>r.id==="enemy_ally"),c={playerHit:a.hp<a.maxHp,allySafe:o&&o.hp===o.maxHp,hitPlayerLog:i.some(r=>r.includes("attacked you")),hitAllyLog:!i.some(r=>r.includes("attacked enemy_ally"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i)),Object.values(c).every(r=>r===!0)}}]},uv={id:"integration",name:"Integration Tests",description:"Multi-skill integration scenarios testing complex interactions",scenarios:[{id:"environmental_chain_reaction",title:"Environmental Chain Reaction",description:"Test complex environmental interactions with multiple hazards",relatedSkills:["GRAPPLE_HOOK","SHIELD_THROW"],category:"hazards",difficulty:"advanced",isTutorial:!1,tags:["lava","wall","environmental-kill","chain-reaction"],setup:e=>{e.setPlayer({q:5,r:4,s:-9},["GRAPPLE_HOOK","SHIELD_THROW"]),e.spawnEnemy("shieldbearer",{q:5,r:2,s:-7},"victim1"),e.spawnEnemy("footman",{q:5,r:6,s:-11},"victim2"),e.spawnEnemy("footman",{q:5,r:7,s:-12},"victim3"),e.setTile({q:5,r:8,s:-13},"lava")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:5,r:2,s:-7}),e.useSkill("SHIELD_THROW",{q:5,r:5,s:-10})},verify:(e,i)=>{const a=e.player.position.q===5&&e.player.position.r===3,o=!e.enemies.find(y=>y.id==="victim3")||!!e.dyingEntities?.find(y=>y.id==="victim3"),c=!e.enemies.find(y=>y.id==="victim2")||!!e.dyingEntities?.find(y=>y.id==="victim2"),r=e.enemies.find(y=>y.id==="victim1"),f=r&&i.some(y=>y.includes("stunned")),h=r&&r.position.q===5&&r.position.r===6,b=[a,o,c,f,h];return Object.values(b).some(y=>y===!1)&&(console.log(" Environmental Chain Reaction Failed:",b),console.log("Player at 5,3:",a),console.log("Player Pos:",e.player.position),console.log("Logs found:",i),console.log("Victim1 at 5,6:",h),console.log("Victim1 Pos:",r?.position),console.log("Victim1 Stunned:",f),console.log("Victim2 Dead:",c),console.log("Victim3 Dead:",o)),Object.values(b).every(y=>y===!0)}},{id:"auto_attack_after_grapple",title:"Auto-Attack After Grapple",description:"Verify auto-attack triggers correctly after grapple displacement",relatedSkills:["GRAPPLE_HOOK","AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","displacement","integration"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK","AUTO_ATTACK"]),e.state.player.previousPosition={q:4,r:6,s:-10},e.spawnEnemy("footman",{q:7,r:6,s:-13},"grappleHookTarget"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"safe"),e.spawnEnemy("footman",{q:4,r:5,s:-9},"auto-attacked"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"safe2")},run:e=>{e.useSkill("GRAPPLE_HOOK",{q:7,r:6,s:-13})},verify:(e,i)=>{const a=e.enemies.find(h=>h.id==="grappleHookTarget"),o=e.enemies.find(h=>h.id==="auto-attacked"),c=e.enemies.find(h=>h.id==="safe"),r=e.enemies.find(h=>h.id==="safe2"),f={targetPulled:!!(a&&a.position.q<7),targetNotHit:!!(a&&a.hp===a.maxHp),safeNotHit:!!(c&&c.hp===c.maxHp),safe2NotHit:!!(r&&r.hp===r.maxHp),autoattackedDead:!o||o.hp<=0};return Object.values(f).some(h=>h===!1)&&(console.log(" Scenario Failed Details:",f),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i),console.log("target Pos:",a?.position.q),console.log("target Pulled:",f.targetPulled),console.log("target Not Hit:",f.targetNotHit),console.log("safe Not Hit:",f.safeNotHit),console.log("safe2 Not Hit:",f.safe2NotHit),console.log("autoattacked Dead:",f.autoattackedDead)),Object.values(f).every(h=>h===!0)}}]},dv="modulepreload",fv=function(e){return"/Hop/"+e},Rg={},mv=function(i,a,o){let c=Promise.resolve();if(a&&a.length>0){let y=function(A){return Promise.all(A.map(v=>Promise.resolve(v).then(S=>({status:"fulfilled",value:S}),S=>({status:"rejected",reason:S}))))};var f=y;document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),b=h?.nonce||h?.getAttribute("nonce");c=y(a.map(A=>{if(A=fv(A),A in Rg)return;Rg[A]=!0;const v=A.endsWith(".css"),S=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${A}"]${S}`))return;const _=document.createElement("link");if(_.rel=v?"stylesheet":dv,v||(_.as="script"),_.crossOrigin="",_.href=A,b&&_.setAttribute("nonce",b),document.head.appendChild(_),v)return new Promise((p,g)=>{_.addEventListener("load",p),_.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${A}`)))})}))}function r(h){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=h,window.dispatchEvent(b),!b.defaultPrevented)throw h}return c.then(h=>{for(const b of h||[])b.status==="rejected"&&r(b.reason);return i().catch(r)})},pv=async(e,i)=>{if(typeof window>"u")try{(await mv(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])).appendFileSync(e,i)}catch(a){console.warn(`Failed to persist log to ${e}:`,a)}},hv={id:"basic_attack",name:"Basic Attack",description:"Tests for basic melee attack mechanics including range and move-to-attack logic",scenarios:[{id:"basic_attack_player_mechanics",title:"Player Basic Attack: Range & Bump",description:"Validates range enforcement, turn accounting, and bump-attack redirection.",relatedSkills:["BASIC_ATTACK"],category:"combat",tags:["melee","targeting","bump-attack"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"far_victim")},run:e=>{e.useSkill("BASIC_ATTACK",{q:3,r:4,s:-7}),e.move({q:3,r:5,s:-8})},verify:(e,i)=>{const a=e.enemies.find(r=>r.id==="adj_victim"),o=e.enemies.find(r=>r.id==="far_victim"),c={farStaysAlive:o&&o.hp===o.maxHp,rangeError:i.some(r=>r.includes("out of range")),adjTookDamage:!a||a.hp<=a.maxHp,playerPositionHeld:ne(e.player.position,{q:3,r:6,s:-9}),oneTurnConsumed:e.turnsSpent===1};if(Object.values(c).some(r=>r===!1)){const r=` Basic Attack Failed: ${JSON.stringify(c)}
Current Player Pos: ${JSON.stringify(e.player.position)}
Logs: ${JSON.stringify(i)}
`;console.log(r),pv("integration_debug.txt",r)}return Object.values(c).every(r=>r===!0)}}]},gv={id:"spear_throw",name:"Spear Throw",description:"Tests for spear throw mechanics including range, LoS, and spear retrieval",scenarios:[{id:"spear_kill",title:"Spear Kill",description:"Throw spear to kill an enemy and verify item spawn.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["projectile","combat","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:3,r:4,s:-7},"target"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,i)=>{const a=!e.enemies.find(r=>r.id==="target"),o=!!e.spearPosition&&e.spearPosition.q===3&&e.spearPosition.r===4,c=i.some(r=>r.includes("Spear killed"));return a&&o&&c}},{id:"spear_miss_spawn",title:"Spear Rejects Empty Tile",description:"Enemy-only contract: empty tiles are invalid targets and do not spawn spear.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","item-spawn"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(e,i)=>{const a=i.some(c=>c.includes("No enemy at target.")),o=e.hasSpear===!0&&!e.spearPosition;return a&&o}},{id:"spear_wall_block",title:"Spear Wall Block",description:"Spear throw is blocked by walls.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["projectile","wall","boundary"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["SPEAR_THROW"]),e.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),e.setTile({q:4,r:4,s:-8},"wall"),e.state.hasSpear=!0},run:e=>{e.useSkill("SPEAR_THROW",{q:4,r:3,s:-7})},verify:(e,i)=>{const a=i.some(r=>r.includes("No clear line of sight to enemy.")),o=!!e.enemies.find(r=>r.id==="target"),c=e.hasSpear===!0&&!e.spearPosition;return a&&o&&c}}]},yv={id:"dash",name:"Dash",description:"Tests for dash mechanics including path validation and shield-based enemy shunting",scenarios:[{id:"dash_shunt_lava",title:"Shunt into Lava",description:"Shunt an enemy into lava for an environmental kill.",relatedSkills:["DASH"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["lava","push","environmental-kill"],setup:e=>{e.setPlayer({q:3,r:5,s:-8},["DASH"]),e.spawnEnemy("footman",{q:5,r:5,s:-10},"victim"),e.setTile({q:7,r:5,s:-12},"lava"),e.state.hasShield=!0},run:e=>{e.useSkill("DASH",{q:5,r:5,s:-10})},verify:(e,i)=>{const a=e.enemies.find(c=>c.id==="victim"),o={playerPosition:e.player.position.q===5&&e.player.position.r===5,victimDead:!a};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Shunt Lava Failed:",o),console.log("Final State:",e.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"dash_comprehensive_validation",title:"Dash: Constraints & Shunt Physics",description:"Validates range limits, wall blocking, and Shield Shunt displacement in one sequence.",relatedSkills:["DASH"],category:"movement",difficulty:"advanced",isTutorial:!1,tags:["stress-test","collision","range"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["DASH"]),e.state.hasShield=!0,e.setTile({q:4,r:4,s:-8},"wall"),e.setTile({q:6,r:5,s:-11},"wall"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"victim")},run:e=>{e.useSkill("DASH",{q:4,r:7,s:-11}),e.useSkill("DASH",{q:7,r:4,s:-11}),e.useSkill("DASH",{q:6,r:6,s:-12}),e.useSkill("DASH",{q:4,r:5,s:-9})},verify:(e,i)=>{const a=e.enemies.find(c=>c.id==="victim"),o={finalPositionCorrect:e.player.position.q===4&&e.player.position.r===6,victimPushed:!!(a&&a.position.q===4&&a.position.r===5),wallErrorFound:i.some(c=>c.includes("wall blocks")),axialRangeErrorFound:i.some(c=>c.includes("Axial only!")),shuntSuccess:i.some(c=>c.includes("Shield Shunt")),twoTurnSpent:e.turnsSpent===2};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Stress Test Failed:",o),console.log("Final State:",e.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},bv={id:"jump",name:"Jump",description:"Tests for jump mechanics including range validation and stunning landing",scenarios:[{id:"jump_basic",title:"Basic Jump",description:"Jump to a tile.",relatedSkills:["JUMP"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","leap"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.setTile({q:3,r:5,s:-8},"lava")},run:e=>{e.useSkill("JUMP",{q:3,r:4,s:-7})},verify:(e,i)=>{const a=ne(e.player.position,{q:3,r:4,s:-7}),o=bf(e.occupancyMask,{q:3,r:4}),c=!bf(e.occupancyMask,{q:3,r:6}),r={playerInPosition:a,spatialMaskRefreshed:o&&c,noLavaDamage:e.player.hp===e.player.maxHp,jumpedSuccessfully:i.some(f=>f.includes("Jumped"))};return Object.values(r).some(f=>f===!1)&&(console.error(" Jump Basic Failed:",r),console.error("Final State:",e.player.position),console.error("Logs:",i)),Object.values(r).every(f=>f===!0)}},{id:"jump_stunning_landing",title:"Stunning Landing",description:"Jump into a group of enemies and ensure neighbors are stunned.",relatedSkills:["JUMP"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["movement","stun","aoe"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["JUMP"]),e.addUpgrade("JUMP","STUNNING_LANDING"),e.spawnEnemy("footman",{q:3,r:7,s:-10},"neighbor_1"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"neighbor_2"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"distant_enemy")},run:e=>{e.useSkill("JUMP",{q:3,r:8,s:-11})},verify:(e,i,a=[])=>{const o={n1StunnedMessage:i.some(c=>c.includes("stunned by landing impact")),hasShakeJuice:a.some(c=>c.type==="shake"),hasStunBurstVFX:a.some(c=>c.type==="vfx"&&c.payload.type==="stunBurst"),hasStunnedCombatText:a.some(c=>c.type==="combat_text"&&c.payload.text==="STUNNED"),playerAtTarget:ne(e.player.position,{q:3,r:8,s:-11}),oneTurnSpent:e.turnsSpent===1};return Object.values(o).some(c=>c===!1)&&(console.error(" Jump Stunning Landing Failed:",o),console.error("Final State:",e.player.position),console.error("turnsSpent:",e.turnsSpent),console.error("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},xv={id:"shield_bash",name:"Shield Bash",description:"Tests for shield bash mechanics including push, stun, and collision behavior",scenarios:[{id:"bash_push",title:"Shield Push",description:"Push an enemy into lava.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","lava"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.setTile({q:3,r:4,s:-7},"lava"),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,i)=>{const a={enemyGone:e.enemies.length===0,messageOk:i.some(o=>o.includes("Lava"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Current Player Pos:",e.player.position),console.log("Logs found:",i)),Object.values(a).every(o=>o===!0)}},{id:"bash_wall_stun",title:"Wall Slam Stun",description:"Bash enemy into wall to cause a stun.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"victim"),e.setTile({q:3,r:4,s:-7},"wall")},run:e=>{e.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(e,i)=>{const a=e.enemies.find(r=>r.id==="victim");if(!a)return!1;const o=ne(a.position,{q:3,r:5,s:-8}),c=i.some(r=>r.includes("into obstacle"));return o&&c}}]},vv={id:"bulwark_charge",name:"Bulwark Charge",description:"Tests for bulwark charge mechanics including chain pushing and wall slamming",scenarios:[{id:"chain_stun",title:"The Chain-Stun",description:"Wall prevents chain movement, causing all members to be stunned.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["chain","wall","stun"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,i)=>!0},{id:"bulwark_chain_push",title:"Bulwark Chain Push",description:"Push a chain of enemies successfully.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["chain","push","displacement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"A"),e.spawnEnemy("footman",{q:3,r:4,s:-7},"B"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,i)=>!0}]},Sv={id:"vault",name:"Vault",description:"Tests for vault mechanics including state-shifting behavior between odd and even turns",scenarios:[{id:"vault_shift_stun",title:"Vault Stun (Odd Turn)",description:"Verify vault stuns neighbors on Turn 1.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","stun","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>{const a={stunned:i.some(o=>o.includes("Stun Vault executed!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Stun Failed:",a),console.log("Logs:",i)),Object.values(a).every(o=>o===!0)}},{id:"vault_shift_normal",title:"Vault Normal (Even Turn)",description:"Verify vault is normal on Turn 2.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","movement"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.setTile({q:3,r:5,s:-8},"lava"),e.spawnEnemy("footman",{q:4,r:3,s:-7},"victim")},run:e=>{e.wait(),e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>{const a={vaulted:i.some(o=>o.includes("Vaulted!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Normal Failed:",a),console.log("Logs:",i)),Object.values(a).every(o=>o===!0)}}]},Av={id:"basic_move",name:"Basic Move",description:"Fundamental movement mechanics",scenarios:[{id:"walk_to_tile",title:"Movement 101",description:"Move your character from the center to an adjacent tile.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","basics"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.setTile({q:4,r:6,s:-10},"wall")},run:e=>{e.move({q:4,r:6,s:-10}),e.move({q:4,r:4,s:-8})},verify:(e,i)=>{const a={positionCorrect:ne(e.player.position,{q:4,r:4,s:-8}),logFound:i.some(o=>o.includes("blocked")),oneTurnSpent:e.turnsSpent===1};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Final Position:",e.player.position),console.log("Logs found:",i)),Object.values(a).every(o=>o===!0)}},{id:"free_move_out_of_combat",title:"Exploration Mode",description:"Verify that movement range expands only when no enemies are present.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["movement","exploration","free-move"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE","BASIC_ATTACK"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim")},run:e=>{e.move({q:7,r:1,s:-8}),e.useSkill("BASIC_ATTACK",{q:3,r:5,s:-8}),e.move({q:7,r:1,s:-8})},verify:(e,i)=>{const a=i.filter(r=>r.toLowerCase().includes("out of reach")).length,o=i.some(r=>r.toLowerCase().includes("you attacked")),c={wasBlockedInitially:a===1,attackLogs:o,reachedDistantHex:ne(e.player.position,{q:7,r:1,s:-8})};return Object.values(c).some(r=>r===!1)&&(console.log(" Free Move Scenario Failed:",c),console.log("Final Position:",e.player.position),console.log("Logs found:",i)),Object.values(c).every(r=>r===!0)}},{id:"invalid_enemy_move_intent_is_rejected_pre_execution",title:"Move Intent Rejected Before Execution",description:"Enemy AI may decide to move, but execution must not run a skill the actor does not own.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["movement","validation","intent"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"attacker_without_move");const i=e.getEnemy("attacker_without_move");i&&(i.activeSkills=(i.activeSkills||[]).filter(a=>a.id!=="BASIC_MOVE"))},run:e=>{e.wait()},verify:(e,i)=>{const a=e.enemies.find(c=>c.id==="attacker_without_move"),o={enemyDidNotMove:!!a&&ne(a.position,{q:7,r:5,s:-12}),noMissingSkillRuntimeError:!i.some(c=>c.includes("does not have skill BASIC_MOVE"))};return Object.values(o).some(c=>c===!1)&&(console.log("Invalid Enemy Move Intent Rejection Failed:",o),console.log("Enemy:",a),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"single_enemy_single_action_per_turn",title:"Single Action Per Actor Turn",description:"Each actor resolves exactly one action per turn in normal flow.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["turn-loop","movement","integrity"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"single_actor")},run:e=>{e.wait()},verify:(e,i)=>{const a={q:7,r:5,s:-12},o=e.enemies.find(f=>f.id==="single_actor"),c=o?Ce(a,o.position):-1,r={enemyExists:!!o,movedExactlyOneTile:c===1,noZeroEffectMoveWarning:!i.some(f=>f.includes("produced ZERO effects"))};return Object.values(r).some(f=>f===!1)&&(console.log("Single Action Per Actor Turn Failed:",r),console.log("Enemy:",o),console.log("Logs:",i)),Object.values(r).every(f=>f===!0)}}]},ra=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},SENTINEL_TELEGRAPH:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Telegraph",description:"Marks blast zone."},SENTINEL_BLAST:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Blast",description:"Massive area blast."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},Tv={id:"sentinel_blast",name:"Sentinel Blast",description:"Sentinel unique area-of-effect attack",scenarios:[{id:"blast_aoe",title:"Blast Away",description:"Use Sentinel Blast to hit multiple enemies.",relatedSkills:["SENTINEL_BLAST"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["aoe","damage","sentinel"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["SENTINEL_BLAST"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"center"),e.spawnEnemy("footman",{q:4,r:4,s:-8},"side")},run:e=>{e.useSkill("SENTINEL_BLAST",{q:3,r:5,s:-8})},verify:(e,i)=>i.some(a=>a.includes("massive blast"))},{id:"sentinel_playlist_two_turn_timing",title:"Playlist: Telegraph then Execute",description:"Boss uses a 2-turn skill playlist: telegraph first, blast on next turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["boss","playlist","telegraph"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=e.getEnemy("boss");i&&(i.activeSkills=[ra("BASIC_MOVE"),ra("BASIC_ATTACK"),ra("SENTINEL_TELEGRAPH"),ra("SENTINEL_BLAST")])},run:e=>{e.wait(),e.logs.push(`HP_AFTER_TELEGRAPH=${e.state.player.hp}`),e.wait()},verify:(e,i)=>{const a=i.find(r=>r.startsWith("HP_AFTER_TELEGRAPH=")),o=a?Number(a.split("=")[1]):-1,c={telegraphEmitted:i.some(r=>r.includes("marks the impact zone")),executeEmitted:i.some(r=>r.includes("massive blast")),noDamageOnTelegraphTurn:o===e.player.maxHp,damageOnExecuteTurn:e.player.hp<e.player.maxHp};return Object.values(c).some(r=>r===!1)&&(console.log("Sentinel Playlist Timing Failed:",c),console.log("Logs:",i),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(c).every(r=>r===!0)}},{id:"sentinel_playlist_interruption_by_stun",title:"Playlist: Interruption Cancels Execute",description:"Stunning the boss during telegraph cancels the follow-up execute turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["boss","playlist","interruption","stun"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=e.getEnemy("boss");i&&(i.activeSkills=[ra("BASIC_MOVE"),ra("BASIC_ATTACK"),ra("SENTINEL_TELEGRAPH"),ra("SENTINEL_BLAST")])},run:e=>{e.wait(),e.applyStatus("boss","stunned",1),e.wait()},verify:(e,i)=>{const a=e.enemies.find(c=>c.id==="boss"),o={telegraphEmitted:i.some(c=>c.includes("marks the impact zone")),executeCancelled:!i.some(c=>c.includes("massive blast")),playerUnharmed:e.player.hp===e.player.maxHp,bossStillExists:!!a};return Object.values(o).some(c=>c===!1)&&(console.log("Sentinel Playlist Interruption Failed:",o),console.log("Logs:",i),console.log("Player HP:",e.player.hp,"/",e.player.maxHp),console.log("Boss:",a)),Object.values(o).every(c=>c===!0)}}]},Ev={id:"fireball",name:"Fireball",description:"Validates axial targeting, AoE damage, and environmental fire placement.",scenarios:[{id:"fireball_axial_aoe",title:"Axial Alignment & AoE Spread",description:"Verify the skill only fires axially and damages all neighbors at the impact site.",relatedSkills:["FIREBALL"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["aoe","axial","fire"],setup:e=>{e.setPlayer({q:3,r:6,s:-9},["FIREBALL"]),e.spawnEnemy("footman",{q:5,r:4,s:-9},"primary_target"),e.spawnEnemy("footman",{q:6,r:4,s:-10},"neighbor_target"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"diagonal_enemy"),e.setTile({q:6,r:3,s:-9},"wall"),e.setTile({q:6,r:6,s:-12},"wall"),e.setTile({q:5,r:6,s:-11},"lava")},run:e=>{e.useSkill("FIREBALL",{q:7,r:5,s:-12}),e.useSkill("FIREBALL",{q:5,r:4,s:-9})},verify:()=>!0},{id:"fireball_max_range_edge",title:"Max Range & Fire Duration",description:"Verify fireball at exactly range 3 and check fire duration persistence.",relatedSkills:["FIREBALL"],category:"balancing",difficulty:"intermediate",isTutorial:!1,tags:["range","persistence"],setup:e=>{e.setPlayer({q:0,r:0,s:0},["FIREBALL"]),e.setTile({q:0,r:3,s:-3},"grass")},run:e=>{e.useSkill("FIREBALL",{q:0,r:3,s:-3}),e.wait(),e.wait()},verify:()=>!0}]},wv={id:"hazards_v1",name:"Hazard Consolidation",description:"Verifies centralized hazard logic and flight immunity",scenarios:[{id:"Jump Over Lava",title:"Jump Over Lava",description:"Jumping over lava should not result in damage.",relatedSkills:["JUMP"],category:"hazards",tags:["lava","jump"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["JUMP"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("JUMP",{q:4,r:7,s:-11})},verify:e=>{const i=e.player,a={playerPos:ne(i.position,{q:4,r:7,s:-11}),isAlive:i.hp===i.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Walk Into Lava",title:"Walk Into Lava",description:"Walking into lava should be invalid unless the mover is hazard-safe.",relatedSkills:["BASIC_MOVE"],category:"hazards",tags:["lava","walk"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["BASIC_MOVE"]),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:8,s:-12})},verify:e=>{const i=e.player,a={playerPos:ne(i.position,{q:4,r:9,s:-13}),hpUnchanged:i.hp===i.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Falcon Flying Over Lava",title:"Falcon Flying Over Lava",description:"Flying units (Falcon) should ignore lava during transit and stay.",relatedSkills:["FALCON_COMMAND"],category:"hazards",tags:["lava","falcon","flight"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:e=>{e.wait()},verify:e=>{const i=e.enemies.find(o=>o.id==="my-falcon"),a={falconExists:!!i,falconAlive:(i?.hp||0)>0,falconPos:ne(i?.position,{q:4,r:8,s:-12})};return Object.values(a).every(o=>o===!0)}}]},_v={id:"falcon_command_v2",name:"Falcon's Command",description:"Validates Predator/Scout mode transitions and spatial orbit logic.",scenarios:[{id:"falcon_predator_strike_path",title:"Predator Mode: Apex Strike Geometry",description:`
                Tests the Falcon's flight path from its current position to the Target.
                Layout:
                   (F)  <- Falcon Start (6, 5, -11)
                      .
                         (T) <- Target/Prey (8, 5, -13)
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:2,s:-6},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:2,s:-6}),e.wait()},verify:(e,i)=>{const a=e.companions?.find(r=>r.id==="my-falcon"),o=e.enemies.find(r=>r.id==="prey"),c={modeSet:a?.companionState?.mode==="predator",targetLocked:a?.companionState?.markTarget==="prey",movedCloser:a&&Ce(a.position,{q:4,r:2,s:-6})<7,preyHealthy:o?.hp===o?.maxHp,turnSpent:e.turnsSpent===2};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Falcon Predator Strike Failed:",c),console.log("Falcon:",a)),Object.values(c).every(r=>r===!0)}},{id:"falcon_scout_orbit",title:"Scout Mode: Hex Ring Orbit",description:`
                Ensures that in Scout mode, the Falcon rotates around the mark 
                on the flat-top hex ring.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.spawnFalcon({q:3,r:9,s:-12},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:3,r:6,s:-9}),e.wait(),e.wait()},verify:(e,i)=>{const a=e.companions?.find(r=>r.id==="my-falcon"),o={q:3,r:6,s:-9},c={isScout:a?.companionState?.mode==="scout",onOrbitRing:a&&Ce(a.position,o)===1,hasRotated:a&&!!a.previousPosition&&!ne(a.position,a.previousPosition),turnSpent:e.turnsSpent===3};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Falcon Scout Orbit Failed:",c),console.log("Falcon:",a)),Object.values(c).every(r=>r===!0)}},{id:"falcon_roost_mode",title:"Roost Mode: Return and Heal",description:`
                Ensures that when targeting self, the Falcon returns to the Hunter
                and provides a heal on arrival.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","roost","heal"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=2,e.spawnFalcon({q:3,r:6,s:-9},"my-falcon")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:9,s:-13}),e.wait(),e.wait()},verify:(e,i)=>{const a=e.companions?.find(r=>r.id==="my-falcon"),o=e.player,c={modeRoost:a?.companionState?.mode==="roost",healed:o.hp>2,closeToHunter:a&&Ce(a.position,o.position)<=1};return Object.values(c).some(r=>r===!1)&&console.log(" Scenario Falcon Roost Heal Failed:",c),Object.values(c).every(r=>r===!0)}},{id:"falcon_predator_auto_return",title:"Predator Mode: Auto-Roost on Kill",description:`
                Ensures that if a marked predator target dies, the Falcon
                automatically reverts to Roost mode.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!0,tags:["falcon","predator","cleanup"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.hp=1,e.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),e.spawnEnemy("footman",{q:4,r:7,s:-11},"prey")},run:e=>{e.useSkill("FALCON_COMMAND",{q:4,r:7,s:-11}),e.wait(),e.wait(),e.wait()},verify:(e,i)=>{const a=e.companions?.find(f=>f.id==="my-falcon"),o=e.enemies.find(f=>f.id==="prey"),c=e.player,r={preyDead:!o,autoRoost:a?.companionState?.mode==="roost",healed:c.hp>1};return Object.values(r).some(f=>f===!1),Object.values(r).every(f=>f===!0)}},{id:"falcon_command_metadata_null_safety",title:"Command Metadata Null-Safety",description:`
                Ensures FALCON_COMMAND name/description resolution is safe
                when player context is remapped in harness-like states.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["falcon","null-safety","metadata"],setup:e=>{e.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),e.state.player.id="hunter_remapped"},run:e=>{e.wait()},verify:(e,i)=>{const a={playerIdRemapped:e.player.id==="hunter_remapped",noRuntimeReferenceError:!i.some(o=>o.toLowerCase().includes("cannot read properties"))};return Object.values(a).some(o=>o===!1)&&console.log("Falcon Command Metadata Null-Safety Failed:",a),Object.values(a).every(o=>o===!0)}}]},Mv={id:"kinetic_tri_trap",name:"Kinetic Tri-Trap",description:"Tests for trap deployment and fling mechanics",scenarios:[{id:"tri_trap_basic_deployment",title:"Trap Deployment",description:"Deploy 3 traps on axial tiles at range 2.",relatedSkills:["KINETIC_TRI_TRAP"],category:"deployment",difficulty:"beginner",isTutorial:!0,tags:["trap","deployment"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,i)=>{const a=e.player.position,o=e.traps||[],c={countIsThree:o.length===3,isAtRangeTwo:o.every(r=>Ce(r.position,a)===2),isAxialToPlayer:o.every(r=>r.position.q===a.q||r.position.r===a.r||r.position.s===a.s),trapsHidden:o.every(r=>!r.isRevealed)};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Tri-Trap Deployment Failed:",c),console.log("Traps:",e.traps),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}},{id:"tri_trap_state_tracking",title:"Trap State Tracking",description:"Traps are tracked with correct owner and hidden state.",relatedSkills:["KINETIC_TRI_TRAP"],category:"state",difficulty:"intermediate",isTutorial:!1,tags:["trap","state"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),e.state.player.archetype="HUNTER"},run:e=>{e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10}),e.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(e,i)=>{const a=e.traps,o={trapsExist:a&&a.length>0,allHidden:a?.every(c=>!c.isRevealed)??!1,allZeroCooldown:a?.every(c=>c.cooldown===0)??!1,deployMessage:i.some(c=>c.includes("trap")||c.includes("Trap")),trapsCount:a?.length===3};return Object.values(o).some(c=>c===!1)&&(console.log(" Trap State Failed:",o),console.log("Traps:",e.traps)),Object.values(o).every(c=>c===!0)}}]},Ov={id:"withdrawal",name:"Withdrawal",description:"Tests for shot + backroll mechanics and passive reaction",scenarios:[{id:"withdrawal_basic",title:"Shot and Backroll",description:"Shoot adjacent enemy and backroll to safety.",relatedSkills:["WITHDRAWAL"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["shot","backroll","displacement"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,i)=>{const a=e.enemies.find(c=>c.id==="target"),o={enemyDamagedOrDead:!a||a.hp<a.maxHp,playerMoved:e.player.position.q!==5||e.player.position.r!==5,playerBackrolled:e.player.position.q<5,shotFired:i.some(c=>c.includes("Withdrawal")||c.includes("shot"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Withdrawal Failed:",o),console.log("Player:",e.player.position),console.log("Target HP:",a?.hp)),Object.values(o).every(c=>c===!0)}},{id:"withdrawal_wall_block",title:"Backroll Blocked by Wall",description:"Backroll finds alternate safe spot when wall blocks retreat.",relatedSkills:["WITHDRAWAL"],category:"collision",difficulty:"intermediate",isTutorial:!1,tags:["backroll","wall","pathfinding"],setup:e=>{e.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),e.state.player.archetype="HUNTER",e.setTile({q:4,r:5,s:-9},"wall"),e.setTile({q:3,r:5,s:-8},"wall"),e.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:e=>{e.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(e,i)=>{const a={playerNotOnWall:!ne(e.player.position,{q:4,r:5,s:-9}),playerMoved:e.player.position.q!==5||e.player.position.r!==5};return Object.values(a).some(o=>o===!1)&&(console.log(" Wall Block Failed:",a),console.log("Player:",e.player.position)),Object.values(a).every(o=>o===!0)}}]},Cv={id:"absorb_fire",name:"Absorb Fire Passive",description:"Verifies that fire damage is converted to healing.",scenarios:[{id:"Absorb Fire Damage",title:"Stand on Fire",description:"Player with Absorb Fire should be healed when standing on fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",tags:["fire","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE"]),e.state.player.hp=1,e.setTile({q:4,r:5,s:-9},"stone");const i={q:4,r:5,s:-9},a=e.getTileAt(i);a&&a.effects.push({id:"FIRE",duration:3,potency:1})},run:e=>{e.wait()},verify:e=>{const i=e.player;return i.hp<=1&&console.log("Stand on Fire Failed: HP did not increase",i.hp),i.hp>1}},{id:"Absorb Lava Damage",title:"Walk into Lava",description:"Player with Absorb Fire should be healed when walking into lava.",relatedSkills:["ABSORB_FIRE","BASIC_MOVE"],category:"passive",tags:["lava","healing"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE","BASIC_MOVE"]),e.state.player.hp=1,e.setTile({q:4,r:6,s:-10},"lava")},run:e=>{e.useSkill("BASIC_MOVE",{q:4,r:6,s:-10})},verify:e=>{const i=e.player,a={alive:i.hp>0,healed:i.hp===i.maxHp,onLava:ne(i.position,{q:4,r:6,s:-10})};return(!a.alive||!a.healed||!a.onLava)&&(console.log("Walk into Lava Failed:",a,"HP:",i.hp,"MaxHP:",i.maxHp),console.log("Player Pos:",i.position)),Object.values(a).every(o=>o===!0)}}]},Nv={id:"tile_interactions",name:"Tile Interactions",description:"Verifies interactions with special tiles like Shrines and Stairs.",scenarios:[{id:"shrine_interaction",title:"Shrine Interaction",description:"Moving onto a shrine should trigger an upgrade choice.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["shrine","upgrade"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.shrinePosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"SHRINE",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","SHRINE"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const i={playerOnShrine:ne(e.player.position,{q:4,r:6,s:-10}),isChoosingUpgrade:e.pendingStatus?.status==="choosing_upgrade",hasOptions:e.pendingStatus?.shrineOptions?.length>0};return Object.values(i).every(a=>a===!0)}},{id:"stairs_interaction",title:"Stairs Interaction",description:"Moving onto stairs should trigger level transition.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["stairs","portal"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),e.state.stairsPosition={q:4,r:6,s:-10},e.state.tiles.set("4,6",{baseId:"STAIRS",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","STAIRS"]),effects:[]})},run:e=>{e.move({q:4,r:6,s:-10})},verify:e=>{const i={playerOnStairs:ne(e.player.position,{q:4,r:6,s:-10}),isTransitioning:e.pendingStatus?.status==="playing"||e.pendingStatus?.status==="won",messageFound:e.message.some(a=>a.includes("Descending")||a.includes("Cleared"))};return Object.values(i).every(a=>a===!0)}}]},Rv={id:"telegraph_projection",name:"Telegraph Projection",description:"Deterministic intent previews for next-turn danger tiles.",scenarios:[{id:"telegraph_projection_is_deterministic",title:"Projection Determinism",description:"Same state should always produce the same danger projection.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","determinism"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:7,r:5,s:-12},"threat")},run:e=>{e.wait()},verify:e=>{const i=e.intentPreview,a=i?.dangerTiles||[],o=i?.projections||[],c=a.map(A=>`${A.q},${A.r},${A.s}`),r=new Set(c),f=c.every((A,v)=>v===0||c[v-1].localeCompare(A)<=0),h=o.map(A=>`${A.actorId}|${A.skillId}|${A.targetHex?`${A.targetHex.q},${A.targetHex.r},${A.targetHex.s}`:"none"}`),b=h.every((A,v)=>v===0||h[v-1].localeCompare(A)<=0),y={hasEnginePreview:!!i,noDuplicateTiles:r.size===c.length,tilesAreSorted:f,projectionsAreSorted:b};return Object.values(y).some(A=>A===!1)&&(console.log("Telegraph Projection Determinism Failed:",y),console.log("Engine Preview:",i)),Object.values(y).every(A=>A===!0)}},{id:"telegraph_projection_matches_execute_footprint",title:"Projection Matches Execute Footprint",description:"Projected danger tiles should include the tile actually damaged on execution.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","parity","combat"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},[]),e.spawnEnemy("footman",{q:4,r:2,s:-6},"threat")},run:e=>{e.wait();const o=e.state.intentPreview?.projections?.find(c=>c.actorId==="threat")?.dangerTiles?.[0];o?e.logs.push(`PREVIEW_TILE=${o.q},${o.r},${o.s}`):e.logs.push("PREVIEW_TILE=none"),e.wait()},verify:(e,i)=>{const a=e.enemies.find(h=>h.id==="threat"),c=i.find(h=>h.startsWith("PREVIEW_TILE="))?.split("=")[1]||"none",r=c==="none"?void 0:(()=>{const[h,b,y]=c.split(",").map(A=>Number(A));return{q:h,r:b,s:y}})(),f={previewProducedTile:!!r,projectedTileMatchesExecute:!!r&&!!a&&ne(a.position,r)};return Object.values(f).some(h=>h===!1)&&(console.log("Telegraph Projection Parity Failed:",f),console.log("Logs:",i),console.log("Player HP:",e.player.hp,"/",e.player.maxHp)),Object.values(f).every(h=>h===!0)}}]},af=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},DASH:{slot:"passive",range:4,cooldown:0,name:"Kinetic Dash",description:"Dash in a straight line."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},kv={id:"raider_dash",name:"Raider Dash",description:"Parity checks for enemy Raider reusing the player DASH contract.",scenarios:[{id:"player_dash_stops_before_adjacent_enemy",title:"Parity Baseline: Player Dash Stops Before Blocker",description:"Player DASH should stop on the tile before an occupied target.",relatedSkills:["DASH"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["parity","dash","reuse"],setup:e=>{e.setPlayer({q:4,r:2,s:-6},["DASH"]),e.spawnEnemy("footman",{q:4,r:6,s:-10},"blocker"),e.state.hasShield=!1},run:e=>{e.useSkill("DASH",{q:4,r:6,s:-10})},verify:(e,i)=>{const a={playerStoppedBeforeBlocker:e.player.position.q===4&&e.player.position.r===5,dashResolved:i.some(o=>o.includes("Stopped by an obstacle")||o.includes("Dashed!")||o.includes("Shield Shunt"))};return Object.values(a).every(o=>o===!0)}},{id:"raider_ai_uses_dash_with_player_contract",title:"Parity: Raider Uses Same Dash Stop Rule",description:"Raider AI selects DASH and lands on the same stop tile as player-owned DASH in mirrored geometry.",relatedSkills:["DASH"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","dash"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("raider",{q:4,r:2,s:-6},"raider"),e.state.hasShield=!1;const i=e.getEnemy("raider");i&&(i.activeSkills=[af("BASIC_MOVE"),af("BASIC_ATTACK"),af("DASH")])},run:e=>{e.wait()},verify:(e,i)=>{const a=e.enemies.find(c=>c.id==="raider"),o={raiderStillAlive:!!a,raiderStoppedBeforePlayer:!!a&&a.position.q===4&&a.position.r===5,playerUnharmed:e.player.hp===e.player.maxHp,dashResolved:i.some(c=>c.includes("Stopped by an obstacle")||c.includes("Dashed!")||c.includes("Shield Shunt"))};return Object.values(o).every(c=>c===!0)}}]},of=e=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},GRAPPLE_HOOK:{slot:"offensive",range:4,cooldown:0,name:"Grapple Hook",description:"Pull and swap with target."}}[e]||{slot:"offensive",range:1,cooldown:0,name:e,description:e};return{id:e,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},Lv={id:"pouncer_hook",name:"Pouncer Hook",description:"Second archetype reuse: enemy uses player GRAPPLE_HOOK via normal skill execution.",scenarios:[{id:"pouncer_uses_grapple_hook_deterministically",title:"Pouncer Uses Grapple Hook Through Skill Pipeline",description:"Pouncer selects GRAPPLE_HOOK from AI and resolves via standard USE_SKILL execution.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","determinism"],setup:e=>{e.setPlayer({q:4,r:6,s:-10},[]),e.spawnEnemy("pouncer",{q:4,r:2,s:-6},"pouncer");const i=e.getEnemy("pouncer");i&&(i.activeSkills=[of("BASIC_MOVE"),of("BASIC_ATTACK"),of("GRAPPLE_HOOK")])},run:e=>{e.wait()},verify:(e,i)=>{const o={pouncerStillAlive:!!e.enemies.find(c=>c.id==="pouncer"),grappleExecuted:i.filter(c=>c.includes("Vaulted and Flung!")).length>=1,deterministicStatus:i.filter(c=>c.includes("You are stunned!")).length===1,noZeroEffectWarning:!i.some(c=>c.includes("produced ZERO effects"))};return Object.values(o).every(c=>c===!0)}}]},Iv={id:"ice",name:"Ice Terrain",description:"ICE/SLIPPERY terrain behavior for pass-through momentum and landing slide.",scenarios:[{id:"ice_pass_preserves_dash_momentum",title:"Ice Pass: Dash Carries Momentum",description:"Passing through ICE during DASH should preserve momentum and carry movement beyond nominal target.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","ice","momentum","pass"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:6,r:4,s:-10})},verify:e=>e.player.position.q>6},{id:"ice_land_slides_after_basic_move",title:"Ice Land: Basic Move Slides Forward",description:"Landing on ICE with BASIC_MOVE should slide one hex in the move direction when the next tile is walkable.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["terrain","ice","slide","land"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_MOVE"]),e.setTile({q:5,r:4,s:-9},"slippery"),e.setTile({q:6,r:4,s:-10},"floor")},run:e=>{e.move({q:5,r:4,s:-9})},verify:e=>e.player.position.q===6&&e.player.position.r===4}]},Bv={id:"snare",name:"Snare Terrain",description:"Snare tile effect movement restriction and status interaction.",scenarios:[{id:"snare_interrupts_dash_and_roots_actor",title:"Snare Interrupts Dash",description:"DASH into a snare tile should halt movement at snare and apply rooted status.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","snare","movement-restriction"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["DASH"]),e.state.hasShield=!1,e.state.tiles.set("5,4",{baseId:"STONE",position:{q:5,r:4,s:-9},traits:new Set(["WALKABLE"]),effects:[{id:"SNARE",duration:-1,potency:1}]}),e.setTile({q:6,r:4,s:-10},"floor"),e.setTile({q:7,r:4,s:-11},"floor")},run:e=>{e.useSkill("DASH",{q:7,r:4,s:-11})},verify:(e,i)=>{const a=e.player.statusEffects.some(c=>c.type==="rooted"),o={stoppedAtSnare:e.player.position.q===5&&e.player.position.r===4,rootedApplied:a,snareMessageLogged:i.some(c=>c.includes("Snared! Movement halted."))};return Object.values(o).every(c=>c===!0)}}]},jv={id:"relics",name:"Relics",description:"Passive relic behaviors using existing engine hooks only.",scenarios:[{id:"relic_ember_ward_reduces_fire_damage",title:"Relic: Ember Ward",description:"Equipping Ember Ward reduces incoming fire damage by 1.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"beginner",isTutorial:!1,tags:["relic","fire","passive"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_EMBER_WARD"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,i)=>{const a={hpUnchanged:e.player.hp===e.player.maxHp,relicMessageSeen:i.some(o=>o.includes("Ember Ward dampens the flames."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_cinder_orb_stacks_with_absorb_fire",title:"Relic: Cinder Orb Stacking",description:"Cinder Orb adds bonus healing when fire damage is converted by Absorb Fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",difficulty:"advanced",isTutorial:!1,tags:["relic","stacking","absorb-fire"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["ABSORB_FIRE"]),e.state.player={...e.state.player,hp:1,maxHp:3},e.state.upgrades=[...e.state.upgrades||[],"RELIC_CINDER_ORB"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,i)=>{const a={healedByStacking:e.player.hp===3,stackingMessageSeen:i.some(o=>o.includes("Cinder Orb amplifies the absorption."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_steady_plates_end_to_end",title:"Relic: Steady Plates",description:"Steady Plates grants turn-start armor that resolves against incoming damage in the same round.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"intermediate",isTutorial:!1,tags:["relic","armor","turn-start"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.upgrades=[...e.state.upgrades||[],"RELIC_STEADY_PLATES"],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:(e,i)=>{const a={playerHpProtected:e.player.hp===e.player.maxHp,damageEventOccurred:i.some(o=>o.includes("player burns!")),armorPresentAfterCycle:e.player.temporaryArmor>=0&&e.player.temporaryArmor<=2,relicTriggerMessageSeen:i.some(o=>o.includes("Steady Plates harden your stance."))};return Object.values(a).every(o=>o===!0)}}]},Dv=250,Hv=700,Pv=100,Uv=8,qv=220,zv=260,$v=40,jy=(e,i)=>{const a=e.floor||0,o=e.player?.hp||0,c=e.turnsSpent??e.turnNumber??0,r=e.kills||0,f=e.environmentalKills||0,h=e.hazardBreaches||0,b=(i||[]).filter(y=>y.success).length*Dv;return a*Hv+o*Pv+r*qv+f*zv-c*Uv-h*$v+b},Vv=e=>{if(typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e))return e;const i=e instanceof Date?e:new Date,a=i.getFullYear(),o=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0");return`${a}-${o}-${c}`},Yv=e=>`daily:${e}`,Fv=e=>{const i=18+Math.floor(qc(e,0)*8);return[{id:"TURN_LIMIT",label:`Finish within ${i} turns`,target:i},{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}]},jc=e=>(e.runObjectives||[]).map(a=>{if(a.id==="TURN_LIMIT"){const c=e.turnsSpent||0;return{...a,value:c,success:c<=a.target}}const o=e.hazardBreaches||0;return{...a,value:o,success:o<=a.target}}),Ql=e=>{const i=e.initialSeed??e.rngSeed??"0",a=jc(e),o=e.combatScoreEvents||[],c=o.length?Number((o.reduce((f,h)=>f+h.efficiency,0)/o.length).toFixed(4)):0,r=o.filter(f=>f.riskBonusApplied).length;return{seed:i,actionLog:e.actionLog,score:jy(e,a),floor:e.floor,objectives:a,combatTelemetry:{events:o.length,avgEfficiency:c,riskBonusEvents:r}}},Kv={id:"objectives",name:"Objectives",description:"Daily objective validation for turn-limit and hazard constraints.",scenarios:[{id:"objective_turn_limit_boundary",title:"Objective: Turn Limit Boundary",description:"Turn-limit objective passes at boundary and fails above boundary.",relatedSkills:["BASIC_MOVE"],category:"progression",difficulty:"intermediate",isTutorial:!1,tags:["objective","turn-limit"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"TURN_LIMIT",label:"Finish within 1 turns",target:1}]},run:e=>{e.wait()},verify:e=>{const a=jc(e)[0]?.success===!0,o=Ql(e).score,c=jc({...e,turnsSpent:(e.turnsSpent||0)+1}),r={...e,turnsSpent:(e.turnsSpent||0)+1},f=Ql(r).score,h=c[0]?.success===!1,b=f<o;return a&&h&&b}},{id:"objective_hazard_constraint_fail_on_hazard",title:"Objective: Hazard Constraint",description:"Hazard objective fails after prohibited hazard interaction.",relatedSkills:["BASIC_MOVE"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["objective","hazard"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},[]),e.state.runObjectives=[{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}],e.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:e=>{e.wait()},verify:e=>{const i=jc(e)[0];return(e.hazardBreaches||0)>0&&!!i&&i.success===!1}}]},Gv={id:"necromancer",name:"Necromancer",description:"Corpse persistence and summon migration contracts.",scenarios:[{id:"necromancer_corpse_persistence",title:"Corpse Persists Until Consumed",description:"Kill an enemy, wait 5 turns, then Raise Dead succeeds from corpse tile trait.",relatedSkills:["BASIC_ATTACK","RAISE_DEAD"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","corpse","persistence"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["BASIC_ATTACK","RAISE_DEAD"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:4,s:-9},"dummy");const i=e.getEnemy("dummy");i&&(i.hp=1,i.maxHp=1)},run:e=>{const i={q:5,r:4,s:-9};e.useSkill("BASIC_ATTACK",i);for(let a=0;a<5;a++)e.wait();e.useSkill("RAISE_DEAD",i)},verify:e=>{const i=he({q:5,r:4}),a=e.tiles.get(i),o=e.enemies.find(h=>h.subtype==="skeleton"&&h.factionId==="player"),c=e.companions?.find(h=>h.id===o?.id),r=new Set((o?.activeSkills||[]).map(h=>h.id)),f={corpseConsumed:!a?.traits?.has("CORPSE"),skeletonRaised:!!o,skeletonOnCorpseTile:!!o&&o.position.q===5&&o.position.r===4,companionRegistered:!!c,hasBasicLoadout:r.has("BASIC_MOVE")&&r.has("BASIC_ATTACK")};return Object.values(f).every(Boolean)}},{id:"summon_floor_transition",title:"Summon Persists Across Floor Transition",description:"Raised skeleton migrates with player to floor 2.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","summon","floor-transition"],setup:e=>{e.setPlayer({q:4,r:4,s:-8},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:4,s:-9},a=he(i),o=e.getTileAt(i);e.state.tiles.set(a,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])})},run:e=>{const i={q:5,r:4,s:-9};e.useSkill("RAISE_DEAD",i),e.state.player={...e.state.player,position:{...e.state.stairsPosition}},e.wait(),e.dispatchSync({type:"RESOLVE_PENDING"})},verify:e=>{const i=e.enemies.find(o=>o.subtype==="skeleton"&&o.factionId==="player"&&o.companionOf===e.player.id),a={floorAdvanced:e.floor===2,summonStillPresent:!!i,summonTracksOwner:!!i&&i.companionOf===e.player.id};return Object.values(a).every(Boolean)}},{id:"companion_does_not_block_free_move",title:"Companion Does Not Block Exploration Free Move",description:"Friendly skeleton companion should not count as hostile for BASIC_MOVE exploration range.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","companion","movement"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"],"VANGUARD"),e.spawnEnemy("footman",{q:5,r:5,s:-10},"friendly_skeleton");const i=e.getEnemy("friendly_skeleton");i&&(i.subtype="skeleton",i.factionId="player",i.companionOf=e.state.player.id,i.activeSkills=i.activeSkills||[],e.state.companions=[...e.state.companions||[],i])},run:e=>{e.move({q:7,r:1,s:-8})},verify:e=>{const i={movedFar:e.player.position.q===7&&e.player.position.r===1,turnsAdvanced:e.turnsSpent>=1};return Object.values(i).every(Boolean)}},{id:"raise_dead_pushes_ally_from_target_hex",title:"Raise Dead Pushes Ally Occupant",description:"If corpse tile is occupied by an ally, ally is displaced and summon succeeds without overlap.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","occupancy","push"],setup:e=>{e.setPlayer({q:4,r:5,s:-9},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:5,s:-10},a=he(i),o=e.getTileAt(i);e.state.tiles.set(a,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])}),e.spawnEnemy("footman",i,"ally_blocker");const c=e.getEnemy("ally_blocker");c&&(c.subtype="skeleton",c.factionId="player",c.companionOf=e.state.player.id,e.state.companions=[...e.state.companions||[],c])},run:e=>{e.useSkill("RAISE_DEAD",{q:5,r:5,s:-10})},verify:e=>{const i=e.enemies.filter(h=>h.subtype==="skeleton"&&h.factionId==="player"),a=new Set;let o=!1;i.forEach(h=>{const b=he(h.position);a.has(b)&&(o=!0),a.add(b)});const c=i.some(h=>h.position.q===5&&h.position.r===5),r=i.some(h=>h.id==="ally_blocker"&&!(h.position.q===5&&h.position.r===5));return Object.values({raisedAtCorpse:c,pushedExists:r,noOverlap:!o}).every(Boolean)}}]};function Wv(e){return{id:e.id,title:e.title,description:e.description,rationale:e.rationale,setup:e.setup,run:e.run,verify:e.verify}}const Xv=[lv,rv,cv,uv,hv,gv,yv,bv,xv,vv,Sv,wv,Av,Tv,Ev,_v,Mv,Ov,Cv,Nv,Rv,kv,Lv,Iv,Bv,jv,Kv,Gv],Qv=Xv.flatMap(e=>e.scenarios);function Jv(e){return Qv.filter(i=>i.relatedSkills.includes(e))}function vt(e){return Jv(e).map(Wv)}const Dy={id:"AUTO_ATTACK",name:"Auto Attack",description:"Automatically strike adjacent enemies that started the turn adjacent to you.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,i,a,o=[],c)=>{const r=[],f=[];let h=0;const b=(e.timelineEvents||[]).some(_=>_.phase==="STATUS_APPLY"&&_.type==="ApplyStatus"&&_.payload?.status==="stunned"&&(_.payload?.target===i.id||typeof _.payload?.target=="object"&&_.payload?.target&&ne(_.payload.target,i.position)));if(Ns(i)||b)return{effects:r,messages:f,kills:0};const y=ot(i.position);let A=1;o.includes("HEAVY_HANDS")&&(A+=1);const v=c?.persistentTargetIds||[],S=c?.previousNeighbors||[];if(v.length===0&&S.length===0)return{effects:r,messages:f,kills:0};for(const _ of y){const p=Ee(e,_);if(!p||p.hp<=0||p.id===i.id||i.factionId===p.factionId)continue;if(v.length>0?v.includes(p.id):S.some(R=>ne(R,_))){const R=bn({attackerId:i.id,targetId:p.id,skillId:"AUTO_ATTACK",basePower:A,trinity:Ze(i),targetTrinity:Ze(p),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});r.push({type:"Damage",target:_,amount:R.finalPower,scoreEvent:R.scoreEvent});const I=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,C=p.factionId==="player"?"you":`${p.subtype||"enemy"}#${p.id}`;f.push(`${I} attacked ${C}!`),p.hp<=A&&h++}}if(o.includes("CLEAVE")&&r.length>0)for(const _ of y){if(r.some(N=>N.type==="Damage"&&typeof N.target=="object"&&"q"in N.target&&ne(N.target,_)))continue;const g=Ee(e,_);if(!g||g.id===i.id||!(i.factionId!==g.factionId))continue;const I=bn({attackerId:i.id,targetId:g.id,skillId:"AUTO_ATTACK",basePower:A,trinity:Ze(i),targetTrinity:Ze(g),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});r.push({type:"Damage",target:_,amount:I.finalPower,scoreEvent:I.scoreEvent});const C=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,M=g.factionId==="player"?"you":`${g.subtype||"enemy"}#${g.id}`;f.push(`${C} cleaved ${M}!`),g.hp<=A&&h++}return{effects:r,messages:f,kills:h}},upgrades:{HEAVY_HANDS:{id:"HEAVY_HANDS",name:"Heavy Hands",description:"Auto-attack damage +1"},CLEAVE:{id:"CLEAVE",name:"Cleave",description:"When auto-attack triggers, hit ALL adjacent enemies"}},scenarios:vt("AUTO_ATTACK")},Zv=(e,i,a,o,c,r)=>{if(!i.activeSkills?.some(S=>S.id==="AUTO_ATTACK"))return{state:e,kills:0,messages:[]};const b=i.activeSkills?.find(S=>S.id==="AUTO_ATTACK")?.activeUpgrades||[],y=new Map;if(e.initiativeQueue)for(const S of e.initiativeQueue.entries)S.turnStartPosition&&y.set(S.actorId,S.turnStartPosition);const A=Dy.execute(e,i,void 0,b,{previousNeighbors:a,attackerTurnStartPosition:o,allActorsTurnStartPositions:y,persistentTargetIds:c});return{state:pi(e,A.effects,{sourceId:i.id,targetId:void 0,stepId:r}),kills:A.kills||0,messages:A.messages}},je={shake:(e,i)=>({type:"Juice",effect:"shake",intensity:e,direction:i}),flash:e=>({type:"Juice",effect:"flash",intensity:"high",color:e}),freeze:(e=80)=>({type:"Juice",effect:"freeze",duration:e}),combatText:(e,i,a)=>({type:"Juice",effect:"combat_text",text:e,target:i,color:a}),momentumTrail:(e,i)=>({type:"Juice",effect:"momentumTrail",path:e,intensity:i}),heavyImpact:(e,i)=>({type:"Juice",effect:"heavyImpact",target:e,direction:i,intensity:"extreme"}),lightImpact:e=>({type:"Juice",effect:"lightImpact",target:e,intensity:"low"}),kineticWave:(e,i,a)=>({type:"Juice",effect:"kineticWave",target:e,direction:i,intensity:a}),stunBurst:e=>({type:"Juice",effect:"stunBurst",target:e,intensity:"medium"}),lavaRipple:e=>({type:"Juice",effect:"lavaRipple",target:e,intensity:"medium"}),wallCrack:(e,i)=>({type:"Juice",effect:"wallCrack",target:e,direction:i,intensity:"high"}),explosionRing:e=>({type:"Juice",effect:"explosion_ring",target:e})},Xt={GRAPPLE_HOOK:{anticipation:(e,i)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,i],intensity:"low",color:"#00ff88"}],execution:e=>[{type:"Juice",effect:"hookCable",path:e,intensity:"medium",duration:200,color:"#00ff88"},je.shake("low")],impact:(e,i)=>[{type:"Juice",effect:"grappleHookWinch",target:e,direction:i,intensity:"high",duration:150},je.shake("medium",i)],resolution:(e,i)=>[je.momentumTrail(e,i>6?"high":"medium"),je.kineticWave(e[0],e[e.length-1],"high")]},SHIELD_THROW:{anticipation:(e,i)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,i],intensity:"medium",color:"#4169e1"}],execution:e=>[{type:"Juice",effect:"shieldArc",path:e,intensity:"high",duration:300,metadata:{rotation:720}},{type:"Juice",effect:"shieldSpin",path:e,intensity:"medium"}],impact:(e,i)=>[je.heavyImpact(e,i),je.shake("high",i),je.freeze(120),je.combatText("IMPACT!",e,"#ff4444")],resolution:e=>[je.kineticWave(e[0],e[e.length-1],"high"),je.momentumTrail(e,"high")]},DASH:{anticipation:(e,i)=>[{type:"Juice",effect:"chargeUp",target:e,direction:i,intensity:"medium",duration:100}],execution:e=>[{type:"Juice",effect:"dashBlur",path:e,intensity:"high",duration:150},je.momentumTrail(e,"medium")],impact:(e,i,a)=>a?[je.heavyImpact(e,i),je.shake("extreme",i),je.freeze(100),je.combatText("SHUNT!",e,"#ffaa00")]:[je.lightImpact(e)],resolution:e=>e?[je.kineticWave(e[0],e[e.length-1],"high"),je.momentumTrail(e,"high")]:[]},SPEAR_THROW:{anticipation:(e,i)=>[{type:"Juice",effect:"aimingLaser",target:e,path:[e,i],intensity:"low",color:"#ff6b6b"}],execution:e=>[{type:"Juice",effect:"spearTrail",path:e,intensity:"high",duration:150},{type:"Juice",effect:"spearWhistle",path:e,intensity:"medium",metadata:{pitch:"rising"}}],impact:(e,i)=>i?[je.heavyImpact(e),je.shake("medium"),je.freeze(60),je.combatText("LETHAL",e,"#ff0000")]:[je.lightImpact(e),je.combatText("MISS",e,"#888888")],resolution:()=>[]},VAULT:{anticipation:(e,i)=>[{type:"Juice",effect:"trajectory",target:e,path:[e,i],intensity:"low",color:"#00ddff",metadata:{arc:"high"}}],execution:e=>[{type:"Juice",effect:"vaultLeap",path:e,intensity:"medium",duration:250,metadata:{arc:"parabolic"}}],impact:(e,i)=>i?[je.heavyImpact(e),je.shake("medium"),je.stunBurst(e),je.combatText("STUN!",e,"#ffff00")]:[je.lightImpact(e)],resolution:()=>[]}},lf={lavaSink:e=>[{type:"Juice",effect:"lavaSink",target:e,intensity:"extreme",duration:500,metadata:{particleCount:50}},je.lavaRipple(e),je.shake("high"),je.combatText("CONSUMED",e,"#ff4400")],wallImpact:(e,i,a)=>{const o=[je.wallCrack(e,i),je.shake("high",i)];return a&&(o.push(je.stunBurst(e)),o.push(je.combatText("STUNNED",e,"#ffaa00"))),o},voidConsume:e=>[{type:"Juice",effect:"voidConsume",target:e,intensity:"extreme",duration:800,color:"#000000"},je.freeze(150),je.combatText("VOID",e,"#8800ff")]};function Fc(e,i){const{origin:a,direction:o,momentum:c}=i,r=[];r.push(je.kineticWave(a,o,c>6?"high":"medium"));const f=Yn(a,{q:o.q*(c+10),r:o.r*(c+10),s:o.s*(c+10)}),h=Ut(a,f);let b=c,y=eS(e,h);for(;b>0&&y.length>0;){const A=tS(y);if(A.length===0)break;const v=A.length;if(b<v){const C=A[A.length-1],M=b;b=0;const N=[h[C.pos1D]];for(let Y=0;Y<M;Y++){const X=C.pos1D+1,O=h[X];if(!O||!pa(O,e.gridWidth,e.gridHeight)||kg(e,O)){r.push({type:"Impact",target:C.id,damage:M-Y,direction:o});break}if(C.pos1D=X,N.push(O),Lg(e,O)){r.push({type:"LavaSink",target:C.id}),r.push(...lf.lavaSink(O));break}}N.length>1&&(r.push({type:"Displacement",target:C.id,destination:N[N.length-1],path:N,animationDuration:N.length*80}),r.push(je.momentumTrail(N,"medium")));break}const S=A[A.length-1],_=S.pos1D+1,p=h[_];if(!p||!pa(p,e.gridWidth,e.gridHeight)||kg(e,p)){r.push({type:"ApplyStatus",target:S.id,status:"stunned",duration:1}),p&&r.push(...lf.wallImpact(p,o,!0));break}const g=new Map;for(const C of A){const M=h[C.pos1D];C.pos1D+=1;const N=h[C.pos1D];g.set(C.id,[M,N])}const R=[...A].reverse();for(const C of R){const M=g.get(C.id);M&&r.push({type:"Displacement",target:C.id,destination:M[M.length-1],path:M,ignoreCollision:!0,animationDuration:150})}const I=Array.from(g.values()).flat();I.length>0&&r.push(je.momentumTrail(I,v>2?"high":"medium")),b-=v;for(let C=y.length-1;C>=0;C--){const M=y[C],N=h[M.pos1D];Lg(e,N)&&(r.push({type:"LavaSink",target:M.id}),r.push(...lf.lavaSink(N)),y.splice(C,1))}if(b>0){const C=A[A.length-1];y=y.filter(N=>N.pos1D>=C.pos1D);const M=y.filter(N=>N.pos1D>C.pos1D);y=[C,...M]}}return r}function eS(e,i){const a=[],o=[e.player,...e.enemies];for(const c of o){const r=i.findIndex(f=>ne(f,c.position));r!==-1&&a.push({id:c.id,pos1D:r})}return a.sort((c,r)=>c.pos1D-r.pos1D)}function tS(e){if(e.length===0)return[];const i=[];let a=e[0];i.push(a);for(let o=1;o<e.length;o++){const c=e[o];if(c.pos1D===a.pos1D||c.pos1D===a.pos1D+1)i.push(c),a=c;else break}return i}function kg(e,i){const a=ze.getTraitsAt(e,i);return a.has("BLOCKS_MOVEMENT")||a.has("BLOCKS_LOS")}function Lg(e,i){const a=ze.getTraitsAt(e,i);return a.has("HAZARDOUS")||a.has("LIQUID")}function nS(e,i,a,o){const c=Ce(i.position,a);if(c<=1)return[];const r=fa(a,i.position),f=Pn(r);return Fc(e,{origin:a,direction:f,momentum:Math.min(o,c-1)})}function iS(e,i){return[{type:"Displacement",target:e.id,destination:i.position},{type:"Displacement",target:i.id,destination:e.position}]}function sS(e,i,a,o){return Fc(e,{origin:i,direction:a,momentum:o})}function ki(e,i){const a=e.tiles.get(he(i));return!!(a?.traits.has("BLOCKS_LOS")||a?.baseId==="WALL")}function Ga(e,i){const a=e.tiles.get(he(i));return a?.baseId==="LAVA"||a?.traits.has("LIQUID")||!1}function ha(e,i,a){const o=Ee(e,i);return!!o&&o.id!==a}function xn(e,i,a){const o=Ce(e,i);return o>=1&&o<=a}function as(e,i){const a=fa(e,i);return{isAxial:a!==-1,directionIndex:a}}function Bf(e,i,a={}){const{checkWalls:o=!0,checkActors:c=!0,checkLava:r=!1,excludeActorId:f}=a;for(const h of i){if(o&&ki(e,h))return{obstacle:"wall",position:h};if(r&&Ga(e,h))return{obstacle:"lava",position:h};if(c){const b=Ee(e,h);if(b&&b.id!==f)return{obstacle:"actor",position:h,actor:b}}}return{}}function jf(e,i,a,o={}){const r=Ut(i,a).slice(1),{stopAtWalls:f=!0,stopAtActors:h=!0,stopAtLava:b=!1,excludeActorId:y}=o,A=Bf(e,r,{checkWalls:f,checkActors:h,checkLava:b,excludeActorId:y});return A.obstacle&&A.position&&!ne(A.position,a)?{isValid:!1,blockedBy:A.obstacle,blockedAt:A.position}:{isValid:!0}}function Ig(e,i,a,o,c){const f=Ut(i,a).slice(1),h=Bf(e,f,{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:c});return h.obstacle==="actor"&&h.actor?.id===o&&!!h.position&&ne(h.position,a)}function aS(e,i){const a=ze.getTraitsAt(e,i),o=a.has("HAZARDOUS")||a.has("LAVA")||a.has("FIRE")||a.has("VOID"),c=a.has("LAVA")||a.has("FIRE");return{isHazard:o,isFireHazard:c}}function Rs(e,i,a){const{isHazard:o,isFireHazard:c}=aS(e,a);return!!(!o||i.isFlying||(i.activeSkills?.some(f=>f.id==="ABSORB_FIRE")||i.statusEffects?.some(f=>f.type==="fire_immunity"))&&c)}function Hy(e,i,a,o){return Rs(e,i,a)?!0:new Set(["JUMP","VAULT","GRAPPLE_HOOK","DASH"]).has(o)}const oS={id:"GRAPPLE_HOOK",name:"Grapple Hook",description:"Pull/Zip mechanism with multi-phase kinetic resolution.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3,momentum:4},execute:(e,i,a,o=[])=>{let c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};const{directionIndex:h}=as(i.position,a),b=Pn(h);c.push(...Xt.GRAPPLE_HOOK.anticipation(i.position,a));const{isValid:y,blockedBy:A}=jf(e,i.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!y)return r.push(`Line of sight blocked by ${A}!`),{effects:c,messages:r,consumesTurn:!1};const v=a,S=Ee(e,v),_=ze.getTraitsAt(e,v),g=_.has("BLOCKS_MOVEMENT")||_.has("ANCHOR")?"Heavy":S?.weightClass||"Standard";if(g==="Heavy"||g==="Anchored"){const R=yf(v,b);c.push(...Xt.GRAPPLE_HOOK.execution(Ut(i.position,R))),c.push({type:"Displacement",target:i.id,destination:R,ignoreGroundHazards:!0});const I=ze.getTileAt(e,R);if(I){const M=za.processEntry(i,I,e);c.push(...M.effects),r.push(...M.messages)}const C=ot(R);for(const M of C){const N=Ee(e,M);N&&N.id!==i.id&&(c.push({type:"Impact",target:N.id,damage:0,direction:b}),c.push({type:"ApplyStatus",target:N.id,status:"stunned",duration:2}),c.push(je.stunBurst(M)))}return c.push(je.heavyImpact(R,b)),c.push(je.shake("high",b)),r.push("Zipped to anchor!"),{effects:c,messages:r,consumesTurn:!0}}else if(S){const R=Ce(i.position,v),I=Pn((h+3)%6),C=i.position;c.push(...Xt.GRAPPLE_HOOK.execution(Ut(i.position,a)));const M=nS(e,i,v,R-1),N=pi(e,M,{sourceId:i.id,targetId:S.id}),Y=N.enemies.find(G=>G.id===S.id)||(N.player.id===S.id?N.player:null);if(!Y)return r.push(`${S.subtype||"Enemy"} neutralized during pull.`),{effects:[...c,...M],messages:r,consumesTurn:!0};const X=iS(i,Y),O=Y.position;c.push(...Xt.GRAPPLE_HOOK.impact(O,b));const q=pi(N,X,{sourceId:i.id,targetId:S.id}),K=sS(q,C,I,4),ue=Ut(C,Yn(C,kf(h,6)));return c.push(...Xt.GRAPPLE_HOOK.resolution(ue,4)),{effects:[...c,...M,...X,...K],messages:["Vaulted and Flung!"],consumesTurn:!0}}else return r.push("Hook missed."),{effects:c,messages:r,consumesTurn:!1}},getValidTargets:(e,i)=>{const a=Ee(e,i);return a?nt.getAxialTargets(e,i,4,{includeWalls:!0,includeActors:!0,stopAtObstacles:!0}).filter(o=>{const{directionIndex:c}=as(i,o),r=Pn(c),f=Ee(e,o),h=ze.getTraitsAt(e,o),y=h.has("BLOCKS_MOVEMENT")||h.has("ANCHOR")?yf(o,r):f?o:void 0;return y?Rs(e,a,y):!1}):[]},upgrades:{},scenarios:vt("GRAPPLE_HOOK")},lS={id:"SPEAR_THROW",name:e=>e.hasSpear?"Spear Throw":"Recall Spear",description:e=>e.hasSpear?"Throw your spear to instantly kill an enemy.":"Recall your spear, damaging enemies in its path.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:1},execute:(e,i,a,o=[])=>{const c=[],r=[],f=Ze(i),h=o.includes("SPEAR_RANGE"),b=o.includes("RECALL"),y=o.includes("RECALL_DAMAGE"),A=o.includes("LUNGE"),v=o.includes("LUNGE_ARC"),S=o.includes("DEEP_BREATH"),_=o.includes("SPEAR_CLEAVE")||o.includes("CLEAVE"),p=3+(h?1:0);if(e.hasSpear){if(!a)return{effects:c,messages:r,consumesTurn:!1};if(A&&Ce(i.position,a)===2){const N=Ee(e,a);if(N&&N.id!==i.id){const Y=bn({attackerId:i.id,targetId:N.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:Ze(N),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return c.push({type:"Displacement",target:"self",destination:a,simulatePath:!0}),c.push({type:"Damage",target:N.id,amount:Y.finalPower,scoreEvent:Y.scoreEvent}),r.push(`Lunged and killed ${N.subtype||"enemy"} !`),v&&ot(a).forEach(X=>{const O=Ee(e,X);if(O&&O.id!==i.id&&O.id!==N.id){const q=bn({attackerId:i.id,targetId:O.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Ze(O),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:O.id,amount:q.finalPower,scoreEvent:q.scoreEvent})}}),S&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0}),{effects:c,messages:r}}}if(!xn(i.position,a,p))return r.push("Out of range!"),{effects:c,messages:r,consumesTurn:!1};const g=zi(e.enemies,a);if(!g)return r.push("No enemy at target."),{effects:c,messages:r,consumesTurn:!1};if(!as(i.position,a).isAxial)return r.push("Target must be axial."),{effects:c,messages:r,consumesTurn:!1};if(!Ig(e,i.position,a,g.id,i.id))return r.push("No clear line of sight to enemy."),{effects:c,messages:r,consumesTurn:!1};c.push(...Xt.SPEAR_THROW.anticipation(i.position,a));const C=a,M=g;if(c.push(...Xt.SPEAR_THROW.execution(Ut(i.position,C))),M){const N=bn({attackerId:i.id,targetId:M.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:Ze(M),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});c.push(...Xt.SPEAR_THROW.impact(C,!0)),c.push({type:"Damage",target:M.id,amount:N.finalPower,scoreEvent:N.scoreEvent}),r.push(`Spear killed ${M.subtype||"enemy"} !`),S&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0})}else c.push(...Xt.SPEAR_THROW.impact(C,!1)),r.push("Spear thrown.");c.push({type:"SpawnItem",itemType:"spear",position:C}),b&&(c.push({type:"PickupSpear",position:C}),r.push("Spear auto-retrieved."))}else{const g=e.spearPosition;if(!g)return r.push("Spear is lost!"),{effects:c,messages:r,consumesTurn:!1};const R=Ut(g,i.position);if(y&&R.forEach(I=>{const C=zi(e.enemies,I);if(C){const M=bn({attackerId:i.id,targetId:C.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Ze(C),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:C.id,amount:M.finalPower,scoreEvent:M.scoreEvent}),r.push(`Spear recall hit ${C.subtype||"enemy"} !`)}}),c.push({type:"PickupSpear",position:g}),r.push("Spear recalled."),_){for(const I of ot(g)){const C=zi(e.enemies,I);if(!C)continue;const M=bn({attackerId:i.id,targetId:C.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Ze(C),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1}],statusMultipliers:[]});c.push({type:"Damage",target:C.id,amount:M.finalPower,scoreEvent:M.scoreEvent})}r.push("Cleave triggered on pickup.")}c.push({type:"Juice",effect:"spearTrail",path:R,intensity:"medium"})}return{effects:c,messages:r}},getValidTargets:(e,i)=>{if(!e.hasSpear)return[];const a=Ee(e,i);if(!a)return[];const r=3+(a.activeSkills?.find(h=>h.id==="SPEAR_THROW")?.activeUpgrades?.includes("SPEAR_RANGE")?1:0);return e.enemies.filter(h=>h.hp>0).filter(h=>{const b=h.position;return!as(i,b).isAxial||!xn(i,b,r)?!1:Ig(e,i,b,h.id,a.id)}).map(h=>h.position)},upgrades:{SPEAR_RANGE:{id:"SPEAR_RANGE",name:"Extended Reach",description:"Range +1"},RECALL:{id:"RECALL",name:"Recall",description:"Spear automatically returns (handled internally if active, or via manual recall)"},RECALL_DAMAGE:{id:"RECALL_DAMAGE",name:"Returning Edge",description:"Damage enemies in path when recalling spear"},LUNGE:{id:"LUNGE",name:"Lunge",description:"If an enemy is exactly 2 hexes away, move to them and kill"},LUNGE_ARC:{id:"LUNGE_ARC",name:"Lunge Sweeping",description:"Lunge hits neighbors of the target"},DEEP_BREATH:{id:"DEEP_BREATH",name:"Deep Breath",description:"Reset Jump cooldown on spear kill"},SPEAR_CLEAVE:{id:"SPEAR_CLEAVE",name:"Cleave",description:"Damage all neighbors when picking up spear"}},scenarios:vt("SPEAR_THROW")},rS={id:"SHIELD_BASH",name:"Shield Bash",description:"Push an enemy 1 tile. If they hit a wall or another enemy, they are stunned.",slot:"defensive",icon:"",baseVariables:{range:1,cost:0,cooldown:2},execute:(e,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:r,consumesTurn:!1};const f=o.includes("SHIELD_RANGE"),h=o.includes("ARC_BASH"),b=o.includes("BASH_360"),y=o.includes("WALL_SLAM"),A=1+(f?1:0);if(!xn(i.position,a,A))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};let v=[];if(b)v=ot(i.position);else if(h){v=[a];const g=ot(a);for(const R of g)Ce(R,i.position)===1&&v.length<3&&v.push(R)}else v=[a];const S=new Map;e.enemies.forEach(g=>S.set(g.id,g.position)),e.player&&S.set(e.player.id,e.player.position);const _=g=>{for(const[R,I]of Array.from(S.entries()))if(ne(I,g))return R===e.player.id?e.player:e.enemies.find(C=>C.id===R)},p=(g,R)=>{const I=_(R);if(!I||I.id===i.id)return;const C=fa(g,R),M=Pn(C),N=Yn(R,M),Y=e.tiles.get(he(N)),X=Y?.baseId==="WALL"||Y?.traits.has("BLOCKS_MOVEMENT"),O=!nt.isWithinBounds(e,N),q=_(N);X||O||q&&q.id!==I.id?(c.push({type:"ApplyStatus",target:I.id,status:"stunned",duration:1}),r.push(`Bashed ${I.subtype||"enemy"} into obstacle!`),c.push({type:"Juice",effect:"shake"}),q&&y&&p(R,N)):(c.push({type:"Displacement",target:I.id,destination:N,simulatePath:!0}),S.set(I.id,N),r.push(`Pushed ${I.subtype||"enemy"}!`))};for(const g of v)p(i.position,g);return{effects:c,messages:r}},getValidTargets:(e,i)=>{const a=Ee(e,i);if(!a)return[];const c=1+(a.activeSkills?.find(r=>r.id==="SHIELD_BASH")?.activeUpgrades?.includes("SHIELD_RANGE")?1:0);return nt.getAreaTargets(e,i,c).filter(r=>{const f=Ee(e,r);return!!f&&f.id!==a.id&&f.factionId!==a.factionId})},upgrades:{SHIELD_RANGE:{id:"SHIELD_RANGE",name:"Extended Bash",description:"Range +1"},SHIELD_COOLDOWN:{id:"SHIELD_COOLDOWN",name:"Quick Recovery",description:"Cooldown -1",modifyCooldown:-1},ARC_BASH:{id:"ARC_BASH",name:"Arc Bash",description:"Bash hits 3-hex frontal arc (+1 cooldown)",modifyCooldown:1},BASH_360:{id:"BASH_360",name:"360 Bash",description:"Bash hits all neighbors (+1 cooldown)",modifyCooldown:1},PASSIVE_PROTECTION:{id:"PASSIVE_PROTECTION",name:"Passive Protection",description:"+1 temp armor when shield not on cooldown"},WALL_SLAM:{id:"WALL_SLAM",name:"Wall Slam",description:"Enemies bashed into obstacles trigger a cascade and stun"}},scenarios:vt("SHIELD_BASH")},cS={id:"JUMP",name:"Jump",description:"Leap to an empty tile within range. Can cross lava but not walls.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:r,consumesTurn:!1};const f=o.includes("JUMP_RANGE"),h=o.includes("STUNNING_LANDING"),b=o.includes("METEOR_IMPACT"),y=o.includes("FREE_JUMP"),A=2+(f?1:0);if(!xn(i.position,a,A))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};const v=Ee(e,a),S=ki(e,a),_=Rs(e,i,a);if(S)return r.push("Cannot jump into a wall!"),{effects:c,messages:r,consumesTurn:!1};if(!_)return r.push("Cannot land on hazard!"),{effects:c,messages:r,consumesTurn:!1};if(v&&!b)return r.push("Target hex is blocked!"),{effects:c,messages:r,consumesTurn:!1};if(v&&b){const p=bn({attackerId:i.id,targetId:v.id,skillId:"JUMP",basePower:99,trinity:Ze(i),targetTrinity:Ze(v),damageClass:"physical",scaling:[{attribute:"body",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:v.id,amount:p.finalPower,scoreEvent:p.scoreEvent}),r.push(`Meteor Impact killed ${v.subtype||"enemy"}!`)}if(c.push({type:"Message",text:"Jumped!"}),c.push({type:"Displacement",target:"self",destination:a,ignoreCollision:!0,ignoreGroundHazards:!0,simulatePath:!0}),h){const p=ot(a);let g=!1;for(const R of p){const I=Ee(e,R);I&&I.id!==i.id&&(c.push({type:"ApplyStatus",target:I.id,status:"stunned",duration:1}),g=!0)}g&&r.push("Enemies stunned by landing impact!")}return c.push({type:"Juice",effect:"shake",target:a,intensity:"medium"}),{effects:c,messages:r,consumesTurn:!y}},getValidTargets:(e,i)=>{const a=Ee(e,i);if(!a)return[];const o=a.activeSkills?.find(h=>h.id==="JUMP"),c=new Set(o?.activeUpgrades||[]),r=2+(c.has("JUMP_RANGE")?1:0),f=c.has("METEOR_IMPACT");return nt.getAreaTargets(e,i,r).filter(h=>{if(ne(h,i)||ki(e,h)||!Rs(e,a,h))return!1;const b=Ee(e,h);return!(b&&b.id!==a.id&&!f)})},upgrades:{JUMP_RANGE:{id:"JUMP_RANGE",name:"Extended Jump",description:"Jump range +1"},JUMP_COOLDOWN:{id:"JUMP_COOLDOWN",name:"Nimble",description:"Jump cooldown -1",modifyCooldown:-1},STUNNING_LANDING:{id:"STUNNING_LANDING",name:"Stunning Landing",description:"All enemies within 1 hex of landing are stunned"},METEOR_IMPACT:{id:"METEOR_IMPACT",name:"Meteor Impact",description:"Can land on enemies to kill them"},FREE_JUMP:{id:"FREE_JUMP",name:"Free Jump",description:"Can move after jumping"}},scenarios:vt("JUMP")},uS={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Charge into an adjacent enemy, pushing a chain. Wall hard-stop stuns the chain.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:3},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(Ce(i.position,a)!==1)return c.push("Target not adjacent!"),{effects:o,messages:c,consumesTurn:!1};const f=zi(e.enemies,a);if(!f)return c.push("No target!"),{effects:o,messages:c,consumesTurn:!1};const{isAxial:h,directionIndex:b}=as(i.position,a);if(!h)return{effects:o,messages:c,consumesTurn:!1};const y=Pn(b),A=[f];let v={q:f.position.q+y.q,r:f.position.r+y.r,s:f.position.s+y.s};for(;;){const p=zi(e.enemies,v);if(p){if(A.push(p),v={q:v.q+y.q,r:v.r+y.r,s:v.s+y.s},A.length>6)break;continue}break}const S=[];for(let p=0;p<A.length;p++){const g=A[p],R=p===0?2:1,I={q:g.position.q+y.q*R,r:g.position.r+y.r*R,s:g.position.s+y.s*R};S.push({actor:g,dest:I})}let _=!1;for(const p of S){const g=e.tiles.get(he(p.dest));if(g?.baseId==="WALL"||g?.traits.has("BLOCKS_MOVEMENT")){_=!0;break}if(e.enemies.find(I=>ne(I.position,p.dest)&&!A.some(C=>C.id===I.id))){_=!0;break}}if(_){for(const p of A)o.push({type:"ApplyStatus",target:p.position,status:"stunned",duration:1}),c.push("Chain blocked! Stunned.");return{effects:o,messages:c}}for(const p of S)o.push({type:"Displacement",target:p.actor.id,destination:p.dest});return o.push({type:"Displacement",target:"self",destination:f.position}),c.push("Bulwark Charge!"),{effects:o,messages:c}},getValidTargets:(e,i)=>[{q:i.q+1,r:i.r,s:i.s-1},{q:i.q+1,r:i.r-1,s:i.s},{q:i.q,r:i.r-1,s:i.s+1},{q:i.q-1,r:i.r,s:i.s+1},{q:i.q-1,r:i.r+1,s:i.s},{q:i.q,r:i.r+1,s:i.s-1}].filter(o=>!!zi(e.enemies,o)),upgrades:{},scenarios:[{id:"chain_stun",title:"Chain-Stun",description:"Wall prevents chain, chain gets stunned",setup:e=>{e.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),e.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),e.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),e.setTile({q:3,r:3,s:-6},"wall"),e.state.hasShield=!0},run:e=>{e.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(e,i)=>!0}]},dS={id:"BASIC_ATTACK",name:"Basic Attack",description:"Strike an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,i,a,o=[])=>{const c=[],r=[],f=(e.timelineEvents||[]).some(g=>g.phase==="STATUS_APPLY"&&g.type==="ApplyStatus"&&g.payload?.status==="stunned"&&(g.payload?.target===i.id||typeof g.payload?.target=="object"&&g.payload?.target&&ne(g.payload.target,i.position)));if(Ns(i)||f)return r.push("Cannot attack while stunned!"),{effects:c,messages:r,consumesTurn:!0};if(!a)return r.push("Select a target!"),{effects:c,messages:r,consumesTurn:!1};if(!xn(i.position,a,1))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};const b=Ee(e,a);if(!b||b.id===i.id)return r.push("No enemy at target!"),{effects:c,messages:r,consumesTurn:!1};if(b.factionId===i.factionId)return r.push("Cannot attack friendlies!"),{effects:c,messages:r,consumesTurn:!1};if(b.subtype==="bomb")return r.push("Cannot attack a bomb!"),{effects:c,messages:r,consumesTurn:!1};let y=1;o.includes("POWER_STRIKE")&&(y+=2);const A=ne(i.previousPosition||i.position,i.position);o.includes("EXTENDED_REACH")&&A&&(y+=1);const v=bn({attackerId:i.id,targetId:b.id,skillId:"BASIC_ATTACK",basePower:y,trinity:Ze(i),targetTrinity:Ze(b),damageClass:"physical",scaling:[{attribute:"body",coefficient:.5}],statusMultipliers:[],inDangerPreviewHex:!!e.intentPreview?.dangerTiles?.some(g=>ne(g,i.position)),theoreticalMaxPower:y}),S=v.finalPower;c.push({type:"Damage",target:"targetActor",amount:S,scoreEvent:v.scoreEvent});const _=i.type==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,p=b.type==="player"?"you":`${b.subtype||"enemy"}#${b.id}`;if(r.push(`${_} attacked ${p}!`),o.includes("VAMPIRIC")){const g=Math.max(0,S-(b.temporaryArmor||0));b.hp-g<=0&&(c.push({type:"Heal",target:i.id,amount:1}),r.push("Vampiric heal!"))}return{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(e,i)=>{const a=Ee(e,i);return a?ot(i).filter(c=>{const r=Ee(e,c);return!!r&&r.subtype!=="bomb"&&r.id!==a.id&&r.factionId!==a.factionId}):[]},upgrades:{EXTENDED_REACH:{id:"EXTENDED_REACH",name:"Disciplined Stance",description:"+1 damage when attacking without moving first."},POWER_STRIKE:{id:"POWER_STRIKE",name:"Power Strike",description:"Damage +2"},VAMPIRIC:{id:"VAMPIRIC",name:"Vampiric",description:"Heal 1 HP on kill"}},scenarios:vt("BASIC_ATTACK")},fS={id:"SENTINEL_TELEGRAPH",name:"Sentinel Telegraph",description:"The Sentinel marks an impact zone for a delayed blast.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0},execute:(e,i,a)=>a?{effects:[{type:"Juice",effect:"combat_text",target:a,text:"TELEGRAPH"}],messages:["The Sentinel marks the impact zone."],consumesTurn:!0}:{effects:[],messages:[],consumesTurn:!0},getValidTargets:(e,i)=>nt.getAreaTargets(e,i,3),upgrades:{},scenarios:vt("SENTINEL_TELEGRAPH")},mS={id:"SENTINEL_BLAST",name:"Sentinel Blast",description:"A massive energy surge from the Sentinel.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:2},execute:(e,i,a)=>{if(!a)return{effects:[],messages:[]};const o=Ze(i),c=Ee(e,a),r=bn({attackerId:i.id,targetId:c?.id||he(a),skillId:"SENTINEL_BLAST",basePower:2,trinity:o,targetTrinity:c?Ze(c):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:[]}),f=[{type:"Damage",target:a,amount:r.finalPower,scoreEvent:r.scoreEvent},{type:"Juice",effect:"shake",intensity:"high"}];return ot(a).forEach(b=>{const y=Ee(e,b),A=bn({attackerId:i.id,targetId:y?.id||he(b),skillId:"SENTINEL_BLAST",basePower:1,trinity:o,targetTrinity:y?Ze(y):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.1}],statusMultipliers:[]});f.push({type:"Damage",target:b,amount:A.finalPower,scoreEvent:A.scoreEvent})}),{effects:f,messages:["The Sentinel unleashed a massive blast!"],consumesTurn:!0}},getValidTargets:(e,i)=>nt.getAreaTargets(e,i,3),upgrades:{},scenarios:vt("SENTINEL_BLAST")},pS={id:"THEME_HAZARDS",name:"Theme Hazards",description:"Internal skill for testing floor themes.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0},execute:e=>({effects:[],messages:[]}),upgrades:{},scenarios:vt("THEME_HAZARDS")},hS={id:"SHIELD_THROW",name:"Shield Throw",description:"Throw your shield to strike and push enemies. Triggers a kinetic pulse on impact.",slot:"defensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!e.hasShield)return r.push("Shield not in hand!"),{effects:c,messages:r,consumesTurn:!1};c.push(...Xt.SHIELD_THROW.anticipation(i.position,a));const{isValid:f,blockedBy:h,blockedAt:b}=jf(e,i.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!f&&h==="wall")return r.push("Shield hit a wall mid-flight!"),c.push({type:"SpawnItem",itemType:"shield",position:b}),{effects:c,messages:r,consumesTurn:!0};const y=Ee(e,a);if(!y)return r.push("Shield missed: No target at location."),c.push({type:"SpawnItem",itemType:"shield",position:a}),{effects:c,messages:r,consumesTurn:!0};const A=Ut(i.position,a);c.push(...Xt.SHIELD_THROW.execution(A));const v=4,{directionIndex:S}=as(i.position,a),_=Pn(S);c.push({type:"ApplyStatus",target:y.id,status:"stunned",duration:1}),c.push(...Xt.SHIELD_THROW.impact(a,_));const p=Fc(e,{origin:a,direction:_,momentum:v}),g=p.filter(M=>M.type==="Displacement"&&M.target===y.id),R=g[g.length-1],I=R&&"destination"in R?R.destination:a,C=Ut(a,I);return C.length>1&&c.push(...Xt.SHIELD_THROW.resolution(C)),c.push({type:"SpawnItem",itemType:"shield",position:I}),r.push("Direct hit! Shield triggered kinetic pulse."),{effects:[...c,...p],messages:r,consumesTurn:!0}},getValidTargets:(e,i)=>nt.getAxialTargets(e,i,4),upgrades:{},scenarios:vt("SHIELD_THROW")},gS={id:"VAULT",name:e=>e.turnNumber%2!==0?"Stun Vault":"Vault",description:e=>e.turnNumber%2!==0?"Leap to an empty tile and stun neighbors. (Odd Turn)":"Leap to an empty tile. (Even Turn)",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:0},execute:(e,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!xn(i.position,a,2))return r.push("Out of range!"),{effects:c,messages:r,consumesTurn:!1};if(ki(e,a)||ha(e,a))return r.push("Blocked!"),{effects:c,messages:r,consumesTurn:!1};if(!Rs(e,i,a))return r.push("Blocked!"),{effects:c,messages:r,consumesTurn:!1};const f=e.turnNumber%2!==0;c.push(...Xt.VAULT.anticipation(i.position,a));const h=Ut(i.position,a);if(c.push(...Xt.VAULT.execution(h)),c.push({type:"Displacement",target:"self",destination:a,path:h,ignoreGroundHazards:!0,animationDuration:250}),f){r.push("Stun Vault executed!");const b=ot(a);for(const y of b)zi(e.enemies,y)&&c.push({type:"ApplyStatus",target:y,status:"stunned",duration:1});c.push(...Xt.VAULT.impact(a,!0)),r.push("Slam landing! Neighbors stunned.")}else c.push(...Xt.VAULT.impact(a,!1)),r.push("Vaulted!");return{effects:c,messages:r}},getValidTargets:(e,i)=>{const o=Ee(e,i);return o?nt.getAreaTargets(e,i,2).filter(c=>ne(c,i)?!1:!ki(e,c)&&!ha(e,c)&&Rs(e,o,c)):[]},upgrades:{},scenarios:[{id:"vault_shift_stun",title:"Vault State-Shifting: Stun (Turn 1)",description:"Verify vault stuns on Turn 1 (Odd).",setup:e=>{e.setTurn(1),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>i.some(a=>a.includes("Stun Vault executed!"))},{id:"vault_shift_normal",title:"Vault State-Shifting: Normal (Turn 2)",description:"Verify vault is normal on Turn 2 (Even).",setup:e=>{e.setTurn(2),e.setPlayer({q:3,r:6,s:-9},["VAULT"]),e.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:e=>{e.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(e,i)=>i.some(a=>a.includes("Vaulted!"))&&!i.some(a=>a.includes("Slam landing!"))}]},Bg=(e,i)=>e.enemies.filter(o=>o.hp>0&&o.factionId==="enemy").length===0?20:Math.max(i.speed||1,1),Py=(e,i)=>nt.isWithinBounds(e,i)?ze.getTraitsAt(e,i).has("BLOCKS_MOVEMENT"):!0,jg=(e,i,a,o)=>{const c=new Map,r=[],f=b=>`${b.q},${b.r}`,h=[{p:a,cost:0}];for(c.set(f(a),0);h.length>0;){const b=h.shift();if(!(b.cost>=o))for(const y of ot(b.p)){if(!nt.isWithinBounds(e,y)||!ze.isWalkable(e,y)||!Hy(e,i,y,"BASIC_MOVE"))continue;const A=Ee(e,y),v=!!A&&A.id!==i.id,S=v&&A.factionId===i.factionId;if(v&&!S)continue;const _=f(y),p=b.cost+1;c.has(_)&&c.get(_)<=p||(c.set(_,p),!S&&Rs(e,i,y)&&!Py(e,y)&&r.push(y),h.push({p:y,cost:p}))}}return r},yS=(e,i,a,o,c)=>{const r=_=>`${_.q},${_.r}`,f=_=>{const[p,g]=_.split(",").map(Number);return{q:p,r:g,s:-p-g}},h=[a],b=new Map([[r(a),0]]),y=new Map([[r(a),null]]);for(;h.length>0;){const _=h.shift(),p=r(_),g=b.get(p);if(!(g>=c))for(const R of ot(_)){if(!nt.isWithinBounds(e,R)||!ze.isWalkable(e,R)||!Hy(e,i,R,"BASIC_MOVE"))continue;const I=Ee(e,R),C=!!I&&I.id!==i.id,M=C&&I.factionId===i.factionId;if(C&&!M)continue;const N=r(R),Y=g+1;b.has(N)&&b.get(N)<=Y||(b.set(N,Y),y.set(N,p),h.push(R))}}const A=r(o);if(!y.has(A)||Py(e,o)||!Rs(e,i,o))return null;const v=[];let S=A;for(;S;)v.push(f(S)),S=y.get(S)||null;return v.reverse(),v},bS={id:"BASIC_MOVE",name:"Walk",description:"Move to an adjacent or nearby tile within your speed range.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Bg(e,i),h=jg(e,i,i.position,r).some(A=>ne(A,a)),b=yS(e,i,i.position,a,r);if(!h||!b||b.length<2)return c.push("Target out of reach or blocked!"),{effects:o,messages:c,consumesTurn:!1};o.push({type:"Displacement",target:"self",destination:a,source:i.position,path:b,simulatePath:!0,ignoreCollision:!0});const y=i.id===e.player.id?"You":`${i.subtype||"enemy"}#${i.id}`;return c.push(`${y} moved to (${a.q}, ${a.r}). [Range ${r}]`),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>{const a=Ee(e,i);if(!a)return[];const o=Bg(e,a);return jg(e,a,i,o).filter(r=>!ha(e,r,a.id))},upgrades:{},scenarios:vt("BASIC_MOVE")},xS={id:"DASH",name:"Kinetic Dash",description:"Dash in a straight line. With a shield, slam into enemies and send them flying!",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:0},execute:(e,i,a,o=[])=>{const c=[],r=[],f=o.includes("MOMENTUM_SURGE"),h=o.includes("DASH_CHAIN_REACTION")||o.includes("CHAIN_REACTION");if(!a)return{effects:c,messages:r,consumesTurn:!1};const{isAxial:b,directionIndex:y}=as(i.position,a),v=e.enemies.filter(I=>I.hp>0).length===0?20:4;if(!xn(i.position,a,v))return{effects:c,messages:["Out of range!"],consumesTurn:!1};if(!b)return{effects:c,messages:["Axial only! Dash must be in a straight line."],consumesTurn:!1};c.push(...Xt.DASH.anticipation(i.position,a));const S=Pn(y),_=Ut(i.position,a),p=Bf(e,_.slice(1),{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:i.id});let g=a;if(p.obstacle){if(p.obstacle==="wall")return{effects:c,messages:["A wall blocks the way!"],consumesTurn:!1};if(p.obstacle==="lava")return{effects:c,messages:["Lava blocks the way!"],consumesTurn:!1};const I=_.findIndex(C=>ne(C,p.position));g=_[I-1]||i.position}if(p.obstacle==="actor"?p.actor:null){const I=Ut(i.position,g);c.push(...Xt.DASH.execution(I));const C=[{type:"Displacement",target:"self",destination:g,path:I,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:I.length*60}],M=pi(e,C,{sourceId:i.id});if(e.hasShield){c.push(...Xt.DASH.impact(g,S,!0));const N=5+(e.hasShield&&f?2:0)+(h?1:0),Y=Fc(M,{origin:g,direction:S,momentum:N});return{effects:[...c,...C,...Y],messages:[...r,"Shield Shunt!"],consumesTurn:!0}}else return c.push(...Xt.DASH.impact(g,S,!1)),{effects:[...c,...C],messages:[...r,"Stopped by an obstacle (Need shield to shunt)."],consumesTurn:!ne(i.position,g)}}else{const I=Ut(i.position,g);c.push(...Xt.DASH.execution(I));const C={type:"Displacement",target:"self",destination:g,path:I,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:I.length*60};return{effects:[...c,C],messages:[...r,"Dashed!"],consumesTurn:!ne(i.position,g)}}},getValidTargets:(e,i)=>{const o=e.enemies.filter(r=>r.hp>0).length===0?20:4,c=Ee(e,i);return c?nt.getAxialTargets(e,i,o,{stopAtObstacles:!0,includeActors:!0,includeWalls:!1}).filter(r=>Rs(e,c,r)):[]},upgrades:{MOMENTUM_SURGE:{id:"MOMENTUM_SURGE",name:"Momentum Surge",description:"+2 Momentum when dashing with shield"},DASH_CHAIN_REACTION:{id:"DASH_CHAIN_REACTION",name:"Chain Reaction",description:"Enemies pushed into other enemies transfer momentum"}},scenarios:vt("DASH")},vS=new Set(["FIREBALL","FIREWALL","FIREWALK","ABSORB_FIRE"]),Uy=(e,i)=>{const a=ze.getTileAt(e,i),o=ze.getTraitsForTile(e,a),c=r=>a.effects.some(f=>f.id===r);return a.baseId==="VOID"||o.has("VOID")||o.has("PIT")?"VOID_TOUCHED":a.baseId==="ICE"||c("ICE_WALL")?"FROZEN":a.baseId==="LAVA"||o.has("LAVA")||o.has("FIRE")||c("FIRE")?"MELTED":c("WET")||c("STEAM")?"SOAKED":"STABLE"},qy=(e,i)=>vS.has(e)&&i==="MELTED"?1.15:1,SS={id:"FIREBALL",name:"Fireball",description:"Launch a sphere of flame. Range 3, Axial. Deals damage and leaves fire.",slot:"offensive",icon:"",baseVariables:{range:3,cost:1,cooldown:2},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r}=as(i.position,a);if(!xn(i.position,a,3)||!r)return{effects:o,messages:["Invalid target! Range 3, Axial only."],consumesTurn:!1};const f=[a,...ot(a)],h=Ze(i),b=!!e.intentPreview?.dangerTiles?.some(y=>ne(y,i.position));for(const y of f){const A=Ee(e,y),v=Uy(e,y),S=qy("FIREBALL",v),_=bn({attackerId:i.id,targetId:A?.id||he(y),skillId:"FIREBALL",basePower:1,trinity:h,targetTrinity:A?Ze(A):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:S===1?[]:[{id:`surface_${v}`,multiplier:S}],inDangerPreviewHex:b,theoreticalMaxPower:1});o.push({type:"Damage",target:y,amount:_.finalPower,reason:"fireball",scoreEvent:_.scoreEvent}),o.push({type:"PlaceFire",position:y,duration:3})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ff4400"}),o.push({type:"Juice",effect:"shake",intensity:"medium"}),c.push("Fireball!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>nt.getAxialTargets(e,i,3),upgrades:{},scenarios:vt("FIREBALL")},AS={id:"FIREWALL",name:"Firewall",description:"Create a wall of flames 5 tiles wide. Area denial.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:4},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r,directionIndex:f}=as(i.position,a);if(!r)return{effects:o,messages:["Axial targeting only!"],consumesTurn:!1};const h=(f+2)%6,b=(f+5)%6,y=[a];let A=a;for(let S=0;S<2;S++)A=Yn(A,Pn(h)),nt.isWithinBounds(e,A)&&y.push(A);let v=a;for(let S=0;S<2;S++)v=Yn(v,Pn(b)),nt.isWithinBounds(e,v)&&y.push(v);for(const S of y)if(!ki(e,S)){o.push({type:"PlaceFire",position:S,duration:3});const _=Ee(e,S);if(_){const p=Uy(e,S),g=qy("FIREWALL",p),R=bn({attackerId:i.id,targetId:_.id,skillId:"FIREWALL",basePower:1,trinity:Ze(i),targetTrinity:Ze(_),damageClass:"magical",scaling:[{attribute:"mind",coefficient:.15}],statusMultipliers:g===1?[]:[{id:`surface_${p}`,multiplier:g}]});o.push({type:"Damage",target:_.id,amount:R.finalPower,reason:"firewall_impact",scoreEvent:R.scoreEvent})}}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffaa00"}),c.push("Firewall raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>nt.getAxialTargets(e,i,4),upgrades:{},scenarios:vt("FIREWALL")},TS={id:"FIREWALK",name:"Firewalk",description:"Teleport to a fire or lava tile. Grants 2 turns of Fire Immunity.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!xn(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const r=e.tiles.get(he(a)),f=r?.effects.some(b=>b.id==="FIRE"),h=r?.baseId==="LAVA"||r?.traits.has("LIQUID");return!f&&!h?{effects:o,messages:["Can only teleport to Fire or Lava!"],consumesTurn:!1}:ha(e,a,i.id)?{effects:o,messages:["Target position occupied!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a,source:i.position,simulatePath:!1}),o.push({type:"ApplyStatus",target:"self",status:"fire_immunity",duration:2}),o.push({type:"Juice",effect:"flash",target:a,color:"#ff8800"}),c.push("Firewalk!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(e,i)=>{const a=[];return e.tiles.forEach(o=>{const c=Ce(i,o.position);if(c>0&&c<=4){const r=o.effects.some(h=>h.id==="FIRE"),f=o.baseId==="LAVA"||o.traits.has("LIQUID");(r||f)&&a.push(o.position)}}),a},upgrades:{},scenarios:vt("FIREWALK")},ES={id:"BOMB_TOSS",name:"Bomb Toss",description:"Throw a bomb to a nearby tile.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:2},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!xn(i.position,a,3))return c.push("Out of range!"),{effects:o,messages:c,consumesTurn:!1};if(!ze.isWalkable(e,a))return c.push("Target blocked!"),{effects:o,messages:c,consumesTurn:!1};if(Ee(e,a))return c.push("Target occupied!"),{effects:o,messages:c,consumesTurn:!1};const f=`bomb-${i.id}-${e.turnNumber}-${e.actionLog?.length??0}-${a.q}_${a.r}_${a.s}`,h=ma({id:f,type:"enemy",subtype:"bomb",factionId:i.factionId,position:a,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return h.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.push({type:"SpawnActor",actor:h}),c.push("Bomb tossed!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>{const o=[];for(let c=-3;c<=3;c++)for(let r=Math.max(-3,-c-3);r<=Math.min(3,-c+3);r++){const f={q:i.q+c,r:i.r+r,s:i.s-c-r};xn(i,f,3)&&ze.isWalkable(e,f)&&(Ee(e,f)||o.push(f))}return o},upgrades:{}},wS={id:"TIME_BOMB",name:"Time Bomb",description:"Detonates when the fuse reaches zero.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0,damage:1},execute:(e,i,a)=>{const o=i.statusEffects.find(h=>h.type==="time_bomb");if(o&&o.duration>1)return{effects:[],messages:[],consumesTurn:!0};const c=i.position,f=[c,...ot(c)].map(h=>({type:"Damage",target:h,amount:1,reason:"bomb_explosion"}));return f.push({type:"Damage",target:i.id,amount:999,reason:"bomb_explosion"}),f.push({type:"Juice",effect:"explosion_ring",target:c,intensity:"high"}),{effects:f,messages:["A bomb exploded!"],consumesTurn:!0}},getValidTargets:(e,i)=>[i],upgrades:{}},_S=(e,i)=>!!e.tiles.get(he(i))?.traits?.has("CORPSE"),MS=(e,i,a)=>{const o=[];return e.tiles.forEach(c=>{c.traits.has("CORPSE")&&Ce(i,c.position)<=a&&o.push(c.position)}),o},OS={id:"CORPSE_EXPLOSION",name:"Corpse Explosion",description:"Detonate a target corpse, dealing damage in a 1-tile radius.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:2},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!_S(e,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!xn(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};o.push({type:"RemoveCorpse",position:a});const f=[a,...ot(a)],h=Ze(i),b=!!e.intentPreview?.dangerTiles?.some(y=>ne(y,i.position));for(const y of f){const A=Ee(e,y),v=bn({attackerId:i.id,targetId:A?.id||he(y),skillId:"CORPSE_EXPLOSION",basePower:2,trinity:h,targetTrinity:A?Ze(A):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.25}],statusMultipliers:[],inDangerPreviewHex:b,theoreticalMaxPower:2});o.push({type:"Damage",target:y,amount:v.finalPower,reason:"corpse_explosion",scoreEvent:v.scoreEvent})}return o.push({type:"Juice",effect:"explosion_ring",target:a}),o.push({type:"Juice",effect:"shake",intensity:"high"}),o.push({type:"Juice",effect:"combat_text",target:a,text:"BOOM!"}),c.push("Corpse exploded!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>MS(e,i,4),upgrades:{},scenarios:vt("CORPSE_EXPLOSION")},CS=(e,i)=>i.q>=0&&i.q<e.gridWidth&&i.r>=0&&i.r<e.gridHeight,NS=(e,i,a)=>ot(a).filter(c=>CS(e,c)).filter(c=>ze.isWalkable(e,c)).filter(c=>!Ee(e,c)).sort((c,r)=>{const f=Ce(c,i.position),h=Ce(r,i.position);return f!==h?f-h:c.q!==r.q?c.q-r.q:c.r-r.r})[0]||null,RS=(e,i)=>i.id!==e.id&&i.factionId===e.factionId;function Dg(e,i,a,o="fail"){const c=Ee(e,a);if(!c)return{ok:!0,spawnPosition:a,effects:[],messages:[]};if(o==="push_friendly"){if(!RS(i,c))return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."};const r=NS(e,i,a);return r?{ok:!0,spawnPosition:a,effects:[{type:"Displacement",target:c.id,destination:r,source:c.position,simulatePath:!0}],messages:["Ally repositions to make room."]}:{ok:!1,effects:[],messages:[],failureMessage:"No space to reposition ally."}}return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."}}const kS=(e,i)=>!!e.tiles.get(he(i))?.traits?.has("CORPSE"),LS=(e,i,a)=>{const o=[];return e.tiles.forEach(c=>{c.traits.has("CORPSE")&&Ce(i,c.position)<=a&&o.push(c.position)}),o},IS=e=>{const i=e.initialSeed??e.rngSeed??"0",a=new Set([...e.enemies.map(r=>r.id),...(e.companions||[]).map(r=>r.id)]);let o=(e.floor<<20)+(e.turnNumber<<12)+(e.actionLog?.length??0)+(e.rngCounter??0),c=`skeleton_${Bo(i,o,8,"skeleton")}`;for(;a.has(c);)o+=1,c=`skeleton_${Bo(i,o,8,"skeleton")}`;return c},BS={id:"RAISE_DEAD",name:"Raise Dead",description:"Reanimate a target corpse into a Skeleton minion (Faction: Player).",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!kS(e,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!xn(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=Dg(e,i,a,"push_friendly");if(!f.ok)return{effects:o,messages:[f.failureMessage||"Target tile occupied."],consumesTurn:!1};o.push(...f.effects),c.push(...f.messages),o.push({type:"RemoveCorpse",position:a});const h=By({companionType:"skeleton",ownerId:i.id,id:IS(e),position:a});return o.push({type:"SpawnActor",actor:h}),o.push({type:"Juice",effect:"flash",target:a,color:"#aaaaaa"}),c.push("Skeleton raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>{const a=Ee(e,i);return a?LS(e,i,4).filter(o=>Dg(e,a,o,"push_friendly").ok):[]},upgrades:{},scenarios:vt("RAISE_DEAD")},jS={id:"SOUL_SWAP",name:"Soul Swap",description:"Instantly swap positions with a player-aligned minion.",slot:"utility",icon:"",baseVariables:{range:6,cost:0,cooldown:3},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!xn(i.position,a,6))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const r=Ee(e,a);return!r||r.factionId!=="player"||r.id===i.id?{effects:o,messages:["Target must be a minion!"],consumesTurn:!1}:(o.push({type:"Displacement",target:i.id,destination:a}),o.push({type:"Displacement",target:r.id,destination:i.position}),o.push({type:"Juice",effect:"flash",target:a,color:"#330066"}),o.push({type:"Juice",effect:"flash",target:i.position,color:"#330066"}),c.push("Soul Swapped!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(e,i)=>e.enemies.filter(a=>a.factionId==="player"&&xn(i,a.position,6)).map(a=>a.position),upgrades:{},scenarios:vt("SOUL_SWAP")},DS={id:"MULTI_SHOOT",name:"Multi-Shoot",description:"A spread of arrows. Axial range 4. Deals damage to target and neighbors.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:1},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r}=as(i.position,a);if(!xn(i.position,a,4)||!r)return{effects:o,messages:["Invalid target! Axial range 4 only."],consumesTurn:!1};const f=[a,...ot(a)],h=Ze(i);for(const b of f){const y=Ee(e,b),A=bn({attackerId:i.id,targetId:y?.id||he(b),skillId:"MULTI_SHOOT",basePower:1,trinity:h,targetTrinity:y?Ze(y):void 0,damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.1},{attribute:"mind",coefficient:.1}],statusMultipliers:[]});o.push({type:"Damage",target:b,amount:A.finalPower,reason:"multi_shoot",scoreEvent:A.scoreEvent})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffff00"}),c.push("Multi-Shoot!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>nt.getAxialTargets(e,i,4),upgrades:{},scenarios:vt("MULTI_SHOOT")},HS={id:"SET_TRAP",name:"Set Trap",description:"Place a hidden trap. Roots units for 3 turns.",slot:"utility",icon:"",baseVariables:{range:1,cost:1,cooldown:2},execute:(e,i,a)=>{const o=[],c=[];return a?ki(e,a)||Ga(e,a)?{effects:o,messages:["Cannot place trap here!"],consumesTurn:!1}:(o.push({type:"PlaceTrap",position:a,ownerId:i.id}),o.push({type:"Juice",effect:"combat_text",target:a,text:"Trapped"}),c.push("Trap set."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(e,i)=>ot(i).filter(a=>!ki(e,a)&&!Ga(e,a)),upgrades:{},scenarios:vt("SET_TRAP")},PS={id:"SWIFT_ROLL",name:"Swift Roll",description:"Quickly dodge 2 tiles. Passive: Automatically roll away from attackers when hit.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,i,a)=>{const o=[],c=[];return a?xn(i.position,a,2)?ki(e,a)||Ga(e,a)||ha(e,a,i.id)?{effects:o,messages:["Cannot roll there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"Juice",effect:"dashBlur",target:a,path:[i.position,a]}),c.push("Swift roll!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(e,i)=>nt.getAreaTargets(e,i,2).filter(o=>ne(o,i)?!1:!ki(e,o)&&!Ga(e,o)&&!ha(e,o)),upgrades:{},scenarios:vt("SWIFT_ROLL")},US={id:"SNEAK_ATTACK",name:"Sneak Attack",description:"Attack an adjacent enemy. Deals massive damage if executed from stealth.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=zi(e.enemies,a);if(!r)return{effects:o,messages:["No target!"],consumesTurn:!1};if(!xn(i.position,a,1))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=(i.stealthCounter||0)>0,h=f?3:1,b=bn({attackerId:i.id,targetId:r.id,skillId:"SNEAK_ATTACK",basePower:h,trinity:Ze(i),targetTrinity:Ze(r),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.25}],statusMultipliers:[]});return o.push({type:"Damage",target:r.id,amount:b.finalPower,reason:"sneak_attack",source:i.position,scoreEvent:b.scoreEvent}),f?(o.push({type:"Juice",effect:"flash",target:a,color:"#ff0000"}),c.push("SNEAK ATTACK!")):c.push("Sneak attack (No stealth bonus)."),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>ot(i).filter(a=>!!zi(e.enemies,a)),upgrades:{},scenarios:vt("SNEAK_ATTACK")},qS={id:"SMOKE_SCREEN",name:"Smoke Screen",description:"Vanish into a cloud of smoke. Adds +2 to stealth counter.",slot:"utility",icon:"",baseVariables:{range:0,cost:0,cooldown:2},execute:(e,i,a)=>{const o=[],c=[];return o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:i.position}),c.push("Smoke Screen!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(e,i)=>[i],upgrades:{},scenarios:vt("SMOKE_SCREEN")},zS={id:"SHADOW_STEP",name:"Shadow Step",description:"Teleport through the shadows. Only works while invisible. Extends stealth.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(e,i,a)=>{const o=[],c=[];return a?(i.stealthCounter||0)>0?xn(i.position,a,2)?ki(e,a)||Ga(e,a)||ha(e,a,i.id)?{effects:o,messages:["Cannot step there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:a}),c.push("Shadow stepped!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:["Must be invisible to Shadow Step!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(e,i)=>(e.player.stealthCounter||0)>0?nt.getAreaTargets(e,i,2).filter(c=>ne(c,i)?!1:!ki(e,c)&&!Ga(e,c)&&!ha(e,c)):[],upgrades:{},scenarios:vt("SHADOW_STEP")};function rf(e,i){return e.enemies.find(a=>a.companionOf===i&&a.subtype==="falcon")}const $S={id:"FALCON_COMMAND",name:e=>{const i=e?.player?.id;if(!i)return"Summon Falcon";const a=rf(e,i);if(!a)return"Summon Falcon";const o=a.companionState?.mode||"roost";return o==="scout"?"Falcon: Scout":o==="predator"?"Falcon: Hunt":"Falcon: Roost"},description:e=>{const i=e?.player?.id;if(!i)return"Call your Falcon companion.";const a=rf(e,i);if(!a)return"Call your Falcon companion.";const o=a.companionState?.mode||"roost";return o==="scout"?"Click tile to set patrol zone. Falcon orbits and attacks nearby enemies.":o==="predator"?"Click enemy to mark as prey. Falcon pursues and uses Apex Strike.":"Falcon returns to you. Heals and cleanses 1 debuff on arrival."},slot:"offensive",icon:"",baseVariables:{range:6,cost:0,cooldown:0},execute:(e,i,a)=>{const o=[],c=[];let r=rf(e,i.id);if(!r){const b=Qx({ownerId:i.id,position:ot(i.position)[0]});return o.push({type:"SpawnActor",actor:b}),o.push({type:"Message",text:"Your Falcon companion awakens!"}),c.push("Falcon summoned!"),{effects:o,messages:c,consumesTurn:!0}}const f=a?Ee(e,a):void 0;return!a||ne(a,i.position)||!!(f&&f.id===i.id)?(c.push("Falcon returns to roost."),o.push({type:"Juice",effect:"combat_text",target:i.position,text:"Roost"}),o.push({type:"UpdateCompanionState",target:r.id,mode:"roost"}),{effects:o,messages:c,consumesTurn:!0}):f&&f.factionId==="enemy"?(c.push(`Falcon marks ${f.subtype||"enemy"} as prey!`),o.push({type:"Juice",effect:"combat_text",target:a,text:" Marked"}),o.push({type:"ApplyStatus",target:f.id,status:"marked_predator",duration:-1}),o.push({type:"UpdateCompanionState",target:r.id,mode:"predator",markTarget:f.id}),{effects:o,messages:c,consumesTurn:!0}):(c.push("Falcon set to patrol zone."),o.push({type:"Juice",effect:"combat_text",target:a,text:" Patrol"}),o.push({type:"UpdateCompanionState",target:r.id,mode:"scout",markTarget:a}),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(e,i)=>nt.getAreaTargets(e,i,6).filter(o=>(ne(o,i),!0)),upgrades:{KEEN_SIGHT:{id:"KEEN_SIGHT",name:"Keen Sight",description:"Falcon reveals hidden enemies within 3 tiles of its position."},FALCON_TWIN_TALONS:{id:"FALCON_TWIN_TALONS",name:"Twin Talons",description:"Basic Peck hits 2 targets instead of 1."},APEX_PREDATOR:{id:"APEX_PREDATOR",name:"Apex Predator",description:"Apex Strike cooldown reduced by 1. Marked enemies take +1 damage from all sources."}},scenarios:vt("FALCON_COMMAND")},VS={id:"FALCON_PECK",name:"Peck",description:"The falcon pecks an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(e,i,a,o=[])=>{const c=[],r=[],f=i.companionOf,b=(f?f===e.player.id?e.player:e.enemies.find(S=>S.id===f):void 0)?.activeSkills?.find(S=>S.id==="FALCON_COMMAND")?.activeUpgrades||[],y=o.includes("TWIN_TALONS")||b.includes("TWIN_TALONS")||b.includes("FALCON_TWIN_TALONS");if(!a)return{effects:c,messages:r,consumesTurn:!1};const A=Ee(e,a);if(!A||A.factionId==="player")return{effects:c,messages:r,consumesTurn:!1};if(Ce(i.position,a)>1)return{effects:c,messages:r,consumesTurn:!1};const v=[A];if(y){const S=ot(i.position).map(_=>Ee(e,_)).filter(_=>!!_&&_.id!==A.id&&_.factionId==="enemy")[0];S&&v.push(S)}for(const S of v){const _=bn({attackerId:i.id,targetId:S.id,skillId:"FALCON_PECK",basePower:1,trinity:Ze(i),targetTrinity:Ze(S),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:S.id,amount:_.finalPower,reason:"falcon_peck",scoreEvent:_.scoreEvent})}return c.push({type:"Juice",effect:"combat_text",target:a,text:"Peck!",intensity:"low"}),r.push(y&&v.length>1?`Falcon pecked ${v.length} enemies!`:`Falcon pecked ${A.subtype||"enemy"}!`),{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(e,i)=>ot(i).filter(a=>{const o=Ee(e,a);return o&&o.factionId==="enemy"}),upgrades:{TWIN_TALONS:{id:"TWIN_TALONS",name:"Twin Talons",description:"Peck hits 2 adjacent targets instead of 1."}},scenarios:vt("FALCON_PECK")},YS={id:"FALCON_APEX_STRIKE",name:"Apex Strike",description:"The falcon dives into a target for lethal damage.",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:2,damage:40},execute:(e,i,a,o=[])=>{const c=[],r=[],f=i.companionOf,b=(f?f===e.player.id?e.player:e.enemies.find(S=>S.id===f):void 0)?.activeSkills?.find(S=>S.id==="FALCON_COMMAND")?.activeUpgrades||[],y=o.includes("APEX_PREDATOR")||b.includes("APEX_PREDATOR");if(!a)return{effects:c,messages:r,consumesTurn:!1};const A=Ee(e,a);if(!A)return{effects:c,messages:r,consumesTurn:!1};if(i.companionState?.apexStrikeCooldown&&i.companionState.apexStrikeCooldown>0)return{effects:c,messages:r,consumesTurn:!1};const v=bn({attackerId:i.id,targetId:A.id,skillId:"FALCON_APEX_STRIKE",basePower:40,trinity:Ze(i),targetTrinity:Ze(A),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return c.push({type:"Damage",target:A.id,amount:v.finalPower,reason:"apex_strike",scoreEvent:v.scoreEvent}),c.push({type:"Juice",effect:"impact",target:a,intensity:"high"}),c.push({type:"UpdateCompanionState",target:i.id,apexStrikeCooldown:y?1:2}),r.push(`Falcon executes APEX STRIKE on ${A.subtype||"enemy"}!`),{effects:c,messages:r,consumesTurn:!0}},upgrades:{},getValidTargets:(e,i)=>{const a=[];return e.enemies.forEach(o=>{Ce(i,o.position)<=4&&a.push(o.position)}),a}},FS={id:"FALCON_HEAL",name:"Roost Heal",description:"The falcon roosts and restores health to its companion.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:1},execute:(e,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Ee(e,a);return r?i.companionState?.healCooldown&&i.companionState.healCooldown>0?{effects:o,messages:c,consumesTurn:!1}:(o.push({type:"Heal",target:r.id,amount:1}),o.push({type:"Juice",effect:"flash",target:r.position,color:"#00ff88"}),o.push({type:"UpdateCompanionState",target:i.id,healCooldown:1}),c.push("Falcon roosts. You feel restored."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(e,i)=>{const a=[],o=e.player;return Ce(i,o.position)<=1&&a.push(o.position),a}},KS={id:"FALCON_SCOUT",name:"Scout Orbit",description:"The actor orbits a target point in a hexagonal ring.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(e,i,a)=>{const o=[],c=[],r=i.companionState?.markTarget;if(!r||typeof r!="object")return{effects:o,messages:c,consumesTurn:!1};const f=r,h=ot(f);let b;if(Ce(i.position,f)!==1)b=h.sort((y,A)=>Ce(i.position,y)-Ce(i.position,A))[0];else{const A=(h.findIndex(v=>ne(v,i.position))+1)%6;b=h[A]}return nt.isWithinBounds(e,b)&&ze.isWalkable(e,b)&&!Ee(e,b)?(o.push({type:"Displacement",target:i.id,destination:b,source:i.position,simulatePath:!0}),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(e,i)=>[]},GS={id:"FALCON_AUTO_ROOST",name:"Auto Roost",description:"Automatically returns the falcon to roost mode when mark is lost.",slot:"passive",icon:"R",baseVariables:{range:0,cost:0,cooldown:0},execute:(e,i,a)=>({effects:[{type:"UpdateCompanionState",target:i.id,mode:"roost",markTarget:void 0}],messages:["Falcon loses prey and returns to roost mode."],consumesTurn:!0}),getValidTargets:(e,i)=>[i],upgrades:{}},Hg=2,WS=3,XS=3,QS=2;function JS(e,i){const a=[];for(let o=0;o<6;o++){let c=e;for(let r=0;r<i;r++)c=Yn(c,Pn(o));a.push(c)}return a}function ZS(e,i,a){return JS(i,a).filter(c=>!(!nt.isWithinBounds(e,c)||!ze.isWalkable(e,c)||Ee(e,c)))}const e1={id:"KINETIC_TRI_TRAP",name:"Kinetic Tri-Trap",description:"Deploy 3 hidden traps on axial tiles. Triggered enemies are flung away.",slot:"defensive",icon:"",baseVariables:{range:Hg,cost:0,cooldown:XS},execute:(e,i,a,o=[])=>{const c=[],r=[];let f=e;const h=o.includes("VOLATILE_CORE"),b=o.includes("TRAP_CHAIN_REACTION")||o.includes("CHAIN_REACTION"),y=o.includes("QUICK_RELOAD"),A=ZS(e,i.position,Hg);if(A.length===0)return{effects:c,messages:["No valid trap positions!"],consumesTurn:!1};const v=Math.min(WS,A.length),S=[];c.push({type:"RemoveTrap",position:{q:0,r:0,s:0},ownerId:i.id});const _=[...A];for(let p=0;p<v&&_.length!==0;p++){const{value:g,nextState:R}=Va(f);f=R;const I=Math.floor(g*_.length)%_.length;S.push(_[I]),_.splice(I,1)}for(const p of S)c.push({type:"PlaceTrap",position:p,ownerId:i.id,volatileCore:h,chainReaction:b,resetCooldown:y?1:QS}),c.push({type:"Juice",effect:"flash",target:p,intensity:"low",color:"#ffaa00"});return r.push(`${S.length} traps deployed.`),{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(e,i)=>[i],upgrades:{VOLATILE_CORE:{id:"VOLATILE_CORE",name:"Volatile Core",description:"Traps deal 1 damage when triggered."},TRAP_CHAIN_REACTION:{id:"TRAP_CHAIN_REACTION",name:"Chain Reaction",description:"When a trap triggers, adjacent traps also activate."},QUICK_RELOAD:{id:"QUICK_RELOAD",name:"Quick Reload",description:"Individual trap reset cooldown reduced to 1."}},scenarios:vt("KINETIC_TRI_TRAP")},Pg=1,Ug=1,t1=1,zy=2,n1=2;function i1(e,i,a,o=zy){const c=fa(a,i);if(c===-1)return null;const r=Pn(c);for(let h=o;h>=t1;h--){let b=i,y=!0;for(let A=0;A<h;A++){if(b=Yn(b,r),!nt.isWithinBounds(e,b)){y=!1;break}if(!ze.isWalkable(e,b)){y=!1;break}}if(y&&!Ee(e,b))return b}const f=[(c+1)%6,(c+5)%6];for(const h of f){const b=Pn(h);let y=Yn(i,b);if(nt.isWithinBounds(e,y)&&ze.isWalkable(e,y)&&!Ee(e,y))return y}return null}const s1={id:"WITHDRAWAL",name:"Withdrawal",description:"Quick shot + tactical backroll. Auto-triggers when enemies close in.",slot:"utility",icon:"",baseVariables:{range:Pg,cost:0,cooldown:n1,damage:Ug},execute:(e,i,a,o=[])=>{const c=[],r=[],f=o.includes("PARTING_SHOT"),h=o.includes("NIMBLE_FEET");if(!a)return{effects:c,messages:["No target!"],consumesTurn:!1};if(Ce(i.position,a)>Pg)return{effects:c,messages:["Target out of range!"],consumesTurn:!1};const y=Ee(e,a);if(!y)return{effects:c,messages:["No enemy at target!"],consumesTurn:!1};if(y.factionId===i.factionId)return{effects:c,messages:["Cannot target allies!"],consumesTurn:!1};const A=bn({attackerId:i.id,targetId:y.id,skillId:"WITHDRAWAL",basePower:Ug+(f?1:0),trinity:Ze(i),targetTrinity:Ze(y),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});c.push({type:"Damage",target:y.id,amount:A.finalPower,scoreEvent:A.scoreEvent}),c.push({type:"Juice",effect:"impact",target:a}),r.push(`Withdrawal shot hits ${y.subtype||"enemy"}!`);const v=h?3:zy,S=i1(e,i.position,a,v);return S?(c.push({type:"Displacement",target:"self",destination:S,source:i.position}),c.push({type:"Juice",effect:"dashBlur",target:S,path:[i.position,S]}),r.push("Backroll!")):r.push("No safe retreat available!"),{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(e,i)=>ot(i).filter(a=>{const o=Ee(e,a);return o&&o.factionId==="enemy"}),upgrades:{PARTING_SHOT:{id:"PARTING_SHOT",name:"Parting Shot",description:"Withdrawal deals +1 damage."},NIMBLE_FEET:{id:"NIMBLE_FEET",name:"Nimble Feet",description:"Backroll distance increased to 3 hexes."},HAIR_TRIGGER:{id:"HAIR_TRIGGER",name:"Hair Trigger",description:"Passive reaction does not consume cooldown."}},scenarios:vt("WITHDRAWAL")},a1={id:"ABSORB_FIRE",name:"Absorb Fire",description:"Fire heals you instead of harming you.",slot:"passive",icon:"",baseVariables:{cost:0,cooldown:0,range:0},execute:(e,i,a)=>({effects:[],messages:[]}),getValidTargets:()=>[],upgrades:{}},ca=(e,i)=>e.includes(i),o1=e=>{const i=new Set,a=e.id;return((e.baseVariables.damage||0)>0||/(ATTACK|THROW|BLAST|FIREBALL|BASH|PECK|EXPLOSION|SPEAR|SHOOT)/.test(a))&&i.add("damage"),/(MOVE|DASH|JUMP|ROLL|VAULT|STEP|GRAPPLE|WITHDRAWAL|WALK)/.test(a)&&i.add("move"),/(HEAL|ABSORB)/.test(a)&&i.add("heal"),/(SHIELD|PROTECT|BULWARK)/.test(a)&&i.add("protect"),/(STUN|TRAP|SMOKE|TELEGRAPH|ROOT|SWAP|SCOUT)/.test(a)&&i.add("control"),/(RAISE|FALCON|SUMMON)/.test(a)&&i.add("summon"),/(FIRE|LAVA|HAZARD|TRAP)/.test(a)&&i.add("hazard"),e.slot==="offensive"&&i.add("damage"),e.slot==="defensive"&&i.add("protect"),e.slot==="utility"&&i.add("utility"),(e.baseVariables.cooldown>0||e.baseVariables.cost>0)&&i.add("economy"),i.size||i.add("utility"),[...i]},l1={BASIC_MOVE:{intentTags:["move","objective","utility"],target:{pattern:"single"},estimates:{movement:1}},BASIC_ATTACK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:4}},AUTO_ATTACK:{intentTags:["damage","utility"],target:{pattern:"single"},estimates:{damage:2}},DASH:{intentTags:["move","damage","utility"],target:{pattern:"line"},estimates:{movement:2,damage:2},risk:{noProgressCastPenalty:5}},JUMP:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2},risk:{noProgressCastPenalty:6}},SHIELD_BASH:{intentTags:["damage","control","protect"],target:{pattern:"single"},estimates:{damage:3,control:2},risk:{requireEnemyContact:!0,noContactPenalty:5,noProgressCastPenalty:7}},BULWARK_CHARGE:{intentTags:["move","protect","damage"],target:{pattern:"line"},estimates:{movement:2,damage:4,shielding:2}},VAULT:{intentTags:["move","utility","control"],target:{pattern:"single"},estimates:{movement:3,control:2}},GRAPPLE_HOOK:{intentTags:["move","control"],target:{pattern:"line"},estimates:{movement:3,control:2}},SHIELD_THROW:{intentTags:["damage","control"],target:{pattern:"line"},estimates:{damage:6,control:2}},SPEAR_THROW:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:5}},FIREBALL:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:5,control:1}},FIREWALL:{intentTags:["hazard","control","damage"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:5,control:3}},FIREWALK:{intentTags:["move","hazard","utility"],target:{pattern:"single"},estimates:{movement:3},risk:{noProgressCastPenalty:8}},ABSORB_FIRE:{intentTags:["heal","hazard","utility"],target:{pattern:"self"},estimates:{healing:6},risk:{noProgressCastPenalty:2}},BOMB_TOSS:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:2}},TIME_BOMB:{intentTags:["damage","hazard","utility"],target:{pattern:"self"},estimates:{damage:6,control:1}},CORPSE_EXPLOSION:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:1}},RAISE_DEAD:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:5}},SOUL_SWAP:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:2}},MULTI_SHOOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5}},SET_TRAP:{intentTags:["control","hazard"],target:{pattern:"single"},estimates:{control:3}},SWIFT_ROLL:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2}},SNEAK_ATTACK:{intentTags:["damage","move"],target:{pattern:"single"},estimates:{damage:8,movement:2},risk:{requireEnemyContact:!0,noContactPenalty:3,noProgressCastPenalty:4}},SMOKE_SCREEN:{intentTags:["control","protect","utility"],target:{pattern:"radius",aoeRadius:1},estimates:{control:4,shielding:4}},SHADOW_STEP:{intentTags:["move","damage","utility"],target:{pattern:"single"},estimates:{movement:3,damage:3}},FALCON_COMMAND:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:4,control:2}},FALCON_PECK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:3}},FALCON_APEX_STRIKE:{intentTags:["damage","control"],target:{pattern:"single"},estimates:{damage:5,control:1}},FALCON_HEAL:{intentTags:["heal","utility"],target:{pattern:"single"},estimates:{healing:4}},FALCON_SCOUT:{intentTags:["control","utility"],target:{pattern:"self"},estimates:{control:3}},FALCON_AUTO_ROOST:{intentTags:["summon","utility"],target:{pattern:"self"},estimates:{summon:2}},KINETIC_TRI_TRAP:{intentTags:["control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{control:5,damage:4}},WITHDRAWAL:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:1}},SENTINEL_TELEGRAPH:{intentTags:["control","objective"],target:{pattern:"radius",aoeRadius:2},estimates:{control:3}},SENTINEL_BLAST:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:7}},THEME_HAZARDS:{intentTags:["hazard","control"],target:{pattern:"global"},estimates:{control:2}}},r1=(e,i)=>i?{...e,...i,target:{...e.target,...i.target||{}},estimates:{...e.estimates,...i.estimates||{}},economy:{...e.economy,...i.economy||{}},risk:{...e.risk,...i.risk||{}}}:e,c1=e=>{const i=o1(e),a=(ca(i,"move"),"single"),o={id:e.id,intentTags:i,target:{range:Math.max(0,e.baseVariables.range||0),pattern:a},estimates:{damage:Math.max(0,e.baseVariables.damage||0),movement:ca(i,"move")?Math.max(1,Math.min(3,e.baseVariables.range||1)):0,healing:ca(i,"heal")?2:0,shielding:ca(i,"protect")?1:0,control:ca(i,"control")?1:0,summon:ca(i,"summon")?1:0},economy:{cost:Math.max(0,e.baseVariables.cost||0),cooldown:Math.max(0,e.baseVariables.cooldown||0),consumesTurn:!0},risk:{selfExposure:ca(i,"move")?.5:0,hazardAffinity:ca(i,"hazard")?.5:0},complexity:1};return r1(o,l1[e.id])},u1=e=>{const i=[];return(!e.intentTags||e.intentTags.length===0)&&i.push("intentTags must not be empty"),(!Number.isFinite(e.target.range)||e.target.range<0)&&i.push("target.range must be >= 0"),e.target.pattern||i.push("target.pattern is required"),(!Number.isFinite(e.economy.cooldown)||e.economy.cooldown<0)&&i.push("economy.cooldown must be >= 0"),(!Number.isFinite(e.economy.cost)||e.economy.cost<0)&&i.push("economy.cost must be >= 0"),(!Number.isFinite(e.complexity)||e.complexity<0)&&i.push("complexity must be >= 0"),i},d1=e=>{const i=[],a=[];for(const[o,c]of Object.entries(e)){const r=c.intentProfile||c1(c);c.intentProfile=r;const f=u1(r);f.length>0&&a.push({skillId:o,errors:f}),r||i.push(o)}return{missing:i,invalid:a}},f1=(e,i)=>e.player.id===i?e.player:e.enemies.find(a=>a.id===i)||e.companions?.find(a=>a.id===i),m1=(e,i,a)=>!!(e.player.id!==a&&ne(e.player.position,i)||e.enemies.some(o=>o.id!==a&&o.hp>0&&ne(o.position,i))||e.companions?.some(o=>o.id!==a&&o.hp>0&&ne(o.position,i))),qg=(e,i)=>{const a={q:i.q-e.q,r:i.r-e.r,s:i.s-e.s};let o=nr[0],c=Number.NEGATIVE_INFINITY;for(const r of nr){const f=r.q*a.q+r.r*a.r+r.s*a.s;f>c&&(c=f,o=r)}return o},p1=(e,i)=>{const a=f1(e,i.targetActorId);if(!a)return{effects:[],destination:null,collided:!1};const o=Math.max(0,Math.min(i.maxDistance,Math.floor(i.magnitude)));if(o<=0)return{effects:[],destination:a.position,collided:!1};const c=a.position,r=i.mode==="push"?qg(i.source,c):qg(c,i.source),f=[c];let h=c,b=!1;for(let A=0;A<o;A++){const v=Yn(h,r);if(!ze.isWalkable(e,v)||m1(e,v,a.id)){b=!0;break}f.push(v),h=v}const y=[];return ne(h,c)||y.push({type:"Displacement",target:a.id,destination:h,path:f,simulatePath:!0}),b&&i.collision.onBlocked==="crush_damage"&&y.push({type:"Damage",target:a.id,amount:Math.max(0,Math.floor(i.collision.crushDamage??0)),reason:i.damageReason||"crush"}),{effects:y,destination:h,collided:b}},vc=e=>JSON.parse(JSON.stringify(e)),h1=(e,i)=>i==="floor"?Math.floor(e):i==="round"?Math.round(e):i==="ceil"?Math.ceil(e):e,cf=(e,i)=>{let a=e.base;for(const o of e.scaling||[])a+=(i[o.stat]??0)*o.coefficient;return a=h1(a,e.round),e.min!==void 0&&(a=Math.max(e.min,a)),e.max!==void 0&&(a=Math.min(e.max,a)),a},g1=(e,i,a,o)=>{const c=i.split(".");let r=e;for(let b=0;b<c.length-1;b++){const y=c[b],A=r[y];if(!A||typeof A!="object")return;r=A}const f=c[c.length-1],h=Number(r[f]);Number.isFinite(h)&&(a==="set"&&(r[f]=o),a==="add"&&(r[f]=h+o),a==="multiply"&&(r[f]=h*o))},y1=(e,i,a)=>{let o=vc(e.baseAction.effects);const c=vc(e.reactivePassives||[]),r=new Set(e.keywords),f={};for(const h of e.upgrades)f[h.id]=h;for(const h of i){const b=f[h];if(b)for(const y of b.modifiers){if(y.op==="add_effect"&&o.push(vc(y.effect)),y.op==="remove_effect_by_tag"&&(o=o.filter(A=>!A.tags.includes(y.tag))),y.op==="modify_number"){const A=o.find(v=>v.id===y.effectId);A&&g1(A,y.field,y.mode,y.value)}y.op==="add_keyword"&&r.add(y.keyword),y.op==="remove_keyword"&&r.delete(y.keyword),y.op==="add_reaction"&&c.push(vc(y.reaction))}}return e.inhibit?.filterMode==="exclude_matching_tags"&&a.size>0&&(o=o.filter(h=>!h.tags.some(b=>a.has(b)))),{effects:o,reactions:c,keywords:r}},b1=(e,i)=>{const a=Ze(e),o=Number(i?.momentum??0),c=Number(i?.mass??1);return{body:a.body,mind:a.mind,instinct:a.instinct,mass:Number.isFinite(c)?c:1,speed:e.speed||1,momentum:Number.isFinite(o)?o:0}},uf=(e,i)=>i?Ee(e,i)?.id:void 0,x1=(e,i,a,o,c)=>{if(o.kind==="MESSAGE")return[{type:"Message",text:o.text}];if(o.kind==="DEAL_DAMAGE"){const b=Math.max(0,Math.floor(cf(o.amount,c))),y=uf(e,a);return[{type:"Damage",target:o.target.selector==="targetActor"?y||"targetActor":o.target.selector==="self"?i.id:a||"targetActor",amount:b,reason:o.reason}]}if(o.kind==="APPLY_STATUS"){const b=uf(e,a);return[{type:"ApplyStatus",target:o.target.selector==="targetActor"?b||"targetActor":o.target.selector==="self"?i.id:a||"targetActor",status:o.statusId,duration:o.duration}]}const r=uf(e,a);if(!r)return[];const f=cf(o.force.magnitude,c),h=o.force.collision.crushDamage?cf(o.force.collision.crushDamage,c):0;return p1(e,{source:i.position,targetActorId:r,mode:o.force.mode,magnitude:f,maxDistance:o.force.maxDistance,collision:{onBlocked:o.force.collision.onBlocked,crushDamage:h}}).effects},v1=(e,i,a,o)=>{const c=[];for(let r=0;r<e.gridWidth;r++)for(let f=0;f<e.gridHeight;f++){const h=Vn(r,f);pa(h,e.gridWidth,e.gridHeight)&&Ce(i,h)<=a&&c.push(h)}return c.sort((r,f)=>{if(o==="q_then_r")return r.q===f.q?r.r-f.r:r.q-f.q;if(o==="r_then_q")return r.r===f.r?r.q-f.q:r.r-f.r;const h=Ce(i,r),b=Ce(i,f);return h!==b?h-b:r.q===f.q?r.r-f.r:r.q-f.q}),c},S1=e=>{const i=e.baseAction.effects.find(c=>c.kind==="DEAL_DAMAGE"),a=e.baseAction.effects.find(c=>c.kind==="APPLY_FORCE"),o={};return e.upgrades.forEach(c=>{o[c.id]={id:c.id,name:c.name,description:c.description||c.name}}),{id:e.id,name:e.name,description:e.description||e.name,slot:e.slot,icon:"data-driven",baseVariables:{range:e.targeting.range,cost:e.baseAction.costs.energy,cooldown:e.baseAction.costs.cooldown,damage:i?.amount?.base,momentum:a?.force?.magnitude?.base},execute:(c,r,f,h=[],b={})=>{const y=new Set(b.inhibitTags||[]),A=y1(e,h,y),v=b1(r,b),_=[...(A.reactions||[]).filter(g=>g.trigger==="ON_DECLARE").flatMap(g=>g.effects),...A.effects],p=[];for(const g of _)p.push(...x1(c,r,f,g,v));return{effects:p,messages:[],consumesTurn:e.baseAction.costs.consumesTurn}},getValidTargets:(c,r)=>{if(e.targeting.mode==="self")return[r];let f=v1(c,r,e.targeting.range,e.targeting.deterministicSort);return(e.targeting.mode==="single"||e.targeting.mode==="radius"||e.targeting.mode==="line")&&(e.targeting.requiresLos&&(f=f.filter(h=>jf(c,r,h).isValid)),e.targeting.allowOccupied||(f=f.filter(h=>!Ee(c,h)))),f},upgrades:o}},A1=new Map,$y=new Map,T1=e=>{const i=S1(e);return A1.set(e.id,e),$y.set(e.id,i),i},E1=e=>e.map(T1),w1=()=>{const e={};for(const[i,a]of $y.entries())e[i]=a;return e},Kc={GRAPPLE_HOOK:oS,SPEAR_THROW:lS,SHIELD_BASH:rS,SHIELD_THROW:hS,VAULT:gS,JUMP:cS,BULWARK_CHARGE:uS,BASIC_ATTACK:dS,AUTO_ATTACK:Dy,SENTINEL_TELEGRAPH:fS,SENTINEL_BLAST:mS,THEME_HAZARDS:pS,BASIC_MOVE:bS,DASH:xS,FIREBALL:SS,FIREWALL:AS,FIREWALK:TS,BOMB_TOSS:ES,TIME_BOMB:wS,CORPSE_EXPLOSION:OS,RAISE_DEAD:BS,SOUL_SWAP:jS,MULTI_SHOOT:DS,SET_TRAP:HS,SWIFT_ROLL:PS,SNEAK_ATTACK:US,SMOKE_SCREEN:qS,SHADOW_STEP:zS,FALCON_COMMAND:$S,FALCON_PECK:VS,FALCON_APEX_STRIKE:YS,FALCON_HEAL:FS,FALCON_SCOUT:KS,FALCON_AUTO_ROOST:GS,KINETIC_TRI_TRAP:e1,WITHDRAWAL:s1,ABSORB_FIRE:a1},Sc=d1(Kc);if(Sc.missing.length>0||Sc.invalid.length>0){const e=Sc.missing.join(", "),i=Sc.invalid.map(a=>`${a.skillId}: ${a.errors.join("; ")}`).join(" | ");throw new Error(`Skill intent profile validation failed. missing=[${e}] invalid=[${i}]`)}const Lo=()=>({...Kc,...w1()});function da(e){const a=Lo()[e];return a?{id:e,name:a.name,description:typeof a.description=="function"?a.description({}):a.description,slot:a.slot,cooldown:a.baseVariables.cooldown||0,currentCooldown:0,range:a.baseVariables.range||0,upgrades:Object.keys(a.upgrades||{}),activeUpgrades:[]}:null}function _1(){return[da("BASIC_MOVE"),da("BASIC_ATTACK"),da("AUTO_ATTACK"),da("SPEAR_THROW"),da("SHIELD_BASH"),da("JUMP")].filter(Boolean)}const M1={...Kc,get:e=>Lo()[e],getAllUpgrades:()=>{const e=Lo();return Object.values(e).flatMap(i=>Object.values(i.upgrades||{}).map(a=>({...a,skillId:i.id})))},getUpgrade:e=>{const i=Lo();for(const a of Object.values(i))if(a.upgrades?.[e])return a.upgrades[e]},getSkillForUpgrade:e=>{const i=Lo();for(const[a,o]of Object.entries(i))if(o.upgrades?.[e])return a},getSkillRange:(e,i)=>{const a=(e.activeSkills||[]).find(r=>r.id===i),o=Lo()[i];if(!o)return a?.range||0;let c=o.baseVariables.range;return a?.activeUpgrades&&a.activeUpgrades.forEach(r=>{const f=o.upgrades[r];f?.modifyRange&&(c+=f.modifyRange)}),c}},Rn=M1,O1=Rn.getSkillRange,C1=e=>Rn.get(e),N1=(e,i,a,o)=>{let c=e;const r=[],f=a?e.enemies.filter(b=>b.id===a):e.enemies,h=[...c.enemies];return f.forEach(b=>{const y=c.enemies.find(A=>A.id===b.id);if(y){if(Ns(y)){const A=h.findIndex(v=>v.id===b.id);A!==-1&&(h[A]={...h[A],intent:void 0,intentPosition:void 0});return}if(y.intent&&y.intentPosition){let A=!1;const v=Rn.get(y.intent),S=y.activeSkills?.find(_=>_.id===y.intent);if(v&&S){const p=(v.getValidTargets?v.getValidTargets(c,y.position):[]).some(I=>ne(I,c.player.position));let g=y.intentPosition;if(p)g=c.player.position;else{const I=h.findIndex(C=>C.id===b.id);I!==-1&&(h[I]={...h[I],intent:void 0,intentPosition:void 0});return}const R=v.execute(c,y,g,S.activeUpgrades);c=pi(c,R.effects,{sourceId:y.id,targetId:c.player.id,stepId:o}),r.push(...R.messages),A=!0}else if(y.subtype!=="bomber"){if(ne(y.intentPosition,i)){c={...c,player:ua(c.player,1)};const _=`${y.subtype||"enemy"}#${y.id}`;r.push(`${_} hit you! (HP: ${c.player.hp}/${c.player.maxHp})`),A=!0}}if(A){const _=h.findIndex(p=>p.id===b.id);_!==-1&&(h[_]={...h[_],intent:void 0,intentPosition:void 0})}}}}),c={...c,enemies:h},{state:c,messages:r}};class zg extends Error{issues;constructor(i,a){super(`${i} validation failed:
${a.map(o=>`${o.path}: ${o.message}`).join(`
`)}`),this.name="ContractValidationError",this.issues=a}}const mn=e=>typeof e=="object"&&e!==null&&!Array.isArray(e),Os=e=>typeof e=="number"&&Number.isFinite(e),Pi=e=>Number.isInteger(e),Rt=e=>typeof e=="string",ge=(e,i,a)=>e.push({path:i,message:a}),R1=e=>{if(!Rt(e))return e;try{return JSON.parse(e)}catch(i){throw new Error(`Invalid JSON: ${i.message}`)}},Jl=(e,i,a,o={})=>{if(!Array.isArray(e))return ge(i,a,"Expected array");const c=new Set;o.nonEmpty&&e.length===0&&ge(i,a,"Must not be empty"),e.forEach((r,f)=>{if(!Rt(r)||r.length===0)return ge(i,`${a}[${f}]`,"Expected non-empty string");o.unique&&(c.has(r)&&ge(i,`${a}[${f}]`,`Duplicate "${r}"`),c.add(r))})},$g=(e,i,a)=>{if(!mn(e))return ge(i,a,"Expected object");Os(e.base)||ge(i,`${a}.base`,"Expected number"),e.min!==void 0&&!Os(e.min)&&ge(i,`${a}.min`,"Expected number"),e.max!==void 0&&!Os(e.max)&&ge(i,`${a}.max`,"Expected number"),Os(e.min)&&Os(e.max)&&e.min>e.max&&ge(i,a,"min must be <= max")},k1=(e,i,a)=>mn(e)?((!Rt(e.id)||e.id.length===0)&&ge(i,`${a}.id`,"Expected non-empty string"),Jl(e.tags,i,`${a}.tags`,{nonEmpty:!0,unique:!0}),Rt(e.kind)?e.kind==="DEAL_DAMAGE"?($g(e.amount,i,`${a}.amount`),(!mn(e.target)||!Rt(e.target.selector))&&ge(i,`${a}.target`,"Expected selector"),!0):e.kind==="APPLY_STATUS"?((!Rt(e.statusId)||e.statusId.length===0)&&ge(i,`${a}.statusId`,"Expected statusId"),(!Pi(e.duration)||e.duration<0)&&ge(i,`${a}.duration`,"Expected integer >= 0"),(!mn(e.target)||!Rt(e.target.selector))&&ge(i,`${a}.target`,"Expected selector"),!0):e.kind==="APPLY_FORCE"?mn(e.force)?((!Rt(e.force.mode)||!new Set(["push","pull"]).has(e.force.mode))&&ge(i,`${a}.force.mode`,"Expected push|pull"),(!Rt(e.force.direction)||!new Set(["source_to_target","target_to_source"]).has(e.force.direction))&&ge(i,`${a}.force.direction`,"Invalid direction"),(!Pi(e.force.maxDistance)||e.force.maxDistance<0)&&ge(i,`${a}.force.maxDistance`,"Expected integer >= 0"),$g(e.force.magnitude,i,`${a}.force.magnitude`),mn(e.force.collision)||ge(i,`${a}.force.collision`,"Expected object"),!0):(ge(i,`${a}.force`,"Expected object"),!0):e.kind==="MESSAGE"?((!Rt(e.text)||e.text.length===0)&&ge(i,`${a}.text`,"Expected non-empty string"),!0):(ge(i,`${a}.kind`,"Unknown kind"),!1):(ge(i,`${a}.kind`,"Expected kind"),!1)):(ge(i,a,"Expected object"),!1),L1=(e,i,a)=>{if(!mn(e))return ge(i,a,"Expected object");if(!Rt(e.method))return ge(i,`${a}.method`,"Expected method");if(e.method==="fixed"){Os(e.value)||ge(i,`${a}.value`,"Expected number");return}if(e.method==="uniform_int"){Pi(e.min)||ge(i,`${a}.min`,"Expected integer"),Pi(e.max)||ge(i,`${a}.max`,"Expected integer"),Pi(e.min)&&Pi(e.max)&&e.min>e.max&&ge(i,a,"min must be <= max");return}if(e.method==="triangular_int"){Pi(e.min)||ge(i,`${a}.min`,"Expected integer"),Pi(e.mode)||ge(i,`${a}.mode`,"Expected integer"),Pi(e.max)||ge(i,`${a}.max`,"Expected integer");return}if(e.method==="weighted_table"){if(!Array.isArray(e.table)||e.table.length===0)return ge(i,`${a}.table`,"Expected non-empty array");e.table.forEach((o,c)=>{if(!mn(o))return ge(i,`${a}.table[${c}]`,"Expected object");Os(o.value)||ge(i,`${a}.table[${c}].value`,"Expected number"),(!Os(o.weight)||o.weight<=0)&&ge(i,`${a}.table[${c}].weight`,"Expected number > 0")});return}ge(i,`${a}.method`,"Unknown propensity method")},I1=e=>{const i=[];if(!mn(e))return ge(i,"$","Expected object"),i;if((!Rt(e.version)||!/^1\./.test(e.version))&&ge(i,"$.version","Expected v1.x"),(!Rt(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&ge(i,"$.id","Expected uppercase id"),(!Rt(e.name)||e.name.length===0)&&ge(i,"$.name","Expected non-empty string"),(!Rt(e.actorType)||!new Set(["player","enemy"]).has(e.actorType))&&ge(i,"$.actorType","Expected player|enemy"),(!Rt(e.factionId)||e.factionId.length===0)&&ge(i,"$.factionId","Expected non-empty string"),(!mn(e.coordSpace)||e.coordSpace.system!=="cube-axial"||e.coordSpace.pointFormat!=="qrs")&&ge(i,"$.coordSpace","Expected {system:cube-axial,pointFormat:qrs}"),mn(e.instantiate)?((!Rt(e.instantiate.rngStream)||e.instantiate.rngStream.length===0)&&ge(i,"$.instantiate.rngStream","Expected non-empty string"),(!Rt(e.instantiate.counterMode)||!new Set(["consume_global","stateless"]).has(e.instantiate.counterMode))&&ge(i,"$.instantiate.counterMode","Expected consume_global|stateless"),Jl(e.instantiate.drawOrder,i,"$.instantiate.drawOrder",{nonEmpty:!0,unique:!0})):ge(i,"$.instantiate","Expected object"),!mn(e.propensities))ge(i,"$.propensities","Expected object");else{const a=e.propensities;["body","mind","instinct","speed","mass"].forEach(o=>{o in a||ge(i,`$.propensities.${o}`,"Missing required propensity")}),Object.entries(a).forEach(([o,c])=>L1(c,i,`$.propensities.${o}`))}return mn(e.skillLoadout)?(Jl(e.skillLoadout.baseSkillIds,i,"$.skillLoadout.baseSkillIds",{nonEmpty:!0,unique:!0}),e.skillLoadout.passiveSkillIds!==void 0&&Jl(e.skillLoadout.passiveSkillIds,i,"$.skillLoadout.passiveSkillIds",{unique:!0})):ge(i,"$.skillLoadout","Expected object"),i},B1=e=>{const i=[];return mn(e)?((!Rt(e.version)||!/^1\./.test(e.version))&&ge(i,"$.version","Expected v1.x"),(!Rt(e.id)||!/^[A-Z0-9_]+$/.test(e.id))&&ge(i,"$.id","Expected uppercase id"),(!Rt(e.name)||e.name.length===0)&&ge(i,"$.name","Expected non-empty string"),(!Rt(e.slot)||!new Set(["offensive","defensive","utility","passive"]).has(e.slot))&&ge(i,"$.slot","Invalid slot"),Jl(e.keywords,i,"$.keywords",{unique:!0}),mn(e.targeting)?((!Rt(e.targeting.mode)||!new Set(["self","single","line","radius","global"]).has(e.targeting.mode))&&ge(i,"$.targeting.mode","Invalid mode"),(!Pi(e.targeting.range)||e.targeting.range<0)&&ge(i,"$.targeting.range","Expected integer >= 0"),typeof e.targeting.requiresLos!="boolean"&&ge(i,"$.targeting.requiresLos","Expected boolean"),typeof e.targeting.allowOccupied!="boolean"&&ge(i,"$.targeting.allowOccupied","Expected boolean")):ge(i,"$.targeting","Expected object"),(!mn(e.stackPolicy)||e.stackPolicy.resolveOrder!=="LIFO")&&ge(i,"$.stackPolicy.resolveOrder","MVP requires LIFO"),mn(e.baseAction)?(mn(e.baseAction.costs)?((!Os(e.baseAction.costs.energy)||e.baseAction.costs.energy<0)&&ge(i,"$.baseAction.costs.energy","Expected number >= 0"),(!Pi(e.baseAction.costs.cooldown)||e.baseAction.costs.cooldown<0)&&ge(i,"$.baseAction.costs.cooldown","Expected integer >= 0"),typeof e.baseAction.costs.consumesTurn!="boolean"&&ge(i,"$.baseAction.costs.consumesTurn","Expected boolean")):ge(i,"$.baseAction.costs","Expected object"),!Array.isArray(e.baseAction.effects)||e.baseAction.effects.length===0?ge(i,"$.baseAction.effects","Expected non-empty array"):e.baseAction.effects.forEach((a,o)=>k1(a,i,`$.baseAction.effects[${o}]`))):ge(i,"$.baseAction","Expected object"),Array.isArray(e.upgrades)?e.upgrades.forEach((a,o)=>{if(!mn(a))return ge(i,`$.upgrades[${o}]`,"Expected object");(!Rt(a.id)||!/^[A-Z0-9_]+$/.test(a.id))&&ge(i,`$.upgrades[${o}].id`,"Expected uppercase id"),(!Rt(a.name)||a.name.length===0)&&ge(i,`$.upgrades[${o}].name`,"Expected non-empty string"),Array.isArray(a.modifiers)||ge(i,`$.upgrades[${o}].modifiers`,"Expected array")}):ge(i,"$.upgrades","Expected array"),i):(ge(i,"$","Expected object"),i)},j1=e=>{const i=R1(e),a=[];if(!mn(i))throw new zg("TacticalDataPack",[{path:"$",message:"Expected pack object"}]);if((!Rt(i.version)||!/^1\./.test(i.version))&&a.push({path:"$.version",message:"Expected v1.x string"}),Array.isArray(i.units)?i.units.forEach((o,c)=>{I1(o).forEach(f=>a.push({path:`$.units[${c}]${f.path.slice(1)}`,message:f.message}))}):a.push({path:"$.units",message:"Expected array"}),Array.isArray(i.skills)?i.skills.forEach((o,c)=>{B1(o).forEach(f=>a.push({path:`$.skills[${c}]${f.path.slice(1)}`,message:f.message}))}):a.push({path:"$.skills",message:"Expected array"}),a.length>0)throw new zg("TacticalDataPack",a);return i},D1=e=>({definition:e,drawOrder:[...e.instantiate.drawOrder],skillIds:[...e.skillLoadout.baseSkillIds],passiveSkillIds:[...e.skillLoadout.passiveSkillIds||[]]}),H1={Light:3,Standard:5,Heavy:8,Anchored:12,OuterWall:20},Ms=e=>({version:"1.0.0",id:e.id,name:e.name,actorType:"enemy",subtype:e.subtype,factionId:"enemy",weightClass:e.weightClass,coordSpace:{system:"cube-axial",pointFormat:"qrs"},instantiate:{rngStream:"enemy.instantiate",seedSalt:e.subtype,counterMode:"consume_global",drawOrder:["body","mind","instinct","speed","mass"],includeRollTrace:!1},propensities:{body:{method:"fixed",value:e.trinity.body},mind:{method:"fixed",value:e.trinity.mind},instinct:{method:"fixed",value:e.trinity.instinct},speed:{method:"fixed",value:e.speed},mass:{method:"fixed",value:H1[e.weightClass]}},derivedStats:{maxHp:{formula:"trinity_hp_v1"}},physics:{collisionPolicy:"crush_damage",crushModel:{baseDamage:0,impulseMultiplier:1,massDivider:1,minDamage:1}},skillLoadout:{baseSkillIds:e.baseSkills,passiveSkillIds:e.passiveSkills||[]},runtimeDefaults:{startingHp:"maxHp",temporaryArmor:0,isVisible:!0}}),P1={version:"1.0.0",id:"SHIELD_BASH_V1",name:"Shield Bash V1",description:"Data-driven migration variant of shield bash.",slot:"offensive",keywords:["Momentum"],intentTags:["damage","control","move"],targeting:{mode:"single",range:1,requiresLos:!0,allowOccupied:!0,deterministicSort:"distance_then_q_then_r"},stackPolicy:{resolveOrder:"LIFO",reactionWindow:"automated",playerPriority:!1,emitTickEvents:!0},baseAction:{costs:{energy:0,cooldown:2,consumesTurn:!0},effects:[{id:"shield_bash_v1_force",kind:"APPLY_FORCE",tags:["movement","momentum"],target:{selector:"targetActor"},force:{mode:"push",direction:"source_to_target",magnitude:{base:2,scaling:[{stat:"body",coefficient:.2}],min:1,round:"floor"},maxDistance:3,collision:{onBlocked:"crush_damage",crushDamage:{base:1,scaling:[{stat:"momentum",coefficient:1}],min:1,round:"floor"}}}},{id:"shield_bash_v1_damage",kind:"DEAL_DAMAGE",tags:["damage","physical"],target:{selector:"targetActor"},amount:{base:2,scaling:[{stat:"body",coefficient:.4}],min:1,round:"floor"},damageClass:"physical",reason:"shield_bash_v1"}]},reactivePassives:[],upgrades:[],inhibit:{filterMode:"exclude_matching_tags",removableTags:["movement","momentum"]},preview:{dryRunEnabled:!0,eventMap:{APPLY_FORCE:"UnitMoved",DEAL_DAMAGE:"DamageTaken"}}},U1={version:"1.0.0",units:[Ms({id:"ENEMY_FOOTMAN_V1",name:"Footman",subtype:"footman",weightClass:"Standard",speed:1,trinity:{body:0,mind:0,instinct:0},baseSkills:["BASIC_MOVE","BASIC_ATTACK"],passiveSkills:["AUTO_ATTACK"]}),Ms({id:"ENEMY_SPRINTER_V1",name:"Sprinter",subtype:"sprinter",weightClass:"Standard",speed:2,trinity:{body:0,mind:0,instinct:0},baseSkills:["BASIC_MOVE","BASIC_ATTACK"]}),Ms({id:"ENEMY_RAIDER_V1",name:"Raider",subtype:"raider",weightClass:"Standard",speed:1,trinity:{body:.4,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","DASH"],passiveSkills:["AUTO_ATTACK"]}),Ms({id:"ENEMY_POUNCER_V1",name:"Pouncer",subtype:"pouncer",weightClass:"Standard",speed:1,trinity:{body:.4,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],passiveSkills:["AUTO_ATTACK"]}),Ms({id:"ENEMY_SHIELDBEARER_V1",name:"Shield Bearer",subtype:"shieldBearer",weightClass:"Heavy",speed:1,trinity:{body:1,mind:0,instinct:.4},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],passiveSkills:["AUTO_ATTACK"]}),Ms({id:"ENEMY_ARCHER_V1",name:"Archer",subtype:"archer",weightClass:"Standard",speed:1,trinity:{body:.2,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SPEAR_THROW"],passiveSkills:["AUTO_ATTACK"]}),Ms({id:"ENEMY_BOMBER_V1",name:"Bomber",subtype:"bomber",weightClass:"Standard",speed:1,trinity:{body:.4,mind:.2,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","BOMB_TOSS"],passiveSkills:["AUTO_ATTACK"]}),Ms({id:"ENEMY_WARLOCK_V1",name:"Warlock",subtype:"warlock",weightClass:"Standard",speed:1,trinity:{body:.4,mind:.6,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK"],passiveSkills:["AUTO_ATTACK"]}),Ms({id:"ENEMY_SENTINEL_V1",name:"Sentinel",subtype:"sentinel",weightClass:"Heavy",speed:1,trinity:{body:4,mind:2,instinct:2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_TELEGRAPH","SENTINEL_BLAST"],passiveSkills:["AUTO_ATTACK"]})],skills:[P1]},q1=new Map,Vy=new Map,z1=e=>(q1.set(e.id,e),e.subtype&&Vy.set(e.subtype,e),e),$1=e=>e.map(z1),V1=e=>Vy.get(e);let Yy=!1;const Y1=(e=U1)=>{const i=j1(e);return $1(i.units),E1(i.skills),Yy=!0,{unitsRegistered:i.units.length,skillsRegistered:i.skills.length}},Fy=()=>Yy?{unitsRegistered:0,skillsRegistered:0}:Y1(),Ky=(e,i="none")=>i==="floor"?Math.floor(e):i==="round"?Math.round(e):i==="ceil"?Math.ceil(e):e,Gy=(e,i)=>i?Math.max(i.min,Math.min(i.max,e)):e,Ac=(e,i)=>Gy(Ky(e,i.round),i.clamp),F1=(e,i)=>{if(e.method==="fixed")return{value:Ac(e.value,e),before:-1,after:-1,usedRng:!1};if(e.method==="uniform_int"){const f=i(),h=e.max-e.min+1,b=e.min+Math.floor(f.value*h)%Math.max(1,h);return{value:Ac(b,e),before:f.before,after:f.after,usedRng:!0}}if(e.method==="triangular_int"){const f=i(),h=e.min,b=e.mode,y=e.max,A=(b-h)/Math.max(1e-9,y-h),v=f.value<A?h+Math.sqrt(f.value*(y-h)*(b-h)):y-Math.sqrt((1-f.value)*(y-h)*(y-b));return{value:Ac(v,e),before:f.before,after:f.after,usedRng:!0}}const a=i(),o=e.table.reduce((f,h)=>f+h.weight,0);let c=a.value*Math.max(1e-9,o),r=e.table[e.table.length-1].value;for(const f of e.table)if(c-=f.weight,c<=0){r=f.value;break}return{value:Ac(r,e),before:a.before,after:a.after,usedRng:!0}},Vg=(e,i,a)=>{if(e.formula==="trinity_hp_v1")return Yc(a);const o=e.base??0,r=(e.terms||[]).reduce((h,b)=>h+(i[b.stat]??0)*b.coefficient,o),f=Ky(r,e.round);return Gy(f,e.clamp)},K1=(e,i)=>!i||Object.keys(i).length===0?e:{...e,activeSkills:(e.activeSkills||[]).map(a=>{const o=i[a.id];return o===void 0?a:{...a,currentCooldown:Math.max(0,o)}})},G1=e=>e.id.toLowerCase(),W1=(e,i,a)=>{const o=i.definition,c=[];let r={rngSeed:e.rngSeed||"default",rngCounter:Math.max(0,e.rngCounter||0)},f=0;const h=`${r.rngSeed}:${o.instantiate.rngStream}:${o.instantiate.seedSalt||o.id}`,b=()=>{if(o.instantiate.counterMode==="consume_global"){const N=r.rngCounter,Y=qc(r.rngSeed,N);return r={...r,rngCounter:N+1},{value:Y,before:N,after:r.rngCounter}}const C=f;return{value:qc(h,f++),before:C,after:f}},y={};for(const C of i.drawOrder){const M=o.propensities[C];if(!M)continue;const N=F1(M,b);y[C]=N.value,N.usedRng&&c.push({key:C,method:M.method,value:N.value,counterBefore:N.before,counterAfter:N.after})}const A={body:y.body??0,mind:y.mind??0,instinct:y.instinct??0},v=o.derivedStats||{},S=v.maxHp?Vg(v.maxHp,y,A):Yc(A),_=y.speed??1,p=y.mass??1,g=o.runtimeDefaults?.startingHp==="explicit"?Math.max(0,o.runtimeDefaults.explicitHp??S):S,R=ma({id:a.actorId||G1(o),type:o.actorType,subtype:a.subtype||o.subtype,position:a.position,hp:g,maxHp:S,speed:_,factionId:a.factionId||o.factionId,weightClass:o.weightClass,skills:[...i.skillIds,...i.passiveSkillIds],trinity:A});let I=K1(R,o.skillLoadout.startCooldowns);o.runtimeDefaults?.temporaryArmor!==void 0&&(I={...I,temporaryArmor:Math.max(0,o.runtimeDefaults.temporaryArmor)}),o.runtimeDefaults?.isVisible!==void 0&&(I={...I,isVisible:o.runtimeDefaults.isVisible}),y.maxHp=S,y.speed=_,y.mass=p;for(const[C,M]of Object.entries(v))C!=="maxHp"&&(y[C]=Vg(M,y,A));return{actor:I,stats:y,trinity:A,speed:_,mass:p,nextCursor:r,rollTrace:c}},X1=(e,i,a)=>W1(e,D1(i),a),Q1=(e,i)=>{const a=Vc(i),o=Zb(Ic,Bc),c=[],r=o,f=Math.floor(Ic/2),h=Vn(f,Bc-1),b=Vn(f,0);let y;if(e%1===0){const M=r.filter(N=>!ne(N,h)&&!ne(N,b)&&Ce(N,h)>=3);M.length>0&&(y=M[Math.floor(a.next()*M.length)])}const v=Math.floor(r.length*yx),S=[],_={playerStart:h,stairsPosition:b,shrinePosition:y},g=[...r.filter(M=>!Sg(M,_))].sort(()=>a.next()-.5);for(let M=0;M<v;M++)M<g.length&&S.push(g[M]);const R=r.filter(M=>!Sg(M,{playerStart:h,stairsPosition:b,shrinePosition:y})&&!c.some(N=>ne(N,M))&&!S.some(N=>ne(N,M))&&Ce(M,h)>=3),I={id:"arena",type:"combat",center:Vn(Math.floor(Ic/2),Math.floor(Bc/2)),hexes:o,connections:[]},C=new Map;for(const M of o)C.set(`${M.q},${M.r}`,{baseId:"STONE",position:M,traits:new Set(Io.STONE.defaultTraits),effects:[]});for(const M of c)C.set(`${M.q},${M.r}`,{baseId:"WALL",position:M,traits:new Set(Io.WALL.defaultTraits),effects:[]});for(const M of S)C.set(`${M.q},${M.r}`,{baseId:"LAVA",position:M,traits:new Set(Io.LAVA.defaultTraits),effects:[]});return{rooms:[I],allHexes:o,stairsPosition:b,shrinePosition:y,spawnPositions:R,playerSpawn:h,tiles:C}},J1=(e,i,a)=>{Fy();const o=Vc(a+":enemies"),c=Eg[Math.min(e,Eg.length-1)],r=ef[e]||ef[Math.max(...Object.keys(ef).map(Number))];let f={rngSeed:`${a}:enemy-propensity`,rngCounter:0};const h=[];let b=c;const y=[];for(;b>0&&y.length<i.length;){const A=r.filter(q=>{const K=xf[q];return K&&K.cost<=b});if(A.length===0)break;const v=Math.floor(o.next()*A.length),S=A[v],_=xf[S],p=i.filter(q=>!y.some(K=>ne(K,q)));if(p.length===0)break;const g=Math.floor(o.next()*p.length),R=p[g];y.push(R);const I=Math.floor(e/5),C=_.weightClass||"Standard",M=(f.rngCounter<<8)+h.length,N=`enemy_${h.length}_${Bo(a,M,6,S)}`,Y=V1(S);let X;if(Y){const q=X1(f,Y,{actorId:N,position:R,subtype:S,factionId:"enemy"});f=q.nextCursor,X=q.actor}else X=Xx({id:N,subtype:S,position:R,speed:_.speed||50,skills:Jx(S),weightClass:C,enemyType:_.type});const O=I>0?{...X,hp:X.hp+I,maxHp:X.maxHp+I}:X;h.push({...O,subtype:S,enemyType:_.type,actionCooldown:_.actionCooldown??O.actionCooldown,isVisible:!0}),b-=_.cost}return h},Z1=e=>bx[e]||"inferno",eA=(e,i)=>{const a=i.initialSeed??i.rngSeed??"0",o=i.commandLog?.length??0;return{id:Bo(a,o,9,"cmd"),timestamp:i.turnNumber,action:e}},tA=(e,i,a)=>{const o=a.initialSeed??a.rngSeed??"0",c=a.undoStack?.length??0;return{id:Bo(o,c,9,"delta"),undoData:{player:{...e.player},enemies:[...e.enemies],turnNumber:e.turnNumber,gameStatus:e.gameStatus}}},jo={VANGUARD:{id:"VANGUARD",name:"Vanguard",description:"Direct damage, brawling, and area denial.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK","SPEAR_THROW","SHIELD_BASH","JUMP"]},SKIRMISHER:{id:"SKIRMISHER",name:"Skirmisher",description:"Zero direct damage. Kinetic momentum and environmental lethality.",startingUpgrades:[],startingSkills:["DASH","GRAPPLE_HOOK","SHIELD_THROW","VAULT"]},FIREMAGE:{id:"FIREMAGE",name:"Fire Mage",description:"Area control with fire and high-damage spells.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","ABSORB_FIRE","FIREBALL","FIREWALL","FIREWALK"]},NECROMANCER:{id:"NECROMANCER",name:"Necromancer",description:"Utilize death and reanimation.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","CORPSE_EXPLOSION","RAISE_DEAD","SOUL_SWAP"]},HUNTER:{id:"HUNTER",name:"Hunter",description:"Ranged precision and traps.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","FALCON_COMMAND","KINETIC_TRI_TRAP","WITHDRAWAL"]},ASSASSIN:{id:"ASSASSIN",name:"Assassin",description:"Stealth and high burst damage.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","SNEAK_ATTACK","SMOKE_SCREEN","SHADOW_STEP"]}},Wy=e=>{const i=e.startingSkills.map(o=>da(o)).filter(Boolean),a=e.id;return{upgrades:[...e.startingUpgrades],activeSkills:i,archetype:a}},nA=e=>e.some(i=>i.id==="BASIC_MOVE"||i.id==="DASH"),Xy=(e=[])=>{if(nA(e))return e;const i=da("BASIC_MOVE");return i?[i,...e]:e},Ef=e=>{const i=e.activeSkills||[],a=Xy(i);return a===i?e:{...e,activeSkills:a}};function iA(e){let i=e;const a=[],o=[],c=new Map(i.tiles);for(const[r,f]of c.entries()){const h=[];let b=!1;for(const v of f.effects){if(v.duration===-1){h.push(v);continue}const S=v.duration-1;S>0?(h.push({...v,duration:S}),b=!0):(a.push(`The ${v.id.toLowerCase()} died down.`),b=!0)}b&&c.set(r,{...f,effects:h});const y=[i.player,...i.enemies],A=v=>`${v.q},${v.r}`;for(const v of y)if(A(v.position)===r){const S=za.processStay(v,f,i);o.push(...S.effects),a.push(...S.messages)}}return i={...i,tiles:c},o.length>0&&(i=pi(i,o)),{state:i,messages:a}}class Yg{getFalconIntent(i,a){const o=a.companionState?.mode||"roost",c=a.companionOf===i.player.id?i.player:i.enemies.find(f=>f.id===a.companionOf),r={expectedValue:0,reasoningCode:`FALCON_${o.toUpperCase()}`,isGhost:!1,rngConsumption:0};if(o==="scout")return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_SCOUT",targetHex:a.position,priority:10,metadata:r};if(o==="predator"&&typeof a.companionState?.markTarget=="string"){const f=i.enemies.find(b=>b.id===a.companionState.markTarget&&b.hp>0);if(!f)return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_AUTO_ROOST",targetHex:a.position,priority:9,metadata:{...r,reasoningCode:"FALCON_AUTO_ROOST"}};const h=Ce(a.position,f.position);return h<=4?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_APEX_STRIKE",targetHex:f.position,primaryTargetId:f.id,priority:10,metadata:r}:h<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_PECK",targetHex:f.position,primaryTargetId:f.id,priority:9,metadata:r}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,a,f.position),primaryTargetId:f.id,priority:7,metadata:r}}return c?Ce(a.position,c.position)<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_HEAL",targetHex:c.position,primaryTargetId:c.id,priority:10,metadata:r}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,a,c.position),primaryTargetId:c.id,priority:7,metadata:r}:{type:"WAIT",actorId:a.id,skillId:"WAIT_SKILL",priority:1,metadata:{...r,reasoningCode:"FALCON_WAIT"}}}findStepToward(i,a,o){const c=ot(a.position).filter(r=>nt.isWithinBounds(i,r)).filter(r=>ze.isWalkable(i,r)).filter(r=>{const f=Ee(i,r);return!f||f.id===a.id});return c.length===0?a.position:c.sort((r,f)=>Ce(r,o)-Ce(f,o))[0]}getIntent(i,a){if(a.subtype==="falcon")return this.getFalconIntent(i,a);if(a.subtype==="bomb")return{type:"USE_SKILL",actorId:a.id,skillId:"TIME_BOMB",targetHex:a.position,priority:10,metadata:{expectedValue:0,reasoningCode:"BOMB_FUSE_TICK",isGhost:!1,rngConsumption:0}};const o=i.player.position,c=hx(a,o,{...i,occupiedCurrentTurn:i.occupiedCurrentTurn}),{entity:r,message:f}=c;let h="WAIT",b="WAIT_SKILL",y,A,v=10;const S=r.intent||"Waiting";if(S==="Moving"||S==="Advancing"||S==="Repositioning"||S==="Lumbering")h="MOVE",b="BASIC_MOVE",y=r.position;else if(S==="BASIC_ATTACK"){if(h="ATTACK",b="BASIC_ATTACK",y=r.intentPosition,y){const p=i.player.position.q===y.q&&i.player.position.r===y.r?i.player:i.enemies.find(g=>g.position.q===y?.q&&g.position.r===y?.r);p&&p.factionId!==a.factionId&&(A=p.id)}}else S==="SPEAR_THROW"?(h="USE_SKILL",b="SPEAR_THROW",y=r.intentPosition):S==="DASH"?(h="USE_SKILL",b="DASH",y=r.intentPosition):S==="GRAPPLE_HOOK"?(h="USE_SKILL",b="GRAPPLE_HOOK",y=r.intentPosition):S==="Bombing"?(h="USE_SKILL",b="BOMB_TOSS",y=r.intentPosition):S==="SENTINEL_BLAST"?(h="USE_SKILL",b="SENTINEL_BLAST",y=r.intentPosition):S==="SENTINEL_TELEGRAPH"?(h="USE_SKILL",b="SENTINEL_TELEGRAPH",y=r.intentPosition):(S==="Charging Power"||S==="Preparing")&&(h="WAIT",b="WAIT_SKILL");if(!(b==="WAIT_SKILL"||a.activeSkills?.some(p=>p.id===b)))h="WAIT",b="WAIT_SKILL",y=void 0,A=void 0;else if(b!=="WAIT_SKILL"){const p=Rn.get(b);p?.getValidTargets&&y&&(p.getValidTargets(i,a.position).some(I=>ne(I,y))||(h="WAIT",b="WAIT_SKILL",y=void 0,A=void 0))}return{type:h,actorId:a.id,skillId:b,primaryTargetId:A,targetHex:y,priority:v,metadata:{expectedValue:0,reasoningCode:S.toUpperCase().replace(" ","_"),isGhost:!1,rngConsumption:(f?.includes("teleports")||f?.includes("Bombing"),(c.nextState.rngCounter||0)-(i.rngCounter||0))}}}}class Zl{inputQueue=[];resolveInput;pushIntent(i){this.inputQueue.push(i),this.resolveInput&&(this.resolveInput(i),this.resolveInput=void 0)}getIntent(i,a){return this.inputQueue.length>0?this.inputQueue.shift():new Promise(o=>{this.resolveInput=o})}}class er{static strategies=new Map;static defaultEnemyStrategy=new Yg;static defaultPlayerStrategy=new Zl;static register(i,a){this.strategies.set(i,a)}static resolve(i){return this.strategies.has(i.id)?this.strategies.get(i.id):i.type==="player"?this.defaultPlayerStrategy:this.defaultEnemyStrategy}static reset(){this.strategies.clear(),this.defaultEnemyStrategy=new Yg,this.defaultPlayerStrategy=new Zl}}const Qy=(e,i,a)=>Ns(a)?{...e,type:"WAIT",skillId:"WAIT_SKILL",priority:0,metadata:{...e.metadata,reasoningCode:"STATUS_STUNNED"}}:e;class Jy{static execute(i,a,o){return this.resolveExecution(i,a,o)}static simulate(i,a,o){return this.resolveExecution(i,a,o)}static resolveExecution(i,a,o){const c=[],r=[],f=Rn.get(i.skillId);if(!f&&i.type!=="WAIT")return{effects:[],messages:[`Failed to execute unknown skill: ${i.skillId}`],consumesTurn:!1};if(i.type==="WAIT")return{effects:[],messages:[],consumesTurn:!0};if(!(i.skillId==="WAIT_SKILL"||a.activeSkills.some(p=>p.id===i.skillId)))return{effects:[],messages:[`Actor ${a.id} does not have skill ${i.skillId} in loadout!`],consumesTurn:!1};const b=a.activeSkills.find(p=>p.id===i.skillId);if(b&&(b.currentCooldown||0)>0)return{effects:[],messages:[`${i.skillId} is on cooldown (${b.currentCooldown}).`],consumesTurn:a.type!=="player"};let y=i.targetHex,A=i.primaryTargetId;if(!y&&f&&(y=this.findOptimalTargetHex(i,a,o,f.baseVariables.range)),!y)return{effects:[],messages:[`No valid target found for ${i.skillId}`],consumesTurn:!1};if(y&&!A){const p=Ee(o,y);p&&(A=p.id)}const v=b?.activeUpgrades||[],S=f.execute(o,a,y,v),_=[...c,...S.effects];if(S.consumesTurn!==!1){let g=f.baseVariables.cooldown||0;for(const R of v){const I=f.upgrades?.[R];typeof I?.modifyCooldown=="number"&&(g+=I.modifyCooldown)}g=Math.max(0,g),g>0&&_.push({type:"ModifyCooldown",skillId:i.skillId,amount:g+1,setExact:!0})}return{effects:_,messages:[...r,...S.messages],consumesTurn:S.consumesTurn??!0,targetId:A,kills:S.kills||0}}static findOptimalTargetHex(i,a,o,c){if(i.primaryTargetId){const r=o.enemies.find(f=>f.id===i.primaryTargetId)||(o.player.id===i.primaryTargetId?o.player:void 0);if(r&&(i.type==="ATTACK"||i.type==="USE_SKILL"))return r.position}}}const wf=(e,i)=>e.q!==i.q?e.q-i.q:e.r!==i.r?e.r-i.r:e.s-i.s,Dc=(e,i)=>e.player.id===i?e.player:e.enemies.find(a=>a.id===i)||e.companions?.find(a=>a.id===i),sA=(e,i)=>{if(i.primaryTargetId)return Dc(e,i.primaryTargetId);if(i.targetHex)return Ee(e,i.targetHex)},aA=(e,i,a)=>{const o=new Map,c=sA(e,i),r=f=>{f&&o.set(he(f),f)};return a.forEach(f=>{f.type==="Damage"?typeof f.target=="string"&&f.target!=="targetActor"&&f.target!=="area"?r(Dc(e,f.target)?.position):f.target==="targetActor"?r(c?.position):f.target==="area"?r(f.source):typeof f.target=="object"&&"q"in f.target&&r(f.target):f.type==="Impact"||f.type==="LavaSink"?r(Dc(e,f.target)?.position):f.type==="Displacement"&&r(f.destination)}),[...o.values()].sort(wf)},Fg=e=>{const i=[];e.enemies.filter(c=>c.hp>0&&c.factionId!==e.player.factionId).forEach(c=>{const f=er.resolve(c).getIntent(e,c);if(f instanceof Promise)return;const h=Qy(f,e,c);let b=h;h.skillId==="SENTINEL_TELEGRAPH"&&(b={...h,skillId:"SENTINEL_BLAST"});const y=Jy.simulate(b,c,e),A=aA(e,b,y.effects);A.length!==0&&i.push({actorId:c.id,skillId:h.skillId,targetHex:h.targetHex,dangerTiles:A})}),i.sort((c,r)=>c.actorId!==r.actorId?c.actorId.localeCompare(r.actorId):c.skillId!==r.skillId?c.skillId.localeCompare(r.skillId):!c.targetHex&&!r.targetHex?0:c.targetHex?r.targetHex?wf(c.targetHex,r.targetHex):1:-1);const o=new Map;return i.forEach(c=>c.dangerTiles.forEach(r=>o.set(he(r),r))),{sourceTurn:e.turnNumber,dangerTiles:[...o.values()].sort(wf),projections:i}};var Zy={};const _f=typeof process<"u"&&Zy?.HOP_ENGINE_DEBUG==="1",e0=typeof process<"u"&&Zy?.HOP_ENGINE_WARN==="1",oA=_f||e0,t0=(e,i)=>{if(oA){if(i){console.warn(`[TURN_STACK] ${e}`,i);return}console.warn(`[TURN_STACK] ${e}`)}},lA=(e,i,a,o)=>{const c=(e.pendingFrames?.length??0)+1;return{id:`${e.turnNumber}:${a}:${i}:${c}`,type:i,status:a,createdTurn:e.turnNumber,blocking:!0,payload:o}},$l=(e,i,a,o)=>{const c=lA(e,a,i.status,o);return{...e,pendingStatus:i,pendingFrames:[...e.pendingFrames||[],c]}},Mf=()=>{const e=Cs();return{...e,gameStatus:"hub",message:[Pt([],"Welcome to the Strategic Hub. Select your loadout.","INFO","SYSTEM")[0]],player:{...e.player,activeSkills:[]},hasSpear:!1,hasShield:!1}},Cs=(e=1,i,a,o,c)=>{Fy();const r=i||String(Date.now()),f=Z1(e),h=Q1(e,r),b=J1(e,h.spawnPositions||[],r),y=o?{hp:o.hp,maxHp:o.maxHp,speed:o.speed||Tg.speed}:{speed:Tg.speed},A=o?.upgrades||(c?c.startingUpgrades:[]),v=c?Wy(c):{activeSkills:_1(),archetype:"VANGUARD"},S=Xy(o?.activeSkills||v.activeSkills),_=o?.archetype||v.archetype,p=h.tiles||new Map,R={turnNumber:1,player:{...ma({id:"player",type:"player",position:h.playerSpawn,hp:y.hp,maxHp:y.maxHp,speed:y.speed,factionId:"player",activeSkills:S,archetype:_,weightClass:"Standard",components:new Map}),previousPosition:h.playerSpawn},enemies:b.map(I=>({...I,previousPosition:I.position,statusEffects:I.statusEffects||[],temporaryArmor:I.temporaryArmor||0})),gridWidth:Ic,gridHeight:Bc,gameStatus:"playing",message:e===1?[Pt([],"Welcome to the arena. Survive.","INFO","SYSTEM")[0]]:Pt(o?.message||[],`Floor ${e} - ${f.charAt(0).toUpperCase()+f.slice(1)}. Be careful.`,"INFO","OBJECTIVE"),hasSpear:!0,stairsPosition:h.stairsPosition,occupancyMask:[0n],shrinePosition:h.shrinePosition,shrineOptions:void 0,hasShield:!0,floor:e,upgrades:A,rooms:h.rooms,theme:f,commandLog:[],undoStack:[],rngSeed:r,initialSeed:a??(e===1?r:void 0),rngCounter:0,actionLog:[],kills:o&&o.kills||0,environmentalKills:o&&o.environmentalKills||0,turnsSpent:o&&o.turnsSpent||0,dailyRunDate:o?.dailyRunDate,runObjectives:o?.runObjectives||[],hazardBreaches:o?.hazardBreaches||0,completedRun:void 0,combatScoreEvents:o?.combatScoreEvents||[],dyingEntities:[],visualEvents:[],timelineEvents:[],intentPreview:void 0,initiativeQueue:void 0,tiles:p};return R.initiativeQueue=Ka(R),R.occupancyMask=nt.refreshOccupancyMask(R),R},Kg=(e,i,a,o)=>{const c=i==="player"?e.player:e.enemies.find(b=>b.id===i);if(!c)return{state:e,messages:[]};const r=[],f=[];return c.statusEffects.forEach(b=>{if(b.tickWindow===a&&b.onTick){const y=b.onTick(c,e);y&&r.push(...y)}}),{state:pi(e,r,{sourceId:i,stepId:o}),messages:f}},Tc=(e,i=!1)=>{if(e.pendingStatus||(e.pendingFrames?.length??0)>0)return t0("Blocked processNextTurn while pendingStatus is active.",{status:e.pendingStatus?.status,pendingFrames:e.pendingFrames?.length??0,turnNumber:e.turnNumber}),e;let a=e;const o=[],c=[];let r=0;const f=100;let h=!1;for(;r<f;){if(r++,a.player.hp<=0&&a.pendingStatus?.status!=="lost"){const oe=Ql(a);return $l({...a,message:Pt(a.message,"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:oe},"RUN_LOST",{reason:"GLOBAL_DEATH_CHECK"})}a.occupancyMask=nt.refreshOccupancyMask(a);let y;if((i&&r===1||h)&&a.initiativeQueue){h=!1;const oe=a.initiativeQueue;oe.entries.length>0&&oe.currentIndex>=0&&oe.currentIndex<oe.entries.length&&(y=oe.entries[oe.currentIndex].actorId)}else{const oe=Lx(a);a={...a,initiativeQueue:oe.queue},y=oe.actorId??void 0}if(!y)break;const A=y==="player"?a.player:a.enemies.find(oe=>oe.id===y),v=`${a.turnNumber}:${a.initiativeQueue?.round??0}:${y}:${r}`;if(!A||A.hp<=0){a={...a,initiativeQueue:nf(a.initiativeQueue,y)};continue}if(kx(a.initiativeQueue)?.turnStartPosition||(a={...a,initiativeQueue:Ix(a,A)}),!i||r>1){const oe=Kg(a,y,"START_OF_TURN",v);if(a=oe.state,o.push(...oe.messages),y==="player"&&a.upgrades?.includes("RELIC_STEADY_PLATES")){const pe=Math.min(2,(a.player.temporaryArmor||0)+1);pe!==(a.player.temporaryArmor||0)&&(a={...a,player:{...a.player,temporaryArmor:pe}},o.push(Pt([],"Steady Plates harden your stance.","INFO","COMBAT")[0]))}if(y==="player"){const pe=a.player.activeSkills?.find(ee=>ee.id==="SHIELD_BASH");if(!!pe?.activeUpgrades?.includes("PASSIVE_PROTECTION")&&(pe?.currentCooldown||0)===0){const ee=Math.max(a.player.temporaryArmor||0,1);ee!==(a.player.temporaryArmor||0)&&(a={...a,player:{...a.player,temporaryArmor:ee}},o.push(Pt([],"Passive Protection braces your guard.","INFO","COMBAT")[0]))}}const be=N1(a,a.player.position,y,v);a=be.state,o.push(...be.messages)}const _=y==="player"?a.player:a.enemies.find(oe=>oe.id===y);if(!_||_.hp<=0){a={...a,initiativeQueue:nf(a.initiativeQueue,y),message:ss(a.message,o,"INFO","SYSTEM")};continue}const p=y==="player"?a.player:a.enemies.find(oe=>oe.id===y);if(!p||p.hp<=0)continue;let g,R=!1;if(Ns(p))R=!0,g={type:"WAIT",actorId:p.id,skillId:"WAIT_SKILL",priority:0,metadata:{expectedValue:0,reasoningCode:"STATUS_STUNNED_AUTOSKIP",isGhost:!1}},y==="player"?o.push("You are stunned and skip your turn."):o.push(`${p.subtype||"Enemy"} is stunned and skips its turn.`);else{const be=er.resolve(p).getIntent(a,p);if(be instanceof Promise){const pe=Fg(a);return{...a,intentPreview:pe,message:ss(a.message,o,"INFO","SYSTEM"),dyingEntities:[...a.dyingEntities||[],...c]}}g=be}const I=_.activeSkills.map(oe=>oe.id).join(", ");_f&&(console.log(`[ENGINE] Actor: ${y} | Loadout: [${I}] | Pos: ${JSON.stringify(_.position)}`),console.log(`[ENGINE] Intent: ${g.type} | Skill: ${g.skillId} | TargetHex: ${g.targetHex?JSON.stringify(g.targetHex):"none"} | TargetId: ${g.primaryTargetId||"none"}`)),g.metadata.rngConsumption&&(a={...a,rngCounter:(a.rngCounter||0)+g.metadata.rngConsumption}),g=Qy(g,a,p);const{effects:C,messages:M,consumesTurn:N,targetId:Y,kills:X}=Jy.execute(g,p,a);if(_f&&console.log(`[ENGINE] ${y} intends ${g.type} (${g.skillId}) onto ${Y||(g.targetHex?JSON.stringify(g.targetHex):"self")}`),e0&&C.length===0&&g.type!=="WAIT"){const oe=`[ENGINE] WARNING: Intent ${g.type} (${g.skillId}) for actor ${y} produced ZERO effects!`;console.warn(oe)}const O=a,q=pi(a,C,{sourceId:y,targetId:Y,stepId:v});if(y==="player"&&(q.kills=(q.kills||0)+(X||0)),N===!1){a={...O,message:ss(a.message,M,"INFO","COMBAT")},h=!0;continue}if(a=q,o.push(...M),y!=="player"){const oe=a.enemies.find(be=>be.id===y);if(oe?.subtype==="bomber"){const be=g.skillId==="BOMB_TOSS"?2:Math.max(0,(oe.actionCooldown??0)-1);oe.actionCooldown!==be&&(a={...a,enemies:a.enemies.map(pe=>pe.id===y?{...pe,actionCooldown:be}:pe)})}}const K=y==="player"?a.player:a.enemies.find(oe=>oe.id===y);if(!K||K.hp<=0){if(y==="player"){const oe=Ql(a);return $l({...a,message:Pt(ss(a.message,o,"INFO","SYSTEM"),"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:oe},"RUN_LOST",{reason:"SELF_ACTION_DEATH"})}a={...a,enemies:a.enemies.filter(oe=>oe.id!==y),initiativeQueue:nf(a.initiativeQueue,y),message:ss(a.message,o,"INFO","SYSTEM")};continue}const ue=Kg(a,y,"END_OF_TURN",v);a=ue.state,o.push(...ue.messages),a={...a,enemies:a.enemies.map(oe=>oe.id===y?wg(vg(oe)):oe),player:y==="player"?wg(vg(a.player)):a.player,initiativeQueue:Bx(a,y)};const G=y==="player"?a.player:a.enemies.find(oe=>oe.id===y);if(!(R||g.metadata?.reasoningCode==="STATUS_STUNNED"||g.metadata?.reasoningCode==="STATUS_STUNNED_AUTOSKIP")&&G&&G.hp>0){const oe=jx(a,y)||G.previousPosition||G.position,be=Dx(a,y)??void 0,pe=Zv(a,G,ot(oe),oe,be,v);a=pe.state,o.push(...pe.messages),y==="player"&&(a.kills=(a.kills||0)+pe.kills)}if(y==="player"){const oe=a.player.position;if(a.spearPosition&&ne(oe,a.spearPosition)){if(!!a.player.activeSkills?.find(ee=>ee.id==="SPEAR_THROW")?.activeUpgrades?.some(ee=>ee==="SPEAR_CLEAVE"||ee==="CLEAVE")){const ee=ot(oe).map(ae=>a.enemies.find(Te=>Te.hp>0&&ne(Te.position,ae))).filter(ae=>!!ae&&ae.factionId!==a.player.factionId);if(ee.length>0){const ae=ee.map(Te=>({type:"Damage",target:Te.id,amount:1,reason:"spear_cleave_pickup"}));a=pi(a,ae,{sourceId:a.player.id,stepId:v}),o.push(`Spear cleave hit ${ee.length} target(s).`)}}a={...a,hasSpear:!0,spearPosition:void 0,message:Pt(a.message,"Picked up your spear.","INFO","OBJECTIVE")}}const be=iA(a);if(a=be.state,o.push(...be.messages),a={...a,turnNumber:a.turnNumber+1,turnsSpent:(a.turnsSpent||0)+1},a.traps&&a.traps.length>0&&(a={...a,traps:a.traps.map(pe=>({...pe,cooldown:Math.max(0,pe.cooldown-1)}))}),sx(a,a.player.position)){const pe=a.player.activeSkills||[],H=new Set(pe.map($=>$.id)),ee=new Map;for(const $ of pe)ee.set($.id,new Set($.activeUpgrades||[]));const ae=Rn.getAllUpgrades().filter($=>H.has($.skillId)).filter($=>{if(a.upgrades.includes($.id))return!1;const J=ee.get($.skillId);return!J||!J.has($.id)}).map($=>$.id).filter(($,J,me)=>me.indexOf($)===J),Te=[];let xe={...a};for(let $=0;$<3&&ae.length>0;$++){const J=Va(xe);xe=J.nextState;const me=Math.floor(J.value*ae.length);Te.push(ae[me]),ae.splice(me,1)}const k=Te.length>0?Te:["EXTRA_HP"];return $l({...a,rngCounter:xe.rngCounter,message:Pt(a.message,"A holy shrine! Choose an upgrade.","INFO","OBJECTIVE")},{status:"choosing_upgrade",shrineOptions:k},"SHRINE_CHOICE",{shrineOptions:k})}if(ax(a,a.player.position)){if(a.floor>=10){const H=Ql(a);return $l({...a,message:Pt(a.message,`Arcade Cleared! Final Score: ${H.score}`,"INFO","OBJECTIVE")},{status:"won",completedRun:H},"RUN_WON",{score:H.score??0})}return $l({...a,message:Pt(a.message,"Descending to the next level...","INFO","OBJECTIVE")},{status:"playing"},"STAIRS_TRANSITION",{nextFloor:a.floor+1})}}}const b=Fg(a);return{...a,intentPreview:b,message:ss(a.message,o,"INFO","SYSTEM"),dyingEntities:[...a.dyingEntities||[],...c]}},rA=(e,i)=>{const a=Ef(e.player),o=a===e.player?e:{...e,player:a};if(o.gameStatus!=="playing"&&i.type!=="RESET"&&i.type!=="SELECT_UPGRADE"&&i.type!=="LOAD_STATE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN"&&i.type!=="EXIT_TO_HUB")return o;const c={...o,isShaking:!1,lastSpearPath:void 0,dyingEntities:[],occupiedCurrentTurn:void 0,visualEvents:[],timelineEvents:[]};switch(i.type){case"LOAD_STATE":{const v=i.payload;return Array.isArray(v.tiles)&&(v.tiles=new Map(v.tiles.map(([S,_])=>[S,{..._,traits:new Set(_.traits)}]))),v.player=Ef(Xl(v.player)),v.enemies=(v.enemies||[]).map(Xl),v.companions&&(v.companions=v.companions.map(Xl)),v}case"RESET":{const S=e.player.archetype==="SKIRMISHER"?"SKIRMISHER":"VANGUARD",_=jo[S];return Cs(1,i.payload?.seed||String(Date.now()),void 0,void 0,_)}case"EXIT_TO_HUB":return Mf()}if(o.gameStatus!=="playing"&&i.type!=="SELECT_UPGRADE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN")return o;const r=eA(i,o),f=o;let h={...c,initiativeQueue:c.initiativeQueue};const y=((v,S)=>{if(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP"].includes(S.type)&&!Gl(v))return v;switch(S.type){case"SELECT_UPGRADE":{if(!("payload"in S))return v;const p=S.payload;if(!(v.pendingStatus?.shrineOptions||v.shrineOptions||[]).includes(p))return{...v,message:Pt(v.message,`Upgrade ${p} was not offered.`,"CRITICAL","SYSTEM")};let R=v.player,I=!1;const C=Rn.getUpgrade(p);if(C){const M=Rn.getSkillForUpgrade(p),N=!!M&&R.activeSkills.some(Y=>Y.id===M);if(M&&N){const Y=JSON.stringify(R.activeSkills);R=Ax(R,M,p),I=JSON.stringify(R.activeSkills)!==Y}}else p==="EXTRA_HP"&&(R=vx(R,1,!0),I=!0);return!I&&p!=="EXTRA_HP"?{...v,message:Pt(v.message,`Upgrade ${p} could not be applied.`,"CRITICAL","SYSTEM")}:{...v,player:R,upgrades:v.upgrades.includes(p)?v.upgrades:[...v.upgrades,p],gameStatus:"playing",shrinePosition:void 0,shrineOptions:void 0,pendingStatus:void 0,pendingFrames:void 0,message:Pt(v.message,`Gained ${C?.name||p}!`,"INFO","OBJECTIVE")}}case"USE_SKILL":{const{skillId:p,target:g}=S.payload,R=er.resolve(v.player);return R instanceof Zl&&R.pushIntent({type:"USE_SKILL",actorId:v.player.id,skillId:p,targetHex:g,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),Tc(v,!0)}case"MOVE":{if(!("payload"in S))return v;const p=S.payload,g=v.player.activeSkills||[],R=zi(v.enemies,p),I=["BASIC_ATTACK","BASIC_MOVE","DASH"],C=g.filter(q=>q.slot==="passive"),M=[...C.filter(q=>I.includes(q.id)),...C.filter(q=>!I.includes(q.id))];let N;for(const q of M){const K=Rn.get(q.id);if(!K?.getValidTargets)continue;if(K.getValidTargets(v,v.player.position).some(G=>ne(G,p))){N=q.id;break}}if(!N){const q=g.some(ue=>ue.id==="BASIC_ATTACK"),K=g.some(ue=>ue.id==="BASIC_MOVE");if(R&&q)N="BASIC_ATTACK";else if(!R&&K)N="BASIC_MOVE";else return{...v,message:Pt(v.message,R?"No valid passive attack for target.":"No valid passive movement for target.","CRITICAL","SYSTEM")}}const Y=R?"ATTACK":"MOVE",X=N,O=er.resolve(v.player);return O instanceof Zl&&O.pushIntent({type:Y,actorId:v.player.id,skillId:X,targetHex:p,primaryTargetId:R?.id,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),Tc(v,!0)}case"WAIT":{const p=er.resolve(v.player);return p instanceof Zl&&p.pushIntent({type:"WAIT",actorId:v.player.id,skillId:"WAIT",priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),Tc(v,!0)}case"APPLY_LOADOUT":{if(!("payload"in S))return v;const p=S.payload,g=Wy(p);return{...v,player:{...v.player,activeSkills:g.activeSkills,archetype:g.archetype},upgrades:g.upgrades,hasSpear:p.startingSkills.includes("SPEAR_THROW"),hasShield:p.startingSkills.includes("SHIELD_THROW")||v.hasShield,selectedLoadoutId:p.id,message:Pt(v.message,`${p.name} selected.`,"INFO","SYSTEM")}}case"START_RUN":{const{loadoutId:p,seed:g,mode:R,date:I}=S.payload,C=jo[p];if(!C)return v;if(R==="daily"){const M=Vv(I),N=Yv(M);return{...Cs(1,g||N,void 0,void 0,C),dailyRunDate:M,runObjectives:Fv(N),hazardBreaches:0}}return Cs(1,g,void 0,void 0,C)}case"ADVANCE_TURN":return v.pendingStatus||(v.pendingFrames?.length??0)>0?(t0("Ignored ADVANCE_TURN while pendingStatus is active.",{status:v.pendingStatus?.status,pendingFrames:v.pendingFrames?.length??0,turnNumber:v.turnNumber}),v):Tc(v,!1);case"RESOLVE_PENDING":{const p=v.pendingFrames||[];if(p.length>1)return{...v,pendingFrames:p.slice(1)};if(!v.pendingStatus)return p.length===1?{...v,pendingFrames:[]}:v;const{status:g,shrineOptions:R,completedRun:I}=v.pendingStatus;if(g==="playing"&&v.gameStatus==="playing"){const C=v.initialSeed??v.rngSeed??"0",M=`${C}:${v.floor+1}`,N=v.enemies.filter(X=>X.hp>0&&X.factionId==="player"&&X.companionOf===v.player.id).sort((X,O)=>X.id.localeCompare(O.id)),Y=Cs(v.floor+1,M,C,{...v.player,hp:Math.min(v.player.maxHp,v.player.hp+1),upgrades:v.upgrades});if(N.length>0){const X=[Y.player.position,...ot(Y.player.position)],O=[Y.player,...Y.enemies],q=[];for(let K=0;K<N.length;K++){const ue=N[K],G=X[X.length-1]||Y.player.position,_e=X.find(be=>!O.some(H=>ne(H.position,be))&&ze.isWalkable(Y,be))||G,oe={...ue,position:_e,previousPosition:_e};O.push(oe),q.push(oe)}Y.enemies=[...Y.enemies,...q],Y.companions=[...Y.companions||[],...q.filter(K=>K.companionOf===v.player.id)],Y.initiativeQueue=Ka(Y),Y.occupancyMask=nt.refreshOccupancyMask(Y)}return{...Y,actionLog:[...v.actionLog||[]],dailyRunDate:v.dailyRunDate,runObjectives:v.runObjectives,hazardBreaches:v.hazardBreaches||0,pendingFrames:void 0}}return{...v,gameStatus:g,shrineOptions:R||v.shrineOptions,completedRun:I||v.completedRun,pendingStatus:void 0,pendingFrames:void 0}}case"EXIT_TO_HUB":return Mf();default:return v}})(h,i),A=tA(f,y,e);return r.delta=A,{...y,commandLog:[...y.commandLog||[],r],undoStack:[...y.undoStack||[],A],actionLog:[...y.actionLog||[],i]}},Ec={weightsByIntent:{offense:{survival:2.1,lethality:6.5,position:2.4,objective:.5,status:2.5,tempo:1.6,resource:1},defense:{survival:4.8,lethality:3.6,position:3,objective:.8,status:2.2,tempo:1.6,resource:1},positioning:{survival:2.3,lethality:3.8,position:3.1,objective:6,status:1.4,tempo:1.6,resource:1},control:{survival:2.3,lethality:4.2,position:2.8,objective:.6,status:3.4,tempo:1.6,resource:1}},thresholds:{defenseHpRatio:.45,defensePressureHpRatio:.65,defensePressureAdjacentHostiles:2,controlMinHostiles:3}};({...Ec.weightsByIntent,offense:{...Ec.weightsByIntent.offense},control:{...Ec.weightsByIntent.control}},{...Ec.thresholds});const Gg={skill:{staticWeight:.5,powerCoeff:1,reachCoeff:1,safetyCoeff:1,tempoCoeff:1,complexityCoeff:1,perSkillScalar:{}},policy:{offenseWeight:1,defenseWeight:1,positioningWeight:1,statusWeight:1,riskPenaltyWeight:1}};({...Gg.policy},{...Gg.skill});const cA=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP","ADVANCE_TURN","SELECT_UPGRADE","RESOLVE_PENDING"]),uA=e=>typeof e=="object"&&e!==null,Wg=e=>{if(!Array.isArray(e))return{valid:!1,actions:[],errors:["Replay actions must be an array."]};const i=[],a=[];return e.forEach((o,c)=>{if(!uA(o)||typeof o.type!="string"){a.push(`Action[${c}] is not a valid action object with a "type" field.`);return}if(!cA.has(o.type)){a.push(`Action[${c}] type "${o.type}" is not replayable.`);return}i.push(o)}),{valid:a.length===0,actions:i,errors:a}},$a=e=>({q:e.q,r:e.r,s:e.s}),wc=e=>({...e,position:$a(e.position),previousPosition:e.previousPosition?$a(e.previousPosition):void 0,intentPosition:e.intentPosition?$a(e.intentPosition):void 0,statusEffects:e.statusEffects.map(i=>({...i})),activeSkills:e.activeSkills.map(i=>({...i,upgrades:[...i.upgrades||[]],activeUpgrades:[...i.activeUpgrades||[]]})),components:e.components?new Map(e.components):void 0,companionState:e.companionState?{...e.companionState,markTarget:typeof e.companionState.markTarget=="object"&&e.companionState.markTarget?$a(e.companionState.markTarget):e.companionState.markTarget}:void 0}),dA=e=>({...e,player:wc(e.player),enemies:e.enemies.map(wc),companions:e.companions?.map(wc),dyingEntities:e.dyingEntities?.map(wc),message:[...e.message],visualEvents:[...e.visualEvents||[]],simulationEvents:[...e.simulationEvents||[]],stackTrace:e.stackTrace?e.stackTrace.map(i=>({...i})):void 0,timelineEvents:e.timelineEvents?e.timelineEvents.map(i=>({...i})):void 0,occupancyMask:[...e.occupancyMask],tiles:new Map(Array.from(e.tiles.entries()).map(([i,a])=>[i,{...a,position:$a(a.position),traits:new Set(a.traits),effects:a.effects.map(o=>({...o}))}])),traps:e.traps?.map(i=>({...i,position:$a(i.position)})),lastSpearPath:e.lastSpearPath?.map($a),actionLog:e.actionLog?[...e.actionLog]:void 0}),Xg=(e,i)=>e.player.id===i?e.player:e.enemies.find(a=>a.id===i)||e.companions?.find(a=>a.id===i),fA=(e,i)=>{if(i)return Ee(e,i)?.id},mA=(e,i)=>{const a=Xg(e,i.actorId);if(!a)return{ok:!1,reason:`Actor ${i.actorId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const o=Rn.get(i.skillId);if(!o)return{ok:!1,reason:`Skill ${i.skillId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};if(i.target&&o.getValidTargets&&!o.getValidTargets(e,a.position).some(S=>he(S)===he(i.target)))return{ok:!1,reason:`Target ${he(i.target)} is invalid`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const c=dA(e),r=Xg(c,i.actorId),f=o.execute(c,r,i.target,i.activeUpgrades||[],i.context||{}),h=c.simulationEvents?.length||0,b=c.stackTrace?.length||0,y=fA(c,i.target),A=pi(c,f.effects,{sourceId:r.id,targetId:y});return{ok:!0,effects:f.effects,messages:f.messages,consumesTurn:f.consumesTurn,predictedState:A,simulationEvents:(A.simulationEvents||[]).slice(h),stackTrace:(A.stackTrace||[]).slice(b)}},pA=e=>({q:e.q,r:e.r,s:e.s}),hA=e=>{const i=[e.player,...e.enemies,...e.companions||[],...e.dyingEntities||[]];return{turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:i.map(a=>({id:a.id,position:pA(a.position)}))}},gA=(e,i)=>{const a=[],o=new Map(e.actors.map(r=>[r.id,r.position])),c=new Map(i.actors.map(r=>[r.id,r.position]));for(const[r,f]of o.entries()){const h=c.get(r);if(!h){a.push({actorId:r,expected:f,reason:"missing_in_ui"});continue}he(f)!==he(h)&&a.push({actorId:r,expected:f,actual:h,reason:"position_mismatch"})}for(const[r,f]of c.entries())o.has(r)||a.push({actorId:r,actual:f,reason:"missing_in_engine"});return{ok:a.length===0,mismatches:a}},Vl={player:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},vanguard:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},skirmisher:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#fbbf24",isRanged:!1},firemage:{icon:"",shape:"square",color:"#ef4444",borderColor:"#fbbf24",isRanged:!0},necromancer:{icon:"",shape:"square",color:"#6b21a8",borderColor:"#9333ea",isRanged:!0},hunter:{icon:"",shape:"square",color:"#10b981",borderColor:"#ffffff",isRanged:!0},assassin_player:{icon:"",shape:"square",color:"#1f2937",borderColor:"#ffffff",isRanged:!1},footman:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1},sprinter:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1,size:.9},spear:{icon:"",shape:"circle",color:"#ffffff",borderColor:"#3b82f6",isRanged:!1,size:.8,opacity:.9},shieldBearer:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#fbbf24",isRanged:!1,showFacing:!0},golem:{icon:"",shape:"diamond",color:"#78716c",borderColor:"#ffffff",isRanged:!1,size:1.2},assassin:{icon:"",shape:"diamond",color:"#6b21a8",borderColor:"#ffffff",isRanged:!1},archer:{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},bomber:{icon:"",shape:"circle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},warlock:{icon:"",shape:"triangle",color:"#9333ea",borderColor:"#ffffff",isRanged:!0},bomb:{icon:"",shape:"circle",color:"#1f2937",borderColor:"#000000",isRanged:!1,showTimer:!0},falcon:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},skeleton:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},sentinel:{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!0,size:1.5}};function ir(e,i,a,o){if(e&&Vl[e])return Vl[e];if(i==="player"&&o){const c=o==="ASSASSIN"?"assassin_player":o.toLowerCase();if(Vl[c])return Vl[c]}return i==="player"?Vl.player:a==="ranged"?{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0}:a==="boss"?{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!1,size:1.5}:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1}}function yA(e){return e.isFlying===!0}const df=e=>{const i=[];for(let a=0;a<6;a++){const o=60*a,c=Math.PI/180*o,r=e*Math.cos(c),f=e*Math.sin(c);i.push(`${r},${f}`)}return i.join(" ")},bA=()=>typeof window>"u"?!1:!!window.__HOP_DEBUG_HEX_COORDS,xA=[{cx:-8,cy:-6,r:3,delay:0},{cx:6,cy:2,r:2.5,delay:.3},{cx:-3,cy:8,r:2,delay:.6}],vA=e=>{const i=[[-.6,.42],[-.5,.15],[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2],[.48,.1],[.6,.4],[.4,.48],[-.48,.48]],a=[[-.48,.48],[-.6,.42],[-.34,-.18],[-.18,-.24],[-.28,.28]],o=[[.6,.4],[.4,.48],[.2,.28],[.3,-.2],[.48,.1]],c=[[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2]],r=[[-.46,.1],[-.3,-.12],[-.1,-.24],[0,-.4]],f=h=>h.map(([b,y])=>`${(b*e).toFixed(2)},${(y*e).toFixed(2)}`).join(" ");return{body:f(i),leftFace:f(a),rightFace:f(o),ridgeA:f(c),ridgeB:f(r)}},SA=({hex:e,onClick:i,isValidMove:a,isTargeted:o,isStairs:c,isLava:r,isShrine:f,isWall:h,isFire:b,onMouseEnter:y,assetHref:A,interactionOnly:v})=>{const[S,_]=w.useState(!1);w.useEffect(()=>{_(!1)},[A]);const{x:p,y:g}=dt(e,se),R=bA(),I=df(se-2),C=vA(se-2),M=`hex-clip-${e.q}-${e.r}-${e.s}`;let N=xc.floor,Y="rgba(0,0,0,0.2)",X="default";h?(N=xc.wall,Y="#1f2937"):r?(N="#7f1d1d",Y="#7f1d1d"):b?(N="#7c2d12",Y="#ea580c"):c?(N=xc.portal,Y="#000000"):f&&(N=xc.shrine,Y="#c2410c"),v&&(N="transparent",Y="rgba(255,255,255,0.10)"),a&&(Y="rgba(255,255,255,0.78)",X="pointer"),o&&(Y="#f97316");const O=!!A&&!v&&!S;return m.jsxs("g",{transform:`translate(${p},${g})`,onClick:()=>i(e),onMouseEnter:()=>y?.(e),style:{cursor:X},className:"hex-tile transition-colors duration-200",children:[h&&O&&m.jsx("polygon",{points:df(se-2),fill:"#111827",transform:"translate(0, 4)"}),!O&&(h?m.jsxs("g",{"data-wall-fallback":"relief",children:[m.jsx("ellipse",{cx:"0",cy:se*.56,rx:se*.56,ry:se*.18,fill:"rgba(3,7,18,0.55)"}),m.jsx("polygon",{points:I,fill:"#0f172a",transform:"translate(0, 5)",opacity:"0.92"}),m.jsx("polygon",{points:I,fill:"#1f2937",transform:"translate(0, 2)",opacity:"0.98"}),m.jsx("polygon",{points:I,fill:"#273447"}),m.jsx("polygon",{points:C.body,fill:"#4b5563",opacity:"0.96"}),m.jsx("polygon",{points:C.leftFace,fill:"#6b7280",opacity:"0.9"}),m.jsx("polygon",{points:C.rightFace,fill:"#374151",opacity:"0.95"}),m.jsx("polyline",{points:C.ridgeA,fill:"none",stroke:"rgba(229,231,235,0.55)",strokeWidth:"1.1",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("polyline",{points:C.ridgeB,fill:"none",stroke:"rgba(17,24,39,0.58)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"}),m.jsx("polygon",{points:I,fill:"none",stroke:Y,strokeWidth:o||a?"2":"1"})]}):m.jsx("polygon",{points:I,fill:N,stroke:Y,strokeWidth:o||a?"2":"1"})),O&&m.jsxs(m.Fragment,{children:[m.jsx("defs",{children:m.jsx("clipPath",{id:M,children:m.jsx("polygon",{points:I})})}),m.jsx("image",{href:A,x:-se,y:-31.176,width:se*2,height:se*1.732,preserveAspectRatio:"xMidYMid slice",clipPath:`url(#${M})`,onError:()=>_(!0)}),m.jsx("polygon",{points:I,fill:"none",stroke:Y,strokeWidth:o||a?"2":"1"})]}),r&&!v&&m.jsxs("g",{className:"lava-bubbles",children:[xA.map((q,K)=>m.jsx("circle",{cx:q.cx,cy:q.cy,r:q.r,fill:"#fbbf24",opacity:"0.7",style:{animation:`lavaBubble 2s ease-in-out ${q.delay}s infinite`}},K)),m.jsx("polygon",{points:df(se-4),fill:"none",stroke:"#f97316",strokeWidth:"1",opacity:"0.35"})]}),b&&!v&&m.jsxs("g",{className:"fire-embers",children:[m.jsx("circle",{cx:"-6",cy:"4",r:"2",fill:"#fbbf24",opacity:"0.75",style:{animation:"lavaBubble 1.6s ease-in-out 0s infinite"}}),m.jsx("circle",{cx:"4",cy:"-6",r:"1.5",fill:"#fcd34d",opacity:"0.75",style:{animation:"lavaBubble 1.4s ease-in-out 0.5s infinite"}})]}),R&&m.jsx("text",{x:"0",y:"0",textAnchor:"middle",fill:"rgba(0,0,0,0.15)",fontSize:"8",dy:".3em",pointerEvents:"none",children:`${e.q},${e.r}`})]})},AA=Ui.memo(SA,(e,i)=>e.hex.q===i.hex.q&&e.hex.r===i.hex.r&&e.hex.s===i.hex.s&&e.onClick===i.onClick&&e.onMouseEnter===i.onMouseEnter&&e.isCenter===i.isCenter&&e.isSelected===i.isSelected&&e.isValidMove===i.isValidMove&&e.isTargeted===i.isTargeted&&e.isStairs===i.isStairs&&e.isLava===i.isLava&&e.isShrine===i.isShrine&&e.isWall===i.isWall&&e.isFire===i.isFire&&e.assetHref===i.assetHref&&e.interactionOnly===i.interactionOnly),TA={catacombs:.2,inferno:.16,throne:.24,frozen:.45,void:.08},EA=(e,i)=>{const a=Math.max(e,i),o=Math.min(e,i);return(a+.05)/(o+.05)},Qg=(e,i)=>{const a=[];for(let o=0;o<6;o++){const c=Math.PI/3*o;a.push(`${Math.cos(c)*e},${Math.sin(c)*i}`)}return a.join(" ")},wA=(e,i,a=24,o,c,r=1)=>{const f=ir(e.subtype,e.type,e.enemyType,e.archetype),{icon:h,shape:b,color:y,borderColor:A,size:v=1}=f,S=a*v,_=e.statusEffects?.find(I=>I.type==="time_bomb"),p=_?Math.max(0,_.duration):e.actionCooldown??0,g=`contrast(${r.toFixed(2)}) brightness(${(r>1?1.12:1.04).toFixed(2)})`,R=i?`drop-shadow(0 3px 4px rgba(0,0,0,0.45)) drop-shadow(0 0 2px rgba(255,255,255,0.5)) saturate(1.08) ${g}`:`drop-shadow(0 3px 4px rgba(0,0,0,0.50)) drop-shadow(0 0 2px rgba(255,255,255,0.35)) saturate(1.0) ${g}`;return m.jsxs("g",{children:[m.jsx("title",{children:i?"Player":`${e.subtype||"Enemy"}`}),o&&m.jsx("image",{href:o,x:-S,y:-S,width:S*2,height:S*2,preserveAspectRatio:"xMidYMid meet",onError:c,style:{filter:R,opacity:i?1:.97}}),!o&&b==="square"&&m.jsx("rect",{x:-S*.8,y:-S*.8,width:S*1.6,height:S*1.6,fill:y,stroke:A,strokeWidth:2}),!o&&b==="diamond"&&m.jsx("path",{d:`M0 ${-S*.8} L${S*.6} 0 L0 ${S*.8} L${-S*.6} 0 Z`,fill:y,stroke:A,strokeWidth:1}),!o&&b==="triangle"&&m.jsx("path",{d:`M0 ${-S*.8} L${S*.7} ${S*.5} L${-S*.7} ${S*.5} Z`,fill:y,stroke:A,strokeWidth:1}),!o&&b==="circle"&&m.jsx("circle",{r:S*.7,fill:y,stroke:A,strokeWidth:1}),e.subtype==="bomb"&&m.jsx("text",{y:S*.2,textAnchor:"middle",fill:"#fff",fontSize:"10",fontWeight:"bold",children:p}),!o&&!i&&e.subtype!=="bomb"&&m.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:S*.8,opacity:.8,children:h}),!o&&i&&m.jsx("path",{d:`M0 ${-S*.4} L0 ${S*.4} M${-S*.15} ${-S*.2} L0 ${-S*.5} L${S*.15} ${-S*.2}`,stroke:A,strokeWidth:2,fill:"none"})]})},_A=({entity:e,isSpear:i,isDying:a,movementTrace:o,waapiControlled:c=!1,assetHref:r,fallbackAssetHref:f,floorTheme:h})=>{const[b,y]=w.useState(e.position),[A,v]=w.useState(()=>dt(e.position,se)),[S,_]=w.useState(e.previousPosition),[p,g]=w.useState(220),[R,I]=w.useState("cubic-bezier(0.22, 1, 0.36, 1)"),[C,M]=w.useState("none"),N=w.useRef(!1),Y=w.useRef(e.position),X=w.useRef([]),O=w.useRef(null),[q,K]=w.useState(!1),ue=w.useRef(e.hp),G=e.type==="player",_e=typeof window<"u"&&!!window.__HOP_DEBUG_MOVEMENT,[oe,be]=w.useState(r||f),[pe,H]=w.useState(!1);w.useEffect(()=>{be(r||f),H(!1)},[r,f,e.id]);const ee=()=>{if(!pe&&f&&oe!==f){be(f),H(!0);return}be(void 0)};w.useEffect(()=>{const Vt=()=>{for(const Ve of X.current)clearTimeout(Ve);X.current=[],O.current!==null&&(cancelAnimationFrame(O.current),O.current=null)};if(c){Vt(),N.current=!1;const Ve=!!(o&&o.actorId===e.id&&o.destination&&ne(o.destination,e.position)),Yt=!ne(e.position,Y.current);Y.current=e.position,Yt&&!Ve&&(y(e.position),_(e.previousPosition),v(dt(e.position,se))),C!=="none"&&M("none"),p!==0&&g(0),R!=="linear"&&I("linear");return}if(!ne(e.position,Y.current)){Y.current=e.position;const Ve=o&&o.actorId===e.id&&o.destination&&ne(o.destination,e.position)&&Array.isArray(o.path)&&o.path.length>0,Yt=Ve?o.path:void 0,$i=Ve?o.movementType:void 0,kn=Ve?Math.max(0,o.startDelayMs??0):0;if(_e){const sn=e.previousPosition?Ut(e.previousPosition,e.position).length:0;console.log("[HOP_MOVE]",{actorId:e.id,movementType:$i||"fallback",usedEngineTrace:Ve,tracePathLength:Yt?.length||0,tracePath:Yt||[],startDelayMs:kn,fallbackPathLength:sn,origin:o?.origin||e.previousPosition,destination:e.position})}if($i==="teleport"&&Ve&&o.origin){Vt(),N.current=!0;const sn=o.durationMs??180,Lt=Math.max(80,Math.floor(sn/2)),Jt=()=>{g(0),I("linear"),_(o.origin),y(o.origin),v(dt(o.origin,se)),M("out");const an=window.setTimeout(()=>{y(e.position),_(e.position),v(dt(e.position,se)),M("in")},Lt),wt=window.setTimeout(()=>{M("none"),N.current=!1},Lt*2);X.current.push(an,wt)};if(kn>0){const an=window.setTimeout(Jt,kn);X.current.push(an)}else Jt();return()=>{Vt(),N.current=!1}}const pn=!!(e.previousPosition&&!ne(e.position,e.previousPosition));if(!!(Yt&&Yt.length>1)||pn){let Lt=Yt||(e.previousPosition?Ut(e.previousPosition,e.position):[]);if(Ve&&o?.origin&&Lt.length>1&&ne(Lt[Lt.length-1],o.origin)&&!ne(Lt[0],o.origin)&&(Lt=[...Lt].reverse()),Lt.length>1){Vt(),N.current=!0;const Jt=Math.max(1,Lt.length-1),an=o?.durationMs?o.durationMs/Jt:0,wt=Math.max(90,Math.min(130,an||112)),wn=wt*Jt,_t=Lt.map(Mt=>dt(Mt,se)),ga=performance.now(),Yi=Mt=>Mt<.5?4*Mt*Mt*Mt:1-Math.pow(-2*Mt+2,3)/2;M("none"),g(0),I("linear"),y(Lt[0]),_(Lt[0]),v(_t[0]);let qn=-1;const Zt=Mt=>{const hn=Math.max(0,Mt-ga),Ft=Math.min(Jt-1,Math.floor(hn/wt)),Fe=Ft*wt,Ot=hn-Fe,on=Math.max(0,Math.min(1,Ot/wt)),Li=Yi(on);Ft!==qn&&(_(Lt[Ft]),y(Lt[Math.min(Lt.length-1,Ft+1)]),qn=Ft);const ft=_t[Ft],qt=_t[Math.min(_t.length-1,Ft+1)];if(v({x:ft.x+(qt.x-ft.x)*Li,y:ft.y+(qt.y-ft.y)*Li}),hn<wn){O.current=requestAnimationFrame(Zt);return}N.current=!1,y(e.position),_(e.previousPosition),v(_t[_t.length-1]),O.current=null};if(kn>0){const Mt=window.setTimeout(()=>{O.current=requestAnimationFrame(Zt)},kn);X.current.push(Mt)}else O.current=requestAnimationFrame(Zt);return()=>{Vt(),N.current=!1}}}M("none"),g(220),I("cubic-bezier(0.22, 1, 0.36, 1)"),y(e.position),_(e.previousPosition),v(dt(e.position,se))}},[e.position,e.previousPosition,o,e.id,c]);const{x:ae,y:Te}=A||dt(b,se);w.useEffect(()=>{if(e.hp<ue.current){K(!0);const Vt=setTimeout(()=>K(!1),150);return()=>clearTimeout(Vt)}ue.current=e.hp},[e.hp]);let xe="";const k=S;if(k&&!ne(b,k)){const Vt=fa(k,b);if(Vt!==-1){const Ve=Vt*60;xe=`rotate(${Ve}) scale(1.15, 0.85) rotate(${-Ve})`}}const $=e.isVisible===!1;if(i){const Vt=ir("spear","enemy");return m.jsx("g",{style:{pointerEvents:"none"},children:m.jsx("g",{transform:`translate(${ae},${Te})`,children:m.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:"20",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5))"},children:Vt.icon})})})}const J=ir(e.subtype,e.type,e.enemyType,e.archetype),me=yA(e),Me=G?1.34:.92,Re=G?-9:-2,ke=G?24:18,ht=String(h||"").toLowerCase(),$e=TA[ht]??.22,vn=EA($e,G?.87:.82),St=vn<4.5?1.22:1.06,nn=G?vn<4.5?.62:.42:vn<4.5?.48:.32,At=G?"#22e7ff":"rgba(255,120,120,0.7)",Un=G?"rgba(34,231,255,0.22)":"rgba(255,68,68,0.08)",hi=G?"rgba(34,231,255,0.48)":"rgba(255,90,90,0.18)",Ue=G?se*.5:se*.46,Le=G?se*.2:se*.18,qe=w.useMemo(()=>Qg(Ue,Le),[Ue,Le]),Tn=w.useMemo(()=>Qg(Ue*.86,Le*.84),[Ue,Le]),Qt=G?se*.32:se*.3,En=G?"rgba(190,250,255,0.86)":"rgba(255,201,241,0.86)";return m.jsx("g",{style:{pointerEvents:"none"},children:m.jsx("g",{"data-actor-node":e.id,style:{transition:c?"none":`transform ${p}ms ${R}`,transform:`translate(${ae}px, ${Te}px)`},className:a?"animate-lava-sink":"",children:m.jsxs("g",{transform:xe,className:`${q?"entity-damaged":""} ${!a&&!Ns(e)?"animate-idle":""} ${C==="out"?"entity-teleport-out":""} ${C==="in"?"entity-teleport-in":""}`,opacity:$?.3:J.opacity||1,style:{filter:$?"blur(1px)":"none"},children:[m.jsx("circle",{r:G?se*.92:se*.84,cy:Qt-2,fill:G?"rgba(6,15,23,0.84)":"rgba(22,7,18,0.84)",opacity:nn}),m.jsxs("g",{transform:`translate(0,${Qt})`,children:[m.jsx("polygon",{points:qe,fill:Un,stroke:At,strokeWidth:2,style:{filter:`drop-shadow(0 0 5px ${hi})`}}),G&&m.jsx("polygon",{points:Tn,fill:"none",stroke:At,strokeWidth:1.4,opacity:.82})]}),me&&m.jsx("ellipse",{cx:0,cy:se*.3,rx:se*.4,ry:se*.15,fill:"black",opacity:.2}),m.jsxs("g",{transform:`translate(0,${Re}) scale(${Me})`,children:[G&&m.jsx("circle",{r:Math.max(10,ke*.84),fill:"none",stroke:En,strokeWidth:2,opacity:.68,style:{filter:"drop-shadow(0 0 3px rgba(255,255,255,0.45))"}}),wA(e,G,ke,oe,ee,St)]}),Ns(e)&&m.jsxs("g",{transform:`translate(0, -${se*.8})`,className:"stun-icon",children:[m.jsx("text",{fontSize:"14",textAnchor:"middle",children:"*"}),m.jsx("text",{fontSize:"8",textAnchor:"middle",dy:"-3",dx:"6",children:"+"})]}),J.showFacing&&e.facing!==void 0&&!Ns(e)&&m.jsx("line",{x1:0,y1:0,x2:Math.cos((e.facing*60-90)*Math.PI/180)*se*.5,y2:Math.sin((e.facing*60-90)*Math.PI/180)*se*.5,stroke:J.borderColor,strokeWidth:3,strokeLinecap:"round"}),m.jsx("title",{children:`${e.subtype||e.type} - HP ${e.hp}/${e.maxHp}${e.intent?` - ${e.intent}`:""}`})]})})})},Jg=e=>{if(!e)return"";const i=(e.path||[]).map(a=>`${a.q},${a.r},${a.s}`).join(";");return`${e.actorId}|${e.movementType||""}|${e.destination?.q??""},${e.destination?.r??""},${e.destination?.s??""}|${i}|${e.durationMs??""}|${e.startDelayMs??0}|${e.wasLethal?1:0}`},Zg=(e=[])=>e.map(i=>`${i.id}:${i.duration??""}:${i.stacks??""}`).join("|"),_c=Ui.memo(_A,(e,i)=>{const a=e.entity,o=i.entity;return e.isSpear===i.isSpear&&e.isDying===i.isDying&&e.waapiControlled===i.waapiControlled&&e.assetHref===i.assetHref&&e.fallbackAssetHref===i.fallbackAssetHref&&e.floorTheme===i.floorTheme&&Jg(e.movementTrace)===Jg(i.movementTrace)&&a.id===o.id&&a.hp===o.hp&&a.maxHp===o.maxHp&&a.facing===o.facing&&a.intent===o.intent&&a.isVisible===o.isVisible&&a.position.q===o.position.q&&a.position.r===o.position.r&&a.position.s===o.position.s&&(a.previousPosition?.q??0)===(o.previousPosition?.q??0)&&(a.previousPosition?.r??0)===(o.previousPosition?.r??0)&&(a.previousPosition?.s??0)===(o.previousPosition?.s??0)&&(a.intentPosition?.q??0)===(o.intentPosition?.q??0)&&(a.intentPosition?.r??0)===(o.intentPosition?.r??0)&&(a.intentPosition?.s??0)===(o.intentPosition?.s??0)&&Zg(a.statusEffects)===Zg(o.statusEffects)}),MA=({gameState:e,selectedSkillId:i,showMovementRange:a,hoveredTile:o,enginePreviewGhost:c})=>{const r=e.player.position,f=w.useMemo(()=>{const S=new Set;for(const _ of e.enemies)_.hp>0&&S.add(he(_.position));return S},[e.enemies]),h=w.useMemo(()=>{if(!a||i)return[];const S=new Set(e.player.activeSkills.map(R=>R.id)),_=["BASIC_MOVE","DASH"],p=new Set,g=[];return _.forEach(R=>{if(S.has(R)){const I=Rn.get(R);I?.getValidTargets&&I.getValidTargets(e,r).forEach(M=>{const N=he(M);p.has(N)||(p.add(N),g.push(M))})}}),g.length===0?[{q:r.q+1,r:r.r,s:r.s-1},{q:r.q+1,r:r.r-1,s:r.s},{q:r.q,r:r.r-1,s:r.s+1},{q:r.q-1,r:r.r,s:r.s+1},{q:r.q-1,r:r.r+1,s:r.s},{q:r.q,r:r.r+1,s:r.s-1}].filter(I=>pa(I,e.gridWidth,e.gridHeight)):g},[e,a,i,r]),b=w.useMemo(()=>{const S=new Set;for(const _ of h)S.add(he(_));return S},[h]),y=w.useMemo(()=>{if(!i)return[];const S=Rn.get(i),_=O1(e.player,i)||S?.baseVariables?.range||0,p=S?.getValidTargets?S.getValidTargets(e,r):[],g=new Set(p.map(he)),R=[];if(i==="DASH"||i==="SPEAR_THROW"||i==="SHIELD_THROW"||i==="GRAPPLE_HOOK")for(let C=0;C<6;C++)for(let M=1;M<=_;M++){const N=Yn(r,kf(C,M));if(!pa(N,e.gridWidth,e.gridHeight))break;const Y=ze.isLosBlocking(e,N),X=f.has(he(N)),K=Ut(r,N).slice(1,-1).some(G=>ze.isLosBlocking(e,G)||f.has(he(G))),ue=g.has(he(N));if(R.push({p:N,isValidTarget:ue,isBlocked:K,isWall:Y,isEnemy:X}),Y||X)break}else p.forEach(C=>{const M=ze.isLosBlocking(e,C),N=f.has(he(C));R.push({p:C,isValidTarget:!0,isBlocked:!1,isWall:M,isEnemy:N})});return R},[e,i,r,f]),A=w.useMemo(()=>{const S=new Map;for(const _ of y)S.set(he(_.p),_);return S},[y]),v=w.useMemo(()=>{if(c)return c;if(a&&o&&!i&&b.has(he(o)))return{path:Ut(r,o),aoe:[],hasEnemy:!1,target:o};if(!i||!o)return null;const S=A.get(he(o));if(!S||!S.isValidTarget||S.isBlocked)return null;const _=Ut(r,o),p=ox(e,i,r,o),g=S.isEnemy;return{path:_,aoe:p,hasEnemy:g,target:o}},[c,e,i,o,A,b,a,r]);return m.jsx("g",{pointerEvents:"none",children:v&&m.jsxs("g",{children:[(()=>{const S=v.path.map(C=>dt(C,se)),_=S.map((C,M)=>`${M===0?"M":"L"} ${C.x} ${C.y}`).join(" "),p=S[S.length-1],g=S[S.length-2]||{x:p.x-1,y:p.y},R=Math.atan2(p.y-g.y,p.x-g.x),I=8;return m.jsxs("g",{children:[m.jsx("path",{d:_,stroke:"rgba(255,255,255,0.9)",strokeWidth:"2.25",fill:"none",opacity:"0.85",style:{filter:"drop-shadow(0 0 4px rgba(255,255,255,0.22))"}}),m.jsx("path",{d:`M ${p.x} ${p.y} L ${p.x-I*Math.cos(R-Math.PI/6)} ${p.y-I*Math.sin(R-Math.PI/6)} M ${p.x} ${p.y} L ${p.x-I*Math.cos(R+Math.PI/6)} ${p.y-I*Math.sin(R+Math.PI/6)}`,stroke:"rgba(255,255,255,0.95)",strokeWidth:"2",opacity:"0.9"})]})})(),v.hasEnemy&&(()=>{const{x:S,y:_}=dt(v.target,se),p=se*.7;return m.jsxs("g",{children:[m.jsx("circle",{cx:S,cy:_,r:p,fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4 2"}),m.jsx("line",{x1:S-p,y1:_,x2:S+p,y2:_,stroke:"#ef4444",strokeWidth:"1"}),m.jsx("line",{x1:S,y1:_-p,x2:S,y2:_+p,stroke:"#ef4444",strokeWidth:"1"})]})})(),!v.hasEnemy&&(()=>{const{x:S,y:_}=dt(v.target,se);return m.jsx("circle",{cx:S,cy:_,r:se*.36,fill:"rgba(255,255,255,0.14)",stroke:"rgba(255,255,255,0.65)",strokeWidth:1.5})})(),Array.from(new Map(v.aoe.map(S=>[he(S),S])).values()).map(S=>{const{x:_,y:p}=dt(S,se);return m.jsx("circle",{cx:_,cy:p,r:se*.6,fill:"rgba(239, 68, 68, 0.2)",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,strokeDasharray:"4 2"},`aoe-${S.q}-${S.r}`)})]})})},OA=["white","blue","black","red","green"],ey={white:{label:"Plains / Mesa",floorAssetId:"tile.catacombs.floor.01",hazardAssetId:"tile.catacombs.lava.01"},blue:{label:"Islands / Coast",floorAssetId:"tile.frozen.floor.01",hazardAssetId:"tile.catacombs.lava.01"},black:{label:"Swamp / Wastes",floorAssetId:"tile.void.floor.01",hazardAssetId:"tile.catacombs.lava.01"},red:{label:"Mountains / Volcanic",floorAssetId:"tile.inferno.floor.01",hazardAssetId:"tile.inferno.lava.01"},green:{label:"Forest / Jungle",floorAssetId:"tile.throne.floor.01",hazardAssetId:"tile.catacombs.lava.01"}},CA={catacombs:"white",frozen:"blue",void:"black",inferno:"red",throne:"green"},NA=e=>{if(typeof e!="string")return;const i=e.toLowerCase();return OA.includes(i)?i:void 0},RA=()=>{if(!(typeof window>"u"))return NA(window.__HOP_FORCE_BIOME)},kA=e=>{const i=RA();if(i)return i;const a=String(e||"").toLowerCase();return CA[a]||"white"},LA=e=>{const i=kA(e.theme);return e.isWall?"tile.catacombs.wall.01":e.isLava?ey[i].hazardAssetId:e.isFire?"tile.catacombs.fire.01":ey[i].floorAssetId},ty=e=>{if(e.isStairs)return"prop.core.stairs.01";if(e.isShrine)return"prop.core.shrine.01"},Hc=e=>{if(e.type==="player")switch(e.archetype){case"FIREMAGE":return"unit.player.firemage.04";case"SKIRMISHER":return"unit.player.skirmisher.01";case"HUNTER":return"unit.player.hunter.01";case"NECROMANCER":return"unit.player.necromancer.01";case"ASSASSIN":return"unit.player.assassin.01";default:return"unit.player.vanguard.01"}switch(e.subtype){case"footman":return"unit.enemy.footman.01";case"shield_bearer":return"unit.enemy.shield_bearer.01";case"archer":return"unit.enemy.archer.01";case"warlock":return"unit.enemy.warlock.01";case"bomber":return"unit.enemy.bomber.01";case"bomb":return"unit.enemy.bomb.01";default:return e.enemyType==="boss"?"unit.enemy.boss.01":"unit.enemy.footman.01"}},ny="/Hop",iy=(e,i)=>`${e.endsWith("/")?e:`${e}/`}${i.replace(/^\/+/,"")}`,IA=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?iy(ny,e.slice(1)):e:iy(ny,e),BA={"unit.player.vanguard.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.firemage.04":"/assets/units/unit.player.firemage.02.svg","unit.player.skirmisher.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.hunter.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.necromancer.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.assassin.01":"/assets/units/unit.player.skirmisher.01.svg","unit.enemy.footman.01":"/assets/units/unit.enemy.footman.01.svg","unit.enemy.shield_bearer.01":"/assets/units/unit.enemy.shield_bearer.01.svg","unit.enemy.archer.01":"/assets/units/unit.enemy.archer.01.svg","unit.enemy.warlock.01":"/assets/units/unit.enemy.warlock.01.svg","unit.enemy.bomber.01":"/assets/units/unit.enemy.bomber.01.svg","unit.enemy.bomb.01":"/assets/units/unit.enemy.bomb.01.svg","unit.enemy.boss.01":"/assets/units/unit.enemy.boss.01.svg"},ff=e=>{const i=Hc(e),a=BA[i];return a?IA(a):void 0},jA=e=>{if(e==="impact")return"fx.core.impact.01";if(e==="vaporize")return"fx.core.vaporize.01";if(e==="lava_ripple")return"fx.core.lava_ripple.01";if(e==="explosion_ring")return"fx.core.explosion_ring.01"},DA=()=>"ui.core.hp_frame.01",HA=()=>"decal.combat.blood.01",PA=e=>new Promise(i=>setTimeout(i,e)),UA=e=>{if(!e)return null;const i=e.position||e.destination||e.origin||e.target;return i&&typeof i.q=="number"&&typeof i.r=="number"&&typeof i.s=="number"?i:null},sy=e=>e==="impact"?400:e==="combat_text"?1e3:e==="flash"?300:e==="melee_lunge"?240:e==="arrow_shot"?260:e==="arcane_bolt"?320:e==="spear_trail"?500:e==="vaporize"?600:e==="lava_ripple"?800:e==="explosion_ring"?1e3:2e3,qA=new Set(["impact","flash","combat_text","spear_trail","vaporize","lava_ripple","explosion_ring"]),ay=.72,zA=(e,i,a)=>{const o=String(e||"").toLowerCase(),c=String(i||"").toLowerCase();return c.includes("lava")||c.includes("fire")||c.includes("hazard")||c.includes("burn")||c.includes("crush")||c.includes("collision")||o==="bomber"||c.includes("bomb")||c.includes("explosion")?null:o==="warlock"||c.includes("arcane")||c.includes("force")||c.includes("spell")?"arcane_bolt":o==="archer"||c.includes("arrow")||c.includes("spear_throw")?"arrow_shot":a<=se*2.05||c.includes("basic_attack")||c.includes("melee")?"melee_lunge":null},$A=({visualEvents:e,timelineEvents:i=[],simulationEvents:a=[],actorSnapshots:o=[],onBusyStateChange:c,assetManifest:r})=>{const[f,h]=w.useState([]),b=w.useRef(0),y=w.useRef(0),A=w.useRef(0),v=w.useRef([]),S=w.useRef(!1),[_,p]=w.useState(!1),g=w.useRef(!1),R=w.useRef(new Map),I=w.useRef(null),C=650,M=3500,N=w.useMemo(()=>{const O=new Map;for(const q of r?.assets||[])O.set(q.id,q);return O},[r]),Y=w.useMemo(()=>{const O=new Map;for(const q of o)O.set(q.id,q);return O},[o]);w.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const O=window.matchMedia("(prefers-reduced-motion: reduce)"),q=()=>{g.current=O.matches};return q(),O.addEventListener?.("change",q),()=>O.removeEventListener?.("change",q)},[]),w.useEffect(()=>{if(!e.length)return;const O=new Map(R.current),q=Date.now();for(const K of e){if(K.type!=="kinetic_trace")continue;const ue=K.payload;if(!ue?.actorId)continue;const G=Number(ue.durationMs??0);G>0&&O.set(String(ue.actorId),{durationMs:G,seenAt:q})}R.current=O},[e]),w.useEffect(()=>{c?.(_)},[_,c]);const X=O=>{const q=Date.now(),K=UA(O.payload);if(!K)return;const ue=[],G=`${O.id}:${q}`;O.phase==="HAZARD_CHECK"?ue.push({id:`${G}:haz`,type:"combat_text",position:K,payload:{text:"!"},startTime:q}):O.phase==="DEATH_RESOLVE"&&ue.push({id:`${G}:vapor`,type:"vaporize",position:K,startTime:q}),ue.length>0&&h(_e=>[..._e,...ue])};return w.useEffect(()=>{if(!i.length)return;i.length<b.current&&(b.current=0);const O=i.slice(b.current);O.length&&(b.current=i.length,v.current.push(...O),!S.current&&(S.current=!0,p(!0),(async()=>{try{const q=Date.now();for(;v.current.length>0;){if(Date.now()-q>M){console.warn("[HOP_JUICE] Timeline queue exceeded runtime budget; flushing remaining events.",{queued:v.current.length});break}const K=v.current.shift();X(K);let ue=K.blocking?Math.round((K.suggestedDurationMs??140)*ay):0;if(K.phase==="MOVE_END"){const be=K.payload?.targetActorId;if(be){const pe=R.current.get(be),H=pe?Date.now()-pe.seenAt<=2500:!1;pe&&H&&pe.durationMs>0&&(ue=Math.max(ue,Math.min(C,Math.round(pe.durationMs*ay))))}}let G=0;K.phase==="MOVE_END"?G=Math.min(460,Math.max(70,ue)):K.phase==="DEATH_RESOLVE"?G=Math.min(120,Math.max(55,ue)):K.phase==="DAMAGE_APPLY"?G=Math.min(80,Math.max(35,ue)):K.phase==="HAZARD_CHECK"?G=Math.min(70,Math.max(30,ue)):K.blocking&&(G=Math.min(70,Math.max(0,ue)));const _e=K.phase==="MOVE_END"?ue:g.current?Math.min(70,Math.floor(G*.5)):G,oe=Math.max(0,Math.min(C,_e));oe>0&&await PA(oe)}}catch(q){console.error("[HOP_JUICE] Timeline queue processing failed; releasing busy lock.",q)}finally{v.current=[],S.current=!1,p(!1)}})()))},[i]),w.useEffect(()=>{if(i.length>0){y.current=e.length;return}e.length<y.current&&(y.current=0);const O=y.current;if(O>=e.length)return;const q=e.slice(O);y.current=e.length;const K=[],ue=Date.now();q.forEach((G,_e)=>{const oe=`juice-${ue}-${O+_e}`;G.type==="vfx"&&G.payload?.type==="impact"?G.payload.position&&K.push({id:oe,type:"impact",position:G.payload.position,startTime:ue}):G.type==="vfx"&&G.payload?.type==="flash"?G.payload.position&&K.push({id:oe,type:"flash",position:G.payload.position,startTime:ue}):G.type==="vfx"&&G.payload?.type==="spear_trail"?G.payload.path&&G.payload.path.length>0&&K.push({id:oe,type:"spear_trail",position:G.payload.path[0],payload:G.payload,startTime:ue}):G.type==="vfx"&&G.payload?.type==="vaporize"?G.payload.position&&K.push({id:oe,type:"vaporize",position:G.payload.position,startTime:ue}):G.type==="vfx"&&G.payload?.type==="lava_ripple"?G.payload.position&&K.push({id:oe,type:"lava_ripple",position:G.payload.position,startTime:ue}):G.type==="vfx"&&G.payload?.type==="explosion_ring"&&G.payload.position&&K.push({id:oe,type:"explosion_ring",position:G.payload.position,startTime:ue})}),K.length>0&&h(G=>[...G,...K])},[e,i.length]),w.useEffect(()=>{a.length<A.current&&(A.current=0);const O=A.current;if(O>=a.length)return;const q=a.slice(O);A.current=a.length;const K=Date.now(),ue=[];q.forEach((G,_e)=>{if(G.type!=="DamageTaken"||!G.position)return;const oe=G.position,be=String(G.payload?.sourceId||""),pe=be?Y.get(be):void 0,H=String(G.payload?.reason||"");if(pe?.position){const ee=dt(pe.position,se),ae=dt(oe,se),Te=Math.hypot(ae.x-ee.x,ae.y-ee.y),xe=zA(pe.subtype,H,Te);xe&&ue.push({id:`sim-cue-${K}-${O+_e}`,type:xe,position:oe,payload:{source:pe.position,sourceSubtype:pe.subtype,reason:H},startTime:K})}ue.push({id:`sim-impact-${K}-${O+_e}`,type:"impact",position:oe,startTime:K})}),ue.length>0&&h(G=>[...G,...ue])},[a,Y]),w.useEffect(()=>{if(I.current!==null&&(window.clearTimeout(I.current),I.current=null),f.length===0)return;const O=Date.now();let q=1/0;for(const ue of f){const G=O-ue.startTime,_e=sy(ue.type)-G;_e>0&&_e<q&&(q=_e)}if(!Number.isFinite(q)){h([]);return}const K=Math.max(16,Math.min(180,Math.floor(q)));return I.current=window.setTimeout(()=>{const ue=Date.now();h(G=>{const _e=G.filter(oe=>ue-oe.startTime<sy(oe.type));return _e.length===G.length?G:_e})},K),()=>{I.current!==null&&(window.clearTimeout(I.current),I.current=null)}},[f]),m.jsx("g",{style:{pointerEvents:"none"},children:f.map(O=>{if(!O.position)return null;const{x:q,y:K}=dt(O.position,se),ue=qA.has(O.type)?jA(O.type):void 0,G=ue?N.get(ue)?.path:void 0,_e=N.get(DA())?.path;if(O.type==="melee_lunge"||O.type==="arrow_shot"||O.type==="arcane_bolt"){const oe=O.payload?.source;if(!oe)return null;const be=dt(oe,se),pe=q-be.x,H=K-be.y,ee=Math.max(1,Math.hypot(pe,H)),ae=pe/ee,Te=H/ee,xe=q-ae*Math.min(ee*.18,14),k=K-Te*Math.min(ee*.18,14),$=O.type==="arrow_shot"?7:5,J=q-ae*$-Te*($*.55),me=K-Te*$+ae*($*.55),Me=q-ae*$+Te*($*.55),Re=K-Te*$-ae*($*.55);return O.type==="melee_lunge"?m.jsxs("g",{className:"animate-melee-lunge",children:[m.jsx("line",{x1:be.x,y1:be.y,x2:xe,y2:k,stroke:"rgba(255,255,255,0.35)",strokeWidth:5,strokeLinecap:"round"}),m.jsx("line",{x1:xe,y1:k,x2:q,y2:K,stroke:"rgba(255,255,255,0.85)",strokeWidth:3,strokeLinecap:"round"})]},O.id):O.type==="arrow_shot"?m.jsxs("g",{className:"animate-arrow-shot",children:[m.jsx("line",{x1:be.x,y1:be.y,x2:q,y2:K,stroke:"rgba(253,230,138,0.9)",strokeWidth:2.5,strokeLinecap:"round",strokeDasharray:"10 8"}),m.jsx("path",{d:`M ${q} ${K} L ${J} ${me} M ${q} ${K} L ${Me} ${Re}`,stroke:"rgba(254,243,199,0.95)",strokeWidth:2,strokeLinecap:"round"})]},O.id):m.jsxs("g",{className:"animate-arcane-bolt",children:[m.jsx("line",{x1:be.x,y1:be.y,x2:q,y2:K,stroke:"rgba(34,211,238,0.92)",strokeWidth:4,strokeLinecap:"round",strokeDasharray:"12 10"}),m.jsx("line",{x1:be.x,y1:be.y,x2:q,y2:K,stroke:"rgba(207,250,254,0.85)",strokeWidth:1.8,strokeLinecap:"round"}),m.jsx("circle",{cx:q,cy:K,r:se*.22,fill:"rgba(34,211,238,0.35)"})]},O.id)}if(O.type==="impact")return G?m.jsx("image",{href:G,x:q-se*.75,y:K-se*.75,width:se*1.5,height:se*1.5,preserveAspectRatio:"xMidYMid meet",className:"animate-impact",opacity:"0.9"},O.id):m.jsx("circle",{cx:q,cy:K,r:se*.5,fill:"none",stroke:"#ffffff",strokeWidth:"2",className:"animate-impact"},O.id);if(O.type==="combat_text"){const oe=O.payload.text.startsWith("-")?"#fb7185":"#86efac";return m.jsxs("g",{transform:`translate(${q}, ${K-10})`,children:[_e&&m.jsx("image",{href:_e,x:-46,y:-24,width:92,height:24,preserveAspectRatio:"xMidYMid meet",opacity:"0.78"}),m.jsx("text",{textAnchor:"middle",fill:oe,fontSize:"16",fontWeight:"black",className:"animate-float-up",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.8))",paintOrder:"stroke",stroke:"#000",strokeWidth:"4px"},children:O.payload.text})]},O.id)}if(O.type==="flash")return m.jsx("circle",{cx:q,cy:K,r:se*2,fill:"#ffffff",className:"animate-flash"},O.id);if(O.type==="spear_trail"){const be=O.payload.path.map(pe=>{const H=dt(pe,se);return`${H.x},${H.y}`}).join(" ");return m.jsx("polyline",{points:be,fill:"none",stroke:"#ffffff",strokeWidth:"4",strokeLinecap:"round",className:"animate-spear-trail"},O.id)}return O.type==="vaporize"?G?m.jsx("image",{href:G,x:q-se*.95,y:K-se*.95,width:se*1.9,height:se*1.9,preserveAspectRatio:"xMidYMid meet",className:"animate-vaporize",opacity:"0.9"},O.id):m.jsxs("g",{children:[m.jsx("circle",{cx:q,cy:K,r:se*.6,fill:"#f97316",className:"animate-vaporize",opacity:"0.8"}),m.jsx("circle",{cx:q,cy:K,r:se*1.2,fill:"none",stroke:"#f97316",strokeWidth:"2",className:"animate-ping"})]},O.id):O.type==="lava_ripple"?G?m.jsx("image",{href:G,x:q-se,y:K-se,width:se*2,height:se*2,preserveAspectRatio:"xMidYMid meet",className:"animate-ping",opacity:"0.85"},O.id):m.jsx("circle",{cx:q,cy:K,r:se*.8,fill:"none",stroke:"#ea580c",strokeWidth:"3",className:"animate-ping"},O.id):O.type==="explosion_ring"?G?m.jsx("image",{href:G,x:q-se*1.35,y:K-se*1.35,width:se*2.7,height:se*2.7,preserveAspectRatio:"xMidYMid meet",className:"animate-explosion-ring",opacity:"0.88"},O.id):m.jsx("circle",{cx:q,cy:K,r:se*2.5,fill:"rgba(255, 120, 0, 0.2)",stroke:"#ffaa00",strokeWidth:"4",className:"animate-explosion-ring"},O.id):null})})},Of="/Hop",n0=/^[a-z0-9]+(?:[._-][a-z0-9]+)*$/,sr=/^\/assets\/[a-z0-9/_\-.]+$/,Df=["ground","decal","prop","unit","fx","ui"],VA=["svg","webp","avif","png","jpg","jpeg"],oy=["svg","webp","avif","png"],ly=["svg","webp","avif","png","jpg","jpeg"],ry=["svg","webp","avif","png"],cy=["svg"],Cf=(e,i)=>`${e.endsWith("/")?e:`${e}/`}${i.replace(/^\/+/,"")}`,YA=Cf(Of,"assets/manifest.json"),Ya=e=>/^(?:[a-z]+:)?\/\//i.test(e)||e.startsWith("data:")?e:e.startsWith("/")?e.startsWith("/assets/")?Cf(Of,e.slice(1)):e:Cf(Of,e),Do=e=>{if(e)return{...e,default:Ya(e.default),themes:Object.fromEntries(Object.entries(e.themes||{}).map(([i,a])=>[i,Ya(a)]))}},uy=e=>{if(e)return{...e,scale:e.scale??e.mountainScale,offsetX:e.offsetX??e.mountainOffsetX,offsetY:e.offsetY??e.mountainOffsetY,anchorX:e.anchorX??e.mountainAnchorX,anchorY:e.anchorY??e.mountainAnchorY,crustBlendMode:e.crustBlendMode??e.mountainCrustBlendMode,crustBlendOpacity:e.crustBlendOpacity??e.mountainCrustBlendOpacity,tintColor:e.tintColor??e.mountainTintColor,tintBlendMode:e.tintBlendMode??e.mountainTintBlendMode,tintOpacity:e.tintOpacity??e.mountainTintOpacity}},FA=e=>{if(e)return{...e,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([i,a])=>[i,String(a)]))}},zc=e=>{if(e)return{detailA:Do(e.detailA),detailB:Do(e.detailB),tint:FA(e.tint)}},Nf=e=>{if(e)return{...e}},i0=e=>{if(!e)return;const i=uy(e);return{...i,mountainPath:i?.mountainPath?Ya(i.mountainPath):i?.mountainPath,themes:Object.fromEntries(Object.entries(e.themes||{}).map(([a,o])=>[a,{...uy(o),mountainPath:o?.mountainPath?Ya(o.mountainPath):o?.mountainPath}]))}},KA=e=>{if(e)return{...e,biomeLayers:e.biomeLayers?{undercurrent:Do(e.biomeLayers.undercurrent),crust:Do(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:zc(e.biomeMaterials.undercurrent),crust:zc(e.biomeMaterials.crust)}:void 0,walls:i0(e.walls),assetOverrides:Object.fromEntries(Object.entries(e.assetOverrides||{}).map(([i,a])=>[i,{...a,mountainSettings:Nf(a?.mountainSettings)}]))}},GA=e=>({...e,biomeUnderlay:e.biomeUnderlay?{...e.biomeUnderlay,default:Ya(e.biomeUnderlay.default),themes:Object.fromEntries(Object.entries(e.biomeUnderlay.themes||{}).map(([i,a])=>[i,Ya(a)]))}:void 0,biomeLayers:e.biomeLayers?{undercurrent:Do(e.biomeLayers.undercurrent),crust:Do(e.biomeLayers.crust),clutter:e.biomeLayers.clutter?{...e.biomeLayers.clutter,tags:[...e.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:e.biomeMaterials?{undercurrent:zc(e.biomeMaterials.undercurrent),crust:zc(e.biomeMaterials.crust)}:void 0,walls:i0(e.walls),biomePresets:Object.fromEntries(Object.entries(e.biomePresets||{}).map(([i,a])=>[i,KA(a)||{}])),assets:e.assets.map(i=>({...i,path:Ya(i.path),mountainSettings:Nf(i.mountainSettings),mountainSettingsByTheme:Object.fromEntries(Object.entries(i.mountainSettingsByTheme||{}).map(([a,o])=>[a,Nf(o)||{}]))}))}),dy={version:"1.0.0",gridTopology:"flat-top-hex",tileUnitPx:256,tileAspectRatio:1.154700538,layers:[...Df],assets:[]};let Mc=null;const fy=e=>typeof e=="string"&&Df.includes(e),my=e=>typeof e=="string"&&["tile","decal","prop","unit","fx","ui"].includes(e),py=e=>typeof e=="string"&&VA.includes(e),Fa=(e,i,a)=>{if(!e||typeof e!="object"){a.push(`"${i}" must be an object when provided.`);return}if((typeof e.default!="string"||!sr.test(e.default))&&a.push(`"${i}.default" must be a /assets/... path.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(e.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||!sr.test(c))&&a.push(`"${i}.themes.${o}" must be a /assets/... path.`);if(e.mode!==void 0&&e.mode!=="off"&&e.mode!=="cover"&&e.mode!=="repeat"&&a.push(`"${i}.mode" must be one of "off", "cover", or "repeat".`),e.scalePx!==void 0&&(!Number.isFinite(e.scalePx)||Number(e.scalePx)<=0)&&a.push(`"${i}.scalePx" must be > 0 when provided.`),e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&a.push(`"${i}.opacity" must be in [0, 1] when provided.`),e.seedShiftPx!==void 0&&(!Number.isFinite(e.seedShiftPx)||Number(e.seedShiftPx)<0)&&a.push(`"${i}.seedShiftPx" must be >= 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&a.push(`"${i}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&a.push(`"${i}.offsetY" must be a finite number when provided.`),e.scroll!==void 0){const o=e.scroll;!o||typeof o!="object"?a.push(`"${i}.scroll" must be an object when provided.`):(o.x!==void 0&&!Number.isFinite(o.x)&&a.push(`"${i}.scroll.x" must be a finite number.`),o.y!==void 0&&!Number.isFinite(o.y)&&a.push(`"${i}.scroll.y" must be a finite number.`),o.durationMs!==void 0&&(!Number.isFinite(o.durationMs)||Number(o.durationMs)<=0)&&a.push(`"${i}.scroll.durationMs" must be > 0 when provided.`))}},WA=(e,i,a)=>{if(!e||typeof e!="object"){a.push(`"${i}" must be an object when provided.`);return}if((typeof e.default!="string"||e.default.trim().length===0)&&a.push(`"${i}.default" must be a non-empty color string.`),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(e.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||c.trim().length===0)&&a.push(`"${i}.themes.${o}" must be a non-empty color string.`);e.opacity!==void 0&&(!Number.isFinite(e.opacity)||Number(e.opacity)<0||Number(e.opacity)>1)&&a.push(`"${i}.opacity" must be in [0, 1] when provided.`),e.blendMode!==void 0&&e.blendMode!=="normal"&&e.blendMode!=="multiply"&&e.blendMode!=="overlay"&&e.blendMode!=="soft-light"&&e.blendMode!=="screen"&&e.blendMode!=="color-dodge"&&a.push(`"${i}.blendMode" must be one of "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`)},ar=(e,i,a)=>{if(!e||typeof e!="object"){a.push(`"${i}" must be an object when provided.`);return}e.scale!==void 0&&(!Number.isFinite(e.scale)||Number(e.scale)<=0)&&a.push(`"${i}.scale" must be > 0 when provided.`),e.offsetX!==void 0&&!Number.isFinite(e.offsetX)&&a.push(`"${i}.offsetX" must be a finite number when provided.`),e.offsetY!==void 0&&!Number.isFinite(e.offsetY)&&a.push(`"${i}.offsetY" must be a finite number when provided.`),e.anchorX!==void 0&&(!Number.isFinite(e.anchorX)||Number(e.anchorX)<0||Number(e.anchorX)>1)&&a.push(`"${i}.anchorX" must be in [0, 1] when provided.`),e.anchorY!==void 0&&(!Number.isFinite(e.anchorY)||Number(e.anchorY)<0||Number(e.anchorY)>1)&&a.push(`"${i}.anchorY" must be in [0, 1] when provided.`),e.crustBlendMode!==void 0&&e.crustBlendMode!=="off"&&e.crustBlendMode!=="normal"&&e.crustBlendMode!=="multiply"&&e.crustBlendMode!=="overlay"&&e.crustBlendMode!=="soft-light"&&e.crustBlendMode!=="screen"&&e.crustBlendMode!=="color-dodge"&&a.push(`"${i}.crustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.tintBlendMode!==void 0&&e.tintBlendMode!=="off"&&e.tintBlendMode!=="normal"&&e.tintBlendMode!=="multiply"&&e.tintBlendMode!=="overlay"&&e.tintBlendMode!=="soft-light"&&e.tintBlendMode!=="screen"&&e.tintBlendMode!=="color-dodge"&&a.push(`"${i}.tintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.crustBlendOpacity!==void 0&&(!Number.isFinite(e.crustBlendOpacity)||Number(e.crustBlendOpacity)<0||Number(e.crustBlendOpacity)>1)&&a.push(`"${i}.crustBlendOpacity" must be in [0, 1] when provided.`),e.tintOpacity!==void 0&&(!Number.isFinite(e.tintOpacity)||Number(e.tintOpacity)<0||Number(e.tintOpacity)>1)&&a.push(`"${i}.tintOpacity" must be in [0, 1] when provided.`),e.tintColor!==void 0&&(typeof e.tintColor!="string"||e.tintColor.trim().length===0)&&a.push(`"${i}.tintColor" must be a non-empty color string when provided.`)},s0=(e,i,a)=>{if(!e||typeof e!="object"){a.push(`"${i}" must be an object when provided.`);return}if(e.mode!==void 0&&e.mode!=="native"&&e.mode!=="additive"&&e.mode!=="custom"&&a.push(`"${i}.mode" must be one of "native", "additive", or "custom".`),e.interiorDensity!==void 0&&(!Number.isFinite(e.interiorDensity)||Number(e.interiorDensity)<0||Number(e.interiorDensity)>1)&&a.push(`"${i}.interiorDensity" must be in [0, 1] when provided.`),e.clusterBias!==void 0&&(!Number.isFinite(e.clusterBias)||Number(e.clusterBias)<0||Number(e.clusterBias)>1)&&a.push(`"${i}.clusterBias" must be in [0, 1] when provided.`),e.keepPerimeter!==void 0&&typeof e.keepPerimeter!="boolean"&&a.push(`"${i}.keepPerimeter" must be a boolean when provided.`),e.mountainPath!==void 0&&(typeof e.mountainPath!="string"||!sr.test(e.mountainPath))&&a.push(`"${i}.mountainPath" must be a /assets/... path when provided.`),e.mountainScale!==void 0&&(!Number.isFinite(e.mountainScale)||Number(e.mountainScale)<=0)&&a.push(`"${i}.mountainScale" must be > 0 when provided.`),e.mountainOffsetX!==void 0&&!Number.isFinite(e.mountainOffsetX)&&a.push(`"${i}.mountainOffsetX" must be a finite number when provided.`),e.mountainOffsetY!==void 0&&!Number.isFinite(e.mountainOffsetY)&&a.push(`"${i}.mountainOffsetY" must be a finite number when provided.`),e.mountainAnchorX!==void 0&&(!Number.isFinite(e.mountainAnchorX)||Number(e.mountainAnchorX)<0||Number(e.mountainAnchorX)>1)&&a.push(`"${i}.mountainAnchorX" must be in [0, 1] when provided.`),e.mountainAnchorY!==void 0&&(!Number.isFinite(e.mountainAnchorY)||Number(e.mountainAnchorY)<0||Number(e.mountainAnchorY)>1)&&a.push(`"${i}.mountainAnchorY" must be in [0, 1] when provided.`),e.mountainCrustBlendMode!==void 0&&e.mountainCrustBlendMode!=="off"&&e.mountainCrustBlendMode!=="normal"&&e.mountainCrustBlendMode!=="multiply"&&e.mountainCrustBlendMode!=="overlay"&&e.mountainCrustBlendMode!=="soft-light"&&e.mountainCrustBlendMode!=="screen"&&e.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${i}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(e.mountainCrustBlendOpacity)||Number(e.mountainCrustBlendOpacity)<0||Number(e.mountainCrustBlendOpacity)>1)&&a.push(`"${i}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),e.mountainTintColor!==void 0&&(typeof e.mountainTintColor!="string"||e.mountainTintColor.trim().length===0)&&a.push(`"${i}.mountainTintColor" must be a non-empty color string when provided.`),e.mountainTintBlendMode!==void 0&&e.mountainTintBlendMode!=="off"&&e.mountainTintBlendMode!=="normal"&&e.mountainTintBlendMode!=="multiply"&&e.mountainTintBlendMode!=="overlay"&&e.mountainTintBlendMode!=="soft-light"&&e.mountainTintBlendMode!=="screen"&&e.mountainTintBlendMode!=="color-dodge"&&a.push(`"${i}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),e.mountainTintOpacity!==void 0&&(!Number.isFinite(e.mountainTintOpacity)||Number(e.mountainTintOpacity)<0||Number(e.mountainTintOpacity)>1)&&a.push(`"${i}.mountainTintOpacity" must be in [0, 1] when provided.`),ar(e,i,a),e.themes!==void 0)if(!e.themes||typeof e.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(e.themes)){if(typeof o!="string"||o.trim().length===0){a.push(`"${i}.themes" contains an invalid theme key.`);continue}if(!c||typeof c!="object"){a.push(`"${i}.themes.${o}" must be an object.`);continue}c.mountainPath!==void 0&&(typeof c.mountainPath!="string"||!sr.test(c.mountainPath))&&a.push(`"${i}.themes.${o}.mountainPath" must be a /assets/... path when provided.`);const r=c;r.mountainScale!==void 0&&(!Number.isFinite(r.mountainScale)||Number(r.mountainScale)<=0)&&a.push(`"${i}.themes.${o}.mountainScale" must be > 0 when provided.`),r.mountainOffsetX!==void 0&&!Number.isFinite(r.mountainOffsetX)&&a.push(`"${i}.themes.${o}.mountainOffsetX" must be a finite number when provided.`),r.mountainOffsetY!==void 0&&!Number.isFinite(r.mountainOffsetY)&&a.push(`"${i}.themes.${o}.mountainOffsetY" must be a finite number when provided.`),r.mountainAnchorX!==void 0&&(!Number.isFinite(r.mountainAnchorX)||Number(r.mountainAnchorX)<0||Number(r.mountainAnchorX)>1)&&a.push(`"${i}.themes.${o}.mountainAnchorX" must be in [0, 1] when provided.`),r.mountainAnchorY!==void 0&&(!Number.isFinite(r.mountainAnchorY)||Number(r.mountainAnchorY)<0||Number(r.mountainAnchorY)>1)&&a.push(`"${i}.themes.${o}.mountainAnchorY" must be in [0, 1] when provided.`),r.mountainCrustBlendMode!==void 0&&r.mountainCrustBlendMode!=="off"&&r.mountainCrustBlendMode!=="normal"&&r.mountainCrustBlendMode!=="multiply"&&r.mountainCrustBlendMode!=="overlay"&&r.mountainCrustBlendMode!=="soft-light"&&r.mountainCrustBlendMode!=="screen"&&r.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${i}.themes.${o}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),r.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(r.mountainCrustBlendOpacity)||Number(r.mountainCrustBlendOpacity)<0||Number(r.mountainCrustBlendOpacity)>1)&&a.push(`"${i}.themes.${o}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),r.mountainTintBlendMode!==void 0&&r.mountainTintBlendMode!=="off"&&r.mountainTintBlendMode!=="normal"&&r.mountainTintBlendMode!=="multiply"&&r.mountainTintBlendMode!=="overlay"&&r.mountainTintBlendMode!=="soft-light"&&r.mountainTintBlendMode!=="screen"&&r.mountainTintBlendMode!=="color-dodge"&&a.push(`"${i}.themes.${o}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),r.mountainTintOpacity!==void 0&&(!Number.isFinite(r.mountainTintOpacity)||Number(r.mountainTintOpacity)<0||Number(r.mountainTintOpacity)>1)&&a.push(`"${i}.themes.${o}.mountainTintOpacity" must be in [0, 1] when provided.`),r.mountainTintColor!==void 0&&(typeof r.mountainTintColor!="string"||r.mountainTintColor.trim().length===0)&&a.push(`"${i}.themes.${o}.mountainTintColor" must be a non-empty color string when provided.`),ar(c,`${i}.themes.${o}`,a)}},$c=(e,i,a)=>{if(!e||typeof e!="object"){a.push(`"${i}" must be an object when provided.`);return}e.detailA!==void 0&&Fa(e.detailA,`${i}.detailA`,a),e.detailB!==void 0&&Fa(e.detailB,`${i}.detailB`,a),e.tint!==void 0&&WA(e.tint,`${i}.tint`,a),e.detailA===void 0&&e.detailB===void 0&&e.tint===void 0&&a.push(`"${i}" must define at least one of "detailA", "detailB", or "tint".`)},XA=(e,i,a)=>{if(!e||typeof e!="object"){a.push(`"${i}" must be an object when provided.`);return}if(e.seed!==void 0&&(typeof e.seed!="string"||e.seed.trim().length===0)&&a.push(`"${i}.seed" must be a non-empty string when provided.`),e.injectHazards!==void 0&&typeof e.injectHazards!="boolean"&&a.push(`"${i}.injectHazards" must be a boolean when provided.`),e.biomeLayers!==void 0){const o=e.biomeLayers;if(!o||typeof o!="object")a.push(`"${i}.biomeLayers" must be an object when provided.`);else if(o.undercurrent!==void 0&&Fa(o.undercurrent,`${i}.biomeLayers.undercurrent`,a),o.crust!==void 0&&Fa(o.crust,`${i}.biomeLayers.crust`,a),o.clutter!==void 0){const c=o.clutter;!c||typeof c!="object"?a.push(`"${i}.biomeLayers.clutter" must be an object when provided.`):(c.density!==void 0&&(!Number.isFinite(c.density)||Number(c.density)<0||Number(c.density)>1)&&a.push(`"${i}.biomeLayers.clutter.density" must be in [0, 1] when provided.`),c.maxPerHex!==void 0&&(!Number.isFinite(c.maxPerHex)||Number(c.maxPerHex)<0)&&a.push(`"${i}.biomeLayers.clutter.maxPerHex" must be >= 0 when provided.`),c.bleedScaleMax!==void 0&&(!Number.isFinite(c.bleedScaleMax)||Number(c.bleedScaleMax)<1||Number(c.bleedScaleMax)>2)&&a.push(`"${i}.biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.`),c.tags!==void 0&&(!Array.isArray(c.tags)||!c.tags.every(r=>typeof r=="string"&&r.length>0))&&a.push(`"${i}.biomeLayers.clutter.tags" must be a string array when provided.`))}}if(e.biomeMaterials!==void 0){const o=e.biomeMaterials;!o||typeof o!="object"?a.push(`"${i}.biomeMaterials" must be an object when provided.`):(o.undercurrent!==void 0&&$c(o.undercurrent,`${i}.biomeMaterials.undercurrent`,a),o.crust!==void 0&&$c(o.crust,`${i}.biomeMaterials.crust`,a))}if(e.walls!==void 0&&s0(e.walls,`${i}.walls`,a),e.assetOverrides!==void 0)if(!e.assetOverrides||typeof e.assetOverrides!="object")a.push(`"${i}.assetOverrides" must be an object when provided.`);else for(const[o,c]of Object.entries(e.assetOverrides)){if(!n0.test(o)){a.push(`"${i}.assetOverrides" contains invalid asset id "${o}".`);continue}if(!c||typeof c!="object"){a.push(`"${i}.assetOverrides.${o}" must be an object.`);continue}c.mountainSettings!==void 0&&ar(c.mountainSettings,`${i}.assetOverrides.${o}.mountainSettings`,a)}},QA=e=>{const i=[];if(!e||typeof e!="object")return{valid:!1,errors:["Manifest is not an object."]};const a=e;if((typeof a.version!="string"||a.version.length===0)&&i.push('Missing or invalid "version".'),a.gridTopology!=="flat-top-hex"&&i.push('Only "flat-top-hex" gridTopology is supported.'),(!Number.isFinite(a.tileUnitPx)||Number(a.tileUnitPx)<=0)&&i.push('Missing or invalid "tileUnitPx".'),(!Number.isFinite(a.tileAspectRatio)||Number(a.tileAspectRatio)<=0)&&i.push('Missing or invalid "tileAspectRatio".'),a.biomeUnderlay!==void 0&&Fa(a.biomeUnderlay,"biomeUnderlay",i),a.biomeLayers!==void 0){const c=a.biomeLayers;if(!c||typeof c!="object")i.push('"biomeLayers" must be an object when provided.');else if(c.undercurrent!==void 0&&Fa(c.undercurrent,"biomeLayers.undercurrent",i),c.crust!==void 0&&Fa(c.crust,"biomeLayers.crust",i),!c.undercurrent&&!c.crust&&i.push('"biomeLayers" must define at least one of "undercurrent" or "crust".'),c.clutter!==void 0){const r=c.clutter;!r||typeof r!="object"?i.push('"biomeLayers.clutter" must be an object when provided.'):(r.density!==void 0&&(!Number.isFinite(r.density)||Number(r.density)<0||Number(r.density)>1)&&i.push('"biomeLayers.clutter.density" must be in [0, 1] when provided.'),r.maxPerHex!==void 0&&(!Number.isFinite(r.maxPerHex)||Number(r.maxPerHex)<0)&&i.push('"biomeLayers.clutter.maxPerHex" must be >= 0 when provided.'),r.bleedScaleMax!==void 0&&(!Number.isFinite(r.bleedScaleMax)||Number(r.bleedScaleMax)<1||Number(r.bleedScaleMax)>2)&&i.push('"biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.'),r.tags!==void 0&&(!Array.isArray(r.tags)||!r.tags.every(f=>typeof f=="string"&&f.length>0))&&i.push('"biomeLayers.clutter.tags" must be a string array when provided.'))}}if(a.biomeMaterials!==void 0){const c=a.biomeMaterials;!c||typeof c!="object"?i.push('"biomeMaterials" must be an object when provided.'):(c.undercurrent!==void 0&&$c(c.undercurrent,"biomeMaterials.undercurrent",i),c.crust!==void 0&&$c(c.crust,"biomeMaterials.crust",i),c.undercurrent===void 0&&c.crust===void 0&&i.push('"biomeMaterials" must define at least one of "undercurrent" or "crust".'))}if(a.walls!==void 0&&s0(a.walls,"walls",i),a.biomePresets!==void 0)if(!a.biomePresets||typeof a.biomePresets!="object")i.push('"biomePresets" must be an object when provided.');else for(const[c,r]of Object.entries(a.biomePresets)){if(typeof c!="string"||c.trim().length===0){i.push('"biomePresets" contains an invalid theme key.');continue}XA(r,`biomePresets.${c}`,i)}if(!Array.isArray(a.layers)||a.layers.length===0||!a.layers.every(fy))i.push('Missing or invalid "layers".');else for(const c of Df)a.layers.includes(c)||i.push(`Missing required layer "${c}" in "layers".`);if(!Array.isArray(a.assets))return i.push('Missing or invalid "assets".'),{valid:i.length===0,errors:i};const o=new Set;for(const[c,r]of a.assets.entries()){const f=`assets[${c}]`;if(!r||typeof r!="object"){i.push(`${f} is not an object.`);continue}const h=r;if(typeof h.id!="string"||!n0.test(h.id)?i.push(`${f}.id is invalid; expected lowercase tokenized id.`):o.has(h.id)?i.push(`${f}.id is duplicated (${h.id}).`):o.add(h.id),my(h.type)||i.push(`${f}.type is invalid.`),fy(h.layer)||i.push(`${f}.layer is invalid.`),py(h.recommendedFormat)||i.push(`${f}.recommendedFormat is invalid.`),my(h.type)&&py(h.recommendedFormat)&&((h.type==="tile"||h.type==="decal"||h.type==="prop")&&!ly.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${ly.join(", ")} for ${h.type}.`),h.type==="ui"&&!cy.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${cy.join(", ")} for ui.`),h.type==="unit"&&!oy.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${oy.join(", ")} for units.`),h.type==="fx"&&!ry.includes(h.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${ry.join(", ")} for fx.`)),(typeof h.path!="string"||!sr.test(h.path))&&i.push(`${f}.path is invalid; expected /assets/...`),(!Number.isFinite(h.width)||Number(h.width)<=0)&&i.push(`${f}.width must be > 0.`),(!Number.isFinite(h.height)||Number(h.height)<=0)&&i.push(`${f}.height must be > 0.`),h.mountainSettings!==void 0&&ar(h.mountainSettings,`${f}.mountainSettings`,i),h.mountainSettingsByTheme!==void 0)if(!h.mountainSettingsByTheme||typeof h.mountainSettingsByTheme!="object")i.push(`${f}.mountainSettingsByTheme must be an object when provided.`);else for(const[b,y]of Object.entries(h.mountainSettingsByTheme)){if(typeof b!="string"||b.trim().length===0){i.push(`${f}.mountainSettingsByTheme contains an invalid theme key.`);continue}ar(y,`${f}.mountainSettingsByTheme.${b}`,i)}}return{valid:i.length===0,errors:i}},JA=async()=>Mc||(Mc=fetch(YA).then(async e=>{if(!e.ok)throw new Error(`Asset manifest fetch failed: ${e.status}`);return e.json()}).then(e=>{const i=QA(e);return i.valid?GA(e):(console.warn("[HOP_ASSETS] Invalid manifest; using fallback.",i.errors),dy)}).catch(e=>(console.warn("[HOP_ASSETS] Failed to load manifest; using fallback.",e),dy)),Mc),Hf=(e,i)=>{if(!e)return;const a=String(i||"").toLowerCase();if(a)return e.biomePresets?.[a]},ZA=[7,11],hy=(e,i,a)=>e<i?i:e>a?a:e,eT=e=>({top:Math.max(0,Number(e?.top??0)),right:Math.max(0,Number(e?.right??0)),bottom:Math.max(0,Number(e?.bottom??0)),left:Math.max(0,Number(e?.left??0))}),Pf=e=>{const i=eT(e.insets),a=Math.max(1,Number(e.width||0)-i.left-i.right),o=Math.max(1,Number(e.height||0)-i.top-i.bottom);return{width:a,height:o,insets:i}},tT=(e,i,a=0)=>{const o=Math.max(1,i),c=1.5*o,r=2*o;return(Math.max(1,e)-1)*c+r+Math.max(0,a)*2},nT=(e,i,a,o=0)=>{const c=Pf(e),r=tT(i,a,o);return c.width/Math.max(1,r)},iT=(e,i)=>{const a=Pf(e),o=Math.max(1,i.width),c=Math.max(1,i.height);return Math.min(a.width/o,a.height/c)},sT=(e,i)=>({x:e.x-i,y:e.y-i,width:e.width+i*2,height:e.height+i*2}),aT=(e,i)=>{const a=Math.max(1e-6,e),o=Math.max(1e-6,i);return Math.max(a,o)},gy=(e,i)=>{const a=Pf(e),o=Math.max(1e-6,i);return{width:a.width/o,height:a.height/o}},oT=(e,i,a)=>{const o=i.width/2,c=i.height/2,r=a.x+o,f=a.x+a.width-o,h=a.y+c,b=a.y+a.height-c;return{x:r>f?a.x+a.width/2:hy(e.x,r,f),y:h>b?a.y+a.height/2:hy(e.y,h,b)}},yy=(e,i)=>({x:e.x-i.width/2,y:e.y-i.height/2,width:i.width,height:i.height}),Pc=e=>{let i=2166136261;for(let a=0;a<e.length;a++)i^=e.charCodeAt(a),i=Math.imul(i,16777619);return i>>>0},Yl=e=>Pc(e)/4294967295,lT=e=>{const i=(e.tags||[]).map(o=>o.toLowerCase()),a=[e.id.toLowerCase(),...i];for(const o of a){const c=o.match(/(?:cluster|hex)[-_]?([123])\b/);if(c)return Number(c[1]);if(o.includes("1-hex")||o.includes("single"))return 1;if(o.includes("2-hex")||o.includes("double"))return 2;if(o.includes("3-hex")||o.includes("triple"))return 3}return 1},Oc=(e,i)=>{if(e)return i&&e.themes?.[i]?e.themes[i]:e.default},Cc=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"cover":"off",mf=e=>Math.min(1,Math.max(0,Number(e?.opacity??1))),Nc=(e,i,a=64,o=Number.POSITIVE_INFINITY)=>{const c=Number(e?.scalePx||i);return Math.min(o,Math.max(a,c))},by=e=>({x:Number(e?.scroll?.x??0),y:Number(e?.scroll?.y??0),durationMs:Math.max(1e3,Number(e?.scroll?.durationMs??18e3))}),rT=(e,i)=>{if(e)return i&&e.themes?.[i]?e.themes[i]:e.default},cT=e=>Math.min(1,Math.max(0,Number(e?.opacity??0))),a0=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",o0=(e,i="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[r,f,h]=a.slice(1).split("");return`#${r}${r}${f}${f}${h}${h}`.toLowerCase()}return i},uT=e=>{const a=o0(e).slice(1);return{r:parseInt(a.slice(0,2),16)/255,g:parseInt(a.slice(2,4),16)/255,b:parseInt(a.slice(4,6),16)/255}},dT=e=>e.replace(/[^a-zA-Z0-9_-]/g,"-"),xy=(e,i)=>e==="off"?"off":e?a0(e):i,pf=e=>{const i=[];for(let a=0;a<6;a++){const o=Math.PI/180*(60*a);i.push(`${e*Math.cos(o)},${e*Math.sin(o)}`)}return i.join(" ")},l0=({gameState:e,onMove:i,selectedSkillId:a,showMovementRange:o,onBusyStateChange:c,assetManifest:r,biomeDebug:f,onSimulationEvents:h,onMirrorSnapshot:b,enginePreviewGhost:y,cameraSafeInsetsPx:A})=>{const[v,S]=w.useState(!1),[_,p]=w.useState(null),[g,R]=w.useState(!1),[I,C]=w.useState(!1),[M,N]=w.useState([]),[Y,X]=w.useState(11),[O,q]=w.useState({width:0,height:0}),[K,ue]=w.useState(!1),G=w.useRef(null),_e=w.useRef(null),oe=w.useRef([]),be=w.useRef(!1),pe=w.useRef([]),H=w.useRef(0),ee=w.useRef(""),ae=w.useRef(0),Te=w.useRef(0),xe=w.useRef(0),k=w.useRef(null),$=w.useRef(null),J=w.useRef({x:0,y:0}),me=w.useRef(!1),Me=w.useRef(!1),Re=w.useRef(0),ke=w.useRef(new Map),ht=w.useRef({activePointerId:null,startClient:null,lastWorld:null,didPan:!1}),$e=w.useRef(null),kt=w.useRef(null),vn=w.useRef(null),St=w.useRef(!1),nn=w.useRef(""),At=w.useRef(""),Un=w.useRef(11),hi=w.useRef(!1),Ue=e.player.position,Le=w.useMemo(()=>{let E=e.rooms?.[0]?.hexes;if(!E||E.length===0){E=[];for(let B=0;B<e.gridWidth;B++)for(let z=0;z<e.gridHeight;z++)E.push({q:B,r:z,s:-B-z})}return E.filter(B=>Uc(B.q,B.r,e.gridWidth,e.gridHeight))},[e.rooms,e.gridWidth,e.gridHeight]);w.useEffect(()=>{if(e.visualEvents?.find(B=>B.type==="shake")){S(!0);const B=setTimeout(()=>S(!1),200);return()=>clearTimeout(B)}},[e.visualEvents]);const qe=w.useMemo(()=>{if(Le.length===0)return{minX:0,minY:0,width:100,height:100};let E=1/0,B=1/0,z=-1/0,le=-1/0;return Le.forEach(re=>{const{x:fe,y:ye}=dt(re,se);E=Math.min(E,fe-se),B=Math.min(B,ye-se),z=Math.max(z,fe+se),le=Math.max(le,ye+se)}),{minX:E,minY:B,width:z-E,height:le-B}},[Le]),Tn=w.useMemo(()=>{const{x:E,y:B}=dt(Ue,se);return{x:E,y:B}},[Ue]),Qt=w.useMemo(()=>({x:qe.minX,y:qe.minY,width:qe.width,height:qe.height}),[qe.minX,qe.minY,qe.width,qe.height]),En=w.useCallback(()=>{$.current!==null&&(window.cancelAnimationFrame($.current),$.current=null),hi.current=!1},[]),Vt=w.useCallback(E=>{const B=G.current;B&&B.setAttribute("viewBox",`${E.x} ${E.y} ${E.width} ${E.height}`)},[]),Ve=w.useCallback(E=>{k.current=E,Vt(E.viewBox)},[Vt]),Yt=w.useCallback(E=>{const B=Math.max(1,O.width),z=Math.max(1,O.height),le=E?.zoomPreset??Y,re=E?.panOffset??J.current,ye={width:B,height:z,insets:A||{}},Xe=se*.75,et=sT(Qt,Xe),Dt=nT(ye,le,se,se*.2),zt=iT(ye,et),Tt=aT(zt,Dt),ct=gy(ye,Tt),gt={x:Tn.x+re.x,y:Tn.y+re.y},$t=oT(gt,ct,et),It=yy($t,ct);return{center:$t,scale:Tt,viewBox:It}},[O.width,O.height,Y,A,Qt,Tn.x,Tn.y]),$i=w.useCallback((E,B=220)=>{const z=k.current;if(!z){Ve(E);return}En();const le=z.center,re=z.scale,fe=E.center,ye=E.scale,Xe=performance.now();hi.current=!0;const et=zt=>1-Math.pow(1-zt,3),Dt=zt=>{const Tt=Math.min(1,(zt-Xe)/Math.max(1,B)),ct=et(Tt),gt=re+(ye-re)*ct,$t={x:le.x+(fe.x-le.x)*ct,y:le.y+(fe.y-le.y)*ct},It={width:Math.max(1,O.width),height:Math.max(1,O.height),insets:A||{}},Dn=gy(It,gt),Si=yy($t,Dn);Ve({center:$t,scale:gt,viewBox:Si}),Tt<1?$.current=window.requestAnimationFrame(Dt):($.current=null,hi.current=!1,Ve(E))};$.current=window.requestAnimationFrame(Dt)},[En,Ve,O.width,O.height,A]),kn=w.useCallback(E=>{En(),Ve(Yt(E))},[En,Ve,Yt]),pn=w.useCallback(E=>{const B=Yt(E);$i(B,E?.durationMs??220)},[$i,Yt]);w.useEffect(()=>{const E=_e.current;if(!E)return;const B=()=>{const le=E.getBoundingClientRect();q(re=>{const fe=Math.round(le.width),ye=Math.round(le.height);return re.width===fe&&re.height===ye?re:{width:fe,height:ye}})};if(B(),typeof ResizeObserver>"u")return window.addEventListener("resize",B),()=>window.removeEventListener("resize",B);const z=new ResizeObserver(()=>B());return z.observe(E),()=>z.disconnect()},[]),w.useEffect(()=>{if(O.width<=0||O.height<=0)return;const E=`${Qt.x}:${Qt.y}:${Qt.width}:${Qt.height}`,B=`${O.width}:${O.height}:${A?.top??0}:${A?.right??0}:${A?.bottom??0}:${A?.left??0}`,z=he(e.player.position);if(!St.current){St.current=!0,kt.current=z,vn.current=e.floor??null,nn.current=B,At.current=E,Un.current=Y,kn({panOffset:{x:0,y:0}});return}if((e.floor??null)!==vn.current){vn.current=e.floor??null,At.current=E,nn.current=B,kt.current=z,Un.current=Y,J.current={x:0,y:0},kn({panOffset:{x:0,y:0}});return}if(e.floor!==void 0&&E!==At.current){At.current=E,nn.current=B,kt.current=z,Un.current=Y,J.current={x:0,y:0},kn({panOffset:{x:0,y:0}});return}if(B!==nn.current){nn.current=B,At.current=E,kn();return}if(Y!==Un.current){Un.current=Y,pn();return}if(z!==kt.current){kt.current=z;const le={x:0,y:0};J.current=le,pn({panOffset:le,durationMs:210});return}},[O.width,O.height,Qt.x,Qt.y,Qt.width,Qt.height,A,e.floor,e.player.position,Y,kn,pn]);const Vi=k.current?.viewBox||Qt,sn=w.useMemo(()=>{const E={};for(const B of e.visualEvents||[]){if(B.type!=="kinetic_trace")continue;const z=B.payload;z?.actorId&&(E[z.actorId]=z)}return E},[e.visualEvents]),Lt=w.useMemo(()=>{if(!o||a)return[];const E=["BASIC_MOVE","DASH"],B=new Set(e.player.activeSkills.map(re=>re.id)),z=new Set,le=[];for(const re of E){if(!B.has(re))continue;const fe=Rn.get(re);if(!fe?.getValidTargets)continue;const ye=fe.getValidTargets(e,Ue);for(const Xe of ye){const et=he(Xe);z.has(et)||(z.add(et),le.push(Xe))}}return le},[o,a,e,Ue]),Jt=w.useMemo(()=>{const E=new Set;for(const B of Lt)E.add(he(B));return E},[Lt]),an=w.useMemo(()=>e.player.activeSkills.some(E=>E.id==="BASIC_MOVE"||E.id==="DASH"),[e.player.activeSkills]),wt=w.useMemo(()=>he(e.stairsPosition),[e.stairsPosition]),wn=w.useMemo(()=>e.shrinePosition?he(e.shrinePosition):null,[e.shrinePosition]),_t=w.useMemo(()=>{const E=[{q:Ue.q+1,r:Ue.r,s:Ue.s-1},{q:Ue.q+1,r:Ue.r-1,s:Ue.s},{q:Ue.q,r:Ue.r-1,s:Ue.s+1},{q:Ue.q-1,r:Ue.r,s:Ue.s+1},{q:Ue.q-1,r:Ue.r+1,s:Ue.s},{q:Ue.q,r:Ue.r+1,s:Ue.s-1}],B=new Set;for(const z of E)Uc(z.q,z.r,e.gridWidth,e.gridHeight)&&B.add(he(z));return B},[Ue,e.gridWidth,e.gridHeight]),ga=w.useMemo(()=>{const E=new Set;if(!a)return E;const B=Rn.get(a);if(!B?.getValidTargets)return E;const z=B.getValidTargets(e,Ue);for(const le of z)E.add(he(le));return E},[a,e,Ue]),Yi=w.useMemo(()=>{if(y)return y;if(!_)return null;const E=he(_);if(o&&!a)return Jt.has(E)||!an&&_t.has(E)?{path:Ut(Ue,_),aoe:[],hasEnemy:!1,target:_}:null;if(!a)return null;const B=e.player.activeSkills.find(fe=>fe.id===a),z=mA(e,{actorId:e.player.id,skillId:a,target:_,activeUpgrades:B?.activeUpgrades||[]});if(!z.ok)return null;const le=new Map;for(const fe of z.simulationEvents)fe.position&&(fe.type!=="DamageTaken"&&fe.type!=="StatusApplied"&&fe.type!=="UnitMoved"||le.set(he(fe.position),fe.position));const re=z.simulationEvents.some(fe=>(fe.type==="DamageTaken"||fe.type==="StatusApplied")&&!!fe.targetId&&fe.targetId!==e.player.id);return{path:Ut(Ue,_),aoe:[...le.values()],hasEnemy:re,target:_}},[y,_,o,a,Jt,an,_t,e,Ue]),qn=w.useMemo(()=>{const E=new Map;for(const B of Le){const z=he(B),le=ze.getTraitsAt(e,B),re=le.has("BLOCKS_MOVEMENT")&&le.has("BLOCKS_LOS"),fe=le.has("LAVA")||le.has("HAZARDOUS")&&le.has("LIQUID"),ye=le.has("FIRE");E.set(z,{isWall:re,isLava:!re&&fe,isFire:!re&&ye})}return E},[Le,e.tiles]),Zt=w.useMemo(()=>{const E=new Map;for(const B of r?.assets||[])E.set(B.id,B);return E},[r]),Mt=w.useMemo(()=>Zt.get(HA())?.path,[Zt]),hn=w.useMemo(()=>Math.max(1,r?.tileUnitPx||256),[r?.tileUnitPx]),Ft=w.useMemo(()=>se*2/hn,[hn]),Fe=w.useMemo(()=>String(e.theme||"").toLowerCase(),[e.theme]),Ot=w.useMemo(()=>`${e.initialSeed||e.rngSeed||e.turnNumber}:${e.floor}:${Fe}`,[e.initialSeed,e.rngSeed,e.turnNumber,e.floor,Fe]),on=w.useMemo(()=>Hf(r,Fe),[r,Fe]),Li=w.useMemo(()=>{const E=r?.biomeUnderlay;if(E)return{default:E.default,themes:E.themes,mode:E.mode,scalePx:E.scalePx,opacity:E.opacity}},[r?.biomeUnderlay]),ft=w.useMemo(()=>on?.biomeLayers?.undercurrent||r?.biomeLayers?.undercurrent,[on?.biomeLayers?.undercurrent,r?.biomeLayers?.undercurrent]),qt=w.useMemo(()=>on?.biomeLayers?.crust||r?.biomeLayers?.crust||Li,[on?.biomeLayers?.crust,r?.biomeLayers?.crust,Li]),zn=w.useMemo(()=>on?.biomeLayers?.clutter||r?.biomeLayers?.clutter,[on?.biomeLayers?.clutter,r?.biomeLayers?.clutter]),gi=w.useMemo(()=>Oc(ft,Fe),[ft,Fe]),os=w.useMemo(()=>Cc(ft),[ft]),Fi=w.useMemo(()=>Nc(ft,hn,64,192),[ft,hn]),ks=w.useMemo(()=>mf(ft),[ft]),Ii=w.useMemo(()=>({x:Number(ft?.scroll?.x??120),y:Number(ft?.scroll?.y??90),durationMs:Math.max(1e3,Number(ft?.scroll?.durationMs??92e3))}),[ft?.scroll?.x,ft?.scroll?.y,ft?.scroll?.durationMs]),Ln=w.useMemo(()=>({x:Number(ft?.offsetX??0)+Number(f?.undercurrentOffset?.x??0),y:Number(ft?.offsetY??0)+Number(f?.undercurrentOffset?.y??0)}),[ft?.offsetX,ft?.offsetY,f?.undercurrentOffset?.x,f?.undercurrentOffset?.y]),yi=w.useMemo(()=>Oc(qt,Fe),[qt,Fe]),In=w.useMemo(()=>Cc(qt),[qt]),F=w.useMemo(()=>Nc(qt,hn,64),[qt,hn]),te=1,de=w.useMemo(()=>{const E=Math.max(0,Number(qt?.seedShiftPx??se*5));if(E===0)return{x:0,y:0};const B=Pc(`${Ot}|crust-offset`),z=((B&65535)/65535*2-1)*E,le=((B>>>16&65535)/65535*2-1)*E;return{x:z,y:le}},[qt?.seedShiftPx,Ot]),we=w.useMemo(()=>({x:Number(qt?.offsetX??0)+Number(f?.crustOffset?.x??0),y:Number(qt?.offsetY??0)+Number(f?.crustOffset?.y??0)}),[qt?.offsetX,qt?.offsetY,f?.crustOffset?.x,f?.crustOffset?.y]),ve=w.useMemo(()=>({x:de.x+we.x,y:de.y+we.y}),[de.x,de.y,we.x,we.y]),Ie=w.useMemo(()=>r?.walls,[r?.walls]),Ye=w.useMemo(()=>on?.walls||Ie?.themes?.[Fe],[on?.walls,Ie?.themes,Fe]),Ct=w.useMemo(()=>on?.biomeMaterials?.crust||r?.biomeMaterials?.crust,[on?.biomeMaterials?.crust,r?.biomeMaterials?.crust]),lt=w.useMemo(()=>Ct?.detailA,[Ct?.detailA]),Ke=w.useMemo(()=>Ct?.detailB,[Ct?.detailB]),rt=w.useMemo(()=>Oc(lt,Fe),[lt,Fe]),Kt=w.useMemo(()=>Oc(Ke,Fe),[Ke,Fe]),Bn=w.useMemo(()=>Cc(lt),[lt]),Nt=w.useMemo(()=>Cc(Ke),[Ke]),ls=w.useMemo(()=>Nc(lt,F,64),[lt,F]),ya=w.useMemo(()=>Nc(Ke,F,64),[Ke,F]),Fn=w.useMemo(()=>mf(lt),[lt]),ti=w.useMemo(()=>mf(Ke),[Ke]),ba=w.useMemo(()=>by(lt),[lt?.scroll?.x,lt?.scroll?.y,lt?.scroll?.durationMs]),Ls=w.useMemo(()=>by(Ke),[Ke?.scroll?.x,Ke?.scroll?.y,Ke?.scroll?.durationMs]),xa=w.useMemo(()=>{const E=se*.75,B=Pc(`${Ot}|crust-detail-a-offset`),z=((B&65535)/65535*2-1)*E,le=((B>>>16&65535)/65535*2-1)*E;return{x:z,y:le}},[Ot]),Wa=w.useMemo(()=>{const E=se*.75,B=Pc(`${Ot}|crust-detail-b-offset`),z=((B&65535)/65535*2-1)*E,le=((B>>>16&65535)/65535*2-1)*E;return{x:z,y:le}},[Ot]),ni=w.useMemo(()=>({x:ve.x+xa.x,y:ve.y+xa.y}),[ve.x,ve.y,xa.x,xa.y]),ii=w.useMemo(()=>({x:ve.x+Wa.x,y:ve.y+Wa.y}),[ve.x,ve.y,Wa.x,Wa.y]),jn=w.useMemo(()=>Ct?.tint,[Ct?.tint]),Sn=w.useMemo(()=>rT(jn,Fe),[jn,Fe]),va=w.useMemo(()=>cT(jn),[jn?.opacity]),Xa=w.useMemo(()=>a0(jn?.blendMode),[jn?.blendMode]),rs=!!(Sn&&va>0),Ho=w.useMemo(()=>rs?Math.min(.55,Math.max(.15,va*.9)):0,[rs,va]),Ki=w.useCallback(E=>{const B=E?.mountainSettings,z=E?.mountainSettingsByTheme?.[Fe],re=(E?on?.assetOverrides?.[E.id]:void 0)?.mountainSettings,fe=Math.min(3,Math.max(.2,Number(f?.mountainScale??re?.scale??z?.scale??Ye?.scale??Ie?.scale??B?.scale??.95))),ye=Number(f?.mountainOffset?.x??re?.offsetX??z?.offsetX??Ye?.offsetX??Ie?.offsetX??B?.offsetX??0),Xe=Number(f?.mountainOffset?.y??re?.offsetY??z?.offsetY??Ye?.offsetY??Ie?.offsetY??B?.offsetY??0),et=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.x??re?.anchorX??z?.anchorX??Ye?.anchorX??Ie?.anchorX??B?.anchorX??.5))),Dt=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.y??re?.anchorY??z?.anchorY??Ye?.anchorY??Ie?.anchorY??B?.anchorY??.78))),zt=xy(f?.mountainCrustBlendMode??re?.crustBlendMode??z?.crustBlendMode??Ye?.crustBlendMode??Ie?.crustBlendMode??B?.crustBlendMode,Xa),Tt=Math.min(1,Math.max(0,Number(f?.mountainCrustBlendOpacity??re?.crustBlendOpacity??z?.crustBlendOpacity??Ye?.crustBlendOpacity??Ie?.crustBlendOpacity??B?.crustBlendOpacity??Ho))),ct=o0(String(f?.mountainTintColor??re?.tintColor??z?.tintColor??Ye?.tintColor??Ie?.tintColor??B?.tintColor??Sn??"#8b6f4a")),gt=xy(f?.mountainTintBlendMode??re?.tintBlendMode??z?.tintBlendMode??Ye?.tintBlendMode??Ie?.tintBlendMode??B?.tintBlendMode,"soft-light"),$t=Math.min(1,Math.max(0,Number(f?.mountainTintOpacity??re?.tintOpacity??z?.tintOpacity??Ye?.tintOpacity??Ie?.tintOpacity??B?.tintOpacity??0))),It=uT(ct);return{scale:fe,offsetX:ye,offsetY:Xe,anchorX:et,anchorY:Dt,crustBlendMode:zt,crustBlendOpacity:Tt,tintColor:ct,tintBlendMode:gt,tintOpacity:$t,tintMatrixValues:`0 0 0 0 ${It.r.toFixed(4)} 0 0 0 0 ${It.g.toFixed(4)} 0 0 0 0 ${It.b.toFixed(4)} 0 0 0 1 0`}},[Fe,f?.mountainScale,f?.mountainOffset?.x,f?.mountainOffset?.y,f?.mountainAnchor?.x,f?.mountainAnchor?.y,f?.mountainCrustBlendMode,f?.mountainCrustBlendOpacity,f?.mountainTintColor,f?.mountainTintBlendMode,f?.mountainTintOpacity,on?.assetOverrides,Ie,Ye,Xa,Sn,Ho]),Gc=!!(rt&&Bn!=="off"&&Fn>0||Kt&&Nt!=="off"&&ti>0||rs),Kn=!!(gi&&os!=="off"||yi&&In!=="off"||Gc),Qa=w.useMemo(()=>`biome-undercurrent-${e.floor}`,[e.floor]),Po=w.useMemo(()=>`biome-crust-${e.floor}`,[e.floor]),bi=w.useMemo(()=>`biome-crust-mask-${e.floor}`,[e.floor]),cs=w.useMemo(()=>`biome-crust-detail-a-${e.floor}`,[e.floor]),Uo=w.useMemo(()=>`biome-crust-detail-b-${e.floor}`,[e.floor]),or=!!(yi&&In!=="off"||rt&&Bn!=="off"&&Fn>0||Kt&&Nt!=="off"&&ti>0||rs),Is=w.useMemo(()=>{const E=[];for(const B of Le){const z=he(B),le=qn.get(z);if(!le||!le.isLava&&!le.isFire)continue;const{x:re,y:fe}=dt(B,se);E.push({key:z,x:re,y:fe})}return E},[Le,qn]),lr=w.useMemo(()=>{const E=ty({isStairs:!0});return E?Zt.get(E):void 0},[Zt]),qo=w.useMemo(()=>{const E=ty({isShrine:!0});return E?Zt.get(E):void 0},[Zt]),Ja=w.useMemo(()=>{const E=[];return e.stairsPosition&&E.push({id:`stairs-${he(e.stairsPosition)}`,kind:"stairs",position:e.stairsPosition,asset:lr}),e.shrinePosition&&E.push({id:`shrine-${he(e.shrinePosition)}`,kind:"shrine",position:e.shrinePosition,asset:qo}),E},[e.stairsPosition,e.shrinePosition,lr,qo]),Gi=w.useMemo(()=>{const B=(r?.assets||[]).filter(fe=>{if(fe.type!=="prop")return!1;const ye=fe.id.toLowerCase(),Xe=new Set((fe.tags||[]).map(zt=>zt.toLowerCase()));if(!(ye.includes("mountain")||Xe.has("mountain")))return!1;if(!fe.theme)return!0;const Dt=fe.theme.toLowerCase();return Dt===Fe||Dt==="core"}).sort((fe,ye)=>fe.id.localeCompare(ye.id)),z=String(Ye?.mountainPath||Ie?.mountainPath||"").trim(),le=String(f?.mountainAssetPath||z).trim();if(!le)return B;const re=B.find(fe=>fe.path===le);return re?[re]:[]},[r?.assets,Fe,f?.mountainAssetPath,Ie?.mountainPath,Ye?.mountainPath]),zo=w.useMemo(()=>{const E=new Map;for(const B of Gi)E.set(B.id,Ki(B));return E},[Gi,Ki]),Za=w.useMemo(()=>{if(!Gi.length)return[];const E=Gi.filter(le=>lT(le)===1),B=E.length?E:Gi,z=Le.filter(le=>qn.get(he(le))?.isWall).sort((le,re)=>he(le).localeCompare(he(re)));return z.length?z.map(le=>{const re=he(le),fe=Math.floor(Yl(`${Ot}|mountain-tile|${re}|asset`)*B.length)%B.length,ye=B[fe],Xe=zo.get(ye.id)||Ki(ye),{y:et}=dt(le,se);return{id:`mountain-${re}-${ye.id}`,kind:"mountain",position:le,asset:ye,renderScale:Xe.scale,zAnchorY:et+se*.42+Xe.offsetY}}):[]},[Gi,Le,qn,Ot,zo,Ki]),Wi=w.useMemo(()=>{const E=new Set((zn?.tags?.length?zn.tags:["clutter","obstacle"]).map(B=>B.toLowerCase()));return(r?.assets||[]).filter(B=>{if(B.type!=="prop"&&B.type!=="decal"||B.id.toLowerCase().includes("mountain"))return!1;const le=(B.tags||[]).map(re=>re.toLowerCase());return le.includes("mountain")||!le.some(re=>E.has(re))?!1:B.theme?B.theme.toLowerCase()===Fe||B.theme.toLowerCase()==="core":!0})},[r?.assets,zn?.tags,Fe]),xi=w.useMemo(()=>{if(!Wi.length)return[];const E=Math.min(.6,Math.max(0,Number(zn?.density??.08))),B=Math.max(1,Math.floor(Number(zn?.maxPerHex??1))),z=Math.min(2,Math.max(1,Number(zn?.bleedScaleMax??2))),le=[];for(const re of Le){const fe=he(re),ye=qn.get(fe);if(ye?.isWall||ye?.isLava||ye?.isFire)continue;const{y:Xe}=dt(re,se);for(let et=0;et<B;et++){if(Yl(`${Ot}|clutter|${fe}|slot:${et}|roll`)>E/(et+1))continue;const zt=Math.floor(Yl(`${Ot}|clutter|${fe}|slot:${et}|pick`)*Wi.length)%Wi.length,Tt=Wi[zt],ct=1+Yl(`${Ot}|clutter|${fe}|slot:${et}|scale`)*(z-1),gt=(Yl(`${Ot}|clutter|${fe}|slot:${et}|depth`)-.5)*se*.28;le.push({id:`clutter-${fe}-${et}-${Tt.id}`,kind:"clutter",position:re,asset:Tt,renderScale:ct,zAnchorY:Xe+gt})}}return le},[Le,qn,Wi,zn?.density,zn?.maxPerHex,zn?.bleedScaleMax,Ot]),$o=w.useMemo(()=>{const E=[...Za,...xi];for(const B of Ja){const{y:z}=dt(B.position,se),le=B.kind==="shrine";E.push({id:B.id,kind:B.kind,position:B.position,asset:B.asset,renderScale:Math.min(2,le?1.5:1.42),zAnchorY:z+(le?se*.32:se*.28),fallback:B.kind})}return E.sort((B,z)=>B.zAnchorY===z.zAnchorY?B.id.localeCompare(z.id):B.zAnchorY-z.zAnchorY),E},[Za,xi,Ja]),Vo=w.useMemo(()=>{const E=new Set;for(const B of Za)E.add(he(B.position));return E},[Za]),Xi=w.useCallback(E=>{if(!E)return null;const B=E.position||E.destination||E.origin||E.target;return B&&typeof B.q=="number"&&typeof B.r=="number"&&typeof B.s=="number"?B:null},[]);w.useEffect(()=>{if(!Mt)return;const E=e.timelineEvents||[],B=e.visualEvents||[];E.length<ae.current&&(ae.current=0);const z=E.slice(ae.current);ae.current=E.length,B.length<Te.current&&(Te.current=0);const le=B.slice(Te.current);Te.current=B.length;const re=[],fe=Date.now();for(const ye of z){if(ye.phase!=="DEATH_RESOLVE")continue;const Xe=Xi(ye.payload);Xe&&re.push({id:`decal-tl-${ye.id}-${fe}-${re.length}`,position:Xe,href:Mt,createdAt:fe})}for(const ye of le){if(ye.type!=="vfx")continue;const Xe=ye.payload?.type;if(Xe!=="vaporize"&&Xe!=="explosion_ring")continue;const et=Xi(ye.payload);et&&re.push({id:`decal-vx-${Xe}-${fe}-${re.length}`,position:et,href:Mt,createdAt:fe})}re.length>0&&N(ye=>[...ye,...re].slice(-80))},[e.timelineEvents,e.visualEvents,Mt,Xi]),w.useEffect(()=>{const E=e.simulationEvents||[];E.length<xe.current&&(xe.current=0);const B=E.slice(xe.current);xe.current=E.length,B.length>0&&h?.(B)},[e.simulationEvents,h]),w.useEffect(()=>{if(M.length===0)return;const E=12e3,B=window.setTimeout(()=>{const z=Date.now();N(le=>le.filter(re=>z-re.createdAt<E))},1e3);return()=>window.clearTimeout(B)},[M]);const si=w.useCallback((E,B)=>{const z=G.current;if(!z||!z.getScreenCTM)return null;const le=z.getScreenCTM();if(!le)return null;const re=z.createSVGPoint();re.x=E,re.y=B;const fe=re.matrixTransform(le.inverse());return{x:fe.x,y:fe.y}},[]),Yo=w.useCallback(E=>{const B={x:J.current.x+E.x,y:J.current.y+E.y};J.current=B,En(),Ve(Yt({panOffset:B}))},[En,Ve,Yt]),us=w.useCallback(E=>{X(B=>B===E?B:E)},[]),rr=w.useCallback(()=>{J.current={x:0,y:0},pn({panOffset:{x:0,y:0},durationMs:220})},[pn]),Sa=w.useCallback(E=>{Date.now()<Re.current||i(E)},[i]),Bi=w.useCallback(E=>{me.current||Me.current||p(E)},[]),Qi=w.useCallback(()=>Array.from(ke.current.entries()),[]),Aa=w.useCallback(E=>{if(E.pointerType==="mouse"&&E.button!==0)return;ke.current.set(E.pointerId,{x:E.clientX,y:E.clientY});try{E.currentTarget.setPointerCapture(E.pointerId)}catch{}const B=Qi();if(B.length>=2){Me.current=!0,me.current=!1,ue(!1),ht.current.didPan=!0,Re.current=Date.now()+250;const[z,le]=B,re=z[1].x-le[1].x,fe=z[1].y-le[1].y;$e.current={startDistance:Math.hypot(re,fe),startPreset:Y,appliedPreset:Y};return}ht.current={activePointerId:E.pointerId,startClient:{x:E.clientX,y:E.clientY},lastWorld:si(E.clientX,E.clientY),didPan:!1}},[si,Qi,Y]),Ji=w.useCallback(E=>{if(!ke.current.has(E.pointerId))return;ke.current.set(E.pointerId,{x:E.clientX,y:E.clientY});const B=Qi();if(Me.current||B.length>=2){if(B.length>=2){Me.current=!0;const[Dt,zt]=B,Tt=Dt[1].x-zt[1].x,ct=Dt[1].y-zt[1].y,gt=Math.max(1,Math.hypot(Tt,ct));if(!$e.current)$e.current={startDistance:gt,startPreset:Y,appliedPreset:Y};else{const $t=gt/Math.max(1,$e.current.startDistance);let It=$e.current.startPreset;$t>1.08&&(It=7),$t<.92&&(It=11),It!==$e.current.appliedPreset&&($e.current.appliedPreset=It,us(It))}Re.current=Date.now()+250,E.preventDefault()}return}const z=ht.current;if(!z.startClient||z.activePointerId!==E.pointerId)return;const le=E.clientX-z.startClient.x,re=E.clientY-z.startClient.y,fe=Math.hypot(le,re);if(!z.didPan&&fe>10&&(z.didPan=!0,me.current=!0,ue(!0),Re.current=Date.now()+250,p(null)),!z.didPan)return;const Xe=si(E.clientX,E.clientY);if(!z.lastWorld||!Xe)return;const et={x:z.lastWorld.x-Xe.x,y:z.lastWorld.y-Xe.y};z.lastWorld=Xe,Yo(et),E.preventDefault()},[si,Qi,us,Yo,Y]),Bs=w.useCallback(E=>{ke.current.delete(E);const B=Qi();B.length<2&&(Me.current=!1,$e.current=null);const z=ht.current;z.activePointerId===E&&(z.didPan&&(Re.current=Date.now()+250),ht.current={activePointerId:B[0]?.[0]??null,startClient:B[0]?{...B[0][1]}:null,lastWorld:B[0]?si(B[0][1].x,B[0][1].y):null,didPan:!1}),ke.current.size===0&&(me.current=!1,ue(!1))},[si,Qi]),eo=w.useCallback(E=>{Bs(E.pointerId);try{E.currentTarget.releasePointerCapture(E.pointerId)}catch{}},[Bs]),cr=w.useCallback(E=>{Bs(E.pointerId)},[Bs]),to=w.useCallback(E=>{if((E.ctrlKey||E.deltaY!==0)&&E.preventDefault(),Math.abs(E.deltaY)<.1)return;const B=E.deltaY<0?7:11;us(B),Re.current=Date.now()+120},[us]);w.useEffect(()=>{c?.(g||I)},[g,I,c]);const ds=w.useMemo(()=>{const E=new Map;E.set(e.player.id,e.player.position);for(const B of e.enemies)E.set(B.id,B.position);for(const B of e.companions||[])E.set(B.id,B.position);for(const B of e.dyingEntities||[])E.set(B.id,B.position);return E},[e.player.id,e.player.position,e.enemies,e.companions,e.dyingEntities]),ur=w.useMemo(()=>[{id:e.player.id,position:e.player.position,subtype:e.player.subtype||"player"},...e.enemies.map(E=>({id:E.id,position:E.position,subtype:E.subtype})),...(e.companions||[]).map(E=>({id:E.id,position:E.position,subtype:E.subtype})),...(e.dyingEntities||[]).map(E=>({id:E.id,position:E.position,subtype:E.subtype}))],[e.player.id,e.player.position,e.player.subtype,e.enemies,e.companions,e.dyingEntities]);w.useEffect(()=>{if(!b)return;const E={turn:e.turnNumber||0,stackTick:e.stackTrace?.length||0,actors:[...ds.entries()].map(([B,z])=>({id:B,position:{q:z.q,r:z.r,s:z.s}}))};b(E)},[b,e.turnNumber,e.stackTrace,ds]);const ln=w.useMemo(()=>(e.visualEvents||[]).filter(E=>E.type==="kinetic_trace").map(E=>E.payload).filter(E=>{if(!E?.actorId||!E.origin||!E.destination)return!1;const B=ds.get(E.actorId);return!!B&&he(B)===he(E.destination)}),[e.visualEvents,ds]),vi=w.useMemo(()=>{if(!ln.length)return"";const E=e.turnNumber??0,B=ln.map(z=>{const le=(z.path||[]).map(re=>`${re.q},${re.r},${re.s}`).join(">");return[z.actorId,`${z.origin.q},${z.origin.r},${z.origin.s}`,`${z.destination.q},${z.destination.r},${z.destination.s}`,z.movementType||"slide",z.startDelayMs||0,z.durationMs||0,le].join("|")}).join("||");return`${E}::${B}`},[ln,e.turnNumber]),js=w.useCallback(async(E,B,z,le)=>{if(le!==H.current)return;const re=E.animate(B,{...z,fill:z.fill??"forwards"});pe.current.push(re);try{await re.finished}catch{}finally{pe.current=pe.current.filter(fe=>fe!==re)}},[]),Ds=w.useCallback(async(E,B,z)=>{if(B!==H.current)return;const le=.76,re=G.current?.querySelector(`[data-actor-node="${E.actorId}"]`),fe=Dn=>{const Si=dt(Dn,se);return`translate(${Si.x}px, ${Si.y}px)`},ye=Math.max(0,E.startDelayMs||0),Xe=Math.max(0,performance.now()-z),et=Math.round(ye*le),Dt=Math.max(0,et-Xe),zt=E.path&&E.path.length>1?E.path:[E.origin,E.destination],Tt=Math.max(1,zt.length-1),ct=Math.max(90,Math.round((E.durationMs||Tt*110)*le));if(!re){const Dn=Math.max(0,Dt+ct);Dn>0&&await new Promise(Si=>window.setTimeout(Si,Dn));return}if(Dt>0&&(await new Promise(Dn=>window.setTimeout(Dn,Dt)),B!==H.current))return;if((E.movementType||"slide")==="teleport"){const Dn=Math.max(100,Math.round((E.durationMs||180)*le));await js(re,[{transform:fe(E.origin),opacity:1,offset:0},{transform:fe(E.origin),opacity:0,offset:.45},{transform:fe(E.destination),opacity:0,offset:.55},{transform:fe(E.destination),opacity:1,offset:1}],{duration:Dn,easing:"linear"},B),B===H.current&&(re.style.transform=fe(E.destination),re.style.opacity="1");return}const gt=[...zt],$t=gt[gt.length-1];(!$t||$t.q!==E.destination.q||$t.r!==E.destination.r||$t.s!==E.destination.s)&&gt.push(E.destination);const It=gt.map((Dn,Si)=>({transform:fe(Dn),offset:gt.length===1?1:Si/(gt.length-1)}));It[It.length-1]={...It[It.length-1],transform:fe(E.destination),offset:1},await js(re,It,{duration:ct,easing:"linear"},B),B===H.current&&(re.style.transform=fe(E.destination),re.style.opacity="1")},[js]),dr=w.useCallback(async()=>{if(be.current)return;be.current=!0,R(!0);const E=++H.current,B=performance.now();try{for(;oe.current.length>0&&E===H.current;){const z=oe.current.shift();z&&await Ds(z,E,B)}}finally{E===H.current&&(be.current=!1,R(!1))}},[Ds]);w.useEffect(()=>{if(!vi){ee.current="";return}vi!==ee.current&&(ee.current=vi,oe.current.push(...ln),dr())},[vi,ln,dr]),w.useEffect(()=>()=>{En(),H.current++,oe.current=[],be.current=!1,pe.current.forEach(E=>{try{E.cancel()}catch{}}),pe.current=[],R(!1)},[En]),w.useEffect(()=>{En(),H.current++,oe.current=[],be.current=!1,pe.current.forEach(E=>{try{E.cancel()}catch{}}),pe.current=[],R(!1),ee.current="",N([]),ae.current=0,Te.current=0},[e.floor,En]);const Fo=w.useMemo(()=>pf(se-1),[]),Ko=w.useMemo(()=>pf(se+1),[]),Ta=w.useMemo(()=>pf(se-2),[]),Hs=w.useMemo(()=>`biome-map-clip-${e.floor}`,[e.floor]),De=w.useMemo(()=>({x:qe.minX-se*2,y:qe.minY-se*2,width:qe.width+se*4,height:qe.height+se*4}),[qe.minX,qe.minY,qe.width,qe.height]);return m.jsxs("div",{ref:_e,className:`relative w-full h-full flex justify-center items-center overflow-hidden transition-transform duration-75 ${v?"animate-shake":""} ${K?"cursor-grabbing":""}`,children:[m.jsxs("svg",{ref:G,width:"100%",height:"100%",viewBox:`${Vi.x} ${Vi.y} ${Vi.width} ${Vi.height}`,preserveAspectRatio:"xMidYMid meet",shapeRendering:"geometricPrecision",className:"max-h-full max-w-full",onMouseLeave:()=>p(null),onWheel:to,onPointerDown:Aa,onPointerMove:Ji,onPointerUp:eo,onPointerCancel:cr,style:{touchAction:"none"},children:[m.jsxs("defs",{children:[m.jsx("clipPath",{id:Hs,clipPathUnits:"userSpaceOnUse",children:Le.map(E=>{const{x:B,y:z}=dt(E,se);return m.jsx("polygon",{points:Ta,transform:`translate(${B},${z})`},`biome-clip-${he(E)}`)})}),gi&&os==="repeat"&&m.jsxs("pattern",{id:Qa,patternUnits:"userSpaceOnUse",width:Fi,height:Fi,patternTransform:`translate(${Ln.x} ${Ln.y})`,children:[m.jsx("image",{href:gi,x:"0",y:"0",width:Fi,height:Fi,preserveAspectRatio:"xMidYMid slice"}),(Ii.x!==0||Ii.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${Ln.x} ${Ln.y}`,to:`${Ln.x+Ii.x} ${Ln.y+Ii.y}`,dur:`${Ii.durationMs}ms`,repeatCount:"indefinite"})]}),yi&&In==="repeat"&&m.jsx("pattern",{id:Po,patternUnits:"userSpaceOnUse",width:F,height:F,patternTransform:`translate(${ve.x} ${ve.y})`,children:m.jsx("image",{href:yi,x:"0",y:"0",width:F,height:F,preserveAspectRatio:"xMidYMid slice"})}),rt&&Bn==="repeat"&&m.jsxs("pattern",{id:cs,patternUnits:"userSpaceOnUse",width:ls,height:ls,patternTransform:`translate(${ni.x} ${ni.y})`,children:[m.jsx("image",{href:rt,x:"0",y:"0",width:ls,height:ls,preserveAspectRatio:"xMidYMid slice"}),(ba.x!==0||ba.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${ni.x} ${ni.y}`,to:`${ni.x+ba.x} ${ni.y+ba.y}`,dur:`${ba.durationMs}ms`,repeatCount:"indefinite"})]}),Kt&&Nt==="repeat"&&m.jsxs("pattern",{id:Uo,patternUnits:"userSpaceOnUse",width:ya,height:ya,patternTransform:`translate(${ii.x} ${ii.y})`,children:[m.jsx("image",{href:Kt,x:"0",y:"0",width:ya,height:ya,preserveAspectRatio:"xMidYMid slice"}),(Ls.x!==0||Ls.y!==0)&&m.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${ii.x} ${ii.y}`,to:`${ii.x+Ls.x} ${ii.y+Ls.y}`,dur:`${Ls.durationMs}ms`,repeatCount:"indefinite"})]}),or&&m.jsxs("mask",{id:bi,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:[m.jsx("rect",{x:De.x,y:De.y,width:De.width,height:De.height,fill:"white"}),Is.map(E=>m.jsx("polygon",{points:Ko,transform:`translate(${E.x},${E.y})`,fill:"black",opacity:1},`hole-${E.key}`))]})]}),m.jsxs("g",{"data-layer":"biome-undercurrent",pointerEvents:"none",clipPath:`url(#${Hs})`,children:[gi&&os==="repeat"&&m.jsx("rect",{x:De.x,y:De.y,width:De.width,height:De.height,fill:`url(#${Qa})`,opacity:ks}),gi&&os==="cover"&&m.jsx("image",{href:gi,x:De.x+Ln.x,y:De.y+Ln.y,width:De.width,height:De.height,preserveAspectRatio:"xMidYMid slice",opacity:ks})]}),m.jsxs("g",{"data-layer":"biome-crust",pointerEvents:"none",clipPath:`url(#${Hs})`,children:[yi&&In==="repeat"&&m.jsx("rect",{x:De.x,y:De.y,width:De.width,height:De.height,fill:`url(#${Po})`,opacity:te,mask:`url(#${bi})`}),yi&&In==="cover"&&m.jsx("image",{href:yi,x:De.x+ve.x,y:De.y+ve.y,width:De.width,height:De.height,preserveAspectRatio:"xMidYMid slice",opacity:te,mask:`url(#${bi})`}),rt&&Bn==="repeat"&&Fn>0&&m.jsx("rect",{x:De.x,y:De.y,width:De.width,height:De.height,fill:`url(#${cs})`,opacity:Fn,mask:`url(#${bi})`}),rt&&Bn==="cover"&&Fn>0&&m.jsx("image",{href:rt,x:De.x+ni.x,y:De.y+ni.y,width:De.width,height:De.height,preserveAspectRatio:"xMidYMid slice",opacity:Fn,mask:`url(#${bi})`}),Kt&&Nt==="repeat"&&ti>0&&m.jsx("rect",{x:De.x,y:De.y,width:De.width,height:De.height,fill:`url(#${Uo})`,opacity:ti,mask:`url(#${bi})`}),Kt&&Nt==="cover"&&ti>0&&m.jsx("image",{href:Kt,x:De.x+ii.x,y:De.y+ii.y,width:De.width,height:De.height,preserveAspectRatio:"xMidYMid slice",opacity:ti,mask:`url(#${bi})`}),rs&&Sn&&m.jsx("rect",{x:De.x,y:De.y,width:De.width,height:De.height,fill:Sn,opacity:va,mask:`url(#${bi})`,style:Xa!=="normal"?{mixBlendMode:Xa}:void 0})]}),m.jsx("g",{"data-layer":"interaction-preview",children:m.jsx(MA,{gameState:e,selectedSkillId:a,showMovementRange:o,hoveredTile:_,enginePreviewGhost:Yi})}),m.jsxs("g",{"data-layer":"interaction-tiles",children:[Le.map(E=>{const B=he(E),z=qn.get(B)||{isWall:!1,isLava:!1,isFire:!1},le=z.isWall,re=z.isLava,fe=z.isFire,ye=o&&!a&&Jt.has(B)||o&&!a&&!an&&_t.has(B)&&!le,et=!!a&&ga.has(B)||ye,Dt=B===wt,zt=wn?B===wn:!1,Tt=le&&!Vo.has(B),ct=Kn&&!Tt,gt=LA({isWall:Tt,isLava:re,isFire:fe,theme:e.theme}),$t=ct?void 0:Zt.get(gt)?.path;return m.jsx(AA,{hex:E,onClick:Sa,isValidMove:et,isTargeted:!1,isStairs:Dt,isLava:re,isFire:fe,isShrine:zt,isWall:Tt,onMouseEnter:Bi,assetHref:$t,interactionOnly:ct},B)}),m.jsx("g",{children:M.map(E=>{const{x:B,y:z}=dt(E.position,se),le=Date.now()-E.createdAt,re=Math.max(.18,.75-le/12e3*.57);return m.jsx("image",{href:E.href,x:B-se*.7,y:z-se*.7,width:se*1.4,height:se*1.4,preserveAspectRatio:"xMidYMid meet",opacity:re},E.id)})})]}),m.jsx("g",{"data-layer":"clutter-obstacles",pointerEvents:"none",children:$o.map(E=>{const{x:B,y:z}=dt(E.position,se);if(E.asset?.path){const le=Math.min(1,Math.max(0,E.asset.anchor?.x??.5)),re=Math.min(1,Math.max(0,E.asset.anchor?.y??.5)),fe=E.kind==="mountain",ye=fe?zo.get(E.asset.id)||Ki(E.asset):null,Xe=ye?ye.anchorX:le,et=ye?ye.anchorY:re,Dt=B+(ye?ye.offsetX:0),zt=z+(ye?ye.offsetY:0),Tt=Math.max(8,E.asset.width*Ft*E.renderScale),ct=Math.max(8,E.asset.height*Ft*E.renderScale),gt=E.kind==="shrine",$t=E.kind==="stairs",It=gt||$t,Dn=gt?"rgba(251,146,60,0.25)":"rgba(74,222,128,0.22)",Si=gt?"#fdba74":"#86efac",Go=B,fr=z-ct*et+ct*.84,mr=Math.max(14,Tt*.32),pr=Math.max(8,ct*.14);return m.jsxs("g",{children:[It&&m.jsxs(m.Fragment,{children:[m.jsx("ellipse",{cx:Go,cy:fr,rx:mr,ry:pr,fill:Dn,opacity:.95}),m.jsx("ellipse",{cx:Go,cy:fr,rx:mr*1.14,ry:pr*1.14,fill:"none",stroke:Si,strokeWidth:2,opacity:.72,style:{animation:`shrineGlow ${gt?1.8:2.4}s ease-in-out infinite`}})]}),(()=>{const Wc=It?gt?"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(251,146,60,0.45)) saturate(1.08) contrast(1.06)":"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(74,222,128,0.42)) saturate(1.08) contrast(1.06)":fe?"drop-shadow(0 7px 10px rgba(0,0,0,0.56)) saturate(1.04) contrast(1.08)":"drop-shadow(0 5px 8px rgba(0,0,0,0.48)) saturate(0.98) contrast(1.04)",Xc=It?.99:fe?.96:.9,Wo=!!(ye&&ye.crustBlendMode!=="off"&&ye.crustBlendOpacity>0),Xo=!!(ye&&ye.tintBlendMode!=="off"&&ye.tintOpacity>0),Qc=ye?.crustBlendMode!=="off"?ye?.crustBlendMode:void 0,Jc=ye?.tintBlendMode!=="off"?ye?.tintBlendMode:void 0,Ps=Dt-Tt*Xe,Zi=zt-ct*et,Qo=dT(E.id),Jo=`mountain-ground-gradient-${e.floor}-${Qo}`,Zo=`mountain-ground-mask-${e.floor}-${Qo}`,el=`mountain-tint-filter-${e.floor}-${Qo}`;return m.jsxs(m.Fragment,{children:[(Wo||Xo)&&m.jsxs("defs",{children:[Wo&&m.jsxs(m.Fragment,{children:[m.jsxs("linearGradient",{id:Jo,x1:"0",y1:"0",x2:"0",y2:"1",children:[m.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0"}),m.jsx("stop",{offset:"42%",stopColor:"#ffffff",stopOpacity:"0.04"}),m.jsx("stop",{offset:"64%",stopColor:"#ffffff",stopOpacity:"0.42"}),m.jsx("stop",{offset:"82%",stopColor:"#ffffff",stopOpacity:"0.82"}),m.jsx("stop",{offset:"100%",stopColor:"#ffffff",stopOpacity:"1"})]}),m.jsx("mask",{id:Zo,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:m.jsx("rect",{x:Ps,y:Zi,width:Tt,height:ct,fill:`url(#${Jo})`})})]}),Xo&&m.jsx("filter",{id:el,x:"-10%",y:"-10%",width:"120%",height:"120%",children:m.jsx("feColorMatrix",{type:"matrix",values:ye?.tintMatrixValues})})]}),m.jsx("image",{href:E.asset.path,x:Ps,y:Zi,width:Tt,height:ct,preserveAspectRatio:"xMidYMid meet",opacity:Xc,style:{filter:Wc}}),Wo&&m.jsx("image",{href:E.asset.path,x:Ps,y:Zi,width:Tt,height:ct,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.9,ye?.crustBlendOpacity||0),mask:`url(#${Zo})`,style:{mixBlendMode:Qc,filter:"brightness(0.92) saturate(0.76) contrast(1.03)"}}),Xo&&m.jsx("image",{href:E.asset.path,x:Ps,y:Zi,width:Tt,height:ct,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.95,ye?.tintOpacity||0),filter:`url(#${el})`,style:{mixBlendMode:Jc}})]})})()]},E.id)}return E.fallback==="shrine"?m.jsxs("g",{transform:`translate(${B},${z})`,children:[m.jsx("polygon",{points:"0,-18 8,-4 5,12 -5,12 -8,-4",fill:"#f97316",stroke:"#fff",strokeWidth:"1",opacity:"0.9"}),m.jsx("polygon",{points:"-2,-14 2,-14 1,-2 -1,-2",fill:"rgba(255,255,255,0.6)"}),m.jsx("circle",{cx:"0",cy:"0",r:"14",fill:"none",stroke:"#fdba74",strokeWidth:"2",opacity:"0.4",style:{animation:"shrineGlow 2s ease-in-out infinite"}})]},E.id):m.jsxs("g",{transform:`translate(${B},${z})`,children:[m.jsx("rect",{x:"-12",y:"6",width:"8",height:"4",fill:"#1f2937",rx:"1"}),m.jsx("rect",{x:"-6",y:"2",width:"8",height:"4",fill:"#374151",rx:"1"}),m.jsx("rect",{x:"0",y:"-2",width:"8",height:"4",fill:"#4b5563",rx:"1"}),m.jsx("rect",{x:"6",y:"-6",width:"8",height:"4",fill:"#6b7280",rx:"1"}),m.jsx("path",{d:"M 2 -14 L 2 -20 L -4 -20 L 2 -26 L 8 -20 L 2 -20",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1"})]},E.id)})}),m.jsxs("g",{children:[e.lastSpearPath&&e.lastSpearPath.length>=2&&(()=>{const B=e.lastSpearPath.map(z=>dt(z,se)).map((z,le)=>`${le===0?"M":"L"} ${z.x} ${z.y}`).join(" ");return m.jsx("path",{d:B,stroke:"rgba(255, 255, 255, 0.15)",strokeWidth:"2",fill:"none",strokeDasharray:"4 2",strokeLinecap:"round"})})(),e.spearPosition&&m.jsx(_c,{entity:{id:"spear",type:"player",subtype:"footman",position:e.spearPosition,hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],speed:0,factionId:"player"},isSpear:!0}),m.jsx(_c,{entity:e.player,movementTrace:sn[e.player.id],waapiControlled:!0,assetHref:Zt.get(Hc(e.player))?.path,fallbackAssetHref:ff(e.player),floorTheme:Fe},`player-${e.floor}`),e.enemies.map(E=>m.jsx(_c,{entity:E,movementTrace:sn[E.id],waapiControlled:!0,assetHref:Zt.get(Hc(E))?.path,fallbackAssetHref:ff(E),floorTheme:Fe},`${E.id}-${e.floor}`)),e.dyingEntities?.map(E=>m.jsx(_c,{entity:E,isDying:!0,movementTrace:sn[E.id],waapiControlled:!0,assetHref:Zt.get(Hc(E))?.path,fallbackAssetHref:ff(E),floorTheme:Fe},`dying-${E.id}-${e.floor}-${e.turnNumber}`)),m.jsx($A,{visualEvents:e.visualEvents||[],timelineEvents:e.timelineEvents||[],simulationEvents:e.simulationEvents||[],actorSnapshots:ur,onBusyStateChange:C,assetManifest:r})]}),m.jsx("g",{"data-layer":"interaction-ui-grid",pointerEvents:"none",shapeRendering:"crispEdges",children:Le.map(E=>{const{x:B,y:z}=dt(E,se);return m.jsx("g",{transform:`translate(${B},${z})`,children:m.jsx("polygon",{points:Fo,fill:"none",stroke:"rgba(201,224,255,0.12)",strokeWidth:.9})},`grid-${he(E)}`)})}),m.jsx("g",{"data-layer":"ui-objective-markers",pointerEvents:"none",children:Ja.map(E=>{const{x:B,y:z}=dt(E.position,se),le=E.kind==="shrine",re=le?"#c2410c":"#15803d",fe=le?"S":"E",ye=B+se*.52,Xe=z-se*.52;return m.jsxs("g",{transform:`translate(${ye},${Xe})`,children:[m.jsx("circle",{r:14,fill:"none",stroke:"rgba(255,255,255,0.55)",strokeWidth:2,style:{animation:`shrineGlow ${le?1.6:1.9}s ease-in-out infinite`}}),m.jsx("circle",{r:10.5,fill:re,stroke:"#ffffff",strokeWidth:2}),m.jsx("text",{x:0,y:0,textAnchor:"middle",dy:".34em",fill:"#ffffff",fontSize:10,fontWeight:900,style:{textShadow:"0 1px 2px rgba(0,0,0,0.7)"},children:fe})]},`marker-${E.id}`)})})]}),m.jsx("div",{className:"absolute top-2 right-2 sm:top-3 sm:right-3 z-30 flex items-center gap-1.5 pointer-events-auto",children:m.jsxs("div",{className:"flex items-center gap-1 rounded-xl border border-white/15 bg-black/35 backdrop-blur-sm p-1",children:[ZA.map(E=>{const B=Y===E;return m.jsx("button",{type:"button",onPointerDown:z=>z.stopPropagation(),onClick:()=>us(E),className:`px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest transition-colors ${B?"bg-white text-black":"bg-white/5 text-white/70 hover:bg-white/10"}`,"aria-label":`Set zoom to ${E} tiles wide`,children:E},`zoom-${E}`)}),m.jsx("button",{type:"button",onPointerDown:E=>E.stopPropagation(),onClick:rr,className:"px-2 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest bg-white/5 text-white/70 hover:bg-white/10","aria-label":"Reset camera to player",children:"Fit"})]})})]})},fT=({gameState:e})=>{const{initiativeQueue:i,player:a,enemies:o}=e;if(!i||!i.entries||i.entries.length===0)return null;const c=i.entries.map(r=>r.actorId===a.id?a:o.find(f=>f.id===r.actorId)).filter(r=>!!r);return m.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-white/5 border border-white/10 rounded-2xl backdrop-blur-md",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Turn Sequence"}),m.jsx("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-none",children:c.map((r,f)=>{const h=r.id===a.id,b=f===i.currentIndex,A=i.entries.find(v=>v.actorId===r.id)?.hasActed;return m.jsxs("div",{className:`flex flex-col items-center shrink-0 transition-all duration-300 ${b?"scale-110":"opacity-60 scale-90"}`,children:[m.jsxs("div",{className:`
                                w-10 h-10 rounded-xl flex items-center justify-center border-2 transition-all relative
                                ${h?"bg-blue-500/20 border-blue-500/50":"bg-red-500/20 border-red-500/50"}
                                ${b?"shadow-[0_0_15px_rgba(255,255,255,0.2)] border-white/80":""}
                                ${A?"grayscale":""}
                            `,children:[m.jsx("span",{className:"text-xl",children:ir(r.subtype,r.type,r.enemyType,r.archetype).icon}),b&&m.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping"}),A&&!b&&m.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-[#030712] text-[8px]",children:""})]}),m.jsx("div",{className:"w-8 h-1 bg-white/10 rounded-full mt-2 overflow-hidden",children:m.jsx("div",{className:`h-full ${h?"bg-blue-400":"bg-red-400"}`,style:{width:`${r.hp/r.maxHp*100}%`}})}),m.jsx("span",{className:`text-[8px] font-bold uppercase mt-1 ${h?"text-blue-300":"text-red-300"} ${b?"text-white":""}`,children:h?"You":r.subtype||"Enemy"})]},`${r.id}-${f}`)})})]})},mT=({gameState:e,onReset:i,onWait:a,onExitToHub:o,inputLocked:c=!1,compact:r=!1,hideInitiativeQueue:f=!1,hideLog:h=!1})=>{const b=jy(e),y=Array.isArray(e.message)?e.message:[],A=Ui.useRef(null),[v,S]=Ui.useState("all"),[_,p]=Ui.useState("all"),g=(C,M)=>{const N=C||"",Y=N.toLowerCase(),X=N.match(/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*(.*)$/i);if(X){const K=X[1].toLowerCase(),ue=X[2].toLowerCase(),G=X[3]||"",_e=ue.includes("combat")?"combat":ue.includes("hazard")?"hazard":ue.includes("objective")||ue.includes("score")?"objective":ue.includes("ai")?"ai":"system";return{idx:M,raw:C,text:G,level:K,channel:_e}}const O=/(attacked|killed|blast|stunned|damage|hit|healed|shield|bash|spear|fireball|jump|dash)/i.test(Y)?"combat":/(lava|burn|hazard|void|sink|fire damage)/i.test(Y)?"hazard":/(score|objective|floor|stairs|descending|arcade cleared)/i.test(Y)?"objective":/(enemy|falcon|intent|telegraph|moves to|repositioning|attacks)/i.test(Y)?"ai":"system",q=/(fallen|warning|error|failed|invalid|blocked|cannot)/i.test(Y)?"critical":/(debug|trace|telemetry|seed|counter|rng)/i.test(Y)?"debug":/(marks the impact zone|telegraph|planning|intent)/i.test(Y)?"verbose":"info";return{idx:M,raw:C,text:N,level:q,channel:O}},R=Ui.useMemo(()=>y.map((C,M)=>g(C,M)),[y]),I=Ui.useMemo(()=>R.filter(C=>(v==="all"||C.level===v)&&(_==="all"||C.channel===_)),[R,v,_]);return Ui.useEffect(()=>{A.current&&(A.current.scrollTop=A.current.scrollHeight)},[I]),m.jsxs("div",{className:"flex flex-col h-full max-h-screen",children:[m.jsxs("div",{className:`flex flex-col overflow-y-auto flex-1 min-h-0 ${r?"gap-4 p-4":"gap-8 p-8"}`,children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{children:[m.jsx("h1",{className:`${r?"text-base":"text-xl"} font-black uppercase tracking-widest text-white/90 mb-1`,children:"Hoplite"}),m.jsx("p",{className:"text-[10px] font-bold text-white/30 uppercase tracking-[0.2em]",children:"Tactical Arena"})]}),m.jsx("div",{className:`px-2 py-1 bg-white/10 rounded border border-white/20 text-[10px] font-black text-white/60 ${r?"hidden sm:block":""}`,children:"V2.1.0"})]}),!f&&m.jsx(fT,{gameState:e}),m.jsxs("div",{className:r?"space-y-4":"space-y-6",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Vitality"}),m.jsxs("div",{className:"flex items-end gap-2",children:[m.jsx("span",{className:`${r?"text-3xl":"text-4xl"} font-black text-red-500 leading-none`,children:e.player.hp}),m.jsx("span",{className:"text-xl text-white/20 font-bold leading-none mb-1",children:"/"}),m.jsx("span",{className:"text-xl text-gray-500 font-bold leading-none mb-1",children:e.player.maxHp})]})]}),m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Guardian Plating"}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:`w-3 h-3 rounded-sm ${e.player.temporaryArmor?"bg-blue-400 rotate-45":"bg-white/5 border border-white/10"}`}),m.jsx("span",{className:"text-2xl font-black text-blue-400 leading-none",children:e.player.temporaryArmor||0})]})]}),e.enemies.filter(C=>C.subtype==="sentinel").map(C=>m.jsxs("div",{className:"pt-4 animate-in slide-in-from-right-8 duration-500",children:[m.jsxs("div",{className:"flex justify-between items-end mb-2",children:[m.jsx("span",{className:"text-xs font-black text-red-500 uppercase tracking-tighter italic",children:"Sentinel Directive"}),m.jsxs("span",{className:"text-lg font-black",children:[C.hp," ",m.jsxs("span",{className:"text-white/20 text-xs",children:["/ ",C.maxHp]})]})]}),m.jsx("div",{className:"h-4 w-full bg-red-950/30 rounded-md border border-red-500/20 overflow-hidden",children:m.jsx("div",{className:"h-full bg-gradient-to-r from-red-600 to-red-400 shadow-[0_0_20px_rgba(239,68,68,0.4)] transition-all duration-300",style:{width:`${C.hp/C.maxHp*100}%`}})})]},C.id))]}),m.jsxs("div",{className:`${r?"py-4 space-y-4":"py-8 space-y-6"} border-y border-white/5`,children:[m.jsxs("div",{className:"flex flex-col gap-3",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Arcade Progress"}),m.jsxs("span",{className:"text-xl font-black",children:[e.floor," ",m.jsx("span",{className:"text-white/20 text-sm",children:"/ 10"})]})]}),m.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden border border-white/5",children:m.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.4)] transition-all duration-1000 ease-out",style:{width:`${e.floor/10*100}%`}})})]}),m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Current Score"}),m.jsx("span",{className:"text-xl font-black text-white",children:b.toLocaleString()})]})]}),m.jsxs("div",{className:`flex flex-col ${r?"gap-2":"gap-3"}`,children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Directives"}),m.jsxs("button",{disabled:c,onClick:a,className:`w-full flex justify-between items-center ${r?"px-3 py-2.5":"px-4 py-3"} border rounded-xl transition-all group ${c?"bg-white/[0.03] border-white/5 text-white/30 cursor-not-allowed opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}`,children:[m.jsx("span",{className:"text-sm font-bold text-white/70",children:"Secure & Wait"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),m.jsxs("button",{onClick:i,className:`w-full flex justify-between items-center ${r?"px-3 py-2.5":"px-4 py-3"} bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-xl transition-all group`,children:[m.jsx("span",{className:"text-sm font-bold text-red-400/80",children:"Reset Chronology"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),m.jsxs("button",{onClick:o,className:`w-full flex justify-between items-center ${r?"px-3 py-2.5":"px-4 py-3"} bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all group`,children:[m.jsx("span",{className:"text-sm font-bold text-white/70",children:"Return to Hub"}),m.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]})]})]}),!h&&y.length>0&&m.jsxs("div",{className:`${r?"p-4":"p-8"} border-t border-white/5 bg-[#030712]/80 backdrop-blur-sm`,children:[m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold block",children:"Tactical Log"}),m.jsxs("div",{className:`items-center gap-2 ${r?"hidden sm:flex":"flex"}`,children:[m.jsxs("select",{value:_,onChange:C=>p(C.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[m.jsx("option",{value:"all",children:"All Channels"}),m.jsx("option",{value:"combat",children:"Combat"}),m.jsx("option",{value:"hazard",children:"Hazard"}),m.jsx("option",{value:"objective",children:"Objective"}),m.jsx("option",{value:"ai",children:"AI"}),m.jsx("option",{value:"system",children:"System"})]}),m.jsxs("select",{value:v,onChange:C=>S(C.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[m.jsx("option",{value:"all",children:"All Levels"}),m.jsx("option",{value:"info",children:"Info"}),m.jsx("option",{value:"verbose",children:"Verbose"}),m.jsx("option",{value:"debug",children:"Debug"}),m.jsx("option",{value:"critical",children:"Critical"})]})]})]}),m.jsxs("div",{ref:A,className:"flex flex-col gap-2 bg-white/[0.02] border border-white/5 p-4 rounded-2xl overflow-y-auto max-h-[140px]",children:[I.slice(-20).map(C=>m.jsxs("div",{className:"flex gap-2 items-start",children:[m.jsxs("span",{className:"text-[10px] text-white/20 font-bold mt-1 leading-none shrink-0",children:["[",C.idx,"]"]}),m.jsx("span",{className:`text-[9px] mt-1 px-1.5 py-0.5 rounded border shrink-0 ${C.level==="critical"?"text-red-300 border-red-400/40 bg-red-500/10":C.level==="debug"?"text-cyan-300 border-cyan-400/40 bg-cyan-500/10":C.level==="verbose"?"text-amber-300 border-amber-400/40 bg-amber-500/10":"text-white/60 border-white/20 bg-white/5"}`,children:C.level.toUpperCase()}),m.jsx("span",{className:"text-[9px] mt-1 px-1.5 py-0.5 rounded border border-white/20 bg-white/5 text-white/60 shrink-0",children:C.channel.toUpperCase()}),m.jsx("p",{className:"text-[11px] leading-tight text-white/70 font-medium whitespace-pre-wrap",children:C.text})]},C.idx)),I.length===0&&m.jsx("div",{className:"text-[11px] text-white/40 italic",children:"No messages match current filters."})]})]})]})},pT=({onSelect:e,gameState:i})=>{const a=i.player,c=(i.pendingStatus?.shrineOptions||i.shrineOptions||["EXTRA_HP"]).map(r=>{if(r==="EXTRA_HP")return{id:"EXTRA_HP",label:"Extra Heart",desc:"Increases your Max HP by 1 and heals you to full.",color:"bg-red-900/40 border-red-500"};const f=Rn.getUpgrade(r),h=Rn.getSkillForUpgrade(r),b=a.activeSkills?.find(A=>A.id===h),y=b?.slot==="offensive"?"bg-orange-900/40 border-orange-500":b?.slot==="defensive"?"bg-blue-900/40 border-blue-500":"bg-green-900/40 border-green-500";return{id:r,label:f?f.name:r,desc:f?.description||"Unknown upgrade.",color:y}});return m.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-[100] p-4",children:m.jsxs("div",{className:"bg-gray-900 p-8 rounded-3xl border-2 border-slate-700 max-w-2xl w-full shadow-2xl relative overflow-hidden",children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-blue-500 to-green-500"}),m.jsx("h2",{className:"text-4xl font-black text-white mb-2 text-center tracking-tight",children:"SHRINE BLESSING"}),m.jsx("p",{className:"text-slate-400 mb-8 text-center text-lg",children:"The gods offer you a choice. Choose wisely."}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.map(r=>m.jsxs("button",{onClick:()=>e(r.id),className:`
                                relative p-6 border-2 rounded-2xl text-left transition-all group overflow-hidden
                                hover:scale-[1.02] active:scale-[0.98]
                                ${r.color} hover:bg-slate-800
                            `,children:[m.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-blue-200",children:r.label}),m.jsx("p",{className:"text-sm text-slate-400 group-hover:text-slate-300 leading-relaxed",children:r.desc}),m.jsx("div",{className:"absolute -right-2 -bottom-2 opacity-0 group-hover:opacity-10 scale-0 group-hover:scale-150 transition-all font-bold text-4xl",children:"*"})]},r.id))})]})})},vy=({skills:e,selectedSkillId:i,onSelectSkill:a,hasSpear:o,gameState:c,inputLocked:r=!1,compact:f=!1})=>{const h=["offensive","defensive","utility"];return m.jsx("div",{className:f?"grid grid-cols-3 gap-2 sm:grid-cols-4":"flex flex-col gap-4",children:h.flatMap(b=>e.filter(A=>A.slot===b).map(A=>{const v=i===A.id,S=A.currentCooldown>0,_=A.id==="SPEAR_THROW",p=r||S&&!_||_&&!o,g=C1(A.id),R=g?.name||A.name,I=typeof R=="function"?R(c):R,C=g?.icon||"";return m.jsxs("button",{disabled:p,onClick:()=>a(v?null:A.id),className:`
                            relative w-full ${f?"h-20 rounded-xl gap-0.5":"h-24 rounded-2xl gap-1"} flex flex-col items-center justify-center
                            border transition-all transform hover:translate-x-1
                            ${v?"bg-blue-600 border-white shadow-[0_0_20px_rgba(59,130,246,0.5)]":"bg-white/5 border-white/10 hover:border-blue-500/50"}
                            ${p?"opacity-40 grayscale pointer-events-none":"cursor-pointer"}
                        `,children:[m.jsx("span",{className:f?"text-2xl":"text-3xl",children:C}),m.jsx("span",{className:`${f?"text-[9px] tracking-[0.12em]":"text-[10px] tracking-widest"} uppercase font-bold text-white/50 text-center px-2 leading-tight`,children:I}),S&&!_&&m.jsx("div",{className:`absolute inset-0 flex items-center justify-center bg-black/40 ${f?"rounded-xl":"rounded-2xl"} backdrop-blur-[2px]`,children:m.jsx("span",{className:`${f?"text-2xl":"text-3xl"} font-black text-white`,children:A.currentCooldown})}),m.jsx("div",{className:`absolute ${f?"-top-1 left-2 px-1.5":"-top-2 left-4 px-2"} py-0.5 bg-[#030712] rounded-full border border-white/10 text-[8px] uppercase font-black tracking-widest text-white/40`,children:b})]},A.id)}))})},hT=({onSelect:e})=>m.jsxs("div",{className:"relative z-50 flex flex-col items-center justify-center p-8 gap-8 animate-in fade-in zoom-in duration-500",children:[m.jsxs("div",{className:"text-center space-y-2",children:[m.jsx("h1",{className:"text-4xl font-black uppercase tracking-widest text-white mb-2",children:"Select Class"}),m.jsx("p",{className:"text-white/40 text-sm uppercase tracking-wider",children:"Choose your combat doctrine"})]}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl",children:Object.values(jo).map(i=>m.jsxs("button",{onClick:()=>{console.log("Archetype Selected:",i.id),e(i)},className:"group relative flex flex-col items-start p-8 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/30 rounded-3xl transition-all hover:scale-[1.02] text-left cursor-pointer",children:[m.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 rounded-3xl transition-opacity"}),m.jsxs("div",{className:"relative z-10 w-full",children:[m.jsxs("div",{className:"flex justify-between items-start mb-4",children:[m.jsx("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10 group-hover:border-white/30 transition-colors",children:m.jsx("span",{className:"text-3xl",children:ir(i.id==="ASSASSIN"?"assassin_player":i.id.toLowerCase(),"player").icon})}),m.jsx("div",{className:"px-3 py-1 bg-white/5 rounded-full border border-white/10 text-[10px] font-bold uppercase tracking-widest text-white/50",children:i.id==="VANGUARD"?"Standard":"Advanced"})]}),m.jsx("h3",{className:"text-2xl font-black uppercase tracking-wide text-white mb-2",children:i.name}),m.jsx("p",{className:"text-white/60 text-sm leading-relaxed mb-6 h-12",children:i.description}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/30 font-bold border-b border-white/5 pb-1",children:"Starting Loadout"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:i.startingSkills.map(a=>m.jsx("div",{className:"px-2 py-1 bg-black/40 rounded border border-white/10 text-[10px] text-blue-200",children:a.replace("_"," ")},a))})]})]})]},i.id))})]}),gT="hop_replays_v1",yT="hop_leaderboard_v1",Sy=()=>{try{const e=localStorage.getItem(gT);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load replays",e),[]}},Ay=()=>{try{const e=localStorage.getItem(yT);return e?JSON.parse(e):[]}catch(e){return console.error("Failed to load leaderboard",e),[]}},Ty=e=>{const i=Array.isArray(e.actions)?e.actions:[],a=new Set(i.map(y=>y?.type)),o=a.has("ADVANCE_TURN"),c=a.has("RESOLVE_PENDING"),r=(e.floor||0)>=5&&i.length<Math.max(25,(e.floor||0)*4),f=(e.replayVersion??1)<2,h=i.length===0,b=h?"invalid replay":r?"truncated replay":f?"legacy replay":null;return{isLegacy:f,invalid:h,suspicious:r||e.floor>1&&!c,label:b,hasTurnAdvance:o,hasPendingResolve:c,actionCount:i.length}},Ey=({onStartReplay:e})=>{const[i,a]=w.useState(()=>Sy()),[o,c]=w.useState(()=>Ay()),[r,f]=w.useState(""),[h,b]=w.useState(""),[y,A]=w.useState(""),[v,S]=w.useState(null);w.useEffect(()=>{const g=()=>{a(Sy()),c(Ay())};return window.addEventListener("storage",g),()=>window.removeEventListener("storage",g)},[]);const _=()=>{S(null);try{const g=y.trim();if(!g)return S("Paste actions JSON first."),null;const R=JSON.parse(g);let I=r.trim()||void 0,C=h.trim()||void 0,M=[];return Array.isArray(R)?M=R:R&&typeof R=="object"&&(M=Array.isArray(R.actions)?R.actions:[],I=I||(typeof R.seed=="string"?R.seed:void 0),C=C||(typeof R.loadoutId=="string"?R.loadoutId:void 0)),!Array.isArray(M)||M.length===0?(S('No actions found. Provide a JSON action array or object with "actions".'),null):M.filter(X=>X&&typeof X.type=="string").length===0?(S('Actions must be objects with a "type" field.'),null):{id:`manual-${Date.now()}`,seed:I,loadoutId:C,actions:M,score:0,floor:1,date:new Date().toISOString(),replayVersion:2,diagnostics:{actionCount:M.length,hasTurnAdvance:M.some(X=>X?.type==="ADVANCE_TURN"),hasPendingResolve:M.some(X=>X?.type==="RESOLVE_PENDING"),suspiciouslyShort:!1}}}catch(g){return S(`Invalid JSON: ${g?.message||"parse error"}`),null}},p=()=>{const g=_();g&&e(g)};return m.jsxs("div",{className:"flex flex-col gap-8",children:[m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-emerald-400",children:"Manual Replay"}),m.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Paste from UPA"})]}),m.jsxs("div",{className:"space-y-2 p-3 rounded-2xl border border-white/5 bg-white/[0.02]",children:[m.jsx("input",{value:r,onChange:g=>f(g.target.value),placeholder:"Seed (optional if included in JSON)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),m.jsx("input",{value:h,onChange:g=>b(g.target.value),placeholder:"Loadout ID (optional)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),m.jsx("textarea",{value:y,onChange:g=>A(g.target.value),placeholder:'Paste JSON actions array, or object: {"seed":"...","loadoutId":"...","actions":[...]}',rows:6,className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40 font-mono"}),v&&m.jsx("div",{className:"text-[10px] text-red-400 font-bold uppercase tracking-wider",children:v}),m.jsx("button",{onClick:p,className:"w-full py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 text-xs font-black uppercase tracking-widest transition-colors",children:"Start Manual Replay"})]})]}),m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-4",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400",children:"Hall of Fame"}),m.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Top 5 Only"})]}),m.jsxs("div",{className:"space-y-2",children:[o.length===0&&m.jsx("div",{className:"p-4 rounded-xl border border-white/5 bg-white/[0.02] text-center",children:m.jsx("span",{className:"text-[10px] text-white/30 uppercase font-black",children:"No Champions Yet"})}),o.slice(0,5).map((g,R)=>{const I={id:g.id,seed:g.seed,loadoutId:g.loadoutId,actions:g.actions||[],score:g.score,floor:g.floor,date:g.date,replayVersion:g.replayVersion,diagnostics:g.diagnostics},C=Ty(I);return m.jsxs("button",{onClick:()=>e(I),className:"w-full group relative flex items-center gap-4 p-4 bg-white/[0.03] hover:bg-white/[0.07] border border-white/5 hover:border-indigo-500/30 rounded-2xl transition-all text-left",children:[m.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-indigo-500/10 rounded-lg text-indigo-400 font-black text-sm border border-indigo-500/20",children:R+1}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[m.jsx("span",{className:"font-black text-white uppercase text-xs truncate tracking-wider",children:g.name}),m.jsx("span",{className:"text-[10px] font-black text-indigo-400 tabular-nums",children:g.score.toLocaleString()})]}),m.jsxs("div",{className:"text-[9px] text-white/30 font-bold uppercase tracking-widest",children:["Floor ",g.floor," * ",new Date(g.date).toLocaleDateString()," * ",C.actionCount," acts"]}),C.label&&m.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:C.label})]}),m.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-indigo-400 text-xs",children:"Play"})]},g.id)})]})]}),m.jsxs("section",{children:[m.jsx("div",{className:"flex items-center justify-between mb-4",children:m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Recent Simulations"})}),m.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar pr-2",children:[i.length===0&&m.jsx("div",{className:"text-center py-4",children:m.jsx("span",{className:"text-[10px] text-white/10 uppercase font-bold",children:"Log Empty"})}),i.slice(0,10).map(g=>{const R=Ty(g);return m.jsxs("button",{onClick:()=>e(g),className:"w-full flex items-center justify-between p-3 hover:bg-white/[0.04] rounded-xl transition-colors text-left group",children:[m.jsxs("div",{className:"min-w-0",children:[m.jsxs("div",{className:"text-[10px] font-bold text-white/60 mb-0.5 truncate uppercase",children:["Score: ",m.jsx("span",{className:"text-white",children:g.score})," * F",g.floor," * ",R.actionCount," acts"]}),m.jsx("div",{className:"text-[9px] text-white/20 font-medium",children:new Date(g.date).toLocaleTimeString()}),R.label&&m.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:R.label})]}),m.jsx("div",{className:"text-[10px] text-white/0 group-hover:text-white/40 font-black uppercase tracking-widest transition-all",children:"Replay"})]},g.id)})]})]})]})};class bT{state;constructor(){this.state=Cs(1,"tutorial-seed"),this.state.enemies=[],this.state.tiles=new Map}setPlayer(i,a){this.state.player={...this.state.player,position:i,previousPosition:i,activeSkills:a.map(o=>{const c=Rn.get(o);return{id:o,name:typeof c?.name=="function"?c.name(this.state):c?.name||o,description:c?.description||"",slot:c?.slot||"offensive",cooldown:c?.baseVariables.cooldown||0,currentCooldown:0,range:c?.baseVariables.range||0,upgrades:Object.keys(c?.upgrades||{}),activeUpgrades:[]}})}}spawnEnemy(i,a,o){const c=xf[i]||{hp:1,maxHp:1};this.state.enemies.push({id:o,type:"enemy",subtype:i,position:a,previousPosition:a,hp:c.hp,maxHp:c.maxHp,enemyType:c.type||"melee",statusEffects:[],temporaryArmor:0,activeSkills:[],speed:c.speed||1,factionId:"enemy"})}spawnFalcon(i,a){const o={id:a,type:"enemy",subtype:"falcon",factionId:"player",speed:95,position:{...i},previousPosition:{...i},hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],isFlying:!0,companionOf:"player",companionState:{mode:"roost",orbitStep:0,apexStrikeCooldown:0}};this.state.enemies.push(o),this.state.companions||(this.state.companions=[]),this.state.companions.push(o)}spawnCompanion(i,a,o){i==="falcon"&&this.spawnFalcon(a,o)}setTile(i,a){const o=a.toUpperCase(),c=he(i),r=Io[o];if(!r){console.warn(`Attempted to set unknown tile type: ${o}`);return}this.state.tiles.set(c,{baseId:o,position:i,traits:new Set(r.defaultTraits||[]),effects:[],occupantId:void 0})}addUpgrade(i,a){this.state.player.activeSkills=(this.state.player.activeSkills||[]).map(o=>o.id===i?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}useSkill(i,a){}wait(){}move(i){}getEnemy(i){return this.state.enemies.find(a=>a.id===i)}setTurn(i){this.state.turnNumber=i}exitToHub(){}applyStatus(i,a){const o=this.state.enemies.findIndex(c=>c.id===i);o!==-1&&(this.state.enemies[o]=vf(this.state.enemies[o],a,1))}}const wy=({onLoadScenario:e})=>{const i=Object.values(Kc),a=o=>{const c=new bT;o.setup(c),c.state.initiativeQueue=Ka(c.state),e(c.state,o.description)};return m.jsx("div",{className:"flex flex-col gap-4",children:i.map(o=>m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-white/50",children:typeof o.name=="function"?o.name(Cs(1,"temp")):o.name}),m.jsx("div",{className:"flex flex-col gap-1",children:o.scenarios?.map(c=>m.jsx("button",{onClick:()=>a(c),className:"text-left px-3 py-2 bg-white/5 hover:bg-white/10 rounded text-xs text-white/80 transition-colors border border-transparent hover:border-white/20",children:c.title},c.id))})]},o.id))})},xT=({gameState:e,onSelectLoadout:i,onStartRun:a,onOpenArcade:o,onLoadScenario:c,onStartReplay:r})=>m.jsxs("div",{className:"w-full h-full flex flex-col bg-[#020617]",children:[m.jsx("header",{className:"border-b border-white/5 px-4 sm:px-6 lg:px-12 py-3 sm:py-4 bg-[#030712]/50 backdrop-blur-xl z-30",children:m.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[m.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[m.jsx("div",{className:"w-9 h-9 sm:w-10 sm:h-10 bg-indigo-500 rounded-lg flex items-center justify-center font-black text-lg sm:text-xl shadow-[0_0_20px_rgba(99,102,241,0.5)]",children:"H"}),m.jsxs("div",{children:[m.jsxs("h1",{className:"text-base sm:text-lg font-black uppercase tracking-tighter leading-none italic",children:["Hop ",m.jsx("span",{className:"text-indigo-500",children:"Engine"})]}),m.jsx("div",{className:"text-[9px] sm:text-[10px] font-bold text-white/30 tracking-[0.22em] sm:tracking-[0.3em] uppercase mt-1",children:"Strategic Hub v5.0"})]})]}),m.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-6 lg:gap-8",children:[m.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/[0.03] px-3 py-2 sm:bg-transparent sm:border-0 sm:p-0",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/40 mb-1",children:"Current Loadout"}),m.jsx("div",{className:"text-sm font-bold text-indigo-400 truncate",children:e.selectedLoadoutId||"No Archetype Selected"})]}),e.selectedLoadoutId&&m.jsxs("div",{className:"grid grid-cols-2 gap-2 sm:flex sm:items-center sm:gap-3",children:[m.jsxs("button",{onClick:()=>a("normal"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center leading-tight",children:[m.jsx("span",{children:"Start Run"}),m.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"10 Floors | Boss Defeat"})]}),m.jsxs("button",{onClick:()=>a("daily"),className:"px-4 sm:px-6 py-2.5 sm:py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-black uppercase text-xs sm:text-sm tracking-widest transition-all hover:scale-[1.02] active:scale-95 shadow-[0_0_30px_rgba(16,185,129,0.3)] flex flex-col items-center justify-center leading-tight",children:[m.jsx("span",{children:"Daily"}),m.jsx("span",{className:"hidden sm:block text-[9px] opacity-50 tracking-[0.2em]",children:"Seeded Challenge"})]})]})]})]})}),m.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-y-auto lg:overflow-hidden",children:[m.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 lg:p-12 custom-scrollbar",children:m.jsxs("div",{className:"max-w-4xl mx-auto",children:[m.jsxs("div",{className:"mb-6 sm:mb-10 lg:mb-12",children:[m.jsx("button",{onClick:o,className:"mb-4 sm:mb-5 w-full sm:w-auto px-5 sm:px-6 py-2.5 sm:py-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 font-black uppercase tracking-widest text-xs sm:text-sm transition-all",children:"Arcade Mode"}),m.jsxs("h2",{className:"text-xl sm:text-2xl lg:text-3xl font-black uppercase tracking-tighter mb-2 italic",children:["Select Your ",m.jsx("span",{className:"text-indigo-500",children:"Archetype"})]}),m.jsx("p",{className:"text-sm sm:text-base text-white/40 max-w-xl",children:"Choose your tactical specialty. Each archetype provides unique skills and modifies your core interaction with the engine."})]}),m.jsx(hT,{onSelect:i})]})}),m.jsxs("section",{className:"lg:hidden border-t border-white/5 bg-[#030712]/50 backdrop-blur-sm p-4 sm:p-6 space-y-4",children:[m.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[m.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[m.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Historical Replay"}),m.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),m.jsx("div",{className:"mt-3",children:m.jsx(Ey,{gameState:e,onStartReplay:r})})]}),m.jsxs("details",{className:"rounded-2xl border border-white/10 bg-white/[0.02] p-3",children:[m.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between",children:[m.jsx("span",{className:"text-[11px] font-black uppercase tracking-[0.2em] text-white/60",children:"Training Simulations"}),m.jsx("span",{className:"text-[10px] text-white/30 uppercase tracking-widest",children:"Optional"})]}),m.jsx("div",{className:"mt-3",children:m.jsx(wy,{onLoadScenario:c})})]})]}),m.jsx("aside",{className:"hidden lg:flex w-[450px] border-l border-white/5 bg-[#030712]/80 backdrop-blur-md flex-col z-20",children:m.jsxs("div",{className:"p-8 flex flex-col gap-12 h-full overflow-y-auto custom-scrollbar",children:[m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Historical Replay"}),m.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]}),m.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:m.jsx(Ey,{gameState:e,onStartReplay:r})})]}),m.jsxs("section",{children:[m.jsxs("div",{className:"flex items-center justify-between mb-6",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Training Simulations"}),m.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]}),m.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:m.jsx(wy,{onLoadScenario:c})})]}),m.jsx("div",{className:"mt-auto pt-8 border-t border-white/5 opacity-20 hover:opacity-100 transition-opacity",children:m.jsx("div",{className:"text-[10px] font-bold uppercase tracking-[0.4em] mb-2 text-center text-white/50",children:"Engine Status: Online"})})]})})]})]}),vT={VANGUARD:"V",HUNTER:"H",FIREMAGE:"F",NECROMANCER:"N",SKIRMISHER:"S"},_y=e=>{let i=2166136261;for(let a=0;a<e.length;a++)i^=e.charCodeAt(a),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return i>>>0},ST=(e=new Date)=>e.toISOString().slice(0,10),AT=(e,i)=>{if(e.length<2)throw new Error("Arcade mode requires at least two loadouts.");const o=_y(`arcade-a:${i}`)%e.length,c=e[o],r=e.filter(y=>y.id!==c.id),h=_y(`arcade-b:${i}`)%r.length,b=r[h];return[c,b]},TT=({onBack:e,onLaunchArcade:i})=>{const a=Ui.useMemo(()=>Object.values(jo),[]),o=Ui.useMemo(()=>ST(),[]),[c,r]=Ui.useMemo(()=>AT(a,o),[a,o]);return m.jsxs("div",{className:"w-full h-full flex flex-col bg-[#040a18]",children:[m.jsxs("header",{className:"h-20 border-b border-white/10 flex items-center justify-between px-12 bg-[#050b1f]/80 backdrop-blur-xl z-30",children:[m.jsxs("div",{children:[m.jsxs("h1",{className:"text-xl font-black uppercase tracking-tight italic",children:["Hop ",m.jsx("span",{className:"text-emerald-400",children:"Arcade"})]}),m.jsxs("div",{className:"text-[10px] uppercase tracking-[0.3em] text-white/40 mt-1",children:["Daily Draft ",o]})]}),m.jsx("button",{onClick:e,className:"px-5 py-2.5 rounded-xl border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-widest",children:"Back to Strategic Hub"})]}),m.jsx("main",{className:"flex-1 overflow-y-auto p-12",children:m.jsxs("div",{className:"max-w-5xl mx-auto",children:[m.jsxs("div",{className:"mb-10",children:[m.jsx("h2",{className:"text-4xl font-black uppercase tracking-tight italic mb-3",children:"Arcade Mode"}),m.jsx("p",{className:"text-white/60 max-w-3xl",children:"Pick one of two daily archetypes and run the seeded challenge. Both options share the same seed for fair comparison."})]}),m.jsx("div",{className:"flex flex-col gap-6",children:[c,r].map((f,h)=>{const b=h===1,y=vT[f.id]||f.id.slice(0,1);return m.jsx("button",{onClick:()=>i(f.id),className:"w-full text-left group rounded-3xl border border-white/10 bg-gradient-to-r from-white/[0.06] to-white/[0.02] hover:from-emerald-500/20 hover:to-cyan-500/10 transition-all p-6",children:m.jsxs("div",{className:`flex items-center justify-between gap-6 ${b?"flex-row-reverse":""}`,children:[m.jsxs("div",{className:"flex items-center gap-4 min-w-[200px]",children:[m.jsx("div",{className:`w-20 h-20 rounded-2xl border border-white/15 bg-[#0b1733] flex items-center justify-center text-4xl font-black text-emerald-300 shadow-[0_0_35px_rgba(16,185,129,0.25)] ${b?"-scale-x-100":""}`,children:y}),m.jsxs("div",{children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Daily Archetype"}),m.jsx("div",{className:"text-2xl font-black uppercase tracking-tight",children:f.name})]})]}),m.jsxs("div",{className:"flex-1",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/40 mb-2",children:"Starting Skills"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:f.startingSkills.slice(0,6).map(A=>m.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full border border-white/20 bg-white/5 font-bold tracking-wide",children:A},A))})]}),m.jsxs("div",{className:"text-right min-w-[150px]",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Launch"}),m.jsx("div",{className:"text-sm font-black uppercase tracking-widest text-emerald-300 group-hover:text-emerald-200",children:"Start Arcade Run"})]})]})},f.id)})})]})})]})},ET=["catacombs","inferno","throne","frozen","void"],Rc=["off","repeat","cover"],My="hop_biome_sandbox_settings_v1",tr="/Hop",Pa=64,Ua=192,Zn=64,ei=512,wT=["normal","multiply","overlay","soft-light","screen","color-dodge"],Oy=["off","multiply","overlay","soft-light","screen","color-dodge","normal"],_T=["#8b6f4a","#8f4a2e","#5b6d41","#536e8e","#5f5977","#b79a73","#d15a3a","#3e4f3a"],MT=["native","additive","custom"],OT=[{q:1,r:0,s:-1},{q:0,r:1,s:-1},{q:-1,r:1,s:0},{q:-1,r:0,s:1},{q:0,r:-1,s:1},{q:1,r:-1,s:0}],Cy=(e,i)=>`${e.endsWith("/")?e:`${e}/`}${i.replace(/^\/+/,"")}`,Fl=e=>{const i=e.trim();return!i||/^(?:[a-z]+:)?\/\//i.test(i)||i.startsWith("data:")?i:i.startsWith("/")?i.startsWith("/assets/")?Cy(tr,i.slice(1)):i:Cy(tr,i)},Kl=e=>{const i=e.trim();if(!i||/^\/assets\/[a-z0-9/_\-.]+$/i.test(i))return i;const o=`${tr.endsWith("/")?tr:`${tr}/`}assets/`;return i.startsWith(o)?`/assets/${i.slice(o.length)}`:i},Ri=(e,i="#8b6f4a")=>{const a=String(e||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[r,f,h]=a.slice(1).split("");return`#${r}${r}${f}${f}${h}${h}`.toLowerCase()}return i},CT=e=>{let i=2166136261;for(let a=0;a<e.length;a++)i^=e.charCodeAt(a),i=Math.imul(i,16777619);return i>>>0},Ny=e=>CT(e)/4294967295,r0=e=>e.has("BLOCKS_MOVEMENT")&&e.has("BLOCKS_LOS"),NT=e=>e.has("LAVA")||e.has("FIRE")||e.has("HAZARDOUS")&&e.has("LIQUID"),Uf=e=>OT.map(i=>he({q:e.q+i.q,r:e.r+i.r,s:e.s+i.s})),RT=e=>{const i=new Set;for(const[a,o]of e.entries())Uf(o.position).some(r=>!e.has(r))&&i.add(a);return i},kT=(e,i,a)=>{const o=new Set,c=[{point:i,depth:0}];for(;c.length>0;){const r=c.shift(),f=he(r.point);if(!o.has(f)&&e.has(f)&&(o.add(f),!(r.depth>=a)))for(const h of Uf(r.point)){const b=e.get(h);b&&c.push({point:b.position,depth:r.depth+1})}}return o},hf=(e,i,a)=>{const o=e.get(i);if(!o)return;const c=new Set(Array.from(o.traits));a?(c.add("BLOCKS_MOVEMENT"),c.add("BLOCKS_LOS"),c.delete("LAVA"),c.delete("FIRE"),c.delete("LIQUID"),c.delete("HAZARDOUS")):(c.delete("BLOCKS_MOVEMENT"),c.delete("BLOCKS_LOS")),e.set(i,{...o,traits:c})},ce=(e,i,a)=>Math.min(a,Math.max(i,e)),kc=(e,i)=>e?i&&e.themes?.[i]?e.themes[i]:e.default||"":"",Lc=e=>e?e.mode==="cover"||e.mode==="repeat"||e.mode==="off"?e.mode:"repeat":"off",LT=(e,i)=>e?i&&e.themes?.[i]?e.themes[i]:e.default||"#8b6f4a":"#8b6f4a",qa=e=>e==="normal"||e==="multiply"||e==="overlay"||e==="soft-light"||e==="screen"||e==="color-dodge"?e:"multiply",fi=e=>e==="off"?"off":qa(e),gf=(e,i,a,o)=>{const c=e?.[a]??e?.[o];return c!==void 0?c:i?.[a]??i?.[o]},IT=e=>{switch(e){case"inferno":return 4;case"throne":return 6;case"frozen":return 8;case"void":return 10;default:return 1}},BT=e=>{const i=new Map;for(const[a,o]of e.tiles.entries())i.set(a,{...o,traits:new Set(o.traits),effects:Array.isArray(o.effects)?[...o.effects]:[]});return i},jT=(e,i)=>{const a=(r,f,h)=>{const y=he({q:r,r:f}),A=e.get(y);if(!A)return;const v=new Set(Array.from(A.traits));if(!r0(v)){for(const S of h)v.add(S);e.set(y,{...A,traits:v})}},o=[[0,0],[1,0],[0,1],[-1,1],[-1,0],[0,-1],[1,-1],[2,-1],[2,0],[1,1],[-2,1],[-2,0],[-1,-1]];for(const[r,f]of o)a(i.q+r,i.r+f,["HAZARDOUS","LIQUID","LAVA"]);const c=[[3,-1],[3,0],[2,1],[-3,1],[-3,0],[-2,-1]];for(const[r,f]of c)a(i.q+r,i.r+f,["HAZARDOUS","FIRE"])},DT=(e,i,a,o)=>{const c=o.mode,r=RT(e),f=kT(e,a,2),h=Array.from(e.keys()).sort((_,p)=>_.localeCompare(p));if(c==="custom")for(const _ of h){if(f.has(_)){hf(e,_,!1);continue}const p=o.keepPerimeter&&r.has(_);hf(e,_,p)}if(c==="native")return;const b=ce(Number(o.interiorDensity||0),0,.45),y=ce(Number(o.clusterBias||0),0,1);if(b<=0&&y<=0)return;const A=h.filter(_=>{if(r.has(_)||f.has(_))return!1;const p=e.get(_);if(!p)return!1;const g=p.traits;return!NT(g)}),v=_=>{const p=e.get(_);return p?r0(p.traits):!1},S=new Set;for(const _ of A){if(v(_))continue;Ny(`${i}|sandbox-wall-seed|${_}`)<b&&S.add(_)}for(let _=0;_<2;_++)for(const p of A){if(v(p)||S.has(p))continue;const g=e.get(p);if(!g)continue;const R=Uf(g.position).filter(N=>e.has(N));let I=0;for(const N of R)(v(N)||S.has(N))&&I++;if(I===0)continue;const C=y*(I/6);Ny(`${i}|sandbox-wall-grow|pass:${_}|${p}`)<C&&S.add(p)}for(const _ of S)hf(e,_,!0)},HT=(e,i,a,o)=>{const c=IT(e),r=i.trim()||"biome-sandbox-seed",f=Cs(c,r,r,void 0,jo.VANGUARD),h=BT(f);return DT(h,r,f.player.position,o),a&&jT(h,f.player.position),{...f,floor:c,theme:e,rngSeed:r,initialSeed:r,turnNumber:1,tiles:h,visualEvents:[],timelineEvents:[],intentPreview:void 0}},Ry=(e,i)=>{const a=i.toLowerCase(),o=Hf(e,a),c=o?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,r=o?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),f=o?.biomeMaterials?.crust??e.biomeMaterials?.crust,h=f?.detailA,b=f?.detailB,y=f?.tint,A=o?.walls||e.walls,v=o?.walls?o.walls:e.walls?.themes?.[a],S=(e.assets||[]).filter(X=>{if(X.type!=="prop")return!1;const O=X.id.toLowerCase(),q=new Set((X.tags||[]).map(ue=>ue.toLowerCase()));if(!O.includes("mountain")&&!q.has("mountain"))return!1;if(!X.theme)return!0;const K=X.theme.toLowerCase();return K===a||K==="core"}).sort((X,O)=>X.id.localeCompare(O.id)),p=String(v?.mountainPath??A?.mountainPath??"").trim()||S.find(X=>X.path.toLowerCase().includes("biome.volcano.mountain.03.webp"))?.path||S[0]?.path||"",g=S.find(X=>X.path===p)||S[0],R=g?.mountainSettings,I=g?.mountainSettingsByTheme?.[a],C=g?o?.assetOverrides?.[g.id]?.mountainSettings:void 0,M=(X,O,q)=>{const ue=gf(v,A,X,O)??C?.[X]??I?.[X]??R?.[X]??q,G=Number(ue);return Number.isFinite(G)?G:q},N=(X,O,q)=>{const ue=gf(v,A,X,O)??C?.[X]??I?.[X]??R?.[X]??q;return fi(ue)},Y=(X,O,q)=>{const ue=gf(v,A,X,O)??C?.[X]??I?.[X]??R?.[X]??q;return Ri(String(ue||""),q)};return{theme:i,seed:String(o?.seed||"biome-sandbox-seed"),injectHazards:o?.injectHazards!==void 0?!!o.injectHazards:!0,undercurrent:{path:kc(c,a),mode:Lc(c),scalePx:ce(Number(c?.scalePx??e.tileUnitPx??256),Pa,Ua),opacity:ce(Number(c?.opacity??.6),0,1),scrollX:Number(c?.scroll?.x??120),scrollY:Number(c?.scroll?.y??90),scrollDurationMs:Math.max(1e3,Number(c?.scroll?.durationMs??92e3)),offsetX:Number(c?.offsetX??0),offsetY:Number(c?.offsetY??0)},crust:{path:kc(r,a),mode:Lc(r),scalePx:Math.max(64,Number(r?.scalePx??e.tileUnitPx??256)),opacity:1,seedShiftPx:Math.max(0,Number(r?.seedShiftPx??96)),offsetX:Number(r?.offsetX??0),offsetY:Number(r?.offsetY??0)},clutter:{density:ce(Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.density??.14),0,1),maxPerHex:Math.max(0,Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.maxPerHex??1)),bleedScaleMax:ce(Number((o?.biomeLayers?.clutter??e.biomeLayers?.clutter)?.bleedScaleMax??2),1,2)},walls:{mode:A?.mode==="native"||A?.mode==="additive"||A?.mode==="custom"?A.mode:"custom",interiorDensity:ce(Number(A?.interiorDensity??.05),0,.45),clusterBias:ce(Number(A?.clusterBias??0),0,1),keepPerimeter:A?.keepPerimeter!==void 0?!!A.keepPerimeter:!0,mountainPath:p,mountainScale:ce(M("scale","mountainScale",.53),.2,3),mountainOffsetX:M("offsetX","mountainOffsetX",0),mountainOffsetY:M("offsetY","mountainOffsetY",0),mountainAnchorX:ce(M("anchorX","mountainAnchorX",.5),0,1),mountainAnchorY:ce(M("anchorY","mountainAnchorY",.55),0,1),mountainCrustBlendMode:N("crustBlendMode","mountainCrustBlendMode","multiply"),mountainCrustBlendOpacity:ce(M("crustBlendOpacity","mountainCrustBlendOpacity",1),0,1),mountainTintColor:Y("tintColor","mountainTintColor","#7d7d7d"),mountainTintBlendMode:N("tintBlendMode","mountainTintBlendMode","overlay"),mountainTintOpacity:ce(M("tintOpacity","mountainTintOpacity",1),0,1)},materials:{detailA:{path:kc(h,a),mode:Lc(h),scalePx:ce(Number(h?.scalePx??192),Zn,ei),opacity:ce(Number(h?.opacity??0),0,1)},detailB:{path:kc(b,a),mode:Lc(b),scalePx:ce(Number(b?.scalePx??256),Zn,ei),opacity:ce(Number(b?.opacity??0),0,1)},tintColor:LT(y,a),tintOpacity:ce(Number(y?.opacity??0),0,1),tintBlend:qa(y?.blendMode)}}},PT=e=>{if(!e)return null;try{const i=JSON.parse(e);return!i||typeof i!="object"?null:i}catch{return null}},ut=(e,i)=>{const a=Number(e);return Number.isFinite(a)?a:i},UT=({assetManifest:e,onBack:i})=>{const a=w.useRef(!1),[o,c]=w.useState(""),[r,f]=w.useState(null);w.useEffect(()=>{if(!e||a.current)return;const p=Ry(e,"inferno"),g=PT(localStorage.getItem(My));if(!g){f(p),a.current=!0;return}f({...p,...g,undercurrent:{...p.undercurrent,...g.undercurrent||{},scalePx:ce(Number((g.undercurrent||{}).scalePx??p.undercurrent.scalePx),Pa,Ua)},crust:{...p.crust,...g.crust||{},opacity:1},clutter:{...p.clutter,...g.clutter||{}},walls:{...p.walls,...g.walls||{},mode:(g.walls||{}).mode==="native"||(g.walls||{}).mode==="additive"||(g.walls||{}).mode==="custom"?(g.walls||{}).mode:p.walls.mode,interiorDensity:ce(Number((g.walls||{}).interiorDensity??p.walls.interiorDensity),0,.45),clusterBias:ce(Number((g.walls||{}).clusterBias??p.walls.clusterBias),0,1),keepPerimeter:(g.walls||{}).keepPerimeter!==void 0?!!(g.walls||{}).keepPerimeter:p.walls.keepPerimeter,mountainPath:String((g.walls||{}).mountainPath||p.walls.mountainPath||""),mountainScale:ce(Number((g.walls||{}).mountainScale??p.walls.mountainScale),.2,3),mountainOffsetX:ut(String((g.walls||{}).mountainOffsetX??p.walls.mountainOffsetX),p.walls.mountainOffsetX),mountainOffsetY:ut(String((g.walls||{}).mountainOffsetY??p.walls.mountainOffsetY),p.walls.mountainOffsetY),mountainAnchorX:ce(Number((g.walls||{}).mountainAnchorX??p.walls.mountainAnchorX),0,1),mountainAnchorY:ce(Number((g.walls||{}).mountainAnchorY??p.walls.mountainAnchorY),0,1),mountainCrustBlendMode:fi((g.walls||{}).mountainCrustBlendMode??p.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:ce(Number((g.walls||{}).mountainCrustBlendOpacity??p.walls.mountainCrustBlendOpacity),0,1),mountainTintColor:Ri(String((g.walls||{}).mountainTintColor??p.walls.mountainTintColor),p.walls.mountainTintColor),mountainTintBlendMode:fi((g.walls||{}).mountainTintBlendMode??p.walls.mountainTintBlendMode),mountainTintOpacity:ce(Number((g.walls||{}).mountainTintOpacity??p.walls.mountainTintOpacity),0,1)},materials:{...p.materials,...g.materials||{},detailA:{...p.materials.detailA,...(g.materials||{}).detailA||{},scalePx:ce(Number(((g.materials||{}).detailA||{}).scalePx??p.materials.detailA.scalePx),Zn,ei),opacity:ce(Number(((g.materials||{}).detailA||{}).opacity??p.materials.detailA.opacity),0,1)},detailB:{...p.materials.detailB,...(g.materials||{}).detailB||{},scalePx:ce(Number(((g.materials||{}).detailB||{}).scalePx??p.materials.detailB.scalePx),Zn,ei),opacity:ce(Number(((g.materials||{}).detailB||{}).opacity??p.materials.detailB.opacity),0,1)},tintOpacity:ce(Number((g.materials||{}).tintOpacity??p.materials.tintOpacity),0,1),tintBlend:qa((g.materials||{}).tintBlend)}}),a.current=!0},[e]),w.useEffect(()=>{r&&localStorage.setItem(My,JSON.stringify(r))},[r]);const h=r?.theme?.toLowerCase()||"inferno",b=w.useMemo(()=>Ri(r?.materials.tintColor||"#8b6f4a"),[r?.materials.tintColor]),y=w.useMemo(()=>Ri(r?.walls.mountainTintColor||"#8b6f4a"),[r?.walls.mountainTintColor]),A=w.useMemo(()=>{const p=new Set,g=new Set,R=new Set,I=new Set;if(!e)return{undercurrent:[],crust:[],detail:[],mountain:[]};const C=M=>{if(M){M.default&&(p.add(M.default),g.add(M.default),R.add(M.default));for(const N of Object.values(M.themes||{}))p.add(N),g.add(N),R.add(N)}};C(e.biomeLayers?.undercurrent),C(e.biomeLayers?.crust);for(const M of Object.values(e.biomePresets||{}))C(M?.biomeLayers?.undercurrent),C(M?.biomeLayers?.crust),M?.biomeMaterials?.crust?.detailA&&C(M.biomeMaterials.crust.detailA),M?.biomeMaterials?.crust?.detailB&&C(M.biomeMaterials.crust.detailB);if(e.biomeUnderlay){e.biomeUnderlay.default&&g.add(e.biomeUnderlay.default);for(const M of Object.values(e.biomeUnderlay.themes||{}))g.add(M)}e.biomeMaterials?.crust?.detailA&&C(e.biomeMaterials.crust.detailA),e.biomeMaterials?.crust?.detailB&&C(e.biomeMaterials.crust.detailB);for(const M of e.assets||[]){const N=new Set((M.tags||[]).map(X=>X.toLowerCase())),Y=M.type==="prop"&&(M.id.toLowerCase().includes("mountain")||N.has("mountain"));(N.has("floor")||N.has("stone")||N.has("void")||N.has("frozen")||N.has("inferno"))&&(g.add(M.path),R.add(M.path)),(N.has("lava")||N.has("hazard")||N.has("fire")||N.has("quicksand"))&&p.add(M.path),(M.type==="decal"||M.type==="prop"||M.type==="tile")&&R.add(M.path),Y&&I.add(M.path)}e.walls?.mountainPath&&I.add(e.walls.mountainPath);for(const M of Object.values(e.walls?.themes||{}))M?.mountainPath&&I.add(M.mountainPath);for(const M of Object.values(e.biomePresets||{})){M?.walls?.mountainPath&&I.add(M.walls.mountainPath);for(const N of Object.values(M?.walls?.themes||{}))N?.mountainPath&&I.add(N.mountainPath)}return{undercurrent:Array.from(p).sort((M,N)=>M.localeCompare(N)),crust:Array.from(g).sort((M,N)=>M.localeCompare(N)),detail:Array.from(R).sort((M,N)=>M.localeCompare(N)),mountain:Array.from(I).sort((M,N)=>M.localeCompare(N))}},[e]),v=w.useMemo(()=>{if(!e||!r)return null;const p=Fl(r.undercurrent.path),g=Fl(r.crust.path),R=Fl(r.materials.detailA.path),I=Fl(r.materials.detailB.path),C=Hf(e,h),M=C?.biomeLayers?.undercurrent??e.biomeLayers?.undercurrent,N=C?.biomeLayers?.crust??e.biomeLayers?.crust??(e.biomeUnderlay?{default:e.biomeUnderlay.default,themes:e.biomeUnderlay.themes,mode:e.biomeUnderlay.mode,scalePx:e.biomeUnderlay.scalePx,opacity:e.biomeUnderlay.opacity}:void 0),Y=C?.biomeMaterials?.crust??e.biomeMaterials?.crust,X=M||p?{...M||{default:p||g||""},default:p||M?.default||"",themes:{...M?.themes||{},[h]:p||M?.default||""},mode:r.undercurrent.mode,scalePx:ce(r.undercurrent.scalePx,Pa,Ua),opacity:ce(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}}:void 0,O=N||g?{...N||{default:g||p||""},default:g||N?.default||"",themes:{...N?.themes||{},[h]:g||N?.default||""},mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:Math.max(0,r.crust.seedShiftPx),offsetX:r.crust.offsetX,offsetY:r.crust.offsetY}:void 0,q=R||Y?.detailA?.default||"",K={...Y?.detailA?.themes||{}};q&&(K[h]=q);const ue=q?{...Y?.detailA||{default:q},default:q,themes:K,mode:r.materials.detailA.mode,scalePx:ce(r.materials.detailA.scalePx,Zn,ei),opacity:ce(r.materials.detailA.opacity,0,1)}:void 0,G=I||Y?.detailB?.default||"",_e={...Y?.detailB?.themes||{}};G&&(_e[h]=G);const oe=G?{...Y?.detailB||{default:G},default:G,themes:_e,mode:r.materials.detailB.mode,scalePx:ce(r.materials.detailB.scalePx,Zn,ei),opacity:ce(r.materials.detailB.opacity,0,1)}:void 0,be=String(r.materials.tintColor||"").trim()||Y?.tint?.default||"#8b6f4a",pe={...Y?.tint?.themes||{}};pe[h]=be;const H={...Y?.tint||{default:be},default:be,themes:pe,opacity:ce(r.materials.tintOpacity,0,1),blendMode:qa(r.materials.tintBlend)},ee=ue||oe||H?{...Y||{},detailA:ue,detailB:oe,tint:H}:void 0,ae=Fl(r.walls.mountainPath),Te=C?.walls,xe={...Te||e.walls?.themes?.[h]||{},mountainPath:ae,scale:ce(r.walls.mountainScale,.2,3),offsetX:r.walls.mountainOffsetX,offsetY:r.walls.mountainOffsetY,anchorX:ce(r.walls.mountainAnchorX,0,1),anchorY:ce(r.walls.mountainAnchorY,0,1),crustBlendMode:fi(r.walls.mountainCrustBlendMode),crustBlendOpacity:ce(r.walls.mountainCrustBlendOpacity,0,1),tintColor:Ri(r.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:fi(r.walls.mountainTintBlendMode),tintOpacity:ce(r.walls.mountainTintOpacity,0,1),mountainScale:ce(r.walls.mountainScale,.2,3),mountainOffsetX:r.walls.mountainOffsetX,mountainOffsetY:r.walls.mountainOffsetY,mountainAnchorX:ce(r.walls.mountainAnchorX,0,1),mountainAnchorY:ce(r.walls.mountainAnchorY,0,1),mountainCrustBlendMode:fi(r.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:ce(r.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Ri(r.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:fi(r.walls.mountainTintBlendMode),mountainTintOpacity:ce(r.walls.mountainTintOpacity,0,1)},k={...e.walls||{},...Te||{},mode:r.walls.mode,interiorDensity:ce(r.walls.interiorDensity,0,.45),clusterBias:ce(r.walls.clusterBias,0,1),keepPerimeter:!!r.walls.keepPerimeter,mountainPath:ae,scale:xe.scale,offsetX:xe.offsetX,offsetY:xe.offsetY,anchorX:xe.anchorX,anchorY:xe.anchorY,crustBlendMode:xe.crustBlendMode,crustBlendOpacity:xe.crustBlendOpacity,tintColor:xe.tintColor,tintBlendMode:xe.tintBlendMode,tintOpacity:xe.tintOpacity,mountainScale:xe.mountainScale,mountainOffsetX:xe.mountainOffsetX,mountainOffsetY:xe.mountainOffsetY,mountainAnchorX:xe.mountainAnchorX,mountainAnchorY:xe.mountainAnchorY,mountainCrustBlendMode:xe.mountainCrustBlendMode,mountainCrustBlendOpacity:xe.mountainCrustBlendOpacity,mountainTintColor:xe.mountainTintColor,mountainTintBlendMode:xe.mountainTintBlendMode,mountainTintOpacity:xe.mountainTintOpacity,themes:{...e.walls?.themes||{},[h]:xe}},$={...C?.biomeLayers||{},undercurrent:X,crust:O,clutter:{...C?.biomeLayers?.clutter||e.biomeLayers?.clutter||{},density:ce(r.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(r.clutter.maxPerHex)),bleedScaleMax:ce(r.clutter.bleedScaleMax,1,2)}},J={...C?.biomeMaterials||{},crust:ee},me={...C||{},seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:$,biomeMaterials:J,walls:k};return{...e,biomeLayers:{...e.biomeLayers||{},undercurrent:X,crust:O,clutter:{...e.biomeLayers?.clutter||{},density:ce(r.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(r.clutter.maxPerHex)),bleedScaleMax:ce(r.clutter.bleedScaleMax,1,2)}},biomeMaterials:{...e.biomeMaterials||{},crust:ee},walls:k,biomePresets:{...e.biomePresets||{},[h]:me}}},[e,r,h]),S=w.useMemo(()=>r?HT(r.theme,r.seed,r.injectHazards,r.walls):null,[r]),_=async()=>{if(!r)return;const p=Kl(r.undercurrent.path),g=Kl(r.crust.path),R=Kl(r.materials.detailA.path),I=Kl(r.materials.detailB.path),M={mountainPath:Kl(r.walls.mountainPath),mountainScale:ce(r.walls.mountainScale,.2,3),mountainOffsetX:r.walls.mountainOffsetX,mountainOffsetY:r.walls.mountainOffsetY,mountainAnchorX:ce(r.walls.mountainAnchorX,0,1),mountainAnchorY:ce(r.walls.mountainAnchorY,0,1),mountainCrustBlendMode:fi(r.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:ce(r.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:Ri(r.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:fi(r.walls.mountainTintBlendMode),mountainTintOpacity:ce(r.walls.mountainTintOpacity,0,1),scale:ce(r.walls.mountainScale,.2,3),offsetX:r.walls.mountainOffsetX,offsetY:r.walls.mountainOffsetY,anchorX:ce(r.walls.mountainAnchorX,0,1),anchorY:ce(r.walls.mountainAnchorY,0,1),crustBlendMode:fi(r.walls.mountainCrustBlendMode),crustBlendOpacity:ce(r.walls.mountainCrustBlendOpacity,0,1),tintColor:Ri(r.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:fi(r.walls.mountainTintBlendMode),tintOpacity:ce(r.walls.mountainTintOpacity,0,1)},N={seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:{undercurrent:{default:p,mode:r.undercurrent.mode,scalePx:ce(r.undercurrent.scalePx,Pa,Ua),opacity:ce(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}},crust:{default:g,mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:r.crust.seedShiftPx,offsetX:r.crust.offsetX,offsetY:r.crust.offsetY},clutter:{density:r.clutter.density,maxPerHex:r.clutter.maxPerHex,bleedScaleMax:r.clutter.bleedScaleMax}},walls:{mode:r.walls.mode,interiorDensity:r.walls.interiorDensity,clusterBias:r.walls.clusterBias,keepPerimeter:r.walls.keepPerimeter,...M},biomeMaterials:{crust:{detailA:{default:R,mode:r.materials.detailA.mode,scalePx:ce(r.materials.detailA.scalePx,Zn,ei),opacity:ce(r.materials.detailA.opacity,0,1)},detailB:{default:I,mode:r.materials.detailB.mode,scalePx:ce(r.materials.detailB.scalePx,Zn,ei),opacity:ce(r.materials.detailB.opacity,0,1)},tint:{default:Ri(r.materials.tintColor,"#8b6f4a"),opacity:ce(r.materials.tintOpacity,0,1),blendMode:qa(r.materials.tintBlend)}}}},Y={theme:r.theme,seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:{undercurrent:{default:p,mode:r.undercurrent.mode,scalePx:ce(r.undercurrent.scalePx,Pa,Ua),opacity:ce(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}},crust:{default:g,mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:r.crust.seedShiftPx,offsetX:r.crust.offsetX,offsetY:r.crust.offsetY},clutter:{density:r.clutter.density,maxPerHex:r.clutter.maxPerHex,bleedScaleMax:r.clutter.bleedScaleMax}},walls:{mode:r.walls.mode,interiorDensity:r.walls.interiorDensity,clusterBias:r.walls.clusterBias,keepPerimeter:r.walls.keepPerimeter,...M,themes:{[h]:M}},biomeMaterials:{crust:{detailA:{default:R,mode:r.materials.detailA.mode,scalePx:ce(r.materials.detailA.scalePx,Zn,ei),opacity:ce(r.materials.detailA.opacity,0,1)},detailB:{default:I,mode:r.materials.detailB.mode,scalePx:ce(r.materials.detailB.scalePx,Zn,ei),opacity:ce(r.materials.detailB.opacity,0,1)},tint:{default:Ri(r.materials.tintColor,"#8b6f4a"),opacity:ce(r.materials.tintOpacity,0,1),blendMode:qa(r.materials.tintBlend)}}},biomePresets:{[h]:N}};try{await navigator.clipboard.writeText(JSON.stringify(Y,null,2)),c("Copied"),window.setTimeout(()=>c(""),1600)}catch{c("Copy failed"),window.setTimeout(()=>c(""),1600)}};return!e||!r||!v||!S?m.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex items-center justify-center",children:[m.jsx("button",{type:"button",onClick:i,className:"absolute top-5 left-5 px-4 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-[0.2em]",children:"Back"}),m.jsx("div",{className:"text-sm text-white/70 uppercase tracking-[0.25em] font-black",children:"Loading Biome Sandbox..."})]}):m.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex",children:[m.jsxs("aside",{className:"w-[420px] border-r border-white/10 bg-[#02040a] overflow-y-auto",children:[m.jsxs("div",{className:"sticky top-0 z-20 border-b border-white/10 bg-[#02040a]/95 backdrop-blur p-4",children:[m.jsxs("div",{className:"flex items-center justify-between gap-3",children:[m.jsx("button",{type:"button",onClick:i,className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-[11px] font-black uppercase tracking-[0.18em]",children:"Back"}),m.jsx("button",{type:"button",onClick:()=>f(Ry(e,r.theme)),className:"px-3 py-2 rounded-lg border border-amber-300/40 bg-amber-500/10 hover:bg-amber-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Reset"}),m.jsx("button",{type:"button",onClick:_,className:"px-3 py-2 rounded-lg border border-cyan-300/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Copy JSON"})]}),m.jsxs("div",{className:"mt-3 text-[10px] uppercase tracking-[0.22em] text-white/50",children:["Hop / Biomes ",o?`* ${o}`:""]})]}),m.jsxs("div",{className:"p-4 space-y-6",children:[m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/75",children:"Preview"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Theme"}),m.jsx("select",{value:r.theme,onChange:p=>f(g=>g&&{...g,theme:p.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:ET.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed"}),m.jsx("input",{value:r.seed,onChange:p=>f(g=>g&&{...g,seed:p.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[m.jsx("input",{type:"checkbox",checked:r.injectHazards,onChange:p=>f(g=>g&&{...g,injectHazards:p.target.checked})}),"Inject synthetic lava/fire patches for mask testing"]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-cyan-200",children:"Undercurrent"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),m.jsx("input",{list:"sandbox-undercurrent-paths",value:r.undercurrent.path,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,path:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-undercurrent-paths",children:A.undercurrent.map(p=>m.jsx("option",{value:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),m.jsx("select",{value:r.undercurrent.mode,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Rc.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),m.jsx("input",{type:"number",min:Pa,max:Ua,step:16,value:r.undercurrent.scalePx,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scalePx:ce(ut(p.target.value,g.undercurrent.scalePx),Pa,Ua)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.undercurrent.opacity,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,opacity:ce(ut(p.target.value,g.undercurrent.opacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll X"}),m.jsx("input",{type:"number",step:5,value:r.undercurrent.scrollX,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollX:ut(p.target.value,g.undercurrent.scrollX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll Y"}),m.jsx("input",{type:"number",step:5,value:r.undercurrent.scrollY,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollY:ut(p.target.value,g.undercurrent.scrollY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Duration"}),m.jsx("input",{type:"number",min:1e3,step:500,value:r.undercurrent.scrollDurationMs,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,scrollDurationMs:Math.max(1e3,ut(p.target.value,g.undercurrent.scrollDurationMs))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:4,value:r.undercurrent.offsetX,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,offsetX:ut(p.target.value,g.undercurrent.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:4,value:r.undercurrent.offsetY,onChange:p=>f(g=>g&&{...g,undercurrent:{...g.undercurrent,offsetY:ut(p.target.value,g.undercurrent.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-amber-200",children:"Crust"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),m.jsx("input",{list:"sandbox-crust-paths",value:r.crust.path,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,path:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-crust-paths",children:A.crust.map(p=>m.jsx("option",{value:p},p))}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),m.jsx("select",{value:r.crust.mode,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Rc.map(p=>m.jsx("option",{value:p,children:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),m.jsx("input",{type:"number",min:64,step:16,value:r.crust.scalePx,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,scalePx:Math.max(64,ut(p.target.value,g.crust.scalePx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),m.jsx("input",{type:"number",min:1,max:1,step:.01,value:1,onChange:()=>f(p=>p&&{...p,crust:{...p.crust,opacity:1}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed Shift Budget"}),m.jsx("input",{type:"number",min:0,step:8,value:r.crust.seedShiftPx,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,seedShiftPx:Math.max(0,ut(p.target.value,g.crust.seedShiftPx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:4,value:r.crust.offsetX,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,offsetX:ut(p.target.value,g.crust.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:4,value:r.crust.offsetY,onChange:p=>f(g=>g&&{...g,crust:{...g.crust,offsetY:ut(p.target.value,g.crust.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-rose-200",children:"Walls / Mountains"}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mountain Asset"}),m.jsx("input",{list:"sandbox-mountain-paths",value:r.walls.mountainPath,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainPath:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs",placeholder:"/assets/biomes/biome.volcano.mountain.01.webp"}),m.jsx("datalist",{id:"sandbox-mountain-paths",children:A.mountain.map(p=>m.jsx("option",{value:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale"}),m.jsx("input",{type:"number",min:.2,max:3,step:.01,value:r.walls.mountainScale,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainScale:ce(ut(p.target.value,g.walls.mountainScale),.2,3)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor X"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainAnchorX,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainAnchorX:ce(ut(p.target.value,g.walls.mountainAnchorX),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),m.jsx("input",{type:"number",step:2,value:r.walls.mountainOffsetX,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainOffsetX:ut(p.target.value,g.walls.mountainOffsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),m.jsx("input",{type:"number",step:2,value:r.walls.mountainOffsetY,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainOffsetY:ut(p.target.value,g.walls.mountainOffsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor Y"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainAnchorY,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainAnchorY:ce(ut(p.target.value,g.walls.mountainAnchorY),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Crust Blend"}),m.jsx("select",{value:r.walls.mountainCrustBlendMode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainCrustBlendMode:fi(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Oy.map(p=>m.jsx("option",{value:p,children:p},`mountain-blend-${p}`))})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Blend Opacity ",r.walls.mountainCrustBlendOpacity.toFixed(2)]}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainCrustBlendOpacity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainCrustBlendOpacity:ce(ut(p.target.value,g.walls.mountainCrustBlendOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Mountain Tint"}),m.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[m.jsx("input",{type:"color",value:y,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintColor:p.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Mountain Tint Color Picker"}),m.jsx("input",{value:r.walls.mountainTintColor,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintColor:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Tint Blend"}),m.jsx("select",{value:r.walls.mountainTintBlendMode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintBlendMode:fi(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Oy.map(p=>m.jsx("option",{value:p,children:p},`mountain-tint-blend-${p}`))})]}),m.jsxs("div",{children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",r.walls.mountainTintOpacity.toFixed(2)]}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainTintOpacity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mountainTintOpacity:ce(ut(p.target.value,g.walls.mountainTintOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Wall Layout Mode"}),m.jsx("select",{value:r.walls.mode,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,mode:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:MT.map(p=>m.jsx("option",{value:p,children:p},`wall-mode-${p}`))}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Interior Density ",r.walls.interiorDensity.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:.45,step:.01,value:r.walls.interiorDensity,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,interiorDensity:ce(ut(p.target.value,g.walls.interiorDensity),0,.45)}}),className:"w-full"})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Cluster Bias ",r.walls.clusterBias.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:1,step:.01,value:r.walls.clusterBias,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,clusterBias:ce(ut(p.target.value,g.walls.clusterBias),0,1)}}),className:"w-full"})]}),m.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[m.jsx("input",{type:"checkbox",checked:r.walls.keepPerimeter,onChange:p=>f(g=>g&&{...g,walls:{...g.walls,keepPerimeter:p.target.checked}})}),"Keep perimeter walls (custom mode)"]})]}),m.jsxs("section",{className:"space-y-3",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-fuchsia-200",children:"Crust Materials"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Detail A"}),m.jsx("input",{list:"sandbox-detail-paths",value:r.materials.detailA.path,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,path:p.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsx("datalist",{id:"sandbox-detail-paths",children:A.detail.map(p=>m.jsx("option",{value:p},p))}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsx("select",{value:r.materials.detailA.mode,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,mode:p.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Rc.map(p=>m.jsx("option",{value:p,children:p},`detail-a-${p}`))}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.materials.detailA.opacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,opacity:ce(ut(p.target.value,g.materials.detailA.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsx("input",{type:"number",min:Zn,max:ei,step:16,value:r.materials.detailA.scalePx,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailA:{...g.materials.detailA,scalePx:ce(ut(p.target.value,g.materials.detailA.scalePx),Zn,ei)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Detail B"}),m.jsx("input",{list:"sandbox-detail-paths",value:r.materials.detailB.path,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,path:p.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsx("select",{value:r.materials.detailB.mode,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,mode:p.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Rc.map(p=>m.jsx("option",{value:p,children:p},`detail-b-${p}`))}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.materials.detailB.opacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,opacity:ce(ut(p.target.value,g.materials.detailB.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsx("input",{type:"number",min:Zn,max:ei,step:16,value:r.materials.detailB.scalePx,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,detailB:{...g.materials.detailB,scalePx:ce(ut(p.target.value,g.materials.detailB.scalePx),Zn,ei)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),m.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Tint"}),m.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[m.jsx("input",{type:"color",value:b,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Tint Color Picker"}),m.jsx("input",{value:r.materials.tintColor,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),m.jsx("div",{className:"grid grid-cols-8 gap-2",children:_T.map(p=>m.jsx("button",{type:"button",onClick:()=>f(g=>g&&{...g,materials:{...g.materials,tintColor:p}}),className:`h-6 rounded border ${Ri(r.materials.tintColor)===Ri(p)?"border-white":"border-white/20"}`,style:{backgroundColor:p},title:p},`tint-swatch-${p}`))}),m.jsxs("div",{className:"space-y-2",children:[m.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",r.materials.tintOpacity.toFixed(2)]}),m.jsx("input",{type:"range",min:0,max:1,step:.01,value:r.materials.tintOpacity,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintOpacity:ce(ut(p.target.value,g.materials.tintOpacity),0,1)}}),className:"w-full"})]}),m.jsx("select",{value:r.materials.tintBlend,onChange:p=>f(g=>g&&{...g,materials:{...g.materials,tintBlend:qa(p.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:wT.map(p=>m.jsx("option",{value:p,children:p},`blend-${p}`))})]}),m.jsxs("section",{className:"space-y-3 pb-8",children:[m.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-emerald-200",children:"Clutter"}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Density"}),m.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.clutter.density,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,density:ce(ut(p.target.value,g.clutter.density),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Max / Hex"}),m.jsx("input",{type:"number",min:0,max:5,step:1,value:r.clutter.maxPerHex,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,maxPerHex:Math.max(0,Math.floor(ut(p.target.value,g.clutter.maxPerHex)))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Bleed Max"}),m.jsx("input",{type:"number",min:1,max:2,step:.01,value:r.clutter.bleedScaleMax,onChange:p=>f(g=>g&&{...g,clutter:{...g.clutter,bleedScaleMax:ce(ut(p.target.value,g.clutter.bleedScaleMax),1,2)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]})]})]}),m.jsxs("main",{className:"flex-1 relative bg-[#050914] overflow-hidden",children:[m.jsxs("div",{className:"absolute top-4 right-5 z-20 px-3 py-2 rounded-lg border border-white/15 bg-black/35 text-[10px] font-black uppercase tracking-[0.2em]",children:["Theme: ",r.theme]}),m.jsx("div",{className:"w-full h-full p-6",children:m.jsx("div",{className:"w-full h-full rounded-[28px] border border-white/10 bg-[#030712]/70 overflow-hidden",children:m.jsx(l0,{gameState:S,onMove:()=>{},selectedSkillId:null,showMovementRange:!1,assetManifest:v})})})]})]})},qT=e=>{const{gameStatus:i,isReplayMode:a,isBusy:o,postCommitInputLock:c,isPlayerTurn:r,hasPendingStatus:f,pendingFrameCount:h}=e,b=f||h>0;let y="IDLE";return a?y="REPLAY":i!=="playing"?y="IDLE":b?y=o?"INTERCEPT_ANIMATING":"INTERCEPT_READY":o?y="PLAYBACK":c&&r?y="POST_COMMIT_LOCK":c&&!r?y="POST_COMMIT_QUEUE":r?y="INPUT_OPEN":y="QUEUE_ADVANCE",{phase:y,canPlayerInput:y==="INPUT_OPEN",shouldAdvanceQueue:y==="QUEUE_ADVANCE"||y==="POST_COMMIT_QUEUE",shouldResolvePending:y==="INTERCEPT_READY",queueAdvanceDelayMs:380}},zT=e=>{const i=e.payload;if(!(!i||typeof i!="object")){if("q"in i&&"r"in i)return{q:Number(i.q??0),r:Number(i.r??0),s:Number(i.s??0)};if(e.type==="USE_SKILL"){const a=i;return{skillId:a.skillId??"unknown",target:a.target?{q:a.target.q,r:a.target.r,s:a.target.s}:null}}if(e.type==="START_RUN")return{loadoutId:i.loadoutId??"unknown",mode:i.mode??"normal"};if(e.type==="LOAD_STATE"){const a=i;return{floor:a?.floor??0,gameStatus:a?.gameStatus??"unknown",turnNumber:a?.turnNumber??0,queueLength:Array.isArray(a?.initiativeQueue)?a.initiativeQueue.length:0}}return{}}};function $T(){const e=(F,te)=>{const de=new Set(F.map(Ct=>Ct.type)),we=de.has("ADVANCE_TURN"),ve=de.has("RESOLVE_PENDING"),Ie=F.length,Ye=te>=5&&Ie<Math.max(25,te*4);return{actionCount:Ie,hasTurnAdvance:we,hasPendingResolve:ve,suspiciouslyShort:Ye}},i=F=>{const te=F||[],de=te.length>0?te[te.length-1]:void 0;return`${te.length}:${de?.type??"none"}`},a=F=>{const te=F||[],de=te.length>0?te[te.length-1]:void 0;return`${te.length}:${de?.id??"none"}:${de?.phase??"none"}`},[o,c]=w.useState(()=>window.location.pathname);w.useEffect(()=>{const F=()=>c(window.location.pathname);return window.addEventListener("popstate",F),()=>window.removeEventListener("popstate",F)},[]);const r=F=>{window.location.pathname!==F&&window.history.pushState({},"",F),c(F)},f=o.toLowerCase().startsWith("/hop")?"/Hop":"",h=`${f||""}`||"/",b=`${f}/Arcade`||"/Arcade",y=`${f}/Biomes`||"/Biomes",v=o.toLowerCase().replace(/\/+$/,""),S=v.endsWith("/arcade")||v.endsWith("/arcarde"),_=v.endsWith("/biomes"),[p,g]=w.useReducer(rA,null,()=>{const F=localStorage.getItem("hop_save");if(F)try{const te=JSON.parse(F);if(te.tiles){const ve=Array.isArray(te.tiles)?te.tiles:Object.entries(te.tiles);te.tiles=new Map(ve.map(([Ie,Ye])=>[Ie,{...Ye,traits:new Set(Ye.traits)}]))}Array.isArray(te.occupancyMask)&&(te.occupancyMask=te.occupancyMask.map(ve=>typeof ve=="string"?BigInt(ve):ve));const de=ve=>ve instanceof Map?ve:Array.isArray(ve)?new Map(ve):ve&&typeof ve=="object"?new Map(Object.entries(ve)):new Map,we=ve=>{const Ie={...ve,components:de(ve?.components)},Ye=Xl(Ie),lt=(Ye.components??new Map).get("trinity");if(!lt)return Ye;const Ke=Yc({body:Number(lt.body||0),mind:Number(lt.mind||0),instinct:Number(lt.instinct||0)});return{...Ye,maxHp:Ke,hp:Math.min(Ke,Math.max(0,Number(Ye.hp??Ke)))}};return te.player=Ef(we(te.player)),te.enemies=Array.isArray(te.enemies)?te.enemies.map(we):[],te}catch(te){console.error("Failed to hydrate Map state:",te)}return Mf()}),R=typeof window<"u"&&!!window.__HOP_DEBUG_QUERY,[I,C]=w.useState(null);w.useEffect(()=>{let F=!0;return JA().then(te=>{F&&(C(te),window.__HOP_ASSET_MANIFEST=te)}),()=>{F=!1}},[]),w.useEffect(()=>{R&&(window.state=p,window.QUERY={tile:(F,te)=>{const we=he({q:F,r:te});return console.log(`Checking Map for Key: "${we}"`),p.tiles.get(we)},whereAmI:()=>{const F=p.player.position,te=he(F),de=p.tiles.get(te);return{coords:F,key:te,tileExists:!!de,tileData:de}},dumpKeys:()=>Array.from(p.tiles.keys())})},[p,R]);const M=w.useRef(null),N=w.useRef(""),Y=p.gameStatus==="playing"||p.gameStatus==="choosing_upgrade",X=`${p.gameStatus}|${p.floor}|${p.turnNumber}|${p.player.hp}|${he(p.player.position)}|${p.enemies.length}|${p.actionLog?.length??0}|${p.message?.length??0}`;w.useEffect(()=>{if(M.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(M.current):window.clearTimeout(M.current),M.current=null),!Y){N.current="",localStorage.removeItem("hop_save");return}if(X===N.current)return;const F=()=>{const te={...p,tiles:Array.from(p.tiles.entries()).map(([we,ve])=>[we,{...ve,traits:Array.from(ve.traits)}])},de=we=>JSON.stringify(we,(ve,Ie)=>typeof Ie=="bigint"?Ie.toString():Ie);localStorage.setItem("hop_save",de(te)),N.current=X,M.current=null};return typeof window.requestIdleCallback=="function"?M.current=window.requestIdleCallback(F,{timeout:500}):M.current=window.setTimeout(F,120),()=>{M.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(M.current):window.clearTimeout(M.current),M.current=null)}},[p,Y,X]);const[O,q]=w.useState(!1),[K,ue]=w.useState([]),[G,_e]=w.useState(!1),[oe,be]=w.useState(null),pe=w.useRef(0),H=w.useRef(null);w.useEffect(()=>{if(!(typeof window<"u"&&!!window.__HOP_DEBUG_PERF))return;let te=0,de=performance.now(),we=0,ve=0,Ie=de;const Ye=Ct=>{const lt=Ct-de;if(de=Ct,we++,ve+=lt,Ct-Ie>=2e3){const Ke=ve/Math.max(1,we),rt=1e3/Math.max(1,Ke);console.log("[HOP_PERF]",{fps:Number(rt.toFixed(1)),avgFrameMs:Number(Ke.toFixed(2)),frames:we}),Ie=Ct,we=0,ve=0}te=requestAnimationFrame(Ye)};return te=requestAnimationFrame(Ye),()=>cancelAnimationFrame(te)},[p.gameStatus,O]);const[ee,ae]=w.useState(null),[Te,xe]=w.useState(!1),[k,$]=w.useState(!1),[J,me]=w.useState(!1),[Me,Re]=w.useState(0),ke=w.useRef(null),ht=w.useRef(null),$e=w.useRef(null),kt=w.useRef(null),vn=p.pendingFrames?.length??0,St=w.useMemo(()=>qT({gameStatus:p.gameStatus,isReplayMode:O,isBusy:k,postCommitInputLock:J,isPlayerTurn:Gl(p),hasPendingStatus:!!p.pendingStatus,pendingFrameCount:vn}),[p.gameStatus,O,k,J,p.pendingStatus,vn,p.initiativeQueue,p.player.id,p.enemies]),nn=!St.canPlayerInput,At=w.useRef([]),Un=w.useRef(0),hi=w.useRef(""),Ue=p.initiativeQueue?.entries?.[Math.max(0,p.initiativeQueue.currentIndex??0)]?.actorId??p.initiativeQueue?.entries?.[0]?.actorId??"none",Le=w.useCallback((F,te)=>{const de={id:++Un.current,t:Date.now(),event:F,turnNumber:p.turnNumber,phase:St.phase,gameStatus:p.gameStatus,playerTurn:Gl(p),isBusy:k,postCommitInputLock:J,pendingStatus:p.pendingStatus?.status??"none",pendingFrames:p.pendingFrames?.length??0,canPlayerInput:St.canPlayerInput,shouldAdvanceQueue:St.shouldAdvanceQueue,shouldResolvePending:St.shouldResolvePending,actionLogLength:p.actionLog?.length??0,queueHead:Ue,details:te};At.current.push(de),At.current.length>800&&At.current.splice(0,At.current.length-800)},[p.turnNumber,p.gameStatus,p.pendingStatus,p.pendingFrames,p.actionLog,p.initiativeQueue,p.player.id,p.enemies,St.phase,St.canPlayerInput,St.shouldAdvanceQueue,St.shouldResolvePending,k,J,Ue]),qe=w.useCallback((F,te)=>{Le("DISPATCH",{source:te,actionType:F.type,payload:zT(F)}),g(F)},[Le]);w.useEffect(()=>{const F=[St.phase,p.turnNumber,p.gameStatus,p.pendingStatus?.status??"none",p.pendingFrames?.length??0,k?1:0,J?1:0,Ue].join("|");F!==hi.current&&(Le("TURN_STATE"),hi.current=F)},[St.phase,p.turnNumber,p.gameStatus,p.pendingStatus,p.pendingFrames,k,J,Ue,Le]),w.useEffect(()=>(window.__HOP_TURN_TRACE=At.current,window.__HOP_DUMP_TURN_TRACE=()=>[...At.current],window.__HOP_PRINT_TURN_TRACE=(F=80)=>{const te=At.current.slice(-Math.max(1,Math.floor(F)));return console.table(te.map(de=>({id:de.id,event:de.event,turn:de.turnNumber,phase:de.phase,status:de.gameStatus,playerTurn:de.playerTurn,busy:de.isBusy,lock:de.postCommitInputLock,pending:`${de.pendingStatus}/${de.pendingFrames}`,queueHead:de.queueHead,actionLog:de.actionLogLength,details:de.details?JSON.stringify(de.details):""}))),te},window.__HOP_CLEAR_TURN_TRACE=()=>{At.current.length=0,Un.current=0},At.current.push({id:++Un.current,t:Date.now(),event:"TRACE_READY",turnNumber:0,phase:"INIT",gameStatus:"init",playerTurn:!1,isBusy:!1,postCommitInputLock:!1,pendingStatus:"none",pendingFrames:0,canPlayerInput:!1,shouldAdvanceQueue:!1,shouldResolvePending:!1,actionLogLength:0,queueHead:"none"}),()=>{delete window.__HOP_DUMP_TURN_TRACE,delete window.__HOP_PRINT_TURN_TRACE,delete window.__HOP_CLEAR_TURN_TRACE}),[]);const Tn=w.useRef([]),Qt=w.useRef(null),En=w.useRef(""),[Vt,Ve]=w.useState([]),Yt=w.useCallback(F=>{const te=Date.now();Ve(de=>[...de,{...F,createdAt:te}].slice(-4))},[]),$i=w.useCallback(F=>{if(!(!F||F.length===0)){Tn.current=[...Tn.current,...F].slice(-600),window.__HOP_SIM_EVENTS=Tn.current,window.dispatchEvent(new CustomEvent("hop:simulation-events",{detail:{turn:p.turnNumber,events:F}})),Le("SIM_EVENTS",{count:F.length,lastType:F[F.length-1]?.type??"unknown"});for(const te of F)if(te.type==="DamageTaken"&&te.targetId===p.player.id){const de=Math.max(0,Number(te.payload?.amount||0));de>0&&Yt({id:`sim-toast-${te.id}`,text:`-${de} HP`,tone:"damage"})}else if(te.type==="Healed"&&te.targetId===p.player.id){const de=Math.max(0,Number(te.payload?.amount||0));de>0&&Yt({id:`sim-toast-${te.id}`,text:`+${de} HP`,tone:"heal"})}else if(te.type==="StatusApplied"&&te.targetId===p.player.id){const we=String(te.payload?.status||"Status").split("_").filter(Boolean).map(ve=>ve.charAt(0).toUpperCase()+ve.slice(1)).join(" ");Yt({id:`sim-toast-${te.id}`,text:we,tone:"status"})}else if(te.type==="MessageLogged"){const de=String(te.payload?.text||"").trim();if(!de)continue;const we=de.toLowerCase();if(!(we.includes("stun")||we.includes("snare")||we.includes("lava")||we.includes("fire")||we.includes("burn")||we.includes("heal")||we.includes("shrine")||we.includes("stairs")||we.includes("roll away")||we.includes("ward")||we.includes("orb")))continue;const Ie=de.length>52?`${de.slice(0,49)}...`:de;Yt({id:`sim-toast-${te.id}`,text:Ie,tone:"system"})}}},[Le,p.turnNumber,p.player.id,Yt]),kn=w.useCallback(F=>{Qt.current=F,window.__HOP_UI_MIRROR=F},[]);w.useEffect(()=>(window.__HOP_SIM_EVENTS=Tn.current,window.__HOP_DUMP_SIM_EVENTS=()=>[...Tn.current],window.__HOP_CLEAR_SIM_EVENTS=()=>{Tn.current=[],window.__HOP_SIM_EVENTS=[]},window.__HOP_DUMP_MIRROR=()=>window.__HOP_MIRROR_LAST,()=>{delete window.__HOP_DUMP_SIM_EVENTS,delete window.__HOP_CLEAR_SIM_EVENTS,delete window.__HOP_DUMP_MIRROR}),[]),w.useEffect(()=>{if(Vt.length===0)return;const F=window.setTimeout(()=>{const te=Date.now();Ve(de=>de.filter(we=>te-we.createdAt<2200))},180);return()=>window.clearTimeout(F)},[Vt]),w.useEffect(()=>{const F=hA(p);window.__HOP_ENGINE_MIRROR=F;const te=Qt.current;if(!te||te.turn!==F.turn||te.stackTick!==F.stackTick)return;const de=gA(F,te),we=`${F.turn}:${F.stackTick}:${de.ok?"ok":de.mismatches.length}`;we!==En.current&&(En.current=we,window.__HOP_MIRROR_LAST={engineSnapshot:F,uiSnapshot:te,result:de},de.ok||(Le("MIRROR_MISMATCH",{count:de.mismatches.length}),console.warn("[HOP_MIRROR] snapshot mismatch detected",de.mismatches)))},[p,Le]),w.useEffect(()=>{if(!St.shouldAdvanceQueue)return;Le("QUEUE_SCHEDULE",{delayMs:St.queueAdvanceDelayMs});const F=window.setTimeout(()=>{qe({type:"ADVANCE_TURN"},"queue_pump")},St.queueAdvanceDelayMs);return()=>window.clearTimeout(F)},[St.shouldAdvanceQueue,St.queueAdvanceDelayMs,p.turnNumber,p.initiativeQueue,p.player.id,p.enemies,qe,Le]);const pn=(F="unknown")=>{J&&Le("LOCK_RELEASE",{reason:F,lockTurn:ke.current,expectedActionLogLength:ht.current}),me(!1),ke.current=null,ht.current=null,$e.current=null,an.current=!1,wt.current="",wn.current="",kt.current!==null&&(window.clearTimeout(kt.current),kt.current=null)},Vi=w.useRef(""),sn=i(p.visualEvents),Lt=w.useRef(""),Jt=a(p.timelineEvents),an=w.useRef(!1),wt=w.useRef(""),wn=w.useRef(""),_t=220,ga=900,Yi=w.useRef(!1),qn=w.useRef(0),Zt=`${p.pendingStatus?.status??"none"}:${vn}`;w.useEffect(()=>{k||(Vi.current=sn,Lt.current=Jt)},[k,sn,Jt]),w.useEffect(()=>{Yi.current=!1,qn.current=performance.now()},[Zt]),w.useEffect(()=>{(p.pendingStatus||vn>0)&&k&&(Yi.current=!0)},[p.pendingStatus,vn,k]),w.useEffect(()=>{J&&k&&(an.current=!0)},[J,k]),w.useEffect(()=>{if(!J)return;const F=window.setTimeout(()=>{Re(te=>te+1)},120);return()=>window.clearTimeout(F)},[J,Me]),w.useEffect(()=>{const F=!k&&sn===Vi.current&&Jt===Lt.current,te=(p.timelineEvents||[]).some(rt=>rt.blocking),de=(p.timelineEvents||[]).filter(rt=>rt.blocking).reduce((rt,Kt)=>rt+(Kt.suggestedDurationMs||0),0),we=(p.visualEvents||[]).reduce((rt,Kt)=>{if(Kt.type!=="kinetic_trace")return rt;const Bn=Kt.payload;if(!Bn)return rt;const Nt=Math.max(0,Number(Bn.startDelayMs||0)),ls=Math.max(0,Number(Bn.durationMs||0));return Math.max(rt,Nt+ls)},0),ve=Math.max(de,we),Ie=ve>0?Math.max(160,Math.min(3200,ve+40)):0,Ye=Math.max(0,performance.now()-qn.current),Ct=!te||Yi.current,lt=!te||Ye>=Ie,Ke=F&&(Ct||lt);if(St.shouldResolvePending){if(Ke){Le("PENDING_RESOLVE_READY",{noPendingAnimations:F,hasBlockingTimeline:te,movementTraceBudgetMs:we,elapsedPendingMs:Ye,requiredFallbackDelayMs:Ie}),qe({type:"RESOLVE_PENDING"},"pending_ready");return}if(!k&&te&&!Yi.current){Le("PENDING_RESOLVE_WAIT",{movementTraceBudgetMs:we,elapsedPendingMs:Ye,requiredFallbackDelayMs:Ie});const rt=Math.max(0,Ie-Ye),Kt=window.setTimeout(()=>{qe({type:"RESOLVE_PENDING"},"pending_fallback_delay")},rt);return()=>window.clearTimeout(Kt)}}},[St.shouldResolvePending,p.timelineEvents,p.visualEvents,k,sn,Jt,qe,Le]),w.useEffect(()=>{if(!J)return;if(O||p.gameStatus!=="playing"){pn("mode_or_status_change");return}if(p.pendingStatus||(p.pendingFrames?.length??0)>0){pn("pending_intercept");return}const F=ke.current,te=ht.current,de=$e.current!==null?Math.max(0,performance.now()-$e.current):Number.POSITIVE_INFINITY,we=F!==null?p.turnNumber>F:!1,ve=te!==null?(p.actionLog?.length??0)>=te:!1,Ie=de>=_t,Ye=sn!==wt.current||Jt!==wn.current,Ct=!we&&!ve,lt=!an.current&&Ye&&de<ga,Ke=p.gameStatus==="playing"&&!O&&!k&&!p.pendingStatus&&(p.pendingFrames?.length??0)===0&&Gl(p);if(lt){Le("LOCK_WAIT_FOR_BUSY",{lockAgeMs:de,visualsChangedSinceArm:Ye});return}if(Ke&&Ct&&de>450){pn("no_progress_timeout");return}Ke&&Ie&&(we||ve||de>1500)&&pn(we?"turn_advanced":ve?"action_committed":"age_fallback")},[J,O,p.gameStatus,p.turnNumber,p.pendingStatus,p.pendingFrames,p.initiativeQueue,p.actionLog,k,p.player.id,p.enemies,Le,sn,Jt,Me]),w.useEffect(()=>{p.gameStatus!=="playing"&&J&&pn("not_playing")},[p.gameStatus,J,Le]),w.useEffect(()=>{if(J)return kt.current!==null&&window.clearTimeout(kt.current),kt.current=window.setTimeout(()=>{J&&(console.error("[HOP_INPUT_LOCK] Watchdog released stuck post-commit lock",{turnNumber:p.turnNumber,pendingStatus:p.pendingStatus?.status,pendingFrames:p.pendingFrames?.length??0,playerTurn:Gl(p),isBusy:k,actionLogLength:p.actionLog?.length??0,traceTail:At.current.slice(-40)}),Le("LOCK_WATCHDOG_RELEASE"),pn("watchdog"))},8e3),()=>{kt.current!==null&&(window.clearTimeout(kt.current),kt.current=null)}},[J,p.turnNumber,p.pendingStatus,p.actionLog,k,p.initiativeQueue,p.player.id,p.enemies,Le]),w.useEffect(()=>{if(!J)return;const F=window.setTimeout(()=>{Le("LOCK_STALL_SNAPSHOT",{lockAgeMs:$e.current!==null?Math.max(0,performance.now()-$e.current):null})},2500);return()=>window.clearTimeout(F)},[J,Le]);const[Mt,hn]=w.useState(null),[Ft,Fe]=w.useState(null),Ot=w.useRef(p.floor);w.useEffect(()=>{if(p.gameStatus==="playing"&&p.floor!==Ot.current){Fe({floor:p.floor,theme:p.theme||"Inferno"}),Ot.current=p.floor;const F=setTimeout(()=>Fe(null),3e3);return()=>clearTimeout(F)}},[p.floor,p.gameStatus,p.theme]),w.useEffect(()=>{if(p.gameStatus==="playing"&&p.floor===1&&!Ot.current){Fe({floor:1,theme:p.theme||"Inferno"}),Ot.current=1;const F=setTimeout(()=>Fe(null),3e3);return()=>clearTimeout(F)}},[p.gameStatus]);const on=()=>{kt.current!==null&&(window.clearTimeout(kt.current),kt.current=null),ke.current=p.turnNumber,ht.current=(p.actionLog?.length??0)+1,$e.current=performance.now(),an.current=!1,wt.current=sn,wn.current=Jt,me(!0),Le("LOCK_ARM",{lockTurn:p.turnNumber,expectedActionLogLength:(p.actionLog?.length??0)+1,eventHashAtArm:sn,timelineHashAtArm:Jt})},Li=F=>{nn||ae(F)},ft=F=>{if(!nn){if(ee){on(),qe({type:"USE_SKILL",payload:{skillId:ee,target:F}},"player_use_skill"),ae(null);return}if(ne(F,p.player.position)){xe(!Te);return}on(),qe({type:"MOVE",payload:F},"player_move"),xe(!1)}},qt=F=>{O||k||qe({type:"SELECT_UPGRADE",payload:F},"upgrade_select")},zn=()=>{qe({type:"RESET"},"reset"),ae(null),q(!1),be(null)},gi=()=>{nn||(on(),qe({type:"WAIT"},"player_wait"),ae(null))},os=F=>{if(!F)return;const te=Wg(F.actions||[]);if(!te.valid){const Ie=`Replay rejected: ${te.errors.slice(0,3).join(" | ")}`;be(Ie),console.error("[HOP_REPLAY] Invalid replay actions",{replayId:F.id,errors:te.errors});return}be(null),q(!0),ue(te.actions),_e(!1),pe.current=0;const de=F.seed||F.id||String(Date.now()),we=F.loadoutId?jo[F.loadoutId]:void 0,ve=Cs(1,de,de,void 0,we);qe({type:"LOAD_STATE",payload:ve},"replay_start")},Fi=()=>{const F=pe.current;if(F>=K.length){_e(!1);return}qe(K[F],"replay_step"),pe.current=F+1};w.useEffect(()=>{if(!G||!O)return;const F=window.setInterval(Fi,500);return()=>window.clearInterval(F)},[G,O,K]);const ks=()=>{q(!1),be(null),Ln()},Ii=(F,te)=>{qe({type:"LOAD_STATE",payload:F},"scenario_load"),hn(te),ae(null)},Ln=()=>{qe({type:"EXIT_TO_HUB"},"exit_to_hub"),ae(null),q(!1),be(null),r(h)};w.useEffect(()=>{if(!O){if((p.gameStatus==="won"||p.gameStatus==="lost")&&H.current!==p.initialSeed){H.current=p.initialSeed||"default";const F=p.initialSeed??p.rngSeed??"0",te=p.completedRun?.score||(p.player.hp||0)+(p.floor||0)*100,de=Wg(p.actionLog||[]);if(!de.valid){console.error("[HOP_REPLAY] Refusing to persist replay with invalid action log",{errors:de.errors});return}const we=e(de.actions,p.floor||0),ve={id:`run-${Date.now()}`,seed:F,loadoutId:p.player.archetype,actions:de.actions,score:te,floor:p.floor,date:new Date().toISOString(),replayVersion:2,diagnostics:we},Ie=localStorage.getItem("hop_replays_v1"),Ye=Ie?JSON.parse(Ie):[],Ct=[ve,...Ye].slice(0,100);localStorage.setItem("hop_replays_v1",JSON.stringify(Ct));const lt=localStorage.getItem("hop_leaderboard_v1");let Ke=lt?JSON.parse(lt):[];Ke.push({id:ve.id,name:"Player",score:ve.score,floor:ve.floor,date:ve.date,seed:ve.seed,loadoutId:ve.loadoutId,actions:ve.actions,replayVersion:ve.replayVersion,diagnostics:ve.diagnostics}),Ke.sort((rt,Kt)=>Kt.score-rt.score),Ke=Ke.slice(0,5),localStorage.setItem("hop_leaderboard_v1",JSON.stringify(Ke))}p.gameStatus==="hub"&&(H.current=null)}},[p.gameStatus,O,p.initialSeed]);const yi=F=>{const te=p.selectedLoadoutId;if(!te){console.warn("Start Run called without a selected loadout.");return}qe({type:"START_RUN",payload:{loadoutId:te,mode:F}},"hub_start_run")},In=F=>{qe({type:"START_RUN",payload:{loadoutId:F,mode:"daily"}},"arcade_start_run"),r(h)};return _?m.jsx(UT,{assetManifest:I,onBack:()=>r(h)}):p.gameStatus==="hub"?m.jsxs("div",{className:"w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[!S&&m.jsx("button",{type:"button",onClick:()=>r(y),className:"absolute top-4 right-4 z-40 px-4 py-2 rounded-xl border border-cyan-300/35 bg-cyan-500/10 hover:bg-cyan-500/20 text-[10px] font-black uppercase tracking-[0.2em]",children:"Biome Sandbox"}),S?m.jsx(TT,{onBack:()=>r(h),onLaunchArcade:In}):m.jsx(xT,{gameState:p,onSelectLoadout:F=>{qe({type:"APPLY_LOADOUT",payload:F},"hub_select_loadout")},onStartRun:yi,onOpenArcade:()=>r(b),onLoadScenario:Ii,onStartReplay:os}),oe&&m.jsx("div",{className:"absolute top-4 right-4 z-40 max-w-xl px-4 py-3 rounded-xl border border-red-400/40 bg-red-900/70 text-red-100 text-xs font-bold tracking-wide",children:oe}),Mt&&m.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[m.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),m.jsx("p",{className:"text-white text-sm",children:Mt}),m.jsx("button",{onClick:()=>hn(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]})]}):m.jsxs("div",{className:"flex flex-col lg:flex-row w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[m.jsx("div",{className:"lg:hidden shrink-0 border-b border-white/5 bg-[#030712]/95 backdrop-blur-sm z-20",children:m.jsxs("div",{className:"px-4 py-3 flex items-center justify-between gap-4",children:[m.jsxs("div",{className:"min-w-0",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"Level"}),m.jsxs("div",{className:"text-lg font-black text-white leading-none",children:[p.floor,m.jsx("span",{className:"text-white/25 text-sm ml-1",children:"/ 10"})]})]}),m.jsxs("div",{className:"ml-auto min-w-0 text-right",children:[m.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/35 font-bold",children:"HP"}),m.jsxs("div",{className:"text-lg font-black text-red-400 leading-none",children:[p.player.hp,m.jsxs("span",{className:"text-white/25 text-sm ml-1",children:["/ ",p.player.maxHp]})]})]})]})}),m.jsx("aside",{className:"hidden lg:flex w-80 border-r border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:m.jsx(mT,{gameState:p,onReset:zn,onWait:gi,onExitToHub:Ln,inputLocked:nn})}),m.jsx("main",{className:"flex-1 min-h-0 relative flex items-center justify-center bg-[#020617] overflow-hidden",children:m.jsx("div",{className:"w-full h-full p-0 sm:p-3 lg:p-8 flex items-center justify-center",children:m.jsxs("div",{className:`w-full h-full relative border border-white/5 bg-[#030712]/50 rounded-none sm:rounded-3xl lg:rounded-[40px] shadow-[inset_0_0_100px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden ${p.isShaking?"animate-shake":""}`,children:[m.jsx(l0,{gameState:p,onMove:ft,selectedSkillId:ee,showMovementRange:Te,onBusyStateChange:$,assetManifest:I,onSimulationEvents:$i,onMirrorSnapshot:kn}),nn&&p.gameStatus==="playing"&&m.jsx("div",{className:"absolute inset-0 z-40 pointer-events-auto",children:m.jsx("div",{className:"absolute top-3 sm:top-4 lg:top-6 left-1/2 -translate-x-1/2 h-10 w-10 rounded-full bg-black/55 border border-white/15 text-lg flex items-center justify-center text-white/80 animate-pulse","aria-label":"Resolving turn",title:"Resolving turn",children:""})})]})})}),p.gameStatus==="playing"&&Vt.length>0&&m.jsx("div",{className:"lg:hidden fixed left-1/2 -translate-x-1/2 top-16 z-50 pointer-events-none flex flex-col gap-2 w-[min(92vw,26rem)]",children:Vt.map(F=>{const te=F.tone==="damage"?"border-red-400/30 bg-red-950/75 text-red-100":F.tone==="heal"?"border-emerald-400/30 bg-emerald-950/70 text-emerald-100":F.tone==="status"?"border-cyan-300/30 bg-cyan-950/70 text-cyan-100":"border-white/15 bg-black/65 text-white/85";return m.jsx("div",{className:`rounded-xl border px-3 py-2 backdrop-blur-md shadow-[0_4px_20px_rgba(0,0,0,0.35)] text-xs font-bold tracking-wide ${te}`,children:F.text},F.id)})}),m.jsx("aside",{className:"lg:hidden shrink-0 h-[26svh] min-h-[160px] max-h-[250px] border-t border-white/5 bg-[#030712] z-20 overflow-y-auto",children:m.jsxs("div",{className:"p-3 flex flex-col gap-3 h-full",children:[m.jsxs("div",{className:"flex items-center justify-between gap-2",children:[m.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Skills"}),m.jsxs("div",{className:"flex items-center gap-1.5",children:[m.jsx("button",{disabled:nn,onClick:gi,className:`px-2.5 py-1.5 rounded-lg border text-[10px] font-black uppercase tracking-widest ${nn?"bg-white/[0.03] border-white/5 text-white/30 opacity-50":"bg-white/5 border-white/10 text-white/70 active:bg-white/10"}`,children:"Wait"}),m.jsx("button",{onClick:Ln,className:"px-2.5 py-1.5 rounded-lg border border-white/10 bg-white/5 text-[10px] font-black uppercase tracking-widest text-white/70 active:bg-white/10",children:"Hub"}),m.jsx("button",{onClick:zn,className:"px-2.5 py-1.5 rounded-lg border border-red-500/20 bg-red-500/10 text-[10px] font-black uppercase tracking-widest text-red-300/90 active:bg-red-500/20",children:"Reset"})]})]}),m.jsx(vy,{skills:p.player.activeSkills||[],selectedSkillId:ee,onSelectSkill:Li,hasSpear:p.hasSpear,gameState:p,inputLocked:nn,compact:!0})]})}),m.jsx("aside",{className:"hidden lg:flex w-80 border-l border-white/5 bg-[#030712] flex-col z-20 overflow-y-auto",children:m.jsxs("div",{className:"p-6 flex flex-col gap-8 h-full",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30 mb-6",children:"Tactical Skills"}),m.jsx(vy,{skills:p.player.activeSkills||[],selectedSkillId:ee,onSelectSkill:Li,hasSpear:p.hasSpear,gameState:p,inputLocked:nn})]}),m.jsx("div",{className:"pt-8 border-t border-white/5 text-center",children:m.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/20",children:"Hop Engine v5.0"})})]})}),Mt&&m.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[m.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),m.jsx("p",{className:"text-white text-sm",children:Mt}),m.jsx("button",{onClick:()=>hn(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]}),p.gameStatus==="choosing_upgrade"&&m.jsx(pT,{onSelect:qt,gameState:p}),p.gameStatus==="lost"&&m.jsxs("div",{className:"fixed inset-0 bg-red-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[m.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),m.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Identity Deleted"}),m.jsx("p",{className:"text-red-200/60 mb-12 text-xl font-medium tracking-widest uppercase",children:"Simulation Terminated"}),m.jsx("button",{onClick:zn,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Reinitialize Simulation"})]}),p.gameStatus==="won"&&m.jsxs("div",{className:"fixed inset-0 bg-indigo-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[m.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),m.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Arcade Mode Cleared"}),m.jsx("p",{className:"text-indigo-200/60 mb-2 text-xl font-medium tracking-widest uppercase",children:"The Sentinel has fallen"}),m.jsxs("p",{className:"text-white/20 mb-12 text-sm font-bold uppercase tracking-[0.3em]",children:["Score: ",p.completedRun?.score||0]}),m.jsx("button",{onClick:Ln,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Return to Command Center"})]}),Ft&&m.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[150] pointer-events-none animate-in fade-in duration-700",children:m.jsxs("div",{className:"text-center",children:[m.jsxs("div",{className:"text-indigo-500 font-black text-2xl uppercase tracking-[0.5em] mb-4 animate-in slide-in-from-bottom-8 duration-1000",children:["Floor ",Ft.floor]}),m.jsx("h2",{className:"text-8xl font-black text-white uppercase tracking-tighter italic animate-in slide-in-from-top-12 duration-1000",children:Ft.theme}),m.jsx("div",{className:"h-1 w-64 bg-white/20 mx-auto mt-8 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-indigo-500 animate-[progress_3s_linear]"})})]})}),O&&m.jsxs("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 bg-[#030712]/90 border border-indigo-500/30 p-6 rounded-3xl backdrop-blur-2xl shadow-[0_0_50px_rgba(79,70,229,0.2)] z-[250] flex items-center gap-8 animate-in slide-in-from-bottom-8 duration-500",children:[m.jsxs("div",{className:"flex flex-col",children:[m.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 mb-1",children:"Replay System"}),m.jsxs("span",{className:"text-white font-bold text-sm",children:["Step ",pe.current," / ",K.length]})]}),m.jsx("div",{className:"h-8 w-px bg-white/10"}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("button",{onClick:()=>_e(!G),className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${G?"bg-indigo-500 text-white shadow-[0_0_20px_rgba(79,70,229,0.5)]":"bg-white/5 text-white/50 hover:bg-white/10"}`,children:G?"":""}),m.jsx("button",{onClick:Fi,disabled:G,className:"w-12 h-12 bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:hover:bg-white/5 text-white rounded-xl flex items-center justify-center transition-all",children:""})]}),m.jsx("div",{className:"h-8 w-px bg-white/10"}),m.jsx("button",{onClick:ks,className:"px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl font-bold uppercase text-xs tracking-widest transition-all",children:"Close"})]})]})}Wb.createRoot(document.getElementById("root")).render(m.jsx(w.StrictMode,{children:m.jsx($T,{})}));
