(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const f of r.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function a(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(c){if(c.ep)return;c.ep=!0;const r=a(c);fetch(c.href,r)}})();function Cb(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var md={exports:{}},ol={};var jh;function Nb(){if(jh)return ol;jh=1;var t=Symbol.for("react.transitional.element"),i=Symbol.for("react.fragment");function a(o,c,r){var f=null;if(r!==void 0&&(f=""+r),c.key!==void 0&&(f=""+c.key),"key"in c){r={};for(var g in c)g!=="key"&&(r[g]=c[g])}else r=c;return c=r.ref,{$$typeof:t,type:o,key:f,ref:c!==void 0?c:null,props:r}}return ol.Fragment=i,ol.jsx=a,ol.jsxs=a,ol}var Dh;function Rb(){return Dh||(Dh=1,md.exports=Nb()),md.exports}var p=Rb(),pd={exports:{}},ke={};var Hh;function kb(){if(Hh)return ke;Hh=1;var t=Symbol.for("react.transitional.element"),i=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),c=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),f=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),b=Symbol.for("react.suspense"),y=Symbol.for("react.memo"),A=Symbol.for("react.lazy"),v=Symbol.for("react.activity"),x=Symbol.iterator;function E(O){return O===null||typeof O!="object"?null:(O=x&&O[x]||O["@@iterator"],typeof O=="function"?O:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,R={};function k(O,Y,te){this.props=O,this.context=Y,this.refs=R,this.updater=te||m}k.prototype.isReactComponent={},k.prototype.setState=function(O,Y){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,Y,"setState")},k.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function B(){}B.prototype=k.prototype;function _(O,Y,te){this.props=O,this.context=Y,this.refs=R,this.updater=te||m}var w=_.prototype=new B;w.constructor=_,h(w,k.prototype),w.isPureReactComponent=!0;var H=Array.isArray;function j(){}var L={H:null,A:null,T:null,S:null},W=Object.prototype.hasOwnProperty;function Z(O,Y,te){var ue=te.ref;return{$$typeof:t,type:O,key:Y,ref:ue!==void 0?ue:null,props:te}}function Te(O,Y){return Z(O.type,Y,O.props)}function oe(O){return typeof O=="object"&&O!==null&&O.$$typeof===t}function Be(O){var Y={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(te){return Y[te]})}var ne=/\/+/g;function xe(O,Y){return typeof O=="object"&&O!==null&&O.key!=null?Be(""+O.key):Y.toString(36)}function ve(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(j,j):(O.status="pending",O.then(function(Y){O.status==="pending"&&(O.status="fulfilled",O.value=Y)},function(Y){O.status==="pending"&&(O.status="rejected",O.reason=Y)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function V(O,Y,te,ue,Oe){var Ce=typeof O;(Ce==="undefined"||Ce==="boolean")&&(O=null);var Ne=!1;if(O===null)Ne=!0;else switch(Ce){case"bigint":case"string":case"number":Ne=!0;break;case"object":switch(O.$$typeof){case t:case i:Ne=!0;break;case A:return Ne=O._init,V(Ne(O._payload),Y,te,ue,Oe)}}if(Ne)return Oe=Oe(O),Ne=ue===""?"."+xe(O,0):ue,H(Oe)?(te="",Ne!=null&&(te=Ne.replace(ne,"$&/")+"/"),V(Oe,Y,te,"",function(Lt){return Lt})):Oe!=null&&(oe(Oe)&&(Oe=Te(Oe,te+(Oe.key==null||O&&O.key===Oe.key?"":(""+Oe.key).replace(ne,"$&/")+"/")+Ne)),Y.push(Oe)),1;Ne=0;var ft=ue===""?".":ue+":";if(H(O))for(var qe=0;qe<O.length;qe++)ue=O[qe],Ce=ft+xe(ue,qe),Ne+=V(ue,Y,te,Ce,Oe);else if(qe=E(O),typeof qe=="function")for(O=qe.call(O),qe=0;!(ue=O.next()).done;)ue=ue.value,Ce=ft+xe(ue,qe++),Ne+=V(ue,Y,te,Ce,Oe);else if(Ce==="object"){if(typeof O.then=="function")return V(ve(O),Y,te,ue,Oe);throw Y=String(O),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.")}return Ne}function ie(O,Y,te){if(O==null)return O;var ue=[],Oe=0;return V(O,ue,"","",function(Ce){return Y.call(te,Ce,Oe++)}),ue}function re(O){if(O._status===-1){var Y=O._result;Y=Y(),Y.then(function(te){(O._status===0||O._status===-1)&&(O._status=1,O._result=te)},function(te){(O._status===0||O._status===-1)&&(O._status=2,O._result=te)}),O._status===-1&&(O._status=0,O._result=Y)}if(O._status===1)return O._result.default;throw O._result}var Re=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(Y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},ge={map:ie,forEach:function(O,Y,te){ie(O,function(){Y.apply(this,arguments)},te)},count:function(O){var Y=0;return ie(O,function(){Y++}),Y},toArray:function(O){return ie(O,function(Y){return Y})||[]},only:function(O){if(!oe(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return ke.Activity=v,ke.Children=ge,ke.Component=k,ke.Fragment=a,ke.Profiler=c,ke.PureComponent=_,ke.StrictMode=o,ke.Suspense=b,ke.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,ke.__COMPILER_RUNTIME={__proto__:null,c:function(O){return L.H.useMemoCache(O)}},ke.cache=function(O){return function(){return O.apply(null,arguments)}},ke.cacheSignal=function(){return null},ke.cloneElement=function(O,Y,te){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var ue=h({},O.props),Oe=O.key;if(Y!=null)for(Ce in Y.key!==void 0&&(Oe=""+Y.key),Y)!W.call(Y,Ce)||Ce==="key"||Ce==="__self"||Ce==="__source"||Ce==="ref"&&Y.ref===void 0||(ue[Ce]=Y[Ce]);var Ce=arguments.length-2;if(Ce===1)ue.children=te;else if(1<Ce){for(var Ne=Array(Ce),ft=0;ft<Ce;ft++)Ne[ft]=arguments[ft+2];ue.children=Ne}return Z(O.type,Oe,ue)},ke.createContext=function(O){return O={$$typeof:f,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:r,_context:O},O},ke.createElement=function(O,Y,te){var ue,Oe={},Ce=null;if(Y!=null)for(ue in Y.key!==void 0&&(Ce=""+Y.key),Y)W.call(Y,ue)&&ue!=="key"&&ue!=="__self"&&ue!=="__source"&&(Oe[ue]=Y[ue]);var Ne=arguments.length-2;if(Ne===1)Oe.children=te;else if(1<Ne){for(var ft=Array(Ne),qe=0;qe<Ne;qe++)ft[qe]=arguments[qe+2];Oe.children=ft}if(O&&O.defaultProps)for(ue in Ne=O.defaultProps,Ne)Oe[ue]===void 0&&(Oe[ue]=Ne[ue]);return Z(O,Ce,Oe)},ke.createRef=function(){return{current:null}},ke.forwardRef=function(O){return{$$typeof:g,render:O}},ke.isValidElement=oe,ke.lazy=function(O){return{$$typeof:A,_payload:{_status:-1,_result:O},_init:re}},ke.memo=function(O,Y){return{$$typeof:y,type:O,compare:Y===void 0?null:Y}},ke.startTransition=function(O){var Y=L.T,te={};L.T=te;try{var ue=O(),Oe=L.S;Oe!==null&&Oe(te,ue),typeof ue=="object"&&ue!==null&&typeof ue.then=="function"&&ue.then(j,Re)}catch(Ce){Re(Ce)}finally{Y!==null&&te.types!==null&&(Y.types=te.types),L.T=Y}},ke.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},ke.use=function(O){return L.H.use(O)},ke.useActionState=function(O,Y,te){return L.H.useActionState(O,Y,te)},ke.useCallback=function(O,Y){return L.H.useCallback(O,Y)},ke.useContext=function(O){return L.H.useContext(O)},ke.useDebugValue=function(){},ke.useDeferredValue=function(O,Y){return L.H.useDeferredValue(O,Y)},ke.useEffect=function(O,Y){return L.H.useEffect(O,Y)},ke.useEffectEvent=function(O){return L.H.useEffectEvent(O)},ke.useId=function(){return L.H.useId()},ke.useImperativeHandle=function(O,Y,te){return L.H.useImperativeHandle(O,Y,te)},ke.useInsertionEffect=function(O,Y){return L.H.useInsertionEffect(O,Y)},ke.useLayoutEffect=function(O,Y){return L.H.useLayoutEffect(O,Y)},ke.useMemo=function(O,Y){return L.H.useMemo(O,Y)},ke.useOptimistic=function(O,Y){return L.H.useOptimistic(O,Y)},ke.useReducer=function(O,Y,te){return L.H.useReducer(O,Y,te)},ke.useRef=function(O){return L.H.useRef(O)},ke.useState=function(O){return L.H.useState(O)},ke.useSyncExternalStore=function(O,Y,te){return L.H.useSyncExternalStore(O,Y,te)},ke.useTransition=function(){return L.H.useTransition()},ke.version="19.2.3",ke}var Ph;function Qd(){return Ph||(Ph=1,pd.exports=kb()),pd.exports}var M=Qd();const Bi=Cb(M);var hd={exports:{}},ll={},gd={exports:{}},yd={};var Uh;function Lb(){return Uh||(Uh=1,(function(t){function i(V,ie){var re=V.length;V.push(ie);e:for(;0<re;){var Re=re-1>>>1,ge=V[Re];if(0<c(ge,ie))V[Re]=ie,V[re]=ge,re=Re;else break e}}function a(V){return V.length===0?null:V[0]}function o(V){if(V.length===0)return null;var ie=V[0],re=V.pop();if(re!==ie){V[0]=re;e:for(var Re=0,ge=V.length,O=ge>>>1;Re<O;){var Y=2*(Re+1)-1,te=V[Y],ue=Y+1,Oe=V[ue];if(0>c(te,re))ue<ge&&0>c(Oe,te)?(V[Re]=Oe,V[ue]=re,Re=ue):(V[Re]=te,V[Y]=re,Re=Y);else if(ue<ge&&0>c(Oe,re))V[Re]=Oe,V[ue]=re,Re=ue;else break e}}return ie}function c(V,ie){var re=V.sortIndex-ie.sortIndex;return re!==0?re:V.id-ie.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var f=Date,g=f.now();t.unstable_now=function(){return f.now()-g}}var b=[],y=[],A=1,v=null,x=3,E=!1,m=!1,h=!1,R=!1,k=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function w(V){for(var ie=a(y);ie!==null;){if(ie.callback===null)o(y);else if(ie.startTime<=V)o(y),ie.sortIndex=ie.expirationTime,i(b,ie);else break;ie=a(y)}}function H(V){if(h=!1,w(V),!m)if(a(b)!==null)m=!0,j||(j=!0,Be());else{var ie=a(y);ie!==null&&ve(H,ie.startTime-V)}}var j=!1,L=-1,W=5,Z=-1;function Te(){return R?!0:!(t.unstable_now()-Z<W)}function oe(){if(R=!1,j){var V=t.unstable_now();Z=V;var ie=!0;try{e:{m=!1,h&&(h=!1,B(L),L=-1),E=!0;var re=x;try{t:{for(w(V),v=a(b);v!==null&&!(v.expirationTime>V&&Te());){var Re=v.callback;if(typeof Re=="function"){v.callback=null,x=v.priorityLevel;var ge=Re(v.expirationTime<=V);if(V=t.unstable_now(),typeof ge=="function"){v.callback=ge,w(V),ie=!0;break t}v===a(b)&&o(b),w(V)}else o(b);v=a(b)}if(v!==null)ie=!0;else{var O=a(y);O!==null&&ve(H,O.startTime-V),ie=!1}}break e}finally{v=null,x=re,E=!1}ie=void 0}}finally{ie?Be():j=!1}}}var Be;if(typeof _=="function")Be=function(){_(oe)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,xe=ne.port2;ne.port1.onmessage=oe,Be=function(){xe.postMessage(null)}}else Be=function(){k(oe,0)};function ve(V,ie){L=k(function(){V(t.unstable_now())},ie)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(V){V.callback=null},t.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<V?Math.floor(1e3/V):5},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_next=function(V){switch(x){case 1:case 2:case 3:var ie=3;break;default:ie=x}var re=x;x=ie;try{return V()}finally{x=re}},t.unstable_requestPaint=function(){R=!0},t.unstable_runWithPriority=function(V,ie){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var re=x;x=V;try{return ie()}finally{x=re}},t.unstable_scheduleCallback=function(V,ie,re){var Re=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?Re+re:Re):re=Re,V){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=re+ge,V={id:A++,callback:ie,priorityLevel:V,startTime:re,expirationTime:ge,sortIndex:-1},re>Re?(V.sortIndex=re,i(y,V),a(b)===null&&V===a(y)&&(h?(B(L),L=-1):h=!0,ve(H,re-Re))):(V.sortIndex=ge,i(b,V),m||E||(m=!0,j||(j=!0,Be()))),V},t.unstable_shouldYield=Te,t.unstable_wrapCallback=function(V){var ie=x;return function(){var re=x;x=ie;try{return V.apply(this,arguments)}finally{x=re}}}})(yd)),yd}var qh;function Bb(){return qh||(qh=1,gd.exports=Lb()),gd.exports}var bd={exports:{}},On={};var zh;function Ib(){if(zh)return On;zh=1;var t=Qd();function i(b){var y="https://react.dev/errors/"+b;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var A=2;A<arguments.length;A++)y+="&args[]="+encodeURIComponent(arguments[A])}return"Minified React error #"+b+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(){}var o={d:{f:a,r:function(){throw Error(i(522))},D:a,C:a,L:a,m:a,X:a,S:a,M:a},p:0,findDOMNode:null},c=Symbol.for("react.portal");function r(b,y,A){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:v==null?null:""+v,children:b,containerInfo:y,implementation:A}}var f=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function g(b,y){if(b==="font")return"";if(typeof y=="string")return y==="use-credentials"?y:""}return On.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,On.createPortal=function(b,y){var A=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!y||y.nodeType!==1&&y.nodeType!==9&&y.nodeType!==11)throw Error(i(299));return r(b,y,null,A)},On.flushSync=function(b){var y=f.T,A=o.p;try{if(f.T=null,o.p=2,b)return b()}finally{f.T=y,o.p=A,o.d.f()}},On.preconnect=function(b,y){typeof b=="string"&&(y?(y=y.crossOrigin,y=typeof y=="string"?y==="use-credentials"?y:"":void 0):y=null,o.d.C(b,y))},On.prefetchDNS=function(b){typeof b=="string"&&o.d.D(b)},On.preinit=function(b,y){if(typeof b=="string"&&y&&typeof y.as=="string"){var A=y.as,v=g(A,y.crossOrigin),x=typeof y.integrity=="string"?y.integrity:void 0,E=typeof y.fetchPriority=="string"?y.fetchPriority:void 0;A==="style"?o.d.S(b,typeof y.precedence=="string"?y.precedence:void 0,{crossOrigin:v,integrity:x,fetchPriority:E}):A==="script"&&o.d.X(b,{crossOrigin:v,integrity:x,fetchPriority:E,nonce:typeof y.nonce=="string"?y.nonce:void 0})}},On.preinitModule=function(b,y){if(typeof b=="string")if(typeof y=="object"&&y!==null){if(y.as==null||y.as==="script"){var A=g(y.as,y.crossOrigin);o.d.M(b,{crossOrigin:A,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0})}}else y==null&&o.d.M(b)},On.preload=function(b,y){if(typeof b=="string"&&typeof y=="object"&&y!==null&&typeof y.as=="string"){var A=y.as,v=g(A,y.crossOrigin);o.d.L(b,A,{crossOrigin:v,integrity:typeof y.integrity=="string"?y.integrity:void 0,nonce:typeof y.nonce=="string"?y.nonce:void 0,type:typeof y.type=="string"?y.type:void 0,fetchPriority:typeof y.fetchPriority=="string"?y.fetchPriority:void 0,referrerPolicy:typeof y.referrerPolicy=="string"?y.referrerPolicy:void 0,imageSrcSet:typeof y.imageSrcSet=="string"?y.imageSrcSet:void 0,imageSizes:typeof y.imageSizes=="string"?y.imageSizes:void 0,media:typeof y.media=="string"?y.media:void 0})}},On.preloadModule=function(b,y){if(typeof b=="string")if(y){var A=g(y.as,y.crossOrigin);o.d.m(b,{as:typeof y.as=="string"&&y.as!=="script"?y.as:void 0,crossOrigin:A,integrity:typeof y.integrity=="string"?y.integrity:void 0})}else o.d.m(b)},On.requestFormReset=function(b){o.d.r(b)},On.unstable_batchedUpdates=function(b,y){return b(y)},On.useFormState=function(b,y,A){return f.H.useFormState(b,y,A)},On.useFormStatus=function(){return f.H.useHostTransitionStatus()},On.version="19.2.3",On}var Vh;function jb(){if(Vh)return bd.exports;Vh=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(i){console.error(i)}}return t(),bd.exports=Ib(),bd.exports}var $h;function Db(){if($h)return ll;$h=1;var t=Bb(),i=Qd(),a=jb();function o(e){var n="https://react.dev/errors/"+e;if(1<arguments.length){n+="?args[]="+encodeURIComponent(arguments[1]);for(var s=2;s<arguments.length;s++)n+="&args[]="+encodeURIComponent(arguments[s])}return"Minified React error #"+e+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function c(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function r(e){var n=e,s=e;if(e.alternate)for(;n.return;)n=n.return;else{e=n;do n=e,(n.flags&4098)!==0&&(s=n.return),e=n.return;while(e)}return n.tag===3?s:null}function f(e){if(e.tag===13){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function g(e){if(e.tag===31){var n=e.memoizedState;if(n===null&&(e=e.alternate,e!==null&&(n=e.memoizedState)),n!==null)return n.dehydrated}return null}function b(e){if(r(e)!==e)throw Error(o(188))}function y(e){var n=e.alternate;if(!n){if(n=r(e),n===null)throw Error(o(188));return n!==e?null:e}for(var s=e,l=n;;){var u=s.return;if(u===null)break;var d=u.alternate;if(d===null){if(l=u.return,l!==null){s=l;continue}break}if(u.child===d.child){for(d=u.child;d;){if(d===s)return b(u),e;if(d===l)return b(u),n;d=d.sibling}throw Error(o(188))}if(s.return!==l.return)s=u,l=d;else{for(var S=!1,T=u.child;T;){if(T===s){S=!0,s=u,l=d;break}if(T===l){S=!0,l=u,s=d;break}T=T.sibling}if(!S){for(T=d.child;T;){if(T===s){S=!0,s=d,l=u;break}if(T===l){S=!0,l=d,s=u;break}T=T.sibling}if(!S)throw Error(o(189))}}if(s.alternate!==l)throw Error(o(190))}if(s.tag!==3)throw Error(o(188));return s.stateNode.current===s?e:n}function A(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e;for(e=e.child;e!==null;){if(n=A(e),n!==null)return n;e=e.sibling}return null}var v=Object.assign,x=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),B=Symbol.for("react.consumer"),_=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),Z=Symbol.for("react.activity"),Te=Symbol.for("react.memo_cache_sentinel"),oe=Symbol.iterator;function Be(e){return e===null||typeof e!="object"?null:(e=oe&&e[oe]||e["@@iterator"],typeof e=="function"?e:null)}var ne=Symbol.for("react.client.reference");function xe(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===ne?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case h:return"Fragment";case k:return"Profiler";case R:return"StrictMode";case H:return"Suspense";case j:return"SuspenseList";case Z:return"Activity"}if(typeof e=="object")switch(e.$$typeof){case m:return"Portal";case _:return e.displayName||"Context";case B:return(e._context.displayName||"Context")+".Consumer";case w:var n=e.render;return e=e.displayName,e||(e=n.displayName||n.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case L:return n=e.displayName||null,n!==null?n:xe(e.type)||"Memo";case W:n=e._payload,e=e._init;try{return xe(e(n))}catch{}}return null}var ve=Array.isArray,V=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},Re=[],ge=-1;function O(e){return{current:e}}function Y(e){0>ge||(e.current=Re[ge],Re[ge]=null,ge--)}function te(e,n){ge++,Re[ge]=e.current,e.current=n}var ue=O(null),Oe=O(null),Ce=O(null),Ne=O(null);function ft(e,n){switch(te(Ce,n),te(Oe,e),te(ue,null),n.nodeType){case 9:case 11:e=(e=n.documentElement)&&(e=e.namespaceURI)?ah(e):0;break;default:if(e=n.tagName,n=n.namespaceURI)n=ah(n),e=oh(n,e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}Y(ue),te(ue,e)}function qe(){Y(ue),Y(Oe),Y(Ce)}function Lt(e){e.memoizedState!==null&&te(Ne,e);var n=ue.current,s=oh(n,e.type);n!==s&&(te(Oe,e),te(ue,s))}function ze(e){Oe.current===e&&(Y(ue),Y(Oe)),Ne.current===e&&(Y(Ne),nl._currentValue=re)}var Ue,Ot;function Bt(e){if(Ue===void 0)try{throw Error()}catch(s){var n=s.stack.trim().match(/\n( *(at )?)/);Ue=n&&n[1]||"",Ot=-1<s.stack.indexOf(`
    at`)?" (<anonymous>)":-1<s.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ue+e+Ot}var rt=!1;function Vt(e,n){if(!e||rt)return"";rt=!0;var s=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var l={DetermineComponentFrameRoot:function(){try{if(n){var Q=function(){throw Error()};if(Object.defineProperty(Q.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Q,[])}catch($){var z=$}Reflect.construct(e,[],Q)}else{try{Q.call()}catch($){z=$}e.call(Q.prototype)}}else{try{throw Error()}catch($){z=$}(Q=e())&&typeof Q.catch=="function"&&Q.catch(function(){})}}catch($){if($&&z&&typeof $.stack=="string")return[$.stack,z.stack]}return[null,null]}};l.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var u=Object.getOwnPropertyDescriptor(l.DetermineComponentFrameRoot,"name");u&&u.configurable&&Object.defineProperty(l.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var d=l.DetermineComponentFrameRoot(),S=d[0],T=d[1];if(S&&T){var N=S.split(`
`),q=T.split(`
`);for(u=l=0;l<N.length&&!N[l].includes("DetermineComponentFrameRoot");)l++;for(;u<q.length&&!q[u].includes("DetermineComponentFrameRoot");)u++;if(l===N.length||u===q.length)for(l=N.length-1,u=q.length-1;1<=l&&0<=u&&N[l]!==q[u];)u--;for(;1<=l&&0<=u;l--,u--)if(N[l]!==q[u]){if(l!==1||u!==1)do if(l--,u--,0>u||N[l]!==q[u]){var K=`
`+N[l].replace(" at new "," at ");return e.displayName&&K.includes("<anonymous>")&&(K=K.replace("<anonymous>",e.displayName)),K}while(1<=l&&0<=u);break}}}finally{rt=!1,Error.prepareStackTrace=s}return(s=e?e.displayName||e.name:"")?Bt(s):""}function ln(e,n){switch(e.tag){case 26:case 27:case 5:return Bt(e.type);case 16:return Bt("Lazy");case 13:return e.child!==n&&n!==null?Bt("Suspense Fallback"):Bt("Suspense");case 19:return Bt("SuspenseList");case 0:case 15:return Vt(e.type,!1);case 11:return Vt(e.type.render,!1);case 1:return Vt(e.type,!0);case 31:return Bt("Activity");default:return""}}function Ve(e){try{var n="",s=null;do n+=ln(e,s),s=e,e=e.return;while(e);return n}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}var it=Object.prototype.hasOwnProperty,yn=t.unstable_scheduleCallback,Ti=t.unstable_cancelCallback,Qn=t.unstable_shouldYield,Dn=t.unstable_requestPaint,Fe=t.unstable_now,mt=t.unstable_getCurrentPriorityLevel,jt=t.unstable_ImmediatePriority,bn=t.unstable_UserBlockingPriority,rn=t.unstable_NormalPriority,Sn=t.unstable_LowPriority,$t=t.unstable_IdlePriority,At=t.log,$e=t.unstable_setDisableYieldValue,Yt=null,Je=null;function et(e){if(typeof At=="function"&&$e(e),Je&&typeof Je.setStrictMode=="function")try{Je.setStrictMode(Yt,e)}catch{}}var Tt=Math.clz32?Math.clz32:Jn,cn=Math.log,Hn=Math.LN2;function Jn(e){return e>>>=0,e===0?32:31-(cn(e)/Hn|0)|0}var Mn=256,un=262144,pt=4194304;function Dt(e){var n=e&42;if(n!==0)return n;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return e&261888;case 262144:case 524288:case 1048576:case 2097152:return e&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return e&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Xt(e,n,s){var l=e.pendingLanes;if(l===0)return 0;var u=0,d=e.suspendedLanes,S=e.pingedLanes;e=e.warmLanes;var T=l&134217727;return T!==0?(l=T&~d,l!==0?u=Dt(l):(S&=T,S!==0?u=Dt(S):s||(s=T&~e,s!==0&&(u=Dt(s))))):(T=l&~d,T!==0?u=Dt(T):S!==0?u=Dt(S):s||(s=l&~e,s!==0&&(u=Dt(s)))),u===0?0:n!==0&&n!==u&&(n&d)===0&&(d=u&-u,s=n&-n,d>=s||d===32&&(s&4194048)!==0)?n:u}function Rn(e,n){return(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&n)===0}function Di(e,n){switch(e){case 1:case 2:case 4:case 8:case 64:return n+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ci(){var e=pt;return pt<<=1,(pt&62914560)===0&&(pt=4194304),e}function vn(e){for(var n=[],s=0;31>s;s++)n.push(e);return n}function Kt(e,n){e.pendingLanes|=n,n!==268435456&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Pn(e,n,s,l,u,d){var S=e.pendingLanes;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=s,e.entangledLanes&=s,e.errorRecoveryDisabledLanes&=s,e.shellSuspendCounter=0;var T=e.entanglements,N=e.expirationTimes,q=e.hiddenUpdates;for(s=S&~s;0<s;){var K=31-Tt(s),Q=1<<K;T[K]=0,N[K]=-1;var z=q[K];if(z!==null)for(q[K]=null,K=0;K<z.length;K++){var $=z[K];$!==null&&($.lane&=-536870913)}s&=~Q}l!==0&&Hi(e,l,0),d!==0&&u===0&&e.tag!==0&&(e.suspendedLanes|=d&~(S&~n))}function Hi(e,n,s){e.pendingLanes|=n,e.suspendedLanes&=~n;var l=31-Tt(n);e.entangledLanes|=n,e.entanglements[l]=e.entanglements[l]|1073741824|s&261930}function Gi(e,n){var s=e.entangledLanes|=n;for(e=e.entanglements;s;){var l=31-Tt(s),u=1<<l;u&n|e[l]&n&&(e[l]|=n),s&=~u}}function Ei(e,n){var s=n&-n;return s=(s&42)!==0?1:_i(s),(s&(e.suspendedLanes|n))!==0?0:s}function _i(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function bs(e){return e&=-e,2<e?8<e?(e&134217727)!==0?32:268435456:8:2}function X(){var e=ie.p;return e!==0?e:(e=window.event,e===void 0?32:Ch(e.type))}function le(e,n){var s=ie.p;try{return ie.p=e,n()}finally{ie.p=s}}var me=Math.random().toString(36).slice(2),we="__reactFiber$"+me,be="__reactProps$"+me,De="__reactContainer$"+me,ct="__reactEvents$"+me,dn="__reactListeners$"+me,xn="__reactHandles$"+me,Ht="__reactResources$"+me,Ct="__reactMarker$"+me;function kn(e){delete e[we],delete e[be],delete e[ct],delete e[dn],delete e[xn]}function Un(e){var n=e[we];if(n)return n;for(var s=e.parentNode;s;){if(n=s[De]||s[we]){if(s=n.alternate,n.child!==null||s!==null&&s.child!==null)for(e=mh(e);e!==null;){if(s=e[we])return s;e=mh(e)}return n}e=s,s=e.parentNode}return null}function Ln(e){if(e=e[we]||e[De]){var n=e.tag;if(n===5||n===6||n===13||n===31||n===26||n===27||n===3)return e}return null}function wi(e){var n=e.tag;if(n===5||n===26||n===27||n===6)return e.stateNode;throw Error(o(33))}function Mi(e){var n=e[Ht];return n||(n=e[Ht]={hoistableStyles:new Map,hoistableScripts:new Map}),n}function Nt(e){e[Ct]=!0}var yo=new Set,Nl={};function Wi(e,n){Pi(e,n),Pi(e+"Capture",n)}function Pi(e,n){for(Nl[e]=n,e=0;e<n.length;e++)yo.add(n[e])}var mc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Qs={},Ss={};function Ca(e){return it.call(Ss,e)?!0:it.call(Qs,e)?!1:mc.test(e)?Ss[e]=!0:(Qs[e]=!0,!1)}function vs(e,n,s){if(Ca(n))if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":e.removeAttribute(n);return;case"boolean":var l=n.toLowerCase().slice(0,5);if(l!=="data-"&&l!=="aria-"){e.removeAttribute(n);return}}e.setAttribute(n,""+s)}}function Js(e,n,s){if(s===null)e.removeAttribute(n);else{switch(typeof s){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttribute(n,""+s)}}function ui(e,n,s,l){if(l===null)e.removeAttribute(s);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(s);return}e.setAttributeNS(n,s,""+l)}}function qn(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Rl(e){var n=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function pc(e,n,s){var l=Object.getOwnPropertyDescriptor(e.constructor.prototype,n);if(!e.hasOwnProperty(n)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var u=l.get,d=l.set;return Object.defineProperty(e,n,{configurable:!0,get:function(){return u.call(this)},set:function(S){s=""+S,d.call(this,S)}}),Object.defineProperty(e,n,{enumerable:l.enumerable}),{getValue:function(){return s},setValue:function(S){s=""+S},stopTracking:function(){e._valueTracker=null,delete e[n]}}}}function Zs(e){if(!e._valueTracker){var n=Rl(e)?"checked":"value";e._valueTracker=pc(e,n,""+e[n])}}function Ie(e){if(!e)return!1;var n=e._valueTracker;if(!n)return!0;var s=n.getValue(),l="";return e&&(l=Rl(e)?e.checked?"true":"false":e.value),e=l,e!==s?(n.setValue(e),!0):!1}function C(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}var P=/[\n"\\]/g;function F(e){return e.replace(P,function(n){return"\\"+n.charCodeAt(0).toString(16)+" "})}function ae(e,n,s,l,u,d,S,T){e.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?e.type=S:e.removeAttribute("type"),n!=null?S==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+qn(n)):e.value!==""+qn(n)&&(e.value=""+qn(n)):S!=="submit"&&S!=="reset"||e.removeAttribute("value"),n!=null?pe(e,S,qn(n)):s!=null?pe(e,S,qn(s)):l!=null&&e.removeAttribute("value"),u==null&&d!=null&&(e.defaultChecked=!!d),u!=null&&(e.checked=u&&typeof u!="function"&&typeof u!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?e.name=""+qn(T):e.removeAttribute("name")}function ce(e,n,s,l,u,d,S,T){if(d!=null&&typeof d!="function"&&typeof d!="symbol"&&typeof d!="boolean"&&(e.type=d),n!=null||s!=null){if(!(d!=="submit"&&d!=="reset"||n!=null)){Zs(e);return}s=s!=null?""+qn(s):"",n=n!=null?""+qn(n):s,T||n===e.value||(e.value=n),e.defaultValue=n}l=l??u,l=typeof l!="function"&&typeof l!="symbol"&&!!l,e.checked=T?e.checked:!!l,e.defaultChecked=!!l,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(e.name=S),Zs(e)}function pe(e,n,s){n==="number"&&C(e.ownerDocument)===e||e.defaultValue===""+s||(e.defaultValue=""+s)}function he(e,n,s,l){if(e=e.options,n){n={};for(var u=0;u<s.length;u++)n["$"+s[u]]=!0;for(s=0;s<e.length;s++)u=n.hasOwnProperty("$"+e[s].value),e[s].selected!==u&&(e[s].selected=u),u&&l&&(e[s].defaultSelected=!0)}else{for(s=""+qn(s),n=null,u=0;u<e.length;u++){if(e[u].value===s){e[u].selected=!0,l&&(e[u].defaultSelected=!0);return}n!==null||e[u].disabled||(n=e[u])}n!==null&&(n.selected=!0)}}function at(e,n,s){if(n!=null&&(n=""+qn(n),n!==e.value&&(e.value=n),s==null)){e.defaultValue!==n&&(e.defaultValue=n);return}e.defaultValue=s!=null?""+qn(s):""}function ot(e,n,s,l){if(n==null){if(l!=null){if(s!=null)throw Error(o(92));if(ve(l)){if(1<l.length)throw Error(o(93));l=l[0]}s=l}s==null&&(s=""),n=s}s=qn(n),e.defaultValue=s,l=e.textContent,l===s&&l!==""&&l!==null&&(e.value=l),Zs(e)}function fn(e,n){if(n){var s=e.firstChild;if(s&&s===e.lastChild&&s.nodeType===3){s.nodeValue=n;return}}e.textContent=n}var zn=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function It(e,n,s){var l=n.indexOf("--")===0;s==null||typeof s=="boolean"||s===""?l?e.setProperty(n,""):n==="float"?e.cssFloat="":e[n]="":l?e.setProperty(n,s):typeof s!="number"||s===0||zn.has(n)?n==="float"?e.cssFloat=s:e[n]=(""+s).trim():e[n]=s+"px"}function _t(e,n,s){if(n!=null&&typeof n!="object")throw Error(o(62));if(e=e.style,s!=null){for(var l in s)!s.hasOwnProperty(l)||n!=null&&n.hasOwnProperty(l)||(l.indexOf("--")===0?e.setProperty(l,""):l==="float"?e.cssFloat="":e[l]="");for(var u in n)l=n[u],n.hasOwnProperty(u)&&s[u]!==l&&It(e,u,l)}else for(var d in n)n.hasOwnProperty(d)&&It(e,d,n[d])}function Pt(e){if(e.indexOf("-")===-1)return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mn=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),pn=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Na(e){return pn.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Oi(){}var Ra=null;function ka(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Xi=null,Qi=null;function kl(e){var n=Ln(e);if(n&&(e=n.stateNode)){var s=e[be]||null;e:switch(e=n.stateNode,n.type){case"input":if(ae(e,s.value,s.defaultValue,s.defaultValue,s.checked,s.defaultChecked,s.type,s.name),n=s.name,s.type==="radio"&&n!=null){for(s=e;s.parentNode;)s=s.parentNode;for(s=s.querySelectorAll('input[name="'+F(""+n)+'"][type="radio"]'),n=0;n<s.length;n++){var l=s[n];if(l!==e&&l.form===e.form){var u=l[be]||null;if(!u)throw Error(o(90));ae(l,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name)}}for(n=0;n<s.length;n++)l=s[n],l.form===e.form&&Ie(l)}break e;case"textarea":at(e,s.value,s.defaultValue);break e;case"select":n=s.value,n!=null&&he(e,!!s.multiple,n,!1)}}}var bo=!1;function La(e,n,s){if(bo)return e(n,s);bo=!0;try{var l=e(n);return l}finally{if(bo=!1,(Xi!==null||Qi!==null)&&(yr(),Xi&&(n=Xi,e=Qi,Qi=Xi=null,kl(n),e)))for(n=0;n<e.length;n++)kl(e[n])}}function Ji(e,n){var s=e.stateNode;if(s===null)return null;var l=s[be]||null;if(l===null)return null;s=l[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(e=e.type,l=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!l;break e;default:e=!1}if(e)return null;if(s&&typeof s!="function")throw Error(o(231,n,typeof s));return s}var Ci=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),So=!1;if(Ci)try{var Ui={};Object.defineProperty(Ui,"passive",{get:function(){So=!0}}),window.addEventListener("test",Ui,Ui),window.removeEventListener("test",Ui,Ui)}catch{So=!1}var Zn=null,ea=null,ta=null;function vo(){if(ta)return ta;var e,n=ea,s=n.length,l,u="value"in Zn?Zn.value:Zn.textContent,d=u.length;for(e=0;e<s&&n[e]===u[e];e++);var S=s-e;for(l=1;l<=S&&n[s-l]===u[d-l];l++);return ta=u.slice(e,1<l?1-l:void 0)}function na(e){var n=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&n===13&&(e=13)):e=n,e===10&&(e=13),32<=e||e===13?e:0}function Ll(){return!0}function lf(){return!1}function Vn(e){function n(s,l,u,d,S){this._reactName=s,this._targetInst=u,this.type=l,this.nativeEvent=d,this.target=S,this.currentTarget=null;for(var T in e)e.hasOwnProperty(T)&&(s=e[T],this[T]=s?s(d):d[T]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?Ll:lf,this.isPropagationStopped=lf,this}return v(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var s=this.nativeEvent;s&&(s.preventDefault?s.preventDefault():typeof s.returnValue!="unknown"&&(s.returnValue=!1),this.isDefaultPrevented=Ll)},stopPropagation:function(){var s=this.nativeEvent;s&&(s.stopPropagation?s.stopPropagation():typeof s.cancelBubble!="unknown"&&(s.cancelBubble=!0),this.isPropagationStopped=Ll)},persist:function(){},isPersistent:Ll}),n}var ia={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Bl=Vn(ia),xo=v({},ia,{view:0,detail:0}),My=Vn(xo),hc,gc,Ao,Il=v({},xo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bc,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Ao&&(Ao&&e.type==="mousemove"?(hc=e.screenX-Ao.screenX,gc=e.screenY-Ao.screenY):gc=hc=0,Ao=e),hc)},movementY:function(e){return"movementY"in e?e.movementY:gc}}),rf=Vn(Il),Oy=v({},Il,{dataTransfer:0}),Cy=Vn(Oy),Ny=v({},xo,{relatedTarget:0}),yc=Vn(Ny),Ry=v({},ia,{animationName:0,elapsedTime:0,pseudoElement:0}),ky=Vn(Ry),Ly=v({},ia,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),By=Vn(Ly),Iy=v({},ia,{data:0}),cf=Vn(Iy),jy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Py(e){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(e):(e=Hy[e])?!!n[e]:!1}function bc(){return Py}var Uy=v({},xo,{key:function(e){if(e.key){var n=jy[e.key]||e.key;if(n!=="Unidentified")return n}return e.type==="keypress"?(e=na(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Dy[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bc,charCode:function(e){return e.type==="keypress"?na(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?na(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),qy=Vn(Uy),zy=v({},Il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uf=Vn(zy),Vy=v({},xo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bc}),$y=Vn(Vy),Yy=v({},ia,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ky=Vn(Yy),Fy=v({},Il,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Gy=Vn(Fy),Wy=v({},ia,{newState:0,oldState:0}),Xy=Vn(Wy),Qy=[9,13,27,32],Sc=Ci&&"CompositionEvent"in window,To=null;Ci&&"documentMode"in document&&(To=document.documentMode);var Jy=Ci&&"TextEvent"in window&&!To,df=Ci&&(!Sc||To&&8<To&&11>=To),ff=" ",mf=!1;function pf(e,n){switch(e){case"keyup":return Qy.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hf(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Ba=!1;function Zy(e,n){switch(e){case"compositionend":return hf(n);case"keypress":return n.which!==32?null:(mf=!0,ff);case"textInput":return e=n.data,e===ff&&mf?null:e;default:return null}}function e0(e,n){if(Ba)return e==="compositionend"||!Sc&&pf(e,n)?(e=vo(),ta=ea=Zn=null,Ba=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return df&&n.locale!=="ko"?null:n.data;default:return null}}var t0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gf(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n==="input"?!!t0[e.type]:n==="textarea"}function yf(e,n,s,l){Xi?Qi?Qi.push(l):Qi=[l]:Xi=l,n=Er(n,"onChange"),0<n.length&&(s=new Bl("onChange","change",null,s,l),e.push({event:s,listeners:n}))}var Eo=null,_o=null;function n0(e){Zp(e,0)}function jl(e){var n=wi(e);if(Ie(n))return e}function bf(e,n){if(e==="change")return n}var Sf=!1;if(Ci){var vc;if(Ci){var xc="oninput"in document;if(!xc){var vf=document.createElement("div");vf.setAttribute("oninput","return;"),xc=typeof vf.oninput=="function"}vc=xc}else vc=!1;Sf=vc&&(!document.documentMode||9<document.documentMode)}function xf(){Eo&&(Eo.detachEvent("onpropertychange",Af),_o=Eo=null)}function Af(e){if(e.propertyName==="value"&&jl(_o)){var n=[];yf(n,_o,e,ka(e)),La(n0,n)}}function i0(e,n,s){e==="focusin"?(xf(),Eo=n,_o=s,Eo.attachEvent("onpropertychange",Af)):e==="focusout"&&xf()}function s0(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return jl(_o)}function a0(e,n){if(e==="click")return jl(n)}function o0(e,n){if(e==="input"||e==="change")return jl(n)}function l0(e,n){return e===n&&(e!==0||1/e===1/n)||e!==e&&n!==n}var ei=typeof Object.is=="function"?Object.is:l0;function wo(e,n){if(ei(e,n))return!0;if(typeof e!="object"||e===null||typeof n!="object"||n===null)return!1;var s=Object.keys(e),l=Object.keys(n);if(s.length!==l.length)return!1;for(l=0;l<s.length;l++){var u=s[l];if(!it.call(n,u)||!ei(e[u],n[u]))return!1}return!0}function Tf(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ef(e,n){var s=Tf(e);e=0;for(var l;s;){if(s.nodeType===3){if(l=e+s.textContent.length,e<=n&&l>=n)return{node:s,offset:n-e};e=l}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=Tf(s)}}function _f(e,n){return e&&n?e===n?!0:e&&e.nodeType===3?!1:n&&n.nodeType===3?_f(e,n.parentNode):"contains"in e?e.contains(n):e.compareDocumentPosition?!!(e.compareDocumentPosition(n)&16):!1:!1}function wf(e){e=e!=null&&e.ownerDocument!=null&&e.ownerDocument.defaultView!=null?e.ownerDocument.defaultView:window;for(var n=C(e.document);n instanceof e.HTMLIFrameElement;){try{var s=typeof n.contentWindow.location.href=="string"}catch{s=!1}if(s)e=n.contentWindow;else break;n=C(e.document)}return n}function Ac(e){var n=e&&e.nodeName&&e.nodeName.toLowerCase();return n&&(n==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||n==="textarea"||e.contentEditable==="true")}var r0=Ci&&"documentMode"in document&&11>=document.documentMode,Ia=null,Tc=null,Mo=null,Ec=!1;function Mf(e,n,s){var l=s.window===s?s.document:s.nodeType===9?s:s.ownerDocument;Ec||Ia==null||Ia!==C(l)||(l=Ia,"selectionStart"in l&&Ac(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),Mo&&wo(Mo,l)||(Mo=l,l=Er(Tc,"onSelect"),0<l.length&&(n=new Bl("onSelect","select",null,n,s),e.push({event:n,listeners:l}),n.target=Ia)))}function sa(e,n){var s={};return s[e.toLowerCase()]=n.toLowerCase(),s["Webkit"+e]="webkit"+n,s["Moz"+e]="moz"+n,s}var ja={animationend:sa("Animation","AnimationEnd"),animationiteration:sa("Animation","AnimationIteration"),animationstart:sa("Animation","AnimationStart"),transitionrun:sa("Transition","TransitionRun"),transitionstart:sa("Transition","TransitionStart"),transitioncancel:sa("Transition","TransitionCancel"),transitionend:sa("Transition","TransitionEnd")},_c={},Of={};Ci&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ja.animationend.animation,delete ja.animationiteration.animation,delete ja.animationstart.animation),"TransitionEvent"in window||delete ja.transitionend.transition);function aa(e){if(_c[e])return _c[e];if(!ja[e])return e;var n=ja[e],s;for(s in n)if(n.hasOwnProperty(s)&&s in Of)return _c[e]=n[s];return e}var Cf=aa("animationend"),Nf=aa("animationiteration"),Rf=aa("animationstart"),c0=aa("transitionrun"),u0=aa("transitionstart"),d0=aa("transitioncancel"),kf=aa("transitionend"),Lf=new Map,wc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");wc.push("scrollEnd");function Ni(e,n){Lf.set(e,n),Wi(n,[e])}var Dl=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var n=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(n))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},di=[],Da=0,Mc=0;function Hl(){for(var e=Da,n=Mc=Da=0;n<e;){var s=di[n];di[n++]=null;var l=di[n];di[n++]=null;var u=di[n];di[n++]=null;var d=di[n];if(di[n++]=null,l!==null&&u!==null){var S=l.pending;S===null?u.next=u:(u.next=S.next,S.next=u),l.pending=u}d!==0&&Bf(s,u,d)}}function Pl(e,n,s,l){di[Da++]=e,di[Da++]=n,di[Da++]=s,di[Da++]=l,Mc|=l,e.lanes|=l,e=e.alternate,e!==null&&(e.lanes|=l)}function Oc(e,n,s,l){return Pl(e,n,s,l),Ul(e)}function oa(e,n){return Pl(e,null,null,n),Ul(e)}function Bf(e,n,s){e.lanes|=s;var l=e.alternate;l!==null&&(l.lanes|=s);for(var u=!1,d=e.return;d!==null;)d.childLanes|=s,l=d.alternate,l!==null&&(l.childLanes|=s),d.tag===22&&(e=d.stateNode,e===null||e._visibility&1||(u=!0)),e=d,d=d.return;return e.tag===3?(d=e.stateNode,u&&n!==null&&(u=31-Tt(s),e=d.hiddenUpdates,l=e[u],l===null?e[u]=[n]:l.push(n),n.lane=s|536870912),d):null}function Ul(e){if(50<Wo)throw Wo=0,Du=null,Error(o(185));for(var n=e.return;n!==null;)e=n,n=e.return;return e.tag===3?e.stateNode:null}var Ha={};function f0(e,n,s,l){this.tag=e,this.key=s,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ti(e,n,s,l){return new f0(e,n,s,l)}function Cc(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zi(e,n){var s=e.alternate;return s===null?(s=ti(e.tag,n,e.key,e.mode),s.elementType=e.elementType,s.type=e.type,s.stateNode=e.stateNode,s.alternate=e,e.alternate=s):(s.pendingProps=n,s.type=e.type,s.flags=0,s.subtreeFlags=0,s.deletions=null),s.flags=e.flags&65011712,s.childLanes=e.childLanes,s.lanes=e.lanes,s.child=e.child,s.memoizedProps=e.memoizedProps,s.memoizedState=e.memoizedState,s.updateQueue=e.updateQueue,n=e.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},s.sibling=e.sibling,s.index=e.index,s.ref=e.ref,s.refCleanup=e.refCleanup,s}function If(e,n){e.flags&=65011714;var s=e.alternate;return s===null?(e.childLanes=0,e.lanes=n,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=s.childLanes,e.lanes=s.lanes,e.child=s.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=s.memoizedProps,e.memoizedState=s.memoizedState,e.updateQueue=s.updateQueue,e.type=s.type,n=s.dependencies,e.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),e}function ql(e,n,s,l,u,d){var S=0;if(l=e,typeof e=="function")Cc(e)&&(S=1);else if(typeof e=="string")S=yb(e,s,ue.current)?26:e==="html"||e==="head"||e==="body"?27:5;else e:switch(e){case Z:return e=ti(31,s,n,u),e.elementType=Z,e.lanes=d,e;case h:return la(s.children,u,d,n);case R:S=8,u|=24;break;case k:return e=ti(12,s,n,u|2),e.elementType=k,e.lanes=d,e;case H:return e=ti(13,s,n,u),e.elementType=H,e.lanes=d,e;case j:return e=ti(19,s,n,u),e.elementType=j,e.lanes=d,e;default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case _:S=10;break e;case B:S=9;break e;case w:S=11;break e;case L:S=14;break e;case W:S=16,l=null;break e}S=29,s=Error(o(130,e===null?"null":typeof e,"")),l=null}return n=ti(S,s,n,u),n.elementType=e,n.type=l,n.lanes=d,n}function la(e,n,s,l){return e=ti(7,e,l,n),e.lanes=s,e}function Nc(e,n,s){return e=ti(6,e,null,n),e.lanes=s,e}function jf(e){var n=ti(18,null,null,0);return n.stateNode=e,n}function Rc(e,n,s){return n=ti(4,e.children!==null?e.children:[],e.key,n),n.lanes=s,n.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},n}var Df=new WeakMap;function fi(e,n){if(typeof e=="object"&&e!==null){var s=Df.get(e);return s!==void 0?s:(n={value:e,source:n,stack:Ve(n)},Df.set(e,n),n)}return{value:e,source:n,stack:Ve(n)}}var Pa=[],Ua=0,zl=null,Oo=0,mi=[],pi=0,xs=null,qi=1,zi="";function es(e,n){Pa[Ua++]=Oo,Pa[Ua++]=zl,zl=e,Oo=n}function Hf(e,n,s){mi[pi++]=qi,mi[pi++]=zi,mi[pi++]=xs,xs=e;var l=qi;e=zi;var u=32-Tt(l)-1;l&=~(1<<u),s+=1;var d=32-Tt(n)+u;if(30<d){var S=u-u%5;d=(l&(1<<S)-1).toString(32),l>>=S,u-=S,qi=1<<32-Tt(n)+u|s<<u|l,zi=d+e}else qi=1<<d|s<<u|l,zi=e}function kc(e){e.return!==null&&(es(e,1),Hf(e,1,0))}function Lc(e){for(;e===zl;)zl=Pa[--Ua],Pa[Ua]=null,Oo=Pa[--Ua],Pa[Ua]=null;for(;e===xs;)xs=mi[--pi],mi[pi]=null,zi=mi[--pi],mi[pi]=null,qi=mi[--pi],mi[pi]=null}function Pf(e,n){mi[pi++]=qi,mi[pi++]=zi,mi[pi++]=xs,qi=n.id,zi=n.overflow,xs=e}var An=null,wt=null,Xe=!1,As=null,hi=!1,Bc=Error(o(519));function Ts(e){var n=Error(o(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Co(fi(n,e)),Bc}function Uf(e){var n=e.stateNode,s=e.type,l=e.memoizedProps;switch(n[we]=e,n[be]=l,s){case"dialog":Ke("cancel",n),Ke("close",n);break;case"iframe":case"object":case"embed":Ke("load",n);break;case"video":case"audio":for(s=0;s<Qo.length;s++)Ke(Qo[s],n);break;case"source":Ke("error",n);break;case"img":case"image":case"link":Ke("error",n),Ke("load",n);break;case"details":Ke("toggle",n);break;case"input":Ke("invalid",n),ce(n,l.value,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name,!0);break;case"select":Ke("invalid",n);break;case"textarea":Ke("invalid",n),ot(n,l.value,l.defaultValue,l.children)}s=l.children,typeof s!="string"&&typeof s!="number"&&typeof s!="bigint"||n.textContent===""+s||l.suppressHydrationWarning===!0||ih(n.textContent,s)?(l.popover!=null&&(Ke("beforetoggle",n),Ke("toggle",n)),l.onScroll!=null&&Ke("scroll",n),l.onScrollEnd!=null&&Ke("scrollend",n),l.onClick!=null&&(n.onclick=Oi),n=!0):n=!1,n||Ts(e,!0)}function qf(e){for(An=e.return;An;)switch(An.tag){case 5:case 31:case 13:hi=!1;return;case 27:case 3:hi=!0;return;default:An=An.return}}function qa(e){if(e!==An)return!1;if(!Xe)return qf(e),Xe=!0,!1;var n=e.tag,s;if((s=n!==3&&n!==27)&&((s=n===5)&&(s=e.type,s=!(s!=="form"&&s!=="button")||Ju(e.type,e.memoizedProps)),s=!s),s&&wt&&Ts(e),qf(e),n===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));wt=fh(e)}else if(n===31){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(317));wt=fh(e)}else n===27?(n=wt,Ds(e.type)?(e=id,id=null,wt=e):wt=n):wt=An?yi(e.stateNode.nextSibling):null;return!0}function ra(){wt=An=null,Xe=!1}function Ic(){var e=As;return e!==null&&(Fn===null?Fn=e:Fn.push.apply(Fn,e),As=null),e}function Co(e){As===null?As=[e]:As.push(e)}var jc=O(null),ca=null,ts=null;function Es(e,n,s){te(jc,n._currentValue),n._currentValue=s}function ns(e){e._currentValue=jc.current,Y(jc)}function Dc(e,n,s){for(;e!==null;){var l=e.alternate;if((e.childLanes&n)!==n?(e.childLanes|=n,l!==null&&(l.childLanes|=n)):l!==null&&(l.childLanes&n)!==n&&(l.childLanes|=n),e===s)break;e=e.return}}function Hc(e,n,s,l){var u=e.child;for(u!==null&&(u.return=e);u!==null;){var d=u.dependencies;if(d!==null){var S=u.child;d=d.firstContext;e:for(;d!==null;){var T=d;d=u;for(var N=0;N<n.length;N++)if(T.context===n[N]){d.lanes|=s,T=d.alternate,T!==null&&(T.lanes|=s),Dc(d.return,s,e),l||(S=null);break e}d=T.next}}else if(u.tag===18){if(S=u.return,S===null)throw Error(o(341));S.lanes|=s,d=S.alternate,d!==null&&(d.lanes|=s),Dc(S,s,e),S=null}else S=u.child;if(S!==null)S.return=u;else for(S=u;S!==null;){if(S===e){S=null;break}if(u=S.sibling,u!==null){u.return=S.return,S=u;break}S=S.return}u=S}}function za(e,n,s,l){e=null;for(var u=n,d=!1;u!==null;){if(!d){if((u.flags&524288)!==0)d=!0;else if((u.flags&262144)!==0)break}if(u.tag===10){var S=u.alternate;if(S===null)throw Error(o(387));if(S=S.memoizedProps,S!==null){var T=u.type;ei(u.pendingProps.value,S.value)||(e!==null?e.push(T):e=[T])}}else if(u===Ne.current){if(S=u.alternate,S===null)throw Error(o(387));S.memoizedState.memoizedState!==u.memoizedState.memoizedState&&(e!==null?e.push(nl):e=[nl])}u=u.return}e!==null&&Hc(n,e,s,l),n.flags|=262144}function Vl(e){for(e=e.firstContext;e!==null;){if(!ei(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function ua(e){ca=e,ts=null,e=e.dependencies,e!==null&&(e.firstContext=null)}function Tn(e){return zf(ca,e)}function $l(e,n){return ca===null&&ua(e),zf(e,n)}function zf(e,n){var s=n._currentValue;if(n={context:n,memoizedValue:s,next:null},ts===null){if(e===null)throw Error(o(308));ts=n,e.dependencies={lanes:0,firstContext:n},e.flags|=524288}else ts=ts.next=n;return s}var m0=typeof AbortController<"u"?AbortController:function(){var e=[],n=this.signal={aborted:!1,addEventListener:function(s,l){e.push(l)}};this.abort=function(){n.aborted=!0,e.forEach(function(s){return s()})}},p0=t.unstable_scheduleCallback,h0=t.unstable_NormalPriority,Qt={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Pc(){return{controller:new m0,data:new Map,refCount:0}}function No(e){e.refCount--,e.refCount===0&&p0(h0,function(){e.controller.abort()})}var Ro=null,Uc=0,Va=0,$a=null;function g0(e,n){if(Ro===null){var s=Ro=[];Uc=0,Va=Vu(),$a={status:"pending",value:void 0,then:function(l){s.push(l)}}}return Uc++,n.then(Vf,Vf),n}function Vf(){if(--Uc===0&&Ro!==null){$a!==null&&($a.status="fulfilled");var e=Ro;Ro=null,Va=0,$a=null;for(var n=0;n<e.length;n++)(0,e[n])()}}function y0(e,n){var s=[],l={status:"pending",value:null,reason:null,then:function(u){s.push(u)}};return e.then(function(){l.status="fulfilled",l.value=n;for(var u=0;u<s.length;u++)(0,s[u])(n)},function(u){for(l.status="rejected",l.reason=u,u=0;u<s.length;u++)(0,s[u])(void 0)}),l}var $f=V.S;V.S=function(e,n){Mp=Fe(),typeof n=="object"&&n!==null&&typeof n.then=="function"&&g0(e,n),$f!==null&&$f(e,n)};var da=O(null);function qc(){var e=da.current;return e!==null?e:vt.pooledCache}function Yl(e,n){n===null?te(da,da.current):te(da,n.pool)}function Yf(){var e=qc();return e===null?null:{parent:Qt._currentValue,pool:e}}var Ya=Error(o(460)),zc=Error(o(474)),Kl=Error(o(542)),Fl={then:function(){}};function Kf(e){return e=e.status,e==="fulfilled"||e==="rejected"}function Ff(e,n,s){switch(s=e[s],s===void 0?e.push(n):s!==n&&(n.then(Oi,Oi),n=s),n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Wf(e),e;default:if(typeof n.status=="string")n.then(Oi,Oi);else{if(e=vt,e!==null&&100<e.shellSuspendCounter)throw Error(o(482));e=n,e.status="pending",e.then(function(l){if(n.status==="pending"){var u=n;u.status="fulfilled",u.value=l}},function(l){if(n.status==="pending"){var u=n;u.status="rejected",u.reason=l}})}switch(n.status){case"fulfilled":return n.value;case"rejected":throw e=n.reason,Wf(e),e}throw ma=n,Ya}}function fa(e){try{var n=e._init;return n(e._payload)}catch(s){throw s!==null&&typeof s=="object"&&typeof s.then=="function"?(ma=s,Ya):s}}var ma=null;function Gf(){if(ma===null)throw Error(o(459));var e=ma;return ma=null,e}function Wf(e){if(e===Ya||e===Kl)throw Error(o(483))}var Ka=null,ko=0;function Gl(e){var n=ko;return ko+=1,Ka===null&&(Ka=[]),Ff(Ka,e,n)}function Lo(e,n){n=n.props.ref,e.ref=n!==void 0?n:null}function Wl(e,n){throw n.$$typeof===x?Error(o(525)):(e=Object.prototype.toString.call(n),Error(o(31,e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)))}function Xf(e){function n(D,I){if(e){var U=D.deletions;U===null?(D.deletions=[I],D.flags|=16):U.push(I)}}function s(D,I){if(!e)return null;for(;I!==null;)n(D,I),I=I.sibling;return null}function l(D){for(var I=new Map;D!==null;)D.key!==null?I.set(D.key,D):I.set(D.index,D),D=D.sibling;return I}function u(D,I){return D=Zi(D,I),D.index=0,D.sibling=null,D}function d(D,I,U){return D.index=U,e?(U=D.alternate,U!==null?(U=U.index,U<I?(D.flags|=67108866,I):U):(D.flags|=67108866,I)):(D.flags|=1048576,I)}function S(D){return e&&D.alternate===null&&(D.flags|=67108866),D}function T(D,I,U,G){return I===null||I.tag!==6?(I=Nc(U,D.mode,G),I.return=D,I):(I=u(I,U),I.return=D,I)}function N(D,I,U,G){var Ee=U.type;return Ee===h?K(D,I,U.props.children,G,U.key):I!==null&&(I.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===W&&fa(Ee)===I.type)?(I=u(I,U.props),Lo(I,U),I.return=D,I):(I=ql(U.type,U.key,U.props,null,D.mode,G),Lo(I,U),I.return=D,I)}function q(D,I,U,G){return I===null||I.tag!==4||I.stateNode.containerInfo!==U.containerInfo||I.stateNode.implementation!==U.implementation?(I=Rc(U,D.mode,G),I.return=D,I):(I=u(I,U.children||[]),I.return=D,I)}function K(D,I,U,G,Ee){return I===null||I.tag!==7?(I=la(U,D.mode,G,Ee),I.return=D,I):(I=u(I,U),I.return=D,I)}function Q(D,I,U){if(typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint")return I=Nc(""+I,D.mode,U),I.return=D,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case E:return U=ql(I.type,I.key,I.props,null,D.mode,U),Lo(U,I),U.return=D,U;case m:return I=Rc(I,D.mode,U),I.return=D,I;case W:return I=fa(I),Q(D,I,U)}if(ve(I)||Be(I))return I=la(I,D.mode,U,null),I.return=D,I;if(typeof I.then=="function")return Q(D,Gl(I),U);if(I.$$typeof===_)return Q(D,$l(D,I),U);Wl(D,I)}return null}function z(D,I,U,G){var Ee=I!==null?I.key:null;if(typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint")return Ee!==null?null:T(D,I,""+U,G);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case E:return U.key===Ee?N(D,I,U,G):null;case m:return U.key===Ee?q(D,I,U,G):null;case W:return U=fa(U),z(D,I,U,G)}if(ve(U)||Be(U))return Ee!==null?null:K(D,I,U,G,null);if(typeof U.then=="function")return z(D,I,Gl(U),G);if(U.$$typeof===_)return z(D,I,$l(D,U),G);Wl(D,U)}return null}function $(D,I,U,G,Ee){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return D=D.get(U)||null,T(I,D,""+G,Ee);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case E:return D=D.get(G.key===null?U:G.key)||null,N(I,D,G,Ee);case m:return D=D.get(G.key===null?U:G.key)||null,q(I,D,G,Ee);case W:return G=fa(G),$(D,I,U,G,Ee)}if(ve(G)||Be(G))return D=D.get(U)||null,K(I,D,G,Ee,null);if(typeof G.then=="function")return $(D,I,U,Gl(G),Ee);if(G.$$typeof===_)return $(D,I,U,$l(I,G),Ee);Wl(I,G)}return null}function ye(D,I,U,G){for(var Ee=null,tt=null,Se=I,He=I=0,We=null;Se!==null&&He<U.length;He++){Se.index>He?(We=Se,Se=null):We=Se.sibling;var nt=z(D,Se,U[He],G);if(nt===null){Se===null&&(Se=We);break}e&&Se&&nt.alternate===null&&n(D,Se),I=d(nt,I,He),tt===null?Ee=nt:tt.sibling=nt,tt=nt,Se=We}if(He===U.length)return s(D,Se),Xe&&es(D,He),Ee;if(Se===null){for(;He<U.length;He++)Se=Q(D,U[He],G),Se!==null&&(I=d(Se,I,He),tt===null?Ee=Se:tt.sibling=Se,tt=Se);return Xe&&es(D,He),Ee}for(Se=l(Se);He<U.length;He++)We=$(Se,D,He,U[He],G),We!==null&&(e&&We.alternate!==null&&Se.delete(We.key===null?He:We.key),I=d(We,I,He),tt===null?Ee=We:tt.sibling=We,tt=We);return e&&Se.forEach(function(zs){return n(D,zs)}),Xe&&es(D,He),Ee}function Me(D,I,U,G){if(U==null)throw Error(o(151));for(var Ee=null,tt=null,Se=I,He=I=0,We=null,nt=U.next();Se!==null&&!nt.done;He++,nt=U.next()){Se.index>He?(We=Se,Se=null):We=Se.sibling;var zs=z(D,Se,nt.value,G);if(zs===null){Se===null&&(Se=We);break}e&&Se&&zs.alternate===null&&n(D,Se),I=d(zs,I,He),tt===null?Ee=zs:tt.sibling=zs,tt=zs,Se=We}if(nt.done)return s(D,Se),Xe&&es(D,He),Ee;if(Se===null){for(;!nt.done;He++,nt=U.next())nt=Q(D,nt.value,G),nt!==null&&(I=d(nt,I,He),tt===null?Ee=nt:tt.sibling=nt,tt=nt);return Xe&&es(D,He),Ee}for(Se=l(Se);!nt.done;He++,nt=U.next())nt=$(Se,D,He,nt.value,G),nt!==null&&(e&&nt.alternate!==null&&Se.delete(nt.key===null?He:nt.key),I=d(nt,I,He),tt===null?Ee=nt:tt.sibling=nt,tt=nt);return e&&Se.forEach(function(Ob){return n(D,Ob)}),Xe&&es(D,He),Ee}function yt(D,I,U,G){if(typeof U=="object"&&U!==null&&U.type===h&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case E:e:{for(var Ee=U.key;I!==null;){if(I.key===Ee){if(Ee=U.type,Ee===h){if(I.tag===7){s(D,I.sibling),G=u(I,U.props.children),G.return=D,D=G;break e}}else if(I.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===W&&fa(Ee)===I.type){s(D,I.sibling),G=u(I,U.props),Lo(G,U),G.return=D,D=G;break e}s(D,I);break}else n(D,I);I=I.sibling}U.type===h?(G=la(U.props.children,D.mode,G,U.key),G.return=D,D=G):(G=ql(U.type,U.key,U.props,null,D.mode,G),Lo(G,U),G.return=D,D=G)}return S(D);case m:e:{for(Ee=U.key;I!==null;){if(I.key===Ee)if(I.tag===4&&I.stateNode.containerInfo===U.containerInfo&&I.stateNode.implementation===U.implementation){s(D,I.sibling),G=u(I,U.children||[]),G.return=D,D=G;break e}else{s(D,I);break}else n(D,I);I=I.sibling}G=Rc(U,D.mode,G),G.return=D,D=G}return S(D);case W:return U=fa(U),yt(D,I,U,G)}if(ve(U))return ye(D,I,U,G);if(Be(U)){if(Ee=Be(U),typeof Ee!="function")throw Error(o(150));return U=Ee.call(U),Me(D,I,U,G)}if(typeof U.then=="function")return yt(D,I,Gl(U),G);if(U.$$typeof===_)return yt(D,I,$l(D,U),G);Wl(D,U)}return typeof U=="string"&&U!==""||typeof U=="number"||typeof U=="bigint"?(U=""+U,I!==null&&I.tag===6?(s(D,I.sibling),G=u(I,U),G.return=D,D=G):(s(D,I),G=Nc(U,D.mode,G),G.return=D,D=G),S(D)):s(D,I)}return function(D,I,U,G){try{ko=0;var Ee=yt(D,I,U,G);return Ka=null,Ee}catch(Se){if(Se===Ya||Se===Kl)throw Se;var tt=ti(29,Se,null,D.mode);return tt.lanes=G,tt.return=D,tt}}}var pa=Xf(!0),Qf=Xf(!1),_s=!1;function Vc(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function $c(e,n){e=e.updateQueue,n.updateQueue===e&&(n.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function ws(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function Ms(e,n,s){var l=e.updateQueue;if(l===null)return null;if(l=l.shared,(st&2)!==0){var u=l.pending;return u===null?n.next=n:(n.next=u.next,u.next=n),l.pending=n,n=Ul(e),Bf(e,null,s),n}return Pl(e,l,n,s),Ul(e)}function Bo(e,n,s){if(n=n.updateQueue,n!==null&&(n=n.shared,(s&4194048)!==0)){var l=n.lanes;l&=e.pendingLanes,s|=l,n.lanes=s,Gi(e,s)}}function Yc(e,n){var s=e.updateQueue,l=e.alternate;if(l!==null&&(l=l.updateQueue,s===l)){var u=null,d=null;if(s=s.firstBaseUpdate,s!==null){do{var S={lane:s.lane,tag:s.tag,payload:s.payload,callback:null,next:null};d===null?u=d=S:d=d.next=S,s=s.next}while(s!==null);d===null?u=d=n:d=d.next=n}else u=d=n;s={baseState:l.baseState,firstBaseUpdate:u,lastBaseUpdate:d,shared:l.shared,callbacks:l.callbacks},e.updateQueue=s;return}e=s.lastBaseUpdate,e===null?s.firstBaseUpdate=n:e.next=n,s.lastBaseUpdate=n}var Kc=!1;function Io(){if(Kc){var e=$a;if(e!==null)throw e}}function jo(e,n,s,l){Kc=!1;var u=e.updateQueue;_s=!1;var d=u.firstBaseUpdate,S=u.lastBaseUpdate,T=u.shared.pending;if(T!==null){u.shared.pending=null;var N=T,q=N.next;N.next=null,S===null?d=q:S.next=q,S=N;var K=e.alternate;K!==null&&(K=K.updateQueue,T=K.lastBaseUpdate,T!==S&&(T===null?K.firstBaseUpdate=q:T.next=q,K.lastBaseUpdate=N))}if(d!==null){var Q=u.baseState;S=0,K=q=N=null,T=d;do{var z=T.lane&-536870913,$=z!==T.lane;if($?(Ge&z)===z:(l&z)===z){z!==0&&z===Va&&(Kc=!0),K!==null&&(K=K.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var ye=e,Me=T;z=n;var yt=s;switch(Me.tag){case 1:if(ye=Me.payload,typeof ye=="function"){Q=ye.call(yt,Q,z);break e}Q=ye;break e;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=Me.payload,z=typeof ye=="function"?ye.call(yt,Q,z):ye,z==null)break e;Q=v({},Q,z);break e;case 2:_s=!0}}z=T.callback,z!==null&&(e.flags|=64,$&&(e.flags|=8192),$=u.callbacks,$===null?u.callbacks=[z]:$.push(z))}else $={lane:z,tag:T.tag,payload:T.payload,callback:T.callback,next:null},K===null?(q=K=$,N=Q):K=K.next=$,S|=z;if(T=T.next,T===null){if(T=u.shared.pending,T===null)break;$=T,T=$.next,$.next=null,u.lastBaseUpdate=$,u.shared.pending=null}}while(!0);K===null&&(N=Q),u.baseState=N,u.firstBaseUpdate=q,u.lastBaseUpdate=K,d===null&&(u.shared.lanes=0),ks|=S,e.lanes=S,e.memoizedState=Q}}function Jf(e,n){if(typeof e!="function")throw Error(o(191,e));e.call(n)}function Zf(e,n){var s=e.callbacks;if(s!==null)for(e.callbacks=null,e=0;e<s.length;e++)Jf(s[e],n)}var Fa=O(null),Xl=O(0);function em(e,n){e=ds,te(Xl,e),te(Fa,n),ds=e|n.baseLanes}function Fc(){te(Xl,ds),te(Fa,Fa.current)}function Gc(){ds=Xl.current,Y(Fa),Y(Xl)}var ni=O(null),gi=null;function Os(e){var n=e.alternate;te(Ft,Ft.current&1),te(ni,e),gi===null&&(n===null||Fa.current!==null||n.memoizedState!==null)&&(gi=e)}function Wc(e){te(Ft,Ft.current),te(ni,e),gi===null&&(gi=e)}function tm(e){e.tag===22?(te(Ft,Ft.current),te(ni,e),gi===null&&(gi=e)):Cs()}function Cs(){te(Ft,Ft.current),te(ni,ni.current)}function ii(e){Y(ni),gi===e&&(gi=null),Y(Ft)}var Ft=O(0);function Ql(e){for(var n=e;n!==null;){if(n.tag===13){var s=n.memoizedState;if(s!==null&&(s=s.dehydrated,s===null||td(s)||nd(s)))return n}else if(n.tag===19&&(n.memoizedProps.revealOrder==="forwards"||n.memoizedProps.revealOrder==="backwards"||n.memoizedProps.revealOrder==="unstable_legacy-backwards"||n.memoizedProps.revealOrder==="together")){if((n.flags&128)!==0)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var is=0,je=null,ht=null,Jt=null,Jl=!1,Ga=!1,ha=!1,Zl=0,Do=0,Wa=null,b0=0;function Ut(){throw Error(o(321))}function Xc(e,n){if(n===null)return!1;for(var s=0;s<n.length&&s<e.length;s++)if(!ei(e[s],n[s]))return!1;return!0}function Qc(e,n,s,l,u,d){return is=d,je=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,V.H=e===null||e.memoizedState===null?Hm:fu,ha=!1,d=s(l,u),ha=!1,Ga&&(d=im(n,s,l,u)),nm(e),d}function nm(e){V.H=Uo;var n=ht!==null&&ht.next!==null;if(is=0,Jt=ht=je=null,Jl=!1,Do=0,Wa=null,n)throw Error(o(300));e===null||Zt||(e=e.dependencies,e!==null&&Vl(e)&&(Zt=!0))}function im(e,n,s,l){je=e;var u=0;do{if(Ga&&(Wa=null),Do=0,Ga=!1,25<=u)throw Error(o(301));if(u+=1,Jt=ht=null,e.updateQueue!=null){var d=e.updateQueue;d.lastEffect=null,d.events=null,d.stores=null,d.memoCache!=null&&(d.memoCache.index=0)}V.H=Pm,d=n(s,l)}while(Ga);return d}function S0(){var e=V.H,n=e.useState()[0];return n=typeof n.then=="function"?Ho(n):n,e=e.useState()[0],(ht!==null?ht.memoizedState:null)!==e&&(je.flags|=1024),n}function Jc(){var e=Zl!==0;return Zl=0,e}function Zc(e,n,s){n.updateQueue=e.updateQueue,n.flags&=-2053,e.lanes&=~s}function eu(e){if(Jl){for(e=e.memoizedState;e!==null;){var n=e.queue;n!==null&&(n.pending=null),e=e.next}Jl=!1}is=0,Jt=ht=je=null,Ga=!1,Do=Zl=0,Wa=null}function Bn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?je.memoizedState=Jt=e:Jt=Jt.next=e,Jt}function Gt(){if(ht===null){var e=je.alternate;e=e!==null?e.memoizedState:null}else e=ht.next;var n=Jt===null?je.memoizedState:Jt.next;if(n!==null)Jt=n,ht=e;else{if(e===null)throw je.alternate===null?Error(o(467)):Error(o(310));ht=e,e={memoizedState:ht.memoizedState,baseState:ht.baseState,baseQueue:ht.baseQueue,queue:ht.queue,next:null},Jt===null?je.memoizedState=Jt=e:Jt=Jt.next=e}return Jt}function er(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ho(e){var n=Do;return Do+=1,Wa===null&&(Wa=[]),e=Ff(Wa,e,n),n=je,(Jt===null?n.memoizedState:Jt.next)===null&&(n=n.alternate,V.H=n===null||n.memoizedState===null?Hm:fu),e}function tr(e){if(e!==null&&typeof e=="object"){if(typeof e.then=="function")return Ho(e);if(e.$$typeof===_)return Tn(e)}throw Error(o(438,String(e)))}function tu(e){var n=null,s=je.updateQueue;if(s!==null&&(n=s.memoCache),n==null){var l=je.alternate;l!==null&&(l=l.updateQueue,l!==null&&(l=l.memoCache,l!=null&&(n={data:l.data.map(function(u){return u.slice()}),index:0})))}if(n==null&&(n={data:[],index:0}),s===null&&(s=er(),je.updateQueue=s),s.memoCache=n,s=n.data[n.index],s===void 0)for(s=n.data[n.index]=Array(e),l=0;l<e;l++)s[l]=Te;return n.index++,s}function ss(e,n){return typeof n=="function"?n(e):n}function nr(e){var n=Gt();return nu(n,ht,e)}function nu(e,n,s){var l=e.queue;if(l===null)throw Error(o(311));l.lastRenderedReducer=s;var u=e.baseQueue,d=l.pending;if(d!==null){if(u!==null){var S=u.next;u.next=d.next,d.next=S}n.baseQueue=u=d,l.pending=null}if(d=e.baseState,u===null)e.memoizedState=d;else{n=u.next;var T=S=null,N=null,q=n,K=!1;do{var Q=q.lane&-536870913;if(Q!==q.lane?(Ge&Q)===Q:(is&Q)===Q){var z=q.revertLane;if(z===0)N!==null&&(N=N.next={lane:0,revertLane:0,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),Q===Va&&(K=!0);else if((is&z)===z){q=q.next,z===Va&&(K=!0);continue}else Q={lane:0,revertLane:q.revertLane,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},N===null?(T=N=Q,S=d):N=N.next=Q,je.lanes|=z,ks|=z;Q=q.action,ha&&s(d,Q),d=q.hasEagerState?q.eagerState:s(d,Q)}else z={lane:Q,revertLane:q.revertLane,gesture:q.gesture,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},N===null?(T=N=z,S=d):N=N.next=z,je.lanes|=Q,ks|=Q;q=q.next}while(q!==null&&q!==n);if(N===null?S=d:N.next=T,!ei(d,e.memoizedState)&&(Zt=!0,K&&(s=$a,s!==null)))throw s;e.memoizedState=d,e.baseState=S,e.baseQueue=N,l.lastRenderedState=d}return u===null&&(l.lanes=0),[e.memoizedState,l.dispatch]}function iu(e){var n=Gt(),s=n.queue;if(s===null)throw Error(o(311));s.lastRenderedReducer=e;var l=s.dispatch,u=s.pending,d=n.memoizedState;if(u!==null){s.pending=null;var S=u=u.next;do d=e(d,S.action),S=S.next;while(S!==u);ei(d,n.memoizedState)||(Zt=!0),n.memoizedState=d,n.baseQueue===null&&(n.baseState=d),s.lastRenderedState=d}return[d,l]}function sm(e,n,s){var l=je,u=Gt(),d=Xe;if(d){if(s===void 0)throw Error(o(407));s=s()}else s=n();var S=!ei((ht||u).memoizedState,s);if(S&&(u.memoizedState=s,Zt=!0),u=u.queue,ou(lm.bind(null,l,u,e),[e]),u.getSnapshot!==n||S||Jt!==null&&Jt.memoizedState.tag&1){if(l.flags|=2048,Xa(9,{destroy:void 0},om.bind(null,l,u,s,n),null),vt===null)throw Error(o(349));d||(is&127)!==0||am(l,n,s)}return s}function am(e,n,s){e.flags|=16384,e={getSnapshot:n,value:s},n=je.updateQueue,n===null?(n=er(),je.updateQueue=n,n.stores=[e]):(s=n.stores,s===null?n.stores=[e]:s.push(e))}function om(e,n,s,l){n.value=s,n.getSnapshot=l,rm(n)&&cm(e)}function lm(e,n,s){return s(function(){rm(n)&&cm(e)})}function rm(e){var n=e.getSnapshot;e=e.value;try{var s=n();return!ei(e,s)}catch{return!0}}function cm(e){var n=oa(e,2);n!==null&&Gn(n,e,2)}function su(e){var n=Bn();if(typeof e=="function"){var s=e;if(e=s(),ha){et(!0);try{s()}finally{et(!1)}}}return n.memoizedState=n.baseState=e,n.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ss,lastRenderedState:e},n}function um(e,n,s,l){return e.baseState=s,nu(e,ht,typeof l=="function"?l:ss)}function v0(e,n,s,l,u){if(ar(e))throw Error(o(485));if(e=n.action,e!==null){var d={payload:u,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){d.listeners.push(S)}};V.T!==null?s(!0):d.isTransition=!1,l(d),s=n.pending,s===null?(d.next=n.pending=d,dm(n,d)):(d.next=s.next,n.pending=s.next=d)}}function dm(e,n){var s=n.action,l=n.payload,u=e.state;if(n.isTransition){var d=V.T,S={};V.T=S;try{var T=s(u,l),N=V.S;N!==null&&N(S,T),fm(e,n,T)}catch(q){au(e,n,q)}finally{d!==null&&S.types!==null&&(d.types=S.types),V.T=d}}else try{d=s(u,l),fm(e,n,d)}catch(q){au(e,n,q)}}function fm(e,n,s){s!==null&&typeof s=="object"&&typeof s.then=="function"?s.then(function(l){mm(e,n,l)},function(l){return au(e,n,l)}):mm(e,n,s)}function mm(e,n,s){n.status="fulfilled",n.value=s,pm(n),e.state=s,n=e.pending,n!==null&&(s=n.next,s===n?e.pending=null:(s=s.next,n.next=s,dm(e,s)))}function au(e,n,s){var l=e.pending;if(e.pending=null,l!==null){l=l.next;do n.status="rejected",n.reason=s,pm(n),n=n.next;while(n!==l)}e.action=null}function pm(e){e=e.listeners;for(var n=0;n<e.length;n++)(0,e[n])()}function hm(e,n){return n}function gm(e,n){if(Xe){var s=vt.formState;if(s!==null){e:{var l=je;if(Xe){if(wt){t:{for(var u=wt,d=hi;u.nodeType!==8;){if(!d){u=null;break t}if(u=yi(u.nextSibling),u===null){u=null;break t}}d=u.data,u=d==="F!"||d==="F"?u:null}if(u){wt=yi(u.nextSibling),l=u.data==="F!";break e}}Ts(l)}l=!1}l&&(n=s[0])}}return s=Bn(),s.memoizedState=s.baseState=n,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:hm,lastRenderedState:n},s.queue=l,s=Im.bind(null,je,l),l.dispatch=s,l=su(!1),d=du.bind(null,je,!1,l.queue),l=Bn(),u={state:n,dispatch:null,action:e,pending:null},l.queue=u,s=v0.bind(null,je,u,d,s),u.dispatch=s,l.memoizedState=e,[n,s,!1]}function ym(e){var n=Gt();return bm(n,ht,e)}function bm(e,n,s){if(n=nu(e,n,hm)[0],e=nr(ss)[0],typeof n=="object"&&n!==null&&typeof n.then=="function")try{var l=Ho(n)}catch(S){throw S===Ya?Kl:S}else l=n;n=Gt();var u=n.queue,d=u.dispatch;return s!==n.memoizedState&&(je.flags|=2048,Xa(9,{destroy:void 0},x0.bind(null,u,s),null)),[l,d,e]}function x0(e,n){e.action=n}function Sm(e){var n=Gt(),s=ht;if(s!==null)return bm(n,s,e);Gt(),n=n.memoizedState,s=Gt();var l=s.queue.dispatch;return s.memoizedState=e,[n,l,!1]}function Xa(e,n,s,l){return e={tag:e,create:s,deps:l,inst:n,next:null},n=je.updateQueue,n===null&&(n=er(),je.updateQueue=n),s=n.lastEffect,s===null?n.lastEffect=e.next=e:(l=s.next,s.next=e,e.next=l,n.lastEffect=e),e}function vm(){return Gt().memoizedState}function ir(e,n,s,l){var u=Bn();je.flags|=e,u.memoizedState=Xa(1|n,{destroy:void 0},s,l===void 0?null:l)}function sr(e,n,s,l){var u=Gt();l=l===void 0?null:l;var d=u.memoizedState.inst;ht!==null&&l!==null&&Xc(l,ht.memoizedState.deps)?u.memoizedState=Xa(n,d,s,l):(je.flags|=e,u.memoizedState=Xa(1|n,d,s,l))}function xm(e,n){ir(8390656,8,e,n)}function ou(e,n){sr(2048,8,e,n)}function A0(e){je.flags|=4;var n=je.updateQueue;if(n===null)n=er(),je.updateQueue=n,n.events=[e];else{var s=n.events;s===null?n.events=[e]:s.push(e)}}function Am(e){var n=Gt().memoizedState;return A0({ref:n,nextImpl:e}),function(){if((st&2)!==0)throw Error(o(440));return n.impl.apply(void 0,arguments)}}function Tm(e,n){return sr(4,2,e,n)}function Em(e,n){return sr(4,4,e,n)}function _m(e,n){if(typeof n=="function"){e=e();var s=n(e);return function(){typeof s=="function"?s():n(null)}}if(n!=null)return e=e(),n.current=e,function(){n.current=null}}function wm(e,n,s){s=s!=null?s.concat([e]):null,sr(4,4,_m.bind(null,n,e),s)}function lu(){}function Mm(e,n){var s=Gt();n=n===void 0?null:n;var l=s.memoizedState;return n!==null&&Xc(n,l[1])?l[0]:(s.memoizedState=[e,n],e)}function Om(e,n){var s=Gt();n=n===void 0?null:n;var l=s.memoizedState;if(n!==null&&Xc(n,l[1]))return l[0];if(l=e(),ha){et(!0);try{e()}finally{et(!1)}}return s.memoizedState=[l,n],l}function ru(e,n,s){return s===void 0||(is&1073741824)!==0&&(Ge&261930)===0?e.memoizedState=n:(e.memoizedState=s,e=Cp(),je.lanes|=e,ks|=e,s)}function Cm(e,n,s,l){return ei(s,n)?s:Fa.current!==null?(e=ru(e,s,l),ei(e,n)||(Zt=!0),e):(is&42)===0||(is&1073741824)!==0&&(Ge&261930)===0?(Zt=!0,e.memoizedState=s):(e=Cp(),je.lanes|=e,ks|=e,n)}function Nm(e,n,s,l,u){var d=ie.p;ie.p=d!==0&&8>d?d:8;var S=V.T,T={};V.T=T,du(e,!1,n,s);try{var N=u(),q=V.S;if(q!==null&&q(T,N),N!==null&&typeof N=="object"&&typeof N.then=="function"){var K=y0(N,l);Po(e,n,K,oi(e))}else Po(e,n,l,oi(e))}catch(Q){Po(e,n,{then:function(){},status:"rejected",reason:Q},oi())}finally{ie.p=d,S!==null&&T.types!==null&&(S.types=T.types),V.T=S}}function T0(){}function cu(e,n,s,l){if(e.tag!==5)throw Error(o(476));var u=Rm(e).queue;Nm(e,u,n,re,s===null?T0:function(){return km(e),s(l)})}function Rm(e){var n=e.memoizedState;if(n!==null)return n;n={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ss,lastRenderedState:re},next:null};var s={};return n.next={memoizedState:s,baseState:s,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ss,lastRenderedState:s},next:null},e.memoizedState=n,e=e.alternate,e!==null&&(e.memoizedState=n),n}function km(e){var n=Rm(e);n.next===null&&(n=e.alternate.memoizedState),Po(e,n.next.queue,{},oi())}function uu(){return Tn(nl)}function Lm(){return Gt().memoizedState}function Bm(){return Gt().memoizedState}function E0(e){for(var n=e.return;n!==null;){switch(n.tag){case 24:case 3:var s=oi();e=ws(s);var l=Ms(n,e,s);l!==null&&(Gn(l,n,s),Bo(l,n,s)),n={cache:Pc()},e.payload=n;return}n=n.return}}function _0(e,n,s){var l=oi();s={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null},ar(e)?jm(n,s):(s=Oc(e,n,s,l),s!==null&&(Gn(s,e,l),Dm(s,n,l)))}function Im(e,n,s){var l=oi();Po(e,n,s,l)}function Po(e,n,s,l){var u={lane:l,revertLane:0,gesture:null,action:s,hasEagerState:!1,eagerState:null,next:null};if(ar(e))jm(n,u);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=n.lastRenderedReducer,d!==null))try{var S=n.lastRenderedState,T=d(S,s);if(u.hasEagerState=!0,u.eagerState=T,ei(T,S))return Pl(e,n,u,0),vt===null&&Hl(),!1}catch{}if(s=Oc(e,n,u,l),s!==null)return Gn(s,e,l),Dm(s,n,l),!0}return!1}function du(e,n,s,l){if(l={lane:2,revertLane:Vu(),gesture:null,action:l,hasEagerState:!1,eagerState:null,next:null},ar(e)){if(n)throw Error(o(479))}else n=Oc(e,s,l,2),n!==null&&Gn(n,e,2)}function ar(e){var n=e.alternate;return e===je||n!==null&&n===je}function jm(e,n){Ga=Jl=!0;var s=e.pending;s===null?n.next=n:(n.next=s.next,s.next=n),e.pending=n}function Dm(e,n,s){if((s&4194048)!==0){var l=n.lanes;l&=e.pendingLanes,s|=l,n.lanes=s,Gi(e,s)}}var Uo={readContext:Tn,use:tr,useCallback:Ut,useContext:Ut,useEffect:Ut,useImperativeHandle:Ut,useLayoutEffect:Ut,useInsertionEffect:Ut,useMemo:Ut,useReducer:Ut,useRef:Ut,useState:Ut,useDebugValue:Ut,useDeferredValue:Ut,useTransition:Ut,useSyncExternalStore:Ut,useId:Ut,useHostTransitionStatus:Ut,useFormState:Ut,useActionState:Ut,useOptimistic:Ut,useMemoCache:Ut,useCacheRefresh:Ut};Uo.useEffectEvent=Ut;var Hm={readContext:Tn,use:tr,useCallback:function(e,n){return Bn().memoizedState=[e,n===void 0?null:n],e},useContext:Tn,useEffect:xm,useImperativeHandle:function(e,n,s){s=s!=null?s.concat([e]):null,ir(4194308,4,_m.bind(null,n,e),s)},useLayoutEffect:function(e,n){return ir(4194308,4,e,n)},useInsertionEffect:function(e,n){ir(4,2,e,n)},useMemo:function(e,n){var s=Bn();n=n===void 0?null:n;var l=e();if(ha){et(!0);try{e()}finally{et(!1)}}return s.memoizedState=[l,n],l},useReducer:function(e,n,s){var l=Bn();if(s!==void 0){var u=s(n);if(ha){et(!0);try{s(n)}finally{et(!1)}}}else u=n;return l.memoizedState=l.baseState=u,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:u},l.queue=e,e=e.dispatch=_0.bind(null,je,e),[l.memoizedState,e]},useRef:function(e){var n=Bn();return e={current:e},n.memoizedState=e},useState:function(e){e=su(e);var n=e.queue,s=Im.bind(null,je,n);return n.dispatch=s,[e.memoizedState,s]},useDebugValue:lu,useDeferredValue:function(e,n){var s=Bn();return ru(s,e,n)},useTransition:function(){var e=su(!1);return e=Nm.bind(null,je,e.queue,!0,!1),Bn().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,n,s){var l=je,u=Bn();if(Xe){if(s===void 0)throw Error(o(407));s=s()}else{if(s=n(),vt===null)throw Error(o(349));(Ge&127)!==0||am(l,n,s)}u.memoizedState=s;var d={value:s,getSnapshot:n};return u.queue=d,xm(lm.bind(null,l,d,e),[e]),l.flags|=2048,Xa(9,{destroy:void 0},om.bind(null,l,d,s,n),null),s},useId:function(){var e=Bn(),n=vt.identifierPrefix;if(Xe){var s=zi,l=qi;s=(l&~(1<<32-Tt(l)-1)).toString(32)+s,n="_"+n+"R_"+s,s=Zl++,0<s&&(n+="H"+s.toString(32)),n+="_"}else s=b0++,n="_"+n+"r_"+s.toString(32)+"_";return e.memoizedState=n},useHostTransitionStatus:uu,useFormState:gm,useActionState:gm,useOptimistic:function(e){var n=Bn();n.memoizedState=n.baseState=e;var s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return n.queue=s,n=du.bind(null,je,!0,s),s.dispatch=n,[e,n]},useMemoCache:tu,useCacheRefresh:function(){return Bn().memoizedState=E0.bind(null,je)},useEffectEvent:function(e){var n=Bn(),s={impl:e};return n.memoizedState=s,function(){if((st&2)!==0)throw Error(o(440));return s.impl.apply(void 0,arguments)}}},fu={readContext:Tn,use:tr,useCallback:Mm,useContext:Tn,useEffect:ou,useImperativeHandle:wm,useInsertionEffect:Tm,useLayoutEffect:Em,useMemo:Om,useReducer:nr,useRef:vm,useState:function(){return nr(ss)},useDebugValue:lu,useDeferredValue:function(e,n){var s=Gt();return Cm(s,ht.memoizedState,e,n)},useTransition:function(){var e=nr(ss)[0],n=Gt().memoizedState;return[typeof e=="boolean"?e:Ho(e),n]},useSyncExternalStore:sm,useId:Lm,useHostTransitionStatus:uu,useFormState:ym,useActionState:ym,useOptimistic:function(e,n){var s=Gt();return um(s,ht,e,n)},useMemoCache:tu,useCacheRefresh:Bm};fu.useEffectEvent=Am;var Pm={readContext:Tn,use:tr,useCallback:Mm,useContext:Tn,useEffect:ou,useImperativeHandle:wm,useInsertionEffect:Tm,useLayoutEffect:Em,useMemo:Om,useReducer:iu,useRef:vm,useState:function(){return iu(ss)},useDebugValue:lu,useDeferredValue:function(e,n){var s=Gt();return ht===null?ru(s,e,n):Cm(s,ht.memoizedState,e,n)},useTransition:function(){var e=iu(ss)[0],n=Gt().memoizedState;return[typeof e=="boolean"?e:Ho(e),n]},useSyncExternalStore:sm,useId:Lm,useHostTransitionStatus:uu,useFormState:Sm,useActionState:Sm,useOptimistic:function(e,n){var s=Gt();return ht!==null?um(s,ht,e,n):(s.baseState=e,[e,s.queue.dispatch])},useMemoCache:tu,useCacheRefresh:Bm};Pm.useEffectEvent=Am;function mu(e,n,s,l){n=e.memoizedState,s=s(l,n),s=s==null?n:v({},n,s),e.memoizedState=s,e.lanes===0&&(e.updateQueue.baseState=s)}var pu={enqueueSetState:function(e,n,s){e=e._reactInternals;var l=oi(),u=ws(l);u.payload=n,s!=null&&(u.callback=s),n=Ms(e,u,l),n!==null&&(Gn(n,e,l),Bo(n,e,l))},enqueueReplaceState:function(e,n,s){e=e._reactInternals;var l=oi(),u=ws(l);u.tag=1,u.payload=n,s!=null&&(u.callback=s),n=Ms(e,u,l),n!==null&&(Gn(n,e,l),Bo(n,e,l))},enqueueForceUpdate:function(e,n){e=e._reactInternals;var s=oi(),l=ws(s);l.tag=2,n!=null&&(l.callback=n),n=Ms(e,l,s),n!==null&&(Gn(n,e,s),Bo(n,e,s))}};function Um(e,n,s,l,u,d,S){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(l,d,S):n.prototype&&n.prototype.isPureReactComponent?!wo(s,l)||!wo(u,d):!0}function qm(e,n,s,l){e=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(s,l),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(s,l),n.state!==e&&pu.enqueueReplaceState(n,n.state,null)}function ga(e,n){var s=n;if("ref"in n){s={};for(var l in n)l!=="ref"&&(s[l]=n[l])}if(e=e.defaultProps){s===n&&(s=v({},s));for(var u in e)s[u]===void 0&&(s[u]=e[u])}return s}function zm(e){Dl(e)}function Vm(e){console.error(e)}function $m(e){Dl(e)}function or(e,n){try{var s=e.onUncaughtError;s(n.value,{componentStack:n.stack})}catch(l){setTimeout(function(){throw l})}}function Ym(e,n,s){try{var l=e.onCaughtError;l(s.value,{componentStack:s.stack,errorBoundary:n.tag===1?n.stateNode:null})}catch(u){setTimeout(function(){throw u})}}function hu(e,n,s){return s=ws(s),s.tag=3,s.payload={element:null},s.callback=function(){or(e,n)},s}function Km(e){return e=ws(e),e.tag=3,e}function Fm(e,n,s,l){var u=s.type.getDerivedStateFromError;if(typeof u=="function"){var d=l.value;e.payload=function(){return u(d)},e.callback=function(){Ym(n,s,l)}}var S=s.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(e.callback=function(){Ym(n,s,l),typeof u!="function"&&(Ls===null?Ls=new Set([this]):Ls.add(this));var T=l.stack;this.componentDidCatch(l.value,{componentStack:T!==null?T:""})})}function w0(e,n,s,l,u){if(s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){if(n=s.alternate,n!==null&&za(n,s,u,!0),s=ni.current,s!==null){switch(s.tag){case 31:case 13:return gi===null?br():s.alternate===null&&qt===0&&(qt=3),s.flags&=-257,s.flags|=65536,s.lanes=u,l===Fl?s.flags|=16384:(n=s.updateQueue,n===null?s.updateQueue=new Set([l]):n.add(l),Uu(e,l,u)),!1;case 22:return s.flags|=65536,l===Fl?s.flags|=16384:(n=s.updateQueue,n===null?(n={transitions:null,markerInstances:null,retryQueue:new Set([l])},s.updateQueue=n):(s=n.retryQueue,s===null?n.retryQueue=new Set([l]):s.add(l)),Uu(e,l,u)),!1}throw Error(o(435,s.tag))}return Uu(e,l,u),br(),!1}if(Xe)return n=ni.current,n!==null?((n.flags&65536)===0&&(n.flags|=256),n.flags|=65536,n.lanes=u,l!==Bc&&(e=Error(o(422),{cause:l}),Co(fi(e,s)))):(l!==Bc&&(n=Error(o(423),{cause:l}),Co(fi(n,s))),e=e.current.alternate,e.flags|=65536,u&=-u,e.lanes|=u,l=fi(l,s),u=hu(e.stateNode,l,u),Yc(e,u),qt!==4&&(qt=2)),!1;var d=Error(o(520),{cause:l});if(d=fi(d,s),Go===null?Go=[d]:Go.push(d),qt!==4&&(qt=2),n===null)return!0;l=fi(l,s),s=n;do{switch(s.tag){case 3:return s.flags|=65536,e=u&-u,s.lanes|=e,e=hu(s.stateNode,l,e),Yc(s,e),!1;case 1:if(n=s.type,d=s.stateNode,(s.flags&128)===0&&(typeof n.getDerivedStateFromError=="function"||d!==null&&typeof d.componentDidCatch=="function"&&(Ls===null||!Ls.has(d))))return s.flags|=65536,u&=-u,s.lanes|=u,u=Km(u),Fm(u,e,s,l),Yc(s,u),!1}s=s.return}while(s!==null);return!1}var gu=Error(o(461)),Zt=!1;function En(e,n,s,l){n.child=e===null?Qf(n,null,s,l):pa(n,e.child,s,l)}function Gm(e,n,s,l,u){s=s.render;var d=n.ref;if("ref"in l){var S={};for(var T in l)T!=="ref"&&(S[T]=l[T])}else S=l;return ua(n),l=Qc(e,n,s,S,d,u),T=Jc(),e!==null&&!Zt?(Zc(e,n,u),as(e,n,u)):(Xe&&T&&kc(n),n.flags|=1,En(e,n,l,u),n.child)}function Wm(e,n,s,l,u){if(e===null){var d=s.type;return typeof d=="function"&&!Cc(d)&&d.defaultProps===void 0&&s.compare===null?(n.tag=15,n.type=d,Xm(e,n,d,l,u)):(e=ql(s.type,null,l,n,n.mode,u),e.ref=n.ref,e.return=n,n.child=e)}if(d=e.child,!Eu(e,u)){var S=d.memoizedProps;if(s=s.compare,s=s!==null?s:wo,s(S,l)&&e.ref===n.ref)return as(e,n,u)}return n.flags|=1,e=Zi(d,l),e.ref=n.ref,e.return=n,n.child=e}function Xm(e,n,s,l,u){if(e!==null){var d=e.memoizedProps;if(wo(d,l)&&e.ref===n.ref)if(Zt=!1,n.pendingProps=l=d,Eu(e,u))(e.flags&131072)!==0&&(Zt=!0);else return n.lanes=e.lanes,as(e,n,u)}return yu(e,n,s,l,u)}function Qm(e,n,s,l){var u=l.children,d=e!==null?e.memoizedState:null;if(e===null&&n.stateNode===null&&(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.mode==="hidden"){if((n.flags&128)!==0){if(d=d!==null?d.baseLanes|s:s,e!==null){for(l=n.child=e.child,u=0;l!==null;)u=u|l.lanes|l.childLanes,l=l.sibling;l=u&~d}else l=0,n.child=null;return Jm(e,n,d,s,l)}if((s&536870912)!==0)n.memoizedState={baseLanes:0,cachePool:null},e!==null&&Yl(n,d!==null?d.cachePool:null),d!==null?em(n,d):Fc(),tm(n);else return l=n.lanes=536870912,Jm(e,n,d!==null?d.baseLanes|s:s,s,l)}else d!==null?(Yl(n,d.cachePool),em(n,d),Cs(),n.memoizedState=null):(e!==null&&Yl(n,null),Fc(),Cs());return En(e,n,u,s),n.child}function qo(e,n){return e!==null&&e.tag===22||n.stateNode!==null||(n.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),n.sibling}function Jm(e,n,s,l,u){var d=qc();return d=d===null?null:{parent:Qt._currentValue,pool:d},n.memoizedState={baseLanes:s,cachePool:d},e!==null&&Yl(n,null),Fc(),tm(n),e!==null&&za(e,n,l,!0),n.childLanes=u,null}function lr(e,n){return n=cr({mode:n.mode,children:n.children},e.mode),n.ref=e.ref,e.child=n,n.return=e,n}function Zm(e,n,s){return pa(n,e.child,null,s),e=lr(n,n.pendingProps),e.flags|=2,ii(n),n.memoizedState=null,e}function M0(e,n,s){var l=n.pendingProps,u=(n.flags&128)!==0;if(n.flags&=-129,e===null){if(Xe){if(l.mode==="hidden")return e=lr(n,l),n.lanes=536870912,qo(null,e);if(Wc(n),(e=wt)?(e=dh(e,hi),e=e!==null&&e.data==="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:xs!==null?{id:qi,overflow:zi}:null,retryLane:536870912,hydrationErrors:null},s=jf(e),s.return=n,n.child=s,An=n,wt=null)):e=null,e===null)throw Ts(n);return n.lanes=536870912,null}return lr(n,l)}var d=e.memoizedState;if(d!==null){var S=d.dehydrated;if(Wc(n),u)if(n.flags&256)n.flags&=-257,n=Zm(e,n,s);else if(n.memoizedState!==null)n.child=e.child,n.flags|=128,n=null;else throw Error(o(558));else if(Zt||za(e,n,s,!1),u=(s&e.childLanes)!==0,Zt||u){if(l=vt,l!==null&&(S=Ei(l,s),S!==0&&S!==d.retryLane))throw d.retryLane=S,oa(e,S),Gn(l,e,S),gu;br(),n=Zm(e,n,s)}else e=d.treeContext,wt=yi(S.nextSibling),An=n,Xe=!0,As=null,hi=!1,e!==null&&Pf(n,e),n=lr(n,l),n.flags|=4096;return n}return e=Zi(e.child,{mode:l.mode,children:l.children}),e.ref=n.ref,n.child=e,e.return=n,e}function rr(e,n){var s=n.ref;if(s===null)e!==null&&e.ref!==null&&(n.flags|=4194816);else{if(typeof s!="function"&&typeof s!="object")throw Error(o(284));(e===null||e.ref!==s)&&(n.flags|=4194816)}}function yu(e,n,s,l,u){return ua(n),s=Qc(e,n,s,l,void 0,u),l=Jc(),e!==null&&!Zt?(Zc(e,n,u),as(e,n,u)):(Xe&&l&&kc(n),n.flags|=1,En(e,n,s,u),n.child)}function ep(e,n,s,l,u,d){return ua(n),n.updateQueue=null,s=im(n,l,s,u),nm(e),l=Jc(),e!==null&&!Zt?(Zc(e,n,d),as(e,n,d)):(Xe&&l&&kc(n),n.flags|=1,En(e,n,s,d),n.child)}function tp(e,n,s,l,u){if(ua(n),n.stateNode===null){var d=Ha,S=s.contextType;typeof S=="object"&&S!==null&&(d=Tn(S)),d=new s(l,d),n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=pu,n.stateNode=d,d._reactInternals=n,d=n.stateNode,d.props=l,d.state=n.memoizedState,d.refs={},Vc(n),S=s.contextType,d.context=typeof S=="object"&&S!==null?Tn(S):Ha,d.state=n.memoizedState,S=s.getDerivedStateFromProps,typeof S=="function"&&(mu(n,s,S,l),d.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(S=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),S!==d.state&&pu.enqueueReplaceState(d,d.state,null),jo(n,l,d,u),Io(),d.state=n.memoizedState),typeof d.componentDidMount=="function"&&(n.flags|=4194308),l=!0}else if(e===null){d=n.stateNode;var T=n.memoizedProps,N=ga(s,T);d.props=N;var q=d.context,K=s.contextType;S=Ha,typeof K=="object"&&K!==null&&(S=Tn(K));var Q=s.getDerivedStateFromProps;K=typeof Q=="function"||typeof d.getSnapshotBeforeUpdate=="function",T=n.pendingProps!==T,K||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(T||q!==S)&&qm(n,d,l,S),_s=!1;var z=n.memoizedState;d.state=z,jo(n,l,d,u),Io(),q=n.memoizedState,T||z!==q||_s?(typeof Q=="function"&&(mu(n,s,Q,l),q=n.memoizedState),(N=_s||Um(n,s,N,l,z,q,S))?(K||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(n.flags|=4194308)):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=l,n.memoizedState=q),d.props=l,d.state=q,d.context=S,l=N):(typeof d.componentDidMount=="function"&&(n.flags|=4194308),l=!1)}else{d=n.stateNode,$c(e,n),S=n.memoizedProps,K=ga(s,S),d.props=K,Q=n.pendingProps,z=d.context,q=s.contextType,N=Ha,typeof q=="object"&&q!==null&&(N=Tn(q)),T=s.getDerivedStateFromProps,(q=typeof T=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(S!==Q||z!==N)&&qm(n,d,l,N),_s=!1,z=n.memoizedState,d.state=z,jo(n,l,d,u),Io();var $=n.memoizedState;S!==Q||z!==$||_s||e!==null&&e.dependencies!==null&&Vl(e.dependencies)?(typeof T=="function"&&(mu(n,s,T,l),$=n.memoizedState),(K=_s||Um(n,s,K,l,z,$,N)||e!==null&&e.dependencies!==null&&Vl(e.dependencies))?(q||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(l,$,N),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(l,$,N)),typeof d.componentDidUpdate=="function"&&(n.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof d.componentDidUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=1024),n.memoizedProps=l,n.memoizedState=$),d.props=l,d.state=$,d.context=N,l=K):(typeof d.componentDidUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&z===e.memoizedState||(n.flags|=1024),l=!1)}return d=l,rr(e,n),l=(n.flags&128)!==0,d||l?(d=n.stateNode,s=l&&typeof s.getDerivedStateFromError!="function"?null:d.render(),n.flags|=1,e!==null&&l?(n.child=pa(n,e.child,null,u),n.child=pa(n,null,s,u)):En(e,n,s,u),n.memoizedState=d.state,e=n.child):e=as(e,n,u),e}function np(e,n,s,l){return ra(),n.flags|=256,En(e,n,s,l),n.child}var bu={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Su(e){return{baseLanes:e,cachePool:Yf()}}function vu(e,n,s){return e=e!==null?e.childLanes&~s:0,n&&(e|=ai),e}function ip(e,n,s){var l=n.pendingProps,u=!1,d=(n.flags&128)!==0,S;if((S=d)||(S=e!==null&&e.memoizedState===null?!1:(Ft.current&2)!==0),S&&(u=!0,n.flags&=-129),S=(n.flags&32)!==0,n.flags&=-33,e===null){if(Xe){if(u?Os(n):Cs(),(e=wt)?(e=dh(e,hi),e=e!==null&&e.data!=="&"?e:null,e!==null&&(n.memoizedState={dehydrated:e,treeContext:xs!==null?{id:qi,overflow:zi}:null,retryLane:536870912,hydrationErrors:null},s=jf(e),s.return=n,n.child=s,An=n,wt=null)):e=null,e===null)throw Ts(n);return nd(e)?n.lanes=32:n.lanes=536870912,null}var T=l.children;return l=l.fallback,u?(Cs(),u=n.mode,T=cr({mode:"hidden",children:T},u),l=la(l,u,s,null),T.return=n,l.return=n,T.sibling=l,n.child=T,l=n.child,l.memoizedState=Su(s),l.childLanes=vu(e,S,s),n.memoizedState=bu,qo(null,l)):(Os(n),xu(n,T))}var N=e.memoizedState;if(N!==null&&(T=N.dehydrated,T!==null)){if(d)n.flags&256?(Os(n),n.flags&=-257,n=Au(e,n,s)):n.memoizedState!==null?(Cs(),n.child=e.child,n.flags|=128,n=null):(Cs(),T=l.fallback,u=n.mode,l=cr({mode:"visible",children:l.children},u),T=la(T,u,s,null),T.flags|=2,l.return=n,T.return=n,l.sibling=T,n.child=l,pa(n,e.child,null,s),l=n.child,l.memoizedState=Su(s),l.childLanes=vu(e,S,s),n.memoizedState=bu,n=qo(null,l));else if(Os(n),nd(T)){if(S=T.nextSibling&&T.nextSibling.dataset,S)var q=S.dgst;S=q,l=Error(o(419)),l.stack="",l.digest=S,Co({value:l,source:null,stack:null}),n=Au(e,n,s)}else if(Zt||za(e,n,s,!1),S=(s&e.childLanes)!==0,Zt||S){if(S=vt,S!==null&&(l=Ei(S,s),l!==0&&l!==N.retryLane))throw N.retryLane=l,oa(e,l),Gn(S,e,l),gu;td(T)||br(),n=Au(e,n,s)}else td(T)?(n.flags|=192,n.child=e.child,n=null):(e=N.treeContext,wt=yi(T.nextSibling),An=n,Xe=!0,As=null,hi=!1,e!==null&&Pf(n,e),n=xu(n,l.children),n.flags|=4096);return n}return u?(Cs(),T=l.fallback,u=n.mode,N=e.child,q=N.sibling,l=Zi(N,{mode:"hidden",children:l.children}),l.subtreeFlags=N.subtreeFlags&65011712,q!==null?T=Zi(q,T):(T=la(T,u,s,null),T.flags|=2),T.return=n,l.return=n,l.sibling=T,n.child=l,qo(null,l),l=n.child,T=e.child.memoizedState,T===null?T=Su(s):(u=T.cachePool,u!==null?(N=Qt._currentValue,u=u.parent!==N?{parent:N,pool:N}:u):u=Yf(),T={baseLanes:T.baseLanes|s,cachePool:u}),l.memoizedState=T,l.childLanes=vu(e,S,s),n.memoizedState=bu,qo(e.child,l)):(Os(n),s=e.child,e=s.sibling,s=Zi(s,{mode:"visible",children:l.children}),s.return=n,s.sibling=null,e!==null&&(S=n.deletions,S===null?(n.deletions=[e],n.flags|=16):S.push(e)),n.child=s,n.memoizedState=null,s)}function xu(e,n){return n=cr({mode:"visible",children:n},e.mode),n.return=e,e.child=n}function cr(e,n){return e=ti(22,e,null,n),e.lanes=0,e}function Au(e,n,s){return pa(n,e.child,null,s),e=xu(n,n.pendingProps.children),e.flags|=2,n.memoizedState=null,e}function sp(e,n,s){e.lanes|=n;var l=e.alternate;l!==null&&(l.lanes|=n),Dc(e.return,n,s)}function Tu(e,n,s,l,u,d){var S=e.memoizedState;S===null?e.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:l,tail:s,tailMode:u,treeForkCount:d}:(S.isBackwards=n,S.rendering=null,S.renderingStartTime=0,S.last=l,S.tail=s,S.tailMode=u,S.treeForkCount=d)}function ap(e,n,s){var l=n.pendingProps,u=l.revealOrder,d=l.tail;l=l.children;var S=Ft.current,T=(S&2)!==0;if(T?(S=S&1|2,n.flags|=128):S&=1,te(Ft,S),En(e,n,l,s),l=Xe?Oo:0,!T&&e!==null&&(e.flags&128)!==0)e:for(e=n.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&sp(e,s,n);else if(e.tag===19)sp(e,s,n);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break e;for(;e.sibling===null;){if(e.return===null||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(u){case"forwards":for(s=n.child,u=null;s!==null;)e=s.alternate,e!==null&&Ql(e)===null&&(u=s),s=s.sibling;s=u,s===null?(u=n.child,n.child=null):(u=s.sibling,s.sibling=null),Tu(n,!1,u,s,d,l);break;case"backwards":case"unstable_legacy-backwards":for(s=null,u=n.child,n.child=null;u!==null;){if(e=u.alternate,e!==null&&Ql(e)===null){n.child=u;break}e=u.sibling,u.sibling=s,s=u,u=e}Tu(n,!0,s,null,d,l);break;case"together":Tu(n,!1,null,null,void 0,l);break;default:n.memoizedState=null}return n.child}function as(e,n,s){if(e!==null&&(n.dependencies=e.dependencies),ks|=n.lanes,(s&n.childLanes)===0)if(e!==null){if(za(e,n,s,!1),(s&n.childLanes)===0)return null}else return null;if(e!==null&&n.child!==e.child)throw Error(o(153));if(n.child!==null){for(e=n.child,s=Zi(e,e.pendingProps),n.child=s,s.return=n;e.sibling!==null;)e=e.sibling,s=s.sibling=Zi(e,e.pendingProps),s.return=n;s.sibling=null}return n.child}function Eu(e,n){return(e.lanes&n)!==0?!0:(e=e.dependencies,!!(e!==null&&Vl(e)))}function O0(e,n,s){switch(n.tag){case 3:ft(n,n.stateNode.containerInfo),Es(n,Qt,e.memoizedState.cache),ra();break;case 27:case 5:Lt(n);break;case 4:ft(n,n.stateNode.containerInfo);break;case 10:Es(n,n.type,n.memoizedProps.value);break;case 31:if(n.memoizedState!==null)return n.flags|=128,Wc(n),null;break;case 13:var l=n.memoizedState;if(l!==null)return l.dehydrated!==null?(Os(n),n.flags|=128,null):(s&n.child.childLanes)!==0?ip(e,n,s):(Os(n),e=as(e,n,s),e!==null?e.sibling:null);Os(n);break;case 19:var u=(e.flags&128)!==0;if(l=(s&n.childLanes)!==0,l||(za(e,n,s,!1),l=(s&n.childLanes)!==0),u){if(l)return ap(e,n,s);n.flags|=128}if(u=n.memoizedState,u!==null&&(u.rendering=null,u.tail=null,u.lastEffect=null),te(Ft,Ft.current),l)break;return null;case 22:return n.lanes=0,Qm(e,n,s,n.pendingProps);case 24:Es(n,Qt,e.memoizedState.cache)}return as(e,n,s)}function op(e,n,s){if(e!==null)if(e.memoizedProps!==n.pendingProps)Zt=!0;else{if(!Eu(e,s)&&(n.flags&128)===0)return Zt=!1,O0(e,n,s);Zt=(e.flags&131072)!==0}else Zt=!1,Xe&&(n.flags&1048576)!==0&&Hf(n,Oo,n.index);switch(n.lanes=0,n.tag){case 16:e:{var l=n.pendingProps;if(e=fa(n.elementType),n.type=e,typeof e=="function")Cc(e)?(l=ga(e,l),n.tag=1,n=tp(null,n,e,l,s)):(n.tag=0,n=yu(null,n,e,l,s));else{if(e!=null){var u=e.$$typeof;if(u===w){n.tag=11,n=Gm(null,n,e,l,s);break e}else if(u===L){n.tag=14,n=Wm(null,n,e,l,s);break e}}throw n=xe(e)||e,Error(o(306,n,""))}}return n;case 0:return yu(e,n,n.type,n.pendingProps,s);case 1:return l=n.type,u=ga(l,n.pendingProps),tp(e,n,l,u,s);case 3:e:{if(ft(n,n.stateNode.containerInfo),e===null)throw Error(o(387));l=n.pendingProps;var d=n.memoizedState;u=d.element,$c(e,n),jo(n,l,null,s);var S=n.memoizedState;if(l=S.cache,Es(n,Qt,l),l!==d.cache&&Hc(n,[Qt],s,!0),Io(),l=S.element,d.isDehydrated)if(d={element:l,isDehydrated:!1,cache:S.cache},n.updateQueue.baseState=d,n.memoizedState=d,n.flags&256){n=np(e,n,l,s);break e}else if(l!==u){u=fi(Error(o(424)),n),Co(u),n=np(e,n,l,s);break e}else for(e=n.stateNode.containerInfo,e.nodeType===9?e=e.body:e=e.nodeName==="HTML"?e.ownerDocument.body:e,wt=yi(e.firstChild),An=n,Xe=!0,As=null,hi=!0,s=Qf(n,null,l,s),n.child=s;s;)s.flags=s.flags&-3|4096,s=s.sibling;else{if(ra(),l===u){n=as(e,n,s);break e}En(e,n,l,s)}n=n.child}return n;case 26:return rr(e,n),e===null?(s=yh(n.type,null,n.pendingProps,null))?n.memoizedState=s:Xe||(s=n.type,e=n.pendingProps,l=_r(Ce.current).createElement(s),l[we]=n,l[be]=e,_n(l,s,e),Nt(l),n.stateNode=l):n.memoizedState=yh(n.type,e.memoizedProps,n.pendingProps,e.memoizedState),null;case 27:return Lt(n),e===null&&Xe&&(l=n.stateNode=ph(n.type,n.pendingProps,Ce.current),An=n,hi=!0,u=wt,Ds(n.type)?(id=u,wt=yi(l.firstChild)):wt=u),En(e,n,n.pendingProps.children,s),rr(e,n),e===null&&(n.flags|=4194304),n.child;case 5:return e===null&&Xe&&((u=l=wt)&&(l=sb(l,n.type,n.pendingProps,hi),l!==null?(n.stateNode=l,An=n,wt=yi(l.firstChild),hi=!1,u=!0):u=!1),u||Ts(n)),Lt(n),u=n.type,d=n.pendingProps,S=e!==null?e.memoizedProps:null,l=d.children,Ju(u,d)?l=null:S!==null&&Ju(u,S)&&(n.flags|=32),n.memoizedState!==null&&(u=Qc(e,n,S0,null,null,s),nl._currentValue=u),rr(e,n),En(e,n,l,s),n.child;case 6:return e===null&&Xe&&((e=s=wt)&&(s=ab(s,n.pendingProps,hi),s!==null?(n.stateNode=s,An=n,wt=null,e=!0):e=!1),e||Ts(n)),null;case 13:return ip(e,n,s);case 4:return ft(n,n.stateNode.containerInfo),l=n.pendingProps,e===null?n.child=pa(n,null,l,s):En(e,n,l,s),n.child;case 11:return Gm(e,n,n.type,n.pendingProps,s);case 7:return En(e,n,n.pendingProps,s),n.child;case 8:return En(e,n,n.pendingProps.children,s),n.child;case 12:return En(e,n,n.pendingProps.children,s),n.child;case 10:return l=n.pendingProps,Es(n,n.type,l.value),En(e,n,l.children,s),n.child;case 9:return u=n.type._context,l=n.pendingProps.children,ua(n),u=Tn(u),l=l(u),n.flags|=1,En(e,n,l,s),n.child;case 14:return Wm(e,n,n.type,n.pendingProps,s);case 15:return Xm(e,n,n.type,n.pendingProps,s);case 19:return ap(e,n,s);case 31:return M0(e,n,s);case 22:return Qm(e,n,s,n.pendingProps);case 24:return ua(n),l=Tn(Qt),e===null?(u=qc(),u===null&&(u=vt,d=Pc(),u.pooledCache=d,d.refCount++,d!==null&&(u.pooledCacheLanes|=s),u=d),n.memoizedState={parent:l,cache:u},Vc(n),Es(n,Qt,u)):((e.lanes&s)!==0&&($c(e,n),jo(n,null,null,s),Io()),u=e.memoizedState,d=n.memoizedState,u.parent!==l?(u={parent:l,cache:l},n.memoizedState=u,n.lanes===0&&(n.memoizedState=n.updateQueue.baseState=u),Es(n,Qt,l)):(l=d.cache,Es(n,Qt,l),l!==u.cache&&Hc(n,[Qt],s,!0))),En(e,n,n.pendingProps.children,s),n.child;case 29:throw n.pendingProps}throw Error(o(156,n.tag))}function os(e){e.flags|=4}function _u(e,n,s,l,u){if((n=(e.mode&32)!==0)&&(n=!1),n){if(e.flags|=16777216,(u&335544128)===u)if(e.stateNode.complete)e.flags|=8192;else if(Lp())e.flags|=8192;else throw ma=Fl,zc}else e.flags&=-16777217}function lp(e,n){if(n.type!=="stylesheet"||(n.state.loading&4)!==0)e.flags&=-16777217;else if(e.flags|=16777216,!Ah(n))if(Lp())e.flags|=8192;else throw ma=Fl,zc}function ur(e,n){n!==null&&(e.flags|=4),e.flags&16384&&(n=e.tag!==22?ci():536870912,e.lanes|=n,eo|=n)}function zo(e,n){if(!Xe)switch(e.tailMode){case"hidden":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e.tail=null:s.sibling=null;break;case"collapsed":s=e.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?n||e.tail===null?e.tail=null:e.tail.sibling=null:l.sibling=null}}function Mt(e){var n=e.alternate!==null&&e.alternate.child===e.child,s=0,l=0;if(n)for(var u=e.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags&65011712,l|=u.flags&65011712,u.return=e,u=u.sibling;else for(u=e.child;u!==null;)s|=u.lanes|u.childLanes,l|=u.subtreeFlags,l|=u.flags,u.return=e,u=u.sibling;return e.subtreeFlags|=l,e.childLanes=s,n}function C0(e,n,s){var l=n.pendingProps;switch(Lc(n),n.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mt(n),null;case 1:return Mt(n),null;case 3:return s=n.stateNode,l=null,e!==null&&(l=e.memoizedState.cache),n.memoizedState.cache!==l&&(n.flags|=2048),ns(Qt),qe(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(qa(n)?os(n):e===null||e.memoizedState.isDehydrated&&(n.flags&256)===0||(n.flags|=1024,Ic())),Mt(n),null;case 26:var u=n.type,d=n.memoizedState;return e===null?(os(n),d!==null?(Mt(n),lp(n,d)):(Mt(n),_u(n,u,null,l,s))):d?d!==e.memoizedState?(os(n),Mt(n),lp(n,d)):(Mt(n),n.flags&=-16777217):(e=e.memoizedProps,e!==l&&os(n),Mt(n),_u(n,u,e,l,s)),null;case 27:if(ze(n),s=Ce.current,u=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==l&&os(n);else{if(!l){if(n.stateNode===null)throw Error(o(166));return Mt(n),null}e=ue.current,qa(n)?Uf(n):(e=ph(u,l,s),n.stateNode=e,os(n))}return Mt(n),null;case 5:if(ze(n),u=n.type,e!==null&&n.stateNode!=null)e.memoizedProps!==l&&os(n);else{if(!l){if(n.stateNode===null)throw Error(o(166));return Mt(n),null}if(d=ue.current,qa(n))Uf(n);else{var S=_r(Ce.current);switch(d){case 1:d=S.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:d=S.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":d=S.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":d=S.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":d=S.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild);break;case"select":d=typeof l.is=="string"?S.createElement("select",{is:l.is}):S.createElement("select"),l.multiple?d.multiple=!0:l.size&&(d.size=l.size);break;default:d=typeof l.is=="string"?S.createElement(u,{is:l.is}):S.createElement(u)}}d[we]=n,d[be]=l;e:for(S=n.child;S!==null;){if(S.tag===5||S.tag===6)d.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===n)break e;for(;S.sibling===null;){if(S.return===null||S.return===n)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}n.stateNode=d;e:switch(_n(d,u,l),u){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&os(n)}}return Mt(n),_u(n,n.type,e===null?null:e.memoizedProps,n.pendingProps,s),null;case 6:if(e&&n.stateNode!=null)e.memoizedProps!==l&&os(n);else{if(typeof l!="string"&&n.stateNode===null)throw Error(o(166));if(e=Ce.current,qa(n)){if(e=n.stateNode,s=n.memoizedProps,l=null,u=An,u!==null)switch(u.tag){case 27:case 5:l=u.memoizedProps}e[we]=n,e=!!(e.nodeValue===s||l!==null&&l.suppressHydrationWarning===!0||ih(e.nodeValue,s)),e||Ts(n,!0)}else e=_r(e).createTextNode(l),e[we]=n,n.stateNode=e}return Mt(n),null;case 31:if(s=n.memoizedState,e===null||e.memoizedState!==null){if(l=qa(n),s!==null){if(e===null){if(!l)throw Error(o(318));if(e=n.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(o(557));e[we]=n}else ra(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Mt(n),e=!1}else s=Ic(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=s),e=!0;if(!e)return n.flags&256?(ii(n),n):(ii(n),null);if((n.flags&128)!==0)throw Error(o(558))}return Mt(n),null;case 13:if(l=n.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(u=qa(n),l!==null&&l.dehydrated!==null){if(e===null){if(!u)throw Error(o(318));if(u=n.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(o(317));u[we]=n}else ra(),(n.flags&128)===0&&(n.memoizedState=null),n.flags|=4;Mt(n),u=!1}else u=Ic(),e!==null&&e.memoizedState!==null&&(e.memoizedState.hydrationErrors=u),u=!0;if(!u)return n.flags&256?(ii(n),n):(ii(n),null)}return ii(n),(n.flags&128)!==0?(n.lanes=s,n):(s=l!==null,e=e!==null&&e.memoizedState!==null,s&&(l=n.child,u=null,l.alternate!==null&&l.alternate.memoizedState!==null&&l.alternate.memoizedState.cachePool!==null&&(u=l.alternate.memoizedState.cachePool.pool),d=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(d=l.memoizedState.cachePool.pool),d!==u&&(l.flags|=2048)),s!==e&&s&&(n.child.flags|=8192),ur(n,n.updateQueue),Mt(n),null);case 4:return qe(),e===null&&Fu(n.stateNode.containerInfo),Mt(n),null;case 10:return ns(n.type),Mt(n),null;case 19:if(Y(Ft),l=n.memoizedState,l===null)return Mt(n),null;if(u=(n.flags&128)!==0,d=l.rendering,d===null)if(u)zo(l,!1);else{if(qt!==0||e!==null&&(e.flags&128)!==0)for(e=n.child;e!==null;){if(d=Ql(e),d!==null){for(n.flags|=128,zo(l,!1),e=d.updateQueue,n.updateQueue=e,ur(n,e),n.subtreeFlags=0,e=s,s=n.child;s!==null;)If(s,e),s=s.sibling;return te(Ft,Ft.current&1|2),Xe&&es(n,l.treeForkCount),n.child}e=e.sibling}l.tail!==null&&Fe()>hr&&(n.flags|=128,u=!0,zo(l,!1),n.lanes=4194304)}else{if(!u)if(e=Ql(d),e!==null){if(n.flags|=128,u=!0,e=e.updateQueue,n.updateQueue=e,ur(n,e),zo(l,!0),l.tail===null&&l.tailMode==="hidden"&&!d.alternate&&!Xe)return Mt(n),null}else 2*Fe()-l.renderingStartTime>hr&&s!==536870912&&(n.flags|=128,u=!0,zo(l,!1),n.lanes=4194304);l.isBackwards?(d.sibling=n.child,n.child=d):(e=l.last,e!==null?e.sibling=d:n.child=d,l.last=d)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=Fe(),e.sibling=null,s=Ft.current,te(Ft,u?s&1|2:s&1),Xe&&es(n,l.treeForkCount),e):(Mt(n),null);case 22:case 23:return ii(n),Gc(),l=n.memoizedState!==null,e!==null?e.memoizedState!==null!==l&&(n.flags|=8192):l&&(n.flags|=8192),l?(s&536870912)!==0&&(n.flags&128)===0&&(Mt(n),n.subtreeFlags&6&&(n.flags|=8192)):Mt(n),s=n.updateQueue,s!==null&&ur(n,s.retryQueue),s=null,e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),l=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(l=n.memoizedState.cachePool.pool),l!==s&&(n.flags|=2048),e!==null&&Y(da),null;case 24:return s=null,e!==null&&(s=e.memoizedState.cache),n.memoizedState.cache!==s&&(n.flags|=2048),ns(Qt),Mt(n),null;case 25:return null;case 30:return null}throw Error(o(156,n.tag))}function N0(e,n){switch(Lc(n),n.tag){case 1:return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 3:return ns(Qt),qe(),e=n.flags,(e&65536)!==0&&(e&128)===0?(n.flags=e&-65537|128,n):null;case 26:case 27:case 5:return ze(n),null;case 31:if(n.memoizedState!==null){if(ii(n),n.alternate===null)throw Error(o(340));ra()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 13:if(ii(n),e=n.memoizedState,e!==null&&e.dehydrated!==null){if(n.alternate===null)throw Error(o(340));ra()}return e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 19:return Y(Ft),null;case 4:return qe(),null;case 10:return ns(n.type),null;case 22:case 23:return ii(n),Gc(),e!==null&&Y(da),e=n.flags,e&65536?(n.flags=e&-65537|128,n):null;case 24:return ns(Qt),null;case 25:return null;default:return null}}function rp(e,n){switch(Lc(n),n.tag){case 3:ns(Qt),qe();break;case 26:case 27:case 5:ze(n);break;case 4:qe();break;case 31:n.memoizedState!==null&&ii(n);break;case 13:ii(n);break;case 19:Y(Ft);break;case 10:ns(n.type);break;case 22:case 23:ii(n),Gc(),e!==null&&Y(da);break;case 24:ns(Qt)}}function Vo(e,n){try{var s=n.updateQueue,l=s!==null?s.lastEffect:null;if(l!==null){var u=l.next;s=u;do{if((s.tag&e)===e){l=void 0;var d=s.create,S=s.inst;l=d(),S.destroy=l}s=s.next}while(s!==u)}}catch(T){dt(n,n.return,T)}}function Ns(e,n,s){try{var l=n.updateQueue,u=l!==null?l.lastEffect:null;if(u!==null){var d=u.next;l=d;do{if((l.tag&e)===e){var S=l.inst,T=S.destroy;if(T!==void 0){S.destroy=void 0,u=n;var N=s,q=T;try{q()}catch(K){dt(u,N,K)}}}l=l.next}while(l!==d)}}catch(K){dt(n,n.return,K)}}function cp(e){var n=e.updateQueue;if(n!==null){var s=e.stateNode;try{Zf(n,s)}catch(l){dt(e,e.return,l)}}}function up(e,n,s){s.props=ga(e.type,e.memoizedProps),s.state=e.memoizedState;try{s.componentWillUnmount()}catch(l){dt(e,n,l)}}function $o(e,n){try{var s=e.ref;if(s!==null){switch(e.tag){case 26:case 27:case 5:var l=e.stateNode;break;case 30:l=e.stateNode;break;default:l=e.stateNode}typeof s=="function"?e.refCleanup=s(l):s.current=l}}catch(u){dt(e,n,u)}}function Vi(e,n){var s=e.ref,l=e.refCleanup;if(s!==null)if(typeof l=="function")try{l()}catch(u){dt(e,n,u)}finally{e.refCleanup=null,e=e.alternate,e!=null&&(e.refCleanup=null)}else if(typeof s=="function")try{s(null)}catch(u){dt(e,n,u)}else s.current=null}function dp(e){var n=e.type,s=e.memoizedProps,l=e.stateNode;try{e:switch(n){case"button":case"input":case"select":case"textarea":s.autoFocus&&l.focus();break e;case"img":s.src?l.src=s.src:s.srcSet&&(l.srcset=s.srcSet)}}catch(u){dt(e,e.return,u)}}function wu(e,n,s){try{var l=e.stateNode;J0(l,e.type,s,n),l[be]=n}catch(u){dt(e,e.return,u)}}function fp(e){return e.tag===5||e.tag===3||e.tag===26||e.tag===27&&Ds(e.type)||e.tag===4}function Mu(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||fp(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.tag===27&&Ds(e.type)||e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Ou(e,n,s){var l=e.tag;if(l===5||l===6)e=e.stateNode,n?(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s).insertBefore(e,n):(n=s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,n.appendChild(e),s=s._reactRootContainer,s!=null||n.onclick!==null||(n.onclick=Oi));else if(l!==4&&(l===27&&Ds(e.type)&&(s=e.stateNode,n=null),e=e.child,e!==null))for(Ou(e,n,s),e=e.sibling;e!==null;)Ou(e,n,s),e=e.sibling}function dr(e,n,s){var l=e.tag;if(l===5||l===6)e=e.stateNode,n?s.insertBefore(e,n):s.appendChild(e);else if(l!==4&&(l===27&&Ds(e.type)&&(s=e.stateNode),e=e.child,e!==null))for(dr(e,n,s),e=e.sibling;e!==null;)dr(e,n,s),e=e.sibling}function mp(e){var n=e.stateNode,s=e.memoizedProps;try{for(var l=e.type,u=n.attributes;u.length;)n.removeAttributeNode(u[0]);_n(n,l,s),n[we]=e,n[be]=s}catch(d){dt(e,e.return,d)}}var ls=!1,en=!1,Cu=!1,pp=typeof WeakSet=="function"?WeakSet:Set,hn=null;function R0(e,n){if(e=e.containerInfo,Xu=kr,e=wf(e),Ac(e)){if("selectionStart"in e)var s={start:e.selectionStart,end:e.selectionEnd};else e:{s=(s=e.ownerDocument)&&s.defaultView||window;var l=s.getSelection&&s.getSelection();if(l&&l.rangeCount!==0){s=l.anchorNode;var u=l.anchorOffset,d=l.focusNode;l=l.focusOffset;try{s.nodeType,d.nodeType}catch{s=null;break e}var S=0,T=-1,N=-1,q=0,K=0,Q=e,z=null;t:for(;;){for(var $;Q!==s||u!==0&&Q.nodeType!==3||(T=S+u),Q!==d||l!==0&&Q.nodeType!==3||(N=S+l),Q.nodeType===3&&(S+=Q.nodeValue.length),($=Q.firstChild)!==null;)z=Q,Q=$;for(;;){if(Q===e)break t;if(z===s&&++q===u&&(T=S),z===d&&++K===l&&(N=S),($=Q.nextSibling)!==null)break;Q=z,z=Q.parentNode}Q=$}s=T===-1||N===-1?null:{start:T,end:N}}else s=null}s=s||{start:0,end:0}}else s=null;for(Qu={focusedElem:e,selectionRange:s},kr=!1,hn=n;hn!==null;)if(n=hn,e=n.child,(n.subtreeFlags&1028)!==0&&e!==null)e.return=n,hn=e;else for(;hn!==null;){switch(n=hn,d=n.alternate,e=n.flags,n.tag){case 0:if((e&4)!==0&&(e=n.updateQueue,e=e!==null?e.events:null,e!==null))for(s=0;s<e.length;s++)u=e[s],u.ref.impl=u.nextImpl;break;case 11:case 15:break;case 1:if((e&1024)!==0&&d!==null){e=void 0,s=n,u=d.memoizedProps,d=d.memoizedState,l=s.stateNode;try{var ye=ga(s.type,u);e=l.getSnapshotBeforeUpdate(ye,d),l.__reactInternalSnapshotBeforeUpdate=e}catch(Me){dt(s,s.return,Me)}}break;case 3:if((e&1024)!==0){if(e=n.stateNode.containerInfo,s=e.nodeType,s===9)ed(e);else if(s===1)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":ed(e);break;default:e.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((e&1024)!==0)throw Error(o(163))}if(e=n.sibling,e!==null){e.return=n.return,hn=e;break}hn=n.return}}function hp(e,n,s){var l=s.flags;switch(s.tag){case 0:case 11:case 15:cs(e,s),l&4&&Vo(5,s);break;case 1:if(cs(e,s),l&4)if(e=s.stateNode,n===null)try{e.componentDidMount()}catch(S){dt(s,s.return,S)}else{var u=ga(s.type,n.memoizedProps);n=n.memoizedState;try{e.componentDidUpdate(u,n,e.__reactInternalSnapshotBeforeUpdate)}catch(S){dt(s,s.return,S)}}l&64&&cp(s),l&512&&$o(s,s.return);break;case 3:if(cs(e,s),l&64&&(e=s.updateQueue,e!==null)){if(n=null,s.child!==null)switch(s.child.tag){case 27:case 5:n=s.child.stateNode;break;case 1:n=s.child.stateNode}try{Zf(e,n)}catch(S){dt(s,s.return,S)}}break;case 27:n===null&&l&4&&mp(s);case 26:case 5:cs(e,s),n===null&&l&4&&dp(s),l&512&&$o(s,s.return);break;case 12:cs(e,s);break;case 31:cs(e,s),l&4&&bp(e,s);break;case 13:cs(e,s),l&4&&Sp(e,s),l&64&&(e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null&&(s=U0.bind(null,s),ob(e,s))));break;case 22:if(l=s.memoizedState!==null||ls,!l){n=n!==null&&n.memoizedState!==null||en,u=ls;var d=en;ls=l,(en=n)&&!d?us(e,s,(s.subtreeFlags&8772)!==0):cs(e,s),ls=u,en=d}break;case 30:break;default:cs(e,s)}}function gp(e){var n=e.alternate;n!==null&&(e.alternate=null,gp(n)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(n=e.stateNode,n!==null&&kn(n)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Rt=null,$n=!1;function rs(e,n,s){for(s=s.child;s!==null;)yp(e,n,s),s=s.sibling}function yp(e,n,s){if(Je&&typeof Je.onCommitFiberUnmount=="function")try{Je.onCommitFiberUnmount(Yt,s)}catch{}switch(s.tag){case 26:en||Vi(s,n),rs(e,n,s),s.memoizedState?s.memoizedState.count--:s.stateNode&&(s=s.stateNode,s.parentNode.removeChild(s));break;case 27:en||Vi(s,n);var l=Rt,u=$n;Ds(s.type)&&(Rt=s.stateNode,$n=!1),rs(e,n,s),Zo(s.stateNode),Rt=l,$n=u;break;case 5:en||Vi(s,n);case 6:if(l=Rt,u=$n,Rt=null,rs(e,n,s),Rt=l,$n=u,Rt!==null)if($n)try{(Rt.nodeType===9?Rt.body:Rt.nodeName==="HTML"?Rt.ownerDocument.body:Rt).removeChild(s.stateNode)}catch(d){dt(s,n,d)}else try{Rt.removeChild(s.stateNode)}catch(d){dt(s,n,d)}break;case 18:Rt!==null&&($n?(e=Rt,ch(e.nodeType===9?e.body:e.nodeName==="HTML"?e.ownerDocument.body:e,s.stateNode),ro(e)):ch(Rt,s.stateNode));break;case 4:l=Rt,u=$n,Rt=s.stateNode.containerInfo,$n=!0,rs(e,n,s),Rt=l,$n=u;break;case 0:case 11:case 14:case 15:Ns(2,s,n),en||Ns(4,s,n),rs(e,n,s);break;case 1:en||(Vi(s,n),l=s.stateNode,typeof l.componentWillUnmount=="function"&&up(s,n,l)),rs(e,n,s);break;case 21:rs(e,n,s);break;case 22:en=(l=en)||s.memoizedState!==null,rs(e,n,s),en=l;break;default:rs(e,n,s)}}function bp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null))){e=e.dehydrated;try{ro(e)}catch(s){dt(n,n.return,s)}}}function Sp(e,n){if(n.memoizedState===null&&(e=n.alternate,e!==null&&(e=e.memoizedState,e!==null&&(e=e.dehydrated,e!==null))))try{ro(e)}catch(s){dt(n,n.return,s)}}function k0(e){switch(e.tag){case 31:case 13:case 19:var n=e.stateNode;return n===null&&(n=e.stateNode=new pp),n;case 22:return e=e.stateNode,n=e._retryCache,n===null&&(n=e._retryCache=new pp),n;default:throw Error(o(435,e.tag))}}function fr(e,n){var s=k0(e);n.forEach(function(l){if(!s.has(l)){s.add(l);var u=q0.bind(null,e,l);l.then(u,u)}})}function Yn(e,n){var s=n.deletions;if(s!==null)for(var l=0;l<s.length;l++){var u=s[l],d=e,S=n,T=S;e:for(;T!==null;){switch(T.tag){case 27:if(Ds(T.type)){Rt=T.stateNode,$n=!1;break e}break;case 5:Rt=T.stateNode,$n=!1;break e;case 3:case 4:Rt=T.stateNode.containerInfo,$n=!0;break e}T=T.return}if(Rt===null)throw Error(o(160));yp(d,S,u),Rt=null,$n=!1,d=u.alternate,d!==null&&(d.return=null),u.return=null}if(n.subtreeFlags&13886)for(n=n.child;n!==null;)vp(n,e),n=n.sibling}var Ri=null;function vp(e,n){var s=e.alternate,l=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:Yn(n,e),Kn(e),l&4&&(Ns(3,e,e.return),Vo(3,e),Ns(5,e,e.return));break;case 1:Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),l&64&&ls&&(e=e.updateQueue,e!==null&&(l=e.callbacks,l!==null&&(s=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=s===null?l:s.concat(l))));break;case 26:var u=Ri;if(Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),l&4){var d=s!==null?s.memoizedState:null;if(l=e.memoizedState,s===null)if(l===null)if(e.stateNode===null){e:{l=e.type,s=e.memoizedProps,u=u.ownerDocument||u;t:switch(l){case"title":d=u.getElementsByTagName("title")[0],(!d||d[Ct]||d[we]||d.namespaceURI==="http://www.w3.org/2000/svg"||d.hasAttribute("itemprop"))&&(d=u.createElement(l),u.head.insertBefore(d,u.querySelector("head > title"))),_n(d,l,s),d[we]=e,Nt(d),l=d;break e;case"link":var S=vh("link","href",u).get(l+(s.href||""));if(S){for(var T=0;T<S.length;T++)if(d=S[T],d.getAttribute("href")===(s.href==null||s.href===""?null:s.href)&&d.getAttribute("rel")===(s.rel==null?null:s.rel)&&d.getAttribute("title")===(s.title==null?null:s.title)&&d.getAttribute("crossorigin")===(s.crossOrigin==null?null:s.crossOrigin)){S.splice(T,1);break t}}d=u.createElement(l),_n(d,l,s),u.head.appendChild(d);break;case"meta":if(S=vh("meta","content",u).get(l+(s.content||""))){for(T=0;T<S.length;T++)if(d=S[T],d.getAttribute("content")===(s.content==null?null:""+s.content)&&d.getAttribute("name")===(s.name==null?null:s.name)&&d.getAttribute("property")===(s.property==null?null:s.property)&&d.getAttribute("http-equiv")===(s.httpEquiv==null?null:s.httpEquiv)&&d.getAttribute("charset")===(s.charSet==null?null:s.charSet)){S.splice(T,1);break t}}d=u.createElement(l),_n(d,l,s),u.head.appendChild(d);break;default:throw Error(o(468,l))}d[we]=e,Nt(d),l=d}e.stateNode=l}else xh(u,e.type,e.stateNode);else e.stateNode=Sh(u,l,e.memoizedProps);else d!==l?(d===null?s.stateNode!==null&&(s=s.stateNode,s.parentNode.removeChild(s)):d.count--,l===null?xh(u,e.type,e.stateNode):Sh(u,l,e.memoizedProps)):l===null&&e.stateNode!==null&&wu(e,e.memoizedProps,s.memoizedProps)}break;case 27:Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),s!==null&&l&4&&wu(e,e.memoizedProps,s.memoizedProps);break;case 5:if(Yn(n,e),Kn(e),l&512&&(en||s===null||Vi(s,s.return)),e.flags&32){u=e.stateNode;try{fn(u,"")}catch(ye){dt(e,e.return,ye)}}l&4&&e.stateNode!=null&&(u=e.memoizedProps,wu(e,u,s!==null?s.memoizedProps:u)),l&1024&&(Cu=!0);break;case 6:if(Yn(n,e),Kn(e),l&4){if(e.stateNode===null)throw Error(o(162));l=e.memoizedProps,s=e.stateNode;try{s.nodeValue=l}catch(ye){dt(e,e.return,ye)}}break;case 3:if(Or=null,u=Ri,Ri=wr(n.containerInfo),Yn(n,e),Ri=u,Kn(e),l&4&&s!==null&&s.memoizedState.isDehydrated)try{ro(n.containerInfo)}catch(ye){dt(e,e.return,ye)}Cu&&(Cu=!1,xp(e));break;case 4:l=Ri,Ri=wr(e.stateNode.containerInfo),Yn(n,e),Kn(e),Ri=l;break;case 12:Yn(n,e),Kn(e);break;case 31:Yn(n,e),Kn(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,fr(e,l)));break;case 13:Yn(n,e),Kn(e),e.child.flags&8192&&e.memoizedState!==null!=(s!==null&&s.memoizedState!==null)&&(pr=Fe()),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,fr(e,l)));break;case 22:u=e.memoizedState!==null;var N=s!==null&&s.memoizedState!==null,q=ls,K=en;if(ls=q||u,en=K||N,Yn(n,e),en=K,ls=q,Kn(e),l&8192)e:for(n=e.stateNode,n._visibility=u?n._visibility&-2:n._visibility|1,u&&(s===null||N||ls||en||ya(e)),s=null,n=e;;){if(n.tag===5||n.tag===26){if(s===null){N=s=n;try{if(d=N.stateNode,u)S=d.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{T=N.stateNode;var Q=N.memoizedProps.style,z=Q!=null&&Q.hasOwnProperty("display")?Q.display:null;T.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(ye){dt(N,N.return,ye)}}}else if(n.tag===6){if(s===null){N=n;try{N.stateNode.nodeValue=u?"":N.memoizedProps}catch(ye){dt(N,N.return,ye)}}}else if(n.tag===18){if(s===null){N=n;try{var $=N.stateNode;u?uh($,!0):uh(N.stateNode,!1)}catch(ye){dt(N,N.return,ye)}}}else if((n.tag!==22&&n.tag!==23||n.memoizedState===null||n===e)&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;s===n&&(s=null),n=n.return}s===n&&(s=null),n.sibling.return=n.return,n=n.sibling}l&4&&(l=e.updateQueue,l!==null&&(s=l.retryQueue,s!==null&&(l.retryQueue=null,fr(e,s))));break;case 19:Yn(n,e),Kn(e),l&4&&(l=e.updateQueue,l!==null&&(e.updateQueue=null,fr(e,l)));break;case 30:break;case 21:break;default:Yn(n,e),Kn(e)}}function Kn(e){var n=e.flags;if(n&2){try{for(var s,l=e.return;l!==null;){if(fp(l)){s=l;break}l=l.return}if(s==null)throw Error(o(160));switch(s.tag){case 27:var u=s.stateNode,d=Mu(e);dr(e,d,u);break;case 5:var S=s.stateNode;s.flags&32&&(fn(S,""),s.flags&=-33);var T=Mu(e);dr(e,T,S);break;case 3:case 4:var N=s.stateNode.containerInfo,q=Mu(e);Ou(e,q,N);break;default:throw Error(o(161))}}catch(K){dt(e,e.return,K)}e.flags&=-3}n&4096&&(e.flags&=-4097)}function xp(e){if(e.subtreeFlags&1024)for(e=e.child;e!==null;){var n=e;xp(n),n.tag===5&&n.flags&1024&&n.stateNode.reset(),e=e.sibling}}function cs(e,n){if(n.subtreeFlags&8772)for(n=n.child;n!==null;)hp(e,n.alternate,n),n=n.sibling}function ya(e){for(e=e.child;e!==null;){var n=e;switch(n.tag){case 0:case 11:case 14:case 15:Ns(4,n,n.return),ya(n);break;case 1:Vi(n,n.return);var s=n.stateNode;typeof s.componentWillUnmount=="function"&&up(n,n.return,s),ya(n);break;case 27:Zo(n.stateNode);case 26:case 5:Vi(n,n.return),ya(n);break;case 22:n.memoizedState===null&&ya(n);break;case 30:ya(n);break;default:ya(n)}e=e.sibling}}function us(e,n,s){for(s=s&&(n.subtreeFlags&8772)!==0,n=n.child;n!==null;){var l=n.alternate,u=e,d=n,S=d.flags;switch(d.tag){case 0:case 11:case 15:us(u,d,s),Vo(4,d);break;case 1:if(us(u,d,s),l=d,u=l.stateNode,typeof u.componentDidMount=="function")try{u.componentDidMount()}catch(q){dt(l,l.return,q)}if(l=d,u=l.updateQueue,u!==null){var T=l.stateNode;try{var N=u.shared.hiddenCallbacks;if(N!==null)for(u.shared.hiddenCallbacks=null,u=0;u<N.length;u++)Jf(N[u],T)}catch(q){dt(l,l.return,q)}}s&&S&64&&cp(d),$o(d,d.return);break;case 27:mp(d);case 26:case 5:us(u,d,s),s&&l===null&&S&4&&dp(d),$o(d,d.return);break;case 12:us(u,d,s);break;case 31:us(u,d,s),s&&S&4&&bp(u,d);break;case 13:us(u,d,s),s&&S&4&&Sp(u,d);break;case 22:d.memoizedState===null&&us(u,d,s),$o(d,d.return);break;case 30:break;default:us(u,d,s)}n=n.sibling}}function Nu(e,n){var s=null;e!==null&&e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),e=null,n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(e=n.memoizedState.cachePool.pool),e!==s&&(e!=null&&e.refCount++,s!=null&&No(s))}function Ru(e,n){e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&No(e))}function ki(e,n,s,l){if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Ap(e,n,s,l),n=n.sibling}function Ap(e,n,s,l){var u=n.flags;switch(n.tag){case 0:case 11:case 15:ki(e,n,s,l),u&2048&&Vo(9,n);break;case 1:ki(e,n,s,l);break;case 3:ki(e,n,s,l),u&2048&&(e=null,n.alternate!==null&&(e=n.alternate.memoizedState.cache),n=n.memoizedState.cache,n!==e&&(n.refCount++,e!=null&&No(e)));break;case 12:if(u&2048){ki(e,n,s,l),e=n.stateNode;try{var d=n.memoizedProps,S=d.id,T=d.onPostCommit;typeof T=="function"&&T(S,n.alternate===null?"mount":"update",e.passiveEffectDuration,-0)}catch(N){dt(n,n.return,N)}}else ki(e,n,s,l);break;case 31:ki(e,n,s,l);break;case 13:ki(e,n,s,l);break;case 23:break;case 22:d=n.stateNode,S=n.alternate,n.memoizedState!==null?d._visibility&2?ki(e,n,s,l):Yo(e,n):d._visibility&2?ki(e,n,s,l):(d._visibility|=2,Qa(e,n,s,l,(n.subtreeFlags&10256)!==0||!1)),u&2048&&Nu(S,n);break;case 24:ki(e,n,s,l),u&2048&&Ru(n.alternate,n);break;default:ki(e,n,s,l)}}function Qa(e,n,s,l,u){for(u=u&&((n.subtreeFlags&10256)!==0||!1),n=n.child;n!==null;){var d=e,S=n,T=s,N=l,q=S.flags;switch(S.tag){case 0:case 11:case 15:Qa(d,S,T,N,u),Vo(8,S);break;case 23:break;case 22:var K=S.stateNode;S.memoizedState!==null?K._visibility&2?Qa(d,S,T,N,u):Yo(d,S):(K._visibility|=2,Qa(d,S,T,N,u)),u&&q&2048&&Nu(S.alternate,S);break;case 24:Qa(d,S,T,N,u),u&&q&2048&&Ru(S.alternate,S);break;default:Qa(d,S,T,N,u)}n=n.sibling}}function Yo(e,n){if(n.subtreeFlags&10256)for(n=n.child;n!==null;){var s=e,l=n,u=l.flags;switch(l.tag){case 22:Yo(s,l),u&2048&&Nu(l.alternate,l);break;case 24:Yo(s,l),u&2048&&Ru(l.alternate,l);break;default:Yo(s,l)}n=n.sibling}}var Ko=8192;function Ja(e,n,s){if(e.subtreeFlags&Ko)for(e=e.child;e!==null;)Tp(e,n,s),e=e.sibling}function Tp(e,n,s){switch(e.tag){case 26:Ja(e,n,s),e.flags&Ko&&e.memoizedState!==null&&bb(s,Ri,e.memoizedState,e.memoizedProps);break;case 5:Ja(e,n,s);break;case 3:case 4:var l=Ri;Ri=wr(e.stateNode.containerInfo),Ja(e,n,s),Ri=l;break;case 22:e.memoizedState===null&&(l=e.alternate,l!==null&&l.memoizedState!==null?(l=Ko,Ko=16777216,Ja(e,n,s),Ko=l):Ja(e,n,s));break;default:Ja(e,n,s)}}function Ep(e){var n=e.alternate;if(n!==null&&(e=n.child,e!==null)){n.child=null;do n=e.sibling,e.sibling=null,e=n;while(e!==null)}}function Fo(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var l=n[s];hn=l,wp(l,e)}Ep(e)}if(e.subtreeFlags&10256)for(e=e.child;e!==null;)_p(e),e=e.sibling}function _p(e){switch(e.tag){case 0:case 11:case 15:Fo(e),e.flags&2048&&Ns(9,e,e.return);break;case 3:Fo(e);break;case 12:Fo(e);break;case 22:var n=e.stateNode;e.memoizedState!==null&&n._visibility&2&&(e.return===null||e.return.tag!==13)?(n._visibility&=-3,mr(e)):Fo(e);break;default:Fo(e)}}function mr(e){var n=e.deletions;if((e.flags&16)!==0){if(n!==null)for(var s=0;s<n.length;s++){var l=n[s];hn=l,wp(l,e)}Ep(e)}for(e=e.child;e!==null;){switch(n=e,n.tag){case 0:case 11:case 15:Ns(8,n,n.return),mr(n);break;case 22:s=n.stateNode,s._visibility&2&&(s._visibility&=-3,mr(n));break;default:mr(n)}e=e.sibling}}function wp(e,n){for(;hn!==null;){var s=hn;switch(s.tag){case 0:case 11:case 15:Ns(8,s,n);break;case 23:case 22:if(s.memoizedState!==null&&s.memoizedState.cachePool!==null){var l=s.memoizedState.cachePool.pool;l!=null&&l.refCount++}break;case 24:No(s.memoizedState.cache)}if(l=s.child,l!==null)l.return=s,hn=l;else e:for(s=e;hn!==null;){l=hn;var u=l.sibling,d=l.return;if(gp(l),l===s){hn=null;break e}if(u!==null){u.return=d,hn=u;break e}hn=d}}}var L0={getCacheForType:function(e){var n=Tn(Qt),s=n.data.get(e);return s===void 0&&(s=e(),n.data.set(e,s)),s},cacheSignal:function(){return Tn(Qt).controller.signal}},B0=typeof WeakMap=="function"?WeakMap:Map,st=0,vt=null,Ye=null,Ge=0,ut=0,si=null,Rs=!1,Za=!1,ku=!1,ds=0,qt=0,ks=0,ba=0,Lu=0,ai=0,eo=0,Go=null,Fn=null,Bu=!1,pr=0,Mp=0,hr=1/0,gr=null,Ls=null,sn=0,Bs=null,to=null,fs=0,Iu=0,ju=null,Op=null,Wo=0,Du=null;function oi(){return(st&2)!==0&&Ge!==0?Ge&-Ge:V.T!==null?Vu():X()}function Cp(){if(ai===0)if((Ge&536870912)===0||Xe){var e=un;un<<=1,(un&3932160)===0&&(un=262144),ai=e}else ai=536870912;return e=ni.current,e!==null&&(e.flags|=32),ai}function Gn(e,n,s){(e===vt&&(ut===2||ut===9)||e.cancelPendingCommit!==null)&&(no(e,0),Is(e,Ge,ai,!1)),Kt(e,s),((st&2)===0||e!==vt)&&(e===vt&&((st&2)===0&&(ba|=s),qt===4&&Is(e,Ge,ai,!1)),$i(e))}function Np(e,n,s){if((st&6)!==0)throw Error(o(327));var l=!s&&(n&127)===0&&(n&e.expiredLanes)===0||Rn(e,n),u=l?D0(e,n):Pu(e,n,!0),d=l;do{if(u===0){Za&&!l&&Is(e,n,0,!1);break}else{if(s=e.current.alternate,d&&!I0(s)){u=Pu(e,n,!1),d=!1;continue}if(u===2){if(d=n,e.errorRecoveryDisabledLanes&d)var S=0;else S=e.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){n=S;e:{var T=e;u=Go;var N=T.current.memoizedState.isDehydrated;if(N&&(no(T,S).flags|=256),S=Pu(T,S,!1),S!==2){if(ku&&!N){T.errorRecoveryDisabledLanes|=d,ba|=d,u=4;break e}d=Fn,Fn=u,d!==null&&(Fn===null?Fn=d:Fn.push.apply(Fn,d))}u=S}if(d=!1,u!==2)continue}}if(u===1){no(e,0),Is(e,n,0,!0);break}e:{switch(l=e,d=u,d){case 0:case 1:throw Error(o(345));case 4:if((n&4194048)!==n)break;case 6:Is(l,n,ai,!Rs);break e;case 2:Fn=null;break;case 3:case 5:break;default:throw Error(o(329))}if((n&62914560)===n&&(u=pr+300-Fe(),10<u)){if(Is(l,n,ai,!Rs),Xt(l,0,!0)!==0)break e;fs=n,l.timeoutHandle=lh(Rp.bind(null,l,s,Fn,gr,Bu,n,ai,ba,eo,Rs,d,"Throttled",-0,0),u);break e}Rp(l,s,Fn,gr,Bu,n,ai,ba,eo,Rs,d,null,-0,0)}}break}while(!0);$i(e)}function Rp(e,n,s,l,u,d,S,T,N,q,K,Q,z,$){if(e.timeoutHandle=-1,Q=n.subtreeFlags,Q&8192||(Q&16785408)===16785408){Q={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Oi},Tp(n,d,Q);var ye=(d&62914560)===d?pr-Fe():(d&4194048)===d?Mp-Fe():0;if(ye=Sb(Q,ye),ye!==null){fs=d,e.cancelPendingCommit=ye(Pp.bind(null,e,n,d,s,l,u,S,T,N,K,Q,null,z,$)),Is(e,d,S,!q);return}}Pp(e,n,d,s,l,u,S,T,N)}function I0(e){for(var n=e;;){var s=n.tag;if((s===0||s===11||s===15)&&n.flags&16384&&(s=n.updateQueue,s!==null&&(s=s.stores,s!==null)))for(var l=0;l<s.length;l++){var u=s[l],d=u.getSnapshot;u=u.value;try{if(!ei(d(),u))return!1}catch{return!1}}if(s=n.child,n.subtreeFlags&16384&&s!==null)s.return=n,n=s;else{if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Is(e,n,s,l){n&=~Lu,n&=~ba,e.suspendedLanes|=n,e.pingedLanes&=~n,l&&(e.warmLanes|=n),l=e.expirationTimes;for(var u=n;0<u;){var d=31-Tt(u),S=1<<d;l[d]=-1,u&=~S}s!==0&&Hi(e,s,n)}function yr(){return(st&6)===0?(Xo(0),!1):!0}function Hu(){if(Ye!==null){if(ut===0)var e=Ye.return;else e=Ye,ts=ca=null,eu(e),Ka=null,ko=0,e=Ye;for(;e!==null;)rp(e.alternate,e),e=e.return;Ye=null}}function no(e,n){var s=e.timeoutHandle;s!==-1&&(e.timeoutHandle=-1,tb(s)),s=e.cancelPendingCommit,s!==null&&(e.cancelPendingCommit=null,s()),fs=0,Hu(),vt=e,Ye=s=Zi(e.current,null),Ge=n,ut=0,si=null,Rs=!1,Za=Rn(e,n),ku=!1,eo=ai=Lu=ba=ks=qt=0,Fn=Go=null,Bu=!1,(n&8)!==0&&(n|=n&32);var l=e.entangledLanes;if(l!==0)for(e=e.entanglements,l&=n;0<l;){var u=31-Tt(l),d=1<<u;n|=e[u],l&=~d}return ds=n,Hl(),s}function kp(e,n){je=null,V.H=Uo,n===Ya||n===Kl?(n=Gf(),ut=3):n===zc?(n=Gf(),ut=4):ut=n===gu?8:n!==null&&typeof n=="object"&&typeof n.then=="function"?6:1,si=n,Ye===null&&(qt=1,or(e,fi(n,e.current)))}function Lp(){var e=ni.current;return e===null?!0:(Ge&4194048)===Ge?gi===null:(Ge&62914560)===Ge||(Ge&536870912)!==0?e===gi:!1}function Bp(){var e=V.H;return V.H=Uo,e===null?Uo:e}function Ip(){var e=V.A;return V.A=L0,e}function br(){qt=4,Rs||(Ge&4194048)!==Ge&&ni.current!==null||(Za=!0),(ks&134217727)===0&&(ba&134217727)===0||vt===null||Is(vt,Ge,ai,!1)}function Pu(e,n,s){var l=st;st|=2;var u=Bp(),d=Ip();(vt!==e||Ge!==n)&&(gr=null,no(e,n)),n=!1;var S=qt;e:do try{if(ut!==0&&Ye!==null){var T=Ye,N=si;switch(ut){case 8:Hu(),S=6;break e;case 3:case 2:case 9:case 6:ni.current===null&&(n=!0);var q=ut;if(ut=0,si=null,io(e,T,N,q),s&&Za){S=0;break e}break;default:q=ut,ut=0,si=null,io(e,T,N,q)}}j0(),S=qt;break}catch(K){kp(e,K)}while(!0);return n&&e.shellSuspendCounter++,ts=ca=null,st=l,V.H=u,V.A=d,Ye===null&&(vt=null,Ge=0,Hl()),S}function j0(){for(;Ye!==null;)jp(Ye)}function D0(e,n){var s=st;st|=2;var l=Bp(),u=Ip();vt!==e||Ge!==n?(gr=null,hr=Fe()+500,no(e,n)):Za=Rn(e,n);e:do try{if(ut!==0&&Ye!==null){n=Ye;var d=si;t:switch(ut){case 1:ut=0,si=null,io(e,n,d,1);break;case 2:case 9:if(Kf(d)){ut=0,si=null,Dp(n);break}n=function(){ut!==2&&ut!==9||vt!==e||(ut=7),$i(e)},d.then(n,n);break e;case 3:ut=7;break e;case 4:ut=5;break e;case 7:Kf(d)?(ut=0,si=null,Dp(n)):(ut=0,si=null,io(e,n,d,7));break;case 5:var S=null;switch(Ye.tag){case 26:S=Ye.memoizedState;case 5:case 27:var T=Ye;if(S?Ah(S):T.stateNode.complete){ut=0,si=null;var N=T.sibling;if(N!==null)Ye=N;else{var q=T.return;q!==null?(Ye=q,Sr(q)):Ye=null}break t}}ut=0,si=null,io(e,n,d,5);break;case 6:ut=0,si=null,io(e,n,d,6);break;case 8:Hu(),qt=6;break e;default:throw Error(o(462))}}H0();break}catch(K){kp(e,K)}while(!0);return ts=ca=null,V.H=l,V.A=u,st=s,Ye!==null?0:(vt=null,Ge=0,Hl(),qt)}function H0(){for(;Ye!==null&&!Qn();)jp(Ye)}function jp(e){var n=op(e.alternate,e,ds);e.memoizedProps=e.pendingProps,n===null?Sr(e):Ye=n}function Dp(e){var n=e,s=n.alternate;switch(n.tag){case 15:case 0:n=ep(s,n,n.pendingProps,n.type,void 0,Ge);break;case 11:n=ep(s,n,n.pendingProps,n.type.render,n.ref,Ge);break;case 5:eu(n);default:rp(s,n),n=Ye=If(n,ds),n=op(s,n,ds)}e.memoizedProps=e.pendingProps,n===null?Sr(e):Ye=n}function io(e,n,s,l){ts=ca=null,eu(n),Ka=null,ko=0;var u=n.return;try{if(w0(e,u,n,s,Ge)){qt=1,or(e,fi(s,e.current)),Ye=null;return}}catch(d){if(u!==null)throw Ye=u,d;qt=1,or(e,fi(s,e.current)),Ye=null;return}n.flags&32768?(Xe||l===1?e=!0:Za||(Ge&536870912)!==0?e=!1:(Rs=e=!0,(l===2||l===9||l===3||l===6)&&(l=ni.current,l!==null&&l.tag===13&&(l.flags|=16384))),Hp(n,e)):Sr(n)}function Sr(e){var n=e;do{if((n.flags&32768)!==0){Hp(n,Rs);return}e=n.return;var s=C0(n.alternate,n,ds);if(s!==null){Ye=s;return}if(n=n.sibling,n!==null){Ye=n;return}Ye=n=e}while(n!==null);qt===0&&(qt=5)}function Hp(e,n){do{var s=N0(e.alternate,e);if(s!==null){s.flags&=32767,Ye=s;return}if(s=e.return,s!==null&&(s.flags|=32768,s.subtreeFlags=0,s.deletions=null),!n&&(e=e.sibling,e!==null)){Ye=e;return}Ye=e=s}while(e!==null);qt=6,Ye=null}function Pp(e,n,s,l,u,d,S,T,N){e.cancelPendingCommit=null;do vr();while(sn!==0);if((st&6)!==0)throw Error(o(327));if(n!==null){if(n===e.current)throw Error(o(177));if(d=n.lanes|n.childLanes,d|=Mc,Pn(e,s,d,S,T,N),e===vt&&(Ye=vt=null,Ge=0),to=n,Bs=e,fs=s,Iu=d,ju=u,Op=l,(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?(e.callbackNode=null,e.callbackPriority=0,z0(rn,function(){return $p(),null})):(e.callbackNode=null,e.callbackPriority=0),l=(n.flags&13878)!==0,(n.subtreeFlags&13878)!==0||l){l=V.T,V.T=null,u=ie.p,ie.p=2,S=st,st|=4;try{R0(e,n,s)}finally{st=S,ie.p=u,V.T=l}}sn=1,Up(),qp(),zp()}}function Up(){if(sn===1){sn=0;var e=Bs,n=to,s=(n.flags&13878)!==0;if((n.subtreeFlags&13878)!==0||s){s=V.T,V.T=null;var l=ie.p;ie.p=2;var u=st;st|=4;try{vp(n,e);var d=Qu,S=wf(e.containerInfo),T=d.focusedElem,N=d.selectionRange;if(S!==T&&T&&T.ownerDocument&&_f(T.ownerDocument.documentElement,T)){if(N!==null&&Ac(T)){var q=N.start,K=N.end;if(K===void 0&&(K=q),"selectionStart"in T)T.selectionStart=q,T.selectionEnd=Math.min(K,T.value.length);else{var Q=T.ownerDocument||document,z=Q&&Q.defaultView||window;if(z.getSelection){var $=z.getSelection(),ye=T.textContent.length,Me=Math.min(N.start,ye),yt=N.end===void 0?Me:Math.min(N.end,ye);!$.extend&&Me>yt&&(S=yt,yt=Me,Me=S);var D=Ef(T,Me),I=Ef(T,yt);if(D&&I&&($.rangeCount!==1||$.anchorNode!==D.node||$.anchorOffset!==D.offset||$.focusNode!==I.node||$.focusOffset!==I.offset)){var U=Q.createRange();U.setStart(D.node,D.offset),$.removeAllRanges(),Me>yt?($.addRange(U),$.extend(I.node,I.offset)):(U.setEnd(I.node,I.offset),$.addRange(U))}}}}for(Q=[],$=T;$=$.parentNode;)$.nodeType===1&&Q.push({element:$,left:$.scrollLeft,top:$.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<Q.length;T++){var G=Q[T];G.element.scrollLeft=G.left,G.element.scrollTop=G.top}}kr=!!Xu,Qu=Xu=null}finally{st=u,ie.p=l,V.T=s}}e.current=n,sn=2}}function qp(){if(sn===2){sn=0;var e=Bs,n=to,s=(n.flags&8772)!==0;if((n.subtreeFlags&8772)!==0||s){s=V.T,V.T=null;var l=ie.p;ie.p=2;var u=st;st|=4;try{hp(e,n.alternate,n)}finally{st=u,ie.p=l,V.T=s}}sn=3}}function zp(){if(sn===4||sn===3){sn=0,Dn();var e=Bs,n=to,s=fs,l=Op;(n.subtreeFlags&10256)!==0||(n.flags&10256)!==0?sn=5:(sn=0,to=Bs=null,Vp(e,e.pendingLanes));var u=e.pendingLanes;if(u===0&&(Ls=null),bs(s),n=n.stateNode,Je&&typeof Je.onCommitFiberRoot=="function")try{Je.onCommitFiberRoot(Yt,n,void 0,(n.current.flags&128)===128)}catch{}if(l!==null){n=V.T,u=ie.p,ie.p=2,V.T=null;try{for(var d=e.onRecoverableError,S=0;S<l.length;S++){var T=l[S];d(T.value,{componentStack:T.stack})}}finally{V.T=n,ie.p=u}}(fs&3)!==0&&vr(),$i(e),u=e.pendingLanes,(s&261930)!==0&&(u&42)!==0?e===Du?Wo++:(Wo=0,Du=e):Wo=0,Xo(0)}}function Vp(e,n){(e.pooledCacheLanes&=n)===0&&(n=e.pooledCache,n!=null&&(e.pooledCache=null,No(n)))}function vr(){return Up(),qp(),zp(),$p()}function $p(){if(sn!==5)return!1;var e=Bs,n=Iu;Iu=0;var s=bs(fs),l=V.T,u=ie.p;try{ie.p=32>s?32:s,V.T=null,s=ju,ju=null;var d=Bs,S=fs;if(sn=0,to=Bs=null,fs=0,(st&6)!==0)throw Error(o(331));var T=st;if(st|=4,_p(d.current),Ap(d,d.current,S,s),st=T,Xo(0,!1),Je&&typeof Je.onPostCommitFiberRoot=="function")try{Je.onPostCommitFiberRoot(Yt,d)}catch{}return!0}finally{ie.p=u,V.T=l,Vp(e,n)}}function Yp(e,n,s){n=fi(s,n),n=hu(e.stateNode,n,2),e=Ms(e,n,2),e!==null&&(Kt(e,2),$i(e))}function dt(e,n,s){if(e.tag===3)Yp(e,e,s);else for(;n!==null;){if(n.tag===3){Yp(n,e,s);break}else if(n.tag===1){var l=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Ls===null||!Ls.has(l))){e=fi(s,e),s=Km(2),l=Ms(n,s,2),l!==null&&(Fm(s,l,n,e),Kt(l,2),$i(l));break}}n=n.return}}function Uu(e,n,s){var l=e.pingCache;if(l===null){l=e.pingCache=new B0;var u=new Set;l.set(n,u)}else u=l.get(n),u===void 0&&(u=new Set,l.set(n,u));u.has(s)||(ku=!0,u.add(s),e=P0.bind(null,e,n,s),n.then(e,e))}function P0(e,n,s){var l=e.pingCache;l!==null&&l.delete(n),e.pingedLanes|=e.suspendedLanes&s,e.warmLanes&=~s,vt===e&&(Ge&s)===s&&(qt===4||qt===3&&(Ge&62914560)===Ge&&300>Fe()-pr?(st&2)===0&&no(e,0):Lu|=s,eo===Ge&&(eo=0)),$i(e)}function Kp(e,n){n===0&&(n=ci()),e=oa(e,n),e!==null&&(Kt(e,n),$i(e))}function U0(e){var n=e.memoizedState,s=0;n!==null&&(s=n.retryLane),Kp(e,s)}function q0(e,n){var s=0;switch(e.tag){case 31:case 13:var l=e.stateNode,u=e.memoizedState;u!==null&&(s=u.retryLane);break;case 19:l=e.stateNode;break;case 22:l=e.stateNode._retryCache;break;default:throw Error(o(314))}l!==null&&l.delete(n),Kp(e,s)}function z0(e,n){return yn(e,n)}var xr=null,so=null,qu=!1,Ar=!1,zu=!1,js=0;function $i(e){e!==so&&e.next===null&&(so===null?xr=so=e:so=so.next=e),Ar=!0,qu||(qu=!0,$0())}function Xo(e,n){if(!zu&&Ar){zu=!0;do for(var s=!1,l=xr;l!==null;){if(e!==0){var u=l.pendingLanes;if(u===0)var d=0;else{var S=l.suspendedLanes,T=l.pingedLanes;d=(1<<31-Tt(42|e)+1)-1,d&=u&~(S&~T),d=d&201326741?d&201326741|1:d?d|2:0}d!==0&&(s=!0,Xp(l,d))}else d=Ge,d=Xt(l,l===vt?d:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),(d&3)===0||Rn(l,d)||(s=!0,Xp(l,d));l=l.next}while(s);zu=!1}}function V0(){Fp()}function Fp(){Ar=qu=!1;var e=0;js!==0&&eb()&&(e=js);for(var n=Fe(),s=null,l=xr;l!==null;){var u=l.next,d=Gp(l,n);d===0?(l.next=null,s===null?xr=u:s.next=u,u===null&&(so=s)):(s=l,(e!==0||(d&3)!==0)&&(Ar=!0)),l=u}sn!==0&&sn!==5||Xo(e),js!==0&&(js=0)}function Gp(e,n){for(var s=e.suspendedLanes,l=e.pingedLanes,u=e.expirationTimes,d=e.pendingLanes&-62914561;0<d;){var S=31-Tt(d),T=1<<S,N=u[S];N===-1?((T&s)===0||(T&l)!==0)&&(u[S]=Di(T,n)):N<=n&&(e.expiredLanes|=T),d&=~T}if(n=vt,s=Ge,s=Xt(e,e===n?s:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l=e.callbackNode,s===0||e===n&&(ut===2||ut===9)||e.cancelPendingCommit!==null)return l!==null&&l!==null&&Ti(l),e.callbackNode=null,e.callbackPriority=0;if((s&3)===0||Rn(e,s)){if(n=s&-s,n===e.callbackPriority)return n;switch(l!==null&&Ti(l),bs(s)){case 2:case 8:s=bn;break;case 32:s=rn;break;case 268435456:s=$t;break;default:s=rn}return l=Wp.bind(null,e),s=yn(s,l),e.callbackPriority=n,e.callbackNode=s,n}return l!==null&&l!==null&&Ti(l),e.callbackPriority=2,e.callbackNode=null,2}function Wp(e,n){if(sn!==0&&sn!==5)return e.callbackNode=null,e.callbackPriority=0,null;var s=e.callbackNode;if(vr()&&e.callbackNode!==s)return null;var l=Ge;return l=Xt(e,e===vt?l:0,e.cancelPendingCommit!==null||e.timeoutHandle!==-1),l===0?null:(Np(e,l,n),Gp(e,Fe()),e.callbackNode!=null&&e.callbackNode===s?Wp.bind(null,e):null)}function Xp(e,n){if(vr())return null;Np(e,n,!0)}function $0(){nb(function(){(st&6)!==0?yn(jt,V0):Fp()})}function Vu(){if(js===0){var e=Va;e===0&&(e=Mn,Mn<<=1,(Mn&261888)===0&&(Mn=256)),js=e}return js}function Qp(e){return e==null||typeof e=="symbol"||typeof e=="boolean"?null:typeof e=="function"?e:Na(""+e)}function Jp(e,n){var s=n.ownerDocument.createElement("input");return s.name=n.name,s.value=n.value,e.id&&s.setAttribute("form",e.id),n.parentNode.insertBefore(s,n),e=new FormData(e),s.parentNode.removeChild(s),e}function Y0(e,n,s,l,u){if(n==="submit"&&s&&s.stateNode===u){var d=Qp((u[be]||null).action),S=l.submitter;S&&(n=(n=S[be]||null)?Qp(n.formAction):S.getAttribute("formAction"),n!==null&&(d=n,S=null));var T=new Bl("action","action",null,l,u);e.push({event:T,listeners:[{instance:null,listener:function(){if(l.defaultPrevented){if(js!==0){var N=S?Jp(u,S):new FormData(u);cu(s,{pending:!0,data:N,method:u.method,action:d},null,N)}}else typeof d=="function"&&(T.preventDefault(),N=S?Jp(u,S):new FormData(u),cu(s,{pending:!0,data:N,method:u.method,action:d},d,N))},currentTarget:u}]})}}for(var $u=0;$u<wc.length;$u++){var Yu=wc[$u],K0=Yu.toLowerCase(),F0=Yu[0].toUpperCase()+Yu.slice(1);Ni(K0,"on"+F0)}Ni(Cf,"onAnimationEnd"),Ni(Nf,"onAnimationIteration"),Ni(Rf,"onAnimationStart"),Ni("dblclick","onDoubleClick"),Ni("focusin","onFocus"),Ni("focusout","onBlur"),Ni(c0,"onTransitionRun"),Ni(u0,"onTransitionStart"),Ni(d0,"onTransitionCancel"),Ni(kf,"onTransitionEnd"),Pi("onMouseEnter",["mouseout","mouseover"]),Pi("onMouseLeave",["mouseout","mouseover"]),Pi("onPointerEnter",["pointerout","pointerover"]),Pi("onPointerLeave",["pointerout","pointerover"]),Wi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G0=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qo));function Zp(e,n){n=(n&4)!==0;for(var s=0;s<e.length;s++){var l=e[s],u=l.event;l=l.listeners;e:{var d=void 0;if(n)for(var S=l.length-1;0<=S;S--){var T=l[S],N=T.instance,q=T.currentTarget;if(T=T.listener,N!==d&&u.isPropagationStopped())break e;d=T,u.currentTarget=q;try{d(u)}catch(K){Dl(K)}u.currentTarget=null,d=N}else for(S=0;S<l.length;S++){if(T=l[S],N=T.instance,q=T.currentTarget,T=T.listener,N!==d&&u.isPropagationStopped())break e;d=T,u.currentTarget=q;try{d(u)}catch(K){Dl(K)}u.currentTarget=null,d=N}}}}function Ke(e,n){var s=n[ct];s===void 0&&(s=n[ct]=new Set);var l=e+"__bubble";s.has(l)||(eh(n,e,2,!1),s.add(l))}function Ku(e,n,s){var l=0;n&&(l|=4),eh(s,e,l,n)}var Tr="_reactListening"+Math.random().toString(36).slice(2);function Fu(e){if(!e[Tr]){e[Tr]=!0,yo.forEach(function(s){s!=="selectionchange"&&(G0.has(s)||Ku(s,!1,e),Ku(s,!0,e))});var n=e.nodeType===9?e:e.ownerDocument;n===null||n[Tr]||(n[Tr]=!0,Ku("selectionchange",!1,n))}}function eh(e,n,s,l){switch(Ch(n)){case 2:var u=Ab;break;case 8:u=Tb;break;default:u=rd}s=u.bind(null,n,s,e),u=void 0,!So||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(u=!0),l?u!==void 0?e.addEventListener(n,s,{capture:!0,passive:u}):e.addEventListener(n,s,!0):u!==void 0?e.addEventListener(n,s,{passive:u}):e.addEventListener(n,s,!1)}function Gu(e,n,s,l,u){var d=l;if((n&1)===0&&(n&2)===0&&l!==null)e:for(;;){if(l===null)return;var S=l.tag;if(S===3||S===4){var T=l.stateNode.containerInfo;if(T===u)break;if(S===4)for(S=l.return;S!==null;){var N=S.tag;if((N===3||N===4)&&S.stateNode.containerInfo===u)return;S=S.return}for(;T!==null;){if(S=Un(T),S===null)return;if(N=S.tag,N===5||N===6||N===26||N===27){l=d=S;continue e}T=T.parentNode}}l=l.return}La(function(){var q=d,K=ka(s),Q=[];e:{var z=Lf.get(e);if(z!==void 0){var $=Bl,ye=e;switch(e){case"keypress":if(na(s)===0)break e;case"keydown":case"keyup":$=qy;break;case"focusin":ye="focus",$=yc;break;case"focusout":ye="blur",$=yc;break;case"beforeblur":case"afterblur":$=yc;break;case"click":if(s.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=rf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=Cy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=$y;break;case Cf:case Nf:case Rf:$=ky;break;case kf:$=Ky;break;case"scroll":case"scrollend":$=My;break;case"wheel":$=Gy;break;case"copy":case"cut":case"paste":$=By;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=uf;break;case"toggle":case"beforetoggle":$=Xy}var Me=(n&4)!==0,yt=!Me&&(e==="scroll"||e==="scrollend"),D=Me?z!==null?z+"Capture":null:z;Me=[];for(var I=q,U;I!==null;){var G=I;if(U=G.stateNode,G=G.tag,G!==5&&G!==26&&G!==27||U===null||D===null||(G=Ji(I,D),G!=null&&Me.push(Jo(I,G,U))),yt)break;I=I.return}0<Me.length&&(z=new $(z,ye,null,s,K),Q.push({event:z,listeners:Me}))}}if((n&7)===0){e:{if(z=e==="mouseover"||e==="pointerover",$=e==="mouseout"||e==="pointerout",z&&s!==Ra&&(ye=s.relatedTarget||s.fromElement)&&(Un(ye)||ye[De]))break e;if(($||z)&&(z=K.window===K?K:(z=K.ownerDocument)?z.defaultView||z.parentWindow:window,$?(ye=s.relatedTarget||s.toElement,$=q,ye=ye?Un(ye):null,ye!==null&&(yt=r(ye),Me=ye.tag,ye!==yt||Me!==5&&Me!==27&&Me!==6)&&(ye=null)):($=null,ye=q),$!==ye)){if(Me=rf,G="onMouseLeave",D="onMouseEnter",I="mouse",(e==="pointerout"||e==="pointerover")&&(Me=uf,G="onPointerLeave",D="onPointerEnter",I="pointer"),yt=$==null?z:wi($),U=ye==null?z:wi(ye),z=new Me(G,I+"leave",$,s,K),z.target=yt,z.relatedTarget=U,G=null,Un(K)===q&&(Me=new Me(D,I+"enter",ye,s,K),Me.target=U,Me.relatedTarget=yt,G=Me),yt=G,$&&ye)t:{for(Me=W0,D=$,I=ye,U=0,G=D;G;G=Me(G))U++;G=0;for(var Ee=I;Ee;Ee=Me(Ee))G++;for(;0<U-G;)D=Me(D),U--;for(;0<G-U;)I=Me(I),G--;for(;U--;){if(D===I||I!==null&&D===I.alternate){Me=D;break t}D=Me(D),I=Me(I)}Me=null}else Me=null;$!==null&&th(Q,z,$,Me,!1),ye!==null&&yt!==null&&th(Q,yt,ye,Me,!0)}}e:{if(z=q?wi(q):window,$=z.nodeName&&z.nodeName.toLowerCase(),$==="select"||$==="input"&&z.type==="file")var tt=bf;else if(gf(z))if(Sf)tt=o0;else{tt=s0;var Se=i0}else $=z.nodeName,!$||$.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?q&&Pt(q.elementType)&&(tt=bf):tt=a0;if(tt&&(tt=tt(e,q))){yf(Q,tt,s,K);break e}Se&&Se(e,z,q),e==="focusout"&&q&&z.type==="number"&&q.memoizedProps.value!=null&&pe(z,"number",z.value)}switch(Se=q?wi(q):window,e){case"focusin":(gf(Se)||Se.contentEditable==="true")&&(Ia=Se,Tc=q,Mo=null);break;case"focusout":Mo=Tc=Ia=null;break;case"mousedown":Ec=!0;break;case"contextmenu":case"mouseup":case"dragend":Ec=!1,Mf(Q,s,K);break;case"selectionchange":if(r0)break;case"keydown":case"keyup":Mf(Q,s,K)}var He;if(Sc)e:{switch(e){case"compositionstart":var We="onCompositionStart";break e;case"compositionend":We="onCompositionEnd";break e;case"compositionupdate":We="onCompositionUpdate";break e}We=void 0}else Ba?pf(e,s)&&(We="onCompositionEnd"):e==="keydown"&&s.keyCode===229&&(We="onCompositionStart");We&&(df&&s.locale!=="ko"&&(Ba||We!=="onCompositionStart"?We==="onCompositionEnd"&&Ba&&(He=vo()):(Zn=K,ea="value"in Zn?Zn.value:Zn.textContent,Ba=!0)),Se=Er(q,We),0<Se.length&&(We=new cf(We,e,null,s,K),Q.push({event:We,listeners:Se}),He?We.data=He:(He=hf(s),He!==null&&(We.data=He)))),(He=Jy?Zy(e,s):e0(e,s))&&(We=Er(q,"onBeforeInput"),0<We.length&&(Se=new cf("onBeforeInput","beforeinput",null,s,K),Q.push({event:Se,listeners:We}),Se.data=He)),Y0(Q,e,q,s,K)}Zp(Q,n)})}function Jo(e,n,s){return{instance:e,listener:n,currentTarget:s}}function Er(e,n){for(var s=n+"Capture",l=[];e!==null;){var u=e,d=u.stateNode;if(u=u.tag,u!==5&&u!==26&&u!==27||d===null||(u=Ji(e,s),u!=null&&l.unshift(Jo(e,u,d)),u=Ji(e,n),u!=null&&l.push(Jo(e,u,d))),e.tag===3)return l;e=e.return}return[]}function W0(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5&&e.tag!==27);return e||null}function th(e,n,s,l,u){for(var d=n._reactName,S=[];s!==null&&s!==l;){var T=s,N=T.alternate,q=T.stateNode;if(T=T.tag,N!==null&&N===l)break;T!==5&&T!==26&&T!==27||q===null||(N=q,u?(q=Ji(s,d),q!=null&&S.unshift(Jo(s,q,N))):u||(q=Ji(s,d),q!=null&&S.push(Jo(s,q,N)))),s=s.return}S.length!==0&&e.push({event:n,listeners:S})}var X0=/\r\n?/g,Q0=/\u0000|\uFFFD/g;function nh(e){return(typeof e=="string"?e:""+e).replace(X0,`
`).replace(Q0,"")}function ih(e,n){return n=nh(n),nh(e)===n}function gt(e,n,s,l,u,d){switch(s){case"children":typeof l=="string"?n==="body"||n==="textarea"&&l===""||fn(e,l):(typeof l=="number"||typeof l=="bigint")&&n!=="body"&&fn(e,""+l);break;case"className":Js(e,"class",l);break;case"tabIndex":Js(e,"tabindex",l);break;case"dir":case"role":case"viewBox":case"width":case"height":Js(e,s,l);break;case"style":_t(e,l,d);break;case"data":if(n!=="object"){Js(e,"data",l);break}case"src":case"href":if(l===""&&(n!=="a"||s!=="href")){e.removeAttribute(s);break}if(l==null||typeof l=="function"||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(s);break}l=Na(""+l),e.setAttribute(s,l);break;case"action":case"formAction":if(typeof l=="function"){e.setAttribute(s,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof d=="function"&&(s==="formAction"?(n!=="input"&&gt(e,n,"name",u.name,u,null),gt(e,n,"formEncType",u.formEncType,u,null),gt(e,n,"formMethod",u.formMethod,u,null),gt(e,n,"formTarget",u.formTarget,u,null)):(gt(e,n,"encType",u.encType,u,null),gt(e,n,"method",u.method,u,null),gt(e,n,"target",u.target,u,null)));if(l==null||typeof l=="symbol"||typeof l=="boolean"){e.removeAttribute(s);break}l=Na(""+l),e.setAttribute(s,l);break;case"onClick":l!=null&&(e.onclick=Oi);break;case"onScroll":l!=null&&Ke("scroll",e);break;case"onScrollEnd":l!=null&&Ke("scrollend",e);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));e.innerHTML=s}}break;case"multiple":e.multiple=l&&typeof l!="function"&&typeof l!="symbol";break;case"muted":e.muted=l&&typeof l!="function"&&typeof l!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(l==null||typeof l=="function"||typeof l=="boolean"||typeof l=="symbol"){e.removeAttribute("xlink:href");break}s=Na(""+l),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",s);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,""+l):e.removeAttribute(s);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":l&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,""):e.removeAttribute(s);break;case"capture":case"download":l===!0?e.setAttribute(s,""):l!==!1&&l!=null&&typeof l!="function"&&typeof l!="symbol"?e.setAttribute(s,l):e.removeAttribute(s);break;case"cols":case"rows":case"size":case"span":l!=null&&typeof l!="function"&&typeof l!="symbol"&&!isNaN(l)&&1<=l?e.setAttribute(s,l):e.removeAttribute(s);break;case"rowSpan":case"start":l==null||typeof l=="function"||typeof l=="symbol"||isNaN(l)?e.removeAttribute(s):e.setAttribute(s,l);break;case"popover":Ke("beforetoggle",e),Ke("toggle",e),vs(e,"popover",l);break;case"xlinkActuate":ui(e,"http://www.w3.org/1999/xlink","xlink:actuate",l);break;case"xlinkArcrole":ui(e,"http://www.w3.org/1999/xlink","xlink:arcrole",l);break;case"xlinkRole":ui(e,"http://www.w3.org/1999/xlink","xlink:role",l);break;case"xlinkShow":ui(e,"http://www.w3.org/1999/xlink","xlink:show",l);break;case"xlinkTitle":ui(e,"http://www.w3.org/1999/xlink","xlink:title",l);break;case"xlinkType":ui(e,"http://www.w3.org/1999/xlink","xlink:type",l);break;case"xmlBase":ui(e,"http://www.w3.org/XML/1998/namespace","xml:base",l);break;case"xmlLang":ui(e,"http://www.w3.org/XML/1998/namespace","xml:lang",l);break;case"xmlSpace":ui(e,"http://www.w3.org/XML/1998/namespace","xml:space",l);break;case"is":vs(e,"is",l);break;case"innerText":case"textContent":break;default:(!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(s=mn.get(s)||s,vs(e,s,l))}}function Wu(e,n,s,l,u,d){switch(s){case"style":_t(e,l,d);break;case"dangerouslySetInnerHTML":if(l!=null){if(typeof l!="object"||!("__html"in l))throw Error(o(61));if(s=l.__html,s!=null){if(u.children!=null)throw Error(o(60));e.innerHTML=s}}break;case"children":typeof l=="string"?fn(e,l):(typeof l=="number"||typeof l=="bigint")&&fn(e,""+l);break;case"onScroll":l!=null&&Ke("scroll",e);break;case"onScrollEnd":l!=null&&Ke("scrollend",e);break;case"onClick":l!=null&&(e.onclick=Oi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Nl.hasOwnProperty(s))e:{if(s[0]==="o"&&s[1]==="n"&&(u=s.endsWith("Capture"),n=s.slice(2,u?s.length-7:void 0),d=e[be]||null,d=d!=null?d[s]:null,typeof d=="function"&&e.removeEventListener(n,d,u),typeof l=="function")){typeof d!="function"&&d!==null&&(s in e?e[s]=null:e.hasAttribute(s)&&e.removeAttribute(s)),e.addEventListener(n,l,u);break e}s in e?e[s]=l:l===!0?e.setAttribute(s,""):vs(e,s,l)}}}function _n(e,n,s){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ke("error",e),Ke("load",e);var l=!1,u=!1,d;for(d in s)if(s.hasOwnProperty(d)){var S=s[d];if(S!=null)switch(d){case"src":l=!0;break;case"srcSet":u=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:gt(e,n,d,S,s,null)}}u&&gt(e,n,"srcSet",s.srcSet,s,null),l&&gt(e,n,"src",s.src,s,null);return;case"input":Ke("invalid",e);var T=d=S=u=null,N=null,q=null;for(l in s)if(s.hasOwnProperty(l)){var K=s[l];if(K!=null)switch(l){case"name":u=K;break;case"type":S=K;break;case"checked":N=K;break;case"defaultChecked":q=K;break;case"value":d=K;break;case"defaultValue":T=K;break;case"children":case"dangerouslySetInnerHTML":if(K!=null)throw Error(o(137,n));break;default:gt(e,n,l,K,s,null)}}ce(e,d,T,N,q,S,u,!1);return;case"select":Ke("invalid",e),l=S=d=null;for(u in s)if(s.hasOwnProperty(u)&&(T=s[u],T!=null))switch(u){case"value":d=T;break;case"defaultValue":S=T;break;case"multiple":l=T;default:gt(e,n,u,T,s,null)}n=d,s=S,e.multiple=!!l,n!=null?he(e,!!l,n,!1):s!=null&&he(e,!!l,s,!0);return;case"textarea":Ke("invalid",e),d=u=l=null;for(S in s)if(s.hasOwnProperty(S)&&(T=s[S],T!=null))switch(S){case"value":l=T;break;case"defaultValue":u=T;break;case"children":d=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(o(91));break;default:gt(e,n,S,T,s,null)}ot(e,l,u,d);return;case"option":for(N in s)s.hasOwnProperty(N)&&(l=s[N],l!=null)&&(N==="selected"?e.selected=l&&typeof l!="function"&&typeof l!="symbol":gt(e,n,N,l,s,null));return;case"dialog":Ke("beforetoggle",e),Ke("toggle",e),Ke("cancel",e),Ke("close",e);break;case"iframe":case"object":Ke("load",e);break;case"video":case"audio":for(l=0;l<Qo.length;l++)Ke(Qo[l],e);break;case"image":Ke("error",e),Ke("load",e);break;case"details":Ke("toggle",e);break;case"embed":case"source":case"link":Ke("error",e),Ke("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in s)if(s.hasOwnProperty(q)&&(l=s[q],l!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,n));default:gt(e,n,q,l,s,null)}return;default:if(Pt(n)){for(K in s)s.hasOwnProperty(K)&&(l=s[K],l!==void 0&&Wu(e,n,K,l,s,void 0));return}}for(T in s)s.hasOwnProperty(T)&&(l=s[T],l!=null&&gt(e,n,T,l,s,null))}function J0(e,n,s,l){switch(n){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var u=null,d=null,S=null,T=null,N=null,q=null,K=null;for($ in s){var Q=s[$];if(s.hasOwnProperty($)&&Q!=null)switch($){case"checked":break;case"value":break;case"defaultValue":N=Q;default:l.hasOwnProperty($)||gt(e,n,$,null,l,Q)}}for(var z in l){var $=l[z];if(Q=s[z],l.hasOwnProperty(z)&&($!=null||Q!=null))switch(z){case"type":d=$;break;case"name":u=$;break;case"checked":q=$;break;case"defaultChecked":K=$;break;case"value":S=$;break;case"defaultValue":T=$;break;case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(o(137,n));break;default:$!==Q&&gt(e,n,z,$,l,Q)}}ae(e,S,T,N,q,K,d,u);return;case"select":$=S=T=z=null;for(d in s)if(N=s[d],s.hasOwnProperty(d)&&N!=null)switch(d){case"value":break;case"multiple":$=N;default:l.hasOwnProperty(d)||gt(e,n,d,null,l,N)}for(u in l)if(d=l[u],N=s[u],l.hasOwnProperty(u)&&(d!=null||N!=null))switch(u){case"value":z=d;break;case"defaultValue":T=d;break;case"multiple":S=d;default:d!==N&&gt(e,n,u,d,l,N)}n=T,s=S,l=$,z!=null?he(e,!!s,z,!1):!!l!=!!s&&(n!=null?he(e,!!s,n,!0):he(e,!!s,s?[]:"",!1));return;case"textarea":$=z=null;for(T in s)if(u=s[T],s.hasOwnProperty(T)&&u!=null&&!l.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:gt(e,n,T,null,l,u)}for(S in l)if(u=l[S],d=s[S],l.hasOwnProperty(S)&&(u!=null||d!=null))switch(S){case"value":z=u;break;case"defaultValue":$=u;break;case"children":break;case"dangerouslySetInnerHTML":if(u!=null)throw Error(o(91));break;default:u!==d&&gt(e,n,S,u,l,d)}at(e,z,$);return;case"option":for(var ye in s)z=s[ye],s.hasOwnProperty(ye)&&z!=null&&!l.hasOwnProperty(ye)&&(ye==="selected"?e.selected=!1:gt(e,n,ye,null,l,z));for(N in l)z=l[N],$=s[N],l.hasOwnProperty(N)&&z!==$&&(z!=null||$!=null)&&(N==="selected"?e.selected=z&&typeof z!="function"&&typeof z!="symbol":gt(e,n,N,z,l,$));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Me in s)z=s[Me],s.hasOwnProperty(Me)&&z!=null&&!l.hasOwnProperty(Me)&&gt(e,n,Me,null,l,z);for(q in l)if(z=l[q],$=s[q],l.hasOwnProperty(q)&&z!==$&&(z!=null||$!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(o(137,n));break;default:gt(e,n,q,z,l,$)}return;default:if(Pt(n)){for(var yt in s)z=s[yt],s.hasOwnProperty(yt)&&z!==void 0&&!l.hasOwnProperty(yt)&&Wu(e,n,yt,void 0,l,z);for(K in l)z=l[K],$=s[K],!l.hasOwnProperty(K)||z===$||z===void 0&&$===void 0||Wu(e,n,K,z,l,$);return}}for(var D in s)z=s[D],s.hasOwnProperty(D)&&z!=null&&!l.hasOwnProperty(D)&&gt(e,n,D,null,l,z);for(Q in l)z=l[Q],$=s[Q],!l.hasOwnProperty(Q)||z===$||z==null&&$==null||gt(e,n,Q,z,l,$)}function sh(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Z0(){if(typeof performance.getEntriesByType=="function"){for(var e=0,n=0,s=performance.getEntriesByType("resource"),l=0;l<s.length;l++){var u=s[l],d=u.transferSize,S=u.initiatorType,T=u.duration;if(d&&T&&sh(S)){for(S=0,T=u.responseEnd,l+=1;l<s.length;l++){var N=s[l],q=N.startTime;if(q>T)break;var K=N.transferSize,Q=N.initiatorType;K&&sh(Q)&&(N=N.responseEnd,S+=K*(N<T?1:(T-q)/(N-q)))}if(--l,n+=8*(d+S)/(u.duration/1e3),e++,10<e)break}}if(0<e)return n/e/1e6}return navigator.connection&&(e=navigator.connection.downlink,typeof e=="number")?e:5}var Xu=null,Qu=null;function _r(e){return e.nodeType===9?e:e.ownerDocument}function ah(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oh(e,n){if(e===0)switch(n){case"svg":return 1;case"math":return 2;default:return 0}return e===1&&n==="foreignObject"?0:e}function Ju(e,n){return e==="textarea"||e==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.children=="bigint"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var Zu=null;function eb(){var e=window.event;return e&&e.type==="popstate"?e===Zu?!1:(Zu=e,!0):(Zu=null,!1)}var lh=typeof setTimeout=="function"?setTimeout:void 0,tb=typeof clearTimeout=="function"?clearTimeout:void 0,rh=typeof Promise=="function"?Promise:void 0,nb=typeof queueMicrotask=="function"?queueMicrotask:typeof rh<"u"?function(e){return rh.resolve(null).then(e).catch(ib)}:lh;function ib(e){setTimeout(function(){throw e})}function Ds(e){return e==="head"}function ch(e,n){var s=n,l=0;do{var u=s.nextSibling;if(e.removeChild(s),u&&u.nodeType===8)if(s=u.data,s==="/$"||s==="/&"){if(l===0){e.removeChild(u),ro(n);return}l--}else if(s==="$"||s==="$?"||s==="$~"||s==="$!"||s==="&")l++;else if(s==="html")Zo(e.ownerDocument.documentElement);else if(s==="head"){s=e.ownerDocument.head,Zo(s);for(var d=s.firstChild;d;){var S=d.nextSibling,T=d.nodeName;d[Ct]||T==="SCRIPT"||T==="STYLE"||T==="LINK"&&d.rel.toLowerCase()==="stylesheet"||s.removeChild(d),d=S}}else s==="body"&&Zo(e.ownerDocument.body);s=u}while(s);ro(n)}function uh(e,n){var s=e;e=0;do{var l=s.nextSibling;if(s.nodeType===1?n?(s._stashedDisplay=s.style.display,s.style.display="none"):(s.style.display=s._stashedDisplay||"",s.getAttribute("style")===""&&s.removeAttribute("style")):s.nodeType===3&&(n?(s._stashedText=s.nodeValue,s.nodeValue=""):s.nodeValue=s._stashedText||""),l&&l.nodeType===8)if(s=l.data,s==="/$"){if(e===0)break;e--}else s!=="$"&&s!=="$?"&&s!=="$~"&&s!=="$!"||e++;s=l}while(s)}function ed(e){var n=e.firstChild;for(n&&n.nodeType===10&&(n=n.nextSibling);n;){var s=n;switch(n=n.nextSibling,s.nodeName){case"HTML":case"HEAD":case"BODY":ed(s),kn(s);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(s.rel.toLowerCase()==="stylesheet")continue}e.removeChild(s)}}function sb(e,n,s,l){for(;e.nodeType===1;){var u=s;if(e.nodeName.toLowerCase()!==n.toLowerCase()){if(!l&&(e.nodeName!=="INPUT"||e.type!=="hidden"))break}else if(l){if(!e[Ct])switch(n){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if(d=e.getAttribute("rel"),d==="stylesheet"&&e.hasAttribute("data-precedence"))break;if(d!==u.rel||e.getAttribute("href")!==(u.href==null||u.href===""?null:u.href)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin)||e.getAttribute("title")!==(u.title==null?null:u.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(d=e.getAttribute("src"),(d!==(u.src==null?null:u.src)||e.getAttribute("type")!==(u.type==null?null:u.type)||e.getAttribute("crossorigin")!==(u.crossOrigin==null?null:u.crossOrigin))&&d&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else if(n==="input"&&e.type==="hidden"){var d=u.name==null?null:""+u.name;if(u.type==="hidden"&&e.getAttribute("name")===d)return e}else return e;if(e=yi(e.nextSibling),e===null)break}return null}function ab(e,n,s){if(n==="")return null;for(;e.nodeType!==3;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!s||(e=yi(e.nextSibling),e===null))return null;return e}function dh(e,n){for(;e.nodeType!==8;)if((e.nodeType!==1||e.nodeName!=="INPUT"||e.type!=="hidden")&&!n||(e=yi(e.nextSibling),e===null))return null;return e}function td(e){return e.data==="$?"||e.data==="$~"}function nd(e){return e.data==="$!"||e.data==="$?"&&e.ownerDocument.readyState!=="loading"}function ob(e,n){var s=e.ownerDocument;if(e.data==="$~")e._reactRetry=n;else if(e.data!=="$?"||s.readyState!=="loading")n();else{var l=function(){n(),s.removeEventListener("DOMContentLoaded",l)};s.addEventListener("DOMContentLoaded",l),e._reactRetry=l}}function yi(e){for(;e!=null;e=e.nextSibling){var n=e.nodeType;if(n===1||n===3)break;if(n===8){if(n=e.data,n==="$"||n==="$!"||n==="$?"||n==="$~"||n==="&"||n==="F!"||n==="F")break;if(n==="/$"||n==="/&")return null}}return e}var id=null;function fh(e){e=e.nextSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="/$"||s==="/&"){if(n===0)return yi(e.nextSibling);n--}else s!=="$"&&s!=="$!"&&s!=="$?"&&s!=="$~"&&s!=="&"||n++}e=e.nextSibling}return null}function mh(e){e=e.previousSibling;for(var n=0;e;){if(e.nodeType===8){var s=e.data;if(s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"){if(n===0)return e;n--}else s!=="/$"&&s!=="/&"||n++}e=e.previousSibling}return null}function ph(e,n,s){switch(n=_r(s),e){case"html":if(e=n.documentElement,!e)throw Error(o(452));return e;case"head":if(e=n.head,!e)throw Error(o(453));return e;case"body":if(e=n.body,!e)throw Error(o(454));return e;default:throw Error(o(451))}}function Zo(e){for(var n=e.attributes;n.length;)e.removeAttributeNode(n[0]);kn(e)}var bi=new Map,hh=new Set;function wr(e){return typeof e.getRootNode=="function"?e.getRootNode():e.nodeType===9?e:e.ownerDocument}var ms=ie.d;ie.d={f:lb,r:rb,D:cb,C:ub,L:db,m:fb,X:pb,S:mb,M:hb};function lb(){var e=ms.f(),n=yr();return e||n}function rb(e){var n=Ln(e);n!==null&&n.tag===5&&n.type==="form"?km(n):ms.r(e)}var ao=typeof document>"u"?null:document;function gh(e,n,s){var l=ao;if(l&&typeof n=="string"&&n){var u=F(n);u='link[rel="'+e+'"][href="'+u+'"]',typeof s=="string"&&(u+='[crossorigin="'+s+'"]'),hh.has(u)||(hh.add(u),e={rel:e,crossOrigin:s,href:n},l.querySelector(u)===null&&(n=l.createElement("link"),_n(n,"link",e),Nt(n),l.head.appendChild(n)))}}function cb(e){ms.D(e),gh("dns-prefetch",e,null)}function ub(e,n){ms.C(e,n),gh("preconnect",e,n)}function db(e,n,s){ms.L(e,n,s);var l=ao;if(l&&e&&n){var u='link[rel="preload"][as="'+F(n)+'"]';n==="image"&&s&&s.imageSrcSet?(u+='[imagesrcset="'+F(s.imageSrcSet)+'"]',typeof s.imageSizes=="string"&&(u+='[imagesizes="'+F(s.imageSizes)+'"]')):u+='[href="'+F(e)+'"]';var d=u;switch(n){case"style":d=oo(e);break;case"script":d=lo(e)}bi.has(d)||(e=v({rel:"preload",href:n==="image"&&s&&s.imageSrcSet?void 0:e,as:n},s),bi.set(d,e),l.querySelector(u)!==null||n==="style"&&l.querySelector(el(d))||n==="script"&&l.querySelector(tl(d))||(n=l.createElement("link"),_n(n,"link",e),Nt(n),l.head.appendChild(n)))}}function fb(e,n){ms.m(e,n);var s=ao;if(s&&e){var l=n&&typeof n.as=="string"?n.as:"script",u='link[rel="modulepreload"][as="'+F(l)+'"][href="'+F(e)+'"]',d=u;switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":d=lo(e)}if(!bi.has(d)&&(e=v({rel:"modulepreload",href:e},n),bi.set(d,e),s.querySelector(u)===null)){switch(l){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(s.querySelector(tl(d)))return}l=s.createElement("link"),_n(l,"link",e),Nt(l),s.head.appendChild(l)}}}function mb(e,n,s){ms.S(e,n,s);var l=ao;if(l&&e){var u=Mi(l).hoistableStyles,d=oo(e);n=n||"default";var S=u.get(d);if(!S){var T={loading:0,preload:null};if(S=l.querySelector(el(d)))T.loading=5;else{e=v({rel:"stylesheet",href:e,"data-precedence":n},s),(s=bi.get(d))&&sd(e,s);var N=S=l.createElement("link");Nt(N),_n(N,"link",e),N._p=new Promise(function(q,K){N.onload=q,N.onerror=K}),N.addEventListener("load",function(){T.loading|=1}),N.addEventListener("error",function(){T.loading|=2}),T.loading|=4,Mr(S,n,l)}S={type:"stylesheet",instance:S,count:1,state:T},u.set(d,S)}}}function pb(e,n){ms.X(e,n);var s=ao;if(s&&e){var l=Mi(s).hoistableScripts,u=lo(e),d=l.get(u);d||(d=s.querySelector(tl(u)),d||(e=v({src:e,async:!0},n),(n=bi.get(u))&&ad(e,n),d=s.createElement("script"),Nt(d),_n(d,"link",e),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(u,d))}}function hb(e,n){ms.M(e,n);var s=ao;if(s&&e){var l=Mi(s).hoistableScripts,u=lo(e),d=l.get(u);d||(d=s.querySelector(tl(u)),d||(e=v({src:e,async:!0,type:"module"},n),(n=bi.get(u))&&ad(e,n),d=s.createElement("script"),Nt(d),_n(d,"link",e),s.head.appendChild(d)),d={type:"script",instance:d,count:1,state:null},l.set(u,d))}}function yh(e,n,s,l){var u=(u=Ce.current)?wr(u):null;if(!u)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return typeof s.precedence=="string"&&typeof s.href=="string"?(n=oo(s.href),s=Mi(u).hoistableStyles,l=s.get(n),l||(l={type:"style",instance:null,count:0,state:null},s.set(n,l)),l):{type:"void",instance:null,count:0,state:null};case"link":if(s.rel==="stylesheet"&&typeof s.href=="string"&&typeof s.precedence=="string"){e=oo(s.href);var d=Mi(u).hoistableStyles,S=d.get(e);if(S||(u=u.ownerDocument||u,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,S),(d=u.querySelector(el(e)))&&!d._p&&(S.instance=d,S.state.loading=5),bi.has(e)||(s={rel:"preload",as:"style",href:s.href,crossOrigin:s.crossOrigin,integrity:s.integrity,media:s.media,hrefLang:s.hrefLang,referrerPolicy:s.referrerPolicy},bi.set(e,s),d||gb(u,e,s,S.state))),n&&l===null)throw Error(o(528,""));return S}if(n&&l!==null)throw Error(o(529,""));return null;case"script":return n=s.async,s=s.src,typeof s=="string"&&n&&typeof n!="function"&&typeof n!="symbol"?(n=lo(s),s=Mi(u).hoistableScripts,l=s.get(n),l||(l={type:"script",instance:null,count:0,state:null},s.set(n,l)),l):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function oo(e){return'href="'+F(e)+'"'}function el(e){return'link[rel="stylesheet"]['+e+"]"}function bh(e){return v({},e,{"data-precedence":e.precedence,precedence:null})}function gb(e,n,s,l){e.querySelector('link[rel="preload"][as="style"]['+n+"]")?l.loading=1:(n=e.createElement("link"),l.preload=n,n.addEventListener("load",function(){return l.loading|=1}),n.addEventListener("error",function(){return l.loading|=2}),_n(n,"link",s),Nt(n),e.head.appendChild(n))}function lo(e){return'[src="'+F(e)+'"]'}function tl(e){return"script[async]"+e}function Sh(e,n,s){if(n.count++,n.instance===null)switch(n.type){case"style":var l=e.querySelector('style[data-href~="'+F(s.href)+'"]');if(l)return n.instance=l,Nt(l),l;var u=v({},s,{"data-href":s.href,"data-precedence":s.precedence,href:null,precedence:null});return l=(e.ownerDocument||e).createElement("style"),Nt(l),_n(l,"style",u),Mr(l,s.precedence,e),n.instance=l;case"stylesheet":u=oo(s.href);var d=e.querySelector(el(u));if(d)return n.state.loading|=4,n.instance=d,Nt(d),d;l=bh(s),(u=bi.get(u))&&sd(l,u),d=(e.ownerDocument||e).createElement("link"),Nt(d);var S=d;return S._p=new Promise(function(T,N){S.onload=T,S.onerror=N}),_n(d,"link",l),n.state.loading|=4,Mr(d,s.precedence,e),n.instance=d;case"script":return d=lo(s.src),(u=e.querySelector(tl(d)))?(n.instance=u,Nt(u),u):(l=s,(u=bi.get(d))&&(l=v({},s),ad(l,u)),e=e.ownerDocument||e,u=e.createElement("script"),Nt(u),_n(u,"link",l),e.head.appendChild(u),n.instance=u);case"void":return null;default:throw Error(o(443,n.type))}else n.type==="stylesheet"&&(n.state.loading&4)===0&&(l=n.instance,n.state.loading|=4,Mr(l,s.precedence,e));return n.instance}function Mr(e,n,s){for(var l=s.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),u=l.length?l[l.length-1]:null,d=u,S=0;S<l.length;S++){var T=l[S];if(T.dataset.precedence===n)d=T;else if(d!==u)break}d?d.parentNode.insertBefore(e,d.nextSibling):(n=s.nodeType===9?s.head:s,n.insertBefore(e,n.firstChild))}function sd(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.title==null&&(e.title=n.title)}function ad(e,n){e.crossOrigin==null&&(e.crossOrigin=n.crossOrigin),e.referrerPolicy==null&&(e.referrerPolicy=n.referrerPolicy),e.integrity==null&&(e.integrity=n.integrity)}var Or=null;function vh(e,n,s){if(Or===null){var l=new Map,u=Or=new Map;u.set(s,l)}else u=Or,l=u.get(s),l||(l=new Map,u.set(s,l));if(l.has(e))return l;for(l.set(e,null),s=s.getElementsByTagName(e),u=0;u<s.length;u++){var d=s[u];if(!(d[Ct]||d[we]||e==="link"&&d.getAttribute("rel")==="stylesheet")&&d.namespaceURI!=="http://www.w3.org/2000/svg"){var S=d.getAttribute(n)||"";S=e+S;var T=l.get(S);T?T.push(d):l.set(S,[d])}}return l}function xh(e,n,s){e=e.ownerDocument||e,e.head.insertBefore(s,n==="title"?e.querySelector("head > title"):null)}function yb(e,n,s){if(s===1||n.itemProp!=null)return!1;switch(e){case"meta":case"title":return!0;case"style":if(typeof n.precedence!="string"||typeof n.href!="string"||n.href==="")break;return!0;case"link":if(typeof n.rel!="string"||typeof n.href!="string"||n.href===""||n.onLoad||n.onError)break;return n.rel==="stylesheet"?(e=n.disabled,typeof n.precedence=="string"&&e==null):!0;case"script":if(n.async&&typeof n.async!="function"&&typeof n.async!="symbol"&&!n.onLoad&&!n.onError&&n.src&&typeof n.src=="string")return!0}return!1}function Ah(e){return!(e.type==="stylesheet"&&(e.state.loading&3)===0)}function bb(e,n,s,l){if(s.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var u=oo(l.href),d=n.querySelector(el(u));if(d){n=d._p,n!==null&&typeof n=="object"&&typeof n.then=="function"&&(e.count++,e=Cr.bind(e),n.then(e,e)),s.state.loading|=4,s.instance=d,Nt(d);return}d=n.ownerDocument||n,l=bh(l),(u=bi.get(u))&&sd(l,u),d=d.createElement("link"),Nt(d);var S=d;S._p=new Promise(function(T,N){S.onload=T,S.onerror=N}),_n(d,"link",l),s.instance=d}e.stylesheets===null&&(e.stylesheets=new Map),e.stylesheets.set(s,n),(n=s.state.preload)&&(s.state.loading&3)===0&&(e.count++,s=Cr.bind(e),n.addEventListener("load",s),n.addEventListener("error",s))}}var od=0;function Sb(e,n){return e.stylesheets&&e.count===0&&Rr(e,e.stylesheets),0<e.count||0<e.imgCount?function(s){var l=setTimeout(function(){if(e.stylesheets&&Rr(e,e.stylesheets),e.unsuspend){var d=e.unsuspend;e.unsuspend=null,d()}},6e4+n);0<e.imgBytes&&od===0&&(od=62500*Z0());var u=setTimeout(function(){if(e.waitingForImages=!1,e.count===0&&(e.stylesheets&&Rr(e,e.stylesheets),e.unsuspend)){var d=e.unsuspend;e.unsuspend=null,d()}},(e.imgBytes>od?50:800)+n);return e.unsuspend=s,function(){e.unsuspend=null,clearTimeout(l),clearTimeout(u)}}:null}function Cr(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Rr(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var Nr=null;function Rr(e,n){e.stylesheets=null,e.unsuspend!==null&&(e.count++,Nr=new Map,n.forEach(vb,e),Nr=null,Cr.call(e))}function vb(e,n){if(!(n.state.loading&4)){var s=Nr.get(e);if(s)var l=s.get(null);else{s=new Map,Nr.set(e,s);for(var u=e.querySelectorAll("link[data-precedence],style[data-precedence]"),d=0;d<u.length;d++){var S=u[d];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(s.set(S.dataset.precedence,S),l=S)}l&&s.set(null,l)}u=n.instance,S=u.getAttribute("data-precedence"),d=s.get(S)||l,d===l&&s.set(null,u),s.set(S,u),this.count++,l=Cr.bind(this),u.addEventListener("load",l),u.addEventListener("error",l),d?d.parentNode.insertBefore(u,d.nextSibling):(e=e.nodeType===9?e.head:e,e.insertBefore(u,e.firstChild)),n.state.loading|=4}}var nl={$$typeof:_,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function xb(e,n,s,l,u,d,S,T,N){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=vn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vn(0),this.hiddenUpdates=vn(null),this.identifierPrefix=l,this.onUncaughtError=u,this.onCaughtError=d,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=N,this.incompleteTransitions=new Map}function Th(e,n,s,l,u,d,S,T,N,q,K,Q){return e=new xb(e,n,s,S,N,q,K,Q,T),n=1,d===!0&&(n|=24),d=ti(3,null,null,n),e.current=d,d.stateNode=e,n=Pc(),n.refCount++,e.pooledCache=n,n.refCount++,d.memoizedState={element:l,isDehydrated:s,cache:n},Vc(d),e}function Eh(e){return e?(e=Ha,e):Ha}function _h(e,n,s,l,u,d){u=Eh(u),l.context===null?l.context=u:l.pendingContext=u,l=ws(n),l.payload={element:s},d=d===void 0?null:d,d!==null&&(l.callback=d),s=Ms(e,l,n),s!==null&&(Gn(s,e,n),Bo(s,e,n))}function wh(e,n){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var s=e.retryLane;e.retryLane=s!==0&&s<n?s:n}}function ld(e,n){wh(e,n),(e=e.alternate)&&wh(e,n)}function Mh(e){if(e.tag===13||e.tag===31){var n=oa(e,67108864);n!==null&&Gn(n,e,67108864),ld(e,67108864)}}function Oh(e){if(e.tag===13||e.tag===31){var n=oi();n=_i(n);var s=oa(e,n);s!==null&&Gn(s,e,n),ld(e,n)}}var kr=!0;function Ab(e,n,s,l){var u=V.T;V.T=null;var d=ie.p;try{ie.p=2,rd(e,n,s,l)}finally{ie.p=d,V.T=u}}function Tb(e,n,s,l){var u=V.T;V.T=null;var d=ie.p;try{ie.p=8,rd(e,n,s,l)}finally{ie.p=d,V.T=u}}function rd(e,n,s,l){if(kr){var u=cd(l);if(u===null)Gu(e,n,l,Lr,s),Nh(e,l);else if(_b(u,e,n,s,l))l.stopPropagation();else if(Nh(e,l),n&4&&-1<Eb.indexOf(e)){for(;u!==null;){var d=Ln(u);if(d!==null)switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var S=Dt(d.pendingLanes);if(S!==0){var T=d;for(T.pendingLanes|=2,T.entangledLanes|=2;S;){var N=1<<31-Tt(S);T.entanglements[1]|=N,S&=~N}$i(d),(st&6)===0&&(hr=Fe()+500,Xo(0))}}break;case 31:case 13:T=oa(d,2),T!==null&&Gn(T,d,2),yr(),ld(d,2)}if(d=cd(l),d===null&&Gu(e,n,l,Lr,s),d===u)break;u=d}u!==null&&l.stopPropagation()}else Gu(e,n,l,null,s)}}function cd(e){return e=ka(e),ud(e)}var Lr=null;function ud(e){if(Lr=null,e=Un(e),e!==null){var n=r(e);if(n===null)e=null;else{var s=n.tag;if(s===13){if(e=f(n),e!==null)return e;e=null}else if(s===31){if(e=g(n),e!==null)return e;e=null}else if(s===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;e=null}else n!==e&&(e=null)}}return Lr=e,null}function Ch(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(mt()){case jt:return 2;case bn:return 8;case rn:case Sn:return 32;case $t:return 268435456;default:return 32}default:return 32}}var dd=!1,Hs=null,Ps=null,Us=null,il=new Map,sl=new Map,qs=[],Eb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Nh(e,n){switch(e){case"focusin":case"focusout":Hs=null;break;case"dragenter":case"dragleave":Ps=null;break;case"mouseover":case"mouseout":Us=null;break;case"pointerover":case"pointerout":il.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":sl.delete(n.pointerId)}}function al(e,n,s,l,u,d){return e===null||e.nativeEvent!==d?(e={blockedOn:n,domEventName:s,eventSystemFlags:l,nativeEvent:d,targetContainers:[u]},n!==null&&(n=Ln(n),n!==null&&Mh(n)),e):(e.eventSystemFlags|=l,n=e.targetContainers,u!==null&&n.indexOf(u)===-1&&n.push(u),e)}function _b(e,n,s,l,u){switch(n){case"focusin":return Hs=al(Hs,e,n,s,l,u),!0;case"dragenter":return Ps=al(Ps,e,n,s,l,u),!0;case"mouseover":return Us=al(Us,e,n,s,l,u),!0;case"pointerover":var d=u.pointerId;return il.set(d,al(il.get(d)||null,e,n,s,l,u)),!0;case"gotpointercapture":return d=u.pointerId,sl.set(d,al(sl.get(d)||null,e,n,s,l,u)),!0}return!1}function Rh(e){var n=Un(e.target);if(n!==null){var s=r(n);if(s!==null){if(n=s.tag,n===13){if(n=f(s),n!==null){e.blockedOn=n,le(e.priority,function(){Oh(s)});return}}else if(n===31){if(n=g(s),n!==null){e.blockedOn=n,le(e.priority,function(){Oh(s)});return}}else if(n===3&&s.stateNode.current.memoizedState.isDehydrated){e.blockedOn=s.tag===3?s.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Br(e){if(e.blockedOn!==null)return!1;for(var n=e.targetContainers;0<n.length;){var s=cd(e.nativeEvent);if(s===null){s=e.nativeEvent;var l=new s.constructor(s.type,s);Ra=l,s.target.dispatchEvent(l),Ra=null}else return n=Ln(s),n!==null&&Mh(n),e.blockedOn=s,!1;n.shift()}return!0}function kh(e,n,s){Br(e)&&s.delete(n)}function wb(){dd=!1,Hs!==null&&Br(Hs)&&(Hs=null),Ps!==null&&Br(Ps)&&(Ps=null),Us!==null&&Br(Us)&&(Us=null),il.forEach(kh),sl.forEach(kh)}function Ir(e,n){e.blockedOn===n&&(e.blockedOn=null,dd||(dd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,wb)))}var jr=null;function Lh(e){jr!==e&&(jr=e,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){jr===e&&(jr=null);for(var n=0;n<e.length;n+=3){var s=e[n],l=e[n+1],u=e[n+2];if(typeof l!="function"){if(ud(l||s)===null)continue;break}var d=Ln(s);d!==null&&(e.splice(n,3),n-=3,cu(d,{pending:!0,data:u,method:s.method,action:l},l,u))}}))}function ro(e){function n(N){return Ir(N,e)}Hs!==null&&Ir(Hs,e),Ps!==null&&Ir(Ps,e),Us!==null&&Ir(Us,e),il.forEach(n),sl.forEach(n);for(var s=0;s<qs.length;s++){var l=qs[s];l.blockedOn===e&&(l.blockedOn=null)}for(;0<qs.length&&(s=qs[0],s.blockedOn===null);)Rh(s),s.blockedOn===null&&qs.shift();if(s=(e.ownerDocument||e).$$reactFormReplay,s!=null)for(l=0;l<s.length;l+=3){var u=s[l],d=s[l+1],S=u[be]||null;if(typeof d=="function")S||Lh(s);else if(S){var T=null;if(d&&d.hasAttribute("formAction")){if(u=d,S=d[be]||null)T=S.formAction;else if(ud(u)!==null)continue}else T=S.action;typeof T=="function"?s[l+1]=T:(s.splice(l,3),l-=3),Lh(s)}}}function Bh(){function e(d){d.canIntercept&&d.info==="react-transition"&&d.intercept({handler:function(){return new Promise(function(S){return u=S})},focusReset:"manual",scroll:"manual"})}function n(){u!==null&&(u(),u=null),l||setTimeout(s,20)}function s(){if(!l&&!navigation.transition){var d=navigation.currentEntry;d&&d.url!=null&&navigation.navigate(d.url,{state:d.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var l=!1,u=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",n),navigation.addEventListener("navigateerror",n),setTimeout(s,100),function(){l=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",n),navigation.removeEventListener("navigateerror",n),u!==null&&(u(),u=null)}}}function fd(e){this._internalRoot=e}Dr.prototype.render=fd.prototype.render=function(e){var n=this._internalRoot;if(n===null)throw Error(o(409));var s=n.current,l=oi();_h(s,l,e,n,null,null)},Dr.prototype.unmount=fd.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var n=e.containerInfo;_h(e.current,2,null,e,null,null),yr(),n[De]=null}};function Dr(e){this._internalRoot=e}Dr.prototype.unstable_scheduleHydration=function(e){if(e){var n=X();e={blockedOn:null,target:e,priority:n};for(var s=0;s<qs.length&&n!==0&&n<qs[s].priority;s++);qs.splice(s,0,e),s===0&&Rh(e)}};var Ih=i.version;if(Ih!=="19.2.3")throw Error(o(527,Ih,"19.2.3"));ie.findDOMNode=function(e){var n=e._reactInternals;if(n===void 0)throw typeof e.render=="function"?Error(o(188)):(e=Object.keys(e).join(","),Error(o(268,e)));return e=y(n),e=e!==null?A(e):null,e=e===null?null:e.stateNode,e};var Mb={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hr=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hr.isDisabled&&Hr.supportsFiber)try{Yt=Hr.inject(Mb),Je=Hr}catch{}}return ll.createRoot=function(e,n){if(!c(e))throw Error(o(299));var s=!1,l="",u=zm,d=Vm,S=$m;return n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(l=n.identifierPrefix),n.onUncaughtError!==void 0&&(u=n.onUncaughtError),n.onCaughtError!==void 0&&(d=n.onCaughtError),n.onRecoverableError!==void 0&&(S=n.onRecoverableError)),n=Th(e,1,!1,null,null,s,l,null,u,d,S,Bh),e[De]=n.current,Fu(e),new fd(n)},ll.hydrateRoot=function(e,n,s){if(!c(e))throw Error(o(299));var l=!1,u="",d=zm,S=Vm,T=$m,N=null;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(d=s.onUncaughtError),s.onCaughtError!==void 0&&(S=s.onCaughtError),s.onRecoverableError!==void 0&&(T=s.onRecoverableError),s.formState!==void 0&&(N=s.formState)),n=Th(e,1,!0,n,s??null,l,u,N,d,S,T,Bh),n.context=Eh(null),s=n.current,l=oi(),l=_i(l),u=ws(l),u.callback=null,Ms(s,u,l),s=l,n.current.lanes=s,Kt(n,s),$i(n),e[De]=n.current,Fu(e),new Dr(n)},ll.version="19.2.3",ll}var Yh;function Hb(){if(Yh)return hd.exports;Yh=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(i){console.error(i)}}return t(),hd.exports=Db(),hd.exports}var Pb=Hb();const In=(t,i)=>({q:t,r:i,s:-t-i}),Ub=t=>`${t.q},${t.r}`,de=Ub,J=(t,i)=>t.q===i.q&&t.r===i.r&&t.s===i.s,jn=(t,i)=>In(t.q+i.q,t.r+i.r),Dd=(t,i)=>In(t.q-i.q,t.r-i.r),_e=(t,i)=>(Math.abs(t.q-i.q)+Math.abs(t.r-i.r)+Math.abs(t.s-i.s))/2,bt=(t,i)=>{const a=i*(1.5*t.q),o=i*Math.sqrt(3)*(t.r+t.q/2);return{x:a,y:o}},Kh=t=>({q:t.q,r:t.r,s:t.s??-t.q-t.r}),qb=t=>In(t.q,t.r),zb=t=>{let i=Math.round(t.q),a=Math.round(t.r),o=Math.round(t.s);const c=Math.abs(i-t.q),r=Math.abs(a-t.r),f=Math.abs(o-t.s);return c>r&&c>f?i=-a-o:r>f?a=-i-o:o=-i-a,{q:i,r:a,s:o}},wl=[In(1,0),In(1,-1),In(0,-1),In(-1,0),In(-1,1),In(0,1)],xt=t=>wl.map(i=>jn(t,i)),Cn=t=>wl[(t%6+6)%6],Sd=(t,i,a)=>t+(i-t)*a,kt=(t,i)=>{const a=_e(t,i),o=[],c=Kh(t),r=Kh(i);for(let f=0;f<=a;f++){const g=a===0?0:f/a,b={q:Sd(c.q+1e-6,r.q+1e-6,g),r:Sd(c.r+1e-6,r.r+1e-6,g),s:Sd(c.s+1e-6,r.s+1e-6,g)};o.push(qb(zb(b)))}return o},Fs=(t,i)=>{const a=_e(t,i);if(a===0)return-1;const o=Dd(i,t),c=o.q/a,r=o.r/a,f=(0-o.q-o.r)/a;return wl.findIndex(g=>Math.abs(g.q-c)<.01&&Math.abs(g.r-r)<.01&&Math.abs(g.s-f)<.01)};function Jd(t,i){const a=Cn(t);return{q:a.q*i,r:a.r*i,s:-(a.q*i)-a.r*i}}const ac=(t,i,a,o)=>{if(t<0||t>=a||i<0||i>=o)return!1;const c=t+i,r=Math.floor(a/2),f=a-1+(o-1)-r;return c>=r&&c<=f},Vb=(t,i)=>{const a=[];for(let o=0;o<t;o++)for(let c=0;c<i;c++)ac(o,c,t,i)&&a.push(In(o,c));return a},Ws=(t,i,a)=>ac(t.q,t.r,i,a),$b=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i=Math.imul(i,16777619)>>>0;return i>>>0},Yb=t=>function(){let i=(t+=1831565813)>>>0;return i=Math.imul(i^i>>>15,i|1)>>>0,i^=i+Math.imul(i^i>>>7,i|61)>>>0,((i^i>>>14)>>>0)/4294967296},cc=t=>{const i=typeof t=="number"?t>>>0:$b(String(t)),a=Yb(i||1);return{next:()=>a(),id:(o=9)=>{const c="abcdefghijklmnopqrstuvwxyz0123456789";let r="";for(let f=0;f<o;f++){const g=Math.floor(a()*c.length)%c.length;r+=c[g]}return r}}},po=(t,i,a=9,o="")=>{const c=`${t}:${i}:${o}`,r=cc(c),f="abcdefghijklmnopqrstuvwxyz0123456789";let g="";for(let b=0;b<a;b++){const y=Math.floor(r.next()*f.length)%f.length;g+=f[y]}return g},oc=(t,i)=>{const a=`${t}:${i}`;return cc(a).next()},Ea=t=>{const i=t.rngSeed||"default",a=t.rngCounter||0;return{value:oc(i,a),nextState:{...t,rngCounter:a+1}}};function ji(t){return t.statusEffects?.some(i=>i.type==="stunned")??!1}function Kb(t){return t.statusEffects?.some(i=>i.type==="rooted")??!1}function Fh(t,i=1){if(!t.statusEffects||t.statusEffects.length===0)return t;const a=t.statusEffects.map(o=>({...o,duration:o.duration-i})).filter(o=>o.duration>0);return{...t,statusEffects:a}}const mo={GRASS:{id:"GRASS",name:"Grass",description:"Soft grass",defaultTraits:new Set(["WALKABLE","FLAMMABLE"]),visual:{color:"#4a7c59",icon:""}},STONE:{id:"STONE",name:"Stone Floor",description:"Hard stone",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#808080",icon:""}},LAVA:{id:"LAVA",name:"Lava",description:"Molten lava",defaultTraits:new Set(["LIQUID","HAZARDOUS"]),visual:{color:"#ff4400",icon:""}},WALL:{id:"WALL",name:"Wall",description:"Solid wall",defaultTraits:new Set(["BLOCKS_LOS","BLOCKS_MOVEMENT","ANCHOR"]),visual:{color:"#333333",icon:""}},ICE:{id:"ICE",name:"Ice",description:"Slippery ice",defaultTraits:new Set(["WALKABLE","SLIPPERY"]),visual:{color:"#aaddff",icon:""}},VOID:{id:"VOID",name:"Void",description:"The endless void",defaultTraits:new Set(["HAZARDOUS"]),visual:{color:"#000000",icon:""}},STAIRS:{id:"STAIRS",name:"Stairs",description:"Lead to the next floor",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#ffffff",icon:""}},SHRINE:{id:"SHRINE",name:"Shrine",description:"A place of power",defaultTraits:new Set(["WALKABLE","ANCHOR"]),visual:{color:"#ffd700",icon:""}},GATE:{id:"GATE",name:"Gate",description:"A heavy gate",defaultTraits:new Set(["BLOCKS_MOVEMENT","BLOCKS_LOS"]),visual:{color:"#444444",icon:""}},BRIDGE:{id:"BRIDGE",name:"Bridge",description:"Crossing the gap",defaultTraits:new Set(["WALKABLE"]),visual:{color:"#8b4513",icon:""}}},Pr={FIRE:{id:"FIRE",name:"Fire",description:"Burning flames",onStay:t=>({effects:[{type:"Damage",target:t.actor.id,amount:1,reason:"fire_damage"}],messages:[`${t.actor.subtype||t.actor.type} burns!`]}),interactsWith:{WET:t=>({effects:[{type:"Juice",effect:"flash",target:t.tile.position,color:"#aaaaaa"}],messages:["Steam rises!"],modifyTile:{effects:t.tile.effects.filter(i=>i.id!=="FIRE"&&i.id!=="WET"&&i.id!=="STEAM").concat({id:"STEAM",duration:2,potency:1})}})}},WET:{id:"WET",name:"Wet",description:"Soaked with water",onApply:t=>t.tile.effects.some(a=>a.id==="FIRE")?{effects:[],messages:["Water extinguishes the flames!"],modifyTile:{effects:t.tile.effects.filter(a=>a.id!=="FIRE")}}:{effects:[],messages:[]}},OIL:{id:"OIL",name:"Oil",description:"Slippery oil",interactsWith:{FIRE:t=>({effects:[{type:"Damage",target:"area",amount:3,reason:"oil_explosion"},{type:"Juice",effect:"explosion_ring",target:t.tile.position}],messages:["Oil explodes!"],modifyTile:{effects:t.tile.effects.filter(i=>i.id!=="OIL")}})}},STEAM:{id:"STEAM",name:"Steam",description:"Obscuring steam cloud"},BLESSED:{id:"BLESSED",name:"Blessed",description:"Holy ground"},CURSED:{id:"CURSED",name:"Cursed",description:"Unholy ground"},ICE_WALL:{id:"ICE_WALL",name:"Ice Wall",description:"A wall of ice"},SMOKE:{id:"SMOKE",name:"Smoke",description:"Thick smoke"},BOMB_TICK:{id:"BOMB_TICK",name:"Bomb Tick",description:"About to explode"},TRI_TRAP:{id:"TRI_TRAP",name:"Kinetic Trap",description:"Hidden trap that flings non-flying units outward"},SNARE:{id:"SNARE",name:"Snare",description:"Entangling roots that halt movement and root the target.",onPass:t=>t.actor.isFlying?{effects:[],messages:[]}:{effects:[{type:"ApplyStatus",target:t.actor.id,status:"rooted",duration:2}],messages:["Snared! Movement halted."],interrupt:!0,newMomentum:0}}},Pe={getTileAt(t,i){const a=de(i);let o;return t.tiles&&(t.tiles instanceof Map?o=t.tiles.get(a):Array.isArray(t.tiles)?o=t.tiles.find(c=>Array.isArray(c)&&c[0]===a||c.position&&J(c.position,i)):o=t.tiles[a]),o||{position:i,baseId:"STONE",traits:new Set(["WALKABLE"]),effects:[]}},getTraitsForTile(t,i){const a=new Set,o=i.position;return Ws(o,t.gridWidth,t.gridHeight)?(i.baseId==="LAVA"&&(a.add("HAZARDOUS"),a.add("LIQUID"),a.add("LAVA")),i.baseId==="WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),i.traits.forEach(r=>a.add(r)),i.effects.forEach(r=>{r.id==="FIRE"&&(a.add("FIRE"),a.add("HAZARDOUS")),r.id==="ICE_WALL"&&(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR")),r.id==="SMOKE"&&a.add("BLOCKS_LOS")}),a):(a.add("BLOCKS_MOVEMENT"),a.add("BLOCKS_LOS"),a.add("ANCHOR"),a)},getTraitsAt(t,i){const a=this.getTileAt(t,i);return this.getTraitsForTile(t,a)},isPassable(t,i){const a=this.getTraitsAt(t,i);return!a.has("BLOCKS_MOVEMENT")&&!a.has("HAZARDOUS")},isWalkable(t,i){return!this.getTraitsAt(t,i).has("BLOCKS_MOVEMENT")},isLosBlocking(t,i){return this.getTraitsAt(t,i).has("BLOCKS_LOS")},isAnchorable(t,i){return this.getTraitsAt(t,i).has("ANCHOR")},hasTrait(t,i,a){return this.getTraitsAt(t,i).has(a)}};class Aa{static mergeResults(i,a){i.effects.push(...a.effects),i.messages.push(...a.messages),a.newMomentum!==void 0&&(i.newMomentum=a.newMomentum),a.interrupt&&(i.interrupt=!0),a.modifyTile&&(i.modifyTile={...i.modifyTile,...a.modifyTile})}static processEntry(i,a,o){const c={effects:[],messages:[],interrupt:!1},r={tile:a,actor:i,state:o,isFinalDestination:!0,source:i.previousPosition},f=Pe.getTraitsForTile(o,a);f.has("HAZARDOUS")&&!i.isFlying&&(a.baseId==="LAVA"||f.has("LAVA")?this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"lava_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Lava Sink! You were engulfed by lava!"],interrupt:!0}):(a.baseId==="VOID"||f.has("VOID"))&&this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:99,reason:"void_sink"},{type:"Juice",effect:"lavaSink",target:i.position}],messages:["Void consumes your soul!"],interrupt:!0}));for(const g of a.effects){const b=Pr[g.id];if(!b?.onEnter)continue;const y=b.onEnter(r);if(this.mergeResults(c,y),c.interrupt)break}return c.messages.length===0&&c.effects.some(g=>g.type==="LavaSink")&&c.messages.push("Lava Sink! You were engulfed by lava!"),c}static processTransition(i,a,o,c,r={}){const{ignoreActors:f=!1,ignoreGroundHazards:g=!1}=r,b={effects:[],messages:[],newMomentum:c!==void 0?Math.max(0,c-1):void 0,interrupt:!1},y=Pe.getTraitsForTile(o,a);if(y.has("BLOCKS_MOVEMENT")||!f&&(o.enemies.find(x=>x.id!==i.id&&x.hp>0&&J(x.position,a.position))||(i.id!==o.player.id&&J(o.player.position,a.position)?o.player:void 0)))return b.interrupt=!0,b.newMomentum=0,b;const A={tile:a,actor:i,state:o,momentum:c,isFinalDestination:!1,source:i.previousPosition};y.has("HAZARDOUS")&&!i.isFlying&&!g?this.mergeResults(b,{effects:[{type:"Damage",target:i.id,amount:99,reason:"hazard_intercept"},{type:"Juice",effect:"lavaSink",target:a.position}],messages:[a.baseId==="LAVA"||y.has("LAVA")?"Sunk in Lava!":"Consumed by Void!"],interrupt:!0}):y.has("SLIPPERY")?b.newMomentum=Math.max(1,c||0):y.has("LIQUID")&&c!==void 0&&c>0&&(b.newMomentum=Math.max(0,c-1));for(const v of a.effects){const x=Pr[v.id];if(!x?.onPass)continue;const E=x.onPass(A);if(this.mergeResults(b,E),b.interrupt)break}if(!b.interrupt&&!i.isFlying&&!g&&o.traps){const v=o.traps.find(x=>J(x.position,a.position)&&x.cooldown===0&&x.ownerId!==i.id);if(v){const x=a.position.q-v.position.q||1,E=a.position.r-v.position.r||0;let m=0;x>0&&E===0?m=0:x>0&&E<0?m=1:x===0&&E<0?m=2:x<0&&E===0?m=3:x<0&&E>0?m=4:m=5;const h=3;let R=a.position;const B=(_=>[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0},{q:0,r:1,s:-1}][_%6])(m);for(let _=0;_<h;_++){const w={q:R.q+B.q,r:R.r+B.r,s:R.s+B.s};if(!Pe.isWalkable(o,w))break;R=w}this.mergeResults(b,{effects:[{type:"Displacement",target:i.id,destination:R,source:a.position,isFling:!0},{type:"Juice",effect:"kineticWave",target:a.position,intensity:"high"},{type:"Juice",effect:"combat_text",target:a.position,text:"TRAP!"}],messages:[`${i.subtype||"Unit"} triggered a kinetic trap!`],interrupt:!0})}}return b}static processStay(i,a,o){const c={effects:[],messages:[]},r={tile:a,actor:i,state:o,isFinalDestination:!1},f=Pe.getTraitsForTile(o,a);if((a.baseId==="LAVA"||f.has("LAVA"))&&!i.isFlying&&!i.statusEffects.some(g=>g.type==="fire_immunity")){const g=i.id==="player";this.mergeResults(c,{effects:[{type:"Damage",target:i.id,amount:g?1:99,reason:"lava_tick"}],messages:["Lava Sink! You were engulfed by lava!"]})}for(const g of a.effects){const b=Pr[g.id];if(!b?.onStay)continue;const y=b.onStay(r);this.mergeResults(c,y)}return c}static applyEffect(i,a,o,c,r,f){const g=Pr[a];if(!g)return{effects:[],messages:[]};const b={effects:[],messages:[]};for(const y of i.effects){const A=g.interactsWith?.[y.id];if(A){const v=A({tile:i,state:r,potency:c,sourceId:f});return this.mergeResults(b,v),b}}if(g.onApply){const y=g.onApply({tile:i,state:r,potency:c,sourceId:f});this.mergeResults(b,y)}return b.modifyTile?.effects?b.modifyTile&&(i.effects=b.modifyTile.effects):i.effects.push({id:a,duration:o,potency:c,sourceId:f}),b}static processPath(i,a,o,c,r={}){let f=i.position,g=c,b={effects:[],messages:[],newMomentum:c,interrupt:!1};for(const y of a){const A=Pe.getTileAt(o,y),v=Pe.getTraitsForTile(o,A),x=this.processTransition(i,A,o,g,r);if(x.interrupt&&v.has("BLOCKS_MOVEMENT")){b.interrupt=!0;break}if(f=y,this.mergeResults(b,x),b.interrupt){b.interrupt=!0;break}if(g=b.newMomentum,g!==void 0&&g<=0)break}return{lastValidPos:f,result:b,interrupt:!!b.interrupt}}static getMovementCost(i,a){const o=Pe.getTraitsForTile(i,a);let c=1;return o.has("HAZARDOUS")&&(c+=5),o.has("LIQUID")&&(c+=1),o.has("FIRE")&&(c+=2),c}}const Fb=(t,i)=>Array(i).fill(0n),vd=(t,i,a)=>{if(!Number.isInteger(i.q)||!Number.isInteger(i.r))return[...t];if(i.r<0||i.r>=t.length||i.q<0)return[...t];const o=[...t];return o[i.r]|=1n<<BigInt(i.q),o},Hd=(t,i)=>i.r<0||i.r>=t.length?!0:(t[i.r]&1n<<BigInt(i.q))!==0n,Gh=(t,i)=>{if(i.playerStart&&J(t,i.playerStart)||i.stairsPosition&&J(t,i.stairsPosition)||i.shrinePosition&&J(t,i.shrinePosition))return!0;if(i.tiles){const a=Pe.getTraitsAt(i,t);if(a.has("HAZARDOUS")||a.has("BLOCKS_MOVEMENT"))return!0}return!1},Ki=(t,i)=>{if(t)return t.find(a=>a&&a.position&&J(a.position,i))},Ae=(t,i)=>J(t.player.position,i)?t.player:Ki(t.enemies,i),Gb=(t,i)=>!!t.shrinePosition&&J(i,t.shrinePosition),Wb=(t,i)=>!(!J(i,t.stairsPosition)||t.enemies.some(o=>o.subtype==="sentinel"&&o.hp>0)),Xb=(t,i,a)=>{if(t.q===0||t.q===i-1||t.r===0||t.r===a-1)return!0;const o=t.q+t.r,c=Math.floor(i/2),r=i-1+(a-1)-c;return o===c||o===r},Qb=(t,i,a,o)=>{const c=_e(a,o);if(c===0)return[];const r=(o.q-a.q)/c,f=(o.r-a.r)/c,g=(o.s-a.s)/c,b=[],y=new Set,A=2;for(let v=1;v<=A;v++){const x={q:o.q+Math.round(r*v),r:o.r+Math.round(f*v),s:o.s+Math.round(g*v)};if(Ws(x,t.gridWidth,t.gridHeight)){const E=`${x.q},${x.r}`;y.has(E)||(y.add(E),b.push(x))}}return b},Ze={getNeighbors(t){return xt(t)},isTileBlocked(t,i){return!t.occupancyMask||t.occupancyMask.length===0?!1:Hd(t.occupancyMask,i)},refreshOccupancyMask(t){let i=Fb(t.gridWidth,t.gridHeight);return t.tiles?.forEach(a=>{(a.baseId==="WALL"||a.traits?.has("BLOCKS_MOVEMENT"))&&(i=vd(i,a.position))}),t.player&&(i=vd(i,t.player.position)),t.enemies?.forEach(a=>{i=vd(i,a.position)}),i},getMovementRange(t,i,a){const o=new Map,c=[],r=b=>`${b.q},${b.r}`,f=Ae(t,i),g=[{p:i,cost:0}];for(o.set(r(i),0);g.length;){const b=g.shift();if(!(b.cost>=a))for(const y of this.getNeighbors(b.p)){if(!this.isWithinBounds(t,y)||!Pe.isWalkable(t,y))continue;const A=Ae(t,y),v=A&&!J(y,i),x=v&&f&&A.factionId===f.factionId;if(v&&!x)continue;const E=r(y),m=b.cost+1;(!o.has(E)||o.get(E)>m)&&(o.set(E,m),x||c.push(y),g.push({p:y,cost:m}))}}return c},getAxialTargets(t,i,a,o={}){const{includeWalls:c=!1,includeActors:r=!0,stopAtObstacles:f=!0}=o,g=[];for(let b=0;b<6;b++)for(let y=1;y<=a;y++){const A=jn(i,Jd(b,y));if(!this.isWithinBounds(t,A))break;const x=Pe.getTileAt(t,A)?.baseId==="WALL",E=Ae(t,A);if(x){if(c&&g.push(A),f)break}else if(E){if(r&&g.push(A),f)break}else g.push(A)}return g},getAreaTargets(t,i,a){const o=[];for(let c=-a;c<=a;c++)for(let r=Math.max(-a,-c-a);r<=Math.min(a,-c+a);r++){const f=jn(i,In(c,r));this.isWithinBounds(t,f)&&o.push(f)}return o},isWithinBounds(t,i){return Ws(i,t.gridWidth,t.gridHeight)},getAxialTargetsWithOptions(t,i,a,o){return this.getAxialTargets(t,i,a,o)}},Wh=(t,i)=>{const a=i.q-t.q,o=i.r-t.r;return a>0&&o===0?0:a>0&&o<0?1:a===0&&o<0?2:a<0&&o===0?3:a<0&&o>0?4:5},ri=(t,i,a,o=[],c)=>{if(Kb(t))return{position:t.position,state:a};const r=Ze.getNeighbors(t.position);let f=[],g=c!==void 0?Math.abs(_e(t.position,i)-c):_e(t.position,i);for(const v of r){if(!Ze.isWithinBounds(a,v))continue;const x=a.tiles.get(de(v)),E=x?.traits.has("BLOCKS_LOS")||x?.baseId==="WALL",m=o.some(B=>J(B,v))||a.enemies.some(B=>B.id!==t.id&&J(B.position,v))||J(v,i);if(E||m)continue;const h=x?Aa.getMovementCost(a,x):1,k=(c!==void 0?Math.abs(_e(v,i)-c):_e(v,i))+(h-1);k<g?(g=k,f=[v]):k===g&&f.push(v)}if(f.length===0)return{position:t.position,state:a};if(f.length===1)return{position:f[0],state:a};const{value:b,nextState:y}=Ea(a),A=Math.floor(b*f.length)%f.length;return{position:f[A],state:y}},Jb=(t,i,a)=>{if(_e(t.position,i)===1)return{entity:{...t,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};let c=t.position,r=a;for(let g=0;g<2&&!(_e(c,i)<=1);g++){const b={...t,position:c},{position:y,state:A}=ri(b,i,r,a.occupiedCurrentTurn);c=y,r=A}const f=!J(c,t.position);return{entity:{...t,position:c,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:r,message:f?`${t.subtype} moves to (${c.q}, ${c.r})`:void 0}},Zb=(t,i,a)=>{const o=_e(t.position,i),c=Wh(t.position,i);if(o===1)return{entity:{...t,facing:c,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=ri(t,i,a,a.occupiedCurrentTurn),g=!J(r,t.position);return{entity:{...t,position:r,facing:g?Wh(t.position,r):c,intent:g?"Advancing":"BASIC_ATTACK",intentPosition:g?void 0:{...i}},nextState:f,message:g?`${t.subtype} advances to (${r.q}, ${r.r})`:void 0}},eS=(t,i,a)=>{const o=_e(t.position,i);let c=a;const{value:r,nextState:f}=Ea(c);c=f;let g=t.position;if(o<=2||r<.3){const{value:v,nextState:x}=Ea(c);c=x;const{value:E,nextState:m}=Ea(c);c=m;const h=Math.floor(v*6),R=3+Math.floor(E*3);let k=t.position;for(let _=0;_<R;_++)k=jn(k,Cn(h));!Ze.isWithinBounds(a,k)||!Pe.isWalkable(a,k)||a.occupiedCurrentTurn?.some(_=>J(_,k))||a.enemies.some(_=>_.id!==t.id&&J(_.position,k))||J(k,i)||(g=k)}const b=!J(g,t.position),y=_e(g,i),A=!b&&y>=2&&y<=4;return{entity:{...t,position:g,intent:b?"Repositioning":A?"Casting":"Preparing",intentPosition:A?{...i}:void 0},nextState:c,message:b?`${t.subtype} teleports to (${g.q}, ${g.r})`:void 0}},tS=(t,i,a)=>{const o=_e(t.position,i);if(o===1)return{entity:{...t,isVisible:!0,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:c,state:r}=ri(t,i,a,a.occupiedCurrentTurn),f=!J(c,t.position);return{entity:{...t,position:c,isVisible:f?!1:o<=1,intent:f?"Moving":"BASIC_ATTACK",intentPosition:f?void 0:{...i}},nextState:r,message:f?"You hear footsteps nearby...":void 0}},nS={sentinel:{telegraphSkillId:"SENTINEL_TELEGRAPH",executeSkillId:"SENTINEL_BLAST",triggerRange:3,telegraphMessage:"The Sentinel marks the blast zone..."}},iS=(t,i,a,o)=>{const r=_e(t.position,i)<=o.triggerRange,f=a.turnNumber%2===0,g=!f;if(r&&g&&ji(t))return{entity:{...t,intent:"Preparing",intentPosition:void 0},nextState:a,message:`${t.subtype} loses focus!`};if(r&&f)return{entity:{...t,intent:o.telegraphSkillId,intentPosition:{...i}},nextState:a,message:o.telegraphMessage};if(r&&g)return{entity:{...t,intent:o.executeSkillId,intentPosition:{...i}},nextState:a};const{position:b,state:y}=ri(t,i,a,a.occupiedCurrentTurn);return{entity:{...t,position:b,intent:"Moving",intentPosition:void 0},nextState:y}},sS=(t,i,a)=>{const o=t.actionCooldown??0;if(o>0)return{entity:{...t,actionCooldown:o-1,intent:"Charging Power"},nextState:a};const c=_e(t.position,i);if(c>=1&&c<=3)return{entity:{...t,actionCooldown:2,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=ri(t,i,a,a.occupiedCurrentTurn),g=!J(r,t.position);return{entity:{...t,position:r,intent:g?"Lumbering":"Waiting",actionCooldown:0},nextState:f,message:g?`${t.subtype} lumbers to (${r.q}, ${r.r})`:void 0}},aS=(t,i,a)=>{const o=_e(t.position,i);if(o>4){const{position:A,state:v}=ri(t,i,a,a.occupiedCurrentTurn),x=!J(A,t.position);return{entity:{...t,position:A,intent:x?"Following":"Waiting"},nextState:v,message:x?`${t.subtype} follows you.`:void 0}}const c=a.enemies.filter(A=>A.factionId==="enemy").sort((A,v)=>_e(t.position,A.position)-_e(t.position,v.position))[0];if(!c){if(o>1){const{position:A,state:v}=ri(t,i,a,a.occupiedCurrentTurn);return{entity:{...t,position:A,intent:"Idle"},nextState:v}}return{entity:{...t,intent:"Idle"},nextState:a}}if(_e(t.position,c.position)===1)return{entity:{...t,intent:"BASIC_ATTACK",intentPosition:{...c.position}},nextState:a};const{position:f,state:g}=ri(t,c.position,a,a.occupiedCurrentTurn),b=!J(f,t.position),y=_e(f,c.position);return{entity:{...t,position:f,intent:b?"Advancing":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...c.position}},nextState:g,message:b?`${t.subtype} attacks ${c.subtype}!`:void 0}},oS=(t,i,a)=>{if(t.factionId==="player")return aS(t,i,a);if((a.player.stealthCounter||0)>0)return{entity:{...t,intent:"Searching",intentPosition:void 0},nextState:a};const c=_e(t.position,i);switch(t.subtype){case"sprinter":return Jb(t,i,a);case"shieldBearer":return Zb(t,i,a);case"warlock":return eS(t,i,a);case"assassin":return tS(t,i,a);case"golem":return sS(t,i,a);case"sentinel":return iS(t,i,a,nS.sentinel);case"raider":{if((t.position.q===i.q||t.position.r===i.r||t.position.s===i.s)&&c>=2&&c<=4)return{entity:{...t,intent:"DASH",intentPosition:{...i}},nextState:a};const{position:f,state:g}=ri(t,i,a,a.occupiedCurrentTurn),b=!J(f,t.position),y=_e(f,i);return{entity:{...t,position:f,intent:b?"Moving":y===1?"BASIC_ATTACK":"Waiting",intentPosition:b||y>1?void 0:{...i}},nextState:g,message:b?`${t.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"pouncer":{if((t.position.q===i.q||t.position.r===i.r||t.position.s===i.s)&&c>=2&&c<=4)return{entity:{...t,intent:"GRAPPLE_HOOK",intentPosition:{...i}},nextState:a};const{position:f,state:g}=ri(t,i,a,a.occupiedCurrentTurn),b=!J(f,t.position);return{entity:{...t,position:f,intent:b?"Moving":"Waiting",intentPosition:void 0},nextState:g,message:b?`${t.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"archer":{if((t.position.q===i.q||t.position.r===i.r||t.position.s===i.s)&&c>1&&c<=4)return{entity:{...t,intent:"SPEAR_THROW",intentPosition:{...i}},nextState:a};const{position:f,state:g}=ri(t,i,a,a.occupiedCurrentTurn),b=!J(f,t.position);return{entity:{...t,position:f,intent:b?"Moving":"Idle",intentPosition:void 0},nextState:g,message:b?`${t.subtype} moves to (${f.q}, ${f.r})`:void 0}}case"bomber":{const r=t.actionCooldown??0;if(r===0&&c>=2&&c<=3){const A=Ze.getNeighbors(i).filter(v=>{const x=!Pe.isWalkable(a,v),E=a.enemies.some(m=>J(m.position,v));return Ze.isWithinBounds(a,v)&&!x&&!E&&!J(v,i)});if(A.length>0){const{value:v,nextState:x}=Ea(a),E=Math.floor(v*A.length)%A.length,m=A[E];return{entity:{...t,intent:"Bombing",intentPosition:m,actionCooldown:2},nextState:x}}}const{position:g,state:b}=ri(t,i,a,a.occupiedCurrentTurn,2.5),y=!J(g,t.position);return{entity:{...t,position:g,intent:y?"Moving":"Waiting",intentPosition:void 0,actionCooldown:Math.max(0,r-1)},nextState:b,message:y?`${t.subtype} repositioning to (${g.q}, ${g.r})`:void 0}}default:{if(c===1)return{entity:{...t,intent:"BASIC_ATTACK",intentPosition:{...i}},nextState:a};const{position:r,state:f}=ri(t,i,a,a.occupiedCurrentTurn),g=!J(r,t.position),b=_e(r,i);return{entity:{...t,position:r,intent:g?"Moving":b===1?"BASIC_ATTACK":"Waiting",intentPosition:g||b>1?void 0:{...i}},nextState:f,message:g?`${t.subtype} moves to (${r.q}, ${r.r})`:void 0}}}},uo=9,yl=11,ee=36,Xh={speed:1},lS={stunned:{tickWindow:"START_OF_TURN"},poisoned:{tickWindow:"START_OF_TURN"},armored:{tickWindow:"END_OF_TURN"},hidden:{tickWindow:"END_OF_TURN"},time_bomb:{tickWindow:"END_OF_TURN"}},Pd={footman:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},sprinter:{hp:1,maxHp:1,range:1,damage:1,type:"melee",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:1,weightClass:"Standard",speed:2},raider:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","DASH"],actionCooldown:1,weightClass:"Standard",speed:1},pouncer:{hp:1,maxHp:1,range:4,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],actionCooldown:1,weightClass:"Standard",speed:1},shieldBearer:{hp:2,maxHp:2,range:1,damage:1,type:"melee",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],actionCooldown:2,weightClass:"Heavy",speed:1},archer:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK","SPEAR_THROW"],actionCooldown:3,weightClass:"Standard",speed:1},bomber:{hp:1,maxHp:1,range:3,damage:1,type:"ranged",cost:1,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},warlock:{hp:1,maxHp:1,range:4,damage:1,type:"ranged",cost:2,skills:["BASIC_MOVE","BASIC_ATTACK"],actionCooldown:2,weightClass:"Standard",speed:1},sentinel:{hp:30,maxHp:30,range:4,damage:2,type:"boss",cost:25,skills:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_BLAST"],actionCooldown:1,weightClass:"Heavy",speed:1}},rS=.17,Qh=[0,2,3,5,7,10,12,15,18,22,25],Ur={floor:"#6b7b3c",wall:"#374151",shrine:"#f97316",portal:"#ffffff"},cS={1:"catacombs",2:"catacombs",3:"inferno",4:"inferno",5:"throne",6:"frozen",7:"frozen",8:"frozen",9:"void",10:"void"},xd={1:["footman"],2:["footman","sprinter"],3:["footman","archer"],4:["footman","archer","bomber","raider"],5:["footman","archer","bomber","shieldBearer","raider"],6:["footman","archer","bomber","shieldBearer","warlock","pouncer"],7:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],8:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],9:["footman","archer","bomber","shieldBearer","warlock","sprinter","pouncer"],10:["sentinel"]},Ys=(t,i)=>{let a=i,o=t.temporaryArmor||0,c=t.hp;if(o>0){const r=Math.min(o,a);o-=r,a-=r}return c=Math.max(0,c-a),{...t,hp:c,temporaryArmor:o}},Ud=(t,i,a,o)=>{const r=lS[i]?.tickWindow||"END_OF_TURN",f=i.toUpperCase();if(t.statusEffects.find(y=>y.id===f))return{...t,statusEffects:t.statusEffects.map(y=>y.id===f?{...y,duration:Math.max(y.duration,a),tickWindow:r,stacks:o||y.stacks}:y)};const b={id:f,type:i,duration:a,tickWindow:r,stacks:o||1};return{...t,statusEffects:[...t.statusEffects,b]}},uS=(t,i)=>({...t,hp:Math.min(t.maxHp,t.hp+i)}),dS=(t,i,a=!0)=>{const o=t.maxHp+i,c=a?Math.min(o,t.hp+i):t.hp;return{...t,maxHp:o,hp:c}},fS=t=>{const i=[];return t.player.hp<=0&&t.gameStatus==="playing"&&i.push({type:"GameOver",reason:"PLAYER_DIED"}),i},mS=t=>t.activeSkills?{...t,activeSkills:t.activeSkills.map(i=>({...i,currentCooldown:Math.max(0,i.currentCooldown-1)}))}:t,pS=(t,i,a)=>t.activeSkills?{...t,activeSkills:t.activeSkills.map(o=>o.id===i&&!o.activeUpgrades.includes(a)?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}:t;function qd(t,i){return t?.get(i)}const Ad=(t,i,a)=>Math.max(i,Math.min(a,t)),rl=t=>Math.round(t*1e3)/1e3,Zd=t=>{const i=Math.max(0,t.body),a=Math.max(0,t.mind),o=Math.max(0,t.instinct);return{bodyDamageMultiplier:rl(1+i/20),bodyMitigation:rl(Ad(i*.01,0,.5)),mindStatusDurationBonus:Math.floor(a/15),mindMagicMultiplier:rl(1+a/20),instinctInitiativeBonus:o*2,instinctCriticalMultiplier:rl(1+Ad(o,0,10)*.02),instinctSparkDiscountMultiplier:rl(1-Ad(o,0,100)/100)}},uc=t=>{const i=Math.max(0,t.body),a=Math.max(0,t.mind),o=Math.max(0,t.instinct),c={base:0,body:5,mind:2,instinct:3},r=Math.floor(i*c.body+a*c.mind+o*c.instinct+c.base);return Math.max(1,r)},wn=(t,i,a)=>Math.max(i,Math.min(a,t)),tn=t=>Math.round(t*1e3)/1e3,hS=()=>globalThis?.process?.env?.HOP_COMBAT_INTERACTION_MODEL,gS=t=>t.length===0?1:t.reduce((i,a)=>i*a.multiplier,1),yS=t=>{let i=1;if(t.inDangerPreviewHex&&(i+=.15),typeof t.proximityDistance=="number"){const a=wn(t.proximityDistance,0,6);i+=(6-a)*.02}return i},bS=(t,i,a,o,c,r,f,g)=>{if(!i)return{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1};const b=a==="physical"?.85+t.instinct*.015+t.body*.005:.85+t.mind*.015+t.instinct*.005,y=a==="physical"?i.instinct*.012+i.body*.004:i.instinct*.008+i.mind*.008,A=wn(b-y,.1,.99);if(typeof o!="number")return{multiplier:A,pressure:tn(b-y),rangePressure:0,rangeMultiplier:1};const v={min:wn(c??(a==="physical"?1:2),1,6),max:wn(r??(a==="physical"?2:4),1,6)};if(v.max<v.min){const j=v.min;v.min=v.max,v.max=j}const x={min:wn(f??(a==="physical"?1:2),1,6),max:wn(g??(a==="physical"?3:5),1,6)};if(x.max<x.min){const j=x.min;x.min=x.max,x.max=j}const E=wn(o,1,6),m=Math.max(0,v.min-E),h=Math.max(0,E-v.max),R=m*.06+h*.1,k=t.instinct*.015,B=(E>=x.min&&E<=x.max?.05:0)+i.instinct*.006,_=k-R-B,w=wn(1+_,.55,1.25);return{multiplier:wn(A*w,.05,.99),pressure:tn(b-y),rangePressure:tn(_),rangeMultiplier:tn(w)}},SS=(t,i)=>{if(!t)return{multiplier:1,pressure:0};const a=wn(i==="physical"?t.body*.01+t.instinct*.004:t.mind*.01+t.instinct*.004,0,.75);return{multiplier:1-a,pressure:tn(a)}},vS=(t,i,a,o)=>{if(!i)return{multiplier:o,critPressure:0,resistancePressure:0};const c=wn(a==="physical"?.05+t.instinct*.01:.05+t.mind*.01,0,.75),r=wn(a==="physical"?i.body*.006+i.instinct*.004:i.mind*.006+i.instinct*.004,0,.7);return{multiplier:1+wn(c-r,0,.75)*(o-1),critPressure:tn(c),resistancePressure:tn(r)}},xS=(t,i,a,o,c)=>{const r=t.scaling.filter(v=>v.attribute==="body").reduce((v,x)=>v+(t.trinity.body||0)*x.coefficient,0),f=t.scaling.filter(v=>v.attribute==="mind").reduce((v,x)=>v+(t.trinity.mind||0)*x.coefficient,0),g=t.scaling.filter(v=>v.attribute==="instinct").reduce((v,x)=>v+(t.trinity.instinct||0)*x.coefficient,0),b=t.damageClass==="physical"?Math.max(0,t.basePower*(i.bodyDamageMultiplier-1)):0,y=t.damageClass==="magical"?Math.max(0,t.basePower*(i.mindMagicMultiplier-1)):0,A=Math.max(0,(c-1)*(a+o));return{body:Math.max(0,b+r),mind:Math.max(0,y+f),instinct:Math.max(0,g+A)}},AS=(t,i)=>{if(t<=0)return t;const a=Zd(i).mindStatusDurationBonus;return t+a},TS=t=>Zd(t).instinctInitiativeBonus,gn=t=>{const i=Zd(t.trinity),a=t.damageClass||"physical",o=hS()==="triangle"?"triangle":"legacy",c=t.interactionModel||o,r=a==="magical"?i.mindMagicMultiplier:i.bodyDamageMultiplier,f=t.basePower*r,g=t.scaling.reduce((L,W)=>{const Z=t.trinity[W.attribute]||0;return L+Z*W.coefficient},0),b=gS(t.statusMultipliers),y=yS(t),A=i.instinctCriticalMultiplier,v=c==="triangle"?bS(t.trinity,t.targetTrinity,a,t.engagementRange,t.optimalRangeMin,t.optimalRangeMax,t.targetOptimalRangeMin,t.targetOptimalRangeMax):{multiplier:1,pressure:0,rangePressure:0,rangeMultiplier:1},x=c==="triangle"?SS(t.targetTrinity,a):{multiplier:1,pressure:0},E=c==="triangle"?vS(t.trinity,t.targetTrinity,a,A):{multiplier:A,critPressure:0,resistancePressure:0},m=(f+g)*b*y*v.multiplier*x.multiplier*E.multiplier*(t.attackPowerMultiplier??1)*(t.targetDamageTakenMultiplier??1),h=Math.max(0,Math.floor(m)),R=xS(t,i,f,g,A),k=Math.max(1e-6,R.body+R.mind+R.instinct),B=tn(R.body/k),_=tn(R.mind/k),w=tn(R.instinct/k),H=Math.max(1,t.theoreticalMaxPower??m),j=wn(h/H,0,1);return{basePower:t.basePower,bodyScaledPower:tn(f),scalingPower:tn(g),statusMultiplier:tn(b),riskMultiplier:tn(y),criticalMultiplier:tn(A),hitMultiplier:tn(v.multiplier),rangeMultiplier:tn(v.rangeMultiplier),mitigationMultiplier:tn(x.multiplier),critExpectedMultiplier:tn(E.multiplier),finalPower:h,bodyContribution:B,mindContribution:_,instinctContribution:w,scoreEvent:{skillId:t.skillId,attackerId:t.attackerId,targetId:t.targetId,finalPower:h,efficiency:tn(j),riskBonusApplied:!!t.inDangerPreviewHex,damageClass:a,hitPressure:v.pressure,rangePressure:v.rangePressure,mitigationPressure:x.pressure,critPressure:E.critPressure,resistancePressure:E.resistancePressure,bodyContribution:B,mindContribution:_,instinctContribution:w}}},Qe=t=>{const i=qd(t.components,"trinity");if(i)return{body:i.body,mind:i.mind,instinct:i.instinct};const a=qd(t.components,"stats"),o=a?.strength??0,c=a?.defense??0,r=a?.evasion??0;return{body:o,mind:c,instinct:r}},Jh={player:100,footman:50,archer:60,shieldBearer:40,bomber:30,warlock:55,bomb:10},zd=t=>{let i=t.speed;if(i===void 0){const o=t.subtype;i=t.type==="player"?Jh.player:Jh[o]??50}return t.statusEffects?.some(o=>o.type==="stunned")&&(i-=100),i+=TS(Qe(t)),i},Ma=t=>{const i=[];i.push({actorId:t.player.id,initiative:zd(t.player),hasActed:!1,turnStartPosition:void 0});for(const a of t.enemies)i.push({actorId:a.id,initiative:zd(a),hasActed:!1,turnStartPosition:void 0});return i.sort((a,o)=>o.initiative!==a.initiative?o.initiative-a.initiative:a.actorId==="player"?-1:o.actorId==="player"?1:a.actorId.localeCompare(o.actorId)),{entries:i,currentIndex:-1,round:1}},ES=t=>t.currentIndex<0||t.currentIndex>=t.entries.length?null:t.entries[t.currentIndex],_S=t=>{let i=t.initiativeQueue;i||(i=Ma(t));let a=i.currentIndex+1;for(;a<i.entries.length&&i.entries[a].hasActed;)a++;return a>=i.entries.length?(i=Ma(t),i.round=(t.initiativeQueue?.round??0)+1,a=0,{queue:{...i,currentIndex:a},actorId:i.entries[a]?.actorId??null,newRound:!0}):{queue:{...i,currentIndex:a},actorId:i.entries[a]?.actorId??null,newRound:!1}},wS=(t,i)=>{const a=t.initiativeQueue;if(!a)return Ma(t);const o=a.entries.map(c=>{if(c.actorId===i.id){if(c.turnStartPosition)return c;const f=xt(i.position).map(g=>Ae(t,g)?.id).filter(Boolean);return{...c,turnStartPosition:{...i.position},turnStartNeighborIds:f}}return c});return{...a,entries:o}},MS=(t,i)=>{const a=t.initiativeQueue;if(!a)return Ma(t);const o=a.entries.map(c=>c.actorId===i?{...c,hasActed:!0}:c);return{...a,entries:o}},OS=(t,i)=>{const a=t.initiativeQueue;return a?a.entries.find(c=>c.actorId===i)?.turnStartPosition??null:null},CS=(t,i)=>{const a=t.initiativeQueue;return a?a.entries.find(c=>c.actorId===i)?.turnStartNeighborIds??null:null},bl=t=>{const i=t.initiativeQueue;if(!i)return!0;if(i.currentIndex<0||i.currentIndex>=i.entries.length)return!1;const a=i.entries[i.currentIndex];return a.actorId===t.player.id&&!a.hasActed},Td=(t,i)=>{const a=t.entries.filter(r=>r.actorId!==i);let o=t.currentIndex;const c=t.entries.findIndex(r=>r.actorId===i);return c>=0&&c<t.currentIndex&&o--,{...t,entries:a,currentIndex:Math.min(o,a.length-1)}},NS=(t,i)=>{const a={actorId:i.id,initiative:zd(i),hasActed:!0,turnStartPosition:void 0};return{...t,entries:[...t.entries,a]}},an={body:0,mind:0,instinct:0},RS=t=>({body:t.body,mind:t.mind,instinct:t.instinct}),co=t=>{const i={};for(const[a,o]of Object.entries(t))i[a]=RS(o);return i},kS={neutral:{id:"neutral",default:an,archetype:co({VANGUARD:an,SKIRMISHER:an,FIREMAGE:an,NECROMANCER:an,HUNTER:an,ASSASSIN:an}),enemySubtype:co({footman:an,sprinter:an,raider:an,pouncer:an,shieldBearer:an,archer:an,bomber:an,warlock:an,sentinel:an}),companionSubtype:co({falcon:an,skeleton:an})},live:{id:"live",default:an,archetype:co({VANGUARD:{body:9,mind:4,instinct:5},SKIRMISHER:{body:7,mind:6,instinct:10},FIREMAGE:{body:2,mind:9,instinct:4},NECROMANCER:{body:5,mind:9,instinct:5},HUNTER:{body:3,mind:4,instinct:8},ASSASSIN:{body:3,mind:3,instinct:9}}),enemySubtype:co({footman:{body:0,mind:0,instinct:0},sprinter:{body:0,mind:0,instinct:0},raider:{body:.4,mind:0,instinct:.2},pouncer:{body:.4,mind:0,instinct:.2},shieldBearer:{body:1,mind:0,instinct:.4},archer:{body:.2,mind:0,instinct:.2},bomber:{body:.4,mind:.2,instinct:.2},warlock:{body:.4,mind:.6,instinct:.2},sentinel:{body:4,mind:2,instinct:2}}),companionSubtype:co({falcon:{body:2,mind:2,instinct:9},skeleton:{body:15,mind:1,instinct:4}})}},LS=t=>t?.toLowerCase()==="neutral"?"neutral":"live",BS=()=>globalThis?.process?.env?.HOP_TRINITY_PROFILE,IS=t=>kS[LS(BS())],Ii={outgoingPhysical:1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},jS={VANGUARD:Ii,SKIRMISHER:Ii,FIREMAGE:Ii,NECROMANCER:Ii,HUNTER:Ii,ASSASSIN:Ii},DS={footman:{outgoingPhysical:3,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},sprinter:{outgoingPhysical:2.8,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},raider:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},pouncer:{outgoingPhysical:3.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},shieldBearer:{outgoingPhysical:3.5,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},archer:{outgoingPhysical:2.6,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},bomber:{outgoingPhysical:2.8,outgoingMagical:3,incomingPhysical:1,incomingMagical:1},warlock:{outgoingPhysical:1.5,outgoingMagical:3.5,incomingPhysical:1,incomingMagical:1},sentinel:{outgoingPhysical:4,outgoingMagical:4,incomingPhysical:1,incomingMagical:1}},HS={falcon:{outgoingPhysical:1.2,outgoingMagical:1,incomingPhysical:1,incomingMagical:1},skeleton:{outgoingPhysical:1.1,outgoingMagical:1,incomingPhysical:1,incomingMagical:1}},Sl=t=>({outgoingPhysical:t.outgoingPhysical,outgoingMagical:t.outgoingMagical,incomingPhysical:t.incomingPhysical,incomingMagical:t.incomingMagical}),Qg=t=>t.type==="player"?Sl(jS[(t.archetype||"VANGUARD").toUpperCase()]||Ii):t.companionOf&&t.subtype?Sl(HS[t.subtype]||Ii):t.subtype?Sl(DS[t.subtype]||Ii):Sl(Ii),Jg=t=>{const i=qd(t.components,"combat_profile");return i?{outgoingPhysical:Number.isFinite(i.outgoingPhysical)?i.outgoingPhysical:1,outgoingMagical:Number.isFinite(i.outgoingMagical)?i.outgoingMagical:1,incomingPhysical:Number.isFinite(i.incomingPhysical)?i.incomingPhysical:1,incomingMagical:Number.isFinite(i.incomingMagical)?i.incomingMagical:1}:Sl(Ii)},PS=(t,i)=>{const a=Jg(t);return i==="magical"?a.outgoingMagical:a.outgoingPhysical},US=(t,i)=>{const a=Jg(t);return i==="magical"?a.incomingMagical:a.incomingPhysical},cl=t=>({body:t.body,mind:t.mind,instinct:t.instinct}),Zg=t=>{if(t.trinity)return cl(t.trinity);const i=IS(),a=i.default;if(t.type==="player"){const o=(t.archetype||"VANGUARD").toUpperCase();return cl(i.archetype[o]||a)}if(t.companionOf&&t.subtype){const o=t.subtype;if(i.companionSubtype[o])return cl(i.companionSubtype[o])}return t.subtype?cl(i.enemySubtype[t.subtype]||a):cl(a)},vl=t=>{const i=new Map(t.components||[]),a=i.has("trinity"),o=i.has("combat_profile");if(a&&o)return t;const c=Zg({id:t.id,type:t.type,subtype:t.subtype,position:t.position,hp:t.hp,maxHp:t.maxHp,speed:t.speed,factionId:t.factionId,archetype:t.archetype,companionOf:t.companionOf}),r=Qg({type:t.type,archetype:t.archetype,subtype:t.subtype,companionOf:t.companionOf});return a||i.set("trinity",{type:"trinity",...c}),o||i.set("combat_profile",{type:"combat_profile",...r}),{...t,components:i}};function qS(t){return t.map(i=>({id:i,name:String(i),description:String(i),slot:"utility",cooldown:0,currentCooldown:0,range:0,upgrades:[],activeUpgrades:[]}))}function Gs(t){const i=t.activeSkills?[...t.activeSkills]:qS(t.skills||[]),a=new Map(t.components||[]),o=Zg(t),c=t.combatProfile||Qg(t);a.has("trinity")||a.set("trinity",{type:"trinity",...o}),a.has("combat_profile")||a.set("combat_profile",{type:"combat_profile",...c});const r=uc(o),f=Math.max(1,t.maxHp??r),g=Math.min(f,Math.max(0,t.hp??f));return t.weightClass&&a.set("physics",{type:"physics",weightClass:t.weightClass}),t.archetype&&a.set("archetype",{type:"archetype",archetype:t.archetype}),{id:t.id,type:t.type,subtype:t.subtype,position:t.position,hp:g,maxHp:f,speed:t.speed,factionId:t.factionId,initiative:t.initiative,statusEffects:[],temporaryArmor:0,activeSkills:i,weightClass:t.weightClass,archetype:t.archetype,components:a,isFlying:t.isFlying,companionOf:t.companionOf,isVisible:!0}}function zS(t){const i=Gs({id:t.id,type:"enemy",subtype:t.subtype,position:t.position,hp:t.hp,maxHp:t.maxHp,speed:t.speed,factionId:"enemy",skills:t.skills,weightClass:t.weightClass||"Standard",trinity:t.trinity});return i.enemyType=t.enemyType,i}function ey(t){if(t.companionType==="falcon"){const i=Gs({id:t.id||`falcon-${t.ownerId}`,type:"enemy",subtype:"falcon",position:t.position,speed:95,factionId:"player",skills:["BASIC_MOVE","FALCON_PECK","FALCON_APEX_STRIKE","FALCON_HEAL","FALCON_SCOUT","FALCON_AUTO_ROOST"],weightClass:"Light",isFlying:!0,companionOf:t.ownerId,trinity:t.trinity});return i.companionState={mode:"roost",orbitStep:0},i}return t.companionType==="skeleton"?Gs({id:t.id||`${t.companionType}-${t.ownerId}`,type:"enemy",subtype:"skeleton",position:t.position,hp:2,maxHp:2,speed:50,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK"],companionOf:t.ownerId,weightClass:"Standard",trinity:t.trinity}):Gs({id:t.id||`${t.companionType}-${t.ownerId}`,type:"enemy",subtype:t.companionType,position:t.position,speed:80,factionId:"player",skills:["BASIC_MOVE","BASIC_ATTACK"],companionOf:t.ownerId,weightClass:"Standard",trinity:t.trinity})}function VS(t){return ey({companionType:"falcon",ownerId:t.ownerId,position:t.position})}function $S(t){const i=["BASIC_MOVE","BASIC_ATTACK"],a={footman:["AUTO_ATTACK"],sprinter:[],raider:["DASH"],pouncer:["GRAPPLE_HOOK"],shieldBearer:["SHIELD_BASH"],archer:["SPEAR_THROW"],bomber:["BOMB_TOSS"],warlock:[],sentinel:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"]};return[...i,...a[t]||[]]}const YS=/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*/i,KS=t=>YS.test(t),ef=(t,i="INFO",a="SYSTEM")=>t?KS(t)?t:`[${i}|${a}] ${t}`:"",FS=(t,i="INFO",a="SYSTEM")=>t.map(o=>ef(o,i,a)).filter(Boolean),Wt=(t,i,a,o,c=50)=>{const r=ef(i,a,o),f=[...t||[]];return r&&f[f.length-1]===r?f.slice(-c):[...f,r].slice(-c)},Yi=(t,i,a,o,c=50)=>{const r=[...t||[]];let f;for(const g of FS(i,a,o))g&&f===g||(r.push(g),f=g);return r.slice(-c)},Zh=(t,i,a)=>{const o=a.preserveInputOrder===!1?[...i]:[...i].reverse(),c=a.describe||(()=>"UNKNOWN");let r=t;const f=[];let g=a.startTick||1;for(;o.length>0;){const b=o.length,y=o.pop();r=a.apply(r,y);const A=a.getReactions?.(r,y)||[];if(A.length>0)for(let v=A.length-1;v>=0;v--)o.push(A[v]);f.push({tick:g++,effectType:c(y),depthBefore:b,depthAfter:o.length,reactionsQueued:A.length})}return{state:r,trace:f,resolvedCount:f.length}};var eg={};const ul=(t,i)=>{const a=de(i);let o=t;o.tiles===t.tiles&&(o={...o,tiles:new Map(o.tiles)});let c=o.tiles.get(a);return c?c={...c,traits:new Set(c.traits),effects:[...c.effects]}:c={baseId:"STONE",position:i,traits:new Set(mo.STONE.defaultTraits),effects:[]},c.traits.add("CORPSE"),o.tiles.set(a,c),o},GS=(t,i)=>{const a=de(i),o=t.tiles.get(a);if(!o||!o.traits.has("CORPSE"))return t;let c=t;c.tiles===t.tiles&&(c={...c,tiles:new Map(c.tiles)});const r={...o,traits:new Set(o.traits),effects:[...o.effects]};return r.traits.delete("CORPSE"),c.tiles.set(a,r),c},WS=typeof process<"u"&&(eg?.HOP_ENGINE_WARN==="1"||eg?.HOP_ENGINE_DEBUG==="1"),tg={INTENT_START:1,MOVE_START:2,MOVE_END:3,ON_PASS:4,ON_ENTER:5,HAZARD_CHECK:6,STATUS_APPLY:7,DAMAGE_APPLY:8,DEATH_RESOLVE:9,INTENT_END:10},XS=t=>{const i=t||[];let a=0;for(const o of i)o.blocking&&(a+=Number(o.suggestedDurationMs||0));return a},Si=(t,i,a,o,c,r,f)=>{const g=t.timelineEvents||[],b=g.length,y=t.turnNumber||0,A=c.sourceId||c.targetId,v=c.stepId||`${y}:${A||"system"}`,x=c.stepId||v,E=x?[...g].reverse().find(h=>(h.stepId||h.groupId)===x):void 0;if(E){const h=tg[E.phase]||0,R=tg[i]||0;h>R&&WS&&console.warn("[TURN_STACK] Non-monotonic timeline phase order detected.",{stepId:x,previous:E.phase,next:i})}const m=`${x}:${b}:${i}`;return{...t,timelineEvents:[...g,{id:m,turn:y,actorId:A,stepId:x,phase:i,type:a,payload:o,blocking:r,groupId:v,suggestedDurationMs:f}]}},dl=(t,i)=>{const a=t.simulationEvents||[],o=`sim:${t.turnNumber||0}:${a.length}:${i.type}`;return{...t,simulationEvents:[...a,{...i,id:o,turn:t.turnNumber||0}]}},QS=(t,i)=>{if(i)return t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i)},ng=(t,i)=>{if(i)return J(t.player.position,i)?t.player:t.enemies.find(a=>J(a.position,i))||t.companions?.find(a=>J(a.position,i))},JS=new Set(["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage","burning","oil_explosion"]),Ed=(t,i,a,o,c,r)=>{if(!o)return{amount:i,outgoing:1,incoming:1,total:1};if(r&&JS.has(r))return{amount:i,outgoing:1,incoming:1,total:1};const f=QS(t,a);if(!f)return{amount:i,outgoing:1,incoming:1,total:1};const g=PS(f,c),b=US(o,c),y=g*b;return{amount:Math.max(0,Math.floor(i*y)),outgoing:g,incoming:b,total:y}},Vd=(t,i,a={})=>{let o={...t};const c=()=>{o.tiles===t.tiles&&(o={...o,tiles:new Map(o.tiles)})};switch(i.type){case"Displacement":{let r="";if(i.target==="self"?r=a.sourceId||o.player.id:i.target==="targetActor"?r=a.targetId||"":r=i.target,!r)break;const f=(x,E)=>E===x.player.id?x.player:x.enemies.find(m=>m.id===E),g=f(o,r);if(!g)break;const b=i.source||g?.position,y=Math.min(3200,Math.max(0,XS(o.timelineEvents)));let A=!1;const v=!(i.simulatePath||i.path||i.isFling);if(b&&(o=Si(o,"MOVE_START","Displacement",{origin:b,destination:i.destination,targetActorId:r},{...a,targetId:r},!0,220)),b){const x=i.path||(b?kt(b,i.destination):void 0),E=i.simulatePath||i.isFling||!!i.path;let m=i.destination;if(E&&x){const j=f(o,r);if(!j)break;const L=Aa.processPath(j,x.slice(1),o,x.length-1,{ignoreActors:i.ignoreCollision,ignoreGroundHazards:i.ignoreGroundHazards});m=L.lastValidPos,r===o.player.id?o.player={...o.player,position:m}:o.enemies=o.enemies.map(Z=>Z.id===r?{...Z,position:m}:Z),A||(o=Si(o,"MOVE_END","Displacement",{destination:m,targetActorId:r},{...a,targetId:r},!0,260),A=!0),L.result.effects.length>0&&(o=Si(o,"ON_PASS","TilePath",{path:x.slice(1),targetActorId:r},{...a,targetId:r},!1,80),o=xi(o,L.result.effects,{targetId:r})),L.result.messages.length>0&&(o.message=Yi(o.message,L.result.messages,"INFO","HAZARD"));const W=r===o.player.id||o.enemies.some(Z=>Z.id===r);if(!L.interrupt&&W){const Z=Pe.getTileAt(o,m);o=Si(o,"ON_ENTER","TileEnter",{position:m,targetActorId:r,tileBaseId:Z?.baseId},{...a,targetId:r},!1,80);const Te=f(o,r);if(!Te)break;const oe=Aa.processEntry(Te,Z,o);oe.effects.length>0&&(o=xi(o,oe.effects,{targetId:r})),oe.messages.length>0&&(o.message=Yi(o.message,oe.messages,"INFO","HAZARD"))}if(L.result.newMomentum&&L.result.newMomentum>0){const Z=L.lastValidPos,Te=x.length>1?x[x.length-2]:b,oe=Fs(Te,Z);if(oe!==-1){const Be=Cn(oe);let ne=Z,xe=5;for(;xe>0;){const ve=jn(ne,Be);if(!Pe.isWalkable(o,ve)||(r===o.player.id?o.enemies.find(re=>re.hp>0&&J(re.position,ve)):J(o.player.position,ve)?o.player:o.enemies.find(re=>re.id!==r&&re.hp>0&&J(re.position,ve))))break;const ie=Pe.getTileAt(o,ve);if(ie){const re=Aa.processTransition(g,ie,o,1);if(ne=ve,re.effects.length>0&&(o=xi(o,re.effects,{targetId:r})),re.messages.length>0&&(o.message=Yi(o.message,re.messages,"INFO","HAZARD")),re.newMomentum===0||re.interrupt)break}else{ne=ve;break}xe--}m=ne}}}const h=[...o.visualEvents||[]],R=!!(i.ignoreCollision||i.isFling),k=R?h.reduce((j,L)=>{if(L.type!=="kinetic_trace")return j;const W=L.payload;return W&&(W.movementType??"slide")==="slide"?j+1:j},0):0,B=v?0:R?Math.min(640,k*90):0,_=Math.max(y,B),w={actorId:r,origin:b,path:i.path||(v?[b,m]:kt(b,m)),destination:m,movementType:v?"teleport":"slide",durationMs:i.animationDuration??(v?180:Math.max(120,(i.path?.length||kt(b,m).length)*110)),startDelayMs:_,wasLethal:o.tiles.get(de(m))?.traits.has("HAZARDOUS")||!1},H=h;if(v)H.push({type:"kinetic_trace",payload:w});else{let j=!1;for(let L=H.length-1;L>=0;L--){const W=H[L];if(W.type!=="kinetic_trace")continue;const Z=W.payload;if(!(!Z||Z.actorId!==r)){if((Z.movementType??"slide")==="slide"&&J(Z.destination,w.origin)){const Te=Z.path&&Z.path.length>0?Z.path:[Z.origin,Z.destination],oe=w.path&&w.path.length>0?w.path:[w.origin,w.destination],Be=[...Te,...oe.slice(1)];H[L]={type:"kinetic_trace",payload:{...w,origin:Z.origin,path:Be,durationMs:(Z.durationMs||0)+(w.durationMs||0),startDelayMs:Math.min(Z.startDelayMs??_,_),movementType:"slide",wasLethal:!!(Z.wasLethal||w.wasLethal)}},j=!0}break}}j||H.push({type:"kinetic_trace",payload:w})}if(o.visualEvents=H,r===o.player.id)o.player={...o.player,position:m,previousPosition:v?m:o.player.position};else{const j=L=>L.id===r?{...L,position:m,previousPosition:v?m:L.position}:L;o.enemies=o.enemies.map(j),o.companions&&(o.companions=o.companions.map(j))}o.occupancyMask=Ze.refreshOccupancyMask(o),A||(o=Si(o,"MOVE_END","Displacement",{destination:m,targetActorId:r},{...a,targetId:r},!0,260)),o=dl(o,{type:"UnitMoved",actorId:r,position:m,payload:{origin:b,destination:m,movementType:w.movementType}})}break}case"Damage":{i.reason&&["lava_sink","void_sink","hazard_intercept","lava_tick","fire_damage"].includes(i.reason)&&(o=Si(o,"HAZARD_CHECK","Damage",{reason:i.reason,amount:i.amount,target:i.target},a,!0,200)),o=Si(o,"DAMAGE_APPLY","Damage",{reason:i.reason,amount:i.amount,target:i.target,scoreEvent:i.scoreEvent},a,!0,180);let f="",g=null,b,y,A=i.amount;typeof i.target=="string"?i.target==="targetActor"?f=a.targetId||"":i.target!=="area"&&(f=i.target):g=i.target;const v=["fire_damage","lava_sink","burning","hazard_intercept","lava_tick","oil_explosion","void_sink"],x=i.reason&&v.includes(i.reason),E=o.upgrades?.includes("RELIC_EMBER_WARD"),m=o.upgrades?.includes("RELIC_CINDER_ORB");if(x&&f){const R=(f===o.player.id?o.player:o.enemies.find(B=>B.id===f))?.activeSkills?.some(B=>B.id==="ABSORB_FIRE");let k=i.amount;if(f===o.player.id&&E&&(k=Math.max(0,k-1),o.message=Wt(o.message,"Ember Ward dampens the flames.","INFO","COMBAT")),R){const B=k+(f===o.player.id&&m?1:0);return f===o.player.id&&m&&(o.message=Wt(o.message,"Cinder Orb amplifies the absorption.","INFO","COMBAT")),Vd(o,{type:"Heal",target:f,amount:B})}}if(f)if(f===o.player.id){const h=o.player,R=i.scoreEvent?.damageClass||"physical",k=Ed(o,i.amount,a.sourceId,h,R,i.reason);let B=k.amount;x&&E&&(B=Math.max(0,B-1)),i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:B,traitOutgoingMultiplier:k.outgoing,traitIncomingMultiplier:k.incoming,traitTotalMultiplier:k.total}].slice(-500)),o.player=Ys(o.player,B),b=o.player.id,y=o.player.position,A=B,x&&(o.hazardBreaches=(o.hazardBreaches||0)+1),x&&m&&(o.player=uS(o.player,1),o.message=Wt(o.message,"Cinder Orb restores 1 HP.","INFO","COMBAT"))}else{const h=o.enemies.find(j=>j.id===f),R=f===o.player.id?o.player.position:h?.position,k=[],B=i.scoreEvent?.damageClass||"physical",_=Ed(o,i.amount,a.sourceId,h,B,i.reason),w=_.amount;b=f||h?.id,y=R||h?.position,A=w;const H=j=>{if(j.id===f){const L=Ys(j,w);return L.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],j],k.push(j.position)),L}return j};if(i.scoreEvent&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,finalPower:w,traitOutgoingMultiplier:_.outgoing,traitIncomingMultiplier:_.incoming,traitTotalMultiplier:_.total}].slice(-500)),o.enemies=o.enemies.map(H).filter(j=>j.hp>0),o.companions&&(o.companions=o.companions.map(H).filter(j=>j.hp>0)),k.length>0&&(o=Si(o,"DEATH_RESOLVE","Damage",{targetActorId:f,reason:i.reason||"damage"},{...a,targetId:f},!0,260)),k.forEach(j=>{o=ul(o,j)}),R&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:R}}]),f===o.player.id&&(o.player.stealthCounter||0)>0)o.player={...o.player,stealthCounter:Math.max(0,(o.player.stealthCounter||0)-1)};else if(f!==o.player.id){const j=L=>L.id===f?{...L,stealthCounter:Math.max(0,(L.stealthCounter||0)-1)}:L;o.enemies=o.enemies.map(j),o.companions&&(o.companions=o.companions.map(j))}f===o.player.id&&o.player.archetype==="HUNTER"&&i.source&&Fs(i.source,o.player.position)!==-1&&(o.message=Wt(o.message,"You roll away!","INFO","COMBAT")),h&&h.archetype==="HUNTER"&&i.source&&Fs(i.source,h.position)!==-1&&(o.message=Wt(o.message,`${h.subtype||h.id} rolls away!`,"INFO","COMBAT"))}else if(g){const h=ng(o,g),R=i.scoreEvent?.damageClass||"physical",k=Ed(o,i.amount,a.sourceId,h,R,i.reason),B=k.amount;b=h?.id,y=g,A=B,o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:g}}],i.scoreEvent&&h&&(o.combatScoreEvents=[...o.combatScoreEvents||[],{...i.scoreEvent,targetId:h.id,finalPower:B,traitOutgoingMultiplier:k.outgoing,traitIncomingMultiplier:k.incoming,traitTotalMultiplier:k.total}].slice(-500)),J(o.player.position,g)&&(o.player=Ys(o.player,B),x&&(o.hazardBreaches=(o.hazardBreaches||0)+1),o.player.hp<=0);const _=j=>{if(J(j.position,g)){const L=Ys(j,B);return L.hp<=0&&(o.dyingEntities=[...o.dyingEntities||[],j],H.push(j.id),w.push(j.position)),L}return j},w=[],H=[];o.enemies=o.enemies.map(_).filter(j=>j.hp>0),o.companions&&(o.companions=o.companions.map(_).filter(j=>j.hp>0)),H.forEach(j=>{o=Si(o,"DEATH_RESOLVE","Damage",{targetActorId:j,reason:i.reason||"area_damage"},{...a,targetId:j},!0,260)}),w.forEach(j=>{o=ul(o,j)})}A>0&&(o=dl(o,{type:"DamageTaken",targetId:b||f||void 0,position:y,payload:{amount:A,reason:i.reason,sourceId:a.sourceId}}));break}case"Heal":{const r=y=>({...y,hp:Math.min(y.maxHp,y.hp+i.amount)}),f=i.target==="targetActor"?a.targetId:i.target;let g,b;if(f){const y=f===o.player.id?o.player:o.enemies.find(A=>A.id===f)||o.companions?.find(A=>A.id===f);if(y){const A=f===o.player.id?"You":y.subtype||y.id;if(o.message=Wt(o.message,`${A} recover ${i.amount} HP.`,"INFO","COMBAT"),f===o.player.id)o.player=r(o.player),g=o.player.id,b=o.player.position;else{const v=x=>x.id===f?r(x):x;o.enemies=o.enemies.map(v),o.companions&&(o.companions=o.companions.map(v)),g=y.id,b=y.position}}}g&&(o=dl(o,{type:"Healed",targetId:g,position:b,payload:{amount:i.amount,sourceId:a.sourceId}}));break}case"ApplyStatus":{o=Si(o,"STATUS_APPLY","ApplyStatus",{status:i.status,duration:i.duration,target:i.target},a,!0,160);let r="",f=null;typeof i.target=="string"?i.target==="targetActor"?r=a.targetId||"":r=i.target:f=i.target;let g=f;const b=a.sourceId?a.sourceId===o.player.id?o.player:o.enemies.find(v=>v.id===a.sourceId):void 0,y=b?AS(i.duration,Qe(b)):i.duration;if(r){const v=r===o.player.id?o.player:o.enemies.find(x=>x.id===r)||o.companions?.find(x=>x.id===r);if(v){g=v.position;const x=r===o.player.id?"You":`${v.subtype||"enemy"}#${v.id}`,E=r===o.player.id?"are":"is";if(o.message=Wt(o.message,`${x} ${E} ${i.status}!`,"INFO","COMBAT"),r===o.player.id)o.player=Ud(o.player,i.status,y);else{const m=h=>h.id===r?Ud(h,i.status,y):h;o.enemies=o.enemies.map(m),o.companions&&(o.companions=o.companions.map(m))}}}i.status==="stunned"&&g&&(o.visualEvents=[...o.visualEvents||[],{type:"shake",payload:{intensity:"low"}},{type:"vfx",payload:{type:"stunBurst",position:g}},{type:"combat_text",payload:{text:"STUNNED",position:g}}]);const A=r||(g?ng(o,g)?.id:void 0);o=dl(o,{type:"StatusApplied",targetId:A,position:g||void 0,payload:{status:i.status,duration:y,sourceId:a.sourceId}});break}case"PickupShield":{const r=i.position||o.shieldPosition;if(r&&o.shieldPosition&&J(o.shieldPosition,r)){o.hasShield=!0,o.shieldPosition=void 0;const f={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Shield Bash.",slot:"utility",cooldown:3,currentCooldown:0,range:1,upgrades:[],activeUpgrades:[]};o.player.activeSkills.some(g=>g.id==="BULWARK_CHARGE")||(o.player={...o.player,activeSkills:[...o.player.activeSkills,f]})}break}case"PickupSpear":{const r=i.position||o.spearPosition;r&&o.spearPosition&&J(o.spearPosition,r)&&(o.hasSpear=!0,o.spearPosition=void 0);break}case"SpawnItem":{if(i.itemType==="spear")o.spearPosition=i.position,a.sourceId===o.player.id&&(o.hasSpear=!1);else if(i.itemType==="bomb"){const r=o.initialSeed??o.rngSeed??"0",f=(o.turnNumber<<16)+(o.actionLog?.length??0)+o.enemies.length,g=`bomb-${po(r,f,8,"bomb")}`,b=Gs({id:g,type:"enemy",subtype:"bomb",factionId:"enemy",position:i.position,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});b.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.enemies=[...o.enemies,b]}else i.itemType==="shield"&&(o.shieldPosition=i.position,o.hasShield=!1);break}case"LavaSink":{o=Si(o,"HAZARD_CHECK","LavaSink",{target:i.target},a,!0,240);const r=i.target,f=r===o.player.id?o.player:o.enemies.find(g=>g.id===r);f&&(o=Si(o,"DEATH_RESOLVE","LavaSink",{targetId:r},{...a,targetId:r},!0,280),r===o.player.id?o.player=Ys(o.player,99):(o.enemies=o.enemies.filter(g=>g.id!==r),o.dyingEntities=[...o.dyingEntities||[],f],o=ul(o,f.position)),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:f.position}}]);break}case"Impact":{const r=i.target,f=r===o.player.id?o.player:o.enemies.find(g=>g.id===r);if(f&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:f.position}}],i.damage>0))if(r===o.player.id)o.player=Ys(o.player,i.damage);else{const g=b=>b.id===r?Ys(b,i.damage):b;o.enemies=o.enemies.map(g).filter(b=>b.hp>0),o.companions&&(o.companions=o.companions.map(g).filter(b=>b.hp>0))}break}case"Message":{o.message=[...o.message,ef(i.text,"INFO","SYSTEM")].slice(-50),o=dl(o,{type:"MessageLogged",payload:{text:i.text}});break}case"Juice":{if(i.effect==="combat_text"&&i.text&&(o.message=Wt(o.message,i.text,"VERBOSE","SYSTEM")),i.effect==="impact"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;r&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"impact",position:r}}])}if(i.effect==="flash"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;r&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"flash",position:r}}])}if(i.effect==="spearTrail"&&i.path&&(o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"spear_trail",path:i.path}}]),i.effect==="lavaSink"&&i.target){const r=typeof i.target=="string"?i.target===o.player.id?o.player.position:o.enemies.find(f=>f.id===i.target)?.position:i.target;if(r){const f=o.enemies.find(g=>J(g.position,r));f&&(o.dyingEntities=[...o.dyingEntities||[],f],o.enemies=o.enemies.filter(g=>!J(g.position,r)),o.companions&&(o.companions=o.companions.filter(g=>!J(g.position,r))),o=ul(o,r),o.visualEvents=[...o.visualEvents||[],{type:"vfx",payload:{type:"vaporize",position:r}}])}}break}case"UpdateComponent":{const r=(f,g,b)=>{const y=new Map(f.components||[]);return y.set(g,b),{...f,components:y}};if(i.target==="self")o.player=r(o.player,i.key,i.value);else if(i.target==="targetActor"&&a.targetId)if(a.targetId===o.player.id)o.player=r(o.player,i.key,i.value);else{const f=g=>g.id===a.targetId?r(g,i.key,i.value):g;o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f))}break}case"ModifyCooldown":{o.player={...o.player,activeSkills:o.player.activeSkills?.map(r=>r.id===i.skillId?{...r,currentCooldown:i.setExact?i.amount:Math.max(0,r.currentCooldown+i.amount)}:r)};break}case"SpawnCorpse":{o=ul(o,i.position);break}case"RemoveCorpse":{o=GS(o,i.position),o.dyingEntities=(o.dyingEntities||[]).filter(r=>!J(r.position,i.position));break}case"SpawnActor":{const r=vl(i.actor);o.enemies=[...o.enemies,r],r.companionOf&&(o.companions=[...o.companions||[],r]),o.initiativeQueue&&(o.initiativeQueue=NS(o.initiativeQueue,r));break}case"PlaceFire":{const r=de(i.position);c();let f=o.tiles.get(r);f?f={...f,traits:new Set(f.traits),effects:[...f.effects]}:f={baseId:"STONE",position:i.position,traits:new Set(mo.STONE.defaultTraits),effects:[]},o.tiles.set(r,f);const g=Aa.applyEffect(f,"FIRE",i.duration,1,o,a.sourceId);g.messages.length>0&&(o.message=Yi(o.message,g.messages,"INFO","HAZARD"));break}case"PlaceTrap":{o.traps||(o.traps=[]),o.traps=[...o.traps,{position:i.position,ownerId:i.ownerId,isRevealed:!1,cooldown:0}];break}case"RemoveTrap":{o.traps&&(i.ownerId?o.traps=o.traps.filter(r=>r.ownerId!==i.ownerId):o.traps=o.traps.filter(r=>!J(r.position,i.position)));break}case"SetStealth":{const r=f=>({...f,stealthCounter:(f.stealthCounter||0)+i.amount});i.target==="self"?o.player=r(o.player):(o.enemies=o.enemies.map(f=>f.id===i.target?r(f):f),o.companions&&(o.companions=o.companions.map(f=>f.id===i.target?r(f):f)));break}case"UpdateCompanionState":{const r=i.target==="self"?a.sourceId||o.player.id:i.target,f=g=>g.id!==r?g:{...g,companionState:{...g.companionState,mode:i.mode||g.companionState?.mode,markTarget:i.markTarget!==void 0?i.markTarget:g.companionState?.markTarget,orbitStep:i.mode==="scout"?0:g.companionState?.orbitStep,apexStrikeCooldown:i.apexStrikeCooldown!==void 0?i.apexStrikeCooldown:g.companionState?.apexStrikeCooldown,healCooldown:i.healCooldown!==void 0?i.healCooldown:g.companionState?.healCooldown}};o.enemies=o.enemies.map(f),o.companions&&(o.companions=o.companions.map(f));break}case"GameOver":{o.gameStatus="lost";break}}return o},xi=(t,i,a={})=>{const o=t.stackTrace?.length||0,c=Zh(t,i,{apply:(b,y)=>Vd(b,y,a),describe:b=>b.type,preserveInputOrder:!0,startTick:o+1});let r=c.state,f=[...t.stackTrace||[],...c.trace];const g=fS(r);if(g.length>0){const b=Zh(r,g,{apply:(y,A)=>Vd(y,A,{}),describe:y=>y.type,preserveInputOrder:!0,startTick:f.length+1});r=b.state,f=[...f,...b.trace]}return{...r,stackTrace:f}},ZS={id:"grapple_hook",name:"Grapple Hook",description:"Tests for grapple hook mechanics including LoS, lava sinking, and weight-based behavior",scenarios:[{id:"hook_lava_intercept",title:"Lava Interceptor & LoS",description:"Verify LoS blocking and Lava killing targets.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["lava","line-of-sight","displacement"],setup:t=>{t.setPlayer({q:4,r:6,s:-10},["GRAPPLE_HOOK"]),t.spawnEnemy("footman",{q:4,r:4,s:-8},"target1"),t.spawnEnemy("footman",{q:7,r:3,s:-10},"hidden"),t.setTile({q:6,r:4,s:-10},"wall"),t.setTile({q:4,r:5,s:-9},"lava")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:7,r:3,s:-10}),t.useSkill("GRAPPLE_HOOK",{q:4,r:4,s:-8}),t.wait(),t.wait()},verify:(t,i)=>{const a=t.player,o=t.enemies.find(r=>r.id==="target1"),c={playerInOriginalPosition:a.position.q===4&&a.position.r===6&&a.position.s===-10,target1Dead:!o,losWarning:i.some(r=>r.includes("Line of sight"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}},{id:"hook_wall_anchor_zip",title:"Heavy Zip to Wall",description:"Verify zipping to a wall and stunning nearby enemies.",relatedSkills:["GRAPPLE_HOOK"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["wall","displacement","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK"]),t.setTile({q:6,r:3,s:-9},"wall"),t.spawnEnemy("footman",{q:5,r:4,s:-9},"blocker"),t.setTile({q:6,r:6,s:-12},"wall"),t.setTile({q:5,r:6,s:-11},"lava"),t.spawnEnemy("footman",{q:6,r:5,s:-11},"stunMe"),t.spawnEnemy("footman",{q:7,r:5,s:-12},"noStun")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:6,r:3,s:-9}),t.useSkill("GRAPPLE_HOOK",{q:6,r:6,s:-12})},verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="stunMe"),o=t.enemies.find(r=>r.id==="noStun"),c={stunnedEnemy:!!(a&&a.statusEffects.some(r=>r.type==="stunned")),safeEnemy:!!(o&&!o.statusEffects.some(r=>r.type==="stunned")),zipLog:i.some(r=>r.includes("Zipped")),lavaSinkLog:i.some(r=>r.includes("Lava Sink"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Player Pos:",t.player.position),console.log("Victim Status:",a?.statusEffects)),Object.values(c).every(r=>r===!0)}}]},ev={id:"shield_throw",name:"Shield Throw",description:"Tests for shield throw mechanics including push, stun, and collision behavior",scenarios:[{id:"shield_stun_push",title:"Standard Push",description:"Verify 4-tile push in a straight line.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>t.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="victim"),o={victimAt1:a?.position.r===1,victimStunned:i?.some(c=>c.includes("stunned"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Shield Throw Failed:",o),console.log("Enemy Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"shield_unit_collision",title:"Unit Collision",description:"Verify push stops when hitting another unit.",relatedSkills:["SHIELD_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","lava","push","environmental-kill"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_THROW"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim"),t.spawnEnemy("shieldbearer",{q:3,r:3,s:-6},"obstacle"),t.setTile({q:3,r:1,s:-4},"lava")},run:t=>t.useSkill("SHIELD_THROW",{q:3,r:5,s:-8}),verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="victim"),o=t.enemies.find(r=>r.id==="obstacle"),c={victimPushed:(a?.position.r??5)===3,obstacleDead:!o};return Object.values(c).some(r=>r===!1)&&(console.log(" Shield Throw Failed:",c),console.log("Victim Pushed:",c.victimPushed),console.log("Victim Pos:",a?.position),console.log("Obstacle Dead:",c.obstacleDead),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}}]},tv={id:"auto_attack",name:"Auto Attack",description:"Tests for auto-attack passive skill including turn-start memory and friendly fire logic",scenarios:[{id:"auto_attack_persistence_stress_test",title:"Persistence: Three-Point Validation",description:"Verifies that Auto-Attack only hits units that were adjacent at BOTH start and end.",relatedSkills:["AUTO_ATTACK","BASIC_MOVE"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","spatial-memory","edge-case"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["AUTO_ATTACK","BASIC_MOVE"]),t.spawnEnemy("footman",{q:5,r:5,s:-10},"persistent_foe"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"new_neighbor"),t.spawnEnemy("footman",{q:5,r:4,s:-9},"former_neighbor"),t.state.player.previousPosition={q:4,r:5,s:-9}},run:t=>{t.move({q:4,r:6,s:-10})},verify:(t,i)=>{const a=t.enemies.find(f=>f.id==="persistent_foe"),o=t.enemies.find(f=>f.id==="new_neighbor"),c=t.enemies.find(f=>f.id==="former_neighbor"),r={persistentDead:!a||a.hp<a.maxHp,ignoredNew:o&&o.hp===o.maxHp,ignoredFormer:c&&c.hp===c.maxHp,logFound:i.some(f=>f.includes("attacked footman"))};return Object.values(r).some(f=>f===!1)&&(console.log(" Scenario Failed Details:",r),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i)),Object.values(r).every(f=>f===!0)}},{id:"enemy_auto_attack_no_friendly_fire",title:"Enemy Auto-Attack: Team Alignment",description:"Ensures enemy passives only target the player and not their own allies.",relatedSkills:["AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","alignment","friendly-fire"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},[]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"enemy_attacker");const i=t.state.enemies.find(a=>a.id==="enemy_attacker");i&&(i.activeSkills=[{id:"AUTO_ATTACK",range:1}],i.previousPosition={q:3,r:5,s:-8}),t.spawnEnemy("shieldBearer",{q:2,r:6,s:-8},"enemy_ally"),i.previousPosition={q:3,r:5,s:-8},t.state.player.previousPosition={q:3,r:6,s:-9}},run:t=>{t.wait()},verify:(t,i)=>{const a=t.player,o=t.enemies.find(r=>r.id==="enemy_ally"),c={playerHit:a.hp<a.maxHp,allySafe:o&&o.hp===o.maxHp,hitPlayerLog:i.some(r=>r.includes("attacked you")),hitAllyLog:!i.some(r=>r.includes("attacked enemy_ally"))};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Failed Details:",c),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i)),Object.values(c).every(r=>r===!0)}}]},nv={id:"integration",name:"Integration Tests",description:"Multi-skill integration scenarios testing complex interactions",scenarios:[{id:"environmental_chain_reaction",title:"Environmental Chain Reaction",description:"Test complex environmental interactions with multiple hazards",relatedSkills:["GRAPPLE_HOOK","SHIELD_THROW"],category:"hazards",difficulty:"advanced",isTutorial:!1,tags:["lava","wall","environmental-kill","chain-reaction"],setup:t=>{t.setPlayer({q:5,r:4,s:-9},["GRAPPLE_HOOK","SHIELD_THROW"]),t.spawnEnemy("shieldbearer",{q:5,r:2,s:-7},"victim1"),t.spawnEnemy("footman",{q:5,r:6,s:-11},"victim2"),t.spawnEnemy("footman",{q:5,r:7,s:-12},"victim3"),t.setTile({q:5,r:8,s:-13},"lava")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:5,r:2,s:-7}),t.useSkill("SHIELD_THROW",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.player.position.q===5&&t.player.position.r===3,o=!t.enemies.find(y=>y.id==="victim3")||!!t.dyingEntities?.find(y=>y.id==="victim3"),c=!t.enemies.find(y=>y.id==="victim2")||!!t.dyingEntities?.find(y=>y.id==="victim2"),r=t.enemies.find(y=>y.id==="victim1"),f=r&&i.some(y=>y.includes("stunned")),g=r&&r.position.q===5&&r.position.r===6,b=[a,o,c,f,g];return Object.values(b).some(y=>y===!1)&&(console.log(" Environmental Chain Reaction Failed:",b),console.log("Player at 5,3:",a),console.log("Player Pos:",t.player.position),console.log("Logs found:",i),console.log("Victim1 at 5,6:",g),console.log("Victim1 Pos:",r?.position),console.log("Victim1 Stunned:",f),console.log("Victim2 Dead:",c),console.log("Victim3 Dead:",o)),Object.values(b).every(y=>y===!0)}},{id:"auto_attack_after_grapple",title:"Auto-Attack After Grapple",description:"Verify auto-attack triggers correctly after grapple displacement",relatedSkills:["GRAPPLE_HOOK","AUTO_ATTACK"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["passive","displacement","integration"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["GRAPPLE_HOOK","AUTO_ATTACK"]),t.state.player.previousPosition={q:4,r:6,s:-10},t.spawnEnemy("footman",{q:7,r:6,s:-13},"grappleHookTarget"),t.spawnEnemy("footman",{q:3,r:5,s:-8},"safe"),t.spawnEnemy("footman",{q:4,r:5,s:-9},"auto-attacked"),t.spawnEnemy("footman",{q:5,r:5,s:-10},"safe2")},run:t=>{t.useSkill("GRAPPLE_HOOK",{q:7,r:6,s:-13})},verify:(t,i)=>{const a=t.enemies.find(g=>g.id==="grappleHookTarget"),o=t.enemies.find(g=>g.id==="auto-attacked"),c=t.enemies.find(g=>g.id==="safe"),r=t.enemies.find(g=>g.id==="safe2"),f={targetPulled:!!(a&&a.position.q<7),targetNotHit:!!(a&&a.hp===a.maxHp),safeNotHit:!!(c&&c.hp===c.maxHp),safe2NotHit:!!(r&&r.hp===r.maxHp),autoattackedDead:!o||o.hp<=0};return Object.values(f).some(g=>g===!1)&&(console.log(" Scenario Failed Details:",f),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i),console.log("target Pos:",a?.position.q),console.log("target Pulled:",f.targetPulled),console.log("target Not Hit:",f.targetNotHit),console.log("safe Not Hit:",f.safeNotHit),console.log("safe2 Not Hit:",f.safe2NotHit),console.log("autoattacked Dead:",f.autoattackedDead)),Object.values(f).every(g=>g===!0)}}]},iv="modulepreload",sv=function(t){return"/Hop/"+t},ig={},av=function(i,a,o){let c=Promise.resolve();if(a&&a.length>0){let y=function(A){return Promise.all(A.map(v=>Promise.resolve(v).then(x=>({status:"fulfilled",value:x}),x=>({status:"rejected",reason:x}))))};var f=y;document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),b=g?.nonce||g?.getAttribute("nonce");c=y(a.map(A=>{if(A=sv(A),A in ig)return;ig[A]=!0;const v=A.endsWith(".css"),x=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${A}"]${x}`))return;const E=document.createElement("link");if(E.rel=v?"stylesheet":iv,v||(E.as="script"),E.crossOrigin="",E.href=A,b&&E.setAttribute("nonce",b),document.head.appendChild(E),v)return new Promise((m,h)=>{E.addEventListener("load",m),E.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${A}`)))})}))}function r(g){const b=new Event("vite:preloadError",{cancelable:!0});if(b.payload=g,window.dispatchEvent(b),!b.defaultPrevented)throw g}return c.then(g=>{for(const b of g||[])b.status==="rejected"&&r(b.reason);return i().catch(r)})},ov=async(t,i)=>{if(typeof window>"u")try{(await av(()=>import("./__vite-browser-external-BIHI7g3E.js"),[])).appendFileSync(t,i)}catch(a){console.warn(`Failed to persist log to ${t}:`,a)}},lv={id:"basic_attack",name:"Basic Attack",description:"Tests for basic melee attack mechanics including range and move-to-attack logic",scenarios:[{id:"basic_attack_player_mechanics",title:"Player Basic Attack: Range & Bump",description:"Validates range enforcement, turn accounting, and bump-attack redirection.",relatedSkills:["BASIC_ATTACK"],category:"combat",tags:["melee","targeting","bump-attack"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BASIC_ATTACK"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim"),t.spawnEnemy("footman",{q:3,r:4,s:-7},"far_victim")},run:t=>{t.useSkill("BASIC_ATTACK",{q:3,r:4,s:-7}),t.move({q:3,r:5,s:-8})},verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="adj_victim"),o=t.enemies.find(r=>r.id==="far_victim"),c={farStaysAlive:o&&o.hp===o.maxHp,rangeError:i.some(r=>r.includes("out of range")),adjTookDamage:!a||a.hp<=a.maxHp,playerPositionHeld:J(t.player.position,{q:3,r:6,s:-9}),oneTurnConsumed:t.turnsSpent===1};if(Object.values(c).some(r=>r===!1)){const r=` Basic Attack Failed: ${JSON.stringify(c)}
Current Player Pos: ${JSON.stringify(t.player.position)}
Logs: ${JSON.stringify(i)}
`;console.log(r),ov("integration_debug.txt",r)}return Object.values(c).every(r=>r===!0)}}]},rv={id:"spear_throw",name:"Spear Throw",description:"Tests for spear throw mechanics including range, LoS, and spear retrieval",scenarios:[{id:"spear_kill",title:"Spear Kill",description:"Throw spear to kill an enemy and verify item spawn.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["projectile","combat","item-spawn"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),t.spawnEnemy("footman",{q:3,r:4,s:-7},"target"),t.state.hasSpear=!0},run:t=>{t.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(t,i)=>{const a=!t.enemies.find(r=>r.id==="target"),o=!!t.spearPosition&&t.spearPosition.q===3&&t.spearPosition.r===4,c=i.some(r=>r.includes("Spear killed"));return a&&o&&c}},{id:"spear_miss_spawn",title:"Spear Rejects Empty Tile",description:"Enemy-only contract: empty tiles are invalid targets and do not spawn spear.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["projectile","item-spawn"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SPEAR_THROW"]),t.state.hasSpear=!0},run:t=>{t.useSkill("SPEAR_THROW",{q:3,r:4,s:-7})},verify:(t,i)=>{const a=i.some(c=>c.includes("No enemy at target.")),o=t.hasSpear===!0&&!t.spearPosition;return a&&o}},{id:"spear_wall_block",title:"Spear Wall Block",description:"Spear throw is blocked by walls.",relatedSkills:["SPEAR_THROW"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["projectile","wall","boundary"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["SPEAR_THROW"]),t.spawnEnemy("footman",{q:4,r:3,s:-7},"target"),t.setTile({q:4,r:4,s:-8},"wall"),t.state.hasSpear=!0},run:t=>{t.useSkill("SPEAR_THROW",{q:4,r:3,s:-7})},verify:(t,i)=>{const a=i.some(r=>r.includes("No clear line of sight to enemy.")),o=!!t.enemies.find(r=>r.id==="target"),c=t.hasSpear===!0&&!t.spearPosition;return a&&o&&c}}]},cv={id:"dash",name:"Dash",description:"Tests for dash mechanics including path validation and shield-based enemy shunting",scenarios:[{id:"dash_shunt_lava",title:"Shunt into Lava",description:"Shunt an enemy into lava for an environmental kill.",relatedSkills:["DASH"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["lava","push","environmental-kill"],setup:t=>{t.setPlayer({q:3,r:5,s:-8},["DASH"]),t.spawnEnemy("footman",{q:5,r:5,s:-10},"victim"),t.setTile({q:7,r:5,s:-12},"lava"),t.state.hasShield=!0},run:t=>{t.useSkill("DASH",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="victim"),o={playerPosition:t.player.position.q===5&&t.player.position.r===5,victimDead:!a};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Shunt Lava Failed:",o),console.log("Final State:",t.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"dash_comprehensive_validation",title:"Dash: Constraints & Shunt Physics",description:"Validates range limits, wall blocking, and Shield Shunt displacement in one sequence.",relatedSkills:["DASH"],category:"movement",difficulty:"advanced",isTutorial:!1,tags:["stress-test","collision","range"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["DASH"]),t.state.hasShield=!0,t.setTile({q:4,r:4,s:-8},"wall"),t.setTile({q:6,r:5,s:-11},"wall"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"victim")},run:t=>{t.useSkill("DASH",{q:4,r:7,s:-11}),t.useSkill("DASH",{q:7,r:4,s:-11}),t.useSkill("DASH",{q:6,r:6,s:-12}),t.useSkill("DASH",{q:4,r:5,s:-9})},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="victim"),o={finalPositionCorrect:t.player.position.q===4&&t.player.position.r===6,victimPushed:!!(a&&a.position.q===4&&a.position.r===5),wallErrorFound:i.some(c=>c.includes("wall blocks")),axialRangeErrorFound:i.some(c=>c.includes("Axial only!")),shuntSuccess:i.some(c=>c.includes("Shield Shunt")),twoTurnSpent:t.turnsSpent===2};return Object.values(o).some(c=>c===!1)&&(console.log(" Dash Stress Test Failed:",o),console.log("Final State:",t.player.position),console.log("Victim Pos:",a?.position),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},uv={id:"jump",name:"Jump",description:"Tests for jump mechanics including range validation and stunning landing",scenarios:[{id:"jump_basic",title:"Basic Jump",description:"Jump to a tile.",relatedSkills:["JUMP"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","leap"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["JUMP"]),t.setTile({q:3,r:5,s:-8},"lava")},run:t=>{t.useSkill("JUMP",{q:3,r:4,s:-7})},verify:(t,i)=>{const a=J(t.player.position,{q:3,r:4,s:-7}),o=Hd(t.occupancyMask,{q:3,r:4}),c=!Hd(t.occupancyMask,{q:3,r:6}),r={playerInPosition:a,spatialMaskRefreshed:o&&c,noLavaDamage:t.player.hp===t.player.maxHp,jumpedSuccessfully:i.some(f=>f.includes("Jumped"))};return Object.values(r).some(f=>f===!1)&&(console.error(" Jump Basic Failed:",r),console.error("Final State:",t.player.position),console.error("Logs:",i)),Object.values(r).every(f=>f===!0)}},{id:"jump_stunning_landing",title:"Stunning Landing",description:"Jump into a group of enemies and ensure neighbors are stunned.",relatedSkills:["JUMP"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["movement","stun","aoe"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["JUMP"]),t.addUpgrade("JUMP","STUNNING_LANDING"),t.spawnEnemy("footman",{q:3,r:7,s:-10},"neighbor_1"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"neighbor_2"),t.spawnEnemy("footman",{q:3,r:5,s:-8},"distant_enemy")},run:t=>{t.useSkill("JUMP",{q:3,r:8,s:-11})},verify:(t,i,a=[])=>{const o={n1StunnedMessage:i.some(c=>c.includes("stunned by landing impact")),hasShakeJuice:a.some(c=>c.type==="shake"),hasStunBurstVFX:a.some(c=>c.type==="vfx"&&c.payload.type==="stunBurst"),hasStunnedCombatText:a.some(c=>c.type==="combat_text"&&c.payload.text==="STUNNED"),playerAtTarget:J(t.player.position,{q:3,r:8,s:-11}),oneTurnSpent:t.turnsSpent===1};return Object.values(o).some(c=>c===!1)&&(console.error(" Jump Stunning Landing Failed:",o),console.error("Final State:",t.player.position),console.error("turnsSpent:",t.turnsSpent),console.error("Logs:",i)),Object.values(o).every(c=>c===!0)}}]},dv={id:"shield_bash",name:"Shield Bash",description:"Tests for shield bash mechanics including push, stun, and collision behavior",scenarios:[{id:"bash_push",title:"Shield Push",description:"Push an enemy into lava.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["push","displacement","lava"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),t.setTile({q:3,r:4,s:-7},"lava"),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>{t.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(t,i)=>{const a={enemyGone:t.enemies.length===0,messageOk:i.some(o=>o.includes("Lava"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Current Player Pos:",t.player.position),console.log("Logs found:",i)),Object.values(a).every(o=>o===!0)}},{id:"bash_wall_stun",title:"Wall Slam Stun",description:"Bash enemy into wall to cause a stun.",relatedSkills:["SHIELD_BASH"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["collision","wall","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SHIELD_BASH"]),t.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"victim"),t.setTile({q:3,r:4,s:-7},"wall")},run:t=>{t.useSkill("SHIELD_BASH",{q:3,r:5,s:-8})},verify:(t,i)=>{const a=t.enemies.find(r=>r.id==="victim");if(!a)return!1;const o=J(a.position,{q:3,r:5,s:-8}),c=i.some(r=>r.includes("into obstacle"));return o&&c}}]},fv={id:"bulwark_charge",name:"Bulwark Charge",description:"Tests for bulwark charge mechanics including chain pushing and wall slamming",scenarios:[{id:"chain_stun",title:"The Chain-Stun",description:"Wall prevents chain movement, causing all members to be stunned.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"intermediate",isTutorial:!0,tags:["chain","wall","stun"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),t.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),t.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),t.setTile({q:3,r:3,s:-6},"wall"),t.state.hasShield=!0},run:t=>{t.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(t,i)=>!0},{id:"bulwark_chain_push",title:"Bulwark Chain Push",description:"Push a chain of enemies successfully.",relatedSkills:["BULWARK_CHARGE"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["chain","push","displacement"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"A"),t.spawnEnemy("footman",{q:3,r:4,s:-7},"B"),t.state.hasShield=!0},run:t=>{t.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(t,i)=>!0}]},mv={id:"vault",name:"Vault",description:"Tests for vault mechanics including state-shifting behavior between odd and even turns",scenarios:[{id:"vault_shift_stun",title:"Vault Stun (Odd Turn)",description:"Verify vault stuns neighbors on Turn 1.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","stun","movement"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.setTile({q:3,r:5,s:-8},"lava"),t.spawnEnemy("footman",{q:4,r:4,s:-8},"victim")},run:t=>{t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>{const a={stunned:i.some(o=>o.includes("Stun Vault executed!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Stun Failed:",a),console.log("Logs:",i)),Object.values(a).every(o=>o===!0)}},{id:"vault_shift_normal",title:"Vault Normal (Even Turn)",description:"Verify vault is normal on Turn 2.",relatedSkills:["VAULT"],category:"movement",difficulty:"intermediate",isTutorial:!0,tags:["state-shift","movement"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.setTile({q:3,r:5,s:-8},"lava"),t.spawnEnemy("footman",{q:4,r:3,s:-7},"victim")},run:t=>{t.wait(),t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>{const a={vaulted:i.some(o=>o.includes("Vaulted!"))};return Object.values(a).some(o=>o===!1)&&(console.log(" Vault Normal Failed:",a),console.log("Logs:",i)),Object.values(a).every(o=>o===!0)}}]},pv={id:"basic_move",name:"Basic Move",description:"Fundamental movement mechanics",scenarios:[{id:"walk_to_tile",title:"Movement 101",description:"Move your character from the center to an adjacent tile.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!0,tags:["movement","basics"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),t.setTile({q:4,r:6,s:-10},"wall")},run:t=>{t.move({q:4,r:6,s:-10}),t.move({q:4,r:4,s:-8})},verify:(t,i)=>{const a={positionCorrect:J(t.player.position,{q:4,r:4,s:-8}),logFound:i.some(o=>o.includes("blocked")),oneTurnSpent:t.turnsSpent===1};return Object.values(a).some(o=>o===!1)&&(console.log(" Scenario Failed Details:",a),console.log("Final Position:",t.player.position),console.log("Logs found:",i)),Object.values(a).every(o=>o===!0)}},{id:"free_move_out_of_combat",title:"Exploration Mode",description:"Verify that movement range expands only when no enemies are present.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["movement","exploration","free-move"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE","BASIC_ATTACK"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"adj_victim")},run:t=>{t.move({q:7,r:1,s:-8}),t.useSkill("BASIC_ATTACK",{q:3,r:5,s:-8}),t.move({q:7,r:1,s:-8})},verify:(t,i)=>{const a=i.filter(r=>r.toLowerCase().includes("out of reach")).length,o=i.some(r=>r.toLowerCase().includes("you attacked")),c={wasBlockedInitially:a===1,attackLogs:o,reachedDistantHex:J(t.player.position,{q:7,r:1,s:-8})};return Object.values(c).some(r=>r===!1)&&(console.log(" Free Move Scenario Failed:",c),console.log("Final Position:",t.player.position),console.log("Logs found:",i)),Object.values(c).every(r=>r===!0)}},{id:"invalid_enemy_move_intent_is_rejected_pre_execution",title:"Move Intent Rejected Before Execution",description:"Enemy AI may decide to move, but execution must not run a skill the actor does not own.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["movement","validation","intent"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:7,r:5,s:-12},"attacker_without_move");const i=t.getEnemy("attacker_without_move");i&&(i.activeSkills=(i.activeSkills||[]).filter(a=>a.id!=="BASIC_MOVE"))},run:t=>{t.wait()},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="attacker_without_move"),o={enemyDidNotMove:!!a&&J(a.position,{q:7,r:5,s:-12}),noMissingSkillRuntimeError:!i.some(c=>c.includes("does not have skill BASIC_MOVE"))};return Object.values(o).some(c=>c===!1)&&(console.log("Invalid Enemy Move Intent Rejection Failed:",o),console.log("Enemy:",a),console.log("Logs:",i)),Object.values(o).every(c=>c===!0)}},{id:"single_enemy_single_action_per_turn",title:"Single Action Per Actor Turn",description:"Each actor resolves exactly one action per turn in normal flow.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["turn-loop","movement","integrity"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:7,r:5,s:-12},"single_actor")},run:t=>{t.wait()},verify:(t,i)=>{const a={q:7,r:5,s:-12},o=t.enemies.find(f=>f.id==="single_actor"),c=o?_e(a,o.position):-1,r={enemyExists:!!o,movedExactlyOneTile:c===1,noZeroEffectMoveWarning:!i.some(f=>f.includes("produced ZERO effects"))};return Object.values(r).some(f=>f===!1)&&(console.log("Single Action Per Actor Turn Failed:",r),console.log("Enemy:",o),console.log("Logs:",i)),Object.values(r).every(f=>f===!0)}}]},Vs=t=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},SENTINEL_TELEGRAPH:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Telegraph",description:"Marks blast zone."},SENTINEL_BLAST:{slot:"offensive",range:3,cooldown:0,name:"Sentinel Blast",description:"Massive area blast."}}[t]||{slot:"offensive",range:1,cooldown:0,name:t,description:t};return{id:t,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},hv={id:"sentinel_blast",name:"Sentinel Blast",description:"Sentinel unique area-of-effect attack",scenarios:[{id:"blast_aoe",title:"Blast Away",description:"Use Sentinel Blast to hit multiple enemies.",relatedSkills:["SENTINEL_BLAST"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["aoe","damage","sentinel"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["SENTINEL_BLAST"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"center"),t.spawnEnemy("footman",{q:4,r:4,s:-8},"side")},run:t=>{t.useSkill("SENTINEL_BLAST",{q:3,r:5,s:-8})},verify:(t,i)=>i.some(a=>a.includes("massive blast"))},{id:"sentinel_playlist_two_turn_timing",title:"Playlist: Telegraph then Execute",description:"Boss uses a 2-turn skill playlist: telegraph first, blast on next turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["boss","playlist","telegraph"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=t.getEnemy("boss");i&&(i.activeSkills=[Vs("BASIC_MOVE"),Vs("BASIC_ATTACK"),Vs("SENTINEL_TELEGRAPH"),Vs("SENTINEL_BLAST")])},run:t=>{t.wait(),t.logs.push(`HP_AFTER_TELEGRAPH=${t.state.player.hp}`),t.wait()},verify:(t,i)=>{const a=i.find(r=>r.startsWith("HP_AFTER_TELEGRAPH=")),o=a?Number(a.split("=")[1]):-1,c={telegraphEmitted:i.some(r=>r.includes("marks the impact zone")),executeEmitted:i.some(r=>r.includes("massive blast")),noDamageOnTelegraphTurn:o===t.player.maxHp,damageOnExecuteTurn:t.player.hp<t.player.maxHp};return Object.values(c).some(r=>r===!1)&&(console.log("Sentinel Playlist Timing Failed:",c),console.log("Logs:",i),console.log("Player HP:",t.player.hp,"/",t.player.maxHp)),Object.values(c).every(r=>r===!0)}},{id:"sentinel_playlist_interruption_by_stun",title:"Playlist: Interruption Cancels Execute",description:"Stunning the boss during telegraph cancels the follow-up execute turn.",relatedSkills:["SENTINEL_TELEGRAPH","SENTINEL_BLAST"],category:"combat",difficulty:"advanced",isTutorial:!1,tags:["boss","playlist","interruption","stun"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("sentinel",{q:4,r:2,s:-6},"boss");const i=t.getEnemy("boss");i&&(i.activeSkills=[Vs("BASIC_MOVE"),Vs("BASIC_ATTACK"),Vs("SENTINEL_TELEGRAPH"),Vs("SENTINEL_BLAST")])},run:t=>{t.wait(),t.applyStatus("boss","stunned",1),t.wait()},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="boss"),o={telegraphEmitted:i.some(c=>c.includes("marks the impact zone")),executeCancelled:!i.some(c=>c.includes("massive blast")),playerUnharmed:t.player.hp===t.player.maxHp,bossStillExists:!!a};return Object.values(o).some(c=>c===!1)&&(console.log("Sentinel Playlist Interruption Failed:",o),console.log("Logs:",i),console.log("Player HP:",t.player.hp,"/",t.player.maxHp),console.log("Boss:",a)),Object.values(o).every(c=>c===!0)}}]},gv={id:"fireball",name:"Fireball",description:"Validates axial targeting, AoE damage, and environmental fire placement.",scenarios:[{id:"fireball_axial_aoe",title:"Axial Alignment & AoE Spread",description:"Verify the skill only fires axially and damages all neighbors at the impact site.",relatedSkills:["FIREBALL"],category:"combat",difficulty:"beginner",isTutorial:!1,tags:["aoe","axial","fire"],setup:t=>{t.setPlayer({q:3,r:6,s:-9},["FIREBALL"]),t.spawnEnemy("footman",{q:5,r:4,s:-9},"primary_target"),t.spawnEnemy("footman",{q:6,r:4,s:-10},"neighbor_target"),t.spawnEnemy("footman",{q:6,r:5,s:-11},"diagonal_enemy"),t.setTile({q:6,r:3,s:-9},"wall"),t.setTile({q:6,r:6,s:-12},"wall"),t.setTile({q:5,r:6,s:-11},"lava")},run:t=>{t.useSkill("FIREBALL",{q:7,r:5,s:-12}),t.useSkill("FIREBALL",{q:5,r:4,s:-9})},verify:()=>!0},{id:"fireball_max_range_edge",title:"Max Range & Fire Duration",description:"Verify fireball at exactly range 3 and check fire duration persistence.",relatedSkills:["FIREBALL"],category:"balancing",difficulty:"intermediate",isTutorial:!1,tags:["range","persistence"],setup:t=>{t.setPlayer({q:0,r:0,s:0},["FIREBALL"]),t.setTile({q:0,r:3,s:-3},"grass")},run:t=>{t.useSkill("FIREBALL",{q:0,r:3,s:-3}),t.wait(),t.wait()},verify:()=>!0}]},yv={id:"hazards_v1",name:"Hazard Consolidation",description:"Verifies centralized hazard logic and flight immunity",scenarios:[{id:"Jump Over Lava",title:"Jump Over Lava",description:"Jumping over lava should not result in damage.",relatedSkills:["JUMP"],category:"hazards",tags:["lava","jump"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["JUMP"]),t.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:t=>{t.useSkill("JUMP",{q:4,r:7,s:-11})},verify:t=>{const i=t.player,a={playerPos:J(i.position,{q:4,r:7,s:-11}),isAlive:i.hp===i.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Walk Into Lava",title:"Walk Into Lava",description:"Walking into lava should be invalid unless the mover is hazard-safe.",relatedSkills:["BASIC_MOVE"],category:"hazards",tags:["lava","walk"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["BASIC_MOVE"]),t.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:t=>{t.useSkill("BASIC_MOVE",{q:4,r:8,s:-12})},verify:t=>{const i=t.player,a={playerPos:J(i.position,{q:4,r:9,s:-13}),hpUnchanged:i.hp===i.maxHp};return Object.values(a).every(o=>o===!0)}},{id:"Falcon Flying Over Lava",title:"Falcon Flying Over Lava",description:"Flying units (Falcon) should ignore lava during transit and stay.",relatedSkills:["FALCON_COMMAND"],category:"hazards",tags:["lava","falcon","flight"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),t.state.tiles.set("4,8",{baseId:"LAVA",position:{q:4,r:8,s:-12},traits:new Set(["HAZARDOUS","LAVA","LIQUID"]),effects:[]})},run:t=>{t.wait()},verify:t=>{const i=t.enemies.find(o=>o.id==="my-falcon"),a={falconExists:!!i,falconAlive:(i?.hp||0)>0,falconPos:J(i?.position,{q:4,r:8,s:-12})};return Object.values(a).every(o=>o===!0)}}]},bv={id:"falcon_command_v2",name:"Falcon's Command",description:"Validates Predator/Scout mode transitions and spatial orbit logic.",scenarios:[{id:"falcon_predator_strike_path",title:"Predator Mode: Apex Strike Geometry",description:`
                Tests the Falcon's flight path from its current position to the Target.
                Layout:
                   (F)  <- Falcon Start (6, 5, -11)
                      .
                         (T) <- Target/Prey (8, 5, -13)
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.spawnFalcon({q:3,r:9,s:-12},"my-falcon"),t.spawnEnemy("footman",{q:4,r:2,s:-6},"prey")},run:t=>{t.useSkill("FALCON_COMMAND",{q:4,r:2,s:-6}),t.wait()},verify:(t,i)=>{const a=t.companions?.find(r=>r.id==="my-falcon"),o=t.enemies.find(r=>r.id==="prey"),c={modeSet:a?.companionState?.mode==="predator",targetLocked:a?.companionState?.markTarget==="prey",movedCloser:a&&_e(a.position,{q:4,r:2,s:-6})<7,preyHealthy:o?.hp===o?.maxHp,turnSpent:t.turnsSpent===2};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Falcon Predator Strike Failed:",c),console.log("Falcon:",a)),Object.values(c).every(r=>r===!0)}},{id:"falcon_scout_orbit",title:"Scout Mode: Hex Ring Orbit",description:`
                Ensures that in Scout mode, the Falcon rotates around the mark 
                on the flat-top hex ring.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","summon","companion"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.spawnFalcon({q:3,r:9,s:-12},"my-falcon")},run:t=>{t.useSkill("FALCON_COMMAND",{q:3,r:6,s:-9}),t.wait(),t.wait()},verify:(t,i)=>{const a=t.companions?.find(r=>r.id==="my-falcon"),o={q:3,r:6,s:-9},c={isScout:a?.companionState?.mode==="scout",onOrbitRing:a&&_e(a.position,o)===1,hasRotated:a&&!!a.previousPosition&&!J(a.position,a.previousPosition),turnSpent:t.turnsSpent===3};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Falcon Scout Orbit Failed:",c),console.log("Falcon:",a)),Object.values(c).every(r=>r===!0)}},{id:"falcon_roost_mode",title:"Roost Mode: Return and Heal",description:`
                Ensures that when targeting self, the Falcon returns to the Hunter
                and provides a heal on arrival.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"beginner",isTutorial:!0,tags:["falcon","roost","heal"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.state.player.hp=2,t.spawnFalcon({q:3,r:6,s:-9},"my-falcon")},run:t=>{t.useSkill("FALCON_COMMAND",{q:4,r:9,s:-13}),t.wait(),t.wait()},verify:(t,i)=>{const a=t.companions?.find(r=>r.id==="my-falcon"),o=t.player,c={modeRoost:a?.companionState?.mode==="roost",healed:o.hp>2,closeToHunter:a&&_e(a.position,o.position)<=1};return Object.values(c).some(r=>r===!1)&&console.log(" Scenario Falcon Roost Heal Failed:",c),Object.values(c).every(r=>r===!0)}},{id:"falcon_predator_auto_return",title:"Predator Mode: Auto-Roost on Kill",description:`
                Ensures that if a marked predator target dies, the Falcon
                automatically reverts to Roost mode.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!0,tags:["falcon","predator","cleanup"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.state.player.hp=1,t.spawnFalcon({q:4,r:8,s:-12},"my-falcon"),t.spawnEnemy("footman",{q:4,r:7,s:-11},"prey")},run:t=>{t.useSkill("FALCON_COMMAND",{q:4,r:7,s:-11}),t.wait(),t.wait(),t.wait()},verify:(t,i)=>{const a=t.companions?.find(f=>f.id==="my-falcon"),o=t.enemies.find(f=>f.id==="prey"),c=t.player,r={preyDead:!o,autoRoost:a?.companionState?.mode==="roost",healed:c.hp>1};return Object.values(r).some(f=>f===!1),Object.values(r).every(f=>f===!0)}},{id:"falcon_command_metadata_null_safety",title:"Command Metadata Null-Safety",description:`
                Ensures FALCON_COMMAND name/description resolution is safe
                when player context is remapped in harness-like states.
            `,relatedSkills:["FALCON_COMMAND"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["falcon","null-safety","metadata"],setup:t=>{t.setPlayer({q:4,r:9,s:-13},["FALCON_COMMAND"]),t.state.player.id="hunter_remapped"},run:t=>{t.wait()},verify:(t,i)=>{const a={playerIdRemapped:t.player.id==="hunter_remapped",noRuntimeReferenceError:!i.some(o=>o.toLowerCase().includes("cannot read properties"))};return Object.values(a).some(o=>o===!1)&&console.log("Falcon Command Metadata Null-Safety Failed:",a),Object.values(a).every(o=>o===!0)}}]},Sv={id:"kinetic_tri_trap",name:"Kinetic Tri-Trap",description:"Tests for trap deployment and fling mechanics",scenarios:[{id:"tri_trap_basic_deployment",title:"Trap Deployment",description:"Deploy 3 traps on axial tiles at range 2.",relatedSkills:["KINETIC_TRI_TRAP"],category:"deployment",difficulty:"beginner",isTutorial:!0,tags:["trap","deployment"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),t.state.player.archetype="HUNTER"},run:t=>{t.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.player.position,o=t.traps||[],c={countIsThree:o.length===3,isAtRangeTwo:o.every(r=>_e(r.position,a)===2),isAxialToPlayer:o.every(r=>r.position.q===a.q||r.position.r===a.r||r.position.s===a.s),trapsHidden:o.every(r=>!r.isRevealed)};return Object.values(c).some(r=>r===!1)&&(console.log(" Scenario Tri-Trap Deployment Failed:",c),console.log("Traps:",t.traps),console.log("Logs:",i)),Object.values(c).every(r=>r===!0)}},{id:"tri_trap_state_tracking",title:"Trap State Tracking",description:"Traps are tracked with correct owner and hidden state.",relatedSkills:["KINETIC_TRI_TRAP"],category:"state",difficulty:"intermediate",isTutorial:!1,tags:["trap","state"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["KINETIC_TRI_TRAP"]),t.state.player.archetype="HUNTER"},run:t=>{t.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10}),t.useSkill("KINETIC_TRI_TRAP",{q:5,r:5,s:-10})},verify:(t,i)=>{const a=t.traps,o={trapsExist:a&&a.length>0,allHidden:a?.every(c=>!c.isRevealed)??!1,allZeroCooldown:a?.every(c=>c.cooldown===0)??!1,deployMessage:i.some(c=>c.includes("trap")||c.includes("Trap")),trapsCount:a?.length===3};return Object.values(o).some(c=>c===!1)&&(console.log(" Trap State Failed:",o),console.log("Traps:",t.traps)),Object.values(o).every(c=>c===!0)}}]},vv={id:"withdrawal",name:"Withdrawal",description:"Tests for shot + backroll mechanics and passive reaction",scenarios:[{id:"withdrawal_basic",title:"Shot and Backroll",description:"Shoot adjacent enemy and backroll to safety.",relatedSkills:["WITHDRAWAL"],category:"combat",difficulty:"beginner",isTutorial:!0,tags:["shot","backroll","displacement"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),t.state.player.archetype="HUNTER",t.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:t=>{t.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="target"),o={enemyDamagedOrDead:!a||a.hp<a.maxHp,playerMoved:t.player.position.q!==5||t.player.position.r!==5,playerBackrolled:t.player.position.q<5,shotFired:i.some(c=>c.includes("Withdrawal")||c.includes("shot"))};return Object.values(o).some(c=>c===!1)&&(console.log(" Withdrawal Failed:",o),console.log("Player:",t.player.position),console.log("Target HP:",a?.hp)),Object.values(o).every(c=>c===!0)}},{id:"withdrawal_wall_block",title:"Backroll Blocked by Wall",description:"Backroll finds alternate safe spot when wall blocks retreat.",relatedSkills:["WITHDRAWAL"],category:"collision",difficulty:"intermediate",isTutorial:!1,tags:["backroll","wall","pathfinding"],setup:t=>{t.setPlayer({q:5,r:5,s:-10},["WITHDRAWAL"]),t.state.player.archetype="HUNTER",t.setTile({q:4,r:5,s:-9},"wall"),t.setTile({q:3,r:5,s:-8},"wall"),t.spawnEnemy("footman",{q:6,r:5,s:-11},"target")},run:t=>{t.useSkill("WITHDRAWAL",{q:6,r:5,s:-11})},verify:(t,i)=>{const a={playerNotOnWall:!J(t.player.position,{q:4,r:5,s:-9}),playerMoved:t.player.position.q!==5||t.player.position.r!==5};return Object.values(a).some(o=>o===!1)&&(console.log(" Wall Block Failed:",a),console.log("Player:",t.player.position)),Object.values(a).every(o=>o===!0)}}]},xv={id:"absorb_fire",name:"Absorb Fire Passive",description:"Verifies that fire damage is converted to healing.",scenarios:[{id:"Absorb Fire Damage",title:"Stand on Fire",description:"Player with Absorb Fire should be healed when standing on fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",tags:["fire","healing"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE"]),t.state.player.hp=1,t.setTile({q:4,r:5,s:-9},"stone");const i={q:4,r:5,s:-9},a=t.getTileAt(i);a&&a.effects.push({id:"FIRE",duration:3,potency:1})},run:t=>{t.wait()},verify:t=>{const i=t.player;return i.hp<=1&&console.log("Stand on Fire Failed: HP did not increase",i.hp),i.hp>1}},{id:"Absorb Lava Damage",title:"Walk into Lava",description:"Player with Absorb Fire should be healed when walking into lava.",relatedSkills:["ABSORB_FIRE","BASIC_MOVE"],category:"passive",tags:["lava","healing"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["ABSORB_FIRE","BASIC_MOVE"]),t.state.player.hp=1,t.setTile({q:4,r:6,s:-10},"lava")},run:t=>{t.useSkill("BASIC_MOVE",{q:4,r:6,s:-10})},verify:t=>{const i=t.player,a={alive:i.hp>0,healed:i.hp===i.maxHp,onLava:J(i.position,{q:4,r:6,s:-10})};return(!a.alive||!a.healed||!a.onLava)&&(console.log("Walk into Lava Failed:",a,"HP:",i.hp,"MaxHP:",i.maxHp),console.log("Player Pos:",i.position)),Object.values(a).every(o=>o===!0)}}]},Av={id:"tile_interactions",name:"Tile Interactions",description:"Verifies interactions with special tiles like Shrines and Stairs.",scenarios:[{id:"shrine_interaction",title:"Shrine Interaction",description:"Moving onto a shrine should trigger an upgrade choice.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["shrine","upgrade"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),t.state.shrinePosition={q:4,r:6,s:-10},t.state.tiles.set("4,6",{baseId:"SHRINE",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","SHRINE"]),effects:[]})},run:t=>{t.move({q:4,r:6,s:-10})},verify:t=>{const i={playerOnShrine:J(t.player.position,{q:4,r:6,s:-10}),isChoosingUpgrade:t.pendingStatus?.status==="choosing_upgrade",hasOptions:t.pendingStatus?.shrineOptions?.length>0};return Object.values(i).every(a=>a===!0)}},{id:"stairs_interaction",title:"Stairs Interaction",description:"Moving onto stairs should trigger level transition.",relatedSkills:["BASIC_MOVE"],category:"progression",tags:["stairs","portal"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"]),t.state.stairsPosition={q:4,r:6,s:-10},t.state.tiles.set("4,6",{baseId:"STAIRS",position:{q:4,r:6,s:-10},traits:new Set(["INTERACTABLE","STAIRS"]),effects:[]})},run:t=>{t.move({q:4,r:6,s:-10})},verify:t=>{const i={playerOnStairs:J(t.player.position,{q:4,r:6,s:-10}),isTransitioning:t.pendingStatus?.status==="playing"||t.pendingStatus?.status==="won",messageFound:t.message.some(a=>a.includes("Descending")||a.includes("Cleared"))};return Object.values(i).every(a=>a===!0)}}]},Tv={id:"telegraph_projection",name:"Telegraph Projection",description:"Deterministic intent previews for next-turn danger tiles.",scenarios:[{id:"telegraph_projection_is_deterministic",title:"Projection Determinism",description:"Same state should always produce the same danger projection.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","determinism"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:7,r:5,s:-12},"threat")},run:t=>{t.wait()},verify:t=>{const i=t.intentPreview,a=i?.dangerTiles||[],o=i?.projections||[],c=a.map(A=>`${A.q},${A.r},${A.s}`),r=new Set(c),f=c.every((A,v)=>v===0||c[v-1].localeCompare(A)<=0),g=o.map(A=>`${A.actorId}|${A.skillId}|${A.targetHex?`${A.targetHex.q},${A.targetHex.r},${A.targetHex.s}`:"none"}`),b=g.every((A,v)=>v===0||g[v-1].localeCompare(A)<=0),y={hasEnginePreview:!!i,noDuplicateTiles:r.size===c.length,tilesAreSorted:f,projectionsAreSorted:b};return Object.values(y).some(A=>A===!1)&&(console.log("Telegraph Projection Determinism Failed:",y),console.log("Engine Preview:",i)),Object.values(y).every(A=>A===!0)}},{id:"telegraph_projection_matches_execute_footprint",title:"Projection Matches Execute Footprint",description:"Projected danger tiles should include the tile actually damaged on execution.",relatedSkills:["BASIC_ATTACK"],category:"telegraph",difficulty:"intermediate",isTutorial:!1,tags:["projection","parity","combat"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},[]),t.spawnEnemy("footman",{q:4,r:2,s:-6},"threat")},run:t=>{t.wait();const o=t.state.intentPreview?.projections?.find(c=>c.actorId==="threat")?.dangerTiles?.[0];o?t.logs.push(`PREVIEW_TILE=${o.q},${o.r},${o.s}`):t.logs.push("PREVIEW_TILE=none"),t.wait()},verify:(t,i)=>{const a=t.enemies.find(g=>g.id==="threat"),c=i.find(g=>g.startsWith("PREVIEW_TILE="))?.split("=")[1]||"none",r=c==="none"?void 0:(()=>{const[g,b,y]=c.split(",").map(A=>Number(A));return{q:g,r:b,s:y}})(),f={previewProducedTile:!!r,projectedTileMatchesExecute:!!r&&!!a&&J(a.position,r)};return Object.values(f).some(g=>g===!1)&&(console.log("Telegraph Projection Parity Failed:",f),console.log("Logs:",i),console.log("Player HP:",t.player.hp,"/",t.player.maxHp)),Object.values(f).every(g=>g===!0)}}]},_d=t=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},DASH:{slot:"passive",range:4,cooldown:0,name:"Kinetic Dash",description:"Dash in a straight line."}}[t]||{slot:"offensive",range:1,cooldown:0,name:t,description:t};return{id:t,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},Ev={id:"raider_dash",name:"Raider Dash",description:"Parity checks for enemy Raider reusing the player DASH contract.",scenarios:[{id:"player_dash_stops_before_adjacent_enemy",title:"Parity Baseline: Player Dash Stops Before Blocker",description:"Player DASH should stop on the tile before an occupied target.",relatedSkills:["DASH"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["parity","dash","reuse"],setup:t=>{t.setPlayer({q:4,r:2,s:-6},["DASH"]),t.spawnEnemy("footman",{q:4,r:6,s:-10},"blocker"),t.state.hasShield=!1},run:t=>{t.useSkill("DASH",{q:4,r:6,s:-10})},verify:(t,i)=>{const a={playerStoppedBeforeBlocker:t.player.position.q===4&&t.player.position.r===5,dashResolved:i.some(o=>o.includes("Stopped by an obstacle")||o.includes("Dashed!")||o.includes("Shield Shunt"))};return Object.values(a).every(o=>o===!0)}},{id:"raider_ai_uses_dash_with_player_contract",title:"Parity: Raider Uses Same Dash Stop Rule",description:"Raider AI selects DASH and lands on the same stop tile as player-owned DASH in mirrored geometry.",relatedSkills:["DASH"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","dash"],setup:t=>{t.setPlayer({q:4,r:6,s:-10},[]),t.spawnEnemy("raider",{q:4,r:2,s:-6},"raider"),t.state.hasShield=!1;const i=t.getEnemy("raider");i&&(i.activeSkills=[_d("BASIC_MOVE"),_d("BASIC_ATTACK"),_d("DASH")])},run:t=>{t.wait()},verify:(t,i)=>{const a=t.enemies.find(c=>c.id==="raider"),o={raiderStillAlive:!!a,raiderStoppedBeforePlayer:!!a&&a.position.q===4&&a.position.r===5,playerUnharmed:t.player.hp===t.player.maxHp,dashResolved:i.some(c=>c.includes("Stopped by an obstacle")||c.includes("Dashed!")||c.includes("Shield Shunt"))};return Object.values(o).every(c=>c===!0)}}]},wd=t=>{const a={BASIC_MOVE:{slot:"passive",range:1,cooldown:0,name:"Walk",description:"Move to adjacent tile."},BASIC_ATTACK:{slot:"passive",range:1,cooldown:0,name:"Basic Attack",description:"Strike adjacent target."},GRAPPLE_HOOK:{slot:"offensive",range:4,cooldown:0,name:"Grapple Hook",description:"Pull and swap with target."}}[t]||{slot:"offensive",range:1,cooldown:0,name:t,description:t};return{id:t,name:a.name,description:a.description,slot:a.slot,cooldown:a.cooldown,currentCooldown:0,range:a.range,upgrades:[],activeUpgrades:[]}},_v={id:"pouncer_hook",name:"Pouncer Hook",description:"Second archetype reuse: enemy uses player GRAPPLE_HOOK via normal skill execution.",scenarios:[{id:"pouncer_uses_grapple_hook_deterministically",title:"Pouncer Uses Grapple Hook Through Skill Pipeline",description:"Pouncer selects GRAPPLE_HOOK from AI and resolves via standard USE_SKILL execution.",relatedSkills:["GRAPPLE_HOOK"],category:"combat",difficulty:"intermediate",isTutorial:!1,tags:["parity","enemy-ai","determinism"],setup:t=>{t.setPlayer({q:4,r:6,s:-10},[]),t.spawnEnemy("pouncer",{q:4,r:2,s:-6},"pouncer");const i=t.getEnemy("pouncer");i&&(i.activeSkills=[wd("BASIC_MOVE"),wd("BASIC_ATTACK"),wd("GRAPPLE_HOOK")])},run:t=>{t.wait()},verify:(t,i)=>{const o={pouncerStillAlive:!!t.enemies.find(c=>c.id==="pouncer"),grappleExecuted:i.filter(c=>c.includes("Vaulted and Flung!")).length>=1,deterministicStatus:i.filter(c=>c.includes("You are stunned!")).length===1,noZeroEffectWarning:!i.some(c=>c.includes("produced ZERO effects"))};return Object.values(o).every(c=>c===!0)}}]},wv={id:"ice",name:"Ice Terrain",description:"ICE/SLIPPERY terrain behavior for pass-through momentum and landing slide.",scenarios:[{id:"ice_pass_preserves_dash_momentum",title:"Ice Pass: Dash Carries Momentum",description:"Passing through ICE during DASH should preserve momentum and carry movement beyond nominal target.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","ice","momentum","pass"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["DASH"]),t.state.hasShield=!1,t.setTile({q:5,r:4,s:-9},"slippery"),t.setTile({q:6,r:4,s:-10},"floor"),t.setTile({q:7,r:4,s:-11},"floor")},run:t=>{t.useSkill("DASH",{q:6,r:4,s:-10})},verify:t=>t.player.position.q>6},{id:"ice_land_slides_after_basic_move",title:"Ice Land: Basic Move Slides Forward",description:"Landing on ICE with BASIC_MOVE should slide one hex in the move direction when the next tile is walkable.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"beginner",isTutorial:!1,tags:["terrain","ice","slide","land"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["BASIC_MOVE"]),t.setTile({q:5,r:4,s:-9},"slippery"),t.setTile({q:6,r:4,s:-10},"floor")},run:t=>{t.move({q:5,r:4,s:-9})},verify:t=>t.player.position.q===6&&t.player.position.r===4}]},Mv={id:"snare",name:"Snare Terrain",description:"Snare tile effect movement restriction and status interaction.",scenarios:[{id:"snare_interrupts_dash_and_roots_actor",title:"Snare Interrupts Dash",description:"DASH into a snare tile should halt movement at snare and apply rooted status.",relatedSkills:["DASH"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["terrain","snare","movement-restriction"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["DASH"]),t.state.hasShield=!1,t.state.tiles.set("5,4",{baseId:"STONE",position:{q:5,r:4,s:-9},traits:new Set(["WALKABLE"]),effects:[{id:"SNARE",duration:-1,potency:1}]}),t.setTile({q:6,r:4,s:-10},"floor"),t.setTile({q:7,r:4,s:-11},"floor")},run:t=>{t.useSkill("DASH",{q:7,r:4,s:-11})},verify:(t,i)=>{const a=t.player.statusEffects.some(c=>c.type==="rooted"),o={stoppedAtSnare:t.player.position.q===5&&t.player.position.r===4,rootedApplied:a,snareMessageLogged:i.some(c=>c.includes("Snared! Movement halted."))};return Object.values(o).every(c=>c===!0)}}]},Ov={id:"relics",name:"Relics",description:"Passive relic behaviors using existing engine hooks only.",scenarios:[{id:"relic_ember_ward_reduces_fire_damage",title:"Relic: Ember Ward",description:"Equipping Ember Ward reduces incoming fire damage by 1.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"beginner",isTutorial:!1,tags:["relic","fire","passive"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.upgrades=[...t.state.upgrades||[],"RELIC_EMBER_WARD"],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:(t,i)=>{const a={hpUnchanged:t.player.hp===t.player.maxHp,relicMessageSeen:i.some(o=>o.includes("Ember Ward dampens the flames."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_cinder_orb_stacks_with_absorb_fire",title:"Relic: Cinder Orb Stacking",description:"Cinder Orb adds bonus healing when fire damage is converted by Absorb Fire.",relatedSkills:["ABSORB_FIRE"],category:"passive",difficulty:"advanced",isTutorial:!1,tags:["relic","stacking","absorb-fire"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["ABSORB_FIRE"]),t.state.player={...t.state.player,hp:1,maxHp:3},t.state.upgrades=[...t.state.upgrades||[],"RELIC_CINDER_ORB"],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:(t,i)=>{const a={healedByStacking:t.player.hp===3,stackingMessageSeen:i.some(o=>o.includes("Cinder Orb amplifies the absorption."))};return Object.values(a).every(o=>o===!0)}},{id:"relic_steady_plates_end_to_end",title:"Relic: Steady Plates",description:"Steady Plates grants turn-start armor that resolves against incoming damage in the same round.",relatedSkills:["BASIC_MOVE"],category:"passive",difficulty:"intermediate",isTutorial:!1,tags:["relic","armor","turn-start"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.upgrades=[...t.state.upgrades||[],"RELIC_STEADY_PLATES"],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:(t,i)=>{const a={playerHpProtected:t.player.hp===t.player.maxHp,damageEventOccurred:i.some(o=>o.includes("player burns!")),armorPresentAfterCycle:t.player.temporaryArmor>=0&&t.player.temporaryArmor<=2,relicTriggerMessageSeen:i.some(o=>o.includes("Steady Plates harden your stance."))};return Object.values(a).every(o=>o===!0)}}]},Cv=250,Nv=700,Rv=100,kv=8,Lv=220,Bv=260,Iv=40,ty=(t,i)=>{const a=t.floor||0,o=t.player?.hp||0,c=t.turnsSpent??t.turnNumber??0,r=t.kills||0,f=t.environmentalKills||0,g=t.hazardBreaches||0,b=(i||[]).filter(y=>y.success).length*Cv;return a*Nv+o*Rv+r*Lv+f*Bv-c*kv-g*Iv+b},jv=t=>{if(typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t))return t;const i=t instanceof Date?t:new Date,a=i.getFullYear(),o=String(i.getMonth()+1).padStart(2,"0"),c=String(i.getDate()).padStart(2,"0");return`${a}-${o}-${c}`},Dv=t=>`daily:${t}`,Hv=t=>{const i=18+Math.floor(oc(t,0)*8);return[{id:"TURN_LIMIT",label:`Finish within ${i} turns`,target:i},{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}]},tc=t=>(t.runObjectives||[]).map(a=>{if(a.id==="TURN_LIMIT"){const c=t.turnsSpent||0;return{...a,value:c,success:c<=a.target}}const o=t.hazardBreaches||0;return{...a,value:o,success:o<=a.target}}),xl=t=>{const i=t.initialSeed??t.rngSeed??"0",a=tc(t),o=t.combatScoreEvents||[],c=o.length?Number((o.reduce((f,g)=>f+g.efficiency,0)/o.length).toFixed(4)):0,r=o.filter(f=>f.riskBonusApplied).length;return{seed:i,actionLog:t.actionLog,score:ty(t,a),floor:t.floor,objectives:a,combatTelemetry:{events:o.length,avgEfficiency:c,riskBonusEvents:r}}},Pv={id:"objectives",name:"Objectives",description:"Daily objective validation for turn-limit and hazard constraints.",scenarios:[{id:"objective_turn_limit_boundary",title:"Objective: Turn Limit Boundary",description:"Turn-limit objective passes at boundary and fails above boundary.",relatedSkills:["BASIC_MOVE"],category:"progression",difficulty:"intermediate",isTutorial:!1,tags:["objective","turn-limit"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.runObjectives=[{id:"TURN_LIMIT",label:"Finish within 1 turns",target:1}]},run:t=>{t.wait()},verify:t=>{const a=tc(t)[0]?.success===!0,o=xl(t).score,c=tc({...t,turnsSpent:(t.turnsSpent||0)+1}),r={...t,turnsSpent:(t.turnsSpent||0)+1},f=xl(r).score,g=c[0]?.success===!1,b=f<o;return a&&g&&b}},{id:"objective_hazard_constraint_fail_on_hazard",title:"Objective: Hazard Constraint",description:"Hazard objective fails after prohibited hazard interaction.",relatedSkills:["BASIC_MOVE"],category:"hazards",difficulty:"intermediate",isTutorial:!1,tags:["objective","hazard"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},[]),t.state.runObjectives=[{id:"HAZARD_CONSTRAINT",label:"Take no hazard damage",target:0}],t.state.tiles.set("4,4",{baseId:"STONE",position:{q:4,r:4,s:-8},traits:new Set(["WALKABLE"]),effects:[{id:"FIRE",duration:-1,potency:1}]})},run:t=>{t.wait()},verify:t=>{const i=tc(t)[0];return(t.hazardBreaches||0)>0&&!!i&&i.success===!1}}]},Uv={id:"necromancer",name:"Necromancer",description:"Corpse persistence and summon migration contracts.",scenarios:[{id:"necromancer_corpse_persistence",title:"Corpse Persists Until Consumed",description:"Kill an enemy, wait 5 turns, then Raise Dead succeeds from corpse tile trait.",relatedSkills:["BASIC_ATTACK","RAISE_DEAD"],category:"summon",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","corpse","persistence"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["BASIC_ATTACK","RAISE_DEAD"],"VANGUARD"),t.spawnEnemy("footman",{q:5,r:4,s:-9},"dummy");const i=t.getEnemy("dummy");i&&(i.hp=1,i.maxHp=1)},run:t=>{const i={q:5,r:4,s:-9};t.useSkill("BASIC_ATTACK",i);for(let a=0;a<5;a++)t.wait();t.useSkill("RAISE_DEAD",i)},verify:t=>{const i=de({q:5,r:4}),a=t.tiles.get(i),o=t.enemies.find(g=>g.subtype==="skeleton"&&g.factionId==="player"),c=t.companions?.find(g=>g.id===o?.id),r=new Set((o?.activeSkills||[]).map(g=>g.id)),f={corpseConsumed:!a?.traits?.has("CORPSE"),skeletonRaised:!!o,skeletonOnCorpseTile:!!o&&o.position.q===5&&o.position.r===4,companionRegistered:!!c,hasBasicLoadout:r.has("BASIC_MOVE")&&r.has("BASIC_ATTACK")};return Object.values(f).every(Boolean)}},{id:"summon_floor_transition",title:"Summon Persists Across Floor Transition",description:"Raised skeleton migrates with player to floor 2.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","summon","floor-transition"],setup:t=>{t.setPlayer({q:4,r:4,s:-8},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:4,s:-9},a=de(i),o=t.getTileAt(i);t.state.tiles.set(a,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])})},run:t=>{const i={q:5,r:4,s:-9};t.useSkill("RAISE_DEAD",i),t.state.player={...t.state.player,position:{...t.state.stairsPosition}},t.wait(),t.dispatchSync({type:"RESOLVE_PENDING"})},verify:t=>{const i=t.enemies.find(o=>o.subtype==="skeleton"&&o.factionId==="player"&&o.companionOf===t.player.id),a={floorAdvanced:t.floor===2,summonStillPresent:!!i,summonTracksOwner:!!i&&i.companionOf===t.player.id};return Object.values(a).every(Boolean)}},{id:"companion_does_not_block_free_move",title:"Companion Does Not Block Exploration Free Move",description:"Friendly skeleton companion should not count as hostile for BASIC_MOVE exploration range.",relatedSkills:["BASIC_MOVE"],category:"movement",difficulty:"intermediate",isTutorial:!1,tags:["necromancer","companion","movement"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["BASIC_MOVE"],"VANGUARD"),t.spawnEnemy("footman",{q:5,r:5,s:-10},"friendly_skeleton");const i=t.getEnemy("friendly_skeleton");i&&(i.subtype="skeleton",i.factionId="player",i.companionOf=t.state.player.id,i.activeSkills=i.activeSkills||[],t.state.companions=[...t.state.companions||[],i])},run:t=>{t.move({q:7,r:1,s:-8})},verify:t=>{const i={movedFar:t.player.position.q===7&&t.player.position.r===1,turnsAdvanced:t.turnsSpent>=1};return Object.values(i).every(Boolean)}},{id:"raise_dead_pushes_ally_from_target_hex",title:"Raise Dead Pushes Ally Occupant",description:"If corpse tile is occupied by an ally, ally is displaced and summon succeeds without overlap.",relatedSkills:["RAISE_DEAD"],category:"summon",difficulty:"advanced",isTutorial:!1,tags:["necromancer","occupancy","push"],setup:t=>{t.setPlayer({q:4,r:5,s:-9},["RAISE_DEAD"],"VANGUARD");const i={q:5,r:5,s:-10},a=de(i),o=t.getTileAt(i);t.state.tiles.set(a,{...o,position:i,traits:new Set([...o?.traits||[],"CORPSE"])}),t.spawnEnemy("footman",i,"ally_blocker");const c=t.getEnemy("ally_blocker");c&&(c.subtype="skeleton",c.factionId="player",c.companionOf=t.state.player.id,t.state.companions=[...t.state.companions||[],c])},run:t=>{t.useSkill("RAISE_DEAD",{q:5,r:5,s:-10})},verify:t=>{const i=t.enemies.filter(g=>g.subtype==="skeleton"&&g.factionId==="player"),a=new Set;let o=!1;i.forEach(g=>{const b=de(g.position);a.has(b)&&(o=!0),a.add(b)});const c=i.some(g=>g.position.q===5&&g.position.r===5),r=i.some(g=>g.id==="ally_blocker"&&!(g.position.q===5&&g.position.r===5));return Object.values({raisedAtCorpse:c,pushedExists:r,noOverlap:!o}).every(Boolean)}}]};function qv(t){return{id:t.id,title:t.title,description:t.description,rationale:t.rationale,setup:t.setup,run:t.run,verify:t.verify}}const zv=[ZS,ev,tv,nv,lv,rv,cv,uv,dv,fv,mv,yv,pv,hv,gv,bv,Sv,vv,xv,Av,Tv,Ev,_v,wv,Mv,Ov,Pv,Uv],Vv=zv.flatMap(t=>t.scenarios);function $v(t){return Vv.filter(i=>i.relatedSkills.includes(t))}function St(t){return $v(t).map(qv)}const ny={id:"AUTO_ATTACK",name:"Auto Attack",description:"Automatically strike adjacent enemies that started the turn adjacent to you.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(t,i,a,o=[],c)=>{const r=[],f=[];let g=0;const b=(t.timelineEvents||[]).some(E=>E.phase==="STATUS_APPLY"&&E.type==="ApplyStatus"&&E.payload?.status==="stunned"&&(E.payload?.target===i.id||typeof E.payload?.target=="object"&&E.payload?.target&&J(E.payload.target,i.position)));if(ji(i)||b)return{effects:r,messages:f,kills:0};const y=xt(i.position);let A=1;o.includes("HEAVY_HANDS")&&(A+=1);const v=c?.persistentTargetIds||[],x=c?.previousNeighbors||[];if(v.length===0&&x.length===0)return{effects:r,messages:f,kills:0};for(const E of y){const m=Ae(t,E);if(!m||m.hp<=0||m.id===i.id||i.factionId===m.factionId)continue;if(v.length>0?v.includes(m.id):x.some(R=>J(R,E))){const R=gn({attackerId:i.id,targetId:m.id,skillId:"AUTO_ATTACK",basePower:A,trinity:Qe(i),targetTrinity:Qe(m),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});r.push({type:"Damage",target:E,amount:R.finalPower,scoreEvent:R.scoreEvent});const k=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,B=m.factionId==="player"?"you":`${m.subtype||"enemy"}#${m.id}`;f.push(`${k} attacked ${B}!`),m.hp<=A&&g++}}if(o.includes("CLEAVE")&&r.length>0)for(const E of y){if(r.some(w=>w.type==="Damage"&&typeof w.target=="object"&&"q"in w.target&&J(w.target,E)))continue;const h=Ae(t,E);if(!h||h.id===i.id||!(i.factionId!==h.factionId))continue;const k=gn({attackerId:i.id,targetId:h.id,skillId:"AUTO_ATTACK",basePower:A,trinity:Qe(i),targetTrinity:Qe(h),damageClass:"physical",scaling:[{attribute:"body",coefficient:.4}],statusMultipliers:[]});r.push({type:"Damage",target:E,amount:k.finalPower,scoreEvent:k.scoreEvent});const B=i.factionId==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,_=h.factionId==="player"?"you":`${h.subtype||"enemy"}#${h.id}`;f.push(`${B} cleaved ${_}!`),h.hp<=A&&g++}return{effects:r,messages:f,kills:g}},upgrades:{HEAVY_HANDS:{id:"HEAVY_HANDS",name:"Heavy Hands",description:"Auto-attack damage +1"},CLEAVE:{id:"CLEAVE",name:"Cleave",description:"When auto-attack triggers, hit ALL adjacent enemies"}},scenarios:St("AUTO_ATTACK")},Yv=(t,i,a,o,c,r)=>{if(!i.activeSkills?.some(x=>x.id==="AUTO_ATTACK"))return{state:t,kills:0,messages:[]};const b=i.activeSkills?.find(x=>x.id==="AUTO_ATTACK")?.activeUpgrades||[],y=new Map;if(t.initiativeQueue)for(const x of t.initiativeQueue.entries)x.turnStartPosition&&y.set(x.actorId,x.turnStartPosition);const A=ny.execute(t,i,void 0,b,{previousNeighbors:a,attackerTurnStartPosition:o,allActorsTurnStartPositions:y,persistentTargetIds:c});return{state:xi(t,A.effects,{sourceId:i.id,targetId:void 0,stepId:r}),kills:A.kills||0,messages:A.messages}},Le={shake:(t,i)=>({type:"Juice",effect:"shake",intensity:t,direction:i}),flash:t=>({type:"Juice",effect:"flash",intensity:"high",color:t}),freeze:(t=80)=>({type:"Juice",effect:"freeze",duration:t}),combatText:(t,i,a)=>({type:"Juice",effect:"combat_text",text:t,target:i,color:a}),momentumTrail:(t,i)=>({type:"Juice",effect:"momentumTrail",path:t,intensity:i}),heavyImpact:(t,i)=>({type:"Juice",effect:"heavyImpact",target:t,direction:i,intensity:"extreme"}),lightImpact:t=>({type:"Juice",effect:"lightImpact",target:t,intensity:"low"}),kineticWave:(t,i,a)=>({type:"Juice",effect:"kineticWave",target:t,direction:i,intensity:a}),stunBurst:t=>({type:"Juice",effect:"stunBurst",target:t,intensity:"medium"}),lavaRipple:t=>({type:"Juice",effect:"lavaRipple",target:t,intensity:"medium"}),wallCrack:(t,i)=>({type:"Juice",effect:"wallCrack",target:t,direction:i,intensity:"high"}),explosionRing:t=>({type:"Juice",effect:"explosion_ring",target:t})},zt={GRAPPLE_HOOK:{anticipation:(t,i)=>[{type:"Juice",effect:"aimingLaser",target:t,path:[t,i],intensity:"low",color:"#00ff88"}],execution:t=>[{type:"Juice",effect:"hookCable",path:t,intensity:"medium",duration:200,color:"#00ff88"},Le.shake("low")],impact:(t,i)=>[{type:"Juice",effect:"grappleHookWinch",target:t,direction:i,intensity:"high",duration:150},Le.shake("medium",i)],resolution:(t,i)=>[Le.momentumTrail(t,i>6?"high":"medium"),Le.kineticWave(t[0],t[t.length-1],"high")]},SHIELD_THROW:{anticipation:(t,i)=>[{type:"Juice",effect:"trajectory",target:t,path:[t,i],intensity:"medium",color:"#4169e1"}],execution:t=>[{type:"Juice",effect:"shieldArc",path:t,intensity:"high",duration:300,metadata:{rotation:720}},{type:"Juice",effect:"shieldSpin",path:t,intensity:"medium"}],impact:(t,i)=>[Le.heavyImpact(t,i),Le.shake("high",i),Le.freeze(120),Le.combatText("IMPACT!",t,"#ff4444")],resolution:t=>[Le.kineticWave(t[0],t[t.length-1],"high"),Le.momentumTrail(t,"high")]},DASH:{anticipation:(t,i)=>[{type:"Juice",effect:"chargeUp",target:t,direction:i,intensity:"medium",duration:100}],execution:t=>[{type:"Juice",effect:"dashBlur",path:t,intensity:"high",duration:150},Le.momentumTrail(t,"medium")],impact:(t,i,a)=>a?[Le.heavyImpact(t,i),Le.shake("extreme",i),Le.freeze(100),Le.combatText("SHUNT!",t,"#ffaa00")]:[Le.lightImpact(t)],resolution:t=>t?[Le.kineticWave(t[0],t[t.length-1],"high"),Le.momentumTrail(t,"high")]:[]},SPEAR_THROW:{anticipation:(t,i)=>[{type:"Juice",effect:"aimingLaser",target:t,path:[t,i],intensity:"low",color:"#ff6b6b"}],execution:t=>[{type:"Juice",effect:"spearTrail",path:t,intensity:"high",duration:150},{type:"Juice",effect:"spearWhistle",path:t,intensity:"medium",metadata:{pitch:"rising"}}],impact:(t,i)=>i?[Le.heavyImpact(t),Le.shake("medium"),Le.freeze(60),Le.combatText("LETHAL",t,"#ff0000")]:[Le.lightImpact(t),Le.combatText("MISS",t,"#888888")],resolution:()=>[]},VAULT:{anticipation:(t,i)=>[{type:"Juice",effect:"trajectory",target:t,path:[t,i],intensity:"low",color:"#00ddff",metadata:{arc:"high"}}],execution:t=>[{type:"Juice",effect:"vaultLeap",path:t,intensity:"medium",duration:250,metadata:{arc:"parabolic"}}],impact:(t,i)=>i?[Le.heavyImpact(t),Le.shake("medium"),Le.stunBurst(t),Le.combatText("STUN!",t,"#ffff00")]:[Le.lightImpact(t)],resolution:()=>[]}},Md={lavaSink:t=>[{type:"Juice",effect:"lavaSink",target:t,intensity:"extreme",duration:500,metadata:{particleCount:50}},Le.lavaRipple(t),Le.shake("high"),Le.combatText("CONSUMED",t,"#ff4400")],wallImpact:(t,i,a)=>{const o=[Le.wallCrack(t,i),Le.shake("high",i)];return a&&(o.push(Le.stunBurst(t)),o.push(Le.combatText("STUNNED",t,"#ffaa00"))),o},voidConsume:t=>[{type:"Juice",effect:"voidConsume",target:t,intensity:"extreme",duration:800,color:"#000000"},Le.freeze(150),Le.combatText("VOID",t,"#8800ff")]};function dc(t,i){const{origin:a,direction:o,momentum:c}=i,r=[];r.push(Le.kineticWave(a,o,c>6?"high":"medium"));const f=jn(a,{q:o.q*(c+10),r:o.r*(c+10),s:o.s*(c+10)}),g=kt(a,f);let b=c,y=Kv(t,g);for(;b>0&&y.length>0;){const A=Fv(y);if(A.length===0)break;const v=A.length;if(b<v){const B=A[A.length-1],_=b;b=0;const w=[g[B.pos1D]];for(let H=0;H<_;H++){const j=B.pos1D+1,L=g[j];if(!L||!Ws(L,t.gridWidth,t.gridHeight)||sg(t,L)){r.push({type:"Impact",target:B.id,damage:_-H,direction:o});break}if(B.pos1D=j,w.push(L),ag(t,L)){r.push({type:"LavaSink",target:B.id}),r.push(...Md.lavaSink(L));break}}w.length>1&&(r.push({type:"Displacement",target:B.id,destination:w[w.length-1],path:w,animationDuration:w.length*80}),r.push(Le.momentumTrail(w,"medium")));break}const x=A[A.length-1],E=x.pos1D+1,m=g[E];if(!m||!Ws(m,t.gridWidth,t.gridHeight)||sg(t,m)){r.push({type:"ApplyStatus",target:x.id,status:"stunned",duration:1}),m&&r.push(...Md.wallImpact(m,o,!0));break}const h=new Map;for(const B of A){const _=g[B.pos1D];B.pos1D+=1;const w=g[B.pos1D];h.set(B.id,[_,w])}const R=[...A].reverse();for(const B of R){const _=h.get(B.id);_&&r.push({type:"Displacement",target:B.id,destination:_[_.length-1],path:_,ignoreCollision:!0,animationDuration:150})}const k=Array.from(h.values()).flat();k.length>0&&r.push(Le.momentumTrail(k,v>2?"high":"medium")),b-=v;for(let B=y.length-1;B>=0;B--){const _=y[B],w=g[_.pos1D];ag(t,w)&&(r.push({type:"LavaSink",target:_.id}),r.push(...Md.lavaSink(w)),y.splice(B,1))}if(b>0){const B=A[A.length-1];y=y.filter(w=>w.pos1D>=B.pos1D);const _=y.filter(w=>w.pos1D>B.pos1D);y=[B,..._]}}return r}function Kv(t,i){const a=[],o=[t.player,...t.enemies];for(const c of o){const r=i.findIndex(f=>J(f,c.position));r!==-1&&a.push({id:c.id,pos1D:r})}return a.sort((c,r)=>c.pos1D-r.pos1D)}function Fv(t){if(t.length===0)return[];const i=[];let a=t[0];i.push(a);for(let o=1;o<t.length;o++){const c=t[o];if(c.pos1D===a.pos1D||c.pos1D===a.pos1D+1)i.push(c),a=c;else break}return i}function sg(t,i){const a=Pe.getTraitsAt(t,i);return a.has("BLOCKS_MOVEMENT")||a.has("BLOCKS_LOS")}function ag(t,i){const a=Pe.getTraitsAt(t,i);return a.has("HAZARDOUS")||a.has("LIQUID")}function Gv(t,i,a,o){const c=_e(i.position,a);if(c<=1)return[];const r=Fs(a,i.position),f=Cn(r);return dc(t,{origin:a,direction:f,momentum:Math.min(o,c-1)})}function Wv(t,i){return[{type:"Displacement",target:t.id,destination:i.position},{type:"Displacement",target:i.id,destination:t.position}]}function Xv(t,i,a,o){return dc(t,{origin:i,direction:a,momentum:o})}function Ai(t,i){const a=t.tiles.get(de(i));return a?.traits.has("BLOCKS_LOS")||a?.baseId==="WALL"||Xb(i,t.gridWidth,t.gridHeight)}function Oa(t,i){const a=t.tiles.get(de(i));return a?.baseId==="LAVA"||a?.traits.has("LIQUID")||!1}function Xs(t,i,a){const o=Ae(t,i);return!!o&&o.id!==a}function on(t,i,a){const o=_e(t,i);return o>=1&&o<=a}function Fi(t,i){const a=Fs(t,i);return{isAxial:a!==-1,directionIndex:a}}function tf(t,i,a={}){const{checkWalls:o=!0,checkActors:c=!0,checkLava:r=!1,excludeActorId:f}=a;for(const g of i){if(o&&Ai(t,g))return{obstacle:"wall",position:g};if(r&&Oa(t,g))return{obstacle:"lava",position:g};if(c){const b=Ae(t,g);if(b&&b.id!==f)return{obstacle:"actor",position:g,actor:b}}}return{}}function nf(t,i,a,o={}){const r=kt(i,a).slice(1),{stopAtWalls:f=!0,stopAtActors:g=!0,stopAtLava:b=!1,excludeActorId:y}=o,A=tf(t,r,{checkWalls:f,checkActors:g,checkLava:b,excludeActorId:y});return A.obstacle&&A.position&&!J(A.position,a)?{isValid:!1,blockedBy:A.obstacle,blockedAt:A.position}:{isValid:!0}}function og(t,i,a,o,c){const f=kt(i,a).slice(1),g=tf(t,f,{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:c});return g.obstacle==="actor"&&g.actor?.id===o&&!!g.position&&J(g.position,a)}function Qv(t,i){const a=Pe.getTraitsAt(t,i),o=a.has("HAZARDOUS")||a.has("LAVA")||a.has("FIRE")||a.has("VOID"),c=a.has("LAVA")||a.has("FIRE");return{isHazard:o,isFireHazard:c}}function ys(t,i,a){const{isHazard:o,isFireHazard:c}=Qv(t,a);return!!(!o||i.isFlying||(i.activeSkills?.some(f=>f.id==="ABSORB_FIRE")||i.statusEffects?.some(f=>f.type==="fire_immunity"))&&c)}function iy(t,i,a,o){return ys(t,i,a)?!0:new Set(["JUMP","VAULT","GRAPPLE_HOOK","DASH"]).has(o)}const Jv={id:"GRAPPLE_HOOK",name:"Grapple Hook",description:"Pull/Zip mechanism with multi-phase kinetic resolution.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3,momentum:4},execute:(t,i,a,o=[])=>{let c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};const{directionIndex:g}=Fi(i.position,a),b=Cn(g);c.push(...zt.GRAPPLE_HOOK.anticipation(i.position,a));const{isValid:y,blockedBy:A}=nf(t,i.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!y)return r.push(`Line of sight blocked by ${A}!`),{effects:c,messages:r,consumesTurn:!1};const v=a,x=Ae(t,v),E=Pe.getTraitsAt(t,v),h=E.has("BLOCKS_MOVEMENT")||E.has("ANCHOR")?"Heavy":x?.weightClass||"Standard";if(h==="Heavy"||h==="Anchored"){const R=Dd(v,b);c.push(...zt.GRAPPLE_HOOK.execution(kt(i.position,R))),c.push({type:"Displacement",target:i.id,destination:R,ignoreGroundHazards:!0});const k=Pe.getTileAt(t,R);if(k){const _=Aa.processEntry(i,k,t);c.push(..._.effects),r.push(..._.messages)}const B=xt(R);for(const _ of B){const w=Ae(t,_);w&&w.id!==i.id&&(c.push({type:"Impact",target:w.id,damage:0,direction:b}),c.push({type:"ApplyStatus",target:w.id,status:"stunned",duration:2}),c.push(Le.stunBurst(_)))}return c.push(Le.heavyImpact(R,b)),c.push(Le.shake("high",b)),r.push("Zipped to anchor!"),{effects:c,messages:r,consumesTurn:!0}}else if(x){const R=_e(i.position,v),k=Cn((g+3)%6),B=i.position;c.push(...zt.GRAPPLE_HOOK.execution(kt(i.position,a)));const _=Gv(t,i,v,R-1),w=xi(t,_,{sourceId:i.id,targetId:x.id}),H=w.enemies.find(oe=>oe.id===x.id)||(w.player.id===x.id?w.player:null);if(!H)return r.push(`${x.subtype||"Enemy"} neutralized during pull.`),{effects:[...c,..._],messages:r,consumesTurn:!0};const j=Wv(i,H),L=H.position;c.push(...zt.GRAPPLE_HOOK.impact(L,b));const W=xi(w,j,{sourceId:i.id,targetId:x.id}),Z=Xv(W,B,k,4),Te=kt(B,jn(B,Jd(g,6)));return c.push(...zt.GRAPPLE_HOOK.resolution(Te,4)),{effects:[...c,..._,...j,...Z],messages:["Vaulted and Flung!"],consumesTurn:!0}}else return r.push("Hook missed."),{effects:c,messages:r,consumesTurn:!1}},getValidTargets:(t,i)=>{const a=Ae(t,i);return a?Ze.getAxialTargets(t,i,4,{includeWalls:!0,includeActors:!0,stopAtObstacles:!0}).filter(o=>{const{directionIndex:c}=Fi(i,o),r=Cn(c),f=Ae(t,o),g=Pe.getTraitsAt(t,o),y=g.has("BLOCKS_MOVEMENT")||g.has("ANCHOR")?Dd(o,r):f?o:void 0;return y?ys(t,a,y):!1}):[]},upgrades:{},scenarios:St("GRAPPLE_HOOK")},Zv={id:"SPEAR_THROW",name:t=>t.hasSpear?"Spear Throw":"Recall Spear",description:t=>t.hasSpear?"Throw your spear to instantly kill an enemy.":"Recall your spear, damaging enemies in its path.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:1},execute:(t,i,a,o=[])=>{const c=[],r=[],f=Qe(i),g=o.includes("SPEAR_RANGE"),b=o.includes("RECALL_DAMAGE"),y=o.includes("LUNGE"),A=o.includes("LUNGE_ARC"),v=o.includes("DEEP_BREATH"),x=3+(g?1:0);if(t.hasSpear){if(!a)return{effects:c,messages:r,consumesTurn:!1};if(y&&_e(i.position,a)===2){const B=Ae(t,a);if(B&&B.id!==i.id){const _=gn({attackerId:i.id,targetId:B.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:Qe(B),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return c.push({type:"Displacement",target:"self",destination:a,simulatePath:!0}),c.push({type:"Damage",target:B.id,amount:_.finalPower,scoreEvent:_.scoreEvent}),r.push(`Lunged and killed ${B.subtype||"enemy"} !`),A&&xt(a).forEach(w=>{const H=Ae(t,w);if(H&&H.id!==i.id&&H.id!==B.id){const j=gn({attackerId:i.id,targetId:H.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Qe(H),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:H.id,amount:j.finalPower,scoreEvent:j.scoreEvent})}}),v&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0}),{effects:c,messages:r}}}if(!on(i.position,a,x))return r.push("Out of range!"),{effects:c,messages:r,consumesTurn:!1};const E=Ki(t.enemies,a);if(!E)return r.push("No enemy at target."),{effects:c,messages:r,consumesTurn:!1};if(!Fi(i.position,a).isAxial)return r.push("Target must be axial."),{effects:c,messages:r,consumesTurn:!1};if(!og(t,i.position,a,E.id,i.id))return r.push("No clear line of sight to enemy."),{effects:c,messages:r,consumesTurn:!1};c.push(...zt.SPEAR_THROW.anticipation(i.position,a));const R=a,k=E;if(c.push(...zt.SPEAR_THROW.execution(kt(i.position,R))),k){const B=gn({attackerId:i.id,targetId:k.id,skillId:"SPEAR_THROW",basePower:99,trinity:f,targetTrinity:Qe(k),damageClass:"physical",scaling:[{attribute:"body",coefficient:.1},{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});c.push(...zt.SPEAR_THROW.impact(R,!0)),c.push({type:"Damage",target:k.id,amount:B.finalPower,scoreEvent:B.scoreEvent}),r.push(`Spear killed ${k.subtype||"enemy"} !`),v&&c.push({type:"ModifyCooldown",skillId:"JUMP",amount:0,setExact:!0})}else c.push(...zt.SPEAR_THROW.impact(R,!1)),r.push("Spear thrown.");c.push({type:"SpawnItem",itemType:"spear",position:R})}else{const E=t.spearPosition;if(!E)return r.push("Spear is lost!"),{effects:c,messages:r,consumesTurn:!1};const m=kt(E,i.position);b&&m.forEach(h=>{const R=Ki(t.enemies,h);if(R){const k=gn({attackerId:i.id,targetId:R.id,skillId:"SPEAR_THROW",basePower:1,trinity:f,targetTrinity:Qe(R),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:R.id,amount:k.finalPower,scoreEvent:k.scoreEvent}),r.push(`Spear recall hit ${R.subtype||"enemy"} !`)}}),c.push({type:"PickupSpear",position:E}),r.push("Spear recalled."),c.push({type:"Juice",effect:"spearTrail",path:m,intensity:"medium"})}return{effects:c,messages:r}},getValidTargets:(t,i)=>{if(!t.hasSpear)return[];const a=Ae(t,i);if(!a)return[];const r=3+(a.activeSkills?.find(g=>g.id==="SPEAR_THROW")?.activeUpgrades?.includes("SPEAR_RANGE")?1:0);return t.enemies.filter(g=>g.hp>0).filter(g=>{const b=g.position;return!Fi(i,b).isAxial||!on(i,b,r)?!1:og(t,i,b,g.id,a.id)}).map(g=>g.position)},upgrades:{SPEAR_RANGE:{id:"SPEAR_RANGE",name:"Extended Reach",description:"Range +1"},RECALL:{id:"RECALL",name:"Recall",description:"Spear automatically returns (handled internally if active, or via manual recall)"},RECALL_DAMAGE:{id:"RECALL_DAMAGE",name:"Returning Edge",description:"Damage enemies in path when recalling spear"},LUNGE:{id:"LUNGE",name:"Lunge",description:"If an enemy is exactly 2 hexes away, move to them and kill"},LUNGE_ARC:{id:"LUNGE_ARC",name:"Lunge Sweeping",description:"Lunge hits neighbors of the target"},DEEP_BREATH:{id:"DEEP_BREATH",name:"Deep Breath",description:"Reset Jump cooldown on spear kill"},CLEAVE:{id:"CLEAVE",name:"Cleave",description:"Damage all neighbors when picking up spear"}},scenarios:St("SPEAR_THROW")},ex={id:"SHIELD_BASH",name:"Shield Bash",description:"Push an enemy 1 tile. If they hit a wall or another enemy, they are stunned.",slot:"defensive",icon:"",baseVariables:{range:1,cost:0,cooldown:2},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:r,consumesTurn:!1};const f=o.includes("SHIELD_RANGE"),g=o.includes("ARC_BASH"),b=o.includes("BASH_360"),y=o.includes("WALL_SLAM"),A=1+(f?1:0);if(!on(i.position,a,A))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};let v=[];if(b)v=xt(i.position);else if(g){v=[a];const h=xt(a);for(const R of h)_e(R,i.position)===1&&v.length<3&&v.push(R)}else v=[a];const x=new Map;t.enemies.forEach(h=>x.set(h.id,h.position)),t.player&&x.set(t.player.id,t.player.position);const E=h=>{for(const[R,k]of Array.from(x.entries()))if(J(k,h))return R===t.player.id?t.player:t.enemies.find(B=>B.id===R)},m=(h,R)=>{const k=E(R);if(!k||k.id===i.id)return;const B=Fs(h,R),_=Cn(B),w=jn(R,_),H=t.tiles.get(de(w)),j=H?.baseId==="WALL"||H?.traits.has("BLOCKS_MOVEMENT"),L=!Ze.isWithinBounds(t,w),W=E(w);j||L||W&&W.id!==k.id?(c.push({type:"ApplyStatus",target:k.id,status:"stunned",duration:1}),r.push(`Bashed ${k.subtype||"enemy"} into obstacle!`),c.push({type:"Juice",effect:"shake"}),W&&y&&m(R,w)):(c.push({type:"Displacement",target:k.id,destination:w,simulatePath:!0}),x.set(k.id,w),r.push(`Pushed ${k.subtype||"enemy"}!`))};for(const h of v)m(i.position,h);return{effects:c,messages:r}},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,1).filter(a=>!!Ae(t,a)),upgrades:{SHIELD_RANGE:{id:"SHIELD_RANGE",name:"Extended Bash",description:"Range +1"},SHIELD_COOLDOWN:{id:"SHIELD_COOLDOWN",name:"Quick Recovery",description:"Cooldown -1",modifyCooldown:-1},ARC_BASH:{id:"ARC_BASH",name:"Arc Bash",description:"Bash hits 3-hex frontal arc (+1 cooldown)",modifyCooldown:1},BASH_360:{id:"BASH_360",name:"360 Bash",description:"Bash hits all neighbors (+1 cooldown)",modifyCooldown:1},PASSIVE_PROTECTION:{id:"PASSIVE_PROTECTION",name:"Passive Protection",description:"+1 temp armor when shield not on cooldown"},WALL_SLAM:{id:"WALL_SLAM",name:"Wall Slam",description:"Enemies bashed into obstacles trigger a cascade and stun"}},scenarios:St("SHIELD_BASH")},tx={id:"JUMP",name:"Jump",description:"Leap to an empty tile within range. Can cross lava but not walls.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!i||!i.position)return{effects:c,messages:r,consumesTurn:!1};const f=o.includes("JUMP_RANGE"),g=o.includes("STUNNING_LANDING"),b=o.includes("METEOR_IMPACT"),y=o.includes("FREE_JUMP"),A=2+(f?1:0);if(!on(i.position,a,A))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};const v=Ae(t,a),x=Ai(t,a),E=ys(t,i,a);if(x)return r.push("Cannot jump into a wall!"),{effects:c,messages:r,consumesTurn:!1};if(!E)return r.push("Cannot land on hazard!"),{effects:c,messages:r,consumesTurn:!1};if(v&&!b)return r.push("Target hex is blocked!"),{effects:c,messages:r,consumesTurn:!1};if(v&&b){const m=gn({attackerId:i.id,targetId:v.id,skillId:"JUMP",basePower:99,trinity:Qe(i),targetTrinity:Qe(v),damageClass:"physical",scaling:[{attribute:"body",coefficient:.15}],statusMultipliers:[]});c.push({type:"Damage",target:v.id,amount:m.finalPower,scoreEvent:m.scoreEvent}),r.push(`Meteor Impact killed ${v.subtype||"enemy"}!`)}if(c.push({type:"Message",text:"Jumped!"}),c.push({type:"Displacement",target:"self",destination:a,ignoreCollision:!0,ignoreGroundHazards:!0,simulatePath:!0}),g){const m=xt(a);let h=!1;for(const R of m){const k=Ae(t,R);k&&k.id!==i.id&&(c.push({type:"ApplyStatus",target:k.id,status:"stunned",duration:1}),h=!0)}h&&r.push("Enemies stunned by landing impact!")}return c.push({type:"Juice",effect:"shake",target:a,intensity:"medium"}),{effects:c,messages:r,consumesTurn:!y}},getValidTargets:(t,i)=>{const a=Ae(t,i);if(!a)return[];const o=a.activeSkills?.find(g=>g.id==="JUMP"),c=new Set(o?.activeUpgrades||[]),r=2+(c.has("JUMP_RANGE")?1:0),f=c.has("METEOR_IMPACT");return Ze.getAreaTargets(t,i,r).filter(g=>{if(J(g,i)||Ai(t,g)||!ys(t,a,g))return!1;const b=Ae(t,g);return!(b&&b.id!==a.id&&!f)})},upgrades:{JUMP_RANGE:{id:"JUMP_RANGE",name:"Extended Jump",description:"Jump range +1"},JUMP_COOLDOWN:{id:"JUMP_COOLDOWN",name:"Nimble",description:"Jump cooldown -1",modifyCooldown:-1},STUNNING_LANDING:{id:"STUNNING_LANDING",name:"Stunning Landing",description:"All enemies within 1 hex of landing are stunned"},METEOR_IMPACT:{id:"METEOR_IMPACT",name:"Meteor Impact",description:"Can land on enemies to kill them"},FREE_JUMP:{id:"FREE_JUMP",name:"Free Jump",description:"Can move after jumping"}},scenarios:St("JUMP")},nx={id:"BULWARK_CHARGE",name:"Bulwark Charge",description:"Charge into an adjacent enemy, pushing a chain. Wall hard-stop stuns the chain.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(_e(i.position,a)!==1)return c.push("Target not adjacent!"),{effects:o,messages:c,consumesTurn:!1};const f=Ki(t.enemies,a);if(!f)return c.push("No target!"),{effects:o,messages:c,consumesTurn:!1};const{isAxial:g,directionIndex:b}=Fi(i.position,a);if(!g)return{effects:o,messages:c,consumesTurn:!1};const y=Cn(b),A=[f];let v={q:f.position.q+y.q,r:f.position.r+y.r,s:f.position.s+y.s};for(;;){const m=Ki(t.enemies,v);if(m){if(A.push(m),v={q:v.q+y.q,r:v.r+y.r,s:v.s+y.s},A.length>6)break;continue}break}const x=[];for(let m=0;m<A.length;m++){const h=A[m],R=m===0?2:1,k={q:h.position.q+y.q*R,r:h.position.r+y.r*R,s:h.position.s+y.s*R};x.push({actor:h,dest:k})}let E=!1;for(const m of x){const h=t.tiles.get(de(m.dest));if(h?.baseId==="WALL"||h?.traits.has("BLOCKS_MOVEMENT")){E=!0;break}if(t.enemies.find(k=>J(k.position,m.dest)&&!A.some(B=>B.id===k.id))){E=!0;break}}if(E){for(const m of A)o.push({type:"ApplyStatus",target:m.position,status:"stunned",duration:1}),c.push("Chain blocked! Stunned.");return{effects:o,messages:c}}for(const m of x)o.push({type:"Displacement",target:m.actor.id,destination:m.dest});return o.push({type:"Displacement",target:"self",destination:f.position}),c.push("Bulwark Charge!"),{effects:o,messages:c}},getValidTargets:(t,i)=>[{q:i.q+1,r:i.r,s:i.s-1},{q:i.q+1,r:i.r-1,s:i.s},{q:i.q,r:i.r-1,s:i.s+1},{q:i.q-1,r:i.r,s:i.s+1},{q:i.q-1,r:i.r+1,s:i.s},{q:i.q,r:i.r+1,s:i.s-1}].filter(o=>!!Ki(t.enemies,o)),upgrades:{},scenarios:[{id:"chain_stun",title:"Chain-Stun",description:"Wall prevents chain, chain gets stunned",setup:t=>{t.setPlayer({q:3,r:6,s:-9},["BULWARK_CHARGE"]),t.spawnEnemy("shieldBearer",{q:3,r:5,s:-8},"A"),t.spawnEnemy("shieldBearer",{q:3,r:4,s:-7},"B"),t.setTile({q:3,r:3,s:-6},"wall"),t.state.hasShield=!0},run:t=>{t.useSkill("BULWARK_CHARGE",{q:3,r:5,s:-8})},verify:(t,i)=>!0}]},ix={id:"BASIC_ATTACK",name:"Basic Attack",description:"Strike an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(t,i,a,o=[])=>{const c=[],r=[],f=(t.timelineEvents||[]).some(m=>m.phase==="STATUS_APPLY"&&m.type==="ApplyStatus"&&m.payload?.status==="stunned"&&(m.payload?.target===i.id||typeof m.payload?.target=="object"&&m.payload?.target&&J(m.payload.target,i.position)));if(ji(i)||f)return r.push("Cannot attack while stunned!"),{effects:c,messages:r,consumesTurn:!0};if(!a)return r.push("Select a target!"),{effects:c,messages:r,consumesTurn:!1};let g=1;if(o.includes("EXTENDED_REACH")&&(g+=1),!on(i.position,a,g))return r.push("Target out of range!"),{effects:c,messages:r,consumesTurn:!1};const b=Ae(t,a);if(!b||b.id===i.id)return r.push("No enemy at target!"),{effects:c,messages:r,consumesTurn:!1};if(b.factionId===i.factionId)return r.push("Cannot attack friendlies!"),{effects:c,messages:r,consumesTurn:!1};if(b.subtype==="bomb")return r.push("Cannot attack a bomb!"),{effects:c,messages:r,consumesTurn:!1};let y=1;o.includes("POWER_STRIKE")&&(y+=1);const A=gn({attackerId:i.id,targetId:b.id,skillId:"BASIC_ATTACK",basePower:y,trinity:Qe(i),targetTrinity:Qe(b),damageClass:"physical",scaling:[{attribute:"body",coefficient:.5}],statusMultipliers:[],inDangerPreviewHex:!!t.intentPreview?.dangerTiles?.some(m=>J(m,i.position)),theoreticalMaxPower:y}),v=A.finalPower;c.push({type:"Damage",target:"targetActor",amount:v,scoreEvent:A.scoreEvent});const x=i.type==="player"?"You":`${i.subtype||"enemy"}#${i.id}`,E=b.type==="player"?"you":`${b.subtype||"enemy"}#${b.id}`;return r.push(`${x} attacked ${E}!`),o.includes("VAMPIRIC")&&b.hp<=v&&r.push("Vampiric heal!"),{effects:c,messages:r,consumesTurn:!0}},getValidTargets:(t,i)=>{const a=Ae(t,i);return a?xt(i).filter(o=>{const c=Ae(t,o);return!!c&&c.subtype!=="bomb"&&c.id!==a.id&&c.factionId!==a.factionId}):[]},upgrades:{EXTENDED_REACH:{id:"EXTENDED_REACH",name:"Extended Reach",description:"Attack range +1"},POWER_STRIKE:{id:"POWER_STRIKE",name:"Power Strike",description:"Damage +1"},VAMPIRIC:{id:"VAMPIRIC",name:"Vampiric",description:"Heal 1 HP on kill"}},scenarios:St("BASIC_ATTACK")},sx={id:"SENTINEL_TELEGRAPH",name:"Sentinel Telegraph",description:"The Sentinel marks an impact zone for a delayed blast.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0},execute:(t,i,a)=>a?{effects:[{type:"Juice",effect:"combat_text",target:a,text:"TELEGRAPH"}],messages:["The Sentinel marks the impact zone."],consumesTurn:!0}:{effects:[],messages:[],consumesTurn:!0},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,3),upgrades:{},scenarios:St("SENTINEL_TELEGRAPH")},ax={id:"SENTINEL_BLAST",name:"Sentinel Blast",description:"A massive energy surge from the Sentinel.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:0,damage:2},execute:(t,i,a)=>{if(!a)return{effects:[],messages:[]};const o=Qe(i),c=Ae(t,a),r=gn({attackerId:i.id,targetId:c?.id||de(a),skillId:"SENTINEL_BLAST",basePower:2,trinity:o,targetTrinity:c?Qe(c):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:[]}),f=[{type:"Damage",target:a,amount:r.finalPower,scoreEvent:r.scoreEvent},{type:"Juice",effect:"shake",intensity:"high"}];return xt(a).forEach(b=>{const y=Ae(t,b),A=gn({attackerId:i.id,targetId:y?.id||de(b),skillId:"SENTINEL_BLAST",basePower:1,trinity:o,targetTrinity:y?Qe(y):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.1}],statusMultipliers:[]});f.push({type:"Damage",target:b,amount:A.finalPower,scoreEvent:A.scoreEvent})}),{effects:f,messages:["The Sentinel unleashed a massive blast!"],consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,3),upgrades:{},scenarios:St("SENTINEL_BLAST")},ox={id:"THEME_HAZARDS",name:"Theme Hazards",description:"Internal skill for testing floor themes.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0},execute:t=>({effects:[],messages:[]}),upgrades:{},scenarios:St("THEME_HAZARDS")},lx={id:"SHIELD_THROW",name:"Shield Throw",description:"Throw your shield to strike and push enemies. Triggers a kinetic pulse on impact.",slot:"defensive",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!t.hasShield)return r.push("Shield not in hand!"),{effects:c,messages:r,consumesTurn:!1};c.push(...zt.SHIELD_THROW.anticipation(i.position,a));const{isValid:f,blockedBy:g,blockedAt:b}=nf(t,i.position,a,{stopAtWalls:!0,stopAtActors:!0,excludeActorId:i.id});if(!f&&g==="wall")return r.push("Shield hit a wall mid-flight!"),c.push({type:"SpawnItem",itemType:"shield",position:b}),{effects:c,messages:r,consumesTurn:!0};const y=Ae(t,a);if(!y)return r.push("Shield missed: No target at location."),c.push({type:"SpawnItem",itemType:"shield",position:a}),{effects:c,messages:r,consumesTurn:!0};const A=kt(i.position,a);c.push(...zt.SHIELD_THROW.execution(A));const v=4,{directionIndex:x}=Fi(i.position,a),E=Cn(x);c.push({type:"ApplyStatus",target:y.id,status:"stunned",duration:1}),c.push(...zt.SHIELD_THROW.impact(a,E));const m=dc(t,{origin:a,direction:E,momentum:v}),h=m.filter(_=>_.type==="Displacement"&&_.target===y.id),R=h[h.length-1],k=R&&"destination"in R?R.destination:a,B=kt(a,k);return B.length>1&&c.push(...zt.SHIELD_THROW.resolution(B)),c.push({type:"SpawnItem",itemType:"shield",position:k}),r.push("Direct hit! Shield triggered kinetic pulse."),{effects:[...c,...m],messages:r,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,4),upgrades:{},scenarios:St("SHIELD_THROW")},rx={id:"VAULT",name:t=>t.turnNumber%2!==0?"Stun Vault":"Vault",description:t=>t.turnNumber%2!==0?"Leap to an empty tile and stun neighbors. (Odd Turn)":"Leap to an empty tile. (Even Turn)",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:0},execute:(t,i,a,o=[])=>{const c=[],r=[];if(!a)return{effects:c,messages:r,consumesTurn:!1};if(!on(i.position,a,2))return r.push("Out of range!"),{effects:c,messages:r,consumesTurn:!1};if(Ai(t,a)||Xs(t,a))return r.push("Blocked!"),{effects:c,messages:r,consumesTurn:!1};if(!ys(t,i,a))return r.push("Blocked!"),{effects:c,messages:r,consumesTurn:!1};const f=t.turnNumber%2!==0;c.push(...zt.VAULT.anticipation(i.position,a));const g=kt(i.position,a);if(c.push(...zt.VAULT.execution(g)),c.push({type:"Displacement",target:"self",destination:a,path:g,ignoreGroundHazards:!0,animationDuration:250}),f){r.push("Stun Vault executed!");const b=xt(a);for(const y of b)Ki(t.enemies,y)&&c.push({type:"ApplyStatus",target:y,status:"stunned",duration:1});c.push(...zt.VAULT.impact(a,!0)),r.push("Slam landing! Neighbors stunned.")}else c.push(...zt.VAULT.impact(a,!1)),r.push("Vaulted!");return{effects:c,messages:r}},getValidTargets:(t,i)=>{const o=Ae(t,i);return o?Ze.getAreaTargets(t,i,2).filter(c=>J(c,i)?!1:!Ai(t,c)&&!Xs(t,c)&&ys(t,o,c)):[]},upgrades:{},scenarios:[{id:"vault_shift_stun",title:"Vault State-Shifting: Stun (Turn 1)",description:"Verify vault stuns on Turn 1 (Odd).",setup:t=>{t.setTurn(1),t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>{t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>i.some(a=>a.includes("Stun Vault executed!"))},{id:"vault_shift_normal",title:"Vault State-Shifting: Normal (Turn 2)",description:"Verify vault is normal on Turn 2 (Even).",setup:t=>{t.setTurn(2),t.setPlayer({q:3,r:6,s:-9},["VAULT"]),t.spawnEnemy("footman",{q:3,r:5,s:-8},"victim")},run:t=>{t.useSkill("VAULT",{q:3,r:4,s:-7})},verify:(t,i)=>i.some(a=>a.includes("Vaulted!"))&&!i.some(a=>a.includes("Slam landing!"))}]},lg=(t,i)=>t.enemies.filter(o=>o.hp>0&&o.factionId==="enemy").length===0?20:Math.max(i.speed||1,1),sy=(t,i)=>Ze.isWithinBounds(t,i)?Pe.getTraitsAt(t,i).has("BLOCKS_MOVEMENT"):!0,rg=(t,i,a,o)=>{const c=new Map,r=[],f=b=>`${b.q},${b.r}`,g=[{p:a,cost:0}];for(c.set(f(a),0);g.length>0;){const b=g.shift();if(!(b.cost>=o))for(const y of xt(b.p)){if(!Ze.isWithinBounds(t,y)||!Pe.isWalkable(t,y)||!iy(t,i,y,"BASIC_MOVE"))continue;const A=Ae(t,y),v=!!A&&A.id!==i.id,x=v&&A.factionId===i.factionId;if(v&&!x)continue;const E=f(y),m=b.cost+1;c.has(E)&&c.get(E)<=m||(c.set(E,m),!x&&ys(t,i,y)&&!sy(t,y)&&r.push(y),g.push({p:y,cost:m}))}}return r},cx=(t,i,a,o,c)=>{const r=E=>`${E.q},${E.r}`,f=E=>{const[m,h]=E.split(",").map(Number);return{q:m,r:h,s:-m-h}},g=[a],b=new Map([[r(a),0]]),y=new Map([[r(a),null]]);for(;g.length>0;){const E=g.shift(),m=r(E),h=b.get(m);if(!(h>=c))for(const R of xt(E)){if(!Ze.isWithinBounds(t,R)||!Pe.isWalkable(t,R)||!iy(t,i,R,"BASIC_MOVE"))continue;const k=Ae(t,R),B=!!k&&k.id!==i.id,_=B&&k.factionId===i.factionId;if(B&&!_)continue;const w=r(R),H=h+1;b.has(w)&&b.get(w)<=H||(b.set(w,H),y.set(w,m),g.push(R))}}const A=r(o);if(!y.has(A)||sy(t,o)||!ys(t,i,o))return null;const v=[];let x=A;for(;x;)v.push(f(x)),x=y.get(x)||null;return v.reverse(),v},ux={id:"BASIC_MOVE",name:"Walk",description:"Move to an adjacent or nearby tile within your speed range.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=lg(t,i),g=rg(t,i,i.position,r).some(A=>J(A,a)),b=cx(t,i,i.position,a,r);if(!g||!b||b.length<2)return c.push("Target out of reach or blocked!"),{effects:o,messages:c,consumesTurn:!1};o.push({type:"Displacement",target:"self",destination:a,source:i.position,path:b,simulatePath:!0});const y=i.id===t.player.id?"You":`${i.subtype||"enemy"}#${i.id}`;return c.push(`${y} moved to (${a.q}, ${a.r}). [Range ${r}]`),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>{const a=Ae(t,i);if(!a)return[];const o=lg(t,a);return rg(t,a,i,o).filter(r=>!Xs(t,r,a.id))},upgrades:{},scenarios:St("BASIC_MOVE")},dx={id:"DASH",name:"Kinetic Dash",description:"Dash in a straight line. With a shield, slam into enemies and send them flying!",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r,directionIndex:f}=Fi(i.position,a),b=t.enemies.filter(m=>m.hp>0).length===0?20:4;if(!on(i.position,a,b))return{effects:o,messages:["Out of range!"],consumesTurn:!1};if(!r)return{effects:o,messages:["Axial only! Dash must be in a straight line."],consumesTurn:!1};o.push(...zt.DASH.anticipation(i.position,a));const y=Cn(f),A=kt(i.position,a),v=tf(t,A.slice(1),{checkWalls:!0,checkActors:!0,checkLava:!1,excludeActorId:i.id});let x=a;if(v.obstacle){if(v.obstacle==="wall")return{effects:o,messages:["A wall blocks the way!"],consumesTurn:!1};if(v.obstacle==="lava")return{effects:o,messages:["Lava blocks the way!"],consumesTurn:!1};const m=A.findIndex(h=>J(h,v.position));x=A[m-1]||i.position}if(v.obstacle==="actor"?v.actor:null){const m=kt(i.position,x);o.push(...zt.DASH.execution(m));const h=[{type:"Displacement",target:"self",destination:x,path:m,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:m.length*60}],R=xi(t,h,{sourceId:i.id});if(t.hasShield){o.push(...zt.DASH.impact(x,y,!0));const k=dc(R,{origin:x,direction:y,momentum:5});return{effects:[...o,...h,...k],messages:[...c,"Shield Shunt!"],consumesTurn:!0}}else return o.push(...zt.DASH.impact(x,y,!1)),{effects:[...o,...h],messages:[...c,"Stopped by an obstacle (Need shield to shunt)."],consumesTurn:!J(i.position,x)}}else{const m=kt(i.position,x);o.push(...zt.DASH.execution(m));const h={type:"Displacement",target:"self",destination:x,path:m,simulatePath:!0,ignoreGroundHazards:!0,animationDuration:m.length*60};return{effects:[...o,h],messages:[...c,"Dashed!"],consumesTurn:!J(i.position,x)}}},getValidTargets:(t,i)=>{const o=t.enemies.filter(r=>r.hp>0).length===0?20:4,c=Ae(t,i);return c?Ze.getAxialTargets(t,i,o,{stopAtObstacles:!0,includeActors:!0,includeWalls:!1}).filter(r=>ys(t,c,r)):[]},upgrades:{MOMENTUM_SURGE:{id:"MOMENTUM_SURGE",name:"Momentum Surge",description:"+2 Momentum when dashing with shield"},CHAIN_REACTION:{id:"CHAIN_REACTION",name:"Chain Reaction",description:"Enemies pushed into other enemies transfer momentum"}},scenarios:St("DASH")},fx=new Set(["FIREBALL","FIREWALL","FIREWALK","ABSORB_FIRE"]),ay=(t,i)=>{const a=Pe.getTileAt(t,i),o=Pe.getTraitsForTile(t,a),c=r=>a.effects.some(f=>f.id===r);return a.baseId==="VOID"||o.has("VOID")||o.has("PIT")?"VOID_TOUCHED":a.baseId==="ICE"||c("ICE_WALL")?"FROZEN":a.baseId==="LAVA"||o.has("LAVA")||o.has("FIRE")||c("FIRE")?"MELTED":c("WET")||c("STEAM")?"SOAKED":"STABLE"},oy=(t,i)=>fx.has(t)&&i==="MELTED"?1.15:1,mx={id:"FIREBALL",name:"Fireball",description:"Launch a sphere of flame. Range 3, Axial. Deals damage and leaves fire.",slot:"offensive",icon:"",baseVariables:{range:3,cost:1,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r}=Fi(i.position,a);if(!on(i.position,a,3)||!r)return{effects:o,messages:["Invalid target! Range 3, Axial only."],consumesTurn:!1};const f=[a,...xt(a)],g=Qe(i),b=!!t.intentPreview?.dangerTiles?.some(y=>J(y,i.position));for(const y of f){const A=Ae(t,y),v=ay(t,y),x=oy("FIREBALL",v),E=gn({attackerId:i.id,targetId:A?.id||de(y),skillId:"FIREBALL",basePower:1,trinity:g,targetTrinity:A?Qe(A):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.2}],statusMultipliers:x===1?[]:[{id:`surface_${v}`,multiplier:x}],inDangerPreviewHex:b,theoreticalMaxPower:1});o.push({type:"Damage",target:y,amount:E.finalPower,reason:"fireball",scoreEvent:E.scoreEvent}),o.push({type:"PlaceFire",position:y,duration:3})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ff4400"}),o.push({type:"Juice",effect:"shake",intensity:"medium"}),c.push("Fireball!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,3),upgrades:{},scenarios:St("FIREBALL")},px={id:"FIREWALL",name:"Firewall",description:"Create a wall of flames 5 tiles wide. Area denial.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:4},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r,directionIndex:f}=Fi(i.position,a);if(!r)return{effects:o,messages:["Axial targeting only!"],consumesTurn:!1};const g=(f+2)%6,b=(f+5)%6,y=[a];let A=a;for(let x=0;x<2;x++)A=jn(A,Cn(g)),Ze.isWithinBounds(t,A)&&y.push(A);let v=a;for(let x=0;x<2;x++)v=jn(v,Cn(b)),Ze.isWithinBounds(t,v)&&y.push(v);for(const x of y)if(!Ai(t,x)){o.push({type:"PlaceFire",position:x,duration:3});const E=Ae(t,x);if(E){const m=ay(t,x),h=oy("FIREWALL",m),R=gn({attackerId:i.id,targetId:E.id,skillId:"FIREWALL",basePower:1,trinity:Qe(i),targetTrinity:Qe(E),damageClass:"magical",scaling:[{attribute:"mind",coefficient:.15}],statusMultipliers:h===1?[]:[{id:`surface_${m}`,multiplier:h}]});o.push({type:"Damage",target:E.id,amount:R.finalPower,reason:"firewall_impact",scoreEvent:R.scoreEvent})}}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffaa00"}),c.push("Firewall raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,4),upgrades:{},scenarios:St("FIREWALL")},hx={id:"FIREWALK",name:"Firewalk",description:"Teleport to a fire or lava tile. Grants 2 turns of Fire Immunity.",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!on(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const r=t.tiles.get(de(a)),f=r?.effects.some(b=>b.id==="FIRE"),g=r?.baseId==="LAVA"||r?.traits.has("LIQUID");return!f&&!g?{effects:o,messages:["Can only teleport to Fire or Lava!"],consumesTurn:!1}:Xs(t,a,i.id)?{effects:o,messages:["Target position occupied!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a,source:i.position,simulatePath:!1}),o.push({type:"ApplyStatus",target:"self",status:"fire_immunity",duration:2}),o.push({type:"Juice",effect:"flash",target:a,color:"#ff8800"}),c.push("Firewalk!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(t,i)=>{const a=[];return t.tiles.forEach(o=>{const c=_e(i,o.position);if(c>0&&c<=4){const r=o.effects.some(g=>g.id==="FIRE"),f=o.baseId==="LAVA"||o.traits.has("LIQUID");(r||f)&&a.push(o.position)}}),a},upgrades:{},scenarios:St("FIREWALK")},gx={id:"BOMB_TOSS",name:"Bomb Toss",description:"Throw a bomb to a nearby tile.",slot:"offensive",icon:"",baseVariables:{range:3,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!on(i.position,a,3))return c.push("Out of range!"),{effects:o,messages:c,consumesTurn:!1};if(!Pe.isWalkable(t,a))return c.push("Target blocked!"),{effects:o,messages:c,consumesTurn:!1};if(Ae(t,a))return c.push("Target occupied!"),{effects:o,messages:c,consumesTurn:!1};const f=`bomb-${i.id}-${t.turnNumber}-${t.actionLog?.length??0}-${a.q}_${a.r}_${a.s}`,g=Gs({id:f,type:"enemy",subtype:"bomb",factionId:i.factionId,position:a,speed:10,skills:["TIME_BOMB"],weightClass:"Standard"});return g.statusEffects=[{id:"TIME_BOMB",type:"time_bomb",duration:2,tickWindow:"END_OF_TURN"}],o.push({type:"SpawnActor",actor:g}),c.push("Bomb tossed!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>{const o=[];for(let c=-3;c<=3;c++)for(let r=Math.max(-3,-c-3);r<=Math.min(3,-c+3);r++){const f={q:i.q+c,r:i.r+r,s:i.s-c-r};on(i,f,3)&&Pe.isWalkable(t,f)&&(Ae(t,f)||o.push(f))}return o},upgrades:{}},yx={id:"TIME_BOMB",name:"Time Bomb",description:"Detonates when the fuse reaches zero.",slot:"passive",icon:"",baseVariables:{range:0,cost:0,cooldown:0,damage:1},execute:(t,i,a)=>{const o=i.statusEffects.find(g=>g.type==="time_bomb");if(o&&o.duration>1)return{effects:[],messages:[],consumesTurn:!0};const c=i.position,f=[c,...xt(c)].map(g=>({type:"Damage",target:g,amount:1,reason:"bomb_explosion"}));return f.push({type:"Damage",target:i.id,amount:999,reason:"bomb_explosion"}),f.push({type:"Juice",effect:"explosion_ring",target:c,intensity:"high"}),{effects:f,messages:["A bomb exploded!"],consumesTurn:!0}},getValidTargets:(t,i)=>[i],upgrades:{}},bx=(t,i)=>!!t.tiles.get(de(i))?.traits?.has("CORPSE"),Sx=(t,i,a)=>{const o=[];return t.tiles.forEach(c=>{c.traits.has("CORPSE")&&_e(i,c.position)<=a&&o.push(c.position)}),o},vx={id:"CORPSE_EXPLOSION",name:"Corpse Explosion",description:"Detonate a target corpse, dealing damage in a 1-tile radius.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!bx(t,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!on(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};o.push({type:"RemoveCorpse",position:a});const f=[a,...xt(a)],g=Qe(i),b=!!t.intentPreview?.dangerTiles?.some(y=>J(y,i.position));for(const y of f){const A=Ae(t,y),v=gn({attackerId:i.id,targetId:A?.id||de(y),skillId:"CORPSE_EXPLOSION",basePower:2,trinity:g,targetTrinity:A?Qe(A):void 0,damageClass:"magical",scaling:[{attribute:"mind",coefficient:.25}],statusMultipliers:[],inDangerPreviewHex:b,theoreticalMaxPower:2});o.push({type:"Damage",target:y,amount:v.finalPower,reason:"corpse_explosion",scoreEvent:v.scoreEvent})}return o.push({type:"Juice",effect:"explosion_ring",target:a}),o.push({type:"Juice",effect:"shake",intensity:"high"}),o.push({type:"Juice",effect:"combat_text",target:a,text:"BOOM!"}),c.push("Corpse exploded!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Sx(t,i,4),upgrades:{},scenarios:St("CORPSE_EXPLOSION")},xx=(t,i)=>i.q>=0&&i.q<t.gridWidth&&i.r>=0&&i.r<t.gridHeight,Ax=(t,i,a)=>xt(a).filter(c=>xx(t,c)).filter(c=>Pe.isWalkable(t,c)).filter(c=>!Ae(t,c)).sort((c,r)=>{const f=_e(c,i.position),g=_e(r,i.position);return f!==g?f-g:c.q!==r.q?c.q-r.q:c.r-r.r})[0]||null,Tx=(t,i)=>i.id!==t.id&&i.factionId===t.factionId;function cg(t,i,a,o="fail"){const c=Ae(t,a);if(!c)return{ok:!0,spawnPosition:a,effects:[],messages:[]};if(o==="push_friendly"){if(!Tx(i,c))return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."};const r=Ax(t,i,a);return r?{ok:!0,spawnPosition:a,effects:[{type:"Displacement",target:c.id,destination:r,source:c.position,simulatePath:!0}],messages:["Ally repositions to make room."]}:{ok:!1,effects:[],messages:[],failureMessage:"No space to reposition ally."}}return{ok:!1,effects:[],messages:[],failureMessage:"Target tile occupied."}}const Ex=(t,i)=>!!t.tiles.get(de(i))?.traits?.has("CORPSE"),_x=(t,i,a)=>{const o=[];return t.tiles.forEach(c=>{c.traits.has("CORPSE")&&_e(i,c.position)<=a&&o.push(c.position)}),o},wx=t=>{const i=t.initialSeed??t.rngSeed??"0",a=new Set([...t.enemies.map(r=>r.id),...(t.companions||[]).map(r=>r.id)]);let o=(t.floor<<20)+(t.turnNumber<<12)+(t.actionLog?.length??0)+(t.rngCounter??0),c=`skeleton_${po(i,o,8,"skeleton")}`;for(;a.has(c);)o+=1,c=`skeleton_${po(i,o,8,"skeleton")}`;return c},Mx={id:"RAISE_DEAD",name:"Raise Dead",description:"Reanimate a target corpse into a Skeleton minion (Faction: Player).",slot:"utility",icon:"",baseVariables:{range:4,cost:1,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!Ex(t,a))return{effects:o,messages:["A corpse is required!"],consumesTurn:!1};if(!on(i.position,a,4))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=cg(t,i,a,"push_friendly");if(!f.ok)return{effects:o,messages:[f.failureMessage||"Target tile occupied."],consumesTurn:!1};o.push(...f.effects),c.push(...f.messages),o.push({type:"RemoveCorpse",position:a});const g=ey({companionType:"skeleton",ownerId:i.id,id:wx(t),position:a});return o.push({type:"SpawnActor",actor:g}),o.push({type:"Juice",effect:"flash",target:a,color:"#aaaaaa"}),c.push("Skeleton raised!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>{const a=Ae(t,i);return a?_x(t,i,4).filter(o=>cg(t,a,o,"push_friendly").ok):[]},upgrades:{},scenarios:St("RAISE_DEAD")},Ox={id:"SOUL_SWAP",name:"Soul Swap",description:"Instantly swap positions with a player-aligned minion.",slot:"utility",icon:"",baseVariables:{range:6,cost:0,cooldown:3},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};if(!on(i.position,a,6))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const r=Ae(t,a);return!r||r.factionId!=="player"||r.id===i.id?{effects:o,messages:["Target must be a minion!"],consumesTurn:!1}:(o.push({type:"Displacement",target:i.id,destination:a}),o.push({type:"Displacement",target:r.id,destination:i.position}),o.push({type:"Juice",effect:"flash",target:a,color:"#330066"}),o.push({type:"Juice",effect:"flash",target:i.position,color:"#330066"}),c.push("Soul Swapped!"),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(t,i)=>t.enemies.filter(a=>a.factionId==="player"&&on(i,a.position,6)).map(a=>a.position),upgrades:{},scenarios:St("SOUL_SWAP")},Cx={id:"MULTI_SHOOT",name:"Multi-Shoot",description:"A spread of arrows. Axial range 4. Deals damage to target and neighbors.",slot:"offensive",icon:"",baseVariables:{range:4,cost:1,cooldown:1},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const{isAxial:r}=Fi(i.position,a);if(!on(i.position,a,4)||!r)return{effects:o,messages:["Invalid target! Axial range 4 only."],consumesTurn:!1};const f=[a,...xt(a)],g=Qe(i);for(const b of f){const y=Ae(t,b),A=gn({attackerId:i.id,targetId:y?.id||de(b),skillId:"MULTI_SHOOT",basePower:1,trinity:g,targetTrinity:y?Qe(y):void 0,damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.1},{attribute:"mind",coefficient:.1}],statusMultipliers:[]});o.push({type:"Damage",target:b,amount:A.finalPower,reason:"multi_shoot",scoreEvent:A.scoreEvent})}return o.push({type:"Juice",effect:"flash",target:a,color:"#ffff00"}),c.push("Multi-Shoot!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>Ze.getAxialTargets(t,i,4),upgrades:{},scenarios:St("MULTI_SHOOT")},Nx={id:"SET_TRAP",name:"Set Trap",description:"Place a hidden trap. Roots units for 3 turns.",slot:"utility",icon:"",baseVariables:{range:1,cost:1,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return a?Ai(t,a)||Oa(t,a)?{effects:o,messages:["Cannot place trap here!"],consumesTurn:!1}:(o.push({type:"PlaceTrap",position:a,ownerId:i.id}),o.push({type:"Juice",effect:"combat_text",target:a,text:"Trapped"}),c.push("Trap set."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(t,i)=>xt(i).filter(a=>!Ai(t,a)&&!Oa(t,a)),upgrades:{},scenarios:St("SET_TRAP")},Rx={id:"SWIFT_ROLL",name:"Swift Roll",description:"Quickly dodge 2 tiles. Passive: Automatically roll away from attackers when hit.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return a?on(i.position,a,2)?Ai(t,a)||Oa(t,a)||Xs(t,a,i.id)?{effects:o,messages:["Cannot roll there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"Juice",effect:"dashBlur",target:a,path:[i.position,a]}),c.push("Swift roll!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,2).filter(o=>J(o,i)?!1:!Ai(t,o)&&!Oa(t,o)&&!Xs(t,o)),upgrades:{},scenarios:St("SWIFT_ROLL")},kx={id:"SNEAK_ATTACK",name:"Sneak Attack",description:"Attack an adjacent enemy. Deals massive damage if executed from stealth.",slot:"offensive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Ki(t.enemies,a);if(!r)return{effects:o,messages:["No target!"],consumesTurn:!1};if(!on(i.position,a,1))return{effects:o,messages:["Out of range!"],consumesTurn:!1};const f=(i.stealthCounter||0)>0,g=f?3:1,b=gn({attackerId:i.id,targetId:r.id,skillId:"SNEAK_ATTACK",basePower:g,trinity:Qe(i),targetTrinity:Qe(r),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.25}],statusMultipliers:[]});return o.push({type:"Damage",target:r.id,amount:b.finalPower,reason:"sneak_attack",source:i.position,scoreEvent:b.scoreEvent}),f?(o.push({type:"Juice",effect:"flash",target:a,color:"#ff0000"}),c.push("SNEAK ATTACK!")):c.push("Sneak attack (No stealth bonus)."),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>xt(i).filter(a=>!!Ki(t.enemies,a)),upgrades:{},scenarios:St("SNEAK_ATTACK")},Lx={id:"SMOKE_SCREEN",name:"Smoke Screen",description:"Vanish into a cloud of smoke. Adds +2 to stealth counter.",slot:"utility",icon:"",baseVariables:{range:0,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:i.position}),c.push("Smoke Screen!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>[i],upgrades:{},scenarios:St("SMOKE_SCREEN")},Bx={id:"SHADOW_STEP",name:"Shadow Step",description:"Teleport through the shadows. Only works while invisible. Extends stealth.",slot:"utility",icon:"",baseVariables:{range:2,cost:0,cooldown:2},execute:(t,i,a)=>{const o=[],c=[];return a?(i.stealthCounter||0)>0?on(i.position,a,2)?Ai(t,a)||Oa(t,a)||Xs(t,a,i.id)?{effects:o,messages:["Cannot step there!"],consumesTurn:!1}:(o.push({type:"Displacement",target:"self",destination:a}),o.push({type:"SetStealth",target:"self",amount:2}),o.push({type:"Juice",effect:"hiddenFade",target:a}),c.push("Shadow stepped!"),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:["Too far!"],consumesTurn:!1}:{effects:o,messages:["Must be invisible to Shadow Step!"],consumesTurn:!1}:{effects:o,messages:c,consumesTurn:!1}},getValidTargets:(t,i)=>(t.player.stealthCounter||0)>0?Ze.getAreaTargets(t,i,2).filter(c=>J(c,i)?!1:!Ai(t,c)&&!Oa(t,c)&&!Xs(t,c)):[],upgrades:{},scenarios:St("SHADOW_STEP")};function Od(t,i){return t.enemies.find(a=>a.companionOf===i&&a.subtype==="falcon")}const Ix={id:"FALCON_COMMAND",name:t=>{const i=t?.player?.id;if(!i)return"Summon Falcon";const a=Od(t,i);if(!a)return"Summon Falcon";const o=a.companionState?.mode||"roost";return o==="scout"?"Falcon: Scout":o==="predator"?"Falcon: Hunt":"Falcon: Roost"},description:t=>{const i=t?.player?.id;if(!i)return"Call your Falcon companion.";const a=Od(t,i);if(!a)return"Call your Falcon companion.";const o=a.companionState?.mode||"roost";return o==="scout"?"Click tile to set patrol zone. Falcon orbits and attacks nearby enemies.":o==="predator"?"Click enemy to mark as prey. Falcon pursues and uses Apex Strike.":"Falcon returns to you. Heals and cleanses 1 debuff on arrival."},slot:"offensive",icon:"",baseVariables:{range:6,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[];let r=Od(t,i.id);if(!r){const b=VS({ownerId:i.id,position:xt(i.position)[0]});return o.push({type:"SpawnActor",actor:b}),o.push({type:"Message",text:"Your Falcon companion awakens!"}),c.push("Falcon summoned!"),{effects:o,messages:c,consumesTurn:!0}}const f=a?Ae(t,a):void 0;return!a||J(a,i.position)||!!(f&&f.id===i.id)?(c.push("Falcon returns to roost."),o.push({type:"Juice",effect:"combat_text",target:i.position,text:"Roost"}),o.push({type:"UpdateCompanionState",target:r.id,mode:"roost"}),{effects:o,messages:c,consumesTurn:!0}):f&&f.factionId==="enemy"?(c.push(`Falcon marks ${f.subtype||"enemy"} as prey!`),o.push({type:"Juice",effect:"combat_text",target:a,text:" Marked"}),o.push({type:"ApplyStatus",target:f.id,status:"marked_predator",duration:-1}),o.push({type:"UpdateCompanionState",target:r.id,mode:"predator",markTarget:f.id}),{effects:o,messages:c,consumesTurn:!0}):(c.push("Falcon set to patrol zone."),o.push({type:"Juice",effect:"combat_text",target:a,text:" Patrol"}),o.push({type:"UpdateCompanionState",target:r.id,mode:"scout",markTarget:a}),{effects:o,messages:c,consumesTurn:!0})},getValidTargets:(t,i)=>Ze.getAreaTargets(t,i,6).filter(o=>(J(o,i),!0)),upgrades:{KEEN_SIGHT:{id:"KEEN_SIGHT",name:"Keen Sight",description:"Falcon reveals hidden enemies within 3 tiles of its position."},TWIN_TALONS:{id:"TWIN_TALONS",name:"Twin Talons",description:"Basic Peck hits 2 targets instead of 1."},APEX_PREDATOR:{id:"APEX_PREDATOR",name:"Apex Predator",description:"Apex Strike cooldown reduced by 1. Marked enemies take +1 damage from all sources."}},scenarios:St("FALCON_COMMAND")},jx={id:"FALCON_PECK",name:"Peck",description:"The falcon pecks an adjacent enemy for 1 damage.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0,damage:1},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Ae(t,a);if(!r||r.factionId==="player")return{effects:o,messages:c,consumesTurn:!1};if(_e(i.position,a)>1)return{effects:o,messages:c,consumesTurn:!1};const f=gn({attackerId:i.id,targetId:r.id,skillId:"FALCON_PECK",basePower:1,trinity:Qe(i),targetTrinity:Qe(r),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.15}],statusMultipliers:[]});return o.push({type:"Damage",target:r.id,amount:f.finalPower,reason:"falcon_peck",scoreEvent:f.scoreEvent}),o.push({type:"Juice",effect:"combat_text",target:a,text:"Peck!",intensity:"low"}),c.push(`Falcon pecked ${r.subtype||"enemy"}!`),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>xt(i).filter(a=>{const o=Ae(t,a);return o&&o.factionId==="enemy"}),upgrades:{TWIN_TALONS:{id:"TWIN_TALONS",name:"Twin Talons",description:"Peck hits 2 adjacent targets instead of 1."}},scenarios:St("FALCON_PECK")},Dx={id:"FALCON_APEX_STRIKE",name:"Apex Strike",description:"The falcon dives into a target for lethal damage.",slot:"passive",icon:"",baseVariables:{range:4,cost:0,cooldown:2,damage:40},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Ae(t,a);if(!r)return{effects:o,messages:c,consumesTurn:!1};if(i.companionState?.apexStrikeCooldown&&i.companionState.apexStrikeCooldown>0)return{effects:o,messages:c,consumesTurn:!1};const f=gn({attackerId:i.id,targetId:r.id,skillId:"FALCON_APEX_STRIKE",basePower:40,trinity:Qe(i),targetTrinity:Qe(r),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});return o.push({type:"Damage",target:r.id,amount:f.finalPower,reason:"apex_strike",scoreEvent:f.scoreEvent}),o.push({type:"Juice",effect:"impact",target:a,intensity:"high"}),o.push({type:"UpdateCompanionState",target:i.id,apexStrikeCooldown:2}),c.push(`Falcon executes APEX STRIKE on ${r.subtype||"enemy"}!`),{effects:o,messages:c,consumesTurn:!0}},upgrades:{},getValidTargets:(t,i)=>{const a=[];return t.enemies.forEach(o=>{_e(i,o.position)<=4&&a.push(o.position)}),a}},Hx={id:"FALCON_HEAL",name:"Roost Heal",description:"The falcon roosts and restores health to its companion.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:1},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:c,consumesTurn:!1};const r=Ae(t,a);return r?i.companionState?.healCooldown&&i.companionState.healCooldown>0?{effects:o,messages:c,consumesTurn:!1}:(o.push({type:"Heal",target:r.id,amount:1}),o.push({type:"Juice",effect:"flash",target:r.position,color:"#00ff88"}),o.push({type:"UpdateCompanionState",target:i.id,healCooldown:1}),c.push("Falcon roosts. You feel restored."),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(t,i)=>{const a=[],o=t.player;return _e(i,o.position)<=1&&a.push(o.position),a}},Px={id:"FALCON_SCOUT",name:"Scout Orbit",description:"The actor orbits a target point in a hexagonal ring.",slot:"passive",icon:"",baseVariables:{range:1,cost:0,cooldown:0},execute:(t,i,a)=>{const o=[],c=[],r=i.companionState?.markTarget;if(!r||typeof r!="object")return{effects:o,messages:c,consumesTurn:!1};const f=r,g=xt(f);let b;if(_e(i.position,f)!==1)b=g.sort((y,A)=>_e(i.position,y)-_e(i.position,A))[0];else{const A=(g.findIndex(v=>J(v,i.position))+1)%6;b=g[A]}return Ze.isWithinBounds(t,b)&&Pe.isWalkable(t,b)&&!Ae(t,b)?(o.push({type:"Displacement",target:i.id,destination:b,source:i.position,simulatePath:!0}),{effects:o,messages:c,consumesTurn:!0}):{effects:o,messages:c,consumesTurn:!1}},upgrades:{},getValidTargets:(t,i)=>[]},Ux={id:"FALCON_AUTO_ROOST",name:"Auto Roost",description:"Automatically returns the falcon to roost mode when mark is lost.",slot:"passive",icon:"R",baseVariables:{range:0,cost:0,cooldown:0},execute:(t,i,a)=>({effects:[{type:"UpdateCompanionState",target:i.id,mode:"roost",markTarget:void 0}],messages:["Falcon loses prey and returns to roost mode."],consumesTurn:!0}),getValidTargets:(t,i)=>[i],upgrades:{}},ug=2,qx=3,zx=3;function Vx(t,i){const a=[];for(let o=0;o<6;o++){let c=t;for(let r=0;r<i;r++)c=jn(c,Cn(o));a.push(c)}return a}function $x(t,i,a){return Vx(i,a).filter(c=>!(!Ze.isWithinBounds(t,c)||!Pe.isWalkable(t,c)||Ae(t,c)))}const Yx={id:"KINETIC_TRI_TRAP",name:"Kinetic Tri-Trap",description:"Deploy 3 hidden traps on axial tiles. Triggered enemies are flung away.",slot:"defensive",icon:"",baseVariables:{range:ug,cost:0,cooldown:zx},execute:(t,i,a)=>{const o=[],c=[];let r=t;const f=$x(t,i.position,ug);if(f.length===0)return{effects:o,messages:["No valid trap positions!"],consumesTurn:!1};const g=Math.min(qx,f.length),b=[];o.push({type:"RemoveTrap",position:{q:0,r:0,s:0},ownerId:i.id});const y=[...f];for(let A=0;A<g&&y.length!==0;A++){const{value:v,nextState:x}=Ea(r);r=x;const E=Math.floor(v*y.length)%y.length;b.push(y[E]),y.splice(E,1)}for(const A of b)o.push({type:"PlaceTrap",position:A,ownerId:i.id}),o.push({type:"Juice",effect:"flash",target:A,intensity:"low",color:"#ffaa00"});return c.push(`${b.length} traps deployed.`),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>[i],upgrades:{VOLATILE_CORE:{id:"VOLATILE_CORE",name:"Volatile Core",description:"Traps deal 1 damage when triggered."},CHAIN_REACTION:{id:"CHAIN_REACTION",name:"Chain Reaction",description:"When a trap triggers, adjacent traps also activate."},QUICK_RELOAD:{id:"QUICK_RELOAD",name:"Quick Reload",description:"Individual trap reset cooldown reduced to 1."}},scenarios:St("KINETIC_TRI_TRAP")},dg=1,fg=1,Kx=1,Fx=2,Gx=2;function Wx(t,i,a){const o=Fs(a,i);if(o===-1)return null;const c=Cn(o);for(let f=Fx;f>=Kx;f--){let g=i,b=!0;for(let y=0;y<f;y++){if(g=jn(g,c),!Ze.isWithinBounds(t,g)){b=!1;break}if(!Pe.isWalkable(t,g)){b=!1;break}}if(b&&!Ae(t,g))return g}const r=[(o+1)%6,(o+5)%6];for(const f of r){const g=Cn(f);let b=jn(i,g);if(Ze.isWithinBounds(t,b)&&Pe.isWalkable(t,b)&&!Ae(t,b))return b}return null}const Xx={id:"WITHDRAWAL",name:"Withdrawal",description:"Quick shot + tactical backroll. Auto-triggers when enemies close in.",slot:"utility",icon:"",baseVariables:{range:dg,cost:0,cooldown:Gx,damage:fg},execute:(t,i,a)=>{const o=[],c=[];if(!a)return{effects:o,messages:["No target!"],consumesTurn:!1};if(_e(i.position,a)>dg)return{effects:o,messages:["Target out of range!"],consumesTurn:!1};const f=Ae(t,a);if(!f)return{effects:o,messages:["No enemy at target!"],consumesTurn:!1};if(f.factionId===i.factionId)return{effects:o,messages:["Cannot target allies!"],consumesTurn:!1};const g=gn({attackerId:i.id,targetId:f.id,skillId:"WITHDRAWAL",basePower:fg,trinity:Qe(i),targetTrinity:Qe(f),damageClass:"physical",scaling:[{attribute:"instinct",coefficient:.2}],statusMultipliers:[]});o.push({type:"Damage",target:f.id,amount:g.finalPower,scoreEvent:g.scoreEvent}),o.push({type:"Juice",effect:"impact",target:a}),c.push(`Withdrawal shot hits ${f.subtype||"enemy"}!`);const b=Wx(t,i.position,a);return b?(o.push({type:"Displacement",target:"self",destination:b,source:i.position}),o.push({type:"Juice",effect:"dashBlur",target:b,path:[i.position,b]}),c.push("Backroll!")):c.push("No safe retreat available!"),{effects:o,messages:c,consumesTurn:!0}},getValidTargets:(t,i)=>xt(i).filter(a=>{const o=Ae(t,a);return o&&o.factionId==="enemy"}),upgrades:{PARTING_SHOT:{id:"PARTING_SHOT",name:"Parting Shot",description:"Withdrawal deals +1 damage."},NIMBLE_FEET:{id:"NIMBLE_FEET",name:"Nimble Feet",description:"Backroll distance increased to 3 hexes."},HAIR_TRIGGER:{id:"HAIR_TRIGGER",name:"Hair Trigger",description:"Passive reaction does not consume cooldown."}},scenarios:St("WITHDRAWAL")},Qx={id:"ABSORB_FIRE",name:"Absorb Fire",description:"Fire heals you instead of harming you.",slot:"passive",icon:"",baseVariables:{cost:0,cooldown:0,range:0},execute:(t,i,a)=>({effects:[],messages:[]}),getValidTargets:()=>[],upgrades:{}},$s=(t,i)=>t.includes(i),Jx=t=>{const i=new Set,a=t.id;return((t.baseVariables.damage||0)>0||/(ATTACK|THROW|BLAST|FIREBALL|BASH|PECK|EXPLOSION|SPEAR|SHOOT)/.test(a))&&i.add("damage"),/(MOVE|DASH|JUMP|ROLL|VAULT|STEP|GRAPPLE|WITHDRAWAL|WALK)/.test(a)&&i.add("move"),/(HEAL|ABSORB)/.test(a)&&i.add("heal"),/(SHIELD|PROTECT|BULWARK)/.test(a)&&i.add("protect"),/(STUN|TRAP|SMOKE|TELEGRAPH|ROOT|SWAP|SCOUT)/.test(a)&&i.add("control"),/(RAISE|FALCON|SUMMON)/.test(a)&&i.add("summon"),/(FIRE|LAVA|HAZARD|TRAP)/.test(a)&&i.add("hazard"),t.slot==="offensive"&&i.add("damage"),t.slot==="defensive"&&i.add("protect"),t.slot==="utility"&&i.add("utility"),(t.baseVariables.cooldown>0||t.baseVariables.cost>0)&&i.add("economy"),i.size||i.add("utility"),[...i]},Zx={BASIC_MOVE:{intentTags:["move","objective","utility"],target:{pattern:"single"},estimates:{movement:1}},BASIC_ATTACK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:4}},AUTO_ATTACK:{intentTags:["damage","utility"],target:{pattern:"single"},estimates:{damage:2}},DASH:{intentTags:["move","damage","utility"],target:{pattern:"line"},estimates:{movement:2,damage:2},risk:{noProgressCastPenalty:5}},JUMP:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2},risk:{noProgressCastPenalty:6}},SHIELD_BASH:{intentTags:["damage","control","protect"],target:{pattern:"single"},estimates:{damage:3,control:2},risk:{requireEnemyContact:!0,noContactPenalty:5,noProgressCastPenalty:7}},BULWARK_CHARGE:{intentTags:["move","protect","damage"],target:{pattern:"line"},estimates:{movement:2,damage:4,shielding:2}},VAULT:{intentTags:["move","utility","control"],target:{pattern:"single"},estimates:{movement:3,control:2}},GRAPPLE_HOOK:{intentTags:["move","control"],target:{pattern:"line"},estimates:{movement:3,control:2}},SHIELD_THROW:{intentTags:["damage","control"],target:{pattern:"line"},estimates:{damage:6,control:2}},SPEAR_THROW:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5},risk:{requireEnemyContact:!0,noContactPenalty:4,noProgressCastPenalty:5}},FIREBALL:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:5,control:1}},FIREWALL:{intentTags:["hazard","control","damage"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:5,control:3}},FIREWALK:{intentTags:["move","hazard","utility"],target:{pattern:"single"},estimates:{movement:3},risk:{noProgressCastPenalty:8}},ABSORB_FIRE:{intentTags:["heal","hazard","utility"],target:{pattern:"self"},estimates:{healing:6},risk:{noProgressCastPenalty:2}},BOMB_TOSS:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:2}},TIME_BOMB:{intentTags:["damage","hazard","utility"],target:{pattern:"self"},estimates:{damage:6,control:1}},CORPSE_EXPLOSION:{intentTags:["damage","control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{damage:6,control:1}},RAISE_DEAD:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:5}},SOUL_SWAP:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:2}},MULTI_SHOOT:{intentTags:["damage"],target:{pattern:"line"},estimates:{damage:5}},SET_TRAP:{intentTags:["control","hazard"],target:{pattern:"single"},estimates:{control:3}},SWIFT_ROLL:{intentTags:["move","utility"],target:{pattern:"single"},estimates:{movement:2}},SNEAK_ATTACK:{intentTags:["damage","move"],target:{pattern:"single"},estimates:{damage:8,movement:2},risk:{requireEnemyContact:!0,noContactPenalty:3,noProgressCastPenalty:4}},SMOKE_SCREEN:{intentTags:["control","protect","utility"],target:{pattern:"radius",aoeRadius:1},estimates:{control:4,shielding:4}},SHADOW_STEP:{intentTags:["move","damage","utility"],target:{pattern:"single"},estimates:{movement:3,damage:3}},FALCON_COMMAND:{intentTags:["summon","control","utility"],target:{pattern:"single"},estimates:{summon:4,control:2}},FALCON_PECK:{intentTags:["damage"],target:{pattern:"single"},estimates:{damage:3}},FALCON_APEX_STRIKE:{intentTags:["damage","control"],target:{pattern:"single"},estimates:{damage:5,control:1}},FALCON_HEAL:{intentTags:["heal","utility"],target:{pattern:"single"},estimates:{healing:4}},FALCON_SCOUT:{intentTags:["control","utility"],target:{pattern:"self"},estimates:{control:3}},FALCON_AUTO_ROOST:{intentTags:["summon","utility"],target:{pattern:"self"},estimates:{summon:2}},KINETIC_TRI_TRAP:{intentTags:["control","hazard"],target:{pattern:"radius",aoeRadius:1},estimates:{control:5,damage:4}},WITHDRAWAL:{intentTags:["move","control","utility"],target:{pattern:"single"},estimates:{movement:2,control:1}},SENTINEL_TELEGRAPH:{intentTags:["control","objective"],target:{pattern:"radius",aoeRadius:2},estimates:{control:3}},SENTINEL_BLAST:{intentTags:["damage","hazard"],target:{pattern:"radius",aoeRadius:2},estimates:{damage:7}},THEME_HAZARDS:{intentTags:["hazard","control"],target:{pattern:"global"},estimates:{control:2}}},e1=(t,i)=>i?{...t,...i,target:{...t.target,...i.target||{}},estimates:{...t.estimates,...i.estimates||{}},economy:{...t.economy,...i.economy||{}},risk:{...t.risk,...i.risk||{}}}:t,t1=t=>{const i=Jx(t),a=($s(i,"move"),"single"),o={id:t.id,intentTags:i,target:{range:Math.max(0,t.baseVariables.range||0),pattern:a},estimates:{damage:Math.max(0,t.baseVariables.damage||0),movement:$s(i,"move")?Math.max(1,Math.min(3,t.baseVariables.range||1)):0,healing:$s(i,"heal")?2:0,shielding:$s(i,"protect")?1:0,control:$s(i,"control")?1:0,summon:$s(i,"summon")?1:0},economy:{cost:Math.max(0,t.baseVariables.cost||0),cooldown:Math.max(0,t.baseVariables.cooldown||0),consumesTurn:!0},risk:{selfExposure:$s(i,"move")?.5:0,hazardAffinity:$s(i,"hazard")?.5:0},complexity:1};return e1(o,Zx[t.id])},n1=t=>{const i=[];return(!t.intentTags||t.intentTags.length===0)&&i.push("intentTags must not be empty"),(!Number.isFinite(t.target.range)||t.target.range<0)&&i.push("target.range must be >= 0"),t.target.pattern||i.push("target.pattern is required"),(!Number.isFinite(t.economy.cooldown)||t.economy.cooldown<0)&&i.push("economy.cooldown must be >= 0"),(!Number.isFinite(t.economy.cost)||t.economy.cost<0)&&i.push("economy.cost must be >= 0"),(!Number.isFinite(t.complexity)||t.complexity<0)&&i.push("complexity must be >= 0"),i},i1=t=>{const i=[],a=[];for(const[o,c]of Object.entries(t)){const r=c.intentProfile||t1(c);c.intentProfile=r;const f=n1(r);f.length>0&&a.push({skillId:o,errors:f}),r||i.push(o)}return{missing:i,invalid:a}},s1=(t,i)=>t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i),a1=(t,i,a)=>!!(t.player.id!==a&&J(t.player.position,i)||t.enemies.some(o=>o.id!==a&&o.hp>0&&J(o.position,i))||t.companions?.some(o=>o.id!==a&&o.hp>0&&J(o.position,i))),mg=(t,i)=>{const a={q:i.q-t.q,r:i.r-t.r,s:i.s-t.s};let o=wl[0],c=Number.NEGATIVE_INFINITY;for(const r of wl){const f=r.q*a.q+r.r*a.r+r.s*a.s;f>c&&(c=f,o=r)}return o},o1=(t,i)=>{const a=s1(t,i.targetActorId);if(!a)return{effects:[],destination:null,collided:!1};const o=Math.max(0,Math.min(i.maxDistance,Math.floor(i.magnitude)));if(o<=0)return{effects:[],destination:a.position,collided:!1};const c=a.position,r=i.mode==="push"?mg(i.source,c):mg(c,i.source),f=[c];let g=c,b=!1;for(let A=0;A<o;A++){const v=jn(g,r);if(!Pe.isWalkable(t,v)||a1(t,v,a.id)){b=!0;break}f.push(v),g=v}const y=[];return J(g,c)||y.push({type:"Displacement",target:a.id,destination:g,path:f,simulatePath:!0}),b&&i.collision.onBlocked==="crush_damage"&&y.push({type:"Damage",target:a.id,amount:Math.max(0,Math.floor(i.collision.crushDamage??0)),reason:i.damageReason||"crush"}),{effects:y,destination:g,collided:b}},qr=t=>JSON.parse(JSON.stringify(t)),l1=(t,i)=>i==="floor"?Math.floor(t):i==="round"?Math.round(t):i==="ceil"?Math.ceil(t):t,Cd=(t,i)=>{let a=t.base;for(const o of t.scaling||[])a+=(i[o.stat]??0)*o.coefficient;return a=l1(a,t.round),t.min!==void 0&&(a=Math.max(t.min,a)),t.max!==void 0&&(a=Math.min(t.max,a)),a},r1=(t,i,a,o)=>{const c=i.split(".");let r=t;for(let b=0;b<c.length-1;b++){const y=c[b],A=r[y];if(!A||typeof A!="object")return;r=A}const f=c[c.length-1],g=Number(r[f]);Number.isFinite(g)&&(a==="set"&&(r[f]=o),a==="add"&&(r[f]=g+o),a==="multiply"&&(r[f]=g*o))},c1=(t,i,a)=>{let o=qr(t.baseAction.effects);const c=qr(t.reactivePassives||[]),r=new Set(t.keywords),f={};for(const g of t.upgrades)f[g.id]=g;for(const g of i){const b=f[g];if(b)for(const y of b.modifiers){if(y.op==="add_effect"&&o.push(qr(y.effect)),y.op==="remove_effect_by_tag"&&(o=o.filter(A=>!A.tags.includes(y.tag))),y.op==="modify_number"){const A=o.find(v=>v.id===y.effectId);A&&r1(A,y.field,y.mode,y.value)}y.op==="add_keyword"&&r.add(y.keyword),y.op==="remove_keyword"&&r.delete(y.keyword),y.op==="add_reaction"&&c.push(qr(y.reaction))}}return t.inhibit?.filterMode==="exclude_matching_tags"&&a.size>0&&(o=o.filter(g=>!g.tags.some(b=>a.has(b)))),{effects:o,reactions:c,keywords:r}},u1=(t,i)=>{const a=Qe(t),o=Number(i?.momentum??0),c=Number(i?.mass??1);return{body:a.body,mind:a.mind,instinct:a.instinct,mass:Number.isFinite(c)?c:1,speed:t.speed||1,momentum:Number.isFinite(o)?o:0}},Nd=(t,i)=>i?Ae(t,i)?.id:void 0,d1=(t,i,a,o,c)=>{if(o.kind==="MESSAGE")return[{type:"Message",text:o.text}];if(o.kind==="DEAL_DAMAGE"){const b=Math.max(0,Math.floor(Cd(o.amount,c))),y=Nd(t,a);return[{type:"Damage",target:o.target.selector==="targetActor"?y||"targetActor":o.target.selector==="self"?i.id:a||"targetActor",amount:b,reason:o.reason}]}if(o.kind==="APPLY_STATUS"){const b=Nd(t,a);return[{type:"ApplyStatus",target:o.target.selector==="targetActor"?b||"targetActor":o.target.selector==="self"?i.id:a||"targetActor",status:o.statusId,duration:o.duration}]}const r=Nd(t,a);if(!r)return[];const f=Cd(o.force.magnitude,c),g=o.force.collision.crushDamage?Cd(o.force.collision.crushDamage,c):0;return o1(t,{source:i.position,targetActorId:r,mode:o.force.mode,magnitude:f,maxDistance:o.force.maxDistance,collision:{onBlocked:o.force.collision.onBlocked,crushDamage:g}}).effects},f1=(t,i,a,o)=>{const c=[];for(let r=0;r<t.gridWidth;r++)for(let f=0;f<t.gridHeight;f++){const g=In(r,f);Ws(g,t.gridWidth,t.gridHeight)&&_e(i,g)<=a&&c.push(g)}return c.sort((r,f)=>{if(o==="q_then_r")return r.q===f.q?r.r-f.r:r.q-f.q;if(o==="r_then_q")return r.r===f.r?r.q-f.q:r.r-f.r;const g=_e(i,r),b=_e(i,f);return g!==b?g-b:r.q===f.q?r.r-f.r:r.q-f.q}),c},m1=t=>{const i=t.baseAction.effects.find(c=>c.kind==="DEAL_DAMAGE"),a=t.baseAction.effects.find(c=>c.kind==="APPLY_FORCE"),o={};return t.upgrades.forEach(c=>{o[c.id]={id:c.id,name:c.name,description:c.description||c.name}}),{id:t.id,name:t.name,description:t.description||t.name,slot:t.slot,icon:"data-driven",baseVariables:{range:t.targeting.range,cost:t.baseAction.costs.energy,cooldown:t.baseAction.costs.cooldown,damage:i?.amount?.base,momentum:a?.force?.magnitude?.base},execute:(c,r,f,g=[],b={})=>{const y=new Set(b.inhibitTags||[]),A=c1(t,g,y),v=u1(r,b),E=[...(A.reactions||[]).filter(h=>h.trigger==="ON_DECLARE").flatMap(h=>h.effects),...A.effects],m=[];for(const h of E)m.push(...d1(c,r,f,h,v));return{effects:m,messages:[],consumesTurn:t.baseAction.costs.consumesTurn}},getValidTargets:(c,r)=>{if(t.targeting.mode==="self")return[r];let f=f1(c,r,t.targeting.range,t.targeting.deterministicSort);return(t.targeting.mode==="single"||t.targeting.mode==="radius"||t.targeting.mode==="line")&&(t.targeting.requiresLos&&(f=f.filter(g=>nf(c,r,g).isValid)),t.targeting.allowOccupied||(f=f.filter(g=>!Ae(c,g)))),f},upgrades:o}},p1=new Map,ly=new Map,h1=t=>{const i=m1(t);return p1.set(t.id,t),ly.set(t.id,i),i},g1=t=>t.map(h1),y1=()=>{const t={};for(const[i,a]of ly.entries())t[i]=a;return t},fc={GRAPPLE_HOOK:Jv,SPEAR_THROW:Zv,SHIELD_BASH:ex,SHIELD_THROW:lx,VAULT:rx,JUMP:tx,BULWARK_CHARGE:nx,BASIC_ATTACK:ix,AUTO_ATTACK:ny,SENTINEL_TELEGRAPH:sx,SENTINEL_BLAST:ax,THEME_HAZARDS:ox,BASIC_MOVE:ux,DASH:dx,FIREBALL:mx,FIREWALL:px,FIREWALK:hx,BOMB_TOSS:gx,TIME_BOMB:yx,CORPSE_EXPLOSION:vx,RAISE_DEAD:Mx,SOUL_SWAP:Ox,MULTI_SHOOT:Cx,SET_TRAP:Nx,SWIFT_ROLL:Rx,SNEAK_ATTACK:kx,SMOKE_SCREEN:Lx,SHADOW_STEP:Bx,FALCON_COMMAND:Ix,FALCON_PECK:jx,FALCON_APEX_STRIKE:Dx,FALCON_HEAL:Hx,FALCON_SCOUT:Px,FALCON_AUTO_ROOST:Ux,KINETIC_TRI_TRAP:Yx,WITHDRAWAL:Xx,ABSORB_FIRE:Qx},zr=i1(fc);if(zr.missing.length>0||zr.invalid.length>0){const t=zr.missing.join(", "),i=zr.invalid.map(a=>`${a.skillId}: ${a.errors.join("; ")}`).join(" | ");throw new Error(`Skill intent profile validation failed. missing=[${t}] invalid=[${i}]`)}const fo=()=>({...fc,...y1()});function Ks(t){const a=fo()[t];return a?{id:t,name:a.name,description:typeof a.description=="function"?a.description({}):a.description,slot:a.slot,cooldown:a.baseVariables.cooldown||0,currentCooldown:0,range:a.baseVariables.range||0,upgrades:Object.keys(a.upgrades||{}),activeUpgrades:[]}:null}function b1(){return[Ks("BASIC_MOVE"),Ks("BASIC_ATTACK"),Ks("AUTO_ATTACK"),Ks("SPEAR_THROW"),Ks("SHIELD_BASH"),Ks("JUMP")].filter(Boolean)}const S1={...fc,get:t=>fo()[t],getAllUpgrades:()=>{const t=fo();return Object.values(t).flatMap(i=>Object.values(i.upgrades||{}).map(a=>({...a,skillId:i.id})))},getUpgrade:t=>{const i=fo();for(const a of Object.values(i))if(a.upgrades?.[t])return a.upgrades[t]},getSkillForUpgrade:t=>{const i=fo();for(const[a,o]of Object.entries(i))if(o.upgrades?.[t])return a},getSkillRange:(t,i)=>{const a=(t.activeSkills||[]).find(r=>r.id===i),o=fo()[i];if(!o)return a?.range||0;let c=o.baseVariables.range;return a?.activeUpgrades&&a.activeUpgrades.forEach(r=>{const f=o.upgrades[r];f?.modifyRange&&(c+=f.modifyRange)}),c}},Nn=S1,v1=Nn.getSkillRange,x1=t=>Nn.get(t),A1=(t,i,a,o)=>{let c=t;const r=[],f=a?t.enemies.filter(b=>b.id===a):t.enemies,g=[...c.enemies];return f.forEach(b=>{const y=c.enemies.find(A=>A.id===b.id);if(y){if(ji(y)){const A=g.findIndex(v=>v.id===b.id);A!==-1&&(g[A]={...g[A],intent:void 0,intentPosition:void 0});return}if(y.intent&&y.intentPosition){let A=!1;const v=Nn.get(y.intent),x=y.activeSkills?.find(E=>E.id===y.intent);if(v&&x){const m=(v.getValidTargets?v.getValidTargets(c,y.position):[]).some(k=>J(k,c.player.position));let h=y.intentPosition;if(m)h=c.player.position;else{const k=g.findIndex(B=>B.id===b.id);k!==-1&&(g[k]={...g[k],intent:void 0,intentPosition:void 0});return}const R=v.execute(c,y,h,x.activeUpgrades);c=xi(c,R.effects,{sourceId:y.id,targetId:c.player.id,stepId:o}),r.push(...R.messages),A=!0}else if(y.subtype!=="bomber"){if(J(y.intentPosition,i)){c={...c,player:Ys(c.player,1)};const E=`${y.subtype||"enemy"}#${y.id}`;r.push(`${E} hit you! (HP: ${c.player.hp}/${c.player.maxHp})`),A=!0}}if(A){const E=g.findIndex(m=>m.id===b.id);E!==-1&&(g[E]={...g[E],intent:void 0,intentPosition:void 0})}}}}),c={...c,enemies:g},{state:c,messages:r}};class pg extends Error{issues;constructor(i,a){super(`${i} validation failed:
${a.map(o=>`${o.path}: ${o.message}`).join(`
`)}`),this.name="ContractValidationError",this.issues=a}}const nn=t=>typeof t=="object"&&t!==null&&!Array.isArray(t),hs=t=>typeof t=="number"&&Number.isFinite(t),Li=t=>Number.isInteger(t),Et=t=>typeof t=="string",fe=(t,i,a)=>t.push({path:i,message:a}),T1=t=>{if(!Et(t))return t;try{return JSON.parse(t)}catch(i){throw new Error(`Invalid JSON: ${i.message}`)}},Al=(t,i,a,o={})=>{if(!Array.isArray(t))return fe(i,a,"Expected array");const c=new Set;o.nonEmpty&&t.length===0&&fe(i,a,"Must not be empty"),t.forEach((r,f)=>{if(!Et(r)||r.length===0)return fe(i,`${a}[${f}]`,"Expected non-empty string");o.unique&&(c.has(r)&&fe(i,`${a}[${f}]`,`Duplicate "${r}"`),c.add(r))})},hg=(t,i,a)=>{if(!nn(t))return fe(i,a,"Expected object");hs(t.base)||fe(i,`${a}.base`,"Expected number"),t.min!==void 0&&!hs(t.min)&&fe(i,`${a}.min`,"Expected number"),t.max!==void 0&&!hs(t.max)&&fe(i,`${a}.max`,"Expected number"),hs(t.min)&&hs(t.max)&&t.min>t.max&&fe(i,a,"min must be <= max")},E1=(t,i,a)=>nn(t)?((!Et(t.id)||t.id.length===0)&&fe(i,`${a}.id`,"Expected non-empty string"),Al(t.tags,i,`${a}.tags`,{nonEmpty:!0,unique:!0}),Et(t.kind)?t.kind==="DEAL_DAMAGE"?(hg(t.amount,i,`${a}.amount`),(!nn(t.target)||!Et(t.target.selector))&&fe(i,`${a}.target`,"Expected selector"),!0):t.kind==="APPLY_STATUS"?((!Et(t.statusId)||t.statusId.length===0)&&fe(i,`${a}.statusId`,"Expected statusId"),(!Li(t.duration)||t.duration<0)&&fe(i,`${a}.duration`,"Expected integer >= 0"),(!nn(t.target)||!Et(t.target.selector))&&fe(i,`${a}.target`,"Expected selector"),!0):t.kind==="APPLY_FORCE"?nn(t.force)?((!Et(t.force.mode)||!new Set(["push","pull"]).has(t.force.mode))&&fe(i,`${a}.force.mode`,"Expected push|pull"),(!Et(t.force.direction)||!new Set(["source_to_target","target_to_source"]).has(t.force.direction))&&fe(i,`${a}.force.direction`,"Invalid direction"),(!Li(t.force.maxDistance)||t.force.maxDistance<0)&&fe(i,`${a}.force.maxDistance`,"Expected integer >= 0"),hg(t.force.magnitude,i,`${a}.force.magnitude`),nn(t.force.collision)||fe(i,`${a}.force.collision`,"Expected object"),!0):(fe(i,`${a}.force`,"Expected object"),!0):t.kind==="MESSAGE"?((!Et(t.text)||t.text.length===0)&&fe(i,`${a}.text`,"Expected non-empty string"),!0):(fe(i,`${a}.kind`,"Unknown kind"),!1):(fe(i,`${a}.kind`,"Expected kind"),!1)):(fe(i,a,"Expected object"),!1),_1=(t,i,a)=>{if(!nn(t))return fe(i,a,"Expected object");if(!Et(t.method))return fe(i,`${a}.method`,"Expected method");if(t.method==="fixed"){hs(t.value)||fe(i,`${a}.value`,"Expected number");return}if(t.method==="uniform_int"){Li(t.min)||fe(i,`${a}.min`,"Expected integer"),Li(t.max)||fe(i,`${a}.max`,"Expected integer"),Li(t.min)&&Li(t.max)&&t.min>t.max&&fe(i,a,"min must be <= max");return}if(t.method==="triangular_int"){Li(t.min)||fe(i,`${a}.min`,"Expected integer"),Li(t.mode)||fe(i,`${a}.mode`,"Expected integer"),Li(t.max)||fe(i,`${a}.max`,"Expected integer");return}if(t.method==="weighted_table"){if(!Array.isArray(t.table)||t.table.length===0)return fe(i,`${a}.table`,"Expected non-empty array");t.table.forEach((o,c)=>{if(!nn(o))return fe(i,`${a}.table[${c}]`,"Expected object");hs(o.value)||fe(i,`${a}.table[${c}].value`,"Expected number"),(!hs(o.weight)||o.weight<=0)&&fe(i,`${a}.table[${c}].weight`,"Expected number > 0")});return}fe(i,`${a}.method`,"Unknown propensity method")},w1=t=>{const i=[];if(!nn(t))return fe(i,"$","Expected object"),i;if((!Et(t.version)||!/^1\./.test(t.version))&&fe(i,"$.version","Expected v1.x"),(!Et(t.id)||!/^[A-Z0-9_]+$/.test(t.id))&&fe(i,"$.id","Expected uppercase id"),(!Et(t.name)||t.name.length===0)&&fe(i,"$.name","Expected non-empty string"),(!Et(t.actorType)||!new Set(["player","enemy"]).has(t.actorType))&&fe(i,"$.actorType","Expected player|enemy"),(!Et(t.factionId)||t.factionId.length===0)&&fe(i,"$.factionId","Expected non-empty string"),(!nn(t.coordSpace)||t.coordSpace.system!=="cube-axial"||t.coordSpace.pointFormat!=="qrs")&&fe(i,"$.coordSpace","Expected {system:cube-axial,pointFormat:qrs}"),nn(t.instantiate)?((!Et(t.instantiate.rngStream)||t.instantiate.rngStream.length===0)&&fe(i,"$.instantiate.rngStream","Expected non-empty string"),(!Et(t.instantiate.counterMode)||!new Set(["consume_global","stateless"]).has(t.instantiate.counterMode))&&fe(i,"$.instantiate.counterMode","Expected consume_global|stateless"),Al(t.instantiate.drawOrder,i,"$.instantiate.drawOrder",{nonEmpty:!0,unique:!0})):fe(i,"$.instantiate","Expected object"),!nn(t.propensities))fe(i,"$.propensities","Expected object");else{const a=t.propensities;["body","mind","instinct","speed","mass"].forEach(o=>{o in a||fe(i,`$.propensities.${o}`,"Missing required propensity")}),Object.entries(a).forEach(([o,c])=>_1(c,i,`$.propensities.${o}`))}return nn(t.skillLoadout)?(Al(t.skillLoadout.baseSkillIds,i,"$.skillLoadout.baseSkillIds",{nonEmpty:!0,unique:!0}),t.skillLoadout.passiveSkillIds!==void 0&&Al(t.skillLoadout.passiveSkillIds,i,"$.skillLoadout.passiveSkillIds",{unique:!0})):fe(i,"$.skillLoadout","Expected object"),i},M1=t=>{const i=[];return nn(t)?((!Et(t.version)||!/^1\./.test(t.version))&&fe(i,"$.version","Expected v1.x"),(!Et(t.id)||!/^[A-Z0-9_]+$/.test(t.id))&&fe(i,"$.id","Expected uppercase id"),(!Et(t.name)||t.name.length===0)&&fe(i,"$.name","Expected non-empty string"),(!Et(t.slot)||!new Set(["offensive","defensive","utility","passive"]).has(t.slot))&&fe(i,"$.slot","Invalid slot"),Al(t.keywords,i,"$.keywords",{unique:!0}),nn(t.targeting)?((!Et(t.targeting.mode)||!new Set(["self","single","line","radius","global"]).has(t.targeting.mode))&&fe(i,"$.targeting.mode","Invalid mode"),(!Li(t.targeting.range)||t.targeting.range<0)&&fe(i,"$.targeting.range","Expected integer >= 0"),typeof t.targeting.requiresLos!="boolean"&&fe(i,"$.targeting.requiresLos","Expected boolean"),typeof t.targeting.allowOccupied!="boolean"&&fe(i,"$.targeting.allowOccupied","Expected boolean")):fe(i,"$.targeting","Expected object"),(!nn(t.stackPolicy)||t.stackPolicy.resolveOrder!=="LIFO")&&fe(i,"$.stackPolicy.resolveOrder","MVP requires LIFO"),nn(t.baseAction)?(nn(t.baseAction.costs)?((!hs(t.baseAction.costs.energy)||t.baseAction.costs.energy<0)&&fe(i,"$.baseAction.costs.energy","Expected number >= 0"),(!Li(t.baseAction.costs.cooldown)||t.baseAction.costs.cooldown<0)&&fe(i,"$.baseAction.costs.cooldown","Expected integer >= 0"),typeof t.baseAction.costs.consumesTurn!="boolean"&&fe(i,"$.baseAction.costs.consumesTurn","Expected boolean")):fe(i,"$.baseAction.costs","Expected object"),!Array.isArray(t.baseAction.effects)||t.baseAction.effects.length===0?fe(i,"$.baseAction.effects","Expected non-empty array"):t.baseAction.effects.forEach((a,o)=>E1(a,i,`$.baseAction.effects[${o}]`))):fe(i,"$.baseAction","Expected object"),Array.isArray(t.upgrades)?t.upgrades.forEach((a,o)=>{if(!nn(a))return fe(i,`$.upgrades[${o}]`,"Expected object");(!Et(a.id)||!/^[A-Z0-9_]+$/.test(a.id))&&fe(i,`$.upgrades[${o}].id`,"Expected uppercase id"),(!Et(a.name)||a.name.length===0)&&fe(i,`$.upgrades[${o}].name`,"Expected non-empty string"),Array.isArray(a.modifiers)||fe(i,`$.upgrades[${o}].modifiers`,"Expected array")}):fe(i,"$.upgrades","Expected array"),i):(fe(i,"$","Expected object"),i)},O1=t=>{const i=T1(t),a=[];if(!nn(i))throw new pg("TacticalDataPack",[{path:"$",message:"Expected pack object"}]);if((!Et(i.version)||!/^1\./.test(i.version))&&a.push({path:"$.version",message:"Expected v1.x string"}),Array.isArray(i.units)?i.units.forEach((o,c)=>{w1(o).forEach(f=>a.push({path:`$.units[${c}]${f.path.slice(1)}`,message:f.message}))}):a.push({path:"$.units",message:"Expected array"}),Array.isArray(i.skills)?i.skills.forEach((o,c)=>{M1(o).forEach(f=>a.push({path:`$.skills[${c}]${f.path.slice(1)}`,message:f.message}))}):a.push({path:"$.skills",message:"Expected array"}),a.length>0)throw new pg("TacticalDataPack",a);return i},C1=t=>({definition:t,drawOrder:[...t.instantiate.drawOrder],skillIds:[...t.skillLoadout.baseSkillIds],passiveSkillIds:[...t.skillLoadout.passiveSkillIds||[]]}),N1={Light:3,Standard:5,Heavy:8,Anchored:12,OuterWall:20},ps=t=>({version:"1.0.0",id:t.id,name:t.name,actorType:"enemy",subtype:t.subtype,factionId:"enemy",weightClass:t.weightClass,coordSpace:{system:"cube-axial",pointFormat:"qrs"},instantiate:{rngStream:"enemy.instantiate",seedSalt:t.subtype,counterMode:"consume_global",drawOrder:["body","mind","instinct","speed","mass"],includeRollTrace:!1},propensities:{body:{method:"fixed",value:t.trinity.body},mind:{method:"fixed",value:t.trinity.mind},instinct:{method:"fixed",value:t.trinity.instinct},speed:{method:"fixed",value:t.speed},mass:{method:"fixed",value:N1[t.weightClass]}},derivedStats:{maxHp:{formula:"trinity_hp_v1"}},physics:{collisionPolicy:"crush_damage",crushModel:{baseDamage:0,impulseMultiplier:1,massDivider:1,minDamage:1}},skillLoadout:{baseSkillIds:t.baseSkills,passiveSkillIds:t.passiveSkills||[]},runtimeDefaults:{startingHp:"maxHp",temporaryArmor:0,isVisible:!0}}),R1={version:"1.0.0",id:"SHIELD_BASH_V1",name:"Shield Bash V1",description:"Data-driven migration variant of shield bash.",slot:"offensive",keywords:["Momentum"],intentTags:["damage","control","move"],targeting:{mode:"single",range:1,requiresLos:!0,allowOccupied:!0,deterministicSort:"distance_then_q_then_r"},stackPolicy:{resolveOrder:"LIFO",reactionWindow:"automated",playerPriority:!1,emitTickEvents:!0},baseAction:{costs:{energy:0,cooldown:2,consumesTurn:!0},effects:[{id:"shield_bash_v1_force",kind:"APPLY_FORCE",tags:["movement","momentum"],target:{selector:"targetActor"},force:{mode:"push",direction:"source_to_target",magnitude:{base:2,scaling:[{stat:"body",coefficient:.2}],min:1,round:"floor"},maxDistance:3,collision:{onBlocked:"crush_damage",crushDamage:{base:1,scaling:[{stat:"momentum",coefficient:1}],min:1,round:"floor"}}}},{id:"shield_bash_v1_damage",kind:"DEAL_DAMAGE",tags:["damage","physical"],target:{selector:"targetActor"},amount:{base:2,scaling:[{stat:"body",coefficient:.4}],min:1,round:"floor"},damageClass:"physical",reason:"shield_bash_v1"}]},reactivePassives:[],upgrades:[],inhibit:{filterMode:"exclude_matching_tags",removableTags:["movement","momentum"]},preview:{dryRunEnabled:!0,eventMap:{APPLY_FORCE:"UnitMoved",DEAL_DAMAGE:"DamageTaken"}}},k1={version:"1.0.0",units:[ps({id:"ENEMY_FOOTMAN_V1",name:"Footman",subtype:"footman",weightClass:"Standard",speed:1,trinity:{body:0,mind:0,instinct:0},baseSkills:["BASIC_MOVE","BASIC_ATTACK"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_SPRINTER_V1",name:"Sprinter",subtype:"sprinter",weightClass:"Standard",speed:2,trinity:{body:0,mind:0,instinct:0},baseSkills:["BASIC_MOVE","BASIC_ATTACK"]}),ps({id:"ENEMY_RAIDER_V1",name:"Raider",subtype:"raider",weightClass:"Standard",speed:1,trinity:{body:.4,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","DASH"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_POUNCER_V1",name:"Pouncer",subtype:"pouncer",weightClass:"Standard",speed:1,trinity:{body:.4,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","GRAPPLE_HOOK"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_SHIELDBEARER_V1",name:"Shield Bearer",subtype:"shieldBearer",weightClass:"Heavy",speed:1,trinity:{body:1,mind:0,instinct:.4},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SHIELD_BASH"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_ARCHER_V1",name:"Archer",subtype:"archer",weightClass:"Standard",speed:1,trinity:{body:.2,mind:0,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SPEAR_THROW"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_BOMBER_V1",name:"Bomber",subtype:"bomber",weightClass:"Standard",speed:1,trinity:{body:.4,mind:.2,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","BOMB_TOSS"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_WARLOCK_V1",name:"Warlock",subtype:"warlock",weightClass:"Standard",speed:1,trinity:{body:.4,mind:.6,instinct:.2},baseSkills:["BASIC_MOVE","BASIC_ATTACK"],passiveSkills:["AUTO_ATTACK"]}),ps({id:"ENEMY_SENTINEL_V1",name:"Sentinel",subtype:"sentinel",weightClass:"Heavy",speed:1,trinity:{body:4,mind:2,instinct:2},baseSkills:["BASIC_MOVE","BASIC_ATTACK","SENTINEL_TELEGRAPH","SENTINEL_BLAST"],passiveSkills:["AUTO_ATTACK"]})],skills:[R1]},L1=new Map,ry=new Map,B1=t=>(L1.set(t.id,t),t.subtype&&ry.set(t.subtype,t),t),I1=t=>t.map(B1),j1=t=>ry.get(t);let cy=!1;const D1=(t=k1)=>{const i=O1(t);return I1(i.units),g1(i.skills),cy=!0,{unitsRegistered:i.units.length,skillsRegistered:i.skills.length}},uy=()=>cy?{unitsRegistered:0,skillsRegistered:0}:D1(),dy=(t,i="none")=>i==="floor"?Math.floor(t):i==="round"?Math.round(t):i==="ceil"?Math.ceil(t):t,fy=(t,i)=>i?Math.max(i.min,Math.min(i.max,t)):t,Vr=(t,i)=>fy(dy(t,i.round),i.clamp),H1=(t,i)=>{if(t.method==="fixed")return{value:Vr(t.value,t),before:-1,after:-1,usedRng:!1};if(t.method==="uniform_int"){const f=i(),g=t.max-t.min+1,b=t.min+Math.floor(f.value*g)%Math.max(1,g);return{value:Vr(b,t),before:f.before,after:f.after,usedRng:!0}}if(t.method==="triangular_int"){const f=i(),g=t.min,b=t.mode,y=t.max,A=(b-g)/Math.max(1e-9,y-g),v=f.value<A?g+Math.sqrt(f.value*(y-g)*(b-g)):y-Math.sqrt((1-f.value)*(y-g)*(y-b));return{value:Vr(v,t),before:f.before,after:f.after,usedRng:!0}}const a=i(),o=t.table.reduce((f,g)=>f+g.weight,0);let c=a.value*Math.max(1e-9,o),r=t.table[t.table.length-1].value;for(const f of t.table)if(c-=f.weight,c<=0){r=f.value;break}return{value:Vr(r,t),before:a.before,after:a.after,usedRng:!0}},gg=(t,i,a)=>{if(t.formula==="trinity_hp_v1")return uc(a);const o=t.base??0,r=(t.terms||[]).reduce((g,b)=>g+(i[b.stat]??0)*b.coefficient,o),f=dy(r,t.round);return fy(f,t.clamp)},P1=(t,i)=>!i||Object.keys(i).length===0?t:{...t,activeSkills:(t.activeSkills||[]).map(a=>{const o=i[a.id];return o===void 0?a:{...a,currentCooldown:Math.max(0,o)}})},U1=t=>t.id.toLowerCase(),q1=(t,i,a)=>{const o=i.definition,c=[];let r={rngSeed:t.rngSeed||"default",rngCounter:Math.max(0,t.rngCounter||0)},f=0;const g=`${r.rngSeed}:${o.instantiate.rngStream}:${o.instantiate.seedSalt||o.id}`,b=()=>{if(o.instantiate.counterMode==="consume_global"){const w=r.rngCounter,H=oc(r.rngSeed,w);return r={...r,rngCounter:w+1},{value:H,before:w,after:r.rngCounter}}const B=f;return{value:oc(g,f++),before:B,after:f}},y={};for(const B of i.drawOrder){const _=o.propensities[B];if(!_)continue;const w=H1(_,b);y[B]=w.value,w.usedRng&&c.push({key:B,method:_.method,value:w.value,counterBefore:w.before,counterAfter:w.after})}const A={body:y.body??0,mind:y.mind??0,instinct:y.instinct??0},v=o.derivedStats||{},x=v.maxHp?gg(v.maxHp,y,A):uc(A),E=y.speed??1,m=y.mass??1,h=o.runtimeDefaults?.startingHp==="explicit"?Math.max(0,o.runtimeDefaults.explicitHp??x):x,R=Gs({id:a.actorId||U1(o),type:o.actorType,subtype:a.subtype||o.subtype,position:a.position,hp:h,maxHp:x,speed:E,factionId:a.factionId||o.factionId,weightClass:o.weightClass,skills:[...i.skillIds,...i.passiveSkillIds],trinity:A});let k=P1(R,o.skillLoadout.startCooldowns);o.runtimeDefaults?.temporaryArmor!==void 0&&(k={...k,temporaryArmor:Math.max(0,o.runtimeDefaults.temporaryArmor)}),o.runtimeDefaults?.isVisible!==void 0&&(k={...k,isVisible:o.runtimeDefaults.isVisible}),y.maxHp=x,y.speed=E,y.mass=m;for(const[B,_]of Object.entries(v))B!=="maxHp"&&(y[B]=gg(_,y,A));return{actor:k,stats:y,trinity:A,speed:E,mass:m,nextCursor:r,rollTrace:c}},z1=(t,i,a)=>q1(t,C1(i),a),V1=(t,i)=>{const a=cc(i),o=Vb(uo,yl),c=Math.floor(uo/2),r=uo-1+(yl-1)-c,f=[],g=[];for(const w of o){const H=w.q===0,j=w.q===uo-1,L=w.r===0,W=w.r===yl-1,Z=w.q+w.r;H||j||L||W||Z===c||Z===r?f.push(w):g.push(w)}const b=In(4,9),y=In(4,1);let A;if(t%1===0){const w=g.filter(H=>!J(H,b)&&!J(H,y)&&_e(H,b)>=3);w.length>0&&(A=w[Math.floor(a.next()*w.length)])}const x=Math.floor(g.length*rS),E=[],m={playerStart:b,stairsPosition:y,shrinePosition:A},R=[...g.filter(w=>!Gh(w,m))].sort(()=>a.next()-.5);for(let w=0;w<x;w++)w<R.length&&E.push(R[w]);const k=g.filter(w=>!Gh(w,{playerStart:b,stairsPosition:y,shrinePosition:A})&&!f.some(H=>J(H,w))&&!E.some(H=>J(H,w))&&_e(w,b)>=3),B={id:"arena",type:"combat",center:In(Math.floor(uo/2),Math.floor(yl/2)),hexes:o,connections:[]},_=new Map;for(const w of o)_.set(`${w.q},${w.r}`,{baseId:"STONE",position:w,traits:new Set(mo.STONE.defaultTraits),effects:[]});for(const w of f)_.set(`${w.q},${w.r}`,{baseId:"WALL",position:w,traits:new Set(mo.WALL.defaultTraits),effects:[]});for(const w of E)_.set(`${w.q},${w.r}`,{baseId:"LAVA",position:w,traits:new Set(mo.LAVA.defaultTraits),effects:[]});return{rooms:[B],allHexes:o,stairsPosition:y,shrinePosition:A,spawnPositions:k,playerSpawn:b,tiles:_}},$1=(t,i,a)=>{uy();const o=cc(a+":enemies"),c=Qh[Math.min(t,Qh.length-1)],r=xd[t]||xd[Math.max(...Object.keys(xd).map(Number))];let f={rngSeed:`${a}:enemy-propensity`,rngCounter:0};const g=[];let b=c;const y=[];for(;b>0&&y.length<i.length;){const A=r.filter(W=>{const Z=Pd[W];return Z&&Z.cost<=b});if(A.length===0)break;const v=Math.floor(o.next()*A.length),x=A[v],E=Pd[x],m=i.filter(W=>!y.some(Z=>J(Z,W)));if(m.length===0)break;const h=Math.floor(o.next()*m.length),R=m[h];y.push(R);const k=Math.floor(t/5),B=E.weightClass||"Standard",_=(f.rngCounter<<8)+g.length,w=`enemy_${g.length}_${po(a,_,6,x)}`,H=j1(x);let j;if(H){const W=z1(f,H,{actorId:w,position:R,subtype:x,factionId:"enemy"});f=W.nextCursor,j=W.actor}else j=zS({id:w,subtype:x,position:R,speed:E.speed||50,skills:$S(x),weightClass:B,enemyType:E.type});const L=k>0?{...j,hp:j.hp+k,maxHp:j.maxHp+k}:j;g.push({...L,subtype:x,enemyType:E.type,actionCooldown:E.actionCooldown??L.actionCooldown,isVisible:!0}),b-=E.cost}return g},Y1=t=>cS[t]||"catacombs",K1=(t,i)=>{const a=i.initialSeed??i.rngSeed??"0",o=i.commandLog?.length??0;return{id:po(a,o,9,"cmd"),timestamp:i.turnNumber,action:t}},F1=(t,i,a)=>{const o=a.initialSeed??a.rngSeed??"0",c=a.undoStack?.length??0;return{id:po(o,c,9,"delta"),undoData:{player:{...t.player},enemies:[...t.enemies],turnNumber:t.turnNumber,gameStatus:t.gameStatus}}},ho={VANGUARD:{id:"VANGUARD",name:"Vanguard",description:"Direct damage, brawling, and area denial.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","AUTO_ATTACK","SPEAR_THROW","SHIELD_BASH","JUMP"]},SKIRMISHER:{id:"SKIRMISHER",name:"Skirmisher",description:"Zero direct damage. Kinetic momentum and environmental lethality.",startingUpgrades:[],startingSkills:["DASH","GRAPPLE_HOOK","SHIELD_THROW","VAULT"]},FIREMAGE:{id:"FIREMAGE",name:"Fire Mage",description:"Area control with fire and high-damage spells.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","ABSORB_FIRE","FIREBALL","FIREWALL","FIREWALK"]},NECROMANCER:{id:"NECROMANCER",name:"Necromancer",description:"Utilize death and reanimation.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","CORPSE_EXPLOSION","RAISE_DEAD","SOUL_SWAP"]},HUNTER:{id:"HUNTER",name:"Hunter",description:"Ranged precision and traps.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","FALCON_COMMAND","KINETIC_TRI_TRAP","WITHDRAWAL"]},ASSASSIN:{id:"ASSASSIN",name:"Assassin",description:"Stealth and high burst damage.",startingUpgrades:[],startingSkills:["BASIC_MOVE","BASIC_ATTACK","SNEAK_ATTACK","SMOKE_SCREEN","SHADOW_STEP"]}},my=t=>{const i=t.startingSkills.map(o=>Ks(o)).filter(Boolean),a=t.id;return{upgrades:[...t.startingUpgrades],activeSkills:i,archetype:a}},G1=t=>t.some(i=>i.id==="BASIC_MOVE"||i.id==="DASH"),py=(t=[])=>{if(G1(t))return t;const i=Ks("BASIC_MOVE");return i?[i,...t]:t},$d=t=>{const i=t.activeSkills||[],a=py(i);return a===i?t:{...t,activeSkills:a}};function W1(t){let i=t;const a=[],o=[],c=new Map(i.tiles);for(const[r,f]of c.entries()){const g=[];let b=!1;for(const v of f.effects){if(v.duration===-1){g.push(v);continue}const x=v.duration-1;x>0?(g.push({...v,duration:x}),b=!0):(a.push(`The ${v.id.toLowerCase()} died down.`),b=!0)}b&&c.set(r,{...f,effects:g});const y=[i.player,...i.enemies],A=v=>`${v.q},${v.r}`;for(const v of y)if(A(v.position)===r){const x=Aa.processStay(v,f,i);o.push(...x.effects),a.push(...x.messages)}}return i={...i,tiles:c},o.length>0&&(i=xi(i,o)),{state:i,messages:a}}class yg{getFalconIntent(i,a){const o=a.companionState?.mode||"roost",c=a.companionOf===i.player.id?i.player:i.enemies.find(f=>f.id===a.companionOf),r={expectedValue:0,reasoningCode:`FALCON_${o.toUpperCase()}`,isGhost:!1,rngConsumption:0};if(o==="scout")return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_SCOUT",targetHex:a.position,priority:10,metadata:r};if(o==="predator"&&typeof a.companionState?.markTarget=="string"){const f=i.enemies.find(b=>b.id===a.companionState.markTarget&&b.hp>0);if(!f)return{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_AUTO_ROOST",targetHex:a.position,priority:9,metadata:{...r,reasoningCode:"FALCON_AUTO_ROOST"}};const g=_e(a.position,f.position);return g<=4?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_APEX_STRIKE",targetHex:f.position,primaryTargetId:f.id,priority:10,metadata:r}:g<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_PECK",targetHex:f.position,primaryTargetId:f.id,priority:9,metadata:r}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,a,f.position),primaryTargetId:f.id,priority:7,metadata:r}}return c?_e(a.position,c.position)<=1?{type:"USE_SKILL",actorId:a.id,skillId:"FALCON_HEAL",targetHex:c.position,primaryTargetId:c.id,priority:10,metadata:r}:{type:"MOVE",actorId:a.id,skillId:"BASIC_MOVE",targetHex:this.findStepToward(i,a,c.position),primaryTargetId:c.id,priority:7,metadata:r}:{type:"WAIT",actorId:a.id,skillId:"WAIT_SKILL",priority:1,metadata:{...r,reasoningCode:"FALCON_WAIT"}}}findStepToward(i,a,o){const c=xt(a.position).filter(r=>Ze.isWithinBounds(i,r)).filter(r=>Pe.isWalkable(i,r)).filter(r=>{const f=Ae(i,r);return!f||f.id===a.id});return c.length===0?a.position:c.sort((r,f)=>_e(r,o)-_e(f,o))[0]}getIntent(i,a){if(a.subtype==="falcon")return this.getFalconIntent(i,a);if(a.subtype==="bomb")return{type:"USE_SKILL",actorId:a.id,skillId:"TIME_BOMB",targetHex:a.position,priority:10,metadata:{expectedValue:0,reasoningCode:"BOMB_FUSE_TICK",isGhost:!1,rngConsumption:0}};const o=i.player.position,c=oS(a,o,{...i,occupiedCurrentTurn:i.occupiedCurrentTurn}),{entity:r,message:f}=c;let g="WAIT",b="WAIT_SKILL",y,A,v=10;const x=r.intent||"Waiting";if(x==="Moving"||x==="Advancing"||x==="Repositioning"||x==="Lumbering")g="MOVE",b="BASIC_MOVE",y=r.position;else if(x==="BASIC_ATTACK"){if(g="ATTACK",b="BASIC_ATTACK",y=r.intentPosition,y){const m=i.player.position.q===y.q&&i.player.position.r===y.r?i.player:i.enemies.find(h=>h.position.q===y?.q&&h.position.r===y?.r);m&&m.factionId!==a.factionId&&(A=m.id)}}else x==="SPEAR_THROW"?(g="USE_SKILL",b="SPEAR_THROW",y=r.intentPosition):x==="DASH"?(g="USE_SKILL",b="DASH",y=r.intentPosition):x==="GRAPPLE_HOOK"?(g="USE_SKILL",b="GRAPPLE_HOOK",y=r.intentPosition):x==="Bombing"?(g="USE_SKILL",b="BOMB_TOSS",y=r.intentPosition):x==="SENTINEL_BLAST"?(g="USE_SKILL",b="SENTINEL_BLAST",y=r.intentPosition):x==="SENTINEL_TELEGRAPH"?(g="USE_SKILL",b="SENTINEL_TELEGRAPH",y=r.intentPosition):(x==="Charging Power"||x==="Preparing")&&(g="WAIT",b="WAIT_SKILL");if(!(b==="WAIT_SKILL"||a.activeSkills?.some(m=>m.id===b)))g="WAIT",b="WAIT_SKILL",y=void 0,A=void 0;else if(b!=="WAIT_SKILL"){const m=Nn.get(b);m?.getValidTargets&&y&&(m.getValidTargets(i,a.position).some(k=>J(k,y))||(g="WAIT",b="WAIT_SKILL",y=void 0,A=void 0))}return{type:g,actorId:a.id,skillId:b,primaryTargetId:A,targetHex:y,priority:v,metadata:{expectedValue:0,reasoningCode:x.toUpperCase().replace(" ","_"),isGhost:!1,rngConsumption:(f?.includes("teleports")||f?.includes("Bombing"),(c.nextState.rngCounter||0)-(i.rngCounter||0))}}}}class Tl{inputQueue=[];resolveInput;pushIntent(i){this.inputQueue.push(i),this.resolveInput&&(this.resolveInput(i),this.resolveInput=void 0)}getIntent(i,a){return this.inputQueue.length>0?this.inputQueue.shift():new Promise(o=>{this.resolveInput=o})}}class El{static strategies=new Map;static defaultEnemyStrategy=new yg;static defaultPlayerStrategy=new Tl;static register(i,a){this.strategies.set(i,a)}static resolve(i){return this.strategies.has(i.id)?this.strategies.get(i.id):i.type==="player"?this.defaultPlayerStrategy:this.defaultEnemyStrategy}static reset(){this.strategies.clear(),this.defaultEnemyStrategy=new yg,this.defaultPlayerStrategy=new Tl}}const hy=(t,i,a)=>ji(a)?{...t,type:"WAIT",skillId:"WAIT_SKILL",priority:0,metadata:{...t.metadata,reasoningCode:"STATUS_STUNNED"}}:t;class gy{static execute(i,a,o){return this.resolveExecution(i,a,o)}static simulate(i,a,o){return this.resolveExecution(i,a,o)}static resolveExecution(i,a,o){const c=[],r=[],f=Nn.get(i.skillId);if(!f&&i.type!=="WAIT")return{effects:[],messages:[`Failed to execute unknown skill: ${i.skillId}`],consumesTurn:!1};if(i.type==="WAIT")return{effects:[],messages:[],consumesTurn:!0};if(!(i.skillId==="WAIT_SKILL"||a.activeSkills.some(E=>E.id===i.skillId)))return{effects:[],messages:[`Actor ${a.id} does not have skill ${i.skillId} in loadout!`],consumesTurn:!1};let b=i.targetHex,y=i.primaryTargetId;if(!b&&f&&(b=this.findOptimalTargetHex(i,a,o,f.baseVariables.range)),!b)return{effects:[],messages:[`No valid target found for ${i.skillId}`],consumesTurn:!1};if(b&&!y){const E=Ae(o,b);E&&(y=E.id)}const v=a.activeSkills.find(E=>E.id===i.skillId)?.activeUpgrades||[],x=f.execute(o,a,b,v);return{effects:[...c,...x.effects],messages:[...r,...x.messages],consumesTurn:x.consumesTurn??!0,targetId:y,kills:x.kills||0}}static findOptimalTargetHex(i,a,o,c){if(i.primaryTargetId){const r=o.enemies.find(f=>f.id===i.primaryTargetId)||(o.player.id===i.primaryTargetId?o.player:void 0);if(r&&(i.type==="ATTACK"||i.type==="USE_SKILL"))return r.position}}}const Yd=(t,i)=>t.q!==i.q?t.q-i.q:t.r!==i.r?t.r-i.r:t.s-i.s,nc=(t,i)=>t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i),X1=(t,i)=>{if(i.primaryTargetId)return nc(t,i.primaryTargetId);if(i.targetHex)return Ae(t,i.targetHex)},Q1=(t,i,a)=>{const o=new Map,c=X1(t,i),r=f=>{f&&o.set(de(f),f)};return a.forEach(f=>{f.type==="Damage"?typeof f.target=="string"&&f.target!=="targetActor"&&f.target!=="area"?r(nc(t,f.target)?.position):f.target==="targetActor"?r(c?.position):f.target==="area"?r(f.source):typeof f.target=="object"&&"q"in f.target&&r(f.target):f.type==="Impact"||f.type==="LavaSink"?r(nc(t,f.target)?.position):f.type==="Displacement"&&r(f.destination)}),[...o.values()].sort(Yd)},bg=t=>{const i=[];t.enemies.filter(c=>c.hp>0&&c.factionId!==t.player.factionId).forEach(c=>{const f=El.resolve(c).getIntent(t,c);if(f instanceof Promise)return;const g=hy(f,t,c);let b=g;g.skillId==="SENTINEL_TELEGRAPH"&&(b={...g,skillId:"SENTINEL_BLAST"});const y=gy.simulate(b,c,t),A=Q1(t,b,y.effects);A.length!==0&&i.push({actorId:c.id,skillId:g.skillId,targetHex:g.targetHex,dangerTiles:A})}),i.sort((c,r)=>c.actorId!==r.actorId?c.actorId.localeCompare(r.actorId):c.skillId!==r.skillId?c.skillId.localeCompare(r.skillId):!c.targetHex&&!r.targetHex?0:c.targetHex?r.targetHex?Yd(c.targetHex,r.targetHex):1:-1);const o=new Map;return i.forEach(c=>c.dangerTiles.forEach(r=>o.set(de(r),r))),{sourceTurn:t.turnNumber,dangerTiles:[...o.values()].sort(Yd),projections:i}};var yy={};const Kd=typeof process<"u"&&yy?.HOP_ENGINE_DEBUG==="1",by=typeof process<"u"&&yy?.HOP_ENGINE_WARN==="1",J1=Kd||by,Sy=(t,i)=>{if(J1){if(i){console.warn(`[TURN_STACK] ${t}`,i);return}console.warn(`[TURN_STACK] ${t}`)}},Z1=(t,i,a,o)=>{const c=(t.pendingFrames?.length??0)+1;return{id:`${t.turnNumber}:${a}:${i}:${c}`,type:i,status:a,createdTurn:t.turnNumber,blocking:!0,payload:o}},fl=(t,i,a,o)=>{const c=Z1(t,a,i.status,o);return{...t,pendingStatus:i,pendingFrames:[...t.pendingFrames||[],c]}},Fd=()=>{const t=gs();return{...t,gameStatus:"hub",message:[Wt([],"Welcome to the Strategic Hub. Select your loadout.","INFO","SYSTEM")[0]],player:{...t.player,activeSkills:[]},hasSpear:!1,hasShield:!1}},gs=(t=1,i,a,o,c)=>{uy();const r=i||String(Date.now()),f=Y1(t),g=V1(t,r),b=$1(t,g.spawnPositions||[],r),y=o?{hp:o.hp,maxHp:o.maxHp,speed:o.speed||Xh.speed}:{speed:Xh.speed},A=o?.upgrades||(c?c.startingUpgrades:[]),v=c?my(c):{activeSkills:b1(),archetype:"VANGUARD"},x=py(o?.activeSkills||v.activeSkills),E=o?.archetype||v.archetype,m=g.tiles||new Map,R={turnNumber:1,player:{...Gs({id:"player",type:"player",position:g.playerSpawn,hp:y.hp,maxHp:y.maxHp,speed:y.speed,factionId:"player",activeSkills:x,archetype:E,weightClass:"Standard",components:new Map}),previousPosition:g.playerSpawn},enemies:b.map(k=>({...k,previousPosition:k.position,statusEffects:k.statusEffects||[],temporaryArmor:k.temporaryArmor||0})),gridWidth:uo,gridHeight:yl,gameStatus:"playing",message:t===1?[Wt([],"Welcome to the arena. Survive.","INFO","SYSTEM")[0]]:Wt(o?.message||[],`Floor ${t} - ${f.charAt(0).toUpperCase()+f.slice(1)}. Be careful.`,"INFO","OBJECTIVE"),hasSpear:!0,stairsPosition:g.stairsPosition,occupancyMask:[0n],shrinePosition:g.shrinePosition,shrineOptions:void 0,hasShield:!0,floor:t,upgrades:A,rooms:g.rooms,theme:f,commandLog:[],undoStack:[],rngSeed:r,initialSeed:a??(t===1?r:void 0),rngCounter:0,actionLog:[],kills:o&&o.kills||0,environmentalKills:o&&o.environmentalKills||0,turnsSpent:o&&o.turnsSpent||0,dailyRunDate:o?.dailyRunDate,runObjectives:o?.runObjectives||[],hazardBreaches:o?.hazardBreaches||0,completedRun:void 0,combatScoreEvents:o?.combatScoreEvents||[],dyingEntities:[],visualEvents:[],timelineEvents:[],intentPreview:void 0,initiativeQueue:void 0,tiles:m};return R.initiativeQueue=Ma(R),R.occupancyMask=Ze.refreshOccupancyMask(R),R},Sg=(t,i,a,o)=>{const c=i==="player"?t.player:t.enemies.find(b=>b.id===i);if(!c)return{state:t,messages:[]};const r=[],f=[];return c.statusEffects.forEach(b=>{if(b.tickWindow===a&&b.onTick){const y=b.onTick(c,t);y&&r.push(...y)}}),{state:xi(t,r,{sourceId:i,stepId:o}),messages:f}},$r=(t,i=!1)=>{if(t.pendingStatus||(t.pendingFrames?.length??0)>0)return Sy("Blocked processNextTurn while pendingStatus is active.",{status:t.pendingStatus?.status,pendingFrames:t.pendingFrames?.length??0,turnNumber:t.turnNumber}),t;let a=t;const o=[],c=[];let r=0;const f=100;let g=!1;for(;r<f;){if(r++,a.player.hp<=0&&a.pendingStatus?.status!=="lost"){const ne=xl(a);return fl({...a,message:Wt(a.message,"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:ne},"RUN_LOST",{reason:"GLOBAL_DEATH_CHECK"})}a.occupancyMask=Ze.refreshOccupancyMask(a);let y;if((i&&r===1||g)&&a.initiativeQueue){g=!1;const ne=a.initiativeQueue;ne.entries.length>0&&ne.currentIndex>=0&&ne.currentIndex<ne.entries.length&&(y=ne.entries[ne.currentIndex].actorId)}else{const ne=_S(a);a={...a,initiativeQueue:ne.queue},y=ne.actorId??void 0}if(!y)break;const A=y==="player"?a.player:a.enemies.find(ne=>ne.id===y),v=`${a.turnNumber}:${a.initiativeQueue?.round??0}:${y}:${r}`;if(!A||A.hp<=0){a={...a,initiativeQueue:Td(a.initiativeQueue,y)};continue}if(ES(a.initiativeQueue)?.turnStartPosition||(a={...a,initiativeQueue:wS(a,A)}),!i||r>1){const ne=Sg(a,y,"START_OF_TURN",v);if(a=ne.state,o.push(...ne.messages),y==="player"&&a.upgrades?.includes("RELIC_STEADY_PLATES")){const ve=Math.min(2,(a.player.temporaryArmor||0)+1);ve!==(a.player.temporaryArmor||0)&&(a={...a,player:{...a.player,temporaryArmor:ve}},o.push(Wt([],"Steady Plates harden your stance.","INFO","COMBAT")[0]))}const xe=A1(a,a.player.position,y,v);a=xe.state,o.push(...xe.messages)}const E=y==="player"?a.player:a.enemies.find(ne=>ne.id===y);if(!E||E.hp<=0){a={...a,initiativeQueue:Td(a.initiativeQueue,y),message:Yi(a.message,o,"INFO","SYSTEM")};continue}const m=y==="player"?a.player:a.enemies.find(ne=>ne.id===y);if(!m||m.hp<=0)continue;let h,R=!1;if(ji(m))R=!0,h={type:"WAIT",actorId:m.id,skillId:"WAIT_SKILL",priority:0,metadata:{expectedValue:0,reasoningCode:"STATUS_STUNNED_AUTOSKIP",isGhost:!1}},y==="player"?o.push("You are stunned and skip your turn."):o.push(`${m.subtype||"Enemy"} is stunned and skips its turn.`);else{const xe=El.resolve(m).getIntent(a,m);if(xe instanceof Promise){const ve=bg(a);return{...a,intentPreview:ve,message:Yi(a.message,o,"INFO","SYSTEM"),dyingEntities:[...a.dyingEntities||[],...c]}}h=xe}const k=E.activeSkills.map(ne=>ne.id).join(", ");Kd&&(console.log(`[ENGINE] Actor: ${y} | Loadout: [${k}] | Pos: ${JSON.stringify(E.position)}`),console.log(`[ENGINE] Intent: ${h.type} | Skill: ${h.skillId} | TargetHex: ${h.targetHex?JSON.stringify(h.targetHex):"none"} | TargetId: ${h.primaryTargetId||"none"}`)),h.metadata.rngConsumption&&(a={...a,rngCounter:(a.rngCounter||0)+h.metadata.rngConsumption}),h=hy(h,a,m);const{effects:B,messages:_,consumesTurn:w,targetId:H,kills:j}=gy.execute(h,m,a);if(Kd&&console.log(`[ENGINE] ${y} intends ${h.type} (${h.skillId}) onto ${H||(h.targetHex?JSON.stringify(h.targetHex):"self")}`),by&&B.length===0&&h.type!=="WAIT"){const ne=`[ENGINE] WARNING: Intent ${h.type} (${h.skillId}) for actor ${y} produced ZERO effects!`;console.warn(ne)}const L=a,W=xi(a,B,{sourceId:y,targetId:H,stepId:v});if(y==="player"&&(W.kills=(W.kills||0)+(j||0)),w===!1){a={...L,message:Yi(a.message,_,"INFO","COMBAT")},g=!0;continue}if(a=W,o.push(..._),y!=="player"){const ne=a.enemies.find(xe=>xe.id===y);if(ne?.subtype==="bomber"){const xe=h.skillId==="BOMB_TOSS"?2:Math.max(0,(ne.actionCooldown??0)-1);ne.actionCooldown!==xe&&(a={...a,enemies:a.enemies.map(ve=>ve.id===y?{...ve,actionCooldown:xe}:ve)})}}const Z=y==="player"?a.player:a.enemies.find(ne=>ne.id===y);if(!Z||Z.hp<=0){if(y==="player"){const ne=xl(a);return fl({...a,message:Wt(Yi(a.message,o,"INFO","SYSTEM"),"You have fallen...","CRITICAL","COMBAT")},{status:"lost",completedRun:ne},"RUN_LOST",{reason:"SELF_ACTION_DEATH"})}a={...a,enemies:a.enemies.filter(ne=>ne.id!==y),initiativeQueue:Td(a.initiativeQueue,y),message:Yi(a.message,o,"INFO","SYSTEM")};continue}const Te=Sg(a,y,"END_OF_TURN",v);a=Te.state,o.push(...Te.messages),a={...a,enemies:a.enemies.map(ne=>ne.id===y?Fh(ne):ne),player:y==="player"?Fh(a.player):a.player,initiativeQueue:MS(a,y)};const oe=y==="player"?a.player:a.enemies.find(ne=>ne.id===y);if(!(R||h.metadata?.reasoningCode==="STATUS_STUNNED"||h.metadata?.reasoningCode==="STATUS_STUNNED_AUTOSKIP")&&oe&&oe.hp>0){const ne=OS(a,y)||oe.previousPosition||oe.position,xe=CS(a,y)??void 0,ve=Yv(a,oe,xt(ne),ne,xe,v);a=ve.state,o.push(...ve.messages),y==="player"&&(a.kills=(a.kills||0)+ve.kills)}if(y==="player"){const ne=a.player.position;a.spearPosition&&J(ne,a.spearPosition)&&(a={...a,hasSpear:!0,spearPosition:void 0,message:Wt(a.message,"Picked up your spear.","INFO","OBJECTIVE")});const xe=W1(a);if(a=xe.state,o.push(...xe.messages),a.player=mS(a.player),a={...a,turnNumber:a.turnNumber+1,turnsSpent:(a.turnsSpent||0)+1},Gb(a,a.player.position)){const V=Nn.getAllUpgrades().map(ge=>ge.id).filter(ge=>!a.upgrades.includes(ge)),ie=[];let re={...a};for(let ge=0;ge<3&&V.length>0;ge++){const O=Ea(re);re=O.nextState;const Y=Math.floor(O.value*V.length);ie.push(V[Y]),V.splice(Y,1)}const Re=ie.length>0?ie:["EXTRA_HP"];return fl({...a,rngCounter:re.rngCounter,message:Wt(a.message,"A holy shrine! Choose an upgrade.","INFO","OBJECTIVE")},{status:"choosing_upgrade",shrineOptions:Re},"SHRINE_CHOICE",{shrineOptions:Re})}if(Wb(a,a.player.position)){if(a.floor>=10){const V=xl(a);return fl({...a,message:Wt(a.message,`Arcade Cleared! Final Score: ${V.score}`,"INFO","OBJECTIVE")},{status:"won",completedRun:V},"RUN_WON",{score:V.score??0})}return fl({...a,message:Wt(a.message,"Descending to the next level...","INFO","OBJECTIVE")},{status:"playing"},"STAIRS_TRANSITION",{nextFloor:a.floor+1})}}}const b=bg(a);return{...a,intentPreview:b,message:Yi(a.message,o,"INFO","SYSTEM"),dyingEntities:[...a.dyingEntities||[],...c]}},eA=(t,i)=>{const a=$d(t.player),o=a===t.player?t:{...t,player:a};if(o.gameStatus!=="playing"&&i.type!=="RESET"&&i.type!=="SELECT_UPGRADE"&&i.type!=="LOAD_STATE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN"&&i.type!=="EXIT_TO_HUB")return o;const c={...o,isShaking:!1,lastSpearPath:void 0,dyingEntities:[],occupiedCurrentTurn:void 0,visualEvents:[],timelineEvents:[]};switch(i.type){case"LOAD_STATE":{const v=i.payload;return Array.isArray(v.tiles)&&(v.tiles=new Map(v.tiles.map(([x,E])=>[x,{...E,traits:new Set(E.traits)}]))),v.player=$d(vl(v.player)),v.enemies=(v.enemies||[]).map(vl),v.companions&&(v.companions=v.companions.map(vl)),v}case"RESET":{const x=t.player.archetype==="SKIRMISHER"?"SKIRMISHER":"VANGUARD",E=ho[x];return gs(1,i.payload?.seed||String(Date.now()),void 0,void 0,E)}case"EXIT_TO_HUB":return Fd()}if(o.gameStatus!=="playing"&&i.type!=="SELECT_UPGRADE"&&i.type!=="APPLY_LOADOUT"&&i.type!=="START_RUN")return o;const r=K1(i,o),f=o;let g={...c,initiativeQueue:c.initiativeQueue};const y=((v,x)=>{if(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP"].includes(x.type)&&!bl(v))return v;switch(x.type){case"SELECT_UPGRADE":{if(!("payload"in x))return v;const m=x.payload;let h=v.player;const R=Nn.getUpgrade(m);if(R){const k=Nn.getSkillForUpgrade(m);k&&(h=pS(h,k,m))}else m==="EXTRA_HP"&&(h=dS(h,1,!0));return{...v,player:h,upgrades:[...v.upgrades,m],gameStatus:"playing",shrinePosition:void 0,shrineOptions:void 0,message:Wt(v.message,`Gained ${R?.name||m}!`,"INFO","OBJECTIVE")}}case"USE_SKILL":{const{skillId:m,target:h}=x.payload,R=El.resolve(v.player);return R instanceof Tl&&R.pushIntent({type:"USE_SKILL",actorId:v.player.id,skillId:m,targetHex:h,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),$r(v,!0)}case"MOVE":{if(!("payload"in x))return v;const m=x.payload,h=v.player.activeSkills||[],R=Ki(v.enemies,m),k=["BASIC_ATTACK","BASIC_MOVE","DASH"],B=h.filter(W=>W.slot==="passive"),_=[...B.filter(W=>k.includes(W.id)),...B.filter(W=>!k.includes(W.id))];let w;for(const W of _){const Z=Nn.get(W.id);if(!Z?.getValidTargets)continue;if(Z.getValidTargets(v,v.player.position).some(oe=>J(oe,m))){w=W.id;break}}if(!w){const W=h.some(Te=>Te.id==="BASIC_ATTACK"),Z=h.some(Te=>Te.id==="BASIC_MOVE");if(R&&W)w="BASIC_ATTACK";else if(!R&&Z)w="BASIC_MOVE";else return{...v,message:Wt(v.message,R?"No valid passive attack for target.":"No valid passive movement for target.","CRITICAL","SYSTEM")}}const H=R?"ATTACK":"MOVE",j=w,L=El.resolve(v.player);return L instanceof Tl&&L.pushIntent({type:H,actorId:v.player.id,skillId:j,targetHex:m,primaryTargetId:R?.id,priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),$r(v,!0)}case"WAIT":{const m=El.resolve(v.player);return m instanceof Tl&&m.pushIntent({type:"WAIT",actorId:v.player.id,skillId:"WAIT",priority:10,metadata:{expectedValue:0,reasoningCode:"PLAYER_INPUT",isGhost:!1}}),$r(v,!0)}case"APPLY_LOADOUT":{if(!("payload"in x))return v;const m=x.payload,h=my(m);return{...v,player:{...v.player,activeSkills:h.activeSkills,archetype:h.archetype},upgrades:h.upgrades,hasSpear:m.startingSkills.includes("SPEAR_THROW"),hasShield:m.startingSkills.includes("SHIELD_THROW")||v.hasShield,selectedLoadoutId:m.id,message:Wt(v.message,`${m.name} selected.`,"INFO","SYSTEM")}}case"START_RUN":{const{loadoutId:m,seed:h,mode:R,date:k}=x.payload,B=ho[m];if(!B)return v;if(R==="daily"){const _=jv(k),w=Dv(_);return{...gs(1,h||w,void 0,void 0,B),dailyRunDate:_,runObjectives:Hv(w),hazardBreaches:0}}return gs(1,h,void 0,void 0,B)}case"ADVANCE_TURN":return v.pendingStatus||(v.pendingFrames?.length??0)>0?(Sy("Ignored ADVANCE_TURN while pendingStatus is active.",{status:v.pendingStatus?.status,pendingFrames:v.pendingFrames?.length??0,turnNumber:v.turnNumber}),v):$r(v,!1);case"RESOLVE_PENDING":{const m=v.pendingFrames||[];if(m.length>1)return{...v,pendingFrames:m.slice(1)};if(!v.pendingStatus)return m.length===1?{...v,pendingFrames:[]}:v;const{status:h,shrineOptions:R,completedRun:k}=v.pendingStatus;if(h==="playing"&&v.gameStatus==="playing"){const B=v.initialSeed??v.rngSeed??"0",_=`${B}:${v.floor+1}`,w=v.enemies.filter(j=>j.hp>0&&j.factionId==="player"&&j.companionOf===v.player.id).sort((j,L)=>j.id.localeCompare(L.id)),H=gs(v.floor+1,_,B,{...v.player,hp:Math.min(v.player.maxHp,v.player.hp+1),upgrades:v.upgrades});if(w.length>0){const j=[H.player.position,...xt(H.player.position)],L=[H.player,...H.enemies],W=[];for(let Z=0;Z<w.length;Z++){const Te=w[Z],oe=j[j.length-1]||H.player.position,Be=j.find(xe=>!L.some(V=>J(V.position,xe))&&Pe.isWalkable(H,xe))||oe,ne={...Te,position:Be,previousPosition:Be};L.push(ne),W.push(ne)}H.enemies=[...H.enemies,...W],H.companions=[...H.companions||[],...W.filter(Z=>Z.companionOf===v.player.id)],H.initiativeQueue=Ma(H),H.occupancyMask=Ze.refreshOccupancyMask(H)}return{...H,actionLog:[...v.actionLog||[]],dailyRunDate:v.dailyRunDate,runObjectives:v.runObjectives,hazardBreaches:v.hazardBreaches||0,pendingFrames:void 0}}return{...v,gameStatus:h,shrineOptions:R||v.shrineOptions,completedRun:k||v.completedRun,pendingStatus:void 0,pendingFrames:void 0}}case"EXIT_TO_HUB":return Fd();default:return v}})(g,i),A=F1(f,y,t);return r.delta=A,{...y,commandLog:[...y.commandLog||[],r],undoStack:[...y.undoStack||[],A],actionLog:[...y.actionLog||[],i]}},Yr={weightsByIntent:{offense:{survival:2.1,lethality:6.5,position:2.4,objective:.5,status:2.5,tempo:1.6,resource:1},defense:{survival:4.8,lethality:3.6,position:3,objective:.8,status:2.2,tempo:1.6,resource:1},positioning:{survival:2.3,lethality:3.8,position:3.1,objective:6,status:1.4,tempo:1.6,resource:1},control:{survival:2.3,lethality:4.2,position:2.8,objective:.6,status:3.4,tempo:1.6,resource:1}},thresholds:{defenseHpRatio:.45,defensePressureHpRatio:.65,defensePressureAdjacentHostiles:2,controlMinHostiles:3}};({...Yr.weightsByIntent,offense:{...Yr.weightsByIntent.offense},control:{...Yr.weightsByIntent.control}},{...Yr.thresholds});const vg={skill:{staticWeight:.5,powerCoeff:1,reachCoeff:1,safetyCoeff:1,tempoCoeff:1,complexityCoeff:1,perSkillScalar:{}},policy:{offenseWeight:1,defenseWeight:1,positioningWeight:1,statusWeight:1,riskPenaltyWeight:1}};({...vg.policy},{...vg.skill});const tA=new Set(["MOVE","THROW_SPEAR","WAIT","USE_SKILL","JUMP","SHIELD_BASH","ATTACK","LEAP","ADVANCE_TURN","SELECT_UPGRADE","RESOLVE_PENDING"]),nA=t=>typeof t=="object"&&t!==null,xg=t=>{if(!Array.isArray(t))return{valid:!1,actions:[],errors:["Replay actions must be an array."]};const i=[],a=[];return t.forEach((o,c)=>{if(!nA(o)||typeof o.type!="string"){a.push(`Action[${c}] is not a valid action object with a "type" field.`);return}if(!tA.has(o.type)){a.push(`Action[${c}] type "${o.type}" is not replayable.`);return}i.push(o)}),{valid:a.length===0,actions:i,errors:a}},Ta=t=>({q:t.q,r:t.r,s:t.s}),Kr=t=>({...t,position:Ta(t.position),previousPosition:t.previousPosition?Ta(t.previousPosition):void 0,intentPosition:t.intentPosition?Ta(t.intentPosition):void 0,statusEffects:t.statusEffects.map(i=>({...i})),activeSkills:t.activeSkills.map(i=>({...i,upgrades:[...i.upgrades||[]],activeUpgrades:[...i.activeUpgrades||[]]})),components:t.components?new Map(t.components):void 0,companionState:t.companionState?{...t.companionState,markTarget:typeof t.companionState.markTarget=="object"&&t.companionState.markTarget?Ta(t.companionState.markTarget):t.companionState.markTarget}:void 0}),iA=t=>({...t,player:Kr(t.player),enemies:t.enemies.map(Kr),companions:t.companions?.map(Kr),dyingEntities:t.dyingEntities?.map(Kr),message:[...t.message],visualEvents:[...t.visualEvents||[]],simulationEvents:[...t.simulationEvents||[]],stackTrace:t.stackTrace?t.stackTrace.map(i=>({...i})):void 0,timelineEvents:t.timelineEvents?t.timelineEvents.map(i=>({...i})):void 0,occupancyMask:[...t.occupancyMask],tiles:new Map(Array.from(t.tiles.entries()).map(([i,a])=>[i,{...a,position:Ta(a.position),traits:new Set(a.traits),effects:a.effects.map(o=>({...o}))}])),traps:t.traps?.map(i=>({...i,position:Ta(i.position)})),lastSpearPath:t.lastSpearPath?.map(Ta),actionLog:t.actionLog?[...t.actionLog]:void 0}),Ag=(t,i)=>t.player.id===i?t.player:t.enemies.find(a=>a.id===i)||t.companions?.find(a=>a.id===i),sA=(t,i)=>{if(i)return Ae(t,i)?.id},aA=(t,i)=>{const a=Ag(t,i.actorId);if(!a)return{ok:!1,reason:`Actor ${i.actorId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const o=Nn.get(i.skillId);if(!o)return{ok:!1,reason:`Skill ${i.skillId} not found`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};if(i.target&&o.getValidTargets&&!o.getValidTargets(t,a.position).some(x=>de(x)===de(i.target)))return{ok:!1,reason:`Target ${de(i.target)} is invalid`,effects:[],messages:[],simulationEvents:[],stackTrace:[]};const c=iA(t),r=Ag(c,i.actorId),f=o.execute(c,r,i.target,i.activeUpgrades||[],i.context||{}),g=c.simulationEvents?.length||0,b=c.stackTrace?.length||0,y=sA(c,i.target),A=xi(c,f.effects,{sourceId:r.id,targetId:y});return{ok:!0,effects:f.effects,messages:f.messages,consumesTurn:f.consumesTurn,predictedState:A,simulationEvents:(A.simulationEvents||[]).slice(g),stackTrace:(A.stackTrace||[]).slice(b)}},oA=t=>({q:t.q,r:t.r,s:t.s}),lA=t=>{const i=[t.player,...t.enemies,...t.companions||[],...t.dyingEntities||[]];return{turn:t.turnNumber||0,stackTick:t.stackTrace?.length||0,actors:i.map(a=>({id:a.id,position:oA(a.position)}))}},rA=(t,i)=>{const a=[],o=new Map(t.actors.map(r=>[r.id,r.position])),c=new Map(i.actors.map(r=>[r.id,r.position]));for(const[r,f]of o.entries()){const g=c.get(r);if(!g){a.push({actorId:r,expected:f,reason:"missing_in_ui"});continue}de(f)!==de(g)&&a.push({actorId:r,expected:f,actual:g,reason:"position_mismatch"})}for(const[r,f]of c.entries())o.has(r)||a.push({actorId:r,actual:f,reason:"missing_in_engine"});return{ok:a.length===0,mismatches:a}},ml={player:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},vanguard:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1},skirmisher:{icon:"",shape:"square",color:"#3b82f6",borderColor:"#fbbf24",isRanged:!1},firemage:{icon:"",shape:"square",color:"#ef4444",borderColor:"#fbbf24",isRanged:!0},necromancer:{icon:"",shape:"square",color:"#6b21a8",borderColor:"#9333ea",isRanged:!0},hunter:{icon:"",shape:"square",color:"#10b981",borderColor:"#ffffff",isRanged:!0},assassin_player:{icon:"",shape:"square",color:"#1f2937",borderColor:"#ffffff",isRanged:!1},footman:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1},sprinter:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1,size:.9},spear:{icon:"",shape:"circle",color:"#ffffff",borderColor:"#3b82f6",isRanged:!1,size:.8,opacity:.9},shieldBearer:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#fbbf24",isRanged:!1,showFacing:!0},golem:{icon:"",shape:"diamond",color:"#78716c",borderColor:"#ffffff",isRanged:!1,size:1.2},assassin:{icon:"",shape:"diamond",color:"#6b21a8",borderColor:"#ffffff",isRanged:!1},archer:{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},bomber:{icon:"",shape:"circle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0},warlock:{icon:"",shape:"triangle",color:"#9333ea",borderColor:"#ffffff",isRanged:!0},bomb:{icon:"",shape:"circle",color:"#1f2937",borderColor:"#000000",isRanged:!1,showTimer:!0},falcon:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},skeleton:{icon:"",shape:"circle",color:"#3b82f6",borderColor:"#ffffff",isRanged:!1,size:.8},sentinel:{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!0,size:1.5}};function Ml(t,i,a,o){if(t&&ml[t])return ml[t];if(i==="player"&&o){const c=o==="ASSASSIN"?"assassin_player":o.toLowerCase();if(ml[c])return ml[c]}return i==="player"?ml.player:a==="ranged"?{icon:"",shape:"triangle",color:"#ef4444",borderColor:"#ffffff",isRanged:!0}:a==="boss"?{icon:"",shape:"diamond",color:"#dc2626",borderColor:"#fbbf24",isRanged:!1,size:1.5}:{icon:"",shape:"diamond",color:"#ef4444",borderColor:"#ffffff",isRanged:!1}}function cA(t){return t.isFlying===!0}const Rd=t=>{const i=[];for(let a=0;a<6;a++){const o=60*a,c=Math.PI/180*o,r=t*Math.cos(c),f=t*Math.sin(c);i.push(`${r},${f}`)}return i.join(" ")},uA=()=>typeof window>"u"?!1:!!window.__HOP_DEBUG_HEX_COORDS,dA=[{cx:-8,cy:-6,r:3,delay:0},{cx:6,cy:2,r:2.5,delay:.3},{cx:-3,cy:8,r:2,delay:.6}],fA=t=>{const i=[[-.6,.42],[-.5,.15],[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2],[.48,.1],[.6,.4],[.4,.48],[-.48,.48]],a=[[-.48,.48],[-.6,.42],[-.34,-.18],[-.18,-.24],[-.28,.28]],o=[[.6,.4],[.4,.48],[.2,.28],[.3,-.2],[.48,.1]],c=[[-.34,-.18],[-.16,-.36],[0,-.62],[.12,-.42],[.3,-.2]],r=[[-.46,.1],[-.3,-.12],[-.1,-.24],[0,-.4]],f=g=>g.map(([b,y])=>`${(b*t).toFixed(2)},${(y*t).toFixed(2)}`).join(" ");return{body:f(i),leftFace:f(a),rightFace:f(o),ridgeA:f(c),ridgeB:f(r)}},mA=({hex:t,onClick:i,isValidMove:a,isTargeted:o,isStairs:c,isLava:r,isShrine:f,isWall:g,isFire:b,onMouseEnter:y,assetHref:A,interactionOnly:v})=>{const[x,E]=M.useState(!1);M.useEffect(()=>{E(!1)},[A]);const{x:m,y:h}=bt(t,ee),R=uA(),k=Rd(ee-2),B=fA(ee-2),_=`hex-clip-${t.q}-${t.r}-${t.s}`;let w=Ur.floor,H="rgba(0,0,0,0.2)",j="default";g?(w=Ur.wall,H="#1f2937"):r?(w="#7f1d1d",H="#7f1d1d"):b?(w="#7c2d12",H="#ea580c"):c?(w=Ur.portal,H="#000000"):f&&(w=Ur.shrine,H="#c2410c"),v&&(w="transparent",H="rgba(255,255,255,0.10)"),a&&(H="#ffffff",j="pointer"),o&&(H="#ff0000");const L=!!A&&!v&&!x;return p.jsxs("g",{transform:`translate(${m},${h})`,onClick:()=>i(t),onMouseEnter:()=>y?.(t),style:{cursor:j},className:"hex-tile transition-colors duration-200",children:[g&&L&&p.jsx("polygon",{points:Rd(ee-2),fill:"#111827",transform:"translate(0, 4)"}),!L&&(g?p.jsxs("g",{"data-wall-fallback":"relief",children:[p.jsx("ellipse",{cx:"0",cy:ee*.56,rx:ee*.56,ry:ee*.18,fill:"rgba(3,7,18,0.55)"}),p.jsx("polygon",{points:k,fill:"#0f172a",transform:"translate(0, 5)",opacity:"0.92"}),p.jsx("polygon",{points:k,fill:"#1f2937",transform:"translate(0, 2)",opacity:"0.98"}),p.jsx("polygon",{points:k,fill:"#273447"}),p.jsx("polygon",{points:B.body,fill:"#4b5563",opacity:"0.96"}),p.jsx("polygon",{points:B.leftFace,fill:"#6b7280",opacity:"0.9"}),p.jsx("polygon",{points:B.rightFace,fill:"#374151",opacity:"0.95"}),p.jsx("polyline",{points:B.ridgeA,fill:"none",stroke:"rgba(229,231,235,0.55)",strokeWidth:"1.1",strokeLinecap:"round",strokeLinejoin:"round"}),p.jsx("polyline",{points:B.ridgeB,fill:"none",stroke:"rgba(17,24,39,0.58)",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round"}),p.jsx("polygon",{points:k,fill:"none",stroke:H,strokeWidth:o||a?"3":"1"})]}):p.jsx("polygon",{points:k,fill:w,stroke:H,strokeWidth:o||a?"3":"1"})),L&&p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsx("clipPath",{id:_,children:p.jsx("polygon",{points:k})})}),p.jsx("image",{href:A,x:-ee,y:-31.176,width:ee*2,height:ee*1.732,preserveAspectRatio:"xMidYMid slice",clipPath:`url(#${_})`,onError:()=>E(!0)}),p.jsx("polygon",{points:k,fill:"none",stroke:H,strokeWidth:o||a?"3":"1"})]}),r&&!v&&p.jsxs("g",{className:"lava-bubbles",children:[dA.map((W,Z)=>p.jsx("circle",{cx:W.cx,cy:W.cy,r:W.r,fill:"#fbbf24",opacity:"0.7",style:{animation:`lavaBubble 2s ease-in-out ${W.delay}s infinite`}},Z)),p.jsx("polygon",{points:Rd(ee-4),fill:"none",stroke:"#f97316",strokeWidth:"1",opacity:"0.35"})]}),b&&!v&&p.jsxs("g",{className:"fire-embers",children:[p.jsx("circle",{cx:"-6",cy:"4",r:"2",fill:"#fbbf24",opacity:"0.75",style:{animation:"lavaBubble 1.6s ease-in-out 0s infinite"}}),p.jsx("circle",{cx:"4",cy:"-6",r:"1.5",fill:"#fcd34d",opacity:"0.75",style:{animation:"lavaBubble 1.4s ease-in-out 0.5s infinite"}})]}),R&&p.jsx("text",{x:"0",y:"0",textAnchor:"middle",fill:"rgba(0,0,0,0.15)",fontSize:"8",dy:".3em",pointerEvents:"none",children:`${t.q},${t.r}`})]})},pA=Bi.memo(mA,(t,i)=>t.hex.q===i.hex.q&&t.hex.r===i.hex.r&&t.hex.s===i.hex.s&&t.onClick===i.onClick&&t.onMouseEnter===i.onMouseEnter&&t.isCenter===i.isCenter&&t.isSelected===i.isSelected&&t.isValidMove===i.isValidMove&&t.isTargeted===i.isTargeted&&t.isStairs===i.isStairs&&t.isLava===i.isLava&&t.isShrine===i.isShrine&&t.isWall===i.isWall&&t.isFire===i.isFire&&t.assetHref===i.assetHref&&t.interactionOnly===i.interactionOnly),hA={catacombs:.2,inferno:.16,throne:.24,frozen:.45,void:.08},gA=(t,i)=>{const a=Math.max(t,i),o=Math.min(t,i);return(a+.05)/(o+.05)},Tg=(t,i)=>{const a=[];for(let o=0;o<6;o++){const c=Math.PI/3*o;a.push(`${Math.cos(c)*t},${Math.sin(c)*i}`)}return a.join(" ")},yA=(t,i,a=24,o,c,r=1)=>{const f=Ml(t.subtype,t.type,t.enemyType,t.archetype),{icon:g,shape:b,color:y,borderColor:A,size:v=1}=f,x=a*v,E=t.statusEffects?.find(k=>k.type==="time_bomb"),m=E?Math.max(0,E.duration):t.actionCooldown??0,h=`contrast(${r.toFixed(2)}) brightness(${(r>1?1.12:1.04).toFixed(2)})`,R=i?`drop-shadow(0 3px 4px rgba(0,0,0,0.45)) drop-shadow(0 0 2px rgba(255,255,255,0.5)) saturate(1.08) ${h}`:`drop-shadow(0 3px 4px rgba(0,0,0,0.50)) drop-shadow(0 0 2px rgba(255,255,255,0.35)) saturate(1.0) ${h}`;return p.jsxs("g",{children:[p.jsx("title",{children:i?"Player":`${t.subtype||"Enemy"}`}),o&&p.jsx("image",{href:o,x:-x,y:-x,width:x*2,height:x*2,preserveAspectRatio:"xMidYMid meet",onError:c,style:{filter:R,opacity:i?1:.97}}),!o&&b==="square"&&p.jsx("rect",{x:-x*.8,y:-x*.8,width:x*1.6,height:x*1.6,fill:y,stroke:A,strokeWidth:2}),!o&&b==="diamond"&&p.jsx("path",{d:`M0 ${-x*.8} L${x*.6} 0 L0 ${x*.8} L${-x*.6} 0 Z`,fill:y,stroke:A,strokeWidth:1}),!o&&b==="triangle"&&p.jsx("path",{d:`M0 ${-x*.8} L${x*.7} ${x*.5} L${-x*.7} ${x*.5} Z`,fill:y,stroke:A,strokeWidth:1}),!o&&b==="circle"&&p.jsx("circle",{r:x*.7,fill:y,stroke:A,strokeWidth:1}),t.subtype==="bomb"&&p.jsx("text",{y:x*.2,textAnchor:"middle",fill:"#fff",fontSize:"10",fontWeight:"bold",children:m}),!o&&!i&&t.subtype!=="bomb"&&p.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:x*.8,opacity:.8,children:g}),!o&&i&&p.jsx("path",{d:`M0 ${-x*.4} L0 ${x*.4} M${-x*.15} ${-x*.2} L0 ${-x*.5} L${x*.15} ${-x*.2}`,stroke:A,strokeWidth:2,fill:"none"})]})},bA=({entity:t,isSpear:i,isDying:a,movementTrace:o,waapiControlled:c=!1,assetHref:r,fallbackAssetHref:f,floorTheme:g})=>{const[b,y]=M.useState(t.position),[A,v]=M.useState(()=>bt(t.position,ee)),[x,E]=M.useState(t.previousPosition),[m,h]=M.useState(220),[R,k]=M.useState("cubic-bezier(0.22, 1, 0.36, 1)"),[B,_]=M.useState("none"),w=M.useRef(!1),H=M.useRef(t.position),j=M.useRef([]),L=M.useRef(null),[W,Z]=M.useState(!1),Te=M.useRef(t.hp),oe=t.type==="player",Be=t.intentPosition?bt(t.intentPosition,ee):null,ne=typeof window<"u"&&!!window.__HOP_DEBUG_MOVEMENT,[xe,ve]=M.useState(r||f),[V,ie]=M.useState(!1);M.useEffect(()=>{ve(r||f),ie(!1)},[r,f,t.id]);const re=()=>{if(!V&&f&&xe!==f){ve(f),ie(!0);return}ve(void 0)};M.useEffect(()=>{const Fe=()=>{for(const mt of j.current)clearTimeout(mt);j.current=[],L.current!==null&&(cancelAnimationFrame(L.current),L.current=null)};if(c){Fe(),w.current=!1;const mt=!!(o&&o.actorId===t.id&&o.destination&&J(o.destination,t.position)),jt=!J(t.position,H.current);H.current=t.position,jt&&!mt&&(y(t.position),E(t.previousPosition),v(bt(t.position,ee))),B!=="none"&&_("none"),m!==0&&h(0),R!=="linear"&&k("linear");return}if(!J(t.position,H.current)){H.current=t.position;const mt=o&&o.actorId===t.id&&o.destination&&J(o.destination,t.position)&&Array.isArray(o.path)&&o.path.length>0,jt=mt?o.path:void 0,bn=mt?o.movementType:void 0,rn=mt?Math.max(0,o.startDelayMs??0):0;if(ne){const At=t.previousPosition?kt(t.previousPosition,t.position).length:0;console.log("[HOP_MOVE]",{actorId:t.id,movementType:bn||"fallback",usedEngineTrace:mt,tracePathLength:jt?.length||0,tracePath:jt||[],startDelayMs:rn,fallbackPathLength:At,origin:o?.origin||t.previousPosition,destination:t.position})}if(bn==="teleport"&&mt&&o.origin){Fe(),w.current=!0;const At=o.durationMs??180,$e=Math.max(80,Math.floor(At/2)),Yt=()=>{h(0),k("linear"),E(o.origin),y(o.origin),v(bt(o.origin,ee)),_("out");const Je=window.setTimeout(()=>{y(t.position),E(t.position),v(bt(t.position,ee)),_("in")},$e),et=window.setTimeout(()=>{_("none"),w.current=!1},$e*2);j.current.push(Je,et)};if(rn>0){const Je=window.setTimeout(Yt,rn);j.current.push(Je)}else Yt();return()=>{Fe(),w.current=!1}}const Sn=!!(t.previousPosition&&!J(t.position,t.previousPosition));if(!!(jt&&jt.length>1)||Sn){let $e=jt||(t.previousPosition?kt(t.previousPosition,t.position):[]);if(mt&&o?.origin&&$e.length>1&&J($e[$e.length-1],o.origin)&&!J($e[0],o.origin)&&($e=[...$e].reverse()),$e.length>1){Fe(),w.current=!0;const Yt=Math.max(1,$e.length-1),Je=o?.durationMs?o.durationMs/Yt:0,et=Math.max(90,Math.min(130,Je||112)),Tt=et*Yt,cn=$e.map(pt=>bt(pt,ee)),Hn=performance.now(),Jn=pt=>pt<.5?4*pt*pt*pt:1-Math.pow(-2*pt+2,3)/2;_("none"),h(0),k("linear"),y($e[0]),E($e[0]),v(cn[0]);let Mn=-1;const un=pt=>{const Dt=Math.max(0,pt-Hn),Xt=Math.min(Yt-1,Math.floor(Dt/et)),Rn=Xt*et,Di=Dt-Rn,ci=Math.max(0,Math.min(1,Di/et)),vn=Jn(ci);Xt!==Mn&&(E($e[Xt]),y($e[Math.min($e.length-1,Xt+1)]),Mn=Xt);const Kt=cn[Xt],Pn=cn[Math.min(cn.length-1,Xt+1)];if(v({x:Kt.x+(Pn.x-Kt.x)*vn,y:Kt.y+(Pn.y-Kt.y)*vn}),Dt<Tt){L.current=requestAnimationFrame(un);return}w.current=!1,y(t.position),E(t.previousPosition),v(cn[cn.length-1]),L.current=null};if(rn>0){const pt=window.setTimeout(()=>{L.current=requestAnimationFrame(un)},rn);j.current.push(pt)}else L.current=requestAnimationFrame(un);return()=>{Fe(),w.current=!1}}}_("none"),h(220),k("cubic-bezier(0.22, 1, 0.36, 1)"),y(t.position),E(t.previousPosition),v(bt(t.position,ee))}},[t.position,t.previousPosition,o,t.id,c]);const{x:Re,y:ge}=A||bt(b,ee);M.useEffect(()=>{if(t.hp<Te.current){Z(!0);const Fe=setTimeout(()=>Z(!1),150);return()=>clearTimeout(Fe)}Te.current=t.hp},[t.hp]);let O="";const Y=x;if(Y&&!J(b,Y)){const Fe=Fs(Y,b);if(Fe!==-1){const mt=Fe*60;O=`rotate(${mt}) scale(1.15, 0.85) rotate(${-mt})`}}const te=t.isVisible===!1;if(i){const Fe=Ml("spear","enemy");return p.jsx("g",{style:{pointerEvents:"none"},children:p.jsx("g",{transform:`translate(${Re},${ge})`,children:p.jsx("text",{x:"0",y:"0",textAnchor:"middle",dy:".3em",fontSize:"20",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.5))"},children:Fe.icon})})})}const ue=Ml(t.subtype,t.type,t.enemyType,t.archetype),Oe=cA(t),Ce=oe?1.34:.92,Ne=oe?-9:-2,ft=oe?24:18,qe=String(g||"").toLowerCase(),Lt=hA[qe]??.22,Ue=gA(Lt,oe?.87:.82),Ot=Ue<4.5?1.22:1.06,Bt=Ue<4.5?.62:.42,rt=oe?"#22e7ff":"#ff4fd0",Vt=oe?"rgba(34,231,255,0.22)":"rgba(255,79,208,0.22)",ln=oe?"rgba(34,231,255,0.48)":"rgba(255,79,208,0.46)",Ve=oe?ee*.5:ee*.46,it=oe?ee*.2:ee*.18,yn=M.useMemo(()=>Tg(Ve,it),[Ve,it]),Ti=M.useMemo(()=>Tg(Ve*.86,it*.84),[Ve,it]),Qn=oe?ee*.32:ee*.3,Dn=oe?"rgba(190,250,255,0.86)":"rgba(255,201,241,0.86)";return p.jsxs("g",{style:{pointerEvents:"none"},children:[Be&&!oe&&!ji(t)&&p.jsx("line",{x1:Re,y1:ge,x2:Be.x,y2:Be.y,stroke:t.subtype==="warlock"?"#9333ea":"#ef4444",strokeWidth:"3",strokeDasharray:"4 2",opacity:"0.6"}),p.jsx("g",{"data-actor-node":t.id,style:{transition:c?"none":`transform ${m}ms ${R}`,transform:`translate(${Re}px, ${ge}px)`},className:a?"animate-lava-sink":"",children:p.jsxs("g",{transform:O,className:`${W?"entity-damaged":""} ${!a&&!ji(t)?"animate-idle":""} ${B==="out"?"entity-teleport-out":""} ${B==="in"?"entity-teleport-in":""}`,opacity:te?.3:ue.opacity||1,style:{filter:te?"blur(1px)":"none"},children:[p.jsx("circle",{r:oe?ee*.92:ee*.84,cy:Qn-2,fill:oe?"rgba(6,15,23,0.84)":"rgba(22,7,18,0.84)",opacity:Bt}),p.jsxs("g",{transform:`translate(0,${Qn})`,children:[p.jsx("polygon",{points:yn,fill:Vt,stroke:rt,strokeWidth:2,style:{filter:`drop-shadow(0 0 5px ${ln})`}}),p.jsx("polygon",{points:Ti,fill:"none",stroke:rt,strokeWidth:1.4,opacity:.82})]}),Oe&&p.jsx("ellipse",{cx:0,cy:ee*.3,rx:ee*.4,ry:ee*.15,fill:"black",opacity:.2}),p.jsxs("g",{transform:`translate(0,${Ne}) scale(${Ce})`,children:[p.jsx("circle",{r:Math.max(10,ft*.84),fill:"none",stroke:Dn,strokeWidth:2,opacity:.68,style:{filter:"drop-shadow(0 0 3px rgba(255,255,255,0.45))"}}),yA(t,oe,ft,xe,re,Ot)]}),ji(t)&&p.jsxs("g",{transform:`translate(0, -${ee*.8})`,className:"stun-icon",children:[p.jsx("text",{fontSize:"14",textAnchor:"middle",children:"*"}),p.jsx("text",{fontSize:"8",textAnchor:"middle",dy:"-3",dx:"6",children:"+"})]}),ue.showFacing&&t.facing!==void 0&&!ji(t)&&p.jsx("line",{x1:0,y1:0,x2:Math.cos((t.facing*60-90)*Math.PI/180)*ee*.5,y2:Math.sin((t.facing*60-90)*Math.PI/180)*ee*.5,stroke:ue.borderColor,strokeWidth:3,strokeLinecap:"round"}),!oe&&t.intent&&!ji(t)&&p.jsx("text",{x:0,y:-ee*.6,textAnchor:"middle",fontSize:8,fill:"#ef4444",fontWeight:"bold",children:t.intent}),p.jsx("title",{children:`${t.subtype||t.type} - HP ${t.hp}/${t.maxHp}${t.intent?` - ${t.intent}`:""}`})]})})]})},Eg=t=>{if(!t)return"";const i=(t.path||[]).map(a=>`${a.q},${a.r},${a.s}`).join(";");return`${t.actorId}|${t.movementType||""}|${t.destination?.q??""},${t.destination?.r??""},${t.destination?.s??""}|${i}|${t.durationMs??""}|${t.startDelayMs??0}|${t.wasLethal?1:0}`},_g=(t=[])=>t.map(i=>`${i.id}:${i.duration??""}:${i.stacks??""}`).join("|"),Fr=Bi.memo(bA,(t,i)=>{const a=t.entity,o=i.entity;return t.isSpear===i.isSpear&&t.isDying===i.isDying&&t.waapiControlled===i.waapiControlled&&t.assetHref===i.assetHref&&t.fallbackAssetHref===i.fallbackAssetHref&&t.floorTheme===i.floorTheme&&Eg(t.movementTrace)===Eg(i.movementTrace)&&a.id===o.id&&a.hp===o.hp&&a.maxHp===o.maxHp&&a.facing===o.facing&&a.intent===o.intent&&a.isVisible===o.isVisible&&a.position.q===o.position.q&&a.position.r===o.position.r&&a.position.s===o.position.s&&(a.previousPosition?.q??0)===(o.previousPosition?.q??0)&&(a.previousPosition?.r??0)===(o.previousPosition?.r??0)&&(a.previousPosition?.s??0)===(o.previousPosition?.s??0)&&(a.intentPosition?.q??0)===(o.intentPosition?.q??0)&&(a.intentPosition?.r??0)===(o.intentPosition?.r??0)&&(a.intentPosition?.s??0)===(o.intentPosition?.s??0)&&_g(a.statusEffects)===_g(o.statusEffects)}),SA=({gameState:t,selectedSkillId:i,showMovementRange:a,hoveredTile:o,enginePreviewGhost:c})=>{const r=t.player.position,f=M.useMemo(()=>{const x=new Set;for(const E of t.enemies)E.hp>0&&x.add(de(E.position));return x},[t.enemies]),g=M.useMemo(()=>{if(!a||i)return[];const x=new Set(t.player.activeSkills.map(R=>R.id)),E=["BASIC_MOVE","DASH"],m=new Set,h=[];return E.forEach(R=>{if(x.has(R)){const k=Nn.get(R);k?.getValidTargets&&k.getValidTargets(t,r).forEach(_=>{const w=de(_);m.has(w)||(m.add(w),h.push(_))})}}),h.length===0?[{q:r.q+1,r:r.r,s:r.s-1},{q:r.q+1,r:r.r-1,s:r.s},{q:r.q,r:r.r-1,s:r.s+1},{q:r.q-1,r:r.r,s:r.s+1},{q:r.q-1,r:r.r+1,s:r.s},{q:r.q,r:r.r+1,s:r.s-1}].filter(k=>Ws(k,t.gridWidth,t.gridHeight)):h},[t,a,i,r]),b=M.useMemo(()=>{const x=new Set;for(const E of g)x.add(de(E));return x},[g]),y=M.useMemo(()=>{if(!i)return[];const x=Nn.get(i),E=x?.baseVariables?.range??v1(t.player,i),m=x?.getValidTargets?x.getValidTargets(t,r):[],h=new Set(m.map(de)),R=[];if(i==="DASH"||i==="SPEAR_THROW"||i==="SHIELD_THROW"||i==="GRAPPLE_HOOK")for(let B=0;B<6;B++)for(let _=1;_<=E;_++){const w=jn(r,Jd(B,_));if(!Ws(w,t.gridWidth,t.gridHeight))break;const H=Pe.isLosBlocking(t,w),j=f.has(de(w)),Z=kt(r,w).slice(1,-1).some(oe=>Pe.isLosBlocking(t,oe)||f.has(de(oe))),Te=h.has(de(w));if(R.push({p:w,isValidTarget:Te,isBlocked:Z,isWall:H,isEnemy:j}),H||j)break}else m.forEach(B=>{const _=Pe.isLosBlocking(t,B),w=f.has(de(B));R.push({p:B,isValidTarget:!0,isBlocked:!1,isWall:_,isEnemy:w})});return R},[t,i,r,f]),A=M.useMemo(()=>{const x=new Map;for(const E of y)x.set(de(E.p),E);return x},[y]),v=M.useMemo(()=>{if(c)return c;if(a&&o&&!i&&b.has(de(o)))return{path:kt(r,o),aoe:[],hasEnemy:!1,target:o};if(!i||!o)return null;const x=A.get(de(o));if(!x||!x.isValidTarget||x.isBlocked)return null;const E=kt(r,o),m=Qb(t,i,r,o),h=x.isEnemy;return{path:E,aoe:m,hasEnemy:h,target:o}},[c,t,i,o,A,b,a,r]);return p.jsxs("g",{pointerEvents:"none",children:[g.map(x=>{const{x:E,y:m}=bt(x,ee);return p.jsx("circle",{cx:E,cy:m,r:ee*.55,fill:"rgba(99, 102, 241, 0.15)",className:"animate-soft-pulse"},`mv-${x.q}-${x.r}`)}),y.map(x=>{const{p:E,isValidTarget:m,isBlocked:h}=x,{x:R,y:k}=bt(E,ee);return p.jsxs("g",{children:[p.jsx("circle",{cx:R,cy:k,r:ee*.45,fill:h?"rgba(255,255,255,0.01)":"rgba(255,255,255,0.04)"}),m&&!h&&p.jsx("circle",{cx:R,cy:k,r:ee*.55,fill:"none",stroke:"rgba(239, 68, 68, 0.4)",strokeWidth:1.5}),m&&h&&p.jsx("circle",{cx:R,cy:k,r:ee*.55,fill:"none",stroke:"rgba(255,255,255,0.1)",strokeDasharray:"4 2",strokeWidth:1})]},`sk-${E.q}-${E.r}`)}),v&&p.jsxs("g",{children:[(()=>{const x=v.path.map(B=>bt(B,ee)),E=x.map((B,_)=>`${_===0?"M":"L"} ${B.x} ${B.y}`).join(" "),m=x[x.length-1],h=x[x.length-2]||{x:m.x-1,y:m.y},R=Math.atan2(m.y-h.y,m.x-h.x),k=8;return p.jsxs("g",{children:[p.jsx("path",{d:E,stroke:"white",strokeWidth:"2",fill:"none",strokeDasharray:"6 3",className:"animate-intent-dash",opacity:"0.6"}),p.jsx("path",{d:`M ${m.x} ${m.y} L ${m.x-k*Math.cos(R-Math.PI/6)} ${m.y-k*Math.sin(R-Math.PI/6)} M ${m.x} ${m.y} L ${m.x-k*Math.cos(R+Math.PI/6)} ${m.y-k*Math.sin(R+Math.PI/6)}`,stroke:"white",strokeWidth:"2",opacity:"0.8"})]})})(),v.hasEnemy&&(()=>{const{x,y:E}=bt(v.target,ee),m=ee*.7;return p.jsxs("g",{children:[p.jsx("circle",{cx:x,cy:E,r:m,fill:"none",stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4 2"}),p.jsx("line",{x1:x-m,y1:E,x2:x+m,y2:E,stroke:"#ef4444",strokeWidth:"1"}),p.jsx("line",{x1:x,y1:E-m,x2:x,y2:E+m,stroke:"#ef4444",strokeWidth:"1"})]})})(),Array.from(new Map(v.aoe.map(x=>[de(x),x])).values()).map(x=>{const{x:E,y:m}=bt(x,ee);return p.jsx("circle",{cx:E,cy:m,r:ee*.6,fill:"rgba(239, 68, 68, 0.2)",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:2,strokeDasharray:"4 2"},`aoe-${x.q}-${x.r}`)})]})]})},vA=["white","blue","black","red","green"],wg={white:{label:"Plains / Mesa",floorAssetId:"tile.catacombs.floor.01",hazardAssetId:"tile.catacombs.lava.01"},blue:{label:"Islands / Coast",floorAssetId:"tile.frozen.floor.01",hazardAssetId:"tile.catacombs.lava.01"},black:{label:"Swamp / Wastes",floorAssetId:"tile.void.floor.01",hazardAssetId:"tile.catacombs.lava.01"},red:{label:"Mountains / Volcanic",floorAssetId:"tile.inferno.floor.01",hazardAssetId:"tile.inferno.lava.01"},green:{label:"Forest / Jungle",floorAssetId:"tile.throne.floor.01",hazardAssetId:"tile.catacombs.lava.01"}},xA={catacombs:"white",frozen:"blue",void:"black",inferno:"red",throne:"green"},AA=t=>{if(typeof t!="string")return;const i=t.toLowerCase();return vA.includes(i)?i:void 0},TA=()=>{if(!(typeof window>"u"))return AA(window.__HOP_FORCE_BIOME)},EA=t=>{const i=TA();if(i)return i;const a=String(t||"").toLowerCase();return xA[a]||"white"},_A=t=>{const i=EA(t.theme);return t.isWall?"tile.catacombs.wall.01":t.isLava?wg[i].hazardAssetId:t.isFire?"tile.catacombs.fire.01":wg[i].floorAssetId},Mg=t=>{if(t.isStairs)return"prop.core.stairs.01";if(t.isShrine)return"prop.core.shrine.01"},ic=t=>{if(t.type==="player")switch(t.archetype){case"FIREMAGE":return"unit.player.firemage.04";case"SKIRMISHER":return"unit.player.skirmisher.01";case"HUNTER":return"unit.player.hunter.01";case"NECROMANCER":return"unit.player.necromancer.01";case"ASSASSIN":return"unit.player.assassin.01";default:return"unit.player.vanguard.01"}switch(t.subtype){case"footman":return"unit.enemy.footman.01";case"shield_bearer":return"unit.enemy.shield_bearer.01";case"archer":return"unit.enemy.archer.01";case"warlock":return"unit.enemy.warlock.01";case"bomber":return"unit.enemy.bomber.01";case"bomb":return"unit.enemy.bomb.01";default:return t.enemyType==="boss"?"unit.enemy.boss.01":"unit.enemy.footman.01"}},Og="/Hop",Cg=(t,i)=>`${t.endsWith("/")?t:`${t}/`}${i.replace(/^\/+/,"")}`,wA=t=>/^(?:[a-z]+:)?\/\//i.test(t)||t.startsWith("data:")?t:t.startsWith("/")?t.startsWith("/assets/")?Cg(Og,t.slice(1)):t:Cg(Og,t),MA={"unit.player.vanguard.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.firemage.04":"/assets/units/unit.player.firemage.02.svg","unit.player.skirmisher.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.hunter.01":"/assets/units/unit.player.skirmisher.01.svg","unit.player.necromancer.01":"/assets/units/unit.player.vanguard.01.svg","unit.player.assassin.01":"/assets/units/unit.player.skirmisher.01.svg","unit.enemy.footman.01":"/assets/units/unit.enemy.footman.01.svg","unit.enemy.shield_bearer.01":"/assets/units/unit.enemy.shield_bearer.01.svg","unit.enemy.archer.01":"/assets/units/unit.enemy.archer.01.svg","unit.enemy.warlock.01":"/assets/units/unit.enemy.warlock.01.svg","unit.enemy.bomber.01":"/assets/units/unit.enemy.bomber.01.svg","unit.enemy.bomb.01":"/assets/units/unit.enemy.bomb.01.svg","unit.enemy.boss.01":"/assets/units/unit.enemy.boss.01.svg"},kd=t=>{const i=ic(t),a=MA[i];return a?wA(a):void 0},OA=t=>{if(t==="impact")return"fx.core.impact.01";if(t==="vaporize")return"fx.core.vaporize.01";if(t==="lava_ripple")return"fx.core.lava_ripple.01";if(t==="explosion_ring")return"fx.core.explosion_ring.01"},CA=()=>"ui.core.hp_frame.01",NA=()=>"decal.combat.blood.01",RA=t=>new Promise(i=>setTimeout(i,t)),kA=t=>{if(!t)return null;const i=t.position||t.destination||t.origin||t.target;return i&&typeof i.q=="number"&&typeof i.r=="number"&&typeof i.s=="number"?i:null},Ng=t=>t==="impact"?400:t==="combat_text"?1e3:t==="flash"?300:t==="spear_trail"?500:t==="vaporize"?600:t==="lava_ripple"?800:t==="explosion_ring"?1e3:2e3,LA=({visualEvents:t,timelineEvents:i=[],onBusyStateChange:a,assetManifest:o})=>{const[c,r]=M.useState([]),f=M.useRef(0),g=M.useRef(0),b=M.useRef([]),y=M.useRef(!1),[A,v]=M.useState(!1),x=M.useRef(!1),E=M.useRef(new Map),m=M.useRef(null),h=900,R=5e3,k=M.useMemo(()=>{const _=new Map;for(const w of o?.assets||[])_.set(w.id,w);return _},[o]);M.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const _=window.matchMedia("(prefers-reduced-motion: reduce)"),w=()=>{x.current=_.matches};return w(),_.addEventListener?.("change",w),()=>_.removeEventListener?.("change",w)},[]),M.useEffect(()=>{if(!t.length)return;const _=new Map(E.current),w=Date.now();for(const H of t){if(H.type!=="kinetic_trace")continue;const j=H.payload;if(!j?.actorId)continue;const L=Number(j.durationMs??0);L>0&&_.set(String(j.actorId),{durationMs:L,seenAt:w})}E.current=_},[t]),M.useEffect(()=>{a?.(A)},[A,a]);const B=_=>{const w=Date.now(),H=kA(_.payload);if(!H)return;const j=[],L=`${_.id}:${w}`;_.phase==="HAZARD_CHECK"?j.push({id:`${L}:haz`,type:"combat_text",position:H,payload:{text:"!"},startTime:w}):_.phase==="DAMAGE_APPLY"?j.push({id:`${L}:impact`,type:"impact",position:H,startTime:w}):_.phase==="DEATH_RESOLVE"&&j.push({id:`${L}:vapor`,type:"vaporize",position:H,startTime:w}),j.length>0&&r(W=>[...W,...j])};return M.useEffect(()=>{if(!i.length)return;i.length<f.current&&(f.current=0);const _=i.slice(f.current);_.length&&(f.current=i.length,b.current.push(..._),!y.current&&(y.current=!0,v(!0),(async()=>{try{const w=Date.now();for(;b.current.length>0;){if(Date.now()-w>R){console.warn("[HOP_JUICE] Timeline queue exceeded runtime budget; flushing remaining events.",{queued:b.current.length});break}const H=b.current.shift();B(H);let j=H.blocking?H.suggestedDurationMs??140:0;if(H.phase==="MOVE_END"){const Te=H.payload?.targetActorId;if(Te){const oe=E.current.get(Te),Be=oe?Date.now()-oe.seenAt<=2500:!1;oe&&Be&&oe.durationMs>0&&(j=Math.max(j,Math.min(h,oe.durationMs)))}}let L=0;H.phase==="MOVE_END"?L=Math.min(700,Math.max(120,j)):H.phase==="DEATH_RESOLVE"?L=Math.min(160,Math.max(90,j)):H.phase==="DAMAGE_APPLY"?L=Math.min(110,Math.max(60,j)):H.phase==="HAZARD_CHECK"?L=Math.min(100,Math.max(50,j)):H.blocking&&(L=Math.min(90,Math.max(0,j)));const W=H.phase==="MOVE_END"?j:x.current?Math.min(70,Math.floor(L*.5)):L,Z=Math.max(0,Math.min(h,W));Z>0&&await RA(Z)}}catch(w){console.error("[HOP_JUICE] Timeline queue processing failed; releasing busy lock.",w)}finally{b.current=[],y.current=!1,v(!1)}})()))},[i]),M.useEffect(()=>{if(i.length>0){g.current=t.length;return}t.length<g.current&&(g.current=0);const _=g.current;if(_>=t.length)return;const w=t.slice(_);g.current=t.length;const H=[],j=Date.now();w.forEach((L,W)=>{const Z=`juice-${j}-${_+W}`;L.type==="vfx"&&L.payload?.type==="impact"?L.payload.position&&H.push({id:Z,type:"impact",position:L.payload.position,startTime:j}):L.type==="vfx"&&L.payload?.type==="flash"?L.payload.position&&H.push({id:Z,type:"flash",position:L.payload.position,startTime:j}):L.type==="vfx"&&L.payload?.type==="spear_trail"?L.payload.path&&L.payload.path.length>0&&H.push({id:Z,type:"spear_trail",position:L.payload.path[0],payload:L.payload,startTime:j}):L.type==="vfx"&&L.payload?.type==="vaporize"?L.payload.position&&H.push({id:Z,type:"vaporize",position:L.payload.position,startTime:j}):L.type==="vfx"&&L.payload?.type==="lava_ripple"?L.payload.position&&H.push({id:Z,type:"lava_ripple",position:L.payload.position,startTime:j}):L.type==="vfx"&&L.payload?.type==="explosion_ring"&&L.payload.position&&H.push({id:Z,type:"explosion_ring",position:L.payload.position,startTime:j})}),H.length>0&&r(L=>[...L,...H])},[t,i.length]),M.useEffect(()=>{if(m.current!==null&&(window.clearTimeout(m.current),m.current=null),c.length===0)return;const _=Date.now();let w=1/0;for(const j of c){const L=_-j.startTime,W=Ng(j.type)-L;W>0&&W<w&&(w=W)}if(!Number.isFinite(w)){r([]);return}const H=Math.max(16,Math.min(180,Math.floor(w)));return m.current=window.setTimeout(()=>{const j=Date.now();r(L=>{const W=L.filter(Z=>j-Z.startTime<Ng(Z.type));return W.length===L.length?L:W})},H),()=>{m.current!==null&&(window.clearTimeout(m.current),m.current=null)}},[c]),p.jsx("g",{style:{pointerEvents:"none"},children:c.map(_=>{if(!_.position)return null;const{x:w,y:H}=bt(_.position,ee),j=OA(_.type),L=j?k.get(j)?.path:void 0,W=k.get(CA())?.path;if(_.type==="impact")return L?p.jsx("image",{href:L,x:w-ee*.75,y:H-ee*.75,width:ee*1.5,height:ee*1.5,preserveAspectRatio:"xMidYMid meet",className:"animate-impact",opacity:"0.9"},_.id):p.jsx("circle",{cx:w,cy:H,r:ee*.5,fill:"none",stroke:"#ffffff",strokeWidth:"2",className:"animate-impact"},_.id);if(_.type==="combat_text"){const Z=_.payload.text.startsWith("-")?"#fb7185":"#86efac";return p.jsxs("g",{transform:`translate(${w}, ${H-10})`,children:[W&&p.jsx("image",{href:W,x:-46,y:-24,width:92,height:24,preserveAspectRatio:"xMidYMid meet",opacity:"0.78"}),p.jsx("text",{textAnchor:"middle",fill:Z,fontSize:"16",fontWeight:"black",className:"animate-float-up",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.8))",paintOrder:"stroke",stroke:"#000",strokeWidth:"4px"},children:_.payload.text})]},_.id)}if(_.type==="flash")return p.jsx("circle",{cx:w,cy:H,r:ee*2,fill:"#ffffff",className:"animate-flash"},_.id);if(_.type==="spear_trail"){const Te=_.payload.path.map(oe=>{const Be=bt(oe,ee);return`${Be.x},${Be.y}`}).join(" ");return p.jsx("polyline",{points:Te,fill:"none",stroke:"#ffffff",strokeWidth:"4",strokeLinecap:"round",className:"animate-spear-trail"},_.id)}return _.type==="vaporize"?L?p.jsx("image",{href:L,x:w-ee*.95,y:H-ee*.95,width:ee*1.9,height:ee*1.9,preserveAspectRatio:"xMidYMid meet",className:"animate-vaporize",opacity:"0.9"},_.id):p.jsxs("g",{children:[p.jsx("circle",{cx:w,cy:H,r:ee*.6,fill:"#f97316",className:"animate-vaporize",opacity:"0.8"}),p.jsx("circle",{cx:w,cy:H,r:ee*1.2,fill:"none",stroke:"#f97316",strokeWidth:"2",className:"animate-ping"})]},_.id):_.type==="lava_ripple"?L?p.jsx("image",{href:L,x:w-ee,y:H-ee,width:ee*2,height:ee*2,preserveAspectRatio:"xMidYMid meet",className:"animate-ping",opacity:"0.85"},_.id):p.jsx("circle",{cx:w,cy:H,r:ee*.8,fill:"none",stroke:"#ea580c",strokeWidth:"3",className:"animate-ping"},_.id):_.type==="explosion_ring"?L?p.jsx("image",{href:L,x:w-ee*1.35,y:H-ee*1.35,width:ee*2.7,height:ee*2.7,preserveAspectRatio:"xMidYMid meet",className:"animate-explosion-ring",opacity:"0.88"},_.id):p.jsx("circle",{cx:w,cy:H,r:ee*2.5,fill:"rgba(255, 120, 0, 0.2)",stroke:"#ffaa00",strokeWidth:"4",className:"animate-explosion-ring"},_.id):null})})},Gd="/Hop",vy=/^[a-z0-9]+(?:[._-][a-z0-9]+)*$/,Ol=/^\/assets\/[a-z0-9/_\-.]+$/,sf=["ground","decal","prop","unit","fx","ui"],BA=["svg","webp","avif","png","jpg","jpeg"],Rg=["svg","webp","avif","png"],kg=["svg","webp","avif","png","jpg","jpeg"],Lg=["svg","webp","avif","png"],Bg=["svg"],Wd=(t,i)=>`${t.endsWith("/")?t:`${t}/`}${i.replace(/^\/+/,"")}`,IA=Wd(Gd,"assets/manifest.json"),_a=t=>/^(?:[a-z]+:)?\/\//i.test(t)||t.startsWith("data:")?t:t.startsWith("/")?t.startsWith("/assets/")?Wd(Gd,t.slice(1)):t:Wd(Gd,t),go=t=>{if(t)return{...t,default:_a(t.default),themes:Object.fromEntries(Object.entries(t.themes||{}).map(([i,a])=>[i,_a(a)]))}},Ig=t=>{if(t)return{...t,scale:t.scale??t.mountainScale,offsetX:t.offsetX??t.mountainOffsetX,offsetY:t.offsetY??t.mountainOffsetY,anchorX:t.anchorX??t.mountainAnchorX,anchorY:t.anchorY??t.mountainAnchorY,crustBlendMode:t.crustBlendMode??t.mountainCrustBlendMode,crustBlendOpacity:t.crustBlendOpacity??t.mountainCrustBlendOpacity,tintColor:t.tintColor??t.mountainTintColor,tintBlendMode:t.tintBlendMode??t.mountainTintBlendMode,tintOpacity:t.tintOpacity??t.mountainTintOpacity}},jA=t=>{if(t)return{...t,themes:Object.fromEntries(Object.entries(t.themes||{}).map(([i,a])=>[i,String(a)]))}},lc=t=>{if(t)return{detailA:go(t.detailA),detailB:go(t.detailB),tint:jA(t.tint)}},Xd=t=>{if(t)return{...t}},xy=t=>{if(!t)return;const i=Ig(t);return{...i,mountainPath:i?.mountainPath?_a(i.mountainPath):i?.mountainPath,themes:Object.fromEntries(Object.entries(t.themes||{}).map(([a,o])=>[a,{...Ig(o),mountainPath:o?.mountainPath?_a(o.mountainPath):o?.mountainPath}]))}},DA=t=>{if(t)return{...t,biomeLayers:t.biomeLayers?{undercurrent:go(t.biomeLayers.undercurrent),crust:go(t.biomeLayers.crust),clutter:t.biomeLayers.clutter?{...t.biomeLayers.clutter,tags:[...t.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:t.biomeMaterials?{undercurrent:lc(t.biomeMaterials.undercurrent),crust:lc(t.biomeMaterials.crust)}:void 0,walls:xy(t.walls),assetOverrides:Object.fromEntries(Object.entries(t.assetOverrides||{}).map(([i,a])=>[i,{...a,mountainSettings:Xd(a?.mountainSettings)}]))}},HA=t=>({...t,biomeUnderlay:t.biomeUnderlay?{...t.biomeUnderlay,default:_a(t.biomeUnderlay.default),themes:Object.fromEntries(Object.entries(t.biomeUnderlay.themes||{}).map(([i,a])=>[i,_a(a)]))}:void 0,biomeLayers:t.biomeLayers?{undercurrent:go(t.biomeLayers.undercurrent),crust:go(t.biomeLayers.crust),clutter:t.biomeLayers.clutter?{...t.biomeLayers.clutter,tags:[...t.biomeLayers.clutter.tags||[]]}:void 0}:void 0,biomeMaterials:t.biomeMaterials?{undercurrent:lc(t.biomeMaterials.undercurrent),crust:lc(t.biomeMaterials.crust)}:void 0,walls:xy(t.walls),biomePresets:Object.fromEntries(Object.entries(t.biomePresets||{}).map(([i,a])=>[i,DA(a)||{}])),assets:t.assets.map(i=>({...i,path:_a(i.path),mountainSettings:Xd(i.mountainSettings),mountainSettingsByTheme:Object.fromEntries(Object.entries(i.mountainSettingsByTheme||{}).map(([a,o])=>[a,Xd(o)||{}]))}))}),jg={version:"1.0.0",gridTopology:"flat-top-hex",tileUnitPx:256,tileAspectRatio:1.154700538,layers:[...sf],assets:[]};let Gr=null;const Dg=t=>typeof t=="string"&&sf.includes(t),Hg=t=>typeof t=="string"&&["tile","decal","prop","unit","fx","ui"].includes(t),Pg=t=>typeof t=="string"&&BA.includes(t),wa=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if((typeof t.default!="string"||!Ol.test(t.default))&&a.push(`"${i}.default" must be a /assets/... path.`),t.themes!==void 0)if(!t.themes||typeof t.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(t.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||!Ol.test(c))&&a.push(`"${i}.themes.${o}" must be a /assets/... path.`);if(t.mode!==void 0&&t.mode!=="off"&&t.mode!=="cover"&&t.mode!=="repeat"&&a.push(`"${i}.mode" must be one of "off", "cover", or "repeat".`),t.scalePx!==void 0&&(!Number.isFinite(t.scalePx)||Number(t.scalePx)<=0)&&a.push(`"${i}.scalePx" must be > 0 when provided.`),t.opacity!==void 0&&(!Number.isFinite(t.opacity)||Number(t.opacity)<0||Number(t.opacity)>1)&&a.push(`"${i}.opacity" must be in [0, 1] when provided.`),t.seedShiftPx!==void 0&&(!Number.isFinite(t.seedShiftPx)||Number(t.seedShiftPx)<0)&&a.push(`"${i}.seedShiftPx" must be >= 0 when provided.`),t.offsetX!==void 0&&!Number.isFinite(t.offsetX)&&a.push(`"${i}.offsetX" must be a finite number when provided.`),t.offsetY!==void 0&&!Number.isFinite(t.offsetY)&&a.push(`"${i}.offsetY" must be a finite number when provided.`),t.scroll!==void 0){const o=t.scroll;!o||typeof o!="object"?a.push(`"${i}.scroll" must be an object when provided.`):(o.x!==void 0&&!Number.isFinite(o.x)&&a.push(`"${i}.scroll.x" must be a finite number.`),o.y!==void 0&&!Number.isFinite(o.y)&&a.push(`"${i}.scroll.y" must be a finite number.`),o.durationMs!==void 0&&(!Number.isFinite(o.durationMs)||Number(o.durationMs)<=0)&&a.push(`"${i}.scroll.durationMs" must be > 0 when provided.`))}},PA=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if((typeof t.default!="string"||t.default.trim().length===0)&&a.push(`"${i}.default" must be a non-empty color string.`),t.themes!==void 0)if(!t.themes||typeof t.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(t.themes))(typeof o!="string"||o.trim().length===0)&&a.push(`"${i}.themes" contains an invalid theme key.`),(typeof c!="string"||c.trim().length===0)&&a.push(`"${i}.themes.${o}" must be a non-empty color string.`);t.opacity!==void 0&&(!Number.isFinite(t.opacity)||Number(t.opacity)<0||Number(t.opacity)>1)&&a.push(`"${i}.opacity" must be in [0, 1] when provided.`),t.blendMode!==void 0&&t.blendMode!=="normal"&&t.blendMode!=="multiply"&&t.blendMode!=="overlay"&&t.blendMode!=="soft-light"&&t.blendMode!=="screen"&&t.blendMode!=="color-dodge"&&a.push(`"${i}.blendMode" must be one of "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`)},Cl=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}t.scale!==void 0&&(!Number.isFinite(t.scale)||Number(t.scale)<=0)&&a.push(`"${i}.scale" must be > 0 when provided.`),t.offsetX!==void 0&&!Number.isFinite(t.offsetX)&&a.push(`"${i}.offsetX" must be a finite number when provided.`),t.offsetY!==void 0&&!Number.isFinite(t.offsetY)&&a.push(`"${i}.offsetY" must be a finite number when provided.`),t.anchorX!==void 0&&(!Number.isFinite(t.anchorX)||Number(t.anchorX)<0||Number(t.anchorX)>1)&&a.push(`"${i}.anchorX" must be in [0, 1] when provided.`),t.anchorY!==void 0&&(!Number.isFinite(t.anchorY)||Number(t.anchorY)<0||Number(t.anchorY)>1)&&a.push(`"${i}.anchorY" must be in [0, 1] when provided.`),t.crustBlendMode!==void 0&&t.crustBlendMode!=="off"&&t.crustBlendMode!=="normal"&&t.crustBlendMode!=="multiply"&&t.crustBlendMode!=="overlay"&&t.crustBlendMode!=="soft-light"&&t.crustBlendMode!=="screen"&&t.crustBlendMode!=="color-dodge"&&a.push(`"${i}.crustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.tintBlendMode!==void 0&&t.tintBlendMode!=="off"&&t.tintBlendMode!=="normal"&&t.tintBlendMode!=="multiply"&&t.tintBlendMode!=="overlay"&&t.tintBlendMode!=="soft-light"&&t.tintBlendMode!=="screen"&&t.tintBlendMode!=="color-dodge"&&a.push(`"${i}.tintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.crustBlendOpacity!==void 0&&(!Number.isFinite(t.crustBlendOpacity)||Number(t.crustBlendOpacity)<0||Number(t.crustBlendOpacity)>1)&&a.push(`"${i}.crustBlendOpacity" must be in [0, 1] when provided.`),t.tintOpacity!==void 0&&(!Number.isFinite(t.tintOpacity)||Number(t.tintOpacity)<0||Number(t.tintOpacity)>1)&&a.push(`"${i}.tintOpacity" must be in [0, 1] when provided.`),t.tintColor!==void 0&&(typeof t.tintColor!="string"||t.tintColor.trim().length===0)&&a.push(`"${i}.tintColor" must be a non-empty color string when provided.`)},Ay=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if(t.mode!==void 0&&t.mode!=="native"&&t.mode!=="additive"&&t.mode!=="custom"&&a.push(`"${i}.mode" must be one of "native", "additive", or "custom".`),t.interiorDensity!==void 0&&(!Number.isFinite(t.interiorDensity)||Number(t.interiorDensity)<0||Number(t.interiorDensity)>1)&&a.push(`"${i}.interiorDensity" must be in [0, 1] when provided.`),t.clusterBias!==void 0&&(!Number.isFinite(t.clusterBias)||Number(t.clusterBias)<0||Number(t.clusterBias)>1)&&a.push(`"${i}.clusterBias" must be in [0, 1] when provided.`),t.keepPerimeter!==void 0&&typeof t.keepPerimeter!="boolean"&&a.push(`"${i}.keepPerimeter" must be a boolean when provided.`),t.mountainPath!==void 0&&(typeof t.mountainPath!="string"||!Ol.test(t.mountainPath))&&a.push(`"${i}.mountainPath" must be a /assets/... path when provided.`),t.mountainScale!==void 0&&(!Number.isFinite(t.mountainScale)||Number(t.mountainScale)<=0)&&a.push(`"${i}.mountainScale" must be > 0 when provided.`),t.mountainOffsetX!==void 0&&!Number.isFinite(t.mountainOffsetX)&&a.push(`"${i}.mountainOffsetX" must be a finite number when provided.`),t.mountainOffsetY!==void 0&&!Number.isFinite(t.mountainOffsetY)&&a.push(`"${i}.mountainOffsetY" must be a finite number when provided.`),t.mountainAnchorX!==void 0&&(!Number.isFinite(t.mountainAnchorX)||Number(t.mountainAnchorX)<0||Number(t.mountainAnchorX)>1)&&a.push(`"${i}.mountainAnchorX" must be in [0, 1] when provided.`),t.mountainAnchorY!==void 0&&(!Number.isFinite(t.mountainAnchorY)||Number(t.mountainAnchorY)<0||Number(t.mountainAnchorY)>1)&&a.push(`"${i}.mountainAnchorY" must be in [0, 1] when provided.`),t.mountainCrustBlendMode!==void 0&&t.mountainCrustBlendMode!=="off"&&t.mountainCrustBlendMode!=="normal"&&t.mountainCrustBlendMode!=="multiply"&&t.mountainCrustBlendMode!=="overlay"&&t.mountainCrustBlendMode!=="soft-light"&&t.mountainCrustBlendMode!=="screen"&&t.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${i}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(t.mountainCrustBlendOpacity)||Number(t.mountainCrustBlendOpacity)<0||Number(t.mountainCrustBlendOpacity)>1)&&a.push(`"${i}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),t.mountainTintColor!==void 0&&(typeof t.mountainTintColor!="string"||t.mountainTintColor.trim().length===0)&&a.push(`"${i}.mountainTintColor" must be a non-empty color string when provided.`),t.mountainTintBlendMode!==void 0&&t.mountainTintBlendMode!=="off"&&t.mountainTintBlendMode!=="normal"&&t.mountainTintBlendMode!=="multiply"&&t.mountainTintBlendMode!=="overlay"&&t.mountainTintBlendMode!=="soft-light"&&t.mountainTintBlendMode!=="screen"&&t.mountainTintBlendMode!=="color-dodge"&&a.push(`"${i}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),t.mountainTintOpacity!==void 0&&(!Number.isFinite(t.mountainTintOpacity)||Number(t.mountainTintOpacity)<0||Number(t.mountainTintOpacity)>1)&&a.push(`"${i}.mountainTintOpacity" must be in [0, 1] when provided.`),Cl(t,i,a),t.themes!==void 0)if(!t.themes||typeof t.themes!="object")a.push(`"${i}.themes" must be an object when provided.`);else for(const[o,c]of Object.entries(t.themes)){if(typeof o!="string"||o.trim().length===0){a.push(`"${i}.themes" contains an invalid theme key.`);continue}if(!c||typeof c!="object"){a.push(`"${i}.themes.${o}" must be an object.`);continue}c.mountainPath!==void 0&&(typeof c.mountainPath!="string"||!Ol.test(c.mountainPath))&&a.push(`"${i}.themes.${o}.mountainPath" must be a /assets/... path when provided.`);const r=c;r.mountainScale!==void 0&&(!Number.isFinite(r.mountainScale)||Number(r.mountainScale)<=0)&&a.push(`"${i}.themes.${o}.mountainScale" must be > 0 when provided.`),r.mountainOffsetX!==void 0&&!Number.isFinite(r.mountainOffsetX)&&a.push(`"${i}.themes.${o}.mountainOffsetX" must be a finite number when provided.`),r.mountainOffsetY!==void 0&&!Number.isFinite(r.mountainOffsetY)&&a.push(`"${i}.themes.${o}.mountainOffsetY" must be a finite number when provided.`),r.mountainAnchorX!==void 0&&(!Number.isFinite(r.mountainAnchorX)||Number(r.mountainAnchorX)<0||Number(r.mountainAnchorX)>1)&&a.push(`"${i}.themes.${o}.mountainAnchorX" must be in [0, 1] when provided.`),r.mountainAnchorY!==void 0&&(!Number.isFinite(r.mountainAnchorY)||Number(r.mountainAnchorY)<0||Number(r.mountainAnchorY)>1)&&a.push(`"${i}.themes.${o}.mountainAnchorY" must be in [0, 1] when provided.`),r.mountainCrustBlendMode!==void 0&&r.mountainCrustBlendMode!=="off"&&r.mountainCrustBlendMode!=="normal"&&r.mountainCrustBlendMode!=="multiply"&&r.mountainCrustBlendMode!=="overlay"&&r.mountainCrustBlendMode!=="soft-light"&&r.mountainCrustBlendMode!=="screen"&&r.mountainCrustBlendMode!=="color-dodge"&&a.push(`"${i}.themes.${o}.mountainCrustBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),r.mountainCrustBlendOpacity!==void 0&&(!Number.isFinite(r.mountainCrustBlendOpacity)||Number(r.mountainCrustBlendOpacity)<0||Number(r.mountainCrustBlendOpacity)>1)&&a.push(`"${i}.themes.${o}.mountainCrustBlendOpacity" must be in [0, 1] when provided.`),r.mountainTintBlendMode!==void 0&&r.mountainTintBlendMode!=="off"&&r.mountainTintBlendMode!=="normal"&&r.mountainTintBlendMode!=="multiply"&&r.mountainTintBlendMode!=="overlay"&&r.mountainTintBlendMode!=="soft-light"&&r.mountainTintBlendMode!=="screen"&&r.mountainTintBlendMode!=="color-dodge"&&a.push(`"${i}.themes.${o}.mountainTintBlendMode" must be one of "off", "normal", "multiply", "overlay", "soft-light", "screen", "color-dodge".`),r.mountainTintOpacity!==void 0&&(!Number.isFinite(r.mountainTintOpacity)||Number(r.mountainTintOpacity)<0||Number(r.mountainTintOpacity)>1)&&a.push(`"${i}.themes.${o}.mountainTintOpacity" must be in [0, 1] when provided.`),r.mountainTintColor!==void 0&&(typeof r.mountainTintColor!="string"||r.mountainTintColor.trim().length===0)&&a.push(`"${i}.themes.${o}.mountainTintColor" must be a non-empty color string when provided.`),Cl(c,`${i}.themes.${o}`,a)}},rc=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}t.detailA!==void 0&&wa(t.detailA,`${i}.detailA`,a),t.detailB!==void 0&&wa(t.detailB,`${i}.detailB`,a),t.tint!==void 0&&PA(t.tint,`${i}.tint`,a),t.detailA===void 0&&t.detailB===void 0&&t.tint===void 0&&a.push(`"${i}" must define at least one of "detailA", "detailB", or "tint".`)},UA=(t,i,a)=>{if(!t||typeof t!="object"){a.push(`"${i}" must be an object when provided.`);return}if(t.seed!==void 0&&(typeof t.seed!="string"||t.seed.trim().length===0)&&a.push(`"${i}.seed" must be a non-empty string when provided.`),t.injectHazards!==void 0&&typeof t.injectHazards!="boolean"&&a.push(`"${i}.injectHazards" must be a boolean when provided.`),t.biomeLayers!==void 0){const o=t.biomeLayers;if(!o||typeof o!="object")a.push(`"${i}.biomeLayers" must be an object when provided.`);else if(o.undercurrent!==void 0&&wa(o.undercurrent,`${i}.biomeLayers.undercurrent`,a),o.crust!==void 0&&wa(o.crust,`${i}.biomeLayers.crust`,a),o.clutter!==void 0){const c=o.clutter;!c||typeof c!="object"?a.push(`"${i}.biomeLayers.clutter" must be an object when provided.`):(c.density!==void 0&&(!Number.isFinite(c.density)||Number(c.density)<0||Number(c.density)>1)&&a.push(`"${i}.biomeLayers.clutter.density" must be in [0, 1] when provided.`),c.maxPerHex!==void 0&&(!Number.isFinite(c.maxPerHex)||Number(c.maxPerHex)<0)&&a.push(`"${i}.biomeLayers.clutter.maxPerHex" must be >= 0 when provided.`),c.bleedScaleMax!==void 0&&(!Number.isFinite(c.bleedScaleMax)||Number(c.bleedScaleMax)<1||Number(c.bleedScaleMax)>2)&&a.push(`"${i}.biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.`),c.tags!==void 0&&(!Array.isArray(c.tags)||!c.tags.every(r=>typeof r=="string"&&r.length>0))&&a.push(`"${i}.biomeLayers.clutter.tags" must be a string array when provided.`))}}if(t.biomeMaterials!==void 0){const o=t.biomeMaterials;!o||typeof o!="object"?a.push(`"${i}.biomeMaterials" must be an object when provided.`):(o.undercurrent!==void 0&&rc(o.undercurrent,`${i}.biomeMaterials.undercurrent`,a),o.crust!==void 0&&rc(o.crust,`${i}.biomeMaterials.crust`,a))}if(t.walls!==void 0&&Ay(t.walls,`${i}.walls`,a),t.assetOverrides!==void 0)if(!t.assetOverrides||typeof t.assetOverrides!="object")a.push(`"${i}.assetOverrides" must be an object when provided.`);else for(const[o,c]of Object.entries(t.assetOverrides)){if(!vy.test(o)){a.push(`"${i}.assetOverrides" contains invalid asset id "${o}".`);continue}if(!c||typeof c!="object"){a.push(`"${i}.assetOverrides.${o}" must be an object.`);continue}c.mountainSettings!==void 0&&Cl(c.mountainSettings,`${i}.assetOverrides.${o}.mountainSettings`,a)}},qA=t=>{const i=[];if(!t||typeof t!="object")return{valid:!1,errors:["Manifest is not an object."]};const a=t;if((typeof a.version!="string"||a.version.length===0)&&i.push('Missing or invalid "version".'),a.gridTopology!=="flat-top-hex"&&i.push('Only "flat-top-hex" gridTopology is supported.'),(!Number.isFinite(a.tileUnitPx)||Number(a.tileUnitPx)<=0)&&i.push('Missing or invalid "tileUnitPx".'),(!Number.isFinite(a.tileAspectRatio)||Number(a.tileAspectRatio)<=0)&&i.push('Missing or invalid "tileAspectRatio".'),a.biomeUnderlay!==void 0&&wa(a.biomeUnderlay,"biomeUnderlay",i),a.biomeLayers!==void 0){const c=a.biomeLayers;if(!c||typeof c!="object")i.push('"biomeLayers" must be an object when provided.');else if(c.undercurrent!==void 0&&wa(c.undercurrent,"biomeLayers.undercurrent",i),c.crust!==void 0&&wa(c.crust,"biomeLayers.crust",i),!c.undercurrent&&!c.crust&&i.push('"biomeLayers" must define at least one of "undercurrent" or "crust".'),c.clutter!==void 0){const r=c.clutter;!r||typeof r!="object"?i.push('"biomeLayers.clutter" must be an object when provided.'):(r.density!==void 0&&(!Number.isFinite(r.density)||Number(r.density)<0||Number(r.density)>1)&&i.push('"biomeLayers.clutter.density" must be in [0, 1] when provided.'),r.maxPerHex!==void 0&&(!Number.isFinite(r.maxPerHex)||Number(r.maxPerHex)<0)&&i.push('"biomeLayers.clutter.maxPerHex" must be >= 0 when provided.'),r.bleedScaleMax!==void 0&&(!Number.isFinite(r.bleedScaleMax)||Number(r.bleedScaleMax)<1||Number(r.bleedScaleMax)>2)&&i.push('"biomeLayers.clutter.bleedScaleMax" must be within [1, 2] when provided.'),r.tags!==void 0&&(!Array.isArray(r.tags)||!r.tags.every(f=>typeof f=="string"&&f.length>0))&&i.push('"biomeLayers.clutter.tags" must be a string array when provided.'))}}if(a.biomeMaterials!==void 0){const c=a.biomeMaterials;!c||typeof c!="object"?i.push('"biomeMaterials" must be an object when provided.'):(c.undercurrent!==void 0&&rc(c.undercurrent,"biomeMaterials.undercurrent",i),c.crust!==void 0&&rc(c.crust,"biomeMaterials.crust",i),c.undercurrent===void 0&&c.crust===void 0&&i.push('"biomeMaterials" must define at least one of "undercurrent" or "crust".'))}if(a.walls!==void 0&&Ay(a.walls,"walls",i),a.biomePresets!==void 0)if(!a.biomePresets||typeof a.biomePresets!="object")i.push('"biomePresets" must be an object when provided.');else for(const[c,r]of Object.entries(a.biomePresets)){if(typeof c!="string"||c.trim().length===0){i.push('"biomePresets" contains an invalid theme key.');continue}UA(r,`biomePresets.${c}`,i)}if(!Array.isArray(a.layers)||a.layers.length===0||!a.layers.every(Dg))i.push('Missing or invalid "layers".');else for(const c of sf)a.layers.includes(c)||i.push(`Missing required layer "${c}" in "layers".`);if(!Array.isArray(a.assets))return i.push('Missing or invalid "assets".'),{valid:i.length===0,errors:i};const o=new Set;for(const[c,r]of a.assets.entries()){const f=`assets[${c}]`;if(!r||typeof r!="object"){i.push(`${f} is not an object.`);continue}const g=r;if(typeof g.id!="string"||!vy.test(g.id)?i.push(`${f}.id is invalid; expected lowercase tokenized id.`):o.has(g.id)?i.push(`${f}.id is duplicated (${g.id}).`):o.add(g.id),Hg(g.type)||i.push(`${f}.type is invalid.`),Dg(g.layer)||i.push(`${f}.layer is invalid.`),Pg(g.recommendedFormat)||i.push(`${f}.recommendedFormat is invalid.`),Hg(g.type)&&Pg(g.recommendedFormat)&&((g.type==="tile"||g.type==="decal"||g.type==="prop")&&!kg.includes(g.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${kg.join(", ")} for ${g.type}.`),g.type==="ui"&&!Bg.includes(g.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Bg.join(", ")} for ui.`),g.type==="unit"&&!Rg.includes(g.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Rg.join(", ")} for units.`),g.type==="fx"&&!Lg.includes(g.recommendedFormat)&&i.push(`${f}.recommendedFormat must be one of ${Lg.join(", ")} for fx.`)),(typeof g.path!="string"||!Ol.test(g.path))&&i.push(`${f}.path is invalid; expected /assets/...`),(!Number.isFinite(g.width)||Number(g.width)<=0)&&i.push(`${f}.width must be > 0.`),(!Number.isFinite(g.height)||Number(g.height)<=0)&&i.push(`${f}.height must be > 0.`),g.mountainSettings!==void 0&&Cl(g.mountainSettings,`${f}.mountainSettings`,i),g.mountainSettingsByTheme!==void 0)if(!g.mountainSettingsByTheme||typeof g.mountainSettingsByTheme!="object")i.push(`${f}.mountainSettingsByTheme must be an object when provided.`);else for(const[b,y]of Object.entries(g.mountainSettingsByTheme)){if(typeof b!="string"||b.trim().length===0){i.push(`${f}.mountainSettingsByTheme contains an invalid theme key.`);continue}Cl(y,`${f}.mountainSettingsByTheme.${b}`,i)}}return{valid:i.length===0,errors:i}},zA=async()=>Gr||(Gr=fetch(IA).then(async t=>{if(!t.ok)throw new Error(`Asset manifest fetch failed: ${t.status}`);return t.json()}).then(t=>{const i=qA(t);return i.valid?HA(t):(console.warn("[HOP_ASSETS] Invalid manifest; using fallback.",i.errors),jg)}).catch(t=>(console.warn("[HOP_ASSETS] Failed to load manifest; using fallback.",t),jg)),Gr),af=(t,i)=>{if(!t)return;const a=String(i||"").toLowerCase();if(a)return t.biomePresets?.[a]},sc=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i=Math.imul(i,16777619);return i>>>0},pl=t=>sc(t)/4294967295,VA=t=>{const i=(t.tags||[]).map(o=>o.toLowerCase()),a=[t.id.toLowerCase(),...i];for(const o of a){const c=o.match(/(?:cluster|hex)[-_]?([123])\b/);if(c)return Number(c[1]);if(o.includes("1-hex")||o.includes("single"))return 1;if(o.includes("2-hex")||o.includes("double"))return 2;if(o.includes("3-hex")||o.includes("triple"))return 3}return 1},Wr=(t,i)=>{if(t)return i&&t.themes?.[i]?t.themes[i]:t.default},Xr=t=>t?t.mode==="cover"||t.mode==="repeat"||t.mode==="off"?t.mode:"cover":"off",Ld=t=>Math.min(1,Math.max(0,Number(t?.opacity??1))),Qr=(t,i,a=64,o=Number.POSITIVE_INFINITY)=>{const c=Number(t?.scalePx||i);return Math.min(o,Math.max(a,c))},Ug=t=>({x:Number(t?.scroll?.x??0),y:Number(t?.scroll?.y??0),durationMs:Math.max(1e3,Number(t?.scroll?.durationMs??18e3))}),$A=(t,i)=>{if(t)return i&&t.themes?.[i]?t.themes[i]:t.default},YA=t=>Math.min(1,Math.max(0,Number(t?.opacity??0))),Ty=t=>t==="normal"||t==="multiply"||t==="overlay"||t==="soft-light"||t==="screen"||t==="color-dodge"?t:"multiply",Ey=(t,i="#8b6f4a")=>{const a=String(t||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[r,f,g]=a.slice(1).split("");return`#${r}${r}${f}${f}${g}${g}`.toLowerCase()}return i},KA=t=>{const a=Ey(t).slice(1);return{r:parseInt(a.slice(0,2),16)/255,g:parseInt(a.slice(2,4),16)/255,b:parseInt(a.slice(4,6),16)/255}},FA=t=>t.replace(/[^a-zA-Z0-9_-]/g,"-"),qg=(t,i)=>t==="off"?"off":t?Ty(t):i,Bd=t=>{const i=[];for(let a=0;a<6;a++){const o=Math.PI/180*(60*a);i.push(`${t*Math.cos(o)},${t*Math.sin(o)}`)}return i.join(" ")},_y=({gameState:t,onMove:i,selectedSkillId:a,showMovementRange:o,onBusyStateChange:c,assetManifest:r,biomeDebug:f,onSimulationEvents:g,onMirrorSnapshot:b,enginePreviewGhost:y})=>{const[A,v]=M.useState(!1),[x,E]=M.useState(null),[m,h]=M.useState(!1),[R,k]=M.useState(!1),[B,_]=M.useState([]),w=M.useRef(null),H=M.useRef([]),j=M.useRef(!1),L=M.useRef([]),W=M.useRef(0),Z=M.useRef(""),Te=M.useRef(0),oe=M.useRef(0),Be=M.useRef(0),ne=t.player.position,xe=M.useMemo(()=>{let C=t.rooms?.[0]?.hexes;if(!C||C.length===0){C=[];for(let P=0;P<t.gridWidth;P++)for(let F=0;F<t.gridHeight;F++)C.push({q:P,r:F,s:-P-F})}return C.filter(P=>ac(P.q,P.r,t.gridWidth,t.gridHeight))},[t.rooms,t.gridWidth,t.gridHeight]);M.useEffect(()=>{if(t.visualEvents?.find(P=>P.type==="shake")){v(!0);const P=setTimeout(()=>v(!1),200);return()=>clearTimeout(P)}},[t.visualEvents]);const ve=M.useMemo(()=>{if(xe.length===0)return{minX:0,minY:0,width:100,height:100};let C=1/0,P=1/0,F=-1/0,ae=-1/0;return xe.forEach(ce=>{const{x:pe,y:he}=bt(ce,ee);C=Math.min(C,pe-ee),P=Math.min(P,he-ee),F=Math.max(F,pe+ee),ae=Math.max(ae,he+ee)}),{minX:C,minY:P,width:F-C,height:ae-P}},[xe]),V=M.useMemo(()=>{const C={};for(const P of t.visualEvents||[]){if(P.type!=="kinetic_trace")continue;const F=P.payload;F?.actorId&&(C[F.actorId]=F)}return C},[t.visualEvents]),ie=M.useMemo(()=>{if(!o||a)return[];const C=["BASIC_MOVE","DASH"],P=new Set(t.player.activeSkills.map(ce=>ce.id)),F=new Set,ae=[];for(const ce of C){if(!P.has(ce))continue;const pe=Nn.get(ce);if(!pe?.getValidTargets)continue;const he=pe.getValidTargets(t,ne);for(const at of he){const ot=de(at);F.has(ot)||(F.add(ot),ae.push(at))}}return ae},[o,a,t,ne]),re=M.useMemo(()=>{const C=new Set;for(const P of ie)C.add(de(P));return C},[ie]),Re=M.useMemo(()=>t.player.activeSkills.some(C=>C.id==="BASIC_MOVE"||C.id==="DASH"),[t.player.activeSkills]),ge=M.useMemo(()=>de(t.stairsPosition),[t.stairsPosition]),O=M.useMemo(()=>t.shrinePosition?de(t.shrinePosition):null,[t.shrinePosition]),Y=M.useMemo(()=>{const C=[{q:ne.q+1,r:ne.r,s:ne.s-1},{q:ne.q+1,r:ne.r-1,s:ne.s},{q:ne.q,r:ne.r-1,s:ne.s+1},{q:ne.q-1,r:ne.r,s:ne.s+1},{q:ne.q-1,r:ne.r+1,s:ne.s},{q:ne.q,r:ne.r+1,s:ne.s-1}],P=new Set;for(const F of C)ac(F.q,F.r,t.gridWidth,t.gridHeight)&&P.add(de(F));return P},[ne,t.gridWidth,t.gridHeight]),te=M.useMemo(()=>{const C=new Set;if(!a)return C;const P=Nn.get(a);if(!P?.getValidTargets)return C;const F=P.getValidTargets(t,ne);for(const ae of F)C.add(de(ae));return C},[a,t,ne]),ue=M.useMemo(()=>{const C=new Set;for(const P of t.enemies)P.intentPosition&&C.add(de(P.intentPosition));return C},[t.enemies]),Oe=M.useMemo(()=>{if(y)return y;if(!x)return null;const C=de(x);if(o&&!a)return re.has(C)||!Re&&Y.has(C)?{path:kt(ne,x),aoe:[],hasEnemy:!1,target:x}:null;if(!a)return null;const P=t.player.activeSkills.find(pe=>pe.id===a),F=aA(t,{actorId:t.player.id,skillId:a,target:x,activeUpgrades:P?.activeUpgrades||[]});if(!F.ok)return null;const ae=new Map;for(const pe of F.simulationEvents)pe.position&&(pe.type!=="DamageTaken"&&pe.type!=="StatusApplied"&&pe.type!=="UnitMoved"||ae.set(de(pe.position),pe.position));const ce=F.simulationEvents.some(pe=>(pe.type==="DamageTaken"||pe.type==="StatusApplied")&&!!pe.targetId&&pe.targetId!==t.player.id);return{path:kt(ne,x),aoe:[...ae.values()],hasEnemy:ce,target:x}},[y,x,o,a,re,Re,Y,t,ne]),Ce=M.useMemo(()=>{const C=new Map;for(const P of xe){const F=de(P),ae=Pe.getTraitsAt(t,P),ce=ae.has("BLOCKS_MOVEMENT")&&ae.has("BLOCKS_LOS"),pe=ae.has("LAVA")||ae.has("HAZARDOUS")&&ae.has("LIQUID"),he=ae.has("FIRE");C.set(F,{isWall:ce,isLava:!ce&&pe,isFire:!ce&&he})}return C},[xe,t.tiles]),Ne=M.useMemo(()=>{const C=new Map;for(const P of r?.assets||[])C.set(P.id,P);return C},[r]),ft=M.useMemo(()=>Ne.get(NA())?.path,[Ne]),qe=M.useMemo(()=>Math.max(1,r?.tileUnitPx||256),[r?.tileUnitPx]),Lt=M.useMemo(()=>ee*2/qe,[qe]),ze=M.useMemo(()=>String(t.theme||"").toLowerCase(),[t.theme]),Ue=M.useMemo(()=>`${t.initialSeed||t.rngSeed||t.turnNumber}:${t.floor}:${ze}`,[t.initialSeed,t.rngSeed,t.turnNumber,t.floor,ze]),Ot=M.useMemo(()=>af(r,ze),[r,ze]),Bt=M.useMemo(()=>{const C=r?.biomeUnderlay;if(C)return{default:C.default,themes:C.themes,mode:C.mode,scalePx:C.scalePx,opacity:C.opacity}},[r?.biomeUnderlay]),rt=M.useMemo(()=>Ot?.biomeLayers?.undercurrent||r?.biomeLayers?.undercurrent,[Ot?.biomeLayers?.undercurrent,r?.biomeLayers?.undercurrent]),Vt=M.useMemo(()=>Ot?.biomeLayers?.crust||r?.biomeLayers?.crust||Bt,[Ot?.biomeLayers?.crust,r?.biomeLayers?.crust,Bt]),ln=M.useMemo(()=>Ot?.biomeLayers?.clutter||r?.biomeLayers?.clutter,[Ot?.biomeLayers?.clutter,r?.biomeLayers?.clutter]),Ve=M.useMemo(()=>Wr(rt,ze),[rt,ze]),it=M.useMemo(()=>Xr(rt),[rt]),yn=M.useMemo(()=>Qr(rt,qe,64,192),[rt,qe]),Ti=M.useMemo(()=>Ld(rt),[rt]),Qn=M.useMemo(()=>({x:Number(rt?.scroll?.x??120),y:Number(rt?.scroll?.y??90),durationMs:Math.max(1e3,Number(rt?.scroll?.durationMs??92e3))}),[rt?.scroll?.x,rt?.scroll?.y,rt?.scroll?.durationMs]),Dn=M.useMemo(()=>({x:Number(rt?.offsetX??0)+Number(f?.undercurrentOffset?.x??0),y:Number(rt?.offsetY??0)+Number(f?.undercurrentOffset?.y??0)}),[rt?.offsetX,rt?.offsetY,f?.undercurrentOffset?.x,f?.undercurrentOffset?.y]),Fe=M.useMemo(()=>Wr(Vt,ze),[Vt,ze]),mt=M.useMemo(()=>Xr(Vt),[Vt]),jt=M.useMemo(()=>Qr(Vt,qe,64),[Vt,qe]),bn=1,rn=M.useMemo(()=>{const C=Math.max(0,Number(Vt?.seedShiftPx??ee*5));if(C===0)return{x:0,y:0};const P=sc(`${Ue}|crust-offset`),F=((P&65535)/65535*2-1)*C,ae=((P>>>16&65535)/65535*2-1)*C;return{x:F,y:ae}},[Vt?.seedShiftPx,Ue]),Sn=M.useMemo(()=>({x:Number(Vt?.offsetX??0)+Number(f?.crustOffset?.x??0),y:Number(Vt?.offsetY??0)+Number(f?.crustOffset?.y??0)}),[Vt?.offsetX,Vt?.offsetY,f?.crustOffset?.x,f?.crustOffset?.y]),$t=M.useMemo(()=>({x:rn.x+Sn.x,y:rn.y+Sn.y}),[rn.x,rn.y,Sn.x,Sn.y]),At=M.useMemo(()=>r?.walls,[r?.walls]),$e=M.useMemo(()=>Ot?.walls||At?.themes?.[ze],[Ot?.walls,At?.themes,ze]),Yt=M.useMemo(()=>Ot?.biomeMaterials?.crust||r?.biomeMaterials?.crust,[Ot?.biomeMaterials?.crust,r?.biomeMaterials?.crust]),Je=M.useMemo(()=>Yt?.detailA,[Yt?.detailA]),et=M.useMemo(()=>Yt?.detailB,[Yt?.detailB]),Tt=M.useMemo(()=>Wr(Je,ze),[Je,ze]),cn=M.useMemo(()=>Wr(et,ze),[et,ze]),Hn=M.useMemo(()=>Xr(Je),[Je]),Jn=M.useMemo(()=>Xr(et),[et]),Mn=M.useMemo(()=>Qr(Je,jt,64),[Je,jt]),un=M.useMemo(()=>Qr(et,jt,64),[et,jt]),pt=M.useMemo(()=>Ld(Je),[Je]),Dt=M.useMemo(()=>Ld(et),[et]),Xt=M.useMemo(()=>Ug(Je),[Je?.scroll?.x,Je?.scroll?.y,Je?.scroll?.durationMs]),Rn=M.useMemo(()=>Ug(et),[et?.scroll?.x,et?.scroll?.y,et?.scroll?.durationMs]),Di=M.useMemo(()=>{const C=ee*.75,P=sc(`${Ue}|crust-detail-a-offset`),F=((P&65535)/65535*2-1)*C,ae=((P>>>16&65535)/65535*2-1)*C;return{x:F,y:ae}},[Ue]),ci=M.useMemo(()=>{const C=ee*.75,P=sc(`${Ue}|crust-detail-b-offset`),F=((P&65535)/65535*2-1)*C,ae=((P>>>16&65535)/65535*2-1)*C;return{x:F,y:ae}},[Ue]),vn=M.useMemo(()=>({x:$t.x+Di.x,y:$t.y+Di.y}),[$t.x,$t.y,Di.x,Di.y]),Kt=M.useMemo(()=>({x:$t.x+ci.x,y:$t.y+ci.y}),[$t.x,$t.y,ci.x,ci.y]),Pn=M.useMemo(()=>Yt?.tint,[Yt?.tint]),Hi=M.useMemo(()=>$A(Pn,ze),[Pn,ze]),Gi=M.useMemo(()=>YA(Pn),[Pn?.opacity]),Ei=M.useMemo(()=>Ty(Pn?.blendMode),[Pn?.blendMode]),_i=!!(Hi&&Gi>0),bs=M.useMemo(()=>_i?Math.min(.55,Math.max(.15,Gi*.9)):0,[_i,Gi]),X=M.useCallback(C=>{const P=C?.mountainSettings,F=C?.mountainSettingsByTheme?.[ze],ce=(C?Ot?.assetOverrides?.[C.id]:void 0)?.mountainSettings,pe=Math.min(3,Math.max(.2,Number(f?.mountainScale??ce?.scale??F?.scale??$e?.scale??At?.scale??P?.scale??.95))),he=Number(f?.mountainOffset?.x??ce?.offsetX??F?.offsetX??$e?.offsetX??At?.offsetX??P?.offsetX??0),at=Number(f?.mountainOffset?.y??ce?.offsetY??F?.offsetY??$e?.offsetY??At?.offsetY??P?.offsetY??0),ot=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.x??ce?.anchorX??F?.anchorX??$e?.anchorX??At?.anchorX??P?.anchorX??.5))),fn=Math.min(1,Math.max(0,Number(f?.mountainAnchor?.y??ce?.anchorY??F?.anchorY??$e?.anchorY??At?.anchorY??P?.anchorY??.78))),zn=qg(f?.mountainCrustBlendMode??ce?.crustBlendMode??F?.crustBlendMode??$e?.crustBlendMode??At?.crustBlendMode??P?.crustBlendMode,Ei),It=Math.min(1,Math.max(0,Number(f?.mountainCrustBlendOpacity??ce?.crustBlendOpacity??F?.crustBlendOpacity??$e?.crustBlendOpacity??At?.crustBlendOpacity??P?.crustBlendOpacity??bs))),_t=Ey(String(f?.mountainTintColor??ce?.tintColor??F?.tintColor??$e?.tintColor??At?.tintColor??P?.tintColor??Hi??"#8b6f4a")),Pt=qg(f?.mountainTintBlendMode??ce?.tintBlendMode??F?.tintBlendMode??$e?.tintBlendMode??At?.tintBlendMode??P?.tintBlendMode,"soft-light"),mn=Math.min(1,Math.max(0,Number(f?.mountainTintOpacity??ce?.tintOpacity??F?.tintOpacity??$e?.tintOpacity??At?.tintOpacity??P?.tintOpacity??0))),pn=KA(_t);return{scale:pe,offsetX:he,offsetY:at,anchorX:ot,anchorY:fn,crustBlendMode:zn,crustBlendOpacity:It,tintColor:_t,tintBlendMode:Pt,tintOpacity:mn,tintMatrixValues:`0 0 0 0 ${pn.r.toFixed(4)} 0 0 0 0 ${pn.g.toFixed(4)} 0 0 0 0 ${pn.b.toFixed(4)} 0 0 0 1 0`}},[ze,f?.mountainScale,f?.mountainOffset?.x,f?.mountainOffset?.y,f?.mountainAnchor?.x,f?.mountainAnchor?.y,f?.mountainCrustBlendMode,f?.mountainCrustBlendOpacity,f?.mountainTintColor,f?.mountainTintBlendMode,f?.mountainTintOpacity,Ot?.assetOverrides,At,$e,Ei,Hi,bs]),le=!!(Tt&&Hn!=="off"&&pt>0||cn&&Jn!=="off"&&Dt>0||_i),me=!!(Ve&&it!=="off"||Fe&&mt!=="off"||le),we=M.useMemo(()=>`biome-undercurrent-${t.floor}`,[t.floor]),be=M.useMemo(()=>`biome-crust-${t.floor}`,[t.floor]),De=M.useMemo(()=>`biome-crust-mask-${t.floor}`,[t.floor]),ct=M.useMemo(()=>`biome-crust-detail-a-${t.floor}`,[t.floor]),dn=M.useMemo(()=>`biome-crust-detail-b-${t.floor}`,[t.floor]),xn=!!(Fe&&mt!=="off"||Tt&&Hn!=="off"&&pt>0||cn&&Jn!=="off"&&Dt>0||_i),Ht=M.useMemo(()=>{const C=[];for(const P of xe){const F=de(P),ae=Ce.get(F);if(!ae||!ae.isLava&&!ae.isFire)continue;const{x:ce,y:pe}=bt(P,ee);C.push({key:F,x:ce,y:pe})}return C},[xe,Ce]),Ct=M.useMemo(()=>{const C=Mg({isStairs:!0});return C?Ne.get(C):void 0},[Ne]),kn=M.useMemo(()=>{const C=Mg({isShrine:!0});return C?Ne.get(C):void 0},[Ne]),Un=M.useMemo(()=>{const C=[];return t.stairsPosition&&C.push({id:`stairs-${de(t.stairsPosition)}`,kind:"stairs",position:t.stairsPosition,asset:Ct}),t.shrinePosition&&C.push({id:`shrine-${de(t.shrinePosition)}`,kind:"shrine",position:t.shrinePosition,asset:kn}),C},[t.stairsPosition,t.shrinePosition,Ct,kn]),Ln=M.useMemo(()=>{const P=(r?.assets||[]).filter(pe=>{if(pe.type!=="prop")return!1;const he=pe.id.toLowerCase(),at=new Set((pe.tags||[]).map(zn=>zn.toLowerCase()));if(!(he.includes("mountain")||at.has("mountain")))return!1;if(!pe.theme)return!0;const fn=pe.theme.toLowerCase();return fn===ze||fn==="core"}).sort((pe,he)=>pe.id.localeCompare(he.id)),F=String($e?.mountainPath||At?.mountainPath||"").trim(),ae=String(f?.mountainAssetPath||F).trim();if(!ae)return P;const ce=P.find(pe=>pe.path===ae);return ce?[ce]:[]},[r?.assets,ze,f?.mountainAssetPath,At?.mountainPath,$e?.mountainPath]),wi=M.useMemo(()=>{const C=new Map;for(const P of Ln)C.set(P.id,X(P));return C},[Ln,X]),Mi=M.useMemo(()=>{if(!Ln.length)return[];const C=Ln.filter(ae=>VA(ae)===1),P=C.length?C:Ln,F=xe.filter(ae=>Ce.get(de(ae))?.isWall).sort((ae,ce)=>de(ae).localeCompare(de(ce)));return F.length?F.map(ae=>{const ce=de(ae),pe=Math.floor(pl(`${Ue}|mountain-tile|${ce}|asset`)*P.length)%P.length,he=P[pe],at=wi.get(he.id)||X(he),{y:ot}=bt(ae,ee);return{id:`mountain-${ce}-${he.id}`,kind:"mountain",position:ae,asset:he,renderScale:at.scale,zAnchorY:ot+ee*.42+at.offsetY}}):[]},[Ln,xe,Ce,Ue,wi,X]),Nt=M.useMemo(()=>{const C=new Set((ln?.tags?.length?ln.tags:["clutter","obstacle"]).map(P=>P.toLowerCase()));return(r?.assets||[]).filter(P=>{if(P.type!=="prop"&&P.type!=="decal"||P.id.toLowerCase().includes("mountain"))return!1;const ae=(P.tags||[]).map(ce=>ce.toLowerCase());return ae.includes("mountain")||!ae.some(ce=>C.has(ce))?!1:P.theme?P.theme.toLowerCase()===ze||P.theme.toLowerCase()==="core":!0})},[r?.assets,ln?.tags,ze]),yo=M.useMemo(()=>{if(!Nt.length)return[];const C=Math.min(.6,Math.max(0,Number(ln?.density??.08))),P=Math.max(1,Math.floor(Number(ln?.maxPerHex??1))),F=Math.min(2,Math.max(1,Number(ln?.bleedScaleMax??2))),ae=[];for(const ce of xe){const pe=de(ce),he=Ce.get(pe);if(he?.isWall||he?.isLava||he?.isFire)continue;const{y:at}=bt(ce,ee);for(let ot=0;ot<P;ot++){if(pl(`${Ue}|clutter|${pe}|slot:${ot}|roll`)>C/(ot+1))continue;const zn=Math.floor(pl(`${Ue}|clutter|${pe}|slot:${ot}|pick`)*Nt.length)%Nt.length,It=Nt[zn],_t=1+pl(`${Ue}|clutter|${pe}|slot:${ot}|scale`)*(F-1),Pt=(pl(`${Ue}|clutter|${pe}|slot:${ot}|depth`)-.5)*ee*.28;ae.push({id:`clutter-${pe}-${ot}-${It.id}`,kind:"clutter",position:ce,asset:It,renderScale:_t,zAnchorY:at+Pt})}}return ae},[xe,Ce,Nt,ln?.density,ln?.maxPerHex,ln?.bleedScaleMax,Ue]),Nl=M.useMemo(()=>{const C=[...Mi,...yo];for(const P of Un){const{y:F}=bt(P.position,ee),ae=P.kind==="shrine";C.push({id:P.id,kind:P.kind,position:P.position,asset:P.asset,renderScale:Math.min(2,ae?1.5:1.42),zAnchorY:F+(ae?ee*.32:ee*.28),fallback:P.kind})}return C.sort((P,F)=>P.zAnchorY===F.zAnchorY?P.id.localeCompare(F.id):P.zAnchorY-F.zAnchorY),C},[Mi,yo,Un]),Wi=M.useMemo(()=>{const C=new Set;for(const P of Mi)C.add(de(P.position));return C},[Mi]),Pi=M.useCallback(C=>{if(!C)return null;const P=C.position||C.destination||C.origin||C.target;return P&&typeof P.q=="number"&&typeof P.r=="number"&&typeof P.s=="number"?P:null},[]);M.useEffect(()=>{if(!ft)return;const C=t.timelineEvents||[],P=t.visualEvents||[];C.length<Te.current&&(Te.current=0);const F=C.slice(Te.current);Te.current=C.length,P.length<oe.current&&(oe.current=0);const ae=P.slice(oe.current);oe.current=P.length;const ce=[],pe=Date.now();for(const he of F){if(he.phase!=="DEATH_RESOLVE")continue;const at=Pi(he.payload);at&&ce.push({id:`decal-tl-${he.id}-${pe}-${ce.length}`,position:at,href:ft,createdAt:pe})}for(const he of ae){if(he.type!=="vfx")continue;const at=he.payload?.type;if(at!=="vaporize"&&at!=="explosion_ring")continue;const ot=Pi(he.payload);ot&&ce.push({id:`decal-vx-${at}-${pe}-${ce.length}`,position:ot,href:ft,createdAt:pe})}ce.length>0&&_(he=>[...he,...ce].slice(-80))},[t.timelineEvents,t.visualEvents,ft,Pi]),M.useEffect(()=>{const C=t.simulationEvents||[];C.length<Be.current&&(Be.current=0);const P=C.slice(Be.current);Be.current=C.length,P.length>0&&g?.(P)},[t.simulationEvents,g]),M.useEffect(()=>{if(B.length===0)return;const C=12e3,P=window.setTimeout(()=>{const F=Date.now();_(ae=>ae.filter(ce=>F-ce.createdAt<C))},1e3);return()=>window.clearTimeout(P)},[B]);const mc=M.useCallback(C=>{E(C)},[]);M.useEffect(()=>{c?.(m||R)},[m,R,c]);const Qs=M.useMemo(()=>{const C=new Map;C.set(t.player.id,t.player.position);for(const P of t.enemies)C.set(P.id,P.position);for(const P of t.companions||[])C.set(P.id,P.position);for(const P of t.dyingEntities||[])C.set(P.id,P.position);return C},[t.player.id,t.player.position,t.enemies,t.companions,t.dyingEntities]);M.useEffect(()=>{if(!b)return;const C={turn:t.turnNumber||0,stackTick:t.stackTrace?.length||0,actors:[...Qs.entries()].map(([P,F])=>({id:P,position:{q:F.q,r:F.r,s:F.s}}))};b(C)},[b,t.turnNumber,t.stackTrace,Qs]);const Ss=M.useMemo(()=>(t.visualEvents||[]).filter(C=>C.type==="kinetic_trace").map(C=>C.payload).filter(C=>{if(!C?.actorId||!C.origin||!C.destination)return!1;const P=Qs.get(C.actorId);return!!P&&de(P)===de(C.destination)}),[t.visualEvents,Qs]),Ca=M.useMemo(()=>{if(!Ss.length)return"";const C=t.turnNumber??0,P=Ss.map(F=>{const ae=(F.path||[]).map(ce=>`${ce.q},${ce.r},${ce.s}`).join(">");return[F.actorId,`${F.origin.q},${F.origin.r},${F.origin.s}`,`${F.destination.q},${F.destination.r},${F.destination.s}`,F.movementType||"slide",F.startDelayMs||0,F.durationMs||0,ae].join("|")}).join("||");return`${C}::${P}`},[Ss,t.turnNumber]),vs=M.useCallback(async(C,P,F,ae)=>{if(ae!==W.current)return;const ce=C.animate(P,{...F,fill:F.fill??"forwards"});L.current.push(ce);try{await ce.finished}catch{}finally{L.current=L.current.filter(pe=>pe!==ce)}},[]),Js=M.useCallback(async(C,P,F)=>{if(P!==W.current)return;const ae=w.current?.querySelector(`[data-actor-node="${C.actorId}"]`),ce=mn=>{const pn=bt(mn,ee);return`translate(${pn.x}px, ${pn.y}px)`},pe=Math.max(0,C.startDelayMs||0),he=Math.max(0,performance.now()-F),at=Math.max(0,pe-he),ot=C.path&&C.path.length>1?C.path:[C.origin,C.destination],fn=Math.max(1,ot.length-1),zn=Math.max(120,C.durationMs||fn*110);if(!ae){const mn=Math.max(0,at+zn);mn>0&&await new Promise(pn=>window.setTimeout(pn,mn));return}if(at>0&&(await new Promise(mn=>window.setTimeout(mn,at)),P!==W.current))return;if((C.movementType||"slide")==="teleport"){const mn=Math.max(120,C.durationMs||180);await vs(ae,[{transform:ce(C.origin),opacity:1,offset:0},{transform:ce(C.origin),opacity:0,offset:.45},{transform:ce(C.destination),opacity:0,offset:.55},{transform:ce(C.destination),opacity:1,offset:1}],{duration:mn,easing:"linear"},P),P===W.current&&(ae.style.transform=ce(C.destination),ae.style.opacity="1");return}const It=[...ot],_t=It[It.length-1];(!_t||_t.q!==C.destination.q||_t.r!==C.destination.r||_t.s!==C.destination.s)&&It.push(C.destination);const Pt=It.map((mn,pn)=>({transform:ce(mn),offset:It.length===1?1:pn/(It.length-1)}));Pt[Pt.length-1]={...Pt[Pt.length-1],transform:ce(C.destination),offset:1},await vs(ae,Pt,{duration:zn,easing:"linear"},P),P===W.current&&(ae.style.transform=ce(C.destination),ae.style.opacity="1")},[vs]),ui=M.useCallback(async()=>{if(j.current)return;j.current=!0,h(!0);const C=++W.current,P=performance.now();try{for(;H.current.length>0&&C===W.current;){const F=H.current.shift();F&&await Js(F,C,P)}}finally{C===W.current&&(j.current=!1,h(!1))}},[Js]);M.useEffect(()=>{if(!Ca){Z.current="";return}Ca!==Z.current&&(Z.current=Ca,H.current.push(...Ss),ui())},[Ca,Ss,ui]),M.useEffect(()=>()=>{W.current++,H.current=[],j.current=!1,L.current.forEach(C=>{try{C.cancel()}catch{}}),L.current=[],h(!1)},[]),M.useEffect(()=>{W.current++,H.current=[],j.current=!1,L.current.forEach(C=>{try{C.cancel()}catch{}}),L.current=[],h(!1),Z.current="",_([]),Te.current=0,oe.current=0},[t.floor]);const qn=M.useMemo(()=>Bd(ee-1),[]),Rl=M.useMemo(()=>Bd(ee+1),[]),pc=M.useMemo(()=>Bd(ee-2),[]),Zs=M.useMemo(()=>`biome-map-clip-${t.floor}`,[t.floor]),Ie=M.useMemo(()=>({x:ve.minX-ee*2,y:ve.minY-ee*2,width:ve.width+ee*4,height:ve.height+ee*4}),[ve.minX,ve.minY,ve.width,ve.height]);return p.jsx("div",{className:`w-full h-full flex justify-center items-center overflow-hidden transition-transform duration-75 ${A?"animate-shake":""}`,children:p.jsxs("svg",{ref:w,width:"100%",height:"100%",viewBox:`${ve.minX} ${ve.minY} ${ve.width} ${ve.height}`,preserveAspectRatio:"xMidYMid meet",shapeRendering:"geometricPrecision",className:"max-h-full max-w-full",onMouseLeave:()=>E(null),children:[p.jsxs("defs",{children:[p.jsx("clipPath",{id:Zs,clipPathUnits:"userSpaceOnUse",children:xe.map(C=>{const{x:P,y:F}=bt(C,ee);return p.jsx("polygon",{points:pc,transform:`translate(${P},${F})`},`biome-clip-${de(C)}`)})}),Ve&&it==="repeat"&&p.jsxs("pattern",{id:we,patternUnits:"userSpaceOnUse",width:yn,height:yn,patternTransform:`translate(${Dn.x} ${Dn.y})`,children:[p.jsx("image",{href:Ve,x:"0",y:"0",width:yn,height:yn,preserveAspectRatio:"xMidYMid slice"}),(Qn.x!==0||Qn.y!==0)&&p.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${Dn.x} ${Dn.y}`,to:`${Dn.x+Qn.x} ${Dn.y+Qn.y}`,dur:`${Qn.durationMs}ms`,repeatCount:"indefinite"})]}),Fe&&mt==="repeat"&&p.jsx("pattern",{id:be,patternUnits:"userSpaceOnUse",width:jt,height:jt,patternTransform:`translate(${$t.x} ${$t.y})`,children:p.jsx("image",{href:Fe,x:"0",y:"0",width:jt,height:jt,preserveAspectRatio:"xMidYMid slice"})}),Tt&&Hn==="repeat"&&p.jsxs("pattern",{id:ct,patternUnits:"userSpaceOnUse",width:Mn,height:Mn,patternTransform:`translate(${vn.x} ${vn.y})`,children:[p.jsx("image",{href:Tt,x:"0",y:"0",width:Mn,height:Mn,preserveAspectRatio:"xMidYMid slice"}),(Xt.x!==0||Xt.y!==0)&&p.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${vn.x} ${vn.y}`,to:`${vn.x+Xt.x} ${vn.y+Xt.y}`,dur:`${Xt.durationMs}ms`,repeatCount:"indefinite"})]}),cn&&Jn==="repeat"&&p.jsxs("pattern",{id:dn,patternUnits:"userSpaceOnUse",width:un,height:un,patternTransform:`translate(${Kt.x} ${Kt.y})`,children:[p.jsx("image",{href:cn,x:"0",y:"0",width:un,height:un,preserveAspectRatio:"xMidYMid slice"}),(Rn.x!==0||Rn.y!==0)&&p.jsx("animateTransform",{attributeName:"patternTransform",type:"translate",from:`${Kt.x} ${Kt.y}`,to:`${Kt.x+Rn.x} ${Kt.y+Rn.y}`,dur:`${Rn.durationMs}ms`,repeatCount:"indefinite"})]}),xn&&p.jsxs("mask",{id:De,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:[p.jsx("rect",{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,fill:"white"}),Ht.map(C=>p.jsx("polygon",{points:Rl,transform:`translate(${C.x},${C.y})`,fill:"black",opacity:1},`hole-${C.key}`))]})]}),p.jsxs("g",{"data-layer":"biome-undercurrent",pointerEvents:"none",clipPath:`url(#${Zs})`,children:[Ve&&it==="repeat"&&p.jsx("rect",{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,fill:`url(#${we})`,opacity:Ti}),Ve&&it==="cover"&&p.jsx("image",{href:Ve,x:Ie.x+Dn.x,y:Ie.y+Dn.y,width:Ie.width,height:Ie.height,preserveAspectRatio:"xMidYMid slice",opacity:Ti})]}),p.jsxs("g",{"data-layer":"biome-crust",pointerEvents:"none",clipPath:`url(#${Zs})`,children:[Fe&&mt==="repeat"&&p.jsx("rect",{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,fill:`url(#${be})`,opacity:bn,mask:`url(#${De})`}),Fe&&mt==="cover"&&p.jsx("image",{href:Fe,x:Ie.x+$t.x,y:Ie.y+$t.y,width:Ie.width,height:Ie.height,preserveAspectRatio:"xMidYMid slice",opacity:bn,mask:`url(#${De})`}),Tt&&Hn==="repeat"&&pt>0&&p.jsx("rect",{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,fill:`url(#${ct})`,opacity:pt,mask:`url(#${De})`}),Tt&&Hn==="cover"&&pt>0&&p.jsx("image",{href:Tt,x:Ie.x+vn.x,y:Ie.y+vn.y,width:Ie.width,height:Ie.height,preserveAspectRatio:"xMidYMid slice",opacity:pt,mask:`url(#${De})`}),cn&&Jn==="repeat"&&Dt>0&&p.jsx("rect",{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,fill:`url(#${dn})`,opacity:Dt,mask:`url(#${De})`}),cn&&Jn==="cover"&&Dt>0&&p.jsx("image",{href:cn,x:Ie.x+Kt.x,y:Ie.y+Kt.y,width:Ie.width,height:Ie.height,preserveAspectRatio:"xMidYMid slice",opacity:Dt,mask:`url(#${De})`}),_i&&Hi&&p.jsx("rect",{x:Ie.x,y:Ie.y,width:Ie.width,height:Ie.height,fill:Hi,opacity:Gi,mask:`url(#${De})`,style:Ei!=="normal"?{mixBlendMode:Ei}:void 0})]}),p.jsx("g",{"data-layer":"interaction-preview",children:p.jsx(SA,{gameState:t,selectedSkillId:a,showMovementRange:o,hoveredTile:x,enginePreviewGhost:Oe})}),p.jsxs("g",{"data-layer":"interaction-tiles",children:[xe.map(C=>{const P=de(C),F=Ce.get(P)||{isWall:!1,isLava:!1,isFire:!1},ae=F.isWall,ce=F.isLava,pe=F.isFire,he=o&&!a&&re.has(P)||o&&!a&&!Re&&Y.has(P)&&!ae,ot=!!a&&te.has(P)||he,fn=ue.has(P),zn=P===ge,It=O?P===O:!1,_t=ae&&!Wi.has(P),Pt=me&&!_t,mn=_A({isWall:_t,isLava:ce,isFire:pe,theme:t.theme}),pn=Pt?void 0:Ne.get(mn)?.path;return p.jsx(pA,{hex:C,onClick:()=>i(C),isValidMove:ot,isTargeted:fn,isStairs:zn,isLava:ce,isFire:pe,isShrine:It,isWall:_t,onMouseEnter:mc,assetHref:pn,interactionOnly:Pt},P)}),p.jsx("g",{children:B.map(C=>{const{x:P,y:F}=bt(C.position,ee),ae=Date.now()-C.createdAt,ce=Math.max(.18,.75-ae/12e3*.57);return p.jsx("image",{href:C.href,x:P-ee*.7,y:F-ee*.7,width:ee*1.4,height:ee*1.4,preserveAspectRatio:"xMidYMid meet",opacity:ce},C.id)})})]}),p.jsx("g",{"data-layer":"clutter-obstacles",pointerEvents:"none",children:Nl.map(C=>{const{x:P,y:F}=bt(C.position,ee);if(C.asset?.path){const ae=Math.min(1,Math.max(0,C.asset.anchor?.x??.5)),ce=Math.min(1,Math.max(0,C.asset.anchor?.y??.5)),pe=C.kind==="mountain",he=pe?wi.get(C.asset.id)||X(C.asset):null,at=he?he.anchorX:ae,ot=he?he.anchorY:ce,fn=P+(he?he.offsetX:0),zn=F+(he?he.offsetY:0),It=Math.max(8,C.asset.width*Lt*C.renderScale),_t=Math.max(8,C.asset.height*Lt*C.renderScale),Pt=C.kind==="shrine",mn=C.kind==="stairs",pn=Pt||mn,Na=Pt?"rgba(251,146,60,0.25)":"rgba(74,222,128,0.22)",Oi=Pt?"#fdba74":"#86efac",Ra=P,ka=F-_t*ot+_t*.84,Xi=Math.max(14,It*.32),Qi=Math.max(8,_t*.14);return p.jsxs("g",{children:[pn&&p.jsxs(p.Fragment,{children:[p.jsx("ellipse",{cx:Ra,cy:ka,rx:Xi,ry:Qi,fill:Na,opacity:.95}),p.jsx("ellipse",{cx:Ra,cy:ka,rx:Xi*1.14,ry:Qi*1.14,fill:"none",stroke:Oi,strokeWidth:2,opacity:.72,style:{animation:`shrineGlow ${Pt?1.8:2.4}s ease-in-out infinite`}})]}),(()=>{const kl=pn?Pt?"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(251,146,60,0.45)) saturate(1.08) contrast(1.06)":"drop-shadow(0 4px 6px rgba(0,0,0,0.55)) drop-shadow(0 0 4px rgba(74,222,128,0.42)) saturate(1.08) contrast(1.06)":pe?"drop-shadow(0 7px 10px rgba(0,0,0,0.56)) saturate(1.04) contrast(1.08)":"drop-shadow(0 5px 8px rgba(0,0,0,0.48)) saturate(0.98) contrast(1.04)",bo=pn?.99:pe?.96:.9,La=!!(he&&he.crustBlendMode!=="off"&&he.crustBlendOpacity>0),Ji=!!(he&&he.tintBlendMode!=="off"&&he.tintOpacity>0),Ci=he?.crustBlendMode!=="off"?he?.crustBlendMode:void 0,So=he?.tintBlendMode!=="off"?he?.tintBlendMode:void 0,Ui=fn-It*at,Zn=zn-_t*ot,ea=FA(C.id),ta=`mountain-ground-gradient-${t.floor}-${ea}`,vo=`mountain-ground-mask-${t.floor}-${ea}`,na=`mountain-tint-filter-${t.floor}-${ea}`;return p.jsxs(p.Fragment,{children:[(La||Ji)&&p.jsxs("defs",{children:[La&&p.jsxs(p.Fragment,{children:[p.jsxs("linearGradient",{id:ta,x1:"0",y1:"0",x2:"0",y2:"1",children:[p.jsx("stop",{offset:"0%",stopColor:"#ffffff",stopOpacity:"0"}),p.jsx("stop",{offset:"42%",stopColor:"#ffffff",stopOpacity:"0.04"}),p.jsx("stop",{offset:"64%",stopColor:"#ffffff",stopOpacity:"0.42"}),p.jsx("stop",{offset:"82%",stopColor:"#ffffff",stopOpacity:"0.82"}),p.jsx("stop",{offset:"100%",stopColor:"#ffffff",stopOpacity:"1"})]}),p.jsx("mask",{id:vo,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse",children:p.jsx("rect",{x:Ui,y:Zn,width:It,height:_t,fill:`url(#${ta})`})})]}),Ji&&p.jsx("filter",{id:na,x:"-10%",y:"-10%",width:"120%",height:"120%",children:p.jsx("feColorMatrix",{type:"matrix",values:he?.tintMatrixValues})})]}),p.jsx("image",{href:C.asset.path,x:Ui,y:Zn,width:It,height:_t,preserveAspectRatio:"xMidYMid meet",opacity:bo,style:{filter:kl}}),La&&p.jsx("image",{href:C.asset.path,x:Ui,y:Zn,width:It,height:_t,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.9,he?.crustBlendOpacity||0),mask:`url(#${vo})`,style:{mixBlendMode:Ci,filter:"brightness(0.92) saturate(0.76) contrast(1.03)"}}),Ji&&p.jsx("image",{href:C.asset.path,x:Ui,y:Zn,width:It,height:_t,preserveAspectRatio:"xMidYMid meet",opacity:Math.min(.95,he?.tintOpacity||0),filter:`url(#${na})`,style:{mixBlendMode:So}})]})})()]},C.id)}return C.fallback==="shrine"?p.jsxs("g",{transform:`translate(${P},${F})`,children:[p.jsx("polygon",{points:"0,-18 8,-4 5,12 -5,12 -8,-4",fill:"#f97316",stroke:"#fff",strokeWidth:"1",opacity:"0.9"}),p.jsx("polygon",{points:"-2,-14 2,-14 1,-2 -1,-2",fill:"rgba(255,255,255,0.6)"}),p.jsx("circle",{cx:"0",cy:"0",r:"14",fill:"none",stroke:"#fdba74",strokeWidth:"2",opacity:"0.4",style:{animation:"shrineGlow 2s ease-in-out infinite"}})]},C.id):p.jsxs("g",{transform:`translate(${P},${F})`,children:[p.jsx("rect",{x:"-12",y:"6",width:"8",height:"4",fill:"#1f2937",rx:"1"}),p.jsx("rect",{x:"-6",y:"2",width:"8",height:"4",fill:"#374151",rx:"1"}),p.jsx("rect",{x:"0",y:"-2",width:"8",height:"4",fill:"#4b5563",rx:"1"}),p.jsx("rect",{x:"6",y:"-6",width:"8",height:"4",fill:"#6b7280",rx:"1"}),p.jsx("path",{d:"M 2 -14 L 2 -20 L -4 -20 L 2 -26 L 8 -20 L 2 -20",fill:"#22c55e",stroke:"#16a34a",strokeWidth:"1"})]},C.id)})}),p.jsxs("g",{children:[t.lastSpearPath&&t.lastSpearPath.length>=2&&(()=>{const P=t.lastSpearPath.map(F=>bt(F,ee)).map((F,ae)=>`${ae===0?"M":"L"} ${F.x} ${F.y}`).join(" ");return p.jsx("path",{d:P,stroke:"rgba(255, 255, 255, 0.15)",strokeWidth:"2",fill:"none",strokeDasharray:"4 2",strokeLinecap:"round"})})(),t.spearPosition&&p.jsx(Fr,{entity:{id:"spear",type:"player",subtype:"footman",position:t.spearPosition,hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],speed:0,factionId:"player"},isSpear:!0}),p.jsx(Fr,{entity:t.player,movementTrace:V[t.player.id],waapiControlled:!0,assetHref:Ne.get(ic(t.player))?.path,fallbackAssetHref:kd(t.player),floorTheme:ze},`player-${t.floor}`),t.enemies.map(C=>p.jsx(Fr,{entity:C,movementTrace:V[C.id],waapiControlled:!0,assetHref:Ne.get(ic(C))?.path,fallbackAssetHref:kd(C),floorTheme:ze},`${C.id}-${t.floor}`)),t.dyingEntities?.map(C=>p.jsx(Fr,{entity:C,isDying:!0,movementTrace:V[C.id],waapiControlled:!0,assetHref:Ne.get(ic(C))?.path,fallbackAssetHref:kd(C),floorTheme:ze},`dying-${C.id}-${t.floor}-${t.turnNumber}`)),p.jsx(LA,{visualEvents:t.visualEvents||[],timelineEvents:t.timelineEvents||[],onBusyStateChange:k,assetManifest:r})]}),p.jsx("g",{"data-layer":"interaction-ui-grid",pointerEvents:"none",shapeRendering:"crispEdges",children:xe.map(C=>{const{x:P,y:F}=bt(C,ee);return p.jsx("g",{transform:`translate(${P},${F})`,children:p.jsx("polygon",{points:qn,fill:"none",stroke:"rgba(201,224,255,0.22)",strokeWidth:1.1})},`grid-${de(C)}`)})}),p.jsx("g",{"data-layer":"ui-objective-markers",pointerEvents:"none",children:Un.map(C=>{const{x:P,y:F}=bt(C.position,ee),ae=C.kind==="shrine",ce=ae?"#c2410c":"#15803d",pe=ae?"S":"E",he=P+ee*.52,at=F-ee*.52;return p.jsxs("g",{transform:`translate(${he},${at})`,children:[p.jsx("circle",{r:14,fill:"none",stroke:"rgba(255,255,255,0.55)",strokeWidth:2,style:{animation:`shrineGlow ${ae?1.6:1.9}s ease-in-out infinite`}}),p.jsx("circle",{r:10.5,fill:ce,stroke:"#ffffff",strokeWidth:2}),p.jsx("text",{x:0,y:0,textAnchor:"middle",dy:".34em",fill:"#ffffff",fontSize:10,fontWeight:900,style:{textShadow:"0 1px 2px rgba(0,0,0,0.7)"},children:pe})]},`marker-${C.id}`)})})]})})},GA=({gameState:t})=>{const{initiativeQueue:i,player:a,enemies:o}=t;if(!i||!i.entries||i.entries.length===0)return null;const c=i.entries.map(r=>r.actorId===a.id?a:o.find(f=>f.id===r.actorId)).filter(r=>!!r);return p.jsxs("div",{className:"flex flex-col gap-2 p-4 bg-white/5 border border-white/10 rounded-2xl backdrop-blur-md",children:[p.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Turn Sequence"}),p.jsx("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 scrollbar-none",children:c.map((r,f)=>{const g=r.id===a.id,b=f===i.currentIndex,A=i.entries.find(v=>v.actorId===r.id)?.hasActed;return p.jsxs("div",{className:`flex flex-col items-center shrink-0 transition-all duration-300 ${b?"scale-110":"opacity-60 scale-90"}`,children:[p.jsxs("div",{className:`
                                w-10 h-10 rounded-xl flex items-center justify-center border-2 transition-all relative
                                ${g?"bg-blue-500/20 border-blue-500/50":"bg-red-500/20 border-red-500/50"}
                                ${b?"shadow-[0_0_15px_rgba(255,255,255,0.2)] border-white/80":""}
                                ${A?"grayscale":""}
                            `,children:[p.jsx("span",{className:"text-xl",children:Ml(r.subtype,r.type,r.enemyType,r.archetype).icon}),b&&p.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-white rounded-full animate-ping"}),A&&!b&&p.jsx("div",{className:"absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center border-2 border-[#030712] text-[8px]",children:""})]}),p.jsx("div",{className:"w-8 h-1 bg-white/10 rounded-full mt-2 overflow-hidden",children:p.jsx("div",{className:`h-full ${g?"bg-blue-400":"bg-red-400"}`,style:{width:`${r.hp/r.maxHp*100}%`}})}),p.jsx("span",{className:`text-[8px] font-bold uppercase mt-1 ${g?"text-blue-300":"text-red-300"} ${b?"text-white":""}`,children:g?"You":r.subtype||"Enemy"})]},`${r.id}-${f}`)})})]})},WA=({gameState:t,onReset:i,onWait:a,onExitToHub:o,inputLocked:c=!1})=>{const r=ty(t),f=Array.isArray(t.message)?t.message:[],g=Bi.useRef(null),[b,y]=Bi.useState("all"),[A,v]=Bi.useState("all"),x=(h,R)=>{const k=h||"",B=k.toLowerCase(),_=k.match(/^\[(INFO|VERBOSE|DEBUG|CRITICAL)\|([A-Z_]+)\]\s*(.*)$/i);if(_){const j=_[1].toLowerCase(),L=_[2].toLowerCase(),W=_[3]||"",Z=L.includes("combat")?"combat":L.includes("hazard")?"hazard":L.includes("objective")||L.includes("score")?"objective":L.includes("ai")?"ai":"system";return{idx:R,raw:h,text:W,level:j,channel:Z}}const w=/(attacked|killed|blast|stunned|damage|hit|healed|shield|bash|spear|fireball|jump|dash)/i.test(B)?"combat":/(lava|burn|hazard|void|sink|fire damage)/i.test(B)?"hazard":/(score|objective|floor|stairs|descending|arcade cleared)/i.test(B)?"objective":/(enemy|falcon|intent|telegraph|moves to|repositioning|attacks)/i.test(B)?"ai":"system",H=/(fallen|warning|error|failed|invalid|blocked|cannot)/i.test(B)?"critical":/(debug|trace|telemetry|seed|counter|rng)/i.test(B)?"debug":/(marks the impact zone|telegraph|planning|intent)/i.test(B)?"verbose":"info";return{idx:R,raw:h,text:k,level:H,channel:w}},E=Bi.useMemo(()=>f.map((h,R)=>x(h,R)),[f]),m=Bi.useMemo(()=>E.filter(h=>(b==="all"||h.level===b)&&(A==="all"||h.channel===A)),[E,b,A]);return Bi.useEffect(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[m]),p.jsxs("div",{className:"flex flex-col h-full max-h-screen",children:[p.jsxs("div",{className:"flex flex-col gap-8 p-8 overflow-y-auto flex-1 min-h-0",children:[p.jsxs("div",{className:"flex justify-between items-start",children:[p.jsxs("div",{children:[p.jsx("h1",{className:"text-xl font-black uppercase tracking-widest text-white/90 mb-1",children:"Hoplite"}),p.jsx("p",{className:"text-[10px] font-bold text-white/30 uppercase tracking-[0.2em]",children:"Tactical Arena"})]}),p.jsx("div",{className:"px-2 py-1 bg-white/10 rounded border border-white/20 text-[10px] font-black text-white/60",children:"V2.1.0"})]}),p.jsx(GA,{gameState:t}),p.jsxs("div",{className:"space-y-6",children:[p.jsxs("div",{className:"flex flex-col",children:[p.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Vitality"}),p.jsxs("div",{className:"flex items-end gap-2",children:[p.jsx("span",{className:"text-4xl font-black text-red-500 leading-none",children:t.player.hp}),p.jsx("span",{className:"text-xl text-white/20 font-bold leading-none mb-1",children:"/"}),p.jsx("span",{className:"text-xl text-gray-500 font-bold leading-none mb-1",children:t.player.maxHp})]})]}),p.jsxs("div",{className:"flex flex-col",children:[p.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-2",children:"Guardian Plating"}),p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsx("div",{className:`w-3 h-3 rounded-sm ${t.player.temporaryArmor?"bg-blue-400 rotate-45":"bg-white/5 border border-white/10"}`}),p.jsx("span",{className:"text-2xl font-black text-blue-400 leading-none",children:t.player.temporaryArmor||0})]})]}),t.enemies.filter(h=>h.subtype==="sentinel").map(h=>p.jsxs("div",{className:"pt-4 animate-in slide-in-from-right-8 duration-500",children:[p.jsxs("div",{className:"flex justify-between items-end mb-2",children:[p.jsx("span",{className:"text-xs font-black text-red-500 uppercase tracking-tighter italic",children:"Sentinel Directive"}),p.jsxs("span",{className:"text-lg font-black",children:[h.hp," ",p.jsxs("span",{className:"text-white/20 text-xs",children:["/ ",h.maxHp]})]})]}),p.jsx("div",{className:"h-4 w-full bg-red-950/30 rounded-md border border-red-500/20 overflow-hidden",children:p.jsx("div",{className:"h-full bg-gradient-to-r from-red-600 to-red-400 shadow-[0_0_20px_rgba(239,68,68,0.4)] transition-all duration-300",style:{width:`${h.hp/h.maxHp*100}%`}})})]},h.id))]}),p.jsxs("div",{className:"py-8 border-y border-white/5 space-y-6",children:[p.jsxs("div",{className:"flex flex-col gap-3",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Arcade Progress"}),p.jsxs("span",{className:"text-xl font-black",children:[t.floor," ",p.jsx("span",{className:"text-white/20 text-sm",children:"/ 10"})]})]}),p.jsx("div",{className:"h-1.5 w-full bg-white/5 rounded-full overflow-hidden border border-white/5",children:p.jsx("div",{className:"h-full bg-indigo-500 shadow-[0_0_15px_rgba(99,102,241,0.4)] transition-all duration-1000 ease-out",style:{width:`${t.floor/10*100}%`}})})]}),p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold",children:"Current Score"}),p.jsx("span",{className:"text-xl font-black text-white",children:r.toLocaleString()})]})]}),p.jsxs("div",{className:"flex flex-col gap-3",children:[p.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold mb-1",children:"Directives"}),p.jsxs("button",{disabled:c,onClick:a,className:`w-full flex justify-between items-center px-4 py-3 border rounded-xl transition-all group ${c?"bg-white/[0.03] border-white/5 text-white/30 cursor-not-allowed opacity-50":"bg-white/5 hover:bg-white/10 border-white/10"}`,children:[p.jsx("span",{className:"text-sm font-bold text-white/70",children:"Secure & Wait"}),p.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),p.jsxs("button",{onClick:i,className:"w-full flex justify-between items-center px-4 py-3 bg-red-500/10 hover:bg-red-500/20 border border-red-500/20 rounded-xl transition-all group",children:[p.jsx("span",{className:"text-sm font-bold text-red-400/80",children:"Reset Chronology"}),p.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]}),p.jsxs("button",{onClick:o,className:"w-full flex justify-between items-center px-4 py-3 bg-white/5 hover:bg-white/10 border border-white/10 rounded-xl transition-all group",children:[p.jsx("span",{className:"text-sm font-bold text-white/70",children:"Return to Hub"}),p.jsx("span",{className:"text-lg grayscale group-hover:grayscale-0 transition-all",children:""})]})]})]}),f.length>0&&p.jsxs("div",{className:"p-8 border-t border-white/5 bg-[#030712]/80 backdrop-blur-sm",children:[p.jsxs("div",{className:"flex items-center justify-between mb-3",children:[p.jsx("span",{className:"text-[10px] uppercase tracking-widest text-white/40 font-bold block",children:"Tactical Log"}),p.jsxs("div",{className:"flex items-center gap-2",children:[p.jsxs("select",{value:A,onChange:h=>v(h.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[p.jsx("option",{value:"all",children:"All Channels"}),p.jsx("option",{value:"combat",children:"Combat"}),p.jsx("option",{value:"hazard",children:"Hazard"}),p.jsx("option",{value:"objective",children:"Objective"}),p.jsx("option",{value:"ai",children:"AI"}),p.jsx("option",{value:"system",children:"System"})]}),p.jsxs("select",{value:b,onChange:h=>y(h.target.value),className:"text-[10px] bg-white/5 border border-white/10 rounded px-2 py-1 text-white/80",children:[p.jsx("option",{value:"all",children:"All Levels"}),p.jsx("option",{value:"info",children:"Info"}),p.jsx("option",{value:"verbose",children:"Verbose"}),p.jsx("option",{value:"debug",children:"Debug"}),p.jsx("option",{value:"critical",children:"Critical"})]})]})]}),p.jsxs("div",{ref:g,className:"flex flex-col gap-2 bg-white/[0.02] border border-white/5 p-4 rounded-2xl overflow-y-auto max-h-[140px]",children:[m.slice(-20).map(h=>p.jsxs("div",{className:"flex gap-2 items-start",children:[p.jsxs("span",{className:"text-[10px] text-white/20 font-bold mt-1 leading-none shrink-0",children:["[",h.idx,"]"]}),p.jsx("span",{className:`text-[9px] mt-1 px-1.5 py-0.5 rounded border shrink-0 ${h.level==="critical"?"text-red-300 border-red-400/40 bg-red-500/10":h.level==="debug"?"text-cyan-300 border-cyan-400/40 bg-cyan-500/10":h.level==="verbose"?"text-amber-300 border-amber-400/40 bg-amber-500/10":"text-white/60 border-white/20 bg-white/5"}`,children:h.level.toUpperCase()}),p.jsx("span",{className:"text-[9px] mt-1 px-1.5 py-0.5 rounded border border-white/20 bg-white/5 text-white/60 shrink-0",children:h.channel.toUpperCase()}),p.jsx("p",{className:"text-[11px] leading-tight text-white/70 font-medium whitespace-pre-wrap",children:h.text})]},h.idx)),m.length===0&&p.jsx("div",{className:"text-[11px] text-white/40 italic",children:"No messages match current filters."})]})]})]})},XA=({onSelect:t,gameState:i})=>{const a=i.player,o=[{id:"EXTRA_HP",label:" Extra Heart",desc:"Increases your Max HP by 1 and heals you to full.",color:"bg-red-900/40 border-red-500"}],c=[];for(const b of a.activeSkills||[])for(const y of b.upgrades)if(!b.activeUpgrades.includes(y)){const A=Nn.getUpgrade(y);A&&c.push({id:y,label:` ${A.name}`,desc:A.description,color:b.slot==="offensive"?"bg-orange-900/40 border-orange-500":b.slot==="defensive"?"bg-blue-900/40 border-blue-500":"bg-green-900/40 border-green-500"})}const f=[...c].sort(()=>Math.random()-.5).slice(0,3),g=[...o,...f];return p.jsx("div",{className:"fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-[100] p-4",children:p.jsxs("div",{className:"bg-gray-900 p-8 rounded-3xl border-2 border-slate-700 max-w-2xl w-full shadow-2xl relative overflow-hidden",children:[p.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-blue-500 to-green-500"}),p.jsx("h2",{className:"text-4xl font-black text-white mb-2 text-center tracking-tight",children:"SHRINE BLESSING"}),p.jsx("p",{className:"text-slate-400 mb-8 text-center text-lg",children:"The gods offer you a choice. Choose wisely."}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.map(b=>p.jsxs("button",{onClick:()=>t(b.id),className:`
                                relative p-6 border-2 rounded-2xl text-left transition-all group overflow-hidden
                                hover:scale-[1.02] active:scale-[0.98]
                                ${b.color} hover:bg-slate-800
                            `,children:[p.jsx("h3",{className:"text-xl font-bold text-white mb-2 group-hover:text-blue-200",children:b.label}),p.jsx("p",{className:"text-sm text-slate-400 group-hover:text-slate-300 leading-relaxed",children:b.desc}),p.jsx("div",{className:"absolute -right-2 -bottom-2 opacity-0 group-hover:opacity-10 scale-0 group-hover:scale-150 transition-all font-bold text-4xl",children:""})]},b.id))})]})})},QA=({skills:t,selectedSkillId:i,onSelectSkill:a,hasSpear:o,gameState:c,inputLocked:r=!1})=>{const f=["offensive","defensive","utility"];return p.jsx("div",{className:"flex flex-col gap-4",children:f.flatMap(g=>t.filter(y=>y.slot===g).map(y=>{const A=i===y.id,v=y.currentCooldown>0,x=y.id==="SPEAR_THROW",E=r||v&&!x||x&&!o,m=x1(y.id),h=m?.name||y.name,R=typeof h=="function"?h(c):h,k=m?.icon||"";return p.jsxs("button",{disabled:E,onClick:()=>a(A?null:y.id),className:`
                            relative w-full h-24 rounded-2xl flex flex-col items-center justify-center gap-1
                            border transition-all transform hover:translate-x-1
                            ${A?"bg-blue-600 border-white shadow-[0_0_20px_rgba(59,130,246,0.5)]":"bg-white/5 border-white/10 hover:border-blue-500/50"}
                            ${E?"opacity-40 grayscale pointer-events-none":"cursor-pointer"}
                        `,children:[p.jsx("span",{className:"text-3xl",children:k}),p.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest text-white/50 text-center px-2",children:R}),v&&!x&&p.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded-2xl backdrop-blur-[2px]",children:p.jsx("span",{className:"text-3xl font-black text-white",children:y.currentCooldown})}),p.jsx("div",{className:"absolute -top-2 left-4 px-2 py-0.5 bg-[#030712] rounded-full border border-white/10 text-[8px] uppercase font-black tracking-widest text-white/40",children:g})]},y.id)}))})},JA=({onSelect:t})=>p.jsxs("div",{className:"relative z-50 flex flex-col items-center justify-center p-8 gap-8 animate-in fade-in zoom-in duration-500",children:[p.jsxs("div",{className:"text-center space-y-2",children:[p.jsx("h1",{className:"text-4xl font-black uppercase tracking-widest text-white mb-2",children:"Select Class"}),p.jsx("p",{className:"text-white/40 text-sm uppercase tracking-wider",children:"Choose your combat doctrine"})]}),p.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-4xl",children:Object.values(ho).map(i=>p.jsxs("button",{onClick:()=>{console.log("Archetype Selected:",i.id),t(i)},className:"group relative flex flex-col items-start p-8 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-white/30 rounded-3xl transition-all hover:scale-[1.02] text-left cursor-pointer",children:[p.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/5 to-transparent opacity-0 group-hover:opacity-100 rounded-3xl transition-opacity"}),p.jsxs("div",{className:"relative z-10 w-full",children:[p.jsxs("div",{className:"flex justify-between items-start mb-4",children:[p.jsx("div",{className:"p-3 bg-white/5 rounded-xl border border-white/10 group-hover:border-white/30 transition-colors",children:p.jsx("span",{className:"text-3xl",children:Ml(i.id==="ASSASSIN"?"assassin_player":i.id.toLowerCase(),"player").icon})}),p.jsx("div",{className:"px-3 py-1 bg-white/5 rounded-full border border-white/10 text-[10px] font-bold uppercase tracking-widest text-white/50",children:i.id==="VANGUARD"?"Standard":"Advanced"})]}),p.jsx("h3",{className:"text-2xl font-black uppercase tracking-wide text-white mb-2",children:i.name}),p.jsx("p",{className:"text-white/60 text-sm leading-relaxed mb-6 h-12",children:i.description}),p.jsxs("div",{className:"space-y-3",children:[p.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/30 font-bold border-b border-white/5 pb-1",children:"Starting Loadout"}),p.jsx("div",{className:"flex flex-wrap gap-2",children:i.startingSkills.map(a=>p.jsx("div",{className:"px-2 py-1 bg-black/40 rounded border border-white/10 text-[10px] text-blue-200",children:a.replace("_"," ")},a))})]})]})]},i.id))})]}),ZA="hop_replays_v1",eT="hop_leaderboard_v1",zg=()=>{try{const t=localStorage.getItem(ZA);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load replays",t),[]}},Vg=()=>{try{const t=localStorage.getItem(eT);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load leaderboard",t),[]}},$g=t=>{const i=Array.isArray(t.actions)?t.actions:[],a=new Set(i.map(y=>y?.type)),o=a.has("ADVANCE_TURN"),c=a.has("RESOLVE_PENDING"),r=(t.floor||0)>=5&&i.length<Math.max(25,(t.floor||0)*4),f=(t.replayVersion??1)<2,g=i.length===0,b=g?"invalid replay":r?"truncated replay":f?"legacy replay":null;return{isLegacy:f,invalid:g,suspicious:r||t.floor>1&&!c,label:b,hasTurnAdvance:o,hasPendingResolve:c,actionCount:i.length}},tT=({onStartReplay:t})=>{const[i,a]=M.useState(()=>zg()),[o,c]=M.useState(()=>Vg()),[r,f]=M.useState(""),[g,b]=M.useState(""),[y,A]=M.useState(""),[v,x]=M.useState(null);M.useEffect(()=>{const h=()=>{a(zg()),c(Vg())};return window.addEventListener("storage",h),()=>window.removeEventListener("storage",h)},[]);const E=()=>{x(null);try{const h=y.trim();if(!h)return x("Paste actions JSON first."),null;const R=JSON.parse(h);let k=r.trim()||void 0,B=g.trim()||void 0,_=[];return Array.isArray(R)?_=R:R&&typeof R=="object"&&(_=Array.isArray(R.actions)?R.actions:[],k=k||(typeof R.seed=="string"?R.seed:void 0),B=B||(typeof R.loadoutId=="string"?R.loadoutId:void 0)),!Array.isArray(_)||_.length===0?(x('No actions found. Provide a JSON action array or object with "actions".'),null):_.filter(j=>j&&typeof j.type=="string").length===0?(x('Actions must be objects with a "type" field.'),null):{id:`manual-${Date.now()}`,seed:k,loadoutId:B,actions:_,score:0,floor:1,date:new Date().toISOString(),replayVersion:2,diagnostics:{actionCount:_.length,hasTurnAdvance:_.some(j=>j?.type==="ADVANCE_TURN"),hasPendingResolve:_.some(j=>j?.type==="RESOLVE_PENDING"),suspiciouslyShort:!1}}}catch(h){return x(`Invalid JSON: ${h?.message||"parse error"}`),null}},m=()=>{const h=E();h&&t(h)};return p.jsxs("div",{className:"flex flex-col gap-8",children:[p.jsxs("section",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-emerald-400",children:"Manual Replay"}),p.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Paste from UPA"})]}),p.jsxs("div",{className:"space-y-2 p-3 rounded-2xl border border-white/5 bg-white/[0.02]",children:[p.jsx("input",{value:r,onChange:h=>f(h.target.value),placeholder:"Seed (optional if included in JSON)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),p.jsx("input",{value:g,onChange:h=>b(h.target.value),placeholder:"Loadout ID (optional)",className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40"}),p.jsx("textarea",{value:y,onChange:h=>A(h.target.value),placeholder:'Paste JSON actions array, or object: {"seed":"...","loadoutId":"...","actions":[...]}',rows:6,className:"w-full bg-black/30 border border-white/10 rounded-lg px-3 py-2 text-xs text-white outline-none focus:border-emerald-400/40 font-mono"}),v&&p.jsx("div",{className:"text-[10px] text-red-400 font-bold uppercase tracking-wider",children:v}),p.jsx("button",{onClick:m,className:"w-full py-2 rounded-lg bg-emerald-500/20 hover:bg-emerald-500/30 border border-emerald-400/30 text-emerald-300 text-xs font-black uppercase tracking-widest transition-colors",children:"Start Manual Replay"})]})]}),p.jsxs("section",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-4",children:[p.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400",children:"Hall of Fame"}),p.jsx("span",{className:"text-[10px] text-white/20 font-bold uppercase tracking-widest",children:"Top 5 Only"})]}),p.jsxs("div",{className:"space-y-2",children:[o.length===0&&p.jsx("div",{className:"p-4 rounded-xl border border-white/5 bg-white/[0.02] text-center",children:p.jsx("span",{className:"text-[10px] text-white/30 uppercase font-black",children:"No Champions Yet"})}),o.slice(0,5).map((h,R)=>{const k={id:h.id,seed:h.seed,loadoutId:h.loadoutId,actions:h.actions||[],score:h.score,floor:h.floor,date:h.date,replayVersion:h.replayVersion,diagnostics:h.diagnostics},B=$g(k);return p.jsxs("button",{onClick:()=>t(k),className:"w-full group relative flex items-center gap-4 p-4 bg-white/[0.03] hover:bg-white/[0.07] border border-white/5 hover:border-indigo-500/30 rounded-2xl transition-all text-left",children:[p.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-indigo-500/10 rounded-lg text-indigo-400 font-black text-sm border border-indigo-500/20",children:R+1}),p.jsxs("div",{className:"flex-1 min-w-0",children:[p.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[p.jsx("span",{className:"font-black text-white uppercase text-xs truncate tracking-wider",children:h.name}),p.jsx("span",{className:"text-[10px] font-black text-indigo-400 tabular-nums",children:h.score.toLocaleString()})]}),p.jsxs("div",{className:"text-[9px] text-white/30 font-bold uppercase tracking-widest",children:["Floor ",h.floor," * ",new Date(h.date).toLocaleDateString()," * ",B.actionCount," acts"]}),B.label&&p.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:B.label})]}),p.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity text-indigo-400 text-xs",children:"Play"})]},h.id)})]})]}),p.jsxs("section",{children:[p.jsx("div",{className:"flex items-center justify-between mb-4",children:p.jsx("h3",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-white/30",children:"Recent Simulations"})}),p.jsxs("div",{className:"space-y-1 max-h-[300px] overflow-y-auto custom-scrollbar pr-2",children:[i.length===0&&p.jsx("div",{className:"text-center py-4",children:p.jsx("span",{className:"text-[10px] text-white/10 uppercase font-bold",children:"Log Empty"})}),i.slice(0,10).map(h=>{const R=$g(h);return p.jsxs("button",{onClick:()=>t(h),className:"w-full flex items-center justify-between p-3 hover:bg-white/[0.04] rounded-xl transition-colors text-left group",children:[p.jsxs("div",{className:"min-w-0",children:[p.jsxs("div",{className:"text-[10px] font-bold text-white/60 mb-0.5 truncate uppercase",children:["Score: ",p.jsx("span",{className:"text-white",children:h.score})," * F",h.floor," * ",R.actionCount," acts"]}),p.jsx("div",{className:"text-[9px] text-white/20 font-medium",children:new Date(h.date).toLocaleTimeString()}),R.label&&p.jsx("div",{className:"text-[9px] mt-1 text-amber-400/80 font-bold uppercase tracking-widest",children:R.label})]}),p.jsx("div",{className:"text-[10px] text-white/0 group-hover:text-white/40 font-black uppercase tracking-widest transition-all",children:"Replay"})]},h.id)})]})]})]})};class nT{state;constructor(){this.state=gs(1,"tutorial-seed"),this.state.enemies=[],this.state.tiles=new Map}setPlayer(i,a){this.state.player={...this.state.player,position:i,previousPosition:i,activeSkills:a.map(o=>{const c=Nn.get(o);return{id:o,name:typeof c?.name=="function"?c.name(this.state):c?.name||o,description:c?.description||"",slot:c?.slot||"offensive",cooldown:c?.baseVariables.cooldown||0,currentCooldown:0,range:c?.baseVariables.range||0,upgrades:Object.keys(c?.upgrades||{}),activeUpgrades:[]}})}}spawnEnemy(i,a,o){const c=Pd[i]||{hp:1,maxHp:1};this.state.enemies.push({id:o,type:"enemy",subtype:i,position:a,previousPosition:a,hp:c.hp,maxHp:c.maxHp,enemyType:c.type||"melee",statusEffects:[],temporaryArmor:0,activeSkills:[],speed:c.speed||1,factionId:"enemy"})}spawnFalcon(i,a){const o={id:a,type:"enemy",subtype:"falcon",factionId:"player",speed:95,position:{...i},previousPosition:{...i},hp:1,maxHp:1,statusEffects:[],temporaryArmor:0,activeSkills:[],isFlying:!0,companionOf:"player",companionState:{mode:"roost",orbitStep:0,apexStrikeCooldown:0}};this.state.enemies.push(o),this.state.companions||(this.state.companions=[]),this.state.companions.push(o)}spawnCompanion(i,a,o){i==="falcon"&&this.spawnFalcon(a,o)}setTile(i,a){const o=a.toUpperCase(),c=de(i),r=mo[o];if(!r){console.warn(`Attempted to set unknown tile type: ${o}`);return}this.state.tiles.set(c,{baseId:o,position:i,traits:new Set(r.defaultTraits||[]),effects:[],occupantId:void 0})}addUpgrade(i,a){this.state.player.activeSkills=(this.state.player.activeSkills||[]).map(o=>o.id===i?{...o,activeUpgrades:[...o.activeUpgrades,a]}:o)}useSkill(i,a){}wait(){}move(i){}getEnemy(i){return this.state.enemies.find(a=>a.id===i)}setTurn(i){this.state.turnNumber=i}exitToHub(){}applyStatus(i,a){const o=this.state.enemies.findIndex(c=>c.id===i);o!==-1&&(this.state.enemies[o]=Ud(this.state.enemies[o],a,1))}}const iT=({onLoadScenario:t})=>{const i=Object.values(fc),a=o=>{const c=new nT;o.setup(c),c.state.initiativeQueue=Ma(c.state),t(c.state,o.description)};return p.jsx("div",{className:"flex flex-col gap-4",children:i.map(o=>p.jsxs("div",{className:"flex flex-col gap-2",children:[p.jsx("h4",{className:"text-[10px] font-bold uppercase tracking-wider text-white/50",children:typeof o.name=="function"?o.name(gs(1,"temp")):o.name}),p.jsx("div",{className:"flex flex-col gap-1",children:o.scenarios?.map(c=>p.jsx("button",{onClick:()=>a(c),className:"text-left px-3 py-2 bg-white/5 hover:bg-white/10 rounded text-xs text-white/80 transition-colors border border-transparent hover:border-white/20",children:c.title},c.id))})]},o.id))})},sT=({gameState:t,onSelectLoadout:i,onStartRun:a,onOpenArcade:o,onLoadScenario:c,onStartReplay:r})=>p.jsxs("div",{className:"w-full h-full flex flex-col bg-[#020617]",children:[p.jsxs("header",{className:"h-20 border-b border-white/5 flex items-center justify-between px-12 bg-[#030712]/50 backdrop-blur-xl z-30",children:[p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("div",{className:"w-10 h-10 bg-indigo-500 rounded-lg flex items-center justify-center font-black text-xl shadow-[0_0_20px_rgba(99,102,241,0.5)]",children:"H"}),p.jsxs("div",{children:[p.jsxs("h1",{className:"text-lg font-black uppercase tracking-tighter leading-none italic",children:["Hop ",p.jsx("span",{className:"text-indigo-500",children:"Engine"})]}),p.jsx("div",{className:"text-[10px] font-bold text-white/30 tracking-[0.3em] uppercase mt-1",children:"Strategic Hub v5.0"})]})]}),p.jsxs("div",{className:"flex items-center gap-8",children:[p.jsxs("div",{className:"text-right",children:[p.jsx("div",{className:"text-[10px] uppercase tracking-widest text-white/40 mb-1",children:"Current Loadout"}),p.jsx("div",{className:"text-sm font-bold text-indigo-400",children:t.selectedLoadoutId||"No Archetype Selected"})]}),t.selectedLoadoutId&&p.jsxs("div",{className:"flex items-center gap-3",children:[p.jsxs("button",{onClick:()=>a("normal"),className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-black uppercase text-sm tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_30px_rgba(79,70,229,0.3)] flex flex-col items-center justify-center leading-tight",children:[p.jsx("span",{children:"Start Run"}),p.jsx("span",{className:"text-[9px] opacity-50 tracking-[0.2em]",children:"10 Floors | Boss Defeat"})]}),p.jsxs("button",{onClick:()=>a("daily"),className:"px-6 py-3 bg-emerald-600 hover:bg-emerald-500 text-white rounded-xl font-black uppercase text-sm tracking-widest transition-all hover:scale-105 active:scale-95 shadow-[0_0_30px_rgba(16,185,129,0.3)] flex flex-col items-center justify-center leading-tight",children:[p.jsx("span",{children:"Daily"}),p.jsx("span",{className:"text-[9px] opacity-50 tracking-[0.2em]",children:"Seeded Challenge"})]})]})]})]}),p.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[p.jsx("main",{className:"flex-1 overflow-y-auto p-12 custom-scrollbar",children:p.jsxs("div",{className:"max-w-4xl mx-auto",children:[p.jsxs("div",{className:"mb-12",children:[p.jsx("button",{onClick:o,className:"mb-5 w-full md:w-auto px-6 py-3 rounded-2xl border border-emerald-400/40 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-200 font-black uppercase tracking-widest text-sm transition-all",children:"Arcade Mode"}),p.jsxs("h2",{className:"text-3xl font-black uppercase tracking-tighter mb-2 italic",children:["Select Your ",p.jsx("span",{className:"text-indigo-500",children:"Archetype"})]}),p.jsx("p",{className:"text-white/40 max-w-xl",children:"Choose your tactical specialty. Each archetype provides unique skills and modifies your core interaction with the engine."})]}),p.jsx(JA,{onSelect:i})]})}),p.jsx("aside",{className:"w-[450px] border-l border-white/5 bg-[#030712]/80 backdrop-blur-md flex flex-col z-20",children:p.jsxs("div",{className:"p-8 flex flex-col gap-12 h-full overflow-y-auto custom-scrollbar",children:[p.jsxs("section",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Historical Replay"}),p.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"})]}),p.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:p.jsx(tT,{gameState:t,onStartReplay:r})})]}),p.jsxs("section",{children:[p.jsxs("div",{className:"flex items-center justify-between mb-6",children:[p.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30",children:"Training Simulations"}),p.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500 animate-pulse"})]}),p.jsx("div",{className:"bg-white/[0.02] border border-white/5 rounded-2xl p-4 overflow-hidden",children:p.jsx(iT,{onLoadScenario:c})})]}),p.jsx("div",{className:"mt-auto pt-8 border-t border-white/5 opacity-20 hover:opacity-100 transition-opacity",children:p.jsx("div",{className:"text-[10px] font-bold uppercase tracking-[0.4em] mb-2 text-center text-white/50",children:"Engine Status: Online"})})]})})]})]}),aT={VANGUARD:"V",HUNTER:"H",FIREMAGE:"F",NECROMANCER:"N",SKIRMISHER:"S"},Yg=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i+=(i<<1)+(i<<4)+(i<<7)+(i<<8)+(i<<24);return i>>>0},oT=(t=new Date)=>t.toISOString().slice(0,10),lT=(t,i)=>{if(t.length<2)throw new Error("Arcade mode requires at least two loadouts.");const o=Yg(`arcade-a:${i}`)%t.length,c=t[o],r=t.filter(y=>y.id!==c.id),g=Yg(`arcade-b:${i}`)%r.length,b=r[g];return[c,b]},rT=({onBack:t,onLaunchArcade:i})=>{const a=Bi.useMemo(()=>Object.values(ho),[]),o=Bi.useMemo(()=>oT(),[]),[c,r]=Bi.useMemo(()=>lT(a,o),[a,o]);return p.jsxs("div",{className:"w-full h-full flex flex-col bg-[#040a18]",children:[p.jsxs("header",{className:"h-20 border-b border-white/10 flex items-center justify-between px-12 bg-[#050b1f]/80 backdrop-blur-xl z-30",children:[p.jsxs("div",{children:[p.jsxs("h1",{className:"text-xl font-black uppercase tracking-tight italic",children:["Hop ",p.jsx("span",{className:"text-emerald-400",children:"Arcade"})]}),p.jsxs("div",{className:"text-[10px] uppercase tracking-[0.3em] text-white/40 mt-1",children:["Daily Draft ",o]})]}),p.jsx("button",{onClick:t,className:"px-5 py-2.5 rounded-xl border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-widest",children:"Back to Strategic Hub"})]}),p.jsx("main",{className:"flex-1 overflow-y-auto p-12",children:p.jsxs("div",{className:"max-w-5xl mx-auto",children:[p.jsxs("div",{className:"mb-10",children:[p.jsx("h2",{className:"text-4xl font-black uppercase tracking-tight italic mb-3",children:"Arcade Mode"}),p.jsx("p",{className:"text-white/60 max-w-3xl",children:"Pick one of two daily archetypes and run the seeded challenge. Both options share the same seed for fair comparison."})]}),p.jsx("div",{className:"flex flex-col gap-6",children:[c,r].map((f,g)=>{const b=g===1,y=aT[f.id]||f.id.slice(0,1);return p.jsx("button",{onClick:()=>i(f.id),className:"w-full text-left group rounded-3xl border border-white/10 bg-gradient-to-r from-white/[0.06] to-white/[0.02] hover:from-emerald-500/20 hover:to-cyan-500/10 transition-all p-6",children:p.jsxs("div",{className:`flex items-center justify-between gap-6 ${b?"flex-row-reverse":""}`,children:[p.jsxs("div",{className:"flex items-center gap-4 min-w-[200px]",children:[p.jsx("div",{className:`w-20 h-20 rounded-2xl border border-white/15 bg-[#0b1733] flex items-center justify-center text-4xl font-black text-emerald-300 shadow-[0_0_35px_rgba(16,185,129,0.25)] ${b?"-scale-x-100":""}`,children:y}),p.jsxs("div",{children:[p.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Daily Archetype"}),p.jsx("div",{className:"text-2xl font-black uppercase tracking-tight",children:f.name})]})]}),p.jsxs("div",{className:"flex-1",children:[p.jsx("div",{className:"text-[10px] uppercase tracking-[0.2em] text-white/40 mb-2",children:"Starting Skills"}),p.jsx("div",{className:"flex flex-wrap gap-2",children:f.startingSkills.slice(0,6).map(A=>p.jsx("span",{className:"text-[10px] px-2 py-1 rounded-full border border-white/20 bg-white/5 font-bold tracking-wide",children:A},A))})]}),p.jsxs("div",{className:"text-right min-w-[150px]",children:[p.jsx("div",{className:"text-[10px] uppercase tracking-[0.25em] text-white/40",children:"Launch"}),p.jsx("div",{className:"text-sm font-black uppercase tracking-widest text-emerald-300 group-hover:text-emerald-200",children:"Start Arcade Run"})]})]})},f.id)})})]})})]})},cT=["catacombs","inferno","throne","frozen","void"],Jr=["off","repeat","cover"],Kg="hop_biome_sandbox_settings_v1",_l="/Hop",Sa=64,va=192,Wn=64,Xn=512,uT=["normal","multiply","overlay","soft-light","screen","color-dodge"],Fg=["off","multiply","overlay","soft-light","screen","color-dodge","normal"],dT=["#8b6f4a","#8f4a2e","#5b6d41","#536e8e","#5f5977","#b79a73","#d15a3a","#3e4f3a"],fT=["native","additive","custom"],mT=[{q:1,r:0,s:-1},{q:0,r:1,s:-1},{q:-1,r:1,s:0},{q:-1,r:0,s:1},{q:0,r:-1,s:1},{q:1,r:-1,s:0}],Gg=(t,i)=>`${t.endsWith("/")?t:`${t}/`}${i.replace(/^\/+/,"")}`,hl=t=>{const i=t.trim();return!i||/^(?:[a-z]+:)?\/\//i.test(i)||i.startsWith("data:")?i:i.startsWith("/")?i.startsWith("/assets/")?Gg(_l,i.slice(1)):i:Gg(_l,i)},gl=t=>{const i=t.trim();if(!i||/^\/assets\/[a-z0-9/_\-.]+$/i.test(i))return i;const o=`${_l.endsWith("/")?_l:`${_l}/`}assets/`;return i.startsWith(o)?`/assets/${i.slice(o.length)}`:i},vi=(t,i="#8b6f4a")=>{const a=String(t||"").trim();if(/^#([0-9a-f]{6})$/i.test(a))return a.toLowerCase();if(/^#([0-9a-f]{3})$/i.test(a)){const[r,f,g]=a.slice(1).split("");return`#${r}${r}${f}${f}${g}${g}`.toLowerCase()}return i},pT=t=>{let i=2166136261;for(let a=0;a<t.length;a++)i^=t.charCodeAt(a),i=Math.imul(i,16777619);return i>>>0},Wg=t=>pT(t)/4294967295,wy=t=>t.has("BLOCKS_MOVEMENT")&&t.has("BLOCKS_LOS"),hT=t=>t.has("LAVA")||t.has("FIRE")||t.has("HAZARDOUS")&&t.has("LIQUID"),of=t=>mT.map(i=>de({q:t.q+i.q,r:t.r+i.r,s:t.s+i.s})),gT=t=>{const i=new Set;for(const[a,o]of t.entries())of(o.position).some(r=>!t.has(r))&&i.add(a);return i},yT=(t,i,a)=>{const o=new Set,c=[{point:i,depth:0}];for(;c.length>0;){const r=c.shift(),f=de(r.point);if(!o.has(f)&&t.has(f)&&(o.add(f),!(r.depth>=a)))for(const g of of(r.point)){const b=t.get(g);b&&c.push({point:b.position,depth:r.depth+1})}}return o},Id=(t,i,a)=>{const o=t.get(i);if(!o)return;const c=new Set(Array.from(o.traits));a?(c.add("BLOCKS_MOVEMENT"),c.add("BLOCKS_LOS"),c.delete("LAVA"),c.delete("FIRE"),c.delete("LIQUID"),c.delete("HAZARDOUS")):(c.delete("BLOCKS_MOVEMENT"),c.delete("BLOCKS_LOS")),t.set(i,{...o,traits:c})},se=(t,i,a)=>Math.min(a,Math.max(i,t)),Zr=(t,i)=>t?i&&t.themes?.[i]?t.themes[i]:t.default||"":"",ec=t=>t?t.mode==="cover"||t.mode==="repeat"||t.mode==="off"?t.mode:"repeat":"off",bT=(t,i)=>t?i&&t.themes?.[i]?t.themes[i]:t.default||"#8b6f4a":"#8b6f4a",xa=t=>t==="normal"||t==="multiply"||t==="overlay"||t==="soft-light"||t==="screen"||t==="color-dodge"?t:"multiply",li=t=>t==="off"?"off":xa(t),jd=(t,i,a,o)=>{const c=t?.[a]??t?.[o];return c!==void 0?c:i?.[a]??i?.[o]},ST=t=>{switch(t){case"inferno":return 4;case"throne":return 6;case"frozen":return 8;case"void":return 10;default:return 1}},vT=t=>{const i=new Map;for(const[a,o]of t.tiles.entries())i.set(a,{...o,traits:new Set(o.traits),effects:Array.isArray(o.effects)?[...o.effects]:[]});return i},xT=(t,i)=>{const a=(r,f,g)=>{const y=de({q:r,r:f}),A=t.get(y);if(!A)return;const v=new Set(Array.from(A.traits));if(!wy(v)){for(const x of g)v.add(x);t.set(y,{...A,traits:v})}},o=[[0,0],[1,0],[0,1],[-1,1],[-1,0],[0,-1],[1,-1],[2,-1],[2,0],[1,1],[-2,1],[-2,0],[-1,-1]];for(const[r,f]of o)a(i.q+r,i.r+f,["HAZARDOUS","LIQUID","LAVA"]);const c=[[3,-1],[3,0],[2,1],[-3,1],[-3,0],[-2,-1]];for(const[r,f]of c)a(i.q+r,i.r+f,["HAZARDOUS","FIRE"])},AT=(t,i,a,o)=>{const c=o.mode,r=gT(t),f=yT(t,a,2),g=Array.from(t.keys()).sort((E,m)=>E.localeCompare(m));if(c==="custom")for(const E of g){if(f.has(E)){Id(t,E,!1);continue}const m=o.keepPerimeter&&r.has(E);Id(t,E,m)}if(c==="native")return;const b=se(Number(o.interiorDensity||0),0,.45),y=se(Number(o.clusterBias||0),0,1);if(b<=0&&y<=0)return;const A=g.filter(E=>{if(r.has(E)||f.has(E))return!1;const m=t.get(E);if(!m)return!1;const h=m.traits;return!hT(h)}),v=E=>{const m=t.get(E);return m?wy(m.traits):!1},x=new Set;for(const E of A){if(v(E))continue;Wg(`${i}|sandbox-wall-seed|${E}`)<b&&x.add(E)}for(let E=0;E<2;E++)for(const m of A){if(v(m)||x.has(m))continue;const h=t.get(m);if(!h)continue;const R=of(h.position).filter(w=>t.has(w));let k=0;for(const w of R)(v(w)||x.has(w))&&k++;if(k===0)continue;const B=y*(k/6);Wg(`${i}|sandbox-wall-grow|pass:${E}|${m}`)<B&&x.add(m)}for(const E of x)Id(t,E,!0)},TT=(t,i,a,o)=>{const c=ST(t),r=i.trim()||"biome-sandbox-seed",f=gs(c,r,r,void 0,ho.VANGUARD),g=vT(f);return AT(g,r,f.player.position,o),a&&xT(g,f.player.position),{...f,floor:c,theme:t,rngSeed:r,initialSeed:r,turnNumber:1,tiles:g,visualEvents:[],timelineEvents:[],intentPreview:void 0}},Xg=(t,i)=>{const a=i.toLowerCase(),o=af(t,a),c=o?.biomeLayers?.undercurrent??t.biomeLayers?.undercurrent,r=o?.biomeLayers?.crust??t.biomeLayers?.crust??(t.biomeUnderlay?{default:t.biomeUnderlay.default,themes:t.biomeUnderlay.themes,mode:t.biomeUnderlay.mode,scalePx:t.biomeUnderlay.scalePx,opacity:t.biomeUnderlay.opacity}:void 0),f=o?.biomeMaterials?.crust??t.biomeMaterials?.crust,g=f?.detailA,b=f?.detailB,y=f?.tint,A=o?.walls||t.walls,v=o?.walls?o.walls:t.walls?.themes?.[a],x=(t.assets||[]).filter(j=>{if(j.type!=="prop")return!1;const L=j.id.toLowerCase(),W=new Set((j.tags||[]).map(Te=>Te.toLowerCase()));if(!L.includes("mountain")&&!W.has("mountain"))return!1;if(!j.theme)return!0;const Z=j.theme.toLowerCase();return Z===a||Z==="core"}).sort((j,L)=>j.id.localeCompare(L.id)),m=String(v?.mountainPath??A?.mountainPath??"").trim()||x.find(j=>j.path.toLowerCase().includes("biome.volcano.mountain.03.webp"))?.path||x[0]?.path||"",h=x.find(j=>j.path===m)||x[0],R=h?.mountainSettings,k=h?.mountainSettingsByTheme?.[a],B=h?o?.assetOverrides?.[h.id]?.mountainSettings:void 0,_=(j,L,W)=>{const Te=jd(v,A,j,L)??B?.[j]??k?.[j]??R?.[j]??W,oe=Number(Te);return Number.isFinite(oe)?oe:W},w=(j,L,W)=>{const Te=jd(v,A,j,L)??B?.[j]??k?.[j]??R?.[j]??W;return li(Te)},H=(j,L,W)=>{const Te=jd(v,A,j,L)??B?.[j]??k?.[j]??R?.[j]??W;return vi(String(Te||""),W)};return{theme:i,seed:String(o?.seed||"biome-sandbox-seed"),injectHazards:o?.injectHazards!==void 0?!!o.injectHazards:!0,undercurrent:{path:Zr(c,a),mode:ec(c),scalePx:se(Number(c?.scalePx??t.tileUnitPx??256),Sa,va),opacity:se(Number(c?.opacity??.6),0,1),scrollX:Number(c?.scroll?.x??120),scrollY:Number(c?.scroll?.y??90),scrollDurationMs:Math.max(1e3,Number(c?.scroll?.durationMs??92e3)),offsetX:Number(c?.offsetX??0),offsetY:Number(c?.offsetY??0)},crust:{path:Zr(r,a),mode:ec(r),scalePx:Math.max(64,Number(r?.scalePx??t.tileUnitPx??256)),opacity:1,seedShiftPx:Math.max(0,Number(r?.seedShiftPx??96)),offsetX:Number(r?.offsetX??0),offsetY:Number(r?.offsetY??0)},clutter:{density:se(Number((o?.biomeLayers?.clutter??t.biomeLayers?.clutter)?.density??.14),0,1),maxPerHex:Math.max(0,Number((o?.biomeLayers?.clutter??t.biomeLayers?.clutter)?.maxPerHex??1)),bleedScaleMax:se(Number((o?.biomeLayers?.clutter??t.biomeLayers?.clutter)?.bleedScaleMax??2),1,2)},walls:{mode:A?.mode==="native"||A?.mode==="additive"||A?.mode==="custom"?A.mode:"custom",interiorDensity:se(Number(A?.interiorDensity??.05),0,.45),clusterBias:se(Number(A?.clusterBias??0),0,1),keepPerimeter:A?.keepPerimeter!==void 0?!!A.keepPerimeter:!0,mountainPath:m,mountainScale:se(_("scale","mountainScale",.53),.2,3),mountainOffsetX:_("offsetX","mountainOffsetX",0),mountainOffsetY:_("offsetY","mountainOffsetY",0),mountainAnchorX:se(_("anchorX","mountainAnchorX",.5),0,1),mountainAnchorY:se(_("anchorY","mountainAnchorY",.55),0,1),mountainCrustBlendMode:w("crustBlendMode","mountainCrustBlendMode","multiply"),mountainCrustBlendOpacity:se(_("crustBlendOpacity","mountainCrustBlendOpacity",1),0,1),mountainTintColor:H("tintColor","mountainTintColor","#7d7d7d"),mountainTintBlendMode:w("tintBlendMode","mountainTintBlendMode","overlay"),mountainTintOpacity:se(_("tintOpacity","mountainTintOpacity",1),0,1)},materials:{detailA:{path:Zr(g,a),mode:ec(g),scalePx:se(Number(g?.scalePx??192),Wn,Xn),opacity:se(Number(g?.opacity??0),0,1)},detailB:{path:Zr(b,a),mode:ec(b),scalePx:se(Number(b?.scalePx??256),Wn,Xn),opacity:se(Number(b?.opacity??0),0,1)},tintColor:bT(y,a),tintOpacity:se(Number(y?.opacity??0),0,1),tintBlend:xa(y?.blendMode)}}},ET=t=>{if(!t)return null;try{const i=JSON.parse(t);return!i||typeof i!="object"?null:i}catch{return null}},lt=(t,i)=>{const a=Number(t);return Number.isFinite(a)?a:i},_T=({assetManifest:t,onBack:i})=>{const a=M.useRef(!1),[o,c]=M.useState(""),[r,f]=M.useState(null);M.useEffect(()=>{if(!t||a.current)return;const m=Xg(t,"inferno"),h=ET(localStorage.getItem(Kg));if(!h){f(m),a.current=!0;return}f({...m,...h,undercurrent:{...m.undercurrent,...h.undercurrent||{},scalePx:se(Number((h.undercurrent||{}).scalePx??m.undercurrent.scalePx),Sa,va)},crust:{...m.crust,...h.crust||{},opacity:1},clutter:{...m.clutter,...h.clutter||{}},walls:{...m.walls,...h.walls||{},mode:(h.walls||{}).mode==="native"||(h.walls||{}).mode==="additive"||(h.walls||{}).mode==="custom"?(h.walls||{}).mode:m.walls.mode,interiorDensity:se(Number((h.walls||{}).interiorDensity??m.walls.interiorDensity),0,.45),clusterBias:se(Number((h.walls||{}).clusterBias??m.walls.clusterBias),0,1),keepPerimeter:(h.walls||{}).keepPerimeter!==void 0?!!(h.walls||{}).keepPerimeter:m.walls.keepPerimeter,mountainPath:String((h.walls||{}).mountainPath||m.walls.mountainPath||""),mountainScale:se(Number((h.walls||{}).mountainScale??m.walls.mountainScale),.2,3),mountainOffsetX:lt(String((h.walls||{}).mountainOffsetX??m.walls.mountainOffsetX),m.walls.mountainOffsetX),mountainOffsetY:lt(String((h.walls||{}).mountainOffsetY??m.walls.mountainOffsetY),m.walls.mountainOffsetY),mountainAnchorX:se(Number((h.walls||{}).mountainAnchorX??m.walls.mountainAnchorX),0,1),mountainAnchorY:se(Number((h.walls||{}).mountainAnchorY??m.walls.mountainAnchorY),0,1),mountainCrustBlendMode:li((h.walls||{}).mountainCrustBlendMode??m.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:se(Number((h.walls||{}).mountainCrustBlendOpacity??m.walls.mountainCrustBlendOpacity),0,1),mountainTintColor:vi(String((h.walls||{}).mountainTintColor??m.walls.mountainTintColor),m.walls.mountainTintColor),mountainTintBlendMode:li((h.walls||{}).mountainTintBlendMode??m.walls.mountainTintBlendMode),mountainTintOpacity:se(Number((h.walls||{}).mountainTintOpacity??m.walls.mountainTintOpacity),0,1)},materials:{...m.materials,...h.materials||{},detailA:{...m.materials.detailA,...(h.materials||{}).detailA||{},scalePx:se(Number(((h.materials||{}).detailA||{}).scalePx??m.materials.detailA.scalePx),Wn,Xn),opacity:se(Number(((h.materials||{}).detailA||{}).opacity??m.materials.detailA.opacity),0,1)},detailB:{...m.materials.detailB,...(h.materials||{}).detailB||{},scalePx:se(Number(((h.materials||{}).detailB||{}).scalePx??m.materials.detailB.scalePx),Wn,Xn),opacity:se(Number(((h.materials||{}).detailB||{}).opacity??m.materials.detailB.opacity),0,1)},tintOpacity:se(Number((h.materials||{}).tintOpacity??m.materials.tintOpacity),0,1),tintBlend:xa((h.materials||{}).tintBlend)}}),a.current=!0},[t]),M.useEffect(()=>{r&&localStorage.setItem(Kg,JSON.stringify(r))},[r]);const g=r?.theme?.toLowerCase()||"inferno",b=M.useMemo(()=>vi(r?.materials.tintColor||"#8b6f4a"),[r?.materials.tintColor]),y=M.useMemo(()=>vi(r?.walls.mountainTintColor||"#8b6f4a"),[r?.walls.mountainTintColor]),A=M.useMemo(()=>{const m=new Set,h=new Set,R=new Set,k=new Set;if(!t)return{undercurrent:[],crust:[],detail:[],mountain:[]};const B=_=>{if(_){_.default&&(m.add(_.default),h.add(_.default),R.add(_.default));for(const w of Object.values(_.themes||{}))m.add(w),h.add(w),R.add(w)}};B(t.biomeLayers?.undercurrent),B(t.biomeLayers?.crust);for(const _ of Object.values(t.biomePresets||{}))B(_?.biomeLayers?.undercurrent),B(_?.biomeLayers?.crust),_?.biomeMaterials?.crust?.detailA&&B(_.biomeMaterials.crust.detailA),_?.biomeMaterials?.crust?.detailB&&B(_.biomeMaterials.crust.detailB);if(t.biomeUnderlay){t.biomeUnderlay.default&&h.add(t.biomeUnderlay.default);for(const _ of Object.values(t.biomeUnderlay.themes||{}))h.add(_)}t.biomeMaterials?.crust?.detailA&&B(t.biomeMaterials.crust.detailA),t.biomeMaterials?.crust?.detailB&&B(t.biomeMaterials.crust.detailB);for(const _ of t.assets||[]){const w=new Set((_.tags||[]).map(j=>j.toLowerCase())),H=_.type==="prop"&&(_.id.toLowerCase().includes("mountain")||w.has("mountain"));(w.has("floor")||w.has("stone")||w.has("void")||w.has("frozen")||w.has("inferno"))&&(h.add(_.path),R.add(_.path)),(w.has("lava")||w.has("hazard")||w.has("fire")||w.has("quicksand"))&&m.add(_.path),(_.type==="decal"||_.type==="prop"||_.type==="tile")&&R.add(_.path),H&&k.add(_.path)}t.walls?.mountainPath&&k.add(t.walls.mountainPath);for(const _ of Object.values(t.walls?.themes||{}))_?.mountainPath&&k.add(_.mountainPath);for(const _ of Object.values(t.biomePresets||{})){_?.walls?.mountainPath&&k.add(_.walls.mountainPath);for(const w of Object.values(_?.walls?.themes||{}))w?.mountainPath&&k.add(w.mountainPath)}return{undercurrent:Array.from(m).sort((_,w)=>_.localeCompare(w)),crust:Array.from(h).sort((_,w)=>_.localeCompare(w)),detail:Array.from(R).sort((_,w)=>_.localeCompare(w)),mountain:Array.from(k).sort((_,w)=>_.localeCompare(w))}},[t]),v=M.useMemo(()=>{if(!t||!r)return null;const m=hl(r.undercurrent.path),h=hl(r.crust.path),R=hl(r.materials.detailA.path),k=hl(r.materials.detailB.path),B=af(t,g),_=B?.biomeLayers?.undercurrent??t.biomeLayers?.undercurrent,w=B?.biomeLayers?.crust??t.biomeLayers?.crust??(t.biomeUnderlay?{default:t.biomeUnderlay.default,themes:t.biomeUnderlay.themes,mode:t.biomeUnderlay.mode,scalePx:t.biomeUnderlay.scalePx,opacity:t.biomeUnderlay.opacity}:void 0),H=B?.biomeMaterials?.crust??t.biomeMaterials?.crust,j=_||m?{..._||{default:m||h||""},default:m||_?.default||"",themes:{..._?.themes||{},[g]:m||_?.default||""},mode:r.undercurrent.mode,scalePx:se(r.undercurrent.scalePx,Sa,va),opacity:se(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}}:void 0,L=w||h?{...w||{default:h||m||""},default:h||w?.default||"",themes:{...w?.themes||{},[g]:h||w?.default||""},mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:Math.max(0,r.crust.seedShiftPx),offsetX:r.crust.offsetX,offsetY:r.crust.offsetY}:void 0,W=R||H?.detailA?.default||"",Z={...H?.detailA?.themes||{}};W&&(Z[g]=W);const Te=W?{...H?.detailA||{default:W},default:W,themes:Z,mode:r.materials.detailA.mode,scalePx:se(r.materials.detailA.scalePx,Wn,Xn),opacity:se(r.materials.detailA.opacity,0,1)}:void 0,oe=k||H?.detailB?.default||"",Be={...H?.detailB?.themes||{}};oe&&(Be[g]=oe);const ne=oe?{...H?.detailB||{default:oe},default:oe,themes:Be,mode:r.materials.detailB.mode,scalePx:se(r.materials.detailB.scalePx,Wn,Xn),opacity:se(r.materials.detailB.opacity,0,1)}:void 0,xe=String(r.materials.tintColor||"").trim()||H?.tint?.default||"#8b6f4a",ve={...H?.tint?.themes||{}};ve[g]=xe;const V={...H?.tint||{default:xe},default:xe,themes:ve,opacity:se(r.materials.tintOpacity,0,1),blendMode:xa(r.materials.tintBlend)},ie=Te||ne||V?{...H||{},detailA:Te,detailB:ne,tint:V}:void 0,re=hl(r.walls.mountainPath),Re=B?.walls,ge={...Re||t.walls?.themes?.[g]||{},mountainPath:re,scale:se(r.walls.mountainScale,.2,3),offsetX:r.walls.mountainOffsetX,offsetY:r.walls.mountainOffsetY,anchorX:se(r.walls.mountainAnchorX,0,1),anchorY:se(r.walls.mountainAnchorY,0,1),crustBlendMode:li(r.walls.mountainCrustBlendMode),crustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),tintColor:vi(r.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:li(r.walls.mountainTintBlendMode),tintOpacity:se(r.walls.mountainTintOpacity,0,1),mountainScale:se(r.walls.mountainScale,.2,3),mountainOffsetX:r.walls.mountainOffsetX,mountainOffsetY:r.walls.mountainOffsetY,mountainAnchorX:se(r.walls.mountainAnchorX,0,1),mountainAnchorY:se(r.walls.mountainAnchorY,0,1),mountainCrustBlendMode:li(r.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:vi(r.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:li(r.walls.mountainTintBlendMode),mountainTintOpacity:se(r.walls.mountainTintOpacity,0,1)},O={...t.walls||{},...Re||{},mode:r.walls.mode,interiorDensity:se(r.walls.interiorDensity,0,.45),clusterBias:se(r.walls.clusterBias,0,1),keepPerimeter:!!r.walls.keepPerimeter,mountainPath:re,scale:ge.scale,offsetX:ge.offsetX,offsetY:ge.offsetY,anchorX:ge.anchorX,anchorY:ge.anchorY,crustBlendMode:ge.crustBlendMode,crustBlendOpacity:ge.crustBlendOpacity,tintColor:ge.tintColor,tintBlendMode:ge.tintBlendMode,tintOpacity:ge.tintOpacity,mountainScale:ge.mountainScale,mountainOffsetX:ge.mountainOffsetX,mountainOffsetY:ge.mountainOffsetY,mountainAnchorX:ge.mountainAnchorX,mountainAnchorY:ge.mountainAnchorY,mountainCrustBlendMode:ge.mountainCrustBlendMode,mountainCrustBlendOpacity:ge.mountainCrustBlendOpacity,mountainTintColor:ge.mountainTintColor,mountainTintBlendMode:ge.mountainTintBlendMode,mountainTintOpacity:ge.mountainTintOpacity,themes:{...t.walls?.themes||{},[g]:ge}},Y={...B?.biomeLayers||{},undercurrent:j,crust:L,clutter:{...B?.biomeLayers?.clutter||t.biomeLayers?.clutter||{},density:se(r.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(r.clutter.maxPerHex)),bleedScaleMax:se(r.clutter.bleedScaleMax,1,2)}},te={...B?.biomeMaterials||{},crust:ie},ue={...B||{},seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:Y,biomeMaterials:te,walls:O};return{...t,biomeLayers:{...t.biomeLayers||{},undercurrent:j,crust:L,clutter:{...t.biomeLayers?.clutter||{},density:se(r.clutter.density,0,1),maxPerHex:Math.max(0,Math.floor(r.clutter.maxPerHex)),bleedScaleMax:se(r.clutter.bleedScaleMax,1,2)}},biomeMaterials:{...t.biomeMaterials||{},crust:ie},walls:O,biomePresets:{...t.biomePresets||{},[g]:ue}}},[t,r,g]),x=M.useMemo(()=>r?TT(r.theme,r.seed,r.injectHazards,r.walls):null,[r]),E=async()=>{if(!r)return;const m=gl(r.undercurrent.path),h=gl(r.crust.path),R=gl(r.materials.detailA.path),k=gl(r.materials.detailB.path),_={mountainPath:gl(r.walls.mountainPath),mountainScale:se(r.walls.mountainScale,.2,3),mountainOffsetX:r.walls.mountainOffsetX,mountainOffsetY:r.walls.mountainOffsetY,mountainAnchorX:se(r.walls.mountainAnchorX,0,1),mountainAnchorY:se(r.walls.mountainAnchorY,0,1),mountainCrustBlendMode:li(r.walls.mountainCrustBlendMode),mountainCrustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),mountainTintColor:vi(r.walls.mountainTintColor,"#7d7d7d"),mountainTintBlendMode:li(r.walls.mountainTintBlendMode),mountainTintOpacity:se(r.walls.mountainTintOpacity,0,1),scale:se(r.walls.mountainScale,.2,3),offsetX:r.walls.mountainOffsetX,offsetY:r.walls.mountainOffsetY,anchorX:se(r.walls.mountainAnchorX,0,1),anchorY:se(r.walls.mountainAnchorY,0,1),crustBlendMode:li(r.walls.mountainCrustBlendMode),crustBlendOpacity:se(r.walls.mountainCrustBlendOpacity,0,1),tintColor:vi(r.walls.mountainTintColor,"#7d7d7d"),tintBlendMode:li(r.walls.mountainTintBlendMode),tintOpacity:se(r.walls.mountainTintOpacity,0,1)},w={seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:{undercurrent:{default:m,mode:r.undercurrent.mode,scalePx:se(r.undercurrent.scalePx,Sa,va),opacity:se(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}},crust:{default:h,mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:r.crust.seedShiftPx,offsetX:r.crust.offsetX,offsetY:r.crust.offsetY},clutter:{density:r.clutter.density,maxPerHex:r.clutter.maxPerHex,bleedScaleMax:r.clutter.bleedScaleMax}},walls:{mode:r.walls.mode,interiorDensity:r.walls.interiorDensity,clusterBias:r.walls.clusterBias,keepPerimeter:r.walls.keepPerimeter,..._},biomeMaterials:{crust:{detailA:{default:R,mode:r.materials.detailA.mode,scalePx:se(r.materials.detailA.scalePx,Wn,Xn),opacity:se(r.materials.detailA.opacity,0,1)},detailB:{default:k,mode:r.materials.detailB.mode,scalePx:se(r.materials.detailB.scalePx,Wn,Xn),opacity:se(r.materials.detailB.opacity,0,1)},tint:{default:vi(r.materials.tintColor,"#8b6f4a"),opacity:se(r.materials.tintOpacity,0,1),blendMode:xa(r.materials.tintBlend)}}}},H={theme:r.theme,seed:r.seed.trim()||"biome-sandbox-seed",injectHazards:r.injectHazards,biomeLayers:{undercurrent:{default:m,mode:r.undercurrent.mode,scalePx:se(r.undercurrent.scalePx,Sa,va),opacity:se(r.undercurrent.opacity,0,1),offsetX:r.undercurrent.offsetX,offsetY:r.undercurrent.offsetY,scroll:{x:r.undercurrent.scrollX,y:r.undercurrent.scrollY,durationMs:Math.max(1e3,r.undercurrent.scrollDurationMs)}},crust:{default:h,mode:r.crust.mode,scalePx:Math.max(64,r.crust.scalePx),opacity:1,seedShiftPx:r.crust.seedShiftPx,offsetX:r.crust.offsetX,offsetY:r.crust.offsetY},clutter:{density:r.clutter.density,maxPerHex:r.clutter.maxPerHex,bleedScaleMax:r.clutter.bleedScaleMax}},walls:{mode:r.walls.mode,interiorDensity:r.walls.interiorDensity,clusterBias:r.walls.clusterBias,keepPerimeter:r.walls.keepPerimeter,..._,themes:{[g]:_}},biomeMaterials:{crust:{detailA:{default:R,mode:r.materials.detailA.mode,scalePx:se(r.materials.detailA.scalePx,Wn,Xn),opacity:se(r.materials.detailA.opacity,0,1)},detailB:{default:k,mode:r.materials.detailB.mode,scalePx:se(r.materials.detailB.scalePx,Wn,Xn),opacity:se(r.materials.detailB.opacity,0,1)},tint:{default:vi(r.materials.tintColor,"#8b6f4a"),opacity:se(r.materials.tintOpacity,0,1),blendMode:xa(r.materials.tintBlend)}}},biomePresets:{[g]:w}};try{await navigator.clipboard.writeText(JSON.stringify(H,null,2)),c("Copied"),window.setTimeout(()=>c(""),1600)}catch{c("Copy failed"),window.setTimeout(()=>c(""),1600)}};return!t||!r||!v||!x?p.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex items-center justify-center",children:[p.jsx("button",{type:"button",onClick:i,className:"absolute top-5 left-5 px-4 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-xs font-black uppercase tracking-[0.2em]",children:"Back"}),p.jsx("div",{className:"text-sm text-white/70 uppercase tracking-[0.25em] font-black",children:"Loading Biome Sandbox..."})]}):p.jsxs("div",{className:"w-screen h-screen bg-[#030712] text-white flex",children:[p.jsxs("aside",{className:"w-[420px] border-r border-white/10 bg-[#02040a] overflow-y-auto",children:[p.jsxs("div",{className:"sticky top-0 z-20 border-b border-white/10 bg-[#02040a]/95 backdrop-blur p-4",children:[p.jsxs("div",{className:"flex items-center justify-between gap-3",children:[p.jsx("button",{type:"button",onClick:i,className:"px-3 py-2 rounded-lg border border-white/20 bg-white/5 hover:bg-white/10 text-[11px] font-black uppercase tracking-[0.18em]",children:"Back"}),p.jsx("button",{type:"button",onClick:()=>f(Xg(t,r.theme)),className:"px-3 py-2 rounded-lg border border-amber-300/40 bg-amber-500/10 hover:bg-amber-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Reset"}),p.jsx("button",{type:"button",onClick:E,className:"px-3 py-2 rounded-lg border border-cyan-300/40 bg-cyan-500/10 hover:bg-cyan-500/20 text-[11px] font-black uppercase tracking-[0.18em]",children:"Copy JSON"})]}),p.jsxs("div",{className:"mt-3 text-[10px] uppercase tracking-[0.22em] text-white/50",children:["Hop / Biomes ",o?`* ${o}`:""]})]}),p.jsxs("div",{className:"p-4 space-y-6",children:[p.jsxs("section",{className:"space-y-3",children:[p.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/75",children:"Preview"}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Theme"}),p.jsx("select",{value:r.theme,onChange:m=>f(h=>h&&{...h,theme:m.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:cT.map(m=>p.jsx("option",{value:m,children:m},m))}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed"}),p.jsx("input",{value:r.seed,onChange:m=>f(h=>h&&{...h,seed:m.target.value}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),p.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[p.jsx("input",{type:"checkbox",checked:r.injectHazards,onChange:m=>f(h=>h&&{...h,injectHazards:m.target.checked})}),"Inject synthetic lava/fire patches for mask testing"]})]}),p.jsxs("section",{className:"space-y-3",children:[p.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-cyan-200",children:"Undercurrent"}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),p.jsx("input",{list:"sandbox-undercurrent-paths",value:r.undercurrent.path,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,path:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),p.jsx("datalist",{id:"sandbox-undercurrent-paths",children:A.undercurrent.map(m=>p.jsx("option",{value:m},m))}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),p.jsx("select",{value:r.undercurrent.mode,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Jr.map(m=>p.jsx("option",{value:m,children:m},m))}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),p.jsx("input",{type:"number",min:Sa,max:va,step:16,value:r.undercurrent.scalePx,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,scalePx:se(lt(m.target.value,h.undercurrent.scalePx),Sa,va)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.undercurrent.opacity,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,opacity:se(lt(m.target.value,h.undercurrent.opacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),p.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll X"}),p.jsx("input",{type:"number",step:5,value:r.undercurrent.scrollX,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,scrollX:lt(m.target.value,h.undercurrent.scrollX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scroll Y"}),p.jsx("input",{type:"number",step:5,value:r.undercurrent.scrollY,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,scrollY:lt(m.target.value,h.undercurrent.scrollY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Duration"}),p.jsx("input",{type:"number",min:1e3,step:500,value:r.undercurrent.scrollDurationMs,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,scrollDurationMs:Math.max(1e3,lt(m.target.value,h.undercurrent.scrollDurationMs))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),p.jsx("input",{type:"number",step:4,value:r.undercurrent.offsetX,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,offsetX:lt(m.target.value,h.undercurrent.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),p.jsx("input",{type:"number",step:4,value:r.undercurrent.offsetY,onChange:m=>f(h=>h&&{...h,undercurrent:{...h.undercurrent,offsetY:lt(m.target.value,h.undercurrent.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),p.jsxs("section",{className:"space-y-3",children:[p.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-amber-200",children:"Crust"}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Asset Path"}),p.jsx("input",{list:"sandbox-crust-paths",value:r.crust.path,onChange:m=>f(h=>h&&{...h,crust:{...h.crust,path:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),p.jsx("datalist",{id:"sandbox-crust-paths",children:A.crust.map(m=>p.jsx("option",{value:m},m))}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mode"}),p.jsx("select",{value:r.crust.mode,onChange:m=>f(h=>h&&{...h,crust:{...h.crust,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Jr.map(m=>p.jsx("option",{value:m,children:m},m))}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale Px"}),p.jsx("input",{type:"number",min:64,step:16,value:r.crust.scalePx,onChange:m=>f(h=>h&&{...h,crust:{...h.crust,scalePx:Math.max(64,lt(m.target.value,h.crust.scalePx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Opacity"}),p.jsx("input",{type:"number",min:1,max:1,step:.01,value:1,onChange:()=>f(m=>m&&{...m,crust:{...m.crust,opacity:1}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Seed Shift Budget"}),p.jsx("input",{type:"number",min:0,step:8,value:r.crust.seedShiftPx,onChange:m=>f(h=>h&&{...h,crust:{...h.crust,seedShiftPx:Math.max(0,lt(m.target.value,h.crust.seedShiftPx))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),p.jsx("input",{type:"number",step:4,value:r.crust.offsetX,onChange:m=>f(h=>h&&{...h,crust:{...h.crust,offsetX:lt(m.target.value,h.crust.offsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),p.jsx("input",{type:"number",step:4,value:r.crust.offsetY,onChange:m=>f(h=>h&&{...h,crust:{...h.crust,offsetY:lt(m.target.value,h.crust.offsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]}),p.jsxs("section",{className:"space-y-3",children:[p.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-rose-200",children:"Walls / Mountains"}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Mountain Asset"}),p.jsx("input",{list:"sandbox-mountain-paths",value:r.walls.mountainPath,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainPath:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs",placeholder:"/assets/biomes/biome.volcano.mountain.01.webp"}),p.jsx("datalist",{id:"sandbox-mountain-paths",children:A.mountain.map(m=>p.jsx("option",{value:m},m))}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Scale"}),p.jsx("input",{type:"number",min:.2,max:3,step:.01,value:r.walls.mountainScale,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainScale:se(lt(m.target.value,h.walls.mountainScale),.2,3)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor X"}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainAnchorX,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainAnchorX:se(lt(m.target.value,h.walls.mountainAnchorX),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset X"}),p.jsx("input",{type:"number",step:2,value:r.walls.mountainOffsetX,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainOffsetX:lt(m.target.value,h.walls.mountainOffsetX)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Offset Y"}),p.jsx("input",{type:"number",step:2,value:r.walls.mountainOffsetY,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainOffsetY:lt(m.target.value,h.walls.mountainOffsetY)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Anchor Y"}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainAnchorY,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainAnchorY:se(lt(m.target.value,h.walls.mountainAnchorY),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Crust Blend"}),p.jsx("select",{value:r.walls.mountainCrustBlendMode,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainCrustBlendMode:li(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Fg.map(m=>p.jsx("option",{value:m,children:m},`mountain-blend-${m}`))})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Blend Opacity ",r.walls.mountainCrustBlendOpacity.toFixed(2)]}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainCrustBlendOpacity,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainCrustBlendOpacity:se(lt(m.target.value,h.walls.mountainCrustBlendOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),p.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Mountain Tint"}),p.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[p.jsx("input",{type:"color",value:y,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainTintColor:m.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Mountain Tint Color Picker"}),p.jsx("input",{value:r.walls.mountainTintColor,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainTintColor:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Tint Blend"}),p.jsx("select",{value:r.walls.mountainTintBlendMode,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainTintBlendMode:li(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Fg.map(m=>p.jsx("option",{value:m,children:m},`mountain-tint-blend-${m}`))})]}),p.jsxs("div",{children:[p.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",r.walls.mountainTintOpacity.toFixed(2)]}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.walls.mountainTintOpacity,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mountainTintOpacity:se(lt(m.target.value,h.walls.mountainTintOpacity),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]}),p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Wall Layout Mode"}),p.jsx("select",{value:r.walls.mode,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,mode:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:fT.map(m=>p.jsx("option",{value:m,children:m},`wall-mode-${m}`))}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Interior Density ",r.walls.interiorDensity.toFixed(2)]}),p.jsx("input",{type:"range",min:0,max:.45,step:.01,value:r.walls.interiorDensity,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,interiorDensity:se(lt(m.target.value,h.walls.interiorDensity),0,.45)}}),className:"w-full"})]}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Cluster Bias ",r.walls.clusterBias.toFixed(2)]}),p.jsx("input",{type:"range",min:0,max:1,step:.01,value:r.walls.clusterBias,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,clusterBias:se(lt(m.target.value,h.walls.clusterBias),0,1)}}),className:"w-full"})]}),p.jsxs("label",{className:"flex items-center gap-2 text-xs text-white/80",children:[p.jsx("input",{type:"checkbox",checked:r.walls.keepPerimeter,onChange:m=>f(h=>h&&{...h,walls:{...h.walls,keepPerimeter:m.target.checked}})}),"Keep perimeter walls (custom mode)"]})]}),p.jsxs("section",{className:"space-y-3",children:[p.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-fuchsia-200",children:"Crust Materials"}),p.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45",children:"Detail A"}),p.jsx("input",{list:"sandbox-detail-paths",value:r.materials.detailA.path,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailA:{...h.materials.detailA,path:m.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),p.jsx("datalist",{id:"sandbox-detail-paths",children:A.detail.map(m=>p.jsx("option",{value:m},m))}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsx("select",{value:r.materials.detailA.mode,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailA:{...h.materials.detailA,mode:m.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Jr.map(m=>p.jsx("option",{value:m,children:m},`detail-a-${m}`))}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.materials.detailA.opacity,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailA:{...h.materials.detailA,opacity:se(lt(m.target.value,h.materials.detailA.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsx("input",{type:"number",min:Wn,max:Xn,step:16,value:r.materials.detailA.scalePx,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailA:{...h.materials.detailA,scalePx:se(lt(m.target.value,h.materials.detailA.scalePx),Wn,Xn)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),p.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Detail B"}),p.jsx("input",{list:"sandbox-detail-paths",value:r.materials.detailB.path,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailB:{...h.materials.detailB,path:m.target.value}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-xs"}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsx("select",{value:r.materials.detailB.mode,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailB:{...h.materials.detailB,mode:m.target.value}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:Jr.map(m=>p.jsx("option",{value:m,children:m},`detail-b-${m}`))}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.materials.detailB.opacity,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailB:{...h.materials.detailB,opacity:se(lt(m.target.value,h.materials.detailB.opacity),0,1)}}}),className:"rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsx("input",{type:"number",min:Wn,max:Xn,step:16,value:r.materials.detailB.scalePx,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,detailB:{...h.materials.detailB,scalePx:se(lt(m.target.value,h.materials.detailB.scalePx),Wn,Xn)}}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"}),p.jsx("div",{className:"text-[10px] uppercase tracking-[0.18em] text-white/45 pt-1",children:"Tint"}),p.jsxs("div",{className:"grid grid-cols-[72px_1fr] gap-3",children:[p.jsx("input",{type:"color",value:b,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,tintColor:m.target.value}}),className:"h-10 w-full rounded-lg border border-white/15 bg-white/5 p-1 cursor-pointer","aria-label":"Tint Color Picker"}),p.jsx("input",{value:r.materials.tintColor,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,tintColor:m.target.value}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",placeholder:"#8b6f4a"})]}),p.jsx("div",{className:"grid grid-cols-8 gap-2",children:dT.map(m=>p.jsx("button",{type:"button",onClick:()=>f(h=>h&&{...h,materials:{...h.materials,tintColor:m}}),className:`h-6 rounded border ${vi(r.materials.tintColor)===vi(m)?"border-white":"border-white/20"}`,style:{backgroundColor:m},title:m},`tint-swatch-${m}`))}),p.jsxs("div",{className:"space-y-2",children:[p.jsxs("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:["Tint Opacity ",r.materials.tintOpacity.toFixed(2)]}),p.jsx("input",{type:"range",min:0,max:1,step:.01,value:r.materials.tintOpacity,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,tintOpacity:se(lt(m.target.value,h.materials.tintOpacity),0,1)}}),className:"w-full"})]}),p.jsx("select",{value:r.materials.tintBlend,onChange:m=>f(h=>h&&{...h,materials:{...h.materials,tintBlend:xa(m.target.value)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm",children:uT.map(m=>p.jsx("option",{value:m,children:m},`blend-${m}`))})]}),p.jsxs("section",{className:"space-y-3 pb-8",children:[p.jsx("div",{className:"text-xs font-black uppercase tracking-[0.2em] text-emerald-200",children:"Clutter"}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Density"}),p.jsx("input",{type:"number",min:0,max:1,step:.01,value:r.clutter.density,onChange:m=>f(h=>h&&{...h,clutter:{...h.clutter,density:se(lt(m.target.value,h.clutter.density),0,1)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Max / Hex"}),p.jsx("input",{type:"number",min:0,max:5,step:1,value:r.clutter.maxPerHex,onChange:m=>f(h=>h&&{...h,clutter:{...h.clutter,maxPerHex:Math.max(0,Math.floor(lt(m.target.value,h.clutter.maxPerHex)))}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]}),p.jsxs("div",{children:[p.jsx("label",{className:"block text-[11px] uppercase tracking-[0.16em] text-white/60",children:"Bleed Max"}),p.jsx("input",{type:"number",min:1,max:2,step:.01,value:r.clutter.bleedScaleMax,onChange:m=>f(h=>h&&{...h,clutter:{...h.clutter,bleedScaleMax:se(lt(m.target.value,h.clutter.bleedScaleMax),1,2)}}),className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-2 text-sm"})]})]})]})]})]}),p.jsxs("main",{className:"flex-1 relative bg-[#050914] overflow-hidden",children:[p.jsxs("div",{className:"absolute top-4 right-5 z-20 px-3 py-2 rounded-lg border border-white/15 bg-black/35 text-[10px] font-black uppercase tracking-[0.2em]",children:["Theme: ",r.theme]}),p.jsx("div",{className:"w-full h-full p-6",children:p.jsx("div",{className:"w-full h-full rounded-[28px] border border-white/10 bg-[#030712]/70 overflow-hidden",children:p.jsx(_y,{gameState:x,onMove:()=>{},selectedSkillId:null,showMovementRange:!1,assetManifest:v})})})]})]})},wT=t=>{const{gameStatus:i,isReplayMode:a,isBusy:o,postCommitInputLock:c,isPlayerTurn:r,hasPendingStatus:f,pendingFrameCount:g}=t,b=f||g>0;let y="IDLE";return a?y="REPLAY":i!=="playing"?y="IDLE":b?y=o?"INTERCEPT_ANIMATING":"INTERCEPT_READY":o?y="PLAYBACK":c&&r?y="POST_COMMIT_LOCK":c&&!r?y="POST_COMMIT_QUEUE":r?y="INPUT_OPEN":y="QUEUE_ADVANCE",{phase:y,canPlayerInput:y==="INPUT_OPEN",shouldAdvanceQueue:y==="QUEUE_ADVANCE"||y==="POST_COMMIT_QUEUE",shouldResolvePending:y==="INTERCEPT_READY",queueAdvanceDelayMs:380}},MT=t=>{const i=t.payload;if(!(!i||typeof i!="object")){if("q"in i&&"r"in i)return{q:Number(i.q??0),r:Number(i.r??0),s:Number(i.s??0)};if(t.type==="USE_SKILL"){const a=i;return{skillId:a.skillId??"unknown",target:a.target?{q:a.target.q,r:a.target.r,s:a.target.s}:null}}if(t.type==="START_RUN")return{loadoutId:i.loadoutId??"unknown",mode:i.mode??"normal"};if(t.type==="LOAD_STATE"){const a=i;return{floor:a?.floor??0,gameStatus:a?.gameStatus??"unknown",turnNumber:a?.turnNumber??0,queueLength:Array.isArray(a?.initiativeQueue)?a.initiativeQueue.length:0}}return{}}};function OT(){const t=(X,le)=>{const me=new Set(X.map(dn=>dn.type)),we=me.has("ADVANCE_TURN"),be=me.has("RESOLVE_PENDING"),De=X.length,ct=le>=5&&De<Math.max(25,le*4);return{actionCount:De,hasTurnAdvance:we,hasPendingResolve:be,suspiciouslyShort:ct}},i=X=>{const le=X||[],me=le.length>0?le[le.length-1]:void 0;return`${le.length}:${me?.type??"none"}`},a=X=>{const le=X||[],me=le.length>0?le[le.length-1]:void 0;return`${le.length}:${me?.id??"none"}:${me?.phase??"none"}`},[o,c]=M.useState(()=>window.location.pathname);M.useEffect(()=>{const X=()=>c(window.location.pathname);return window.addEventListener("popstate",X),()=>window.removeEventListener("popstate",X)},[]);const r=X=>{window.location.pathname!==X&&window.history.pushState({},"",X),c(X)},f=o.toLowerCase().startsWith("/hop")?"/Hop":"",g=`${f||""}`||"/",b=`${f}/Arcade`||"/Arcade",y=`${f}/Biomes`||"/Biomes",v=o.toLowerCase().replace(/\/+$/,""),x=v.endsWith("/arcade")||v.endsWith("/arcarde"),E=v.endsWith("/biomes"),[m,h]=M.useReducer(eA,null,()=>{const X=localStorage.getItem("hop_save");if(X)try{const le=JSON.parse(X);if(le.tiles){const be=Array.isArray(le.tiles)?le.tiles:Object.entries(le.tiles);le.tiles=new Map(be.map(([De,ct])=>[De,{...ct,traits:new Set(ct.traits)}]))}Array.isArray(le.occupancyMask)&&(le.occupancyMask=le.occupancyMask.map(be=>typeof be=="string"?BigInt(be):be));const me=be=>be instanceof Map?be:Array.isArray(be)?new Map(be):be&&typeof be=="object"?new Map(Object.entries(be)):new Map,we=be=>{const De={...be,components:me(be?.components)},ct=vl(De),xn=(ct.components??new Map).get("trinity");if(!xn)return ct;const Ht=uc({body:Number(xn.body||0),mind:Number(xn.mind||0),instinct:Number(xn.instinct||0)});return{...ct,maxHp:Ht,hp:Math.min(Ht,Math.max(0,Number(ct.hp??Ht)))}};return le.player=$d(we(le.player)),le.enemies=Array.isArray(le.enemies)?le.enemies.map(we):[],le}catch(le){console.error("Failed to hydrate Map state:",le)}return Fd()}),R=typeof window<"u"&&!!window.__HOP_DEBUG_QUERY,[k,B]=M.useState(null);M.useEffect(()=>{let X=!0;return zA().then(le=>{X&&(B(le),window.__HOP_ASSET_MANIFEST=le)}),()=>{X=!1}},[]),M.useEffect(()=>{R&&(window.state=m,window.QUERY={tile:(X,le)=>{const we=de({q:X,r:le});return console.log(`Checking Map for Key: "${we}"`),m.tiles.get(we)},whereAmI:()=>{const X=m.player.position,le=de(X),me=m.tiles.get(le);return{coords:X,key:le,tileExists:!!me,tileData:me}},dumpKeys:()=>Array.from(m.tiles.keys())})},[m,R]);const _=M.useRef(null),w=M.useRef(""),H=m.gameStatus==="playing"||m.gameStatus==="choosing_upgrade",j=`${m.gameStatus}|${m.floor}|${m.turnNumber}|${m.player.hp}|${de(m.player.position)}|${m.enemies.length}|${m.actionLog?.length??0}|${m.message?.length??0}`;M.useEffect(()=>{if(_.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(_.current):window.clearTimeout(_.current),_.current=null),!H){w.current="",localStorage.removeItem("hop_save");return}if(j===w.current)return;const X=()=>{const le={...m,tiles:Array.from(m.tiles.entries()).map(([we,be])=>[we,{...be,traits:Array.from(be.traits)}])},me=we=>JSON.stringify(we,(be,De)=>typeof De=="bigint"?De.toString():De);localStorage.setItem("hop_save",me(le)),w.current=j,_.current=null};return typeof window.requestIdleCallback=="function"?_.current=window.requestIdleCallback(X,{timeout:500}):_.current=window.setTimeout(X,120),()=>{_.current!==null&&(typeof window.cancelIdleCallback=="function"?window.cancelIdleCallback(_.current):window.clearTimeout(_.current),_.current=null)}},[m,H,j]);const[L,W]=M.useState(!1),[Z,Te]=M.useState([]),[oe,Be]=M.useState(!1),[ne,xe]=M.useState(null),ve=M.useRef(0),V=M.useRef(null);M.useEffect(()=>{if(!(typeof window<"u"&&!!window.__HOP_DEBUG_PERF))return;let le=0,me=performance.now(),we=0,be=0,De=me;const ct=dn=>{const xn=dn-me;if(me=dn,we++,be+=xn,dn-De>=2e3){const Ht=be/Math.max(1,we),Ct=1e3/Math.max(1,Ht);console.log("[HOP_PERF]",{fps:Number(Ct.toFixed(1)),avgFrameMs:Number(Ht.toFixed(2)),frames:we}),De=dn,we=0,be=0}le=requestAnimationFrame(ct)};return le=requestAnimationFrame(ct),()=>cancelAnimationFrame(le)},[m.gameStatus,L]);const[ie,re]=M.useState(null),[Re,ge]=M.useState(!1),[O,Y]=M.useState(!1),[te,ue]=M.useState(!1),[Oe,Ce]=M.useState(0),Ne=M.useRef(null),ft=M.useRef(null),qe=M.useRef(null),Lt=M.useRef(null),ze=m.pendingFrames?.length??0,Ue=M.useMemo(()=>wT({gameStatus:m.gameStatus,isReplayMode:L,isBusy:O,postCommitInputLock:te,isPlayerTurn:bl(m),hasPendingStatus:!!m.pendingStatus,pendingFrameCount:ze}),[m.gameStatus,L,O,te,m.pendingStatus,ze,m.initiativeQueue,m.player.id,m.enemies]),Ot=!Ue.canPlayerInput,Bt=M.useRef([]),rt=M.useRef(0),Vt=M.useRef(""),ln=m.initiativeQueue?.entries?.[Math.max(0,m.initiativeQueue.currentIndex??0)]?.actorId??m.initiativeQueue?.entries?.[0]?.actorId??"none",Ve=M.useCallback((X,le)=>{const me={id:++rt.current,t:Date.now(),event:X,turnNumber:m.turnNumber,phase:Ue.phase,gameStatus:m.gameStatus,playerTurn:bl(m),isBusy:O,postCommitInputLock:te,pendingStatus:m.pendingStatus?.status??"none",pendingFrames:m.pendingFrames?.length??0,canPlayerInput:Ue.canPlayerInput,shouldAdvanceQueue:Ue.shouldAdvanceQueue,shouldResolvePending:Ue.shouldResolvePending,actionLogLength:m.actionLog?.length??0,queueHead:ln,details:le};Bt.current.push(me),Bt.current.length>800&&Bt.current.splice(0,Bt.current.length-800)},[m.turnNumber,m.gameStatus,m.pendingStatus,m.pendingFrames,m.actionLog,m.initiativeQueue,m.player.id,m.enemies,Ue.phase,Ue.canPlayerInput,Ue.shouldAdvanceQueue,Ue.shouldResolvePending,O,te,ln]),it=M.useCallback((X,le)=>{Ve("DISPATCH",{source:le,actionType:X.type,payload:MT(X)}),h(X)},[Ve]);M.useEffect(()=>{const X=[Ue.phase,m.turnNumber,m.gameStatus,m.pendingStatus?.status??"none",m.pendingFrames?.length??0,O?1:0,te?1:0,ln].join("|");X!==Vt.current&&(Ve("TURN_STATE"),Vt.current=X)},[Ue.phase,m.turnNumber,m.gameStatus,m.pendingStatus,m.pendingFrames,O,te,ln,Ve]),M.useEffect(()=>(window.__HOP_TURN_TRACE=Bt.current,window.__HOP_DUMP_TURN_TRACE=()=>[...Bt.current],window.__HOP_PRINT_TURN_TRACE=(X=80)=>{const le=Bt.current.slice(-Math.max(1,Math.floor(X)));return console.table(le.map(me=>({id:me.id,event:me.event,turn:me.turnNumber,phase:me.phase,status:me.gameStatus,playerTurn:me.playerTurn,busy:me.isBusy,lock:me.postCommitInputLock,pending:`${me.pendingStatus}/${me.pendingFrames}`,queueHead:me.queueHead,actionLog:me.actionLogLength,details:me.details?JSON.stringify(me.details):""}))),le},window.__HOP_CLEAR_TURN_TRACE=()=>{Bt.current.length=0,rt.current=0},Bt.current.push({id:++rt.current,t:Date.now(),event:"TRACE_READY",turnNumber:0,phase:"INIT",gameStatus:"init",playerTurn:!1,isBusy:!1,postCommitInputLock:!1,pendingStatus:"none",pendingFrames:0,canPlayerInput:!1,shouldAdvanceQueue:!1,shouldResolvePending:!1,actionLogLength:0,queueHead:"none"}),()=>{delete window.__HOP_DUMP_TURN_TRACE,delete window.__HOP_PRINT_TURN_TRACE,delete window.__HOP_CLEAR_TURN_TRACE}),[]);const yn=M.useRef([]),Ti=M.useRef(null),Qn=M.useRef(""),Dn=M.useCallback(X=>{!X||X.length===0||(yn.current=[...yn.current,...X].slice(-600),window.__HOP_SIM_EVENTS=yn.current,window.dispatchEvent(new CustomEvent("hop:simulation-events",{detail:{turn:m.turnNumber,events:X}})),Ve("SIM_EVENTS",{count:X.length,lastType:X[X.length-1]?.type??"unknown"}))},[Ve,m.turnNumber]),Fe=M.useCallback(X=>{Ti.current=X,window.__HOP_UI_MIRROR=X},[]);M.useEffect(()=>(window.__HOP_SIM_EVENTS=yn.current,window.__HOP_DUMP_SIM_EVENTS=()=>[...yn.current],window.__HOP_CLEAR_SIM_EVENTS=()=>{yn.current=[],window.__HOP_SIM_EVENTS=[]},window.__HOP_DUMP_MIRROR=()=>window.__HOP_MIRROR_LAST,()=>{delete window.__HOP_DUMP_SIM_EVENTS,delete window.__HOP_CLEAR_SIM_EVENTS,delete window.__HOP_DUMP_MIRROR}),[]),M.useEffect(()=>{const X=lA(m);window.__HOP_ENGINE_MIRROR=X;const le=Ti.current;if(!le||le.turn!==X.turn||le.stackTick!==X.stackTick)return;const me=rA(X,le),we=`${X.turn}:${X.stackTick}:${me.ok?"ok":me.mismatches.length}`;we!==Qn.current&&(Qn.current=we,window.__HOP_MIRROR_LAST={engineSnapshot:X,uiSnapshot:le,result:me},me.ok||(Ve("MIRROR_MISMATCH",{count:me.mismatches.length}),console.warn("[HOP_MIRROR] snapshot mismatch detected",me.mismatches)))},[m,Ve]),M.useEffect(()=>{if(!Ue.shouldAdvanceQueue)return;Ve("QUEUE_SCHEDULE",{delayMs:Ue.queueAdvanceDelayMs});const X=window.setTimeout(()=>{it({type:"ADVANCE_TURN"},"queue_pump")},Ue.queueAdvanceDelayMs);return()=>window.clearTimeout(X)},[Ue.shouldAdvanceQueue,Ue.queueAdvanceDelayMs,m.turnNumber,m.initiativeQueue,m.player.id,m.enemies,it,Ve]);const mt=(X="unknown")=>{te&&Ve("LOCK_RELEASE",{reason:X,lockTurn:Ne.current,expectedActionLogLength:ft.current}),ue(!1),Ne.current=null,ft.current=null,qe.current=null,$t.current=!1,At.current="",$e.current="",Lt.current!==null&&(window.clearTimeout(Lt.current),Lt.current=null)},jt=M.useRef(""),bn=i(m.visualEvents),rn=M.useRef(""),Sn=a(m.timelineEvents),$t=M.useRef(!1),At=M.useRef(""),$e=M.useRef(""),Yt=220,Je=900,et=M.useRef(!1),Tt=M.useRef(0),cn=`${m.pendingStatus?.status??"none"}:${ze}`;M.useEffect(()=>{O||(jt.current=bn,rn.current=Sn)},[O,bn,Sn]),M.useEffect(()=>{et.current=!1,Tt.current=performance.now()},[cn]),M.useEffect(()=>{(m.pendingStatus||ze>0)&&O&&(et.current=!0)},[m.pendingStatus,ze,O]),M.useEffect(()=>{te&&O&&($t.current=!0)},[te,O]),M.useEffect(()=>{if(!te)return;const X=window.setTimeout(()=>{Ce(le=>le+1)},120);return()=>window.clearTimeout(X)},[te,Oe]),M.useEffect(()=>{const X=!O&&bn===jt.current&&Sn===rn.current,le=(m.timelineEvents||[]).some(Ct=>Ct.blocking),me=(m.timelineEvents||[]).filter(Ct=>Ct.blocking).reduce((Ct,kn)=>Ct+(kn.suggestedDurationMs||0),0),we=(m.visualEvents||[]).reduce((Ct,kn)=>{if(kn.type!=="kinetic_trace")return Ct;const Un=kn.payload;if(!Un)return Ct;const Ln=Math.max(0,Number(Un.startDelayMs||0)),wi=Math.max(0,Number(Un.durationMs||0));return Math.max(Ct,Ln+wi)},0),be=Math.max(me,we),De=be>0?Math.max(160,Math.min(3200,be+40)):0,ct=Math.max(0,performance.now()-Tt.current),dn=!le||et.current,xn=!le||ct>=De,Ht=X&&(dn||xn);if(Ue.shouldResolvePending){if(Ht){Ve("PENDING_RESOLVE_READY",{noPendingAnimations:X,hasBlockingTimeline:le,movementTraceBudgetMs:we,elapsedPendingMs:ct,requiredFallbackDelayMs:De}),it({type:"RESOLVE_PENDING"},"pending_ready");return}if(!O&&le&&!et.current){Ve("PENDING_RESOLVE_WAIT",{movementTraceBudgetMs:we,elapsedPendingMs:ct,requiredFallbackDelayMs:De});const Ct=Math.max(0,De-ct),kn=window.setTimeout(()=>{it({type:"RESOLVE_PENDING"},"pending_fallback_delay")},Ct);return()=>window.clearTimeout(kn)}}},[Ue.shouldResolvePending,m.timelineEvents,m.visualEvents,O,bn,Sn,it,Ve]),M.useEffect(()=>{if(!te)return;if(L||m.gameStatus!=="playing"){mt("mode_or_status_change");return}if(m.pendingStatus||(m.pendingFrames?.length??0)>0){mt("pending_intercept");return}const X=Ne.current,le=ft.current,me=qe.current!==null?Math.max(0,performance.now()-qe.current):Number.POSITIVE_INFINITY,we=X!==null?m.turnNumber>X:!1,be=le!==null?(m.actionLog?.length??0)>=le:!1,De=me>=Yt,ct=bn!==At.current||Sn!==$e.current,dn=!we&&!be,xn=!$t.current&&ct&&me<Je,Ht=m.gameStatus==="playing"&&!L&&!O&&!m.pendingStatus&&(m.pendingFrames?.length??0)===0&&bl(m);if(xn){Ve("LOCK_WAIT_FOR_BUSY",{lockAgeMs:me,visualsChangedSinceArm:ct});return}if(Ht&&dn&&me>450){mt("no_progress_timeout");return}Ht&&De&&(we||be||me>1500)&&mt(we?"turn_advanced":be?"action_committed":"age_fallback")},[te,L,m.gameStatus,m.turnNumber,m.pendingStatus,m.pendingFrames,m.initiativeQueue,m.actionLog,O,m.player.id,m.enemies,Ve,bn,Sn,Oe]),M.useEffect(()=>{m.gameStatus!=="playing"&&te&&mt("not_playing")},[m.gameStatus,te,Ve]),M.useEffect(()=>{if(te)return Lt.current!==null&&window.clearTimeout(Lt.current),Lt.current=window.setTimeout(()=>{te&&(console.error("[HOP_INPUT_LOCK] Watchdog released stuck post-commit lock",{turnNumber:m.turnNumber,pendingStatus:m.pendingStatus?.status,pendingFrames:m.pendingFrames?.length??0,playerTurn:bl(m),isBusy:O,actionLogLength:m.actionLog?.length??0,traceTail:Bt.current.slice(-40)}),Ve("LOCK_WATCHDOG_RELEASE"),mt("watchdog"))},8e3),()=>{Lt.current!==null&&(window.clearTimeout(Lt.current),Lt.current=null)}},[te,m.turnNumber,m.pendingStatus,m.actionLog,O,m.initiativeQueue,m.player.id,m.enemies,Ve]),M.useEffect(()=>{if(!te)return;const X=window.setTimeout(()=>{Ve("LOCK_STALL_SNAPSHOT",{lockAgeMs:qe.current!==null?Math.max(0,performance.now()-qe.current):null})},2500);return()=>window.clearTimeout(X)},[te,Ve]);const[Hn,Jn]=M.useState(null),[Mn,un]=M.useState(null),pt=M.useRef(m.floor);M.useEffect(()=>{if(m.gameStatus==="playing"&&m.floor!==pt.current){un({floor:m.floor,theme:m.theme||"Catacombs"}),pt.current=m.floor;const X=setTimeout(()=>un(null),3e3);return()=>clearTimeout(X)}},[m.floor,m.gameStatus,m.theme]),M.useEffect(()=>{if(m.gameStatus==="playing"&&m.floor===1&&!pt.current){un({floor:1,theme:m.theme||"Catacombs"}),pt.current=1;const X=setTimeout(()=>un(null),3e3);return()=>clearTimeout(X)}},[m.gameStatus]);const Dt=()=>{Lt.current!==null&&(window.clearTimeout(Lt.current),Lt.current=null),Ne.current=m.turnNumber,ft.current=(m.actionLog?.length??0)+1,qe.current=performance.now(),$t.current=!1,At.current=bn,$e.current=Sn,ue(!0),Ve("LOCK_ARM",{lockTurn:m.turnNumber,expectedActionLogLength:(m.actionLog?.length??0)+1,eventHashAtArm:bn,timelineHashAtArm:Sn})},Xt=X=>{Ot||re(X)},Rn=X=>{if(!Ot){if(ie){Dt(),it({type:"USE_SKILL",payload:{skillId:ie,target:X}},"player_use_skill"),re(null);return}if(J(X,m.player.position)){ge(!Re);return}Dt(),it({type:"MOVE",payload:X},"player_move"),ge(!1)}},Di=X=>{L||O||it({type:"SELECT_UPGRADE",payload:X},"upgrade_select")},ci=()=>{it({type:"RESET"},"reset"),re(null),W(!1),xe(null)},vn=()=>{Ot||(Dt(),it({type:"WAIT"},"player_wait"),re(null))},Kt=X=>{if(!X)return;const le=xg(X.actions||[]);if(!le.valid){const De=`Replay rejected: ${le.errors.slice(0,3).join(" | ")}`;xe(De),console.error("[HOP_REPLAY] Invalid replay actions",{replayId:X.id,errors:le.errors});return}xe(null),W(!0),Te(le.actions),Be(!1),ve.current=0;const me=X.seed||X.id||String(Date.now()),we=X.loadoutId?ho[X.loadoutId]:void 0,be=gs(1,me,me,void 0,we);it({type:"LOAD_STATE",payload:be},"replay_start")},Pn=()=>{const X=ve.current;if(X>=Z.length){Be(!1);return}it(Z[X],"replay_step"),ve.current=X+1};M.useEffect(()=>{if(!oe||!L)return;const X=window.setInterval(Pn,500);return()=>window.clearInterval(X)},[oe,L,Z]);const Hi=()=>{W(!1),xe(null),Ei()},Gi=(X,le)=>{it({type:"LOAD_STATE",payload:X},"scenario_load"),Jn(le),re(null)},Ei=()=>{it({type:"EXIT_TO_HUB"},"exit_to_hub"),re(null),W(!1),xe(null),r(g)};M.useEffect(()=>{if(!L){if((m.gameStatus==="won"||m.gameStatus==="lost")&&V.current!==m.initialSeed){V.current=m.initialSeed||"default";const X=m.initialSeed??m.rngSeed??"0",le=m.completedRun?.score||(m.player.hp||0)+(m.floor||0)*100,me=xg(m.actionLog||[]);if(!me.valid){console.error("[HOP_REPLAY] Refusing to persist replay with invalid action log",{errors:me.errors});return}const we=t(me.actions,m.floor||0),be={id:`run-${Date.now()}`,seed:X,loadoutId:m.player.archetype,actions:me.actions,score:le,floor:m.floor,date:new Date().toISOString(),replayVersion:2,diagnostics:we},De=localStorage.getItem("hop_replays_v1"),ct=De?JSON.parse(De):[],dn=[be,...ct].slice(0,100);localStorage.setItem("hop_replays_v1",JSON.stringify(dn));const xn=localStorage.getItem("hop_leaderboard_v1");let Ht=xn?JSON.parse(xn):[];Ht.push({id:be.id,name:"Player",score:be.score,floor:be.floor,date:be.date,seed:be.seed,loadoutId:be.loadoutId,actions:be.actions,replayVersion:be.replayVersion,diagnostics:be.diagnostics}),Ht.sort((Ct,kn)=>kn.score-Ct.score),Ht=Ht.slice(0,5),localStorage.setItem("hop_leaderboard_v1",JSON.stringify(Ht))}m.gameStatus==="hub"&&(V.current=null)}},[m.gameStatus,L,m.initialSeed]);const _i=X=>{const le=m.selectedLoadoutId;if(!le){console.warn("Start Run called without a selected loadout.");return}it({type:"START_RUN",payload:{loadoutId:le,mode:X}},"hub_start_run")},bs=X=>{it({type:"START_RUN",payload:{loadoutId:X,mode:"daily"}},"arcade_start_run"),r(g)};return E?p.jsx(_T,{assetManifest:k,onBack:()=>r(g)}):m.gameStatus==="hub"?p.jsxs("div",{className:"w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[!x&&p.jsx("button",{type:"button",onClick:()=>r(y),className:"absolute top-4 right-4 z-40 px-4 py-2 rounded-xl border border-cyan-300/35 bg-cyan-500/10 hover:bg-cyan-500/20 text-[10px] font-black uppercase tracking-[0.2em]",children:"Biome Sandbox"}),x?p.jsx(rT,{onBack:()=>r(g),onLaunchArcade:bs}):p.jsx(sT,{gameState:m,onSelectLoadout:X=>{it({type:"APPLY_LOADOUT",payload:X},"hub_select_loadout")},onStartRun:_i,onOpenArcade:()=>r(b),onLoadScenario:Gi,onStartReplay:Kt}),ne&&p.jsx("div",{className:"absolute top-4 right-4 z-40 max-w-xl px-4 py-3 rounded-xl border border-red-400/40 bg-red-900/70 text-red-100 text-xs font-bold tracking-wide",children:ne}),Hn&&p.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[p.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),p.jsx("p",{className:"text-white text-sm",children:Hn}),p.jsx("button",{onClick:()=>Jn(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]})]}):p.jsxs("div",{className:"flex w-screen h-screen bg-[#030712] overflow-hidden text-white font-['Inter',_sans-serif]",children:[p.jsx("aside",{className:"w-80 border-r border-white/5 bg-[#030712] flex flex-col z-20 overflow-y-auto",children:p.jsx(WA,{gameState:m,onReset:ci,onWait:vn,onExitToHub:Ei,inputLocked:Ot})}),p.jsx("main",{className:"flex-1 relative flex items-center justify-center bg-[#020617] overflow-hidden",children:p.jsx("div",{className:"w-full h-full p-8 flex items-center justify-center",children:p.jsxs("div",{className:`w-full h-full relative border border-white/5 bg-[#030712]/50 rounded-[40px] shadow-[inset_0_0_100px_rgba(0,0,0,0.5)] flex items-center justify-center overflow-hidden ${m.isShaking?"animate-shake":""}`,children:[p.jsx(_y,{gameState:m,onMove:Rn,selectedSkillId:ie,showMovementRange:Re,onBusyStateChange:Y,assetManifest:k,onSimulationEvents:Dn,onMirrorSnapshot:Fe}),Ot&&m.gameStatus==="playing"&&p.jsx("div",{className:"absolute inset-0 z-40 pointer-events-auto",children:p.jsx("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 px-3 py-2 rounded-lg bg-black/55 border border-white/15 text-[10px] font-bold uppercase tracking-[0.2em] text-white/70",children:"Resolving Turn..."})})]})})}),p.jsx("aside",{className:"w-80 border-l border-white/5 bg-[#030712] flex flex-col z-20 overflow-y-auto",children:p.jsxs("div",{className:"p-6 flex flex-col gap-8 h-full",children:[p.jsxs("div",{className:"flex-1",children:[p.jsx("h3",{className:"text-xs font-black uppercase tracking-[0.2em] text-white/30 mb-6",children:"Tactical Skills"}),p.jsx(QA,{skills:m.player.activeSkills||[],selectedSkillId:ie,onSelectSkill:Xt,hasSpear:m.hasSpear,gameState:m,inputLocked:Ot})]}),p.jsx("div",{className:"pt-8 border-t border-white/5 text-center",children:p.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-white/20",children:"Hop Engine v5.0"})})]})}),Hn&&p.jsxs("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-blue-900/90 border border-blue-500/30 p-4 rounded-xl backdrop-blur-md shadow-xl z-30 max-w-lg text-center animate-in fade-in slide-in-from-top-4",children:[p.jsx("h4",{className:"text-blue-200 font-bold uppercase text-xs tracking-widest mb-1",children:"Simulation Objective"}),p.jsx("p",{className:"text-white text-sm",children:Hn}),p.jsx("button",{onClick:()=>Jn(null),className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-950 rounded-full border border-blue-500/50 flex items-center justify-center text-xs hover:bg-blue-800 transition-colors",children:""})]}),m.gameStatus==="choosing_upgrade"&&p.jsx(XA,{onSelect:Di,gameState:m}),m.gameStatus==="lost"&&p.jsxs("div",{className:"fixed inset-0 bg-red-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[p.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),p.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Identity Deleted"}),p.jsx("p",{className:"text-red-200/60 mb-12 text-xl font-medium tracking-widest uppercase",children:"Simulation Terminated"}),p.jsx("button",{onClick:ci,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Reinitialize Simulation"})]}),m.gameStatus==="won"&&p.jsxs("div",{className:"fixed inset-0 bg-indigo-950/90 backdrop-blur-xl flex flex-col items-center justify-center z-[200] transition-opacity duration-500",children:[p.jsx("div",{className:"text-8xl mb-8 animate-bounce",children:""}),p.jsx("h2",{className:"text-6xl font-black text-white mb-2 tracking-tighter italic uppercase",children:"Arcade Mode Cleared"}),p.jsx("p",{className:"text-indigo-200/60 mb-2 text-xl font-medium tracking-widest uppercase",children:"The Sentinel has fallen"}),p.jsxs("p",{className:"text-white/20 mb-12 text-sm font-bold uppercase tracking-[0.3em]",children:["Score: ",m.completedRun?.score||0]}),p.jsx("button",{onClick:Ei,className:"px-12 py-4 bg-white text-black rounded-2xl font-black uppercase tracking-widest hover:scale-105 active:scale-95 transition-all shadow-[0_0_50px_rgba(255,255,255,0.3)]",children:"Return to Command Center"})]}),Mn&&p.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-[150] pointer-events-none animate-in fade-in duration-700",children:p.jsxs("div",{className:"text-center",children:[p.jsxs("div",{className:"text-indigo-500 font-black text-2xl uppercase tracking-[0.5em] mb-4 animate-in slide-in-from-bottom-8 duration-1000",children:["Floor ",Mn.floor]}),p.jsx("h2",{className:"text-8xl font-black text-white uppercase tracking-tighter italic animate-in slide-in-from-top-12 duration-1000",children:Mn.theme}),p.jsx("div",{className:"h-1 w-64 bg-white/20 mx-auto mt-8 rounded-full overflow-hidden",children:p.jsx("div",{className:"h-full bg-indigo-500 animate-[progress_3s_linear]"})})]})}),L&&p.jsxs("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 bg-[#030712]/90 border border-indigo-500/30 p-6 rounded-3xl backdrop-blur-2xl shadow-[0_0_50px_rgba(79,70,229,0.2)] z-[250] flex items-center gap-8 animate-in slide-in-from-bottom-8 duration-500",children:[p.jsxs("div",{className:"flex flex-col",children:[p.jsx("span",{className:"text-[10px] font-black uppercase tracking-[0.3em] text-indigo-400 mb-1",children:"Replay System"}),p.jsxs("span",{className:"text-white font-bold text-sm",children:["Step ",ve.current," / ",Z.length]})]}),p.jsx("div",{className:"h-8 w-px bg-white/10"}),p.jsxs("div",{className:"flex items-center gap-4",children:[p.jsx("button",{onClick:()=>Be(!oe),className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${oe?"bg-indigo-500 text-white shadow-[0_0_20px_rgba(79,70,229,0.5)]":"bg-white/5 text-white/50 hover:bg-white/10"}`,children:oe?"":""}),p.jsx("button",{onClick:Pn,disabled:oe,className:"w-12 h-12 bg-white/5 hover:bg-white/10 disabled:opacity-30 disabled:hover:bg-white/5 text-white rounded-xl flex items-center justify-center transition-all",children:""})]}),p.jsx("div",{className:"h-8 w-px bg-white/10"}),p.jsx("button",{onClick:Hi,className:"px-6 py-3 bg-red-500/10 hover:bg-red-500/20 text-red-500 rounded-xl font-bold uppercase text-xs tracking-widest transition-all",children:"Close"})]})]})}Pb.createRoot(document.getElementById("root")).render(p.jsx(M.StrictMode,{children:p.jsx(OT,{})}));
